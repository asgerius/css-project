[{"tags": ["haskell", "haskell-stack"], "comments": [{"owner": {"reputation": 13807, "user_id": 2407038, "user_type": "registered", "accept_rate": 64, "profile_image": "https://www.gravatar.com/avatar/538f6f4a9aa43841841de7d8e8b169fc?s=128&d=identicon&r=PG&f=1", "display_name": "user2407038", "link": "https://stackoverflow.com/users/2407038/user2407038"}, "edited": false, "score": 3, "creation_date": 1498088883, "post_id": 44687898, "comment_id": 76359838, "body": "<code>&#39;&#39;</code> is not a valid character."}, {"owner": {"reputation": 1233, "user_id": 101326, "user_type": "registered", "accept_rate": 80, "profile_image": "https://www.gravatar.com/avatar/b67dd441d570e1913e87396718b70f48?s=128&d=identicon&r=PG", "display_name": "anru ", "link": "https://stackoverflow.com/users/101326/anru"}, "reply_to_user": {"reputation": 13807, "user_id": 2407038, "user_type": "registered", "accept_rate": 64, "profile_image": "https://www.gravatar.com/avatar/538f6f4a9aa43841841de7d8e8b169fc?s=128&d=identicon&r=PG&f=1", "display_name": "user2407038", "link": "https://stackoverflow.com/users/2407038/user2407038"}, "edited": false, "score": 0, "creation_date": 1498088974, "post_id": 44687898, "comment_id": 76359862, "body": "@user2407038, ah, i see, then how to return a empty char in haskell?"}, {"owner": {"reputation": 20333, "user_id": 774078, "user_type": "registered", "accept_rate": 94, "profile_image": "https://i.stack.imgur.com/seSXR.png?s=128&g=1", "display_name": "Sterling Archer", "link": "https://stackoverflow.com/users/774078/sterling-archer"}, "edited": false, "score": 0, "creation_date": 1498089158, "post_id": 44687898, "comment_id": 76359905, "body": "@anru <a href=\"https://stackoverflow.com/questions/36554499/haskell-have-a-function-return-an-empty-character\" title=\"haskell have a function return an empty character\">stackoverflow.com/questions/36554499/&hellip;</a>"}, {"owner": {"reputation": 1233, "user_id": 101326, "user_type": "registered", "accept_rate": 80, "profile_image": "https://www.gravatar.com/avatar/b67dd441d570e1913e87396718b70f48?s=128&d=identicon&r=PG", "display_name": "anru ", "link": "https://stackoverflow.com/users/101326/anru"}, "edited": false, "score": 1, "creation_date": 1498089283, "post_id": 44687898, "comment_id": 76359933, "body": "ok, see that, I should use Maybe"}, {"owner": {"reputation": 126897, "user_id": 791604, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/ce991df7a056248d5e4f6fc3659ba733?s=128&d=identicon&r=PG", "display_name": "Daniel Wagner", "link": "https://stackoverflow.com/users/791604/daniel-wagner"}, "edited": false, "score": 0, "creation_date": 1498093798, "post_id": 44687898, "comment_id": 76360927, "body": "See also <a href=\"http://hackage.haskell.org/package/safe-0.3.15/docs/Safe.html#v:atMay\" rel=\"nofollow noreferrer\"><code>at*</code></a> from the safe package."}], "answers": [{"comments": [{"owner": {"reputation": 1233, "user_id": 101326, "user_type": "registered", "accept_rate": 80, "profile_image": "https://www.gravatar.com/avatar/b67dd441d570e1913e87396718b70f48?s=128&d=identicon&r=PG", "display_name": "anru ", "link": "https://stackoverflow.com/users/101326/anru"}, "edited": false, "score": 0, "creation_date": 1498205416, "post_id": 44692714, "comment_id": 76414794, "body": "thanks mate. i was just playing around String/Char Type. but &#39;&#39; is not a character really confused me. I do not know about language design theory, but like programmer always count from 0 not 1. &#39;&#39; is a character for me just seems natural."}, {"owner": {"reputation": 94713, "user_id": 1139697, "user_type": "registered", "accept_rate": 86, "profile_image": "https://www.gravatar.com/avatar/5f136ddb684f39aaee1c028ee1950f6f?s=128&d=identicon&r=PG", "display_name": "Zeta", "link": "https://stackoverflow.com/users/1139697/zeta"}, "reply_to_user": {"reputation": 1233, "user_id": 101326, "user_type": "registered", "accept_rate": 80, "profile_image": "https://www.gravatar.com/avatar/b67dd441d570e1913e87396718b70f48?s=128&d=identicon&r=PG", "display_name": "anru ", "link": "https://stackoverflow.com/users/101326/anru"}, "edited": false, "score": 0, "creation_date": 1498205708, "post_id": 44692714, "comment_id": 76414967, "body": "A <code>Char</code> in Haskell cannot be &quot;empty&quot;. You can set it to <code>&#39;\\NUL&#39;</code>, but that&#39;s something else. It&#39;s the same as in C, you cannot set <code>char x = &#39;&#39;</code> there. In your other languages, PHP and JS, there is only a minor distinction between a single character and a string, thus <code>&#39;&#39;</code> is an empty <b><i>string</i></b> in those languages."}], "tags": [], "owner": {"reputation": 94713, "user_id": 1139697, "user_type": "registered", "accept_rate": 86, "profile_image": "https://www.gravatar.com/avatar/5f136ddb684f39aaee1c028ee1950f6f?s=128&d=identicon&r=PG", "display_name": "Zeta", "link": "https://stackoverflow.com/users/1139697/zeta"}, "is_accepted": true, "score": 2, "last_activity_date": 1498116120, "last_edit_date": 1592644375, "creation_date": 1498116120, "answer_id": 44692714, "question_id": 44687898, "link": "https://stackoverflow.com/questions/44687898/haskell-syntax-error/44692714#44692714", "title": "Haskell : Syntax error", "body": "<p>The <a href=\"https://www.haskell.org/onlinereport/haskell2010/haskellch2.html#x7-200002.6\" rel=\"nofollow noreferrer\">syntax for character literals dictates that you need something between the single quotes</a>:</p>\n<blockquote>\n<h2>2.6 Character and String Literals</h2>\n<pre><code>char  \u2192   '(graphic|space|escape\u27e8\\&amp;\u27e9)' [remark: heavily simplified]\n</code></pre>\n<p>Character literals are written between single quotes, as in 'a'</p>\n</blockquote>\n<p>Therefore, <code>''</code> isn't valid syntax for a character. How should it be? There's no character to begin with. The type <code>Char</code> does not contain the notion of not being a character, just as <code>Int</code> does not contain the notion of not existing.</p>\n<p>That's exactly what <code>Maybe</code> is for:</p>\n<pre><code>my_nthele :: String -&gt; Integer -&gt; Maybe Char\nmy_nthele [] n = Nothing\nmy_nthele (x:xs) n  | n == 0 = Just x\n                    | otherwise = my_nthele xs (n-1)\n</code></pre>\n<p>By the way, as an exercise, try to make your function more generic, so that one can also use <code>my_nthele [1..10] 3 == Just 4</code>. It's not hard, but let's you play around with <code>Maybe</code>.</p>\n"}], "owner": {"reputation": 1233, "user_id": 101326, "user_type": "registered", "accept_rate": 80, "profile_image": "https://www.gravatar.com/avatar/b67dd441d570e1913e87396718b70f48?s=128&d=identicon&r=PG", "display_name": "anru ", "link": "https://stackoverflow.com/users/101326/anru"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 245, "favorite_count": 0, "accepted_answer_id": 44692714, "answer_count": 1, "score": 1, "last_activity_date": 1498116120, "creation_date": 1498088836, "last_edit_date": 1498088906, "question_id": 44687898, "link": "https://stackoverflow.com/questions/44687898/haskell-syntax-error", "title": "Haskell : Syntax error", "body": "<p>I am use Haskell stack.</p>\n\n<pre><code>module Len () where\n\n   my_nthele :: String -&gt; Integer -&gt; Char\n   my_nthele [] n = ''\n   my_nthele (x:xs) n  | n == 0 = x\n                       | otherwise = my_nthele xs (n-1)\n</code></pre>\n\n<p>Haskell interpreter shows \"src/Len.hs:5:1: error:\n    parse error (possibly incorrect indentation or mismatched brackets)\"</p>\n\n<p>I have no clue about what is wrong.</p>\n"}, {"tags": ["haskell", "infix-operator"], "comments": [{"owner": {"reputation": 100892, "user_id": 745903, "user_type": "registered", "accept_rate": 74, "profile_image": "https://www.gravatar.com/avatar/50933f6638836741e620669b3940410e?s=128&d=identicon&r=PG", "display_name": "leftaroundabout", "link": "https://stackoverflow.com/users/745903/leftaroundabout"}, "edited": false, "score": 1, "creation_date": 1498088897, "post_id": 44687319, "comment_id": 76359842, "body": "While I think I&#39;ve actually tried making <code>\u3009</code> an infix myself at some point, I daresay it&#39;s just a bad idea. It would more sense to allow symbols like <code>\u2768</code>, <code>\u276c</code>, <code>\u2774</code>, <code>\u27e6</code> or <code>\u201c</code> as custom <a href=\"http://hackage.haskell.org/package/template-haskell-2.11.1.0/docs/Language-Haskell-TH-Quote.html#t:QuasiQuoter\" rel=\"nofollow noreferrer\">quasiquote</a> characters."}], "answers": [{"tags": [], "owner": {"reputation": 126897, "user_id": 791604, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/ce991df7a056248d5e4f6fc3659ba733?s=128&d=identicon&r=PG", "display_name": "Daniel Wagner", "link": "https://stackoverflow.com/users/791604/daniel-wagner"}, "is_accepted": true, "score": 7, "last_activity_date": 1498086843, "creation_date": 1498086843, "answer_id": 44687633, "question_id": 44687319, "link": "https://stackoverflow.com/questions/44687319/why-isnt-allowed-as-a-haskell-infix-operator/44687633#44687633", "title": "Why isn&#39;t \u3009allowed as a Haskell infix operator?", "body": "<p>It's probably a bug. It doesn't seem to allow any characters marked as <code>ClosePunctuation</code> or <code>OpenPunctuation</code> by <code>generalCategory</code>. I suggest you open a ticket on the GHC Trac and see what they think.</p>\n\n<p><a href=\"https://ghc.haskell.org/trac/ghc/ticket/2687\" rel=\"noreferrer\">https://ghc.haskell.org/trac/ghc/ticket/2687</a> looks related and suggests that at least at some point <code>OpenPunctuation</code> and <code>ClosePunctuation</code> were considered graphic rather than symbol.</p>\n"}], "owner": {"reputation": 12664, "user_id": 422252, "user_type": "registered", "accept_rate": 94, "profile_image": "https://i.stack.imgur.com/rUirn.jpg?s=128&g=1", "display_name": "Lime", "link": "https://stackoverflow.com/users/422252/lime"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 214, "favorite_count": 0, "accepted_answer_id": 44687633, "answer_count": 1, "score": 5, "last_activity_date": 1498095445, "creation_date": 1498084605, "last_edit_date": 1498095445, "question_id": 44687319, "link": "https://stackoverflow.com/questions/44687319/why-isnt-allowed-as-a-haskell-infix-operator", "title": "Why isn&#39;t \u3009allowed as a Haskell infix operator?", "body": "<p>Why isn't \u3009 allowed as an infix operator in Haskell?</p>\n\n<pre><code>GHCi, version 8.0.2: http://www.haskell.org/ghc/  :? for help\nPrelude&gt; :{\n infixr 6 \u3009\n (\u3009) :: Int -&gt; (Int -&gt; (Int))\n a \u3009 b = a + 2*b\n:}\nprint (1 \u3009 2)\n</code></pre>\n\n<p>According to this <a href=\"http://www.haskell.org/onlinereport/lexemes.html\" rel=\"nofollow noreferrer\">Haskell Report</a> <code>any Unicode symbol or punctuation</code> and <a href=\"https://stackoverflow.com/questions/10548170/what-characters-are-permitted-for-haskell-operators\">this question</a> it should work.</p>\n\n\n"}, {"tags": ["algorithm", "haskell", "neural-network", "backpropagation"], "comments": [{"owner": {"reputation": 3958, "user_id": 4196726, "user_type": "registered", "accept_rate": 64, "profile_image": "https://lh3.googleusercontent.com/-wQ86ZJ6sCsA/AAAAAAAAAAI/AAAAAAAAAI8/2dENRfi7v5c/photo.jpg?sz=128", "display_name": "Charles Langlois", "link": "https://stackoverflow.com/users/4196726/charles-langlois"}, "reply_to_user": {"reputation": 126897, "user_id": 791604, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/ce991df7a056248d5e4f6fc3659ba733?s=128&d=identicon&r=PG", "display_name": "Daniel Wagner", "link": "https://stackoverflow.com/users/791604/daniel-wagner"}, "edited": false, "score": 17, "creation_date": 1498090497, "post_id": 44686609, "comment_id": 76360203, "body": "Thanks, I&#39;ll look into that. But I don&#39;t think this is normal behavior. As far as I know, other implementations of what I&#39;m trying to do(simple feedforward fully connected neural network), either in Haskell or other languages, don&#39;t seem to be doing that."}, {"owner": {"reputation": 336, "user_id": 7236501, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/7f52887fba37383964c102def911c9bc?s=128&d=identicon&r=PG&f=1", "display_name": "shinobi", "link": "https://stackoverflow.com/users/7236501/shinobi"}, "edited": false, "score": 17, "creation_date": 1498829830, "post_id": 44686609, "comment_id": 76676105, "body": "@Charles: Did you actually try your own networks and data sets with said other implementations?  In my own experience, BP will easily go haywire when the NN is ill-suited to the problem.  If you have doubts about your implementation of BP, you can compare its output with that of a naive gradient calculation (over a toy-sized NN, of course) -- which is way harder to get wrong than BP."}, {"owner": {"reputation": 3958, "user_id": 4196726, "user_type": "registered", "accept_rate": 64, "profile_image": "https://lh3.googleusercontent.com/-wQ86ZJ6sCsA/AAAAAAAAAAI/AAAAAAAAAI8/2dENRfi7v5c/photo.jpg?sz=128", "display_name": "Charles Langlois", "link": "https://stackoverflow.com/users/4196726/charles-langlois"}, "edited": false, "score": 0, "creation_date": 1498905617, "post_id": 44686609, "comment_id": 76699695, "body": "Okay, I might try that.  My tests were with a (784-X-10) network(i.e. 1 hidden layer). I tried for a few values of X, also varying batch size and learning rate.  My dataset is MNIST. It&#39;s my understanding that this kind of architecture should work for MNIST."}, {"owner": {"reputation": 3958, "user_id": 4196726, "user_type": "registered", "accept_rate": 64, "profile_image": "https://lh3.googleusercontent.com/-wQ86ZJ6sCsA/AAAAAAAAAAI/AAAAAAAAAI8/2dENRfi7v5c/photo.jpg?sz=128", "display_name": "Charles Langlois", "link": "https://stackoverflow.com/users/4196726/charles-langlois"}, "edited": false, "score": 0, "creation_date": 1541262488, "post_id": 44686609, "comment_id": 93159860, "body": "No, sorry, I went on to do other things and left this in the freezer. Shame on me."}, {"owner": {"reputation": 21891, "user_id": 1243762, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/b9b83cf6ca76699d7abfbba07f4675a3?s=128&d=identicon&r=PG&f=1", "display_name": "Guy Coder", "link": "https://stackoverflow.com/users/1243762/guy-coder"}, "edited": false, "score": 0, "creation_date": 1541598698, "post_id": 44686609, "comment_id": 93270382, "body": "Just ran into your question and had the same problem when doing neural network for MNIST in F#. I started learning with <a href=\"http://neuralnetworksanddeeplearning.com/index.html\" rel=\"nofollow noreferrer\">Neural Networks and Deep Learning</a> to get a working example. Then I converted the Python to F# and thought I had done it correctly, but alas ran into the same problems as you."}, {"owner": {"reputation": 21891, "user_id": 1243762, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/b9b83cf6ca76699d7abfbba07f4675a3?s=128&d=identicon&r=PG&f=1", "display_name": "Guy Coder", "link": "https://stackoverflow.com/users/1243762/guy-coder"}, "edited": false, "score": 0, "creation_date": 1541598914, "post_id": 44686609, "comment_id": 93270495, "body": "So I did one of the options of last recourse and generated the initial random data with the Python example then transported it over to the F# example. This took many hours to write the export and import routines as it is not a copy and paste. Thus both version are working on the same starting data, but that was generated randomly. Then I singled stepped the Python version and the F# version at the same time and compared the numbers for the variables. This eventually led to me uncovering the differences. Needless to say it was a long  and tedious process that took many days."}, {"owner": {"reputation": 21891, "user_id": 1243762, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/b9b83cf6ca76699d7abfbba07f4675a3?s=128&d=identicon&r=PG&f=1", "display_name": "Guy Coder", "link": "https://stackoverflow.com/users/1243762/guy-coder"}, "edited": false, "score": 0, "creation_date": 1541599204, "post_id": 44686609, "comment_id": 93270641, "body": "Now the F# version works the same as the Python version. I posted some of the details with code examples when giving answers here at SO, but I can&#39;t find them in a few minutes, otherwise I would add them here. :)"}, {"owner": {"reputation": 3958, "user_id": 4196726, "user_type": "registered", "accept_rate": 64, "profile_image": "https://lh3.googleusercontent.com/-wQ86ZJ6sCsA/AAAAAAAAAAI/AAAAAAAAAI8/2dENRfi7v5c/photo.jpg?sz=128", "display_name": "Charles Langlois", "link": "https://stackoverflow.com/users/4196726/charles-langlois"}, "edited": false, "score": 0, "creation_date": 1541626078, "post_id": 44686609, "comment_id": 93284778, "body": "Thanks, I&#39;ll go and read those links, but I&#39;m confused. You encountered the same issue, and eventually succeeded in making it work? Did you find out what the problem was?"}, {"owner": {"reputation": 475, "user_id": 6937913, "user_type": "registered", "profile_image": "https://lh4.googleusercontent.com/-yUSwVDc0tsg/AAAAAAAAAAI/AAAAAAAAAP4/bTH1nK7iTqs/photo.jpg?sz=128", "display_name": "gngdb", "link": "https://stackoverflow.com/users/6937913/gngdb"}, "edited": false, "score": 0, "creation_date": 1558948034, "post_id": 44686609, "comment_id": 99253816, "body": "If it helps, someone made a <a href=\"https://github.com/HuwCampbell/grenade\" rel=\"nofollow noreferrer\">neural network library in Haskell</a>."}, {"owner": {"reputation": 6164, "user_id": 1319284, "user_type": "registered", "accept_rate": 69, "profile_image": "https://www.gravatar.com/avatar/519eaa527537a16e0a4665432095c2e5?s=128&d=identicon&r=PG", "display_name": "kutschkem", "link": "https://stackoverflow.com/users/1319284/kutschkem"}, "edited": false, "score": 0, "creation_date": 1571735175, "post_id": 44686609, "comment_id": 103330237, "body": "<code>NaN</code> typically appears when you try to <code>0 &#47; 0</code>, but I don&#39;t see any divisions in the code? Is there some normalization happening somewhere?"}, {"owner": {"reputation": 8621, "user_id": 1848029, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/qfjAy.jpg?s=128&g=1", "display_name": "lehins", "link": "https://stackoverflow.com/users/1848029/lehins"}, "edited": false, "score": 0, "creation_date": 1574863930, "post_id": 44686609, "comment_id": 104382032, "body": "Here is a guide about <a href=\"http://penkovsky.com/neural-networks/\" rel=\"nofollow noreferrer\">Neural Networks in Haskell</a> I don&#39;t think it will help solve the numeric issue in the code, but could be helpful nevertheless."}, {"owner": {"reputation": 1127, "user_id": 9546874, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/ee21d1f7accfbf83abc5ea5663982ac7?s=128&d=identicon&r=PG&f=1", "display_name": "Recessive", "link": "https://stackoverflow.com/users/9546874/recessive"}, "edited": false, "score": 4, "creation_date": 1575264554, "post_id": 44686609, "comment_id": 104493967, "body": "Also, just to save you some time, Xavier initialisation can be implemented through the following: <code>\u03c3 = (6&#47;(input_size + output_size))^0.5</code>, Then multiply that by a random integer from the set <code>{-1, 0, 1}</code> to get the initial value for every weight in the network."}, {"owner": {"reputation": 5759, "user_id": 997378, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/a11366bc2dfe133e16a89898fa33b24f?s=128&d=identicon&r=PG", "display_name": "mdaoust", "link": "https://stackoverflow.com/users/997378/mdaoust"}, "edited": false, "score": 5, "creation_date": 1578764276, "post_id": 44686609, "comment_id": 105548577, "body": "Isn&#39;t MNIST typically a classification problem? Why are you using MES? You should be using softmax crossentropy (calculated from the logits) no?"}, {"owner": {"reputation": 3958, "user_id": 4196726, "user_type": "registered", "accept_rate": 64, "profile_image": "https://lh3.googleusercontent.com/-wQ86ZJ6sCsA/AAAAAAAAAAI/AAAAAAAAAI8/2dENRfi7v5c/photo.jpg?sz=128", "display_name": "Charles Langlois", "link": "https://stackoverflow.com/users/4196726/charles-langlois"}, "reply_to_user": {"reputation": 5759, "user_id": 997378, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/a11366bc2dfe133e16a89898fa33b24f?s=128&d=identicon&r=PG", "display_name": "mdaoust", "link": "https://stackoverflow.com/users/997378/mdaoust"}, "edited": false, "score": 1, "creation_date": 1579032563, "post_id": 44686609, "comment_id": 105630506, "body": "@mdaoust I don&#39;t know, I don&#39;t remember why I chose that function(maybe I was under the impression that it didn&#39;t matter). What are &quot;logits&quot;?"}, {"owner": {"reputation": 5759, "user_id": 997378, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/a11366bc2dfe133e16a89898fa33b24f?s=128&d=identicon&r=PG", "display_name": "mdaoust", "link": "https://stackoverflow.com/users/997378/mdaoust"}, "edited": false, "score": 6, "creation_date": 1579093045, "post_id": 44686609, "comment_id": 105650095, "body": "@CharlesLanglois, It may not be your problem (I can&#39;t read the code) but &quot;mean square error&quot; is not convex for  a classification problem,which could explain getting stuck. &quot;logits&quot; is just a fancy way to say log-odds: Use the <code>ce = x_j - log(sum_i(exp(x)))</code> calculation <a href=\"https://blog.feedly.com/tricks-of-the-trade-logsumexp/\" rel=\"nofollow noreferrer\">from here</a> so you don&#39;t take the log of the exponential (which often generates NaNs)"}, {"owner": {"reputation": 1202, "user_id": 6619250, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/9f47e2aa5bd9841c653a46090c23692b?s=128&d=identicon&r=PG&f=1", "display_name": "hongsy", "link": "https://stackoverflow.com/users/6619250/hongsy"}, "edited": false, "score": 6, "creation_date": 1579355161, "post_id": 44686609, "comment_id": 105742919, "body": "Congratulations on being the <a href=\"https://stackoverflow.com/unanswered/tagged/?tab=votes\">highest voted</a> question (as of Jan &#39;20) with no upvoted or accepted answers!"}, {"owner": {"reputation": 3958, "user_id": 4196726, "user_type": "registered", "accept_rate": 64, "profile_image": "https://lh3.googleusercontent.com/-wQ86ZJ6sCsA/AAAAAAAAAAI/AAAAAAAAAI8/2dENRfi7v5c/photo.jpg?sz=128", "display_name": "Charles Langlois", "link": "https://stackoverflow.com/users/4196726/charles-langlois"}, "edited": false, "score": 3, "creation_date": 1579369174, "post_id": 44686609, "comment_id": 105746715, "body": "lol, thanks. I&#39;ve upvoted many comments that are helpful and relevant. If I ever decide to pick this up again, I&#39;ll be sure to post an answer."}, {"owner": {"reputation": 1648, "user_id": 2535207, "user_type": "registered", "accept_rate": 83, "profile_image": "https://www.gravatar.com/avatar/a0db392082edc1a1fc6f6c927210c233?s=128&d=identicon&r=PG", "display_name": "Jeremy Cochoy", "link": "https://stackoverflow.com/users/2535207/jeremy-cochoy"}, "edited": false, "score": 4, "creation_date": 1581343340, "post_id": 44686609, "comment_id": 106389869, "body": "I did exactly what you are doing <a href=\"https://github.com/jeremycochoy/haskell-ffnn\" rel=\"nofollow noreferrer\">in 2015</a>. My advice is: 1) Check your backprop equation. 2) Check your learning rate 3) Check your initialization, 4) Check your loss function. Even with the right equations, you can have very weird behavior with the wrong meta-parameters."}, {"owner": {"reputation": 3683, "user_id": 330242, "user_type": "registered", "accept_rate": 78, "profile_image": "https://www.gravatar.com/avatar/c9f3ffc3e30d25eb64e2e464f0a86bd7?s=128&d=identicon&r=PG", "display_name": "przemo_li", "link": "https://stackoverflow.com/users/330242/przemo-li"}, "edited": false, "score": 0, "creation_date": 1582812765, "post_id": 44686609, "comment_id": 106912337, "body": "I&#39;ve dropped Haskell and Hmatrix tags. Seam&#39;s like most comments pointed at purely NN related issue."}, {"owner": {"reputation": 59, "user_id": 13475152, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/zNNwf.png?s=128&g=1", "display_name": "EthanDevelops", "link": "https://stackoverflow.com/users/13475152/ethandevelops"}, "edited": false, "score": 1, "creation_date": 1590355874, "post_id": 44686609, "comment_id": 109643616, "body": "I found a similar solved question: <a href=\"https://codereview.stackexchange.com/questions/122698/conversion-of-a-simple-python-neural-network-to-a-haskell-implementation/122770\" title=\"conversion of a simple python neural network to a haskell implementation\">codereview.stackexchange.com/questions/122698/&hellip;</a>"}, {"owner": {"reputation": 930, "user_id": 4387539, "user_type": "registered", "accept_rate": 77, "profile_image": "https://i.stack.imgur.com/xN2AM.png?s=128&g=1", "display_name": "hyiltiz", "link": "https://stackoverflow.com/users/4387539/hyiltiz"}, "edited": false, "score": 1, "creation_date": 1596063886, "post_id": 44686609, "comment_id": 111694172, "body": "Just checked your code in Github, specifically <code>Data&#47;Activation.hs</code>. Your <code>logistic</code> and other activation functions are varbatim math definitions; within the bounds of floating point accuracy, it is very easy to get <code>activation(x)=1</code> or <code>activation(x)=0</code> even for non-infinite <code>x</code>. Either use log-spaces, or hack in offsets s.t. <code>p=1</code> or <code>p=0</code> probabilities never occur."}, {"owner": {"reputation": 8401, "user_id": 4281353, "user_type": "registered", "accept_rate": 69, "profile_image": "https://www.gravatar.com/avatar/5798d66c436d82869b85c0d6f8cabe35?s=128&d=identicon&r=PG&f=1", "display_name": "mon", "link": "https://stackoverflow.com/users/4281353/mon"}, "edited": false, "score": 0, "creation_date": 1615702024, "post_id": 44686609, "comment_id": 117769944, "body": "@CharlesLanglois, have you found the cause? Kindly share if so as I am interested in numeric error issues because I am having the same situations."}, {"owner": {"reputation": 3958, "user_id": 4196726, "user_type": "registered", "accept_rate": 64, "profile_image": "https://lh3.googleusercontent.com/-wQ86ZJ6sCsA/AAAAAAAAAAI/AAAAAAAAAI8/2dENRfi7v5c/photo.jpg?sz=128", "display_name": "Charles Langlois", "link": "https://stackoverflow.com/users/4196726/charles-langlois"}, "reply_to_user": {"reputation": 8401, "user_id": 4281353, "user_type": "registered", "accept_rate": 69, "profile_image": "https://www.gravatar.com/avatar/5798d66c436d82869b85c0d6f8cabe35?s=128&d=identicon&r=PG&f=1", "display_name": "mon", "link": "https://stackoverflow.com/users/4281353/mon"}, "edited": false, "score": 0, "creation_date": 1616530428, "post_id": 44686609, "comment_id": 118030761, "body": "@mon Sorry, I haven&#39;t gotten back on this (yet), this was just a small token attempt at the time, unrelated to my job or my other programming interests(haven&#39;t touched Haskell in a while, unfortunately).  Many of the comments here and the 1 answer below seem to provide promising solutions/explanations, such as using a different activation function or loss function, using an initialization algorithm to provide inital weights... Good luck!"}], "answers": [{"tags": [], "owner": {"reputation": 46, "user_id": 9316171, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/6ad00c01999dfdd88dc7334e7ccd6d5e?s=128&d=identicon&r=PG&f=1", "display_name": "jcft2", "link": "https://stackoverflow.com/users/9316171/jcft2"}, "is_accepted": false, "score": 3, "last_activity_date": 1597181507, "last_edit_date": 1597181507, "creation_date": 1597153669, "answer_id": 63359574, "question_id": 44686609, "link": "https://stackoverflow.com/questions/44686609/extremely-small-or-nan-values-appear-in-training-neural-network/63359574#63359574", "title": "Extremely small or NaN values appear in training neural network", "body": "<p>Do you know about &quot;vanishing&quot; and &quot;exploding&quot; gradients in backpropagation?  I'm not too familiar with Haskell so I can't easily see what exactly your backprop is doing, but it does look like you are using a logistic curve as your activation function.</p>\n<p>If you look at the plot of this function you'll see that the gradient of this function is nearly 0 at the ends (as input values get very large or very small, the slope of the curve is almost flat), so multiplying or dividing by this during backpropagation will result in a very big or very small number.  Doing this repeatedly as you pass through multiple layers causes the activations to approach zero or infinity.  Since backprop updates your weights by doing this during training, you end up with a lot of zeros or infinities in your network.</p>\n<p>Solution:  there are loads of methods out there that you can search for to solve the vanishing gradient problem, but one easy thing to try is to change the type of activation function you are using to a non-saturating one.  ReLU is a popular choice as it mitigates this particular problem (but might introduce others).</p>\n"}], "owner": {"reputation": 3958, "user_id": 4196726, "user_type": "registered", "accept_rate": 64, "profile_image": "https://lh3.googleusercontent.com/-wQ86ZJ6sCsA/AAAAAAAAAAI/AAAAAAAAAI8/2dENRfi7v5c/photo.jpg?sz=128", "display_name": "Charles Langlois", "link": "https://stackoverflow.com/users/4196726/charles-langlois"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 10844, "favorite_count": 41, "protected_date": 1589260855, "answer_count": 1, "score": 328, "last_activity_date": 1597181507, "creation_date": 1498080722, "last_edit_date": 1596575077, "question_id": 44686609, "link": "https://stackoverflow.com/questions/44686609/extremely-small-or-nan-values-appear-in-training-neural-network", "title": "Extremely small or NaN values appear in training neural network", "body": "<p>I'm trying to implement a neural network architecture in Haskell, and use it on MNIST.</p>\n<p>I'm using the <code>hmatrix</code> package for linear algebra.\nMy training framework is built using the <code>pipes</code> package.</p>\n<p>My code compiles and doesn't crash. But the problem is, certain combinations of layer size (say, 1000), minibatch size, and learning rate give rise to <code>NaN</code> values in the computations. After some inspection, I see that extremely small values (order of <code>1e-100</code>) eventually appear in the activations. But, even when that doesn't happen, the training still doesn't work. There's no improvement over its loss or accuracy.</p>\n<p>I checked and rechecked my code, and I'm at a loss as to what the root of the problem could be.</p>\n<p>Here's the backpropagation training, which computes the deltas for each layer:</p>\n<pre><code>backward lf n (out,tar) das = do\n    let \u03b4out = tr (derivate lf (tar, out)) -- dE/dy\n        deltas = scanr (\\(l, a') \u03b4 -&gt;\n                         let w = weights l\n                         in (tr a') * (w &lt;&gt; \u03b4)) \u03b4out (zip (tail $ toList n) das)\n    return (deltas)\n</code></pre>\n<p><code>lf</code> is the loss function, <code>n</code> is the network (<code>weight</code> matrix and <code>bias</code> vector for each layer), <code>out</code> and <code>tar</code> are the actual output of the network and the <code>target</code> (desired) output, and <code>das</code> are the activation derivatives of each layer.</p>\n<p>In batch mode, <code>out</code>, <code>tar</code> are matrices (rows are output vectors), and <code>das</code> is a list of the matrices.</p>\n<p>Here's the actual gradient computation:</p>\n<pre><code>  grad lf (n, (i,t)) = do\n    -- Forward propagation: compute layers outputs and activation derivatives\n    let (as, as') = unzip $ runLayers n i\n        (out) = last as\n    (ds) &lt;- backward lf n (out, t) (init as') -- Compute deltas with backpropagation\n    let r  = fromIntegral $ rows i -- Size of minibatch\n    let gs = zipWith (\\\u03b4 a -&gt; tr (\u03b4 &lt;&gt; a)) ds (i:init as) -- Gradients for weights\n    return $ GradBatch ((recip r .*) &lt;$&gt; gs, (recip r .*) &lt;$&gt; squeeze &lt;$&gt; ds)\n</code></pre>\n<p>Here, <code>lf</code> and <code>n</code> are the same as above, <code>i</code> is the input, and <code>t</code> is the target output (both in batch form, as matrices).</p>\n<p><code>squeeze</code> transforms a matrix into a vector by summing over each row. That is, <code>ds</code> is a list of matrices of deltas, where each column corresponds to the deltas for a row of the minibatch. So, the gradients for the biases are the average of the deltas over all the minibatch. The same thing for <code>gs</code>, which corresponds to the gradients for the weights.</p>\n<p>Here's the actual update code:</p>\n<pre><code>move lr (n, (i,t)) (GradBatch (gs, ds)) = do\n    -- Update function\n    let update = (\\(FC w b af) g \u03b4 -&gt; FC (w + (lr).*g) (b + (lr).*\u03b4) af)\n        n' = Network.fromList $ zipWith3 update (Network.toList n) gs ds\n    return (n', (i,t))\n</code></pre>\n<p><code>lr</code> is the learning rate. <code>FC</code> is the layer constructor, and <code>af</code> is the activation function for that layer.</p>\n<p>The gradient descent algorithm makes sure to pass in a negative value for the learning rate. The actual code for the gradient descent is simply a loop around a composition of <code>grad</code> and <code>move</code>, with a parameterized stop condition.</p>\n<p>Finally, here's the code for a mean square error loss function:</p>\n<pre><code>mse :: (Floating a) =&gt; LossFunction a a\nmse = let f (y,y') = let gamma = y'-y in gamma**2 / 2\n          f' (y,y') = (y'-y)\n      in  Evaluator f f'\n</code></pre>\n<p><code>Evaluator</code> just bundles a loss function and its derivative (for calculating the delta of the output layer).</p>\n<p>The rest of the code is up on GitHub: <a href=\"https://github.com/DrPyser/NeuralNetwork\" rel=\"noreferrer\">NeuralNetwork</a>.</p>\n<p>So, if anyone has an insight into the problem, or even just a sanity check that I'm correctly implementing the algorithm, I'd be grateful.</p>\n"}, {"tags": ["haskell", "monads", "lazy-evaluation", "continuations", "tying-the-knot"], "comments": [{"owner": {"reputation": 100185, "user_id": 3234959, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/93bb12ca0f93dfddb33880316f7e66c2?s=128&d=identicon&r=PG&f=1", "display_name": "chi", "link": "https://stackoverflow.com/users/3234959/chi"}, "edited": false, "score": 2, "creation_date": 1498082646, "post_id": 44686210, "comment_id": 76358013, "body": "I&#39;d leave <code>f</code> defined as it is now, and start by expanding the <code>runContT</code>. Only unfold <code>f</code> when you must. By the way, I find the name <code>k</code> in <code>(k,n)&lt;-...</code> to be confusing, since it looks as if it is the same as in <code>\\k -&gt;...</code> but these don&#39;t even have the same type (one takes an integer, the other one a pair)."}, {"owner": {"reputation": 509, "user_id": 3134946, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/198952b24b7de8ec7329d3a3f46d7bc0?s=128&d=identicon&r=PG&f=1", "display_name": "Ryba", "link": "https://stackoverflow.com/users/3134946/ryba"}, "reply_to_user": {"reputation": 100185, "user_id": 3234959, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/93bb12ca0f93dfddb33880316f7e66c2?s=128&d=identicon&r=PG&f=1", "display_name": "chi", "link": "https://stackoverflow.com/users/3234959/chi"}, "edited": false, "score": 0, "creation_date": 1498083050, "post_id": 44686210, "comment_id": 76358160, "body": "@chi this is a little changed example from <a href=\"https://www.schoolofhaskell.com/user/jwiegley/understanding-continuations\" rel=\"nofollow noreferrer\">here</a>, but true, one of them could at least be called <code>k&#39;</code>"}], "answers": [{"comments": [{"owner": {"reputation": 509, "user_id": 3134946, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/198952b24b7de8ec7329d3a3f46d7bc0?s=128&d=identicon&r=PG&f=1", "display_name": "Ryba", "link": "https://stackoverflow.com/users/3134946/ryba"}, "edited": false, "score": 0, "creation_date": 1498133492, "post_id": 44698911, "comment_id": 76380814, "body": "Looks like i didn&#39;t notice that i can bring <code>runContT</code> into <code>in ContT ($(f,0))</code>, thanks"}], "tags": [], "owner": {"reputation": 100185, "user_id": 3234959, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/93bb12ca0f93dfddb33880316f7e66c2?s=128&d=identicon&r=PG&f=1", "display_name": "chi", "link": "https://stackoverflow.com/users/3234959/chi"}, "is_accepted": true, "score": 3, "last_activity_date": 1498132940, "creation_date": 1498132940, "answer_id": 44698911, "question_id": 44686210, "link": "https://stackoverflow.com/questions/44686210/equational-reasoning-with-tying-the-knot/44698911#44698911", "title": "Equational reasoning with tying the knot", "body": "<p>You can proceed as follows.</p>\n\n<pre><code>s21 = runContT (let f x = ContT $ \\_ -&gt; cc (f, x) in ContT ($(f,0))) cc where\n    cc = (\\(k,n) -&gt; let\n        iff = if n &lt; 3 then k (n+1) else ContT ($())\n        in print n &gt;&gt; runContT iff (\\_ -&gt; return ())\n\n-- runContT is the opposite of ContT\n\ns22 =  (let f x = ContT $ \\_ -&gt; cc (f, x) in ($(f,0))) cc\n    where\n    cc = (\\(k,n) -&gt; let\n        iff = if n &lt; 3 then k (n+1) else ContT ($())\n        in print n &gt;&gt; runContT iff (\\_ -&gt; return ())\n\n-- reordering\n\ns23 = ($(f,0)) cc\n    where\n    f x = ContT $ \\_ -&gt; cc (f, x)\n    cc = (\\(k,n) -&gt; let\n        iff = if n &lt; 3 then k (n+1) else ContT ($())\n        in print n &gt;&gt; runContT iff (\\_ -&gt; return ())\n\ns24 = cc (f,0)\n    where ...\n\n-- beta\n\ns25 = let iff = if 0 &lt; 3 then f (0+1) else ContT ($())\n       in print 0 &gt;&gt; runContT iff (\\_ -&gt; return ())\n    where ...\n\n-- if, arithmetics\n\ns26 = let iff = f 1\n       in print 0 &gt;&gt; runContT iff (\\_ -&gt; return ())\n    where ...\n\ns27 = print 0 &gt;&gt; runContT (f 1) (\\_ -&gt; return ())\n    where ...\n\ns28 = print 0 &gt;&gt; runContT (ContT $ \\_ -&gt; cc (f, 1)) (\\_ -&gt; return ())\n    where ...\n\ns29 = print 0 &gt;&gt; (\\_ -&gt; cc (f, 1)) (\\_ -&gt; return ())\n    where ...\n\ns30 = print 0 &gt;&gt; cc (f, 1)\n    where ...\n\n-- repeat all the steps s24..s30\n\ns31 = print 0 &gt;&gt; print 1 &gt;&gt; cc (f, 2)\n    where ...\n\n-- etc.\n\ns32 = print 0 &gt;&gt; print 1 &gt;&gt; print 2 &gt;&gt; cc (f, 3)\n    where ...\n\ns33 = print 0 &gt;&gt; print 1 &gt;&gt; print 2 &gt;&gt;\n      let iff = if 3 &lt; 3 then f (3+1) else ContT ($())\n       in print 3 &gt;&gt; runContT iff (\\_ -&gt; return ())\n    where ...\n\ns34 = print 0 &gt;&gt; print 1 &gt;&gt; print 2 &gt;&gt; print 3 &gt;&gt; \n      let iff = ContT ($())\n       in runContT iff (\\_ -&gt; return ()))\n    where ...\n\ns35 = print 0 &gt;&gt; print 1 &gt;&gt; print 2 &gt;&gt; print 3 &gt;&gt; \n      runContT (ContT ($())) (\\_ -&gt; return ())\n    where ...\n\ns36 = print 0 &gt;&gt; print 1 &gt;&gt; print 2 &gt;&gt; print 3 &gt;&gt; \n      ($()) (\\_ -&gt; return ())\n    where ...\n\ns37 = print 0 &gt;&gt; print 1 &gt;&gt; print 2 &gt;&gt; print 3 &gt;&gt; \n      return ()\n</code></pre>\n"}], "owner": {"reputation": 509, "user_id": 3134946, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/198952b24b7de8ec7329d3a3f46d7bc0?s=128&d=identicon&r=PG&f=1", "display_name": "Ryba", "link": "https://stackoverflow.com/users/3134946/ryba"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 144, "favorite_count": 0, "accepted_answer_id": 44698911, "answer_count": 1, "score": 7, "last_activity_date": 1498759535, "creation_date": 1498078882, "last_edit_date": 1498759535, "question_id": 44686210, "link": "https://stackoverflow.com/questions/44686210/equational-reasoning-with-tying-the-knot", "title": "Equational reasoning with tying the knot", "body": "<p>I'm trying to wrap my head around Cont and callCC, by reducing this function:</p>\n\n<pre><code>s0 = (flip runContT) return $  do\n    (k, n) &lt;- callCC $ \\k -&gt; let f x = k (f, x)\n                             in  return (f, 0)\n    lift $ print n\n    if n &lt; 3\n        then k (n+1) &gt;&gt; return ()\n        else return ()\n</code></pre>\n\n<p>I've managed to reach this point:</p>\n\n<pre><code>s21 = runContT (let f x = ContT $ \\_ -&gt; cc (f, x) in ContT ($(f,0))) cc where\n    cc = (\\(k,n) -&gt; let\n        iff = if n &lt; 3 then k (n+1) else ContT ($())\n        in print n &gt;&gt; runContT iff (\\_ -&gt; return ()))\n</code></pre>\n\n<p>And at this point i have no idea what to do with recursive definition of <code>f</code>\nWhat is the best way to finish this reduction?</p>\n"}, {"tags": ["haskell", "functional-programming"], "comments": [{"owner": {"reputation": 126897, "user_id": 791604, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/ce991df7a056248d5e4f6fc3659ba733?s=128&d=identicon&r=PG", "display_name": "Daniel Wagner", "link": "https://stackoverflow.com/users/791604/daniel-wagner"}, "edited": false, "score": 4, "creation_date": 1498071714, "post_id": 44683867, "comment_id": 76352611, "body": "Side note: writing <code>f.g = f(g x)</code> is a bit sloppy. In fact, <code>f.g = \\x -&gt; f(g x)</code>."}], "answers": [{"comments": [{"owner": {"reputation": 181, "user_id": 5724906, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/4ba2cda68a7916b7c97d60b52c1110ef?s=128&d=identicon&r=PG&f=1", "display_name": "Tomasz", "link": "https://stackoverflow.com/users/5724906/tomasz"}, "edited": false, "score": 0, "creation_date": 1498071575, "post_id": 44683978, "comment_id": 76352508, "body": "I think i understand. So d) is <code>f(.g) = f((.)g) = f(\\x -&gt; g x)</code> ?"}, {"owner": {"reputation": 314794, "user_id": 67579, "user_type": "registered", "accept_rate": 81, "profile_image": "https://i.stack.imgur.com/BJXub.png?s=128&g=1", "display_name": "Willem Van Onsem", "link": "https://stackoverflow.com/users/67579/willem-van-onsem"}, "reply_to_user": {"reputation": 181, "user_id": 5724906, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/4ba2cda68a7916b7c97d60b52c1110ef?s=128&d=identicon&r=PG&f=1", "display_name": "Tomasz", "link": "https://stackoverflow.com/users/5724906/tomasz"}, "edited": false, "score": 1, "creation_date": 1498071655, "post_id": 44683978, "comment_id": 76352566, "body": "@Tomasz: the last step is incorrect: <code>(.) g</code> is <code>\\h x -&gt; g (h x)</code>. So for your example <code>f (. g) = f ((.) g) = f (\\h x -&gt; g (h x))</code>."}, {"owner": {"reputation": 181, "user_id": 5724906, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/4ba2cda68a7916b7c97d60b52c1110ef?s=128&d=identicon&r=PG&f=1", "display_name": "Tomasz", "link": "https://stackoverflow.com/users/5724906/tomasz"}, "edited": false, "score": 0, "creation_date": 1498071789, "post_id": 44683978, "comment_id": 76352663, "body": "&quot;h&quot; is missing function?"}, {"owner": {"reputation": 314794, "user_id": 67579, "user_type": "registered", "accept_rate": 81, "profile_image": "https://i.stack.imgur.com/BJXub.png?s=128&g=1", "display_name": "Willem Van Onsem", "link": "https://stackoverflow.com/users/67579/willem-van-onsem"}, "reply_to_user": {"reputation": 181, "user_id": 5724906, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/4ba2cda68a7916b7c97d60b52c1110ef?s=128&d=identicon&r=PG&f=1", "display_name": "Tomasz", "link": "https://stackoverflow.com/users/5724906/tomasz"}, "edited": false, "score": 0, "creation_date": 1498071832, "post_id": 44683978, "comment_id": 76352682, "body": "@Tomasz: <code>h</code> is a parameter, but it indeed should be a function."}, {"owner": {"reputation": 100185, "user_id": 3234959, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/93bb12ca0f93dfddb33880316f7e66c2?s=128&d=identicon&r=PG&f=1", "display_name": "chi", "link": "https://stackoverflow.com/users/3234959/chi"}, "edited": false, "score": 0, "creation_date": 1498075870, "post_id": 44683978, "comment_id": 76354987, "body": "@WillemVanOnsem <code>f (. g)</code> is not <code>f ((.) g)</code> -- the latter is <code>f (g .)</code>. (This is about your comment, not your answer.)"}, {"owner": {"reputation": 314794, "user_id": 67579, "user_type": "registered", "accept_rate": 81, "profile_image": "https://i.stack.imgur.com/BJXub.png?s=128&g=1", "display_name": "Willem Van Onsem", "link": "https://stackoverflow.com/users/67579/willem-van-onsem"}, "reply_to_user": {"reputation": 100185, "user_id": 3234959, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/93bb12ca0f93dfddb33880316f7e66c2?s=128&d=identicon&r=PG&f=1", "display_name": "chi", "link": "https://stackoverflow.com/users/3234959/chi"}, "edited": false, "score": 0, "creation_date": 1498081930, "post_id": 44683978, "comment_id": 76357720, "body": "@chi: euh yeah, I don&#39;t know where that came from :s."}], "tags": [], "owner": {"reputation": 314794, "user_id": 67579, "user_type": "registered", "accept_rate": 81, "profile_image": "https://i.stack.imgur.com/BJXub.png?s=128&g=1", "display_name": "Willem Van Onsem", "link": "https://stackoverflow.com/users/67579/willem-van-onsem"}, "is_accepted": true, "score": 4, "last_activity_date": 1498070928, "creation_date": 1498070928, "answer_id": 44683978, "question_id": 44683867, "link": "https://stackoverflow.com/questions/44683867/haskell-complex-function-composition/44683978#44683978", "title": "Haskell complex function composition", "body": "<p>The correct answer is <strong>(b)</strong>: <code>(f.).g</code></p>\n\n<p>Let us analyze this function. The <code>(f.)</code> part is short for <code>((.) f)</code>, so we already solved that one, and thus the function - without syntactical sugar - is:</p>\n\n<pre><code>(.) ((.) f) g\n</code></pre>\n\n<p>Now we can rewrite the first <code>(.)</code> function to a lambda-expression:</p>\n\n<pre><code>\\x -&gt; ((.) f) (g x)\n</code></pre>\n\n<p>And now when we evaluate the second function on the left (<code>((.) f)</code>) further, we obtain:</p>\n\n<pre><code>\\x -&gt; (.) f (g x)\n</code></pre>\n\n<p>or:</p>\n\n<pre><code>\\x -&gt; f . g x\n</code></pre>\n\n<p>So if we convert the <code>(.)</code> function in a lambda expression, we obtain:</p>\n\n<pre><code>\\x -&gt; (\\y -&gt; f ((g x) y))\n</code></pre>\n\n<p>Now we can make this expression more elegantly. <code>(g x) y</code> can be rewritten to <code>g x y</code>:</p>\n\n<pre><code>\\x -&gt; (\\y -&gt; f (g x y))\n</code></pre>\n\n<p>and we can rewrite nested lambda expressions into a single lambda expression:</p>\n\n<pre><code>\\x y -&gt; f (g x y)\n</code></pre>\n\n<p>Which is what we wanted.</p>\n"}, {"comments": [{"owner": {"reputation": 126897, "user_id": 791604, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/ce991df7a056248d5e4f6fc3659ba733?s=128&d=identicon&r=PG", "display_name": "Daniel Wagner", "link": "https://stackoverflow.com/users/791604/daniel-wagner"}, "edited": false, "score": 3, "creation_date": 1498071977, "post_id": 44684189, "comment_id": 76352776, "body": "I downvoted, for three reasons: 1. The level of knowledge displayed in the question doesn&#39;t support the assumption that the behavior of this kind of double-composition would be immediately apparent to the question asker, so some explanatory sentences at the beginning are needed. 2. This doesn&#39;t actually &quot;tie the knot&quot; back to the original question, so some explanatory sentences at the end are needed to show how we can start with double-composition of this form and end with one of the four possible choices. 3. I agree that this is a stupid name for it. So don&#39;t propagate that name!"}, {"owner": {"reputation": 106013, "user_id": 633183, "user_type": "registered", "accept_rate": 66, "profile_image": "https://i.stack.imgur.com/RHeN9.png?s=128&g=1", "display_name": "Thank you", "link": "https://stackoverflow.com/users/633183/thank-you"}, "reply_to_user": {"reputation": 126897, "user_id": 791604, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/ce991df7a056248d5e4f6fc3659ba733?s=128&d=identicon&r=PG", "display_name": "Daniel Wagner", "link": "https://stackoverflow.com/users/791604/daniel-wagner"}, "edited": false, "score": 0, "creation_date": 1498073521, "post_id": 44684189, "comment_id": 76353678, "body": "@DanielWagner thanks for the thorough comment. I&#39;ve adjusted my answer some in hopes that it&#39;s more informative."}], "tags": [], "owner": {"reputation": 106013, "user_id": 633183, "user_type": "registered", "accept_rate": 66, "profile_image": "https://i.stack.imgur.com/RHeN9.png?s=128&g=1", "display_name": "Thank you", "link": "https://stackoverflow.com/users/633183/thank-you"}, "is_accepted": false, "score": 3, "last_activity_date": 1498109327, "last_edit_date": 1498109327, "creation_date": 1498071486, "answer_id": 44684189, "question_id": 44683867, "link": "https://stackoverflow.com/questions/44683867/haskell-complex-function-composition/44684189#44684189", "title": "Haskell complex function composition", "body": "<p>You can also use <code>(.) (.) (.)</code> - despite it being somewhat <a href=\"https://stackoverflow.com/questions/17585649/composing-function-composition-how-does-work\">challenging to understand</a>, the evaluation results in an elegant form identical to the one you're looking for </p>\n\n<pre><code>comp2 = (.) (.) (.)\ncomp2 f g x y == f (g x y)\n</code></pre>\n\n<hr>\n\n<p><strong>Evaluation of <code>(.) (.) (.)</code></strong></p>\n\n<pre><code>-- comp\n(.) = \\f -> \\g -> x -> f (g x)\n\n-- evaluate\n(.) (.) (.)\n(\\f -> \\g -> \\x -> f (g x)) (.) (.)\n(\\g -> \\x -> (.) (g x)) (.)\n\\x -> (.) ((.) x)\n\\x -> (\\f -> \\g -> \\x' -> f (g x')) ((.) x)\n\\x -> \\g -> \\x' -> ((.) x) (g x')\n\\x -> \\g -> \\x' -> ((\\f -> \\g' x'' -> f (g' x'')) x) (g x')\n\\x -> \\g -> \\x' -> (\\g' -> \\x'' -> x (g' x'')) (g x')\n\\x -> \\g -> \\x' -> \\x'' -> x ((g x') x'')\n\\x -> \\g -> \\x' -> \\x'' -> x (g x' x'')\n\n-- alpha rename\n\\f -> \\g -> \\x -> \\y -> f (g x y)\n\n-- collapse lambdas \n\\f g x y -> f (g x y)\n</code></pre>\n\n<hr>\n\n<p><strong>Understanding a pattern of <code>(.)</code> compositions</strong></p>\n\n<pre><code>-- comp2\ncomp2 = (.) (.) (.)\ncomp2 f g x y == f (g x y)\n\n-- comp3\ncomp3 = (.) (.) comp2\ncomp3 f g x y z == f (g x y z)\n\n-- comp4\ncomp4 = (.) (.) comp3\ncomp4 f g w x y z == f (g w x y z)\n</code></pre>\n"}], "owner": {"reputation": 181, "user_id": 5724906, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/4ba2cda68a7916b7c97d60b52c1110ef?s=128&d=identicon&r=PG&f=1", "display_name": "Tomasz", "link": "https://stackoverflow.com/users/5724906/tomasz"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 216, "favorite_count": 0, "accepted_answer_id": 44683978, "answer_count": 2, "score": 3, "last_activity_date": 1498109327, "creation_date": 1498070526, "question_id": 44683867, "link": "https://stackoverflow.com/questions/44683867/haskell-complex-function-composition", "title": "Haskell complex function composition", "body": "<p>I'm trying to learn function composition in Haskell. I have following exercise.<br>\nI have function:<code>h x y = f (g x y)</code>and i need to find function composition equal to it:</p>\n\n<pre><code>a) f . g  \nb) (f.).g  \nc) (.)f(.g)  \nd) f(.g)\n</code></pre>\n\n<p>I know that <code>(.)f g = f.g = f(g x)</code> but i don't understand this complicated function composition</p>\n"}, {"tags": ["haskell", "types", "megaparsec"], "comments": [{"owner": {"reputation": 37219, "user_id": 1523776, "user_type": "moderator", "accept_rate": 87, "profile_image": "https://www.gravatar.com/avatar/b3e0b5c8e42a8c38009ef2d969f8dabb?s=128&d=identicon&r=PG", "display_name": "Benjamin Hodgson", "link": "https://stackoverflow.com/users/1523776/benjamin-hodgson"}, "edited": false, "score": 0, "creation_date": 1498063415, "post_id": 44681410, "comment_id": 76347827, "body": "Why are you writing <code>eol :: Parser Text</code> when you&#39;re ignoring its return value anyway?"}, {"owner": {"reputation": 1199, "user_id": 1744344, "user_type": "registered", "accept_rate": 78, "profile_image": "https://www.gravatar.com/avatar/1e64cde3a7667b8b2ee69af9a7aea5aa?s=128&d=identicon&r=PG", "display_name": "helq", "link": "https://stackoverflow.com/users/1744344/helq"}, "reply_to_user": {"reputation": 37219, "user_id": 1523776, "user_type": "moderator", "accept_rate": 87, "profile_image": "https://www.gravatar.com/avatar/b3e0b5c8e42a8c38009ef2d969f8dabb?s=128&d=identicon&r=PG", "display_name": "Benjamin Hodgson", "link": "https://stackoverflow.com/users/1523776/benjamin-hodgson"}, "edited": false, "score": 0, "creation_date": 1498064835, "post_id": 44681410, "comment_id": 76348618, "body": "Well, I do it because I want to know how to change its type. I want to change its type because many other functions in the library have the same type declaration, take for example <code>lowerChar :: (MonadParsec e s m, Token s ~ Char) =&gt; m Char</code>, I may want not to ignore its return value but constraint it to be &quot;Text&quot; (for that I could do <code>fromList &lt;$&gt; lowerChar</code>, but that seems ugly, I suppose I could just change the type directly, but I don&#39;t know, or understand, how). Mainly my problem is with <code>(MonadParsec e s m, Token s ~ Char) =&gt; m Char</code>."}], "answers": [{"comments": [{"owner": {"reputation": 1199, "user_id": 1744344, "user_type": "registered", "accept_rate": 78, "profile_image": "https://www.gravatar.com/avatar/1e64cde3a7667b8b2ee69af9a7aea5aa?s=128&d=identicon&r=PG", "display_name": "helq", "link": "https://stackoverflow.com/users/1744344/helq"}, "edited": false, "score": 0, "creation_date": 1498144147, "post_id": 44682127, "comment_id": 76389359, "body": "Thanks for the explanation on <code>~</code>, it really helped me. I supposed that the type <code>Parsec Dec Text</code> (written as <code>Parser</code> when importing <code>Megaparsec.Text</code>) was conditioning the OUTPUT of <code>eol</code> to be <code>Text</code>, when in reality it only enforces <code>Text</code> as the INPUT stream of <code>eol</code>, so the type of <code>eol</code> in my (code) example would be <code>Parsec Dec Text [Char]</code>. But I wanted to get <code>Parsec Dec Text Text</code> which is clearly impossible! because <code>eol</code> has type <code>(constraint) =&gt; m [Char] === Parsec e s [Char]</code>."}, {"owner": {"reputation": 1199, "user_id": 1744344, "user_type": "registered", "accept_rate": 78, "profile_image": "https://www.gravatar.com/avatar/1e64cde3a7667b8b2ee69af9a7aea5aa?s=128&d=identicon&r=PG", "display_name": "helq", "link": "https://stackoverflow.com/users/1744344/helq"}, "edited": false, "score": 0, "creation_date": 1498144779, "post_id": 44682127, "comment_id": 76389819, "body": "Btw, I also learnt that <code>Token Text == Char</code>, which I wasn&#39;t expecting! because I saw <code>Text</code> and <code>[Char]</code> as different things (and they are, <code>[Char]</code> is a linked list, and <code>Text</code> something else) but never thought on their constituent parts, which are just <code>Char</code>s.  It makes sense now, <code>Parsec Dec Text [Char]</code> is a totally valid type for <code>eol</code>, I thought it wasn&#39;t because <code>Text != [Char]</code>, but it is, just taking <code>eol :: (MonadParsec e s m, Token s ~ Char) =&gt; m [Char]</code> and replacing <code>e</code> for <code>Dec</code>, <code>s</code> for <code>Text</code> (which fulfills <code>Token s ~ Char</code>!) gives us a totally valid type."}], "tags": [], "owner": {"reputation": 34158, "user_id": 7203016, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/ybAMw.png?s=128&g=1", "display_name": "K. A. Buhr", "link": "https://stackoverflow.com/users/7203016/k-a-buhr"}, "is_accepted": true, "score": 4, "last_activity_date": 1498064425, "creation_date": 1498064425, "answer_id": 44682127, "question_id": 44681410, "link": "https://stackoverflow.com/questions/44681410/megaparsec-how-to-declare-the-type-of-eol-to-parse-text-and-not-char/44682127#44682127", "title": "megaparsec: how to declare the type of `eol` to parse Text and not [Char]", "body": "<p>In the type:</p>\n\n<pre><code>eol :: (MonadParsec e s m, Token s ~ Char) =&gt; m String\n</code></pre>\n\n<p>the <code>~</code> is a type equality constraint, and the <code>MonadParsec</code> and <code>Token</code> typeclasses are defined by Megaparsec.  They can roughly be interpreted as follows:</p>\n\n<ul>\n<li><code>MonadParsec e s m</code> is an assertion that type <code>m</code> is a monadic parser that reads a <code>Stream</code> of type <code>s</code> and represents errors using an <code>ErrorComponent</code> of type <code>e</code></li>\n<li><code>Token s</code> is the underlying type of the tokens read from stream <code>s</code></li>\n</ul>\n\n<p>So, the full type can be interpreted as:  <code>eol</code> is a monadic parser with \"return value\" <code>String</code> that parses a stream whose tokens are <code>Char</code>.</p>\n\n<p>For your problem, most of this can be ignored.  The issue you're running into is that <code>eol</code> returns a <code>String</code> value as the result of the parse, and a <code>String</code> isn't a <code>Text</code>, so you can't make an <code>eol</code> (which is of type <code>Parser String</code>) be of type <code>Parser Text</code>, no matter how hard you try.</p>\n\n<p>Two solutions are to ignore the unwanted <code>String</code> return value or, if you need it as text, convert it:</p>\n\n<pre><code>Data.Text.pack &lt;$&gt; eol\n</code></pre>\n"}], "owner": {"reputation": 1199, "user_id": 1744344, "user_type": "registered", "accept_rate": 78, "profile_image": "https://www.gravatar.com/avatar/1e64cde3a7667b8b2ee69af9a7aea5aa?s=128&d=identicon&r=PG", "display_name": "helq", "link": "https://stackoverflow.com/users/1744344/helq"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 306, "favorite_count": 0, "accepted_answer_id": 44682127, "answer_count": 1, "score": 0, "last_activity_date": 1498064425, "creation_date": 1498061948, "question_id": 44681410, "link": "https://stackoverflow.com/questions/44681410/megaparsec-how-to-declare-the-type-of-eol-to-parse-text-and-not-char", "title": "megaparsec: how to declare the type of `eol` to parse Text and not [Char]", "body": "<p>I can't understand what does the type of (for example) <a href=\"https://hackage.haskell.org/package/megaparsec-5.3.0/docs/Text-Megaparsec.html#v:eol\" rel=\"nofollow noreferrer\"><code>eol</code></a> mean:</p>\n\n<pre><code>eol :: (MonadParsec e s m, Token s ~ Char) =&gt; m String\n</code></pre>\n\n<p>or, better, I don't understand how to use eol with <code>Text.Megaparsec.Text</code> and not <code>Text.Megaparsec.String</code>.</p>\n\n<p>I've been trying to use learn how to use Megaparsec following the (old) tutorial for Parsec from Real World Haskell (I actually started reading RWH tutorial first before finding out that Megaparsec existed). I rewrote the <a href=\"http://book.realworldhaskell.org/read/using-parsec.html#csv1.hs:all\" rel=\"nofollow noreferrer\">code of the first example</a> to use Megaparsec (see below). But I found that when I try to force the type of <code>eol</code> to <code>Parser Text</code> the compiler throws the error: <code>Couldn't match type \u2018[Char]\u2019 with \u2018Text\u2019</code>, what I gather from this is that I cannot use <code>eol</code> with <code>Text</code> or, more likely, I don't know how to change that <code>Token s ~ Char</code> context from the <code>eol</code> declaration to use <code>Token Text</code>.</p>\n\n<pre><code>{-# LANGUAGE OverloadedStrings #-}\n{-# LANGUAGE NoImplicitPrelude #-}\n\nmodule CSVParser (\n  module CSVParser\n) where\n\nimport Foundation\nimport Data.Functor.Identity (Identity)\nimport Text.Megaparsec\nimport Text.Megaparsec.Text\nimport Data.Text\n\ncsvFile :: Parser [[Text]]\ncsvFile =\n    do result &lt;- many line\n       eof\n       return result\n\nline :: Parser [Text]\nline =\n    do result &lt;- cells\n       --eol :: Parser Text -- uncommenting this line results in a compilation error\n       eol\n       return result\n\ncells :: Parser [Text]\ncells =\n    do first &lt;- cellContent\n       next &lt;- remainingCells\n       return (first : next)\n\nremainingCells =\n    (char ',' &gt;&gt; cells)\n    &lt;|&gt; return []\n\ncellContent :: Parser Text\ncellContent = fromList &lt;$&gt; many (noneOf [',','\\n'])\n\nparseCSV :: Text -&gt; Either (ParseError (Token Text) Dec) [[Text]]\nparseCSV = parse csvFile \"(unknown)\"\n</code></pre>\n"}, {"tags": ["haskell", "types"], "comments": [{"owner": {"reputation": 62421, "user_id": 216164, "user_type": "registered", "accept_rate": 89, "profile_image": "https://www.gravatar.com/avatar/786f224adbe0784cdf7d0f15476061fe?s=128&d=identicon&r=PG", "display_name": "Thomas M. DuBuisson", "link": "https://stackoverflow.com/users/216164/thomas-m-dubuisson"}, "edited": false, "score": 3, "creation_date": 1498053136, "post_id": 44677914, "comment_id": 76340279, "body": "How could you compare <code>x :: a</code> to <code>n  :: Integer</code> without <code>a</code> being <code>Integer</code> or at least having some known constraint?  Or instead of the rhetorical question: <code>==</code> is of type <code>a -&gt; a -&gt; Bool</code> so if one of them is an integer then both of them should be."}], "answers": [{"comments": [{"owner": {"reputation": 25967, "user_id": 1743843, "user_type": "registered", "accept_rate": 77, "profile_image": "https://www.gravatar.com/avatar/8ea2c1d9051e40332376a07bc166d9d5?s=128&d=identicon&r=PG&f=1", "display_name": "softshipper", "link": "https://stackoverflow.com/users/1743843/softshipper"}, "edited": false, "score": 0, "creation_date": 1498053866, "post_id": 44678248, "comment_id": 76340805, "body": "In my example, the variable <code>a</code> has no type, that because it does not work right? I did not clarify the type of  <code>a</code>."}, {"owner": {"reputation": 314794, "user_id": 67579, "user_type": "registered", "accept_rate": 81, "profile_image": "https://i.stack.imgur.com/BJXub.png?s=128&g=1", "display_name": "Willem Van Onsem", "link": "https://stackoverflow.com/users/67579/willem-van-onsem"}, "reply_to_user": {"reputation": 25967, "user_id": 1743843, "user_type": "registered", "accept_rate": 77, "profile_image": "https://www.gravatar.com/avatar/8ea2c1d9051e40332376a07bc166d9d5?s=128&d=identicon&r=PG&f=1", "display_name": "softshipper", "link": "https://stackoverflow.com/users/1743843/softshipper"}, "edited": false, "score": 0, "creation_date": 1498053944, "post_id": 44678248, "comment_id": 76340848, "body": "<code>a</code> is not a variable, it is a type variable. You do not have to clarify the type of <code>a</code> in order to define a function. Haskell can derive the concrete types when you call a function itself."}, {"owner": {"reputation": 25967, "user_id": 1743843, "user_type": "registered", "accept_rate": 77, "profile_image": "https://www.gravatar.com/avatar/8ea2c1d9051e40332376a07bc166d9d5?s=128&d=identicon&r=PG&f=1", "display_name": "softshipper", "link": "https://stackoverflow.com/users/1743843/softshipper"}, "edited": false, "score": 0, "creation_date": 1498054038, "post_id": 44678248, "comment_id": 76340907, "body": "OK yes, sorry. So the type variable <code>a</code> has not assigned to a type yet, that because it does not work right?"}, {"owner": {"reputation": 314794, "user_id": 67579, "user_type": "registered", "accept_rate": 81, "profile_image": "https://i.stack.imgur.com/BJXub.png?s=128&g=1", "display_name": "Willem Van Onsem", "link": "https://stackoverflow.com/users/67579/willem-van-onsem"}, "reply_to_user": {"reputation": 25967, "user_id": 1743843, "user_type": "registered", "accept_rate": 77, "profile_image": "https://www.gravatar.com/avatar/8ea2c1d9051e40332376a07bc166d9d5?s=128&d=identicon&r=PG&f=1", "display_name": "softshipper", "link": "https://stackoverflow.com/users/1743843/softshipper"}, "edited": false, "score": 0, "creation_date": 1498054115, "post_id": 44678248, "comment_id": 76340974, "body": "@zero_coding: well you specify an <code>f</code>, but in the <i>scope</i> of <code>treeBuild</code>. So that means that you specify a &quot;free a&quot; so to speak, and that conflicts with the <code>unfold</code> call."}, {"owner": {"reputation": 25967, "user_id": 1743843, "user_type": "registered", "accept_rate": 77, "profile_image": "https://www.gravatar.com/avatar/8ea2c1d9051e40332376a07bc166d9d5?s=128&d=identicon&r=PG&f=1", "display_name": "softshipper", "link": "https://stackoverflow.com/users/1743843/softshipper"}, "edited": false, "score": 0, "creation_date": 1498054467, "post_id": 44678248, "comment_id": 76341302, "body": "Could you please show me another example of &quot;free a&quot;? Or what do you mean with &quot;free a&quot;?"}, {"owner": {"reputation": 314794, "user_id": 67579, "user_type": "registered", "accept_rate": 81, "profile_image": "https://i.stack.imgur.com/BJXub.png?s=128&g=1", "display_name": "Willem Van Onsem", "link": "https://stackoverflow.com/users/67579/willem-van-onsem"}, "reply_to_user": {"reputation": 25967, "user_id": 1743843, "user_type": "registered", "accept_rate": 77, "profile_image": "https://www.gravatar.com/avatar/8ea2c1d9051e40332376a07bc166d9d5?s=128&d=identicon&r=PG&f=1", "display_name": "softshipper", "link": "https://stackoverflow.com/users/1743843/softshipper"}, "edited": false, "score": 0, "creation_date": 1498056980, "post_id": 44678248, "comment_id": 76343439, "body": "@zero_coding: I think you should read about <a href=\"https://wiki.haskell.org/Scoped_type_variables\" rel=\"nofollow noreferrer\">Scoped Type Variables</a>."}], "tags": [], "owner": {"reputation": 314794, "user_id": 67579, "user_type": "registered", "accept_rate": 81, "profile_image": "https://i.stack.imgur.com/BJXub.png?s=128&g=1", "display_name": "Willem Van Onsem", "link": "https://stackoverflow.com/users/67579/willem-van-onsem"}, "is_accepted": true, "score": 8, "last_activity_date": 1498053828, "last_edit_date": 1498053828, "creation_date": 1498053497, "answer_id": 44678248, "question_id": 44677914, "link": "https://stackoverflow.com/questions/44677914/couldnt-match-expected-type-a-with-actual-type-integer/44678248#44678248", "title": "Couldn&#39;t match expected type `a` with actual type `Integer`", "body": "<h1>The error</h1>\n\n<p>In your program you write:</p>\n\n<pre><code>treeBuild :: <b>Integer</b> -&gt; BinaryTree Integer\ntreeBuild <b>n</b> = unfold f 0\n    where f :: <b>a</b> -&gt; Maybe (a,b,a)\n          f <b>x</b>\n              | <b>x == n</b> = Nothing\n              | otherwise = Just (x+1, x, x+1)</code></pre>\n\n<p>So that means that you want to check the equality between an <code>Integer</code> and an <code>a</code>. But <code>(==)</code> has type signature: <a href=\"http://hackage.haskell.org/package/base-4.9.1.0/docs/Prelude.html#v:-61--61-\" rel=\"noreferrer\"><code>(==) :: Eq a =&gt; a -&gt; a -&gt; Bool</code></a>. So that means in Haskell the two <strong>operands should have the same type</strong>.</p>\n\n<p>You thus have two options: (1) you specify the <code>f</code> function, or (2) you generalize the <code>treeBuild</code> function.</p>\n\n<h1>Specialize the <code>f</code> function</h1>\n\n<pre><code>treeBuild :: Integer -&gt; BinaryTree Integer\ntreeBuild n = unfold f 0\n    where f :: <b>Integer</b> -&gt; Maybe (<b>Integer,Integer,Integer</b>)\n          f x\n              | x == n = Nothing\n              | otherwise = Just (x+1, x, x+1)</code></pre>\n\n<p>Here we simply make <code>f</code> a function <code>f :: Integer -&gt; Maybe (Integer,Integer,Integer)</code>.</p>\n\n<h1>Generalize the <code>treeBuild</code> function</h1>\n\n<p>We can - and this is more recommended - generalize the <code>treeBuild</code> function (and slightly specialize the <code>f</code> function):</p>\n\n<pre><code>treeBuild :: <b>(Num a, Eq a) =&gt; a</b> -&gt; BinaryTree <b>a</b>\ntreeBuild n = unfold f 0\n    where f x\n              | x == n = Nothing\n              | otherwise = Just (x+1, x, x+1)</code></pre>\n\n<p>Then <code>f</code> will have the type <code>f :: <b>(Num a, Eq a) =&gt; a</b> -&gt; Maybe (<b>a,a,a</b>)</code>.</p>\n\n<p>Since now we can build trees for any type that is a numerical type and supports equality.</p>\n"}], "owner": {"reputation": 25967, "user_id": 1743843, "user_type": "registered", "accept_rate": 77, "profile_image": "https://www.gravatar.com/avatar/8ea2c1d9051e40332376a07bc166d9d5?s=128&d=identicon&r=PG&f=1", "display_name": "softshipper", "link": "https://stackoverflow.com/users/1743843/softshipper"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 3024, "favorite_count": 0, "accepted_answer_id": 44678248, "answer_count": 1, "score": 1, "last_activity_date": 1498054007, "creation_date": 1498052636, "last_edit_date": 1498054007, "question_id": 44677914, "link": "https://stackoverflow.com/questions/44677914/couldnt-match-expected-type-a-with-actual-type-integer", "title": "Couldn&#39;t match expected type `a` with actual type `Integer`", "body": "<p>I have a <code>treeBuild</code> function does not get compiled, because the signature in the where clause:</p>\n\n<pre><code>unfold :: (a -&gt; Maybe (a,b,a)) -&gt; a -&gt; BinaryTree b\nunfold f x = case f x of Nothing -&gt; Leaf\n                         Just (s,t,u) -&gt; Node (unfold f s) t (unfold f u)\n\ntreeBuild :: Integer -&gt; BinaryTree Integer\ntreeBuild n = unfold f 0\n    where f :: a -&gt; Maybe (a,b,a)\n          f x\n              | x == n = Nothing\n              | otherwise = Just (x+1, x, x+1)        \n</code></pre>\n\n<p>and I've got following compiler error:</p>\n\n<pre><code>* Couldn't match expected type `a' with actual type `Integer'\n  `a' is a rigid type variable bound by\n    the type signature for:\n      f :: forall a b. a -&gt; Maybe (a, b, a)\n    at D:\\haskell\\chapter12\\src\\Small.hs:85:16\n* In the second argument of `(==)', namely `n'\n  In the expression: x == n\n  In a stmt of a pattern guard for\n                 an equation for `f':\n    x == n\n* Relevant bindings include\n    x :: a (bound at D:\\haskell\\chapter12\\src\\Small.hs:86:13)\n    f :: a -&gt; Maybe (a, b, a)\n      (bound at D:\\haskell\\chapter12\\src\\Small.hs:86:11)\n</code></pre>\n\n<p>What is wrong with signature of <code>f</code>?</p>\n"}, {"tags": ["haskell", "fold"], "comments": [{"owner": {"user_type": "does_not_exist", "display_name": "user6445533"}, "edited": false, "score": 0, "creation_date": 1498047059, "post_id": 44674846, "comment_id": 76335405, "body": "<code>(+0)</code> is not the same as <code>foldr (+) 0 []</code>"}, {"owner": {"reputation": 48938, "user_id": 246886, "user_type": "registered", "accept_rate": 94, "profile_image": "https://www.gravatar.com/avatar/dd1ebaade6623fc538fb8af3338e730d?s=128&d=identicon&r=PG", "display_name": "Jon Purdy", "link": "https://stackoverflow.com/users/246886/jon-purdy"}, "edited": false, "score": 0, "creation_date": 1498083847, "post_id": 44674846, "comment_id": 76358421, "body": "You can think of <code>foldr f z xs</code> as \u201creplacing\u201d all the <code>:</code> in <code>xs</code> with <code>f</code> and the <code>[]</code> (if present) with <code>z</code>. So <code>foldr (+) 0 []</code> replaces <code>[]</code> with <code>0</code>, and there are no <code>:</code> to replace, so the <code>+</code> is never used."}], "answers": [{"tags": [], "owner": {"reputation": 314794, "user_id": 67579, "user_type": "registered", "accept_rate": 81, "profile_image": "https://i.stack.imgur.com/BJXub.png?s=128&g=1", "display_name": "Willem Van Onsem", "link": "https://stackoverflow.com/users/67579/willem-van-onsem"}, "is_accepted": true, "score": 4, "last_activity_date": 1498046256, "last_edit_date": 1498046256, "creation_date": 1498044701, "answer_id": 44674895, "question_id": 44674846, "link": "https://stackoverflow.com/questions/44674846/how-does-fold-works-for-empty-list/44674895#44674895", "title": "How does fold works for empty list?", "body": "<p><strong>Short answer</strong>: you get the <strong>initial value <code>z</code></strong>.</p>\n\n<p>If you give <code>foldl</code> or <code>foldr</code> an empty list, then it returns the <strong>initial</strong> value. <a href=\"http://hackage.haskell.org/package/base-4.9.1.0/docs/Prelude.html#v:foldr\" rel=\"nofollow noreferrer\"><code>foldr :: (a -&gt; b -&gt; b) -&gt; b -&gt; t a -&gt; b</code></a> works like:</p>\n\n<blockquote>\n<pre><code>foldr f z [x1, x2, ..., xn] == x1 `f` (x2 `f` ... (xn `f` z)...)\n</code></pre>\n</blockquote>\n\n<p>So since there are no <code>x1</code>, ..., <code>xn</code> the function is never applied, and <code>z</code> is returned.</p>\n\n<p>We can also inspect the <a href=\"http://hackage.haskell.org/package/base-4.9.1.0/docs/src/GHC.Base.html#foldr\" rel=\"nofollow noreferrer\">source code</a>:</p>\n\n<blockquote>\n<pre><code>foldr            :: (a -&gt; b -&gt; b) -&gt; b -&gt; [a] -&gt; b\n-- foldr _ z []     =  z\n-- foldr f z (x:xs) =  f x (foldr f z xs)\n{-# INLINE [0] foldr #-}\n-- Inline only in the final stage, after the foldr/cons rule has had a chance\n-- Also note that we inline it when it has *two* parameters, which are the\n-- ones we are keen about specialising!\nfoldr k z = go\n          where\n            go []     = z\n            go (y:ys) = y `k` go ys\n</code></pre>\n</blockquote>\n\n<p>So if we give <code>foldr</code> an empty list, then <code>go</code> will immediately work on that empty list, and return <code>z</code>, the initial value.</p>\n\n<p>A cleaner syntax (and a bit less efficient, as is written in the comment of the function) would thus be:</p>\n\n<pre><code>foldr :: (a -&gt; b -&gt; b) -&gt; b -&gt; [a] -&gt; b\nfoldr _ z [] = z\nfoldr f z (x:xs) = f x (foldr f z xs)\n</code></pre>\n\n<p>Note that - depending on the implementation of <code>f</code> - it is possible to <code>foldr</code> on infinite lists: if at some point <code>f</code> only looks at the initial value, and then returns a value, then the recursive part can be dropped.</p>\n"}], "owner": {"reputation": 835, "user_id": 6301341, "user_type": "registered", "accept_rate": 91, "profile_image": "https://www.gravatar.com/avatar/bb987d3e8cfa45185a84db4232af8312?s=128&d=identicon&r=PG&f=1", "display_name": "jyet", "link": "https://stackoverflow.com/users/6301341/jyet"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 1048, "favorite_count": 0, "accepted_answer_id": 44674895, "answer_count": 1, "score": 0, "last_activity_date": 1498046256, "creation_date": 1498044553, "last_edit_date": 1498045258, "question_id": 44674846, "link": "https://stackoverflow.com/questions/44674846/how-does-fold-works-for-empty-list", "title": "How does fold works for empty list?", "body": "<p>When we fold a list with one or more elements inside as done below:</p>\n\n<pre><code>foldr (+) 0 [1,2,3]\n</code></pre>\n\n<blockquote>\n  <p>We get:  </p>\n  \n  <p>foldr (+) 0 (1 : 2 : 3 : [])</p>\n  \n  <p>foldr (+)   1 + (2 +(3 + 0)) // 6</p>\n</blockquote>\n\n<p>Now when the list is empty:</p>\n\n<pre><code> foldr (+) 0 []\n</code></pre>\n\n<blockquote>\n  <p>Result: foldr (+) 0 ([])</p>\n</blockquote>\n\n<p>Since (+) is binary operator, it needs two arguments to complete but here we end up <code>(+) 0</code>. How does it result in 0 and not throwing error of partially applied function.</p>\n"}, {"tags": ["haskell", "polymorphism", "typeclass", "parametric-polymorphism"], "comments": [{"owner": {"reputation": 314794, "user_id": 67579, "user_type": "registered", "accept_rate": 81, "profile_image": "https://i.stack.imgur.com/BJXub.png?s=128&g=1", "display_name": "Willem Van Onsem", "link": "https://stackoverflow.com/users/67579/willem-van-onsem"}, "edited": false, "score": 1, "creation_date": 1498041951, "post_id": 44673664, "comment_id": 76331775, "body": "But it is probably not in the <code>ghci</code>, you should run it with <code>ghci -XFlexibleContexts file.hs</code>."}], "answers": [{"comments": [{"owner": {"reputation": 1336, "user_id": 388585, "user_type": "registered", "accept_rate": 64, "profile_image": "https://www.gravatar.com/avatar/bb2833f64b9cd74538a15a6f6bf4fbf7?s=128&d=identicon&r=PG", "display_name": "Nikita Hismatov", "link": "https://stackoverflow.com/users/388585/nikita-hismatov"}, "edited": false, "score": 0, "creation_date": 1498045895, "post_id": 44673949, "comment_id": 76334518, "body": "Thank you! I will try to use your solution."}, {"owner": {"reputation": 1336, "user_id": 388585, "user_type": "registered", "accept_rate": 64, "profile_image": "https://www.gravatar.com/avatar/bb2833f64b9cd74538a15a6f6bf4fbf7?s=128&d=identicon&r=PG", "display_name": "Nikita Hismatov", "link": "https://stackoverflow.com/users/388585/nikita-hismatov"}, "edited": false, "score": 0, "creation_date": 1498047471, "post_id": 44673949, "comment_id": 76335709, "body": "Yep, FunctionalDependencies and FlexibleContents do the magic :)"}], "tags": [], "owner": {"reputation": 153048, "user_id": 9204, "user_type": "registered", "accept_rate": 82, "profile_image": "https://www.gravatar.com/avatar/c79937a093ff9e963c563e22cd385f30?s=128&d=identicon&r=PG", "display_name": "Alexey Romanov", "link": "https://stackoverflow.com/users/9204/alexey-romanov"}, "is_accepted": true, "score": 1, "last_activity_date": 1498042028, "creation_date": 1498042028, "answer_id": 44673949, "question_id": 44673664, "link": "https://stackoverflow.com/questions/44673664/haskell-non-type-variable-argument-in-the-constraint/44673949#44673949", "title": "Haskell: Non type-variable argument in the constraint", "body": "<blockquote>\n  <p>And the thing that confuses me much: I put the FlexibleContexts pragma to the pragma listing in the head, but ghcu still suggest me to get it included.</p>\n</blockquote>\n\n<p>This only enables the extension in the module itself. To write this code in GHCi, you need to enable the extension in GHCi: <code>:set -XFlexibleContexts</code>.</p>\n\n<p>But this is only part of the problem. It looks like for your class <code>p</code> should determine <code>n</code>: you can only move a <code>Point a</code> up and down by <code>a</code>, right? But as it stands, nothing stops you from defining more <code>Moving (Point a) SomeOtherType</code> instances, and the compiler doesn't assume you won't. So <code>a</code> and <code>n</code> in the inferred type are completely unrelated, where you want them to be the same. This can be fixed by adding the <a href=\"https://downloads.haskell.org/~ghc/latest/docs/html/users_guide/glasgow_exts.html#functional-dependencies\" rel=\"nofollow noreferrer\"><code>FunctionalDependencies</code> extension</a> and changing the class declaration to say</p>\n\n<pre><code>class Num n =&gt; Moving p n | p -&gt; n where\n</code></pre>\n\n<p>which means exactly that there can't be instances with same <code>p</code> and different <code>n</code>.</p>\n\n<p>I think that's enough to make it work. The code will still be underdetermined because it allows any numeric <code>a</code>, but defaulting rules will pick <code>Integer</code>.</p>\n"}], "owner": {"reputation": 1336, "user_id": 388585, "user_type": "registered", "accept_rate": 64, "profile_image": "https://www.gravatar.com/avatar/bb2833f64b9cd74538a15a6f6bf4fbf7?s=128&d=identicon&r=PG", "display_name": "Nikita Hismatov", "link": "https://stackoverflow.com/users/388585/nikita-hismatov"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 1010, "favorite_count": 0, "accepted_answer_id": 44673949, "answer_count": 1, "score": 0, "last_activity_date": 1498042028, "creation_date": 1498041198, "question_id": 44673664, "link": "https://stackoverflow.com/questions/44673664/haskell-non-type-variable-argument-in-the-constraint", "title": "Haskell: Non type-variable argument in the constraint", "body": "<p>I created some functions to get some comfort with 2D geometry. \nIn this example I use <a href=\"http://hackage.haskell.org/package/cubicbezier-0.6.0.3/docs/Geom2D.html\" rel=\"nofollow noreferrer\">Geom2D from CubicBezier package</a>.</p>\n\n<p>Complete code of my program: <a href=\"https://gist.github.com/nskeip/3784d651ac646a67c5f246f048949af4\" rel=\"nofollow noreferrer\">https://gist.github.com/nskeip/3784d651ac646a67c5f246f048949af4</a></p>\n\n<pre><code>{-# LANGUAGE MultiParamTypeClasses, FlexibleInstances, FlexibleContexts #-}\nimport Geom2D\n\nleft :: (Num a) =&gt; Point a -&gt; a -&gt; Point a\nleft (Point x y) n = Point (x - n) y\n\nright :: (Num a) =&gt; Point a -&gt; a -&gt; Point a\nright (Point x y) n = Point (x + n) y\n\nup :: (Num a) =&gt; Point a -&gt; a -&gt; Point a\nup (Point x y) n = Point x (y - n)\n\ndown :: (Num a) =&gt; Point a -&gt; a -&gt; Point a\ndown (Point x y) n = Point x (y + n)\n</code></pre>\n\n<p>They work like this:</p>\n\n<pre><code>&gt; (Point 0 0) `up` 10\nPoint 0.0 -10.0\n</code></pre>\n\n<p>Where <code>Point</code> is defined like this:</p>\n\n<pre><code>data Point a = Point {\n  pointX :: !a,\n  pointY :: !a\n  } deriving (Eq, Ord, Functor, Foldable, Traversable)\n</code></pre>\n\n<p>And everything was fine untill I thought: \"Hey, it would be nice to make that functions (actualy, operators) work with thigs like <code>Line</code> - not only <code>Point</code>\"</p>\n\n<p>So I declared a class (not taking <code>left</code> and <code>right</code> to keep thigs simple):</p>\n\n<pre><code>class Num n =&gt; Moving p n where\n  up'    :: n -&gt; p -&gt; p\n  down'  :: n -&gt; p -&gt; p\n\n  up'    n = down'  (-n)\n  down'  n = up'    (-n)\n</code></pre>\n\n<p>And an instance of <code>Moving</code> for <code>Point a</code> data type:</p>\n\n<pre><code>instance Num a =&gt; Moving (Point a) a where\n  up' n (Point x y) = Point x (y - n)\n</code></pre>\n\n<p>But when I try to use it, I got an error:</p>\n\n<pre><code>\u2717 ghci ./uno.hs \nGHCi, version 7.10.3: http://www.haskell.org/ghc/  :? for help\n[1 of 1] Compiling Main             ( uno.hs, interpreted )\nOk, modules loaded: Main.\n*Main&gt; let p = Point { pointX = 0, pointY = 0 } \n*Main&gt; up' 10 p\n\n&lt;interactive&gt;:3:1:\n    Non type-variable argument in the constraint: Moving (Point a) n\n    (Use FlexibleContexts to permit this)\n    When checking that \u2018it\u2019 has the inferred type\n      it :: forall n a. (Num a, Moving (Point a) n) =&gt; Point a\n</code></pre>\n\n<p>And the thing that confuses me much: I put the <code>FlexibleContexts</code> pragma to the pragma listing in the head, but ghcu still suggest me to get it included.</p>\n\n<p>How can I fix my class / instance to get parametric polymorphism working? :)</p>\n"}, {"tags": ["haskell", "parsec"], "answers": [{"tags": [], "owner": {"reputation": 3587, "user_id": 7824574, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/a639be4c9ecc139065fbc6b12b87e6a9?s=128&d=identicon&r=PG&f=1", "display_name": "typetetris", "link": "https://stackoverflow.com/users/7824574/typetetris"}, "is_accepted": true, "score": 1, "last_activity_date": 1498029800, "creation_date": 1498029800, "answer_id": 44669348, "question_id": 44668421, "link": "https://stackoverflow.com/questions/44668421/haskell-parsec-error/44669348#44669348", "title": "Haskell parsec error", "body": "<p>From <a href=\"https://hackage.haskell.org/package/parsec-3.1.11/docs/Text-Parsec-Char.html\" rel=\"nofollow noreferrer\">hackage</a>    </p>\n\n<pre><code>spaces :: Stream s m Char =&gt; ParsecT s u m ()\nletter :: Stream s m Char =&gt; ParsecT s u m Char\n</code></pre>\n\n<p>so you have parser, that try to give you <code>Char</code>s and one, that just drops input and gives you <code>()</code>. What should the result be?</p>\n\n<p>You could use</p>\n\n<pre><code>space :: Stream s m Char =&gt; ParsecT s u m Char\n</code></pre>\n\n<p>or</p>\n\n<pre><code>(spaces *&gt; return ' ')\n</code></pre>\n\n<p>instead of just <code>spaces</code> depends on the behavior you want.</p>\n"}], "owner": {"reputation": 134, "user_id": 6049771, "user_type": "registered", "accept_rate": 79, "profile_image": "https://www.gravatar.com/avatar/7af641d29fe460006c5f0ef5158aec75?s=128&d=identicon&r=PG&f=1", "display_name": "Shaurya", "link": "https://stackoverflow.com/users/6049771/shaurya"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 82, "favorite_count": 0, "accepted_answer_id": 44669348, "answer_count": 1, "score": -3, "last_activity_date": 1498029800, "creation_date": 1498026820, "question_id": 44668421, "link": "https://stackoverflow.com/questions/44668421/haskell-parsec-error", "title": "Haskell parsec error", "body": "<p>while learning the parsec tutorial , I tried the fllowing command</p>\n\n<pre><code>  print (Parsec.parse (Parsec.many (Parsec.choice [Parsec.letter,Parsec.spaces ,(Parsec.char ','), Parsec.digit])) \"\" \"hello1 , byebye2 ,\" )\n</code></pre>\n\n<p>and the error in console was <a href=\"https://i.stack.imgur.com/4ZE0t.png\" rel=\"nofollow noreferrer\"><img src=\"https://i.stack.imgur.com/4ZE0t.png\" alt=\"enter image description here\"></a></p>\n\n<p>I am not sure how to fix this. How this can be fixed, any ideas??</p>\n"}, {"tags": ["haskell", "tree"], "comments": [{"owner": {"reputation": 208473, "user_id": 126014, "user_type": "registered", "accept_rate": 86, "profile_image": "https://www.gravatar.com/avatar/33526616d4a11f1630d4939b769cfbf9?s=128&d=identicon&r=PG", "display_name": "Mark Seemann", "link": "https://stackoverflow.com/users/126014/mark-seemann"}, "edited": false, "score": 2, "creation_date": 1498022705, "post_id": 44667378, "comment_id": 76319799, "body": "What have you tried so far? Where are you having problems?"}, {"owner": {"reputation": 11, "user_id": 8192114, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/c2b3de39da82bf7879a8f3f5f9641401?s=128&d=identicon&r=PG&f=1", "display_name": "adoudouzhao", "link": "https://stackoverflow.com/users/8192114/adoudouzhao"}, "reply_to_user": {"reputation": 208473, "user_id": 126014, "user_type": "registered", "accept_rate": 86, "profile_image": "https://www.gravatar.com/avatar/33526616d4a11f1630d4939b769cfbf9?s=128&d=identicon&r=PG", "display_name": "Mark Seemann", "link": "https://stackoverflow.com/users/126014/mark-seemann"}, "edited": false, "score": 0, "creation_date": 1498023001, "post_id": 44667378, "comment_id": 76319904, "body": "preorder  :: (a -&gt; c) -&gt; (b -&gt; c) -&gt; Tree a b -&gt; [c] preorder f g (Leaf x)= [f x] preorder f g (Branch x l r) = g x : (preorder f g l ++ preorder f g r)  inorder   :: (a -&gt; c) -&gt; (b -&gt; c) -&gt; Tree a b -&gt; [c] inorder f g (Leaf x) = [f x] inorder f g (Branch x l r) = inorder f g l ++ [g x]++ inorder f g r"}, {"owner": {"reputation": 11, "user_id": 8192114, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/c2b3de39da82bf7879a8f3f5f9641401?s=128&d=identicon&r=PG&f=1", "display_name": "adoudouzhao", "link": "https://stackoverflow.com/users/8192114/adoudouzhao"}, "reply_to_user": {"reputation": 208473, "user_id": 126014, "user_type": "registered", "accept_rate": 86, "profile_image": "https://www.gravatar.com/avatar/33526616d4a11f1630d4939b769cfbf9?s=128&d=identicon&r=PG", "display_name": "Mark Seemann", "link": "https://stackoverflow.com/users/126014/mark-seemann"}, "edited": false, "score": 0, "creation_date": 1498023043, "post_id": 44667378, "comment_id": 76319920, "body": "i don&#39;t know how to test my answers"}, {"owner": {"reputation": 24028, "user_id": 383200, "user_type": "registered", "accept_rate": 60, "profile_image": "https://www.gravatar.com/avatar/a9dc722f936cb1059adaae4fe39c07f0?s=128&d=identicon&r=PG", "display_name": "Carl", "link": "https://stackoverflow.com/users/383200/carl"}, "edited": false, "score": 2, "creation_date": 1498026902, "post_id": 44667378, "comment_id": 76321578, "body": "Those look correct. What have you tried to test? In what ways is it giving  you trouble? Please provide exactly what you&#39;ve tried and the full text of any error messages you get."}, {"owner": {"reputation": 11, "user_id": 8192114, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/c2b3de39da82bf7879a8f3f5f9641401?s=128&d=identicon&r=PG&f=1", "display_name": "adoudouzhao", "link": "https://stackoverflow.com/users/8192114/adoudouzhao"}, "edited": false, "score": 0, "creation_date": 1498066053, "post_id": 44667378, "comment_id": 76349360, "body": "I just don&#39;t know how to test whether it&#39;s correct. What parameters should i put in the function to test it?"}], "answers": [{"tags": [], "owner": {"reputation": 755, "user_id": 2704964, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/79d2160e8cd355915182506411e69489?s=128&d=identicon&r=PG&f=1", "display_name": "Anton Xue", "link": "https://stackoverflow.com/users/2704964/anton-xue"}, "is_accepted": false, "score": 1, "last_activity_date": 1498116145, "last_edit_date": 1498116145, "creation_date": 1498044713, "answer_id": 44674900, "question_id": 44667378, "link": "https://stackoverflow.com/questions/44667378/how-to-solve-haskell-tree-prorder/44674900#44674900", "title": "How to solve haskell tree prorder", "body": "<p>The code that you have provided looks correct. To test, here is a nifty little example:\n<a href=\"http://www.geeksforgeeks.org/tree-traversals-inorder-preorder-and-postorder/\" rel=\"nofollow noreferrer\">http://www.geeksforgeeks.org/tree-traversals-inorder-preorder-and-postorder/</a></p>\n\n<p>The representation for this tree might be something like this:</p>\n\n<pre><code>tree :: Tree Int Int\ntree = Branch 1 (Branch 2 (Leaf 4) (Leaf 5)) (Leaf 3)\n</code></pre>\n\n<p>Here both the leaves and internal nodes are of type <code>Int</code>.</p>\n\n<p>Now the <code>preorder</code> and <code>inorder</code> functions take two additional functions <code>f</code> and <code>g</code> of type <code>(a -&gt; c)</code> and <code>(b -&gt; c)</code> respectively, which are ways of converting the data in the leaves from type <code>a</code> to some type <code>c</code> and the data from internal branches from type <code>b</code> to <code>c</code>. These are two functions that you would have to supply yourself, depending on what your desired output type <code>c</code> is.</p>\n\n<p>For instance, let us consider a complete example of <code>Tree Int String</code>. We pass in two functions <code>intToStr</code> and <code>strToStr</code> as ways of converting the leaves and internal nodes' data to our desired output type: <code>String</code>:</p>\n\n<pre><code> data Tree a b = Branch b (Tree a b) (Tree a b)\n               | Leaf a\n\n tree :: Tree Int String\n tree = Branch \"one\" (Branch \"two\" (Leaf 4) (Leaf 5)) (Leaf 3)\n\n preorder :: (a -&gt; c) -&gt; (b -&gt; c) -&gt; Tree a b -&gt; [c] \n preorder f g (Leaf x)= [f x] \n preorder f g (Branch x l r) = g x : (preorder f g l ++ preorder f g r) \n\n inorder :: (a -&gt; c) -&gt; (b -&gt; c) -&gt; Tree a b -&gt; [c] \n inorder f g (Leaf x) = [f x]\n inorder f g (Branch x l r) = inorder f g l ++ [g x] ++ inorder f g r\n\n strToStr :: String -&gt; String\n strToStr s = s\n\n intToStr :: Int -&gt; String\n intToStr i = show i\n\n main = do\n     if (preorder intToStr strToStr tree == [\"one\", \"two\", \"4\", \"5\", \"3\"]) &amp;&amp;\n        (inorder intToStr strToStr tree  == [\"4\", \"two\", \"5\", \"one\", \"3\"])\n         then putStrLn \"Correct implementation!\"\n         else putStrLn \"Something went wrong :(\"\n</code></pre>\n"}], "owner": {"reputation": 11, "user_id": 8192114, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/c2b3de39da82bf7879a8f3f5f9641401?s=128&d=identicon&r=PG&f=1", "display_name": "adoudouzhao", "link": "https://stackoverflow.com/users/8192114/adoudouzhao"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 432, "favorite_count": 0, "answer_count": 1, "score": 1, "last_activity_date": 1498116145, "creation_date": 1498022447, "last_edit_date": 1498055619, "question_id": 44667378, "link": "https://stackoverflow.com/questions/44667378/how-to-solve-haskell-tree-prorder", "title": "How to solve haskell tree prorder", "body": "<p>Can anybody help me solve the problem. I am new to haskell and have no idea of this problem.</p>\n\n<blockquote>\n  <p>Consider the following data type.</p>\n\n<pre><code>data Tree a b = Branch b (Tree a b) (Tree a b)\n              | Leaf a\n</code></pre>\n  \n  <p><strong>Problem 7. (10 points)</strong> Implement the two functions that traverse the tree in the given order collecting the values from the tree nodes\n  into a list:</p>\n\n<pre><code>preorder :: (a -&gt; c) -&gt; (b -&gt; c) -&gt; Tree a b -&gt; [c]\ninorder  :: (a -&gt; c) -&gt; (b -&gt; c) -&gt; Tree a b -&gt; [c]\n</code></pre>\n  \n  <p>Notice that the data type <code>Tree</code> can store different types of values\n  in the leaves than on the branching nodes. Thus, each of these\n  functions takes two functions as arguments: The first function maps\n  the values stored in the leaves to some common type <code>c</code>, and the\n  second function maps the values stored in the branching nodes to type\n  <code>c</code>, thus, resulting in a list of type <code>[c]</code>.</p>\n</blockquote>\n\n<p>So far I have tried the following, but don't know how to test my answers:</p>\n\n<pre><code>preorder :: (a -&gt; c) -&gt; (b -&gt; c) -&gt; Tree a b -&gt; [c] \npreorder f g (Leaf x)= [f x] \npreorder f g (Branch x l r) = g x : (preorder f g l ++ preorder f g r) \n\ninorder :: (a -&gt; c) -&gt; (b -&gt; c) -&gt; Tree a b -&gt; [c] \ninorder f g (Leaf x) = [f x] \ninorder f g (Branch x l r) = inorder f g l ++ [g x] ++ inorder f g r\n</code></pre>\n"}, {"tags": ["haskell", "functional-programming", "elm"], "comments": [{"owner": {"reputation": 23111, "user_id": 1319998, "user_type": "registered", "accept_rate": 58, "profile_image": "https://www.gravatar.com/avatar/9f600f4583bec89109ce8c0c098951ae?s=128&d=identicon&r=PG", "display_name": "Michal Charemza", "link": "https://stackoverflow.com/users/1319998/michal-charemza"}, "edited": false, "score": 0, "creation_date": 1498020884, "post_id": 44667027, "comment_id": 76319167, "body": "What&#39;s the error message you get when you try to compile?"}], "answers": [{"comments": [{"owner": {"reputation": 2957, "user_id": 280050, "user_type": "registered", "accept_rate": 70, "profile_image": "https://www.gravatar.com/avatar/141e8429e4dd4386a8d3a952f02f52e7?s=128&d=identicon&r=PG", "display_name": "Zachary K", "link": "https://stackoverflow.com/users/280050/zachary-k"}, "edited": false, "score": 1, "creation_date": 1498022154, "post_id": 44667296, "comment_id": 76319599, "body": "As an Erlang dev who moved to Elm I often miss this, but I do like Elm&#39;s extremely consistent syntax."}], "tags": [], "owner": {"reputation": 4630, "user_id": 160386, "user_type": "registered", "accept_rate": 85, "profile_image": "https://www.gravatar.com/avatar/b6044f355342bb055fbb03804d9673e3?s=128&d=identicon&r=PG", "display_name": "Jan Tojnar", "link": "https://stackoverflow.com/users/160386/jan-tojnar"}, "is_accepted": true, "score": 12, "last_activity_date": 1498022020, "creation_date": 1498022020, "answer_id": 44667296, "question_id": 44667027, "link": "https://stackoverflow.com/questions/44667027/haskell-pattern-matching-not-allowed-in-elm/44667296#44667296", "title": "Haskell pattern matching not allowed in Elm?", "body": "<p>One of the goals of Elm is to use a <a href=\"http://elm-lang.org/docs/style-guide\" rel=\"noreferrer\">consistent style</a>; removing redundant syntax is a conclusion of this. For that reason, you will not find any <a href=\"https://github.com/elm-lang/elm-compiler/issues/621\" rel=\"noreferrer\"><code>where</code> clause</a> and <a href=\"https://github.com/elm-lang/elm-compiler/issues/973\" rel=\"noreferrer\">function definitions with multiple variants</a> are not permitted either.</p>\n"}], "owner": {"reputation": 693, "user_id": 7564554, "user_type": "registered", "accept_rate": 82, "profile_image": "https://lh3.googleusercontent.com/-h7KkTmgJty0/AAAAAAAAAAI/AAAAAAAAAAo/ZFEGeg_bQ6Y/photo.jpg?sz=128", "display_name": "Eben Kadile", "link": "https://stackoverflow.com/users/7564554/eben-kadile"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 195, "favorite_count": 0, "accepted_answer_id": 44667296, "answer_count": 1, "score": 4, "last_activity_date": 1498022020, "creation_date": 1498020291, "question_id": 44667027, "link": "https://stackoverflow.com/questions/44667027/haskell-pattern-matching-not-allowed-in-elm", "title": "Haskell pattern matching not allowed in Elm?", "body": "<p>Following <a href=\"https://guide.elm-lang.org/architecture/user_input/buttons.html\" rel=\"nofollow noreferrer\">this Elm tutorial</a> and I assumed that the function</p>\n\n<pre><code>update : Msg -&gt; Model -&gt; Model\n</code></pre>\n\n<p>is defined in the tutorial as</p>\n\n<pre><code>update msg model = \n    case msg of\n        Increment  -&gt; model + 1\n        Deccrement -&gt; model - 1\n        Reset      -&gt; 0\n</code></pre>\n\n<p>I thought I would define it the same way but with syntax I prefer:</p>\n\n<pre><code>update Increment model = model + 1\nupdate Decrement model = model - 1\nupdate Reset model     = 0\n</code></pre>\n\n<p>But this doesn't compile, does Elm not support this syntax or did I make a mistake?</p>\n"}, {"tags": ["haskell"], "answers": [{"tags": [], "owner": {"reputation": 29444, "user_id": 3072788, "user_type": "registered", "accept_rate": 82, "profile_image": "https://www.gravatar.com/avatar/220a45c2fcff7e7358d144551b116205?s=128&d=identicon&r=PG&f=1", "display_name": "Alec", "link": "https://stackoverflow.com/users/3072788/alec"}, "is_accepted": false, "score": 1, "last_activity_date": 1498020620, "last_edit_date": 1498020620, "creation_date": 1498019864, "answer_id": 44666983, "question_id": 44666685, "link": "https://stackoverflow.com/questions/44666685/extensible-records-i-think/44666983#44666983", "title": "Extensible records (I think)", "body": "<p>This is exactly what <code>HList</code> is good for. However, since I don't have the right setup to test something with the <code>HList</code> package right now (and besides, it has <a href=\"https://stackoverflow.com/q/41135212/3072788\">more confusing data definitions</a>), here is a minimal example of <code>HList</code> that uses <code>singletons</code> for the type-level list stuff.</p>\n\n<pre><code>{-# LANGUAGE DataKinds, TypeOperators, GADTs,TypeFamilies, UndecidableInstances,\n    PolyKinds,  FlexibleInstances, MultiParamTypeClasses\n  #-}\n\nimport Data.Singletons\nimport Data.Promotion.Prelude.List\n\ndata HList (l :: [*]) where\n  HNil :: HList '[]\n  HCons :: x -&gt; HList xs -&gt; HList (x ': xs)\n</code></pre>\n\n<p>The <code>add</code> function is the simplest: it is just <code>HCons</code>:</p>\n\n<pre><code>add :: x -&gt; HList xs -&gt; HList (x ': xs)\nadd = HCons \n</code></pre>\n\n<p>Something more interesting is combining two records:</p>\n\n<pre><code>-- Notice we are using `:++` from singletons\ncombine :: HList xs -&gt; HList ys -&gt; HList (xs :++ ys)\ncombine HNil xs = xs\ncombine (x `HCons` xs) ys = x `HCons` (xs `combine` ys)\n</code></pre>\n\n<p>Now, for your <code>get</code> function, you need to dispatch based on the type-level list. To do this, you need an overlapping type class.</p>\n\n<pre><code>class Has x xs where\n  get :: xs -&gt; x\n\ninstance {-# OVERLAPS #-} Has x (HList (x ': xs)) where\n  get (x `HCons` _) = x\n\ninstance Has x (HList xs) =&gt; Has x (HList (y ': xs)) where\n  get (_ `HCons` xs) = get xs\n</code></pre>\n\n<p>Finally, we can use <code>Has</code> to define a similar <code>Subset</code> class. Same idea as before.</p>\n\n<pre><code>class Subset ys xs where\n  slice :: xs -&gt; ys\n\ninstance Subset (HList '[]) (HList xs) where\n  slice _ = HNil\n\ninstance (Get y (HList xs), Subset (HList ys) (HList xs)) =&gt;\n           Subset (HList (y ': ys)) (HList xs) where\n  slice xs = get xs `HCons` slice xs\n</code></pre>\n\n<hr>\n\n<p>As you mention in parens, the simple <code>HList</code> form does not ensure you have only <em>one</em> of any type of field (so <code>get</code> just returns the first field, ignoring the rest). If you want uniqueness, you can just add a constraint to the <code>HList</code> constructor.</p>\n\n<pre><code>data Record (l :: [*]) where\n  Nil :: Record '[]\n  Cons :: (NotElem x xs ~ 'True) =&gt; x -&gt; Record xs -&gt; Record (x ': xs)\n</code></pre>\n\n<p>However, defining <code>Subset</code> using <code>Record</code> looks like it involves some proofs. :)</p>\n"}], "owner": {"reputation": 20310, "user_id": 525980, "user_type": "registered", "accept_rate": 48, "profile_image": "https://www.gravatar.com/avatar/8dafe66793ee2f32192e9fcefb389a12?s=128&d=identicon&r=PG", "display_name": "Clinton", "link": "https://stackoverflow.com/users/525980/clinton"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 159, "favorite_count": 0, "answer_count": 1, "score": 1, "last_activity_date": 1498020620, "creation_date": 1498017734, "last_edit_date": 1498018223, "question_id": 44666685, "link": "https://stackoverflow.com/questions/44666685/extensible-records-i-think", "title": "Extensible records (I think)", "body": "<p>What I roughly want is this:</p>\n\n<pre><code>data A = ...\ndata B = ...\ndata C = ...\n\nclass HasA t where\n  getA :: t -&gt; A\n\nclass HasB t where\n  getB :: t -&gt; B\n\nclass HasC t where\n  getC :: t -&gt; C\n</code></pre>\n\n<p>So I can do something like this (pseudocode follows):</p>\n\n<pre><code>a :: A\nb :: B\n\nx = mkRecord { elemA a, elemB b }\ny = mkRecord { elemB b, elemA a }\n\n-- type of `x` == type of `y`\n</code></pre>\n\n<p>Naturally, only the appropriate <code>get</code> functions work, in the above case <code>getA</code> and <code>getB</code>. </p>\n\n<p>I'd also like the following functions</p>\n\n<pre><code>slice :: Subset a b =&gt; a -&gt; b\nslice x = -- just remove the bits of x that aren't in type b.\n\nadd :: e -&gt; a -&gt; a ++ e\nadd e x = -- add an element to the \"record\" (compile error if it's already there)\n</code></pre>\n\n<p>I feel like this is not a new problem so perhaps a resolution for this already exists. Note that I don't require the solution to be extensible, the amount of types I need to deal with is finite and known, but of course and extensible one wouldn't hurt.</p>\n\n<p>I've found a couple of packages that seem to be in the field of what I'm looking for, namely <a href=\"https://hackage.haskell.org/package/HList\" rel=\"nofollow noreferrer\">HList</a> and <a href=\"https://hackage.haskell.org/package/extensible\" rel=\"nofollow noreferrer\">extensible</a> (perhaps extensible is better because I want my records unordered). I got a bit lost in the Hackage docs so I'd like just some sample code (or a link to some sample code) that roughly achieves what I'm looking for.</p>\n"}, {"tags": ["c#", "haskell", "exception", "functional-programming", "either"], "comments": [{"owner": {"reputation": 29444, "user_id": 3072788, "user_type": "registered", "accept_rate": 82, "profile_image": "https://www.gravatar.com/avatar/220a45c2fcff7e7358d144551b116205?s=128&d=identicon&r=PG&f=1", "display_name": "Alec", "link": "https://stackoverflow.com/users/3072788/alec"}, "edited": false, "score": 2, "creation_date": 1498013838, "post_id": 44665959, "comment_id": 76317421, "body": "This isn&#39;t possible without altering the third party function. And I think this is the only reasonable behaviour: you&#39;d lose referential transparency if this was possible. Exceptions (that can be caught) are like <code>null</code>, in that they are a (convenient) &quot;hack&quot; as far as type systems go. <code>null</code> essentially bakes everything into a <code>Maybe</code> monad and exceptions add <code>Either</code> on top of that.   The approach that uses exceptions that you detail is akin to using <code>null</code> to denote a special/extra singleton value instead of just using an option type."}], "answers": [{"comments": [{"owner": {"reputation": 37219, "user_id": 1523776, "user_type": "moderator", "accept_rate": 87, "profile_image": "https://www.gravatar.com/avatar/b3e0b5c8e42a8c38009ef2d969f8dabb?s=128&d=identicon&r=PG", "display_name": "Benjamin Hodgson", "link": "https://stackoverflow.com/users/1523776/benjamin-hodgson"}, "edited": false, "score": 1, "creation_date": 1498034130, "post_id": 44669118, "comment_id": 76326072, "body": "<code>sequence . fmap f = traverse f</code>"}, {"owner": {"reputation": 784, "user_id": 1457216, "user_type": "registered", "accept_rate": 64, "profile_image": "https://www.gravatar.com/avatar/2ac2b341a447ea32064a230d1471c6fb?s=128&d=identicon&r=PG", "display_name": "CountOren", "link": "https://stackoverflow.com/users/1457216/countoren"}, "edited": false, "score": 0, "creation_date": 1498049628, "post_id": 44669118, "comment_id": 76337420, "body": "In C#: Between your function, ProcessUntilException and throwing exception there is still small gap, your function will keep consuming the list even if and error was found tho adding break statement inside the if should give as the same behavior, And if you want to stay in the &quot;monad word&quot; this function can consume IEnumerable&lt;Option&lt;T,TEroor&gt;&gt; and replace the try with Match function and this can be used: thirdPartyFunction(ProcessUntilException(lazyList,e=&gt; e)).   Is there anything I&#39;m missing?"}, {"owner": {"reputation": 208473, "user_id": 126014, "user_type": "registered", "accept_rate": 86, "profile_image": "https://www.gravatar.com/avatar/33526616d4a11f1630d4939b769cfbf9?s=128&d=identicon&r=PG", "display_name": "Mark Seemann", "link": "https://stackoverflow.com/users/126014/mark-seemann"}, "reply_to_user": {"reputation": 784, "user_id": 1457216, "user_type": "registered", "accept_rate": 64, "profile_image": "https://www.gravatar.com/avatar/2ac2b341a447ea32064a230d1471c6fb?s=128&d=identicon&r=PG", "display_name": "CountOren", "link": "https://stackoverflow.com/users/1457216/countoren"}, "edited": false, "score": 1, "creation_date": 1498049837, "post_id": 44669118, "comment_id": 76337595, "body": "@CountOren I was being lazy when I wrote that C# code snippet; I didn&#39;t have a C# compiler handy, so I didn&#39;t want to make it more complicated than I had to, but I&#39;m sure you know how to modify it so that it stops iterating when <code>exceptionHappened</code> is <code>true</code>."}, {"owner": {"reputation": 208473, "user_id": 126014, "user_type": "registered", "accept_rate": 86, "profile_image": "https://www.gravatar.com/avatar/33526616d4a11f1630d4939b769cfbf9?s=128&d=identicon&r=PG", "display_name": "Mark Seemann", "link": "https://stackoverflow.com/users/126014/mark-seemann"}, "reply_to_user": {"reputation": 784, "user_id": 1457216, "user_type": "registered", "accept_rate": 64, "profile_image": "https://www.gravatar.com/avatar/2ac2b341a447ea32064a230d1471c6fb?s=128&d=identicon&r=PG", "display_name": "CountOren", "link": "https://stackoverflow.com/users/1457216/countoren"}, "edited": false, "score": 0, "creation_date": 1498049912, "post_id": 44669118, "comment_id": 76337653, "body": "@CountOren but sure: you should be able to write functions that translate between one and the other paradigm. If I&#39;m right about the isorporhism, this should always be possible."}, {"owner": {"reputation": 9946, "user_id": 467754, "user_type": "registered", "accept_rate": 89, "profile_image": "https://i.stack.imgur.com/3rEtR.png?s=128&g=1", "display_name": "Nikos Baxevanis", "link": "https://stackoverflow.com/users/467754/nikos-baxevanis"}, "edited": false, "score": 1, "creation_date": 1498050093, "post_id": 44669118, "comment_id": 76337802, "body": "Make sure to <code>import Data.Either</code> if you&#39;re trying this in GHCi."}, {"owner": {"reputation": 784, "user_id": 1457216, "user_type": "registered", "accept_rate": 64, "profile_image": "https://www.gravatar.com/avatar/2ac2b341a447ea32064a230d1471c6fb?s=128&d=identicon&r=PG", "display_name": "CountOren", "link": "https://stackoverflow.com/users/1457216/countoren"}, "edited": false, "score": 0, "creation_date": 1498070431, "post_id": 44669118, "comment_id": 76351808, "body": "@MarkSeemann based on your answer here I posted an answer to my related question. Any comments are wellcome. Thanks."}, {"owner": {"reputation": 292, "user_id": 2443886, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/cc7c43e6198f4458dc867230336e4e94?s=128&d=identicon&r=PG&f=1", "display_name": "Lukas Juhrich", "link": "https://stackoverflow.com/users/2443886/lukas-juhrich"}, "edited": false, "score": 0, "creation_date": 1582811863, "post_id": 44669118, "comment_id": 106911778, "body": "@MarkSeemann when you say \u201cisomorphic\u201d, in which category are you? Without context that word is pretty much as precise as saying \u201cvaguely the same thing\u201d."}], "tags": [], "owner": {"reputation": 208473, "user_id": 126014, "user_type": "registered", "accept_rate": 86, "profile_image": "https://www.gravatar.com/avatar/33526616d4a11f1630d4939b769cfbf9?s=128&d=identicon&r=PG", "display_name": "Mark Seemann", "link": "https://stackoverflow.com/users/126014/mark-seemann"}, "is_accepted": true, "score": 10, "last_activity_date": 1498029050, "creation_date": 1498029050, "answer_id": 44669118, "question_id": 44665959, "link": "https://stackoverflow.com/questions/44665959/replacing-exceptions-with-either-maybe-option/44669118#44669118", "title": "Replacing Exceptions With Either/Maybe/Option", "body": "<p>As far as I can tell, Haskell <code>Either</code> is isomorphic to C#/Java-style exceptions, meaning that there's a translation from <code>Either</code>-based code to exception-based code, and vice versa. I'm not quite sure about this, though, as there may be some edge cases that I'm not aware of.</p>\n\n<p>On the other hand, what I <em>am</em> sure of is that <a href=\"https://bartoszmilewski.com/2015/01/13/simple-algebraic-data-types\" rel=\"noreferrer\"><code>Either () a</code> is isomorphic to <code>Maybe a</code></a>, so in the following, I'm going to stick with <code>Either</code> and ignore <code>Maybe</code>.</p>\n\n<p>What you can do with exceptions in C#, you can also do with <code>Either</code>. The default in C# is to do no error handling<sup>1</sup>:</p>\n\n<pre><code>public IEnumerable&lt;TResult&gt; NoCatch&lt;TResult, T&gt;(\n    IEnumerable&lt;T&gt; source, Func&lt;T, TResult&gt; selector)\n{\n    return source.Select(selector);\n}\n</code></pre>\n\n<p>This will iterate over <code>source</code> until an exception happens. If no exception is thrown, it'll return <code>IEnumerable&lt;TResult&gt;</code>, but if an exception is thrown by <code>selector</code>, the entire method throws an exception as well. However, if elements of <code>source</code> were handled before an exception was thrown, and there were side-effects, that work remains done.</p>\n\n<p>You can do the same in Haskell using <code>sequence</code>:</p>\n\n<pre><code>noCatch :: (Traversable t, Monad m) =&gt; (a -&gt; m b) -&gt; t a -&gt; m (t b)\nnoCatch f = sequence . fmap f\n</code></pre>\n\n<p>If <code>f</code> is a function that returns <code>Either</code>, then it behaves in the same way:</p>\n\n<pre><code>*Answer&gt; noCatch (\\i -&gt; if i &lt; 10 then Right i else Left i) [1, 3, 5, 2]\nRight [1,3,5,2]\n*Answer&gt; noCatch (\\i -&gt; if i &lt; 10 then Right i else Left i) [1, 3, 5, 11, 2, 12]\nLeft 11\n</code></pre>\n\n<p>As you can see, if no <code>Left</code> value is ever returned, you get a <code>Right</code> case back, with all the mapped elements. If <em>just one</em> <code>Left</code> case is returned, you get that, and no further processing is done.</p>\n\n<p>You could also imagine that you have a C# method that suppresses individual exceptions:</p>\n\n<pre><code>public IEnumerable&lt;TResult&gt; Suppress&lt;TResult, T&gt;(\n    IEnumerable&lt;T&gt; source, Func&lt;T, TResult&gt; selector)\n{\n    foreach (var x in source)\n        try { yield selector(x) } catch {}\n}\n</code></pre>\n\n<p>In Haskell, you could do this with <code>Either</code>:</p>\n\n<pre><code>filterRight :: (a -&gt; Either e b) -&gt; [a] -&gt; [b]\nfilterRight f = rights . fmap f\n</code></pre>\n\n<p>This returns all the <code>Right</code> values, and ignores the <code>Left</code> values:</p>\n\n<pre><code>*Answer&gt; filterRight (\\i -&gt; if i &lt; 10 then Right i else Left i) [1, 3, 5, 11, 2, 12]\n[1,3,5,2]\n</code></pre>\n\n<p>You can also write a method that processes the input until the first exception is thrown (if any):</p>\n\n<pre><code>public IEnumerable&lt;TResult&gt; ProcessUntilException&lt;TResult, T&gt;(\n    IEnumerable&lt;T&gt; source, Func&lt;T, TResult&gt; selector)\n{\n    var exceptionHappened = false;\n    foreach (var x in source)\n    {\n        if (!exceptionHappened)\n            try { yield selector(x) } catch { exceptionHappened = true }\n    }\n}\n</code></pre>\n\n<p>Again, you can achieve the same effect with Haskell:</p>\n\n<pre><code>takeWhileRight :: (a -&gt; Either e b) -&gt; [a] -&gt; [Either e b]\ntakeWhileRight f = takeWhile isRight . fmap f\n</code></pre>\n\n<p>Examples:</p>\n\n<pre><code>*Answer&gt; takeWhileRight (\\i -&gt; if i &lt; 10 then Right i else Left i) [1, 3, 5, 11, 2, 12]\n[Right 1,Right 3,Right 5]\n*Answer&gt; takeWhileRight (\\i -&gt; if i &lt; 10 then Right i else Left i) [1, 3, 5, 2]\n[Right 1,Right 3,Right 5,Right 2]\n</code></pre>\n\n<p>As you can see, however, both the C# examples and the Haskell examples <strong>need to be aware</strong> of the style of error-handling. While you can translate between the two styles, you can't use one with a method/function that expects the other.</p>\n\n<p>If you have a third-party C# method that expects exception handling to be the way things are done, you can't pass it a sequence of <code>Either</code> values and hope that it can deal with it. <strong>You'd have to modify the method.</strong></p>\n\n<p>The converse isn't quite true, though, because exception-handling is built into C# (and Haskell as well, in fact); you can't really opt out of exception-handling in such languages. Imagine, however, a language that doesn't have built-in exception-handling (PureScript, perhaps?), and this would be true as well.</p>\n\n<hr>\n\n<p><sup>1</sup> C# code may not compile.</p>\n"}, {"comments": [{"owner": {"reputation": 784, "user_id": 1457216, "user_type": "registered", "accept_rate": 64, "profile_image": "https://www.gravatar.com/avatar/2ac2b341a447ea32064a230d1471c6fb?s=128&d=identicon&r=PG", "display_name": "CountOren", "link": "https://stackoverflow.com/users/1457216/countoren"}, "edited": false, "score": 0, "creation_date": 1498095420, "post_id": 44688621, "comment_id": 76361284, "body": "look at the more specific version of this question and my answer there:  <a href=\"https://stackoverflow.com/questions/44578286/ienumerable-of-options-to-option-of-ienumerable?noredirect=1#comment76165155_44578286\" title=\"ienumerable of options to option of ienumerable\">stackoverflow.com/questions/44578286/&hellip;</a>"}, {"owner": {"reputation": 784, "user_id": 1457216, "user_type": "registered", "accept_rate": 64, "profile_image": "https://www.gravatar.com/avatar/2ac2b341a447ea32064a230d1471c6fb?s=128&d=identicon&r=PG", "display_name": "CountOren", "link": "https://stackoverflow.com/users/1457216/countoren"}, "edited": false, "score": 0, "creation_date": 1498096109, "post_id": 44688621, "comment_id": 76361453, "body": "In addition, I was using optional package because I am running .net 4 which is not supported in language-ext."}, {"owner": {"reputation": 11483, "user_id": 55693, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/5IoC2.png?s=128&g=1", "display_name": "CRice", "link": "https://stackoverflow.com/users/55693/crice"}, "edited": false, "score": 0, "creation_date": 1553744351, "post_id": 44688621, "comment_id": 97500961, "body": "@louthster Language-ext is awesome. Apart from <a href=\"https://github.com/louthy/language-ext/wiki\" rel=\"nofollow noreferrer\">github.com/louthy/language-ext/wiki</a> is there any other info on its usage?  I have also recently read &#39;functional programming in c# (enrico buonanno)&#39; which led me to find it."}], "tags": [], "owner": {"reputation": 1240, "user_id": 3384830, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/5oOUj.jpg?s=128&g=1", "display_name": "louthster", "link": "https://stackoverflow.com/users/3384830/louthster"}, "is_accepted": false, "score": 3, "last_activity_date": 1498094898, "last_edit_date": 1498094898, "creation_date": 1498094563, "answer_id": 44688621, "question_id": 44665959, "link": "https://stackoverflow.com/questions/44665959/replacing-exceptions-with-either-maybe-option/44688621#44688621", "title": "Replacing Exceptions With Either/Maybe/Option", "body": "<p>I haven't got a compiler handy, but you may want to check my <a href=\"https://github.com/louthy/language-ext\" rel=\"nofollow noreferrer\">language-ext project</a>.  It's a functional base class library for C#.</p>\n\n<p>For your needs it has:</p>\n\n<ul>\n<li><code>Seq&lt;A&gt;</code> which is a cons like lazy enumerable which will only evaluate once</li>\n<li><code>Try&lt;A&gt;</code> which is a delegate based monad which allows you to capture exceptions from third party code</li>\n<li>Other common error handling monads: <code>Option&lt;A&gt;</code>, <code>Either&lt;L, R&gt;</code>, etc.</li>\n<li>Bonus variants of those monads: <code>OptionAsync&lt;A&gt;</code>, <code>TryOption&lt;A&gt;</code>, <code>TryAsync&lt;A&gt;</code>, <code>TryOptionAsync&lt;A&gt;</code></li>\n<li>Ability to easily convert between those types: <code>ToOption()</code>, <code>ToEither()</code>, etc.</li>\n</ul>\n\n<blockquote>\n  <p>To apply a function (LINQ select,map...) on the method's lazy list argument and will take each element of the list (lazily) and will do computation that might fail (throwing an exception or returning Error/Either).\n  The list to be consumed only \"inside\" the 3rd party function, I don't want to have to iterate over each element more then once.</p>\n</blockquote>\n\n<p>This is a little unclear of the actual goal.  In language-ext you could do this:</p>\n\n<pre><code>using LanguageExt;\nusing static LanguageExt.Prelude;\n\n// Dummy lazy enumerable\nIEnumerable&lt;int&gt; Values()\n{\n    for(int i = 0; i &lt; 100; i++)\n    {\n        yield return UnreliableExternalFunc(i);\n    }\n}\n\n// Convert to a lazy sequence\nSeq&lt;int&gt; seq = Seq(Values());\n\n// Invoke external function that takes an IEnumerable\nExternalFunction(seq);\n\n// Calling it again won't evaluate it twice\nExternalFunction(seq);\n</code></pre>\n\n<p>But if the <code>Values()</code> function threw an exception then it would end its yielding and would return.  So you'd ideally have this:</p>\n\n<pre><code>// Dummy lazy enumerable\nIEnumerable&lt;Try&lt;int&gt;&gt; Values()\n{\n    for(int i = 0; i &lt; 100; i++)\n    {\n        yield return Try(() =&gt; UnreliableExternalFunc(i));\n    }\n}\n</code></pre>\n\n<p><code>Try</code> is the constructor function for the <code>Try</code> monad.  So your result would be a sequence of <code>Try</code> thunks.  If you don't care about the exception you could convert it to an <code>Option</code></p>\n\n<pre><code>// Dummy lazy enumerable\nIEnumerable&lt;Option&lt;int&gt;&gt; Values()\n{\n    for(int i = 0; i &lt; 100; i++)\n    {\n        yield return Try(() =&gt; UnreliableExternalFunc(i)).ToOption();\n    }\n}\n</code></pre>\n\n<p>The you could access all successes via:</p>\n\n<pre><code>var validValues = Values().Somes();\n</code></pre>\n\n<p>Or you could instead use <code>Either</code>:</p>\n\n<pre><code>// Dummy lazy enumerable\nIEnumerable&lt;Either&lt;Exception, A&gt;&gt; Values()\n{\n    for(int i = 0; i &lt; 100; i++)\n    {\n        yield return Try(() =&gt; UnreliableExternalFunc(i)).ToEither();\n    }\n}\n</code></pre>\n\n<p>Then you can get the valid results thus:</p>\n\n<pre><code>var seq = Seq(Values());\n\nvar validValues = seq.Rights();\n</code></pre>\n\n<p>And the errors:</p>\n\n<pre><code>var errors = seq.Lefts();\n</code></pre>\n\n<p>I converted it to a <code>Seq</code> so it doesn't evaluate twice. </p>\n\n<p>One way or another, if you want to catch an exception that happens during the lazy evaluation of the enumerable, then you will need to wrap each value.  If the exception can occur from the usage of the lazy value, but within a function then your only hope is to surround it with a <code>Try</code>:</p>\n\n<pre><code>// Convert to a lazy sequence\nSeq&lt;int&gt; seq = Seq(Values());  // Values is back to returning IEnumerable&lt;int&gt;\n\n// Invoke external function that takes an IEnumerable\nvar res = Try(() =&gt; ExternalFunction(seq)).IfFail(Seq&lt;int&gt;.Empty);\n\n// Calling it again won't evaluate it twice\nExternalFunction(seq);\n</code></pre>\n\n<blockquote>\n  <p>Intuitively I was trying to convert the list from the list of Eithers to Either of list, but this can be done only by consuming the list with functions. Like, aggregate or reduce (does Haskell's Sequence function act the same?).</p>\n</blockquote>\n\n<p>You can do this in language-ext like so:</p>\n\n<pre><code>IEnumerable&lt;Either&lt;L, R&gt;&gt; listOfEithers = ...;\n\nEither&lt;L, IEnumerable&lt;R&gt;&gt; eitherList = listOfEithers.Sequence();\n</code></pre>\n\n<p><code>Traverse</code> is also supported:</p>\n\n<pre><code>Either&lt;L, IEnumerable&lt;R&gt;&gt; eitherList = listOfEithers.Traverse(x =&gt; map(x));\n</code></pre>\n\n<p>All combinations of monads support <code>Sequence()</code> and <code>Traverse</code>; so you could do it with a <code>Seq&lt;Either&lt;L, R&gt;&gt;</code> to get a <code>Either&lt;L, Seq&lt;R&gt;&gt;</code>, which would guarantee that the lazy sequence isn't invoked multiple times. Or a <code>Seq&lt;Try&lt;A&gt;&gt;</code> to get a <code>Try&lt;Seq&lt;A&gt;&gt;</code>, or any of the async variants for concurrent sequencing and traversal.</p>\n\n<p>I'm not sure if any of this is covering what you're asking, the question is a bit broad.  A more specific example would be useful.</p>\n"}], "owner": {"reputation": 784, "user_id": 1457216, "user_type": "registered", "accept_rate": 64, "profile_image": "https://www.gravatar.com/avatar/2ac2b341a447ea32064a230d1471c6fb?s=128&d=identicon&r=PG", "display_name": "CountOren", "link": "https://stackoverflow.com/users/1457216/countoren"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 2341, "favorite_count": 5, "accepted_answer_id": 44669118, "answer_count": 2, "score": 3, "last_activity_date": 1498094898, "creation_date": 1498012584, "last_edit_date": 1498014611, "question_id": 44665959, "link": "https://stackoverflow.com/questions/44665959/replacing-exceptions-with-either-maybe-option", "title": "Replacing Exceptions With Either/Maybe/Option", "body": "<p>I came across this <a href=\"https://stackoverflow.com/questions/44578286/ienumerable-of-options-to-option-of-ienumerable?noredirect=1#comment76165155_44578286\">dead end</a> while trying to replace exceptions with either monad in c#. \nWhich leads me to think maybe it is not only language specific problem and more technique related missing feature.</p>\n\n<p>Let me try to re-explain it more globally:</p>\n\n<p>Given:</p>\n\n<ul>\n<li>I have a 3rd party function( a function that is imported into my code and I have no access to) which receives a lazy list (c# IEnumerable,f# Seq...) and consume it </li>\n</ul>\n\n<p>I Want:</p>\n\n<ul>\n<li><p>To apply a function (LINQ select,map...) on the method's lazy list argument and will take each element of the list (lazily) and will do computation that might fail (throwing an exception or returning Error/Either).</p></li>\n<li><p>The list to be consumed only \"inside\" the 3rd party function, I don't want to have to iterate over each element more then once.</p></li>\n</ul>\n\n<p>With Exceptions/side effects this can be achieved easily with throwing exception from the select, map functions if error was found, this will stop the execution \"inside\" the 3rd party function. Then I could handle the exception outside of it (without the 3rd party being \"aware\" of my error handling), leaving the responsibility of the error handling to me.</p>\n\n<p>While with Either it does not seem to be possible to get the same behavior without altering the 3rd party function. Intuitively I was trying to convert the list from the list of Eithers to Either of list, but this can be done only by consuming the list with functions. Like, aggregate or reduce (does Haskell's Sequence function act the same?).</p>\n\n<p>All this leads me to the question are Maybes/Eithers or Error as return type, missing this behavior? Is there another way to achive the same thing with them?</p>\n"}, {"tags": ["sql", "database", "haskell", "yesod", "esqueleto"], "owner": {"reputation": 1336, "user_id": 2801316, "user_type": "registered", "accept_rate": 87, "profile_image": "https://i.stack.imgur.com/cqx1a.jpg?s=128&g=1", "display_name": "FtheBuilder", "link": "https://stackoverflow.com/users/2801316/fthebuilder"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 94, "favorite_count": 0, "answer_count": 0, "score": 2, "last_activity_date": 1498001876, "creation_date": 1498001876, "question_id": 44664628, "link": "https://stackoverflow.com/questions/44664628/haskell-esqueleto-update-with-join", "title": "Haskell Esqueleto - update with join", "body": "<p>Can I make an update query with join in Haskell? Maybe something like this:</p>\n\n<pre><code>putPromotionInStoreItemsFromStoreBySItemId :: SItemId -&gt; SItemPromoId -&gt; YesodDB App ()\nputPromotionInStoreItemsFromStoreBySItemId siId pId = update $ \\(si `InnerJoin` s `InnerJoin` ssi) -&gt; do\n  on $ ssi ^. SItemStore ==. s ^. StoreId\n  on $ s ^. StoreId ==. si ^. SItemStore\n  set ssi [ SItemPromotion =. val pId ]\n  where_ $     si ^. SItemId ==. val siId \n           &amp;&amp;. isNothing (ssi ^. SItemDisabled)\n</code></pre>\n"}, {"tags": ["haskell", "llvm", "ghc"], "answers": [{"tags": [], "owner": {"reputation": 62421, "user_id": 216164, "user_type": "registered", "accept_rate": 89, "profile_image": "https://www.gravatar.com/avatar/786f224adbe0784cdf7d0f15476061fe?s=128&d=identicon&r=PG", "display_name": "Thomas M. DuBuisson", "link": "https://stackoverflow.com/users/216164/thomas-m-dubuisson"}, "is_accepted": false, "score": 0, "last_activity_date": 1498018769, "creation_date": 1498018769, "answer_id": 44666829, "question_id": 44664490, "link": "https://stackoverflow.com/questions/44664490/cant-build-text-package-with-llvm-backend/44666829#44666829", "title": "Can&#39;t build &#39;text&#39; package with llvm backend", "body": "<p>On an OS-X system using llvm 3.7 and GHC 8.0.2 I was able to (in a temp directory):</p>\n\n<pre><code>cabal sandbox init\ncabal install text-1.2.2.2 --ghc-options=\"-fllvm -pgmlo opt -pgmlc llc -optlc-O4 -v -keep-llvm-files -keep-tmp-files\"\n</code></pre>\n\n<p>Which yielded significant text ending with:</p>\n\n<pre><code>...\nCreated temporary directory: /var/folders/0x/hlxcgy9n5714ryp0gkn5hkmm0000gp/T/ghc6374_0\n*** C Compiler:\n/usr/bin/gcc -m64 -fno-stack-protector -DTABLES_NEXT_TO_CODE -x c /var/folders/0x/hlxcgy9n5714ryp0gkn5hkmm0000gp/T/16807282475249.c -o /var/f\nolders/0x/hlxcgy9n5714ryp0gkn5hkmm0000gp/T/ghc6374_0/ghc_1.s -fno-common -U__PIC__ -D__PIC__ -Wimplicit -S '-D__GLASGOW_HASKELL__=800' -inclu\nde /usr/local/lib/ghc-8.0.2/include/ghcversion.h -I/usr/local/lib/ghc-8.0.2/base-4.9.1.0/include -I/usr/local/lib/ghc-8.0.2/integer-gmp-1.0.0\n.1/include -I/usr/local/lib/ghc-8.0.2/include\n*** Clang (Assembler):\nclang -m64 -fno-stack-protector -DTABLES_NEXT_TO_CODE -fno-common -U__PIC__ -D__PIC__ -Qunused-arguments -x assembler -c /var/folders/0x/hlxc\ngy9n5714ryp0gkn5hkmm0000gp/T/ghc6374_0/ghc_1.s -o /var/folders/0x/hlxcgy9n5714ryp0gkn5hkmm0000gp/T/1622650073984943658.o\nResolving dependencies...\nNotice: installing into a sandbox located at /private/tmp/x/.cabal-sandbox\nConfiguring text-1.2.2.2...\nBuilding text-1.2.2.2...\nInstalled text-1.2.2.2\ncabal install text-1.2.2.2   218.77s user 8.27s system 98% cpu 3:49.67 total\n</code></pre>\n\n<p>So in short this is a non-reproduceable (by me) platform/tooling issue.  I suggest you try GHC 8.0.2 since 8.0.1 is, well, lesser.  It might also be worth glancing at the windows-specific bugs on the GHC trac.</p>\n"}], "owner": {"reputation": 1117, "user_id": 1641035, "user_type": "registered", "accept_rate": 76, "profile_image": "https://www.gravatar.com/avatar/b63d948c23003346549369112f336519?s=128&d=identicon&r=PG", "display_name": "Alexey Vagarenko", "link": "https://stackoverflow.com/users/1641035/alexey-vagarenko"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 72, "favorite_count": 0, "answer_count": 1, "score": 0, "last_activity_date": 1498018769, "creation_date": 1498001032, "last_edit_date": 1498001693, "question_id": 44664490, "link": "https://stackoverflow.com/questions/44664490/cant-build-text-package-with-llvm-backend", "title": "Can&#39;t build &#39;text&#39; package with llvm backend", "body": "<p>I have ghc-8.0.1 and llvm-3.7.0 both 64bit. I'm trying to install 'text' package like this:</p>\n\n<pre><code>cabal install text-1.2.2.2 --ghc-options=\"-fllvm -pgmlo opt -pgmlc llc -optlc-O4 -v -keep-llvm-files -keep-tmp-files\"\n</code></pre>\n\n<p>It fails with the following message:</p>\n\n<pre><code>*** Assembler:\n\"C:\\Program Files\\Haskell Platform\\8.0.1\\lib/../mingw/bin/gcc.exe\" \"-fno-stack-protector\" \"-DTABLES_NEXT_TO_CODE\" \"-I.\\Data\\Text\" \"-Idist/dist-sandbox-a883bd5e\\build\" \"-Idist/dist-sandbox-a883bd5e\\build\" \"-Idist/dist-sandbox-a883bd5e\\build\\autogen\" \"-Idist/dist-sandbox-a883bd5e\\build\" \"-Iinclude\" \"-IC:\\Program Files\\Haskell Platform\\8.0.1\\mingw\\include\" \"-x\" \"assembler\" \"-c\" \"C:\\Users\\alex\\AppData\\Local\\Temp\\ghc7728_0\\ghc_190.s\" \"-o\" \"dist/dist-sandbox-a883bd5e\\build\\Data\\Text\\Read.o\"\nC:\\Users\\alex\\AppData\\Local\\Temp\\ghc7728_0\\ghc_190.s: Assembler messages:\nC:\\Users\\alex\\AppData\\Local\\Temp\\ghc7728_0\\ghc_190.s:29453: Error: junk at end of line, first unrecognized character is `,'\nC:\\Users\\alex\\AppData\\Local\\Temp\\ghc7728_0\\ghc_190.s:29490: Error: junk at end of line, first unrecognized character is `,'\nC:\\Users\\alex\\AppData\\Local\\Temp\\ghc7728_0\\ghc_190.s:29539: Error: junk at end of line, first unrecognized character is `,'\n`gcc.exe' failed in phase `Assembler'. (Exit code: 1)\ncabal: Leaving directory 'C:\\Users\\alex\\AppData\\Local\\Temp\\cabal-tmp-9212\\text-1.2.2.2'\ncabal: Error: some packages failed to install:\ntext-1.2.2.2 failed during the building phase. The exception was:\nExitFailure 1\n</code></pre>\n\n<p>and <code>C:\\Users\\alex\\AppData\\Local\\Temp\\ghc7728_0\\ghc_190.s</code> file contains:</p>\n\n<p>near line 29453:</p>\n\n<pre><code>29442:  c4pto_info$def:\n29443:  # BB#0:                                 # %c4pto\n29444:      movsd   %xmm1, 32(%rbp)\n29445:      addq    $8, %rbp\n29446:      rex64 jmp   c4ppb_entry$def # TAILCALL\n29447:  \n29448:      .def     c4prM_info$def;\n29449:      .scl    3;\n29450:      .type   32;\n29451:      .endef\n29452:      .globl  __real@4024000000000000\n29453:      .section    .rdata,\"dr\",discard,__real@4024000000000000\n29454:      .align  8\n29455:  __real@4024000000000000:\n29456:      .quad   4621819117588971520     # double 10\n29457:      .text\n29458:      .align  16, 0x90\n29459:      .quad   (S470B_srt$def-c4prM_info$def)+1024 # @\"c4prM_info$def\"\n29460:      .quad   1925                    # 0x785\n29461:      .quad   4294967328              # 0x100000020\n29462:  c4prM_info$def:\n</code></pre>\n\n<p>near line 29490:</p>\n\n<pre><code>29479:  .LBB697_4:                              # %u4pwu\n29480:      addq    $48, %rbp\n29481:      movq    textzm1zi2zi2zi2zm9RlRQEEESJb1LT1TjepTtH_DataziTextziRead_zdszc1_closure$def(%rip), %rax\n29482:      movl    $textzm1zi2zi2zi2zm9RlRQEEESJb1LT1TjepTtH_DataziTextziRead_zdszc1_closure$def, %ebx\n29483:      rex64 jmpq  *%rax           # TAILCALL\n29484:  \n29485:      .def     c4psR_info$def;\n29486:      .scl    3;\n29487:      .type   32;\n29488:      .endef\n29489:      .globl  __xmm@80000000000000008000000000000000\n29490:      .section    .rdata,\"dr\",discard,__xmm@80000000000000008000000000000000\n29491:      .align  16\n29492:  __xmm@80000000000000008000000000000000:\n29493:      .quad   -9223372036854775808    # 0x8000000000000000\n29494:      .quad   -9223372036854775808    # 0x8000000000000000\n29495:      .text\n29496:      .align  16, 0x90\n29497:      .quad   1925                    # @\"c4psR_info$def\"\n29498:                                          # 0x785\n29499:      .quad   32                      # 0x20\n29500:  c4psR_info$def:\n</code></pre>\n\n<p>near line 29539:</p>\n\n<pre><code>29521:    .LBB698_4:                              # %c4ptk\n29522:      movq    $ghczmprim_GHCziTuple_Z2T_con_info, 24(%rax)\n29523:      leaq    -47(%r12), %rdx\n29524:      movq    %rdx, 32(%rax)\n29525:      movq    %rcx, 40(%rax)\n29526:      movq    $base_DataziEither_Right_con_info, 48(%rax)\n29527:      leaq    -31(%r12), %rcx\n29528:      movq    %rcx, 56(%rax)\n29529:      movq    48(%rbp), %rax\n29530:      addq    $48, %rbp\n29531:      leaq    -6(%r12), %rbx\n29532:      rex64 jmpq  *%rax           # TAILCALL\n29533:    \n29534:      .def     c4ps8_info$def;\n29535:      .scl    3;\n29536:      .type   32;\n29537:      .endef\n29538:      .globl  __real@3ff0000000000000\n29539:      .section    .rdata,\"dr\",discard,__real@3ff0000000000000\n29540:      .align  8\n29541:    __real@3ff0000000000000:\n29542:      .quad   4607182418800017408     # double 1\n29543:      .text\n29544:      .align  16, 0x90\n29545:      .quad   1925                    # @\"c4ps8_info$def\"\n29546:                                            # 0x785\n29547:      .quad   32                      # 0x20\n29548:    c4ps8_info$def:\n</code></pre>\n\n<p>I installed other packages with llvm backend, so far only 'text' fails.</p>\n"}, {"tags": ["haskell", "optimization", "haskell-pipes"], "comments": [{"owner": {"reputation": 37219, "user_id": 1523776, "user_type": "moderator", "accept_rate": 87, "profile_image": "https://www.gravatar.com/avatar/b3e0b5c8e42a8c38009ef2d969f8dabb?s=128&d=identicon&r=PG", "display_name": "Benjamin Hodgson", "link": "https://stackoverflow.com/users/1523776/benjamin-hodgson"}, "edited": false, "score": 0, "creation_date": 1498002687, "post_id": 44660738, "comment_id": 76314931, "body": "I&#39;m not an expert in this, so take the following with the requisite quantity of salt: It looks like arrays are taking up most of your heap. How many unique accounts are there in your input file? Every time you encounter a new account, <code>Vector.snoc</code> has to copy the whole array and make the old one into garbage. Have you tried loading your account IDs into a data structure with a cheap &#39;add&#39; (eg <code>[]</code>, <code>Seq</code>, or some variety of mutable growable array)?"}, {"owner": {"reputation": 14582, "user_id": 2225384, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/f30b04ed4d0b3fc4bc791a28815f34ca?s=128&d=identicon&r=PG", "display_name": "Rein Henrichs", "link": "https://stackoverflow.com/users/2225384/rein-henrichs"}, "edited": false, "score": 0, "creation_date": 1498006433, "post_id": 44660738, "comment_id": 76315727, "body": "Following up on that, I think just using a list and <code>fromList . reverse</code> after folding would help. Vectors are not designed for efficient cons or snoc."}, {"owner": {"reputation": 487, "user_id": 30154, "user_type": "registered", "accept_rate": 67, "profile_image": "https://www.gravatar.com/avatar/753f1ed8a3523d8eda77225f71d65cee?s=128&d=identicon&r=PG", "display_name": "Adam Flott", "link": "https://stackoverflow.com/users/30154/adam-flott"}, "reply_to_user": {"reputation": 37219, "user_id": 1523776, "user_type": "moderator", "accept_rate": 87, "profile_image": "https://www.gravatar.com/avatar/b3e0b5c8e42a8c38009ef2d969f8dabb?s=128&d=identicon&r=PG", "display_name": "Benjamin Hodgson", "link": "https://stackoverflow.com/users/1523776/benjamin-hodgson"}, "edited": false, "score": 0, "creation_date": 1498144723, "post_id": 44660738, "comment_id": 76389780, "body": "@BenjaminHodgson I tried <code>[]</code> but that raised the memory a little (~10-20MB depending on using <code>-c</code> or not. I left a comment with what is likely the best I can do"}], "answers": [{"tags": [], "owner": {"reputation": 487, "user_id": 30154, "user_type": "registered", "accept_rate": 67, "profile_image": "https://www.gravatar.com/avatar/753f1ed8a3523d8eda77225f71d65cee?s=128&d=identicon&r=PG", "display_name": "Adam Flott", "link": "https://stackoverflow.com/users/30154/adam-flott"}, "is_accepted": false, "score": 0, "last_activity_date": 1498144505, "creation_date": 1498144505, "answer_id": 44703364, "question_id": 44660738, "link": "https://stackoverflow.com/questions/44660738/optimizing-memory-in-haskell-pipes-attoparsec-and-containers/44703364#44703364", "title": "Optimizing Memory in Haskell, pipes, attoparsec, and containers", "body": "<p>If I,</p>\n\n<ul>\n<li>remove the intermediate look up cache</li>\n<li>use a <code>HashMap Text (Set Word32)</code></li>\n<li>turn on in place compaction <code>+RTS -c</code></li>\n</ul>\n\n<p>I can get the total memory down to 34 MB, but my lookups now go to O(n). This is likely the best I'm going to get.</p>\n\n<pre><code>{-# LANGUAGE RankNTypes #-}\n{-# LANGUAGE OverloadedStrings #-}\n{-# LANGUAGE NoImplicitPrelude #-}\n\nimport           Protolude hiding (for)\n\nimport qualified Data.Attoparsec.ByteString.Char8 as AB\nimport           Data.HashMap.Strict (HashMap)\nimport qualified Data.HashMap.Strict as HashMap\nimport           Data.Set (Set)\nimport qualified Data.Set as Set\nimport           Pipes\nimport qualified Pipes.Attoparsec as PA\nimport qualified Pipes.ByteString as PB\nimport           Pipes.Parse\nimport           Pipes.Safe (MonadSafe, runSafeT)\nimport qualified Pipes.Safe.Prelude as PSP\n\n-- accountid|account-name|contractid|code\n\ndata AccountLine = AccountLine {\n    _accountId         :: !ByteString,\n    _accountName       :: !ByteString,\n    _accountContractId :: !ByteString,\n    _accountCode       :: !Word32\n    } deriving (Show)\n\n\nnewtype Accounts = Accounts (HashMap Text (Set Word32))\n                 deriving (Show)\n\nparseAccountLine :: AB.Parser AccountLine\nparseAccountLine = AccountLine &lt;$&gt;\n    getSubfield &lt;* delim &lt;*&gt;\n    getSubfield &lt;* delim &lt;*&gt;\n    getSubfield &lt;* delim &lt;*&gt;\n    AB.decimal &lt;* AB.endOfLine\n    where getSubfield = AB.takeTill (== '|')\n          delim = AB.char '|'\n\n--\n\naempty :: Accounts\naempty = Accounts HashMap.empty\n\naappend :: Accounts -&gt; AccountLine -&gt; Accounts\naappend (Accounts cps) (AccountLine aid an cid cp) =\n    case HashMap.lookup (toS aid) cps of\n        Nothing  -&gt; Accounts (HashMap.insert (toS aid) (Set.singleton cp) cps)\n        Just value -&gt; Accounts (HashMap.update (\\codes -&gt; Just (Set.insert cp value)) (toS aid) cps)\n\nfoldAccounts :: (Monad m) =&gt; Parser AccountLine m Accounts\nfoldAccounts = foldAll aappend aempty identity\n\nreadByteStringFile :: (MonadSafe m) =&gt; FilePath -&gt; Producer' ByteString m ()\nreadByteStringFile file = PSP.withFile file ReadMode PB.fromHandle\n\naccountLines :: Text -&gt; MonadSafe m =&gt; Producer AccountLine m (Either (PA.ParsingError, Producer ByteString m ()) ())\naccountLines filename = PA.parsed parseAccountLine (readByteStringFile (toS filename))\n\n\nmain :: IO ()\nmain = do\n    [filename] &lt;- getArgs\n    x &lt;- runSafeT $ runEffect $ Pipes.Parse.evalStateT foldAccounts (accountLines (toS filename))\n\n    print $ sizes x\n\n    -- print x\n    print $ lookupAccountFromCode x 254741\n    print $ lookupAccountFromCode x 196939\n\n\nsizes :: Accounts -&gt; Int\nsizes (Accounts acp) = HashMap.size acp\n\nlookupAccountFromCode :: Accounts -&gt; Word32 -&gt; Maybe Text\nlookupAccountFromCode (Accounts accts) cp = do\n    let f a k v = bool a (Just k) (Set.member cp v)\n    HashMap.foldlWithKey' f Nothing accts\n</code></pre>\n\n<p>And running</p>\n\n<pre><code>$ ./account-parser /tmp/accounts +RTS -s -c\n5837\nJust \"1-PCECJ5\"\nJust \"AANA-76KOUU\"\n   1,652,177,904 bytes allocated in the heap\n      83,767,440 bytes copied during GC\n      17,563,800 bytes maximum residency (18 sample(s))\n         751,144 bytes maximum slop\n              34 MB total memory in use (0 MB lost due to fragmentation)\n\n                                     Tot time (elapsed)  Avg pause  Max pause\n  Gen  0      3083 colls,     0 par    0.058s   0.069s     0.0000s    0.0002s\n  Gen  1        18 colls,     0 par    0.115s   0.151s     0.0084s    0.0317s\n\n  TASKS: 4 (1 bound, 3 peak workers (3 total), using -N1)\n\n  SPARKS: 0 (0 converted, 0 overflowed, 0 dud, 0 GC'd, 0 fizzled)\n\n  INIT    time    0.000s  (  0.002s elapsed)\n  MUT     time    0.263s  (  0.289s elapsed)\n  GC      time    0.173s  (  0.219s elapsed)\n  EXIT    time    0.009s  (  0.008s elapsed)\n  Total   time    0.445s  (  0.518s elapsed)\n\n  Alloc rate    6,286,682,587 bytes per MUT second\n\n  Productivity  61.0% of total user, 57.4% of total elapsed\n\ngc_alloc_block_sync: 0\nwhitehole_spin: 0\ngen[0].sync: 0\ngen[1].sync: 0\n</code></pre>\n"}], "owner": {"reputation": 487, "user_id": 30154, "user_type": "registered", "accept_rate": 67, "profile_image": "https://www.gravatar.com/avatar/753f1ed8a3523d8eda77225f71d65cee?s=128&d=identicon&r=PG", "display_name": "Adam Flott", "link": "https://stackoverflow.com/users/30154/adam-flott"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 157, "favorite_count": 0, "answer_count": 1, "score": 5, "last_activity_date": 1498144505, "creation_date": 1497984014, "question_id": 44660738, "link": "https://stackoverflow.com/questions/44660738/optimizing-memory-in-haskell-pipes-attoparsec-and-containers", "title": "Optimizing Memory in Haskell, pipes, attoparsec, and containers", "body": "<p>I'm trying to further optimize my pipes-attoparsec parser and storage, but having trouble getting memory usage any lower.</p>\n\n<p>Given account-parser.hs</p>\n\n<pre><code>{-# LANGUAGE RankNTypes #-}\n{-# LANGUAGE OverloadedStrings #-}\n{-# LANGUAGE NoImplicitPrelude #-}\n\nimport Protolude hiding (for)\n\nimport Data.Hashable\nimport Data.IntMap.Strict (IntMap)\nimport Data.Vector (Vector)\nimport Pipes\nimport Pipes.Parse\nimport Pipes.Safe (MonadSafe, runSafeT)\nimport qualified Data.Attoparsec.ByteString.Char8 as AB\nimport qualified Data.IntMap.Strict as IM\nimport qualified Data.Vector as Vector\nimport qualified Pipes.Attoparsec as PA\nimport qualified Pipes.ByteString as PB\nimport qualified Pipes.Safe.Prelude as PSP\n\n-- accountid|account-name|contractid|code\n\ndata AccountLine = AccountLine {\n    _accountId         :: !ByteString,\n    _accountName       :: !ByteString,\n    _accountContractId :: !ByteString,\n    _accountCode       :: !Word32\n    } deriving (Show)\n\ntype MapCodetoAccountIdIdx = IntMap Int\n\ndata Accounts = Accounts {\n    _accountIds   :: !(Vector ByteString),\n    _cache        :: !(IntMap Int),\n    _accountCodes :: !MapCodetoAccountIdIdx\n    } deriving (Show)\n\n\nparseAccountLine :: AB.Parser AccountLine\nparseAccountLine = AccountLine &lt;$&gt;\n    getSubfield &lt;* delim &lt;*&gt;\n    getSubfield &lt;* delim &lt;*&gt;\n    getSubfield &lt;* delim &lt;*&gt;\n    AB.decimal &lt;* AB.endOfLine\n    where getSubfield = AB.takeTill (== '|')\n          delim = AB.char '|'\n\n--\n\naempty :: Accounts\naempty = Accounts Vector.empty IM.empty IM.empty\n\naappend :: Accounts -&gt; AccountLine -&gt; Accounts\naappend (Accounts ids a2i cps) (AccountLine aid an cid cp) =\n    case IM.lookup (hash aid) a2i of\n        Nothing -&gt; Accounts\n                (Vector.snoc ids (toS aid))\n                (IM.insert (hash aid) (length ids) a2i)\n                (IM.insert (fromIntegral cp) (length ids) cps)\n        Just idx -&gt; Accounts ids a2i (IM.insert (fromIntegral cp) idx cps)\n\nfoldAccounts :: (Monad m) =&gt; Parser AccountLine m Accounts\nfoldAccounts = foldAll aappend aempty identity\n\nreadByteStringFile :: (MonadSafe m) =&gt; FilePath -&gt; Producer' ByteString m ()\nreadByteStringFile file = PSP.withFile file ReadMode PB.fromHandle\n\naccountLines :: Text -&gt; MonadSafe m =&gt; Producer AccountLine m (Either (PA.ParsingError, Producer ByteString m ()) ())\naccountLines filename = PA.parsed parseAccountLine (readByteStringFile (toS filename))\n\n\nmain :: IO ()\nmain = do\n    [filename] &lt;- getArgs\n    x &lt;- runSafeT $ runEffect $ Pipes.Parse.evalStateT foldAccounts (accountLines (toS filename))\n\n    print $ sizes x\n\nsizes :: Accounts -&gt; (Int, Int, Int)\nsizes (Accounts aid xxx acp) = (Vector.length aid, IM.size xxx, IM.size acp)\n</code></pre>\n\n<p>Compiled with GHC 8.0.2 (<code>stack ghc -- -O2 -rtsopts -threaded -Wall account-parser.hs</code>)</p>\n\n<p>I can't get the memory usage any lower. I have to do fast look ups hence the IntMaps. The file is around 20 MB (and not efficient). Most of the data should be able to fit in 5 MB.</p>\n\n<pre><code>$ ./account-parser /tmp/accounts +RTS -s\n(5837,5837,373998)\n   1,631,040,680 bytes allocated in the heap\n     221,765,464 bytes copied during GC\n      41,709,048 bytes maximum residency (13 sample(s))\n       2,512,560 bytes maximum slop\n              82 MB total memory in use (0 MB lost due to fragmentation)\n\n                                     Tot time (elapsed)  Avg pause  Max pause\n  Gen  0      2754 colls,     0 par    0.105s   0.142s     0.0001s    0.0002s\n  Gen  1        13 colls,     0 par    0.066s   0.074s     0.0057s    0.0216s\n\n  TASKS: 4 (1 bound, 3 peak workers (3 total), using -N1)\n\n  SPARKS: 0 (0 converted, 0 overflowed, 0 dud, 0 GC'd, 0 fizzled)\n\n  INIT    time    0.000s  (  0.001s elapsed)\n  MUT     time    0.324s  (  0.298s elapsed)\n  GC      time    0.171s  (  0.216s elapsed)\n  EXIT    time    0.000s  (  0.005s elapsed)\n  Total   time    0.495s  (  0.520s elapsed)\n\n  Alloc rate    5,026,660,297 bytes per MUT second\n\n  Productivity  65.5% of total user, 58.4% of total elapsed\n\ngc_alloc_block_sync: 0\nwhitehole_spin: 0\ngen[0].sync: 0\ngen[1].sync: 0\n</code></pre>\n\n<p>And the profile:</p>\n\n<p><a href=\"https://i.stack.imgur.com/SK47u.png\" rel=\"noreferrer\"><img src=\"https://i.stack.imgur.com/SK47u.png\" alt=\"enter image description here\"></a></p>\n"}, {"tags": ["haskell"], "comments": [{"owner": {"reputation": 208473, "user_id": 126014, "user_type": "registered", "accept_rate": 86, "profile_image": "https://www.gravatar.com/avatar/33526616d4a11f1630d4939b769cfbf9?s=128&d=identicon&r=PG", "display_name": "Mark Seemann", "link": "https://stackoverflow.com/users/126014/mark-seemann"}, "edited": false, "score": 0, "creation_date": 1497971085, "post_id": 44656494, "comment_id": 76298761, "body": "Sounds like you&#39;re looking for <a href=\"https://en.wikipedia.org/wiki/Dependent_type\" rel=\"nofollow noreferrer\">dependent types</a>, which, AFAIK, isn&#39;t part of &#39;standard&#39; Haskell."}, {"owner": {"reputation": 16233, "user_id": 4253229, "user_type": "registered", "accept_rate": 83, "profile_image": "https://lh4.googleusercontent.com/-e2FAQvlj5CQ/AAAAAAAAAAI/AAAAAAAAAqM/TlSnekirgNE/photo.jpg?sz=128", "display_name": "Eugene Sh.", "link": "https://stackoverflow.com/users/4253229/eugene-sh"}, "edited": false, "score": 0, "creation_date": 1497971169, "post_id": 44656494, "comment_id": 76298826, "body": "Take a look here: <a href=\"https://hackage.haskell.org/package/fixed-list-0.1.6/docs/Data-FixedList.html\" rel=\"nofollow noreferrer\">hackage.haskell.org/package/fixed-list-0.1.6/docs/&hellip;</a>"}, {"owner": {"reputation": 457, "user_id": 5712332, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/59caad12b4a40c5f12f695814683cb92?s=128&d=identicon&r=PG&f=1", "display_name": "JohnW", "link": "https://stackoverflow.com/users/5712332/johnw"}, "edited": false, "score": 0, "creation_date": 1497971381, "post_id": 44656494, "comment_id": 76298955, "body": "Amazing! Such flexibility. That gives me ideas! Thanks."}], "answers": [{"comments": [{"owner": {"reputation": 457, "user_id": 5712332, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/59caad12b4a40c5f12f695814683cb92?s=128&d=identicon&r=PG&f=1", "display_name": "JohnW", "link": "https://stackoverflow.com/users/5712332/johnw"}, "edited": false, "score": 0, "creation_date": 1497971715, "post_id": 44656822, "comment_id": 76299212, "body": "Could you also cite @Eugene_Sh. comment for fixed-length lists? Then I&#39;ll accept your answer. :)"}, {"owner": {"reputation": 100892, "user_id": 745903, "user_type": "registered", "accept_rate": 74, "profile_image": "https://www.gravatar.com/avatar/50933f6638836741e620669b3940410e?s=128&d=identicon&r=PG", "display_name": "leftaroundabout", "link": "https://stackoverflow.com/users/745903/leftaroundabout"}, "reply_to_user": {"reputation": 457, "user_id": 5712332, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/59caad12b4a40c5f12f695814683cb92?s=128&d=identicon&r=PG&f=1", "display_name": "JohnW", "link": "https://stackoverflow.com/users/5712332/johnw"}, "edited": false, "score": 0, "creation_date": 1497972000, "post_id": 44656822, "comment_id": 76299410, "body": "Such fixed-length lists gain you absolutely nothing useful for your application. After all, your question is not really about single-element-constricted lists but about <i>syntax with square brackets</i>."}, {"owner": {"reputation": 457, "user_id": 5712332, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/59caad12b4a40c5f12f695814683cb92?s=128&d=identicon&r=PG&f=1", "display_name": "JohnW", "link": "https://stackoverflow.com/users/5712332/johnw"}, "edited": false, "score": 0, "creation_date": 1497972642, "post_id": 44656822, "comment_id": 76299882, "body": "Hum, yes and no... It has more to do with the type system, really. I just came up with that (real) example thinking &quot;oh, that notation is neat, would it be possible to (ab)use Haskell type system in such a way?&quot;. So, while I understand that it makes no sense from a programming perspective, It is much much much easier to reason about such a simple case rather than real life, complex, cases where using fixed-length lists would actually make sense. That being said, what you wrote obviously makes sense."}, {"owner": {"reputation": 100892, "user_id": 745903, "user_type": "registered", "accept_rate": 74, "profile_image": "https://www.gravatar.com/avatar/50933f6638836741e620669b3940410e?s=128&d=identicon&r=PG", "display_name": "leftaroundabout", "link": "https://stackoverflow.com/users/745903/leftaroundabout"}, "reply_to_user": {"reputation": 457, "user_id": 5712332, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/59caad12b4a40c5f12f695814683cb92?s=128&d=identicon&r=PG&f=1", "display_name": "JohnW", "link": "https://stackoverflow.com/users/5712332/johnw"}, "edited": false, "score": 0, "creation_date": 1497973199, "post_id": 44656822, "comment_id": 76300273, "body": "Well, Haskell&#39;s syntax is flexible, but certain things are hardbaked, including that <code>[]</code> is for lists (or, with the <a href=\"https://downloads.haskell.org/~ghc/latest/docs/html/users_guide/glasgow_exts.html?highlight=overloadedlists#ghc-flag--XOverloadedLists\" rel=\"nofollow noreferrer\"><code>OverloadedLists</code> extension</a>, list-like types such as arrays). If you want to use square-bracket syntax for something entirely different, you&#39;ll need a different syntactic environment. You can write a parser for that with e.g. <a href=\"http://hackage.haskell.org/package/megaparsec\" rel=\"nofollow noreferrer\">megaparsec</a>, and embed it in your Haskell file with a QuasiQuote."}, {"owner": {"reputation": 100892, "user_id": 745903, "user_type": "registered", "accept_rate": 74, "profile_image": "https://www.gravatar.com/avatar/50933f6638836741e620669b3940410e?s=128&d=identicon&r=PG", "display_name": "leftaroundabout", "link": "https://stackoverflow.com/users/745903/leftaroundabout"}, "reply_to_user": {"reputation": 457, "user_id": 5712332, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/59caad12b4a40c5f12f695814683cb92?s=128&d=identicon&r=PG&f=1", "display_name": "JohnW", "link": "https://stackoverflow.com/users/5712332/johnw"}, "edited": false, "score": 1, "creation_date": 1497973468, "post_id": 44656822, "comment_id": 76300454, "body": "Incidentally, you <i>could</i> abuse <code>OverloadedLists</code> to write <code>[0] :: KeyWord</code>, but this would lead to runtime errors when somebody writes <code>macKey [] 2</code> or <code>macKey [32,542] 3</code>."}], "tags": [], "owner": {"reputation": 100892, "user_id": 745903, "user_type": "registered", "accept_rate": 74, "profile_image": "https://www.gravatar.com/avatar/50933f6638836741e620669b3940410e?s=128&d=identicon&r=PG", "display_name": "leftaroundabout", "link": "https://stackoverflow.com/users/745903/leftaroundabout"}, "is_accepted": true, "score": 3, "last_activity_date": 1497971572, "last_edit_date": 1497971572, "creation_date": 1497971387, "answer_id": 44656822, "question_id": 44656494, "link": "https://stackoverflow.com/questions/44656494/how-to-craft-a-type-matching-a-list-with-a-single-element-of-type-int/44656822#44656822", "title": "How to craft a type matching &quot;a list with a single element of type Int&quot;?", "body": "<p>As you've observed yourself, <em>a single <code>Int</code></em> does exactly what's needed and is probably the way to go. Don't use a list if you don't <em>want</em> a list!</p>\n\n<p>That said, using a plain <code>Int</code> may not be the best thing either. Perhaps you want to be clear what's the meaning of each argument. You might for that purpose make an alias for <code>Int</code> and call it accordingly:</p>\n\n<pre><code>newtype KeyWord = KeyWord Int\n\nmacKey :: KeyWord -&gt; Int -&gt; MAC\n</code></pre>\n\n<p>In this case the syntax at the call site would then be <code>macKey (KeyWord 0) 5</code>.</p>\n\n<p>It would be possible to shorten that a bit more, but it's probably not worth it. In fact, even the <code>newtype</code> is probably overkill \u2013 the main benefit is that the type signature becomes more explicit, but for calling the function this is mostly boilerplate. A simple type-alias is probably enough:</p>\n\n<pre><code>type KeyWord = Int\n</code></pre>\n\n<p>and then you can again write <code>macKey 0 5</code> while retaining the clear signature.</p>\n\n<p>If you need to write out lots of those keys in a concise manner, you might consider making <code>macKey</code> and infix operator:</p>\n\n<pre><code>infix 7 #*\n(#*) :: KeyWord -&gt; Int -&gt; MAC\n</code></pre>\n\n<p>and then write <code>0#*5</code>.</p>\n"}], "owner": {"reputation": 457, "user_id": 5712332, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/59caad12b4a40c5f12f695814683cb92?s=128&d=identicon&r=PG&f=1", "display_name": "JohnW", "link": "https://stackoverflow.com/users/5712332/johnw"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 82, "favorite_count": 0, "accepted_answer_id": 44656822, "answer_count": 1, "score": 1, "last_activity_date": 1497971572, "creation_date": 1497970476, "last_edit_date": 1497971014, "question_id": 44656494, "link": "https://stackoverflow.com/questions/44656494/how-to-craft-a-type-matching-a-list-with-a-single-element-of-type-int", "title": "How to craft a type matching &quot;a list with a single element of type Int&quot;?", "body": "<p>I am currently writing my very first program in Haskell.</p>\n\n<p>In the specification I am working with, <code>[0] 5</code> is used to define a MAC key that could be written <code>\"\\x00\\x00\\x00\\x00\\x00\"::ByteString</code>.</p>\n\n<p>I somewhat fancy the idea of reusing that notation (even though it makes very little sense from a programming perspective). Eventually writing <code>mackey</code> so that <code>mackey [0] 5</code> does the right thing was simple enough.</p>\n\n<p>The only question that remains is how to <em>define my input type</em> so that it <em>enforces</em> the use of a list with a <strong>single</strong> <em>integer element</em>. Is that even possible?</p>\n\n<hr>\n\n<p>NB: normally, I wouldn't bother too much about that. I shouldn't even use a list in such case: a simple <code>Int</code> would be enough and \"enforce\" everything I need; so I know that the correct way is to use a simple integer. But this is a very good way to explore what can be done (or not) with Haskell type system. :)</p>\n"}, {"tags": ["haskell", "list-comprehension"], "comments": [{"owner": {"reputation": 100892, "user_id": 745903, "user_type": "registered", "accept_rate": 74, "profile_image": "https://www.gravatar.com/avatar/50933f6638836741e620669b3940410e?s=128&d=identicon&r=PG", "display_name": "leftaroundabout", "link": "https://stackoverflow.com/users/745903/leftaroundabout"}, "edited": false, "score": 2, "creation_date": 1497963799, "post_id": 44653785, "comment_id": 76292889, "body": "Have you tried manually expanding, say, <code>func [1,3,5]</code>?"}, {"owner": {"reputation": 105, "user_id": 7840796, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/2818b0fb3eac8429660315340630b396?s=128&d=identicon&r=PG&f=1", "display_name": "onur cevik", "link": "https://stackoverflow.com/users/7840796/onur-cevik"}, "reply_to_user": {"reputation": 100892, "user_id": 745903, "user_type": "registered", "accept_rate": 74, "profile_image": "https://www.gravatar.com/avatar/50933f6638836741e620669b3940410e?s=128&d=identicon&r=PG", "display_name": "leftaroundabout", "link": "https://stackoverflow.com/users/745903/leftaroundabout"}, "edited": false, "score": 0, "creation_date": 1497964218, "post_id": 44653785, "comment_id": 76293233, "body": "@leftaroundabout yes i tried variety of parameters."}, {"owner": {"reputation": 100892, "user_id": 745903, "user_type": "registered", "accept_rate": 74, "profile_image": "https://www.gravatar.com/avatar/50933f6638836741e620669b3940410e?s=128&d=identicon&r=PG", "display_name": "leftaroundabout", "link": "https://stackoverflow.com/users/745903/leftaroundabout"}, "edited": false, "score": 2, "creation_date": 1497964613, "post_id": 44653785, "comment_id": 76293553, "body": "So what have you not understood? For future questions, please show how you expanded this so we can spots misunderstandings / errors."}], "answers": [{"tags": [], "owner": {"reputation": 100185, "user_id": 3234959, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/93bb12ca0f93dfddb33880316f7e66c2?s=128&d=identicon&r=PG&f=1", "display_name": "chi", "link": "https://stackoverflow.com/users/3234959/chi"}, "is_accepted": true, "score": 4, "last_activity_date": 1497963897, "creation_date": 1497963897, "answer_id": 44653896, "question_id": 44653785, "link": "https://stackoverflow.com/questions/44653785/can-you-please-explain-what-this-haskell-list-comprehension-example-do/44653896#44653896", "title": "Can you please explain what this Haskell List Comprehension example do?", "body": "<p><code>[n+x|x&lt;-ns]</code> is the list obtained by adding <code>n</code> to every element of <code>ns</code>. It is equivalent to <code>map (+n) ns</code>.</p>\n\n<p>Hence, we have, e.g. :</p>\n\n<pre><code>func [a,b,c,d] =\nfunc [a+b,a+c,a+d] =\nfunc [a+b+a+c,a+b+a+d] =\nfunc [a+b+a+c+a+b+a+d] =\na+b+a+c+a+b+a+d\n</code></pre>\n"}], "owner": {"reputation": 105, "user_id": 7840796, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/2818b0fb3eac8429660315340630b396?s=128&d=identicon&r=PG&f=1", "display_name": "onur cevik", "link": "https://stackoverflow.com/users/7840796/onur-cevik"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 264, "favorite_count": 0, "accepted_answer_id": 44653896, "answer_count": 1, "score": 0, "last_activity_date": 1497963897, "creation_date": 1497963601, "question_id": 44653785, "link": "https://stackoverflow.com/questions/44653785/can-you-please-explain-what-this-haskell-list-comprehension-example-do", "title": "Can you please explain what this Haskell List Comprehension example do?", "body": "<p>I was dealing with some Haskell function examples But I didn't understand this particular function. Now the function is:</p>\n\n<pre><code>func [n] = n\nfunc (n:ns) = func [n+x|x&lt;-ns]\n</code></pre>\n\n<p>I know that this is a <strong>list comprehension</strong> and i also learned that the syntax of the list comprehensions is like this :</p>\n\n<pre><code>[return-expression | elem &lt;- collection, predicate]\n</code></pre>\n\n<p>but i still couldn't figure how this function works and what does it do ? Can you please explain it?</p>\n\n<p>Also sorry for my English.</p>\n"}, {"tags": ["json", "haskell"], "comments": [{"owner": {"reputation": 2196, "user_id": 1980863, "user_type": "registered", "accept_rate": 50, "profile_image": "https://www.gravatar.com/avatar/8a9248211c4148f5d7df2269aa711e2e?s=128&d=identicon&r=PG", "display_name": "RandomB", "link": "https://stackoverflow.com/users/1980863/randomb"}, "edited": false, "score": 0, "creation_date": 1497955546, "post_id": 44650525, "comment_id": 76286670, "body": "Hm, seems that I found how to do it, so question is now, is it right: <code>maybe AT.emptyObject toJSON (x myObj)</code> where <code>AT</code> is <code>Data.Aeson.Types</code>  ?"}, {"owner": {"reputation": 46777, "user_id": 1100107, "user_type": "registered", "accept_rate": 80, "profile_image": "https://www.gravatar.com/avatar/8789d3da0b482bcd8e562bfdf3687c74?s=128&d=identicon&r=PG", "display_name": "St&#233;phane Laurent", "link": "https://stackoverflow.com/users/1100107/st%c3%a9phane-laurent"}, "edited": false, "score": 0, "creation_date": 1497958075, "post_id": 44650525, "comment_id": 76288544, "body": "There are some possible options but I don&#39;t see the one you want: <a href=\"https://hackage.haskell.org/package/aeson-1.2.1.0/docs/Data-Aeson.html#v:defaultOptions\" rel=\"nofollow noreferrer\">hackage.haskell.org/package/aeson-1.2.1.0/docs/&hellip;</a> If you found an answer please post it."}, {"owner": {"reputation": 314794, "user_id": 67579, "user_type": "registered", "accept_rate": 81, "profile_image": "https://i.stack.imgur.com/BJXub.png?s=128&g=1", "display_name": "Willem Van Onsem", "link": "https://stackoverflow.com/users/67579/willem-van-onsem"}, "edited": false, "score": 1, "creation_date": 1497968746, "post_id": 44650525, "comment_id": 76296894, "body": "@Paul-AG: If you found the answer, then it can be useful to answer your own question, such that users that later have the same problem, can find your answer."}, {"owner": {"reputation": 29444, "user_id": 3072788, "user_type": "registered", "accept_rate": 82, "profile_image": "https://www.gravatar.com/avatar/220a45c2fcff7e7358d144551b116205?s=128&d=identicon&r=PG&f=1", "display_name": "Alec", "link": "https://stackoverflow.com/users/3072788/alec"}, "edited": false, "score": 2, "creation_date": 1497969243, "post_id": 44650525, "comment_id": 76297304, "body": "I think there may be some possible ambiguity around what you mean by <code>&quot;{XXX}&quot;</code>. What if <code>X ~ Int</code>? Should you have <code>{&quot;x&quot;:{7}}</code>? That would be a malformed JSON... That said, the answer I would&#39;ve recommended is the one you suggest in your comment. Feel free to post it!"}, {"owner": {"reputation": 314794, "user_id": 67579, "user_type": "registered", "accept_rate": 81, "profile_image": "https://i.stack.imgur.com/BJXub.png?s=128&g=1", "display_name": "Willem Van Onsem", "link": "https://stackoverflow.com/users/67579/willem-van-onsem"}, "reply_to_user": {"reputation": 29444, "user_id": 3072788, "user_type": "registered", "accept_rate": 82, "profile_image": "https://www.gravatar.com/avatar/220a45c2fcff7e7358d144551b116205?s=128&d=identicon&r=PG&f=1", "display_name": "Alec", "link": "https://stackoverflow.com/users/3072788/alec"}, "edited": false, "score": 0, "creation_date": 1497969316, "post_id": 44650525, "comment_id": 76297364, "body": "@Alec: the way I understood it, was that <code>X</code> is another object with <code>ToJSON</code> support, so then it can recursively be encoded."}, {"owner": {"reputation": 29444, "user_id": 3072788, "user_type": "registered", "accept_rate": 82, "profile_image": "https://www.gravatar.com/avatar/220a45c2fcff7e7358d144551b116205?s=128&d=identicon&r=PG&f=1", "display_name": "Alec", "link": "https://stackoverflow.com/users/3072788/alec"}, "reply_to_user": {"reputation": 314794, "user_id": 67579, "user_type": "registered", "accept_rate": 81, "profile_image": "https://i.stack.imgur.com/BJXub.png?s=128&g=1", "display_name": "Willem Van Onsem", "link": "https://stackoverflow.com/users/67579/willem-van-onsem"}, "edited": false, "score": 0, "creation_date": 1498002763, "post_id": 44650525, "comment_id": 76314948, "body": "@WillemVanOnsem Of course - but that representation may not be with curly braces (as is the case for <code>X ~ Int</code>), hence the ambiguity around <code>&quot;{XXX}&quot;</code>."}, {"owner": {"reputation": 2196, "user_id": 1980863, "user_type": "registered", "accept_rate": 50, "profile_image": "https://www.gravatar.com/avatar/8a9248211c4148f5d7df2269aa711e2e?s=128&d=identicon&r=PG", "display_name": "RandomB", "link": "https://stackoverflow.com/users/1980863/randomb"}, "edited": false, "score": 0, "creation_date": 1498112885, "post_id": 44650525, "comment_id": 76366708, "body": "what I can add here, is: yes, it&#39;s possible a malformed JSON, but such JSON (or what?) wants Crucible REST API in one of its calls. I tried to use <code>null</code> instead of <code>{}</code> but it fails with 500 in this case. Even more, empty <code>{}</code> is in their documentation. Strange, yes... But when I implemented this <code>{}</code> - it works, and this is like in documentation"}], "answers": [{"comments": [{"owner": {"reputation": 8237, "user_id": 2900502, "user_type": "registered", "accept_rate": 73, "profile_image": "https://i.stack.imgur.com/R1OjD.jpg?s=128&g=1", "display_name": "Shersh", "link": "https://stackoverflow.com/users/2900502/shersh"}, "edited": false, "score": 1, "creation_date": 1497981782, "post_id": 44656505, "comment_id": 76305422, "body": "<code>maybe (Object mempty) toJSON maybeX</code> is the same as <code>maybe mempty toJSON maybeX</code> which is the same as <code>foldMap toJSON maybeX</code>"}, {"owner": {"reputation": 9772, "user_id": 3963, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/9pDQ8.png?s=128&g=1", "display_name": "hao", "link": "https://stackoverflow.com/users/3963/hao"}, "reply_to_user": {"reputation": 8237, "user_id": 2900502, "user_type": "registered", "accept_rate": 73, "profile_image": "https://i.stack.imgur.com/R1OjD.jpg?s=128&g=1", "display_name": "Shersh", "link": "https://stackoverflow.com/users/2900502/shersh"}, "edited": false, "score": 0, "creation_date": 1501617961, "post_id": 44656505, "comment_id": 77854638, "body": "actually i don&#39;t think there&#39;s a Monoid Value instance?"}, {"owner": {"reputation": 8237, "user_id": 2900502, "user_type": "registered", "accept_rate": 73, "profile_image": "https://i.stack.imgur.com/R1OjD.jpg?s=128&g=1", "display_name": "Shersh", "link": "https://stackoverflow.com/users/2900502/shersh"}, "edited": false, "score": 0, "creation_date": 1501631731, "post_id": 44656505, "comment_id": 77859876, "body": "Yes, you&#39;re right. I forgot about types, just performed quick syntactic transformation. My version with <code>foldMap</code> doesn&#39;t work :("}], "tags": [], "owner": {"reputation": 9772, "user_id": 3963, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/9pDQ8.png?s=128&g=1", "display_name": "hao", "link": "https://stackoverflow.com/users/3963/hao"}, "is_accepted": false, "score": 2, "last_activity_date": 1501617952, "last_edit_date": 1501617952, "creation_date": 1497970492, "answer_id": 44656505, "question_id": 44650525, "link": "https://stackoverflow.com/questions/44650525/tojson-with-custom-representation/44656505#44656505", "title": "ToJSON with custom representation", "body": "<p>If I'm not misunderstanding, I think you want this:</p>\n\n<pre><code>instance ToJSON D where\n    toJSON (D maybeX) =\n      object [\"x\" .= (case maybeX of\n                        Nothing -&gt; mempty\n                        Just x -&gt; toJSON x)]\n</code></pre>\n\n<p>And, as you pointed out in the comments, you can golf that inner expression as <code>maybe (Object mempty) toJSON maybeX :: Value</code>.</p>\n"}], "owner": {"reputation": 2196, "user_id": 1980863, "user_type": "registered", "accept_rate": 50, "profile_image": "https://www.gravatar.com/avatar/8a9248211c4148f5d7df2269aa711e2e?s=128&d=identicon&r=PG", "display_name": "RandomB", "link": "https://stackoverflow.com/users/1980863/randomb"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 70, "favorite_count": 0, "answer_count": 1, "score": 2, "last_activity_date": 1501617952, "creation_date": 1497954493, "question_id": 44650525, "link": "https://stackoverflow.com/questions/44650525/tojson-with-custom-representation", "title": "ToJSON with custom representation", "body": "<p>I have some type like</p>\n\n<pre><code>data D = D { x :: Maybe X }\n</code></pre>\n\n<p>and I need to serialize it to JSON like: <code>{\"x\": {XXX} }</code>, where <code>XXX</code> is the representation of <code>X</code> when <code>x</code> is <strong>Just X</strong> object. OK, BUT when it's <strong>Nothing</strong> it must be <code>{}</code>, i.e.:  <code>{\"x\": {}}</code>. How to implement <code>ToJSON</code> instance for such <code>D</code> ?  Conversion to <code>String</code> is wrong, I get <code>\"{}\"</code> instead of <code>{}</code></p>\n"}, {"tags": ["haskell"], "answers": [{"comments": [{"owner": {"reputation": 152, "user_id": 1935301, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/2a80cd7bdb07f8b6d39385943c0f6fb4?s=128&d=identicon&r=PG", "display_name": "ryan91", "link": "https://stackoverflow.com/users/1935301/ryan91"}, "edited": false, "score": 0, "creation_date": 1497957813, "post_id": 44649703, "comment_id": 76288337, "body": "Edited the question to address what you suggested. Thanks for answering!"}, {"owner": {"reputation": 100185, "user_id": 3234959, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/93bb12ca0f93dfddb33880316f7e66c2?s=128&d=identicon&r=PG&f=1", "display_name": "chi", "link": "https://stackoverflow.com/users/3234959/chi"}, "reply_to_user": {"reputation": 152, "user_id": 1935301, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/2a80cd7bdb07f8b6d39385943c0f6fb4?s=128&d=identicon&r=PG", "display_name": "ryan91", "link": "https://stackoverflow.com/users/1935301/ryan91"}, "edited": false, "score": 1, "creation_date": 1497961574, "post_id": 44649703, "comment_id": 76291143, "body": "@ryan91 You need to pass the <code>a</code> type for that, see my edit."}, {"owner": {"reputation": 152, "user_id": 1935301, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/2a80cd7bdb07f8b6d39385943c0f6fb4?s=128&d=identicon&r=PG", "display_name": "ryan91", "link": "https://stackoverflow.com/users/1935301/ryan91"}, "edited": false, "score": 0, "creation_date": 1497962669, "post_id": 44649703, "comment_id": 76292038, "body": "Of course! I was just slowly getting to your solution but hadn&#39;t quite made it yet, thanks a lot!"}], "tags": [], "owner": {"reputation": 100185, "user_id": 3234959, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/93bb12ca0f93dfddb33880316f7e66c2?s=128&d=identicon&r=PG&f=1", "display_name": "chi", "link": "https://stackoverflow.com/users/3234959/chi"}, "is_accepted": true, "score": 4, "last_activity_date": 1497961543, "last_edit_date": 1497961543, "creation_date": 1497952330, "answer_id": 44649703, "question_id": 44649410, "link": "https://stackoverflow.com/questions/44649410/call-a-function-inside-a-class-without-declaring-an-instance/44649703#44649703", "title": "Call a function inside a class without declaring an instance", "body": "<p>You need a couple of extensions to do that, but it is doable. Here's a GHCi session showing that:</p>\n\n<pre><code>&gt; :set -XAllowAmbiguousTypes\n&gt; class C a where myFunction :: Int\n&gt; instance C Int where myFunction = 1\n&gt; instance C Bool where myFunction = 2\n&gt; :set -XTypeApplications\n&gt; myFunction @ Int\n1\n&gt; myFunction @ Bool\n2\n</code></pre>\n\n<p>An \"old\" solution would be to add a proxy argument</p>\n\n<pre><code>class C a where myFunction :: proxy a -&gt; Int\n</code></pre>\n\n<p>but hopefully this will fade out of style in a few years -- I find passing types explicitly clearer than passing proxies.</p>\n\n<hr>\n\n<p>Full code, with another example:</p>\n\n<pre><code>{-# LANGUAGE AllowAmbiguousTypes, TypeApplications, ScopedTypeVariables #-}\n\nclass C a where\n  myFunction :: Int\n  create :: Int -&gt; a\n  doSomething :: a -&gt; Int\n  anotherFunction :: Int -&gt; Int\n  anotherFunction x = doSomething $ create @ a 4\n\ninstance C Int where\n  myFunction = 1\n  create x = 2 * x\n  doSomething x = x + 4\n\ninstance C Bool where\n  myFunction = 2\n  create x = True\n  doSomething x = if x then 42 else 24\n</code></pre>\n\n<p>Tests:</p>\n\n<pre><code>&gt; :set -XTypeApplications\n&gt; anotherFunction @ Bool 4\n42\n&gt; anotherFunction @ Int 6\n12\n</code></pre>\n"}], "owner": {"reputation": 152, "user_id": 1935301, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/2a80cd7bdb07f8b6d39385943c0f6fb4?s=128&d=identicon&r=PG", "display_name": "ryan91", "link": "https://stackoverflow.com/users/1935301/ryan91"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 300, "favorite_count": 1, "accepted_answer_id": 44649703, "answer_count": 1, "score": 3, "last_activity_date": 1497976010, "creation_date": 1497951683, "last_edit_date": 1497976010, "question_id": 44649410, "link": "https://stackoverflow.com/questions/44649410/call-a-function-inside-a-class-without-declaring-an-instance", "title": "Call a function inside a class without declaring an instance", "body": "<p>I want to create a function in Haskell that does different things depending the data type it is given. I thought classes should do what I want, but now I ran into a problem. What I would like to be able to do is something similar to:</p>\n\n<pre><code>let x1 = myFunction :: MyInstance1\nlet x2 = myFunction :: MyInstance2\n</code></pre>\n\n<p>and it does different things depending on the given instance.</p>\n\n<p>My current approach is</p>\n\n<pre><code>class MyClass a where\n    create :: Int -&gt; a\n    doSomething :: a -&gt; [Int]\n\n    myFunction :: [Int]\n    myFunction = doSomething $ create 4\n\ninstance MyClass MyInstance1 where\n    -- implementation of create and doSomething\n\ninstance MyClass MyInstance2 where\n    -- implementation of create and doSomething\n</code></pre>\n\n<p>However, the compiler tells me \"The type variable a0 is ambiguous in the ambiguity check for 'myFunction'\" and from what I've been reading this is related to the compiler not knowing what instance of 'doSomething' to call.</p>\n\n<p>So is there a way to call 'doSomething' in a \"generic\" way and enforce the data type later? Or do I need an entirely different approach for my problem?</p>\n\n<p>--- EDIT ---</p>\n\n<p>So I applied <em>chi</em>'s answer to my problem, but it does not solve it completely yet. Here's my code</p>\n\n<pre><code>{-# LANGUAGE AllowAmbiguousTypes #-}\n\nclass C a where\n  myFunction :: Int\n  create :: Int -&gt; a\n  doSomething :: a -&gt; Int\n  -- anotherFunction :: Int -&gt; Int\n  -- anotherFunction x = doSomething $ create 4\n\ninstance C Int where\n  myFunction = 1\n  create x = 2 * x\n  doSomething x = x + 4\n\ninstance C Bool where\n  myFunction = 2\n  create x = True\n  doSomething x = if x then 42 else 24\n</code></pre>\n\n<p>This compiles and I in the prompt</p>\n\n<pre><code>create @ Bool 4\ncreate @ Int 4\n</code></pre>\n\n<p>returns the expected results. However, <em>anotherFunction</em> does not compile properly giving the error message</p>\n\n<pre><code>Test.hs:8:23: error:\n    \u2022 Could not deduce (C a0) arising from a use of \u2018doSomething\u2019\n      from the context: C a\n        bound by the class declaration for \u2018C\u2019 at Test.hs:(3,1)-(8,44)\n      The type variable \u2018a0\u2019 is ambiguous\n      These potential instances exist:\n        instance C Bool -- Defined at Test.hs:15:10\n        instance C Int -- Defined at Test.hs:10:10\n    \u2022 In the expression: doSomething $ create 4\n      In an equation for \u2018anotherFunction\u2019:\n          anotherFunction x = doSomething $ create 4\nFailed, modules loaded: none.\n</code></pre>\n\n<p>Is it simply not possible to use <em>doSomething</em> in this context? My idea is to implement the function in the same manner for all instances and then write</p>\n\n<pre><code>anotherFunction @ Bool 4\nanotherFunction @ Int 6\n</code></pre>\n"}, {"tags": ["haskell", "dictionary", "erlang"], "comments": [{"owner": {"reputation": 187800, "user_id": 320615, "user_type": "registered", "accept_rate": 89, "profile_image": "https://www.gravatar.com/avatar/65c80e12b6a33913538653f6d4ef1277?s=128&d=identicon&r=PG", "display_name": "Dogbert", "link": "https://stackoverflow.com/users/320615/dogbert"}, "edited": false, "score": 2, "creation_date": 1497948749, "post_id": 44648213, "comment_id": 76281553, "body": "That&#39;s not the map function in Erlang, that&#39;s the map data structure."}, {"owner": {"reputation": 790, "user_id": 8166241, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/985a4a8c6aa54bf92675dfcb0bbcfafb?s=128&d=identicon&r=PG&f=1", "display_name": "Sathish Sundharam", "link": "https://stackoverflow.com/users/8166241/sathish-sundharam"}, "reply_to_user": {"reputation": 187800, "user_id": 320615, "user_type": "registered", "accept_rate": 89, "profile_image": "https://www.gravatar.com/avatar/65c80e12b6a33913538653f6d4ef1277?s=128&d=identicon&r=PG", "display_name": "Dogbert", "link": "https://stackoverflow.com/users/320615/dogbert"}, "edited": false, "score": 0, "creation_date": 1497948846, "post_id": 44648213, "comment_id": 76281634, "body": "can you please explain erlang map data structure @Dogbert"}], "answers": [{"comments": [{"owner": {"reputation": 13614, "user_id": 1635979, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/pZRUz.jpg?s=128&g=1", "display_name": "Pascal", "link": "https://stackoverflow.com/users/1635979/pascal"}, "edited": false, "score": 0, "creation_date": 1497952776, "post_id": 44648338, "comment_id": 76284733, "body": "To complete Willem answer, erlang provides the map function for various data structures: for maps  as already mentioned and also for arrays, dicts, gb-trees, lists, orddicts."}], "tags": [], "owner": {"reputation": 314794, "user_id": 67579, "user_type": "registered", "accept_rate": 81, "profile_image": "https://i.stack.imgur.com/BJXub.png?s=128&g=1", "display_name": "Willem Van Onsem", "link": "https://stackoverflow.com/users/67579/willem-van-onsem"}, "is_accepted": false, "score": 8, "last_activity_date": 1497953241, "last_edit_date": 1497953241, "creation_date": 1497948921, "answer_id": 44648338, "question_id": 44648213, "link": "https://stackoverflow.com/questions/44648213/haskell-and-erlang-map-function/44648338#44648338", "title": "Haskell and Erlang Map Function", "body": "<p>In <strong>Erlang</strong>, the <a href=\"http://erlang.org/doc/man/maps.html\" rel=\"noreferrer\"><code>maps</code></a> are <strong>data structures</strong>, you store <em>values</em> in it you associate with <em>keys</em>. It works like a <em>dictionary</em>. Erlang however has a <a href=\"http://erlang.org/doc/man/maps.html#map-2\" rel=\"noreferrer\"><strong><code>map</code> function</strong></a>:</p>\n\n<blockquote>\n<pre><code>map(Fun, Map1) -&gt; Map2\n</code></pre>\n  \n  <p>Types:</p>\n  \n  <ul>\n  <li><code>Fun</code> = <code>fun((K, V1) -&gt; V2)</code></li>\n  <li><code>Map1</code> = <code>Map2</code> = <code>#{}</code></li>\n  <li><code>K</code> = <code>V1</code> = <code>V2</code> = <code>term()</code></li>\n  </ul>\n</blockquote>\n\n<p>Like @Pascal says in his answer, the <code>map</code> function is defined on various data structures (arrays,...).</p>\n\n<p>The <code>map</code> in <strong>Haskell</strong> you describe is <strong>not a data structure</strong>, it is a function to <strong>transform a <em>list</em> of elements into another list of elements</strong>. This is done in a lazy manner. Mind that here <code>map</code> thus works on a specific data structure: the list <code>[a]</code>. Although this might change in the future.</p>\n\n<p>The two have not much to do with each other. They share a name, because \"mapping\" usually means that you project values on other values.</p>\n"}], "owner": {"reputation": 790, "user_id": 8166241, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/985a4a8c6aa54bf92675dfcb0bbcfafb?s=128&d=identicon&r=PG&f=1", "display_name": "Sathish Sundharam", "link": "https://stackoverflow.com/users/8166241/sathish-sundharam"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 135, "favorite_count": 0, "answer_count": 1, "score": -5, "last_activity_date": 1497953241, "creation_date": 1497948647, "last_edit_date": 1497949124, "question_id": 44648213, "link": "https://stackoverflow.com/questions/44648213/haskell-and-erlang-map-function", "title": "Haskell and Erlang Map Function", "body": "<p>What is the different between erlang map function and haskell map function ?</p>\n\n<p>in <strong>erlang</strong> map ->  <code>M1 = #{name=&gt;john,age=&gt;25}</code>.</p>\n\n<p>in <strong>Haskell</strong> map ->  <code>map :: (a -&gt; b) -&gt; [a] -&gt; [b]</code></p>\n"}, {"tags": ["haskell", "monads", "applicative", "newtype"], "comments": [{"owner": {"reputation": 314794, "user_id": 67579, "user_type": "registered", "accept_rate": 81, "profile_image": "https://i.stack.imgur.com/BJXub.png?s=128&g=1", "display_name": "Willem Van Onsem", "link": "https://stackoverflow.com/users/67579/willem-van-onsem"}, "edited": false, "score": 2, "creation_date": 1497948737, "post_id": 44647521, "comment_id": 76281539, "body": "As far as I know, thats because the base has changed: now <code>Monad</code> requires the type to be <code>Applicative</code>."}, {"owner": {"reputation": 100185, "user_id": 3234959, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/93bb12ca0f93dfddb33880316f7e66c2?s=128&d=identicon&r=PG&f=1", "display_name": "chi", "link": "https://stackoverflow.com/users/3234959/chi"}, "edited": false, "score": 6, "creation_date": 1497951185, "post_id": 44647521, "comment_id": 76283457, "body": "You probably want to use <code>deriving (Functor, Applicative, Monad)</code> together. It wasn&#39;t required a few years ago, but it is now."}, {"owner": {"reputation": 31, "user_id": 5701533, "user_type": "registered", "profile_image": "https://lh6.googleusercontent.com/-AAMEU5FAAd0/AAAAAAAAAAI/AAAAAAAABXg/VRD_QE8B7P4/photo.jpg?sz=128", "display_name": "Agustin Larreinegabe", "link": "https://stackoverflow.com/users/5701533/agustin-larreinegabe"}, "edited": false, "score": 0, "creation_date": 1497959075, "post_id": 44647521, "comment_id": 76289325, "body": "Thanks.. It&#39;s working with <code>deriving (Functor, Applicative, Monad)</code>"}], "answers": [{"tags": [], "owner": {"reputation": 166, "user_id": 8242965, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/5724b2e35bafc1fbff7092793b3ffb4a?s=128&d=identicon&r=PG", "display_name": "user8242965", "link": "https://stackoverflow.com/users/8242965/user8242965"}, "is_accepted": false, "score": 1, "last_activity_date": 1499062620, "creation_date": 1499062620, "answer_id": 44878867, "question_id": 44647521, "link": "https://stackoverflow.com/questions/44647521/newtype-deriving-monad-error/44878867#44878867", "title": "Newtype Deriving Monad Error", "body": "<p>In ghc 7.10.1 AMP proposal took place. Prior to that you could define <code>Monad</code> instance without having <code>Applicative</code> instance, after 7.10.1 you have to define <code>Functor</code> and <code>Applicative</code> if you want to define a <code>Monad</code>.</p>\n\n<p><a href=\"https://wiki.haskell.org/Functor-Applicative-Monad_Proposal\" rel=\"nofollow noreferrer\">https://wiki.haskell.org/Functor-Applicative-Monad_Proposal</a></p>\n"}], "owner": {"reputation": 31, "user_id": 5701533, "user_type": "registered", "profile_image": "https://lh6.googleusercontent.com/-AAMEU5FAAd0/AAAAAAAAAAI/AAAAAAAABXg/VRD_QE8B7P4/photo.jpg?sz=128", "display_name": "Agustin Larreinegabe", "link": "https://stackoverflow.com/users/5701533/agustin-larreinegabe"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 690, "favorite_count": 0, "answer_count": 1, "score": 2, "last_activity_date": 1499062620, "creation_date": 1497946592, "last_edit_date": 1497948593, "question_id": 44647521, "link": "https://stackoverflow.com/questions/44647521/newtype-deriving-monad-error", "title": "Newtype Deriving Monad Error", "body": "<p>I'm trying to install an application <a href=\"https://raw.githubusercontent.com/termite2/util/master/ContextError.hs\" rel=\"nofollow noreferrer\">Termite - Util</a> but I get this error in with the line 14</p>\n\n<pre><code>newtype CE m a = CE {unCE :: m a} deriving (Monad)\n</code></pre>\n\n<p>The error says:</p>\n\n<blockquote>\n  <p>ContextError.hs:14:45:\n     No instance for (Applicative (CE m))\n       arising from the 'deriving' clause of a data type declaration\n     Possible fix:\n       use a standalone 'deriving instance' declaration,\n         so you can specify the instance context yourself\n     When deriving the instance for (Monad (CE m))</p>\n</blockquote>\n\n<p>I have alredy try with the solution proposed in <a href=\"https://www.reddit.com/r/haskellquestions/comments/3j55zb/cis_194_homework_7/?st=j459vj72&amp;sh=497043ff\" rel=\"nofollow noreferrer\">CIS 194: Homework 7</a></p>\n\n<p>adding this:</p>\n\n<blockquote>\n  <p>instance Applicative (CE m) where\n     pure = return\n     (&lt;*>) = ap</p>\n</blockquote>\n\n<p>but I get this error again</p>\n\n<blockquote>\n  <p>ContextError.hs:14:45:\n     No instance for (Functor (CE m))\n       arising from the 'deriving' clause of a data type declaration\n     Possible fix:\n      use a standalone 'deriving instance' declaration,\n         so you can specify the instance context yourself\n     When deriving the instance for (Monad (CE m))</p>\n</blockquote>\n\n<p>I really don't know how to proceed, I'm new with Haskell</p>\n\n<p>Thanks in advance.</p>\n"}, {"tags": ["haskell"], "answers": [{"comments": [{"owner": {"reputation": 20310, "user_id": 525980, "user_type": "registered", "accept_rate": 48, "profile_image": "https://www.gravatar.com/avatar/8dafe66793ee2f32192e9fcefb389a12?s=128&d=identicon&r=PG", "display_name": "Clinton", "link": "https://stackoverflow.com/users/525980/clinton"}, "edited": false, "score": 1, "creation_date": 1497947021, "post_id": 44647496, "comment_id": 76280324, "body": "Beautiful. Exactly what I&#39;m after. Cheers."}, {"owner": {"reputation": 23600, "user_id": 1695172, "user_type": "registered", "accept_rate": 91, "profile_image": "https://www.gravatar.com/avatar/6319d7eafca7852cf04c88598ca31e75?s=128&d=identicon&r=PG", "display_name": "Netwave", "link": "https://stackoverflow.com/users/1695172/netwave"}, "edited": false, "score": 3, "creation_date": 1497951521, "post_id": 44647496, "comment_id": 76283725, "body": "can you explain this with an example, I would like to understand properly. thanks :)"}, {"owner": {"reputation": 383, "user_id": 3024170, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/9c69db72fd6a246ba01bc7fc71348835?s=128&d=identicon&r=PG&f=1", "display_name": "YoshikuniJujo", "link": "https://stackoverflow.com/users/3024170/yoshikunijujo"}, "edited": false, "score": 0, "creation_date": 1498010162, "post_id": 44647496, "comment_id": 76316510, "body": "I added example of use. Is this what you want? Or do you want to know the inside of function cast?"}], "tags": [], "owner": {"reputation": 383, "user_id": 3024170, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/9c69db72fd6a246ba01bc7fc71348835?s=128&d=identicon&r=PG&f=1", "display_name": "YoshikuniJujo", "link": "https://stackoverflow.com/users/3024170/yoshikunijujo"}, "is_accepted": true, "score": 9, "last_activity_date": 1498011229, "last_edit_date": 1498011229, "creation_date": 1497946485, "answer_id": 44647496, "question_id": 44647096, "link": "https://stackoverflow.com/questions/44647096/type-equality-function/44647496#44647496", "title": "Type equality function", "body": "<h2>Just this</h2>\n\n<p><a href=\"http://hackage.haskell.org/package/base-4.9.1.0/docs/Data-Typeable.html#v:cast\" rel=\"nofollow noreferrer\">http://hackage.haskell.org/package/base-4.9.1.0/docs/Data-Typeable.html#v:cast</a></p>\n\n<pre><code>cast :: (Typeable a, Typeable b) =&gt; a -&gt; Maybe b\n</code></pre>\n\n<h2>Example of use</h2>\n\n<p>Function cast can be a part of \"type casting system like object-oriented languages\". Bacteria and Fungus are Life. They can be upcasted to Life. And Life may be able to downcast to Bacteria or Fungus.</p>\n\n<pre><code>{-# LANGUAGE ExistentialQuantification, DeriveDataTypeable #-}\n\nimport Data.Typeable\nimport Data.Maybe\n\ndata SomeLife = forall l . Life l =&gt; SomeLife l\n        deriving Typeable\n\ninstance Show SomeLife where\n        show (SomeLife l) = \"SomeLife \" ++ show l\n\nclass (Typeable l, Show l) =&gt; Life l where\n        toLife :: l -&gt; SomeLife\n        fromLife :: SomeLife -&gt; Maybe l\n\n        toLife = SomeLife\n        fromLife (SomeLife l) = cast l\n\ninstance Life SomeLife where\n        toLife = id\n        fromLife = Just\n\ndata Bacteria = Bacteria deriving (Typeable, Show)\n\ninstance Life Bacteria\n\ndata Fungus = Fungus deriving (Typeable, Show)\n\ninstance Life Fungus\n\ncastLife :: (Life l1, Life l2) =&gt; l1 -&gt; Maybe l2\ncastLife = fromLife . toLife\n\nfilterLife :: (Life l1, Life l2) =&gt; [l1] -&gt; [l2]\nfilterLife = catMaybes . map castLife\n\nwithLifeIO :: (Life l1, Life l2) =&gt; l1 -&gt; (l2 -&gt; IO ()) -&gt; IO ()\nwithLifeIO l f = maybe (return ()) f $ castLife l\n\nwithYourFavoriteLife :: Life l =&gt; (l -&gt; IO ()) -&gt; IO ()\nwithYourFavoriteLife act = do\n        withLifeIO Bacteria act\n        withLifeIO Fungus act\n\nmain :: IO ()\nmain = do\n        let     sls :: Life l =&gt; [l]\n                sls = filterLife [\n                        SomeLife Bacteria,\n                        SomeLife Fungus,\n                        SomeLife Fungus ]\n        print (sls :: [SomeLife])\n        print (sls :: [Bacteria])\n        print (sls :: [Fungus])\n        withYourFavoriteLife (print :: SomeLife -&gt; IO ())\n        withYourFavoriteLife (print :: Bacteria -&gt; IO ())\n        withYourFavoriteLife (print :: Fungus -&gt; IO ())\n</code></pre>\n\n<p>This technic extend to type hierarchy system. Whole Life module is here.\n<a href=\"https://github.com/YoshikuniJujo/test_haskell/blob/master/features/existential_quantifications/type_hierarchy/Life.hs\" rel=\"nofollow noreferrer\">https://github.com/YoshikuniJujo/test_haskell/blob/master/features/existential_quantifications/type_hierarchy/Life.hs</a></p>\n\n<p>Exception system use this technic. <a href=\"https://hackage.haskell.org/package/base-4.9.1.0/docs/Control-Exception.html\" rel=\"nofollow noreferrer\">https://hackage.haskell.org/package/base-4.9.1.0/docs/Control-Exception.html</a></p>\n"}], "owner": {"reputation": 20310, "user_id": 525980, "user_type": "registered", "accept_rate": 48, "profile_image": "https://www.gravatar.com/avatar/8dafe66793ee2f32192e9fcefb389a12?s=128&d=identicon&r=PG", "display_name": "Clinton", "link": "https://stackoverflow.com/users/525980/clinton"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 110, "favorite_count": 3, "accepted_answer_id": 44647496, "answer_count": 1, "score": 6, "last_activity_date": 1498011229, "creation_date": 1497945368, "last_edit_date": 1497945806, "question_id": 44647096, "link": "https://stackoverflow.com/questions/44647096/type-equality-function", "title": "Type equality function", "body": "<p>Is there a way to define a function like so:</p>\n\n<pre><code>f :: (C a, C b) =&gt; a -&gt; Maybe b\n</code></pre>\n\n<p>Such that:</p>\n\n<pre><code>f = Just\n</code></pre>\n\n<p>when type <code>a</code> = <code>b</code>, and</p>\n\n<pre><code>f _ = Nothing\n</code></pre>\n\n<p>when type <code>a</code> /= <code>b</code>?</p>\n\n<p>Note that:</p>\n\n<ul>\n<li>I don't want to use overlapping instances.</li>\n<li>I'd prefer not to have a class constraint <code>C</code>, but I'm pretty sure it's necessary (particularly if I want to avoid overlapping instances).</li>\n<li>I want to define only a single instance for each type I want to compare in this scheme, defining a class <code>Equal a b</code> makes this problem trivial but it then requires <code>n^2</code> instances which I want to avoid.</li>\n</ul>\n"}, {"tags": ["haskell", "gtk", "gtk3", "gtk2"], "answers": [{"tags": [], "owner": {"reputation": 5304, "user_id": 2757035, "user_type": "registered", "accept_rate": 57, "profile_image": "https://www.gravatar.com/avatar/fade5daafd5717576b33f2e08f4f9429?s=128&d=identicon&r=PG&f=1", "display_name": "underscore_d", "link": "https://stackoverflow.com/users/2757035/underscore-d"}, "is_accepted": false, "score": 0, "last_activity_date": 1504390635, "last_edit_date": 1504390635, "creation_date": 1504389438, "answer_id": 46018573, "question_id": 44644642, "link": "https://stackoverflow.com/questions/44644642/how-to-display-overflow-menu-for-toolitems-in-a-gtk-toolbar/46018573#46018573", "title": "How to display overflow menu for ToolItems in a GTK Toolbar", "body": "<p>The documentation states this <a href=\"https://developer.gnome.org/gtk3/stable/GtkToolbar.html#gtk-toolbar-set-show-arrow\" rel=\"nofollow noreferrer\">about <code>gtk_toolbar_set_show_arrow()</code></a>:</p>\n\n<blockquote>\n  <p>Sets whether to show an overflow menu when <code>toolbar</code> doesn\u2019t have room for all items on it. If <code>TRUE</code>, items that there are not room are available through an overflow menu.</p>\n</blockquote>\n\n<p>So, it's an \"overflow menu\". I won't bore you with a detour into the GTK+ source, but suffice it to say: the items you add to the <code>Toolbar</code> need to provide menu items to appear in its overflow menu. Sounds logical now, right? :D</p>\n\n<p><code>ToolButtons</code> work because they call <code>set_proxy_menu_item()</code> with a <code>MenuItem</code> they create specifically for this purpose.</p>\n\n<p>And that's what <code>Toolbar</code> looks for when deciding whether items can overflow: proxy <code>MenuItem</code>s, which it can put into the overflow menu - and only if it finds at least one is there any point in giving the arrow to open that menu.</p>\n\n<p>So, if you have other widgets, you can to get them into the overflow menu by setting a proxy menu item on your <code>ToolItem</code>, by either of:</p>\n\n<ul>\n<li>simply calling <a href=\"https://developer.gnome.org/gtk3/stable/GtkToolItem.html#gtk-tool-item-set-proxy-menu-item\" rel=\"nofollow noreferrer\"><code>gtk_tool_item_set_proxy_menu_item()</code></a> to set a specific item</li>\n<li>connecting to the <code>::create-menu-proxy</code> signal on your <code>ToolItem</code>, and deciding during each emission whether or not to set (or clear) the proxy item</li>\n</ul>\n\n<p>You'd also, of course, connect <code>::activate</code> on that <code>MenuItem</code> to do something appropriate relating to the original <code>ToolItem</code>.</p>\n\n<p>...though whether you can do anything useful from a <code>MenuItem</code> if the ultimate <code>ToolItem</code> child is a <code>ComboBox</code> is a different question. It doesn't expose its popup menu as something you can use. I guess you could just add a duplicate of the <code>ComboBox</code> to a <code>MenuItem</code> and use that as your proxy... But in that case, likely you're outwith the scope of what the overflow menu is meant for, and should instead just ensure your <code>Toolbar</code> doesn't get small enough to lose such controls.</p>\n\n<p>Or maybe not! Try it and see how it goes.</p>\n"}], "owner": {"reputation": 21, "user_id": 737714, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/f6431c5fc3d99602c6203c9739eda7fb?s=128&d=identicon&r=PG", "display_name": "maoe", "link": "https://stackoverflow.com/users/737714/maoe"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 202, "favorite_count": 0, "answer_count": 1, "score": 2, "last_activity_date": 1504390635, "creation_date": 1497937203, "question_id": 44644642, "link": "https://stackoverflow.com/questions/44644642/how-to-display-overflow-menu-for-toolitems-in-a-gtk-toolbar", "title": "How to display overflow menu for ToolItems in a GTK Toolbar", "body": "<p>A GTK <code>Toolbar</code> can display an overflow menu when the toolbar is not wide enough to show its contents.</p>\n\n<p>It seems that this feature doesn't work if the toolbar contains <code>ComboBox</code>es wrapped by <code>ToolItem</code>s.</p>\n\n<p>Here is <a href=\"https://github.com/maoe/gtk2hs-toolbar-experiment/blob/master/Gtk2Hs.hs\" rel=\"nofollow noreferrer\">an example code</a> that demonstrates the issue. It's written in Haskell but I guess it shouldn't be too difficult to translate it into other languages.</p>\n\n<p>The instructions to build the repo is written in the <a href=\"https://github.com/maoe/gtk2hs-toolbar-experiment#readme\" rel=\"nofollow noreferrer\">README.md</a>.</p>\n\n<p>The last command opens a small GTK window. If you make it bigger you'll see two <code>ComboBox</code>es in the window. The problem is that if you make the window narrower a bit, the right <code>ComboBox</code> disappears and no overflow menu appears even though <code>toolbarShowArrow</code> is enabled.</p>\n\n<p>(Unfortunately I don't have enough reputation on SO to post two screenshots here so I uploaded them on the repo.)</p>\n\n<p>Interestingly if I change the contents of the <code>Toolbar</code> from <code>ToolItem</code>s to <code>ToolButton</code>s for example, I get the overflow menu.</p>\n\n<p>Also I tested this with 3 packages: <code>gtk</code> for GTK2, <code>gtk3</code> for GTK3, and <code>gi-gtk</code> for GTK3 with gobject introspection. All of them have the same issue.</p>\n\n<p>So the question is: is there any workaround for this issue?</p>\n"}, {"tags": ["multithreading", "haskell"], "comments": [{"owner": {"reputation": 13807, "user_id": 2407038, "user_type": "registered", "accept_rate": 64, "profile_image": "https://www.gravatar.com/avatar/538f6f4a9aa43841841de7d8e8b169fc?s=128&d=identicon&r=PG&f=1", "display_name": "user2407038", "link": "https://stackoverflow.com/users/2407038/user2407038"}, "edited": false, "score": 1, "creation_date": 1497911833, "post_id": 44640842, "comment_id": 76267914, "body": "Yes, it is likely a buffering issue. The function you want is <a href=\"https://hackage.haskell.org/package/base-4.9.1.0/docs/System-IO.html#v:hSetBuffering\" rel=\"nofollow noreferrer\"><code>hSetBuffer</code></a>. When you set a very small delay, your terminal is likely going to flush the buffer when the characters exceed the length of a single line (which is very fast for 10ms delay). I&#39;m not sure what the 2nd questions means - what &#39;technique&#39; do you refer to? Of course you can do arbitrary computation inside a thread started with <code>forkIO</code>, just like you can do so in the main thread. The last question (library recommendation) is off topic."}, {"owner": {"reputation": 100185, "user_id": 3234959, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/93bb12ca0f93dfddb33880316f7e66c2?s=128&d=identicon&r=PG&f=1", "display_name": "chi", "link": "https://stackoverflow.com/users/3234959/chi"}, "edited": false, "score": 1, "creation_date": 1497911866, "post_id": 44640842, "comment_id": 76267926, "body": "Try <code>hFlush stdout</code> after the <code>putChar</code>"}, {"owner": {"reputation": 44013, "user_id": 1477667, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/trgKM.jpg?s=128&g=1", "display_name": "dfeuer", "link": "https://stackoverflow.com/users/1477667/dfeuer"}, "reply_to_user": {"reputation": 13807, "user_id": 2407038, "user_type": "registered", "accept_rate": 64, "profile_image": "https://www.gravatar.com/avatar/538f6f4a9aa43841841de7d8e8b169fc?s=128&d=identicon&r=PG&f=1", "display_name": "user2407038", "link": "https://stackoverflow.com/users/2407038/user2407038"}, "edited": false, "score": 1, "creation_date": 1497929995, "post_id": 44640842, "comment_id": 76272263, "body": "@user2407038, the question doesn&#39;t ask about libraries. It asks about &quot;thread communication pattern[s]&quot;."}], "answers": [{"tags": [], "owner": {"reputation": 126897, "user_id": 791604, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/ce991df7a056248d5e4f6fc3659ba733?s=128&d=identicon&r=PG", "display_name": "Daniel Wagner", "link": "https://stackoverflow.com/users/791604/daniel-wagner"}, "is_accepted": true, "score": 5, "last_activity_date": 1497921363, "creation_date": 1497921363, "answer_id": 44642279, "question_id": 44640842, "link": "https://stackoverflow.com/questions/44640842/haskells-putchar-doesnt-print-anything-if-used-with-threaddelay-1-sec/44642279#44642279", "title": "Haskell&#39;s `putChar` doesn&#39;t print anything if used with `threadDelay` &gt; 1 sec", "body": "<p>Yes, it is a buffering issue. Import <code>System.IO</code>, then add <code>hSetBuffering stdout NoBuffering</code> to the beginning of <code>main</code> to fix it. Yes, you can use <code>forkIO</code> for concurrency. Don't forget to compile with <code>-threaded</code> and run your program with <code>+RTS -N</code> or similar if you want more than one OS thread to be available.</p>\n"}], "owner": {"reputation": 7751, "user_id": 83938, "user_type": "registered", "accept_rate": 73, "profile_image": "https://www.gravatar.com/avatar/81b900db36308bed1289e374c32cb4a2?s=128&d=identicon&r=PG&f=1", "display_name": "Nik", "link": "https://stackoverflow.com/users/83938/nik"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 210, "favorite_count": 0, "accepted_answer_id": 44642279, "answer_count": 1, "score": 2, "last_activity_date": 1497921363, "creation_date": 1497910895, "question_id": 44640842, "link": "https://stackoverflow.com/questions/44640842/haskells-putchar-doesnt-print-anything-if-used-with-threaddelay-1-sec", "title": "Haskell&#39;s `putChar` doesn&#39;t print anything if used with `threadDelay` &gt; 1 sec", "body": "<p>I'm trying to write a simple program which outputs <code>xoxoxoxoxoooxoxxxxoxoo</code> string.</p>\n\n<pre><code>module Main where\n\nimport Control.Concurrent\n\nloop :: Char -&gt; IO ()\nloop c = do\n  putChar c\n  threadDelay 1000000 -- 1 second\n  loop c\n\nmain = do\n  forkIO $ loop 'x'\n  forkIO $ loop 'o'\n  getChar\n</code></pre>\n\n<p>If I use big values (<code>1</code> second or <code>0.1</code> second) for <code>threadDelay</code> it doesn't print anything until I press any key (and program prints output and exits obviously). </p>\n\n<p>However, if I use small values like <code>10</code> it prints large chunks of chars to the terminal. </p>\n\n<p>Two questions arise. </p>\n\n<p>First. Is it a terminal buffering issue? Or Haskell buffers IO somehow? Can I disable it? </p>\n\n<p>Second. Can I use such technique for writing a game loop for a server with multiple game rooms with independently calculated states? Like you create a room for 2 players starting a fight, <code>forkIO</code> thread does all math and 30 times per second reports updated state back to players TCP sockets. </p>\n\n<p>Could you also recommend the best thread communication pattern for such task? STM? I used to use Erlangs actors for similar tasks in the past. But seems people try to avoid actors in Haskell.</p>\n"}, {"tags": ["haskell", "frp", "reactive-banana"], "comments": [{"owner": {"reputation": 13807, "user_id": 2407038, "user_type": "registered", "accept_rate": 64, "profile_image": "https://www.gravatar.com/avatar/538f6f4a9aa43841841de7d8e8b169fc?s=128&d=identicon&r=PG&f=1", "display_name": "user2407038", "link": "https://stackoverflow.com/users/2407038/user2407038"}, "edited": false, "score": 0, "creation_date": 1497908778, "post_id": 44639908, "comment_id": 76266907, "body": "There are plenty of examples/tutorials to be found on the internet. What have you tried and how did it not work? (The function you want for dealing with user input events like keypresses is <a href=\"https://hackage.haskell.org/package/reactive-banana-1.1.0.1/docs/Reactive-Banana-Frameworks.html#v:fromAddHandler\" rel=\"nofollow noreferrer\"><code>fromAddHandler</code></a>)"}, {"owner": {"reputation": 585, "user_id": 4190654, "user_type": "registered", "accept_rate": 71, "profile_image": "https://www.gravatar.com/avatar/7486a064e377ff1f77a407642b80272f?s=128&d=identicon&r=PG&f=1", "display_name": "ftl", "link": "https://stackoverflow.com/users/4190654/ftl"}, "reply_to_user": {"reputation": 13807, "user_id": 2407038, "user_type": "registered", "accept_rate": 64, "profile_image": "https://www.gravatar.com/avatar/538f6f4a9aa43841841de7d8e8b169fc?s=128&d=identicon&r=PG&f=1", "display_name": "user2407038", "link": "https://stackoverflow.com/users/2407038/user2407038"}, "edited": false, "score": 0, "creation_date": 1497909968, "post_id": 44639908, "comment_id": 76267342, "body": "Yup, I think I have figured it out, just after posting. It seems that I just needed a bit of rest. I&#39;ll post my answer, in case there is any interest, otherwise the question can be closed. Thank you."}, {"owner": {"reputation": 13807, "user_id": 2407038, "user_type": "registered", "accept_rate": 64, "profile_image": "https://www.gravatar.com/avatar/538f6f4a9aa43841841de7d8e8b169fc?s=128&d=identicon&r=PG&f=1", "display_name": "user2407038", "link": "https://stackoverflow.com/users/2407038/user2407038"}, "edited": false, "score": 1, "creation_date": 1497910221, "post_id": 44639908, "comment_id": 76267437, "body": "There is no need to close it - edit the question to include some code showing where you originally got stuck, and then post the answer containing the solution you found. Self-answered questions are a perfectly valid format for SO! You don&#39;t do this for any particular person who has an interest; it is for the posterity of <i>all</i> future readers."}], "answers": [{"tags": [], "owner": {"reputation": 585, "user_id": 4190654, "user_type": "registered", "accept_rate": 71, "profile_image": "https://www.gravatar.com/avatar/7486a064e377ff1f77a407642b80272f?s=128&d=identicon&r=PG&f=1", "display_name": "ftl", "link": "https://stackoverflow.com/users/4190654/ftl"}, "is_accepted": true, "score": 2, "last_activity_date": 1497917888, "last_edit_date": 1497917888, "creation_date": 1497917459, "answer_id": 44641750, "question_id": 44639908, "link": "https://stackoverflow.com/questions/44639908/reactive-banana-bindings/44641750#44641750", "title": "Reactive Banana: Bindings", "body": "<p>As it turns out, dealing with external events is remarkably flexible and simple with Reactive Banana. All that is needed is to create an event handler with \"newAddHandler\" which consists of two pieces, an \"AddHandler\" from which events can be created using the reactimate function, and a Handler which has to be invoked by the glue code (binding) that bridges Reactive Banana to the framework (in my case, I just feed the result of getChar to the handler).</p>\n\n<p>Here is an example code that echos keystrokes:</p>\n\n<pre><code>echo = do\n  (keyEventHandler, fire) &lt;- newAddHandler\n\n  -- Network Specification (echo keyboard input)\n  let networkDescription =\n      fromAddHandler keyEventHandler &gt;&gt;= -- Create event stream from handler\n      reactimate . fmap print -- Map print over event stream\n\n  compile networkDescription &gt;&gt;= actuate \n\n  -- Event Loop\n  hSetBuffering stdin NoBuffering   \n  forever $ do\n      ready &lt;- hReady stdin\n      if ready\n          then getChar &gt;&gt;= fire -- Create keyboad event\n          else return ()\n</code></pre>\n\n<p>The nice thing about reactive banana is that the callback function \"fire\" can be invoked from any context. Thus, the event loop could as well run in a thread or be invoked from a C library. More about this can be found by Heinrich's answer to <a href=\"https://stackoverflow.com/questions/12685430/how-to-implement-a-game-loop-in-reactive-banana\">How to implement a game loop in reactive-banana?</a>.</p>\n\n<p>However, catching arbitrary keyboard input events without polling is not as easy as I thought, POSIX won't allow it (if I am not mistaken) and even if it did the code would not be portable.\nAlso note that on Windows machines, you have to hit enter, I still have to find a way around that problem. More on this issue is found <a href=\"http://hackage.haskell.org/trac/ghc/ticket/2189\" rel=\"nofollow noreferrer\">at the Haskell bugtracker</a></p>\n"}], "owner": {"reputation": 585, "user_id": 4190654, "user_type": "registered", "accept_rate": 71, "profile_image": "https://www.gravatar.com/avatar/7486a064e377ff1f77a407642b80272f?s=128&d=identicon&r=PG&f=1", "display_name": "ftl", "link": "https://stackoverflow.com/users/4190654/ftl"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 137, "favorite_count": 0, "accepted_answer_id": 44641750, "answer_count": 1, "score": 2, "last_activity_date": 1497917888, "creation_date": 1497906094, "question_id": 44639908, "link": "https://stackoverflow.com/questions/44639908/reactive-banana-bindings", "title": "Reactive Banana: Bindings", "body": "<p>I am working on a small terminal-based UI and I want to use Reactive Banana for describing interactions. The only external event I am interested in, is whether the user has pressed a key. </p>\n\n<p>From what I gathered from the Frameworks documentation, I can either use polling to get the state of the terminal input buffer or pass an \"event handler\" to Reactive Banana. I'd rather prefer the latter, but I find the event handling section confusing. How exactly would I describe an event-driven version of getChar? In the end, I'd like to operate on an \"Event Key\" stream.</p>\n\n<p>I have looked at the SDL and wx bindings, but I don't find them of much help, since they are littered with library related idiosyncracies, and I'd much appreciate a more concise explanation how event handlers, event loops and Reactive Banana mix together. </p>\n"}, {"tags": ["haskell", "search", "functional-programming"], "comments": [{"owner": {"reputation": 314794, "user_id": 67579, "user_type": "registered", "accept_rate": 81, "profile_image": "https://i.stack.imgur.com/BJXub.png?s=128&g=1", "display_name": "Willem Van Onsem", "link": "https://stackoverflow.com/users/67579/willem-van-onsem"}, "edited": false, "score": 1, "creation_date": 1497891346, "post_id": 44636042, "comment_id": 76257827, "body": "If <code>a</code> is <i>hashable</i>, you can use a <i>hashset</i>."}], "answers": [{"tags": [], "owner": {"reputation": 14582, "user_id": 2225384, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/f30b04ed4d0b3fc4bc791a28815f34ca?s=128&d=identicon&r=PG", "display_name": "Rein Henrichs", "link": "https://stackoverflow.com/users/2225384/rein-henrichs"}, "is_accepted": true, "score": 3, "last_activity_date": 1497895435, "last_edit_date": 1497895435, "creation_date": 1497894336, "answer_id": 44636844, "question_id": 44636042, "link": "https://stackoverflow.com/questions/44636042/keep-record-of-previously-visited-states-when-searching/44636844#44636844", "title": "Keep record of previously visited states when searching", "body": "<p>The answer depends on what constraints your elements have (or can be given).</p>\n\n<p>If your elements have an <code>Ord</code> constraint then you can use <a href=\"http://hackage.haskell.org/package/containers-0.5.10.2/docs/Data-Set.html\" rel=\"nofollow noreferrer\"><code>Data.Set</code></a> from containers to get <code>O(log n)</code> membership tests.</p>\n\n<p>If your elements have a <code>Hashable</code> constraint then you can use a <a href=\"https://www.stackage.org/haddock/lts-8.19/unordered-containers-0.2.8.0/Data-HashSet.html#t:HashSet\" rel=\"nofollow noreferrer\"><code>HashSet</code></a> from unordered-containers to get <code>O(log n)</code> membership tests with better constant factors* and a large enough base that they are effectively constant time for most use cases.</p>\n\n<p>If your elements only have an <code>Eq</code> constraint then you can't do better than a list.</p>\n\n<hr>\n\n<p>* Depending on the performance of the <code>Hashable</code> instance. When in doubt, benchmark.</p>\n"}], "owner": {"reputation": 265, "user_id": 7430178, "user_type": "registered", "accept_rate": 75, "profile_image": "https://i.stack.imgur.com/phrjq.jpg?s=128&g=1", "display_name": "Diego Vicente", "link": "https://stackoverflow.com/users/7430178/diego-vicente"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 68, "favorite_count": 0, "accepted_answer_id": 44636844, "answer_count": 1, "score": 0, "last_activity_date": 1497895435, "creation_date": 1497891279, "question_id": 44636042, "link": "https://stackoverflow.com/questions/44636042/keep-record-of-previously-visited-states-when-searching", "title": "Keep record of previously visited states when searching", "body": "<p>I am programming several search functions, for which I use the <code>Node</code> datatype:</p>\n\n<pre><code>data Node a =\n  Node { [...]\n       , getPath :: [a]    -- ^ Previous states this node has visited\n       }\n</code></pre>\n\n<p>That field, <code>getPath</code>, is what I use to check if I have previously visited that state in that node: when expanding a new node, I check that by doing:</p>\n\n<pre><code>visited = `elem` path\n</code></pre>\n\n<p>It works, but it becomes incredibly costly when there are a lot of nodes expanded and the paths become too long. Is there a better way to keep track of the states I have visited? Maybe a different data structure (instead of a list) that performs better for this use?</p>\n"}, {"tags": ["haskell", "yesod"], "comments": [{"owner": {"reputation": 20862, "user_id": 376113, "user_type": "registered", "accept_rate": 72, "profile_image": "https://www.gravatar.com/avatar/d3a5bd12fe6d876527a3cf4ac0de5fc6?s=128&d=identicon&r=PG", "display_name": "mb14", "link": "https://stackoverflow.com/users/376113/mb14"}, "edited": false, "score": 0, "creation_date": 1497942040, "post_id": 44636039, "comment_id": 76277016, "body": "Use ^{...} Instead."}, {"owner": {"reputation": 5139, "user_id": 705510, "user_type": "registered", "accept_rate": 89, "profile_image": "https://i.stack.imgur.com/7xrNQ.png?s=128&g=1", "display_name": "McBear Holden", "link": "https://stackoverflow.com/users/705510/mcbear-holden"}, "reply_to_user": {"reputation": 20862, "user_id": 376113, "user_type": "registered", "accept_rate": 72, "profile_image": "https://www.gravatar.com/avatar/d3a5bd12fe6d876527a3cf4ac0de5fc6?s=128&d=identicon&r=PG", "display_name": "mb14", "link": "https://stackoverflow.com/users/376113/mb14"}, "edited": false, "score": 0, "creation_date": 1497942744, "post_id": 44636039, "comment_id": 76277496, "body": "@mb14 thx but it&#39;s not working"}, {"owner": {"reputation": 20862, "user_id": 376113, "user_type": "registered", "accept_rate": 72, "profile_image": "https://www.gravatar.com/avatar/d3a5bd12fe6d876527a3cf4ac0de5fc6?s=128&d=identicon&r=PG", "display_name": "mb14", "link": "https://stackoverflow.com/users/376113/mb14"}, "edited": false, "score": 0, "creation_date": 1497956578, "post_id": 44636039, "comment_id": 76287411, "body": "to use ^{..} you need have a widget instead of a string (or text). You need transform somehow <code>high</code> to be a widget (maybe generate it using <code>[whamlet|..|]</code>."}], "answers": [{"tags": [], "owner": {"reputation": 30377, "user_id": 369198, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/71596bb1ca3ba3aa4400c3f407baec9f?s=128&d=identicon&r=PG", "display_name": "Michael Snoyman", "link": "https://stackoverflow.com/users/369198/michael-snoyman"}, "is_accepted": true, "score": 3, "last_activity_date": 1497954378, "creation_date": 1497954378, "answer_id": 44650483, "question_id": 44636039, "link": "https://stackoverflow.com/questions/44636039/yesod-whamlet-render-as-html-without-being-escaped/44650483#44650483", "title": "Yesod Whamlet render as HTML without being escaped", "body": "<p>As a protection against XSS attacks, the default behavior of Hamlet (and the underlying blaze-html library) is to escape all HTML entities via the <code>toHtml</code> function. If you want to avoid that escaping, you can use <a href=\"https://www.stackage.org/haddock/lts-8.19/blaze-html-0.8.1.3/Text-Blaze-Html.html#v:preEscapedToHtml\" rel=\"nofollow noreferrer\">preEscapedToHtml</a>. Note that using this function on user-supplied data is <em>highly dangerous</em>.</p>\n"}], "owner": {"reputation": 5139, "user_id": 705510, "user_type": "registered", "accept_rate": 89, "profile_image": "https://i.stack.imgur.com/7xrNQ.png?s=128&g=1", "display_name": "McBear Holden", "link": "https://stackoverflow.com/users/705510/mcbear-holden"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 196, "favorite_count": 0, "accepted_answer_id": 44650483, "answer_count": 1, "score": 1, "last_activity_date": 1497954378, "creation_date": 1497891268, "last_edit_date": 1497947737, "question_id": 44636039, "link": "https://stackoverflow.com/questions/44636039/yesod-whamlet-render-as-html-without-being-escaped", "title": "Yesod Whamlet render as HTML without being escaped", "body": "<pre><code>[whamlet|\n\n          &lt;h2&gt; Here's the ES results:\n           &lt;h1&gt;\n            &lt;ul&gt;\n                $forall EsHighlight high &lt;- highlights re\n                    &lt;li&gt;\n                        &lt;br&gt;\n                        #{toHtml high}\n\n      |]\n</code></pre>\n\n<p>high is something like this:</p>\n\n<pre><code>\"large &lt;em&gt;bamboo&lt;/em&gt;, and a crotched stick. Throwing these down, he poked under a pile of rubbish, and brought out a rough block of wood, pierced through and through with a hole, which was immediately clapped on the top of the jar. Then planting the crotched stick upright about two yards distant, and making it sustain one end of the &lt;em&gt;bamboo&lt;/em&gt;, he inserted the other end of the latter into the hole in the block: concluding these arrangements by placing an old calabash under the farther end of the &lt;em&gt;bamboo&lt;/em&gt;.\"\n</code></pre>\n\n<p>The problem is that <code>&lt;em&gt;</code> is not rendered into html but remained string. So the webpage show <code>&lt;em&gt;</code> itself.\nWhat can I do?</p>\n"}, {"tags": ["haskell", "haskell-platform"], "comments": [{"owner": {"user_type": "does_not_exist", "display_name": "user933161"}, "edited": false, "score": 1, "creation_date": 1497888266, "post_id": 44635081, "comment_id": 76256039, "body": "What does it mean &quot;not running&quot;?"}, {"owner": {"reputation": 93, "user_id": 4564798, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/187f9717149081b976cff7068e7b0fb5?s=128&d=identicon&r=PG&f=1", "display_name": "user4564798", "link": "https://stackoverflow.com/users/4564798/user4564798"}, "edited": false, "score": 0, "creation_date": 1497888430, "post_id": 44635081, "comment_id": 76256131, "body": "@Igor When I run it, it says &quot;not responding&quot; on the top bar, and nothing happens if I leave it for hours. I tried to un-install and re-install it again, but it was the same."}, {"owner": {"reputation": 46777, "user_id": 1100107, "user_type": "registered", "accept_rate": 80, "profile_image": "https://www.gravatar.com/avatar/8789d3da0b482bcd8e562bfdf3687c74?s=128&d=identicon&r=PG", "display_name": "St&#233;phane Laurent", "link": "https://stackoverflow.com/users/1100107/st%c3%a9phane-laurent"}, "edited": false, "score": 0, "creation_date": 1497958340, "post_id": 44635081, "comment_id": 76288756, "body": "For me it works but honestly it&#39;s not terrible. I prefer the &quot;normal&quot; GHCi. It&#39;s not worth spending your time for that (unless that&#39;s me who has not found how to use it correctly)."}, {"owner": {"reputation": 93, "user_id": 4564798, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/187f9717149081b976cff7068e7b0fb5?s=128&d=identicon&r=PG&f=1", "display_name": "user4564798", "link": "https://stackoverflow.com/users/4564798/user4564798"}, "reply_to_user": {"reputation": 46777, "user_id": 1100107, "user_type": "registered", "accept_rate": 80, "profile_image": "https://www.gravatar.com/avatar/8789d3da0b482bcd8e562bfdf3687c74?s=128&d=identicon&r=PG", "display_name": "St&#233;phane Laurent", "link": "https://stackoverflow.com/users/1100107/st%c3%a9phane-laurent"}, "edited": false, "score": 0, "creation_date": 1497962900, "post_id": 44635081, "comment_id": 76292243, "body": "@St&#233;phaneLaurent Tell me please how to do the following: I want to write some lines of code in a (text) file. So I can store them. Then, I want to run them in GHCi."}, {"owner": {"reputation": 403, "user_id": 6872977, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/Da7XT.jpg?s=128&g=1", "display_name": "Rom&#225;n Garc&#237;a", "link": "https://stackoverflow.com/users/6872977/rom%c3%a1n-garc%c3%ada"}, "edited": false, "score": 0, "creation_date": 1497968203, "post_id": 44635081, "comment_id": 76296465, "body": "Save your text file with extension .hs. Double click on the file icon, and WinGHCi should open it"}, {"owner": {"reputation": 46777, "user_id": 1100107, "user_type": "registered", "accept_rate": 80, "profile_image": "https://www.gravatar.com/avatar/8789d3da0b482bcd8e562bfdf3687c74?s=128&d=identicon&r=PG", "display_name": "St&#233;phane Laurent", "link": "https://stackoverflow.com/users/1100107/st%c3%a9phane-laurent"}, "edited": false, "score": 0, "creation_date": 1497968748, "post_id": 44635081, "comment_id": 76296896, "body": "@user4564798 You want that <a href=\"https://stackoverflow.com/q/41313467/1100107\">stackoverflow.com/q/41313467/1100107</a> ?"}, {"owner": {"reputation": 93, "user_id": 4564798, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/187f9717149081b976cff7068e7b0fb5?s=128&d=identicon&r=PG&f=1", "display_name": "user4564798", "link": "https://stackoverflow.com/users/4564798/user4564798"}, "edited": false, "score": 0, "creation_date": 1497969319, "post_id": 44635081, "comment_id": 76297367, "body": "@user4564798 Thanks, but it&#39;s not running. My GHCi loads Prelude&gt;"}, {"owner": {"reputation": 93, "user_id": 4564798, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/187f9717149081b976cff7068e7b0fb5?s=128&d=identicon&r=PG&f=1", "display_name": "user4564798", "link": "https://stackoverflow.com/users/4564798/user4564798"}, "edited": false, "score": 0, "creation_date": 1497973929, "post_id": 44635081, "comment_id": 76300737, "body": "ok, here how I managed to call a file from GHCi  (thanks for your comments and help): I store my code (statring with main=print() ) in a test.hs file. Where test.hs is text file. Then, in GHCi when Prelude&gt; shows up I do the following:    :! ghc test.hs    and then  :load *test.hs          So I can use GHCi and avoid using WinGHCi (as it&#39;s still not working)."}], "owner": {"reputation": 93, "user_id": 4564798, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/187f9717149081b976cff7068e7b0fb5?s=128&d=identicon&r=PG&f=1", "display_name": "user4564798", "link": "https://stackoverflow.com/users/4564798/user4564798"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 418, "favorite_count": 0, "answer_count": 0, "score": 0, "last_activity_date": 1497893989, "creation_date": 1497887846, "last_edit_date": 1497893989, "question_id": 44635081, "link": "https://stackoverflow.com/questions/44635081/winghci-not-running-on-windows-7", "title": "WinGHCi not running on Windows 7", "body": "<p>I'm very new to Haskell programming language. </p>\n\n<p>I've installed a Haskell platform 8.0.2 on Windows 7: WinGHCi, but it's not running.</p>\n\n<p>I can install and run GHCi, but NOT WinGHCi.</p>\n"}, {"tags": ["haskell", "binary-search-tree"], "comments": [{"owner": {"reputation": 314794, "user_id": 67579, "user_type": "registered", "accept_rate": 81, "profile_image": "https://i.stack.imgur.com/BJXub.png?s=128&g=1", "display_name": "Willem Van Onsem", "link": "https://stackoverflow.com/users/67579/willem-van-onsem"}, "edited": false, "score": 2, "creation_date": 1497886073, "post_id": 44634397, "comment_id": 76254497, "body": "What error does it produce?"}, {"owner": {"reputation": 314794, "user_id": 67579, "user_type": "registered", "accept_rate": 81, "profile_image": "https://i.stack.imgur.com/BJXub.png?s=128&g=1", "display_name": "Willem Van Onsem", "link": "https://stackoverflow.com/users/67579/willem-van-onsem"}, "edited": false, "score": 0, "creation_date": 1497886144, "post_id": 44634397, "comment_id": 76254556, "body": "Furthermore please include the definition of <code>BinaryTree a</code>."}], "answers": [{"comments": [{"owner": {"reputation": 75362, "user_id": 625403, "user_type": "registered", "accept_rate": 82, "profile_image": "https://www.gravatar.com/avatar/786eed7da67079cb5d63a49d469af25b?s=128&d=identicon&r=PG", "display_name": "amalloy", "link": "https://stackoverflow.com/users/625403/amalloy"}, "edited": false, "score": 0, "creation_date": 1497888955, "post_id": 44634572, "comment_id": 76256437, "body": "<code>myTree</code> is a pattern that matches anything, not a constructor."}, {"owner": {"reputation": 314794, "user_id": 67579, "user_type": "registered", "accept_rate": 81, "profile_image": "https://i.stack.imgur.com/BJXub.png?s=128&g=1", "display_name": "Willem Van Onsem", "link": "https://stackoverflow.com/users/67579/willem-van-onsem"}, "reply_to_user": {"reputation": 75362, "user_id": 625403, "user_type": "registered", "accept_rate": 82, "profile_image": "https://www.gravatar.com/avatar/786eed7da67079cb5d63a49d469af25b?s=128&d=identicon&r=PG", "display_name": "amalloy", "link": "https://stackoverflow.com/users/625403/amalloy"}, "edited": false, "score": 0, "creation_date": 1497889182, "post_id": 44634572, "comment_id": 76256555, "body": "@amalloy: yeah, somehow i did not notice the lowercase, thanks."}], "tags": [], "owner": {"reputation": 314794, "user_id": 67579, "user_type": "registered", "accept_rate": 81, "profile_image": "https://i.stack.imgur.com/BJXub.png?s=128&g=1", "display_name": "Willem Van Onsem", "link": "https://stackoverflow.com/users/67579/willem-van-onsem"}, "is_accepted": false, "score": 3, "last_activity_date": 1497909197, "last_edit_date": 1497909197, "creation_date": 1497886406, "answer_id": 44634572, "question_id": 44634397, "link": "https://stackoverflow.com/questions/44634397/haskell-binary-search-tree/44634572#44634572", "title": "Haskell - Binary Search Tree", "body": "<p><strong>Inorder</strong> means that you (1) first process the left subtree, (2) then process the node itself, and (3) finally process the right subtree.</p>\n\n<h1>Leaves without values</h1>\n\n<p>Based on your function, the definition of <code>BinaryTree a</code>, is probably:</p>\n\n<pre><code>data BinaryTree a = Leaf | Node (BinaryTree a) a (BinaryTree a)\n</code></pre>\n\n<p>So that means that there are two cases: in case of a leaf, there is no data, so we simply return the given value:</p>\n\n<pre><code>inorder' _ a Leaf = a -- with an uppercase, otherwise it does match all\n</code></pre>\n\n<p>And for the <code>Node</code> case, we above already stated how that works:</p>\n\n<pre><code>inorder' f a (Node left val right) = inorder' f <b>c</b> right\n    where <b>b</b> = inorder' f a left\n          <b>c</b> = f <b>b val</b></code></pre>\n\n<p>Or in full:</p>\n\n<pre><code>inorder' :: (b -&gt; a -&gt; b) -&gt; b -&gt; BinaryTree a -&gt; b\ninorder' _ a Leaf = a\ninorder' f a (Node left val right) = inorder' f c right\n    where b = inorder' f a left\n          c = f b val\n</code></pre>\n\n<h1>Leaves with values</h1>\n\n<p>In that case the <code>BinaryTree</code> is defined like:</p>\n\n<pre><code>data BinaryTree a = Leaf a | Node (BinaryTree a) a (BinaryTree a)\n</code></pre>\n\n<p>In case the leaves have a value, we simply need to fix the first clause:</p>\n\n<pre><code>inorder' :: (b -> a -> b) -> b -> BinaryTree a -> b\ninorder' f b <b>(Leaf a)</b> = <b>f b a</b>\ninorder' f a (Node left val right) = inorder' f c right\n    where b = inorder' f a left\n          c = f b val</code></pre>\n"}], "owner": {"reputation": 21, "user_id": 8132852, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/335d66f35a48f936d7b6395163283c15?s=128&d=identicon&r=PG&f=1", "display_name": "CovenantMan", "link": "https://stackoverflow.com/users/8132852/covenantman"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 718, "favorite_count": 0, "answer_count": 1, "score": 1, "last_activity_date": 1497909197, "creation_date": 1497885905, "last_edit_date": 1497901086, "question_id": 44634397, "link": "https://stackoverflow.com/questions/44634397/haskell-binary-search-tree", "title": "Haskell - Binary Search Tree", "body": "<p>Being a beginner in Haskell I am currently trying to get my head around BST. Currently I am trying to perform a fold on a tree inorder.</p>\n\n<p>This is what I got so far, but it produces an error.</p>\n\n<pre><code>inorder' :: (b -&gt; a -&gt; b) -&gt; b -&gt; BinaryTree a -&gt; b\ninorder' _ a myTree = a\ninorder' fun a (Node left root right) = inorder' fun (fun root (inorder' fun a left)) right\n</code></pre>\n\n<p>I am really dumbfounded now because I worked for quite some time now to figure out what exactly the problem is but I simply do not seem to come up with a solution.</p>\n"}, {"tags": ["haskell"], "comments": [{"owner": {"reputation": 100892, "user_id": 745903, "user_type": "registered", "accept_rate": 74, "profile_image": "https://www.gravatar.com/avatar/50933f6638836741e620669b3940410e?s=128&d=identicon&r=PG", "display_name": "leftaroundabout", "link": "https://stackoverflow.com/users/745903/leftaroundabout"}, "edited": false, "score": 3, "creation_date": 1497879691, "post_id": 44632182, "comment_id": 76249744, "body": "Your question appears to have little to do with FRP and arrows, regardless of the tutorial you took the example from. Please tag accordingly."}, {"owner": {"reputation": 13807, "user_id": 2407038, "user_type": "registered", "accept_rate": 64, "profile_image": "https://www.gravatar.com/avatar/538f6f4a9aa43841841de7d8e8b169fc?s=128&d=identicon&r=PG&f=1", "display_name": "user2407038", "link": "https://stackoverflow.com/users/2407038/user2407038"}, "edited": false, "score": 0, "creation_date": 1497909890, "post_id": 44632182, "comment_id": 76267300, "body": "The state doesn&#39;t have to be explicitly stored anywhere. It works exactly like <code>State</code>, which is a function <code>s -&gt; (a, s)</code>. <code>State</code> is significantly simpler, so undestanding it should be more accesible, but the principle is exactly the same. The page you linked gives a dead simple definition of <code>runCircuit</code> - <code>\\cir -&gt; snd . mapAccumL unCircuit cir</code>. In this definition, it is <code>mapAccumL</code> which deals with feeding each previous state to the subsequent definition. <code>Circuit</code> itself is just a representation of a stateful computation - all the magic happens inside <code>mapAccumL</code>."}], "answers": [{"tags": [], "owner": {"reputation": 532, "user_id": 660339, "user_type": "registered", "accept_rate": 40, "profile_image": "https://www.gravatar.com/avatar/ba401042a68ed65c16f73c8cf3a15287?s=128&d=identicon&r=PG", "display_name": "Ivan Perez", "link": "https://stackoverflow.com/users/660339/ivan-perez"}, "is_accepted": true, "score": 3, "last_activity_date": 1497961725, "last_edit_date": 1497961725, "creation_date": 1497939043, "answer_id": 44645106, "question_id": 44632182, "link": "https://stackoverflow.com/questions/44632182/haskell-arrow-tutorial-loop-state/44645106#44645106", "title": "Haskell arrow tutorial loop/state", "body": "<p>Interact does not run the function per line. <code>interact</code> and <code>runCircuit</code> are lazy. Because you split the input in lines and concatenate the output, you'll see the progress of <code>runCircuit</code> as you provide more and more input.</p>\n\n<p>The function <code>runCircuit</code> is defined as follows:</p>\n\n<pre><code>runCircuit :: Circuit a b -&gt; [a] -&gt; [b]\nrunCircuit _   []     = []\nrunCircuit cir (x:xs) =\n    let (cir',x') = unCircuit cir x\n    in  x' : runCircuit cir' xs\n</code></pre>\n\n<p>There you see that you produce one element in the output list for each element in the input list (each line). Which already indicates that you'll be able to process the list lazily. (For comparison: if it required the length of <code>xs</code> to produce the first output <code>x'</code>, then <code>runCircuit</code> would <em>not</em> be lazy.)</p>\n\n<p>Let's put that together with the definition of <code>Circuit</code>:</p>\n\n<pre><code>data Circuit a b = Circuit { unCircuit :: a -&gt; (Circuit a b, b) }\n</code></pre>\n\n<p>The way you run a circuit is that you provide a first input <code>x</code> of type <code>a</code> and obtain not only a first output <code>x'</code> of type <code>b</code>, but also a <em>continuation</em> <code>Circuit</code> (<code>cir'</code> in <code>runCircuit</code>). This continuation is a new <code>Circuit a b</code>, used by <code>runCircuit</code> in the next iteration. That is how state is kept: the new <code>Circuit</code> will be similar to the original one, but it may have been affected by previous inputs.</p>\n\n<p>For example, you could define a circuit that sums Ints and produces the total sum. There is one example in that article, but to make things super-simple:</p>\n\n<pre><code>mySum :: Circuit Int Int\nmySum = mySum' 0\n\nmySum' :: Int -&gt; Circuit Int Int\nmySum' acc = Circuit $ \\input -&gt;\n  let acc' = acc + input\n  in (mySum' acc', acc')\n</code></pre>\n\n<p>In each iteration, the continuation <code>Circuit</code> returned, <code>mySum' acc'</code>, uses <code>acc'</code>, the new accumulator, which contains the sum up to that point. So this <code>Circuit</code> keeps state because it remembers or carries forward the sum of all numbers up to that point.</p>\n\n<p>Back to that article, the slightly more general function:</p>\n\n<pre><code>accum :: acc -&gt; (a -&gt; acc -&gt; (b, acc)) -&gt; Circuit a b\naccum acc f = Circuit $ \\input -&gt;\n    let (output, acc') = input `f` acc\n    in  (accum acc' f, output)\n</code></pre>\n\n<p>returns a <em>continuation</em> <code>Circuit</code> in the first argument of the tuple that is different from itself. It was called as <code>accum acc f</code>, but the continuation is <code>accum acc' f</code>, where <code>acc'</code> depends on the <code>input</code> and <code>acc</code>, so it retains memory in this accumulator.</p>\n\n<p>Using continuations is very, very common. I think most pipe/stream-processing frameworks and many FRP implementations do this, including Yampa, Varying, Dunai and netwire.</p>\n"}], "owner": {"reputation": 2030, "user_id": 1570690, "user_type": "registered", "accept_rate": 67, "profile_image": "https://www.gravatar.com/avatar/6d04a38c7bd1be75cf6471ddcd5b69bf?s=128&d=identicon&r=PG", "display_name": "Beau Trepp", "link": "https://stackoverflow.com/users/1570690/beau-trepp"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 354, "favorite_count": 0, "accepted_answer_id": 44645106, "answer_count": 1, "score": 1, "last_activity_date": 1497961725, "creation_date": 1497879533, "last_edit_date": 1497884085, "question_id": 44632182, "link": "https://stackoverflow.com/questions/44632182/haskell-arrow-tutorial-loop-state", "title": "Haskell arrow tutorial loop/state", "body": "<p>From this\n<a href=\"https://en.wikibooks.org/wiki/Haskell/Arrow_tutorial#Hangman:_Main_program\" rel=\"nofollow noreferrer\">https://en.wikibooks.org/wiki/Haskell/Arrow_tutorial#Hangman:_Main_program</a></p>\n\n<p>How is the IO done?. Particulary</p>\n\n<pre><code>main :: IO ()\nmain = do\n    rng &lt;- getStdGen\n    interact $ unlines                      -- Concatenate lines out output\n        . (\"Welcome to Arrow Hangman\":)     -- Prepend a greeting to the output\n        . concat . map snd . takeWhile fst  -- Take the [String]s as long as the first element of the tuples is True\n        . runCircuit (hangman rng)          -- Process the input lazily\n        . (\"\":)                             -- Act as if the user pressed ENTER once at the start\n        . lines                             -- Split input into lines\n</code></pre>\n\n<p>Interact appears to be (string -> string ) -> IO (). With the impression that it prints runs that function per line that it reads. What confuses me is, How is the initial line printed. Where is the state of the game stored in between?.</p>\n\n<p>runCircuit was used earlier in a way in which it had all the inputs already generated. I'm confused as to how this version runs line by line, but doesn't appear to store any state?. </p>\n\n<p>how can <code>Circuit String (Bool, [String])</code> be ran by <code>runCircuit :: Circuit a b -&gt; [a] -&gt; [b]</code> in a line-by-line fashion?. In a way that appears to remember what the previous results where?.</p>\n"}, {"tags": ["haskell", "record"], "answers": [{"tags": [], "owner": {"reputation": 28873, "user_id": 1068232, "user_type": "registered", "accept_rate": 79, "profile_image": "https://www.gravatar.com/avatar/2a0a145ce58c20013969fe3f203531da?s=128&d=identicon&r=PG", "display_name": "Andr&#225;s Kov&#225;cs", "link": "https://stackoverflow.com/users/1068232/andr%c3%a1s-kov%c3%a1cs"}, "is_accepted": true, "score": 10, "last_activity_date": 1497876876, "creation_date": 1497876876, "answer_id": 44631177, "question_id": 44630494, "link": "https://stackoverflow.com/questions/44630494/what-is-the-shortest-way-to-create-a-record-form-list/44631177#44631177", "title": "What is the shortest way to create a record form list?", "body": "<p><a href=\"https://downloads.haskell.org/~ghc/latest/docs/html/users_guide/glasgow_exts.html#record-wildcards\" rel=\"noreferrer\"><code>RecordWildCards</code></a> removes half of your boilerplate.</p>\n\n<pre><code>{-# LANGUAGE RecordWildCards #-}\n\nmkZone :: [String] -&gt; Zone\nmkZone xs = Zone {..}\n  where [zId, zOwnerId, zPodsP0, zPodsP1, zPodsP2, zPodsP3] = map read xs\n</code></pre>\n"}, {"tags": [], "owner": {"reputation": 3392, "user_id": 7175117, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/Tfz44.png?s=128&g=1", "display_name": "freestyle", "link": "https://stackoverflow.com/users/7175117/freestyle"}, "is_accepted": false, "score": 1, "last_activity_date": 1497882331, "last_edit_date": 1497882331, "creation_date": 1497881203, "answer_id": 44632797, "question_id": 44630494, "link": "https://stackoverflow.com/questions/44630494/what-is-the-shortest-way-to-create-a-record-form-list/44632797#44632797", "title": "What is the shortest way to create a record form list?", "body": "<p>You can do this with SYB, like this:</p>\n\n<pre><code>{-# LANGUAGE DeriveDataTypeable #-}\n{-# LANGUAGE ScopedTypeVariables #-}\n\nimport Data.Data\nimport Control.Monad.State\n\ndata Zone = Zone { zId, zOwnerId, zPodsP0, zPodsP1, zPodsP2, zPodsP3 :: Int }\n    deriving (Show, Data)\n\nmain = do\n    print (mygread [\"1\", \"2\", \"3\", \"4\", \"5\", \"6\"] :: Maybe Zone)\n    print (mygread [\"a\", \"2\", \"3\", \"4\", \"5\", \"6\"] :: Maybe Zone)\n    print (mygread [\"1\", \"2\", \"3\", \"4\", \"5\"] :: Maybe Zone)\n\nmygread :: forall a . Data a =&gt; [String] -&gt; Maybe a\nmygread = evalStateT (fromConstrM read' constr)\n  where\n    constr = head . dataTypeConstrs . dataTypeOf $ (undefined :: a)\n    read' :: forall a . Data a =&gt; StateT [String] Maybe a\n    read' = do\n        x:xs &lt;- get\n        put xs\n        lift . fmap fromConstr . readConstr (dataTypeOf (undefined :: a)) $ x\n</code></pre>\n\n<p>Output:</p>\n\n<pre><code>Just (Zone {zId = 1, zOwnerId = 2, zPodsP0 = 3, zPodsP1 = 4, zPodsP2 = 5, zPodsP3 = 6})\nNothing\nNothing\n</code></pre>\n\n<p>You only need to make your type an instance of Data (<code>deriving Data</code>).</p>\n"}, {"tags": [], "owner": {"reputation": 48938, "user_id": 246886, "user_type": "registered", "accept_rate": 94, "profile_image": "https://www.gravatar.com/avatar/dd1ebaade6623fc538fb8af3338e730d?s=128&d=identicon&r=PG", "display_name": "Jon Purdy", "link": "https://stackoverflow.com/users/246886/jon-purdy"}, "is_accepted": false, "score": 0, "last_activity_date": 1497916306, "last_edit_date": 1497916306, "creation_date": 1497910784, "answer_id": 44640829, "question_id": 44630494, "link": "https://stackoverflow.com/questions/44630494/what-is-the-shortest-way-to-create-a-record-form-list/44640829#44640829", "title": "What is the shortest way to create a record form list?", "body": "<p>Personally, I\u2019d go for <code>RecordWildCards</code> and call it a day. But here\u2019s another hackish-but-interesting way to do this, which may be useful in some circumstances: throw caution to the wind and use dynamic types to get a type-changing fold!</p>\n\n<pre><code>{-# LANGUAGE DeriveDataTypeable #-}\n\nimport Data.Dynamic (dynApp, fromDynamic, toDyn)\nimport Data.List (foldl')\nimport Data.Typeable (Typeable)\n\n-- Add the 'Typeable' instance to enable runtime type information.\ndata Zone = Zone\n  { zId, zOwnerId, zPodsP0, zPodsP1, zPodsP2, zPodsP3 :: Int\n  } deriving (Show, Typeable)\n\nmkZone :: [String] -&gt; Maybe Zone\nmkZone = fromDynamic . foldl' dynApp (toDyn Zone) . map (toDyn . readInt)\n  where\n\n    -- This type-specialised 'read' avoids an ambiguous type.\n    readInt :: String -&gt; Int\n    readInt = read\n</code></pre>\n\n<p>This starts from the <code>Zone</code> constructor, of type:</p>\n\n<pre><code>Int -&gt; Int -&gt; Int -&gt; Int -&gt; Int -&gt; Int -&gt; Zone\n</code></pre>\n\n<p>Then applies it successively to each <code>Int</code> read from the input, changing its type:</p>\n\n<pre><code>Int -&gt; Int -&gt; Int -&gt; Int -&gt; Int -&gt; Zone\nInt -&gt; Int -&gt; Int -&gt; Int -&gt; Zone\nInt -&gt; Int -&gt; Int -&gt; Zone\nInt -&gt; Int -&gt; Zone\nInt -&gt; Zone\nZone\n</code></pre>\n\n<p>And it works:</p>\n\n<pre><code>&gt; mkZone [\"1\", \"2\", \"3\", \"4\", \"5\", \"6\"]\nJust (Zone {zId = 1, zOwnerId = 2, zPodsP0 = 3, zPodsP1 = 4, zPodsP2 = 5, zPodsP3 = 6})\n</code></pre>\n\n<p>If you supply too few arguments, you get <code>Nothing</code> because the runtime cast fails:</p>\n\n<pre><code>&gt; mkZone [\"1\", \"2\", \"3\", \"4\", \"5\"]\nNothing\n</code></pre>\n\n<p>However, if you supply too <em>many</em> arguments, you get an exception:</p>\n\n<pre><code>&gt; mkZone [\"1\", \"2\", \"3\", \"4\", \"5\", \"6\", \"7\"]\n*** Exception: Type error in dynamic application.\nCan't apply function &lt;&lt;Zone&gt;&gt; to argument &lt;&lt;Int&gt;&gt;\n</code></pre>\n\n<p>That\u2019s easily fixed by using <code>dynApply</code> instead of <code>dynApp</code>, which returns a <code>Maybe</code> instead of throwing. And as long as you\u2019re working in <code>Maybe</code>, you might as well use <code>Text.Read.readMaybe</code> to handle parse errors:</p>\n\n<pre><code>{-# LANGUAGE DeriveDataTypeable #-}\n\nimport Control.Monad ((&lt;=&lt;))\nimport Data.Dynamic (Dynamic, dynApply, fromDynamic, toDyn)\nimport Data.List (foldl')\nimport Data.Typeable (Typeable)\nimport Text.Read (readMaybe)\n\ndata Zone = Zone { \u2026 } deriving (Show, Typeable)\n\nmkZone :: [String] -&gt; Maybe Zone\nmkZone = fromDynamic &lt;=&lt; foldl' go (Just (toDyn Zone)) . map readInt\n  where\n\n    go :: Maybe Dynamic -&gt; Maybe Int -&gt; Maybe Dynamic\n    go mAcc mx = do\n      acc &lt;- mAcc\n      x &lt;- mx\n      dynApply acc $ toDyn x\n\n    readInt :: String -&gt; Maybe Int\n    readInt = readMaybe\n</code></pre>\n\n<p>For real though, probably don\u2019t do this.</p>\n"}], "owner": {"reputation": 2141, "user_id": 1664572, "user_type": "registered", "accept_rate": 85, "profile_image": "https://www.gravatar.com/avatar/c2bee27fdb72050b60a3c6aae64b474f?s=128&d=identicon&r=PG", "display_name": "wizzup", "link": "https://stackoverflow.com/users/1664572/wizzup"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 585, "favorite_count": 2, "accepted_answer_id": 44631177, "answer_count": 3, "score": 6, "last_activity_date": 1497916306, "creation_date": 1497875026, "question_id": 44630494, "link": "https://stackoverflow.com/questions/44630494/what-is-the-shortest-way-to-create-a-record-form-list", "title": "What is the shortest way to create a record form list?", "body": "<p>Suppose I have record definition</p>\n\n<pre><code>data Zone = Zone\n  { zId      :: Int -- this zone's ID\n  , zOwnerId :: Int -- the player who owns this zone (-1 otherwise)\n  , zPodsP0  :: Int -- player 0's PODs on this zone\n  , zPodsP1  :: Int -- player 1's PODs on this zone\n  , zPodsP2  :: Int -- player 2's PODs on this zone (always 0 for a two player game)\n  , zPodsP3  :: Int -- player 3's PODs on this zone (always 0 for a two or three player game)\n  } deriving Show\n</code></pre>\n\n<p>What is the shortways to create record from <code>[String]</code> read from <code>getLine</code></p>\n\n<pre><code>zones &lt;- replicateM zoneCount $ fmap (mkZone . words) getLine\n</code></pre>\n\n<p>This is the best I can do so far.</p>\n\n<pre><code>{-# LANGUAGE NamedFieldPuns #-}\n\nmkZone :: [String] -&gt; Zone\nmkZone xs = Zone {zId, zOwnerId, zPodsP0, zPodsP1, zPodsP2, zPodsP3}\n  where [zId, zOwnerId, zPodsP0, zPodsP1, zPodsP2, zPodsP3] = map read xs\n</code></pre>\n\n<p>I use this pattern a lot when playing codingame <a href=\"https://www.codingame.com/multiplayer/bot-programming\" rel=\"noreferrer\">bot programmings</a>, It would be nice if there is a better way to do this.</p>\n"}, {"tags": ["haskell", "profiling", "ghc"], "comments": [{"owner": {"reputation": 100185, "user_id": 3234959, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/93bb12ca0f93dfddb33880316f7e66c2?s=128&d=identicon&r=PG&f=1", "display_name": "chi", "link": "https://stackoverflow.com/users/3234959/chi"}, "edited": false, "score": 0, "creation_date": 1497872326, "post_id": 44625126, "comment_id": 76244624, "body": "By the way: <code>f</code> is essentially a left fold, non strict. This is already &quot;bad&quot;, since it will always allocate a huge number of thunks, no matter what <code>tick</code> does. I&#39;d make that strict, and would also make <code>tick</code> force the components of the output pair. This is not what you are asking, but I can&#39;t see if you understand what&#39;s going on and you just want a confirmation in the profiling data (so to learn how to deal with more complex cases in the future)."}, {"owner": {"reputation": 100185, "user_id": 3234959, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/93bb12ca0f93dfddb33880316f7e66c2?s=128&d=identicon&r=PG&f=1", "display_name": "chi", "link": "https://stackoverflow.com/users/3234959/chi"}, "edited": false, "score": 0, "creation_date": 1497872749, "post_id": 44625126, "comment_id": 76244897, "body": "By the way, I compiled your exact code with -O2, on GHC 8.0.1, and got &lt;100kB memory usage. Without -O2 I get horrible performance."}, {"owner": {"reputation": 41, "user_id": 2924565, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/7b020248f4d63a79765741d174acb376?s=128&d=identicon&r=PG&f=1", "display_name": "Suresh Sudhakaran", "link": "https://stackoverflow.com/users/2924565/suresh-sudhakaran"}, "reply_to_user": {"reputation": 100185, "user_id": 3234959, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/93bb12ca0f93dfddb33880316f7e66c2?s=128&d=identicon&r=PG&f=1", "display_name": "chi", "link": "https://stackoverflow.com/users/3234959/chi"}, "edited": false, "score": 0, "creation_date": 1497877847, "post_id": 44625126, "comment_id": 76248458, "body": "On GHC 7.10.3 with -O2 it takes a little over 100MB, its a lot better than the unoptimised version. Seems there have been great improvements in 8.0.1"}, {"owner": {"reputation": 13807, "user_id": 2407038, "user_type": "registered", "accept_rate": 64, "profile_image": "https://www.gravatar.com/avatar/538f6f4a9aa43841841de7d8e8b169fc?s=128&d=identicon&r=PG&f=1", "display_name": "user2407038", "link": "https://stackoverflow.com/users/2407038/user2407038"}, "edited": false, "score": 0, "creation_date": 1497911366, "post_id": 44625126, "comment_id": 76267791, "body": "The profiler has told you which cost centres result in the allocation - it is the CAFs. Since you don&#39;t manually define CAFs, you need to look at the core for your program to see which expressions have become CAFs (unless you have a remarkable level of insight and experience and can predict exactly how the compiler compiles your program)."}], "answers": [{"comments": [{"owner": {"reputation": 41, "user_id": 2924565, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/7b020248f4d63a79765741d174acb376?s=128&d=identicon&r=PG&f=1", "display_name": "Suresh Sudhakaran", "link": "https://stackoverflow.com/users/2924565/suresh-sudhakaran"}, "edited": false, "score": 1, "creation_date": 1497876592, "post_id": 44629964, "comment_id": 76247550, "body": "Thanks, I do realize that making the arguments strict by adding bang notation will make the program work with a lot less space. But I am more interested in finding out what thunks are being created."}, {"owner": {"reputation": 41, "user_id": 2924565, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/7b020248f4d63a79765741d174acb376?s=128&d=identicon&r=PG&f=1", "display_name": "Suresh Sudhakaran", "link": "https://stackoverflow.com/users/2924565/suresh-sudhakaran"}, "edited": false, "score": 0, "creation_date": 1497877219, "post_id": 44629964, "comment_id": 76248019, "body": "I believe the evaluation of f [1,2,3,4] would go through these stages  f [2,3,4] tick 1 (0,1) -&gt; f [3,4] tick 2 (tick 1 (0,1)) -&gt; ... tick 4 (tick 3 ( tick 2 (tick 1 (0,1)))) -&gt;  a series of thunks of ticks, which would then evaluate to   tick 4 (tick 3 ( tick 2 (0+1,1))) -&gt; tick 4 (tick 3 (0+1, 1+1)) -&gt; ... (((0+1)+1),((1+1)+1))   which is a series of thunks of (+). However I am not able to correlate these stages of the computation with points in the graph, (particularly with the void component which suggests that objects are created but never used)"}, {"owner": {"reputation": 100185, "user_id": 3234959, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/93bb12ca0f93dfddb33880316f7e66c2?s=128&d=identicon&r=PG&f=1", "display_name": "chi", "link": "https://stackoverflow.com/users/3234959/chi"}, "reply_to_user": {"reputation": 41, "user_id": 2924565, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/7b020248f4d63a79765741d174acb376?s=128&d=identicon&r=PG&f=1", "display_name": "Suresh Sudhakaran", "link": "https://stackoverflow.com/users/2924565/suresh-sudhakaran"}, "edited": false, "score": 0, "creation_date": 1497877844, "post_id": 44629964, "comment_id": 76248454, "body": "@SureshSudhakaran I see. I guess the profiler will not show you all these thunks. However, we can see their total cost attributed to who created the thunks. <code>f</code> creates the <code>tick</code>-thunks quickly, which are then consumed more slowly by <code>print</code>. After <code>f</code> finally returns a pair, <code>print</code> will force the first component which will start allocating the <code>+1+1...</code> thunks (first black spike). Then, <code>print</code> does the same for the second component (second black spike)."}, {"owner": {"reputation": 41, "user_id": 2924565, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/7b020248f4d63a79765741d174acb376?s=128&d=identicon&r=PG&f=1", "display_name": "Suresh Sudhakaran", "link": "https://stackoverflow.com/users/2924565/suresh-sudhakaran"}, "edited": false, "score": 0, "creation_date": 1497878015, "post_id": 44629964, "comment_id": 76248569, "body": "Wouldn&#39;t the memory allocation for <code>+1+1</code> already have happened when the sequence of ticks were evaluated?"}, {"owner": {"reputation": 100185, "user_id": 3234959, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/93bb12ca0f93dfddb33880316f7e66c2?s=128&d=identicon&r=PG&f=1", "display_name": "chi", "link": "https://stackoverflow.com/users/3234959/chi"}, "reply_to_user": {"reputation": 41, "user_id": 2924565, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/7b020248f4d63a79765741d174acb376?s=128&d=identicon&r=PG&f=1", "display_name": "Suresh Sudhakaran", "link": "https://stackoverflow.com/users/2924565/suresh-sudhakaran"}, "edited": false, "score": 0, "creation_date": 1497878016, "post_id": 44629964, "comment_id": 76248571, "body": "@SureshSudhakaran I&#39;m also unable to correlate the <code>-hb</code> plot with the execution. I have no idea about the void part being like that, I find the <code>-hc</code> output clearer."}, {"owner": {"reputation": 100185, "user_id": 3234959, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/93bb12ca0f93dfddb33880316f7e66c2?s=128&d=identicon&r=PG&f=1", "display_name": "chi", "link": "https://stackoverflow.com/users/3234959/chi"}, "reply_to_user": {"reputation": 41, "user_id": 2924565, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/7b020248f4d63a79765741d174acb376?s=128&d=identicon&r=PG&f=1", "display_name": "Suresh Sudhakaran", "link": "https://stackoverflow.com/users/2924565/suresh-sudhakaran"}, "edited": false, "score": 0, "creation_date": 1497878146, "post_id": 44629964, "comment_id": 76248642, "body": "@SureshSudhakaran No, they weren&#39;t evaluated yet. First you build the <code>tick (tick (tick ...))</code> large thunk. Then you evaluate that, producing <code>(x,y)</code> where both <code>x,y</code> are unevaluated thunks <code>1+1+1+..</code> (roughly). Last, you perform those <code>+1</code>s."}, {"owner": {"reputation": 41, "user_id": 2924565, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/7b020248f4d63a79765741d174acb376?s=128&d=identicon&r=PG&f=1", "display_name": "Suresh Sudhakaran", "link": "https://stackoverflow.com/users/2924565/suresh-sudhakaran"}, "edited": false, "score": 0, "creation_date": 1497878461, "post_id": 44629964, "comment_id": 76248853, "body": "When we evaluate the <code>tick (tick (tick ...)))</code> large thunk, wouldn&#39;t have allocated the memory for the  <code>+1</code> s?   <code>tick 3 (tick 2 ( tick 1 (0,1)))</code>  <code>tick 3 tick 2 (0+1,1)</code> (Would new memory for <code>+1</code>be allocated at this stage?"}, {"owner": {"reputation": 41, "user_id": 2924565, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/7b020248f4d63a79765741d174acb376?s=128&d=identicon&r=PG&f=1", "display_name": "Suresh Sudhakaran", "link": "https://stackoverflow.com/users/2924565/suresh-sudhakaran"}, "edited": false, "score": 0, "creation_date": 1497878763, "post_id": 44629964, "comment_id": 76249066, "body": "Would evaluating the <code>+1</code> s require additional memory?"}, {"owner": {"reputation": 100185, "user_id": 3234959, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/93bb12ca0f93dfddb33880316f7e66c2?s=128&d=identicon&r=PG&f=1", "display_name": "chi", "link": "https://stackoverflow.com/users/3234959/chi"}, "reply_to_user": {"reputation": 41, "user_id": 2924565, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/7b020248f4d63a79765741d174acb376?s=128&d=identicon&r=PG&f=1", "display_name": "Suresh Sudhakaran", "link": "https://stackoverflow.com/users/2924565/suresh-sudhakaran"}, "edited": false, "score": 0, "creation_date": 1497882156, "post_id": 44629964, "comment_id": 76251719, "body": "The <code>+1</code> thunks are allocated when the <code>tick</code>s are evaluated, yes. But when <code>f</code> builds the <code>tick</code> thunk, the <code>+1</code> thunks are not yet allocated. When finally evaluating the <code>+1</code>s there should be virtually no more memory involved."}, {"owner": {"reputation": 41, "user_id": 2924565, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/7b020248f4d63a79765741d174acb376?s=128&d=identicon&r=PG&f=1", "display_name": "Suresh Sudhakaran", "link": "https://stackoverflow.com/users/2924565/suresh-sudhakaran"}, "edited": false, "score": 0, "creation_date": 1497883942, "post_id": 44629964, "comment_id": 76253024, "body": "If all the <code>+1</code> s are allocated when the <code>tick</code> thunk is evaluated, I dont understand how there would be two black spikes. I wonder if it is possible to find &#39;what thunk&#39; is being created at those points."}], "tags": [], "owner": {"reputation": 100185, "user_id": 3234959, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/93bb12ca0f93dfddb33880316f7e66c2?s=128&d=identicon&r=PG&f=1", "display_name": "chi", "link": "https://stackoverflow.com/users/3234959/chi"}, "is_accepted": false, "score": 1, "last_activity_date": 1497873815, "last_edit_date": 1497873815, "creation_date": 1497873460, "answer_id": 44629964, "question_id": 44625126, "link": "https://stackoverflow.com/questions/44625126/ghc-profiler-output/44629964#44629964", "title": "GHC profiler output", "body": "<p>Use more (local) variables. Replace</p>\n\n<pre><code>main = print (f [1..4000000] (0 :: Int, 1 :: Int))\n</code></pre>\n\n<p>with</p>\n\n<pre><code>main = print (f list (0 :: Int, 1 :: Int))\n   where\n   list = [1..4000000]\n</code></pre>\n\n<p>In such way, you will see an entry <code>main.list/main/Main.CAF</code> showing exactly how much space the 4M-long list takes. You'll probably find out that it takes a lot of space, since it is being defaulted to <code>[Integer]</code>. Define it as <code>[Int]</code> to improve space.</p>\n\n<p>Further, <code>f/main/...</code> is already shown to take a lot of space in your own post. Indeed, it is similar to a left non-strict fold, which has bad performance.</p>\n\n<p>Making things stricter, we get</p>\n\n<pre><code>f [] c = c   \nf (x:xs) c = f xs $! tick x c \n\ntick x (c0,c1) | even x = (,) c0 $! c1+1\n               | otherwise = ((,) $! c0+1) c1\n</code></pre>\n\n<p>And now the code runs in constant time, even without using <code>Int</code>.</p>\n\n<p>GHC 8.0.1 would also do this optimization automatically if we turn on optimization with <code>-O2</code>.</p>\n\n<p>Generally, though, it's a good idea to use explicit type annotations, so that GHC does not introduce unwanted/unneeded polymorphism, and performs better type checks. This could also trigger more optimizations, in general.</p>\n"}], "owner": {"reputation": 41, "user_id": 2924565, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/7b020248f4d63a79765741d174acb376?s=128&d=identicon&r=PG&f=1", "display_name": "Suresh Sudhakaran", "link": "https://stackoverflow.com/users/2924565/suresh-sudhakaran"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 153, "favorite_count": 0, "answer_count": 1, "score": 4, "last_activity_date": 1497873815, "creation_date": 1497859157, "last_edit_date": 1497871677, "question_id": 44625126, "link": "https://stackoverflow.com/questions/44625126/ghc-profiler-output", "title": "GHC profiler output", "body": "<p>I have been going through a <a href=\"http://blog.ezyang.com/2011/05/anatomy-of-a-thunk-leak/\" rel=\"nofollow noreferrer\">blog</a> discussing space leaks in Haskell and have been trying to understand the graph output provided by the ghc profiler (after using hp2ps)</p>\n\n<p>Specifically this is the code that I am looking at:</p>\n\n<pre><code>main = print (f [1..4000000] (0 :: Int, 1 :: Int))\n\nf [] c = c   \nf (x:xs) c = f xs (tick x c) \n\ntick x (c0,c1) | even x = (c0,c1+1)\n               | otherwise = (c0+1,c1)\n</code></pre>\n\n<p>I ran the program with -hb flag for biographical profiling of the heap:</p>\n\n<p><a href=\"https://i.stack.imgur.com/u6ZHV.png\" rel=\"nofollow noreferrer\"><img src=\"https://i.stack.imgur.com/u6ZHV.png\" alt=\"Biographical profile of heap\"></a></p>\n\n<p>I can't understand why so much memory is being considered in the void category as it means that a lot of memory is being allocated to objects that are never used. I restricted a producer profile to just the void components getting output for producer profile restricted to void component:</p>\n\n<p><a href=\"https://i.stack.imgur.com/gJtvS.png\" rel=\"nofollow noreferrer\"><img src=\"https://i.stack.imgur.com/gJtvS.png\" alt=\"hc output restricted to void\"></a></p>\n\n<p>Is there some way to find out what exactly what thunks are being formed that lead do the void usage?</p>\n"}, {"tags": ["haskell", "haskell-lens"], "comments": [{"owner": {"reputation": 40537, "user_id": 465378, "user_type": "registered", "accept_rate": 85, "profile_image": "https://www.gravatar.com/avatar/c03b8d34978563858020eff0d14cc17b?s=128&d=identicon&r=PG", "display_name": "Alexis King", "link": "https://stackoverflow.com/users/465378/alexis-king"}, "edited": false, "score": 1, "creation_date": 1497856386, "post_id": 44624090, "comment_id": 76234259, "body": "It sounds like you may be looking for <a href=\"https://hackage.haskell.org/package/lens-4.15.3/docs/Control-Lens-Prism.html#v:_Just\" rel=\"nofollow noreferrer\">the <code>_Just</code> prism</a>."}, {"owner": {"reputation": 5657, "user_id": 534481, "user_type": "registered", "accept_rate": 31, "profile_image": "https://www.gravatar.com/avatar/60df8c1a366ab1bf4378154e71a93367?s=128&d=identicon&r=PG", "display_name": "Saurabh Nanda", "link": "https://stackoverflow.com/users/534481/saurabh-nanda"}, "reply_to_user": {"reputation": 2313, "user_id": 5318306, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/897fd4f3b92d28c5c1eb28a8024661a1?s=128&d=identicon&r=PG&f=1", "display_name": "Gurkenglas", "link": "https://stackoverflow.com/users/5318306/gurkenglas"}, "edited": false, "score": 0, "creation_date": 1497877830, "post_id": 44624090, "comment_id": 76248445, "body": "Thanks @Gurkenglas. Please submit this as an answer. This is exactly what I needed."}], "answers": [{"comments": [{"owner": {"reputation": 5657, "user_id": 534481, "user_type": "registered", "accept_rate": 31, "profile_image": "https://www.gravatar.com/avatar/60df8c1a366ab1bf4378154e71a93367?s=128&d=identicon&r=PG", "display_name": "Saurabh Nanda", "link": "https://stackoverflow.com/users/534481/saurabh-nanda"}, "edited": false, "score": 1, "creation_date": 1497858183, "post_id": 44624359, "comment_id": 76235235, "body": "does the <code>_Just</code> lens behave like a <code>fromJust</code>, i.e. will it throw an error if the value is a <code>Nothing</code>?"}, {"owner": {"reputation": 20350, "user_id": 411944, "user_type": "registered", "accept_rate": 88, "profile_image": "https://www.gravatar.com/avatar/7bf057b98d0652db34842d1817234853?s=128&d=identicon&r=PG", "display_name": "Reactormonk", "link": "https://stackoverflow.com/users/411944/reactormonk"}, "reply_to_user": {"reputation": 5657, "user_id": 534481, "user_type": "registered", "accept_rate": 31, "profile_image": "https://www.gravatar.com/avatar/60df8c1a366ab1bf4378154e71a93367?s=128&d=identicon&r=PG", "display_name": "Saurabh Nanda", "link": "https://stackoverflow.com/users/534481/saurabh-nanda"}, "edited": false, "score": 0, "creation_date": 1497863899, "post_id": 44624359, "comment_id": 76238851, "body": "@SaurabhNanda I hope there are no exceptions. It just doesn&#39;t set the value."}, {"owner": {"reputation": 5657, "user_id": 534481, "user_type": "registered", "accept_rate": 31, "profile_image": "https://www.gravatar.com/avatar/60df8c1a366ab1bf4378154e71a93367?s=128&d=identicon&r=PG", "display_name": "Saurabh Nanda", "link": "https://stackoverflow.com/users/534481/saurabh-nanda"}, "edited": false, "score": 0, "creation_date": 1497871409, "post_id": 44624359, "comment_id": 76243983, "body": "I do not need to <b>set</b> anything. I need to <b>get</b> only."}, {"owner": {"reputation": 44013, "user_id": 1477667, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/trgKM.jpg?s=128&g=1", "display_name": "dfeuer", "link": "https://stackoverflow.com/users/1477667/dfeuer"}, "reply_to_user": {"reputation": 5657, "user_id": 534481, "user_type": "registered", "accept_rate": 31, "profile_image": "https://www.gravatar.com/avatar/60df8c1a366ab1bf4378154e71a93367?s=128&d=identicon&r=PG", "display_name": "Saurabh Nanda", "link": "https://stackoverflow.com/users/534481/saurabh-nanda"}, "edited": false, "score": 0, "creation_date": 1497902912, "post_id": 44624359, "comment_id": 76264106, "body": "@SaurabhNanda, remember that getting in <code>lens</code> is done by modifying in a <code>Const</code> context. So from <code>Nothing</code> you get nothing."}], "tags": [], "owner": {"reputation": 14582, "user_id": 2225384, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/f30b04ed4d0b3fc4bc791a28815f34ca?s=128&d=identicon&r=PG", "display_name": "Rein Henrichs", "link": "https://stackoverflow.com/users/2225384/rein-henrichs"}, "is_accepted": false, "score": 10, "last_activity_date": 1497856479, "creation_date": 1497856479, "answer_id": 44624359, "question_id": 44624090, "link": "https://stackoverflow.com/questions/44624090/how-to-compose-maybe-lenses/44624359#44624359", "title": "How to compose &quot;Maybe&quot; lenses?", "body": "<p>You can use the <a href=\"https://www.stackage.org/haddock/lts-8.19/lens-4.15.1/Control-Lens-Prism.html#v:_Just\" rel=\"noreferrer\"><code>_Just</code> prism</a>. Here's a contrived example:</p>\n\n<pre><code>&gt; (Just (Just 1, ()), ()) &amp; _1 . _Just . _1 . _Just +~ 1\n(Just (Just 2,()),())\n</code></pre>\n\n<p>In your case, I think you want</p>\n\n<pre><code>properties . _Just . smtpConfig . _Just\n</code></pre>\n"}, {"tags": [], "owner": {"reputation": 37219, "user_id": 1523776, "user_type": "moderator", "accept_rate": 87, "profile_image": "https://www.gravatar.com/avatar/b3e0b5c8e42a8c38009ef2d969f8dabb?s=128&d=identicon&r=PG", "display_name": "Benjamin Hodgson", "link": "https://stackoverflow.com/users/1523776/benjamin-hodgson"}, "is_accepted": false, "score": 3, "last_activity_date": 1497878291, "last_edit_date": 1497878291, "creation_date": 1497863190, "answer_id": 44626371, "question_id": 44624090, "link": "https://stackoverflow.com/questions/44624090/how-to-compose-maybe-lenses/44626371#44626371", "title": "How to compose &quot;Maybe&quot; lenses?", "body": "<p><code>traverse</code> is a valid <a href=\"https://hackage.haskell.org/package/lens-4.15.3/docs/Control-Lens-Traversal.html\" rel=\"nofollow noreferrer\"><code>Traversal</code></a>, remember.</p>\n\n<pre><code>getSmtpConfig :: Traversal' Client SmtpConfig\ngetSmtpConfig = properties . traverse . smtpConfig . traverse\n</code></pre>\n\n<p>A <code>Traversal</code> is the best you can do here - you can't get a <code>Lens</code> - because there may not be an <code>SmtpConfig</code>. (A <a href=\"https://hackage.haskell.org/package/lens-4.15.3/docs/Control-Lens-Lens.html#t:Lens\" rel=\"nofollow noreferrer\"><code>Lens</code></a> says \"there's always exactly one of these things\", whereas a <code>Traversal</code> says \"there may be zero or many\".)</p>\n\n<p>This code actually produces the same <code>Traversal</code> as if you'd used <a href=\"https://stackoverflow.com/a/44624359/7951906\">the <code>_Just</code> prism</a>, but it's perhaps a little easier to understand if you haven't grokked prisms yet.</p>\n\n<p>Note that since a <code>Traversal</code> might not find any results, you can't use <a href=\"https://hackage.haskell.org/package/lens-4.15.3/docs/Control-Lens-Getter.html#v:-94-.\" rel=\"nofollow noreferrer\"><code>^.</code></a> to access a single result as you did in your question. You need to use the \"safe head\" operator <a href=\"https://hackage.haskell.org/package/lens-4.15.3/docs/Control-Lens-Fold.html#v:-94--63-\" rel=\"nofollow noreferrer\"><code>^?</code></a> (aka <a href=\"https://hackage.haskell.org/package/lens-4.15.3/docs/Control-Lens-Fold.html#v:preview\" rel=\"nofollow noreferrer\"><code>flip preview</code></a>).</p>\n\n<pre><code>smtp :: Maybe SmtpConfig\nsmtp = c^?properties.traverse.smtpConfig.traverse\n</code></pre>\n"}, {"tags": [], "owner": {"reputation": 2313, "user_id": 5318306, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/897fd4f3b92d28c5c1eb28a8024661a1?s=128&d=identicon&r=PG&f=1", "display_name": "Gurkenglas", "link": "https://stackoverflow.com/users/5318306/gurkenglas"}, "is_accepted": true, "score": 2, "last_activity_date": 1497895338, "creation_date": 1497895338, "answer_id": 44637106, "question_id": 44624090, "link": "https://stackoverflow.com/questions/44624090/how-to-compose-maybe-lenses/44637106#44637106", "title": "How to compose &quot;Maybe&quot; lenses?", "body": "<pre><code>client ^? properties . _Just . smtpConfig . _Just\n</code></pre>\n"}], "owner": {"reputation": 5657, "user_id": 534481, "user_type": "registered", "accept_rate": 31, "profile_image": "https://www.gravatar.com/avatar/60df8c1a366ab1bf4378154e71a93367?s=128&d=identicon&r=PG", "display_name": "Saurabh Nanda", "link": "https://stackoverflow.com/users/534481/saurabh-nanda"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 1179, "favorite_count": 1, "accepted_answer_id": 44637106, "answer_count": 3, "score": 4, "last_activity_date": 1497895338, "creation_date": 1497855504, "last_edit_date": 1497859797, "question_id": 44624090, "link": "https://stackoverflow.com/questions/44624090/how-to-compose-maybe-lenses", "title": "How to compose &quot;Maybe&quot; lenses?", "body": "<p>If I have lenses for a nested record, where each lens returns a <code>Maybe</code>, how can I get them to compose, so that if anything in the \"traversal\" returns a <code>Nothing</code> the final result is a <code>Nothing</code>?</p>\n\n<pre><code>data Client = Client\n  {\n    clientProperties :: Maybe Properties\n  , ...\n  }\n\ndata Properties = Properties\n  {\n    propSmtpConfig :: Maybe SmtpConfig\n  , ...\n  }\n\nc :: Client \nc = undefined\n\nsmtp = c ^. (properties . smtpConfig) -- How to make these lenses compose?\n</code></pre>\n\n<p><strong>Edit</strong> I tried a lot of options, but this is the best I could come up with. Looking for something cleaner:</p>\n\n<pre><code>(client ^. properties) &gt;&gt;= (view smtpConfig)\n</code></pre>\n"}, {"tags": ["haskell", "simulation", "physics"], "comments": [{"owner": {"reputation": 37219, "user_id": 1523776, "user_type": "moderator", "accept_rate": 87, "profile_image": "https://www.gravatar.com/avatar/b3e0b5c8e42a8c38009ef2d969f8dabb?s=128&d=identicon&r=PG", "display_name": "Benjamin Hodgson", "link": "https://stackoverflow.com/users/1523776/benjamin-hodgson"}, "edited": false, "score": 0, "creation_date": 1497863874, "post_id": 44622757, "comment_id": 76238833, "body": "Try storing your results in a lazy <code>Map (Particle, Particle) Force</code> and <a href=\"https://wiki.haskell.org/Tying_the_Knot\" rel=\"nofollow noreferrer\">tying the knot</a>"}, {"owner": {"reputation": 100892, "user_id": 745903, "user_type": "registered", "accept_rate": 74, "profile_image": "https://www.gravatar.com/avatar/50933f6638836741e620669b3940410e?s=128&d=identicon&r=PG", "display_name": "leftaroundabout", "link": "https://stackoverflow.com/users/745903/leftaroundabout"}, "edited": false, "score": 4, "creation_date": 1497884436, "post_id": 44622757, "comment_id": 76253384, "body": "Note that <i>O</i> (<i>n</i> &#183; (<i>n</i> &#173;\u2013 1)) \u2261 <i>O</i> (<i>n&#178;</i>). Calculating each force only once won&#39;t save you from getting abysmal performance for anything you could seriously call <i>many</i>-body simulation. To really save on asymptotic cost in this kind of computation, you need an approximation method; this is <a href=\"https://en.wikipedia.org/wiki/Barnes%E2%80%93Hut_simulation\" rel=\"nofollow noreferrer\">usually done with something octree-like</a>."}, {"owner": {"reputation": 629, "user_id": 7098058, "user_type": "registered", "accept_rate": 83, "profile_image": "https://www.gravatar.com/avatar/3cb3a1c267d4e2afe8cf01d644f1eb7b?s=128&d=identicon&r=PG&f=1", "display_name": "Thor Correia", "link": "https://stackoverflow.com/users/7098058/thor-correia"}, "reply_to_user": {"reputation": 100892, "user_id": 745903, "user_type": "registered", "accept_rate": 74, "profile_image": "https://www.gravatar.com/avatar/50933f6638836741e620669b3940410e?s=128&d=identicon&r=PG", "display_name": "leftaroundabout", "link": "https://stackoverflow.com/users/745903/leftaroundabout"}, "edited": false, "score": 0, "creation_date": 1497910895, "post_id": 44622757, "comment_id": 76267647, "body": "Thanks! @leftaroundabout. Somebody actually edited my post. I was incorrect before but I think the editor is incorrect as well. The actual O notation would be O(n choose 2), or O(n!/(2(n-2)!). Right? I was considering implementing approximation after I had fixed this sharing computation."}, {"owner": {"reputation": 198293, "user_id": 707111, "user_type": "moderator", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/oXZkh.jpg?s=128&g=1", "display_name": "Ry-", "link": "https://stackoverflow.com/users/707111/ry"}, "edited": false, "score": 1, "creation_date": 1497937672, "post_id": 44622757, "comment_id": 76274582, "body": "@ThorCorreia: O(n!/(2(n-2)!)) = O(n!/(n-2)!) = O(n &#183; (n - 1)) = O(n&#178;)"}, {"owner": {"reputation": 629, "user_id": 7098058, "user_type": "registered", "accept_rate": 83, "profile_image": "https://www.gravatar.com/avatar/3cb3a1c267d4e2afe8cf01d644f1eb7b?s=128&d=identicon&r=PG&f=1", "display_name": "Thor Correia", "link": "https://stackoverflow.com/users/7098058/thor-correia"}, "reply_to_user": {"reputation": 198293, "user_id": 707111, "user_type": "moderator", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/oXZkh.jpg?s=128&g=1", "display_name": "Ry-", "link": "https://stackoverflow.com/users/707111/ry"}, "edited": false, "score": 0, "creation_date": 1498067400, "post_id": 44622757, "comment_id": 76350058, "body": "I don&#39;t quite follow @Ryan. Take for example 200 choose 2. That&#39;s 19,900, whereas 200(199) is 39,800. That&#39;s nearly twice the computations. As this scales, the difference becomes even more dramatic. 2,000 choose 2 is only about 2e6, while 2000(1999) is 4e6."}, {"owner": {"reputation": 23111, "user_id": 1319998, "user_type": "registered", "accept_rate": 58, "profile_image": "https://www.gravatar.com/avatar/9f600f4583bec89109ce8c0c098951ae?s=128&d=identicon&r=PG", "display_name": "Michal Charemza", "link": "https://stackoverflow.com/users/1319998/michal-charemza"}, "edited": false, "score": 1, "creation_date": 1498068159, "post_id": 44622757, "comment_id": 76350473, "body": "@ThorCorreia <code>O</code> (pronounced &quot;big oh&quot;) notation isn&#39;t actually the number of computations for a certain input. It&#39;s how the number of computations scales as n goes to infinity. Another way of thinking about it is &quot;what eventually dominates when n gets big&quot;. Probably too much to go in depth in a comment though!"}, {"owner": {"reputation": 22377, "user_id": 2288659, "user_type": "registered", "accept_rate": 90, "profile_image": "https://i.stack.imgur.com/bBg8v.png?s=128&g=1", "display_name": "Silvio Mayolo", "link": "https://stackoverflow.com/users/2288659/silvio-mayolo"}, "edited": false, "score": 1, "creation_date": 1618169793, "post_id": 44622757, "comment_id": 118515137, "body": "@ThorCorreia At scale, we don&#39;t care about constant multipliers. &quot;Twice as many&quot; is fairly harmless if it&#39;s always &quot;twice as many&quot;. The difference between, say, O(n) and O(2^n), is that if you double the input size, the former doubles in time, whereas if you even add one to the input size, the latter doubles in time. It&#39;s a matter of scale, not of actual quantity."}], "answers": [{"comments": [{"owner": {"reputation": 629, "user_id": 7098058, "user_type": "registered", "accept_rate": 83, "profile_image": "https://www.gravatar.com/avatar/3cb3a1c267d4e2afe8cf01d644f1eb7b?s=128&d=identicon&r=PG&f=1", "display_name": "Thor Correia", "link": "https://stackoverflow.com/users/7098058/thor-correia"}, "edited": false, "score": 0, "creation_date": 1497911130, "post_id": 44640536, "comment_id": 76267728, "body": "Thanks for the suggestions. I think the actual O would be O(n choose 2), or O(n!/(2(n-2)!). For example, for &quot;abcd&quot;, the combinations would be &quot;ab&quot;,&quot;ac&quot;,&quot;ad&quot;,&quot;bc&quot;,&quot;bd&quot;,&quot;cd&quot;. 4 choose 2 is 6. That&#39;s a lot less than 4^2 = 16. But you&#39;re right the performance would still be bad."}, {"owner": {"reputation": 23111, "user_id": 1319998, "user_type": "registered", "accept_rate": 58, "profile_image": "https://www.gravatar.com/avatar/9f600f4583bec89109ce8c0c098951ae?s=128&d=identicon&r=PG", "display_name": "Michal Charemza", "link": "https://stackoverflow.com/users/1319998/michal-charemza"}, "reply_to_user": {"reputation": 629, "user_id": 7098058, "user_type": "registered", "accept_rate": 83, "profile_image": "https://www.gravatar.com/avatar/3cb3a1c267d4e2afe8cf01d644f1eb7b?s=128&d=identicon&r=PG&f=1", "display_name": "Thor Correia", "link": "https://stackoverflow.com/users/7098058/thor-correia"}, "edited": false, "score": 0, "creation_date": 1497937318, "post_id": 44640536, "comment_id": 76274439, "body": "Ah you&#39;re right! I was out by a factor of two? I have tweaked my answer to specify <code>n * (n-1) &#47; 2</code> which I think is n choose 2, and added a test for the leading diagonal case to not call <code>gravitate</code>"}, {"owner": {"reputation": 629, "user_id": 7098058, "user_type": "registered", "accept_rate": 83, "profile_image": "https://www.gravatar.com/avatar/3cb3a1c267d4e2afe8cf01d644f1eb7b?s=128&d=identicon&r=PG&f=1", "display_name": "Thor Correia", "link": "https://stackoverflow.com/users/7098058/thor-correia"}, "edited": false, "score": 0, "creation_date": 1498067489, "post_id": 44640536, "comment_id": 76350109, "body": "awesome. I&#39;ll take a deeper look at your code once a have a bit more time. Thanks!"}], "tags": [], "owner": {"reputation": 23111, "user_id": 1319998, "user_type": "registered", "accept_rate": 58, "profile_image": "https://www.gravatar.com/avatar/9f600f4583bec89109ce8c0c098951ae?s=128&d=identicon&r=PG", "display_name": "Michal Charemza", "link": "https://stackoverflow.com/users/1319998/michal-charemza"}, "is_accepted": true, "score": 1, "last_activity_date": 1497984214, "last_edit_date": 1497984214, "creation_date": 1497909057, "answer_id": 44640536, "question_id": 44622757, "link": "https://stackoverflow.com/questions/44622757/sharing-computation-of-force-in-haskell/44640536#44640536", "title": "Sharing Computation of Force in Haskell", "body": "<p>Taking the code from <a href=\"https://github.com/thorlucas/N-Body-Simulation\" rel=\"nofollow noreferrer\">https://github.com/thorlucas/N-Body-Simulation</a> </p>\n\n<pre><code>updateParticle :: Model -&gt; Particle -&gt; Particle\nupdateParticle ps p@(Particle m pos vel acc) =\n    let accs = map (gravitate p) ps\n        acc' = foldr (\\(accx, accy) (x, y) -&gt; (accx + x, accy + y)) (0, 0) accs\n        vel' = (fst vel + fst acc, snd vel + snd acc)\n        pos' = (fst pos + fst vel, snd pos + snd vel)\n    in  Particle m pos' vel' acc'\n\nstep :: ViewPort -&gt; Float -&gt; Model -&gt; Model\nstep _ _ ps = map (updateParticle ps) ps\n</code></pre>\n\n<p>and modifying it so the accelerations are worked out in a matrix (well, list of lists...) separately from updating each particle, we get...</p>\n\n<pre><code>updateParticle :: Model -&gt; (Particle, [Acc]) -&gt; Particle\nupdateParticle ps (p@(Particle m pos vel acc), accs) =\n    let acc' = foldr (\\(accx, accy) (x, y) -&gt; (accx + x, accy + y)) (0, 0) accs\n        vel' = (fst vel + fst acc, snd vel + snd acc)\n        pos' = (fst pos + fst vel, snd pos + snd vel)\n    in  Particle m pos' vel' acc'\n\nstep :: ViewPort -&gt; Float -&gt; Model -&gt; Model\nstep _ _ ps = map (updateParticle ps) $ zip ps accsMatrix where\n    accsMatrix = [map (gravitate p) ps | p &lt;- ps]\n</code></pre>\n\n<p>... so the problem is essentially how to reduce the number of calls to <code>gravitate</code> when working out <code>accsMatrix</code>, using the fact that <code>gravitate a b</code> = <code>-1 * gravitate b a</code>.</p>\n\n<p>If we were to print out <code>accsMatrix</code>, it would look like...</p>\n\n<pre><code>[[( 0.0,  0.0), ( 1.0,  2.3), (-1.0,  0.0), ...\n[[(-1.0, -2.3), ( 0.0,  0.0), (-1.2,  5.3), ...\n[[( 1.0,  0.0), ( 1.2, -5.3), ( 0.0,  0.0), ...\n...\n</code></pre>\n\n<p>... so we see <code>accsMatrix !! i !! j == -1 * accsMatrix !! j !! i</code>.</p>\n\n<p>So to use the above fact we need access to some indexes. Firstly, we index the outer list...</p>\n\n<pre><code>accsMatrix = [map (gravitate p) ps | (i,p) &lt;- zip [0..] ps]\n</code></pre>\n\n<p>... and replace the inner list with a list comprehension...</p>\n\n<pre><code>accsMatrix = [[ gravitate p p' | p' &lt;- ps] | (i,p) &lt;- zip [0..] ps]\n</code></pre>\n\n<p>... get some more indexes available via zip...</p>\n\n<pre><code>accsMatrix = [[ gravitate p p' | (j, p') &lt;- zip [0..] ps] | (i,p) &lt;- zip [0..] ps]\n</code></pre>\n\n<p>... and then, the key, is make <code>accsMatrix</code> depend on itself for half of the matrix...</p>\n\n<pre><code>accsMatrix = [[ if i == j then 0 else if i &lt; j then gravitate p p' else -1 * accsMatrix !! j !! i | (j, p') &lt;- zip [0..] ps] | (i, p) &lt;- zip [0..] ps]\n</code></pre>\n\n<p>We can split it up a bit as well, as below...</p>\n\n<pre><code>accsMatrix = [[ accs (j, p') (i, p) | (j, p') &lt;- zip [0..] ps] | (i, p) &lt;- zip [0..] ps]\naccs (j, p') (i, p) \n    | i == j    = 0\n    | i &lt; j     = gravitate p p'\n    | otherwise = -1 * accsMatrix !! j !! i\n</code></pre>\n\n<p>... or avoid list comprehensions by using <code>map</code></p>\n\n<pre><code>accsMatrix = map (flip map indexedPs) $ map accs indexedPs  \nindexedPs = zip [0..] ps\naccs (i, p) (j, p')\n    | i == j    = 0\n    | i &lt; j     = gravitate p p'\n    | otherwise = -1 * accsMatrix !! j !! i\n</code></pre>\n\n<p>... or by using the list monad...</p>\n\n<pre><code>accsMatrix = map accs indexedPs &gt;&gt;= (:[]) . flip map indexedPs\n</code></pre>\n\n<p>... although it's harder (for me) to see what's going on in these.</p>\n\n<p>There are probably some horrible performance issues with this list of lists approach, especially using <code>!!</code>, and the fact that you're still running <em>O(n\u00b2)</em> operations due to the traversals, and the fact that O (n \u00b7 (n \u00ad\u2013 1)) \u2261 O (n\u00b2) as @leftaroundabout mentioned, but each iteration should call <code>gravitate</code> <code>n * (n-1) / 2</code> times.</p>\n"}], "owner": {"reputation": 629, "user_id": 7098058, "user_type": "registered", "accept_rate": 83, "profile_image": "https://www.gravatar.com/avatar/3cb3a1c267d4e2afe8cf01d644f1eb7b?s=128&d=identicon&r=PG&f=1", "display_name": "Thor Correia", "link": "https://stackoverflow.com/users/7098058/thor-correia"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 188, "favorite_count": 0, "accepted_answer_id": 44640536, "answer_count": 1, "score": 8, "last_activity_date": 1618169497, "creation_date": 1497849647, "last_edit_date": 1497910950, "question_id": 44622757, "link": "https://stackoverflow.com/questions/44622757/sharing-computation-of-force-in-haskell", "title": "Sharing Computation of Force in Haskell", "body": "<p>I'm implementing a N-Body simulation in Haskell. <a href=\"https://github.com/thorlucas/N-Body-Simulation\" rel=\"nofollow noreferrer\">https://github.com/thorlucas/N-Body-Simulation</a></p>\n\n<p>Right now, each particle calculates its Force, then acceleration against each other particle. In other words, <em>O(n\u00b2)</em> computations of force. I could reduce this down to O(n choose 2) if I were to calculate each combination once.</p>\n\n<pre><code>let combs = [(a, b) | (a:bs) &lt;- tails ps, b &lt;- bs ]\n    force = map (\\comb -&gt; gravitate (fst comb) (snd comb)) combs\n</code></pre>\n\n<p>But I cant figure out how to apply these to the particles without using state. In the above example, <code>ps</code> is <code>[Particle]</code> where</p>\n\n<pre><code>data Particle = Particle Mass Pos Vel Acc deriving (Eq, Show)\n</code></pre>\n\n<p>Theoretically, in an stateful language I would simply be able to loop through the combinations, calculate the relevant acceleration from the force from each <code>a</code> and <code>b</code>, then update each <code>Particle</code> in <code>ps</code> acceleration as I do that.</p>\n\n<p>I've thought about doing something like <code>foldr f ps combs</code>. The starting accumulator would be the current <code>ps</code> and <code>f</code> would be some function that takes each <code>comb</code> and updates the relevant <code>Particle</code> in <code>ps</code>, and returns that accumulator. That seems really memory intensive and quite complicated for such a simple process.</p>\n\n<p>Any ideas?</p>\n"}, {"tags": ["haskell", "shake-build-system"], "comments": [{"owner": {"reputation": 100892, "user_id": 745903, "user_type": "registered", "accept_rate": 74, "profile_image": "https://www.gravatar.com/avatar/50933f6638836741e620669b3940410e?s=128&d=identicon&r=PG", "display_name": "leftaroundabout", "link": "https://stackoverflow.com/users/745903/leftaroundabout"}, "edited": false, "score": 0, "creation_date": 1497865506, "post_id": 44621383, "comment_id": 76239914, "body": "Like Make and most (all?) comparable build systems, Shake as such doesn&#39;t know, care, or influence how many threads are used by some process it invokes. If that <code>BLAST</code> program needs to be told through a flag to parallelise, then you need to pass that flag from Shake. Of course, whether this is a good idea is another question \u2013 if you already run many of these commands in parallel, you likely won&#39;t win much with finer-grained parallelism. Is that your question \u2013 how to tell from within Shake how many commands are running, and thus decide how parallel each should be?"}, {"owner": {"reputation": 1817, "user_id": 429898, "user_type": "registered", "accept_rate": 89, "profile_image": "https://i.stack.imgur.com/IbMYQ.jpg?s=128&g=1", "display_name": "jefdaj", "link": "https://stackoverflow.com/users/429898/jefdaj"}, "reply_to_user": {"reputation": 100892, "user_id": 745903, "user_type": "registered", "accept_rate": 74, "profile_image": "https://www.gravatar.com/avatar/50933f6638836741e620669b3940410e?s=128&d=identicon&r=PG", "display_name": "leftaroundabout", "link": "https://stackoverflow.com/users/745903/leftaroundabout"}, "edited": false, "score": 0, "creation_date": 1497892091, "post_id": 44621383, "comment_id": 76258265, "body": "Thanks that clarifies it a bit. I guess that is my question: how to set <code>--n_threads</code> for a new process based on the number already running? Or better yet the number queued to be run."}], "answers": [{"tags": [], "owner": {"reputation": 8563, "user_id": 160673, "user_type": "registered", "accept_rate": 97, "profile_image": "https://i.stack.imgur.com/7BSPT.jpg?s=128&g=1", "display_name": "Neil Mitchell", "link": "https://stackoverflow.com/users/160673/neil-mitchell"}, "is_accepted": false, "score": 0, "last_activity_date": 1528386009, "creation_date": 1528386009, "answer_id": 50745269, "question_id": 44621383, "link": "https://stackoverflow.com/questions/44621383/can-shake-track-number-of-threads-used-by-build-commands-which-are-themselves-pa/50745269#50745269", "title": "Can Shake track number of threads used by build commands which are themselves parallel?", "body": "<p>No, but there is a ticket to add it: <a href=\"https://github.com/ndmitchell/shake/issues/603\" rel=\"nofollow noreferrer\">https://github.com/ndmitchell/shake/issues/603</a></p>\n"}], "owner": {"reputation": 1817, "user_id": 429898, "user_type": "registered", "accept_rate": 89, "profile_image": "https://i.stack.imgur.com/IbMYQ.jpg?s=128&g=1", "display_name": "jefdaj", "link": "https://stackoverflow.com/users/429898/jefdaj"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 85, "favorite_count": 1, "answer_count": 1, "score": 6, "last_activity_date": 1528386009, "creation_date": 1497838555, "last_edit_date": 1497997677, "question_id": 44621383, "link": "https://stackoverflow.com/questions/44621383/can-shake-track-number-of-threads-used-by-build-commands-which-are-themselves-pa", "title": "Can Shake track number of threads used by build commands which are themselves parallel?", "body": "<p>Shake builds things in parallel when possible, but what happens if an individual build step is itself parallelizable? For example I'm running BLAST commands. Each command compares two species' genomes. Several comparisons could be run in parallel, but there's also a flag to split a comparison into N chunks and run those in parallel. Do I need to pick one way of splitting the jobs up and stick with it, or can I tell Shake \"Use N threads overall, and by the way each of these specific tasks takes up N threads on its own\"?</p>\n\n<p>(This comes up when comparing many small bacterial genomes and a few bigger eukaryotic ones)</p>\n\n<p>EDIT: the question can be simplified to \"how to tell how many Shake threads are currently running/queued from within Shake?\"</p>\n"}, {"tags": ["haskell", "haskell-lens"], "comments": [{"owner": {"reputation": 37219, "user_id": 1523776, "user_type": "moderator", "accept_rate": 87, "profile_image": "https://www.gravatar.com/avatar/b3e0b5c8e42a8c38009ef2d969f8dabb?s=128&d=identicon&r=PG", "display_name": "Benjamin Hodgson", "link": "https://stackoverflow.com/users/1523776/benjamin-hodgson"}, "edited": false, "score": 0, "creation_date": 1497877051, "post_id": 44621325, "comment_id": 76247886, "body": "I had a crack at doing this by traversing in the reverse state monad transformer, but that gives you a signature of <code>MonadFix m =&gt; Traversal&#39; s a -&gt; LensLike&#39; m s a</code> which is not terribly useful - you can only put values into it, not get them out, because <code>Const s</code> is not a <code>Monad</code>. An alternative approach would be to get the length of the collection by folding and then count statefully up to the last index - that&#39;d give you a <code>Monad</code> constraint instead of <code>MonadFix</code> at the expense of some efficiency. Going via a concrete list, as in @Gurkenglas&#39;s answer, is probably your best bet"}], "answers": [{"tags": [], "owner": {"reputation": 2313, "user_id": 5318306, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/897fd4f3b92d28c5c1eb28a8024661a1?s=128&d=identicon&r=PG&f=1", "display_name": "Gurkenglas", "link": "https://stackoverflow.com/users/5318306/gurkenglas"}, "is_accepted": false, "score": 2, "last_activity_date": 1497873917, "creation_date": 1497873917, "answer_id": 44630122, "question_id": 44621325, "link": "https://stackoverflow.com/questions/44621325/traversal-over-last-element-of-filtered/44630122#44630122", "title": "Traversal over last element of &#39;filtered&#39;", "body": "<pre><code>[1,2,3,4] &amp; partsOf (traverse . filtered even) . _last +~ 10\n</code></pre>\n"}, {"tags": [], "owner": {"reputation": 34158, "user_id": 7203016, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/ybAMw.png?s=128&g=1", "display_name": "K. A. Buhr", "link": "https://stackoverflow.com/users/7203016/k-a-buhr"}, "is_accepted": true, "score": 2, "last_activity_date": 1497967016, "creation_date": 1497967016, "answer_id": 44655128, "question_id": 44621325, "link": "https://stackoverflow.com/questions/44621325/traversal-over-last-element-of-filtered/44655128#44655128", "title": "Traversal over last element of &#39;filtered&#39;", "body": "<p>This isn't really an answer, just a follow-up to @Gurkenglas that's too big for a comment.  Note that @Gurkenglas's answer:</p>\n\n<pre><code>let t = partsOf (traverse . filtered even) . _last\n</code></pre>\n\n<p>may <em>look</em> like a Traversal, but it isn't, even if you maintain the element count, because it violates the second Traversal law (for obvious reasons):</p>\n\n<pre><code>let f = Identity . succ\n[1,2,3,4] &amp; fmap (t f) . t f  -- yields [1,3,3,5] effectively\n[1,2,3,4] &amp; getCompose . t (Compose . fmap f . f)\n                              -- yields [1,2,3,6] effectively\n</code></pre>\n\n<p>For it to be a traversal, you have to maintain <em>both</em> the element count <em>and</em> the filtering property as invariants.</p>\n\n<p>Whether this will matter for your application, I don't know, but just be aware that <code>partsOf</code> comes with these sorts of caveats, and the documentation misleadingly suggests that the result of <code>partsOf</code> will be a Lens if you maintain the element count.  (That's true for <code>partsOf each</code>, the example given in the documentation, but not in general.)</p>\n"}], "owner": {"reputation": 1835, "user_id": 3907685, "user_type": "registered", "accept_rate": 87, "profile_image": "https://www.gravatar.com/avatar/4a9d7cdfc525e689e6baefb7d2158fb0?s=128&d=identicon&r=PG", "display_name": "Chris Penner", "link": "https://stackoverflow.com/users/3907685/chris-penner"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 246, "favorite_count": 0, "accepted_answer_id": 44655128, "answer_count": 2, "score": 9, "last_activity_date": 1497967016, "creation_date": 1497837922, "question_id": 44621325, "link": "https://stackoverflow.com/questions/44621325/traversal-over-last-element-of-filtered", "title": "Traversal over last element of &#39;filtered&#39;", "body": "<p>I'm looking to filter a traversal, then select the last element to use with <code>over</code>.</p>\n\n<p>e.g. something like this (but which will actually compile): </p>\n\n<pre><code>[1,2,3,4] &amp; traverse . filtered even . _last +~ 10\n&gt; [1,2,3,14]\n</code></pre>\n\n<p>Any ideas?</p>\n\n<p>P.S. I'm aware that <code>filtered</code> is only valid when not affecting the number of elements in the traversal.</p>\n\n<p>The actual use case I'm performing is to select only the lowest level of a recursive <code>uniplate</code> traversal that matches some predicate; if you have other ideas of how to do this I'd love to hear them!</p>\n"}, {"tags": ["haskell"], "comments": [{"owner": {"reputation": 8237, "user_id": 2900502, "user_type": "registered", "accept_rate": 73, "profile_image": "https://i.stack.imgur.com/R1OjD.jpg?s=128&g=1", "display_name": "Shersh", "link": "https://stackoverflow.com/users/2900502/shersh"}, "edited": false, "score": 1, "creation_date": 1497810113, "post_id": 44617989, "comment_id": 76222152, "body": "What do you want to proof? That 4^4 is 256? It&#39;s just simple combinatoric fact that follows from the nature of algebraic data types. And you always can write program that generates all possible functions."}, {"owner": {"reputation": 13807, "user_id": 2407038, "user_type": "registered", "accept_rate": 64, "profile_image": "https://www.gravatar.com/avatar/538f6f4a9aa43841841de7d8e8b169fc?s=128&d=identicon&r=PG&f=1", "display_name": "user2407038", "link": "https://stackoverflow.com/users/2407038/user2407038"}, "edited": false, "score": 4, "creation_date": 1497814887, "post_id": 44617989, "comment_id": 76223575, "body": "You say there are 4 functions of type <code>Bool -&gt; Bool</code> but you only list two -  you are missing <code>id</code> and <code>not</code>"}, {"owner": {"reputation": 75362, "user_id": 625403, "user_type": "registered", "accept_rate": 82, "profile_image": "https://www.gravatar.com/avatar/786eed7da67079cb5d63a49d469af25b?s=128&d=identicon&r=PG", "display_name": "amalloy", "link": "https://stackoverflow.com/users/625403/amalloy"}, "reply_to_user": {"reputation": 13807, "user_id": 2407038, "user_type": "registered", "accept_rate": 64, "profile_image": "https://www.gravatar.com/avatar/538f6f4a9aa43841841de7d8e8b169fc?s=128&d=identicon&r=PG&f=1", "display_name": "user2407038", "link": "https://stackoverflow.com/users/2407038/user2407038"}, "edited": false, "score": 3, "creation_date": 1497818194, "post_id": 44617989, "comment_id": 76224445, "body": "@user2407038 Actually all four are missing, because neither of the two functions defined is a total function of type <code>Bool -&gt; Bool</code>; rather, they are both definitions with overlapping, incomplete patterns."}], "answers": [{"comments": [{"owner": {"reputation": 57219, "user_id": 33796, "user_type": "registered", "accept_rate": 70, "profile_image": "https://www.gravatar.com/avatar/08727b23ba62e634b32988cdff082663?s=128&d=identicon&r=PG", "display_name": "luqui", "link": "https://stackoverflow.com/users/33796/luqui"}, "edited": false, "score": 0, "creation_date": 1497822084, "post_id": 44618168, "comment_id": 76225383, "body": "I thought &quot;algebraic data type&quot; was because they are initial algebras."}, {"owner": {"reputation": 25967, "user_id": 1743843, "user_type": "registered", "accept_rate": 77, "profile_image": "https://www.gravatar.com/avatar/8ea2c1d9051e40332376a07bc166d9d5?s=128&d=identicon&r=PG&f=1", "display_name": "softshipper", "link": "https://stackoverflow.com/users/1743843/softshipper"}, "edited": false, "score": 0, "creation_date": 1497866657, "post_id": 44618168, "comment_id": 76240704, "body": "Can you please explain what is a isomorphism?"}, {"owner": {"reputation": 1404, "user_id": 5559663, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/sQiE2.gif?s=128&g=1", "display_name": "baxbaxwalanuksiwe", "link": "https://stackoverflow.com/users/5559663/baxbaxwalanuksiwe"}, "edited": false, "score": 1, "creation_date": 1497867427, "post_id": 44618168, "comment_id": 76241282, "body": "An isomorphism is just a fancy word for equivalence. An isomorphism between X and Y means that there is a one-to-one correspondance between every element from X and Y."}, {"owner": {"reputation": 25967, "user_id": 1743843, "user_type": "registered", "accept_rate": 77, "profile_image": "https://www.gravatar.com/avatar/8ea2c1d9051e40332376a07bc166d9d5?s=128&d=identicon&r=PG&f=1", "display_name": "softshipper", "link": "https://stackoverflow.com/users/1743843/softshipper"}, "edited": false, "score": 0, "creation_date": 1497870775, "post_id": 44618168, "comment_id": 76243537, "body": "Awesome. Thanks"}], "tags": [], "owner": {"reputation": 1404, "user_id": 5559663, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/sQiE2.gif?s=128&g=1", "display_name": "baxbaxwalanuksiwe", "link": "https://stackoverflow.com/users/5559663/baxbaxwalanuksiwe"}, "is_accepted": true, "score": 7, "last_activity_date": 1591442790, "last_edit_date": 1591442790, "creation_date": 1497810359, "answer_id": 44618168, "question_id": 44617989, "link": "https://stackoverflow.com/questions/44617989/how-to-proof-the-number-of-possible-functions/44618168#44618168", "title": "How to proof the number of possible functions?", "body": "<p>You can use algebra to count the number of inhabitant of a type.</p>\n\n<p>There are 3 main type constructions:</p>\n\n<ul>\n<li>The sum type: <code>Either a b</code>, written as a + b</li>\n<li>The product type: <code>(a, b)</code>, written as a \u00d7 b</li>\n<li>The exponent (arrow) type, <code>a -&gt; b</code>, written as b<sup>a</sup></li>\n</ul>\n\n<p>There are also some basic types such as the unit type <code>()</code>, written as <code>1</code>, and the empty type <code>Void</code>, written as <code>0</code>.</p>\n\n<p>Most of the common algebra work on types (distribution, commutativity, powers, etc...). The underlying meaning of the resulting expression is the number of inhabitants of your type. Equality can be translated as isomorphisms in the type world.</p>\n\n<p>For an enumeration (i.e. the union of nullary constructors) like yours, we usually write that as <code>1 + 1 + ... + 1</code> with <code>n</code> <code>1</code>s, given <code>n</code> the number of constructors.</p>\n\n<p>Here, your <code>Quad</code> type translates as <code>1 + 1 + 1 + 1</code> in types, and that can be reduced as <code>4</code>. Then, your <code>Quad -&gt; Quad</code> type is written as 4<sup>4</sup>, which is 256.</p>\n"}, {"tags": [], "owner": {"reputation": 314794, "user_id": 67579, "user_type": "registered", "accept_rate": 81, "profile_image": "https://i.stack.imgur.com/BJXub.png?s=128&g=1", "display_name": "Willem Van Onsem", "link": "https://stackoverflow.com/users/67579/willem-van-onsem"}, "is_accepted": false, "score": 3, "last_activity_date": 1497815207, "last_edit_date": 1497815207, "creation_date": 1497813900, "answer_id": 44618694, "question_id": 44617989, "link": "https://stackoverflow.com/questions/44617989/how-to-proof-the-number-of-possible-functions/44618694#44618694", "title": "How to proof the number of possible functions?", "body": "<p>A function <em>f : A &rightarrow; B</em> maps values <em>x &mapsto; f(x)</em>. Given <em>A</em> and <em>B</em> are <strong>finite</strong> sets, than the number of possible functions, is limited to <em>|B| <sup>|A|</sup></em>.</p>\n\n<p>We can proof this by simple combinatorics. For every <em>x &in; A</em>, there are <em>|B|</em> possible values to map <em>f(x)</em> to. For every such <em>x</em> we can independently pick a value <em>b &in; B</em>, so as a result the total number of possible values is <em>|B| &times; |B| &times; ...  &times; |B| = |B| <sup>|A|</sup></em>.</p>\n\n<p>For the <code>Quad</code> type, if you construct a function <code>f :: Quad -&gt; Quad</code>, the <em>A = B = <code>Quad</code></em>. That means that <em>|A| = |B| = 4</em> (since there are four possible values, and none have parameters). So that means there are <em>4<sup>4</sup>=256</em> possibilities.</p>\n\n<p>The number of fuctions <code>g :: Quad -&gt; Bool</code> is thus 16: since <em>A = <code>Quad</code></em> and <em>B = <code>Bool</code></em>, this means that <em>|A| = 4</em> and <em>|B| = 2</em>, so the number of possible functions is 2<sup>4</sup>=16. These are the following:</p>\n\n<pre><code>g01 One   = False\ng01 Two   = False\ng01 Three = False\ng01 Four  = False\n\ng02 One   = False\ng02 Two   = False\ng02 Three = False\ng02 Four  = True\n\ng03 One   = False\ng03 Two   = False\ng03 Three = True\ng03 Four  = False\n\ng04 One   = False\ng04 Two   = False\ng04 Three = True\ng04 Four  = True\n\ng05 One   = False\ng05 Two   = True\ng05 Three = False\ng05 Four  = False\n\ng06 One   = False\ng06 Two   = True\ng06 Three = False\ng06 Four  = True\n\ng07 One   = False\ng07 Two   = True\ng07 Three = True\ng07 Four  = False\n\ng08 One   = False\ng08 Two   = True\ng08 Three = True\ng08 Four  = True\n\ng09 One   = True\ng09 Two   = False\ng09 Three = False\ng09 Four  = False\n\ng10 One   = True\ng10 Two   = False\ng10 Three = False\ng10 Four  = True\n\ng11 One   = True\ng11 Two   = False\ng11 Three = True\ng11 Four  = False\n\ng12 One   = True\ng12 Two   = False\ng12 Three = True\ng12 Four  = True\n\ng13 One   = True\ng13 Two   = True\ng13 Three = False\ng13 Four  = False\n\ng14 One   = True\ng14 Two   = True\ng14 Three = False\ng14 Four  = True\n\ng15 One   = True\ng15 Two   = True\ng15 Three = True\ng15 Four  = False\n\ng16 One   = True\ng16 Two   = True\ng16 Three = True\ng16 Four  = True\n</code></pre>\n\n<p>Finally one can ask about the number of functions <code>f :: a -&gt; b -&gt; c</code>. <code>a -&gt; b -&gt; c</code> is short for <code>a -&gt; (b -&gt; c)</code>. So the number of functions <code>f :: Quad -&gt; (Quad -&gt; Bool)</code>. Since the number of function <code>Quad -&gt; Bool</code> is 16, this thus means that <em>A = <code>Quad</code></em> and <em>B = <code>(Quad -&gt; Bool)</code></em> and thus <em>|A| = 4</em> and <em>|B| = 16</em>. This results in a total of <em>16<sup>4</sup>=65 536</em> possible functions. Since the number of possible implementations increases very fast, exhaustively enumerating them will thus easily become unfeasible.</p>\n"}, {"tags": [], "owner": {"reputation": 48938, "user_id": 246886, "user_type": "registered", "accept_rate": 94, "profile_image": "https://www.gravatar.com/avatar/dd1ebaade6623fc538fb8af3338e730d?s=128&d=identicon&r=PG", "display_name": "Jon Purdy", "link": "https://stackoverflow.com/users/246886/jon-purdy"}, "is_accepted": false, "score": 3, "last_activity_date": 1497821530, "creation_date": 1497821530, "answer_id": 44619727, "question_id": 44617989, "link": "https://stackoverflow.com/questions/44617989/how-to-proof-the-number-of-possible-functions/44619727#44619727", "title": "How to proof the number of possible functions?", "body": "<p>You agree that <code>Quad</code> = 4 and <code>Quad -&gt; Quad</code> = 4<sup>4</sup>. So let\u2019s do a little algebra to convince ourselves that there are 256 possible implementations of a function of type <code>Quad -&gt; Quad</code>.</p>\n\n<p>4<sup>4</sup> = 4 &times; 4 &times; 4 &times; 4. In types, that would be <code>(Quad, Quad, Quad, Quad)</code>. And we can explicitly write out that isomorphism as a pair of Haskell functions:</p>\n\n<pre><code>type Quad4 = (Quad, Quad, Quad, Quad)\n\ntupleToFunction :: Quad4 -&gt; (Quad -&gt; Quad)\ntupleToFunction (a, b, c, d) x = case x of\n  One -&gt; a\n  Two -&gt; b\n  Three -&gt; c\n  Four -&gt; d\n\nfunctionToTuple :: (Quad -&gt; Quad) -&gt; Quad4\nfunctionToTuple f = (f One, f Two, f Three, f Four)\n</code></pre>\n\n<p>Now, here\u2019s the trick: you can think of <code>Quad4</code> as a 4-digit number in base 4, ranging from 0000<sub>4</sub> = 0 = <code>(One, One, One, One)</code> to 3333<sub>4</sub> = 255 = <code>(Four, Four, Four, Four)</code>.</p>\n\n<p>Each one of these numbers represents a possible implementation. We can convert a number to an implementation by just selecting a digit and using it as the output; and we can convert an implementation to a number by \u201cpacking\u201d all its possible outputs into the digits of a number. So there\u2019s also an isomorphism between <code>Quad -&gt; Quad</code> and <code>Word8</code>!</p>\n\n<p>You could also do this by expanding the product type (tuple) into sum types (<code>Either</code>). For <code>Quad</code> it would be huge, but here\u2019s how you\u2019d do it with <code>Bool -&gt; Bool</code> = 2<sup>2</sup> = 2 &times; 2 = 2 + 2:</p>\n\n<pre><code>type BB = Either Bool Bool\n\neitherToFunction :: BB -&gt; (Bool -&gt; Bool)\neitherToFunction (Left a) _ = a\neitherToFunction (Right a) b = a == b  -- xnor\n</code></pre>\n\n<p>Now we can represent <code>const True</code> as <code>Left True</code>, <code>const False</code> as <code>Left False</code>, <code>id</code> as <code>Right True</code>, and <code>not</code> as <code>Right False</code>, and we write the other half of the isomorphism accordingly:</p>\n\n<pre><code>functionToEither :: (Bool -&gt; Bool) -&gt; BB\nfunctionToEither f\n  | f True &amp;&amp; f False = Left True\n  | f True = Right True\n  | f False = Right False\n  | otherwise = Left False\n</code></pre>\n"}], "owner": {"reputation": 25967, "user_id": 1743843, "user_type": "registered", "accept_rate": 77, "profile_image": "https://www.gravatar.com/avatar/8ea2c1d9051e40332376a07bc166d9d5?s=128&d=identicon&r=PG&f=1", "display_name": "softshipper", "link": "https://stackoverflow.com/users/1743843/softshipper"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 208, "favorite_count": 1, "accepted_answer_id": 44618168, "answer_count": 3, "score": 5, "last_activity_date": 1591442790, "creation_date": 1497809074, "last_edit_date": 1497815154, "question_id": 44617989, "link": "https://stackoverflow.com/questions/44617989/how-to-proof-the-number-of-possible-functions", "title": "How to proof the number of possible functions?", "body": "<p>Looking at function declaration, for example:</p>\n\n<pre><code>myFoo :: Bool -&gt; Bool\n</code></pre>\n\n<p>I could say, the function <code>myFoo</code> has four possible unique implementation because function type is the exponent operator, here is the proof from the case above <code>2^2 = 4</code>:</p>\n\n<pre><code>myFoo1 :: Bool -&gt; Bool\nmyFoo1 True = False \nmyFoo1 True = True\n\n\nmyFoo2 :: Bool -&gt; Bool\nmyFoo2 False = False \nmyFoo2 False = True\n</code></pre>\n\n<p>How I have following data declaration:</p>\n\n<pre><code>data Quad =\n  One\n  | Two\n  | Three\n  | Four\n  deriving (Eq, Show)\n</code></pre>\n\n<p>and following function:</p>\n\n<pre><code>funcQuad :: Quad -&gt; Quad\n</code></pre>\n\n<p>possible implementations are <code>256(4^4)</code>. I can not image it, there are a lot of implementation. </p>\n\n<p>How can I proof without writing it out?</p>\n"}, {"tags": ["haskell", "functor"], "comments": [{"owner": {"reputation": 62252, "user_id": 1435869, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/TrEd9.jpg?s=128&g=1", "display_name": "karakfa", "link": "https://stackoverflow.com/users/1435869/karakfa"}, "edited": false, "score": 1, "creation_date": 1497795357, "post_id": 44615767, "comment_id": 76217894, "body": "you need one for <code>StuffPart</code>, same as a list...  Or just enable <code>DeriveFunctor</code> to do the job for you..."}], "answers": [{"comments": [{"owner": {"reputation": 55, "user_id": 8046509, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/8c67d44ba4bb1ea25f7a7707f31e3dec?s=128&d=identicon&r=PG&f=1", "display_name": "itonva", "link": "https://stackoverflow.com/users/8046509/itonva"}, "edited": false, "score": 0, "creation_date": 1497795559, "post_id": 44615834, "comment_id": 76217971, "body": "Thank you !! Oh well I understand, but isn&#39;t there any other option to do this without making Stuffpart a Functor ?"}, {"owner": {"reputation": 314794, "user_id": 67579, "user_type": "registered", "accept_rate": 81, "profile_image": "https://i.stack.imgur.com/BJXub.png?s=128&g=1", "display_name": "Willem Van Onsem", "link": "https://stackoverflow.com/users/67579/willem-van-onsem"}, "reply_to_user": {"reputation": 55, "user_id": 8046509, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/8c67d44ba4bb1ea25f7a7707f31e3dec?s=128&d=identicon&r=PG&f=1", "display_name": "itonva", "link": "https://stackoverflow.com/users/8046509/itonva"}, "edited": false, "score": 1, "creation_date": 1497796050, "post_id": 44615834, "comment_id": 76218113, "body": "@itonva: yeah you can define a function <code>foo :: (a -&gt; b) -&gt; StuffPart a -&gt; StuffPart b</code> and then call that function. But here it seems reasonable to make <code>StuffPart</code> a function as well."}, {"owner": {"reputation": 55, "user_id": 8046509, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/8c67d44ba4bb1ea25f7a7707f31e3dec?s=128&d=identicon&r=PG&f=1", "display_name": "itonva", "link": "https://stackoverflow.com/users/8046509/itonva"}, "edited": false, "score": 0, "creation_date": 1497796162, "post_id": 44615834, "comment_id": 76218145, "body": "Ok i got it. Thanks for your help, I really appreciate this :)"}, {"owner": {"reputation": 55, "user_id": 8046509, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/8c67d44ba4bb1ea25f7a7707f31e3dec?s=128&d=identicon&r=PG&f=1", "display_name": "itonva", "link": "https://stackoverflow.com/users/8046509/itonva"}, "edited": false, "score": 1, "creation_date": 1497796947, "post_id": 44615834, "comment_id": 76218385, "body": "@Wilem Van Onsem:yes actually it is better to make <code>StuffPart</code> a <code>Functor</code>, I just wanted to know if there were any other possibilities."}, {"owner": {"reputation": 8237, "user_id": 2900502, "user_type": "registered", "accept_rate": 73, "profile_image": "https://i.stack.imgur.com/R1OjD.jpg?s=128&g=1", "display_name": "Shersh", "link": "https://stackoverflow.com/users/2900502/shersh"}, "reply_to_user": {"reputation": 55, "user_id": 8046509, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/8c67d44ba4bb1ea25f7a7707f31e3dec?s=128&d=identicon&r=PG&f=1", "display_name": "itonva", "link": "https://stackoverflow.com/users/8046509/itonva"}, "edited": false, "score": 1, "creation_date": 1497802379, "post_id": 44615834, "comment_id": 76220046, "body": "@itonva If you don&#39;t want to dive into those things (though personally I think it&#39;s a good to implement such <code>Functor</code> instances manually) you can add <code>{-# LANGUAGE DeriveFunctor #-}</code> pragma which allows you to add <code>Functor</code> inside <code>deriving</code> clause."}], "tags": [], "owner": {"reputation": 314794, "user_id": 67579, "user_type": "registered", "accept_rate": 81, "profile_image": "https://i.stack.imgur.com/BJXub.png?s=128&g=1", "display_name": "Willem Van Onsem", "link": "https://stackoverflow.com/users/67579/willem-van-onsem"}, "is_accepted": true, "score": 6, "last_activity_date": 1497797839, "last_edit_date": 1497797839, "creation_date": 1497794931, "answer_id": 44615834, "question_id": 44615767, "link": "https://stackoverflow.com/questions/44615767/defining-fmap-for-data-type/44615834#44615834", "title": "Defining fmap for data type", "body": "<p><code>fmap</code> has the signature:</p>\n\n<pre><code>fmap :: Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b\n</code></pre>\n\n<p>So that means that it will - given a function that maps from <code>a</code> to <code>b</code>, produce a function that maps <code>Stuff a</code> to <code>Stuff b</code>. But <strong>the attributes of <code>Stuff</code> are not <code>a</code>s</strong>, so you <strong>cannot call <code>f</code> on the arguments directly</strong>.</p>\n\n<p>So that probably means you want to <strong>make <code>StuffPart a</code> a <code>Functor</code></strong> first. For instance:</p>\n\n<pre><code>instance Functor StuffPart where\n    <b>fmap</b> f (Add x y) = Add (f x) (<b>fmap</b> f y)\n    <b>fmap</b> _ End = End</code></pre>\n\n<p>It looks like <code>StuffPart</code> is your custom defintion of a list (<code>[]</code>).</p>\n\n<p>and then we can simply define:</p>\n\n<pre><code>instance Functor Stuff where\n    fmap f (Stuff x y) = Stuff (<b>fmap</b> f x) (<b>fmap</b> f y)</code></pre>\n\n<p>Note that the <code>fmap</code>s we call here (the ones in boldface) refer to the function we defined above (in the context of <code>Functor StuffPart</code>).</p>\n\n<p><strong>EDIT</strong>: you do not <em>have</em> to make <code>StuffPart</code> a <code>Functor</code> per se. If you do not really want that, you can simply define a function <code>foo :: (a -&gt; b) -&gt; StuffPart a -&gt; StuffPart b</code> and call that function, but this actually looks like bad code design to me, since if you later alter the definition of <code>StuffPart</code> then parts about <code>Stuff</code> have to change as well, making it harder. But if you really want that, you can use:</p>\n\n<pre><code>instance Functor Stuff where\n    fmap f (Stuff x y) = Stuff (<b>foo</b> x) (<b>foo</b> y)\n        where <b>foo</b> (Add x y) = Add (f x) (<b>foo</b> y)\n              <b>foo</b> End = End</code></pre>\n"}, {"tags": [], "owner": {"reputation": 133611, "user_id": 152602, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/7f370b4bd787fc68f9f62d9c6781cb79?s=128&d=identicon&r=PG", "display_name": "Lee", "link": "https://stackoverflow.com/users/152602/lee"}, "is_accepted": false, "score": 5, "last_activity_date": 1497795283, "last_edit_date": 1497795283, "creation_date": 1497794937, "answer_id": 44615838, "question_id": 44615767, "link": "https://stackoverflow.com/questions/44615767/defining-fmap-for-data-type/44615838#44615838", "title": "Defining fmap for data type", "body": "<p>You also need a <code>Functor</code> instance for <code>StuffPart</code>:</p>\n\n<pre><code>instance Functor Stuff where\n  fmap f (Stuff p1 p2) = Stuff (fmap f p1) (fmap f p2)\n\ninstance Functor StuffPart where\n  fmap f (Add x sp) = Add (f x) (fmap f sp)\n  fmap f End = End\n</code></pre>\n"}], "owner": {"reputation": 55, "user_id": 8046509, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/8c67d44ba4bb1ea25f7a7707f31e3dec?s=128&d=identicon&r=PG&f=1", "display_name": "itonva", "link": "https://stackoverflow.com/users/8046509/itonva"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 130, "favorite_count": 0, "accepted_answer_id": 44615834, "answer_count": 2, "score": 0, "last_activity_date": 1497797839, "creation_date": 1497794456, "last_edit_date": 1497795176, "question_id": 44615767, "link": "https://stackoverflow.com/questions/44615767/defining-fmap-for-data-type", "title": "Defining fmap for data type", "body": "<p>So I've got those data types :</p>\n\n<pre><code>data Stuff a = Stuff (StuffPart a) (StuffPart a) deriving (Show,Eq)\ndata StuffPart a = Add a (StuffPart a)| End deriving (Show,Eq)\n</code></pre>\n\n<p>, now is it possible to write a fmap function for Stuff ? Something like :</p>\n\n<pre><code>instance Functor Stuff\n  where \n   fmap f (Stuff x y) = Stuff (f x) (f y)\n</code></pre>\n\n<p>Obviously my fmap won't work but what can I do to make it work.\nI have also tried code like :</p>\n\n<pre><code>instance Functor Stuff\n  where \n   fmap f (Stuff x y) = Stuff (f x) (fmap f y)\n</code></pre>\n\n<p>Somehow I feel lost in terms of fmap functions..</p>\n"}, {"tags": ["haskell", "search", "parallel-processing"], "comments": [{"owner": {"reputation": 13807, "user_id": 2407038, "user_type": "registered", "accept_rate": 64, "profile_image": "https://www.gravatar.com/avatar/538f6f4a9aa43841841de7d8e8b169fc?s=128&d=identicon&r=PG&f=1", "display_name": "user2407038", "link": "https://stackoverflow.com/users/2407038/user2407038"}, "edited": false, "score": 0, "creation_date": 1497794693, "post_id": 44615468, "comment_id": 76217683, "body": "You are using <code>Eval</code> incorrectly - you shouldn&#39;t <code>runEval</code> at every cons of the list. I doubt this would give any performance gain in general, unless computing <code>hasPropertyX</code> is absurdly expensive and the list is comparatively short. Have you benchmarked the version using <code>parListChunk</code>? The hypothesis &quot;it must search through the entire list&quot; might be valid but you should test it. Anyways, I&#39;m guessing something like <code>or . parMap return hasPropertyX</code> would work just fine (or <code>or . parMap (parListChunk k return) hasPropertyX</code> for some <code>k</code>)."}, {"owner": {"reputation": 53, "user_id": 7994574, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/6b56bb47526ed9b1d72c20a7bd284477?s=128&d=identicon&r=PG&f=1", "display_name": "Eddy JD", "link": "https://stackoverflow.com/users/7994574/eddy-jd"}, "reply_to_user": {"reputation": 13807, "user_id": 2407038, "user_type": "registered", "accept_rate": 64, "profile_image": "https://www.gravatar.com/avatar/538f6f4a9aa43841841de7d8e8b169fc?s=128&d=identicon&r=PG&f=1", "display_name": "user2407038", "link": "https://stackoverflow.com/users/2407038/user2407038"}, "edited": false, "score": 0, "creation_date": 1497799525, "post_id": 44615468, "comment_id": 76219253, "body": "Thanks! The first snippet you listed (<code>or . parMap return hasPropertyX</code>) works as listed, but gets slower with each processor core that I add. The second one  (<code>or . parMap (parListChunk 2 return) hasPropertyX</code>) errors as listed, and I&#39;m having a problem figuring it out:     <code>\u2022 Couldn&#39;t match type \u2018[a0]\u2019 with \u2018Bool\u2019       Expected type: [Object] -&gt; [Bool]         Actual type: [Object] -&gt; [[a0]]</code>"}, {"owner": {"reputation": 53, "user_id": 7994574, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/6b56bb47526ed9b1d72c20a7bd284477?s=128&d=identicon&r=PG&f=1", "display_name": "Eddy JD", "link": "https://stackoverflow.com/users/7994574/eddy-jd"}, "reply_to_user": {"reputation": 13807, "user_id": 2407038, "user_type": "registered", "accept_rate": 64, "profile_image": "https://www.gravatar.com/avatar/538f6f4a9aa43841841de7d8e8b169fc?s=128&d=identicon&r=PG&f=1", "display_name": "user2407038", "link": "https://stackoverflow.com/users/2407038/user2407038"}, "edited": false, "score": 0, "creation_date": 1497803808, "post_id": 44615468, "comment_id": 76220444, "body": "I fixed the error with  <code>or . withStrategy (parListChunk 2 return) . map hasPropertyX</code>. It still gets slower with each processor added. I don&#39;t feel like it&#39;s interrupting the other threads when a match is found, but I&#39;m not sure how to test this."}, {"owner": {"reputation": 13807, "user_id": 2407038, "user_type": "registered", "accept_rate": 64, "profile_image": "https://www.gravatar.com/avatar/538f6f4a9aa43841841de7d8e8b169fc?s=128&d=identicon&r=PG&f=1", "display_name": "user2407038", "link": "https://stackoverflow.com/users/2407038/user2407038"}, "edited": false, "score": 0, "creation_date": 1497808245, "post_id": 44615468, "comment_id": 76221644, "body": "(Right, sorry about that, I didn&#39;t typecheck the code except in my head). It doesn&#39;t make sense to talk about interrupting a spark (as opposed to interrupting a thread started with e.g. <code>forkIO</code> by throwing an exception to it) because a spark is internal to the runtime. If you have an expression like <code>x || y</code> then as soon as <code>x</code> evaluates to <code>True</code>, <code>x || y</code> also evaluates to <code>True</code>. Then the spark which was forked to evaluate <code>y</code> will be garbage collected. That happens on the next GC cycle, so you need to pick a chunk size which works will with the frequency of GC (by experimentation!)."}, {"owner": {"reputation": 13807, "user_id": 2407038, "user_type": "registered", "accept_rate": 64, "profile_image": "https://www.gravatar.com/avatar/538f6f4a9aa43841841de7d8e8b169fc?s=128&d=identicon&r=PG&f=1", "display_name": "user2407038", "link": "https://stackoverflow.com/users/2407038/user2407038"}, "edited": false, "score": 0, "creation_date": 1497808457, "post_id": 44615468, "comment_id": 76221700, "body": "... You almost certainly want a chunk size in the thousands or tens of thousand (you say &quot;list is very large&quot;!) - the cost of splitting the list into chunks of 2 and trying to spark a thread to process two elements will probably dominate the running time compared to evaluating <code>propertyX</code>. Also, it may be that you have to fold each sparked chunk individually, then fold the results from each spark sequentially - something like <code>or . map or . withStrategy .. . map propertyX</code> (again, untested)."}, {"owner": {"reputation": 23111, "user_id": 1319998, "user_type": "registered", "accept_rate": 58, "profile_image": "https://www.gravatar.com/avatar/9f600f4583bec89109ce8c0c098951ae?s=128&d=identicon&r=PG", "display_name": "Michal Charemza", "link": "https://stackoverflow.com/users/1319998/michal-charemza"}, "edited": false, "score": 0, "creation_date": 1497845606, "post_id": 44615468, "comment_id": 76230019, "body": "How is this very large list getting populated? I wonder if a list is the best type... Maybe Vector would be better? Would then mean you can split the vector up without traversing it and keeping better data locality for each thread?"}], "answers": [{"tags": [], "owner": {"reputation": 34158, "user_id": 7203016, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/ybAMw.png?s=128&g=1", "display_name": "K. A. Buhr", "link": "https://stackoverflow.com/users/7203016/k-a-buhr"}, "is_accepted": false, "score": 2, "last_activity_date": 1497809184, "last_edit_date": 1497809184, "creation_date": 1497808840, "answer_id": 44617959, "question_id": 44615468, "link": "https://stackoverflow.com/questions/44615468/haskell-parallel-search-with-early-abort/44617959#44617959", "title": "Haskell parallel search with early abort", "body": "<p>I don't think you're going to have much luck using <code>Control.Parallel.Strategies</code>.  A key feature of this module is that it expresses \"deterministic parallelism\" such that the result of the program is unaffected by the parallel evaluation.  The problem you've described is fundamentally non-deterministic because threads are racing to find the <em>first</em> match.</p>\n\n<p><strong>Update:</strong>  I see now that you're only returning <code>True</code> if the element is found, so the desired behavior <em>is</em> technically deterministic.  So, perhaps there is a way to trick the <code>Strategies</code> module into working.  Still, the implementation below seems to meet the requirements.</p>\n\n<p>Here's an implementation of a parallel find <code>parFind</code> that runs in the IO monad using <code>Control.Concurrent</code> primitives and seems to do what you want.  Two <code>MVars</code> are used:  <code>runningV</code> keeps count of how many threads are still running to allow the last thread standing to detect search failure; and <code>resultV</code> is used to return <code>Just</code> the result or <code>Nothing</code> when search failure is detected by that last thread.  Note that it is unlikely to perform better than a single-threaded implementation unless the test (your <code>hasPropertyX</code> above) is substantially more work than the list traversal, unlike this toy example.</p>\n\n<pre><code>import Control.Monad\nimport Control.Concurrent\nimport Data.List\nimport System.Environment\n\n-- Thin a list to every `n`th element starting with index `i`\nthin :: Int -&gt; Int -&gt; [a] -&gt; [a]\nthin i n = unfoldr step . drop i\n  where step [] = Nothing\n        step (y:ys) = Just (y, drop (n-1) ys)\n\n-- Use `n` parallel threads to find first element of `xs` satisfying `f`\nparFind :: Int -&gt; (a -&gt; Bool) -&gt; [a] -&gt; IO (Maybe a)\nparFind n f xs = do\n  resultV &lt;- newEmptyMVar\n  runningV &lt;- newMVar n\n  comparisonsV &lt;- newMVar 0\n  threads &lt;- forM [0..n-1] $ \\i -&gt; forkIO $ do\n    case find f (thin i n xs) of\n      Just x -&gt; void (tryPutMVar resultV (Just x))\n      Nothing -&gt; do m &lt;- takeMVar runningV\n                    if m == 1\n                      then void (tryPutMVar resultV Nothing)\n                      else putMVar runningV (m-1)\n  result &lt;- readMVar resultV\n  mapM_ killThread threads\n  return result\n\nmyList :: [Int]\nmyList = [1..1000000000]\n\n-- Use `n` threads to find first element equal to `y` in `myList`\nrun :: Int -&gt; Int -&gt; IO ()\nrun n y = do x &lt;- parFind n (== y) myList\n             print x\n\n-- e.g.,  stack ghc -- -O2 -threaded SearchList.hs\n--        time ./SearchList +RTS -N4 -RTS 4 12345  # find 12345 using 4 threads -&gt; 0.018s\n--        time ./SearchList +RTS -N4 -RTS 4 -1     # full search w/o match -&gt; 6.7s\nmain :: IO ()\nmain = do [n,y] &lt;- getArgs\n          run (read n) (read y)\n</code></pre>\n\n<p>Also, note that this version runs the threads on interleaved sublists rather than dividing the main list up into consecutive chunks.  I did it this way because (1) it was easier to demonstrate that \"early\" elements were found quickly; and (2) my huge list means that memory usage can explode if the whole list needs to be kept in memory.</p>\n\n<p>In fact, this example is a bit of a performance time bomb -- its memory usage is nondeterministic and can probably explode if one thread falls way behind so that a substantial portion of the whole list needs to be kept in memory.</p>\n\n<p>In a real world example where the whole list <em>is</em> probably being kept in memory and the property test is expensive, you may find that breaking the list into chunks is faster.</p>\n"}], "owner": {"reputation": 53, "user_id": 7994574, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/6b56bb47526ed9b1d72c20a7bd284477?s=128&d=identicon&r=PG&f=1", "display_name": "Eddy JD", "link": "https://stackoverflow.com/users/7994574/eddy-jd"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 159, "favorite_count": 2, "answer_count": 1, "score": 4, "last_activity_date": 1497809184, "creation_date": 1497792325, "last_edit_date": 1497792664, "question_id": 44615468, "link": "https://stackoverflow.com/questions/44615468/haskell-parallel-search-with-early-abort", "title": "Haskell parallel search with early abort", "body": "<p>I'd like to search through a list, testing each element for property X and then return when an element with property X is found.</p>\n\n<p>This list is very large and would benefit from parallelism, but the cost of the spark is rather high relative to the compute time. <code>parListChunk</code> would be great, but then it must search through the entire list. </p>\n\n<p>Is there some way I can write something like <code>parListChunk</code> but with early abort?</p>\n\n<p>This is the naive search code:</p>\n\n<pre><code>hasPropertyX :: Object -&gt; Bool\n\nanyObjectHasPropertyX :: [Object] -&gt; Bool\nanyObjectHasPropertyX [] = False\nanyObjectHasPropertyX l\n| hasPropertyX (head l) == True = True\n| otherwise = anyObjectHasPropertyX (tail l)\n</code></pre>\n\n<p>and this is my first attempt at parallelism:</p>\n\n<pre><code>anyObjectHasPropertyXPar [] = False\nanyObjectHasPropertyXPar [a] = hasPropertyX a\nanyObjectHasPropertyXPar (a:b:rest) = runEval $ do c1 &lt;- rpar (force (hasPropertyX a))\n                                                   c2 &lt;- rpar (force (hasPropertyX b))\n                                                   rseq c1\n                                                   rseq c2\n                                                   if (c1 == True) || (c2 == True) then return True else return (anyObjectHasPropertyXPar rest)\n</code></pre>\n\n<p>This does run slightly faster than the naive code (even with <code>-N1</code>, oddly enough), but not by much (it helps a little by extending the number of parallel computations). I believe it's not benefitting much because it has to spark one thread for each element in the list.</p>\n\n<p>Is there an approach similar to <code>parListChunk</code> that will only spark n threads and that allows for an early abort?</p>\n\n<p>Edit: I'm having problems thinking about this because it seems that I would need to monitor the return value of all the threads. If I omit the <code>rseq</code>'s and have something like</p>\n\n<pre><code>if (c1 == True) || (c2 == True) then ...\n</code></pre>\n\n<p>Is the runtime environment intelligent enough to monitor both threads and continue when either one of them returns?</p>\n"}, {"tags": ["haskell", "purescript", "unification", "impredicativetypes", "rank-n-types"], "comments": [{"owner": {"reputation": 314794, "user_id": 67579, "user_type": "registered", "accept_rate": 81, "profile_image": "https://i.stack.imgur.com/BJXub.png?s=128&g=1", "display_name": "Willem Van Onsem", "link": "https://stackoverflow.com/users/67579/willem-van-onsem"}, "edited": false, "score": 0, "creation_date": 1497792462, "post_id": 44615441, "comment_id": 76217088, "body": "Wouldn&#39;t that break <i>referential transparency</i>?"}, {"owner": {"reputation": 13807, "user_id": 2407038, "user_type": "registered", "accept_rate": 64, "profile_image": "https://www.gravatar.com/avatar/538f6f4a9aa43841841de7d8e8b169fc?s=128&d=identicon&r=PG&f=1", "display_name": "user2407038", "link": "https://stackoverflow.com/users/2407038/user2407038"}, "edited": false, "score": 4, "creation_date": 1497795100, "post_id": 44615441, "comment_id": 76217805, "body": "Add a phantom type parameter to <code>Value</code> and instantiate it with two different types inside <code>A</code>; e.g. using <code>TypeLits</code>: <code>data A = A (Value 1) (Value 2)</code>. This is essentially nothing more than having two (or <code>k</code> for <code>k : Nat</code>) distinct, isomorphic <code>Value</code> types. (Aside: the first thing you say you tried is called &#39;existensial&#39; types, not &#39;impredicative&#39; or &#39;rank-N&#39;, which are both entirely different things)."}], "answers": [{"comments": [{"owner": {"reputation": 10378, "user_id": 2476735, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/39e9447bbc32246fcd23b76b5e946618?s=128&d=identicon&r=PG&f=1", "display_name": "David Young", "link": "https://stackoverflow.com/users/2476735/david-young"}, "edited": false, "score": 1, "creation_date": 1497825025, "post_id": 44616412, "comment_id": 76226092, "body": "You might want to either not use the non-ASCII unicode symbols or add <code>UnicodeSyntax</code> to the language extensions (personally, I&#39;d suggest the former since it is probably a bit more clear in the context of an answer to a programming question)."}, {"owner": {"reputation": 1404, "user_id": 5559663, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/sQiE2.gif?s=128&g=1", "display_name": "baxbaxwalanuksiwe", "link": "https://stackoverflow.com/users/5559663/baxbaxwalanuksiwe"}, "reply_to_user": {"reputation": 10378, "user_id": 2476735, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/39e9447bbc32246fcd23b76b5e946618?s=128&d=identicon&r=PG&f=1", "display_name": "David Young", "link": "https://stackoverflow.com/users/2476735/david-young"}, "edited": false, "score": 0, "creation_date": 1497857488, "post_id": 44616412, "comment_id": 76234897, "body": "Sorry, UnicodeSyntax is by default in my GHCi, I edited my code to use ASCII characters, thanks."}], "tags": [], "owner": {"reputation": 1404, "user_id": 5559663, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/sQiE2.gif?s=128&g=1", "display_name": "baxbaxwalanuksiwe", "link": "https://stackoverflow.com/users/5559663/baxbaxwalanuksiwe"}, "is_accepted": true, "score": 4, "last_activity_date": 1497857384, "last_edit_date": 1497857384, "creation_date": 1497798624, "answer_id": 44616412, "question_id": 44615441, "link": "https://stackoverflow.com/questions/44615441/disallow-assignment-of-values/44616412#44616412", "title": "Disallow assignment of values", "body": "<p>As user2407038 mentionned, you could use phantom types to do what you want.</p>\n\n<pre><code>{-# LANGUAGE DataKinds, GADTs, KindSignatures #-}\n\ndata ValueType = A | B\n\ndata Value :: ValueType -&gt; * where\n    Value :: Int \u2192 Value t\n\ndata V = V { a :: Value A, b :: Value B }\n\nmodify \u2237 V -&gt; V\nmodify v = v { a = a v }  -- no error\nmodify v = v { a = b v }  -- Couldn't match type \u2018'B\u2019 with \u2018'A\u2019\n</code></pre>\n\n<p>However, there is a workaround:</p>\n\n<pre><code>modify \u2237 V -&gt; V\nmodify v = v { a = Value $ getBValue (b v) }\n    where getBValue (Value x) = x\n</code></pre>\n\n<p>But you can prevent the user from writing <code>getBValue</code> if you hide the <code>Value</code> constructor (by not exporting it). But that would mean that there is absolutely no way to extract the actual value out of a <code>Value</code>. You could still instantiate <code>Value</code> for the <code>Functor</code>, <code>Applicative</code> and <code>Monad</code> so that you can work with those wrapped values directly. But you would have to change <code>Value</code> to a more general form. Here is an example:</p>\n\n<pre><code>data Value :: ValueType -&gt; * -&gt; * where\n    Value :: a -&gt; Value t a\n\ninstance Functor (Value t) where\n    fmap f (Value x) = Value (f x)\n\ninstance Applicative (Value t) where\n    pure = Value\n    Value f &lt;*&gt; Value x = Value (f x)\n\ninstance Monad (Value t) where\n    Value x &gt;&gt;= f = f x\n</code></pre>\n"}], "owner": {"reputation": 2535, "user_id": 634020, "user_type": "registered", "accept_rate": 87, "profile_image": "https://www.gravatar.com/avatar/044be669886e6b2e625776ff8be167b7?s=128&d=identicon&r=PG", "display_name": "Philip Kamenarsky", "link": "https://stackoverflow.com/users/634020/philip-kamenarsky"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 90, "favorite_count": 1, "accepted_answer_id": 44616412, "answer_count": 1, "score": 2, "last_activity_date": 1497857384, "creation_date": 1497792109, "question_id": 44615441, "link": "https://stackoverflow.com/questions/44615441/disallow-assignment-of-values", "title": "Disallow assignment of values", "body": "<p>I'm experimenting with a type-level permission system, and I'm trying to disallow assignment of values which do not originate from the same \"source\", i.e:</p>\n\n<pre><code>data A = A { a :: Value, b :: Value }\n\nmodify :: A -&gt; A\nmodify (A v) = A $ v { a = v.a } -- should work\nmodify (A v) = A $ v { a = v.b } -- should *NOT* work\n</code></pre>\n\n<p>I've experimented with rank N (or impredicative?) types:</p>\n\n<pre><code>type Value = forall a. Value a ...\n</code></pre>\n\n<p>but both cases above unify. If I constrain <code>a</code>:</p>\n\n<pre><code>type Value = forall a. Unique a =&gt; Value a ...\n</code></pre>\n\n<p>both cases don't. Is there a way to achieve something like that? Is it possible in Haskell?</p>\n\n<p>(Note: the <code>Value</code> constructor would not be public, i.e. there's no way to create a standalone <code>Value</code>.)</p>\n"}, {"tags": ["haskell", "recursion", "haskell-lens", "recursion-schemes"], "comments": [{"owner": {"reputation": 13807, "user_id": 2407038, "user_type": "registered", "accept_rate": 64, "profile_image": "https://www.gravatar.com/avatar/538f6f4a9aa43841841de7d8e8b169fc?s=128&d=identicon&r=PG&f=1", "display_name": "user2407038", "link": "https://stackoverflow.com/users/2407038/user2407038"}, "edited": false, "score": 0, "creation_date": 1497796518, "post_id": 44612606, "comment_id": 76218241, "body": "How exactly does the 2nd example go wrong? What are the intended semantics of <code>showOptions</code> and <code>showOptions&#39;</code>? I have no idea what it means to &quot;provide lensed contexts to the para function as it does its work&quot;. <code>Pretext (-&gt;) a a a</code> is really just <code>(a, a -&gt; a)</code> and I&#39;m not sure what that represents - you don&#39;t even use the <code>ctx</code> in your implementation of <code>showOptions&#39;</code>! If you don&#39;t need that <code>ctx</code>, what is the point of your <code>paraApp</code>?"}, {"owner": {"reputation": 1589, "user_id": 2535671, "user_type": "registered", "accept_rate": 87, "profile_image": "https://www.gravatar.com/avatar/fca1ba52e0c41803e676d449ef242e75?s=128&d=identicon&r=PG&f=1", "display_name": "Julian Leviston", "link": "https://stackoverflow.com/users/2535671/julian-leviston"}, "reply_to_user": {"reputation": 13807, "user_id": 2407038, "user_type": "registered", "accept_rate": 64, "profile_image": "https://www.gravatar.com/avatar/538f6f4a9aa43841841de7d8e8b169fc?s=128&d=identicon&r=PG&f=1", "display_name": "user2407038", "link": "https://stackoverflow.com/users/2407038/user2407038"}, "edited": false, "score": 0, "creation_date": 1497797709, "post_id": 44612606, "comment_id": 76218663, "body": "Sorry about that I thought I was pretty clear. The output is supposed to be identical. <code>Pretext</code> is like a <code>Context</code> from the <code>Control.Lens.Plated</code> library in that it&#39;s a lens applied to a value. It lets us use <code>pos</code> to get the focussed data out (like a getter), or <code>peek</code> to adjust the original structure (like a setter). I know I&#39;m not using <code>ctx</code> in my implementation of <code>showOptions&#39;</code> \u2014 I mentioned it above \u2014 it&#39;s so that I <i>can</i> use it when I need to next up (otherwise I&#39;d just use <code>showOptions</code>."}, {"owner": {"reputation": 1589, "user_id": 2535671, "user_type": "registered", "accept_rate": 87, "profile_image": "https://www.gravatar.com/avatar/fca1ba52e0c41803e676d449ef242e75?s=128&d=identicon&r=PG&f=1", "display_name": "Julian Leviston", "link": "https://stackoverflow.com/users/2535671/julian-leviston"}, "reply_to_user": {"reputation": 13807, "user_id": 2407038, "user_type": "registered", "accept_rate": 64, "profile_image": "https://www.gravatar.com/avatar/538f6f4a9aa43841841de7d8e8b169fc?s=128&d=identicon&r=PG&f=1", "display_name": "user2407038", "link": "https://stackoverflow.com/users/2407038/user2407038"}, "edited": false, "score": 0, "creation_date": 1497798149, "post_id": 44612606, "comment_id": 76218811, "body": "What I meant by &quot;provide lensed contexts to the para function as it does its work&quot; is ... the paramorphism function takes a function which it calls on the <code>plate</code> contexts of whatever level is currently being focussed on.  That second function usually takes two values: the next <code>plate</code> value, and a list of the results so far. This is what a paramorphism is. If the function returns a list, those then get focussed on, too. <i>My</i> version of <code>para</code> rather passes a tuple of the next plate value and the Pretext of that value related to the original structure. This is so that later on I can use it."}, {"owner": {"reputation": 1589, "user_id": 2535671, "user_type": "registered", "accept_rate": 87, "profile_image": "https://www.gravatar.com/avatar/fca1ba52e0c41803e676d449ef242e75?s=128&d=identicon&r=PG&f=1", "display_name": "Julian Leviston", "link": "https://stackoverflow.com/users/2535671/julian-leviston"}, "reply_to_user": {"reputation": 13807, "user_id": 2407038, "user_type": "registered", "accept_rate": 64, "profile_image": "https://www.gravatar.com/avatar/538f6f4a9aa43841841de7d8e8b169fc?s=128&d=identicon&r=PG&f=1", "display_name": "user2407038", "link": "https://stackoverflow.com/users/2407038/user2407038"}, "edited": false, "score": 0, "creation_date": 1497798485, "post_id": 44612606, "comment_id": 76218933, "body": "The definition for <code>Lens.para</code> can be found at <a href=\"https://hackage.haskell.org/package/lens-4.15.2/docs/src/Control.Lens.Plated.html#para\" rel=\"nofollow noreferrer\">hackage.haskell.org/package/lens-4.15.2/docs/src/&hellip;</a>"}, {"owner": {"reputation": 1589, "user_id": 2535671, "user_type": "registered", "accept_rate": 87, "profile_image": "https://www.gravatar.com/avatar/fca1ba52e0c41803e676d449ef242e75?s=128&d=identicon&r=PG&f=1", "display_name": "Julian Leviston", "link": "https://stackoverflow.com/users/2535671/julian-leviston"}, "reply_to_user": {"reputation": 13807, "user_id": 2407038, "user_type": "registered", "accept_rate": 64, "profile_image": "https://www.gravatar.com/avatar/538f6f4a9aa43841841de7d8e8b169fc?s=128&d=identicon&r=PG&f=1", "display_name": "user2407038", "link": "https://stackoverflow.com/users/2407038/user2407038"}, "edited": false, "score": 0, "creation_date": 1497799570, "post_id": 44612606, "comment_id": 76219261, "body": "I think I&#39;m starting to see the problem now. Because I&#39;m doing the depth traversal by using repeated composition on <code>Lens.plate</code> directly with relation to the original value, rather than on each sub-value, like <code>Lens.para</code> does, it&#39;s causing the recursion explosion. I&#39;ll have to find a way to only apply to the <code>holes</code> that are needed in each case. Would still value anyone&#39;s input if they have any."}, {"owner": {"reputation": 1589, "user_id": 2535671, "user_type": "registered", "accept_rate": 87, "profile_image": "https://www.gravatar.com/avatar/fca1ba52e0c41803e676d449ef242e75?s=128&d=identicon&r=PG&f=1", "display_name": "Julian Leviston", "link": "https://stackoverflow.com/users/2535671/julian-leviston"}, "reply_to_user": {"reputation": 13807, "user_id": 2407038, "user_type": "registered", "accept_rate": 64, "profile_image": "https://www.gravatar.com/avatar/538f6f4a9aa43841841de7d8e8b169fc?s=128&d=identicon&r=PG&f=1", "display_name": "user2407038", "link": "https://stackoverflow.com/users/2407038/user2407038"}, "edited": false, "score": 0, "creation_date": 1497825932, "post_id": 44612606, "comment_id": 76226263, "body": "Ok so I think I need to use <code>holesOnOf</code> instead of <code>holesOf</code> :)"}], "answers": [{"comments": [{"owner": {"reputation": 7587, "user_id": 943010, "user_type": "registered", "accept_rate": 60, "profile_image": "https://i.stack.imgur.com/R7Q27.png?s=128&g=1", "display_name": "kdopen", "link": "https://stackoverflow.com/users/943010/kdopen"}, "edited": false, "score": 0, "creation_date": 1499456428, "post_id": 44951949, "comment_id": 76932240, "body": "This does not provide an answer to the question. To critique or request clarification from an author, leave a comment below their post. - <a href=\"/review/low-quality-posts/16643822\">From Review</a>"}, {"owner": {"reputation": 1589, "user_id": 2535671, "user_type": "registered", "accept_rate": 87, "profile_image": "https://www.gravatar.com/avatar/fca1ba52e0c41803e676d449ef242e75?s=128&d=identicon&r=PG&f=1", "display_name": "Julian Leviston", "link": "https://stackoverflow.com/users/2535671/julian-leviston"}, "reply_to_user": {"reputation": 7587, "user_id": 943010, "user_type": "registered", "accept_rate": 60, "profile_image": "https://i.stack.imgur.com/R7Q27.png?s=128&g=1", "display_name": "kdopen", "link": "https://stackoverflow.com/users/943010/kdopen"}, "edited": false, "score": 0, "creation_date": 1499463059, "post_id": 44951949, "comment_id": 76935234, "body": "I <i>am</i> the author lol. But yeah, I&#39;ll amend the answer to actually answer the question, which is asking where the error lies in the recursion."}, {"owner": {"reputation": 7587, "user_id": 943010, "user_type": "registered", "accept_rate": 60, "profile_image": "https://i.stack.imgur.com/R7Q27.png?s=128&g=1", "display_name": "kdopen", "link": "https://stackoverflow.com/users/943010/kdopen"}, "edited": false, "score": 0, "creation_date": 1499468318, "post_id": 44951949, "comment_id": 76936847, "body": "Thanks. The comments are &#39;canned&#39; and inserted by the review system"}], "tags": [], "owner": {"reputation": 1589, "user_id": 2535671, "user_type": "registered", "accept_rate": 87, "profile_image": "https://www.gravatar.com/avatar/fca1ba52e0c41803e676d449ef242e75?s=128&d=identicon&r=PG&f=1", "display_name": "Julian Leviston", "link": "https://stackoverflow.com/users/2535671/julian-leviston"}, "is_accepted": true, "score": 0, "last_activity_date": 1499463335, "last_edit_date": 1499463335, "creation_date": 1499351729, "answer_id": 44951949, "question_id": 44612606, "link": "https://stackoverflow.com/questions/44612606/recursion-issue-when-writing-a-pretext-aware-version-of-lens-para/44951949#44951949", "title": "Recursion issue when writing a &quot;Pretext&quot; aware version of Lens.para", "body": "<p>This has taken me on a very interesting journey which I'm still on. I'm pretty sure the answer lies in creating a new function that merges the functionality of <code>Lens.paraOf plate</code> with that of <code>Lens.contexts</code>. At least I know the problem now and much more about Context and recursion schemes. I'd suggest anyone who is interested in writing this function should look into the source of those.</p>\n\n<p>So, to answer the question, the error in the recursion lies in the fact that I'm using fmap (<code>&lt;$&gt;</code>) to map <strong>every single</strong> <em>upper</em> lens over <strong>every single</strong> child in the <em>lower</em> part of structure. That means that each subtree, rather than only getting the recursion into its particular part of the tree, is getting the full recursion into every part of the tree.</p>\n\n<p>A correct implementation would take this into consideration.</p>\n"}], "owner": {"reputation": 1589, "user_id": 2535671, "user_type": "registered", "accept_rate": 87, "profile_image": "https://www.gravatar.com/avatar/fca1ba52e0c41803e676d449ef242e75?s=128&d=identicon&r=PG&f=1", "display_name": "Julian Leviston", "link": "https://stackoverflow.com/users/2535671/julian-leviston"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 135, "favorite_count": 0, "accepted_answer_id": 44951949, "answer_count": 1, "score": 2, "last_activity_date": 1499463335, "creation_date": 1497770173, "last_edit_date": 1497798455, "question_id": 44612606, "link": "https://stackoverflow.com/questions/44612606/recursion-issue-when-writing-a-pretext-aware-version-of-lens-para", "title": "Recursion issue when writing a &quot;Pretext&quot; aware version of Lens.para", "body": "<p>I've been trying to build a replacement for <code>Lens.para</code> that provides lensed contexts to the para function as it does its work. However, I seem to have made an error in the recursion somewhere.</p>\n\n<p>According to my understanding of it, <code>Lens.para</code> is a paramorphism function over <strong>values</strong> in a recursive algebraic data type. That is, it uses <code>plated</code> and takes a function that explodes an options list to be used for traversing across the \"self-similar syntax space\" of a piece of data, all the while making its traversal data-context available to the function as it does its work. Its type is <code>Lens.Plated a =&gt; (a -&gt; [r] -&gt; r) -&gt; a -&gt; r</code>, where <code>[r]</code> is the list of data-context values, and <code>a</code> is the type of each value which plated knows how to \"look into\" successive levels of.</p>\n\n<p>The <strong>extremely simple toy example</strong> data type I'm using to proof-of-concept this is as follows:</p>\n\n<p><code>\ndata EExp a\n  = ELit a\n  | EAdd (EExp a) (EExp a)\n  deriving (Show, Eq)\n</code></p>\n\n<p>So, here is my code, including both the existing working version of <code>showOptions</code> and my new version of it, <code>showOptions'</code> which uses my custom <code>Lens.para</code> which is called <code>paraApp</code>. The difference is that this one passes a <code>Pretext</code> along with the data as it does its work so that later I can adjust my code to make use of this <code>Pretext</code> to adjust the original data structure if need be.</p>\n\n<pre><code>{-# LANGUAGE RankNTypes, TemplateHaskell, ExplicitForAll, DeriveDataTypeable, StandaloneDeriving #-}\n\nmodule StepThree where\n\nimport qualified Control.Lens as Lens\nimport qualified Data.Data as DD\nimport qualified Data.Data.Lens as DDL\nimport qualified Data.Maybe as DM\nimport qualified Data.List as DL\nimport Text.Read (readMaybe)\nimport StepThreeGrammar (EExp(..), pretty, run)\n\nimport Control.Comonad.Store.Class (pos, peek, ComonadStore)\nimport Control.Lens.Internal.Context (Pretext(..), sell)\n\nimport qualified Language.Haskell.Interpreter as I\nimport Language.Haskell.Interpreter (Interpreter, GhcError(..), InterpreterError(..))\n\ninstance DD.Data a =&gt; Lens.Plated (EExp a)\nderiving instance DD.Data a =&gt; DD.Data (EExp a)\n\neg3' :: EExp Int\neg3' = EAdd (EAdd (EAdd (EAdd (EAdd (ELit 11) (ELit 9)) (ELit 3)) (ELit 1)) (ELit 5)) (ELit 0)\n\nshowOptions :: (Lens.Plated a, Show a) =&gt; (a -&gt; String) -&gt; a -&gt; [String]\nshowOptions showFn = Lens.para $ \\a xs -&gt;\n    let\n      sa = showFn a\n      (_,is) = DL.mapAccumL mapAccumFn (0, sa) xs\n    in\n      sa : concat is\n  where\n    mapAccumFn (n, acc) x =\n      let\n        i = pfxIndex (head x) acc\n      in\n        ( (n+i+length (head x)\n          , drop (i+length (head x)) acc)\n        , map (replicate (n+i) ' ' ++) x)\n\n\nshowOptions' :: (Lens.Plated a, Show a) =&gt; (a -&gt; String) -&gt; a -&gt; [String]\nshowOptions' showFn = paraApp $ \\(a, ctx) xs -&gt;\n    let\n      sa = showFn a\n      (_, is) = DL.mapAccumL mapAccumFn (0, sa) xs\n    in\n      sa : concat is\n  where\n    mapAccumFn (n, acc) x =\n      let\n        i = pfxIndex (head x) acc\n      in\n        ( (n+i+length (head x)\n          , drop (i+length (head x)) acc)\n        , map (replicate (n+i) ' ' ++) x)\n\nparaApp :: Lens.Plated a =&gt; ((a, Pretext (-&gt;) a a a) -&gt; [r] -&gt; r) -&gt; a -&gt; r\nparaApp f x = go id (x, makePretextFocussingOnSelfFor x)\n  where\n    go p a =\n      let p' = Lens.plate . p\n          holes = Lens.holesOf p' x\n      in f a (go p' &lt;$&gt; (map (\\c -&gt; (pos c, c)) holes))\n    makePretextFocussingOnSelfFor x = Pretext ($ x)\n\n\npfxIndex :: Eq a =&gt; [a] -&gt; [a] -&gt; Int\npfxIndex x y = maybe 0 id (DL.findIndex (x `DL.isPrefixOf`) (DL.tails y))\n</code></pre>\n\n<p>If I go into <code>GHCi</code> and execute the following code, it provides the intended output:</p>\n\n<pre><code>*Main EditorTest StepThree Control.Lens&gt; mapM_ putStrLn $ StepThree.showOptions show eg3'\nEAdd (EAdd (EAdd (EAdd (EAdd (ELit 11) (ELit 9)) (ELit 3)) (ELit 1)) (ELit 5)) (ELit 0)\n      EAdd (EAdd (EAdd (EAdd (ELit 11) (ELit 9)) (ELit 3)) (ELit 1)) (ELit 5)\n            EAdd (EAdd (EAdd (ELit 11) (ELit 9)) (ELit 3)) (ELit 1)\n                  EAdd (EAdd (ELit 11) (ELit 9)) (ELit 3)\n                        EAdd (ELit 11) (ELit 9)\n                              ELit 11\n                                        ELit 9\n                                                  ELit 3\n                                                            ELit 1\n                                                                      ELit 5\n                                                                                ELit 0\n</code></pre>\n\n<p>Which is fine for the case when I don't want to do anything with a context (say updating a particular piece of the original value)</p>\n\n<p>So when I attempt the replacement function, the following happens (it should be identical to the above):</p>\n\n<pre><code>    *Main EditorTest StepThree Control.Lens&gt; mapM_ putStrLn $ StepThree.showOptions' show eg3'\n    EAdd (EAdd (EAdd (EAdd (EAdd (ELit 11) (ELit 9)) (ELit 3)) (ELit 1)) (ELit 5)) (ELit 0)\n          EAdd (EAdd (EAdd (EAdd (ELit 11) (ELit 9)) (ELit 3)) (ELit 1)) (ELit 5)\n                EAdd (EAdd (EAdd (ELit 11) (ELit 9)) (ELit 3)) (ELit 1)\n                      EAdd (EAdd (ELit 11) (ELit 9)) (ELit 3)\n                            EAdd (ELit 11) (ELit 9)\n                                  ELit 11\n                                            ELit 9\n                                                      ELit 3\n                                                      ELit 11\n                                                             ELit 9\n                                                                ELit 1\n                                                                EAdd (ELit 11) (ELit 9)\n                                                                      ELit 11\n                                                                                ELit 9\n                                                                                       ELit 3\n                                                                                       ELit 11\n                                                                                              ELit 9\n                                                                          ELit 5\n                                                                          EAdd (EAdd (ELit 11) (ELit 9)) (ELit 3)\n                                                                                EAdd (ELit 11) (ELit 9)\n                                                                                      ELit 11\n                                                                                                ELit 9\n                                                                                                          ELit 3\n                                                                                                          ELit 11\n                                                                                                                 ELit 9\n                                                                                                                 ELit 1\n                                                                                                                 EAdd (ELit 11) (ELit 9)\n                                                                                                                       ELit 11\n                                                                                                                                 ELit 9\n                                                                                                                                        ELit 3\n                                                                                                                                        ELit 11\n                                                                                                                                               ELit 9\n                                                                                    ELit 0\n                                                                                    EAdd (EAdd (EAdd (ELit 11) (ELit 9)) (ELit 3)) (ELit 1)\n                                                                                          EAdd (EAdd (ELit 11) (ELit 9)) (ELit 3)\n                                                                                                EAdd (ELit 11) (ELit 9)\n                                                                                                      ELit 11\n                                                                                                                ELit 9\n                                                                                                                          ELit 3\n                                                                                                                          ELit 11\n                                                                                                                                 ELit 9\n                                                                                                                                    ELit 1\n                                                                                                                                    EAdd (ELit 11) (ELit 9)\n                                                                                                                                          ELit 11\n                                                                                                                                                    ELit 9\n                                                                                                                                                           ELit 3\n                                                                                                                                                           ELit 11\n                                                                                                                                                                  ELit 9\n                                                                                                                                           ELit 5\n                                                                                                                                           EAdd (EAdd (ELit 11) (ELit 9)) (ELit 3)\n                                                                                                                                                 EAdd (ELit 11) (ELit 9)\n                                                                                                                                                       ELit 11\n                                                                                                                                                                 ELit 9\n                                                                                                                                                                           ELit 3\n                                                                                                                                                                           ELit 11\n                                                                                                                                                                                  ELit 9\n                                                                                                                                                                                  ELit 1\n                                                                                                                                                                                  EAdd (ELit 11) (ELit 9)\n                                                                                                                                                                                        ELit 11\n                                                                                                                                                                                                  ELit 9\n                                                                                                                                                                                                         ELit 3\n                                                                                                                                                                                                         ELit 11\n                                                                                                                                                                                                                ELit 9\n</code></pre>\n\n<p>Obviously I have my recursion wrong somewhere, but I can't work it out. As always, any help would be greatly appreciated.</p>\n\n<p>If you're not familiar with the original definition of <code>Lens.para</code>, it can be found at <a href=\"https://hackage.haskell.org/package/lens-4.15.2/docs/src/Control.Lens.Plated.html#para\" rel=\"nofollow noreferrer\">https://hackage.haskell.org/package/lens-4.15.2/docs/src/Control.Lens.Plated.html#para</a></p>\n"}, {"tags": ["haskell"], "answers": [{"tags": [], "owner": {"reputation": 1589, "user_id": 2535671, "user_type": "registered", "accept_rate": 87, "profile_image": "https://www.gravatar.com/avatar/fca1ba52e0c41803e676d449ef242e75?s=128&d=identicon&r=PG&f=1", "display_name": "Julian Leviston", "link": "https://stackoverflow.com/users/2535671/julian-leviston"}, "is_accepted": false, "score": 0, "last_activity_date": 1497767560, "creation_date": 1497767560, "answer_id": 44612362, "question_id": 44611275, "link": "https://stackoverflow.com/questions/44611275/apis-for-exploring-haskell-source/44612362#44612362", "title": "APIs for exploring Haskell source", "body": "<p>Well, aside from looking at the Leksah source itself (which is a good idea!), I'd recomend looking at the source for hoogle: <a href=\"https://github.com/ndmitchell/hoogle\" rel=\"nofollow noreferrer\">https://github.com/ndmitchell/hoogle</a></p>\n\n<p>But also, pursuit in the purescript world is quite cool to look at, as that's got a kind of hybrid of hoogle (context-insensitive function / module / anything lookup) mixed with hackage (package browsing, etc).</p>\n\n<p>I think you're probably going to have to build the API yourself because there's no readymade packages for doing such things out of the box. Good luck!</p>\n"}], "owner": {"reputation": 31, "user_id": 4199200, "user_type": "registered", "profile_image": "https://graph.facebook.com/100003341692750/picture?type=large", "display_name": "Joe Betz", "link": "https://stackoverflow.com/users/4199200/joe-betz"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 52, "favorite_count": 0, "answer_count": 1, "score": 1, "last_activity_date": 1497767560, "creation_date": 1497754017, "last_edit_date": 1497754368, "question_id": 44611275, "link": "https://stackoverflow.com/questions/44611275/apis-for-exploring-haskell-source", "title": "APIs for exploring Haskell source", "body": "<p>I need an API (or set of APIs) that can:</p>\n\n<ol>\n<li>provide a listing of all packages in hackage</li>\n<li>given a package name, provide a listing of all modules in that package</li>\n<li>given a module name, provide a list of all functions and types exported from that module </li>\n<li>given a module name + function name, provide the type signature, documentation, and definition of said function</li>\n<li>given a module name + type name, provide the definition and documentation of that type </li>\n</ol>\n\n<p>Are any of these available on public APIs? HTTP interfaces with JSON output would be the most convenient, but any type of API will probably do.</p>\n\n<p>My goal is to create a multi-paned package explorer, similar to the class browser you find in Smalltalk IDEs. The only thing close to this I've seen is the Browser in Leksah, which I gave up on for a number of reasons.</p>\n"}, {"tags": ["haskell"], "comments": [{"owner": {"reputation": 28376, "user_id": 5743988, "user_type": "registered", "accept_rate": 67, "profile_image": "https://i.stack.imgur.com/IeSSM.jpg?s=128&g=1", "display_name": "4castle", "link": "https://stackoverflow.com/users/5743988/4castle"}, "edited": false, "score": 0, "creation_date": 1497762168, "post_id": 44610668, "comment_id": 76210281, "body": "You might want to change <code>try</code> so that the return type is a tuple of 3 values instead of a list. This way it&#39;s clear that you expect exactly 3 values to be in the list."}], "answers": [{"tags": [], "owner": {"reputation": 314794, "user_id": 67579, "user_type": "registered", "accept_rate": 81, "profile_image": "https://i.stack.imgur.com/BJXub.png?s=128&g=1", "display_name": "Willem Van Onsem", "link": "https://stackoverflow.com/users/67579/willem-van-onsem"}, "is_accepted": false, "score": 5, "last_activity_date": 1506552543, "last_edit_date": 1506552543, "creation_date": 1497746349, "answer_id": 44610728, "question_id": 44610668, "link": "https://stackoverflow.com/questions/44610668/haskell-applying-function-to-all-combinations-of-arguments/44610728#44610728", "title": "Haskell: Applying function to all combinations of arguments", "body": "<p><strong>Yes</strong>, you can make it also look more elegant with <strong>list comprehension</strong>:</p>\n\n<pre><code>try :: [[Char]] -&gt; [[Char]] -&gt; [[Char]] -&gt; [[Char]]\ntry as bs cs = head [ [a,b,c] | a &lt;- as, b &lt;- bs, c &lt;- cs, checkIfCorrect a b c ]\n--                    \\__ __/   \\__________ ____________/  \\__________ _______/\n--                       v                 v                          v\n--                     yield           enumeration                 filter\n</code></pre>\n\n<p>The code works as follows: the right part of the list comprehension consists out of an \"<strong><em>enumeration</em></strong>\" part (denoted by the comment section). Since we write <code>a &lt;- as, b &lt;- bs, c &lt;- cs</code> it means that <strong><code>a</code> will take any value from <code>as</code></strong>, and for <strong>every such <code>a</code>, <code>b</code> will take any value of <code>bs</code></strong>, etc. So that means every possible combination will be emitted.</p>\n\n<p>Next there is the \"<strong><em>filter</em></strong>\" phase: there is a predicate <code>checkIfCorrect a b c</code> that will be called and only if that predicate returns <code>True</code>, the result will be \"yielded\".</p>\n\n<p>On the left side we see \"<strong><em>yield</em></strong>\". It describes what to add to the list (based on the enumeration) given the filter succeeds. If that happens we add <code>[a,b,c]</code> to that list. If there are multiple such configurations that succeed, we might end up with a list containing multiple solutions. Note however that list comprehension is done <em>lazily</em>: so as long as you do not ask for at least one such element, it will not generate the first element, nor the second, etc.</p>\n\n<p>Now we also need <code>head</code> (in front of the list comprehension). <code>head :: [a] -&gt; a</code> returns the <em>first</em> element of the list. So <code>try</code> will return the first element that satisfies the condition.</p>\n"}, {"comments": [{"owner": {"reputation": 29444, "user_id": 3072788, "user_type": "registered", "accept_rate": 82, "profile_image": "https://www.gravatar.com/avatar/220a45c2fcff7e7358d144551b116205?s=128&d=identicon&r=PG&f=1", "display_name": "Alec", "link": "https://stackoverflow.com/users/3072788/alec"}, "edited": false, "score": 5, "creation_date": 1497751249, "post_id": 44611021, "comment_id": 76208834, "body": "That last paragraph is quotable. :)"}, {"owner": {"reputation": 28376, "user_id": 5743988, "user_type": "registered", "accept_rate": 67, "profile_image": "https://i.stack.imgur.com/IeSSM.jpg?s=128&g=1", "display_name": "4castle", "link": "https://stackoverflow.com/users/5743988/4castle"}, "edited": false, "score": 0, "creation_date": 1497761947, "post_id": 44611021, "comment_id": 76210249, "body": "<code>find checkIfCorrect (liftM3 (,,) as bs cs)</code> would perhaps be another way to do it, but they would need to modify the types of their functions a bit."}], "tags": [], "owner": {"reputation": 37219, "user_id": 1523776, "user_type": "moderator", "accept_rate": 87, "profile_image": "https://www.gravatar.com/avatar/b3e0b5c8e42a8c38009ef2d969f8dabb?s=128&d=identicon&r=PG", "display_name": "Benjamin Hodgson", "link": "https://stackoverflow.com/users/1523776/benjamin-hodgson"}, "is_accepted": false, "score": 11, "last_activity_date": 1497794573, "last_edit_date": 1497794573, "creation_date": 1497750257, "answer_id": 44611021, "question_id": 44610668, "link": "https://stackoverflow.com/questions/44610668/haskell-applying-function-to-all-combinations-of-arguments/44611021#44611021", "title": "Haskell: Applying function to all combinations of arguments", "body": "<p>I just wanted to show you an alternative way of writing <a href=\"https://stackoverflow.com/a/44610728/7951906\">@WillemVanOnsem's code</a>. I'm guessing that you're a Haskell beginner, so hopefully this answer will give you a tiny glimpse of a rich and beautiful idea which you'll soon be learning about in full as you progress with the language. So don't worry too much if you don't understand everything about this code right away; I'm just trying to give you a taste!</p>\n\n<p>A list comprehension can always be reformulated using the list <em>monad</em>: </p>\n\n<pre><code>import Control.Monad (guard)\n\ntry as bs cs = head $ do\n    a &lt;- as\n    b &lt;- bs\n    c &lt;- cs\n    guard $ checkIfCorrect a b c\n    return [a,b,c]\n</code></pre>\n\n<p>I'm using <code>do</code> notation as a special notation for nested loops: for each <code>a</code> in <code>as</code>, for each <code>b</code> in <code>bs</code>, and for each <code>c</code> in <code>cs</code>, we yield <code>[a,b,c]</code> if <code>checkIfCorrect</code> returns <code>True</code>. The translation from list comprehensions is simple: \"enumeration\" parts of the list comprehension turn into \"binds\" using <code>&lt;-</code>, \"filter\"s turn into calls to <code>guard</code>, and \"yield\"s turn into <code>return</code>s.</p>\n\n<p>In an imperative language like Python you might write it like this:</p>\n\n<pre><code>def try(as, bs, cs):\n    for a in as:\n        for b in bs:\n            for c in cs:\n                if checkIfCorrect(a, b, c):\n                    yield [a,b,c]\n</code></pre>\n\n<p>Like politics under the Western neoliberal hegemony, the imperative code gradually marches rightward. \"Staircase\" code like this actually crops up quite frequently in imperative programming (think of \"callback hell\" in JS), so monads were invented to help counteract this tendency. They turned out to be so useful that a special syntax was invented for them, namely <code>do</code>-notation.</p>\n"}, {"tags": [], "owner": {"reputation": 208473, "user_id": 126014, "user_type": "registered", "accept_rate": 86, "profile_image": "https://www.gravatar.com/avatar/33526616d4a11f1630d4939b769cfbf9?s=128&d=identicon&r=PG", "display_name": "Mark Seemann", "link": "https://stackoverflow.com/users/126014/mark-seemann"}, "is_accepted": false, "score": 3, "last_activity_date": 1497773804, "creation_date": 1497773804, "answer_id": 44613022, "question_id": 44610668, "link": "https://stackoverflow.com/questions/44610668/haskell-applying-function-to-all-combinations-of-arguments/44613022#44613022", "title": "Haskell: Applying function to all combinations of arguments", "body": "<p>While both Willem Van Onsem's and The Orgazoid's answers are good (upvoted), you can also approach part of the problem in a more generalised way, and not only for lists.</p>\n\n<p>For the following, you're going to need these imports:</p>\n\n<pre><code>import Control.Monad (MonadPlus, mfilter)\nimport Data.Maybe (fromMaybe, listToMaybe)\n</code></pre>\n\n<p>If I'm understanding the question correctly, you want to try all combinations of <code>as</code>, <code>bs</code>, and <code>cs</code>. You can typically achieve combination-like behaviour with the <code>Applicative</code> typeclass:</p>\n\n<pre><code>combinations = (,,) &lt;$&gt; as &lt;*&gt; bs &lt;*&gt; cs\n</code></pre>\n\n<p><code>(,,)</code> is a function that creates triples (three-element tuples) from three individual values.</p>\n\n<p>This works for lists, because lists are applicative:</p>\n\n<pre><code>*Prelude&gt; (,,) &lt;$&gt; [1,2] &lt;*&gt; [\"foo\", \"bar\"] &lt;*&gt; [True, False]\n[(1,\"foo\",True),(1,\"foo\",False),(1,\"bar\",True),(1,\"bar\",False),(2,\"foo\",True),(2,\"foo\",False),(2,\"bar\",True),(2,\"bar\",False)]\n</code></pre>\n\n<p>but it also works for e.g. <code>Maybe</code>s:</p>\n\n<pre><code>*Prelude&gt; (,,) &lt;$&gt; Just 1 &lt;*&gt; Just \"foo\" &lt;*&gt; Just False\nJust (1,\"foo\",False)\n</code></pre>\n\n<p>With that, you can now define the core of your function:</p>\n\n<pre><code>try' :: MonadPlus m =&gt; ((a, a, a) -&gt; Bool) -&gt; m a -&gt; m a -&gt; m a -&gt; m [a]\ntry' predicate as bs cs =\n  tripleToList &lt;$&gt; mfilter predicate combinations\n  where\n    combinations = (,,) &lt;$&gt; as &lt;*&gt; bs &lt;*&gt; cs\n    tripleToList (a, b, c) = [a, b, c]\n</code></pre>\n\n<p>You'll notice that this helper function is completely generic. It works for any <code>MonadPlus</code> instance of any contained element <code>a</code>.</p>\n\n<p>Here are some examples:</p>\n\n<pre><code>*Answer&gt; try' (const True) [\"foo\", \"bar\", \"baz\"] [\"qux\", \"quux\", \"quuz\", \"corge\"] [\"grault\", \"garply\"]\n[[\"foo\",\"qux\",\"grault\"],[\"foo\",\"qux\",\"garply\"],[\"foo\",\"quux\",\"grault\"],[\"foo\",\"quux\",\"garply\"],[\"foo\",\"quuz\",\"grault\"],[\"foo\",\"quuz\",\"garply\"],[\"foo\",\"corge\",\"grault\"],[\"foo\",\"corge\",\"garply\"],[\"bar\",\"qux\",\"grault\"],[\"bar\",\"qux\",\"garply\"],[\"bar\",\"quux\",\"grault\"],[\"bar\",\"quux\",\"garply\"],[\"bar\",\"quuz\",\"grault\"],[\"bar\",\"quuz\",\"garply\"],[\"bar\",\"corge\",\"grault\"],[\"bar\",\"corge\",\"garply\"],[\"baz\",\"qux\",\"grault\"],[\"baz\",\"qux\",\"garply\"],[\"baz\",\"quux\",\"grault\"],[\"baz\",\"quux\",\"garply\"],[\"baz\",\"quuz\",\"grault\"],[\"baz\",\"quuz\",\"garply\"],[\"baz\",\"corge\",\"grault\"],[\"baz\",\"corge\",\"garply\"]]\n*Answer&gt; try' (const False) [\"foo\", \"bar\", \"baz\"] [\"qux\", \"quux\", \"quuz\", \"corge\"] [\"grault\", \"garply\"]\n[]\n*Answer&gt; try' (const True) (Just \"foo\") (Just \"bar\") (Just \"baz\")\nJust [\"foo\",\"bar\",\"baz\"]\n*Answer&gt; try' (const False) (Just \"foo\") (Just \"bar\") (Just \"baz\")\nNothing\n</code></pre>\n\n<p>You should notice that if <code>predicate</code> always returns <code>False</code>, you'll get nothing back. For lists, you get the empty list; for <code>Maybe</code>, you literally get <code>Nothing</code>.</p>\n\n<p>So far it's all generic, but <code>checkIfCorrect</code> isn't. It also looks like you'd like to get only the first elements that match. You can achieve that by composing <code>try'</code> with <code>checkIfCorrect</code>:</p>\n\n<pre><code>try :: [String] -&gt; [String] -&gt; [String] -&gt; [String]\ntry as bs cs = fromMaybe [] $ listToMaybe $ try' isCorrect as bs cs\n  where isCorrect (a, b, c) = checkIfCorrect a b c\n</code></pre>\n\n<p>Here, I've created a private <code>isCorrect</code> function in order to uncurry the <code>checkIfCorrect</code> function. I've then used a combination of <code>listToMaybe</code> and <code>fromMaybe</code> to return the first element of the resulting list. Other answers here use <code>head</code>, but that's going to throw an exception if the list is empty, so I used this combination instead, because it's safe.</p>\n"}], "owner": {"reputation": 517, "user_id": 6169343, "user_type": "registered", "accept_rate": 50, "profile_image": "https://www.gravatar.com/avatar/bf35274d8dc610e79b42ee2a07828669?s=128&d=identicon&r=PG&f=1", "display_name": "Czarek", "link": "https://stackoverflow.com/users/6169343/czarek"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 451, "favorite_count": 2, "answer_count": 3, "score": 6, "last_activity_date": 1506552543, "creation_date": 1497745714, "question_id": 44610668, "link": "https://stackoverflow.com/questions/44610668/haskell-applying-function-to-all-combinations-of-arguments", "title": "Haskell: Applying function to all combinations of arguments", "body": "<p>I am posting below some code in Haskell. Please treat the code as an example, which I am going to use, to explain what I would like to know.    </p>\n\n<pre><code>try :: [[Char]] -&gt; [[Char]] -&gt; [[Char]] -&gt; [[Char]]\ntry (a:as) (b:bs) (c:cs)  | ((checkIfCorrect a b c) == True) =  a:b:[c]\n                          | otherwise = try as bs cs \n\ncheckIfCorrect :: [Char] -&gt; [Char] -&gt; [Char] -&gt; Bool\ncheckIfCorrect a b c = True\n</code></pre>\n\n<p>Eventually, <code>checkIfCorrect</code> returns <code>True</code> for only one combination of arguments. <code>checkIfCorrect</code> is really long function, so I decided to post substitute here. In the example above, function <code>checkIfCorrect</code> is applicated (by function <code>try</code>) to: first <code>[Char]</code> on the first list, first <code>[Char]</code> on the second list and first <code>[Char]</code> one the third list. If first guarded equation is not fulfilled, function <code>checkIfCorrect</code> is applied to: second <code>[Char]</code> on the first list ... and so on. What I would like to reach, is to applicate function <code>checkIfCorrect</code> (by function <code>try</code>) to all combinations of <code>[Char]</code>s  from all lists\n (<code>[[Char]]</code> ). I mean the following (e.g.): third <code>[Char]</code> on the first list,      eighth  <code>[Char]</code> on the second list, eleventh <code>[Char]</code> on the third list and so on. Everyone with everyone.  How could I easy reach that?</p>\n"}, {"tags": ["haskell", "lazy-evaluation", "network-drive"], "comments": [{"owner": {"reputation": 13807, "user_id": 2407038, "user_type": "registered", "accept_rate": 64, "profile_image": "https://www.gravatar.com/avatar/538f6f4a9aa43841841de7d8e8b169fc?s=128&d=identicon&r=PG&f=1", "display_name": "user2407038", "link": "https://stackoverflow.com/users/2407038/user2407038"}, "edited": false, "score": 1, "creation_date": 1497726279, "post_id": 44608214, "comment_id": 76203595, "body": "1. Does it work if you give it an absolute path (i.e. <code>cd U:&#47; ; tmptmp U:&#47;&lt;..&gt;&#47;test.xlsx</code>? (who knows, this could be it. Windows is weird sometimes) 2. What do you mean by &quot;this network drive is offline&quot;? I&#39;d like to try to reproduce but I&#39;m not sure how one accesses a network drive which is offline (clearly I misunderstand the meaning of &#39;offline&#39; here!). 3. Why do you need to use lazy <code>BS</code>? It seems you&#39;ve discovered that <code>Strict</code> is the right tool for the job. 4. Does it work if you force the input (i.e. <code>evaluate (length bs)</code> before the write)?"}, {"owner": {"reputation": 46777, "user_id": 1100107, "user_type": "registered", "accept_rate": 80, "profile_image": "https://www.gravatar.com/avatar/8789d3da0b482bcd8e562bfdf3687c74?s=128&d=identicon&r=PG", "display_name": "St&#233;phane Laurent", "link": "https://stackoverflow.com/users/1100107/st%c3%a9phane-laurent"}, "reply_to_user": {"reputation": 13807, "user_id": 2407038, "user_type": "registered", "accept_rate": 64, "profile_image": "https://www.gravatar.com/avatar/538f6f4a9aa43841841de7d8e8b169fc?s=128&d=identicon&r=PG&f=1", "display_name": "user2407038", "link": "https://stackoverflow.com/users/2407038/user2407038"}, "edited": false, "score": 0, "creation_date": 1497726504, "post_id": 44608214, "comment_id": 76203673, "body": "Hi @user2407038. 1) No. 2) This is the laptop of my job and I&#39;m not connected to the domain. In Windows Explorer you have a button &quot;Work offline / Work online&quot;. Click on &quot;Work offline&quot; if you want to reproduce. 3) This is just a minimal reproducible example. In the real life, I&#39;m using the <code>xlsx</code> library which deals with lazy bytestrings. 4) I didn&quot;t know the <code>evaluate</code> function, I&#39;ll try."}, {"owner": {"reputation": 46777, "user_id": 1100107, "user_type": "registered", "accept_rate": 80, "profile_image": "https://www.gravatar.com/avatar/8789d3da0b482bcd8e562bfdf3687c74?s=128&d=identicon&r=PG", "display_name": "St&#233;phane Laurent", "link": "https://stackoverflow.com/users/1100107/st%c3%a9phane-laurent"}, "reply_to_user": {"reputation": 13807, "user_id": 2407038, "user_type": "registered", "accept_rate": 64, "profile_image": "https://www.gravatar.com/avatar/538f6f4a9aa43841841de7d8e8b169fc?s=128&d=identicon&r=PG&f=1", "display_name": "user2407038", "link": "https://stackoverflow.com/users/2407038/user2407038"}, "edited": false, "score": 0, "creation_date": 1497726682, "post_id": 44608214, "comment_id": 76203720, "body": "2) Or simply disconnect your computer from Internet."}, {"owner": {"reputation": 46777, "user_id": 1100107, "user_type": "registered", "accept_rate": 80, "profile_image": "https://www.gravatar.com/avatar/8789d3da0b482bcd8e562bfdf3687c74?s=128&d=identicon&r=PG", "display_name": "St&#233;phane Laurent", "link": "https://stackoverflow.com/users/1100107/st%c3%a9phane-laurent"}, "reply_to_user": {"reputation": 13807, "user_id": 2407038, "user_type": "registered", "accept_rate": 64, "profile_image": "https://www.gravatar.com/avatar/538f6f4a9aa43841841de7d8e8b169fc?s=128&d=identicon&r=PG&f=1", "display_name": "user2407038", "link": "https://stackoverflow.com/users/2407038/user2407038"}, "edited": false, "score": 0, "creation_date": 1497727455, "post_id": 44608214, "comment_id": 76203983, "body": "I&#39;ve just solved my real-life issue by using the strategy of the last point of my edit, with <code>LB.readFile</code> then <code>fromStrict</code>. But obviously that does not provide an explanation."}, {"owner": {"reputation": 13807, "user_id": 2407038, "user_type": "registered", "accept_rate": 64, "profile_image": "https://www.gravatar.com/avatar/538f6f4a9aa43841841de7d8e8b169fc?s=128&d=identicon&r=PG&f=1", "display_name": "user2407038", "link": "https://stackoverflow.com/users/2407038/user2407038"}, "edited": false, "score": 0, "creation_date": 1497736083, "post_id": 44608214, "comment_id": 76206116, "body": "Unfortunately, I can&#39;t reproduce (on W7). I think it is because I don&#39;t have an actual remote location which I can access this way, but Windows allowed me to &quot;Map network drive&quot; with a local (shared) folder. With this setup, there is no &quot;Work offline&quot; button, and it worked just fine with the lazy ByteString."}, {"owner": {"reputation": 46777, "user_id": 1100107, "user_type": "registered", "accept_rate": 80, "profile_image": "https://www.gravatar.com/avatar/8789d3da0b482bcd8e562bfdf3687c74?s=128&d=identicon&r=PG", "display_name": "St&#233;phane Laurent", "link": "https://stackoverflow.com/users/1100107/st%c3%a9phane-laurent"}, "reply_to_user": {"reputation": 13807, "user_id": 2407038, "user_type": "registered", "accept_rate": 64, "profile_image": "https://www.gravatar.com/avatar/538f6f4a9aa43841841de7d8e8b169fc?s=128&d=identicon&r=PG&f=1", "display_name": "user2407038", "link": "https://stackoverflow.com/users/2407038/user2407038"}, "edited": false, "score": 0, "creation_date": 1497738141, "post_id": 44608214, "comment_id": 76206552, "body": "Thank you for trying to reproduce @user2407038. I&#39;m using W7 as well. There&#39;s something more I did not say and then this could be the reason, but that would be weird. It seems that this network drive is misconfigured. For example, according to the <code>file.access</code> function of <code>R</code>, the drive <code>U</code> is not writeable (while it is writeable). But that would be strange that <code>U</code> is recognized as unwriteable only when I use a lazy bytestring."}, {"owner": {"reputation": 46777, "user_id": 1100107, "user_type": "registered", "accept_rate": 80, "profile_image": "https://www.gravatar.com/avatar/8789d3da0b482bcd8e562bfdf3687c74?s=128&d=identicon&r=PG", "display_name": "St&#233;phane Laurent", "link": "https://stackoverflow.com/users/1100107/st%c3%a9phane-laurent"}, "reply_to_user": {"reputation": 13807, "user_id": 2407038, "user_type": "registered", "accept_rate": 64, "profile_image": "https://www.gravatar.com/avatar/538f6f4a9aa43841841de7d8e8b169fc?s=128&d=identicon&r=PG&f=1", "display_name": "user2407038", "link": "https://stackoverflow.com/users/2407038/user2407038"}, "edited": false, "score": 0, "creation_date": 1497738871, "post_id": 44608214, "comment_id": 76206692, "body": "The same with <code>getPermissions</code> of <code>System.Directory</code>: <code>getPermissions &quot;U:&#47;Data&quot;</code> indicates that <code>U:&#47;Data</code> is not writable... hmm but however it indicates that <code>U:&#47;Data&#47;zTemp</code> is writable."}], "owner": {"reputation": 46777, "user_id": 1100107, "user_type": "registered", "accept_rate": 80, "profile_image": "https://www.gravatar.com/avatar/8789d3da0b482bcd8e562bfdf3687c74?s=128&d=identicon&r=PG", "display_name": "St&#233;phane Laurent", "link": "https://stackoverflow.com/users/1100107/st%c3%a9phane-laurent"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 1186, "favorite_count": 0, "answer_count": 0, "score": 6, "last_activity_date": 1497725996, "creation_date": 1497725261, "last_edit_date": 1497725996, "question_id": 44608214, "link": "https://stackoverflow.com/questions/44608214/read-file-as-bytestring-and-write-this-bytestring-to-a-file-issue-on-a-network", "title": "Read file as bytestring and write this bytestring to a file: issue on a network drive", "body": "<p>Consider the following simple Haskell program, which reads a file as a bytestring and writes the file <code>tmp.tmp</code> from this bytestring:</p>\n\n<pre><code>module Main\n  where\nimport System.Environment\nimport qualified Data.ByteString.Lazy as B\n\nmain :: IO ()\nmain = do\n  [file] &lt;- getArgs\n  bs &lt;- B.readFile file\n  action &lt;- B.writeFile \"tmp.tmp\" bs\n  putStrLn \"done\"\n</code></pre>\n\n<p>It is compiled to an executable named <code>tmptmp</code>.</p>\n\n<p>I have two hard drives on my computer: the <code>C</code> drive and the <code>U</code> drive, and this one is a network drive, and <em>this network drive is offline</em>.</p>\n\n<p>Now, let's try <code>tmptmp</code>.</p>\n\n<p>When I run it from <code>C</code>, there's no problem; I run it two times below, the first time with a file on <code>C</code> and the second time with a file on <code>U</code>:</p>\n\n<pre><code>C:\\HaskellProjects\\imagelength&gt; tmptmp LICENSE\ndone\n\nC:\\HaskellProjects\\imagelength&gt; tmptmp U:\\Data\\ztemp\\test.xlsx\ndone\n</code></pre>\n\n<p>Now I run it from <code>U</code>, with a file on the <code>C</code> drive, no problem:</p>\n\n<pre><code>U:\\Data\\ztemp&gt; tmptmp C:\\HaskellProjects\\imagelength\\LICENSE\ndone\n</code></pre>\n\n<p>The problem occurs when I <em>run it from <code>U</code> with a file on the <code>U</code> drive</em>:</p>\n\n<pre><code>U:\\Data\\ztemp&gt; tmptmp test.xlsx\ntmptmp: tmp.tmp: openBinaryFile: resource busy (file is locked)\n</code></pre>\n\n<p>If in my program I use <em>strict bytestrings instead of lazy bytestrings</em> (by replacing <code>Data.ByteString.Lazy</code> with <code>Data.ByteString</code>), <em>this problem does not occur anymore</em>.</p>\n\n<p>I'd like to understand that. Any explanation? (I would particularly like to know how to solve this issue but still using lazy bytestrings)</p>\n\n<h2>EDIT</h2>\n\n<p>To be perhaps more precise, the problem still occurs with this program:</p>\n\n<pre><code>import qualified Data.ByteString as SB\nimport qualified Data.ByteString.Lazy as LB\n\nmain :: IO ()\nmain = do\n  [file] &lt;- getArgs\n  bs &lt;- LB.readFile file\n  action &lt;- SB.writeFile \"tmp.tmp\" (LB.toStrict bs)\n  putStrLn \"done\"\n</code></pre>\n\n<p>while the problem disappears with:</p>\n\n<pre><code>  bs &lt;- SB.readFile file\n  action &lt;- LB.writeFile \"tmp.tmp\" (LB.fromStrict bs)\n</code></pre>\n\n<p>It looks like the point causing the problem is the laziness of <code>readFile</code>.</p>\n"}, {"tags": ["list", "haskell", "matrix"], "answers": [{"tags": [], "owner": {"reputation": 15757, "user_id": 176841, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/45a168cb9eb8454d66c78f18e29d9342?s=128&d=identicon&r=PG", "display_name": "jberryman", "link": "https://stackoverflow.com/users/176841/jberryman"}, "is_accepted": false, "score": 2, "last_activity_date": 1497723505, "creation_date": 1497723505, "answer_id": 44607929, "question_id": 44607813, "link": "https://stackoverflow.com/questions/44607813/better-way-to-write-this-function-list-to-matrix-list-of-lists/44607929#44607929", "title": "Better way to write this function: list to matrix (= list of lists)", "body": "<p>No, although I wish <code>chunksOf</code> was in the standard library. You can get that from here if you want: <a href=\"https://hackage.haskell.org/package/split-0.2.3.2/docs/Data-List-Split.html\" rel=\"nofollow noreferrer\">https://hackage.haskell.org/package/split-0.2.3.2/docs/Data-List-Split.html</a></p>\n\n<p>Note a better definition would be:</p>\n\n<pre><code>listToMatrix xs b = (take b xs) : (listToMatrix (drop b xs) b)\n</code></pre>\n\n<p>although this might compile to the same core. You could also use <code>splitAt</code>, though again this is likely to perform the same.</p>\n\n<pre><code>listToMatrix xs b = let (xs,xss) = splitAt b xs in xs : listToMatrix xss\n</code></pre>\n"}, {"comments": [{"owner": {"reputation": 14582, "user_id": 2225384, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/f30b04ed4d0b3fc4bc791a28815f34ca?s=128&d=identicon&r=PG", "display_name": "Rein Henrichs", "link": "https://stackoverflow.com/users/2225384/rein-henrichs"}, "edited": false, "score": 1, "creation_date": 1497729554, "post_id": 44608052, "comment_id": 76204553, "body": "You rightly suggest using <code>splitAt</code> to avoid an unnecessary extra traversal but then use <code>length</code>, which causes an unnecessary extra traversal. An alternative would be to check that <code>length row == b</code> in the case when <code>remaining</code> is empty, i.e., that the last row has the expected row length."}, {"owner": {"reputation": 1404, "user_id": 5559663, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/sQiE2.gif?s=128&g=1", "display_name": "baxbaxwalanuksiwe", "link": "https://stackoverflow.com/users/5559663/baxbaxwalanuksiwe"}, "reply_to_user": {"reputation": 14582, "user_id": 2225384, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/f30b04ed4d0b3fc4bc791a28815f34ca?s=128&d=identicon&r=PG", "display_name": "Rein Henrichs", "link": "https://stackoverflow.com/users/2225384/rein-henrichs"}, "edited": false, "score": 0, "creation_date": 1497735392, "post_id": 44608052, "comment_id": 76205977, "body": "Rein Henrichs: Yeah but wouldn&#39;t that mean that the function would do every recursion until the last row to find that the number of elements doesn&#39;t match ? My solution allows these case to be detected right away, at the first iteration."}, {"owner": {"reputation": 14582, "user_id": 2225384, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/f30b04ed4d0b3fc4bc791a28815f34ca?s=128&d=identicon&r=PG", "display_name": "Rein Henrichs", "link": "https://stackoverflow.com/users/2225384/rein-henrichs"}, "edited": false, "score": 0, "creation_date": 1497735642, "post_id": 44608052, "comment_id": 76206017, "body": "Checking the length doesn&#39;t allow the failure to be detected &quot;right away&quot;: it allows the failure to be detected once you traverse the entire list. You have to traverse the list either way. Recursion is cheap while traversing the whole list an extra time is expensive."}, {"owner": {"reputation": 14582, "user_id": 2225384, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/f30b04ed4d0b3fc4bc791a28815f34ca?s=128&d=identicon&r=PG", "display_name": "Rein Henrichs", "link": "https://stackoverflow.com/users/2225384/rein-henrichs"}, "edited": false, "score": 0, "creation_date": 1497736110, "post_id": 44608052, "comment_id": 76206120, "body": "Also, as a general rule, I don&#39;t like making the successful path slower in order to make the failure path faster."}, {"owner": {"reputation": 1404, "user_id": 5559663, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/sQiE2.gif?s=128&g=1", "display_name": "baxbaxwalanuksiwe", "link": "https://stackoverflow.com/users/5559663/baxbaxwalanuksiwe"}, "reply_to_user": {"reputation": 14582, "user_id": 2225384, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/f30b04ed4d0b3fc4bc791a28815f34ca?s=128&d=identicon&r=PG", "display_name": "Rein Henrichs", "link": "https://stackoverflow.com/users/2225384/rein-henrichs"}, "edited": false, "score": 0, "creation_date": 1497736275, "post_id": 44608052, "comment_id": 76206163, "body": "How is recursion cheap ? We use <code>splitAt</code> which traverses the first <code>b</code> elements of the list. If we give a list of length <code>n</code> to <code>listToMatrix</code>, where <code>b</code> does not divide <code>n</code>, we would have to traverse <code>div n b * b</code> elements. Or is it a lazyness trick ?"}, {"owner": {"reputation": 14582, "user_id": 2225384, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/f30b04ed4d0b3fc4bc791a28815f34ca?s=128&d=identicon&r=PG", "display_name": "Rein Henrichs", "link": "https://stackoverflow.com/users/2225384/rein-henrichs"}, "edited": false, "score": 0, "creation_date": 1497827202, "post_id": 44608052, "comment_id": 76226565, "body": "You have to scrutinize the spine of the list at least once either way. Doing as I suggested scrutinizes the spine exactly once. Your method scrutinizes the spine once for the failure case but <i>twice</i> for the success case. This is strictly worse."}, {"owner": {"reputation": 14582, "user_id": 2225384, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/f30b04ed4d0b3fc4bc791a28815f34ca?s=128&d=identicon&r=PG", "display_name": "Rein Henrichs", "link": "https://stackoverflow.com/users/2225384/rein-henrichs"}, "edited": false, "score": 0, "creation_date": 1497827569, "post_id": 44608052, "comment_id": 76226641, "body": "Do you think that <code>length</code> doesn&#39;t scrutinize the spine of the list?"}, {"owner": {"reputation": 1404, "user_id": 5559663, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/sQiE2.gif?s=128&g=1", "display_name": "baxbaxwalanuksiwe", "link": "https://stackoverflow.com/users/5559663/baxbaxwalanuksiwe"}, "reply_to_user": {"reputation": 14582, "user_id": 2225384, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/f30b04ed4d0b3fc4bc791a28815f34ca?s=128&d=identicon&r=PG", "display_name": "Rein Henrichs", "link": "https://stackoverflow.com/users/2225384/rein-henrichs"}, "edited": false, "score": 0, "creation_date": 1497858651, "post_id": 44608052, "comment_id": 76235543, "body": "Do you mind editing my post, because I&#39;m not 100% sure I understand what you mean."}], "tags": [], "owner": {"reputation": 1404, "user_id": 5559663, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/sQiE2.gif?s=128&g=1", "display_name": "baxbaxwalanuksiwe", "link": "https://stackoverflow.com/users/5559663/baxbaxwalanuksiwe"}, "is_accepted": false, "score": 3, "last_activity_date": 1497725020, "last_edit_date": 1497725020, "creation_date": 1497724275, "answer_id": 44608052, "question_id": 44607813, "link": "https://stackoverflow.com/questions/44607813/better-way-to-write-this-function-list-to-matrix-list-of-lists/44608052#44608052", "title": "Better way to write this function: list to matrix (= list of lists)", "body": "<p>Yes, there is a better way to write this function. But I don't think that making it one line is going to improve anything.</p>\n\n<h3>Use the prepending operator <code>(:)</code> instead of list concatenation <code>(++)</code> for single-element prepending</h3>\n\n<p>The expression <code>[(take b xs)] ++ (listToMatrix (drop b xs) b)</code> is inefficient. I don't mean inefficient in terms of performances, because the compiler probably optimizes that, but, here, you are constructing a list, and then calling a function on it (<code>(++)</code>) which is going to deconstruct it by pattern matching. You could instead build your list directly using the <code>(:)</code> data constructor, which allows you to prepend a single element to your list. The expression becomes <code>take b xs : listToMatrix (drop b xs) b</code></p>\n\n<h3>Use <a href=\"http://hackage.haskell.org/package/base-4.9.1.0/docs/Prelude.html#v:splitAt\" rel=\"nofollow noreferrer\"><code>splitAt</code></a> to avoid running through the list twice</h3>\n\n<pre><code>import Data.List (splitAt)\n\nlistToMatrix :: [a] -&gt; Int -&gt; [[a]]\nlistToMatrix xs b = row : listToMatrix remaining b\n    where (row, remaining) = splitAt b xs\n</code></pre>\n\n<h3>Ensure the correctness of your data by using <code>Maybe</code></h3>\n\n<pre><code>listToMatrix :: [a] -&gt; Int -&gt; Maybe [[a]]\nlistToMatrix xs b\n    | length xs `mod` b /= 0 = Nothing\n    | null xs   = Just []\n    | otherwise = Just $ row : listToMatrix remaining b\n    where (row, remaining) = splitAt b xs\n</code></pre>\n\n<p>You can even avoid checking every time if you have the right number of elements by defining a helper function:</p>\n\n<pre><code>listToMatrix :: [a] -&gt; Int -&gt; Maybe [[a]]\nlistToMatrix xs b\n    | length xs `mod` b /= 0 = Nothing\n    | otherwise = Just (go xs)\n    where go [] = []\n          go xs = row : go remaining\n              where (row, remaining) = splitAt b xs\n</code></pre>\n\n<h3>Ensure the correctness of your data by using safe types</h3>\n\n<p>A matrix has te same number of elements in each row, whereas nested lists don't allow to ensure that kind of conditions. To be certain that every row has the same number of elements, you can either use a library such as <a href=\"https://hackage.haskell.org/package/matrix-0.3.5.0/docs/Data-Matrix.html\" rel=\"nofollow noreferrer\"><code>matrix</code></a> or <a href=\"http://hackage.haskell.org/package/hmatrix-0.18.0.0/docs/Numeric-LinearAlgebra-HMatrix.html\" rel=\"nofollow noreferrer\"><code>hmatrix</code></a></p>\n"}, {"tags": [], "owner": {"reputation": 23600, "user_id": 1695172, "user_type": "registered", "accept_rate": 91, "profile_image": "https://www.gravatar.com/avatar/6319d7eafca7852cf04c88598ca31e75?s=128&d=identicon&r=PG", "display_name": "Netwave", "link": "https://stackoverflow.com/users/1695172/netwave"}, "is_accepted": false, "score": 0, "last_activity_date": 1497725021, "creation_date": 1497725021, "answer_id": 44608181, "question_id": 44607813, "link": "https://stackoverflow.com/questions/44607813/better-way-to-write-this-function-list-to-matrix-list-of-lists/44608181#44608181", "title": "Better way to write this function: list to matrix (= list of lists)", "body": "<p>You can use this, the idea is to take all the chunks of the main list, it is a different approach but basicly do the same:</p>\n\n<pre><code>Prelude&gt; let list2Matrix n xs = map (\\(x ,y)-&gt; (take n) $ (drop (n*x)) y) $ zip [0..] $ replicate (div (length xs)  n) xs\nPrelude&gt; list2Matrix 10 [1..100]\n[[1,2,3,4,5,6,7,8,9,10],[11,12,13,14,15,16,17,18,19,20],[21,22,23,24,25,26,27,28,29,30],[31,32,33,34,35,36,37,38,39,40],[41,42,43,44,45,46,47,48,49,50],[51,52,53,54,55,56,57,58,59,60],[61,62,63,64,65,66,67,68,69,70],[71,72,73,74,75,76,77,78,79,80],[81,82,83,84,85,86,87,88,89,90],[91,92,93,94,95,96,97,98,99,100]]\n</code></pre>\n"}, {"comments": [{"owner": {"reputation": 100185, "user_id": 3234959, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/93bb12ca0f93dfddb33880316f7e66c2?s=128&d=identicon&r=PG&f=1", "display_name": "chi", "link": "https://stackoverflow.com/users/3234959/chi"}, "edited": false, "score": 2, "creation_date": 1497727493, "post_id": 44608565, "comment_id": 76203994, "body": "You can also use <code>null xs</code> instead of <code>xs == []</code>, so you can drop the <code>Eq</code> constraint."}], "tags": [], "owner": {"reputation": 18798, "user_id": 4543207, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/8ed6f11c827fa7cef811f141a84cc14b?s=128&d=identicon&r=PG&f=1", "display_name": "Redu", "link": "https://stackoverflow.com/users/4543207/redu"}, "is_accepted": false, "score": 4, "last_activity_date": 1497728099, "last_edit_date": 1497728099, "creation_date": 1497727379, "answer_id": 44608565, "question_id": 44607813, "link": "https://stackoverflow.com/questions/44607813/better-way-to-write-this-function-list-to-matrix-list-of-lists/44608565#44608565", "title": "Better way to write this function: list to matrix (= list of lists)", "body": "<p>Actually this is a nice case for unfolding. <code>Data.List</code> method <code>unfoldr</code>, unlike folding a list, creates a list to a from a seed value by applying a function to it up until this function returns <code>Nothing</code>. Until we reach the terminating condition that will return <code>Nothing</code> the function returns <code>Just (a,b)</code> where <code>a</code> is the current generated item of the list and <code>b</code> is the next value of the seed. In this particular case our seed value is the given list.</p>\n\n<pre><code>import Data.List\nchunk :: Int -&gt; [a] -&gt; [[a]]\nchunk n = unfoldr (\\xs -&gt; if null xs then Nothing else Just (splitAt n xs))\n\n*Main&gt; chunk 3 [1,2,3,4,5,6,7,8,9]\n[[1,2,3],[4,5,6],[7,8,9]]\n*Main&gt; chunk 3 [1,2,3,4,5,6,7,8,9,10]\n[[1,2,3],[4,5,6],[7,8,9],[10]]\n</code></pre>\n"}], "owner": {"reputation": 3902, "user_id": 391399, "user_type": "registered", "accept_rate": 86, "profile_image": "https://www.gravatar.com/avatar/61f56a38bf46f807b5ef431c46813c99?s=128&d=identicon&r=PG", "display_name": "mrsteve", "link": "https://stackoverflow.com/users/391399/mrsteve"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 272, "favorite_count": 0, "answer_count": 4, "score": 0, "last_activity_date": 1497728099, "creation_date": 1497722957, "last_edit_date": 1497724757, "question_id": 44607813, "link": "https://stackoverflow.com/questions/44607813/better-way-to-write-this-function-list-to-matrix-list-of-lists", "title": "Better way to write this function: list to matrix (= list of lists)", "body": "<p>Is there a better way to write this function (i.e. in one line via folds)?</p>\n\n<pre><code>--              list -&gt; rowWidth -&gt; list of lists\nlistToMatrix :: [a] -&gt; Int -&gt; [[a]]\nlistToMatrix [] _ = []\nlistToMatrix xs b = [(take b xs)] ++ (listToMatrix (drop b xs) b)\n</code></pre>\n"}, {"tags": ["parsing", "haskell", "grammar", "happy"], "comments": [{"owner": {"reputation": 13807, "user_id": 2407038, "user_type": "registered", "accept_rate": 64, "profile_image": "https://www.gravatar.com/avatar/538f6f4a9aa43841841de7d8e8b169fc?s=128&d=identicon&r=PG&f=1", "display_name": "user2407038", "link": "https://stackoverflow.com/users/2407038/user2407038"}, "edited": false, "score": 1, "creation_date": 1497714015, "post_id": 44605925, "comment_id": 76199756, "body": "The symbol <code>$$=</code> is not the same thing as the two consecutive symbols <code>$$ =</code>. As you can see, happy parses <code>$$=</code> as just a regular Haskell operator (because it is) and so <code>$$= $1</code> is parsed as an operator section. As the docs say, if you have only <code>attributetype</code> and no <code>attribute</code>, then the former is simply ignored. When you add an <code>attribute</code>, the syntax of happy changes, because an attribute grammar and a &#39;regular&#39; grammar do not use precisely the same syntax. (All this information comes from about 90 seconds of reading the happy docs)"}], "owner": {"reputation": 163, "user_id": 6399382, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/8e2e4715e76ec2b605e6640e2293af4d?s=128&d=identicon&r=PG&f=1", "display_name": "panda", "link": "https://stackoverflow.com/users/6399382/panda"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 220, "favorite_count": 0, "answer_count": 0, "score": 1, "last_activity_date": 1497710740, "creation_date": 1497710740, "question_id": 44605925, "link": "https://stackoverflow.com/questions/44605925/parse-error-with-happy-and-attributed-grammar", "title": "Parse error with Happy and attributed grammar", "body": "<p>I'm a newbie of Haskell and Happy and I'm trying to make a parser with an attributed grammar in Haskell with Happy. I've made a little grammar just for variable declarations, given to BNFC and everything since here works fine. Then I start to add the attributes in the parser and at this point I found my first problem: when I add <code>%attributetype {MyAttribute a}</code></p>\n\n<p><code>happy -gca Pargrammar.y</code> works fine, but immediately after I add <code>%attribute parseTree {a}</code></p>\n\n<p>happy gives me this parse error</p>\n\n<blockquote>\n  <p>happy: Parse error</p>\n</blockquote>\n\n<p>So I keep just <code>%attributetype {MyAttribute a}</code> and try to modify the basic type changing first</p>\n\n<pre><code>String  :: { String }  : L_quoted {  $1 }\n</code></pre>\n\n<p>with this line here</p>\n\n<pre><code>String  : L_quoted { $$= $1 }\n</code></pre>\n\n<p>but then my second problem arises: when I launch the Makefile I got this error here</p>\n\n<blockquote>\n  <p>Pargrammar.hs:344:19: error:\n      Variable not in scope: ($$=) :: t1 -> String -> t</p>\n  \n  <p>Pargrammar.hs:1066:19: error:</p>\n\n<pre><code>\u2022 Couldn't match type \u2018t1 -&gt; t\u2019 with \u2018[Char]\u2019\n  Expected type: HappyAbsSyn String\n    Actual type: HappyAbsSyn (t1 -&gt; t)\n\u2022 In the first argument of \u2018fn\u2019, namely \u2018v1\u2019\n  In the expression: fn v1\n  In an equation for \u2018r\u2019: r = fn v1\n\u2022 Relevant bindings include\n    r :: HappyAbsSyn (t1 -&gt; t) (bound at Pargrammar.hs:1066:12)\n    stk' :: HappyStk (HappyAbsSyn (t1 -&gt; t))\n      (bound at Pargrammar.hs:1065:81)\n    v1 :: HappyAbsSyn (t1 -&gt; t) (bound at Pargrammar.hs:1065:69)\n    fn :: HappyAbsSyn String -&gt; HappyAbsSyn (t1 -&gt; t)\n      (bound at Pargrammar.hs:1065:22)\n    happySpecReduce_1 :: Happy_GHC_Exts.Int#\n                         -&gt; (HappyAbsSyn String -&gt; HappyAbsSyn (t1 -&gt; t))\n                         -&gt; Happy_GHC_Exts.Int#\n                         -&gt; Token\n                         -&gt; Happy_GHC_Exts.Int#\n                         -&gt; Happy_IntList\n                         -&gt; HappyStk (HappyAbsSyn (t1 -&gt; t))\n                         -&gt; [Token]\n                         -&gt; Err (HappyAbsSyn (t1 -&gt; t))\n      (bound at Pargrammar.hs:1063:1)\n</code></pre>\n</blockquote>\n\n<p>and indeed at line 344 of the Pargrammar.hs I got this</p>\n\n<pre><code>happyIn8\n        ($$= happy_var_1\n    )\n</code></pre>\n\n<p>but that <code>$$=</code> should not be there.</p>\n\n<p>My Makefile just do this</p>\n\n<pre><code>all:\n    happy -gca Pargrammar.y\n    alex -g Lexgrammar.x\n    ghc --make Testgrammar.hs -o Testgrammar\n\nclean:\n    -rm -f *.log *.aux *.hi *.o *.dvi\n    -rm -f Docgrammar.ps\n\ndistclean: clean\n    -rm -f Docgrammar.* Lexgrammar.* Pargrammar.* Layoutgrammar.* Skelgrammar.* Printgrammar.* Testgrammar.* Absgrammar.* Testgrammar ErrM.* SharedString.* ComposOp.* grammar.dtd XMLgrammar.* Makefile*\n</code></pre>\n\n<p>I really don't know how to solve this. If any of you can suggest me some ideas I would be grateful.</p>\n"}, {"tags": ["haskell", "error-code"], "comments": [{"owner": {"reputation": 314794, "user_id": 67579, "user_type": "registered", "accept_rate": 81, "profile_image": "https://i.stack.imgur.com/BJXub.png?s=128&g=1", "display_name": "Willem Van Onsem", "link": "https://stackoverflow.com/users/67579/willem-van-onsem"}, "edited": false, "score": 4, "creation_date": 1497702951, "post_id": 44604701, "comment_id": 76196383, "body": "Probably you then should use <a href=\"https://hackage.haskell.org/package/base-4.9.1.0/docs/System-Exit.html\" rel=\"nofollow noreferrer\"><code>System.Exit</code></a>."}, {"owner": {"reputation": 962, "user_id": 4921099, "user_type": "registered", "accept_rate": 60, "profile_image": "https://i.stack.imgur.com/aqAiW.png?s=128&g=1", "display_name": "martin", "link": "https://stackoverflow.com/users/4921099/martin"}, "reply_to_user": {"reputation": 314794, "user_id": 67579, "user_type": "registered", "accept_rate": 81, "profile_image": "https://i.stack.imgur.com/BJXub.png?s=128&g=1", "display_name": "Willem Van Onsem", "link": "https://stackoverflow.com/users/67579/willem-van-onsem"}, "edited": false, "score": 0, "creation_date": 1497703282, "post_id": 44604701, "comment_id": 76196480, "body": "@WillemVanOnsem I think that&#39;s what I was looking for. Thanks."}], "answers": [{"tags": [], "owner": {"reputation": 94713, "user_id": 1139697, "user_type": "registered", "accept_rate": 86, "profile_image": "https://www.gravatar.com/avatar/5f136ddb684f39aaee1c028ee1950f6f?s=128&d=identicon&r=PG", "display_name": "Zeta", "link": "https://stackoverflow.com/users/1139697/zeta"}, "is_accepted": true, "score": 12, "last_activity_date": 1497705349, "creation_date": 1497705349, "answer_id": 44605076, "question_id": 44604701, "link": "https://stackoverflow.com/questions/44604701/haskell-exit-a-program-with-a-specified-error-code/44605076#44605076", "title": "Haskell - exit a program with a specified error code", "body": "<p>Use <a href=\"https://hackage.haskell.org/package/base-4.9.1.0/docs/System-Exit.html#v:exitWith\" rel=\"noreferrer\"><code>exitWith</code></a> from <a href=\"https://hackage.haskell.org/package/base-4.9.1.0/docs/System-Exit.html\" rel=\"noreferrer\"><code>System.Exit</code></a>:</p>\n\n<pre><code>main = exitWith (ExitFailure 2)\n</code></pre>\n\n<p>I would add some helpers for convenience:</p>\n\n<pre><code>exitWithErrorMessage :: String -&gt; ExitCode -&gt; IO a\nexitWithErrorMessage str e = hPutStrLn stderr str &gt;&gt; exitWith e\n\nexitResourceMissing :: IO a\nexitResourceMissing = exitWithErrorMessage \"Resource missing\" (ExitFailure 2)\n</code></pre>\n"}, {"tags": [], "owner": {"reputation": 416, "user_id": 5729872, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/oxgSz.jpg?s=128&g=1", "display_name": "Adam Burke", "link": "https://stackoverflow.com/users/5729872/adam-burke"}, "is_accepted": false, "score": 2, "last_activity_date": 1605680949, "creation_date": 1605680949, "answer_id": 64888141, "question_id": 44604701, "link": "https://stackoverflow.com/questions/44604701/haskell-exit-a-program-with-a-specified-error-code/64888141#64888141", "title": "Haskell - exit a program with a specified error code", "body": "<p>An alternative that allows an error message only is <code>die</code></p>\n<pre><code>import System.Exit\n\ntests = ... -- some value from the program\ntestsResult = ... -- Bool value overall status\n\nmain :: IO ()\nmain = do\n    if testsResult then\n        print &quot;Tests passed&quot;\n    else\n        die (show tests)\n</code></pre>\n<p>The accepted answer allows setting the exit error code though, so it's closer to the exact phrasing of the question.</p>\n"}], "owner": {"reputation": 962, "user_id": 4921099, "user_type": "registered", "accept_rate": 60, "profile_image": "https://i.stack.imgur.com/aqAiW.png?s=128&g=1", "display_name": "martin", "link": "https://stackoverflow.com/users/4921099/martin"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 1654, "favorite_count": 1, "accepted_answer_id": 44605076, "answer_count": 2, "score": 8, "last_activity_date": 1605680949, "creation_date": 1497702791, "last_edit_date": 1497704484, "question_id": 44604701, "link": "https://stackoverflow.com/questions/44604701/haskell-exit-a-program-with-a-specified-error-code", "title": "Haskell - exit a program with a specified error code", "body": "<p>In Haskell, is there a way to exit a program with a specified error code? The resources I've been reading typically point to the <code>error</code> function for exiting a program with an error, but it seems to always terminate the program with an error code of <code>1</code>. </p>\n\n<pre><code>[martin@localhost Haskell]$ cat error.hs\nmain = do\n    error \"My English language error message\"\n[martin@localhost Haskell]$ ghc error.hs\n[1 of 1] Compiling Main             ( error.hs, error.o )\nLinking error ...\n[martin@localhost Haskell]$ ./error \nerror: My English language error message\n[martin@localhost Haskell]$ echo $?\n1\n</code></pre>\n"}, {"tags": ["haskell", "pattern-matching"], "comments": [{"owner": {"reputation": 314794, "user_id": 67579, "user_type": "registered", "accept_rate": 81, "profile_image": "https://i.stack.imgur.com/BJXub.png?s=128&g=1", "display_name": "Willem Van Onsem", "link": "https://stackoverflow.com/users/67579/willem-van-onsem"}, "edited": false, "score": 0, "creation_date": 1497696181, "post_id": 44603542, "comment_id": 76194466, "body": "Can you give an example? Because with <code>True</code>/<code>False</code>, the program works for me, and Haskell does not show any errors."}, {"owner": {"reputation": 100185, "user_id": 3234959, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/93bb12ca0f93dfddb33880316f7e66c2?s=128&d=identicon&r=PG&f=1", "display_name": "chi", "link": "https://stackoverflow.com/users/3234959/chi"}, "edited": false, "score": 3, "creation_date": 1497697362, "post_id": 44603542, "comment_id": 76194829, "body": "I think the issue is that, with a regular pattern matching, your function is stricter, and later on in your program you use <code>foldr1 shortest ...</code>. Using a <code>foldr</code> with a strict function is not a good idea, since it will immediately perform all the recursive calls before it can return anything, using a lot of memory."}, {"owner": {"reputation": 94713, "user_id": 1139697, "user_type": "registered", "accept_rate": 86, "profile_image": "https://www.gravatar.com/avatar/5f136ddb684f39aaee1c028ee1950f6f?s=128&d=identicon&r=PG", "display_name": "Zeta", "link": "https://stackoverflow.com/users/1139697/zeta"}, "edited": false, "score": 0, "creation_date": 1497698066, "post_id": 44603542, "comment_id": 76195055, "body": "No, SO does not support embedded gist, and it probably will never support them. Gists can get deleted any time, which would devalue the question."}, {"owner": {"reputation": 94713, "user_id": 1139697, "user_type": "registered", "accept_rate": 86, "profile_image": "https://www.gravatar.com/avatar/5f136ddb684f39aaee1c028ee1950f6f?s=128&d=identicon&r=PG", "display_name": "Zeta", "link": "https://stackoverflow.com/users/1139697/zeta"}, "edited": false, "score": 0, "creation_date": 1497699050, "post_id": 44603542, "comment_id": 76195321, "body": "<b><i>Warning:</i></b> If you run wizzup&#39;s code, make sure to compile with <code>-rtsopts</code> and use <code>+RTS -M2G</code> or similar, unless you really like swapping memory."}, {"owner": {"reputation": 13807, "user_id": 2407038, "user_type": "registered", "accept_rate": 64, "profile_image": "https://www.gravatar.com/avatar/538f6f4a9aa43841841de7d8e8b169fc?s=128&d=identicon&r=PG&f=1", "display_name": "user2407038", "link": "https://stackoverflow.com/users/2407038/user2407038"}, "edited": false, "score": 0, "creation_date": 1497701412, "post_id": 44603542, "comment_id": 76195964, "body": "The issue is not with matching on <code>Bool</code>. The issue is that the pattern <code>(x, True)</code> or <code>(x, False)</code> or even <code>(x, y)</code> are strict on the <i>tuple</i>. By writing <code>~(x,y)</code> you not only have a lazy match on the <code>Bool</code>, but on the tuple as well. Try as well a lazy match on just the <code>Bool</code>, i.e. <code>(x, ~y)</code> (hint: you&#39;ll get a warning because the <code>~</code> is redundant there - and it will blow up the stack, being exactly the same as just <code>(x,y)</code>) and also <code>let (x,y) = shortest&#39; .. in ..</code> (it will work, because pattern matches in <code>let</code> bindings are by default lazy, whereas in <code>case</code> it is by default strict)."}, {"owner": {"reputation": 13807, "user_id": 2407038, "user_type": "registered", "accept_rate": 64, "profile_image": "https://www.gravatar.com/avatar/538f6f4a9aa43841841de7d8e8b169fc?s=128&d=identicon&r=PG&f=1", "display_name": "user2407038", "link": "https://stackoverflow.com/users/2407038/user2407038"}, "edited": false, "score": 0, "creation_date": 1497701541, "post_id": 44603542, "comment_id": 76196010, "body": "Aside: I&#39;m not sure what the question here is (what does &quot;Am I missing any patterns?&quot; mean?). If it is about why this works the way it does, please read the Haskell report - that goes into the semantics of pattern matching in some detail."}], "owner": {"reputation": 2141, "user_id": 1664572, "user_type": "registered", "accept_rate": 85, "profile_image": "https://www.gravatar.com/avatar/c2bee27fdb72050b60a3c6aae64b474f?s=128&d=identicon&r=PG", "display_name": "wizzup", "link": "https://stackoverflow.com/users/1664572/wizzup"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 121, "favorite_count": 0, "answer_count": 0, "score": 4, "last_activity_date": 1497699821, "creation_date": 1497695710, "last_edit_date": 1497699821, "question_id": 44603542, "link": "https://stackoverflow.com/questions/44603542/code-only-work-when-using-irrefutable-patterns", "title": "Code only work when using Irrefutable patterns", "body": "<p>I have 2 files <a href=\"https://gist.github.com/wizzup/5af26430046d7b71ed2b93ff5cec2add#file-a-hs\" rel=\"nofollow noreferrer\">a.hs</a> and <a href=\"https://gist.github.com/wizzup/5af26430046d7b71ed2b93ff5cec2add#file-b-hs\" rel=\"nofollow noreferrer\">b.hs</a> that have different only one is use <code>~</code> but another one is use explicit match</p>\n\n<pre><code>$ diff a.hs b.hs\n20,21c20\n&lt;       (True,  js) -&gt; (True,  a:js)\n&lt;       (False, js) -&gt; (False, b:js)\n---\n&gt;       ~(i, js) -&gt; (i, (if i then a else b):js)\n</code></pre>\n\n<p>This is portion of code that use the pattern that run fine.</p>\n\n<pre><code>shortest :: [a] -&gt; [a] -&gt; [a]\nshortest xs ys = snd $ shortest' xs ys where\n  shortest' :: [a] -&gt; [a] -&gt; (Bool, [a])\n  shortest' []     _      = (True,  [])\n  shortest'  _     []     = (False, [])\n  shortest' (a:as) (b:bs) = case shortest' as bs of\n      ~(i, js) -&gt; (i, (if i then a else b):js)\n</code></pre>\n\n<p>but when I use</p>\n\n<pre><code>(True,  js) -&gt; (True,  a:js)\n(False, js) -&gt; (False, b:js)\n</code></pre>\n\n<p>my computer is not responding (memory almost full).</p>\n\n<p><strong>Am I missing any patterns?</strong></p>\n\n<p>The whole files can be found <a href=\"https://gist.github.com/wizzup/5af26430046d7b71ed2b93ff5cec2add\" rel=\"nofollow noreferrer\">here</a>\n. (wonder if SO support embedded gist)</p>\n\n<p>I didn't wrote the code originally, it is a modified version of flickyfrans's <a href=\"https://gist.github.com/flickyfrans/b843b20bb512be443b4b\" rel=\"nofollow noreferrer\">gist</a></p>\n\n<hr>\n\n<p><strong>Edit:</strong> I think I should post <code>b.hs</code> here to prevent link rotted problem in the future.</p>\n\n<pre><code>import Data.Maybe\n\ndata Rose  a = Rose a [Rose a] deriving Show\nnewtype Graph a = Graph [(a, Rose a)]\n\nlookupRose :: Eq a =&gt; a -&gt; Graph a -&gt; Rose a\nlookupRose i (Graph rs) = fromJust $ lookup i rs\n\nfromList :: Eq a =&gt; [(a, [a])] -&gt; Graph a\nfromList xs = graph where\n  graph         = Graph $ map irose xs\n  irose (i, is) = (i, Rose i $ map (`lookupRose` graph) is)\n\nshortest :: [a] -&gt; [a] -&gt; [a]\nshortest xs ys = snd $ shortest' xs ys where\n  shortest' :: [a] -&gt; [a] -&gt; (Bool, [a])\n  shortest' []     _      = (True,  [])\n  shortest'  _     []     = (False, [])\n  shortest' (a:as) (b:bs) = case shortest' as bs of\n      ~(i, js) -&gt; (i, (if i then a else b):js)\n\npath :: Eq a =&gt; a -&gt; a -&gt; Graph a -&gt; [a]\npath orig dest gr = path' (lookupRose orig gr) where\n  path' (Rose p ps)\n      | p == dest = [p]\n      | otherwise = p : foldr1 shortest (map path' ps)\n\n-------------------------------------------------------------------------------\n\ntype Pos = (Int,Int)\n\nposGraph :: [(Pos,[Pos])]\nposGraph = [ (a, [b, c, d])\n          , (b, [a, b, d])\n          , (c, [a, d, e])\n          , (d, [a, b, c, g])\n          , (e, [c, e, f, h])\n          , (f, [e, g, h])\n          , (g, [d, f, g])\n          , (h, [e, f])\n          ]\n  where [a,b,c,d,e,f,g,h] =\n          [ (1,1)\n          , (2,2)\n          , (3,3)\n          , (4,4)\n          , (5,5)\n          , (6,6)\n          , (7,7)\n          , (8,8)\n          ]\n\nmain :: IO ()\nmain = do\n  print $ path (1,1) (8,8) $ fromList posGraph\n  print $ path (2,2) (8,8) $ fromList posGraph\n</code></pre>\n"}, {"tags": ["haskell", "reflex"], "comments": [{"owner": {"reputation": 13807, "user_id": 2407038, "user_type": "registered", "accept_rate": 64, "profile_image": "https://www.gravatar.com/avatar/538f6f4a9aa43841841de7d8e8b169fc?s=128&d=identicon&r=PG&f=1", "display_name": "user2407038", "link": "https://stackoverflow.com/users/2407038/user2407038"}, "edited": false, "score": 0, "creation_date": 1497701737, "post_id": 44603254, "comment_id": 76196074, "body": "What does &#39;failed&#39; mean? A compiler error (include it <i>verbatim</i> and in *it&#39;s entirety) or a runtime error (describe it)? <a href=\"https://stackoverflow.com/help/mcve\">You didn&#39;t post a complete program</a> so it&#39;s nearly impossible for anyone to tell why your program doesn&#39;t work."}, {"owner": {"reputation": 384, "user_id": 4098149, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/4eff262713ed007414ceb4e35f6b63f5?s=128&d=identicon&r=PG&f=1", "display_name": "Schoon", "link": "https://stackoverflow.com/users/4098149/schoon"}, "reply_to_user": {"reputation": 13807, "user_id": 2407038, "user_type": "registered", "accept_rate": 64, "profile_image": "https://www.gravatar.com/avatar/538f6f4a9aa43841841de7d8e8b169fc?s=128&d=identicon&r=PG&f=1", "display_name": "user2407038", "link": "https://stackoverflow.com/users/2407038/user2407038"}, "edited": false, "score": 0, "creation_date": 1497734808, "post_id": 44603254, "comment_id": 76205844, "body": "So &#39;failed&#39; means that I would like to rewrite the working code of the numberInput function in a way that the dynamic attributes are set on the parent DOM node but I have only a very vague idea how that could work. I haven&#39;t grasped enough how reflect works  so I&#39;m a bit lost on how to proceed and cannot provide any sample code or error message. But I have a very concrete question. How would you rewrite the perfectly good code that I provide in a way that the dynamic attributes are set on the parent DOM node."}, {"owner": {"reputation": 13807, "user_id": 2407038, "user_type": "registered", "accept_rate": 64, "profile_image": "https://www.gravatar.com/avatar/538f6f4a9aa43841841de7d8e8b169fc?s=128&d=identicon&r=PG&f=1", "display_name": "user2407038", "link": "https://stackoverflow.com/users/2407038/user2407038"}, "edited": false, "score": 1, "creation_date": 1497736797, "post_id": 44603254, "comment_id": 76206261, "body": "&quot;How would you rewrite this code to do X instead of Y&quot; is off-topic for SO. I&#39;m guessing you want to refer to <code>n</code> in the rhs of <code>dynAttrs</code>, but <code>n</code> is bound in the inner scope of the arguement passed to <code>elDynAttr</code>. The solution is probably to return <code>n</code> (and whichever other things you might need) from that inner scope, and bind those variables again in the outer scope: <code>do { dynAttrs &lt;- .. n ..; (result, n) &lt;- elDynAttr &quot;div&quot; dynAttrs $ do { n &lt;- ..; .. ; return (result, n) }; return result }</code>. (I don&#39;t know enough about DOM to say for sure)."}], "answers": [{"comments": [{"owner": {"reputation": 384, "user_id": 4098149, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/4eff262713ed007414ceb4e35f6b63f5?s=128&d=identicon&r=PG&f=1", "display_name": "Schoon", "link": "https://stackoverflow.com/users/4098149/schoon"}, "edited": false, "score": 0, "creation_date": 1498079268, "post_id": 44680929, "comment_id": 76356652, "body": "user2407038&#39;s hint already helped me over the hump. Thanks for writing the solution down. I had to wrap my head around Recursive Do..."}], "tags": [], "owner": {"reputation": 1496, "user_id": 7350814, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/bd7e1bdad619c54ab51e05ff9cfaa199?s=128&d=identicon&r=PG&f=1", "display_name": "Jogger", "link": "https://stackoverflow.com/users/7350814/jogger"}, "is_accepted": true, "score": 0, "last_activity_date": 1498060439, "creation_date": 1498060439, "answer_id": 44680929, "question_id": 44603254, "link": "https://stackoverflow.com/questions/44603254/dynamic-parent-element/44680929#44680929", "title": "Dynamic parent element", "body": "<p>Here is a little program where the attributes (align right or left) of the parent element depend on the state of a child element:</p>\n\n<pre><code>{-# LANGUAGE OverloadedStrings #-}\n{-# LANGUAGE RecursiveDo #-}\nimport Reflex.Dom\nimport qualified Data.Text as T\nimport Safe\n\nmain :: IO ()\nmain = mainWidget bodyElement \n\nbodyElement :: MonadWidget t m =&gt; m ()\nbodyElement =  el \"div\" $ do\n    el \"h2\" $ text \"Dynamic parent element\"\n    numberInput\n    return ()\n\nnumberInput :: (MonadWidget t m) =&gt; m (Dynamic t (Maybe Double))\nnumberInput =  do\n    rec\n       let errorState = (\"align\" :: T.Text) =: \"right\"\n           validState = \"align\" =: \"left\"\n       let result = fmap (readMay . T.unpack) $ _textInput_value n \n           attrs  = fmap (maybe errorState (const validState)) result\n       n &lt;- elDynAttr \"div\" attrs $ do\n          n1 &lt;- textInput $ def &amp; textInputConfig_inputType .~ \"number\"\n                                &amp; textInputConfig_initialValue .~ \"0\"\n\n          text \"Some additional control\"\n          return n1\n    return result\n</code></pre>\n\n<p>As user <em>user2407038</em> mentions, we have to return the numeric text element from an inner scope to the outer scope. Then we can use recursive do to access the element we define later in the program.</p>\n\n<p>As soon as you type a letter into the numeric field, it will jump to the right.</p>\n"}], "owner": {"reputation": 384, "user_id": 4098149, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/4eff262713ed007414ceb4e35f6b63f5?s=128&d=identicon&r=PG&f=1", "display_name": "Schoon", "link": "https://stackoverflow.com/users/4098149/schoon"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 83, "favorite_count": 0, "accepted_answer_id": 44680929, "answer_count": 1, "score": 1, "last_activity_date": 1498060439, "creation_date": 1497693839, "question_id": 44603254, "link": "https://stackoverflow.com/questions/44603254/dynamic-parent-element", "title": "Dynamic parent element", "body": "<p>I have this piece of code and it works perfectly fine. It toggles some styles on the text input field depending on the field value.</p>\n\n<pre><code>numberInput :: (MonadWidget t m) =&gt; m (Dynamic t (Maybe Double))\nnumberInput = divClass \"form-group\" $ do\n  let errorState = \"style\" =: \"border-color: red\"\n      validState = \"style\" =: \"border-color: green\"\n  rec n &lt;- textInput $ def &amp; textInputConfig_inputType .~ \"number\"\n                           &amp; textInputConfig_initialValue .~ \"0\"\n                           &amp; textInputConfig_attributes .~ attrs\n      let result = fmap (readMay . unpack) $ _textInput_value n\n          attrs  = fmap (maybe errorState (const validState)) result\n  return result\n</code></pre>\n\n<p>I ran into some problems making the parent element dynamic. I'd like to toggle the styles on the parent element of text input. I'd like to write something like but failed!</p>\n\n<pre><code>numberInput :: (MonadWidget t m) =&gt; m (Dynamic t (Maybe Double))\nnumberInput = do\n  rec \n      dynAttrs &lt;- -- reference to textInput\n      elDynAttr \"div\" dynAttrs $ do\n        n &lt;- textInput $ def &amp; textInputConfig_inputType .~ \"number\"\n                       &amp; textInputConfig_initialValue .~ \"0\"\n        ...\n</code></pre>\n\n<p>Thanks for helping out!</p>\n"}, {"tags": ["haskell"], "answers": [{"comments": [{"owner": {"reputation": 2196, "user_id": 1980863, "user_type": "registered", "accept_rate": 50, "profile_image": "https://www.gravatar.com/avatar/8a9248211c4148f5d7df2269aa711e2e?s=128&d=identicon&r=PG", "display_name": "RandomB", "link": "https://stackoverflow.com/users/1980863/randomb"}, "edited": false, "score": 0, "creation_date": 1497693189, "post_id": 44603112, "comment_id": 76193580, "body": "I suspected that Functor is impossible, so is this mean that <code>mapFix</code> function is impossible too?  Btw, when I changed type to <code>FixItem m a b = FixItem (m (a -&gt; b))|SkipItem|KeepItem</code> and try to implement Functor, I get again errors about right type &#39;a&#39;..."}, {"owner": {"reputation": 2196, "user_id": 1980863, "user_type": "registered", "accept_rate": 50, "profile_image": "https://www.gravatar.com/avatar/8a9248211c4148f5d7df2269aa711e2e?s=128&d=identicon&r=PG", "display_name": "RandomB", "link": "https://stackoverflow.com/users/1980863/randomb"}, "edited": false, "score": 0, "creation_date": 1497694988, "post_id": 44603112, "comment_id": 76194113, "body": "Hmm, I got it: composition of <code>pure f</code> and <code>mf</code> hides <code>a -&gt; b</code> in FixITem, while FixItem supports <code>a -&gt; a</code> only. So, mapFix is impossible. But is it possible to implement <code>FixITem m a b = FixITem (m (a -&gt; b))|...</code> Functor instance?"}, {"owner": {"reputation": 2196, "user_id": 1980863, "user_type": "registered", "accept_rate": 50, "profile_image": "https://www.gravatar.com/avatar/8a9248211c4148f5d7df2269aa711e2e?s=128&d=identicon&r=PG", "display_name": "RandomB", "link": "https://stackoverflow.com/users/1980863/randomb"}, "edited": false, "score": 0, "creation_date": 1497695319, "post_id": 44603112, "comment_id": 76194235, "body": "Ah, OK, done :) <code>fmap f (FixItem mf) = FixItem $ pure (.) &lt;*&gt; (pure f) &lt;*&gt; mf</code>. Thanks!"}, {"owner": {"reputation": 8237, "user_id": 2900502, "user_type": "registered", "accept_rate": 73, "profile_image": "https://i.stack.imgur.com/R1OjD.jpg?s=128&g=1", "display_name": "Shersh", "link": "https://stackoverflow.com/users/2900502/shersh"}, "reply_to_user": {"reputation": 2196, "user_id": 1980863, "user_type": "registered", "accept_rate": 50, "profile_image": "https://www.gravatar.com/avatar/8a9248211c4148f5d7df2269aa711e2e?s=128&d=identicon&r=PG", "display_name": "RandomB", "link": "https://stackoverflow.com/users/1980863/randomb"}, "edited": false, "score": 0, "creation_date": 1497702222, "post_id": 44603112, "comment_id": 76196216, "body": "@Paul-AG Yes, functor is impossible in some theoretical sense. It means that <code>mapFix</code> function is impossible as well :( If you change <code>a -&gt; a</code> into <code>a -&gt; b</code> and have type <code>FixItem m a b</code> than you can write <code>mapFix</code> which when given <code>b -&gt; c</code> function can map <code>FixItem m a b</code> to <code>FixItem m a c</code> because <code>b</code> type variable is in covariant position."}], "tags": [], "owner": {"reputation": 8237, "user_id": 2900502, "user_type": "registered", "accept_rate": 73, "profile_image": "https://i.stack.imgur.com/R1OjD.jpg?s=128&g=1", "display_name": "Shersh", "link": "https://stackoverflow.com/users/2900502/shersh"}, "is_accepted": false, "score": 4, "last_activity_date": 1497692826, "creation_date": 1497692826, "answer_id": 44603112, "question_id": 44602927, "link": "https://stackoverflow.com/questions/44602927/how-to-write-map-fmap-analogue-a-b-f-m-a-f-m-b/44603112#44603112", "title": "How to write map/fmap analogue (a-&gt;b) -&gt; F m a -&gt; F m b", "body": "<p>You can't implement <code>Functor</code> type class for your data type. It's because of\n<code>a -&gt; a</code> inside one of your constructors. When you have functions, you should be more careful. But in short, you have type variable <code>a</code> in contravariant position so you can't implement <code>Functor</code> over this type variable.</p>\n\n<p>Though you can implement <a href=\"https://hackage.haskell.org/package/invariant-0.4.2/docs/Data-Functor-Invariant.html#t:Invariant\" rel=\"nofollow noreferrer\"><code>Invariant</code></a> for your data type. Because <code>a</code> in both <em>covariant</em> and <em>contravariant</em> positions, your data type is invariant functor.</p>\n\n<p>Can help you:</p>\n\n<p><a href=\"https://stackoverflow.com/questions/22103445/example-of-invariant-functor\">Example of Invariant Functor?</a></p>\n\n<p><a href=\"https://stackoverflow.com/questions/38034077/what-is-a-contravariant-functor\">What is a contravariant functor?</a></p>\n\n<p><a href=\"https://michaelochurch.wordpress.com/2016/01/01/insights-into-why-a-contravariant-type-cant-be-a-haskell-functor/\" rel=\"nofollow noreferrer\">Some blog post</a></p>\n"}], "owner": {"reputation": 2196, "user_id": 1980863, "user_type": "registered", "accept_rate": 50, "profile_image": "https://www.gravatar.com/avatar/8a9248211c4148f5d7df2269aa711e2e?s=128&d=identicon&r=PG", "display_name": "RandomB", "link": "https://stackoverflow.com/users/1980863/randomb"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 61, "favorite_count": 0, "answer_count": 1, "score": 1, "last_activity_date": 1497692826, "creation_date": 1497691728, "question_id": 44602927, "link": "https://stackoverflow.com/questions/44602927/how-to-write-map-fmap-analogue-a-b-f-m-a-f-m-b", "title": "How to write map/fmap analogue (a-&gt;b) -&gt; F m a -&gt; F m b", "body": "<p>Good day/night everyone!\nI have type:</p>\n\n<pre><code>data FixItem m a = KeepItem|SkipItem|FixItem (m (a -&gt; a))\nfixItem f = FixItem $ pure f\n</code></pre>\n\n<p>and I want to write function <code>mapFix :: (a -&gt; b) -&gt; FixItem m a -&gt; FixItem m b</code>. When I try:</p>\n\n<pre><code>mapFix f SkipItem = SkipItem -- good\nmapFix f KeepItem = fixItem f -- error \"rigid type\"!!!\nmapFix f (FixItem mf) = FixItem $ pure (.) &lt;*&gt; (pure f) &lt;*&gt; mf -- too!\n</code></pre>\n\n<p>So, I get error:</p>\n\n<pre><code>    \u2022 Couldn't match type \u2018b\u2019 with \u2018a\u2019\n      \u2018b\u2019 is a rigid type variable bound by\n        the type signature for:\n          mapFix :: forall (m :: * -&gt; *) a b.\n                    Applicative m =&gt;\n                    (a -&gt; b) -&gt; FixItem m a -&gt; FixItem m b\n        at src/test.hs:235:11\n      \u2018a\u2019 is a rigid type variable bound by\n        the type signature for:\n          mapFix :: forall (m :: * -&gt; *) a b.\n                    Applicative m =&gt;\n                    (a -&gt; b) -&gt; FixItem m a -&gt; FixItem m b\n        at src/test.hs:235:11\n      Expected type: b -&gt; b\n        Actual type: a -&gt; b\n    \u2022 In the first argument of \u2018fixItem\u2019, namely \u2018f\u2019\n      In the expression: fixItem f\n      In an equation for \u2018mapFix\u2019: mapFix f KeepItem = fixItem f\n    \u2022 Relevant bindings include\n        f :: a -&gt; b (bound at src/test.hs:236:8)\n        mapFix :: (a -&gt; b) -&gt; FixItem m a -&gt; FixItem m b\n          (bound at src/test.hs:236:1)\n</code></pre>\n\n<p>How to write mapFix or implement Functor instance for such type (FixItem fixes <code>a</code> to <code>a</code>, not to <code>b</code>, i.e. fix is <code>a -&gt; a</code>, not <code>a -&gt; b</code>)?</p>\n"}, {"tags": ["haskell", "palindrome"], "comments": [{"owner": {"reputation": 100185, "user_id": 3234959, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/93bb12ca0f93dfddb33880316f7e66c2?s=128&d=identicon&r=PG&f=1", "display_name": "chi", "link": "https://stackoverflow.com/users/3234959/chi"}, "edited": false, "score": 3, "creation_date": 1497650975, "post_id": 44598620, "comment_id": 76185584, "body": "What did you try? This looks as a problem dump."}, {"owner": {"reputation": 314794, "user_id": 67579, "user_type": "registered", "accept_rate": 81, "profile_image": "https://i.stack.imgur.com/BJXub.png?s=128&g=1", "display_name": "Willem Van Onsem", "link": "https://stackoverflow.com/users/67579/willem-van-onsem"}, "edited": false, "score": 2, "creation_date": 1497650976, "post_id": 44598620, "comment_id": 76185586, "body": "What have you tried yourself?"}, {"owner": {"reputation": 75362, "user_id": 625403, "user_type": "registered", "accept_rate": 82, "profile_image": "https://www.gravatar.com/avatar/786eed7da67079cb5d63a49d469af25b?s=128&d=identicon&r=PG", "display_name": "amalloy", "link": "https://stackoverflow.com/users/625403/amalloy"}, "edited": false, "score": 2, "creation_date": 1497651008, "post_id": 44598620, "comment_id": 76185594, "body": "What part of the exercise are you having trouble with?"}, {"owner": {"reputation": 81794, "user_id": 9859, "user_type": "registered", "accept_rate": 89, "profile_image": "https://i.stack.imgur.com/KEZOL.jpg?s=128&g=1", "display_name": "rampion", "link": "https://stackoverflow.com/users/9859/rampion"}, "edited": false, "score": 0, "creation_date": 1497652011, "post_id": 44598620, "comment_id": 76185892, "body": "How would you generate all possible palindromes of length 0? length1? Given all possible palindromes of length <code>n - 2</code>, could you generate all possible palindromes of length <code>n</code>?"}, {"owner": {"reputation": 314794, "user_id": 67579, "user_type": "registered", "accept_rate": 81, "profile_image": "https://i.stack.imgur.com/BJXub.png?s=128&g=1", "display_name": "Willem Van Onsem", "link": "https://stackoverflow.com/users/67579/willem-van-onsem"}, "edited": false, "score": 0, "creation_date": 1497652476, "post_id": 44598620, "comment_id": 76186017, "body": "Perhaps an idea might be to generate first all palindromes with for instance length one, two and three."}], "answers": [{"tags": [], "owner": {"reputation": 314794, "user_id": 67579, "user_type": "registered", "accept_rate": 81, "profile_image": "https://i.stack.imgur.com/BJXub.png?s=128&g=1", "display_name": "Willem Van Onsem", "link": "https://stackoverflow.com/users/67579/willem-van-onsem"}, "is_accepted": true, "score": 0, "last_activity_date": 1497658800, "last_edit_date": 1497658800, "creation_date": 1497653617, "answer_id": 44599014, "question_id": 44598620, "link": "https://stackoverflow.com/questions/44598620/haskell-how-to-generate-all-possible-palindromes/44599014#44599014", "title": "Haskell How to generate all possible Palindromes", "body": "<h1>Even case</h1>\n\n<p>Lets for simplicity <strong>first assume that <code>n</code> is even</strong>, later we can generalize the function. We can use recursion for that. We define a helper function <code>pal' :: Integer -&gt; [String] -&gt; [String]</code>. Here the second argument, is the accumulated reverse string. So once we hit <code>0</code>, we simply have to emit a single list the contain the accumulated reversed string, like:</p>\n\n<pre><code>pal' 0 r = [r]\n</code></pre>\n\n<p>Given however we are still in the <em>generating</em> part of the palindrome, the left side thus, we can use list comprehension, like:</p>\n\n<pre><code>pal' k r = [ c : p | c &lt;- ['a'..'z'], p &lt;- pal' (k-1) (c:r) ]\n</code></pre>\n\n<p>So we iterate over <code>[a..z]</code> and for each such character, we we perform a recursive call on <code>pal'</code> where we need to generate an additional <code>k-1</code> characters, with <code>(c:r)</code> as reversed string to be emitted. Furthermore we yield for these palindromes <code>c : p</code>. We put thus the choses character in front of the palindrome.</p>\n\n<p>So now for an <code>even_palindrome</code> function that generates <strong>even</strong> palindromes, we can write:</p>\n\n<pre><code>evenpalindrome :: Integer -&gt; [String]\nevenpalindrome n = pal' (div n 2) []\n    where pal' 0 r = [r]\n          pal' k r = [ c : p | c &lt;- ['a'..'z'], p &lt;- pal' (k-1) (c:r) ]\n</code></pre>\n\n<p>For testing purposes, I set the code to pick from the range `c &lt;- ['a'..'d'], but you can set it to any range you want.</p>\n\n<p>And if we generate palindromes for length 0, 2 and 4, we get:</p>\n\n<pre><code>*Main&gt; evenpalindrome 0\n[\"\"]\n*Main&gt; evenpalindrome 2\n[\"aa\",\"bb\",\"cc\",\"dd\"]\n*Main&gt; evenpalindrome 4\n[\"aaaa\",\"abba\",\"acca\",\"adda\",\"baab\",\"bbbb\",\"bccb\",\"bddb\",\"caac\",\"cbbc\",\"cccc\",\"cddc\",\"daad\",\"dbbd\",\"dccd\",\"dddd\"]\n</code></pre>\n\n<p>So that seems to work. If we however write <code>evenpalindrome 1</code>, it will work in the sense that it will take integer division, and thus generate palindromes for length 0.</p>\n\n<h1>Odd case</h1>\n\n<p>Now the question is what do we have to alter in order to let it work for <strong>odd</strong> length. There are two things that need to change here:</p>\n\n<ol>\n<li>we need to generate an additional character, so we should not use <code>div n 2</code>, but <code>div (n+1) 2</code>; and</li>\n<li>the last generated character should <em>not</em> be repeated in the reverse case.</li>\n</ol>\n\n<p>So it means that we should first check <code>n</code> modulo 2 (let that be <code>d</code>), and then rewrite:</p>\n\n<pre><code>pal' 0 r = [drop (fromInteger d) r]\n</code></pre>\n\n<p>Furthermore as said before we should call the initial <code>pal'</code> with <code>pal' (div (n+1) 2) []</code>, so now the generalized version is:</p>\n\n<pre><code>palindrome :: Integer -&gt; [String]\npalindrome n = pal' (div (n+1) 2) []\n    where pal' 0 r = [drop (fromInteger d) r]\n          pal' k r = [ c : p | c &lt;- ['a'..'z'], p &lt;- pal' (k-1) (c:r) ]\n          d = mod n 2\n</code></pre>\n\n<p>Which produces:</p>\n\n<pre><code>*Main&gt; palindrome 1\n[\"a\",\"b\",\"c\",\"d\"]\n*Main&gt; palindrome 2\n[\"aa\",\"bb\",\"cc\",\"dd\"]\n*Main&gt; palindrome 3\n[\"aaa\",\"aba\",\"aca\",\"ada\",\"bab\",\"bbb\",\"bcb\",\"bdb\",\"cac\",\"cbc\",\"ccc\",\"cdc\",\"dad\",\"dbd\",\"dcd\",\"ddd\"]\n*Main&gt; palindrome 4\n[\"aaaa\",\"abba\",\"acca\",\"adda\",\"baab\",\"bbbb\",\"bccb\",\"bddb\",\"caac\",\"cbbc\",\"cccc\",\"cddc\",\"daad\",\"dbbd\",\"dccd\",\"dddd\"]\n*Main&gt; palindrome 5\n[\"aaaaa\",\"aabaa\",\"aacaa\",\"aadaa\",\"ababa\",\"abbba\",\"abcba\",\"abdba\",\"acaca\",\"acbca\",\"accca\",\"acdca\",\"adada\",\"adbda\",\"adcda\",\"addda\",\"baaab\",\"babab\",\"bacab\",\"badab\",\"bbabb\",\"bbbbb\",\"bbcbb\",\"bbdbb\",\"bcacb\",\"bcbcb\",\"bcccb\",\"bcdcb\",\"bdadb\",\"bdbdb\",\"bdcdb\",\"bdddb\",\"caaac\",\"cabac\",\"cacac\",\"cadac\",\"cbabc\",\"cbbbc\",\"cbcbc\",\"cbdbc\",\"ccacc\",\"ccbcc\",\"ccccc\",\"ccdcc\",\"cdadc\",\"cdbdc\",\"cdcdc\",\"cdddc\",\"daaad\",\"dabad\",\"dacad\",\"dadad\",\"dbabd\",\"dbbbd\",\"dbcbd\",\"dbdbd\",\"dcacd\",\"dcbcd\",\"dcccd\",\"dcdcd\",\"ddadd\",\"ddbdd\",\"ddcdd\",\"ddddd\"]\n</code></pre>\n\n<h1>Memory structure</h1>\n\n<p>A nice thing about constructing the reverse part using recursion that way, is that the second half of all the palindromes is stored more efficiently. Given we generate palindromes of length 5 for the `['a'..'b'] range, the final list (after complete evaluation), will look like:</p>\n\n<pre>+---+\n| o--- 'a' -- 'a' -&gt; 'a' -\\\n+---+                      &gt; 'a' -\\\n| o--&gt; 'a' -&gt; 'a' -&gt; 'b' -/        \\\n+---+                               &gt; 'a'\n| o--&gt; 'a' -&gt; 'b' -&gt; 'a' -\\        /\n+---+                      &gt; 'b' -/\n| o--&gt; 'a' -&gt; 'b' -&gt; 'b' -/\n+---+\n| o--&gt; 'b' -&gt; 'a' -&gt; 'a' -\\\n+---+                      &gt; 'a' -\\\n| o--&gt; 'b' -&gt; 'a' -&gt; 'b' -/        \\\n+---+                               &gt; 'b'\n| o--&gt; 'b' -&gt; 'b' -&gt; 'a' -\\        /\n+---+                      &gt; 'b' -/\n| o--&gt; 'b' -&gt; 'b' -&gt; 'b' -/\n+---+</pre>\n"}, {"tags": [], "owner": {"reputation": 28376, "user_id": 5743988, "user_type": "registered", "accept_rate": 67, "profile_image": "https://i.stack.imgur.com/IeSSM.jpg?s=128&g=1", "display_name": "4castle", "link": "https://stackoverflow.com/users/5743988/4castle"}, "is_accepted": false, "score": 1, "last_activity_date": 1497658270, "last_edit_date": 1497658270, "creation_date": 1497656325, "answer_id": 44599323, "question_id": 44598620, "link": "https://stackoverflow.com/questions/44598620/haskell-how-to-generate-all-possible-palindromes/44599323#44599323", "title": "Haskell How to generate all possible Palindromes", "body": "<p>A palindrome is a string where the last half of the characters are the reverse of the first half of the characters. Therefore, a simple algorithm would be to generate all strings of length <code>n / 2</code> and then append the reverse of each string to the end. For odd length palindromes, we can just drop the first character of the back half of the string, and make sure to round up when we find <code>n / 2</code>.</p>\n\n<p>Now the tricky part is generating all the possible strings of length <code>n / 2</code>. We need to choose a character from <code>['a'..'z']</code> for each character in the string, and in Haskell, <a href=\"https://stackoverflow.com/q/20638893/5743988\">lists can represent non-determinism</a>. Therefore, all we need to do is use <a href=\"http://hackage.haskell.org/package/base-4.9.1.0/docs/Control-Monad.html#v:replicateM\" rel=\"nofollow noreferrer\"><code>replicateM</code></a> and it will create every string where each character is chosen non-deterministically from the alphabet.</p>\n\n<p>A side note, the number of palindromes possible for any length <code>n</code> increases at an exponential rate. Using an <code>Integer</code> as the input is overkill, because the maximum value of an <code>Int</code> is already over 9 quintillion.</p>\n\n<p>Here's one way to implement the full algorithm:</p>\n\n<pre><code>palindrome :: Int -&gt; [String]\npalindrome n\n    | n &lt; 0  = []\n    | even n = map (\\front -&gt; front ++ reverse front) fronts\n    | odd n  = map (\\front -&gt; front ++ tail (reverse front)) fronts\n    where fronts = replicateM (div (n + 1) 2) ['a'..'z']\n</code></pre>\n"}], "owner": {"reputation": 17, "user_id": 2478642, "user_type": "registered", "accept_rate": 20, "profile_image": "https://www.gravatar.com/avatar/3eded30d2c94920cba8162522f738001?s=128&d=identicon&r=PG", "display_name": "Maksim Kerbel", "link": "https://stackoverflow.com/users/2478642/maksim-kerbel"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 809, "favorite_count": 1, "closed_date": 1497700776, "accepted_answer_id": 44599014, "answer_count": 2, "score": -3, "last_activity_date": 1497658800, "creation_date": 1497650790, "last_edit_date": 1497650863, "question_id": 44598620, "link": "https://stackoverflow.com/questions/44598620/haskell-how-to-generate-all-possible-palindromes", "closed_reason": "Needs more focus", "title": "Haskell How to generate all possible Palindromes", "body": "<p>how to generate all possible palindromes of the length <code>n</code>?</p>\n\n<p>the only chars <code>['a'..'z']</code> should be used</p>\n\n<pre><code>palindrome n :: Integer -&gt; [String]\n</code></pre>\n"}, {"tags": ["haskell", "haskell-snap-framework"], "comments": [{"owner": {"reputation": 23111, "user_id": 1319998, "user_type": "registered", "accept_rate": 58, "profile_image": "https://www.gravatar.com/avatar/9f600f4583bec89109ce8c0c098951ae?s=128&d=identicon&r=PG", "display_name": "Michal Charemza", "link": "https://stackoverflow.com/users/1319998/michal-charemza"}, "edited": false, "score": 0, "creation_date": 1497643571, "post_id": 44594504, "comment_id": 76182614, "body": "Can you add a link to the answer you&#39;re referring to?"}, {"owner": {"reputation": 825, "user_id": 962828, "user_type": "registered", "accept_rate": 55, "profile_image": "https://www.gravatar.com/avatar/78c370f00a14fb3bd59dc334082378cd?s=128&d=identicon&r=PG", "display_name": "Ulrar", "link": "https://stackoverflow.com/users/962828/ulrar"}, "reply_to_user": {"reputation": 23111, "user_id": 1319998, "user_type": "registered", "accept_rate": 58, "profile_image": "https://www.gravatar.com/avatar/9f600f4583bec89109ce8c0c098951ae?s=128&d=identicon&r=PG", "display_name": "Michal Charemza", "link": "https://stackoverflow.com/users/1319998/michal-charemza"}, "edited": false, "score": 0, "creation_date": 1497646574, "post_id": 44594504, "comment_id": 76184025, "body": "Oh yeah, sorry : <a href=\"https://stackoverflow.com/questions/3903205/how-do-i-maintain-a-server-side-state-with-snap-framework\" title=\"how do i maintain a server side state with snap framework\">stackoverflow.com/questions/3903205/&hellip;</a>"}, {"owner": {"reputation": 13807, "user_id": 2407038, "user_type": "registered", "accept_rate": 64, "profile_image": "https://www.gravatar.com/avatar/538f6f4a9aa43841841de7d8e8b169fc?s=128&d=identicon&r=PG&f=1", "display_name": "user2407038", "link": "https://stackoverflow.com/users/2407038/user2407038"}, "edited": false, "score": 0, "creation_date": 1497672239, "post_id": 44594504, "comment_id": 76189159, "body": "Almost all of the snap functions have return type <code>MonadSnap m =&gt; .. -&gt; m X</code>. So just make an instance <code>MonadSnap m =&gt; MonadSnap (ReaderT m)</code> (if it doesn&#39;t exist already) and you don&#39;t have to explicitly pass the environment around."}], "answers": [{"comments": [{"owner": {"reputation": 825, "user_id": 962828, "user_type": "registered", "accept_rate": 55, "profile_image": "https://www.gravatar.com/avatar/78c370f00a14fb3bd59dc334082378cd?s=128&d=identicon&r=PG", "display_name": "Ulrar", "link": "https://stackoverflow.com/users/962828/ulrar"}, "edited": false, "score": 0, "creation_date": 1497690622, "post_id": 44599258, "comment_id": 76192846, "body": "Allright so basically you need to make your whole app into a Snaplet to get a State, if I understand correctly. Seems to be working, I assume that won&#39;t impact performances since I don&#39;t really use snaplets, just the one ? Not that it matters much in my case, just curious"}, {"owner": {"reputation": 1589, "user_id": 2535671, "user_type": "registered", "accept_rate": 87, "profile_image": "https://www.gravatar.com/avatar/fca1ba52e0c41803e676d449ef242e75?s=128&d=identicon&r=PG&f=1", "display_name": "Julian Leviston", "link": "https://stackoverflow.com/users/2535671/julian-leviston"}, "reply_to_user": {"reputation": 825, "user_id": 962828, "user_type": "registered", "accept_rate": 55, "profile_image": "https://www.gravatar.com/avatar/78c370f00a14fb3bd59dc334082378cd?s=128&d=identicon&r=PG", "display_name": "Ulrar", "link": "https://stackoverflow.com/users/962828/ulrar"}, "edited": false, "score": 0, "creation_date": 1497692704, "post_id": 44599258, "comment_id": 76193451, "body": "My understanding of Snap is, since a certain version, <b>everything</b> is built with snaplets which are the base level abstraction for any application-programmer level concerns. This provides modularity and is very efficient. Lenses are extremely lightweight data access on records which are also extremely basic. Snaplets are, at their core, about state, so this would be the canonical way to get state into your snap application. It&#39;s fast and efficient, from my understanding, but why not do some profiling :)"}], "tags": [], "owner": {"reputation": 1589, "user_id": 2535671, "user_type": "registered", "accept_rate": 87, "profile_image": "https://www.gravatar.com/avatar/fca1ba52e0c41803e676d449ef242e75?s=128&d=identicon&r=PG&f=1", "display_name": "Julian Leviston", "link": "https://stackoverflow.com/users/2535671/julian-leviston"}, "is_accepted": true, "score": 0, "last_activity_date": 1497655724, "creation_date": 1497655724, "answer_id": 44599258, "question_id": 44594504, "link": "https://stackoverflow.com/questions/44594504/how-do-i-store-some-object-on-server-side-with-snap-framework/44599258#44599258", "title": "How do I store some object on server-side with Snap Framework?", "body": "<p>In the section \"Working with State\" in the snaplet tutorial they explain how to work with local state. If you look at the second code piece in the section called \"Snaplet Overview\" above that, you can see how they're setting up the state when they initialise the data type for it, using Lens. </p>\n\n<p>Not sure how familiar you are with these things, but <code>Lens</code> lets you access (ie read/write/adjust) pieces of data within larger values. The entire state of the server in this case is represented as one blob of data (a record type value), which is initialised when the server is.</p>\n\n<p>Note this: <code>_companyName :: IORef B.ByteString</code> &lt;- is a piece of state that you can mutate in the example, and in the section \"Working with state\" that's just what they do. They have an example that takes an HTTP GET or POST to that URL, and either updates it with the new \"name\" param (POST) and returns the new state, or if it's a GET, it just returns the current state.</p>\n"}], "owner": {"reputation": 825, "user_id": 962828, "user_type": "registered", "accept_rate": 55, "profile_image": "https://www.gravatar.com/avatar/78c370f00a14fb3bd59dc334082378cd?s=128&d=identicon&r=PG", "display_name": "Ulrar", "link": "https://stackoverflow.com/users/962828/ulrar"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 56, "favorite_count": 0, "accepted_answer_id": 44599258, "answer_count": 1, "score": 0, "last_activity_date": 1497655724, "creation_date": 1497632588, "question_id": 44594504, "link": "https://stackoverflow.com/questions/44594504/how-do-i-store-some-object-on-server-side-with-snap-framework", "title": "How do I store some object on server-side with Snap Framework?", "body": "<p>That question was already asked in 2010, but I figure there might be a better answer today.\nBasically I need to store some kind of object and access it in every request, ideally I want to be able to change that object from within a request (I guess an MVar or IORef will do for that).</p>\n\n<p>The snaplet tutorial seems to indicate that it's possible, but it mostly explains how to use snaplets (that's what that tutorial is for after all), and doesn't really explain how this \"App\" object works or even is stored. I have no idea how to apply that to my case, where I have no need of snaplets (I'm making an API, so I don't even need Heist).</p>\n\n<p>So given the default code :</p>\n\n<pre><code>site :: Snap ()\nsite = do\n  ifTop (writeBS \"hello world\") &lt;|&gt;\n    route [ (\"stuff/:param\", someHandler) ] &lt;|&gt;\n    dir \"static\" (serveDirectory \".\")\n</code></pre>\n\n<p>How do I change this to \"register\" some object somewhere that I could use in someHandler ? The answer from 2010 is just to partially apply it to every handler, which would work, but the Snaplet tutorial makes me think there must be a better way.</p>\n"}, {"tags": ["haskell"], "comments": [{"owner": {"reputation": 44013, "user_id": 1477667, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/trgKM.jpg?s=128&g=1", "display_name": "dfeuer", "link": "https://stackoverflow.com/users/1477667/dfeuer"}, "edited": false, "score": 1, "creation_date": 1497636603, "post_id": 44592257, "comment_id": 76178968, "body": "This has nothing to do with your question, but you might like to know that you don&#39;t have to indent everything under the <code>module SumProduct where</code>. Just start the next line in column 0 and you can leave all your top-level declarations there."}], "answers": [{"comments": [{"owner": {"reputation": 25967, "user_id": 1743843, "user_type": "registered", "accept_rate": 77, "profile_image": "https://www.gravatar.com/avatar/8ea2c1d9051e40332376a07bc166d9d5?s=128&d=identicon&r=PG&f=1", "display_name": "softshipper", "link": "https://stackoverflow.com/users/1743843/softshipper"}, "edited": false, "score": 0, "creation_date": 1497641039, "post_id": 44592940, "comment_id": 76181320, "body": "What do you mean with the most  <code>most general type</code>, could you please provide an example?"}, {"owner": {"reputation": 1404, "user_id": 5559663, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/sQiE2.gif?s=128&g=1", "display_name": "baxbaxwalanuksiwe", "link": "https://stackoverflow.com/users/5559663/baxbaxwalanuksiwe"}, "reply_to_user": {"reputation": 25967, "user_id": 1743843, "user_type": "registered", "accept_rate": 77, "profile_image": "https://www.gravatar.com/avatar/8ea2c1d9051e40332376a07bc166d9d5?s=128&d=identicon&r=PG&f=1", "display_name": "softshipper", "link": "https://stackoverflow.com/users/1743843/softshipper"}, "edited": false, "score": 0, "creation_date": 1497641753, "post_id": 44592940, "comment_id": 76181711, "body": "What I call the most general type is the type that assumes the less information about the data. For example, when you type a number literal in Haskell, like <code>23</code>, it is inferred to <code>Num a =&gt; a</code>. This is why you can do <code>2 * 0.5</code>: <code>2</code>here is not an <code>Int</code>, but adapts to the right hand side number, which, in this case, is a floating point number."}], "tags": [], "owner": {"reputation": 1404, "user_id": 5559663, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/sQiE2.gif?s=128&g=1", "display_name": "baxbaxwalanuksiwe", "link": "https://stackoverflow.com/users/5559663/baxbaxwalanuksiwe"}, "is_accepted": true, "score": 5, "last_activity_date": 1497626845, "creation_date": 1497626845, "answer_id": 44592940, "question_id": 44592257, "link": "https://stackoverflow.com/questions/44592257/construct-a-type/44592940#44592940", "title": "Construct a type", "body": "<p>By default, Haskell infers the most general type that applies to the expression.</p>\n\n<p>Here, you directly tell GHC what type <code>bess</code> is, so it just checks if the type you provided is valid, but allows it to be more specific than the most general type.</p>\n\n<p>Since you explicitly tell GHC that <code>bess</code> has type <code>Animal'</code> by the <code>::</code> operator (it's a language construct, not an actual operator defined in the standard library), GHC already knows that <code>bess :: Animal'</code>. However, because you didn't provide any type for <code>elmer'</code>, GHC will find the most general type for you.</p>\n\n<p>In this case, the most general type is <code>Sum a SheepInfo</code> because all GHC knows is that the <code>Second</code> constructor takes a <code>SheepInfo</code>, but has no idea of what <code>First</code> should take. Thus, it infers it to a type variable <code>a</code>.</p>\n"}], "owner": {"reputation": 25967, "user_id": 1743843, "user_type": "registered", "accept_rate": 77, "profile_image": "https://www.gravatar.com/avatar/8ea2c1d9051e40332376a07bc166d9d5?s=128&d=identicon&r=PG&f=1", "display_name": "softshipper", "link": "https://stackoverflow.com/users/1743843/softshipper"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 84, "favorite_count": 1, "accepted_answer_id": 44592940, "answer_count": 1, "score": 1, "last_activity_date": 1497626845, "creation_date": 1497624732, "question_id": 44592257, "link": "https://stackoverflow.com/questions/44592257/construct-a-type", "title": "Construct a type", "body": "<p>I have many type declarations:</p>\n\n<pre><code>module SumProduct where\n\n\n  data GuessWhat = Chickenbutt deriving (Eq, Show)\n\n  data Id a = MkId a deriving (Eq, Show)\n\n  data Product a b = Product a b deriving (Eq, Show)\n\n  data Sum a b = First a\n                | Second b\n                deriving (Eq, Show)\n\n  data RecordProduct a b = RecordProduct { pfirst :: a , psecond :: b }\n                          deriving (Eq, Show)\n\n\n  newtype NumCow = NumCow Int deriving (Eq, Show)\n\n  newtype NumPig = NumPig Int deriving (Eq, Show)\n\n  data Farmhouse = Farmhouse NumCow NumPig deriving (Eq, Show)\n  type Farmhouse' = Product NumCow NumPig\n\n\n  newtype NumSheep = NumSheep Int deriving (Eq, Show)\n\n  data BigFarmhouse = BigFarmhouse NumCow NumPig NumSheep deriving (Eq, Show) \n  type BigFarmhouse' = Product NumCow (Product NumPig NumSheep)\n\n  type Name = String\n  type Age = Int\n  type LovesMud = Bool\n\n\n  type PoundsOfWool = Int\n  data CowInfo = CowInfo Name Age\n                 deriving (Eq, Show)\n\n  data PigInfo = PigInfo Name Age LovesMud deriving (Eq, Show)\n\n  data SheepInfo = SheepInfo Name Age PoundsOfWool deriving (Eq, Show)\n\n\n  data Animal = Cow CowInfo \n               | Pig PigInfo\n               | Sheep SheepInfo\n               deriving (Eq, Show)\n\n\n  type Animal' = Sum CowInfo (Sum PigInfo SheepInfo)(Sum PigInfo SheepInfo)\n</code></pre>\n\n<p>And play around in the prelude with:</p>\n\n<pre><code>Prelude&gt; let bess = First (CowInfo \"Bess\" 4) :: Animal'\nPrelude&gt; let elmer' = Second (SheepInfo \"Elmer\" 5 5)\n</code></pre>\n\n<p>How it comes, that the first becomes the type <code>bess :: Animal'</code> and the second <code>elmer' :: Sum a SheepInfo</code>?</p>\n"}, {"tags": ["haskell"], "comments": [{"owner": {"reputation": 3392, "user_id": 7175117, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/Tfz44.png?s=128&g=1", "display_name": "freestyle", "link": "https://stackoverflow.com/users/7175117/freestyle"}, "edited": false, "score": 0, "creation_date": 1497625137, "post_id": 44591833, "comment_id": 76172435, "body": "You can redesign with primitives like this: <code>f arr n s (dx, dy) = take n . map (arr!) . iterate (\\(!y, !x) -&gt; (y + dy, x + dx)) . swap $ s</code>. And can you write your real simple example where your code work too slow?"}, {"owner": {"reputation": 1086, "user_id": 2582462, "user_type": "registered", "accept_rate": 97, "profile_image": "https://www.gravatar.com/avatar/a7ed51223a9aaaea2c4bdf06db7b6eed?s=128&d=identicon&r=PG", "display_name": "andrzej1_1", "link": "https://stackoverflow.com/users/2582462/andrzej1-1"}, "reply_to_user": {"reputation": 3392, "user_id": 7175117, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/Tfz44.png?s=128&g=1", "display_name": "freestyle", "link": "https://stackoverflow.com/users/7175117/freestyle"}, "edited": false, "score": 0, "creation_date": 1497626334, "post_id": 44591833, "comment_id": 76173224, "body": "I get <code>Illegal bang-pattern (use BangPatterns): ! y</code>"}, {"owner": {"reputation": 1086, "user_id": 2582462, "user_type": "registered", "accept_rate": 97, "profile_image": "https://www.gravatar.com/avatar/a7ed51223a9aaaea2c4bdf06db7b6eed?s=128&d=identicon&r=PG", "display_name": "andrzej1_1", "link": "https://stackoverflow.com/users/2582462/andrzej1-1"}, "reply_to_user": {"reputation": 3392, "user_id": 7175117, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/Tfz44.png?s=128&g=1", "display_name": "freestyle", "link": "https://stackoverflow.com/users/7175117/freestyle"}, "edited": false, "score": 0, "creation_date": 1497626808, "post_id": 44591833, "comment_id": 76173573, "body": "I cannot provide simple example, but consider searching patterns in thousands of arrays in gomoku AI. If you fix function I will provide time difference between both functions."}, {"owner": {"reputation": 3392, "user_id": 7175117, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/Tfz44.png?s=128&g=1", "display_name": "freestyle", "link": "https://stackoverflow.com/users/7175117/freestyle"}, "edited": false, "score": 0, "creation_date": 1497627775, "post_id": 44591833, "comment_id": 76174182, "body": "Use extension <code>BangPatterns</code> to avoid compilation error."}, {"owner": {"reputation": 1086, "user_id": 2582462, "user_type": "registered", "accept_rate": 97, "profile_image": "https://www.gravatar.com/avatar/a7ed51223a9aaaea2c4bdf06db7b6eed?s=128&d=identicon&r=PG", "display_name": "andrzej1_1", "link": "https://stackoverflow.com/users/2582462/andrzej1-1"}, "reply_to_user": {"reputation": 3392, "user_id": 7175117, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/Tfz44.png?s=128&g=1", "display_name": "freestyle", "link": "https://stackoverflow.com/users/7175117/freestyle"}, "edited": false, "score": 0, "creation_date": 1497687966, "post_id": 44591833, "comment_id": 76192252, "body": "Getting best move was taking 17 seconds and with your function it takes 18."}, {"owner": {"reputation": 3392, "user_id": 7175117, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/Tfz44.png?s=128&g=1", "display_name": "freestyle", "link": "https://stackoverflow.com/users/7175117/freestyle"}, "edited": false, "score": 0, "creation_date": 1497699064, "post_id": 44591833, "comment_id": 76195324, "body": "I don&#39;t have experience with Data.Array, maybe @Paul Johnson is right. But I have experience with <a href=\"https://www.stackage.org/lts-8.18/package/repa-3.4.1.2\" rel=\"nofollow noreferrer\">repa</a>, it based on vector package, and I recomend it you"}], "answers": [{"comments": [{"owner": {"reputation": 1086, "user_id": 2582462, "user_type": "registered", "accept_rate": 97, "profile_image": "https://www.gravatar.com/avatar/a7ed51223a9aaaea2c4bdf06db7b6eed?s=128&d=identicon&r=PG", "display_name": "andrzej1_1", "link": "https://stackoverflow.com/users/2582462/andrzej1-1"}, "edited": false, "score": 0, "creation_date": 1497689699, "post_id": 44593823, "comment_id": 76192609, "body": "I was looking for a way to optimize function, but if changing Array to unboxed vector help, I will accept your answer. Give me some time to do it."}, {"owner": {"reputation": 16362, "user_id": 49220, "user_type": "registered", "accept_rate": 56, "profile_image": "https://www.gravatar.com/avatar/431cd43aaf713caa80316e852a87a840?s=128&d=identicon&r=PG", "display_name": "Paul Johnson", "link": "https://stackoverflow.com/users/49220/paul-johnson"}, "reply_to_user": {"reputation": 1086, "user_id": 2582462, "user_type": "registered", "accept_rate": 97, "profile_image": "https://www.gravatar.com/avatar/a7ed51223a9aaaea2c4bdf06db7b6eed?s=128&d=identicon&r=PG", "display_name": "andrzej1_1", "link": "https://stackoverflow.com/users/2582462/andrzej1-1"}, "edited": false, "score": 0, "creation_date": 1497698149, "post_id": 44593823, "comment_id": 76195093, "body": "I can&#39;t see anything intrinsically slow about your function, other than its use of Array, and hence lots of unboxed values. One other point is that by going to a 1-d implementation all your moves (N, NE, E etc) can be represented by a single offset, so you only need to do a single addition per step."}, {"owner": {"reputation": 1086, "user_id": 2582462, "user_type": "registered", "accept_rate": 97, "profile_image": "https://www.gravatar.com/avatar/a7ed51223a9aaaea2c4bdf06db7b6eed?s=128&d=identicon&r=PG", "display_name": "andrzej1_1", "link": "https://stackoverflow.com/users/2582462/andrzej1-1"}, "edited": false, "score": 0, "creation_date": 1497709034, "post_id": 44593823, "comment_id": 76198281, "body": "Currently in array I am using own type like <code>data Square =  Cross | Nought | Empty</code> so I can&#39;t just use vector, because it requires <code>Unbox</code> instance. Do you think It would be better to create / derive it or I should change all functions to work on chars?"}, {"owner": {"reputation": 1086, "user_id": 2582462, "user_type": "registered", "accept_rate": 97, "profile_image": "https://www.gravatar.com/avatar/a7ed51223a9aaaea2c4bdf06db7b6eed?s=128&d=identicon&r=PG", "display_name": "andrzej1_1", "link": "https://stackoverflow.com/users/2582462/andrzej1-1"}, "edited": false, "score": 0, "creation_date": 1497729289, "post_id": 44593823, "comment_id": 76204494, "body": "I managed to derive Unbox instance with <code>vector-th-unbox</code> and port program to Vector.Unboxed, but it runs two times slower: <a href=\"https://pastebin.com/7CEWNfFP\" rel=\"nofollow noreferrer\">pastebin.com/7CEWNfFP</a>"}, {"owner": {"reputation": 16362, "user_id": 49220, "user_type": "registered", "accept_rate": 56, "profile_image": "https://www.gravatar.com/avatar/431cd43aaf713caa80316e852a87a840?s=128&d=identicon&r=PG", "display_name": "Paul Johnson", "link": "https://stackoverflow.com/users/49220/paul-johnson"}, "reply_to_user": {"reputation": 1086, "user_id": 2582462, "user_type": "registered", "accept_rate": 97, "profile_image": "https://www.gravatar.com/avatar/a7ed51223a9aaaea2c4bdf06db7b6eed?s=128&d=identicon&r=PG", "display_name": "andrzej1_1", "link": "https://stackoverflow.com/users/2582462/andrzej1-1"}, "edited": false, "score": 0, "creation_date": 1497788788, "post_id": 44593823, "comment_id": 76216135, "body": "Hard to say more without looking at the code. Are you compiling with optimisation on?"}, {"owner": {"reputation": 1086, "user_id": 2582462, "user_type": "registered", "accept_rate": 97, "profile_image": "https://www.gravatar.com/avatar/a7ed51223a9aaaea2c4bdf06db7b6eed?s=128&d=identicon&r=PG", "display_name": "andrzej1_1", "link": "https://stackoverflow.com/users/2582462/andrzej1-1"}, "edited": false, "score": 0, "creation_date": 1497791942, "post_id": 44593823, "comment_id": 76216958, "body": "I am using only <code>-O2</code> option. If you tell me your bitbucket username I will give you access to private repository."}, {"owner": {"reputation": 1086, "user_id": 2582462, "user_type": "registered", "accept_rate": 97, "profile_image": "https://www.gravatar.com/avatar/a7ed51223a9aaaea2c4bdf06db7b6eed?s=128&d=identicon&r=PG", "display_name": "andrzej1_1", "link": "https://stackoverflow.com/users/2582462/andrzej1-1"}, "edited": false, "score": 0, "creation_date": 1497820440, "post_id": 44593823, "comment_id": 76224988, "body": "I made repository public: <a href=\"https://bitbucket.org/andrzej1_1/gomoku/src/93ac3ed553c0869c63f768562369bbebee2fb55a?at=vector.unboxed\" rel=\"nofollow noreferrer\">bitbucket.org/andrzej1_1/gomoku/src/&hellip;</a> Could you check the code?"}, {"owner": {"reputation": 16362, "user_id": 49220, "user_type": "registered", "accept_rate": 56, "profile_image": "https://www.gravatar.com/avatar/431cd43aaf713caa80316e852a87a840?s=128&d=identicon&r=PG", "display_name": "Paul Johnson", "link": "https://stackoverflow.com/users/49220/paul-johnson"}, "reply_to_user": {"reputation": 1086, "user_id": 2582462, "user_type": "registered", "accept_rate": 97, "profile_image": "https://www.gravatar.com/avatar/a7ed51223a9aaaea2c4bdf06db7b6eed?s=128&d=identicon&r=PG", "display_name": "andrzej1_1", "link": "https://stackoverflow.com/users/2582462/andrzej1-1"}, "edited": false, "score": 0, "creation_date": 1497891900, "post_id": 44593823, "comment_id": 76258159, "body": "Having taken a quick look, I see that the movement through the board is still being done by tracking x and y separately. However in an nxm board held in a 1-d vector you can reduce the move in any direction to a single addition: a horizontal move is +/-1 and a vertical move is +/-m (and likewise for diagonal). You also have a lot of small functions, which is good style, but perhaps judicious use of the INLINE pragma might help. The profile you posted has a lot of Vector fusion binds in it, which suggests that the optimiser isn&#39;t able to fuse your operations into single loops for some reason."}], "tags": [], "owner": {"reputation": 16362, "user_id": 49220, "user_type": "registered", "accept_rate": 56, "profile_image": "https://www.gravatar.com/avatar/431cd43aaf713caa80316e852a87a840?s=128&d=identicon&r=PG", "display_name": "Paul Johnson", "link": "https://stackoverflow.com/users/49220/paul-johnson"}, "is_accepted": true, "score": 1, "last_activity_date": 1497630084, "creation_date": 1497630084, "answer_id": 44593823, "question_id": 44591833, "link": "https://stackoverflow.com/questions/44591833/get-n-elements-from-2d-array-at-specified-coordinates-and-direction/44593823#44593823", "title": "Get n elements from 2D Array at specified coordinates and direction", "body": "<p><code>Array</code> is slow, so your first step should be to port to the <a href=\"https://hackage.haskell.org/package/vector\" rel=\"nofollow noreferrer\">vector package</a>. Use the unboxed variant, as the default \"boxed\" representation allocates heap storage for each value and stores a pointer to it. There is no such thing as a 2-d vector so you will have to write code to transform your coordinate pairs into locations in a 1-d vector. If that still isn't fast enough then access using the <code>unsafeIndex</code> function and its relatives, which don't do bounds checking (but do not call up that which you <a href=\"http://www.dagonbytes.com/thelibrary/lovecraft/thecaseofcharlesdexterward.htm\" rel=\"nofollow noreferrer\">cannot put down</a>).</p>\n\n<p>See also <a href=\"https://stackoverflow.com/questions/9611904/haskell-lists-arrays-vectors-sequences\">this question</a>.</p>\n"}], "owner": {"reputation": 1086, "user_id": 2582462, "user_type": "registered", "accept_rate": 97, "profile_image": "https://www.gravatar.com/avatar/a7ed51223a9aaaea2c4bdf06db7b6eed?s=128&d=identicon&r=PG", "display_name": "andrzej1_1", "link": "https://stackoverflow.com/users/2582462/andrzej1-1"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 398, "favorite_count": 0, "accepted_answer_id": 44593823, "answer_count": 1, "score": 0, "last_activity_date": 1497630084, "creation_date": 1497623443, "question_id": 44591833, "link": "https://stackoverflow.com/questions/44591833/get-n-elements-from-2d-array-at-specified-coordinates-and-direction", "title": "Get n elements from 2D Array at specified coordinates and direction", "body": "<p>I have array of x,y coordinates and char elements. I need function to get list of n chars at specified coordinates toward direction. I wrote it in recurrent way:</p>\n\n<pre><code>import Data.Array\n\nexampleArray = array ((1,1),(2,2)) [((1,1),'a'), ((1,2),'b'), ((2,1),'c'), ((2,2),'d')]\n--       1   2  \n--     +---+---+\n--   1 | a | b |\n--     +---+---+\n--   2 | c | d |\n--     +---+---+\n\nf :: Array (Int, Int) Char -&gt; Int -&gt; (Int, Int) -&gt; (Int, Int) -&gt; [Char]\nf _ 0 _ _ = []\nf arr n (x,y) (dirX, dirY) = (arr ! (y,x)) : f arr (n-1) (x+dirX,y+dirY) (dirX, dirY)\n\n-- ac\nlist = f exampleArray 2 (1,1) (0,1) -- get 2 chars from array at 1,1 toward E\n\n-- cb\nlist2 = f exampleArray 2 (1,2) (1,(-1)) -- get 2 chars from array at 1,2 toward NE\n</code></pre>\n\n<p>It works, but it is too slow and I am wondering how to optimize it? </p>\n"}, {"tags": ["haskell", "haskell-stack", "criterion"], "answers": [{"tags": [], "owner": {"reputation": 24509, "user_id": 6863749, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/UyoQv.jpg?s=128&g=1", "display_name": "Li-yao Xia", "link": "https://stackoverflow.com/users/6863749/li-yao-xia"}, "is_accepted": true, "score": 4, "last_activity_date": 1497623092, "creation_date": 1497623092, "answer_id": 44591715, "question_id": 44591382, "link": "https://stackoverflow.com/questions/44591382/passing-command-line-arguments-to-the-benhmark-program-using-stack/44591715#44591715", "title": "Passing command line arguments to the benhmark program using stack", "body": "<pre><code>stack bench --benchmark-arguments \"--arguments --for --criterion\"\n</code></pre>\n\n<p>(It's among options listed under <code>stack bench --help</code>.)</p>\n"}], "owner": {"reputation": 4593, "user_id": 2289983, "user_type": "registered", "accept_rate": 92, "profile_image": "https://i.stack.imgur.com/LG4hj.jpg?s=128&g=1", "display_name": "Damian Nadales", "link": "https://stackoverflow.com/users/2289983/damian-nadales"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 185, "favorite_count": 1, "accepted_answer_id": 44591715, "answer_count": 1, "score": 3, "last_activity_date": 1497623092, "creation_date": 1497622123, "question_id": 44591382, "link": "https://stackoverflow.com/questions/44591382/passing-command-line-arguments-to-the-benhmark-program-using-stack", "title": "Passing command line arguments to the benhmark program using stack", "body": "<p>I'm using <a href=\"https://docs.haskellstack.org/en/stable/README/\" rel=\"nofollow noreferrer\">stack</a> as a build tool, and <a href=\"http://www.serpentine.com/criterion/\" rel=\"nofollow noreferrer\">criterion</a> as benchmarking library. To run the benchmarks I execute the following command:</p>\n\n<pre><code>stack bench\n</code></pre>\n\n<p>Criterion accepts command line arguments to specify where the output should be written to. I would like to pass these arguments to the executable built and run by <code>stack</code>. Is there a way to achieve this?</p>\n"}, {"tags": ["haskell", "typeclass"], "answers": [{"comments": [{"owner": {"reputation": 5481, "user_id": 2913106, "user_type": "registered", "accept_rate": 74, "profile_image": "https://i.stack.imgur.com/cM7Yq.jpg?s=128&g=1", "display_name": "flawr", "link": "https://stackoverflow.com/users/2913106/flawr"}, "edited": false, "score": 0, "creation_date": 1497620120, "post_id": 44590567, "comment_id": 76168783, "body": "So without enabling <code>FlexibleInstances</code> I can only implmenent <code>show</code> for whole typeclasses, but not for specific types?"}, {"owner": {"reputation": 12035, "user_id": 603094, "user_type": "registered", "accept_rate": 70, "profile_image": "https://www.gravatar.com/avatar/325af9a946cb4337c6640f0e95044be1?s=128&d=identicon&r=PG", "display_name": "kirelagin", "link": "https://stackoverflow.com/users/603094/kirelagin"}, "reply_to_user": {"reputation": 5481, "user_id": 2913106, "user_type": "registered", "accept_rate": 74, "profile_image": "https://i.stack.imgur.com/cM7Yq.jpg?s=128&g=1", "display_name": "flawr", "link": "https://stackoverflow.com/users/2913106/flawr"}, "edited": false, "score": 0, "creation_date": 1497620309, "post_id": 44590567, "comment_id": 76168916, "body": "For a type constructor (e.g. your <code>MyList :: * -&gt; *</code>) you can only implement classes (e.g. <code>Show</code>) only for the whole \u201cfamily of types\u201d of the form <code>MyList a</code> at once, not for specific individuals like <code>MyList String</code> or <code>MyList Bool</code>."}, {"owner": {"reputation": 12035, "user_id": 603094, "user_type": "registered", "accept_rate": 70, "profile_image": "https://www.gravatar.com/avatar/325af9a946cb4337c6640f0e95044be1?s=128&d=identicon&r=PG", "display_name": "kirelagin", "link": "https://stackoverflow.com/users/603094/kirelagin"}, "reply_to_user": {"reputation": 5481, "user_id": 2913106, "user_type": "registered", "accept_rate": 74, "profile_image": "https://i.stack.imgur.com/cM7Yq.jpg?s=128&g=1", "display_name": "flawr", "link": "https://stackoverflow.com/users/2913106/flawr"}, "edited": false, "score": 0, "creation_date": 1497620515, "post_id": 44590567, "comment_id": 76169059, "body": "By the way, this is exactly the reason why <code>Show</code> has the hacky <a href=\"https://hackage.haskell.org/package/base-4.9.1.0/docs/Prelude.html#v:showList\" rel=\"nofollow noreferrer\"><code>showList</code></a> method. You want to show lists of <code>Char</code> differently from the lists of all the other types, but you can\u2019t just implement a separate <code>Show [Char]</code> instance in standard Haskell."}], "tags": [], "owner": {"reputation": 12035, "user_id": 603094, "user_type": "registered", "accept_rate": 70, "profile_image": "https://www.gravatar.com/avatar/325af9a946cb4337c6640f0e95044be1?s=128&d=identicon&r=PG", "display_name": "kirelagin", "link": "https://stackoverflow.com/users/603094/kirelagin"}, "is_accepted": true, "score": 3, "last_activity_date": 1497620228, "last_edit_date": 1497620228, "creation_date": 1497619967, "answer_id": 44590567, "question_id": 44590358, "link": "https://stackoverflow.com/questions/44590358/instance-for-concrete-type-instead-of-typeclass/44590567#44590567", "title": "`instance` for concrete type instead of typeclass?", "body": "<p>The error is telling you that standard Haskell does not allow this kind of instance definitions. Exactly as it says,</p>\n\n<pre class=\"lang-none prettyprint-override\"><code>All instance types must be of the form (T a1 ... an)\nwhere a1 ... an are *distinct type variables*,\nand each type variable appears at most once in the instance head.\n</code></pre>\n\n<p>One of the reasons is that in case you leave <em>both</em> of your instance definitions, the compiler will not know which one to choose for <code>MyList String</code>, as they both match. (You might also want to have a look at the <a href=\"https://downloads.haskell.org/~ghc/latest/docs/html/users_guide/glasgow_exts.html#instance-overlap\" rel=\"nofollow noreferrer\">rules for overlapping instances</a>.)</p>\n\n<p>Having this constraint on the form of instance types guarantees that typechecking will always terminate, and while there are of course valid and typecheckable programs with instances not of this form, that is just how it works: some restrictions in Haskell are conservative.</p>\n\n<p>In your particular case just doing what the compiler suggests (i.e. enabling <code>FlexibleInstances</code>) will do the trick and this extension is safe in terms of termination.</p>\n"}], "owner": {"reputation": 5481, "user_id": 2913106, "user_type": "registered", "accept_rate": 74, "profile_image": "https://i.stack.imgur.com/cM7Yq.jpg?s=128&g=1", "display_name": "flawr", "link": "https://stackoverflow.com/users/2913106/flawr"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 165, "favorite_count": 0, "accepted_answer_id": 44590567, "answer_count": 1, "score": 2, "last_activity_date": 1497620228, "creation_date": 1497619343, "question_id": 44590358, "link": "https://stackoverflow.com/questions/44590358/instance-for-concrete-type-instead-of-typeclass", "title": "`instance` for concrete type instead of typeclass?", "body": "<p>I defined a simple list type:</p>\n\n<pre><code>data MyList a = End\n               |Entry a (MyList a)\n</code></pre>\n\n<p>Instead of <code>deriving (Show)</code> I implemented that explicitly myself for all <code>MyList a</code> where <code>a</code> is an instance of <code>Show</code>.</p>\n\n<pre><code>instance Show a =&gt; Show (MyList a)\n  where show End = \"\"\n        show (Entry a l) = (show a) ++\",\"++(show l)\n</code></pre>\n\n<p>This works perfectly fine. Now I wanted to change that such that only <code>MyList String</code> is an instance of <code>Show</code> and to do so I wrote</p>\n\n<pre><code>instance Show (MyList String)\n  where show End = \"\"\n        show (Entry a l) = a ++\",\"++(show l)\n</code></pre>\n\n<p>But this resulted in an error, that I do not understand:</p>\n\n<pre><code>Illegal instance declaration for `Show (MyList String)'\n  (All instance types must be of the form (T a1 ... an)\n   where a1 ... an are *distinct type variables*,\n   and each type variable appears at most once in the instance head.\n   Use FlexibleInstances if you want to disable this.)\nIn the instance declaration for `Show (MyList String)'\n</code></pre>\n\n<p>Can anyone explain why this will not work and what this error is telling me?</p>\n"}, {"tags": ["algorithm", "haskell", "runtime", "combinatorics"], "comments": [{"owner": {"reputation": 314794, "user_id": 67579, "user_type": "registered", "accept_rate": 81, "profile_image": "https://i.stack.imgur.com/BJXub.png?s=128&g=1", "display_name": "Willem Van Onsem", "link": "https://stackoverflow.com/users/67579/willem-van-onsem"}, "edited": false, "score": 0, "creation_date": 1497617963, "post_id": 44589845, "comment_id": 76167364, "body": "Is this project Euler? That&#39;s not a problem :) only asking."}, {"owner": {"reputation": 271, "user_id": 3727064, "user_type": "registered", "accept_rate": 50, "profile_image": "https://graph.facebook.com/685893932/picture?type=large", "display_name": "Amoz", "link": "https://stackoverflow.com/users/3727064/amoz"}, "reply_to_user": {"reputation": 314794, "user_id": 67579, "user_type": "registered", "accept_rate": 81, "profile_image": "https://i.stack.imgur.com/BJXub.png?s=128&g=1", "display_name": "Willem Van Onsem", "link": "https://stackoverflow.com/users/67579/willem-van-onsem"}, "edited": false, "score": 0, "creation_date": 1497617993, "post_id": 44589845, "comment_id": 76167385, "body": "Kattis:) <a href=\"https://open.kattis.com/problems/nine\" rel=\"nofollow noreferrer\">open.kattis.com/problems/nine</a>"}, {"owner": {"reputation": 18798, "user_id": 4543207, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/8ed6f11c827fa7cef811f141a84cc14b?s=128&d=identicon&r=PG&f=1", "display_name": "Redu", "link": "https://stackoverflow.com/users/4543207/redu"}, "edited": false, "score": 1, "creation_date": 1497618554, "post_id": 44589845, "comment_id": 76167733, "body": "I have a strange feeling like using base 9 instead of base 10 might be a way to start..."}, {"owner": {"reputation": 21989, "user_id": 715269, "user_type": "registered", "accept_rate": 60, "profile_image": "https://www.gravatar.com/avatar/81265cf97af6195bd098512acbf47d03?s=128&d=identicon&r=PG", "display_name": "Gangnus", "link": "https://stackoverflow.com/users/715269/gangnus"}, "reply_to_user": {"reputation": 18798, "user_id": 4543207, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/8ed6f11c827fa7cef811f141a84cc14b?s=128&d=identicon&r=PG&f=1", "display_name": "Redu", "link": "https://stackoverflow.com/users/4543207/redu"}, "edited": false, "score": 0, "creation_date": 1497619724, "post_id": 44589845, "comment_id": 76168495, "body": "Yes. @Redu is absolutely right. It is NOT a SW problem, it is an arithmetical problem. N=9^d. That is all. BTW, not NUMBER  9? but DIGIT 9."}], "answers": [{"comments": [{"owner": {"reputation": 271, "user_id": 3727064, "user_type": "registered", "accept_rate": 50, "profile_image": "https://graph.facebook.com/685893932/picture?type=large", "display_name": "Amoz", "link": "https://stackoverflow.com/users/3727064/amoz"}, "edited": false, "score": 1, "creation_date": 1497620139, "post_id": 44590072, "comment_id": 76168798, "body": "Wow! Thank you for the great answer. I learned a lot of new things"}], "tags": [], "owner": {"reputation": 314794, "user_id": 67579, "user_type": "registered", "accept_rate": 81, "profile_image": "https://i.stack.imgur.com/BJXub.png?s=128&g=1", "display_name": "Willem Van Onsem", "link": "https://stackoverflow.com/users/67579/willem-van-onsem"}, "is_accepted": true, "score": 5, "last_activity_date": 1497619848, "last_edit_date": 1497619848, "creation_date": 1497618528, "answer_id": 44590072, "question_id": 44589845, "link": "https://stackoverflow.com/questions/44589845/improve-runtime-of-counting-appearances-with-combinatorics/44590072#44590072", "title": "Improve runtime of counting appearances with combinatorics", "body": "<p>I think what the site wants to see, is that you grasp the concept of <em>modulo over multiplication</em>. It holds that:</p>\n\n<pre><code>(a * b) mod c == ((a mod c) * (b mod c)) mod c\n</code></pre>\n\n<p>Furthermore they did not choose <code>10^9+7</code> <em>arbitrarily</em>: it is - as far as I know - a huge prime number than can be represented by an 32-bit integer. As a result we can do <strong>all calculus with <code>Int32</code></strong>, which is faster than working with <code>Integer</code> (that has arbitrary precision).</p>\n\n<h1>Multiplication approach (less efficient)</h1>\n\n<p>As a result, we can make our own <code>mulmod</code> function:</p>\n\n<pre><code>mulmod :: Int32 -&gt; Int32 -&gt; Int32 -&gt; Int32\nmulmod m a b = mod (a*b) m\n</code></pre>\n\n<p>Now we can calculate the number modulo <code>m</code> with:</p>\n\n<pre><code>solvemod :: Int32 -&gt; Int -&gt; Int32\nsolvemod m d = foldl (mulmod m) 8 (replicate (d-1) 9)\n</code></pre>\n\n<p>And then the problem can be solved with:</p>\n\n<pre><code>solve :: Int -&gt; Int32\nsolve = solvemod (10^9+7)\n</code></pre>\n\n<p>For the given sample input it results in:</p>\n\n<pre><code>Prelude&gt; solve 1\n8\nPrelude&gt; solve 2\n72\nPrelude&gt; solve 100\n343393926\n</code></pre>\n\n<p>Which is - according to the website - correct.</p>\n\n<h1>Power approach</h1>\n\n<p>Nevertheless it is still inefficient. We can define a <code>powmod</code> like:</p>\n\n<pre><code>powmod :: Integral i =&gt; Int64 -&gt; Int64 -&gt; i -&gt; Int64\npowmod m = powmod'\n    where powmod' _ 0 = 1\n          powmod' a i | even i = rec\n                      | otherwise = mod (a*rec) m\n              where rec = powmod' (mod (a*a) m) (div i 2)\n</code></pre>\n\n<p>Then the <code>solve</code> mechanism is:</p>\n\n<pre><code>solve :: Integral i =&gt; i -&gt; Int64\nsolve d = mod (8 * powmod m 9 (d-1)) m\n    where m = 10^9+7\n</code></pre>\n\n<p>Again resulting in:</p>\n\n<pre><code>*Main&gt; solve 1\n8\n*Main&gt; solve 2\n72\n*Main&gt; solve 100\n343393926\n*Main&gt; solve (10^18)\n303706813\n</code></pre>\n\n<p>The last query took only a few milliseconds, so I guess this is efficient enough. I submitted the last approach to Kattis, and got:</p>\n\n<blockquote>\n  <p>15:29:31 \"I Hate The Number Nine\"    Accepted    0.01 s  Haskell</p>\n</blockquote>\n\n<p>So it took only 0.01s to calculate the testcases.</p>\n"}, {"tags": [], "owner": {"reputation": 18798, "user_id": 4543207, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/8ed6f11c827fa7cef811f141a84cc14b?s=128&d=identicon&r=PG&f=1", "display_name": "Redu", "link": "https://stackoverflow.com/users/4543207/redu"}, "is_accepted": false, "score": 2, "last_activity_date": 1497627051, "creation_date": 1497627051, "answer_id": 44593005, "question_id": 44589845, "link": "https://stackoverflow.com/questions/44589845/improve-runtime-of-counting-appearances-with-combinatorics/44593005#44593005", "title": "Improve runtime of counting appearances with combinatorics", "body": "<p>Yes this is simply an arithmetic problem which can easily be handled in base 9 since we will drop only one number character. If you don't want to use  2 number characters such as I don't want 9 and 4 then you shall go with base 8. So my solution would be;</p>\n\n<pre><code>solve :: Int -&gt; Integer\nsolve n = (8*9^(n-1)) `mod` (10^9 + 7)\n\n*Main&gt; solve 1\n8\n*Main&gt; solve 2\n72\n*Main&gt; solve 100\n343393926\n</code></pre>\n"}], "owner": {"reputation": 271, "user_id": 3727064, "user_type": "registered", "accept_rate": 50, "profile_image": "https://graph.facebook.com/685893932/picture?type=large", "display_name": "Amoz", "link": "https://stackoverflow.com/users/3727064/amoz"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 150, "favorite_count": 0, "accepted_answer_id": 44590072, "answer_count": 2, "score": 2, "last_activity_date": 1497627051, "creation_date": 1497617915, "question_id": 44589845, "link": "https://stackoverflow.com/questions/44589845/improve-runtime-of-counting-appearances-with-combinatorics", "title": "Improve runtime of counting appearances with combinatorics", "body": "<p>I want to count how many d digit numbers does not include the number 9, and since it can be big, output it modulo 10^9 + 7.</p>\n\n<p>Im running the following code t times, on up to 10^18 digit numbers, which I guess the solve function should take care of easily, right? So then it is perhaps the reading or printing that takes a lot of time.</p>\n\n<p>Any tips how to speed this up? </p>\n\n<pre><code>main = do\n    contents &lt;- getContents\n    let (t:ds) = (map read . words) contents\n    let ans = map solve ds\n    sequence_ (map print ans)\n\nsolve :: Integer -&gt; Integer\nsolve ds = mod (8 * 9^(ds - 1)) (10^9 + 7)\n</code></pre>\n"}, {"tags": ["haskell", "haskell-stack"], "comments": [{"owner": {"reputation": 2334, "user_id": 2397162, "user_type": "registered", "accept_rate": 61, "profile_image": "https://www.gravatar.com/avatar/665b976c79d0c9c842b131a2df510c3c?s=128&d=identicon&r=PG", "display_name": "niceman", "link": "https://stackoverflow.com/users/2397162/niceman"}, "edited": false, "score": 0, "creation_date": 1497614764, "post_id": 44588809, "comment_id": 76165267, "body": "can you show us the error without <code>-v</code> ? I suspect you&#39;re talking about the linker errors but I want to be sure"}], "answers": [{"tags": [], "owner": {"reputation": 3587, "user_id": 7824574, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/a639be4c9ecc139065fbc6b12b87e6a9?s=128&d=identicon&r=PG&f=1", "display_name": "typetetris", "link": "https://stackoverflow.com/users/7824574/typetetris"}, "is_accepted": true, "score": 3, "last_activity_date": 1497632723, "creation_date": 1497632723, "answer_id": 44594546, "question_id": 44588809, "link": "https://stackoverflow.com/questions/44588809/resolving-stack-linker-error/44594546#44594546", "title": "Resolving Stack Linker Error", "body": "<p>Because of the paths <code>/Users/</code> I guess you are using MacOS.</p>\n\n<p>Looking at</p>\n\n<p><a href=\"https://github.com/haskell/haskell-platform/issues/74\" rel=\"nofollow noreferrer\">https://github.com/haskell/haskell-platform/issues/74</a></p>\n\n<p>it seems like the code is compiled against the header file of\none version of libiconv and linked against another incompatible version\nof libiconv.</p>\n\n<p>you could probably try the solution suggested there and add the ghc option</p>\n\n<pre><code>--extra-lib-dirs=/usr/lib\n</code></pre>\n\n<p>Also take a look at</p>\n\n<p><a href=\"https://ghc.haskell.org/trac/ghc/ticket/4068\" rel=\"nofollow noreferrer\">https://ghc.haskell.org/trac/ghc/ticket/4068</a></p>\n"}], "owner": {"reputation": 37991, "user_id": 409976, "user_type": "registered", "accept_rate": 68, "profile_image": "https://www.gravatar.com/avatar/9ccda0b49cc974197399eae01ebd6850?s=128&d=identicon&r=PG", "display_name": "Kevin Meredith", "link": "https://stackoverflow.com/users/409976/kevin-meredith"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 253, "favorite_count": 0, "accepted_answer_id": 44594546, "answer_count": 1, "score": 0, "last_activity_date": 1497632723, "creation_date": 1497614545, "question_id": 44588809, "link": "https://stackoverflow.com/questions/44588809/resolving-stack-linker-error", "title": "Resolving Stack Linker Error", "body": "<p>What's the meaning of this stack output error?</p>\n\n<pre><code>$stack build -v\n...\n2017-06-16 07:59:19.792336: [info] Linking .stack-work/dist/x86_64-osx/Cabal-1.24.2.0/build/my-project/my-project ...\n@(Stack/Build/Execute.hs:1070:67)\n2017-06-16 07:59:22.457898: [warn] Undefined symbols for architecture x86_64:\n@(Stack/Build/Execute.hs:1070:67)\n2017-06-16 07:59:22.458019: [warn]   \"_iconv\", referenced from:\n@(Stack/Build/Execute.hs:1070:67)\n2017-06-16 07:59:22.483052: [warn]       _hs_iconv in libHSbase-4.9.1.0.a(iconv.o)\n@(Stack/Build/Execute.hs:1070:67)\n2017-06-16 07:59:22.558523: [warn]      (maybe you meant: _hs_iconv, _base_GHCziIOziEncodingziIconv_iconvEncoding5_closure , _base_GHCziIOziEncodingziIconv_iconvEncoding10_info , _base_GHCziIOziEncodingziIconv_iconvEncodingzuloc_closure , _base_GHCziIOziEncodingziIconv_iconvEncodingzuloc1_closure , _base_GHCziIOziEncodingziIconv_iconvEncoding7_info , _base_GHCziIOziEncodingziIconv_iconvEncoding4_info , _base_GHCziIOziEncodingziIconv_iconvEncoding11_info , _base_GHCziIOziEncodingziIconv_iconvEncoding8_closure , _base_GHCziIOziEncodingziIconv_iconvEncoding11_closure , _base_GHCziIOziEncodingziIconv_iconvEncoding2_closure , _base_GHCziIOziEncodingziIconv_iconvEncoding2_info , _base_GHCziIOziEncodingziIconv_iconvEncoding9_info , _base_GHCziIOziEncodingziIconv_iconvEncoding9_closure , _hs_iconv_open , _base_GHCziIOziEncodingziIconv_iconvEncodingzuloc_info , _base_GHCziIOziEncodingziIconv_iconvEncodingzuloc1_info , _base_GHCziIOziEncodingziIconv_iconvEncoding3_closure , _base_GHCziIOziEncodingziIconv_iconvEncoding8_info , _hs_iconv_close , _base_GHCziIOziEncodingziIconv_iconvEncoding10_closure , _base_GHCziIOziEncodingziIconv_iconvEncoding7_closure , _base_GHCziIOziEncodingziIconv_iconvEncoding4_closure )\n@(Stack/Build/Execute.hs:1070:67)\n2017-06-16 07:59:22.558678: [warn]   \"_iconv_close\", referenced from:\n@(Stack/Build/Execute.hs:1070:67)\n2017-06-16 07:59:22.584378: [warn]       _hs_iconv_close in libHSbase-4.9.1.0.a(iconv.o)\n@(Stack/Build/Execute.hs:1070:67)\n2017-06-16 07:59:22.659175: [warn]      (maybe you meant: _hs_iconv_close)\n@(Stack/Build/Execute.hs:1070:67)\n2017-06-16 07:59:22.659322: [warn]   \"_iconv_open\", referenced from:\n@(Stack/Build/Execute.hs:1070:67)\n2017-06-16 07:59:22.684266: [warn]       _hs_iconv_open in libHSbase-4.9.1.0.a(iconv.o)\n@(Stack/Build/Execute.hs:1070:67)\n2017-06-16 07:59:22.760039: [warn]      (maybe you meant: _hs_iconv_open)\n@(Stack/Build/Execute.hs:1070:67)\n2017-06-16 07:59:22.760166: [warn]   \"_locale_charset\", referenced from:\n@(Stack/Build/Execute.hs:1070:67)\n2017-06-16 07:59:22.774056: [warn]       _localeEncoding in libHSbase-4.9.1.0.a(PrelIOUtils.o)\n@(Stack/Build/Execute.hs:1070:67)\n2017-06-16 07:59:22.911418: [warn] ld: symbol(s) not found for architecture x86_64\n@(Stack/Build/Execute.hs:1070:67)\n2017-06-16 07:59:22.930402: [warn] clang: error: linker command failed with exit code 1 (use -v to see invocation)\n@(Stack/Build/Execute.hs:1070:67)\n2017-06-16 07:59:22.931503: [warn] `gcc' failed in phase `Linker'. (Exit code: 1)\n@(Stack/Build/Execute.hs:1070:67)\n2017-06-16 07:59:22.961835: [debug] Start: getPackageFiles /Users/kevinmeredith/Workspace/my-project-group/HS/my-project.cabal\n@(Stack/Package.hs:251:21)\n2017-06-16 07:59:23.011242: [debug] Finished in 49ms: getPackageFiles /Users/kevinmeredith/Workspace/my-project-group/HS/my-project.cabal\n@(Stack/Package.hs:251:21)\n2017-06-16 07:59:23.016261: [debug] Encoding /Users/kevinmeredith/Workspace/my-project-group/HS/.stack-work/dist/x86_64-osx/Cabal-1.24.2.0/stack-build-cache\n@(Data/Store/VersionTagged.hs:51:5)\n2017-06-16 07:59:23.017031: [debug] Finished writing /Users/kevinmeredith/Workspace/my-project-group/HS/.stack-work/dist/x86_64-osx/Cabal-1.24.2.0/stack-build-cache\n@(Data/Store/VersionTagged.hs:55:5)\n</code></pre>\n\n<p>Also, how can I fix it?</p>\n"}, {"tags": ["haskell"], "comments": [{"owner": {"reputation": 208473, "user_id": 126014, "user_type": "registered", "accept_rate": 86, "profile_image": "https://www.gravatar.com/avatar/33526616d4a11f1630d4939b769cfbf9?s=128&d=identicon&r=PG", "display_name": "Mark Seemann", "link": "https://stackoverflow.com/users/126014/mark-seemann"}, "edited": false, "score": 0, "creation_date": 1497616184, "post_id": 44588439, "comment_id": 76166214, "body": "As posted here, the code doesn&#39;t compile, although not with the error message reported in the OP. Please repost the code, ensuring that formatting is correct, as Haskell uses significant whitespace."}, {"owner": {"reputation": 517, "user_id": 6169343, "user_type": "registered", "accept_rate": 50, "profile_image": "https://www.gravatar.com/avatar/bf35274d8dc610e79b42ee2a07828669?s=128&d=identicon&r=PG&f=1", "display_name": "Czarek", "link": "https://stackoverflow.com/users/6169343/czarek"}, "reply_to_user": {"reputation": 208473, "user_id": 126014, "user_type": "registered", "accept_rate": 86, "profile_image": "https://www.gravatar.com/avatar/33526616d4a11f1630d4939b769cfbf9?s=128&d=identicon&r=PG", "display_name": "Mark Seemann", "link": "https://stackoverflow.com/users/126014/mark-seemann"}, "edited": false, "score": 0, "creation_date": 1497617748, "post_id": 44588439, "comment_id": 76167227, "body": "@MarkSeemann Thank you for mentioning that. Now it should compile correctly."}, {"owner": {"reputation": 208473, "user_id": 126014, "user_type": "registered", "accept_rate": 86, "profile_image": "https://www.gravatar.com/avatar/33526616d4a11f1630d4939b769cfbf9?s=128&d=identicon&r=PG", "display_name": "Mark Seemann", "link": "https://stackoverflow.com/users/126014/mark-seemann"}, "edited": false, "score": 0, "creation_date": 1497617911, "post_id": 44588439, "comment_id": 76167332, "body": "Indeed, it now compiles. This, however, also means that it doesn&#39;t produce the reported compiler error."}, {"owner": {"reputation": 517, "user_id": 6169343, "user_type": "registered", "accept_rate": 50, "profile_image": "https://www.gravatar.com/avatar/bf35274d8dc610e79b42ee2a07828669?s=128&d=identicon&r=PG&f=1", "display_name": "Czarek", "link": "https://stackoverflow.com/users/6169343/czarek"}, "reply_to_user": {"reputation": 208473, "user_id": 126014, "user_type": "registered", "accept_rate": 86, "profile_image": "https://www.gravatar.com/avatar/33526616d4a11f1630d4939b769cfbf9?s=128&d=identicon&r=PG", "display_name": "Mark Seemann", "link": "https://stackoverflow.com/users/126014/mark-seemann"}, "edited": false, "score": 0, "creation_date": 1497618161, "post_id": 44588439, "comment_id": 76167489, "body": "I did not mean, that it produces a compile error. I meant, that after compiling, when I would like to type <code>getFirst plaster2</code> in <code>WinGhci</code> I receive <code>Variable not in scope:plaster2</code>."}, {"owner": {"reputation": 13734, "user_id": 938694, "user_type": "registered", "accept_rate": 59, "profile_image": "https://www.gravatar.com/avatar/b6678a430a805dd78366d6e135b49f2d?s=128&d=identicon&r=PG", "display_name": "Cubic", "link": "https://stackoverflow.com/users/938694/cubic"}, "edited": false, "score": 2, "creation_date": 1497619168, "post_id": 44588439, "comment_id": 76168150, "body": "@Czarek That would be because <code>plaster2</code> is a local variable to <code>main</code>. It isn&#39;t visible anywhere outside of it."}], "answers": [{"tags": [], "owner": {"reputation": 208473, "user_id": 126014, "user_type": "registered", "accept_rate": 86, "profile_image": "https://www.gravatar.com/avatar/33526616d4a11f1630d4939b769cfbf9?s=128&d=identicon&r=PG", "display_name": "Mark Seemann", "link": "https://stackoverflow.com/users/126014/mark-seemann"}, "is_accepted": false, "score": 1, "last_activity_date": 1497643313, "creation_date": 1497643313, "answer_id": 44597117, "question_id": 44588439, "link": "https://stackoverflow.com/questions/44588439/haskell-reading-from-file-to-a-variable/44597117#44597117", "title": "Haskell: Reading from file to a variable", "body": "<p>In the OP, <code>main</code> defines a <em>function</em>, the type of which is <code>IO ()</code>. This essentially means two things:</p>\n\n<ul>\n<li><code>IO</code> informs us that the function is impure</li>\n<li><code>()</code> tells us that it returns no data</li>\n</ul>\n\n<p>All named values defined within <code>main</code> are only available within that function. We say that they are <em>scoped</em> to the <code>main</code> function. They are inaccessible outside of the function. This applies not only to <code>plaster2</code>, but equally to <code>path</code>, <code>openn</code>, and <code>plaster1</code>.</p>\n\n<p>While you <em>could</em> change <code>main</code> so that it returns a value, that would be unorthodox; the <code>main</code> function is special, as this is usually the entry point for your application.</p>\n\n<p>Instead, I'd suggest that you extract the behaviour that you care about to a separate (impure) function:</p>\n\n<pre><code>readFirstLineInFile :: IO Plaster\nreadFirstLineInFile = do\n  putStrLn \"Please choose path:\"\n  path &lt;- getLine\n  h &lt;- openFile path ReadMode\n  plaster1 &lt;- hGetLine h\n  hClose h\n  return $ read plaster1\n</code></pre>\n\n<p>Even though I attempted to clean up the code a bit, there are still issues with it, but I don't want to confuse you with that currently.</p>\n\n<p>You can load your code with GHCI and start interacting with this function, as well as the <code>getFirst</code> function:</p>\n\n<pre><code>*Answer&gt; plaster2 &lt;- readFirstLineInFile\nPlease choose path:\nploeh.txt\n*Answer&gt; getFirst plaster2\n\"foo\"\n</code></pre>\n\n<p>Here, I initiate the <code>readFirstLineInFile</code> while binding the return value of it to <code>plaster2</code>. Once I've completed the interaction and typed in <code>ploeh.txt</code>, the <code>readFirstLineInFile</code> function returns, and <code>plaster2</code> has a value.</p>\n\n<p>I can now call <code>getFirst</code> with <code>plaster2</code>, and verify that the result is as expected.</p>\n\n<p>If, however, your overall goal is to be able to interactively test <code>getFirst</code>, you don't need to make it so complicated; simply call it in GHCI with various <code>Plaster</code> values:</p>\n\n<pre><code>*Answer&gt; getFirst $ Plaster [\"foo\", \"bar\"]\n\"foo\"\n*Answer&gt; getFirst $ Plaster [\"foo\"]\n\"foo\"\n*Answer&gt; getFirst $ Plaster []\n\"\"\n</code></pre>\n\n<p>That would be much easier, but I'm not sure if that's your overall goal...</p>\n"}], "owner": {"reputation": 517, "user_id": 6169343, "user_type": "registered", "accept_rate": 50, "profile_image": "https://www.gravatar.com/avatar/bf35274d8dc610e79b42ee2a07828669?s=128&d=identicon&r=PG&f=1", "display_name": "Czarek", "link": "https://stackoverflow.com/users/6169343/czarek"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 326, "favorite_count": 0, "answer_count": 1, "score": -2, "last_activity_date": 1497643408, "creation_date": 1497613400, "last_edit_date": 1497643408, "question_id": 44588439, "link": "https://stackoverflow.com/questions/44588439/haskell-reading-from-file-to-a-variable", "title": "Haskell: Reading from file to a variable", "body": "<p>I have the following code in Haskell:</p>\n\n<pre><code>import System.IO\n\ndata Plaster = Plaster [String] deriving (Read, Show)\n\nmain = do putStrLn \"Please choose path:\"\n          path &lt;- getLine\n          openn &lt;- openFile path ReadMode\n          plaster1 &lt;- hGetLine openn\n          let plaster2 = read plaster1::Plaster \n          putStrLn(plaster1)\n\ngetFirst :: Plaster -&gt; String\ngetFirst (Plaster (x:xs)) =  x\ngetFirst (Plaster []) = []  \n</code></pre>\n\n<p>I run main and choose path to a file with single example of <code>Plaster</code> instance. Then I would like to apply function <code>getFirst</code> to (I wish) variable <code>plaster2</code> but I receive: <code>\"Variable not in scope: plaster2\"</code>. What should I do, to read data from file to a variable? </p>\n"}, {"tags": ["haskell", "yesod", "aeson", "haskell-persistent"], "comments": [{"owner": {"reputation": 9772, "user_id": 3963, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/9pDQ8.png?s=128&g=1", "display_name": "hao", "link": "https://stackoverflow.com/users/3963/hao"}, "edited": false, "score": 1, "creation_date": 1497971649, "post_id": 44587846, "comment_id": 76299160, "body": "I too have run into this problem and unfortunately the <code>persistent-th</code> package is very &quot;all or nothing&quot; about the Aeson instances it generates. On the large production system I worked on, we eventually bit the bullet and forked the package. There is (relatively) not that much code. For your specific problem you could, for example, modify <code>mkKeyTypeDec</code> (where the key types are declared and then instanced) to produce the desired <code>ToJSON</code> instance. <a href=\"https://hackage.haskell.org/package/persistent-template-2.5.2/docs/src/Database-Persist-TH.html#mpsEntityJSON\" rel=\"nofollow noreferrer\">hackage.haskell.org/package/persistent-template-2.5.2/docs/s&zwnj;&#8203;rc/&hellip;</a>"}], "answers": [{"tags": [], "owner": {"reputation": 81, "user_id": 7400091, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/bddeb889efd6c87614a671b2a1849b15?s=128&d=identicon&r=PG&f=1", "display_name": "Harpo", "link": "https://stackoverflow.com/users/7400091/harpo"}, "is_accepted": true, "score": 0, "last_activity_date": 1498076130, "creation_date": 1498076130, "answer_id": 44685505, "question_id": 44587846, "link": "https://stackoverflow.com/questions/44587846/custom-tojson-instance-for-persistent-key/44685505#44685505", "title": "Custom ToJSON instance for Persistent Key", "body": "<p>Based by the advice in the comment from haoformayor this issue is now solved. The answer is to fork the persistent-template library and modify the <code>mkKeyTypeDec</code> portion.</p>\n"}], "owner": {"reputation": 81, "user_id": 7400091, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/bddeb889efd6c87614a671b2a1849b15?s=128&d=identicon&r=PG&f=1", "display_name": "Harpo", "link": "https://stackoverflow.com/users/7400091/harpo"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 239, "favorite_count": 0, "accepted_answer_id": 44685505, "answer_count": 1, "score": 4, "last_activity_date": 1498076130, "creation_date": 1497611527, "question_id": 44587846, "link": "https://stackoverflow.com/questions/44587846/custom-tojson-instance-for-persistent-key", "title": "Custom ToJSON instance for Persistent Key", "body": "<p>I am building a web application in Haskell. I am using the persistent library to connect to a postgresql database.</p>\n\n<p>I am using the standard schema definition file system where template Haskell is used to generate types from the schema.</p>\n\n<pre><code>share [mkPersist sqlSettings, mkMigrate \"migrateAll\"]\n  $(persistFileWith lowerCaseSettings \"schema\")\n</code></pre>\n\n<p>I have many data types defined in my schema file that look like (fake example):</p>\n\n<pre><code>User json\n  email Text\n\nPost json\n  owner UserId\n  name  Text\n  body  Text\n</code></pre>\n\n<p>The \"json\" next to \"Post\" indicates that ToJSON / FromJSON are to be automatically generated by the framework.</p>\n\n<p>I have been using this automatic instance generation for many of my types so that I can serialize them over the network.</p>\n\n<p>My issue: I want to provide a custom instance of  ToJSON for the Keys. For example in the above \"UserId\" would be a \"Key User\". Every time has such an instance generated for it automatically at the moment \"PostId\" as \"Key Post\" etc.</p>\n\n<p>When \"Post\" is serialized it would convert \"owner\" from a key to the index number like say \"52\".</p>\n\n<p>I would like to serialize all of the database keys to a different style. For example instead of producing the number '52' producing the string \"fiftytwo\" (just an example).</p>\n\n<p>If I did not use code generation I could do something like</p>\n\n<pre><code>instance ToJSON (Key record) where\n  toJSON _ = Data.Aeson.String \"placeholder\"\n</code></pre>\n\n<p>But this would require not using the automatic code generation because of overlapping instance errors. Perhaps there is a way to tell the code generator not to generate instances of \"ToJSON (Key Post)\" etc for all the datatypes?</p>\n\n<p>I could also simply write custom instance declarations for every type but this would be very redundant.</p>\n\n<p>I am familiar with using newtypes to have multiple instances of a type class, however this would not fit well into this scenario.</p>\n\n<p>Thanks!</p>\n"}, {"tags": ["haskell"], "answers": [{"tags": [], "owner": {"reputation": 23600, "user_id": 1695172, "user_type": "registered", "accept_rate": 91, "profile_image": "https://www.gravatar.com/avatar/6319d7eafca7852cf04c88598ca31e75?s=128&d=identicon&r=PG", "display_name": "Netwave", "link": "https://stackoverflow.com/users/1695172/netwave"}, "is_accepted": true, "score": 6, "last_activity_date": 1497599950, "last_edit_date": 1497599950, "creation_date": 1497598084, "answer_id": 44583329, "question_id": 44582957, "link": "https://stackoverflow.com/questions/44582957/what-is-the-value-of-the-type/44583329#44583329", "title": "What is the value of the type?", "body": "<p>It doesn't say that Int is of type <code>MyType</code>, it says that MyVal (constructor) must only contain an Int, so for example you can not do <code>MyVal \"hey!\"</code></p>\n\n<p>Check this</p>\n\n<pre><code>Prelude&gt; data MyType = MyVal Int deriving (Eq, Show)\nPrelude&gt; :t MyVal 9\nMyVal 9 :: MyType\nPrelude&gt; MyVal '9'\n\n&lt;interactive&gt;:12:7: error:\n    \u2022 Couldn't match expected type \u2018Int\u2019 with actual type \u2018Char\u2019\n    \u2022 In the first argument of \u2018MyVal\u2019, namely \u2018'9'\u2019\n      In the expression: MyVal '9'\n      In an equation for \u2018it\u2019: it = MyVal '9'\n</code></pre>\n\n<p>As you can see, the only way of using <code>MyVal</code> wich is of type <code>MyType</code> is with an <code>Int</code>, so no other type is allowed.</p>\n"}, {"tags": [], "owner": {"reputation": 1589, "user_id": 2535671, "user_type": "registered", "accept_rate": 87, "profile_image": "https://www.gravatar.com/avatar/fca1ba52e0c41803e676d449ef242e75?s=128&d=identicon&r=PG&f=1", "display_name": "Julian Leviston", "link": "https://stackoverflow.com/users/2535671/julian-leviston"}, "is_accepted": false, "score": 1, "last_activity_date": 1497656818, "creation_date": 1497656818, "answer_id": 44599377, "question_id": 44582957, "link": "https://stackoverflow.com/questions/44582957/what-is-the-value-of-the-type/44599377#44599377", "title": "What is the value of the type?", "body": "<p>To be super-explicit and clear, which is hopefully helpful: you said that \"As you can see, it has only one data type constructor with an argument.\", but I would adjust that slightly.</p>\n\n<p><code>data MyType = MyVal Int deriving (Eq, Show)</code></p>\n\n<p>Here <code>MyType</code> is the type. It's a <strong>type constructor</strong> with zero arguments, is one way of viewing it. Or, you could say it's the data type constructor.</p>\n\n<p>However, <code>MyVal</code> is a <strong>value constructor</strong>. It's one of <code>MyType</code> data type's value constructors (which there are only one of in this example). That is, it's actually a function that constructs values of type <code>MyType</code>. So, <code>MyType</code> has <strong>one value constructor called <code>MyVal</code> that takes one argument. That argument has type Int</strong>.</p>\n\n<p>If we ask GHCi what the type of this function is, it's clear its one argument is of type <code>Int</code>:\n<code>\nMain&gt; :t MyVal\nMyVal :: Int -&gt; MyType\n</code></p>\n\n<p>Why is it useful to \"wrap\" the type <code>Int</code> when it's already a type? One reason is that it separates the meaning of <code>MyVal</code> from <code>Int</code>, and you can thus have your own type, which is distinct from <code>Int</code> according to the type checker and your code, even though its representation happens to be an <code>Int</code> for now.</p>\n\n<p>Maybe tomorrow you may decide to change it to an <code>Integer</code>, in which case all you probably have to do is change that one spot, and the rest of your code will work (assuming you don't use <code>Int</code> to refer to your unwrapped <code>MyVal</code>s, and that you have data access functions to deal with the base operations on the internal value of <code>MyVal</code>).</p>\n\n<p>As an aside, just FYI, wrapping a single type in a <code>data</code> declaration like this is usually not done in professional code because it costs execution cycles to wrap and unwrap it. There's another way of declaring single-value types such as this, called <code>newtype</code> which gives a cost-free (at runtime) way to explain to the compiler and typechecker that you want a distinct value that has a representation as one of the existing values. I'm sure whatever book you're reading will explain this in due course, but if it doesn't, make a note to look these up later.</p>\n"}], "owner": {"reputation": 25967, "user_id": 1743843, "user_type": "registered", "accept_rate": 77, "profile_image": "https://www.gravatar.com/avatar/8ea2c1d9051e40332376a07bc166d9d5?s=128&d=identicon&r=PG&f=1", "display_name": "softshipper", "link": "https://stackoverflow.com/users/1743843/softshipper"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 91, "favorite_count": 0, "accepted_answer_id": 44583329, "answer_count": 2, "score": 0, "last_activity_date": 1497656818, "creation_date": 1497596927, "question_id": 44582957, "link": "https://stackoverflow.com/questions/44582957/what-is-the-value-of-the-type", "title": "What is the value of the type?", "body": "<p>I have following type declaration:</p>\n\n<pre><code>data MyType = MyVal Int deriving (Eq, Show)\n</code></pre>\n\n<p>As you can see, it has only one data type constructor with an argument.   </p>\n\n<p>In the book, it says:</p>\n\n<blockquote>\n  <p>Because MyVal has one Int argument, a value of type MyType must\n  contain one \u2014 only one \u2014 Int value</p>\n</blockquote>\n\n<p>Why is <code>Int</code> a value of type MyType or what does it mean?</p>\n"}, {"tags": ["haskell"], "comments": [{"owner": {"reputation": 28376, "user_id": 5743988, "user_type": "registered", "accept_rate": 67, "profile_image": "https://i.stack.imgur.com/IeSSM.jpg?s=128&g=1", "display_name": "4castle", "link": "https://stackoverflow.com/users/5743988/4castle"}, "edited": false, "score": 0, "creation_date": 1497581870, "post_id": 44579055, "comment_id": 76148705, "body": "It looks like you don&#39;t need a wrapping type for the <code>[String]</code>, you could just use a type synonym: <code>type Plaster = [String]</code> and then use the <code>head</code> function or pattern match on the <code>:</code> constructor in order to get the first item in the list."}], "answers": [{"tags": [], "owner": {"reputation": 3627, "user_id": 3695939, "user_type": "registered", "accept_rate": 69, "profile_image": "https://www.gravatar.com/avatar/d75f41bcfc1d3f20c084ec7e87d82012?s=128&d=identicon&r=PG&f=1", "display_name": "moondaisy", "link": "https://stackoverflow.com/users/3695939/moondaisy"}, "is_accepted": false, "score": 1, "last_activity_date": 1497573736, "creation_date": 1497573736, "answer_id": 44579074, "question_id": 44579055, "link": "https://stackoverflow.com/questions/44579055/haskell-function-which-use-user-definied-data-type/44579074#44579074", "title": "Haskell: Function which use user definied data type", "body": "<p>You could use the <code>head</code> function from <code>Data.List</code></p>\n\n<pre><code>getFirst :: Plaster -&gt; String\ngetFirst (Plaster []) = \"\" \ngetFirst (Plaster xs) = head xs\n</code></pre>\n\n<p>Where <code>head :: [a] -&gt; a</code> extract the first element of a list, which must be non-empty. As explained <a href=\"https://hackage.haskell.org/package/base-4.9.1.0/docs/Data-List.html#g:1\" rel=\"nofollow noreferrer\">here</a>.</p>\n\n<p>And to call it do: <code>getFirst examplePlaster</code></p>\n"}, {"comments": [{"owner": {"reputation": 1649, "user_id": 3684713, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/qo7tw.jpg?s=128&g=1", "display_name": "overactor", "link": "https://stackoverflow.com/users/3684713/overactor"}, "edited": false, "score": 1, "creation_date": 1497611838, "post_id": 44579104, "comment_id": 76163404, "body": "You could write that second part as <code>getFirst _ = Nothing</code> if you were so inclined."}], "tags": [], "owner": {"reputation": 384463, "user_id": 1126841, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/fa05233b2357f8d11c22ef4cfc7bb85c?s=128&d=identicon&r=PG", "display_name": "chepner", "link": "https://stackoverflow.com/users/1126841/chepner"}, "is_accepted": false, "score": 6, "last_activity_date": 1497573995, "creation_date": 1497573995, "answer_id": 44579104, "question_id": 44579055, "link": "https://stackoverflow.com/questions/44579055/haskell-function-which-use-user-definied-data-type/44579104#44579104", "title": "Haskell: Function which use user definied data type", "body": "<p>Like any other type, you can pattern match on the value created by your data constructor.</p>\n\n<pre><code>getFirst :: Plaster -&gt; Maybe String\ngetFirst (Plaster (x:xs)) = Just x\ngetFirst (Plaster []) = Nothing\n</code></pre>\n"}], "owner": {"reputation": 517, "user_id": 6169343, "user_type": "registered", "accept_rate": 50, "profile_image": "https://www.gravatar.com/avatar/bf35274d8dc610e79b42ee2a07828669?s=128&d=identicon&r=PG&f=1", "display_name": "Czarek", "link": "https://stackoverflow.com/users/6169343/czarek"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 69, "favorite_count": 0, "answer_count": 2, "score": 0, "last_activity_date": 1497575434, "creation_date": 1497573597, "last_edit_date": 1497575434, "question_id": 44579055, "link": "https://stackoverflow.com/questions/44579055/haskell-function-which-use-user-definied-data-type", "title": "Haskell: Function which use user definied data type", "body": "<p>I have written following data type and its instance in Haskell:</p>\n\n<pre><code>data Plaster = Plaster [String] deriving (Read, Show)\n\nexamplePlaster :: Plaster\nexamplePlaster = Plaster [\"..AEG\", \"..CD\", \"DC...\", \"A.B.\", \"..EFG\"]\n</code></pre>\n\n<p>I would like to create a function, which applicated to <code>examplePlaster</code> returns the first String on a list. How should I do that?</p>\n"}, {"tags": ["haskell", "functional-programming", "immutability", "imperative-programming"], "comments": [{"owner": {"reputation": 208473, "user_id": 126014, "user_type": "registered", "accept_rate": 86, "profile_image": "https://www.gravatar.com/avatar/33526616d4a11f1630d4939b769cfbf9?s=128&d=identicon&r=PG", "display_name": "Mark Seemann", "link": "https://stackoverflow.com/users/126014/mark-seemann"}, "edited": false, "score": 2, "creation_date": 1497593375, "post_id": 44578339, "comment_id": 76151974, "body": "I&#39;m voting to close this question as off-topic because there&#39;s no clear answer to general questions about performance. See e.g. <a href=\"https://ericlippert.com/2012/12/17/performance-rant\" rel=\"nofollow noreferrer\">ericlippert.com/2012/12/17/performance-rant</a> for reasoning."}, {"owner": {"reputation": 1393, "user_id": 2535843, "user_type": "registered", "accept_rate": 76, "profile_image": "https://i.stack.imgur.com/ijgr5.png?s=128&g=1", "display_name": "Mahdi", "link": "https://stackoverflow.com/users/2535843/mahdi"}, "reply_to_user": {"reputation": 208473, "user_id": 126014, "user_type": "registered", "accept_rate": 86, "profile_image": "https://www.gravatar.com/avatar/33526616d4a11f1630d4939b769cfbf9?s=128&d=identicon&r=PG", "display_name": "Mark Seemann", "link": "https://stackoverflow.com/users/126014/mark-seemann"}, "edited": false, "score": 2, "creation_date": 1497599793, "post_id": 44578339, "comment_id": 76155433, "body": "Thanks @MarkSeemann but I don&#39;t think it&#39;s off topics.  I am asking about the difference between two paradigms in implementing a data structure in terms of speed. And as I am not a Haskell developer, I could not write a good comparison code myself.  Regarding performance being a bottleneck, I think this does not apply to my question as it is not related to a specific piece of software. It has been asked to make decisions regarding the design of a programming language.  Because of the same reason, the difference is relevant in my case."}, {"owner": {"reputation": 20980, "user_id": 241990, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/265f1d52e6e484c9abe60b4da20fb8ee?s=128&d=identicon&r=PG", "display_name": "Shaun the Sheep", "link": "https://stackoverflow.com/users/241990/shaun-the-sheep"}, "edited": false, "score": 1, "creation_date": 1497608276, "post_id": 44578339, "comment_id": 76161205, "body": "I don&#39;t think this is a general question about performance. It&#39;s hard to understand how Haskell&#39;s array types are implemented (boxed vs unboxed types, how they relate to native arrays and so on), so good answers about this are useful. For example, if you look at the code for the unboxed <a href=\"http://hackage.haskell.org/package/array-0.5.1.1/docs/src/Data.Array.Base.html#STUArray\" rel=\"nofollow noreferrer\"><code>STUArray</code></a> you will see that it uses a <a href=\"https://hackage.haskell.org/package/primitive-0.6.2.0/docs/Data-Primitive-ByteArray.html#t:MutableByteArray-35-\" rel=\"nofollow noreferrer\"><code>MutableByteArray#</code></a>. But that doesn&#39;t really tell you much."}, {"owner": {"reputation": 9772, "user_id": 3963, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/9pDQ8.png?s=128&g=1", "display_name": "hao", "link": "https://stackoverflow.com/users/3963/hao"}, "edited": false, "score": 1, "creation_date": 1497971835, "post_id": 44578339, "comment_id": 76299297, "body": "See <a href=\"https://stackoverflow.com/questions/5773070/how-are-mutable-arrays-implemented-in-haskell\" title=\"how are mutable arrays implemented in haskell\">stackoverflow.com/questions/5773070/&hellip;</a> for a discussion about how MArray (a.k.a. IOUArray/STArray/STUArray) is implemented, with a link to the relevant paper."}], "owner": {"reputation": 1393, "user_id": 2535843, "user_type": "registered", "accept_rate": 76, "profile_image": "https://i.stack.imgur.com/ijgr5.png?s=128&g=1", "display_name": "Mahdi", "link": "https://stackoverflow.com/users/2535843/mahdi"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 84, "favorite_count": 0, "answer_count": 0, "score": 1, "last_activity_date": 1497568104, "creation_date": 1497568104, "question_id": 44578339, "link": "https://stackoverflow.com/questions/44578339/haskell-marray-performance-benchmark", "title": "Haskell MArray performance benchmark", "body": "<p>Haskell's MArray is supposed to provide a mutable array.</p>\n\n<p>I wonder how does it compare with a normal mutable array in an imperative programming language like Java or C. Is there any performance benchmark or feature comparison?</p>\n"}, {"tags": ["haskell", "linked-list"], "comments": [{"owner": {"reputation": 11096, "user_id": 2749717, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/46af1ef54856d737d52b7667afd240ee?s=128&d=identicon&r=PG&f=1", "display_name": "bipll", "link": "https://stackoverflow.com/users/2749717/bipll"}, "edited": false, "score": 0, "creation_date": 1497551915, "post_id": 44574594, "comment_id": 76138064, "body": "The last line should be <code>myAppend (L x xs) ys = L x (myAppend xs ys)</code>. And your toString does convert your list into standard Haskell list, not into a String."}, {"owner": {"reputation": 48938, "user_id": 246886, "user_type": "registered", "accept_rate": 94, "profile_image": "https://www.gravatar.com/avatar/dd1ebaade6623fc538fb8af3338e730d?s=128&d=identicon&r=PG", "display_name": "Jon Purdy", "link": "https://stackoverflow.com/users/246886/jon-purdy"}, "edited": false, "score": 0, "creation_date": 1497582359, "post_id": 44574594, "comment_id": 76148806, "body": "You can use a function or data constructor as an infix operator, but you need to wrap it in backticks, e.g.: <code>x `L` (xs `myAppend` ys)</code>."}], "answers": [{"comments": [{"owner": {"reputation": 113, "user_id": 8138142, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/db1d0687a43f80c2caebe125dae26844?s=128&d=identicon&r=PG&f=1", "display_name": "Vajk", "link": "https://stackoverflow.com/users/8138142/vajk"}, "edited": false, "score": 0, "creation_date": 1497553274, "post_id": 44574758, "comment_id": 76138858, "body": "The append function works fine but toString still doesn&#39;t work. Isn&#39;t there a simple way to convert an Integer list into a String?"}, {"owner": {"reputation": 314794, "user_id": 67579, "user_type": "registered", "accept_rate": 81, "profile_image": "https://i.stack.imgur.com/BJXub.png?s=128&g=1", "display_name": "Willem Van Onsem", "link": "https://stackoverflow.com/users/67579/willem-van-onsem"}, "reply_to_user": {"reputation": 113, "user_id": 8138142, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/db1d0687a43f80c2caebe125dae26844?s=128&d=identicon&r=PG&f=1", "display_name": "Vajk", "link": "https://stackoverflow.com/users/8138142/vajk"}, "edited": false, "score": 0, "creation_date": 1497553334, "post_id": 44574758, "comment_id": 76138898, "body": "@Vajk: yeah, you have to import the <code>intercalate</code> function first"}, {"owner": {"reputation": 314794, "user_id": 67579, "user_type": "registered", "accept_rate": 81, "profile_image": "https://i.stack.imgur.com/BJXub.png?s=128&g=1", "display_name": "Willem Van Onsem", "link": "https://stackoverflow.com/users/67579/willem-van-onsem"}, "reply_to_user": {"reputation": 113, "user_id": 8138142, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/db1d0687a43f80c2caebe125dae26844?s=128&d=identicon&r=PG&f=1", "display_name": "Vajk", "link": "https://stackoverflow.com/users/8138142/vajk"}, "edited": false, "score": 0, "creation_date": 1497555058, "post_id": 44574758, "comment_id": 76139794, "body": "@Vajk: what is complicated about <code>import Data.List(intercalate)</code>?"}, {"owner": {"reputation": 314794, "user_id": 67579, "user_type": "registered", "accept_rate": 81, "profile_image": "https://i.stack.imgur.com/BJXub.png?s=128&g=1", "display_name": "Willem Van Onsem", "link": "https://stackoverflow.com/users/67579/willem-van-onsem"}, "reply_to_user": {"reputation": 113, "user_id": 8138142, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/db1d0687a43f80c2caebe125dae26844?s=128&d=identicon&r=PG&f=1", "display_name": "Vajk", "link": "https://stackoverflow.com/users/8138142/vajk"}, "edited": false, "score": 0, "creation_date": 1497557721, "post_id": 44574758, "comment_id": 76141236, "body": "@Vajk: there is evidently another way, since <code>intercalate</code> is also implemented in Haskell. Will update the answer."}, {"owner": {"reputation": 314794, "user_id": 67579, "user_type": "registered", "accept_rate": 81, "profile_image": "https://i.stack.imgur.com/BJXub.png?s=128&g=1", "display_name": "Willem Van Onsem", "link": "https://stackoverflow.com/users/67579/willem-van-onsem"}, "reply_to_user": {"reputation": 113, "user_id": 8138142, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/db1d0687a43f80c2caebe125dae26844?s=128&d=identicon&r=PG&f=1", "display_name": "Vajk", "link": "https://stackoverflow.com/users/8138142/vajk"}, "edited": false, "score": 0, "creation_date": 1497559037, "post_id": 44574758, "comment_id": 76141870, "body": "You do not add two things together with <code>(x y)</code>. You do that with <code>(x + y)</code>. The <code>(+)</code> operator is a function of the <code>Num</code> type class. So the signature should be: <code>myAdd :: Num a =&gt; ML a -&gt; ML a -&gt; ML a</code>."}], "tags": [], "owner": {"reputation": 314794, "user_id": 67579, "user_type": "registered", "accept_rate": 81, "profile_image": "https://i.stack.imgur.com/BJXub.png?s=128&g=1", "display_name": "Willem Van Onsem", "link": "https://stackoverflow.com/users/67579/willem-van-onsem"}, "is_accepted": true, "score": 3, "last_activity_date": 1497558031, "last_edit_date": 1497558031, "creation_date": 1497552256, "answer_id": 44574758, "question_id": 44574594, "link": "https://stackoverflow.com/questions/44574594/basic-operations-for-linked-lists-in-haskell/44574758#44574758", "title": "Basic operations for linked lists in Haskell", "body": "<p>I think the basic problem is on the last line:</p>\n\n<pre><code>myAppend :: ML a -> ML a -> ML a\nmyAppend E a = a\nmyAppend <b>(x L xs)</b> ys = <b>x L (xs myAppend ys)</b></code></pre>\n\n<p>The constructor is <code>L</code> and in Haskell, one usually writes the <strong>constructor before its arguments</strong>, like:</p>\n\n<pre><code>myAppend :: ML a -> ML a -> ML a\nmyAppend E a = a\nmyAppend <b>(L x xs)</b> ys = <b>L x (myAppend xs ys)</b></code></pre>\n\n<p>Now it should work.</p>\n\n<p>About your second question: <code>toString ML a -&gt; [a]</code>. Actually an <strong><code>[a]</code> is a list</strong>, not a <code>String</code> (well, a <code>String</code> is a list of <code>Char</code>s: <code>type String = [Char]</code>), and guess what: a list in Haskell is a linked list. So that means that your <code>toString :: ML a -&gt; [a]</code> is actually more a <code>toList</code>.</p>\n\n<p>If you want to write something as a <code>String</code>, it means <strong>the elements should be have a textual representation</strong>. You can write that by using a <strong>type constraint</strong>, like <code>Show a =&gt;</code>. So now the signature is: <code>toString :: Show a =&gt; ML a -&gt; [String]</code>.</p>\n\n<p>We can convert a list of <code>a</code>s into a textual representation, by <code>map</code>ping all the elements to their textual representation, and <code>intercalate :: [a] -&gt; [[a]] -&gt; [a]</code> for instance with a comma, like:</p>\n\n<pre><code>import Data.List(intercalate)\n\ntoList :: ML a -&gt; [a]\ntoList E = []\ntoList (L x xs) = x : toList xs\n\ntoString :: Show a =&gt; ML a -&gt; String\ntoString = intercalate \",\" . map show . toList\n</code></pre>\n\n<p>Or we can \"implement the function by ourselves\":</p>\n\n<pre><code>toString :: Show a =&gt; ML a -&gt; String\ntoString E = \"\"\ntoString (L x E) = show x\ntoString (L x xs) = show x++',' : toString xs\n</code></pre>\n"}], "owner": {"reputation": 113, "user_id": 8138142, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/db1d0687a43f80c2caebe125dae26844?s=128&d=identicon&r=PG&f=1", "display_name": "Vajk", "link": "https://stackoverflow.com/users/8138142/vajk"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 485, "favorite_count": 0, "accepted_answer_id": 44574758, "answer_count": 1, "score": 1, "last_activity_date": 1497558031, "creation_date": 1497551749, "question_id": 44574594, "link": "https://stackoverflow.com/questions/44574594/basic-operations-for-linked-lists-in-haskell", "title": "Basic operations for linked lists in Haskell", "body": "<p>I am trying to write some basic list operations for a linked list in Haskell but I could use a hand with this one. I want to append a list to another but it doesn't work at all, here is my code:</p>\n\n<pre><code>data ML a = E | L a (ML a) deriving (Show)\n\nmyList = (L 1 (L 2 (L 3 (L 4 E))))\n\nmyHead :: ML a -&gt; a\nmyHead E = error \"empty list\"\nmyHead (L a _) = a\n\nmyTail :: ML a -&gt; ML a\nmyTail E = error \"empty list\"\nmyTail (L _ a) = a\n\nmyAppend :: ML a -&gt; ML a -&gt; ML a\nmyAppend E a = a\nmyAppend (x L xs) ys = x L (xs myAppend ys)\n</code></pre>\n\n<p>I also got a question on how to show this list as a String like \"1,2,3\". I got a function that shows it as a list like this [1,2,3] but not as a String.</p>\n\n<pre><code>toString :: ML a -&gt; [a]\ntoString E = []\ntoString (L a l) = a:(toString l)\n</code></pre>\n"}, {"tags": ["haskell", "quickcheck"], "comments": [{"owner": {"reputation": 7947, "user_id": 997606, "user_type": "registered", "accept_rate": 50, "profile_image": "https://www.gravatar.com/avatar/b6117f6630078d6612afa75fb8e5bc9a?s=128&d=identicon&r=PG", "display_name": "Tom Ellis", "link": "https://stackoverflow.com/users/997606/tom-ellis"}, "edited": false, "score": 0, "creation_date": 1497557753, "post_id": 44572548, "comment_id": 76141248, "body": "Have you seen that Opaleye has a test suite that you could use for inspiration?  <a href=\"https://github.com/tomjaguarpaw/haskell-opaleye/tree/master/Test\" rel=\"nofollow noreferrer\">github.com/tomjaguarpaw/haskell-opaleye/tree/master/Test</a>"}, {"owner": {"reputation": 5657, "user_id": 534481, "user_type": "registered", "accept_rate": 31, "profile_image": "https://www.gravatar.com/avatar/60df8c1a366ab1bf4378154e71a93367?s=128&d=identicon&r=PG", "display_name": "Saurabh Nanda", "link": "https://stackoverflow.com/users/534481/saurabh-nanda"}, "reply_to_user": {"reputation": 7947, "user_id": 997606, "user_type": "registered", "accept_rate": 50, "profile_image": "https://www.gravatar.com/avatar/b6117f6630078d6612afa75fb8e5bc9a?s=128&d=identicon&r=PG", "display_name": "Tom Ellis", "link": "https://stackoverflow.com/users/997606/tom-ellis"}, "edited": false, "score": 0, "creation_date": 1497585035, "post_id": 44572548, "comment_id": 76149355, "body": "@TomEllis you meant &quot;inspiration&quot; in what way? Am I doing something fundamentally wrong while writing DB tests using QC? Because I can seem to run <code>testClientDB</code> via <code>QC.quickCheck</code> directly. It&#39;s just that it isn&#39;t composing with tasty&#39;s <code>TestTree</code>"}, {"owner": {"reputation": 7947, "user_id": 997606, "user_type": "registered", "accept_rate": 50, "profile_image": "https://www.gravatar.com/avatar/b6117f6630078d6612afa75fb8e5bc9a?s=128&d=identicon&r=PG", "display_name": "Tom Ellis", "link": "https://stackoverflow.com/users/997606/tom-ellis"}, "edited": false, "score": 0, "creation_date": 1497624302, "post_id": 44572548, "comment_id": 76171848, "body": "I mean you could use the same testing setup as Opaleye&#39;s QuickCheck test cases if you like.  It might be easier than trying to discover your own way.  I don&#39;t think you&#39;re doing anything fundamentally wrong though."}], "answers": [{"tags": [], "owner": {"reputation": 5657, "user_id": 534481, "user_type": "registered", "accept_rate": 31, "profile_image": "https://www.gravatar.com/avatar/60df8c1a366ab1bf4378154e71a93367?s=128&d=identicon&r=PG", "display_name": "Saurabh Nanda", "link": "https://stackoverflow.com/users/534481/saurabh-nanda"}, "is_accepted": false, "score": 0, "last_activity_date": 1497588088, "creation_date": 1497588088, "answer_id": 44580953, "question_id": 44572548, "link": "https://stackoverflow.com/questions/44572548/how-to-check-monadic-io-properties-with-tasty-quickcheck/44580953#44580953", "title": "How to check monadic IO properties with tasty-quickcheck?", "body": "<p>I got something to compile, but it isn't pretty. I'm still looking for an easier way to write DB-based Quickcheck properties with tasty, where the connection is being picked from a pool (so that tests can be run in parallel)</p>\n\n<pre><code>testClientDB :: ConnectionPool -&gt; Property\ntestClientDB dbPool = monadicIO $ do\n  (client :: Client) &lt;- pick arbitrary\n  client_ &lt;- run $ withResource dbPool $ \\conn -&gt; insertModel conn client\n  QCM.assert (client == client_)\n</code></pre>\n"}], "owner": {"reputation": 5657, "user_id": 534481, "user_type": "registered", "accept_rate": 31, "profile_image": "https://www.gravatar.com/avatar/60df8c1a366ab1bf4378154e71a93367?s=128&d=identicon&r=PG", "display_name": "Saurabh Nanda", "link": "https://stackoverflow.com/users/534481/saurabh-nanda"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 311, "favorite_count": 0, "answer_count": 1, "score": 3, "last_activity_date": 1497588088, "creation_date": 1497543985, "last_edit_date": 1497587875, "question_id": 44572548, "link": "https://stackoverflow.com/questions/44572548/how-to-check-monadic-io-properties-with-tasty-quickcheck", "title": "How to check monadic IO properties with tasty-quickcheck?", "body": "<p>How does one test a monadicIO property with <a href=\"https://www.stackage.org/haddock/nightly-2017-03-01/tasty-quickcheck-0.8.4/Test-Tasty-QuickCheck.html\" rel=\"nofollow noreferrer\">tasty-quickcheck</a>? I tried the following, where the <code>testCase</code> is working as expected (which is coming from HUnit), but the <code>testProperty</code> (from QuickCheck) is not compiling.</p>\n\n<pre><code>import Test.Common\nimport Models.Client as Client\nimport Foundation\nimport Test.Foundation.Types ()\nimport Test.QuickCheck.Monadic as QCM\nimport Opaleye\nimport Data.Pool as P\n\ntests :: ConnectionPool -&gt; TestTree\ntests dbPool = testGroup \"All tests\"\n  [\n    testProperty \"Client DB\" $ testClientDB dbPool\n  , testCase \"Existing client.properties in production\" $ withResource dbPool testExistingClientProperties\n  ]\n\ntestExistingClientProperties :: Connection -&gt; Assertion\ntestExistingClientProperties = undefined -- REDACTED    \n\n\ntestClientDB :: ConnectionPool -&gt; Property\ntestClientDB dbPool = monadicIO $ do\n  withResource dbPool $ \\conn -&gt; do\n    (client :: Client) &lt;- pick arbitrary\n    client_ &lt;- run $ insertModel conn client\n    QCM.assert (client == client_)\n</code></pre>\n\n<p>Error:</p>\n\n<pre><code>testClientDB :: ConnectionPool -&gt; Property\ntestClientDB dbPool = monadicIO $ do\n  withResource dbPool $ \\conn -&gt; do\n    (client :: BloatedClient) &lt;- pick arbitrary\n    client_ &lt;- run $ insertModel conn client\n    QCM.assert (client == client_)\n</code></pre>\n"}, {"tags": ["haskell", "monad-transformers"], "comments": [{"owner": {"reputation": 3392, "user_id": 7175117, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/Tfz44.png?s=128&g=1", "display_name": "freestyle", "link": "https://stackoverflow.com/users/7175117/freestyle"}, "edited": false, "score": 4, "creation_date": 1497542794, "post_id": 44572037, "comment_id": 76133098, "body": "<code>ToMonadTrans</code> is isomorphic to <code>Compose</code>. In general cases, the composition of two monads is not a monad. Monad Transformers are just able to somehow do these compositions."}, {"owner": {"reputation": 20350, "user_id": 411944, "user_type": "registered", "accept_rate": 88, "profile_image": "https://www.gravatar.com/avatar/7bf057b98d0652db34842d1817234853?s=128&d=identicon&r=PG", "display_name": "Reactormonk", "link": "https://stackoverflow.com/users/411944/reactormonk"}, "edited": false, "score": 3, "creation_date": 1497542990, "post_id": 44572037, "comment_id": 76133199, "body": "<a href=\"https://stackoverflow.com/questions/29453915/composing-monads-v-applicative-functors\" title=\"composing monads v applicative functors\">stackoverflow.com/questions/29453915/&hellip;</a> <a href=\"http://blog.tmorris.net/posts/monads-do-not-compose/\" rel=\"nofollow noreferrer\">blog.tmorris.net/posts/monads-do-not-compose</a>"}, {"owner": {"reputation": 208473, "user_id": 126014, "user_type": "registered", "accept_rate": 86, "profile_image": "https://www.gravatar.com/avatar/33526616d4a11f1630d4939b769cfbf9?s=128&d=identicon&r=PG", "display_name": "Mark Seemann", "link": "https://stackoverflow.com/users/126014/mark-seemann"}, "edited": false, "score": 1, "creation_date": 1497549272, "post_id": 44572037, "comment_id": 76136600, "body": "Could you use <a href=\"https://hackage.haskell.org/package/transformers-free-1.0.1/docs/Control-Monad-Trans-Free.html#g:3\" rel=\"nofollow noreferrer\">FreeT</a>?"}], "owner": {"reputation": 20310, "user_id": 525980, "user_type": "registered", "accept_rate": 48, "profile_image": "https://www.gravatar.com/avatar/8dafe66793ee2f32192e9fcefb389a12?s=128&d=identicon&r=PG", "display_name": "Clinton", "link": "https://stackoverflow.com/users/525980/clinton"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 79, "favorite_count": 0, "closed_date": 1497558837, "answer_count": 0, "score": 3, "last_activity_date": 1497542320, "creation_date": 1497542320, "question_id": 44572037, "link": "https://stackoverflow.com/questions/44572037/creating-a-monad-transformer-from-a-monad", "closed_reason": "Duplicate", "title": "Creating a Monad Transformer from a Monad", "body": "<p>Given an arbitrary monad, is there a way to create a monad transformer based on that monad? I googled this question and didn't see anywhere where it was addressed (although I may have missed it) so I just tried to do it myself, and I got close, I think:</p>\n\n<pre><code>import Control.Monad.Trans.Class (MonadTrans, lift)\n\nnewtype ToMonadTrans m2 m1 a = ToMonadTrans (m2 (m1 a))\n\ninstance (Functor m2, Functor m1) =&gt; Functor (ToMonadTrans m2 m1) where\n  fmap f (ToMonadTrans x) = ToMonadTrans (fmap (fmap f) x)\n\ninstance (Applicative m2, Applicative m1) =&gt; Applicative (ToMonadTrans m2 m1) where\n  pure = ToMonadTrans . pure . pure\n  ToMonadTrans f &lt;*&gt; ToMonadTrans x = ToMonadTrans (((&lt;*&gt;) . (fmap (&lt;*&gt;))) f x)\n\ninstance (Monad m2, Monad m1) =&gt; Monad (ToMonadTrans m2 m1) where\n  ToMonadTrans x &gt;&gt;= ToMonadTrans f = ToMonadTrans (???)\n\ninstance Monad m2 =&gt; MonadTrans (ToMonadTrans m2) where\n  lift x = ToMonadTrans (pure x)\n</code></pre>\n\n<p>The idea here is that <code>ToMonadTrans Maybe</code> is the same as <code>MaybeT</code>. The good thing about this approach (if it works) is that you can make any monad into a <code>MonadTrans</code>, allowing one to layer any monad without having to write a corresponding specialised transformer.</p>\n\n<p>As you can see, I implemented <code>MonadTrans</code> as well as <code>Functor</code> and <code>Applicative</code>, the only place I got stuck is <code>Monad</code>.</p>\n\n<p>My questions are:</p>\n\n<ol>\n<li>Can this be done?</li>\n<li>Has this been done in a package on hackage?</li>\n</ol>\n"}, {"tags": ["haskell", "generics", "cqrs"], "comments": [{"owner": {"reputation": 28376, "user_id": 5743988, "user_type": "registered", "accept_rate": 67, "profile_image": "https://i.stack.imgur.com/IeSSM.jpg?s=128&g=1", "display_name": "4castle", "link": "https://stackoverflow.com/users/5743988/4castle"}, "edited": false, "score": 0, "creation_date": 1497536994, "post_id": 44569993, "comment_id": 76129113, "body": "<code>data Aggregate = Aggregate { state :: State, command :: Command, event :: Event }</code> or use a tuple <code>type Aggregate = (State,Command,Event)</code>"}, {"owner": {"reputation": 208473, "user_id": 126014, "user_type": "registered", "accept_rate": 86, "profile_image": "https://www.gravatar.com/avatar/33526616d4a11f1630d4939b769cfbf9?s=128&d=identicon&r=PG", "display_name": "Mark Seemann", "link": "https://stackoverflow.com/users/126014/mark-seemann"}, "edited": false, "score": 1, "creation_date": 1497537724, "post_id": 44569993, "comment_id": 76129665, "body": "Why does <code>execute</code> take a <code>State</code> argument? It doesn&#39;t use it..."}, {"owner": {"reputation": 7264, "user_id": 146452, "user_type": "registered", "accept_rate": 92, "profile_image": "https://www.gravatar.com/avatar/55e2e2dbef238cbc9d9a3b914b9a65a5?s=128&d=identicon&r=PG", "display_name": "mclark1129", "link": "https://stackoverflow.com/users/146452/mclark1129"}, "reply_to_user": {"reputation": 208473, "user_id": 126014, "user_type": "registered", "accept_rate": 86, "profile_image": "https://www.gravatar.com/avatar/33526616d4a11f1630d4939b769cfbf9?s=128&d=identicon&r=PG", "display_name": "Mark Seemann", "link": "https://stackoverflow.com/users/126014/mark-seemann"}, "edited": false, "score": 0, "creation_date": 1497538178, "post_id": 44569993, "comment_id": 76129995, "body": "@MarkSeemann True, I was just keeping the example super simple.  In practice execute would have to validate the command against the current state before events could be generated (I should probably also be returning Maybe [Event])."}], "answers": [{"comments": [{"owner": {"reputation": 7264, "user_id": 146452, "user_type": "registered", "accept_rate": 92, "profile_image": "https://www.gravatar.com/avatar/55e2e2dbef238cbc9d9a3b914b9a65a5?s=128&d=identicon&r=PG", "display_name": "mclark1129", "link": "https://stackoverflow.com/users/146452/mclark1129"}, "edited": false, "score": 0, "creation_date": 1497550918, "post_id": 44571777, "comment_id": 76137522, "body": "Thanks!  I think that the multi-parameter type class might be exactly what I need.  Working through the example now, will post once I have a more complete update.  I had seen the MPTCs before, but since it was something that required an extension made me feel like I was doing something wrong."}], "tags": [], "owner": {"reputation": 15757, "user_id": 176841, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/45a168cb9eb8454d66c78f18e29d9342?s=128&d=identicon&r=PG", "display_name": "jberryman", "link": "https://stackoverflow.com/users/176841/jberryman"}, "is_accepted": true, "score": 4, "last_activity_date": 1497541520, "creation_date": 1497541520, "answer_id": 44571777, "question_id": 44569993, "link": "https://stackoverflow.com/questions/44569993/creating-generic-typeclasses-in-haskell/44571777#44571777", "title": "Creating Generic Typeclasses in Haskell", "body": "<p>If <code>state</code>, <code>command</code> and <code>event</code> are a triple that are all unique to a particular instance you can use <code>MultiParameterTypeClasses</code> along with <code>FunctionalDependencies</code> like</p>\n\n<pre><code>class Aggregate state command event | state -&gt; command event, command -&gt; state event, event -&gt; state command  where\n    execute :: state -&gt; command -&gt; [event]\n    apply   :: state -&gt; event   -&gt; state\n</code></pre>\n\n<p>The fundeps after the <code>|</code> read: \"where command and event are uniquely determined by state, and state and event are uniquely determined by command, and...\" etc. This allows instances to be resolved if we can infer any one of the types in the instance head. You could do the same with type families.</p>\n\n<p>But three questions you should ask yourself before defining a type class:</p>\n\n<ul>\n<li>do I intend to write useful code that is polymorphic in this class?</li>\n<li>do I expect users to define their own instances I haven't thought of?</li>\n<li>does it have any laws?</li>\n</ul>\n\n<p>If the answer is no to all of these then you probably shouldn't be defining a type class. It's hard to give an answer as to whether that's the case here.</p>\n\n<p>But it might be e.g. that what you really want is something like:</p>\n\n<pre><code>data Aggregate state command where \n   Aggregate :: (state -&gt; command -&gt; [event]) -&gt; (state -&gt; event   -&gt; state) -&gt; Aggregate state command\n</code></pre>\n\n<p>this is a GADT where <code>event</code> is hidden.</p>\n"}, {"comments": [{"owner": {"reputation": 7264, "user_id": 146452, "user_type": "registered", "accept_rate": 92, "profile_image": "https://www.gravatar.com/avatar/55e2e2dbef238cbc9d9a3b914b9a65a5?s=128&d=identicon&r=PG", "display_name": "mclark1129", "link": "https://stackoverflow.com/users/146452/mclark1129"}, "edited": false, "score": 0, "creation_date": 1497561668, "post_id": 44576506, "comment_id": 76143111, "body": "Thanks!  This is actually very similar to the direction I&#39;m heading now.  For the handler I&#39;m still working on ironing out the IO part, which would basically be loading and persisting the events from the event store.  But other than that the logic is just folding the events against an initial state, applying the command to get new events, then saving them.  This will definitely be helpful to refer back to!"}, {"owner": {"reputation": 9946, "user_id": 467754, "user_type": "registered", "accept_rate": 89, "profile_image": "https://i.stack.imgur.com/3rEtR.png?s=128&g=1", "display_name": "Nikos Baxevanis", "link": "https://stackoverflow.com/users/467754/nikos-baxevanis"}, "edited": false, "score": 0, "creation_date": 1497615737, "post_id": 44576506, "comment_id": 76165888, "body": "I&#39;ve never thought about passing <code>it</code> around! +1"}], "tags": [], "owner": {"reputation": 208473, "user_id": 126014, "user_type": "registered", "accept_rate": 86, "profile_image": "https://www.gravatar.com/avatar/33526616d4a11f1630d4939b769cfbf9?s=128&d=identicon&r=PG", "display_name": "Mark Seemann", "link": "https://stackoverflow.com/users/126014/mark-seemann"}, "is_accepted": false, "score": 4, "last_activity_date": 1497558560, "creation_date": 1497558560, "answer_id": 44576506, "question_id": 44569993, "link": "https://stackoverflow.com/questions/44569993/creating-generic-typeclasses-in-haskell/44576506#44576506", "title": "Creating Generic Typeclasses in Haskell", "body": "<p>I'm not familiar with Lev Gorodinski's F# example, so this isn't guaranteed to point in the right direction, but I took a look at it, and it looks like one use of its <code>Aggregate</code> type is to <a href=\"https://github.com/eulerfx/DDDInventoryItemFSharp/blob/16dddc7d50e1480cc6fb92434c0cb7a8641a99b1/DDDInventoryItemFSharp/Aggregate.fs#L20-L43\" rel=\"nofollow noreferrer\">create <em>handlers</em></a>. If we ignore all the impure operations that those functions imply, the core operation seems to be:</p>\n\n<ul>\n<li>fold events to get the current state</li>\n<li>execute the command against that state</li>\n</ul>\n\n<p>So, inspired by @jberryman's answer, you can defined a typeclass like this:</p>\n\n<pre><code>class Aggregate state command event | event -&gt; state command where\n  eventsToState :: [event] -&gt; state\n  execute :: state -&gt; command -&gt; [event]\n</code></pre>\n\n<p>In order for this to compile, you'll need the <code>FunctionalDependencies</code> language extension.</p>\n\n<p>You can now write the core of the handler function as a generic function, based on that typeclass:</p>\n\n<pre><code>handle :: Aggregate state command event =&gt; command -&gt; [event] -&gt; [event]\nhandle command = flip execute command . eventsToState\n</code></pre>\n\n<p>You can now define an instance of <code>Aggregate</code> for the types defined in the OP:</p>\n\n<pre><code>instance Aggregate State Command Event where\n  eventsToState = foldl folder zero\n    where\n      folder state (Created _)        = state\n      folder state (MileageUpdated _) = state\n      folder state Deactivated        = state { isActive = False }\n  execute _ (Create name mileage)   = [Created name, MileageUpdated mileage]\n  execute _ (UpdateMileage mileage) = [MileageUpdated mileage]\n  execute _ Deactivate              = [Deactivated]\n</code></pre>\n\n<p>Try it out in GHCI:</p>\n\n<pre><code>*Vehicle&gt; handle (Create \"BMW 520i\" 250000) [] :: [Event]\n[Created \"BMW 520i\",MileageUpdated 250000]\n*Vehicle&gt; handle (UpdateMileage 256000) it\n[MileageUpdated 256000]\n*Vehicle&gt; handle Deactivate it\n[Deactivated]\n</code></pre>\n\n<p>I haven't looked further around in Lev Gorodinski's F# example, so I'm not sure if this is sufficient, but I hope it's a start.</p>\n"}], "owner": {"reputation": 7264, "user_id": 146452, "user_type": "registered", "accept_rate": 92, "profile_image": "https://www.gravatar.com/avatar/55e2e2dbef238cbc9d9a3b914b9a65a5?s=128&d=identicon&r=PG", "display_name": "mclark1129", "link": "https://stackoverflow.com/users/146452/mclark1129"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 319, "favorite_count": 2, "accepted_answer_id": 44571777, "answer_count": 2, "score": 4, "last_activity_date": 1497616510, "creation_date": 1497536478, "last_edit_date": 1497616510, "question_id": 44569993, "link": "https://stackoverflow.com/questions/44569993/creating-generic-typeclasses-in-haskell", "title": "Creating Generic Typeclasses in Haskell", "body": "<p>As an exercise to wrap my brain around Haskell types and typeclasses, I'm attempting to implement a simple DDD/CQRS style solution.  I'm modelling it directly after <a href=\"https://github.com/eulerfx/DDDInventoryItemFSharp\" rel=\"nofollow noreferrer\">Lev Gorodinski's F# Simple CQRS</a> implementation.  </p>\n\n<p>I've implemented a very simple <code>Vehicle</code> aggregate, which is more or less a direct port of Lev's <code>InventoryItem</code> aggregate</p>\n\n<pre><code>module Vehicle where\n\ndata State = State { isActive :: Bool } deriving (Show)\nzero = State { isActive = True }\n\ntype Mileage = Int \n\ndata Command = \n    Create String Mileage\n    | UpdateMileage Mileage\n    | Deactivate\n    deriving (Show)    \n\ndata Event =\n    Created String\n    | MileageUpdated Mileage \n    | Deactivated\n    deriving (Show)\n\n-- Define transitions from a command to one or more events\nexecute :: State -&gt; Command -&gt; [Event] \nexecute state (Create name mileage)   = [Created name, MileageUpdated mileage]\nexecute state (UpdateMileage mileage) = [MileageUpdated mileage]\nexecute state Deactivate              = [Deactivated]    \n\n-- Apply an event against the current state to get the new state\napply :: State -&gt; Event -&gt; State\napply state (Created _)        = state\napply state (MileageUpdated _) = state\napply state Deactivated        = state { isActive = False }\n</code></pre>\n\n<p>The part that I'm trying to figure out is how to create a higher level abstraction for the domain aggregate, since all Aggregates would be made up of the same component parts.  In Lev's example, he defined a type <code>Aggregate&lt;'TState, 'TCommand, 'TEvent&gt;</code> which allowed him to define a generic command handler which would work against any instance of a domain Aggregate.  In Haskell this feels like something I should be using Typeclasses for.  Of course, since I have no idea what I'm doing this may be a complete misconception of what they are used for.</p>\n\n<p>My thought is that an <code>Aggregate</code> Typeclass would define the interface for the <code>execute</code> and <code>apply</code> commands, as well as somehow that the type requires associated types to represent its State, Commands, and Events. From there I could define some generic command handler that would be able to execute a command against any instance of an Aggregate.  For example</p>\n\n<pre><code>class Aggregate a where =\n    execute :: state -&gt; command -&gt; [event]\n    apply   :: state -&gt; event   -&gt; state\n</code></pre>\n\n<p>Where <code>state</code>, <code>command</code>, and <code>event</code> are type variables representing State, Command, and Event for a given instance of <code>Aggregate</code>. This doesn't work, of course.</p>\n\n<p>Is what I'm trying to do an appropriate use of Typeclasses?  If so, how should I define the class such that an instance of <code>Aggregate</code> must have corresponding State, Command, and Event types?  </p>\n\n<p>If this the wrong approach, how should I be defining <code>Aggregate</code> in order to create higher level abstractions?</p>\n\n<p><strong>Update</strong></p>\n\n<p>Following @jberryman's advice I used an MPTC to define my Aggregate, which allowed me to create the generic command handler I was looking for:</p>\n\n<pre><code>{-# LANGUAGE MultiParamTypeClasses #-}\n{-# LANGUAGE FunctionalDependencies #-}\n\nmodule Aggregate where\n\nclass Aggregate state command event\n    | state -&gt; command event, command -&gt; state event, event -&gt; state command where\n        execute :: state -&gt; command -&gt; [event]\n        apply   :: state -&gt; event   -&gt; state\n        zero    :: state\n\nmakeHandler (load, commit) = \n    (\\ (id, expectedVersion) command -&gt; \n        do events &lt;- load id\n           let state = foldl apply zero events\n           let newEvents = execute state command\n           commit (id, expectedVersion) newEvents)\n</code></pre>\n\n<p>Which in turn leads to the following instance declaration in my <code>Vehicle</code> module</p>\n\n<pre><code>instance Aggregate State Command Event where\n    execute = Vehicle.execute\n    apply   = Vehicle.apply\n    zero    = Vehicle.zero\n</code></pre>\n\n<p>And then a sample script tying it all together:</p>\n\n<pre><code>import Aggregate\nimport Vehicle\n\n-- Mock out IO to a domain repository (EventStore)\nload :: Int -&gt; IO [Event]\nload id = do return [Created \"Honda\", MileageUpdated 15000]\ncommit (id, expectedVersion) events = putStrLn (show events)\n\n-- Create the handler provide a command to it\nhandler = makeHandler (load, commit)\nhandler (1,1) Deactivate\n</code></pre>\n"}, {"tags": ["javascript", "haskell", "functional-programming", "polymorphism", "existential-type"], "comments": [{"owner": {"reputation": 1649, "user_id": 3684713, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/qo7tw.jpg?s=128&g=1", "display_name": "overactor", "link": "https://stackoverflow.com/users/3684713/overactor"}, "edited": false, "score": 0, "creation_date": 1497538247, "post_id": 44568376, "comment_id": 76130040, "body": "I think this question might be more appropriate in Computer Science or Software Engineering. Though I must also admit that I don&#39;t quite understand everything in this question."}, {"owner": {"user_type": "does_not_exist", "display_name": "user6445533"}, "reply_to_user": {"reputation": 1649, "user_id": 3684713, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/qo7tw.jpg?s=128&g=1", "display_name": "overactor", "link": "https://stackoverflow.com/users/3684713/overactor"}, "edited": false, "score": 0, "creation_date": 1497539624, "post_id": 44568376, "comment_id": 76131013, "body": "The title of the question might be a little too general, yes. I have difficulties with the terminology. Nevertheless, I think that the question itself is specific enough, with real code sketches."}, {"owner": {"reputation": 6198, "user_id": 839601, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/d6db99aa846a8217f7e2aba6fa198e7c?s=128&d=identicon&r=PG", "display_name": "gnat", "link": "https://stackoverflow.com/users/839601/gnat"}, "reply_to_user": {"reputation": 1649, "user_id": 3684713, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/qo7tw.jpg?s=128&g=1", "display_name": "overactor", "link": "https://stackoverflow.com/users/3684713/overactor"}, "edited": false, "score": 0, "creation_date": 1497540320, "post_id": 44568376, "comment_id": 76131533, "body": "@overactor when referring other sites, it is often helpful to point that <a href=\"https://meta.stackexchange.com/tags/cross-posting/info\">cross-posting is frowned upon</a>"}, {"owner": {"reputation": 28873, "user_id": 1068232, "user_type": "registered", "accept_rate": 79, "profile_image": "https://www.gravatar.com/avatar/2a0a145ce58c20013969fe3f203531da?s=128&d=identicon&r=PG", "display_name": "Andr&#225;s Kov&#225;cs", "link": "https://stackoverflow.com/users/1068232/andr%c3%a1s-kov%c3%a1cs"}, "edited": false, "score": 1, "creation_date": 1497541685, "post_id": 44568376, "comment_id": 76132444, "body": "Your <code>read</code> is just function application with reversed arguments. Likewise <code>append</code> for binary functions. They don&#39;t provide us anything; you&#39;d be better off just applying functions."}, {"owner": {"reputation": 28376, "user_id": 5743988, "user_type": "registered", "accept_rate": 67, "profile_image": "https://i.stack.imgur.com/IeSSM.jpg?s=128&g=1", "display_name": "4castle", "link": "https://stackoverflow.com/users/5743988/4castle"}, "reply_to_user": {"reputation": 28873, "user_id": 1068232, "user_type": "registered", "accept_rate": 79, "profile_image": "https://www.gravatar.com/avatar/2a0a145ce58c20013969fe3f203531da?s=128&d=identicon&r=PG", "display_name": "Andr&#225;s Kov&#225;cs", "link": "https://stackoverflow.com/users/1068232/andr%c3%a1s-kov%c3%a1cs"}, "edited": false, "score": 0, "creation_date": 1497543141, "post_id": 44568376, "comment_id": 76133275, "body": "@Andr&#225;sKov&#225;cs I think that&#39;s intentional. Haskell has no universal <code>read</code> definition, it inherits the definition of <code>read</code> from the <code>Read a</code> typeclass which gets provided as an invisible parameter in Haskell as a lookup table. It would make more sense probably if they did <code>cons.read(x)</code> instead of <code>cons(x)</code>"}, {"owner": {"user_type": "does_not_exist", "display_name": "user6445533"}, "reply_to_user": {"reputation": 28873, "user_id": 1068232, "user_type": "registered", "accept_rate": 79, "profile_image": "https://www.gravatar.com/avatar/2a0a145ce58c20013969fe3f203531da?s=128&d=identicon&r=PG", "display_name": "Andr&#225;s Kov&#225;cs", "link": "https://stackoverflow.com/users/1068232/andr%c3%a1s-kov%c3%a1cs"}, "edited": false, "score": 0, "creation_date": 1497546247, "post_id": 44568376, "comment_id": 76134928, "body": "@Andr&#225;sKov&#225;cs No offence, but this seems to be rather an argument from authority. In view of your reputation in Haskell your advice is probably right though: &quot;<i>you&#39;d be better off just applying normal functions</i>&quot;. However, I think <code>read</code>/<code>append_</code> aren&#39;t normal functions, regardless of their argument order. They take their value constructor or type constraint explicitly as an argument. Hence they are more generic than &quot;regular functions&quot;."}, {"owner": {"reputation": 24028, "user_id": 383200, "user_type": "registered", "accept_rate": 60, "profile_image": "https://www.gravatar.com/avatar/a9dc722f936cb1059adaae4fe39c07f0?s=128&d=identicon&r=PG", "display_name": "Carl", "link": "https://stackoverflow.com/users/383200/carl"}, "edited": false, "score": 2, "creation_date": 1497552247, "post_id": 44568376, "comment_id": 76138270, "body": "Your <code>ChurchMaybe</code> type isn&#39;t an existential. The constructor doesn&#39;t hide any type choices made by its caller. It forces the caller to provide a polymorphic function, which is the opposite of a hidden choice - it&#39;s an explicit inability to make a choice."}, {"owner": {"user_type": "does_not_exist", "display_name": "user6445533"}, "reply_to_user": {"reputation": 24028, "user_id": 383200, "user_type": "registered", "accept_rate": 60, "profile_image": "https://www.gravatar.com/avatar/a9dc722f936cb1059adaae4fe39c07f0?s=128&d=identicon&r=PG", "display_name": "Carl", "link": "https://stackoverflow.com/users/383200/carl"}, "edited": false, "score": 0, "creation_date": 1497553872, "post_id": 44568376, "comment_id": 76139170, "body": "@Carl OK, I misunderstood existential types. Thanks for the clarification. I&#39;ll look into the subject more closely."}, {"owner": {"reputation": 37219, "user_id": 1523776, "user_type": "moderator", "accept_rate": 87, "profile_image": "https://www.gravatar.com/avatar/b3e0b5c8e42a8c38009ef2d969f8dabb?s=128&d=identicon&r=PG", "display_name": "Benjamin Hodgson", "link": "https://stackoverflow.com/users/1523776/benjamin-hodgson"}, "reply_to_user": {"reputation": 28873, "user_id": 1068232, "user_type": "registered", "accept_rate": 79, "profile_image": "https://www.gravatar.com/avatar/2a0a145ce58c20013969fe3f203531da?s=128&d=identicon&r=PG", "display_name": "Andr&#225;s Kov&#225;cs", "link": "https://stackoverflow.com/users/1068232/andr%c3%a1s-kov%c3%a1cs"}, "edited": false, "score": 1, "creation_date": 1497566292, "post_id": 44568376, "comment_id": 76144960, "body": "I don&#39;t think you&#39;re going to get a satisfactory answer to this question. 1, JS is a <i>totally</i> different language to Haskell, so you shouldn&#39;t expect a Haskell concept to have an equivalent in JS. (A phrase like &quot;return type polymorphism&quot;, which talks about a type, isn&#39;t meaningful in an language without types.) 2, as @Andr&#225;sKov&#225;cs points out, your JS <code>read</code> doesn&#39;t really have any connection to Haskell&#39;s <code>read</code> - it doesn&#39;t parse a value from a string, it&#39;s just <code>flip ($)</code>. 3, it&#39;s unclear what you&#39;re asking: the q reads as a collection of loosely related concepts, not a coherent question"}, {"owner": {"reputation": 28376, "user_id": 5743988, "user_type": "registered", "accept_rate": 67, "profile_image": "https://i.stack.imgur.com/IeSSM.jpg?s=128&g=1", "display_name": "4castle", "link": "https://stackoverflow.com/users/5743988/4castle"}, "reply_to_user": {"reputation": 37219, "user_id": 1523776, "user_type": "moderator", "accept_rate": 87, "profile_image": "https://www.gravatar.com/avatar/b3e0b5c8e42a8c38009ef2d969f8dabb?s=128&d=identicon&r=PG", "display_name": "Benjamin Hodgson", "link": "https://stackoverflow.com/users/1523776/benjamin-hodgson"}, "edited": false, "score": 1, "creation_date": 1497579657, "post_id": 44568376, "comment_id": 76148198, "body": "@BenjaminHodgson On your first point, part of the purpose of implementing Haskell-like features in JavaScript is because it gives an opportunity to learn more about type systems by trying to design one. I really like these &quot;implement Haskell in JS&quot; questions because they&#39;re more academic than most JS questions."}, {"owner": {"user_type": "does_not_exist", "display_name": "user6445533"}, "reply_to_user": {"reputation": 37219, "user_id": 1523776, "user_type": "moderator", "accept_rate": 87, "profile_image": "https://www.gravatar.com/avatar/b3e0b5c8e42a8c38009ef2d969f8dabb?s=128&d=identicon&r=PG", "display_name": "Benjamin Hodgson", "link": "https://stackoverflow.com/users/1523776/benjamin-hodgson"}, "edited": false, "score": 0, "creation_date": 1497591552, "post_id": 44568376, "comment_id": 76151246, "body": "@Benjamin 1. I didn&#39;t expect that at all. On the contrary, I am excited how many advanced functional concepts I am able to express or at least mimic just with pure, first class functions. 2. When you combine <code>read</code> with <code>prompt</code> it does parse a value from a <code>String</code>. It&#39;s all about guidelines or policies in JS. 3. I misunderstood existential types, sorry. I should have omitted them. Otherwise I couldn&#39;t see why the question is not coherent. Maybe it is poor in terminology, but not incoherent."}, {"owner": {"user_type": "does_not_exist", "display_name": "user6445533"}, "reply_to_user": {"reputation": 37219, "user_id": 1523776, "user_type": "moderator", "accept_rate": 87, "profile_image": "https://www.gravatar.com/avatar/b3e0b5c8e42a8c38009ef2d969f8dabb?s=128&d=identicon&r=PG", "display_name": "Benjamin Hodgson", "link": "https://stackoverflow.com/users/1523776/benjamin-hodgson"}, "edited": false, "score": 0, "creation_date": 1497592460, "post_id": 44568376, "comment_id": 76151612, "body": "@Benjamin Yes of course, in an untyped language you can simply ignore types. You can just hack around, make things up as you see fit and produce a code mess. This is sufficient if you don&#39;t have the ambition to create something serious. I believe in the opposite. In the absence of a compiler your mind must pitch in. If you see a bunch of Javascript code you need to recognize the underlying types and the morphisms between them. Sure, it is sometimes hard to force yourself to do so. However, I believe you can develop some mastery of types, even as a developer of an untyped language."}, {"owner": {"reputation": 37219, "user_id": 1523776, "user_type": "moderator", "accept_rate": 87, "profile_image": "https://www.gravatar.com/avatar/b3e0b5c8e42a8c38009ef2d969f8dabb?s=128&d=identicon&r=PG", "display_name": "Benjamin Hodgson", "link": "https://stackoverflow.com/users/1523776/benjamin-hodgson"}, "edited": false, "score": 0, "creation_date": 1497617900, "post_id": 44568376, "comment_id": 76167322, "body": "@ftor I apologise. I should have been more aware of my tone. I&#39;d intended my comment to be question-asking advice but I can totally see upon re-reading it now that I just came across as rude. I&#39;m sorry I gave you a bad experience and I hope I haven&#39;t put you off continuing to learn this wonderful language. (PS I wasn&#39;t ignoring you deliberately, I&#39;m just having a busy week.)"}, {"owner": {"reputation": 37219, "user_id": 1523776, "user_type": "moderator", "accept_rate": 87, "profile_image": "https://www.gravatar.com/avatar/b3e0b5c8e42a8c38009ef2d969f8dabb?s=128&d=identicon&r=PG", "display_name": "Benjamin Hodgson", "link": "https://stackoverflow.com/users/1523776/benjamin-hodgson"}, "edited": false, "score": 0, "creation_date": 1497618306, "post_id": 44568376, "comment_id": 76167569, "body": "I&#39;ll try to write up a (less rude) answer elaborating on what I meant."}, {"owner": {"user_type": "does_not_exist", "display_name": "user6445533"}, "reply_to_user": {"reputation": 37219, "user_id": 1523776, "user_type": "moderator", "accept_rate": 87, "profile_image": "https://www.gravatar.com/avatar/b3e0b5c8e42a8c38009ef2d969f8dabb?s=128&d=identicon&r=PG", "display_name": "Benjamin Hodgson", "link": "https://stackoverflow.com/users/1523776/benjamin-hodgson"}, "edited": false, "score": 0, "creation_date": 1497718853, "post_id": 44568376, "comment_id": 76201279, "body": "@BenjaminHodgson I&#39;ve been working on a way to adapt Haskell idioms for an untyped environment for months now. To expect others to recognize my intention and every detail is inappropriate. My superficial knowledge of Haskell is also not that useful to express a meaningful question. So, uhm, sorry for the mess."}, {"owner": {"reputation": 37219, "user_id": 1523776, "user_type": "moderator", "accept_rate": 87, "profile_image": "https://www.gravatar.com/avatar/b3e0b5c8e42a8c38009ef2d969f8dabb?s=128&d=identicon&r=PG", "display_name": "Benjamin Hodgson", "link": "https://stackoverflow.com/users/1523776/benjamin-hodgson"}, "edited": false, "score": 0, "creation_date": 1497718909, "post_id": 44568376, "comment_id": 76201293, "body": "@ftor Hope my answer helped. No hard feelings?"}, {"owner": {"user_type": "does_not_exist", "display_name": "user6445533"}, "reply_to_user": {"reputation": 37219, "user_id": 1523776, "user_type": "moderator", "accept_rate": 87, "profile_image": "https://www.gravatar.com/avatar/b3e0b5c8e42a8c38009ef2d969f8dabb?s=128&d=identicon&r=PG", "display_name": "Benjamin Hodgson", "link": "https://stackoverflow.com/users/1523776/benjamin-hodgson"}, "edited": false, "score": 0, "creation_date": 1497718960, "post_id": 44568376, "comment_id": 76201309, "body": "@BenjaminHodgson Actually, it helped. Everything OK."}], "answers": [{"comments": [{"owner": {"user_type": "does_not_exist", "display_name": "user6445533"}, "edited": false, "score": 0, "creation_date": 1497593224, "post_id": 44579662, "comment_id": 76151912, "body": "I am particularly interested in functions that are polymorphic in their return type, i.e. the context determines of what type the return value of a function finally is. I&#39;ll look at your answer in more detail later. Thanks!"}, {"owner": {"reputation": 28376, "user_id": 5743988, "user_type": "registered", "accept_rate": 67, "profile_image": "https://i.stack.imgur.com/IeSSM.jpg?s=128&g=1", "display_name": "4castle", "link": "https://stackoverflow.com/users/5743988/4castle"}, "edited": false, "score": 0, "creation_date": 1497618873, "post_id": 44579662, "comment_id": 76167946, "body": "Essentially my answer works by identifying all the type signatures which have a <code>=&gt;</code> and changing it to a <code>-&gt;</code>. For an example, look at <code>readMaybe</code>. I didn&#39;t fully implement a type inference algorithm, so that type parameter has to be provided explicitly. I&#39;d be interested to see how type inference could be implemented."}, {"owner": {"user_type": "does_not_exist", "display_name": "user6445533"}, "edited": false, "score": 0, "creation_date": 1519165278, "post_id": 44579662, "comment_id": 84796150, "body": "It&#39;s been a while, sorry, but <code>read (Maybe(Int())</code> looks like you pass the type itself to <code>read</code> rather than the function of the corresponding instance. Dispatching the right function depending on its type representation seems to be just an indirection, right? You probably did it for learning purposes. Anyway, using functions to represent types is a good idea."}, {"owner": {"reputation": 28376, "user_id": 5743988, "user_type": "registered", "accept_rate": 67, "profile_image": "https://i.stack.imgur.com/IeSSM.jpg?s=128&g=1", "display_name": "4castle", "link": "https://stackoverflow.com/users/5743988/4castle"}, "edited": false, "score": 0, "creation_date": 1519165570, "post_id": 44579662, "comment_id": 84796264, "body": "@ftor Right, it was just a bit of indirection so that the syntax looked more Haskell-like. It also allows <code>readMaybe</code> to be implemented without adding it as a method of every type that implements <code>Read</code>."}], "tags": [], "owner": {"reputation": 28376, "user_id": 5743988, "user_type": "registered", "accept_rate": 67, "profile_image": "https://i.stack.imgur.com/IeSSM.jpg?s=128&g=1", "display_name": "4castle", "link": "https://stackoverflow.com/users/5743988/4castle"}, "is_accepted": false, "score": 1, "last_activity_date": 1497580175, "last_edit_date": 1497580175, "creation_date": 1497578468, "answer_id": 44579662, "question_id": 44568376, "link": "https://stackoverflow.com/questions/44568376/how-can-the-lack-of-return-type-polymorphism-in-untyped-languages-be-alleviated/44579662#44579662", "title": "How can the lack of return type polymorphism in untyped languages be alleviated?", "body": "<p>If I understand your question correctly, you would like to know how to implement functions which need access to the methods of a type class so that they can be polymorphic.</p>\n\n<p>One way to think about type classes is as lookup tables between types and implementations. For example, <code>Show</code> would be a mapping of types to functions which return strings. <a href=\"http://okmij.org/ftp/Computation/typeclass.html\" rel=\"nofollow noreferrer\">This article</a> explains this in more detail and also gives some alternative ways to implement type classes.</p>\n\n<p>In a language that doesn't support types at all, you will have to implement the types as some kind of unique value which you can pass to polymorphic functions \u2014 such as a string, symbol, or object reference. I prefer an object reference because it means I can implement my types as functions and gain the ability to implement parameterized types.</p>\n\n<p>Here's an example of how you could implement <code>Read</code> for <code>Maybe</code> and <code>Int</code>:</p>\n\n<p><div class=\"snippet\" data-lang=\"js\" data-hide=\"false\" data-console=\"true\" data-babel=\"true\">\r\n<div class=\"snippet-code\">\r\n<pre class=\"snippet-code-js lang-js prettyprint-override\"><code>// MACROS\r\nconst TYPE = (constructor, ...args) =&gt; Object.freeze({ constructor, args });\r\nconst TYPECLASS = (name, defaultMethods = {}) =&gt; {\r\n  const id = Symbol(name);\r\n  const typeClass = ({ constructor, args }) =&gt; {\r\n    return Object.assign({}, defaultMethods, constructor[id](...args));\r\n  };\r\n  typeClass._instance_ = (constructor, implementation) =&gt; {\r\n    constructor[id] = implementation;\r\n  };\r\n  return Object.freeze(typeClass);\r\n};\r\n\r\n// TYPES\r\nconst Int   = () =&gt; TYPE(Int);\r\nconst Maybe = a =&gt; TYPE(Maybe, a);\r\n\r\n// DATA CONSTRUCTORS\r\nconst Just    = x =&gt; r =&gt; f =&gt; f(x);\r\nconst Nothing =      r =&gt; f =&gt; r;\r\n\r\n// TYPE CLASSES and INSTANCES\r\nconst Read = TYPECLASS('Read');\r\n\r\nRead._instance_(Maybe, A =&gt; ({\r\n  read: str =&gt;\r\n    str.slice(0, 5) === \"Just \"\r\n      ? Just (Read(A).read(str.slice(5)))\r\n      : str === \"Nothing\"\r\n        ? Nothing\r\n        : undefined\r\n}));\r\n\r\nRead._instance_(Int, () =&gt; ({\r\n  read: str =&gt; {\r\n    const num = parseInt(str);\r\n    return isNaN(num) ? undefined : num;\r\n  }\r\n}));\r\n\r\n// FUNCTIONS\r\nconst error = msg =&gt; { throw new Error(msg); };\r\nconst maybe = x =&gt; f =&gt; m =&gt; m(x)(f);\r\nconst isJust = maybe (false) (_ =&gt; true);\r\nconst fromJust = maybe (undefined) (x =&gt; x);\r\nconst read = A =&gt; str =&gt; {\r\n  const x = Read(A).read(str);\r\n  return x === undefined ? error (\"read: no parse\") : x;\r\n};\r\nconst readMaybe = A =&gt; str =&gt; {\r\n  try       { return Just (read (A) (str)); }\r\n  catch (e) { return Nothing; }\r\n};\r\n\r\n// TESTS\r\nconsole.log([\r\n  fromJust (read (Maybe(Int())) (\"Just 123\")), // 123\r\n  read (Int()) (\"123\"),                        // 123  \r\n  fromJust (readMaybe (Int()) (\"abc\"))         // undefined\r\n]);</code></pre>\r\n</div>\r\n</div>\r\n</p>\n"}, {"comments": [{"owner": {"user_type": "does_not_exist", "display_name": "user6445533"}, "edited": false, "score": 0, "creation_date": 1523561845, "post_id": 44590733, "comment_id": 86623824, "body": "Sorry for my ignorance back then. Return type polymorphism actually makes no sense in dynamically typed languages. Without a value there is no type to introspect. It&#39;s that simple."}], "tags": [], "owner": {"reputation": 37219, "user_id": 1523776, "user_type": "moderator", "accept_rate": 87, "profile_image": "https://www.gravatar.com/avatar/b3e0b5c8e42a8c38009ef2d969f8dabb?s=128&d=identicon&r=PG", "display_name": "Benjamin Hodgson", "link": "https://stackoverflow.com/users/1523776/benjamin-hodgson"}, "is_accepted": true, "score": 4, "last_activity_date": 1497648304, "last_edit_date": 1497648304, "creation_date": 1497620374, "answer_id": 44590733, "question_id": 44568376, "link": "https://stackoverflow.com/questions/44568376/how-can-the-lack-of-return-type-polymorphism-in-untyped-languages-be-alleviated/44590733#44590733", "title": "How can the lack of return type polymorphism in untyped languages be alleviated?", "body": "<p>In <a href=\"https://stackoverflow.com/questions/44568376/how-can-the-lack-of-return-type-polymorphism-in-untyped-languages-be-alleviated?noredirect=1#comment76144960_44568376\">a comment</a> I made an assertion without justifying myself: I said that return type polymorphism isn't a meaningful concept in an untyped language. That was rude of me and I apologise for being so brusque. What I meant was something rather more subtle than what I said, so please allow me to attempt to make amends for my poor communication by explaining in more detail what I was trying to get at. (I hope this answer doesn't come across as condescending; I don't know your base level of knowledge so I'm going to start at the beginning.)</p>\n\n<p>When Haskellers say \"return type polymorphism\", they're referring to one particular effect of the type class dispatch mechanism. It comes about as the interplay between <em>dictionary passing</em> and <em>bidirectional type inference</em>. (I'm going to ignore polymorphic <code>_|_</code>s like <code>undefined :: forall a. a</code> or <code>let x = x in x :: forall a. a</code>. They don't really count.)</p>\n\n<p>First, note that type class instances in Haskell are syntactic sugar for explicit dictionary passing. By the time GHC translates your program into its Core intermediate representation, all the type classes are gone. They are replaced with \"dictionary\" records and passed around as regular explicit arguments; <code>=&gt;</code> is represented at runtime as <code>-&gt;</code>. So code like</p>\n\n<pre><code>class Eq a where\n    (==) :: a -&gt; a -&gt; Bool\ninstance Eq Bool where\n    True == True = True\n    False == False = True\n    _ == _ = False\n\nheadEq :: Eq a =&gt; a -&gt; [a] -&gt; Bool\nheadEq _ [] = False\nheadEq x (y:_) = x == y\n\nmain = print $ headEq True [False]\n</code></pre>\n\n<p>is translated into something like</p>\n\n<pre><code>-- The class declaration is translated into a regular record type. (D for Dictionary)\ndata EqD a = EqD { eq :: a -&gt; a -&gt; Bool }\n-- The instance is translated into a top-level value of that type\neqDBool :: EqD Bool\neqDBool = EqD { eq = eq }\n    where eq True True = True\n          eq False False = True\n          eq _ _ = False\n\n-- the Eq constraint is translated into a regular dictionary argument\nheadEq :: EqD a -&gt; a -&gt; [a] -&gt; Bool\nheadEq _ _ [] = False\nheadEq eqD x (y:_) = eq eqD x y\n\n-- the elaborator sees you're calling headEq with a ~ Bool and passes in Bool's instance dictionary\nmain = print $ headEq eqDBool True [False]\n</code></pre>\n\n<p>It works because of <em>instance coherence</em>: every constraint has at most one \"best\" matching <code>instance</code> (unless you switch on <code>IncoherentInstances</code>, which is usually a bad idea). At the call site of an overloaded function, the elaborator looks at the constraint's type parameter, searches for an instance matching that constraint - either a top-level <code>instance</code> or a constraint that's in scope - and passes in the single corresponding dictionary as an argument. (For more on the notion of instance coherence I recommend <a href=\"https://www.youtube.com/watch?v=hIZxTQP1ifo\" rel=\"nofollow noreferrer\">this talk</a> by Ed Kmett. It's quite advanced - it took me a couple of watches to grasp his point - but it's full of insight.)</p>\n\n<p>Much of the time, as in <code>headEq</code>, the constraint's type parameters can be determined by looking only at the types of the overloaded function's arguments, but in the case of polymorphic return values (such as <code>read :: Read a =&gt; String -&gt; a</code> or <code>mempty :: Monoid m =&gt; m</code>) the typing information has to come from the call site's context. This works via the usual mechanism of bidirectional type inference: GHC looks at the return value's usages, generates and solves unification constraints to figure out its type, and then uses that type to search for an instance. It makes for a kinda magical developer experience: you write <code>mempty</code> and the machine figures out from the context which <code>mempty</code> you meant!</p>\n\n<p>(Incidentally, that's why <code>show . read :: String -&gt; String</code> is forbidden. <code>show</code> and <code>read</code> are type class methods, whose concrete implementation isn't known without any clues about the type at which they're being used. The intermediate type in <code>show . read</code> - the one you're reading into and then showing from - is ambiguous, so GHC doesn't know how to choose an instance dictionary in order to generate runtime code.)</p>\n\n<p>So \"return type polymorphism\" is actually a slightly misleading term. It's really a by-word for a particular kind of <em>type-directed code generation</em>; its Core representation is just as a regular function whose return type can be determined from the type of its (dictionary) argument. In a language without type classes (or a language without types at all, like JS), you have to simulate type classes with explicit dictionary parameters that are manually passed around by the programmer, as @4Castle has demonstrated in <a href=\"https://stackoverflow.com/a/44579662/1523776\">another answer</a>. You can't do type-directed code generation without types to be directed by!</p>\n"}], "owner": {"user_type": "does_not_exist", "display_name": "user6445533"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 268, "favorite_count": 1, "accepted_answer_id": 44590733, "answer_count": 2, "score": 3, "last_activity_date": 1497648304, "creation_date": 1497532038, "last_edit_date": 1497533718, "question_id": 44568376, "link": "https://stackoverflow.com/questions/44568376/how-can-the-lack-of-return-type-polymorphism-in-untyped-languages-be-alleviated", "title": "How can the lack of return type polymorphism in untyped languages be alleviated?", "body": "<p>I've been working with Church encoding recently and when I look at a typical type</p>\n\n<pre class=\"lang-haskell prettyprint-override\"><code>newtype ChurchMaybe a = \n ChurchMaybe { runChurchMaybe :: forall r . r -&gt; (a -&gt; r) -&gt; r }\n</code></pre>\n\n<p>it looks as if functions with an existential type (<code>runChurchMaybe</code>) might behave similarly to functions that are polymorphic in their return type. I haven't fully understood the logic behind existential types though. So I am probably wrong.</p>\n\n<p>Now I've often read that monads are less useful in untyped languages like Javascript, also because of the lack of return type polymorphism. So I wondered if I can ease this shortcoming:</p>\n\n<p><div class=\"snippet\" data-lang=\"js\" data-hide=\"false\" data-console=\"true\" data-babel=\"false\">\r\n<div class=\"snippet-code\">\r\n<pre class=\"snippet-code-js lang-js prettyprint-override\"><code>// JS version of Haskell's read\r\n\r\n// read :: String -&gt; forall r . (String -&gt; r) -&gt; r\r\nconst read = x =&gt; cons =&gt; cons(x);\r\n\r\n// option type\r\n\r\nconst Some = x =&gt; r =&gt; f =&gt; f(x);\r\nconst None =      r =&gt; f =&gt; r;\r\n\r\nconsole.log(\r\n  read(prompt(\"any string\")) (Array.of) // [a]\r\n);\r\n\r\nconsole.log(\r\n  read(prompt(\"any string\")) (Some) // Some(a)\r\n);\r\n\r\nconsole.log(\r\n  read(prompt(\"number string\")) (x =&gt; Number(x)) // Number\r\n);\r\n\r\nconst append_ = x =&gt; y =&gt; append =&gt; append(x) (y);\r\n\r\nconst all = x =&gt; y =&gt; x &amp;&amp; y;\r\nconst any = x =&gt; y =&gt; x || y;\r\nconst add = x =&gt; y =&gt; x + y;\r\n\r\nconst semigroup = append_(true) (false)\r\n\r\nsemigroup(all); // false\r\nsemigroup(any); // true\r\nsemigroup(add); // 1</code></pre>\r\n</div>\r\n</div>\r\n</p>\n\n<p>Obviously, <code>read</code> isn't polymorphic in its return type, because it always  returns a lambda. However, this lambda can serve as a proxy of the actual return value and the context is now able to determine what type this proxy actually produces by passing a suitable constructor.</p>\n\n<p>And while <code>read</code> can produce any type, <code>append_</code> is limited to types that have a semigroup constraint.</p>\n\n<p>Of course there is now a little noise in the context of such functions, since they return a proxy instead of the actual result.</p>\n\n<p>Is this essentially the mechanism behind the term \"return type polymorphism\"? This subject seems to be quite complex and so I guess I am missing something. Any help is appreciated.</p>\n"}, {"tags": ["haskell", "google-api", "yesod"], "comments": [{"owner": {"reputation": 13734, "user_id": 938694, "user_type": "registered", "accept_rate": 59, "profile_image": "https://www.gravatar.com/avatar/b6678a430a805dd78366d6e135b49f2d?s=128&d=identicon&r=PG", "display_name": "Cubic", "link": "https://stackoverflow.com/users/938694/cubic"}, "edited": false, "score": 0, "creation_date": 1497532255, "post_id": 44567028, "comment_id": 76125363, "body": "Hi. Questions on stackoverflow are intended to be self-contained (it should still make sense even if every single link in your question were invalid). Please post a <i>small</i> code snippet that reproduces the problem you&#39;re having."}], "answers": [{"tags": [], "owner": {"reputation": 320, "user_id": 7255965, "user_type": "registered", "accept_rate": 60, "profile_image": "https://www.gravatar.com/avatar/201ab93839e2c4184b8b6930fb434e58?s=128&d=identicon&r=PG&f=1", "display_name": "Yotam Ohad", "link": "https://stackoverflow.com/users/7255965/yotam-ohad"}, "is_accepted": false, "score": 0, "last_activity_date": 1497691660, "creation_date": 1497691660, "answer_id": 44602918, "question_id": 44567028, "link": "https://stackoverflow.com/questions/44567028/google-api-not-responding-when-login-in/44602918#44602918", "title": "Google+ API not responding when login in", "body": "<p>The problem was I did not implement the <code>getAuthId</code> function in the instance for <code>YesodAuth App</code>. I am not sure why this did not appear as an error/warning when I built it with stack.</p>\n"}], "owner": {"reputation": 320, "user_id": 7255965, "user_type": "registered", "accept_rate": 60, "profile_image": "https://www.gravatar.com/avatar/201ab93839e2c4184b8b6930fb434e58?s=128&d=identicon&r=PG&f=1", "display_name": "Yotam Ohad", "link": "https://stackoverflow.com/users/7255965/yotam-ohad"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 40, "favorite_count": 0, "answer_count": 1, "score": 1, "last_activity_date": 1497691660, "creation_date": 1497528253, "last_edit_date": 1497553028, "question_id": 44567028, "link": "https://stackoverflow.com/questions/44567028/google-api-not-responding-when-login-in", "title": "Google+ API not responding when login in", "body": "<p>I am working on a website, and to save me the trouble of a private database I decided to use the Google API to authenticate users. I followed <a href=\"https://www.yesodweb.com/book/authentication-and-authorization\" rel=\"nofollow noreferrer\">this</a> guide. I copied the code and yet when I run it and try to log in, I get the google screen where I choose the account to log in with. I choose my account and then it keeps on loading for a lot of time (I left it for half an hour with no change). In addition, The application starts eating my ram (it uses everything it can from my 16GB).</p>\n\n<p>I am not sure where it went wrong. Maybe someone encountered this thing before?</p>\n\n<p>Cheers</p>\n\n<p>Edit:\nHere is the code I use:</p>\n\n<pre><code>{-# LANGUAGE MultiParamTypeClasses #-}\n{-# LANGUAGE OverloadedStrings     #-}\n{-# LANGUAGE QuasiQuotes           #-}\n{-# LANGUAGE TemplateHaskell       #-}\n{-# LANGUAGE TypeFamilies          #-}\n\nmodule Main where\n\nimport Data.Default (def)\nimport Data.Text (Text)\nimport Network.HTTP.Client.Conduit (Manager, newManager)\nimport Yesod\nimport Yesod.Auth\nimport Yesod.Auth.BrowserId\nimport Yesod.Auth.GoogleEmail2\n\nclientId :: Text\nclientId = \"\" --Removed it for public view\n\nclientSecret :: Text\nclientSecret = \"\" --Removed it for public view\n\ndata App = App\n    { httpManager :: Manager\n    }\n\nmkYesod \"App\" [parseRoutes|\n/ HomeR GET\n/auth AuthR Auth getAuth\n|]\n\ninstance Yesod App where\n    approot = ApprootStatic \"http://localhost:3000\"\n\ninstance YesodAuth App where\n    type AuthId App = Text\n\n    loginDest _ = HomeR\n    logoutDest _ = HomeR\n\n    authPlugins _ =\n        [ authGoogleEmail clientId clientSecret\n        ]\n\n    authHttpManager = httpManager\n\n    maybeAuthId = lookupSession \"_ID\"\n\ninstance RenderMessage App FormMessage where\n    renderMessage _ _ = defaultFormMessage\n\ngetHomeR :: Handler Html\ngetHomeR = do\n  maid &lt;- maybeAuthId\n  defaultLayout\n      [whamlet|\n          &lt;p&gt;Your current auth ID: #{show maid}\n          $maybe _ &lt;- maid\n              &lt;p&gt;\n                  &lt;a href=@{AuthR LogoutR}&gt;Logout\n          $nothing\n              &lt;p&gt;\n                  &lt;a href=@{AuthR LoginR}&gt;Go to the login page\n      |]\n\nmain :: IO ()\nmain = do\n    man &lt;- newManager\n    warp 3000 $ App man\n</code></pre>\n\n<p>And here is snippet from the cabal file (I use stack to build the executable):</p>\n\n<pre><code>executable App-exe\n  hs-source-dirs:      app\n  main-is:             Main.hs\n  ghc-options:         -threaded -rtsopts -with-rtsopts=-N\n  build-depends:       base\n                     , yesod\n                     , yesod-auth\n                     , text\n                     , http-conduit\n                     , data-default\n                     , OWTeamQueue\n  default-language:    Haskell2010\n</code></pre>\n"}, {"tags": ["haskell", "character-encoding", "haskell-pipes", "haskell-turtle"], "comments": [{"owner": {"reputation": 13734, "user_id": 938694, "user_type": "registered", "accept_rate": 59, "profile_image": "https://www.gravatar.com/avatar/b6678a430a805dd78366d6e135b49f2d?s=128&d=identicon&r=PG", "display_name": "Cubic", "link": "https://stackoverflow.com/users/938694/cubic"}, "edited": false, "score": 0, "creation_date": 1497528629, "post_id": 44566223, "comment_id": 76122808, "body": "Counter question: What&#39;s a line? Sounds obvious, but you need to know what a line is to count them. You could treat the entire file as bytes and say any occurrence of the byte &quot;10&quot; is a new line, so you count those. If that&#39;s your goal, you&#39;re better off reading with <code>ByteString</code> instead of <code>Text</code>. If you want something more sophisticated, you can&#39;t really get around someone <i>telling</i> you some information about what&#39;s in the files, because you can&#39;t, in general, guess the meaning of bytes just from seeing them."}, {"owner": {"reputation": 4593, "user_id": 2289983, "user_type": "registered", "accept_rate": 92, "profile_image": "https://i.stack.imgur.com/LG4hj.jpg?s=128&g=1", "display_name": "Damian Nadales", "link": "https://stackoverflow.com/users/2289983/damian-nadales"}, "reply_to_user": {"reputation": 13734, "user_id": 938694, "user_type": "registered", "accept_rate": 59, "profile_image": "https://www.gravatar.com/avatar/b6678a430a805dd78366d6e135b49f2d?s=128&d=identicon&r=PG", "display_name": "Cubic", "link": "https://stackoverflow.com/users/938694/cubic"}, "edited": false, "score": 0, "creation_date": 1497528834, "post_id": 44566223, "comment_id": 76122946, "body": "Indeed, in this case I could probably look around for bytes that correspond to line terminators, and work with <code>ByteString</code>s directly. However I would like to cover the case in which I want to try the files as character files (if I&#39;m gathering words for instance), and then I need a robust solution for decoding different encodings into text."}, {"owner": {"reputation": 13734, "user_id": 938694, "user_type": "registered", "accept_rate": 59, "profile_image": "https://www.gravatar.com/avatar/b6678a430a805dd78366d6e135b49f2d?s=128&d=identicon&r=PG", "display_name": "Cubic", "link": "https://stackoverflow.com/users/938694/cubic"}, "edited": false, "score": 0, "creation_date": 1497529081, "post_id": 44566223, "comment_id": 76123117, "body": "You need to know what encoding a file uses before decoding. You can guess, but that&#39;s brittle. If you&#39;re lucky, there&#39;s a <a href=\"http://unicode.org/faq/utf_bom.html#BOM\" rel=\"nofollow noreferrer\">BOM</a> at the start of the file and then it&#39;s <i>probably</i> Unicode, and if it is you even know which unicode encoding. But BOMs are not required, and even if you see one that doesn&#39;t <i>necessarily</i> mean the file is encoded in some unicode encoding. There&#39;s no truly robust way to get the encoding of a file without having metadata about the file available."}, {"owner": {"reputation": 4593, "user_id": 2289983, "user_type": "registered", "accept_rate": 92, "profile_image": "https://i.stack.imgur.com/LG4hj.jpg?s=128&g=1", "display_name": "Damian Nadales", "link": "https://stackoverflow.com/users/2289983/damian-nadales"}, "reply_to_user": {"reputation": 13734, "user_id": 938694, "user_type": "registered", "accept_rate": 59, "profile_image": "https://www.gravatar.com/avatar/b6678a430a805dd78366d6e135b49f2d?s=128&d=identicon&r=PG", "display_name": "Cubic", "link": "https://stackoverflow.com/users/938694/cubic"}, "edited": false, "score": 0, "creation_date": 1497529372, "post_id": 44566223, "comment_id": 76123299, "body": "I&#39;m wondering how <code>find $FPATH -type f -print | xargs cat | wc -l</code> deals with this..."}, {"owner": {"reputation": 13734, "user_id": 938694, "user_type": "registered", "accept_rate": 59, "profile_image": "https://www.gravatar.com/avatar/b6678a430a805dd78366d6e135b49f2d?s=128&d=identicon&r=PG", "display_name": "Cubic", "link": "https://stackoverflow.com/users/938694/cubic"}, "edited": false, "score": 0, "creation_date": 1497529445, "post_id": 44566223, "comment_id": 76123354, "body": "FYI if you already know the encoding and want to decode it now, that&#39;s what the <code>Data.Text.Encoding</code> module is for."}, {"owner": {"reputation": 4593, "user_id": 2289983, "user_type": "registered", "accept_rate": 92, "profile_image": "https://i.stack.imgur.com/LG4hj.jpg?s=128&g=1", "display_name": "Damian Nadales", "link": "https://stackoverflow.com/users/2289983/damian-nadales"}, "reply_to_user": {"reputation": 13734, "user_id": 938694, "user_type": "registered", "accept_rate": 59, "profile_image": "https://www.gravatar.com/avatar/b6678a430a805dd78366d6e135b49f2d?s=128&d=identicon&r=PG", "display_name": "Cubic", "link": "https://stackoverflow.com/users/938694/cubic"}, "edited": false, "score": 0, "creation_date": 1497529680, "post_id": 44566223, "comment_id": 76123525, "body": "Actually if I&#39;m scanning an arbitrary directory I can find any encoding, so I won&#39;t know the encoding in advance. I&#39;m looking at <code>Data.Text.Encoding</code> indeed, and see if it is possible to use <code>streamDecodeUtf8With</code> ignoring the errors."}, {"owner": {"reputation": 13734, "user_id": 938694, "user_type": "registered", "accept_rate": 59, "profile_image": "https://www.gravatar.com/avatar/b6678a430a805dd78366d6e135b49f2d?s=128&d=identicon&r=PG", "display_name": "Cubic", "link": "https://stackoverflow.com/users/938694/cubic"}, "edited": false, "score": 1, "creation_date": 1497529865, "post_id": 44566223, "comment_id": 76123668, "body": "<code>wc l</code> <i>doesn&#39;t</i> deal with this. It just looks for the byte &#39;10&#39; in the file. &quot; so I won&#39;t know the encoding in advance&quot; see, and that&#39;s the problem. There&#39;s no magic way to know the encoding of a file. You can try some the most common ones and see if any of them give reasonable-seeming results, but you can&#39;t, in general, figure out if some arbitrary blob is encoded with some arbitrary encoding. That&#39;s why the content-type header in HTML exists."}], "owner": {"reputation": 4593, "user_id": 2289983, "user_type": "registered", "accept_rate": 92, "profile_image": "https://i.stack.imgur.com/LG4hj.jpg?s=128&g=1", "display_name": "Damian Nadales", "link": "https://stackoverflow.com/users/2289983/damian-nadales"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 119, "favorite_count": 0, "answer_count": 0, "score": 0, "last_activity_date": 1497534133, "creation_date": 1497525700, "last_edit_date": 1497534133, "question_id": 44566223, "link": "https://stackoverflow.com/questions/44566223/turtle-dealing-with-non-utf8-input", "title": "Turtle: dealing with non-utf8 input", "body": "<p>In my path to learning Pipes, I've run into problems when dealing with non-utf8 files. That is why I've took a detour into the Turtle library to try to understand how to solve the problem there, at higher level of abstraction.</p>\n\n<p>The exercise I want to do is quite simple: find the sum of all the lines of all regular files reachable from a given directory. This is readily implemented by the following shell command:</p>\n\n<pre><code>find $FPATH -type f -print | xargs cat | wc -l\n</code></pre>\n\n<p>I've come up with the following solution:</p>\n\n<pre><code>import qualified Control.Foldl as F\nimport qualified Turtle        as T\n\n-- | Returns true iff the file path is not a symlink.\nnoSymLink :: T.FilePath -&gt; IO Bool\nnoSymLink fPath = (not . T.isSymbolicLink) &lt;$&gt; T.stat fPath\n\n-- | Shell that outputs the regular files in the given directory.\nregularFilesIn :: T.FilePath -&gt; T.Shell T.FilePath\nregularFilesIn fPath = do\n  fInFPath &lt;- T.lsif noSymLink fPath\n  st &lt;- T.stat fInFPath\n  if T.isRegularFile st\n    then return fInFPath\n    else T.empty\n\n-- | Read lines of `Text` from all the regular files under the given directory\n-- path.\ninputDir :: T.FilePath -&gt; T.Shell T.Line\ninputDir fPath = do\n  file &lt;- regularFilesIn fPath\n  T.input file\n\n-- | Print the number of lines in all the files in a directory.\nprintLinesCountIn :: T.FilePath -&gt; IO ()\nprintLinesCountIn fPath = do\n  count &lt;- T.fold (inputDir fPath) F.length\n  print count\n</code></pre>\n\n<p>This solution gives the correct result, as long as there are no non-utf8 files in the directory. If this is not the case, the program will raise an exception like the following one:</p>\n\n<pre><code>*** Exception: test/resources/php_ext_syslog.h: hGetLine: invalid argument (invalid byte sequence)\n</code></pre>\n\n<p>Which is to be expected since:</p>\n\n<pre><code>$ file -I test/resources/php_ext_syslog.h\ntest/resources/php_ext_syslog.h: text/x-c; charset=iso-8859-1\n</code></pre>\n\n<p>I was wondering how to solve the problem of reading different encodings into <code>Text</code>, so that the program can deal with this. For the problem at hand I guess I could avoid the conversion to <code>Text</code>, but I'd rather know how to do this, since you could imagine a situation in which, for instance, I would like to make a set with all the words under a certain directory.</p>\n\n<p><strong>EDIT</strong></p>\n\n<p>For what is worth so far the only solution I could come up with is the following:</p>\n\n<pre><code>mDecodeByteString :: T.Shell ByteString -&gt; T.Shell T.Text\nmDecodeByteString = gMDecodeByteString (streamDecodeUtf8With lenientDecode)\n  where gMDecodeByteString :: (ByteString -&gt; Decoding)\n                             -&gt; T.Shell ByteString\n                             -&gt; T.Shell T.Text\n        gMDecodeByteString f bss = do\n          bs &lt;- bss\n          let Some res bs' g = f bs\n          if BS.null bs'\n            then return res\n            else gMDecodeByteString g bss\n\ninputDir' :: T.FilePath -&gt; T.Shell T.Line\ninputDir' fPath = do\n  file &lt;- regularFilesIn fPath\n  text &lt;- mDecodeByteString (TB.input file)\n  T.select (NE.toList $ T.textToLines text)\n\n-- | Print the number of lines in all the files in a directory. Using a more\n-- robust version of `inputDir`.\nprintLinesCountIn' :: T.FilePath -&gt; IO ()\nprintLinesCountIn' fPath = do\n  count &lt;- T.fold (inputDir' fPath) T.countLines\n  print count\n</code></pre>\n\n<p>The problem is that this will count one more line per file, but at least allows to decode non-utf8 <code>ByteString</code>s. </p>\n"}, {"tags": ["haskell", "vector"], "comments": [{"owner": {"reputation": 198293, "user_id": 707111, "user_type": "moderator", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/oXZkh.jpg?s=128&g=1", "display_name": "Ry-", "link": "https://stackoverflow.com/users/707111/ry"}, "edited": false, "score": 0, "creation_date": 1497521666, "post_id": 44564387, "comment_id": 76118334, "body": "Looks like it just doesn\u2019t exist, but if you don\u2019t mind the copy, you can just <code>thaw</code> a regular <code>generate</code>d or <code>generateM</code>\u2019d vector."}, {"owner": {"reputation": 100892, "user_id": 745903, "user_type": "registered", "accept_rate": 74, "profile_image": "https://www.gravatar.com/avatar/50933f6638836741e620669b3940410e?s=128&d=identicon&r=PG", "display_name": "leftaroundabout", "link": "https://stackoverflow.com/users/745903/leftaroundabout"}, "edited": false, "score": 0, "creation_date": 1497524162, "post_id": 44564387, "comment_id": 76119928, "body": "The <code>Mutable</code> modules are the \u201cimperative\u201d interfaces to the vector library. The idea is kind of, <i>only use these modules when you want exact control over every single memory-access operation</i>.  In that light, the preferred mutable solution would be to <i>not initialize the array at all</i>, instead use the function the first time you actually do something mutable with the array entries."}, {"owner": {"reputation": 7947, "user_id": 997606, "user_type": "registered", "accept_rate": 50, "profile_image": "https://www.gravatar.com/avatar/b6117f6630078d6612afa75fb8e5bc9a?s=128&d=identicon&r=PG", "display_name": "Tom Ellis", "link": "https://stackoverflow.com/users/997606/tom-ellis"}, "reply_to_user": {"reputation": 100892, "user_id": 745903, "user_type": "registered", "accept_rate": 74, "profile_image": "https://www.gravatar.com/avatar/50933f6638836741e620669b3940410e?s=128&d=identicon&r=PG", "display_name": "leftaroundabout", "link": "https://stackoverflow.com/users/745903/leftaroundabout"}, "edited": false, "score": 0, "creation_date": 1497527326, "post_id": 44564387, "comment_id": 76121982, "body": "@leftaroundabout I don&#39;t understand. It seems to me that <code>Data.Vector.Mutable</code> is for <i>mutable</i> vectors (in <code>IO</code> or <code>ST</code>).  It&#39;s not an interface to the immutable data structure in <code>Data.Vector</code>."}], "answers": [{"comments": [{"owner": {"reputation": 7947, "user_id": 997606, "user_type": "registered", "accept_rate": 50, "profile_image": "https://www.gravatar.com/avatar/b6117f6630078d6612afa75fb8e5bc9a?s=128&d=identicon&r=PG", "display_name": "Tom Ellis", "link": "https://stackoverflow.com/users/997606/tom-ellis"}, "edited": false, "score": 0, "creation_date": 1497533935, "post_id": 44568661, "comment_id": 76126719, "body": "Any idea why the library author didn&#39;t just include a version of <code>generate</code> for mutable vectors?"}, {"owner": {"reputation": 34158, "user_id": 7203016, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/ybAMw.png?s=128&g=1", "display_name": "K. A. Buhr", "link": "https://stackoverflow.com/users/7203016/k-a-buhr"}, "reply_to_user": {"reputation": 7947, "user_id": 997606, "user_type": "registered", "accept_rate": 50, "profile_image": "https://www.gravatar.com/avatar/b6117f6630078d6612afa75fb8e5bc9a?s=128&d=identicon&r=PG", "display_name": "Tom Ellis", "link": "https://stackoverflow.com/users/997606/tom-ellis"}, "edited": false, "score": 0, "creation_date": 1497549542, "post_id": 44568661, "comment_id": 76136765, "body": "No, I don&#39;t, but you could open an issue at the package <a href=\"https://github.com/haskell/vector/issues\" rel=\"nofollow noreferrer\">bug tracker</a> and ask.  Everyone there seems pretty responsive."}, {"owner": {"reputation": 7947, "user_id": 997606, "user_type": "registered", "accept_rate": 50, "profile_image": "https://www.gravatar.com/avatar/b6117f6630078d6612afa75fb8e5bc9a?s=128&d=identicon&r=PG", "display_name": "Tom Ellis", "link": "https://stackoverflow.com/users/997606/tom-ellis"}, "edited": false, "score": 0, "creation_date": 1497624383, "post_id": 44568661, "comment_id": 76171898, "body": "OK, I&#39;ve done that.  Thanks for the suggestion. <a href=\"https://github.com/haskell/vector/issues/175\" rel=\"nofollow noreferrer\">github.com/haskell/vector/issues/175</a>"}], "tags": [], "owner": {"reputation": 34158, "user_id": 7203016, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/ybAMw.png?s=128&g=1", "display_name": "K. A. Buhr", "link": "https://stackoverflow.com/users/7203016/k-a-buhr"}, "is_accepted": false, "score": 1, "last_activity_date": 1497532848, "creation_date": 1497532848, "answer_id": 44568661, "question_id": 44564387, "link": "https://stackoverflow.com/questions/44564387/how-do-i-generate-an-io-vector/44568661#44568661", "title": "How do I generate an IO Vector?", "body": "<p>You can safely apply <code>unsafeThaw</code> to the output of <code>generate</code> to produce a mutable vector with zero copying:</p>\n\n<pre><code>import Data.Vector\nimport Data.Vector.Mutable\nmain :: IO ()\nmain = do mv &lt;- unsafeThaw (generate 10 (*5))\n          write mv 3 999\n          print =&lt;&lt; freeze mv\n</code></pre>\n\n<p>Note that the only thing that makes <code>unsafeThaw</code> unsafe is that you cannot use the immutable vector after the operation, so the pattern above <em>is</em> safe.</p>\n"}], "owner": {"reputation": 7947, "user_id": 997606, "user_type": "registered", "accept_rate": 50, "profile_image": "https://www.gravatar.com/avatar/b6117f6630078d6612afa75fb8e5bc9a?s=128&d=identicon&r=PG", "display_name": "Tom Ellis", "link": "https://stackoverflow.com/users/997606/tom-ellis"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 100, "favorite_count": 0, "answer_count": 1, "score": 1, "last_activity_date": 1497532848, "creation_date": 1497520361, "question_id": 44564387, "link": "https://stackoverflow.com/questions/44564387/how-do-i-generate-an-io-vector", "title": "How do I generate an IO Vector?", "body": "<p><a href=\"https://hackage.haskell.org/package/vector-0.12.0.1/docs/Data-Vector.html#g:7\" rel=\"nofollow noreferrer\"><code>Data.Vector</code> has <code>generate :: Int -&gt; (Int -&gt; a) -&gt; Vector a</code></a> but I don't see an equivalent in <code>Data.Vector.Mutable</code>.  What am I missing?</p>\n"}, {"tags": ["haskell"], "comments": [{"owner": {"reputation": 3587, "user_id": 7824574, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/a639be4c9ecc139065fbc6b12b87e6a9?s=128&d=identicon&r=PG&f=1", "display_name": "typetetris", "link": "https://stackoverflow.com/users/7824574/typetetris"}, "edited": false, "score": 0, "creation_date": 1497511607, "post_id": 44560565, "comment_id": 76111504, "body": "When I read <code>Haskell Programming from first principles</code>  there was the same expression and it took me a few chapters more until i finally understood how it worked."}, {"owner": {"reputation": 25967, "user_id": 1743843, "user_type": "registered", "accept_rate": 77, "profile_image": "https://www.gravatar.com/avatar/8ea2c1d9051e40332376a07bc166d9d5?s=128&d=identicon&r=PG&f=1", "display_name": "softshipper", "link": "https://stackoverflow.com/users/1743843/softshipper"}, "reply_to_user": {"reputation": 3587, "user_id": 7824574, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/a639be4c9ecc139065fbc6b12b87e6a9?s=128&d=identicon&r=PG&f=1", "display_name": "typetetris", "link": "https://stackoverflow.com/users/7824574/typetetris"}, "edited": false, "score": 0, "creation_date": 1497512885, "post_id": 44560565, "comment_id": 76112313, "body": "Yes I am reading the book."}, {"owner": {"reputation": 100185, "user_id": 3234959, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/93bb12ca0f93dfddb33880316f7e66c2?s=128&d=identicon&r=PG&f=1", "display_name": "chi", "link": "https://stackoverflow.com/users/3234959/chi"}, "edited": false, "score": 0, "creation_date": 1497513994, "post_id": 44560565, "comment_id": 76113011, "body": "By the way, it is not a recursive function, since it&#39;s not a function at all. You can call it a recursive list, or (perhaps more clearly) a list defined recursively."}], "answers": [{"tags": [], "owner": {"reputation": 395, "user_id": 7803492, "user_type": "registered", "accept_rate": 50, "profile_image": "https://i.stack.imgur.com/CfzIG.png?s=128&g=1", "display_name": "Dhruv Singh", "link": "https://stackoverflow.com/users/7803492/dhruv-singh"}, "is_accepted": false, "score": 1, "last_activity_date": 1497510678, "creation_date": 1497510678, "answer_id": 44560952, "question_id": 44560565, "link": "https://stackoverflow.com/questions/44560565/how-fibonacci-function-expand/44560952#44560952", "title": "How fibonacci function expand?", "body": "<p>Scan and fold are similar except in one thing. In fold the result being the final value but in scan, it's a list of all the intermediate values up to the final one.<br>\nAs we're concatenating first number onto the front of the list, the first fibonacci number will be 1. The second fibonacci number will also be 1 (the second argument to scan), after that every fibonacci number  is the sum of the previous number (scan's running total) and the one before that.</p>\n"}, {"comments": [{"owner": {"reputation": 3587, "user_id": 7824574, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/a639be4c9ecc139065fbc6b12b87e6a9?s=128&d=identicon&r=PG&f=1", "display_name": "typetetris", "link": "https://stackoverflow.com/users/7824574/typetetris"}, "reply_to_user": {"reputation": 25967, "user_id": 1743843, "user_type": "registered", "accept_rate": 77, "profile_image": "https://www.gravatar.com/avatar/8ea2c1d9051e40332376a07bc166d9d5?s=128&d=identicon&r=PG&f=1", "display_name": "softshipper", "link": "https://stackoverflow.com/users/1743843/softshipper"}, "edited": false, "score": 0, "creation_date": 1497513218, "post_id": 44561002, "comment_id": 76112514, "body": "<code>tail fibs = 1 : scanl (+) 2 (tail fibs)</code>"}, {"owner": {"reputation": 25967, "user_id": 1743843, "user_type": "registered", "accept_rate": 77, "profile_image": "https://www.gravatar.com/avatar/8ea2c1d9051e40332376a07bc166d9d5?s=128&d=identicon&r=PG&f=1", "display_name": "softshipper", "link": "https://stackoverflow.com/users/1743843/softshipper"}, "edited": false, "score": 0, "creation_date": 1497513453, "post_id": 44561002, "comment_id": 76112642, "body": "what is <code>tail fibs</code>?"}, {"owner": {"reputation": 25967, "user_id": 1743843, "user_type": "registered", "accept_rate": 77, "profile_image": "https://www.gravatar.com/avatar/8ea2c1d9051e40332376a07bc166d9d5?s=128&d=identicon&r=PG&f=1", "display_name": "softshipper", "link": "https://stackoverflow.com/users/1743843/softshipper"}, "edited": false, "score": 0, "creation_date": 1497518089, "post_id": 44561002, "comment_id": 76115780, "body": "It is so difficult to understand, I need a bit time to understand it. But thanks so much for your help."}, {"owner": {"reputation": 25967, "user_id": 1743843, "user_type": "registered", "accept_rate": 77, "profile_image": "https://www.gravatar.com/avatar/8ea2c1d9051e40332376a07bc166d9d5?s=128&d=identicon&r=PG&f=1", "display_name": "softshipper", "link": "https://stackoverflow.com/users/1743843/softshipper"}, "edited": false, "score": 0, "creation_date": 1497592694, "post_id": 44561002, "comment_id": 76151705, "body": "One more question about <code>(tail fibs)</code>. Consider following expression <code>fibs = 1 : 1 : 2 : scanl (+) 3 (tail (tail fibs))</code>, how it gets the value <code>2</code>? The <code>scan</code> function calls fibs at tail and how does it get the last value from the const cell?"}], "tags": [], "owner": {"reputation": 3587, "user_id": 7824574, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/a639be4c9ecc139065fbc6b12b87e6a9?s=128&d=identicon&r=PG&f=1", "display_name": "typetetris", "link": "https://stackoverflow.com/users/7824574/typetetris"}, "is_accepted": false, "score": 3, "last_activity_date": 1497608111, "last_edit_date": 1497608111, "creation_date": 1497510841, "answer_id": 44561002, "question_id": 44560565, "link": "https://stackoverflow.com/questions/44560565/how-fibonacci-function-expand/44561002#44561002", "title": "How fibonacci function expand?", "body": "<p>We have</p>\n\n<pre><code>fibs = 1 : scanl (+) 1 fibs\n</code></pre>\n\n<p>and can lookup the definition of <code>scanl</code> to be</p>\n\n<pre><code>scanl                   :: (b -&gt; a -&gt; b) -&gt; b -&gt; [a] -&gt; [b]\nscanl                   = scanlGo\n  where\n    scanlGo           :: (b -&gt; a -&gt; b) -&gt; b -&gt; [a] -&gt; [b]\n    scanlGo f q ls    = q : (case ls of\n                               []   -&gt; []\n                               x:xs -&gt; scanlGo f (f q x) xs)\n</code></pre>\n\n<p>For the following analysis, we will simply think of <code>scanlGo</code> as <code>scanl</code>.</p>\n\n<p>We want to see, how haskell evaluates the expression</p>\n\n<pre><code>  let fibs = 1 : scanl (+) 1 fibs\n</code></pre>\n\n<p>Full disclosure: As the expression is written, it doesn't get\nevaluated at all (ignoring possible implementation details).</p>\n\n<p>Why is that? Haskell is lazy and expression are evaluated until\nthey reach \"Weak head normal form\", which means, that an expression\nis evaluated until we get an resulting expression, which is normal\nform or which is a data constructor or an lambda awaiting an argument\n(i.e. a partially applied function).</p>\n\n<p>So the value bound to the name fibs is already in weak head normal\nform, as it is an data constructor with arguments.</p>\n\n<pre><code> 1 : scanl (+) 1 fibs\n-- ^ this is the data constructor\n</code></pre>\n\n<p>So to get haskell evaluate anything at all here, we need to prod it\na little.</p>\n\n<p>Let's start with</p>\n\n<pre><code>  tail fibs\n</code></pre>\n\n<p>you can't type that in ghci, as it will try to print it, which will\nfurther try to evaluate it ad inifinitum. So if you want to experiment\nwith ghci, use </p>\n\n<pre><code>let t = tail fibs\nhead t\n</code></pre>\n\n<p>So how would the expression <code>tail fibs</code> be evaluated? It goes roughly\nlike this:</p>\n\n<pre><code>    tail fibs\n  = tail (1 : scanl (+) 1 fibs)\n  = scanl (+) 1 fibs\n  = 1 : case fibs of { [] -&gt; []; x:xs -&gt; scanl (+) (1 + x) xs ; }\n  --  ^ data constructor\n</code></pre>\n\n<p>and here it stops, as we reached a data constructor. <code>head $ tail fibs</code> is\nnow easily evaluatable, without the need to evaluate the case expression any\nfurther. This result will hopefully also be memoized, so haskell now knows,\nthat the expression known as <code>fibs</code> can be evaluated to</p>\n\n<pre><code>1 : 1 : case fibs of { [] -&gt; []; x:xs -&gt; scanl (+) (1 + x) xs ; }\n</code></pre>\n\n<p>Lets ask for <code>tail (tail fibs)</code>:</p>\n\n<pre><code>  tail (tail fibs)\n= tail (1 : case fibs of { [] -&gt; []; x : xs -&gt; scanl (+) (1 + x) xs; }\n= case fibs of { []-&gt; []; x : xs -&gt; scanl (+) (1 + x) xs; }\n= scanl (+) (1 + 1) (tail fibs)\n= 2 : case (tail fibs) of { [] -&gt; [] ; x:xs -&gt; scanl (+) (2 + x) xs; }\n--  ^ data constructor\n</code></pre>\n\n<p>and here it stops again. Again the result will be memoized and haskell now\nknows, that the expression fibs, can be evaluated to:</p>\n\n<pre><code>1 : 1 : 2 : case (tail fibs) of { [] -&gt; []; x:xs -&gt; scanl (+) (2+x) xs; }\n</code></pre>\n\n<p>and now it goes on like that, if you ask for further elements, remember haskell\nwon't evaluate the expression further, after reaching normal form or a data\nconstructor or a partially applied function, if you don't ask for it.</p>\n\n<p><strong>old answer:</strong></p>\n\n<p>So basically it is</p>\n\n<pre><code>fibs = 1 : scanl (+) 1 fibs\nfibs = 1 : 1 : scanl (+) 2 (tail fibs)\nfibs = 1 : 1 : 2 : scanl (+) 3 (tail (tail fibs))\nfibs = 1 : 1 : 2 : 3 : scanl (+) 5 (tail (tail (tail fibs)))\nfibs = 1 : 1 : 2 : 3 : 5 : scanl (+) 8 (tail (tail (tail (tail fibs))))\n</code></pre>\n\n<p>In the evaluation of the next list element, <code>scanl</code> get evaluated. So we directly get the next element as the value handed to scanl as second parameter. For the then following element haskell stores the computation, which will always evaluate the second branch of the case, as we are always one element <em>behind</em> in consuming fibs. Here the next fibonacci number is calculated as <code>f q x</code>.</p>\n\n<p>Of course it will not be some stacked succession of <code>tail</code> calls in the\nlast parameter of <code>scanl</code>, but there will be some method of keeping the position in the list in a more direct way, as we already computed it. I used those stacked <code>tail</code> calls to enable an easier understanding.</p>\n\n<p>PS: Additional answer to one the comments:</p>\n\n<pre><code>1: tail fibs = scanl (+) 1 fibs\n2:           = scanl (+) 1 (1 : scanl (+) 1 fibs)\n3:           = 1 : scanl (+) 2 (scanl (+) 1 fibs)\n-- with the equation from line 1 we can do\n4:           = 1 : scanl (+) 2 (tail fibs)\n\n5: tail (tail fibs) = scanl (+) 2 (tail fibs)\n6:                  = scanl (+) 2 (1 : scanl (+) 2 (tail fibs))\n7:                  = 2 : scanl (+) 3 (scanl (+) 2 (tail fibs))\n-- with the equation from line 5 we can do\n8:                  = 2 : scanl (+) 3 (tail (tail fibs))\n</code></pre>\n\n<p>and so on.</p>\n\n<p>PSS: In your try to expand it, you set <code>fibs = [1]</code> which is wrong. It is\n<code>1 : some computation, not yet done</code> thanks to lazyness.</p>\n"}, {"tags": [], "owner": {"reputation": 3392, "user_id": 7175117, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/Tfz44.png?s=128&g=1", "display_name": "freestyle", "link": "https://stackoverflow.com/users/7175117/freestyle"}, "is_accepted": true, "score": 1, "last_activity_date": 1497520562, "creation_date": 1497520562, "answer_id": 44564448, "question_id": 44560565, "link": "https://stackoverflow.com/questions/44560565/how-fibonacci-function-expand/44564448#44564448", "title": "How fibonacci function expand?", "body": "<p>Maybe this will be more clearer:</p>\n\n<pre><code>-- scanl f z [x1, x2, ...] == [z, z `f` x1, (z `f` x1) `f` x2, ...]\nlet fibs = 1 : scanl (+) 1 fibs\n\n   fibs\n=&gt; 1 : scanl (+) 1 fibs\n=&gt; 1 : scanl (+) 1 (1:...)\n=&gt; 1 : 1 : scanl (+) (1 + 1) (tail $ 1:1:...)\n=&gt; 1 : 1 : scanl (+) 2 (1:...)\n=&gt; 1 : 1 : 2 : scanl (+) (2 + 1) (tail $ 1:2:...)\n=&gt; 1 : 1 : 2 : scanl (+) 3 (2:...)\n=&gt; 1 : 1 : 2 : 3 : scanl (+) (3 + 2) (tail $ 2:3:...)\n=&gt; 1 : 1 : 2 : 3 : scanl (+) 5 (3:...)\n=&gt; 1 : 1 : 2 : 3 : 5 : scanl (+) (5 + 3) (tail $ 3:5:...)\n=&gt; 1 : 1 : 2 : 3 : 5 : scanl (+) 8 (5:...)\n=&gt; 1 : 1 : 2 : 3 : 5 : 8 : scanl (+) (8 + 5) (tail $ 5:8:...)\n=&gt; 1 : 1 : 2 : 3 : 5 : 8 : scanl (+) 13 (8:...)\n=&gt; 1 : 1 : 2 : 3 : 5 : 8 : 13 : scanl (+) (13 + 8) (tail $ 8:13:...)\n=&gt; 1 : 1 : 2 : 3 : 5 : 8 : 13 : scanl (+) 21 (13:...)\n=&gt; 1 : 1 : 2 : 3 : 5 : 8 : 13 : 21 : scanl (+) (21 + 13) (tail $ 13:21:...)\n=&gt; 1 : 1 : 2 : 3 : 5 : 8 : 13 : 21 : scanl (+) 34 (21:...)\n</code></pre>\n"}, {"tags": [], "owner": {"user_type": "does_not_exist", "display_name": "user8583928"}, "is_accepted": false, "score": 0, "last_activity_date": 1504958172, "creation_date": 1504958172, "answer_id": 46130403, "question_id": 44560565, "link": "https://stackoverflow.com/questions/44560565/how-fibonacci-function-expand/46130403#46130403", "title": "How fibonacci function expand?", "body": "<p>A perspective that helped me realize what is happening in this\nsequence is to remove the recursion and construct it by hand. To\nillustrate this better, I will use a Fibonacci sequence starting with\n2 and 3:</p>\n\n<pre><code>[2, 3, 5, 8, ...]\n</code></pre>\n\n<p>Here all the terms are different, so it is easier to distinguish\nbetween them.</p>\n\n<p>First, no recursion is needed to produce the first two members:</p>\n\n<pre><code>\u03bb&gt; 2 : (scanl (+) 3 [])\n[2,3]\n</code></pre>\n\n<p>That is, the first member is given and the second member <code>3</code> is the\nvalue given as initial accumulator for <code>scanl</code>.</p>\n\n<p>So when recursion kicks in, the sequence is <code>[2, 3]</code>. At this point\nthe value of the accumulator is 3 and the first term of the sequence\nis the next value consumed by <code>scanl</code>.</p>\n\n<pre><code>\u03bb&gt; 2 : (scanl (+) 3 [2])\n[2,3,5]\n</code></pre>\n\n<p>Thus the next output is <code>3 + 2 = 5</code> as expected.</p>\n\n<p>After this the value of the accumulator is 5 and the next value\nconsumed by <code>scanl</code> is 3, so the next output is 8.</p>\n\n<pre><code>\u03bb&gt; 2 : (scanl (+) 3 [2, 3])\n[2,3,5,8]\n</code></pre>\n\n<p>Hope this helps (someone).</p>\n"}], "owner": {"reputation": 25967, "user_id": 1743843, "user_type": "registered", "accept_rate": 77, "profile_image": "https://www.gravatar.com/avatar/8ea2c1d9051e40332376a07bc166d9d5?s=128&d=identicon&r=PG&f=1", "display_name": "softshipper", "link": "https://stackoverflow.com/users/1743843/softshipper"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 297, "favorite_count": 0, "accepted_answer_id": 44564448, "answer_count": 4, "score": 2, "last_activity_date": 1504958172, "creation_date": 1497509522, "last_edit_date": 1497513300, "question_id": 44560565, "link": "https://stackoverflow.com/questions/44560565/how-fibonacci-function-expand", "title": "How fibonacci function expand?", "body": "<p>I have a very simple fibonacci function:</p>\n\n<pre><code>fibs = 1 : scanl (+) 1 fibs\n</code></pre>\n\n<p>But I can't figure out how it's going to expand. As you can see, it's a recursive function. </p>\n\n<p>The fibonacci sequence numbers are(start by one):</p>\n\n<pre><code>1, 1, 2, 3, 5, 8, 13, 21, n \n</code></pre>\n\n<p>The second number (the number 1) on sequence above, for me it is not clear, why is <code>1</code> not <code>2</code>. </p>\n\n<p>Please explain me, how <code>fibs</code> is going to be expanded?</p>\n\n<p><strong>Update</strong></p>\n\n<p>I tried expand as follow: </p>\n\n<pre><code>fibs = 1 : scanl (+) 1 fibs\n\nscanl (+) 1 [1](fibs) = 1 : (\n                                case [1] of\n                                    [] -&gt; []\n                                    x:xs -&gt; scanl (+) (1+1) [1](fibs)\n                            )\n\nscanl (+) 2 [1](fibs) = 2 : (\n                                case [1] of\n                                    [] -&gt; []\n                                    x:xs -&gt; scanl (+) (2+1) [1](fibs)\n                            )\n\nscanl (+) 3 [1](fibs) = 3 : (\n                                case [1] of\n                                    [] -&gt; []\n                                    x:xs -&gt; scanl (+) (3+1) [1](fibs)\n                            )   \n</code></pre>\n\n<p>As you can see, the tail is always return <code>[1](fibs)</code>, that is of course wrong.<br>\nThe last expression should be:</p>\n\n<pre><code>scanl (+) 3 [2](fibs) = 3 : (\n                                case [2] of\n                                    [] -&gt; []\n                                    x:xs -&gt; scanl (+) (3+2) [3](fibs)\n                            )   \n</code></pre>\n\n<p>But I could not image, how does it works.</p>\n"}, {"tags": ["haskell"], "comments": [{"owner": {"reputation": 28376, "user_id": 5743988, "user_type": "registered", "accept_rate": 67, "profile_image": "https://i.stack.imgur.com/IeSSM.jpg?s=128&g=1", "display_name": "4castle", "link": "https://stackoverflow.com/users/5743988/4castle"}, "edited": false, "score": 2, "creation_date": 1497501161, "post_id": 44558242, "comment_id": 76106905, "body": "<code>mapAccumR</code> is like calling <code>map</code> and <code>foldr</code> at the same time. The return value is a pair of values where the left value has the output of <code>foldr</code>, and the right value has the output of <code>map</code>."}, {"owner": {"reputation": 208473, "user_id": 126014, "user_type": "registered", "accept_rate": 86, "profile_image": "https://www.gravatar.com/avatar/33526616d4a11f1630d4939b769cfbf9?s=128&d=identicon&r=PG", "display_name": "Mark Seemann", "link": "https://stackoverflow.com/users/126014/mark-seemann"}, "edited": false, "score": 0, "creation_date": 1497503799, "post_id": 44558242, "comment_id": 76107712, "body": "<a href=\"http://hackage.haskell.org/package/base-4.9.1.0/docs/Data-List.html#v:mapAccumR\" rel=\"nofollow noreferrer\">hackage.haskell.org/package/base-4.9.1.0/docs/&hellip;</a>"}, {"owner": {"reputation": 100185, "user_id": 3234959, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/93bb12ca0f93dfddb33880316f7e66c2?s=128&d=identicon&r=PG&f=1", "display_name": "chi", "link": "https://stackoverflow.com/users/3234959/chi"}, "reply_to_user": {"reputation": 28376, "user_id": 5743988, "user_type": "registered", "accept_rate": 67, "profile_image": "https://i.stack.imgur.com/IeSSM.jpg?s=128&g=1", "display_name": "4castle", "link": "https://stackoverflow.com/users/5743988/4castle"}, "edited": false, "score": 0, "creation_date": 1497513812, "post_id": 44558242, "comment_id": 76112891, "body": "@4castle I agree and disagree at the same time :-P In plain <code>map</code>, every element of the output depends only from the element of the input at the same index. In the list result of <code>mapAccumR</code>, it would also depend on the other elements at the &quot;right &quot; (tail) of the corresponding input element."}, {"owner": {"reputation": 1589, "user_id": 2535671, "user_type": "registered", "accept_rate": 87, "profile_image": "https://www.gravatar.com/avatar/fca1ba52e0c41803e676d449ef242e75?s=128&d=identicon&r=PG&f=1", "display_name": "Julian Leviston", "link": "https://stackoverflow.com/users/2535671/julian-leviston"}, "reply_to_user": {"reputation": 100185, "user_id": 3234959, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/93bb12ca0f93dfddb33880316f7e66c2?s=128&d=identicon&r=PG&f=1", "display_name": "chi", "link": "https://stackoverflow.com/users/3234959/chi"}, "edited": false, "score": 0, "creation_date": 1497663519, "post_id": 44558242, "comment_id": 76188040, "body": "To be fair, @chi it doesn&#39;t <b>have</b> to depend on it, it just can. If you need to do a separate fold and a separate map at the same time on a list, you can totally do that with one of the <code>mapAccum</code> functions. For example, summing the lengths and exclaiming the words in a string: <code>mapAccumR (\\sumLength item -&gt; (sumLength + length item, item ++ &quot;!&quot;)) 0 $ words &quot;This is interesting&quot;</code>"}], "answers": [{"tags": [], "owner": {"reputation": 100185, "user_id": 3234959, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/93bb12ca0f93dfddb33880316f7e66c2?s=128&d=identicon&r=PG&f=1", "display_name": "chi", "link": "https://stackoverflow.com/users/3234959/chi"}, "is_accepted": false, "score": 1, "last_activity_date": 1497521256, "last_edit_date": 1497521256, "creation_date": 1497520580, "answer_id": 44564452, "question_id": 44558242, "link": "https://stackoverflow.com/questions/44558242/picture-how-mapaccumr-works/44564452#44564452", "title": "Picture how mapAccumR works", "body": "<p>Here are some examples, generated using <code>Debug.SimpleReflect</code>.</p>\n\n<p>Below, <code>f</code> is the same <code>f</code> you would use in a <code>foldr</code>, except the arguments have been flipped. Otherwise, there's no difference.</p>\n\n<p>Instead <code>g</code> is similar to what you would use in a <code>map</code>, except <code>g x y</code> does not only depend on the current list element <code>y</code>, but also on the results of the former fold <code>x</code>. </p>\n\n<pre><code>&gt; import Data.List\n&gt; import Debug.SimpleReflect\n&gt; mapAccumR (\\x y -&gt; (f x y, g x y)) a [] :: (Expr, [Expr])\n(a,[])\n&gt; mapAccumR (\\x y -&gt; (f x y, g x y)) a [b] :: (Expr, [Expr])\n(f a b,[g a b])\n&gt; mapAccumR (\\x y -&gt; (f x y, g x y)) a [b,c] :: (Expr, [Expr])\n(f (f a c) b,[g (f a c) b,g a c])\n&gt; mapAccumR (\\x y -&gt; (f x y, g x y)) a [b,c,d] :: (Expr, [Expr])\n(f (f (f a d) c) b,[g (f (f a d) c) b,g (f a d) c,g a d])\n</code></pre>\n\n<p>Here is a <code>foldr</code> with <code>f</code> having its arguments flipped, by comparison.</p>\n\n<pre><code>&gt; foldr (\\x y -&gt; f y x) a [b,c,d]\nf (f (f a d) c) b\n</code></pre>\n\n<p>(I have no idea about why <code>mapAccumR</code> chose the arguments of <code>f</code> in the flipped order compared to <code>foldr</code>.)</p>\n"}, {"tags": [], "owner": {"reputation": 1589, "user_id": 2535671, "user_type": "registered", "accept_rate": 87, "profile_image": "https://www.gravatar.com/avatar/fca1ba52e0c41803e676d449ef242e75?s=128&d=identicon&r=PG&f=1", "display_name": "Julian Leviston", "link": "https://stackoverflow.com/users/2535671/julian-leviston"}, "is_accepted": true, "score": 7, "last_activity_date": 1497693283, "last_edit_date": 1497693283, "creation_date": 1497660456, "answer_id": 44599727, "question_id": 44558242, "link": "https://stackoverflow.com/questions/44558242/picture-how-mapaccumr-works/44599727#44599727", "title": "Picture how mapAccumR works", "body": "<p>This is a good question. I wish the documentation was a bit nicer around this. I recently had a use for them myself, so hopefully I can explain from the perspective of someone who also had some trouble understanding how they worked.</p>\n\n<p>So, the type signature of <code>mapAccumR</code> is:</p>\n\n<p><code>Traversable t =&gt; (a -&gt; b -&gt; (a, c)) -&gt; a -&gt; t b -&gt; (a, t c)</code></p>\n\n<p>Let's just assume the <code>Traversable</code> under question is a list because it's possibly a bit easier to understand that way, so specialising the types:</p>\n\n<p><code>(a -&gt; b -&gt; (a, c)) -&gt; a -&gt; [b] -&gt; (a, [c])</code></p>\n\n<p>So, to explain this, <code>mapAccumR</code> is a function of three arguments (ignoring currying, as we do for easy explanation), and I'm going to annotate these arguments here:</p>\n\n<pre><code>mapAccumR :: (a -&gt; b -&gt; (a, c))             -&gt; a                     -&gt; [b]           -&gt; (a, [c])\nmapAccumR :: mappingAndAccumulationFunction -&gt; initialAccumulatorValue -&gt; listToMapOver -&gt; resultantAccumulatorAndMappedListPair\n</code></pre>\n\n<p>Cool, so that clears things a <strong>little</strong> bit, but it's still a bit confusing, right. So what the heck does it do?</p>\n\n<p>Well, it does an accumulating map: so let's say in the first step, what it does is take the <code>initialAccumulatorValue</code> and the first <code>b</code> from the <code>listToMapOver</code>, and passes those to the <code>mappingAndAccumulationFunction</code> function, which will do <strong>something</strong> with them and return two things: 1. a new value of type <code>a</code> and 2. a mapped value for later collection into the mapped list (see the type of <code>resultantAccumulatorAndMappedListPair</code>). These two values are paired, hence the return type of the <code>mappingAndAccumulationFunction</code> function as <code>(a, c)</code>.</p>\n\n<p>In the second and subsequent steps, it takes this <code>(a, c)</code> pair from the last step, pulls the <code>c</code> out and remembers it by appending it to an internal list it's keeping track of until the end, and pulls the <code>a</code> out as the first argument to the next application of the <code>mappingAndAccumulationFunction</code> along with the next <code>b</code> value of the <code>listToMapOver</code>.</p>\n\n<p>Once it runs out of <code>b</code> values from <code>listToMapOver</code>, it returns a pair which has the last value of <code>a</code> and a list whose contents are of type <code>c</code>.</p>\n\n<p>So why the heck would you want this function? Example time!</p>\n\n<pre><code>annotateLeastFavourites items = snd (mapAccumR (\\num item -&gt; (num + 1, show num ++ \": \" ++ item)) 1 items)\n\nitemList = [\"Geese\",\"Monkeys\",\"Chocolate\",\"Chips\"]\n\n&gt; annotateLeastFavourites itemList\n[\"4: Geese\",\"3: Monkeys\",\"2: Chocolate\",\"1: Chips\"]\n</code></pre>\n\n<p>or, maybe this is a bit simpler to see what's going on:</p>\n\n<pre><code>&gt; mapAccumR (\\num item -&gt; (num + 1, show num ++ \": \" ++ item)) 1 [\"Geese\", \"Monkeys\", \"Chocolate\", \"Chips\"]\n(5,[\"4: Geese\",\"3: Monkeys\",\"2: Chocolate\",\"1: Chips\"])\n</code></pre>\n\n<p>So we can see that it's a function that can give us a \"cumulative value\" along with our accumulating value anytime we need some information to pass along a map, for example, or if we want to build up a collection value (on the right) that also needs to have information passed along that changes with each step (the value on the left).</p>\n\n<p>Maybe you want to get the max length of a list of items as you also annotate them with each item's length</p>\n\n<pre><code>&gt; mapAccumR (\\biggestSoFar item -&gt; (max biggestSoFar (length item), (item, length item))) 0 [\"Geese\", \"Monkeys\", \"Chocolate\", \"Chips\"]\n(9,[(\"Geese\",5),(\"Monkeys\",7),(\"Chocolate\",9),(\"Chips\",5)])\n</code></pre>\n\n<p>There are lots of possibilities here. Hopefully now it's clear why people say this is like a combination of <code>map</code> and <code>foldr</code>. If you happen to think geometrically as I do, I think of it as when you need to transform a collection of some kind, and you need to thread some changing thing through that collection as part of the transformation.</p>\n\n<p>Hope this has helped give you an intuition and store the pattern in your mind for later when you recognise you might need it in the future :)</p>\n\n<pre><code>let (_, result) =\n  mapAccumR \n    (\\cumulativeLength item -&gt; \n      let newLength = cumulativeLength + length item \n      in (newLength, take cumulativeLength (repeat ' ') ++ item)\n    )\n    0\n    [\"Geese\", \"Monkeys\", \"Chocolate\", \"Chips\", \"Dust\", \"Box\"]\nin mapM_ putStrLn $ reverse result\n\nBox\n   Dust\n       Chips\n            Chocolate\n                     Monkeys\n                            Geese\n</code></pre>\n\n<p>Sometimes, and depending on the shape of the computation you want, you'd want to use <code>mapAccumL</code> instead of <code>mapAccumR</code>, but you get the picture.</p>\n\n<p>Also, note that it's defined for <code>Traversable</code> instances, not just lists, so it will work on all sorts of traversable containers and data structures such as Trees, Maps, Vectors, etc.</p>\n"}], "owner": {"reputation": 319, "user_id": 7828400, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/70c46d81a1497ce29153f498b5362904?s=128&d=identicon&r=PG", "display_name": "user28522", "link": "https://stackoverflow.com/users/7828400/user28522"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 919, "favorite_count": 1, "accepted_answer_id": 44599727, "answer_count": 2, "score": 3, "last_activity_date": 1497693283, "creation_date": 1497498789, "question_id": 44558242, "link": "https://stackoverflow.com/questions/44558242/picture-how-mapaccumr-works", "title": "Picture how mapAccumR works", "body": "<p>Can you explain how exactly <code>mapAccumR</code> works, the kind of problems it solves,and how it's different from <code>foldr</code>. I have a hard time picturing how it works.</p>\n"}, {"tags": ["haskell", "monad-transformers"], "comments": [{"owner": {"reputation": 28376, "user_id": 5743988, "user_type": "registered", "accept_rate": 67, "profile_image": "https://i.stack.imgur.com/IeSSM.jpg?s=128&g=1", "display_name": "4castle", "link": "https://stackoverflow.com/users/5743988/4castle"}, "edited": false, "score": 0, "creation_date": 1497493891, "post_id": 44557129, "comment_id": 76105242, "body": "There are a few libraries which do this. You may find <a href=\"https://www.youtube.com/watch?v=8t8fjkISjus\" rel=\"nofollow noreferrer\">this YouTube video</a> interesting, in particular starting at 13:01."}, {"owner": {"reputation": 28376, "user_id": 5743988, "user_type": "registered", "accept_rate": 67, "profile_image": "https://i.stack.imgur.com/IeSSM.jpg?s=128&g=1", "display_name": "4castle", "link": "https://stackoverflow.com/users/5743988/4castle"}, "edited": false, "score": 1, "creation_date": 1497494623, "post_id": 44557129, "comment_id": 76105386, "body": "The library which is most similar to your implementation is the <a href=\"https://hackage.haskell.org/package/MonadStack-0.1.0.3/docs/Control-Monad-MonadStack.html\" rel=\"nofollow noreferrer\">MonadStack</a> library."}, {"owner": {"reputation": 13807, "user_id": 2407038, "user_type": "registered", "accept_rate": 64, "profile_image": "https://www.gravatar.com/avatar/538f6f4a9aa43841841de7d8e8b169fc?s=128&d=identicon&r=PG&f=1", "display_name": "user2407038", "link": "https://stackoverflow.com/users/2407038/user2407038"}, "edited": false, "score": 2, "creation_date": 1497497298, "post_id": 44557129, "comment_id": 76105975, "body": "This isn&#39;t all that useful an abstraction. There is no relation between two type parameters, one of which occurs in a negative position and the other in a positive position, so the situations in which the compiler can infer the correct types to use are very limited. You can solve this problem in a much simpler way, by replacing concrete monads with constraints (e.g. <code>StateT S (Reader R) a</code> becomes <code>(MonadState S m, MonadReader R m) =&gt; .. m a ..</code>) which allows you to embed such a stack in any larger stack without any lifting at all."}, {"owner": {"reputation": 24509, "user_id": 6863749, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/UyoQv.jpg?s=128&g=1", "display_name": "Li-yao Xia", "link": "https://stackoverflow.com/users/6863749/li-yao-xia"}, "edited": false, "score": 0, "creation_date": 1497534347, "post_id": 44557129, "comment_id": 76127056, "body": "Here&#39;s another implementation on Hackage: <a href=\"http://hackage.haskell.org/package/elevator-0.2.3/docs/Control-Elevator.html\" rel=\"nofollow noreferrer\">elevator</a>."}, {"owner": {"reputation": 9772, "user_id": 3963, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/9pDQ8.png?s=128&g=1", "display_name": "hao", "link": "https://stackoverflow.com/users/3963/hao"}, "edited": false, "score": 0, "creation_date": 1497562517, "post_id": 44557129, "comment_id": 76143499, "body": "more links: <a href=\"http://hackage.haskell.org/package/layers-0.1/docs/Documentation-Layers-Overview.html\" rel=\"nofollow noreferrer\">hackage.haskell.org/package/layers-0.1/docs/&hellip;</a> is an (older, circa-2013) survey of many different attempts at solving the &quot;lift&quot; problem"}], "owner": {"reputation": 20310, "user_id": 525980, "user_type": "registered", "accept_rate": 48, "profile_image": "https://www.gravatar.com/avatar/8dafe66793ee2f32192e9fcefb389a12?s=128&d=identicon&r=PG", "display_name": "Clinton", "link": "https://stackoverflow.com/users/525980/clinton"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 49, "favorite_count": 0, "answer_count": 0, "score": 0, "last_activity_date": 1497490111, "creation_date": 1497490111, "question_id": 44557129, "link": "https://stackoverflow.com/questions/44557129/generic-lift-class", "title": "Generic Lift Class", "body": "<p>I've just hacked up the following class as follows:</p>\n\n<pre><code>{-# LANGUAGE TypeFamilies #-}\n{-# LANGUAGE MultiParamTypeClasses #-}\n{-# LANGUAGE FlexibleInstances #-}\n\nimport Control.Monad.Trans.Class (MonadTrans, lift)\n\nclass GenericLift m1 m2 where\n  genericLift :: m1 a -&gt; m2 a\n\ninstance GenericLift m m where\n  genericLift = id\n\ninstance (MonadTrans t, Monad m2, GenericLift m1 m2) =&gt; GenericLift m1 (t m2) where\n  genericLift = lift . genericLift\n</code></pre>\n\n<p>This allows lifting an arbitrary number of levels, which can be useful for generic functions that apply to different transformer stack sizes. Two questions:</p>\n\n<ol>\n<li>Am I reinventing the wheel? Does this already exist and if so where?</li>\n<li>Is this a sensible thing to do or silly?</li>\n</ol>\n"}]