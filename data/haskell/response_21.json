[{"tags": ["haskell"], "comments": [{"owner": {"reputation": 46235, "user_id": 2541573, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/Z1qtP.png?s=128&g=1", "display_name": "jub0bs", "link": "https://stackoverflow.com/users/2541573/jub0bs"}, "edited": false, "score": 1, "creation_date": 1433372143, "post_id": 30632136, "comment_id": 49329998, "body": "Your code does give me an error (because <code>left</code> and <code>y</code> should be swapped in the pattern of the second equation), but not the one you describe..."}, {"owner": {"reputation": 197, "user_id": 4329377, "user_type": "registered", "accept_rate": 50, "profile_image": "https://lh6.googleusercontent.com/--Jf-Vxi9HSQ/AAAAAAAAAAI/AAAAAAAAAzU/r3SujqRJNnc/photo.jpg?sz=128", "display_name": "Walle", "link": "https://stackoverflow.com/users/4329377/walle"}, "reply_to_user": {"reputation": 46235, "user_id": 2541573, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/Z1qtP.png?s=128&g=1", "display_name": "jub0bs", "link": "https://stackoverflow.com/users/2541573/jub0bs"}, "edited": false, "score": 0, "creation_date": 1433372528, "post_id": 30632136, "comment_id": 49330136, "body": "True, I tried it and error went away. Why can&#39;t it be &quot;left y right&quot; ?"}], "answers": [{"comments": [{"owner": {"reputation": 75362, "user_id": 625403, "user_type": "registered", "accept_rate": 82, "profile_image": "https://www.gravatar.com/avatar/786eed7da67079cb5d63a49d469af25b?s=128&d=identicon&r=PG", "display_name": "amalloy", "link": "https://stackoverflow.com/users/625403/amalloy"}, "reply_to_user": {"reputation": 46235, "user_id": 2541573, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/Z1qtP.png?s=128&g=1", "display_name": "jub0bs", "link": "https://stackoverflow.com/users/2541573/jub0bs"}, "edited": false, "score": 0, "creation_date": 1433373031, "post_id": 30632309, "comment_id": 49330307, "body": "I think there are some recent changes to how GHC treats infinite types. But it doesn&#39;t really matter: there&#39;s no requirement that every compiler give an identical error message for code that is wrong."}, {"owner": {"reputation": 46235, "user_id": 2541573, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/Z1qtP.png?s=128&g=1", "display_name": "jub0bs", "link": "https://stackoverflow.com/users/2541573/jub0bs"}, "edited": false, "score": 0, "creation_date": 1433373071, "post_id": 30632309, "comment_id": 49330326, "body": "Agreed. I was just curious as to why we are getting different error messages."}, {"owner": {"reputation": 44013, "user_id": 1477667, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/trgKM.jpg?s=128&g=1", "display_name": "dfeuer", "link": "https://stackoverflow.com/users/1477667/dfeuer"}, "edited": false, "score": 0, "creation_date": 1433426363, "post_id": 30632309, "comment_id": 49355510, "body": "Don&#39;t most (all?) type theories lack a notion of infinite types, just as they lack a notion of infinite terms?"}], "tags": [], "owner": {"reputation": 75362, "user_id": 625403, "user_type": "registered", "accept_rate": 82, "profile_image": "https://www.gravatar.com/avatar/786eed7da67079cb5d63a49d469af25b?s=128&d=identicon&r=PG", "display_name": "amalloy", "link": "https://stackoverflow.com/users/625403/amalloy"}, "is_accepted": false, "score": 4, "last_activity_date": 1433377015, "last_edit_date": 1433377015, "creation_date": 1433372559, "answer_id": 30632309, "question_id": 30632136, "link": "https://stackoverflow.com/questions/30632136/find-an-element-in-a-bst-haskell/30632309#30632309", "title": "Find an element in a BST Haskell", "body": "<p>You have <code>Node a (Tree a) (Tree a)</code>, but pattern-match it as <code>(Node left y right)</code>. This infers the following types: <code>left :: a; y, right :: Tree a</code>. Then you compare <code>y :: Tree a</code> to <code>x :: a</code> - that forces them to have the same type, which is only possible if <code>Tree a</code> is the same type as <code>a</code>. That's an impossible<sup>1</sup>, infinite type, so GHC complains.</p>\n\n<p>The solution is to fix your pattern match: it should be <code>(Node y left right)</code>, to match the data constructor.</p>\n\n<p><sup>1</sup> It's a theoretically possible type, just not a very useful one. <code>a ~ Tree a</code> can hold, but only if <code>a ~ Tree (Tree (Tree (Tree (Tree ...))))</code>.</p>\n"}], "owner": {"reputation": 197, "user_id": 4329377, "user_type": "registered", "accept_rate": 50, "profile_image": "https://lh6.googleusercontent.com/--Jf-Vxi9HSQ/AAAAAAAAAAI/AAAAAAAAAzU/r3SujqRJNnc/photo.jpg?sz=128", "display_name": "Walle", "link": "https://stackoverflow.com/users/4329377/walle"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 185, "favorite_count": 0, "answer_count": 1, "score": 0, "last_activity_date": 1433377015, "creation_date": 1433371526, "question_id": 30632136, "link": "https://stackoverflow.com/questions/30632136/find-an-element-in-a-bst-haskell", "title": "Find an element in a BST Haskell", "body": "<p>I am rewriting a search-for-an-element function in BST on my own, however I encountered this error which I'm not certain of what it means (error occured on the line of x (Empty) = False)</p>\n\n<pre><code> Occurs check: cannot construct the infinite type: a = Tree a\n When generalising the type(s) for `searchTree'\n</code></pre>\n\n<p>Here is what I've come up with:</p>\n\n<pre><code>data Tree a = Empty | Node a (Tree a) (Tree a)\n                    deriving (Show, Read, Eq)\n\n\nsearchTree :: (Ord a) =&gt; a -&gt; Tree a -&gt; Bool\nsearchTree x (Empty) = False\nsearchTree x (Node left y right)\n    |y == x = True\n    |y &gt; x = searchTree x left\n    |y &lt; x = searchTree x right\n</code></pre>\n"}, {"tags": ["haskell", "hspec"], "answers": [{"comments": [{"owner": {"reputation": 639, "user_id": 2786866, "user_type": "registered", "accept_rate": 86, "profile_image": "https://www.gravatar.com/avatar/83d20464b8b297e4b289187bbfbd62c7?s=128&d=identicon&r=PG", "display_name": "crosser", "link": "https://stackoverflow.com/users/2786866/crosser"}, "edited": false, "score": 1, "creation_date": 1433397108, "post_id": 30632814, "comment_id": 49336738, "body": "I see. Wouldn&#39;t it be a good idea to have an &quot;official&quot; way to create common environment for a group of tests (context, one spec, all specs) and pass it over?"}], "tags": [], "owner": {"reputation": 391, "user_id": 2759302, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/af6983cceac5aef7f452a8d4888e5208?s=128&d=identicon&r=PG", "display_name": "Simon Hengel", "link": "https://stackoverflow.com/users/2759302/simon-hengel"}, "is_accepted": true, "score": 3, "last_activity_date": 1433376236, "last_edit_date": 1433376236, "creation_date": 1433375885, "answer_id": 30632814, "question_id": 30631737, "link": "https://stackoverflow.com/questions/30631737/hspec-discovery-custom-main-and-passing-argument-to-spec/30632814#30632814", "title": "Hspec: discovery, custom main, and passing argument to spec", "body": "<p>Sharing values across spec files is currently not support with <code>hspec-discover</code>.  But you can still share values within the same spec file.  The following works:</p>\n\n<p><code>FooSpec.hs</code>:</p>\n\n<pre><code>module FooSpec (spec) where\n\nimport           Test.Hspec\nimport           System.IO\n\nspec :: Spec\nspec = beforeAll (openFile \"foo.txt\" ReadMode) $ afterAll hClose $ do\n  describe \"hGetLine\" $ do\n    it \"reads a line\" $ \\h -&gt; do\n      hGetLine h `shouldReturn` \"foo\"\n\n    it \"reads an other line\" $ \\h -&gt; do\n      hGetLine h `shouldReturn` \"bar\"\n</code></pre>\n\n<p><code>Spec.hs</code>:</p>\n\n<pre><code>{-# OPTIONS_GHC -F -pgmF hspec-discover #-}\n</code></pre>\n\n<p>But note that <code>beforeAll</code> is generally considered a code smell.  It's good practice to use <code>before</code> instead if possible.</p>\n"}], "owner": {"reputation": 639, "user_id": 2786866, "user_type": "registered", "accept_rate": 86, "profile_image": "https://www.gravatar.com/avatar/83d20464b8b297e4b289187bbfbd62c7?s=128&d=identicon&r=PG", "display_name": "crosser", "link": "https://stackoverflow.com/users/2786866/crosser"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 501, "favorite_count": 0, "accepted_answer_id": 30632814, "answer_count": 1, "score": 1, "last_activity_date": 1433376236, "creation_date": 1433369795, "last_edit_date": 1433370598, "question_id": 30631737, "link": "https://stackoverflow.com/questions/30631737/hspec-discovery-custom-main-and-passing-argument-to-spec", "title": "Hspec: discovery, custom main, and passing argument to spec", "body": "<p>I am trying to use <code>hspec-discover</code> along with custom <code>Main</code>. Custom <code>Main</code> is a <code>bracket</code> that creates a file descriptor to be used by all <code>Spec</code>'s.</p>\n\n<p>This is my <code>Spec.hs</code>:</p>\n\n<pre><code>{-# OPTIONS_GHC -F -pgmF hspec-discover -optF --module-name=Spec #-}\n</code></pre>\n\n<p>This is my <code>Main.hs</code>:</p>\n\n<pre><code>module Main (main) where\n\nimport Control.Exception\nimport System.Posix.IO\nimport System.Posix.Files\nimport Test.Hspec\nimport Spec (spec)\n\nmain :: IO ()\nmain = bracket\n  (openFd verybigFile ReadWrite (Just 384) defaultFileFlags)\n  (\\fd -&gt; closeFd fd &gt;&gt; removeLink verybigFile)\n  (\\fd -&gt; hspec (spec fd))\n    where\n      verybigFile = \"test/verybigFile\"\n</code></pre>\n\n<p>For my <code>spec</code> in individual autodiscovered module to accept the file descriptor argument, I need to declare it as</p>\n\n<pre><code>spec :: Fd -&gt; Spec\n</code></pre>\n\n<p>but <code>hspec-discover</code> demands that spec is declared as</p>\n\n<pre><code>spec :: Spec\n</code></pre>\n\n<p>otherwise autogenerated module does not compile:</p>\n\n<pre><code>test/Spec.hs:8:68:\n    Couldn't match type `System.Posix.Types.Fd -&gt; Spec'\n                  with `hspec-core-2.1.7:Test.Hspec.Core.Spec.Monad.SpecM () ()'\n    Expected type: hspec-core-2.1.7:Test.Hspec.Core.Spec.Monad.SpecWith\n                     ()\n      Actual type: System.Posix.Types.Fd -&gt; Spec\n    In the second argument of `describe', namely `SendfileSpec.spec'\n    In the second argument of `postProcessSpec', namely\n      `(describe \"Sendfile\" SendfileSpec.spec)'\n    In the expression:\n      postProcessSpec\n        \"test/SendfileSpec.hs\" (describe \"Sendfile\" SendfileSpec.spec)\n</code></pre>\n\n<p>So, how to pass an argument to the spec without disturbing autodiscovery? My imagination drifts towards <code>IORef</code>'s but the idea makes me shudder. What would be a Right Way to do it?</p>\n"}, {"tags": ["haskell"], "comments": [{"owner": {"reputation": 100185, "user_id": 3234959, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/93bb12ca0f93dfddb33880316f7e66c2?s=128&d=identicon&r=PG&f=1", "display_name": "chi", "link": "https://stackoverflow.com/users/3234959/chi"}, "edited": false, "score": 1, "creation_date": 1433370641, "post_id": 30630873, "comment_id": 49329338, "body": "Off topic: note that <code>f</code> must be monotonic to preserve the BST invariant."}], "answers": [{"comments": [{"owner": {"reputation": 197, "user_id": 4329377, "user_type": "registered", "accept_rate": 50, "profile_image": "https://lh6.googleusercontent.com/--Jf-Vxi9HSQ/AAAAAAAAAAI/AAAAAAAAAzU/r3SujqRJNnc/photo.jpg?sz=128", "display_name": "Walle", "link": "https://stackoverflow.com/users/4329377/walle"}, "edited": false, "score": 0, "creation_date": 1433366493, "post_id": 30630882, "comment_id": 49327523, "body": "I just figured it out literally like 2 minutes upon posting. Thanks a lot for your advice on naming convention though!"}], "tags": [], "owner": {"reputation": 51584, "user_id": 839246, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/9b0573c2b936b12828dd1e4cc04206dc?s=128&d=identicon&r=PG&f=1", "display_name": "bheklilr", "link": "https://stackoverflow.com/users/839246/bheklilr"}, "is_accepted": false, "score": 5, "last_activity_date": 1433366508, "last_edit_date": 1433366508, "creation_date": 1433366103, "answer_id": 30630882, "question_id": 30630873, "link": "https://stackoverflow.com/questions/30630873/map-function-to-a-bst-in-haskell/30630882#30630882", "title": "Map function to a BST in Haskell", "body": "<p>You forgot the node's value:</p>\n\n<pre><code>treeMap f (Node a left right) = Node (f a) (treeMap f left) (treeMap f right)\n</code></pre>\n\n<p>You do need to fix your <code>data</code> declaration, though.  Data types must start with capital letters:</p>\n\n<pre><code>data Tree a = Empty | Node a (Tree a) (Tree a)\n</code></pre>\n\n<p>And your type signature</p>\n\n<pre><code>treeMap :: (a -&gt; b) -&gt; Tree a -&gt; Tree b\n</code></pre>\n\n<p>This is actually a common pattern in Haskell, and it's been given the name <code>Functor</code> with the mapping function called <code>fmap</code>.  Lists are one of the most common <code>Functor</code>s, with <code>fmap</code> just being the standard <code>map</code>, but many other types are <code>Functor</code>s too.  Conceptually, a <code>Functor</code> is just a generic container where you can apply a function to each element.  <code>Maybe</code> is also a <code>Functor</code>, where <code>fmap f Nothing = Nothing</code> and <code>fmap f (Just a) = Just (f a)</code>.  Additionally, any <code>Monad</code> or <code>Applicative</code> is also a <code>Functor</code> by definition, so if you can use <code>do</code> notation with it then you can use <code>fmap</code> on it.</p>\n\n<p>For your structure, you could make it an instance of the <code>Functor</code> typeclass as</p>\n\n<pre><code>instance Functor Tree where\n    fmap f Empty = Empty\n    fmap f (Node a left right) = Node (f a) (fmap f left) (fmap f right)\n</code></pre>\n\n<p>Which is exactly the same definition as your <code>treeMap</code> with a different name.  Additionally, GHC actually has the ability to derive this implementation for you if you give it the <code>DeriveFunctor</code> extension:</p>\n\n<pre><code>{-# LANGUAGE DeriveFunctor #-}\n\ndata Tree a = Empty | Node a (Tree a) (Tree a)\n                    deriving (Eq, Show, Read, Functor)\n</code></pre>\n\n<p>And that's all you have to do!</p>\n"}], "owner": {"reputation": 197, "user_id": 4329377, "user_type": "registered", "accept_rate": 50, "profile_image": "https://lh6.googleusercontent.com/--Jf-Vxi9HSQ/AAAAAAAAAAI/AAAAAAAAAzU/r3SujqRJNnc/photo.jpg?sz=128", "display_name": "Walle", "link": "https://stackoverflow.com/users/4329377/walle"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 498, "favorite_count": 1, "answer_count": 1, "score": 2, "last_activity_date": 1433366508, "creation_date": 1433366065, "question_id": 30630873, "link": "https://stackoverflow.com/questions/30630873/map-function-to-a-bst-in-haskell", "title": "Map function to a BST in Haskell", "body": "<p>Suppose I have a datatype of BST as:</p>\n\n<pre><code>data tree a = Empty | Node a (tree a) (tree a)\n                    deriving (Show, Read, Eq)\n</code></pre>\n\n<p>I am doing a simple map function to apply each element of a BST.</p>\n\n<pre><code>treeMap :: (a -&gt; b) -&gt; tree a -&gt; tree b\ntreeMap f (Empty) = Empty\ntreeMap f (Node left right) = Node (treeMap f left) (treeMap f right)\n</code></pre>\n\n<p>However it gives me an error saying that:</p>\n\n<pre><code>Constructor `Node' should have 3 arguments, but has been given 2\nIn the pattern: Node left right\nIn the definition of `treeMap':\n    treeMap f (Node left right)\n              = Node (treeMap f left) (treeMap f right)\n</code></pre>\n\n<p>How do I solve this ? (p/s not a homework question, trying to understand implementation of tree in haskell)</p>\n"}, {"tags": ["haskell", "frp", "reactive-banana"], "answers": [{"comments": [{"owner": {"reputation": 33184, "user_id": 247623, "user_type": "registered", "accept_rate": 72, "profile_image": "https://www.gravatar.com/avatar/bb9e67348d3e0e93ef12dd97c41a6c22?s=128&d=identicon&r=PG&f=1", "display_name": "Erik Kaplun", "link": "https://stackoverflow.com/users/247623/erik-kaplun"}, "edited": false, "score": 0, "creation_date": 1444383948, "post_id": 30646948, "comment_id": 53891256, "body": "as one of the best sources on FRP, and the best on reactive-banana, could you please elaborate a bit further? +1 if yes!"}, {"owner": {"reputation": 11009, "user_id": 403805, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/bcf3c21ce05cfb6788e25dcc3821b3c7?s=128&d=identicon&r=PG", "display_name": "Heinrich Apfelmus", "link": "https://stackoverflow.com/users/403805/heinrich-apfelmus"}, "reply_to_user": {"reputation": 33184, "user_id": 247623, "user_type": "registered", "accept_rate": 72, "profile_image": "https://www.gravatar.com/avatar/bb9e67348d3e0e93ef12dd97c41a6c22?s=128&d=identicon&r=PG&f=1", "display_name": "Erik Kaplun", "link": "https://stackoverflow.com/users/247623/erik-kaplun"}, "edited": false, "score": 1, "creation_date": 1444744761, "post_id": 30646948, "comment_id": 54024153, "body": "@ErikAllik Like this?"}], "tags": [], "owner": {"reputation": 11009, "user_id": 403805, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/bcf3c21ce05cfb6788e25dcc3821b3c7?s=128&d=identicon&r=PG", "display_name": "Heinrich Apfelmus", "link": "https://stackoverflow.com/users/403805/heinrich-apfelmus"}, "is_accepted": true, "score": 2, "last_activity_date": 1444744752, "last_edit_date": 1444744752, "creation_date": 1433428906, "answer_id": 30646948, "question_id": 30627866, "link": "https://stackoverflow.com/questions/30627866/resettable-accumulator-behaviors/30646948#30646948", "title": "Resettable accumulator behaviors?", "body": "<p>The idea is that <code>eToPrint</code> is sort of a union of two events: when you press characters and when you press enter. Here an example (reactive-banana 0.8):</p>\n\n<pre><code>eToPrint = accumE \"\" $ unions [(:) &lt;$&gt; eWritable, const \"\" &lt;$&gt; eEnter]\n</code></pre>\n\n<p>To \"hold\" it, you can use a <code>Behavior</code>.</p>\n\n<hr>\n\n<p>Here is a complete solution:</p>\n\n<pre><code>bString = accumB \"\" $ unions [(:) &lt;$&gt; eWritable, const \"\" &lt;$&gt; eEnter]\neOut    = bString &lt;@ eEnter\n</code></pre>\n\n<p>The behavior <code>bString</code> contains the accumulated <code>String</code> value. The <code>eOut</code> event returns the last string value whenever the <code>eEnter</code> event happens. Note in particular the semantics of <code>accumB</code>: At the moment in time where <code>eEnter</code> happens, the value of <code>bString</code> is still the <em>old</em> value.</p>\n"}], "owner": {"reputation": 9267, "user_id": 2284221, "user_type": "registered", "accept_rate": 81, "profile_image": "https://www.gravatar.com/avatar/120d229a55c7a6ce3037e6932c190616?s=128&d=identicon&r=PG", "display_name": "Patrick Collins", "link": "https://stackoverflow.com/users/2284221/patrick-collins"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 79, "favorite_count": 0, "accepted_answer_id": 30646948, "answer_count": 1, "score": 3, "last_activity_date": 1444744752, "creation_date": 1433355994, "question_id": 30627866, "link": "https://stackoverflow.com/questions/30627866/resettable-accumulator-behaviors", "title": "Resettable accumulator behaviors?", "body": "<p>I'm trying to wrap my head around FRP and I'm not sure that I'm doing it right. I want to build up a string from key press events up until enter is pressed. Once enter is pressed, the string gets written out and the accumulator is reset to the empty string.</p>\n\n<p>I have a event source that emits a <code>Char</code> every time a key on the keyboard is pressed, <code>ePressed</code>. First, I separate out the two kinds of key presses I care about:</p>\n\n<pre><code>eWritable = filterE (`elem` ['A'..'z']) ePressed\neEnter = filterE (== '\\n') ePressed\n</code></pre>\n\n<p>Now I know how to gather them together into what I want to send out:</p>\n\n<pre><code>eToPrint = accumE \"\" (fmap (:) eWritable)\n</code></pre>\n\n<p>But I'm not sure how to \"hold on to\" this until enter is pressed, or how to reset it afterwards. What's the right, idomatic way to go about this?</p>\n"}, {"tags": ["haskell", "simd"], "comments": [{"owner": {"reputation": 2846, "user_id": 4347335, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/eb7e6f293a134a5defec74e12cae42cc?s=128&d=identicon&r=PG&f=1", "display_name": "cchalmers", "link": "https://stackoverflow.com/users/4347335/cchalmers"}, "edited": false, "score": 1, "creation_date": 1433347280, "post_id": 30624379, "comment_id": 49316356, "body": "There is a branch: <a href=\"https://github.com/haskell/vector/tree/simd\" rel=\"nofollow noreferrer\">github.com/haskell/vector/tree/simd</a> but it hasn&#39;t been worked on in a couple of years."}, {"owner": {"reputation": 8676, "user_id": 1113881, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/sBc0F.jpg?s=128&g=1", "display_name": "CR Drost", "link": "https://stackoverflow.com/users/1113881/cr-drost"}, "edited": false, "score": 1, "creation_date": 1433353877, "post_id": 30624379, "comment_id": 49320314, "body": "None of those SIMD operations appear to be used by <code>Data.Vector</code> in its source code."}, {"owner": {"reputation": 31108, "user_id": 350351, "user_type": "registered", "accept_rate": 85, "profile_image": "https://www.gravatar.com/avatar/b1a41bbf4677c8961237c4d147e764d6?s=128&d=identicon&r=PG", "display_name": "Daenyth", "link": "https://stackoverflow.com/users/350351/daenyth"}, "edited": false, "score": 2, "creation_date": 1433354704, "post_id": 30624379, "comment_id": 49320824, "body": "Related: <a href=\"http://stackoverflow.com/questions/1452309/generate-vector-code-from-haskell?rq=1\" title=\"generate vector code from haskell\">stackoverflow.com/questions/1452309/&hellip;</a>"}], "answers": [{"tags": [], "owner": {"reputation": 58792, "user_id": 1006010, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/f683d229f3673c9dcc3f3f2796d75c09?s=128&d=identicon&r=PG", "display_name": "MathematicalOrchid", "link": "https://stackoverflow.com/users/1006010/mathematicalorchid"}, "is_accepted": false, "score": 8, "last_activity_date": 1433346464, "creation_date": 1433346464, "answer_id": 30624888, "question_id": 30624379, "link": "https://stackoverflow.com/questions/30624379/does-haskell-perfom-simd-optimizations-automatically/30624888#30624888", "title": "Does Haskell perfom SIMD optimizations automatically?", "body": "<p>First: I had no idea GHC even had primops for SIMD. Nice find!</p>\n\n<p>Anyway, that aside, my understanding is this:</p>\n\n<ul>\n<li>The GHC native codegen backend will never emit SIMD instructions all by itself.</li>\n<li>The optional LLVM backend <em>may</em> produce SIMD, I don't know. But that's not the default compilation route; my understanding is it's still rather experimental.</li>\n<li>Given the existence of the primops you mention, the Vector library could conceivably be generating SIMD code. I suspect it isn't, but the only way to really know for sure is to ask the author(s) or just grep the source code...</li>\n<li>If you want something specific, it seems perfectly reasonable to code it yourself. I have no idea how much work it would be...</li>\n</ul>\n"}, {"tags": [], "owner": {"reputation": 445, "user_id": 189176, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/274a52c00e4f37979f33423fc8acf371?s=128&d=identicon&r=PG", "display_name": "Carter Tazio Schonwald", "link": "https://stackoverflow.com/users/189176/carter-tazio-schonwald"}, "is_accepted": true, "score": 6, "last_activity_date": 1433387550, "creation_date": 1433387550, "answer_id": 30634322, "question_id": 30624379, "link": "https://stackoverflow.com/questions/30624379/does-haskell-perfom-simd-optimizations-automatically/30634322#30634322", "title": "Does Haskell perfom SIMD optimizations automatically?", "body": "<p>there is absolutely no auto vectorization wrt SIMD in ghc at the moment. none</p>\n\n<p>the current simd primops will trigger a GHC panic when used with the native code gen, though they will work with the -fllvm backend. </p>\n\n<p>those simd primops crucially lack a good data model for data shuffling, the current data model will require a pretty substantial reworking to support simd shuffles properly.</p>\n\n<p>the llvm backend  <em>MAY</em> do certain auto vectorization optimizations on code, but i'd generally treat auto-vectorization as a bonus rather than a core assumption in how code gets optimized, it requires some careful auditing to validate!</p>\n"}], "owner": {"reputation": 653, "user_id": 2236092, "user_type": "registered", "accept_rate": 71, "profile_image": "https://www.gravatar.com/avatar/8e95a9d73105658172c8932d5a920751?s=128&d=identicon&r=PG", "display_name": "schernichkin", "link": "https://stackoverflow.com/users/2236092/schernichkin"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 1143, "favorite_count": 0, "accepted_answer_id": 30634322, "answer_count": 2, "score": 8, "last_activity_date": 1433387550, "creation_date": 1433345126, "question_id": 30624379, "link": "https://stackoverflow.com/questions/30624379/does-haskell-perfom-simd-optimizations-automatically", "title": "Does Haskell perfom SIMD optimizations automatically?", "body": "<p>It is possible to write SIMD-based vector library in Haskell using <a href=\"https://hackage.haskell.org/package/ghc-prim-0.4.0.0/docs/GHC-Prim.html#g:28\" rel=\"noreferrer\">https://hackage.haskell.org/package/ghc-prim-0.4.0.0/docs/GHC-Prim.html#g:28</a> but will it make any sense? I've came across several papers devoted to automatic SIMD optimization in Haskell, but what the current status (2014)? E.g. will <a href=\"https://hackage.haskell.org/package/vector\" rel=\"noreferrer\">https://hackage.haskell.org/package/vector</a> use SIMD or it is better to write optimized library manually using low-level SIMD primitives?</p>\n"}, {"tags": ["scala", "haskell", "return-type", "algebraic-data-types", "type-constructor"], "answers": [{"comments": [{"owner": {"reputation": 100892, "user_id": 745903, "user_type": "registered", "accept_rate": 74, "profile_image": "https://www.gravatar.com/avatar/50933f6638836741e620669b3940410e?s=128&d=identicon&r=PG", "display_name": "leftaroundabout", "link": "https://stackoverflow.com/users/745903/leftaroundabout"}, "edited": false, "score": 3, "creation_date": 1433344254, "post_id": 30623824, "comment_id": 49314028, "body": "There are extensions that give you <i>similar</i> ability, but it&#39;s quite crucial that Haskell has no subclassing, so you positively can&#39;t do <i>the same thing</i>.."}, {"owner": {"reputation": 51584, "user_id": 839246, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/9b0573c2b936b12828dd1e4cc04206dc?s=128&d=identicon&r=PG&f=1", "display_name": "bheklilr", "link": "https://stackoverflow.com/users/839246/bheklilr"}, "reply_to_user": {"reputation": 100892, "user_id": 745903, "user_type": "registered", "accept_rate": 74, "profile_image": "https://www.gravatar.com/avatar/50933f6638836741e620669b3940410e?s=128&d=identicon&r=PG", "display_name": "leftaroundabout", "link": "https://stackoverflow.com/users/745903/leftaroundabout"}, "edited": false, "score": 0, "creation_date": 1433344381, "post_id": 30623824, "comment_id": 49314141, "body": "@leftaroundabout Changed the wording a bit to make it more clear that I was referring to extensions that let you distinguish constructors at the type level, but that it isn&#39;t what Scala has.  Think it makes it more clear now?"}], "tags": [], "owner": {"reputation": 51584, "user_id": 839246, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/9b0573c2b936b12828dd1e4cc04206dc?s=128&d=identicon&r=PG&f=1", "display_name": "bheklilr", "link": "https://stackoverflow.com/users/839246/bheklilr"}, "is_accepted": true, "score": 12, "last_activity_date": 1433344305, "last_edit_date": 1433344305, "creation_date": 1433343692, "answer_id": 30623824, "question_id": 30623622, "link": "https://stackoverflow.com/questions/30623622/type-constructor-as-return-type/30623824#30623824", "title": "Type Constructor as Return Type", "body": "<p>The difference is how Scala chose to implement ADTs.  Scala uses case classes that extend a trait in an OOP style, so each case is its own type, whereas Haskell just has multiple constructors for the same type.  Since they aren't separate types but essentially just separate functions, you can't distinguish them at the type level.  There are extensions that give you some ability to make that type level distinction, but it won't be the same thing as what Scala has.  And trying to fit Haskell's type system into Scala's type system is probably not the best of ideas.</p>\n\n<p>In short, Scala approximates ADTs using a form of inheritance, whereas Haskell just has ADTs.</p>\n"}, {"comments": [{"owner": {"reputation": 44013, "user_id": 1477667, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/trgKM.jpg?s=128&g=1", "display_name": "dfeuer", "link": "https://stackoverflow.com/users/1477667/dfeuer"}, "edited": false, "score": 0, "creation_date": 1433426684, "post_id": 30628933, "comment_id": 49355745, "body": "Maybe I&#39;m missing something, but why not just return <code>a</code> directly?"}, {"owner": {"reputation": 44013, "user_id": 1477667, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/trgKM.jpg?s=128&g=1", "display_name": "dfeuer", "link": "https://stackoverflow.com/users/1477667/dfeuer"}, "edited": false, "score": 0, "creation_date": 1433458729, "post_id": 30628933, "comment_id": 49373942, "body": "What I meant is that, if you exclude bottoms, <code>Either Void a</code> is isomorphic to <code>a</code>. Why go to all that trouble?"}], "tags": [], "owner": {"reputation": 28456, "user_id": 1094403, "user_type": "registered", "accept_rate": 83, "profile_image": "https://www.gravatar.com/avatar/3770aa7eae5c211921493abd0d2c9f5a?s=128&d=identicon&r=PG", "display_name": "Luis Casillas", "link": "https://stackoverflow.com/users/1094403/luis-casillas"}, "is_accepted": false, "score": 0, "last_activity_date": 1433454392, "last_edit_date": 1495542632, "creation_date": 1433359660, "answer_id": 30628933, "question_id": 30623622, "link": "https://stackoverflow.com/questions/30623622/type-constructor-as-return-type/30628933#30628933", "title": "Type Constructor as Return Type", "body": "<p>bhelkir and leftaroundabout have pointed out why you can't do this exactly in Haskell: there is no notion of subtypes.</p>\n\n<p>But note that with ADTs there are often alternatives that allow you achieve the same effect.  In this case, one candidate technique would be to use <a href=\"https://hackage.haskell.org/package/void-0.7/docs/Data-Void.html\" rel=\"nofollow noreferrer\">the <code>Void</code> type</a> in conjunction with <code>Either</code>:</p>\n\n<pre><code>import Data.Void\n\nf :: Int -&gt; Either Void Int\nf x = Right x\n</code></pre>\n\n<p><code>Void</code> is a type that has no defined values.  Therefore if you see the type <code>Either Void a</code>, that means that since there's no value <code>x :: Void</code> nobody can ever construct any value of the form <code>Left x :: Either Void a</code>.  (The exception is if <code>x</code> is a guaranteed nonterminating value, but <a href=\"http://dev.stephendiehl.com/hask/#moral-correctness\" rel=\"nofollow noreferrer\">we customarily ignore that possibility</a>.)</p>\n\n<p>That means that an <code>Either Void a</code> is always of the form <code>Right a</code>, so for example, you can write this function:</p>\n\n<pre><code>-- | Extract the @a@ from @Either Void a@.\nextract :: Either Void a -&gt; a\nextract (Left x) = absurd x\nextract (Right a) = a\n</code></pre>\n\n<p>The <code>absurd x</code> there works basically like this: since <code>x :: Void</code> that means that there can never actually be a value for <code>x</code>, then <code>absurd :: Void -&gt; a</code>, given its type, is a function that is impossible to ever call.  The way the type system works this means that it can claim to return any type at all that the caller expects.  See <a href=\"https://stackoverflow.com/questions/14131856/whats-the-absurd-function-in-data-void-useful-for\">this question</a> for some more discussion (though maybe a bit advanced).</p>\n"}], "owner": {"reputation": 37991, "user_id": 409976, "user_type": "registered", "accept_rate": 68, "profile_image": "https://www.gravatar.com/avatar/9ccda0b49cc974197399eae01ebd6850?s=128&d=identicon&r=PG", "display_name": "Kevin Meredith", "link": "https://stackoverflow.com/users/409976/kevin-meredith"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 461, "favorite_count": 2, "accepted_answer_id": 30623824, "answer_count": 2, "score": 8, "last_activity_date": 1578153473, "creation_date": 1433343185, "last_edit_date": 1578153473, "question_id": 30623622, "link": "https://stackoverflow.com/questions/30623622/type-constructor-as-return-type", "title": "Type Constructor as Return Type", "body": "<p>In Scala, I can define an <a href=\"https://stackoverflow.com/questions/26689951/writing-algebraic-data-type-in-scala\">Algebraic Data Type</a>:</p>\n\n<pre><code>scala&gt; sealed trait Maybe[A]\ndefined trait Maybe\n\nscala&gt; case class Just[A](x: A) extends Maybe[A]\ndefined class Just\n\nscala&gt; case object NothingHere extends Maybe[Nothing]\ndefined object NothingHere\n</code></pre>\n\n<p>It's possible to return a function, <code>f</code>, with a return type of <code>Maybe[A]</code>.</p>\n\n<pre><code>scala&gt; def f[A](x: A): Maybe[A] = Just(x)\nf: [A](x: A)Maybe[A]\n</code></pre>\n\n<p>However, it's also possible to specify that a <code>Just[A]</code> is returned.    </p>\n\n<pre><code>scala&gt; def f[A](x: A): Just[A] = Just(x)\nf: [A](x: A)Just[A]\n</code></pre>\n\n<p>Now I'll do the similar exercise in Haskell:</p>\n\n<pre><code>Prelude&gt; data Option a = None | Some a deriving Show\nPrelude&gt; let f x = Some x :: Option Int\nPrelude&gt; f 10\nSome 10\n</code></pre>\n\n<p>But, I can't set a return type of a <em>type constructor</em>.</p>\n\n<pre><code>Prelude&gt; let f x = Some x :: Some Int\n\n&lt;interactive&gt;:10:21:\n    Not in scope: type constructor or class `Some'\n    A data constructor of that name is in scope; did you mean DataKinds?\nPrelude&gt; let f x = None :: None\n</code></pre>\n\n<p>Is the simple difference that Scala's <code>Just</code> is a class, i.e. a legitimate return type? Whereas, in Haskell, a <em>type constructor</em> cannot be a return type?</p>\n"}, {"tags": ["haskell", "binary-tree"], "answers": [{"comments": [{"owner": {"reputation": 28456, "user_id": 1094403, "user_type": "registered", "accept_rate": 83, "profile_image": "https://www.gravatar.com/avatar/3770aa7eae5c211921493abd0d2c9f5a?s=128&d=identicon&r=PG", "display_name": "Luis Casillas", "link": "https://stackoverflow.com/users/1094403/luis-casillas"}, "edited": false, "score": 1, "creation_date": 1433365029, "post_id": 30620908, "comment_id": 49326745, "body": "Indeed, not only are those functions not needed, they make things worse; they make it harder for the compiler to check whether the functions cover all cases (exhaustiveness checking)."}, {"owner": {"reputation": 28456, "user_id": 1094403, "user_type": "registered", "accept_rate": 83, "profile_image": "https://www.gravatar.com/avatar/3770aa7eae5c211921493abd0d2c9f5a?s=128&d=identicon&r=PG", "display_name": "Luis Casillas", "link": "https://stackoverflow.com/users/1094403/luis-casillas"}, "edited": false, "score": 1, "creation_date": 1433368045, "post_id": 30620908, "comment_id": 49328241, "body": "the idea is that when you write a function that consumes a union type like your <code>Tree</code> type, the compiler can warn you when you write functions that don&#39;t cover all of the subcases of the type, which helps catch situations where you forgot one of the type&#39;s subcases.  It&#39;s a simple thing, but it saves hours of frustration..."}], "tags": [], "owner": {"reputation": 46235, "user_id": 2541573, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/Z1qtP.png?s=128&g=1", "display_name": "jub0bs", "link": "https://stackoverflow.com/users/2541573/jub0bs"}, "is_accepted": true, "score": 8, "last_activity_date": 1433935617, "last_edit_date": 1495539822, "creation_date": 1433336548, "answer_id": 30620908, "question_id": 30620638, "link": "https://stackoverflow.com/questions/30620638/whats-wrong-with-my-iselement-function-binary-tree/30620908#30620908", "title": "What&#39;s wrong with my isElement function (binary tree)?", "body": "<p>There is a mistake in the definition of your <code>isElement</code> function: you're calling <code>leftTree</code> twice, instead of calling both <code>leftTree</code> and <code>rightTree</code>. As a result, right subtrees are never explored. Amend the code accordingly,</p>\n\n<pre class=\"lang-hs prettyprint-override\"><code>isElement tree t\n    |isNode tree == False = False \n    | nodeValue(tree) == t = True\n    | otherwise = (isElement (leftTree(tree)) t) || (isElement (rightTree(tree))\n</code></pre>\n\n<p>and then <code>isElement</code> works as advertised:</p>\n\n<pre class=\"lang-hs prettyprint-override\"><code>\u03bb&gt; let tree = Node 1 Empty (Node 2 Empty (Node 3 Empty Empty))\n\u03bb&gt; isElement tree 2\nTrue\n\u03bb&gt; isElement tree 3\nTrue\n\u03bb&gt; isElement tree 1\nTrue\n</code></pre>\n\n<p>However, there is still room for improvement. You don't really need all those functions (<code>isNode</code>, <code>nodeValue</code>, etc.) to define <code>isElement</code>. Instead, you can do all that unpacking with pattern matching, by breaking down the definition into two equations: one corresponding to the case where the tree is empty, and another corresponding to the case where the tree is a node:</p>\n\n<pre class=\"lang-hs prettyprint-override\"><code>isElement :: (Eq a) =&gt; Tree a -&gt; a -&gt; Bool\nisElement Empty        _ = False\nisElement (Node v l r) x = v == x || isElement l x || isElement r x\n</code></pre>\n\n<p><strong>Edit</strong>: as pointed out by Luis Casillas in <a href=\"https://stackoverflow.com/questions/30620638/whats-wrong-with-my-iselement-function-binary-tree/30620908#comment49326745_30620908\">his comment</a>, an additional benefit of this alternative definition is that it lends itself better (than the original definition) to <em>exhaustiveness checking</em> by the compiler.</p>\n"}], "owner": {"reputation": 53, "user_id": 4969650, "user_type": "registered", "accept_rate": 40, "profile_image": "https://www.gravatar.com/avatar/7f06fcfe8b5508d6c4d3d3c82bb73823?s=128&d=identicon&r=PG&f=1", "display_name": "Xeriotek", "link": "https://stackoverflow.com/users/4969650/xeriotek"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 303, "favorite_count": 1, "accepted_answer_id": 30620908, "answer_count": 1, "score": 2, "last_activity_date": 1433935617, "creation_date": 1433335827, "last_edit_date": 1433337447, "question_id": 30620638, "link": "https://stackoverflow.com/questions/30620638/whats-wrong-with-my-iselement-function-binary-tree", "title": "What&#39;s wrong with my isElement function (binary tree)?", "body": "<p>I'm working on a a function that check whether an element is part of a binary tree. I've defined a type for my tree called <code>Tree</code>, functions to get the root element and the left and right subtrees, and a function called <code>isElement</code> for checking whether a value is into my tree. Unfortunately, the function only works with the root element.</p>\n\n<p>The following example illustrates the incorrect results I get from my <code>isElement</code> function:</p>\n\n<pre class=\"lang-hs prettyprint-override\"><code>*Main&gt;let tree = Node 1 Empty (Node 2 Empty (Node 3 Empty Empty))\n*Main&gt; isElement  tree 2\nFalse\n*Main&gt; isElement  tree 3\nFalse\n*Main&gt; isElement  tree 1\nTrue\n</code></pre>\n\n<p>This is my code:</p>\n\n<pre class=\"lang-hs prettyprint-override\"><code>data Tree a = Node a (Tree a) (Tree a) \n        |Empty\n        deriving (Show)\n\nnodeValue :: Tree t -&gt; t\nnodeValue (Node x _ _) = x\n\nrightTree :: Tree t -&gt; Tree t\nrightTree (Node _ _ x) = x\n\nleftTree :: Tree t -&gt; Tree t\nleftTree (Node _ x _) = x\n\nisNode ::  Tree t -&gt; Bool \nisNode (Node _ _ _) = True\nisNode _ = False\n\nisElement :: (Eq t) =&gt; Tree t -&gt; t -&gt; Bool\nisElement tree t\n    |isNode tree == False = False \n    | nodeValue(tree) == t = True\n    | otherwise = (isElement (leftTree(tree)) t) || (isElement (leftTree(tree)) t)\n</code></pre>\n"}, {"tags": ["haskell", "tuples", "instance"], "comments": [{"owner": {"reputation": 7030, "user_id": 3032349, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/3cd8d19756aa9bc73d8045ae988ae728?s=128&d=identicon&r=PG&f=1", "display_name": "ThreeFx", "link": "https://stackoverflow.com/users/3032349/threefx"}, "edited": false, "score": 3, "creation_date": 1433335544, "post_id": 30619843, "comment_id": 49306945, "body": "No. At least not in an easy way. But you can just change the output of the <code>show</code> instance for tuples: <code>rewrite (&#39;(&#39;:xs) = replace &quot;,&quot; &quot; &quot; $ init xs</code> where <code>replace</code> is from <a href=\"https://hackage.haskell.org/package/MissingH-1.3.0.1/docs/Data-String-Utils.html\" rel=\"nofollow noreferrer\"><code>Data.String.Utils</code></a>."}, {"owner": {"reputation": 48129, "user_id": 76051, "user_type": "registered", "accept_rate": 91, "profile_image": "https://i.stack.imgur.com/AGDxz.jpg?s=128&g=1", "display_name": "Carsten", "link": "https://stackoverflow.com/users/76051/carsten"}, "edited": false, "score": 0, "creation_date": 1433336647, "post_id": 30619843, "comment_id": 49307858, "body": "if you can live with <i>nested</i>  tuples like <code>(1,(&#39;a&#39;,&quot;b&quot;))</code> it should be straight forward ;)"}, {"owner": {"reputation": 126897, "user_id": 791604, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/ce991df7a056248d5e4f6fc3659ba733?s=128&d=identicon&r=PG", "display_name": "Daniel Wagner", "link": "https://stackoverflow.com/users/791604/daniel-wagner"}, "edited": false, "score": 0, "creation_date": 1433368661, "post_id": 30619843, "comment_id": 49328530, "body": "It sounds to me like you are looking for a pretty-printing library. Have a look on Hackage; there are several good ones (with subtle differences)."}], "answers": [{"comments": [{"owner": {"reputation": 2337, "user_id": 3595992, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/a8fc8a00391b1282338f66de57e3fea0?s=128&d=identicon&r=PG&f=1", "display_name": "JeanJouX", "link": "https://stackoverflow.com/users/3595992/jeanjoux"}, "edited": false, "score": 0, "creation_date": 1433337387, "post_id": 30620888, "comment_id": 49308478, "body": "In fact, my <code>Data</code> type will contain several kind of types (Double, Integer, String, ...). And my lists of <code>Data</code> must be coherent and have fixed size. If I use lists of lists, I will had to perform many tests to check this cohesion. List of tuples will remain simpler."}, {"owner": {"reputation": 7030, "user_id": 3032349, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/3cd8d19756aa9bc73d8045ae988ae728?s=128&d=identicon&r=PG&f=1", "display_name": "ThreeFx", "link": "https://stackoverflow.com/users/3032349/threefx"}, "reply_to_user": {"reputation": 2337, "user_id": 3595992, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/a8fc8a00391b1282338f66de57e3fea0?s=128&d=identicon&r=PG&f=1", "display_name": "JeanJouX", "link": "https://stackoverflow.com/users/3595992/jeanjoux"}, "edited": false, "score": 2, "creation_date": 1433337723, "post_id": 30620888, "comment_id": 49308767, "body": "@JeanJouX This kind of sounds like you could make use of <a href=\"https://www.fpcomplete.com/user/konn/prove-your-haskell-for-great-safety/dependent-types-in-haskell\" rel=\"nofollow noreferrer\">this</a>."}, {"owner": {"reputation": 58792, "user_id": 1006010, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/f683d229f3673c9dcc3f3f2796d75c09?s=128&d=identicon&r=PG", "display_name": "MathematicalOrchid", "link": "https://stackoverflow.com/users/1006010/mathematicalorchid"}, "edited": false, "score": 2, "creation_date": 1433338028, "post_id": 30620888, "comment_id": 49309027, "body": "What do you mean by &quot;coherent&quot;?"}], "tags": [], "owner": {"reputation": 58792, "user_id": 1006010, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/f683d229f3673c9dcc3f3f2796d75c09?s=128&d=identicon&r=PG", "display_name": "MathematicalOrchid", "link": "https://stackoverflow.com/users/1006010/mathematicalorchid"}, "is_accepted": false, "score": 4, "last_activity_date": 1433336487, "creation_date": 1433336487, "answer_id": 30620888, "question_id": 30619843, "link": "https://stackoverflow.com/questions/30619843/extend-a-show-instance-to-a-tuple-of-any-size/30620888#30620888", "title": "Extend a Show instance to a Tuple of any size", "body": "<p>Haskell provides absolutely <em>no way</em> to write code that's polymorphic over tuples of different sizes.</p>\n\n<p>But given that all you seem to be doing is creating tuples of <code>Data</code> (which is really just <code>Double</code>), I have to ask... why not just use a list? You can easily, trivially handle lists of all possible sizes.</p>\n"}, {"comments": [{"owner": {"reputation": 100185, "user_id": 3234959, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/93bb12ca0f93dfddb33880316f7e66c2?s=128&d=identicon&r=PG&f=1", "display_name": "chi", "link": "https://stackoverflow.com/users/3234959/chi"}, "edited": false, "score": 1, "creation_date": 1433346695, "post_id": 30624226, "comment_id": 49315952, "body": "I like the somewhat vs massively evil distinction."}, {"owner": {"reputation": 7030, "user_id": 3032349, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/3cd8d19756aa9bc73d8045ae988ae728?s=128&d=identicon&r=PG&f=1", "display_name": "ThreeFx", "link": "https://stackoverflow.com/users/3032349/threefx"}, "edited": false, "score": 0, "creation_date": 1433347440, "post_id": 30624226, "comment_id": 49316471, "body": "For clarification: Are Idris&#39; tuples isomorph to Haskell&#39;s lists?"}, {"owner": {"reputation": 44013, "user_id": 1477667, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/trgKM.jpg?s=128&g=1", "display_name": "dfeuer", "link": "https://stackoverflow.com/users/1477667/dfeuer"}, "reply_to_user": {"reputation": 7030, "user_id": 3032349, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/3cd8d19756aa9bc73d8045ae988ae728?s=128&d=identicon&r=PG&f=1", "display_name": "ThreeFx", "link": "https://stackoverflow.com/users/3032349/threefx"}, "edited": false, "score": 1, "creation_date": 1433349218, "post_id": 30624226, "comment_id": 49317521, "body": "@ThreeFx, no, they&#39;re really just pairs. In Idris, tuple sytax is pure sugar, <code>the (Nat `Pair` (Char `Pair` String)) (1,(&#39;2&#39;,&quot;3&quot;))</code> gets you <code>(1, &#39;2&#39;, &quot;3&quot;) : (Nat, Char, String)</code>."}, {"owner": {"reputation": 7030, "user_id": 3032349, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/3cd8d19756aa9bc73d8045ae988ae728?s=128&d=identicon&r=PG&f=1", "display_name": "ThreeFx", "link": "https://stackoverflow.com/users/3032349/threefx"}, "edited": false, "score": 0, "creation_date": 1433349456, "post_id": 30624226, "comment_id": 49317656, "body": "@dfeuer You&#39;re right of course, thank you. I forgot about heterogeneous collections."}], "tags": [], "owner": {"reputation": 44013, "user_id": 1477667, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/trgKM.jpg?s=128&g=1", "display_name": "dfeuer", "link": "https://stackoverflow.com/users/1477667/dfeuer"}, "is_accepted": true, "score": 3, "last_activity_date": 1433344741, "creation_date": 1433344741, "answer_id": 30624226, "question_id": 30619843, "link": "https://stackoverflow.com/questions/30619843/extend-a-show-instance-to-a-tuple-of-any-size/30624226#30624226", "title": "Extend a Show instance to a Tuple of any size", "body": "<h3>How to write generic code for tuples</h3>\n\n<p>This is <em>not</em> supported directly in the language, because tuples in Haskell are all or nothing. In Idris, this would be easy, because <code>(a,b,c)</code> actually means <code>(a,(b,c))</code>. Haskell's laziness would make that representation inefficient, and in any case Haskell just has a different concept of what a tuple is. However, you can use <a href=\"https://wiki.haskell.org/GHC.Generics\" rel=\"nofollow\">generics</a> to write that sort of code! I promise it will be painful.</p>\n\n<h3>Why what you're trying to do is a bad idea</h3>\n\n<p>The biggest problem is not that you are trying to make generic tuple code. The biggest problem is that your <code>Show</code> instances overlap the usual ones. The base libraries already export</p>\n\n<pre><code>instance (Show a, Show b) =&gt; Show (a, b)\ninstance (Show a, Show b, Show c) =&gt; Show (a,b,c)\n</code></pre>\n\n<p>etc. When figuring out whether instances overlap, you must look only on the <em>right side</em> of the <code>=&gt;</code>. So even if your <code>Data</code> is not in <code>Show</code>, you have a problem. Haskell insists on committing to a choice of instance before even looking to the left of the arrow. By default, it does this by complaining about overlapping instances if it can't resolve the instance uniquely. If you <code>OverlappingInstances</code>, you <em>might</em> get it working, but this is not a good use case for that somewhat evil extension. If you use <code>IncoherentInstances</code>, it will probably work, but that is such a massively evil extension that it is much better to pretend it does not exist at all.</p>\n"}], "owner": {"reputation": 2337, "user_id": 3595992, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/a8fc8a00391b1282338f66de57e3fea0?s=128&d=identicon&r=PG&f=1", "display_name": "JeanJouX", "link": "https://stackoverflow.com/users/3595992/jeanjoux"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 354, "favorite_count": 0, "accepted_answer_id": 30624226, "answer_count": 2, "score": 1, "last_activity_date": 1433344741, "creation_date": 1433333779, "last_edit_date": 1433336208, "question_id": 30619843, "link": "https://stackoverflow.com/questions/30619843/extend-a-show-instance-to-a-tuple-of-any-size", "title": "Extend a Show instance to a Tuple of any size", "body": "<p>I want to create a new type of data with Haskell and create the related <code>Show</code> instances. I need to create the tuple Show instance with another delimiter than <code>,</code>.  </p>\n\n<p>I implemented this code (with the <code>{-# LANGUAGE FlexibleInstances  #-}</code> pragma): </p>\n\n<pre><code>newtype Data = Data Double\n\ninstance Show Data where\n  show (Data dat) = show dat\n\ninstance Show (Data,Data) where\n  show (Data d1,Data d2) = show d1++\" \"++show d2\n\ninstance Show (Data,Data,Data) where\n  show (Data d1,Data d2,Data d3) = show d1++\" \"++show d2++\" \"++show d3\n</code></pre>\n\n<p><strong>Is it possible to automatically extend the Show instance to tuples of any size without manually creating the instances?</strong></p>\n\n<hr>\n\n<p><em>Note : I'm aware I could use <code>concat $ intersperse \" \" ...</code> to intercalate things between list elements. But for many reasons I wish to use tuples rather than lists.</em></p>\n"}, {"tags": ["haskell", "type-families", "idris"], "comments": [{"owner": {"reputation": 48129, "user_id": 76051, "user_type": "registered", "accept_rate": 91, "profile_image": "https://i.stack.imgur.com/AGDxz.jpg?s=128&g=1", "display_name": "Carsten", "link": "https://stackoverflow.com/users/76051/carsten"}, "edited": false, "score": 3, "creation_date": 1433334548, "post_id": 30619750, "comment_id": 49306190, "body": "I think you don&#39;t need this - remember you have even better tools: <a href=\"http://docs.idris-lang.org/en/latest/tutorial/typesfuns.html#first-class-types\" rel=\"nofollow noreferrer\">first class types</a> - so you can write <code>Elem</code> as a function"}, {"owner": {"reputation": 11366, "user_id": 3922954, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/76ba47d2fdd24ab56b0b273cce2075e5?s=128&d=identicon&r=PG&f=1", "display_name": "AJF", "link": "https://stackoverflow.com/users/3922954/ajf"}, "reply_to_user": {"reputation": 48129, "user_id": 76051, "user_type": "registered", "accept_rate": 91, "profile_image": "https://i.stack.imgur.com/AGDxz.jpg?s=128&g=1", "display_name": "Carsten", "link": "https://stackoverflow.com/users/76051/carsten"}, "edited": false, "score": 0, "creation_date": 1433342444, "post_id": 30619750, "comment_id": 49312565, "body": "@Carsten I realise that, but how might I constrain that function to instances of that typeclass?"}, {"owner": {"reputation": 44013, "user_id": 1477667, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/trgKM.jpg?s=128&g=1", "display_name": "dfeuer", "link": "https://stackoverflow.com/users/1477667/dfeuer"}, "edited": false, "score": 1, "creation_date": 1433345086, "post_id": 30619750, "comment_id": 49314727, "body": "I think you probably don&#39;t have a problem with associated type families at all. Idris does not, however, offer associated <i>data</i> families, and I don&#39;t know if that will keep you from doing something or other. It also doesn&#39;t have Haskell-style non-associated type families; there is no pattern matching whatsoever on type constructors."}], "answers": [{"comments": [{"owner": {"reputation": 11366, "user_id": 3922954, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/76ba47d2fdd24ab56b0b273cce2075e5?s=128&d=identicon&r=PG&f=1", "display_name": "AJF", "link": "https://stackoverflow.com/users/3922954/ajf"}, "edited": false, "score": 1, "creation_date": 1433349726, "post_id": 30623992, "comment_id": 49317814, "body": "I might ask, why isn&#39;t <code>llElem : Type -&gt; Type</code> rather than <code>Type</code>? Surely it&#39;s an undecidable instance?"}, {"owner": {"reputation": 48129, "user_id": 76051, "user_type": "registered", "accept_rate": 91, "profile_image": "https://i.stack.imgur.com/AGDxz.jpg?s=128&g=1", "display_name": "Carsten", "link": "https://stackoverflow.com/users/76051/carsten"}, "reply_to_user": {"reputation": 11366, "user_id": 3922954, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/76ba47d2fdd24ab56b0b273cce2075e5?s=128&d=identicon&r=PG&f=1", "display_name": "AJF", "link": "https://stackoverflow.com/users/3922954/ajf"}, "edited": false, "score": 1, "creation_date": 1433351061, "post_id": 30623992, "comment_id": 49318601, "body": "load it into idris and have a look at the types (<code>:t</code>) - you can get almost the same in Haskell with <code>data</code> instead of <code>type</code> inside your family - <code>llElem</code> is <code>ListLike k =&gt; Type</code> so it makes sense in <code>ListLike k =&gt; List llElem -&gt; k</code> and you don&#39;t really need/want more here (or so I guess)"}, {"owner": {"reputation": 48129, "user_id": 76051, "user_type": "registered", "accept_rate": 91, "profile_image": "https://i.stack.imgur.com/AGDxz.jpg?s=128&g=1", "display_name": "Carsten", "link": "https://stackoverflow.com/users/76051/carsten"}, "reply_to_user": {"reputation": 11366, "user_id": 3922954, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/76ba47d2fdd24ab56b0b273cce2075e5?s=128&d=identicon&r=PG&f=1", "display_name": "AJF", "link": "https://stackoverflow.com/users/3922954/ajf"}, "edited": false, "score": 1, "creation_date": 1433351136, "post_id": 30623992, "comment_id": 49318648, "body": "another way to do it in Haskell would be with a two param type class and <a href=\"https://wiki.haskell.org/Functional_dependencies\" rel=\"nofollow noreferrer\">functional dependencies</a> - the important fact is that <code>k</code>implies <code>llElem</code>"}, {"owner": {"reputation": 4376, "user_id": 1125109, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/6cb825e085d5544406ae6f9887702e02?s=128&d=identicon&r=PG", "display_name": "Edwin Brady", "link": "https://stackoverflow.com/users/1125109/edwin-brady"}, "reply_to_user": {"reputation": 11366, "user_id": 3922954, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/76ba47d2fdd24ab56b0b273cce2075e5?s=128&d=identicon&r=PG&f=1", "display_name": "AJF", "link": "https://stackoverflow.com/users/3922954/ajf"}, "edited": false, "score": 2, "creation_date": 1433402573, "post_id": 30623992, "comment_id": 49339665, "body": "@AJFarmar <code>llElem</code> can&#39;t be used on its own, but the appropriate instance can be determined from the use of <code>fromList</code>. Idris doesn&#39;t actually check this at the moment in the definition of this class (but it should and will soon)."}, {"owner": {"reputation": 1767, "user_id": 2604197, "user_type": "registered", "accept_rate": 62, "profile_image": "https://i.stack.imgur.com/rGs75.jpg?s=128&g=1", "display_name": "Boldizs&#225;r N&#233;meth", "link": "https://stackoverflow.com/users/2604197/boldizs%c3%a1r-n%c3%a9meth"}, "edited": false, "score": 0, "creation_date": 1436722911, "post_id": 30623992, "comment_id": 50720526, "body": "For me Idris 0.9.18 reports 3 errors for the given code <code>DecEq.idr:1:7:When elaborating type of Main.fromList: Can&#39;t resolve type class ListLike k DecEq.idr:5:10:ListLike is not a type class DecEq.idr:9:10:ListLike is not a type class</code>"}], "tags": [], "owner": {"reputation": 48129, "user_id": 76051, "user_type": "registered", "accept_rate": 91, "profile_image": "https://i.stack.imgur.com/AGDxz.jpg?s=128&g=1", "display_name": "Carsten", "link": "https://stackoverflow.com/users/76051/carsten"}, "is_accepted": true, "score": 8, "last_activity_date": 1433344550, "last_edit_date": 1433344550, "creation_date": 1433344082, "answer_id": 30623992, "question_id": 30619750, "link": "https://stackoverflow.com/questions/30619750/haskell-style-type-families/30623992#30623992", "title": "Haskell-style type families", "body": "<p>I have no clue if you will ever find a use for this, but I think the obvious translation should be</p>\n\n<pre><code>class ListLike k where\n    llElem : Type\n    fromList : List llElem -&gt; k\n\ninstance ListLike (List a) where\n    llElem = a\n    fromList = id\n\ninstance ListLike (Maybe a) where\n  llElem = a\n  fromList [] = Nothing\n  fromList (a::_) = Just a\n</code></pre>\n\n<h3>usage</h3>\n\n<pre><code>\u03bb\u03a0&gt; the (Maybe Int) (fromList [3])\nJust 3 : Maybe Int\n\u03bb\u03a0&gt; the (List Int) (fromList [3])\n[3] : List Int\n</code></pre>\n"}], "owner": {"reputation": 11366, "user_id": 3922954, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/76ba47d2fdd24ab56b0b273cce2075e5?s=128&d=identicon&r=PG&f=1", "display_name": "AJF", "link": "https://stackoverflow.com/users/3922954/ajf"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 636, "favorite_count": 1, "accepted_answer_id": 30623992, "answer_count": 1, "score": 10, "last_activity_date": 1433344550, "creation_date": 1433333457, "last_edit_date": 1433342561, "question_id": 30619750, "link": "https://stackoverflow.com/questions/30619750/haskell-style-type-families", "title": "Haskell-style type families", "body": "<p>In Haskell, I might write a typeclass with a <code>type</code> declaration to create a type family, like so:</p>\n\n<pre><code>class ListLike k where\n    type Elem ::  * -&gt; *\n    fromList :: [Elem k] -&gt; k\n</code></pre>\n\n<p>And then write instances like this:</p>\n\n<pre><code>instance ListLike [a] where\n    type Elem [a] = a\n    fromList = id\n\ninstance ListLike Bytestring where\n    type Elem Bytestring = Char\n    fromList = pack\n</code></pre>\n\n<p>I'm aware that you can create typeclasses  and type-level functions in Idris, but the methods operate on data of the given type, not the type itself.</p>\n\n<p>How can I make a typeclass-constrained type family in Idris like the one above?</p>\n"}, {"tags": ["haskell"], "comments": [{"owner": {"reputation": 1747, "user_id": 215381, "user_type": "registered", "accept_rate": 77, "profile_image": "https://www.gravatar.com/avatar/4ab17df223036dd5a9e9e93696a76525?s=128&d=identicon&r=PG", "display_name": "sigrlami", "link": "https://stackoverflow.com/users/215381/sigrlami"}, "edited": false, "score": 2, "creation_date": 1433324591, "post_id": 30616174, "comment_id": 49299125, "body": "you&#39;re looking for <a href=\"https://hackage.haskell.org/package/base-4.7.0.2/docs/System-Exit.html\" rel=\"nofollow noreferrer\">hackage.haskell.org/package/base-4.7.0.2/docs/System-Exit.ht&zwnj;&#8203;ml</a> but I suggest you to switch to normal library for opts parsing like <a href=\"http://hackage.haskell.org/package/optparse-applicative\" rel=\"nofollow noreferrer\">hackage.haskell.org/package/optparse-applicative</a>"}], "answers": [{"tags": [], "owner": {"reputation": 100892, "user_id": 745903, "user_type": "registered", "accept_rate": 74, "profile_image": "https://www.gravatar.com/avatar/50933f6638836741e620669b3940410e?s=128&d=identicon&r=PG", "display_name": "leftaroundabout", "link": "https://stackoverflow.com/users/745903/leftaroundabout"}, "is_accepted": false, "score": 9, "last_activity_date": 1433325305, "last_edit_date": 1433325305, "creation_date": 1433324639, "answer_id": 30616443, "question_id": 30616174, "link": "https://stackoverflow.com/questions/30616174/how-can-i-make-a-simple-exit-in-haskell/30616443#30616443", "title": "How Can I Make a Simple Exit in Haskell?", "body": "<p><code>return ()</code> will work here. In this case, <code>return</code> actually behaves like it would in a procedural language (but watch out, this is <em>not</em> generally true).</p>\n\n<p>Note on style: chains of <code>if</code>...<code>else</code> with equality comparisons are very un-idiomatic in Haskell. The right way to do this is a <code>case</code>:</p>\n\n<pre><code>main =  do \n     putStrLn \"Meniu: \"\n     sequence_ [ putStrLn $ [n]++\". menu \"++[n] | n&lt;-['1'..'5'] ]\n     putStrLn \"-------------------------\"\n     putStr \"Enter option: \"\n\n     opt &lt;- getLine\n     case opt of\n      \"1\" -&gt; do\n        Code one etc\n        main\n      \"2\" -&gt; do\n        Code 2 etc\n        main\n      \"3\" -&gt; do\n        code 3 etc\n        main\n      \"4\" -&gt; do\n        code 4 etc\n        main\n      \"5\" -&gt; return ()\n      _ -&gt; putStrLn \"Option does not exist\"\n</code></pre>\n\n<p>Braces and semicolons aren't needed if you correctly indent the code.</p>\n\n<p>What <code>return ()</code> does here is simply... nothing at all, it's the no-op. Because <code>main</code> ends after the <code>case</code> switch, the program will then also end if you don't recurse back to <code>main</code> like in the other options.</p>\n"}], "owner": {"reputation": 127, "user_id": 4968909, "user_type": "registered", "accept_rate": 43, "profile_image": "https://www.gravatar.com/avatar/eeb8f4702bd3d3c70d0729a777ccb7ca?s=128&d=identicon&r=PG&f=1", "display_name": "RedoColor", "link": "https://stackoverflow.com/users/4968909/redocolor"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 401, "favorite_count": 1, "answer_count": 1, "score": 1, "last_activity_date": 1433326828, "creation_date": 1433323994, "last_edit_date": 1433324348, "question_id": 30616174, "link": "https://stackoverflow.com/questions/30616174/how-can-i-make-a-simple-exit-in-haskell", "title": "How Can I Make a Simple Exit in Haskell?", "body": "<p>This is the code:</p>\n\n<pre><code>main :: IO()\nmain =  do \n{\n         putStrLn (\"Meniu: \");\n         putStrLn (\"1. menu 1\");\n         putStrLn (\"2. menu 2\");\n         putStrLn (\"3. menu 3\");\n         putStrLn (\"4. menu 4\");\n         putStrLn (\"5. Exit - Iesire)\");\n         putStrLn (\"-------------------------\");\n         putStr (\"Enter option: \");\n         opt &lt;- getLine;\n         if(opt == \"1\") then do\n         {\n            Code one etc\n            main\n         }\n            else if(opt == \"2\") then do\n         {\n            Code 2 etc\n            main\n         }\n            else if(opt == \"3\") then do\n         {\n            code 3 etc\n            main\n         }\n         else if(opt == \"4\") then do\n         {\n            code 4 etc\n            main\n\n         }\n         else if(opt == \"5\") then do\n         {\n            ??????????? ()\n         }\n         else putStrLn \"Option is not exist\";\n}\n</code></pre>\n\n<p>The Problem:\nIn the option 5 <code>(opt == 5)</code> I need to make an code to stop the menu, but I dont know how I can do this.\nI tried to find more examples on Google and StackOverflow, but I really can't find a solution.</p>\n"}, {"tags": ["list", "haskell"], "comments": [{"owner": {"reputation": 100185, "user_id": 3234959, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/93bb12ca0f93dfddb33880316f7e66c2?s=128&d=identicon&r=PG&f=1", "display_name": "chi", "link": "https://stackoverflow.com/users/3234959/chi"}, "edited": false, "score": 1, "creation_date": 1433323116, "post_id": 30615303, "comment_id": 49298069, "body": "Can you assume the <code>board</code> is sorted?"}, {"owner": {"reputation": 368, "user_id": 4204160, "user_type": "registered", "accept_rate": 81, "profile_image": "https://www.gravatar.com/avatar/62550e8dec6bd6a777fe3c0013b820df?s=128&d=identicon&r=PG&f=1", "display_name": "Marcin", "link": "https://stackoverflow.com/users/4204160/marcin"}, "reply_to_user": {"reputation": 100185, "user_id": 3234959, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/93bb12ca0f93dfddb33880316f7e66c2?s=128&d=identicon&r=PG&f=1", "display_name": "chi", "link": "https://stackoverflow.com/users/3234959/chi"}, "edited": false, "score": 0, "creation_date": 1433323180, "post_id": 30615303, "comment_id": 49298109, "body": "@chi yes, it&#39;s sorted when I call the function"}, {"owner": {"reputation": 46235, "user_id": 2541573, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/Z1qtP.png?s=128&g=1", "display_name": "jub0bs", "link": "https://stackoverflow.com/users/2541573/jub0bs"}, "edited": false, "score": 2, "creation_date": 1433323476, "post_id": 30615303, "comment_id": 49298328, "body": "You could generate the board full of zeroes, and then walk along your input board and that zero board &quot;in parallel&quot;, and fill in zeroes where needed. O(n^2) time complexity."}], "answers": [{"comments": [{"owner": {"reputation": 100185, "user_id": 3234959, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/93bb12ca0f93dfddb33880316f7e66c2?s=128&d=identicon&r=PG&f=1", "display_name": "chi", "link": "https://stackoverflow.com/users/3234959/chi"}, "edited": false, "score": 1, "creation_date": 1433323895, "post_id": 30615926, "comment_id": 49298620, "body": "The O(..) complexity bounds look a bit off -- you are producing a O(n^2)-long list as output, so you can&#39;t get lower than that."}, {"owner": {"reputation": 6942, "user_id": 1540749, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/dd6c24a0bc5c0a59a456aa8b08a78b6a?s=128&d=identicon&r=PG", "display_name": "josejuan", "link": "https://stackoverflow.com/users/1540749/josejuan"}, "reply_to_user": {"reputation": 100185, "user_id": 3234959, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/93bb12ca0f93dfddb33880316f7e66c2?s=128&d=identicon&r=PG&f=1", "display_name": "chi", "link": "https://stackoverflow.com/users/3234959/chi"}, "edited": false, "score": 0, "creation_date": 1433324101, "post_id": 30615926, "comment_id": 49298762, "body": "@chi I add <code>~</code> to express an informal analysis, <code>n</code> is not an argument there but to me, is the length data (<code>n&#47;2</code> defaults and <code>n&#47;2</code> max data take <code>O(n^2)</code> and <code>O(n log n)</code> for each aproach). I think that is understandable and better than <code>O(a^4 b^4)</code> and <code>O(a^2 b^2 log ab)</code> :)"}, {"owner": {"reputation": 100185, "user_id": 3234959, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/93bb12ca0f93dfddb33880316f7e66c2?s=128&d=identicon&r=PG&f=1", "display_name": "chi", "link": "https://stackoverflow.com/users/3234959/chi"}, "edited": false, "score": 1, "creation_date": 1433324358, "post_id": 30615926, "comment_id": 49298930, "body": "I am still puzzled. If I call e.g. <code>fill 10 10 defaults</code>, this produces a list having <code>10^2</code> cells, and for each of this you search defaults. Even assuming defaults is sparse and only ~10 cells long, we get to 10^3 total cost. I think the first case is O(n^3), at least."}], "tags": [], "owner": {"reputation": 6942, "user_id": 1540749, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/dd6c24a0bc5c0a59a456aa8b08a78b6a?s=128&d=identicon&r=PG", "display_name": "josejuan", "link": "https://stackoverflow.com/users/1540749/josejuan"}, "is_accepted": true, "score": 5, "last_activity_date": 1433323377, "creation_date": 1433323377, "answer_id": 30615926, "question_id": 30615303, "link": "https://stackoverflow.com/questions/30615303/haskell-filling-list-with-missing-elements/30615926#30615926", "title": "Haskell filling list with missing elements", "body": "<p>A direct way may be (with ~O(n^2) cost)</p>\n\n<pre><code>fill :: Int -&gt; Int -&gt; [(Int, Int, Int)] -&gt; [(Int, Int, Int)] \nfill a b defaults = [(x, y, maybe 0 id (search x y defaults)) | x &lt;- [1..a], y &lt;- [1..b]]\n           where search _ _ [] = Nothing\n                 search x y ((u,v,k):rs) | x == u &amp;&amp; y == v = Just k\n                                         | otherwise        = search x y rs\n</code></pre>\n\n<p>but I prefer split key/values like (with ~O(n log n) cost)</p>\n\n<pre><code>import Data.Map hiding (foldr)\n\n-- using key/value\nfill' :: Int -&gt; Int -&gt; [((Int, Int), Int)] -&gt; [((Int, Int), Int)]\nfill' a b defaults = assocs\n                   $ foldr (\\(k, v) m -&gt; insertWith (+) k v m) empty\n                   $ defaults ++ [((x,y),0) | x &lt;- [1..a], y &lt;- [1..b]]\n</code></pre>\n\n<p>example</p>\n\n<pre><code>main = do\n\n    print $ fill 3 3 [(1,2,2),(1,3,5),(3,2,3)]\n    print $ fill' 3 3 [((1,2),2),((1,3),5),((3,2),3)]\n</code></pre>\n\n<p>yours default values are 0, if not, you must replace <code>(+)</code> on <code>insertWith</code>. Can you think how?</p>\n"}, {"tags": [], "owner": {"reputation": 100185, "user_id": 3234959, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/93bb12ca0f93dfddb33880316f7e66c2?s=128&d=identicon&r=PG&f=1", "display_name": "chi", "link": "https://stackoverflow.com/users/3234959/chi"}, "is_accepted": false, "score": 6, "last_activity_date": 1433323433, "creation_date": 1433323433, "answer_id": 30615948, "question_id": 30615303, "link": "https://stackoverflow.com/questions/30615303/haskell-filling-list-with-missing-elements/30615948#30615948", "title": "Haskell filling list with missing elements", "body": "<p>I'd start from e.g.</p>\n\n<pre><code>zeroBoard :: Int -&gt; Int -&gt; [(Int, Int, Int)]\nzeroBoard width height = [ (x,y,0) | x &lt;- [1..width], y &lt;- [1..height] ]\n</code></pre>\n\n<p>Then we can use <em>single</em> recursion, as in:</p>\n\n<pre><code>fill::Int-&gt;Int-&gt;[(Int, Int, Int)]-&gt;[(Int, Int, Int)] \nfill width height board = go board $ zeroBoard width height\n   where go []             zs                 = zs\n         go (t@(x,y,z):bs) (t'@(x',y',z'):zs) =\n                if ... \n                then t : go ...\n                else t': go ...\n</code></pre>\n\n<p>You can even skip the zeros in <code>zeroBoard</code> and add 0 directly inside <code>go</code>.</p>\n"}, {"comments": [{"owner": {"reputation": 126897, "user_id": 791604, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/ce991df7a056248d5e4f6fc3659ba733?s=128&d=identicon&r=PG", "display_name": "Daniel Wagner", "link": "https://stackoverflow.com/users/791604/daniel-wagner"}, "edited": false, "score": 0, "creation_date": 1433368872, "post_id": 30622641, "comment_id": 49328615, "body": "I would even be tempted to change the interface to <code>fill</code> for this example to cut out the mapping noise and show just how close a fit <code>Array</code> really is here."}, {"owner": {"reputation": 126897, "user_id": 791604, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/ce991df7a056248d5e4f6fc3659ba733?s=128&d=identicon&r=PG", "display_name": "Daniel Wagner", "link": "https://stackoverflow.com/users/791604/daniel-wagner"}, "edited": false, "score": 0, "creation_date": 1433369137, "post_id": 30622641, "comment_id": 49328758, "body": "(Also consider using <code>accumArray</code>; e.g. <code>fill w h b = assocs $ accumArray (\\def actual -&gt; actual) 0 ((1, 1), (w, h)) b</code>.)"}], "tags": [], "owner": {"reputation": 14485, "user_id": 190376, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/cd8280c5e1491b8cf55760750ed97dec?s=128&d=identicon&r=PG", "display_name": "Reid Barton", "link": "https://stackoverflow.com/users/190376/reid-barton"}, "is_accepted": false, "score": 2, "last_activity_date": 1433340771, "creation_date": 1433340771, "answer_id": 30622641, "question_id": 30615303, "link": "https://stackoverflow.com/questions/30615303/haskell-filling-list-with-missing-elements/30622641#30622641", "title": "Haskell filling list with missing elements", "body": "<p>The array API is convenient here and gives you the right asymptotics as well.</p>\n\n<pre><code>import Data.Array\n\nfill :: Int -&gt; Int -&gt; [(Int, Int, Int)] -&gt; [(Int, Int, Int)]\nfill width height board =\n  map (\\((x, y), v) -&gt; (x, y, v)) . assocs $\n    listArray ((1,1),(width,height)) (repeat 0)\n      // map (\\(x, y, v) -&gt; ((x, y), v)) board\n</code></pre>\n"}], "owner": {"reputation": 368, "user_id": 4204160, "user_type": "registered", "accept_rate": 81, "profile_image": "https://www.gravatar.com/avatar/62550e8dec6bd6a777fe3c0013b820df?s=128&d=identicon&r=PG&f=1", "display_name": "Marcin", "link": "https://stackoverflow.com/users/4204160/marcin"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 894, "favorite_count": 0, "accepted_answer_id": 30615926, "answer_count": 3, "score": 1, "last_activity_date": 1433340771, "creation_date": 1433321806, "question_id": 30615303, "link": "https://stackoverflow.com/questions/30615303/haskell-filling-list-with-missing-elements", "title": "Haskell filling list with missing elements", "body": "<p>I'm trying to write a function</p>\n\n<pre><code>fill::Int-&gt;Int-&gt;[(Int, Int, Int)]-&gt;[(Int, Int, Int)] \nfill width height board = ...\n</code></pre>\n\n<p>that \"fills\" the given board ( in a single (Int, Int, Int) triple on the board the first two Ints are coordinates, the third one is a value at that field ) with the missing ones (with third coordinate set to 0), e.g.:</p>\n\n<pre><code>let x = fill 3 3 [(1,2,2),(1,3,5),(3,2,3)]\n</code></pre>\n\n<p>should result in</p>\n\n<pre><code>x = [(1,1,0),(1,2,2),(1,3,5),(2,1,0),(2,2,0),(2,3,0),(3,1,0),(3,2,3),(3,3,0)].\n</code></pre>\n\n<p>Is there some nice function that could be used here, or is some complicated double recursion in order?</p>\n"}, {"tags": ["haskell", "math", "ghc", "number-theory"], "comments": [{"owner": {"reputation": 100892, "user_id": 745903, "user_type": "registered", "accept_rate": 74, "profile_image": "https://www.gravatar.com/avatar/50933f6638836741e620669b3940410e?s=128&d=identicon&r=PG", "display_name": "leftaroundabout", "link": "https://stackoverflow.com/users/745903/leftaroundabout"}, "edited": false, "score": 1, "creation_date": 1433318400, "post_id": 30613542, "comment_id": 49294942, "body": "GHC 7.8 isn&#39;t really able to do any arithmetic <i>at all</i>, its <code>Nat</code>s are pretty much just as dumb (because, as general) as any other types. I think only 7.12 will be able to do all of that stuff quite the way you&#39;d like. (But I think there&#39;s some plugin that gets things working even in 7.8.)"}, {"owner": {"reputation": 28873, "user_id": 1068232, "user_type": "registered", "accept_rate": 79, "profile_image": "https://www.gravatar.com/avatar/2a0a145ce58c20013969fe3f203531da?s=128&d=identicon&r=PG", "display_name": "Andr&#225;s Kov&#225;cs", "link": "https://stackoverflow.com/users/1068232/andr%c3%a1s-kov%c3%a1cs"}, "reply_to_user": {"reputation": 100892, "user_id": 745903, "user_type": "registered", "accept_rate": 74, "profile_image": "https://www.gravatar.com/avatar/50933f6638836741e620669b3940410e?s=128&d=identicon&r=PG", "display_name": "leftaroundabout", "link": "https://stackoverflow.com/users/745903/leftaroundabout"}, "edited": false, "score": 2, "creation_date": 1433318603, "post_id": 30613542, "comment_id": 49295051, "body": "@leftaroundabout: <a href=\"https://hackage.haskell.org/package/ghc-typelits-natnormalise\" rel=\"nofollow noreferrer\">this</a> is the plugin."}, {"owner": {"reputation": 29444, "user_id": 3072788, "user_type": "registered", "accept_rate": 82, "profile_image": "https://www.gravatar.com/avatar/220a45c2fcff7e7358d144551b116205?s=128&d=identicon&r=PG&f=1", "display_name": "Alec", "link": "https://stackoverflow.com/users/3072788/alec"}, "reply_to_user": {"reputation": 100892, "user_id": 745903, "user_type": "registered", "accept_rate": 74, "profile_image": "https://www.gravatar.com/avatar/50933f6638836741e620669b3940410e?s=128&d=identicon&r=PG", "display_name": "leftaroundabout", "link": "https://stackoverflow.com/users/745903/leftaroundabout"}, "edited": false, "score": 1, "creation_date": 1433320208, "post_id": 30613542, "comment_id": 49296058, "body": "@leftaroundabout I&#39;m currently at 7.10, if that helps. I&#39;ve gotten some simple arithmetic with <code>Nat</code>s working before, except for this peculiar case."}], "answers": [{"comments": [{"owner": {"reputation": 29444, "user_id": 3072788, "user_type": "registered", "accept_rate": 82, "profile_image": "https://www.gravatar.com/avatar/220a45c2fcff7e7358d144551b116205?s=128&d=identicon&r=PG&f=1", "display_name": "Alec", "link": "https://stackoverflow.com/users/3072788/alec"}, "edited": false, "score": 0, "creation_date": 1433371917, "post_id": 30632098, "comment_id": 49329901, "body": "I don&#39;t know anything about <code>FlexibleContexts</code>, but I&#39;ll look it up, then come back and accept this answer. I hope to fully appreciate your last line joke by then. :-)"}, {"owner": {"reputation": 126897, "user_id": 791604, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/ce991df7a056248d5e4f6fc3659ba733?s=128&d=identicon&r=PG", "display_name": "Daniel Wagner", "link": "https://stackoverflow.com/users/791604/daniel-wagner"}, "reply_to_user": {"reputation": 29444, "user_id": 3072788, "user_type": "registered", "accept_rate": 82, "profile_image": "https://www.gravatar.com/avatar/220a45c2fcff7e7358d144551b116205?s=128&d=identicon&r=PG&f=1", "display_name": "Alec", "link": "https://stackoverflow.com/users/3072788/alec"}, "edited": false, "score": 1, "creation_date": 1433372266, "post_id": 30632098, "comment_id": 49330042, "body": "@Alec Oh, the last line has nothing to do with flexible contexts. It&#39;s just an acknowledgement that type-level programming is a notorious time sink."}, {"owner": {"reputation": 29444, "user_id": 3072788, "user_type": "registered", "accept_rate": 82, "profile_image": "https://www.gravatar.com/avatar/220a45c2fcff7e7358d144551b116205?s=128&d=identicon&r=PG&f=1", "display_name": "Alec", "link": "https://stackoverflow.com/users/3072788/alec"}, "edited": false, "score": 0, "creation_date": 1433372866, "post_id": 30632098, "comment_id": 49330252, "body": "Haha, yeah, I got that, just wanted to see how little <code>FlexibleContexts</code> would give me, but yeah. Thanks a lot for this solution! I have no clue how you came up with this."}, {"owner": {"reputation": 126897, "user_id": 791604, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/ce991df7a056248d5e4f6fc3659ba733?s=128&d=identicon&r=PG", "display_name": "Daniel Wagner", "link": "https://stackoverflow.com/users/791604/daniel-wagner"}, "reply_to_user": {"reputation": 29444, "user_id": 3072788, "user_type": "registered", "accept_rate": 82, "profile_image": "https://www.gravatar.com/avatar/220a45c2fcff7e7358d144551b116205?s=128&d=identicon&r=PG&f=1", "display_name": "Alec", "link": "https://stackoverflow.com/users/3072788/alec"}, "edited": false, "score": 1, "creation_date": 1433376669, "post_id": 30632098, "comment_id": 49331344, "body": "@Alec &quot;How I came up with it&quot; is actually pretty simple: I just followed the errors. The error says it can&#39;t prove a constraint, so I gave it the constraint as an axiom; the next error said that constraint was invalid unless you turn on <code>FlexibleContexts</code>, so I turned that on. GHC did all the hard work, really."}], "tags": [], "owner": {"reputation": 126897, "user_id": 791604, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/ce991df7a056248d5e4f6fc3659ba733?s=128&d=identicon&r=PG", "display_name": "Daniel Wagner", "link": "https://stackoverflow.com/users/791604/daniel-wagner"}, "is_accepted": true, "score": 2, "last_activity_date": 1433371324, "creation_date": 1433371324, "answer_id": 30632098, "question_id": 30613542, "link": "https://stackoverflow.com/questions/30613542/getting-the-ghc-to-accept-type-signature-with-knownnat-arithmetic/30632098#30632098", "title": "Getting the GHC to accept type signature with KnownNat arithmetic", "body": "<p>The cheap, cheesy way to make this compile is to add <code>FlexibleContexts</code>, then add <code>KnownNat (k1 * k2)</code> to the context of <code>crt</code>. Once I did this, I could successfully call it in ghci:</p>\n\n<pre><code>&gt; crt (3 :: Mod Integer 5) (5 :: Mod Integer 7)\n33\n</code></pre>\n\n<p>Have fun working out how to express <code>Coprime k1 k2</code> as a constraint... ;-)</p>\n"}], "owner": {"reputation": 29444, "user_id": 3072788, "user_type": "registered", "accept_rate": 82, "profile_image": "https://www.gravatar.com/avatar/220a45c2fcff7e7358d144551b116205?s=128&d=identicon&r=PG&f=1", "display_name": "Alec", "link": "https://stackoverflow.com/users/3072788/alec"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 214, "favorite_count": 0, "accepted_answer_id": 30632098, "answer_count": 1, "score": 3, "last_activity_date": 1433371324, "creation_date": 1433316576, "question_id": 30613542, "link": "https://stackoverflow.com/questions/30613542/getting-the-ghc-to-accept-type-signature-with-knownnat-arithmetic", "title": "Getting the GHC to accept type signature with KnownNat arithmetic", "body": "<p>I have been trying to implement the <a href=\"http://en.wikipedia.org/wiki/Chinese_remainder_theorem#Case_of_two_equations_.28k_.3D_2.29\" rel=\"nofollow\">Chinese Remainder Theorem</a>, for the specific case of just two equations, using the <a href=\"https://hackage.haskell.org/package/modular-arithmetic-1.1.0.0/docs/Data-Modular.html\" rel=\"nofollow\">Data.Modular</a> package. The idea is that I can specify each equation with only one modular number (<code>x = a (mod m)</code> using the number <code>a (mod m)</code>). Here is my implementation.</p>\n\n<pre><code>{-# LANGUAGE DataKinds, ScopedTypeVariables, TypeOperators #-}\n\nimport GHC.TypeLits\nimport Data.Proxy (Proxy (..))\nimport Data.Modular\n\ncrt :: forall k1 k2 i. (KnownNat k1, KnownNat k2, Integral i) =&gt; i `Mod` k1 -&gt; i `Mod` k2 -&gt; i `Mod` (k1 * k2)\ncrt a1 a2 = toMod $ (unMod a1)*n2*(unMod n2') + (unMod a2)*n1*(unMod n1')\n  where n1 = getModulus a1 :: i\n        n2 = getModulus a2 :: i\n        n2' = inv $ (toMod n2 :: i `Mod` k1)\n        n1' = inv $ (toMod n1 :: i `Mod` k2)\n\n        getModulus :: forall n i j. (Integral i, Integral j, KnownNat n) =&gt; i `Mod` n -&gt; j\n        getModulus x = fromInteger $ natVal (Proxy :: Proxy n)\n</code></pre>\n\n<p>I get the following error: <code>Could not deduce (KnownNat (k1 * k2)) arising from a use of \u2018toMod\u2019</code>. However, shouldn't GHC be able to do the arithmetic for <code>KnownNat (k1 * k2)</code>? Also, for some weird reason, it looks like if I had a constructor for the <code>Mod</code> type instead of the <code>toMod</code> function, everything would work. I fail to see how that should make a difference either...</p>\n\n<p>I am looking for any fix to help this compile, including whatever extensions. I would, however, like to not have to make my own version of Data.Modular if possible. (I think I could make this work inelegantly and clumsily by using the <code>Mod</code> constructor directly).</p>\n"}, {"tags": ["haskell", "hspec"], "comments": [{"owner": {"reputation": 48129, "user_id": 76051, "user_type": "registered", "accept_rate": 91, "profile_image": "https://i.stack.imgur.com/AGDxz.jpg?s=128&g=1", "display_name": "Carsten", "link": "https://stackoverflow.com/users/76051/carsten"}, "edited": false, "score": 1, "creation_date": 1433314013, "post_id": 30612654, "comment_id": 49292172, "body": "try <code>safeHead ([] :: [Int]) </code>shouldBe` Nothing`"}, {"owner": {"reputation": 4571, "user_id": 186429, "user_type": "registered", "accept_rate": 62, "profile_image": "https://www.gravatar.com/avatar/861636564e64678e849fe27ffbd2a61f?s=128&d=identicon&r=PG", "display_name": "Galder Zamarre&#241;o", "link": "https://stackoverflow.com/users/186429/galder-zamarre%c3%b1o"}, "reply_to_user": {"reputation": 48129, "user_id": 76051, "user_type": "registered", "accept_rate": 91, "profile_image": "https://i.stack.imgur.com/AGDxz.jpg?s=128&g=1", "display_name": "Carsten", "link": "https://stackoverflow.com/users/76051/carsten"}, "edited": false, "score": 0, "creation_date": 1433325845, "post_id": 30612654, "comment_id": 49300022, "body": "That worked! What&#39;s the reason behind it? You are coercing the parameter to have a type? Like a cast?"}, {"owner": {"reputation": 48129, "user_id": 76051, "user_type": "registered", "accept_rate": 91, "profile_image": "https://i.stack.imgur.com/AGDxz.jpg?s=128&g=1", "display_name": "Carsten", "link": "https://stackoverflow.com/users/76051/carsten"}, "edited": false, "score": 0, "creation_date": 1433328463, "post_id": 30612654, "comment_id": 49301864, "body": "@Zeta gave an really good answer to that"}], "answers": [{"comments": [{"owner": {"reputation": 4571, "user_id": 186429, "user_type": "registered", "accept_rate": 62, "profile_image": "https://www.gravatar.com/avatar/861636564e64678e849fe27ffbd2a61f?s=128&d=identicon&r=PG", "display_name": "Galder Zamarre&#241;o", "link": "https://stackoverflow.com/users/186429/galder-zamarre%c3%b1o"}, "edited": false, "score": 0, "creation_date": 1433332613, "post_id": 30617137, "comment_id": 49304768, "body": "Thanks for the detailed explanation :)"}], "tags": [], "owner": {"reputation": 94713, "user_id": 1139697, "user_type": "registered", "accept_rate": 86, "profile_image": "https://www.gravatar.com/avatar/5f136ddb684f39aaee1c028ee1950f6f?s=128&d=identicon&r=PG", "display_name": "Zeta", "link": "https://stackoverflow.com/users/1139697/zeta"}, "is_accepted": true, "score": 7, "last_activity_date": 1433326331, "creation_date": 1433326331, "answer_id": 30617137, "question_id": 30612654, "link": "https://stackoverflow.com/questions/30612654/hspec-nothing-expectation-failing-to-compile/30617137#30617137", "title": "HSpec Nothing expectation failing to compile", "body": "<blockquote>\n  <p>So, it's something about Nothing itself, that it cannot be compared by equals?</p>\n</blockquote>\n\n<p>What's <code>Nothing</code>'s type? It's <code>Nothing :: Maybe a</code>. And GHC doesn't like <code>a</code> in this context: \"The type variable \u2018a0\u2019 is ambiguous\". After all, <code>shouldBe</code> takes anything that can be compared with <code>(==)</code> and shown. And <code>Maybe a</code> is an instance of <code>Eq</code> if <code>a</code> is an instance of <code>Eq</code>. GHC can't possibly know <em>which</em> <code>a</code> you want to use, so you need to specify it by hand:</p>\n\n<pre><code>  describe \"safeHead\" $\n    it \"should return Nothing for empty list\" $\n      safeHead [] `shouldBe` (Nothing :: Maybe Int)\n</code></pre>\n\n<p>That's not coercion, you're just making clear <em>which</em> of all possible types you want to use. Other examples:</p>\n\n<pre><code>  describe \"safeHead\" $\n    it \"should return Nothing for empty list\" $ do\n      safeHead [] `shouldBe` (Nothing :: Maybe Int)\n      safeHead [] `shouldBe` (Nothing :: Maybe ())\n      safeHead [] `shouldBe` (Nothing :: Maybe Integer)\n      safeHead [] `shouldBe` (Nothing :: Maybe Char)\n</code></pre>\n"}], "owner": {"reputation": 4571, "user_id": 186429, "user_type": "registered", "accept_rate": 62, "profile_image": "https://www.gravatar.com/avatar/861636564e64678e849fe27ffbd2a61f?s=128&d=identicon&r=PG", "display_name": "Galder Zamarre&#241;o", "link": "https://stackoverflow.com/users/186429/galder-zamarre%c3%b1o"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 423, "favorite_count": 3, "accepted_answer_id": 30617137, "answer_count": 1, "score": 3, "last_activity_date": 1433326331, "creation_date": 1433313711, "question_id": 30612654, "link": "https://stackoverflow.com/questions/30612654/hspec-nothing-expectation-failing-to-compile", "title": "HSpec Nothing expectation failing to compile", "body": "<p>I'm learning Haskell and I've written this function:</p>\n\n<pre><code>safeHead :: [a] -&gt; Maybe a\nsafeHead [] = Nothing\nsafeHead (x:xs) = Just x\n</code></pre>\n\n<p>I'm now trying to test it with HSpec:</p>\n\n<pre><code>import Test.Hspec\n\nmain :: IO ()\nmain = hspec spec\n\nspec :: Spec\nspec =\n\n  describe \"safeHead\" $\n    it \"should return Nothing for empty list\" $\n      safeHead [] `shouldBe` Nothing\n</code></pre>\n\n<p>But that fails to compile:</p>\n\n<pre><code>Error:(14, 19) ghc: No instance for (Eq a0) arising from a use of \u2018shouldBe\u2019\n    The type variable \u2018a0\u2019 is ambiguous\n    Note: there are several potential instances:\n      instance Eq a =&gt; Eq (Maybe a) -- Defined in \u2018GHC.Base\u2019\n      instance Eq a =&gt; Eq (GHC.Real.Ratio a) -- Defined in \u2018GHC.Real\u2019\n      instance Eq Ordering -- Defined in \u2018ghc-prim-0.4.0.0:GHC.Classes\u2019\n      ...plus 31 others\n    In the second argument of \u2018($)\u2019, namely\n      \u2018safeHead [] `shouldBe` Nothing\u2019\n    In the second argument of \u2018($)\u2019, namely\n      \u2018it \"should return Nothing for empty list\"\n       $ safeHead [] `shouldBe` Nothing\u2019\n    In the expression:\n      describe \"safeHead\"\n      $ it \"should return Nothing for empty list\"\n        $ safeHead [] `shouldBe` Nothing\n</code></pre>\n\n<p>I have also tried this:</p>\n\n<pre><code>safeHead :: (Eq a) =&gt; [a] -&gt; Maybe a\nsafeHead [] = Nothing\nsafeHead (x:xs) = Just x\n</code></pre>\n\n<p>But that still fails with:</p>\n\n<pre><code>Error:(14, 19) ghc: No instance for (Eq a0) arising from a use of \u2018shouldBe\u2019\n    The type variable \u2018a0\u2019 is ambiguous\n    Note: there are several potential instances:\n      instance (Eq a, Eq b) =&gt; Eq (Either a b)\n        -- Defined in \u2018Data.Either\u2019\n      instance Eq Data.Monoid.All -- Defined in \u2018Data.Monoid\u2019\n      instance forall (k :: BOX) (f :: k -&gt; *) (a :: k).\n               Eq (f a) =&gt;\n               Eq (Data.Monoid.Alt f a)\n        -- Defined in \u2018Data.Monoid\u2019\n      ...plus 43 others\n    In the second argument of \u2018($)\u2019, namely\n      \u2018safeHead [] `shouldBe` Nothing\u2019\n    In the second argument of \u2018($)\u2019, namely\n      \u2018it \"should return Nothing for empty list\"\n       $ safeHead [] `shouldBe` Nothing\u2019\n    In the expression:\n      describe \"safeHead\"\n      $ it \"should return Nothing for empty list\"\n        $ safeHead [] `shouldBe` Nothing\n</code></pre>\n\n<p>I don't know what's the problem here. If I try other tests like these, it compiles fine:</p>\n\n<pre><code>    it \"should return the head\" $ do\n      safeHead [1] `shouldBe` Just 1\n      safeHead [2,3,4,5,6,1] `shouldBe` Just 2\n</code></pre>\n\n<p>So, it's something about <code>Nothing</code> itself, that it cannot be compared by equals? How do you assert that something returns <code>Nothing</code> then? Or is my function too generic?</p>\n\n<p>SIDE NOTE:\nI've seen a similar error with this function:</p>\n\n<pre><code>palindrome :: (Eq a) =&gt; [a] -&gt; [a]\npalindrome xs = xs ++ reverse xs\n</code></pre>\n\n<p>When trying to test for empty lists:</p>\n\n<pre><code>palindrome [] `shouldBe` []\n</code></pre>\n\n<p>Which fails with:</p>\n\n<pre><code>Error:(26, 21) ghc: No instance for (Eq a0) arising from a use of \u2018shouldBe\u2019\n    The type variable \u2018a0\u2019 is ambiguous\n    Note: there are several potential instances:\n      instance Eq a =&gt; Eq (Maybe a) -- Defined in \u2018GHC.Base\u2019\n      instance Eq a =&gt; Eq (GHC.Real.Ratio a) -- Defined in \u2018GHC.Real\u2019\n      instance Eq Ordering -- Defined in \u2018ghc-prim-0.4.0.0:GHC.Classes\u2019\n      ...plus 32 others\n    In a stmt of a 'do' block: palindrome [] `shouldBe` []\n    In the second argument of \u2018($)\u2019, namely\n      \u2018do { palindrome [] `shouldBe` [] }\u2019\n    In the second argument of \u2018($)\u2019, namely\n      \u2018it\n         \"should turn a list into a palindrome, so it reads same both forwards and backwards\"\n       $ do { palindrome [] `shouldBe` [] }\u2019\n</code></pre>\n"}, {"tags": ["haskell", "ide", "leksah"], "comments": [{"owner": {"reputation": 44013, "user_id": 1477667, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/trgKM.jpg?s=128&g=1", "display_name": "dfeuer", "link": "https://stackoverflow.com/users/1477667/dfeuer"}, "edited": false, "score": 2, "creation_date": 1433309089, "post_id": 30611319, "comment_id": 49289735, "body": "There are a lot more Haskell functions that operate on lists than there are methods of any sane Java class, so I&#39;m not sure that is going to be so useful. However, Hoogle, and I think Hayoo,  let you search by type. And I believe they&#39;re both installable locally."}, {"owner": {"reputation": 18456, "user_id": 1198559, "user_type": "registered", "accept_rate": 70, "profile_image": "https://i.stack.imgur.com/bOjLe.png?s=128&g=1", "display_name": "jhegedus", "link": "https://stackoverflow.com/users/1198559/jhegedus"}, "reply_to_user": {"reputation": 44013, "user_id": 1477667, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/trgKM.jpg?s=128&g=1", "display_name": "dfeuer", "link": "https://stackoverflow.com/users/1477667/dfeuer"}, "edited": false, "score": 0, "creation_date": 1433311986, "post_id": 30611319, "comment_id": 49291030, "body": "Thanks, I have a look."}], "owner": {"reputation": 18456, "user_id": 1198559, "user_type": "registered", "accept_rate": 70, "profile_image": "https://i.stack.imgur.com/bOjLe.png?s=128&g=1", "display_name": "jhegedus", "link": "https://stackoverflow.com/users/1198559/jhegedus"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 37, "favorite_count": 0, "answer_count": 0, "score": 1, "last_activity_date": 1433308375, "creation_date": 1433308375, "question_id": 30611319, "link": "https://stackoverflow.com/questions/30611319/leksah-haskell-search-for-functions-that-operate-on-a-given-type-say-a", "title": "Leksah / Haskell : search for functions that operate on a given type (say [a], [Char])", "body": "<p>Is there an easy way to search for functions that operate on a given type , say on <code>[a]</code> ? In Leksah Haskell IDE or with some other method ? </p>\n\n<p>If I want to figure out all the things that can be done to <code>[a]</code> or say <code>[Char]</code>, what should I do ? </p>\n\n<p>Akin to typing <code>\"hello\".</code>+autocomplete in a Java/Scala IDE ? </p>\n\n<p>So that all the possible operations show up that can be done to that class (i.e. class member functions) ?</p>\n"}, {"tags": ["haskell", "benchmarking", "http-conduit", "scotty"], "comments": [{"owner": {"reputation": 13626, "user_id": 492865, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/5c69a2080e68c8606961a18aba3a08ec?s=128&d=identicon&r=PG", "display_name": "Yuras", "link": "https://stackoverflow.com/users/492865/yuras"}, "edited": false, "score": 0, "creation_date": 1433323470, "post_id": 30611005, "comment_id": 49298322, "body": "What if you reuse <code>Manager</code> instead of creating it each time? E.g. pass <code>Manager</code> instead of <code>IO Manager</code> to <code>testGet</code>. Also <code>http-client</code> relies on <code>GC</code> to reuse connections, that may (or may not) explain file descriptor exhaustion."}, {"owner": {"reputation": 721, "user_id": 2512324, "user_type": "registered", "accept_rate": 76, "profile_image": "https://www.gravatar.com/avatar/f9d51819edf28a5befe8b255e51d95d7?s=128&d=identicon&r=PG", "display_name": "user2512324", "link": "https://stackoverflow.com/users/2512324/user2512324"}, "reply_to_user": {"reputation": 13626, "user_id": 492865, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/5c69a2080e68c8606961a18aba3a08ec?s=128&d=identicon&r=PG", "display_name": "Yuras", "link": "https://stackoverflow.com/users/492865/yuras"}, "edited": false, "score": 0, "creation_date": 1433323816, "post_id": 30611005, "comment_id": 49298570, "body": "I removed the IO wrapper around the manager and tested it again. Doesn&#39;t make any difference. There is an underlying issue which I&#39;m not being able to debug."}, {"owner": {"reputation": 9601, "user_id": 1937197, "user_type": "registered", "accept_rate": 80, "profile_image": "https://i.stack.imgur.com/cg7w6.jpg?s=128&g=1", "display_name": "bobcat", "link": "https://stackoverflow.com/users/1937197/bobcat"}, "edited": false, "score": 0, "creation_date": 1433501413, "post_id": 30611005, "comment_id": 49391147, "body": "Maybe try running your servers from <code>strace</code>?"}, {"owner": {"reputation": 2647, "user_id": 2141650, "user_type": "registered", "accept_rate": 60, "profile_image": "https://www.gravatar.com/avatar/68388df031850463b7bbb5a9e6034abe?s=128&d=identicon&r=PG", "display_name": "user2141650", "link": "https://stackoverflow.com/users/2141650/user2141650"}, "edited": false, "score": 0, "creation_date": 1433878693, "post_id": 30611005, "comment_id": 49538378, "body": "Isn&#39;t 30 threads in <code>wrk</code> way too much? Maybe that&#39;s suffocating the servers?"}, {"owner": {"reputation": 721, "user_id": 2512324, "user_type": "registered", "accept_rate": 76, "profile_image": "https://www.gravatar.com/avatar/f9d51819edf28a5befe8b255e51d95d7?s=128&d=identicon&r=PG", "display_name": "user2512324", "link": "https://stackoverflow.com/users/2512324/user2512324"}, "reply_to_user": {"reputation": 2647, "user_id": 2141650, "user_type": "registered", "accept_rate": 60, "profile_image": "https://www.gravatar.com/avatar/68388df031850463b7bbb5a9e6034abe?s=128&d=identicon&r=PG", "display_name": "user2141650", "link": "https://stackoverflow.com/users/2141650/user2141650"}, "edited": false, "score": 0, "creation_date": 1433914505, "post_id": 30611005, "comment_id": 49550288, "body": "@user2141650 I have found out the issue. Its the same as what @Yuras Jun told. I&#39;ll soon update this post. Changing the signature of the first variable in <code>testGet</code> from <code>IO Manager</code> to <code>Manager</code> solved the entire issue."}, {"owner": {"reputation": 44013, "user_id": 1477667, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/trgKM.jpg?s=128&g=1", "display_name": "dfeuer", "link": "https://stackoverflow.com/users/1477667/dfeuer"}, "edited": false, "score": 1, "creation_date": 1441897280, "post_id": 30611005, "comment_id": 52870020, "body": "Could you add your fix as an answer?"}, {"owner": {"reputation": 8993, "user_id": 1354537, "user_type": "registered", "accept_rate": 83, "profile_image": "https://www.gravatar.com/avatar/24aaaba3c6140eaef24f9ed711644033?s=128&d=identicon&r=PG", "display_name": "Marged", "link": "https://stackoverflow.com/users/1354537/marged"}, "edited": false, "score": 0, "creation_date": 1444861606, "post_id": 30611005, "comment_id": 54084854, "body": "@user2512324 I just hit this unanswered question. Could you please add your fix as an answer like suggested ?"}, {"owner": {"reputation": 721, "user_id": 2512324, "user_type": "registered", "accept_rate": 76, "profile_image": "https://www.gravatar.com/avatar/f9d51819edf28a5befe8b255e51d95d7?s=128&d=identicon&r=PG", "display_name": "user2512324", "link": "https://stackoverflow.com/users/2512324/user2512324"}, "reply_to_user": {"reputation": 8993, "user_id": 1354537, "user_type": "registered", "accept_rate": 83, "profile_image": "https://www.gravatar.com/avatar/24aaaba3c6140eaef24f9ed711644033?s=128&d=identicon&r=PG", "display_name": "Marged", "link": "https://stackoverflow.com/users/1354537/marged"}, "edited": false, "score": 0, "creation_date": 1445544807, "post_id": 30611005, "comment_id": 54379792, "body": "@Marged I have added an answer. If possible, please provide a reason as to why this happened."}, {"owner": {"reputation": 8993, "user_id": 1354537, "user_type": "registered", "accept_rate": 83, "profile_image": "https://www.gravatar.com/avatar/24aaaba3c6140eaef24f9ed711644033?s=128&d=identicon&r=PG", "display_name": "Marged", "link": "https://stackoverflow.com/users/1354537/marged"}, "edited": false, "score": 1, "creation_date": 1445545044, "post_id": 30611005, "comment_id": 54379943, "body": "@user2512324 Perhaps this was a memory leak, but I can&#39;t tell you the exact reason. But thanks for providing the answer, you should be able to accept it"}], "answers": [{"tags": [], "owner": {"reputation": 721, "user_id": 2512324, "user_type": "registered", "accept_rate": 76, "profile_image": "https://www.gravatar.com/avatar/f9d51819edf28a5befe8b255e51d95d7?s=128&d=identicon&r=PG", "display_name": "user2512324", "link": "https://stackoverflow.com/users/2512324/user2512324"}, "is_accepted": true, "score": 1, "last_activity_date": 1445544719, "creation_date": 1445544719, "answer_id": 33289819, "question_id": 30611005, "link": "https://stackoverflow.com/questions/30611005/unexpectedly-low-throughput-for-network-i-o-using-scotty/33289819#33289819", "title": "Unexpectedly low throughput for Network I/O using Scotty", "body": "<p>@Yuras's analogy was correct. On running the server again, all the issues related to non 2xx status code were gone.</p>\n\n<p>The first line in the main block was the culprit.\nI changed the line from</p>\n\n<pre><code>main = do \n  let man = newManager defaultManagerSettings\n</code></pre>\n\n<p>to</p>\n\n<pre><code>main = do \n  man &lt;- newManager defaultManagerSettings\n</code></pre>\n\n<p>and voila, there weren't any issues. Also the high memory usage of the program stabilized to 21MB from 1GB earlier. </p>\n\n<p>I don't know the reason though. It would be nice to have an explanation for this.</p>\n"}], "owner": {"reputation": 721, "user_id": 2512324, "user_type": "registered", "accept_rate": 76, "profile_image": "https://www.gravatar.com/avatar/f9d51819edf28a5befe8b255e51d95d7?s=128&d=identicon&r=PG", "display_name": "user2512324", "link": "https://stackoverflow.com/users/2512324/user2512324"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 354, "favorite_count": 1, "accepted_answer_id": 33289819, "answer_count": 1, "score": 15, "last_activity_date": 1445544719, "creation_date": 1433306571, "last_edit_date": 1441881887, "question_id": 30611005, "link": "https://stackoverflow.com/questions/30611005/unexpectedly-low-throughput-for-network-i-o-using-scotty", "title": "Unexpectedly low throughput for Network I/O using Scotty", "body": "<p>I tried to benchmark Scotty to test the Network I/O efficiency and overall throughput.</p>\n\n<p>For this I set up two local servers written in Haskell. One which doesn't do anything and just acts as an API.</p>\n\n<p>Code for the same is</p>\n\n<pre><code>{-# LANGUAGE OverloadedStrings #-}\n\n\nimport Web.Scotty\n\nimport Network.Wai.Middleware.RequestLogger \n\nimport Control.Monad\nimport Data.Text\nimport Control.Monad.Trans\nimport Data.ByteString\nimport Network.HTTP.Types (status302)\nimport Data.Time.Clock\nimport Data.Text.Lazy.Encoding (decodeUtf8)\nimport Control.Concurrent\nimport Network.HTTP.Conduit\nimport Network.Connection (TLSSettings (..))\nimport Network.HTTP.Client\nimport Network\nmain = do \n  scotty 4001 $ do\n    middleware logStdoutDev\n    get \"/dummy_api\" $ do\n        text $ \"dummy response\"\n</code></pre>\n\n<p>I wrote another server which calls this server and returns the response.</p>\n\n<pre><code>{-# LANGUAGE OverloadedStrings #-}\n\n\nimport Web.Scotty\n\nimport Network.Wai.Middleware.RequestLogger \n\nimport Control.Monad\nimport Control.Monad.Trans\nimport qualified Data.Text.Internal.Lazy as LT\nimport Data.ByteString\nimport Network.HTTP.Types (status302)\nimport Data.Time.Clock\nimport Data.Text.Lazy.Encoding (decodeUtf8)\nimport Control.Concurrent\nimport qualified Data.ByteString.Lazy as LB\nimport Network.HTTP.Conduit\nimport Network.Connection (TLSSettings (..))\nimport Network.HTTP.Client\nimport Network\n\n\nmain = do \n  let man = newManager defaultManagerSettings \n  scotty 3000 $ do\n    middleware logStdoutDev\n\n    get \"/filters\" $ do\n        response &lt;- liftIO $! (testGet man)\n        json $ decodeUtf8 (LB.fromChunks response)\n\ntestGet :: IO Manager -&gt; IO [B.ByteString]\ntestGet manager = do\n    request &lt;- parseUrl \"http://localhost:4001/dummy_api\"\n    man &lt;- manager\n    let req = request { method = \"GET\", responseTimeout = Nothing, redirectCount = 0}\n    a &lt;- withResponse req man $ brConsume . responseBody\n    return $! a\n</code></pre>\n\n<p>With both these servers running, I performed <a href=\"https://github.com/wg/wrk\">wrk</a> benchmarking and got extremely high throughput.</p>\n\n<pre><code>wrk -t30 -c100 -d60s \"http://localhost:3000/filters\"\nRunning 1m test @ http://localhost:3000/filters\n  30 threads and 100 connections\n  Thread Stats   Avg      Stdev     Max   +/- Stdev\n    Latency    30.86ms   78.40ms   1.14s    95.63%\n    Req/Sec   174.05     62.29     1.18k    76.20%\n  287047 requests in 1.00m, 91.61MB read\n  Socket errors: connect 0, read 0, write 0, timeout 118\n  Non-2xx or 3xx responses: 284752\nRequests/sec:   4776.57\nTransfer/sec:      1.52MB\n</code></pre>\n\n<p>While this was significantly higher than other web servers like Phoenix, I realized this meant nothing as majority of responses were 500 errors occuring due to file descriptor exhaustion.</p>\n\n<p>I check the limits which were pretty low.</p>\n\n<pre><code>ulimit -n\n256\n</code></pre>\n\n<p>I increased these limits to</p>\n\n<pre><code>ulimit -n 10240\n</code></pre>\n\n<p>I ran wrk again and this time clearly enough throughput had been reduced drastically.</p>\n\n<pre><code>wrk -t30 -c100 -d60s \"http://localhost:3000/filters\"\nRunning 1m test @ http://localhost:3000/filters\n  30 threads and 100 connections\n  Thread Stats   Avg      Stdev     Max   +/- Stdev\n    Latency   105.69ms  161.72ms   1.24s    96.27%\n    Req/Sec    19.88     16.62   120.00     58.12%\n  8207 requests in 1.00m, 1.42MB read\n  Socket errors: connect 0, read 0, write 0, timeout 1961\n  Non-2xx or 3xx responses: 1521\nRequests/sec:    136.60\nTransfer/sec:     24.24KB\n</code></pre>\n\n<p>Although the amount of 500 errors had reduced, they were not eliminated. I benchmarked <a href=\"https://gin-gonic.github.io\">Gin</a> and Phoenix and they were way better than <code>Scotty</code> while not giving any 500 responses.</p>\n\n<p>What piece of puzzle I am missing? I suspect there is an issue I'm failing to debug.</p>\n\n<p>I understand that <a href=\"https://hackage.haskell.org/package/http-conduit\">http-conduit</a> has a lot to do with these errors and <code>http-client</code> library uses it under the hood and this has nothing to do with <code>Scotty</code>. </p>\n"}, {"tags": ["haskell", "typeclass"], "comments": [{"owner": {"reputation": 24028, "user_id": 383200, "user_type": "registered", "accept_rate": 60, "profile_image": "https://www.gravatar.com/avatar/a9dc722f936cb1059adaae4fe39c07f0?s=128&d=identicon&r=PG", "display_name": "Carl", "link": "https://stackoverflow.com/users/383200/carl"}, "edited": false, "score": 0, "creation_date": 1433297618, "post_id": 30609194, "comment_id": 49286653, "body": "Why do you have a class for this at all? This isn&#39;t the sort of problem classes are good for in Haskell."}, {"owner": {"user_type": "does_not_exist", "display_name": "user3594595"}, "reply_to_user": {"reputation": 24028, "user_id": 383200, "user_type": "registered", "accept_rate": 60, "profile_image": "https://www.gravatar.com/avatar/a9dc722f936cb1059adaae4fe39c07f0?s=128&d=identicon&r=PG", "display_name": "Carl", "link": "https://stackoverflow.com/users/383200/carl"}, "edited": false, "score": 0, "creation_date": 1433298019, "post_id": 30609194, "comment_id": 49286738, "body": "Do you have another suggestion?"}, {"owner": {"reputation": 24028, "user_id": 383200, "user_type": "registered", "accept_rate": 60, "profile_image": "https://www.gravatar.com/avatar/a9dc722f936cb1059adaae4fe39c07f0?s=128&d=identicon&r=PG", "display_name": "Carl", "link": "https://stackoverflow.com/users/383200/carl"}, "edited": false, "score": 2, "creation_date": 1433298822, "post_id": 30609194, "comment_id": 49286941, "body": "My first question would be: what do you get out of this? For an abstraction to make sense, you need to be able to productively write code that&#39;s agnostic to which implementation you&#39;re using. What productive code can you write that works across any implementation?"}], "answers": [{"comments": [{"owner": {"user_type": "does_not_exist", "display_name": "user3594595"}, "edited": false, "score": 0, "creation_date": 1433300879, "post_id": 30610132, "comment_id": 49287428, "body": "What would you use instead of a typeclass?"}, {"owner": {"reputation": 44013, "user_id": 1477667, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/trgKM.jpg?s=128&g=1", "display_name": "dfeuer", "link": "https://stackoverflow.com/users/1477667/dfeuer"}, "edited": false, "score": 0, "creation_date": 1433301105, "post_id": 30610132, "comment_id": 49287488, "body": "@broma0, as Carl said, the real question is &quot;What are you actually trying to do?&quot; Can you imagine some problems you might want to solve, and then explain how a common interface of the flavor you envision will help you share code between them? If so, you can edit your question with the gory details."}, {"owner": {"user_type": "does_not_exist", "display_name": "user3594595"}, "edited": false, "score": 0, "creation_date": 1433411550, "post_id": 30610132, "comment_id": 49345378, "body": "The problem I want to solve is having a db engine that works with both IO and pure backends. I figured that this would best be accomplished with a typeclass"}, {"owner": {"reputation": 44013, "user_id": 1477667, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/trgKM.jpg?s=128&g=1", "display_name": "dfeuer", "link": "https://stackoverflow.com/users/1477667/dfeuer"}, "edited": false, "score": 0, "creation_date": 1433411696, "post_id": 30610132, "comment_id": 49345479, "body": "@broma0, you still haven&#39;t explained why you want that. How would you use it? Can you write a toy program to explain?"}, {"owner": {"user_type": "does_not_exist", "display_name": "user3594595"}, "edited": false, "score": 0, "creation_date": 1433412998, "post_id": 30610132, "comment_id": 49346413, "body": "Imagine a key value db composed of many &quot;buckets&quot;, each of which act as a unique mapping of keys to values. It would be nice to be able to use a memory backend (pure, using state monad) for one bucket but an on disk (IO) backend for another. Since I&#39;d like my engine, the code that handles the storage and indexing for the db, to be as concise and polymorphic as possible, I need some way to abstract the &quot;backend&quot; for each bucket. If this explanation still isn&#39;t sufficient I will add some more code to my question."}, {"owner": {"reputation": 44013, "user_id": 1477667, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/trgKM.jpg?s=128&g=1", "display_name": "dfeuer", "link": "https://stackoverflow.com/users/1477667/dfeuer"}, "edited": false, "score": 0, "creation_date": 1433424367, "post_id": 30610132, "comment_id": 49354064, "body": "@broma0, it still is not. Please add to your question."}], "tags": [], "owner": {"reputation": 44013, "user_id": 1477667, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/trgKM.jpg?s=128&g=1", "display_name": "dfeuer", "link": "https://stackoverflow.com/users/1477667/dfeuer"}, "is_accepted": false, "score": 1, "last_activity_date": 1433301275, "last_edit_date": 1433301275, "creation_date": 1433300593, "answer_id": 30610132, "question_id": 30609194, "link": "https://stackoverflow.com/questions/30609194/generalizing-the-functions-of-a-key-value-database-for-both-on-disk-io-and-pur/30610132#30610132", "title": "Generalizing the functions of a key/value database for both on disk (IO) and pure cases?", "body": "<p>Like Carl, I have my doubts about the utility of this as well, but here goes nothing (note that I'm typing on my phone, so the syntax for the associated types may be completely wrong):</p>\n\n<pre><code>{-# LANGUAGE TypeFamilies #-}\n\nclass Queryable (d :: * -&gt; *) where\n  type Key\n  type M\n  fetch :: d v -&gt; Key -&gt; M v\n  insert :: d v -&gt; Key -&gt; v -&gt; M v\n  delete :: d v -&gt; Key -&gt; M ()\n</code></pre>\n\n<p>Now you can instantiate the class using any functor:</p>\n\n<pre><code>instance Queryable IOIntDict where\n  type Key IOIntDict = Int\n  type M = IO\n  ...\n</code></pre>\n\n<p>For pure stuff, you use <code>Data.Functor.Identity</code> as your functor, or maybe just use the identity type family (I'm not sure what approach would actually work out better).</p>\n"}], "owner": {"user_type": "does_not_exist", "display_name": "user3594595"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 88, "favorite_count": 1, "answer_count": 1, "score": 2, "last_activity_date": 1433301275, "creation_date": 1433293852, "question_id": 30609194, "link": "https://stackoverflow.com/questions/30609194/generalizing-the-functions-of-a-key-value-database-for-both-on-disk-io-and-pur", "title": "Generalizing the functions of a key/value database for both on disk (IO) and pure cases?", "body": "<p>The basic functions of a key value database are <em>store</em>, <em>fetch</em>, and <em>delete</em>. I'm attempting to write a typeclass that allows for the return types of these functions to be either pure or in <code>IO</code> so that I can write a single engine that works for both an in-memory <code>Data.Map</code> backed implementation and an on-disk implementation. </p>\n\n<p>The <em>pure</em> typeclass might look something like this: </p>\n\n<pre><code>class PureQueryable d where\n  fetch  :: d -&gt; Key -&gt; Maybe Value\n  insert :: d -&gt; Key -&gt; Value -&gt; d\n  delete :: d -&gt; Key -&gt; Maybe d\n</code></pre>\n\n<p>...whereas the <code>IO</code> typeclass might look something like this: </p>\n\n<pre><code>class IOQueryable d\n  fetch  :: d -&gt; Key -&gt; IO (Maybe Value)\n  insert :: d -&gt; Key -&gt; Value -&gt; IO d\n  delete :: d -&gt; Key -&gt; IO (Maybe d)\n</code></pre>\n\n<p>I'm attempting to combine these two, and as suggested by someone (Vektorweg1) on <code>#haskell</code> I wrote this:</p>\n\n<pre><code>class Queryable d r where\n  fetch  :: d -&gt; Key -&gt; ??? \n  insert :: d -&gt; Key -&gt; Value -&gt; ??? \n  delete :: d -&gt; Key -&gt; ??? \n</code></pre>\n\n<p>I am unsure of what to write in place of the <code>???</code> to get this to work. Any ideas?</p>\n"}, {"tags": ["excel", "email", "haskell"], "comments": [{"owner": {"reputation": 6364, "user_id": 288913, "user_type": "registered", "accept_rate": 91, "profile_image": "https://www.gravatar.com/avatar/902e8cc4ad1dab7e25d3a2dc1eac732f?s=128&d=identicon&r=PG", "display_name": "Sarah", "link": "https://stackoverflow.com/users/288913/sarah"}, "edited": false, "score": 0, "creation_date": 1433294581, "post_id": 30609142, "comment_id": 49285883, "body": "I think the way you&#39;re building mails (with addresses empty at first) is a bit quirky, but I guess it should not matter.  Have you tried to use the in-memory version of simplemail to rule out lazy IO issues?"}, {"owner": {"reputation": 222, "user_id": 3438721, "user_type": "registered", "accept_rate": 30, "profile_image": "https://i.stack.imgur.com/hc759.jpg?s=128&g=1", "display_name": "dacDave", "link": "https://stackoverflow.com/users/3438721/dacdave"}, "edited": false, "score": 0, "creation_date": 1433303713, "post_id": 30609142, "comment_id": 49288102, "body": "Just to be clear, the problem here occurs on one line of a 14 line file. If I put this line last in the file, 13 reports get generated and emailed without a problem. If I change the title of the report in this line, no error. Maybe I am stuck and not seeing it, but I can&#39;t imagine how changing the string that is the title of the report could crash the program.   I feel silly just asking the question because it seems to me the this problem could not exist. Yet, I have been fighting it now for three months and just today realized that the report title is causing the crash.  It can&#39;t be, but is."}], "answers": [{"comments": [{"owner": {"reputation": 44013, "user_id": 1477667, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/trgKM.jpg?s=128&g=1", "display_name": "dfeuer", "link": "https://stackoverflow.com/users/1477667/dfeuer"}, "edited": false, "score": 0, "creation_date": 1433654891, "post_id": 30690178, "comment_id": 49439711, "body": "That&#39;s weird! Something must have gone really wonky, or maybe a bug was fixed in a package that you upgraded."}], "tags": [], "owner": {"reputation": 222, "user_id": 3438721, "user_type": "registered", "accept_rate": 30, "profile_image": "https://i.stack.imgur.com/hc759.jpg?s=128&g=1", "display_name": "dacDave", "link": "https://stackoverflow.com/users/3438721/dacdave"}, "is_accepted": false, "score": 1, "last_activity_date": 1433652772, "creation_date": 1433652772, "answer_id": 30690178, "question_id": 30609142, "link": "https://stackoverflow.com/questions/30609142/using-simplemail-in-haskell-throws-broken-pipe-error/30690178#30690178", "title": "Using simplemail in Haskell throws broken pipe error", "body": "<p>Solved!</p>\n\n<p>Through a roundabout process, I found that simply rebuilding the application from its original source has fixed the problem. To accomplish the rebuild I had to reinstall a couple of the dependencies, but not one character of the original code was changed.</p>\n\n<p>The new executable does not have the problem reported here. Thanks to all for your suggestions.</p>\n"}], "owner": {"reputation": 222, "user_id": 3438721, "user_type": "registered", "accept_rate": 30, "profile_image": "https://i.stack.imgur.com/hc759.jpg?s=128&g=1", "display_name": "dacDave", "link": "https://stackoverflow.com/users/3438721/dacdave"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 66, "favorite_count": 1, "answer_count": 1, "score": 3, "last_activity_date": 1433652772, "creation_date": 1433293493, "last_edit_date": 1433305929, "question_id": 30609142, "link": "https://stackoverflow.com/questions/30609142/using-simplemail-in-haskell-throws-broken-pipe-error", "title": "Using simplemail in Haskell throws broken pipe error", "body": "<p>I have a Haskell program that I wrote over a year ago and has been running fine until a couple of months ago. </p>\n\n<p>What changed? The program builds a series of Excel report files using SpreadsheetML (of which I am a contributor) and emails them as attachments to a list of users. The program is controlled by a comma separated text file where each line represents a single report and contains the report title, a list of database keywords (separated by |), and a list of recipient email addresses (also separated by |).</p>\n\n<p>Three months ago this file was restructured to change what reports were generated and to whom they were distributed. Since then, one line in the file is killing the program with a broken pipe error. The error message from the program is:</p>\n\n<pre><code>CreateExcel: fd:7: hPutBuf: resource vanished (Broken pipe)\n</code></pre>\n\n<p>The program accepts a command line parameter to control whether or not to send the reports. If this parameter is False, the sendReport method (below) is never called and no error is reported. Therefore, I believe that everything before the call to sendReport is solid. Here is the code that produces the error:</p>\n\n<pre><code>makeAddress :: String -&gt; Address\nmakeAddress addr = Address Nothing (T.pack addr)\n\nsendReport :: String -&gt; [String] -&gt; String -&gt; IO ()\nsendReport file to title = do\n    simplemail &lt;- simpleMail (Address Nothing (T.pack \"\")) \n                       (Address Nothing (T.pack \"\")) \n                       (T.pack (\"CDC/Groth Training Report: \" ++ title)) \n                       (L.pack (\"The attachment contains your training report for\" ++ title ++ \".\"))\n                       (L.pack (\"The attachment contains your training report for &lt;u&gt;\" ++ title ++ \"&lt;/u&gt;.\"))\n                       [(T.pack \"application/xml\", file)]\n    let mail = simplemail { mailFrom = Address (Just (T.pack \"Order Fulfillment\")) (T.pack \"order_fulfillment@brindlewaye.com\"), \n                            mailTo   = map makeAddress to, \n                            mailCc   = [], \n                            mailBcc  = [Address (Just(T.pack \"Dave Smith\")) (T.pack \"dave@brindlewaye.pair.com\")] }\n\n    mailStream &lt;- renderMail' mail\n    sendmail mailStream\n</code></pre>\n\n<p>When the error is reported, the email does get sent, but without the Excel file attachment. Also, after reporting the error the program exits and none of the lines below it get processed.</p>\n\n<p>The line from the report driver file that causes the crash is:</p>\n\n<pre><code>Sales-Europe-Africa, Sales/Thijssen|Sales/Pecqueur|Sales/van den Bos|Sales/Zuyderduyn|Sales/Marksman, user1@example.com|user2@example.com\n</code></pre>\n\n<p>... which translates to a report title of \"Sales-Europe-Africa\" and a list of database keywords and email recipients. If I change the report title to \"TEST\" it works; however, there is another line in the same file where the report title is \"Sales-North-South-Americas\" and that report runs fine.</p>\n\n<p>Anybody see what I have missed?</p>\n"}, {"tags": ["multithreading", "haskell", "concurrency"], "answers": [{"tags": [], "owner": {"reputation": 23816, "user_id": 572606, "user_type": "registered", "accept_rate": 81, "profile_image": "https://www.gravatar.com/avatar/c20a126ad0dce40e8fc4a43456107919?s=128&d=identicon&r=PG", "display_name": "shang", "link": "https://stackoverflow.com/users/572606/shang"}, "is_accepted": true, "score": 7, "last_activity_date": 1433279369, "creation_date": 1433279369, "answer_id": 30606643, "question_id": 30606464, "link": "https://stackoverflow.com/questions/30606464/sharing-a-mvar-between-threads/30606643#30606643", "title": "Sharing a mvar between threads", "body": "<p>Your <code>putMVar</code> doesn't actually put a new value in the <code>MVar</code> but blocks indefinitely. MVars are like boxes that can hold only a single value. If you want to replace the value, you need to take out the old value first.</p>\n\n<p>If you don't need the blocking behavior of MVar, you should just use a regular <a href=\"http://hackage.haskell.org/package/base-4.8.0.0/docs/Data-IORef.html#t:IORef\"><code>IORef</code></a> or possibly a <a href=\"http://hackage.haskell.org/package/stm-2.4.4/docs/Control-Concurrent-STM-TVar.html\"><code>TVar</code></a> if you need to ensure that more complex operations run atomically.</p>\n"}, {"tags": [], "owner": {"reputation": 51584, "user_id": 839246, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/9b0573c2b936b12828dd1e4cc04206dc?s=128&d=identicon&r=PG&f=1", "display_name": "bheklilr", "link": "https://stackoverflow.com/users/839246/bheklilr"}, "is_accepted": false, "score": 3, "last_activity_date": 1433279524, "creation_date": 1433279524, "answer_id": 30606678, "question_id": 30606464, "link": "https://stackoverflow.com/questions/30606464/sharing-a-mvar-between-threads/30606678#30606678", "title": "Sharing a mvar between threads", "body": "<p>You should use <code>swapMVar</code> instead of <code>putMVar</code>.  As mentioned by @shang, <code>putMVar</code> blocks until the <code>MVar</code> is empty, so the <code>putMVar</code> never finishes:</p>\n\n<pre><code>waitForInput m = do\n    getLine\n    putStrLn \"stop\"\n    swapMVar m True\n</code></pre>\n\n<p>Alternatively, you could just use an empty <code>MVar ()</code> as a boolean flag:</p>\n\n<pre><code>waitForInput :: MVar () -&gt; IO ()\nwaitForInput m = do\n    getLine\n    putStrLn \"stop\"\n    putMVar m ()\n\noutputArrows :: MVar () -&gt; IO ()\noutputArrows m = do\n    running &lt;- isEmptyMVar m\n    when running $ do\n        threadDelay 1000000\n        putStr \"&gt;\"\n        outputArrows m\n\nmain :: IO ()\nmain = do\n    hSetBuffering stdout NoBuffering\n    m &lt;- newEmptyMVar\n    th1 &lt;- async (waitForInput m)\n    th2 &lt;- async (outputArrows m)\n    wait th1\n    wait th2\n</code></pre>\n"}], "owner": {"reputation": 573, "user_id": 1485641, "user_type": "registered", "accept_rate": 75, "profile_image": "https://i.stack.imgur.com/DZfVI.jpg?s=128&g=1", "display_name": "Bruno", "link": "https://stackoverflow.com/users/1485641/bruno"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 92, "favorite_count": 1, "accepted_answer_id": 30606643, "answer_count": 2, "score": 3, "last_activity_date": 1433279524, "creation_date": 1433278720, "question_id": 30606464, "link": "https://stackoverflow.com/questions/30606464/sharing-a-mvar-between-threads", "title": "Sharing a mvar between threads", "body": "<p>I'm trying to make a program that print arrows until the user press enter (see code bellow). </p>\n\n<p>The problem is that when I press enter, I see the \"stop\" string in the console, but it doesn't change the value of m in the outputArrows function.</p>\n\n<p>How can I share the state?</p>\n\n<pre><code>import Control.Concurrent\nimport Control.Concurrent.Async\nimport Control.Monad\n\nwaitForInput m = do\n    getLine\n    putStrLn \"stop\"\n    putMVar m True\n\noutputArrows m = do\n    stop &lt;- readMVar m\n    unless stop $ do\n        threadDelay 1000000\n        putStr \"&gt;\"\n        outputArrows m\n\nmain = do\n    m &lt;- newMVar False\n    th1 &lt;- async (waitForInput m)\n    th2 &lt;- async (outputArrows m)\n    wait th1\n    wait th2\n</code></pre>\n"}, {"tags": ["haskell", "ghci", "monad-transformers", "winghci"], "answers": [{"comments": [{"owner": {"reputation": 2695, "user_id": 1924798, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/1ba7bffbe41ca39353b6f8bbfd4624a8?s=128&d=identicon&r=PG", "display_name": "Marco Faustinelli", "link": "https://stackoverflow.com/users/1924798/marco-faustinelli"}, "edited": false, "score": 0, "creation_date": 1433327366, "post_id": 30605953, "comment_id": 49301136, "body": "Thank you. Perfect. Why in this case there is no indent at the &quot;deriving&quot; line? I&#39;d say it belongs to the newtype declaration. Isn&#39;t it so?"}, {"owner": {"reputation": 13807, "user_id": 2407038, "user_type": "registered", "accept_rate": 64, "profile_image": "https://www.gravatar.com/avatar/538f6f4a9aa43841841de7d8e8b169fc?s=128&d=identicon&r=PG&f=1", "display_name": "user2407038", "link": "https://stackoverflow.com/users/2407038/user2407038"}, "reply_to_user": {"reputation": 2695, "user_id": 1924798, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/1ba7bffbe41ca39353b6f8bbfd4624a8?s=128&d=identicon&r=PG", "display_name": "Marco Faustinelli", "link": "https://stackoverflow.com/users/1924798/marco-faustinelli"}, "edited": false, "score": 2, "creation_date": 1433327941, "post_id": 30605953, "comment_id": 49301539, "body": "No - standalone deriving introduces new syntax, <code>deriving instance &lt;class&gt;</code>, which doesn&#39;t need to even be in the same module as the datatype. The two lines are independent declarations."}], "tags": [], "owner": {"reputation": 13807, "user_id": 2407038, "user_type": "registered", "accept_rate": 64, "profile_image": "https://www.gravatar.com/avatar/538f6f4a9aa43841841de7d8e8b169fc?s=128&d=identicon&r=PG&f=1", "display_name": "user2407038", "link": "https://stackoverflow.com/users/2407038/user2407038"}, "is_accepted": true, "score": 6, "last_activity_date": 1433276868, "creation_date": 1433276868, "answer_id": 30605953, "question_id": 30605589, "link": "https://stackoverflow.com/questions/30605589/haskell-home-made-monad-transformer-unable-to-show-itself-in-ghci/30605953#30605953", "title": "Haskell home-made monad transformer unable to Show itself in GHCi", "body": "<p>One of the purposes of standalone deriving is that sometimes the compiler cannot infer the required constraint to make a certain instance, even though the actual <em>code</em> is still derived mechanically. So you just need to know what constraint to give it:</p>\n\n<pre><code>{-# LANGUAGE StandaloneDeriving, UndecidableInstances #-} \n\nnewtype ET m a = ET (m (Maybe a))\nderiving instance Show (m (Maybe a)) =&gt; Show (ET m a)\n</code></pre>\n"}], "owner": {"reputation": 2695, "user_id": 1924798, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/1ba7bffbe41ca39353b6f8bbfd4624a8?s=128&d=identicon&r=PG", "display_name": "Marco Faustinelli", "link": "https://stackoverflow.com/users/1924798/marco-faustinelli"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 84, "favorite_count": 0, "accepted_answer_id": 30605953, "answer_count": 1, "score": 1, "last_activity_date": 1433276868, "creation_date": 1433275592, "question_id": 30605589, "link": "https://stackoverflow.com/questions/30605589/haskell-home-made-monad-transformer-unable-to-show-itself-in-ghci", "title": "Haskell home-made monad transformer unable to Show itself in GHCi", "body": "<p>I am dabbing with simple monad transformers as presented in <a href=\"http://www.cs.nott.ac.uk/~nhn/MGS2006/LectureNotes/lecture03-9up.pdf\" rel=\"nofollow\">http://www.cs.nott.ac.uk/~nhn/MGS2006/LectureNotes/lecture03-9up.pdf</a></p>\n\n<p>My error-handling transformer has type</p>\n\n<pre><code>newtype ET m a = ET (m (Maybe a))\n</code></pre>\n\n<p>I have implemented all the necessary plumbing and I am able to couple it with the identity monad (which in my little sandbox is called <code>I</code>) and write/compile non trivial functions.</p>\n\n<p>But I am unable to print any resulting value onscreen. Message is:</p>\n\n<pre><code>No instance for (Show (ET I Value)) arising from a use of \u2018print\u2019\n</code></pre>\n\n<p><code>Maybe</code> is imported. Both <code>I</code> and <code>Value</code> derive <code>Show</code> and display on their own without problems. It is the mix with <code>ET</code> that won't show. I see two ways:</p>\n\n<ul>\n<li>try to insert <code>deriving Show</code> in the declaration of <code>ET m a</code> (which I tried in many ways obtaining a lot of different error messages)</li>\n<li>create a showable instance dabbing with \"Stand-alone deriving declarations\", as suggested by some web resources - tried with no success so far.</li>\n</ul>\n\n<p>How can I show an <code>ET I Value</code> in my REPL?</p>\n"}, {"tags": ["haskell", "recursion", "lambda-calculus", "church-encoding", "scott-encoding"], "comments": [{"owner": {"reputation": 100185, "user_id": 3234959, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/93bb12ca0f93dfddb33880316f7e66c2?s=128&d=identicon&r=PG&f=1", "display_name": "chi", "link": "https://stackoverflow.com/users/3234959/chi"}, "edited": false, "score": 0, "creation_date": 1433272607, "post_id": 30604408, "comment_id": 49277499, "body": "For that specific list, yes it exists. But you surely mean a function which can take <i>any</i> such list, arbitrarily long, and returns a standard list, right?"}, {"owner": {"reputation": 44680, "user_id": 1031791, "user_type": "registered", "accept_rate": 54, "profile_image": "https://www.gravatar.com/avatar/fb710534fda446d2286074bb7692e65a?s=128&d=identicon&r=PG", "display_name": "MaiaVictor", "link": "https://stackoverflow.com/users/1031791/maiavictor"}, "reply_to_user": {"reputation": 100185, "user_id": 3234959, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/93bb12ca0f93dfddb33880316f7e66c2?s=128&d=identicon&r=PG&f=1", "display_name": "chi", "link": "https://stackoverflow.com/users/3234959/chi"}, "edited": false, "score": 1, "creation_date": 1433272673, "post_id": 30604408, "comment_id": 49277531, "body": "Yes, that is what I mean."}, {"owner": {"reputation": 28873, "user_id": 1068232, "user_type": "registered", "accept_rate": 79, "profile_image": "https://www.gravatar.com/avatar/2a0a145ce58c20013969fe3f203531da?s=128&d=identicon&r=PG", "display_name": "Andr&#225;s Kov&#225;cs", "link": "https://stackoverflow.com/users/1068232/andr%c3%a1s-kov%c3%a1cs"}, "edited": false, "score": 2, "creation_date": 1433275028, "post_id": 30604408, "comment_id": 49278851, "body": "Shouldn&#39;t it be <code>\\c n -&gt; c 3 (\\c n -&gt; n)</code> in the end of the list?"}, {"owner": {"reputation": 13807, "user_id": 2407038, "user_type": "registered", "accept_rate": 64, "profile_image": "https://www.gravatar.com/avatar/538f6f4a9aa43841841de7d8e8b169fc?s=128&d=identicon&r=PG&f=1", "display_name": "user2407038", "link": "https://stackoverflow.com/users/2407038/user2407038"}, "edited": false, "score": 1, "creation_date": 1433275182, "post_id": 30604408, "comment_id": 49278945, "body": "The types of scott-encoded lists are not uniform - that is, the type changes each time you apply another &quot;cons cell&quot;. You would need a type class to do this, otherwise the hypothetical <code>toList</code> function is ill-typed."}, {"owner": {"reputation": 100185, "user_id": 3234959, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/93bb12ca0f93dfddb33880316f7e66c2?s=128&d=identicon&r=PG&f=1", "display_name": "chi", "link": "https://stackoverflow.com/users/3234959/chi"}, "reply_to_user": {"reputation": 13807, "user_id": 2407038, "user_type": "registered", "accept_rate": 64, "profile_image": "https://www.gravatar.com/avatar/538f6f4a9aa43841841de7d8e8b169fc?s=128&d=identicon&r=PG&f=1", "display_name": "user2407038", "link": "https://stackoverflow.com/users/2407038/user2407038"}, "edited": false, "score": 1, "creation_date": 1433275691, "post_id": 30604408, "comment_id": 49279255, "body": "@user2407038 Indeed. I think this is more about the untyped lambda calculus than Haskell."}, {"owner": {"reputation": 44680, "user_id": 1031791, "user_type": "registered", "accept_rate": 54, "profile_image": "https://www.gravatar.com/avatar/fb710534fda446d2286074bb7692e65a?s=128&d=identicon&r=PG", "display_name": "MaiaVictor", "link": "https://stackoverflow.com/users/1031791/maiavictor"}, "reply_to_user": {"reputation": 28873, "user_id": 1068232, "user_type": "registered", "accept_rate": 79, "profile_image": "https://www.gravatar.com/avatar/2a0a145ce58c20013969fe3f203531da?s=128&d=identicon&r=PG", "display_name": "Andr&#225;s Kov&#225;cs", "link": "https://stackoverflow.com/users/1068232/andr%c3%a1s-kov%c3%a1cs"}, "edited": false, "score": 0, "creation_date": 1433277476, "post_id": 30604408, "comment_id": 49280207, "body": "@Andr&#225;s, yes, thanks."}, {"owner": {"reputation": 44680, "user_id": 1031791, "user_type": "registered", "accept_rate": 54, "profile_image": "https://www.gravatar.com/avatar/fb710534fda446d2286074bb7692e65a?s=128&d=identicon&r=PG", "display_name": "MaiaVictor", "link": "https://stackoverflow.com/users/1031791/maiavictor"}, "reply_to_user": {"reputation": 100185, "user_id": 3234959, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/93bb12ca0f93dfddb33880316f7e66c2?s=128&d=identicon&r=PG&f=1", "display_name": "chi", "link": "https://stackoverflow.com/users/3234959/chi"}, "edited": false, "score": 0, "creation_date": 1433277568, "post_id": 30604408, "comment_id": 49280255, "body": "@chi well, someone convinced me ULC questions are still relevant to Haskell since that&#39;s still what you use when, for example, doing type-level computations, or writing DSLs."}, {"owner": {"reputation": 100185, "user_id": 3234959, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/93bb12ca0f93dfddb33880316f7e66c2?s=128&d=identicon&r=PG&f=1", "display_name": "chi", "link": "https://stackoverflow.com/users/3234959/chi"}, "edited": false, "score": 1, "creation_date": 1433278180, "post_id": 30604408, "comment_id": 49280547, "body": "I have a feeling that there&#39;s no such a term, but I have no idea about how to prove that."}, {"owner": {"reputation": 44680, "user_id": 1031791, "user_type": "registered", "accept_rate": 54, "profile_image": "https://www.gravatar.com/avatar/fb710534fda446d2286074bb7692e65a?s=128&d=identicon&r=PG", "display_name": "MaiaVictor", "link": "https://stackoverflow.com/users/1031791/maiavictor"}, "edited": false, "score": 0, "creation_date": 1433278244, "post_id": 30604408, "comment_id": 49280586, "body": "I agree. Intuitively, it doesn&#39;t make sense, indeed... but without a proof it is hard to know for sure."}, {"owner": {"reputation": 28873, "user_id": 1068232, "user_type": "registered", "accept_rate": 79, "profile_image": "https://www.gravatar.com/avatar/2a0a145ce58c20013969fe3f203531da?s=128&d=identicon&r=PG", "display_name": "Andr&#225;s Kov&#225;cs", "link": "https://stackoverflow.com/users/1068232/andr%c3%a1s-kov%c3%a1cs"}, "edited": false, "score": 1, "creation_date": 1433280264, "post_id": 30604408, "comment_id": 49281512, "body": "Can&#39;t we do something with the fact that <code>newtype SList a = SList (forall r. r -&gt; (a -&gt; SList a -&gt; r) -&gt; r)</code> is not strictly positive?"}], "answers": [{"comments": [{"owner": {"reputation": 44680, "user_id": 1031791, "user_type": "registered", "accept_rate": 54, "profile_image": "https://www.gravatar.com/avatar/fb710534fda446d2286074bb7692e65a?s=128&d=identicon&r=PG", "display_name": "MaiaVictor", "link": "https://stackoverflow.com/users/1031791/maiavictor"}, "edited": false, "score": 0, "creation_date": 1433302133, "post_id": 30607903, "comment_id": 49287731, "body": "I don&#39;t get the Miller&#39;s pattern fragment part, but it looks very correct to me."}, {"owner": {"reputation": 44680, "user_id": 1031791, "user_type": "registered", "accept_rate": 54, "profile_image": "https://www.gravatar.com/avatar/fb710534fda446d2286074bb7692e65a?s=128&d=identicon&r=PG", "display_name": "MaiaVictor", "link": "https://stackoverflow.com/users/1031791/maiavictor"}, "edited": false, "score": 0, "creation_date": 1433459138, "post_id": 30607903, "comment_id": 49374094, "body": "Disclaimer: I&#39;m (obviously) not completely sure this is correct."}], "tags": [], "owner": {"reputation": 28873, "user_id": 1068232, "user_type": "registered", "accept_rate": 79, "profile_image": "https://www.gravatar.com/avatar/2a0a145ce58c20013969fe3f203531da?s=128&d=identicon&r=PG", "display_name": "Andr&#225;s Kov&#225;cs", "link": "https://stackoverflow.com/users/1068232/andr%c3%a1s-kov%c3%a1cs"}, "is_accepted": true, "score": 2, "last_activity_date": 1433285164, "creation_date": 1433285164, "answer_id": 30607903, "question_id": 30604408, "link": "https://stackoverflow.com/questions/30604408/is-there-any-non-recursive-term-that-folds-over-a-scott-encoded-list/30607903#30607903", "title": "Is there any non-recursive term that folds over a scott-encoded list?", "body": "<p>OK, I give it a shot. Feel free to correct me, because I'm not an expert on this.</p>\n\n<p>For arbitrary <code>x</code> and <code>xs</code>, it must be the case that <code>toList (\\c n -&gt; c x xs)</code> reduces to a term that is convertible to <code>x : toList xs</code>. </p>\n\n<p>This is only possible if we reduce the left hand side to <code>c x xs</code> by applying <code>(\\c n -&gt; c x xs)</code> to some <code>c</code> and <code>n</code>. So <code>toList ~ (\\f -&gt; f ? ?)</code>. (BTW, this is the part where I couldn't think of a nice rigorous argument; I had some ideas but none very nice. I'd be happy to hear tips).</p>\n\n<p>Now it must be the case that <code>c x xs ~ (x : toList xs)</code>. But since <code>x</code> and <code>xs</code> are distinct universal variables, and they are the only variables occurring in the right hand side, the equation is in <a href=\"http://en.wikipedia.org/wiki/Unification_(computer_science)#Higher-order_unification\" rel=\"nofollow\">Miller's pattern fragment</a>, and therefore <code>c ~ (\\x xs -&gt; x : toList xs)</code> is its most general solution. </p>\n\n<p>So, <code>toList</code> must reduce to <code>(\\f -&gt; f (\\x xs -&gt; x : toList xs) n)</code> for some <code>n</code>. Clearly, <code>toList</code> can't have a normal form, since we can always unfold the recursive occurrence. </p>\n"}], "owner": {"reputation": 44680, "user_id": 1031791, "user_type": "registered", "accept_rate": 54, "profile_image": "https://www.gravatar.com/avatar/fb710534fda446d2286074bb7692e65a?s=128&d=identicon&r=PG", "display_name": "MaiaVictor", "link": "https://stackoverflow.com/users/1031791/maiavictor"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 154, "favorite_count": 3, "accepted_answer_id": 30607903, "answer_count": 1, "score": 5, "last_activity_date": 1557362104, "creation_date": 1433271568, "last_edit_date": 1557362104, "question_id": 30604408, "link": "https://stackoverflow.com/questions/30604408/is-there-any-non-recursive-term-that-folds-over-a-scott-encoded-list", "title": "Is there any non-recursive term that folds over a scott-encoded list?", "body": "<p>Suppose that I have a <a href=\"http://en.wikipedia.org/w/index.php?title=Mogensen%E2%80%93Scott_encoding&amp;oldid=647390899\" rel=\"nofollow\">scott-encoded</a> list such as:</p>\n\n<pre><code>scott = (\\ c n -&gt; c 1 (\\ c n -&gt; c 2 (\\ c n -&gt; c 3 (\\ c n -&gt; n))))\n</code></pre>\n\n<p>I want a function that receives such kind of list and converts it to an actual list (<code>[1,2,3]</code>), except that such function can not be recursive. That is, it must be in eta-beta normal form. Does that function exist?</p>\n"}, {"tags": ["performance", "haskell", "dictionary"], "comments": [{"owner": {"reputation": 7002, "user_id": 827593, "user_type": "registered", "accept_rate": 50, "profile_image": "https://www.gravatar.com/avatar/4d852cf0e1b0e4036e07754fc3925f46?s=128&d=identicon&r=PG", "display_name": "JP Moresmau", "link": "https://stackoverflow.com/users/827593/jp-moresmau"}, "edited": false, "score": 0, "creation_date": 1433251847, "post_id": 30595526, "comment_id": 49263523, "body": "Also, you use a ByteString for storing, but you read first each line into a string. Use the ByteString file operations to read directly from byte string. Or better, use Text since you have text data, and Text also provide file IO operations."}, {"owner": {"reputation": 44013, "user_id": 1477667, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/trgKM.jpg?s=128&g=1", "display_name": "dfeuer", "link": "https://stackoverflow.com/users/1477667/dfeuer"}, "edited": false, "score": 0, "creation_date": 1433275321, "post_id": 30595526, "comment_id": 49279018, "body": "As far as I know, there&#39;s no good reason to enable line buffering on a file."}, {"owner": {"reputation": 44013, "user_id": 1477667, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/trgKM.jpg?s=128&g=1", "display_name": "dfeuer", "link": "https://stackoverflow.com/users/1477667/dfeuer"}, "edited": false, "score": 0, "creation_date": 1433276008, "post_id": 30595526, "comment_id": 49279399, "body": "Also, is there a reason you&#39;re using <code>M.insertWith (++) (sort word) [B.pack word] dict</code> instead of <code>let !packed = B.pack word in adjust (packed :) (sort word) dict</code>? I don&#39;t know if <code>adjust</code> will be more efficient in this context, but it at least seems to communicate the intention better."}, {"owner": {"reputation": 3006, "user_id": 920130, "user_type": "registered", "accept_rate": 83, "profile_image": "https://i.stack.imgur.com/eF81F.jpg?s=128&g=1", "display_name": "Mathias Dolidon", "link": "https://stackoverflow.com/users/920130/mathias-dolidon"}, "edited": false, "score": 0, "creation_date": 1433276318, "post_id": 30595526, "comment_id": 49279573, "body": "No particular reason. It&#39;s my second program in Haskell that&#39;s more than 5 lines long (first one was four years ago) and I&#39;m still absolutely unfamiliar with both library and idioms. :)"}], "answers": [{"comments": [{"owner": {"reputation": 44013, "user_id": 1477667, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/trgKM.jpg?s=128&g=1", "display_name": "dfeuer", "link": "https://stackoverflow.com/users/1477667/dfeuer"}, "edited": false, "score": 1, "creation_date": 1433255787, "post_id": 30598406, "comment_id": 49266759, "body": "Since Scrabble only needs a tiny portion of ASCII (plus blanks) <code>Text</code> seems like overkill to me."}, {"owner": {"reputation": 44013, "user_id": 1477667, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/trgKM.jpg?s=128&g=1", "display_name": "dfeuer", "link": "https://stackoverflow.com/users/1477667/dfeuer"}, "edited": false, "score": 0, "creation_date": 1433266535, "post_id": 30598406, "comment_id": 49274050, "body": "Even if you wanted multilingual support, you&#39;d only ever be dealing with one language at a time, and no character-based writing systems (as those wouldn&#39;t really work for the game). So any suitable writing system could be managed with <code>ByteString</code> using some 8-bit encoding or other."}, {"owner": {"reputation": 3006, "user_id": 920130, "user_type": "registered", "accept_rate": 83, "profile_image": "https://i.stack.imgur.com/eF81F.jpg?s=128&g=1", "display_name": "Mathias Dolidon", "link": "https://stackoverflow.com/users/920130/mathias-dolidon"}, "edited": false, "score": 0, "creation_date": 1433267140, "post_id": 30598406, "comment_id": 49274386, "body": "Indeed. An Scrabble is a hard thing if you want to go multlingual. Thinking of the Spanish version for instance, that has LL and CH tokens, besides L, C and H. But this is only a toy, so I&#39;ll be fine with either ByteString or Text. The factor in size does not account for how much memory this Data.Map takes up. :)"}, {"owner": {"reputation": 3006, "user_id": 920130, "user_type": "registered", "accept_rate": 83, "profile_image": "https://i.stack.imgur.com/eF81F.jpg?s=128&g=1", "display_name": "Mathias Dolidon", "link": "https://stackoverflow.com/users/920130/mathias-dolidon"}, "edited": false, "score": 0, "creation_date": 1433276902, "post_id": 30598406, "comment_id": 49279913, "body": "Just tried. No speed improvement on my laptop readFile + foldr. It&#39;s seven years old, good hardware for writing fast programs. ;) But the code looks much nicer."}], "tags": [], "owner": {"reputation": 7002, "user_id": 827593, "user_type": "registered", "accept_rate": 50, "profile_image": "https://www.gravatar.com/avatar/4d852cf0e1b0e4036e07754fc3925f46?s=128&d=identicon&r=PG", "display_name": "JP Moresmau", "link": "https://stackoverflow.com/users/827593/jp-moresmau"}, "is_accepted": false, "score": 2, "last_activity_date": 1433253988, "creation_date": 1433253988, "answer_id": 30598406, "question_id": 30595526, "link": "https://stackoverflow.com/questions/30595526/how-to-fill-up-a-data-map-in-a-spacetime-efficient-way/30598406#30598406", "title": "How to fill up a Data.Map in a space&amp;time efficient way", "body": "<p>The following works in around a second on my laptop:</p>\n\n<pre><code>import qualified Data.Map as M\nimport qualified Data.Text as T\nimport qualified Data.Text.IO as T\nimport Data.List\n\ntype Dict = M.Map T.Text [T.Text]\n\nnewDict = M.empty\n\naddWord:: T.Text -&gt; Dict -&gt; Dict\naddWord word dict = M.insertWith (++) (T.pack $ sort $ T.unpack word) [word] dict\n\nloadAnagramsFromFile fileName = do\n    full &lt;- T.readFile fileName\n    let ls = T.lines full\n    return $ foldr addWord newDict lsct ls\n</code></pre>\n\n<p>This is using Text, with just a wart for sorting. There may be a better way of sorting a Text. </p>\n"}, {"comments": [{"owner": {"reputation": 44013, "user_id": 1477667, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/trgKM.jpg?s=128&g=1", "display_name": "dfeuer", "link": "https://stackoverflow.com/users/1477667/dfeuer"}, "edited": false, "score": 0, "creation_date": 1433266718, "post_id": 30600082, "comment_id": 49274134, "body": "I didn&#39;t realize <code>Data.Trie</code> was an uncompressed trie. Blech."}, {"owner": {"reputation": 44013, "user_id": 1477667, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/trgKM.jpg?s=128&g=1", "display_name": "dfeuer", "link": "https://stackoverflow.com/users/1477667/dfeuer"}, "edited": false, "score": 0, "creation_date": 1433266782, "post_id": 30600082, "comment_id": 49274175, "body": "Also, you should mention that you are the author of <code>packed-dawg</code>."}, {"owner": {"reputation": 3006, "user_id": 920130, "user_type": "registered", "accept_rate": 83, "profile_image": "https://i.stack.imgur.com/eF81F.jpg?s=128&g=1", "display_name": "Mathias Dolidon", "link": "https://stackoverflow.com/users/920130/mathias-dolidon"}, "edited": false, "score": 0, "creation_date": 1433267391, "post_id": 30600082, "comment_id": 49274541, "body": "Before diving into all those answers as a whole, here&#39;s the C++ version (don&#39;t mind the <code>using namespace</code> that&#39;s gone astray into a header...). 12 Mb as per the activity monitor, on a 64 bit OSX. :) gist.github.com/anonymous/1596f091109238a9ee22 unordered_map used four times as much memory indeed, hence the array of vectors of strings, with a bit less than 100000 elements."}, {"owner": {"reputation": 3006, "user_id": 920130, "user_type": "registered", "accept_rate": 83, "profile_image": "https://i.stack.imgur.com/eF81F.jpg?s=128&g=1", "display_name": "Mathias Dolidon", "link": "https://stackoverflow.com/users/920130/mathias-dolidon"}, "edited": false, "score": 0, "creation_date": 1433267638, "post_id": 30600082, "comment_id": 49274661, "body": "No time right now for more playing around (home, kid, dinner...), but the DAWG package seems to be a very nice thing. Thanks for that lead. I&#39;m still very dubious though about a Data.Map needing 290 Mb to store 320000 entries in the original solution. That&#39;s about one kilobyte per entry. How can one explain that ?"}, {"owner": {"reputation": 28873, "user_id": 1068232, "user_type": "registered", "accept_rate": 79, "profile_image": "https://www.gravatar.com/avatar/2a0a145ce58c20013969fe3f203531da?s=128&d=identicon&r=PG", "display_name": "Andr&#225;s Kov&#225;cs", "link": "https://stackoverflow.com/users/1068232/andr%c3%a1s-kov%c3%a1cs"}, "reply_to_user": {"reputation": 3006, "user_id": 920130, "user_type": "registered", "accept_rate": 83, "profile_image": "https://i.stack.imgur.com/eF81F.jpg?s=128&g=1", "display_name": "Mathias Dolidon", "link": "https://stackoverflow.com/users/920130/mathias-dolidon"}, "edited": false, "score": 0, "creation_date": 1433268546, "post_id": 30600082, "comment_id": 49275168, "body": "@MathiasDolidon: Your custom container, plus your handling of hash collisions, plus small string optimization (maybe...) together make the 12 Mb space plausbile, indeed. I&#39;ll probably look at the Data.Map thing later, and try to get more precise numbers on space (keyword: <code>ghc-datasize</code>)."}, {"owner": {"reputation": 28873, "user_id": 1068232, "user_type": "registered", "accept_rate": 79, "profile_image": "https://www.gravatar.com/avatar/2a0a145ce58c20013969fe3f203531da?s=128&d=identicon&r=PG", "display_name": "Andr&#225;s Kov&#225;cs", "link": "https://stackoverflow.com/users/1068232/andr%c3%a1s-kov%c3%a1cs"}, "reply_to_user": {"reputation": 44013, "user_id": 1477667, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/trgKM.jpg?s=128&g=1", "display_name": "dfeuer", "link": "https://stackoverflow.com/users/1477667/dfeuer"}, "edited": false, "score": 0, "creation_date": 1433268759, "post_id": 30600082, "comment_id": 49275285, "body": "@dfeuer: <code>Data.Trie</code> does have compressed arcs, so I reworded my answer."}, {"owner": {"reputation": 3006, "user_id": 920130, "user_type": "registered", "accept_rate": 83, "profile_image": "https://i.stack.imgur.com/eF81F.jpg?s=128&g=1", "display_name": "Mathias Dolidon", "link": "https://stackoverflow.com/users/920130/mathias-dolidon"}, "edited": false, "score": 0, "creation_date": 1433274733, "post_id": 30600082, "comment_id": 49278678, "body": "Given Reid Barton&#39;s answer, I&#39;ve &quot;unaccepted&quot; your answer ; I hope you forgive this rudeness, nevertheless your input has been highly appreciated, and I&#39;ll definitely have a look at DAWG ; with my regards."}], "tags": [], "owner": {"reputation": 28873, "user_id": 1068232, "user_type": "registered", "accept_rate": 79, "profile_image": "https://www.gravatar.com/avatar/2a0a145ce58c20013969fe3f203531da?s=128&d=identicon&r=PG", "display_name": "Andr&#225;s Kov&#225;cs", "link": "https://stackoverflow.com/users/1068232/andr%c3%a1s-kov%c3%a1cs"}, "is_accepted": false, "score": 6, "last_activity_date": 1433272957, "last_edit_date": 1433272957, "creation_date": 1433258279, "answer_id": 30600082, "question_id": 30595526, "link": "https://stackoverflow.com/questions/30595526/how-to-fill-up-a-data-map-in-a-spacetime-efficient-way/30600082#30600082", "title": "How to fill up a Data.Map in a space&amp;time efficient way", "body": "<p><strong>EDIT</strong>: Removed erroneous benchmarking and commentary, only left a minor bit of advice. See Reid Barton's answer for a direct solution to OP's question.</p>\n\n<p>If you don't need to change the dictionary at runtime, then <a href=\"http://en.wikipedia.org/wiki/Deterministic_acyclic_finite_state_automaton\" rel=\"nofollow\">DAWG-s</a> are pretty much the most space-time efficient solution you can get (at least for word games).</p>\n\n<p>For example, we can generate and serialize a DAWG from your dictionary that takes only 295 Kb space, and supports quite efficient lookup and prefix matching:</p>\n\n<pre><code>import qualified Data.DAWG.Packed as D -- from my \"packed-dawg\" package\n\nmain = do\n  words &lt;- lines &lt;$&gt; readFile \"dict.txt\"\n  D.toFile \"dict.dawg\" $ D.fromList words -- serialize as \"dict.dawg\"\n</code></pre>\n"}, {"comments": [{"owner": {"reputation": 3006, "user_id": 920130, "user_type": "registered", "accept_rate": 83, "profile_image": "https://i.stack.imgur.com/eF81F.jpg?s=128&g=1", "display_name": "Mathias Dolidon", "link": "https://stackoverflow.com/users/920130/mathias-dolidon"}, "edited": false, "score": 0, "creation_date": 1433272456, "post_id": 30604391, "comment_id": 49277431, "body": "Laziness kills... Hell I hadn&#39;t thought of that. Got bitten again... As for the short byte string, thanks for the hint. I didn&#39;t know that type. That doesn&#39;t help understand how the Map eats up so much space in itself, but it defintely helps improve things while keep the same data structure."}, {"owner": {"reputation": 28873, "user_id": 1068232, "user_type": "registered", "accept_rate": 79, "profile_image": "https://www.gravatar.com/avatar/2a0a145ce58c20013969fe3f203531da?s=128&d=identicon&r=PG", "display_name": "Andr&#225;s Kov&#225;cs", "link": "https://stackoverflow.com/users/1068232/andr%c3%a1s-kov%c3%a1cs"}, "edited": false, "score": 1, "creation_date": 1433272471, "post_id": 30604391, "comment_id": 49277440, "body": "Very nice, and I think this is the proper direct answer. I wonder what I should do with my botched benchmarking."}], "tags": [], "owner": {"reputation": 14485, "user_id": 190376, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/cd8280c5e1491b8cf55760750ed97dec?s=128&d=identicon&r=PG", "display_name": "Reid Barton", "link": "https://stackoverflow.com/users/190376/reid-barton"}, "is_accepted": true, "score": 7, "last_activity_date": 1433271516, "creation_date": 1433271516, "answer_id": 30604391, "question_id": 30595526, "link": "https://stackoverflow.com/questions/30595526/how-to-fill-up-a-data-map-in-a-spacetime-efficient-way/30604391#30604391", "title": "How to fill up a Data.Map in a space&amp;time efficient way", "body": "<p>One mistake that you are making that hasn't been pointed out yet is that you are storing unevaluated thunks of the form <code>B.pack word</code> in the lists that are the values in your Map. That means that you are retaining essentially the entire input file in the inefficient String format during the construction of your Map, at a cost of 24 bytes per character in your input file. Using the <code>Data.Map.Strict</code> API makes no difference here, since the functions in that API only force the elements of the Map to weak head normal form, which for a list means only evaluating whether the outermost constructor is <code>[]</code> or <code>(:)</code>, and not evaluating any of the list's elements.</p>\n\n<p>Another improvement you can make is to use the <a href=\"https://hackage.haskell.org/package/bytestring-0.10.4.0/docs/Data-ByteString-Short.html\"><code>ShortByteString</code></a> type available in recent versions of bytestring (the one that comes with GHC 7.8 is new enough). This is specifically designed for minimizing memory usage when storing many short bytestrings, with the trade-off being that most operations on a <code>ShortByteString</code> require a copy.</p>\n\n<p>Andr\u00e1s Kov\u00e1cs's Map example code would look like this with these changes:</p>\n\n<pre><code>{-# LANGUAGE BangPatterns #-}\n\nimport Control.Applicative\nimport Data.List\nimport qualified Data.Map.Strict as M\nimport qualified Data.ByteString.Char8 as B\nimport qualified Data.ByteString.Short as B (ShortByteString, toShort, fromShort)\n\nshortPack = B.toShort . B.pack\n\nmain = do\n  words &lt;- lines &lt;$&gt; readFile \"dict.txt\"\n  print $ M.size $\n    M.fromListWith (++) $ map (\\w -&gt; let !x = shortPack w in (shortPack $ sort w, [x])) words\n</code></pre>\n\n<p>Each of these changes saves about 30% of the maximum residency in my tests, for a total of over 50% space usage savings.</p>\n"}], "owner": {"reputation": 3006, "user_id": 920130, "user_type": "registered", "accept_rate": 83, "profile_image": "https://i.stack.imgur.com/eF81F.jpg?s=128&g=1", "display_name": "Mathias Dolidon", "link": "https://stackoverflow.com/users/920130/mathias-dolidon"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 381, "favorite_count": 1, "accepted_answer_id": 30604391, "answer_count": 3, "score": 10, "last_activity_date": 1438679069, "creation_date": 1433246482, "last_edit_date": 1438679069, "question_id": 30595526, "link": "https://stackoverflow.com/questions/30595526/how-to-fill-up-a-data-map-in-a-spacetime-efficient-way", "title": "How to fill up a Data.Map in a space&amp;time efficient way", "body": "<p>Coming back to Haskell four years after the first glimpse of it. I'm always as amazed by the expressiveness, and as baffled by my inability to predict space/time performance.</p>\n\n<p>As a warm up, I took to translating a tiny toy program I had written in C++. It's about \"cheating\" at Scrabble. You input your game, and it outputs possible words you may play, with your letters alone or by crossing a letter on the board.</p>\n\n<p>The whole thing revolves around a dictionary that's preloaded at start up. The words are then stored as lists in a map, together with their anagrams. The keys are strings of sorted letters. An example will speak more clearly : </p>\n\n<pre><code>Key : \"AEHPS\"  Value : [\"HEAPS\",\"PHASE\",\"SHAPE\"]\n</code></pre>\n\n<p>The C++ version reads the ~320000 words of the dictionary one at a time, in about 200ms in total. The resulting data structure is a hash-map stored in a <code>array&lt;99991, vector&lt;string&gt;&gt;</code> and takes up about 12 megabytes of memory.</p>\n\n<p>The Haskell version reads the same dictionary in about 5 seconds, and the program heap size was ballooning up to 400 megabytes ! I changed the value type in the <code>Data.Map</code> from <code>[String]</code> to <code>[ByteString]</code> to save some memory, and that brought the program memory consumption down to roughly 290 megabytes. That's still 24 times more than my C++ version. That's more than mere \"overhead\", even though <code>Data.Map</code> is a tree instead of an array.</p>\n\n<p>So I assume that I'm doing something wrong.</p>\n\n<p>The whole module is visible here : (deprecated link)</p>\n\n<p>I suppose that my trouble has something to do with the way that <code>Data.Map</code> gets built incrementally, growing upon previous versions of itself ? Or with the data structure itself ? Or something else ?</p>\n\n<p>I'll try other solutions, like <code>Data.HashMap</code>, or filling up <code>Data.Map</code> with <code>fromListWith</code>. Nevertheless, I'd like to build up some understanding of what's going on here. Thanks a lot for any insight !</p>\n\n<hr>\n\n<p>Short answer :</p>\n\n<p>Using Data.Map.Strict, forcing the evaluation of value elements, and storing the keys as ByteStrings too made the miracle of dividing the memory footprint nearly by 3. The result is 100Meg, which is only twice larger than a standard <code>std::multimap&lt;std::string, std::string&gt;</code> in C++ for the same dataset. No speedup though. Git updated.</p>\n\n<p>Thanks a lot to all who contributed, there is interesting material down here !</p>\n"}, {"tags": ["parsing", "haskell", "parsec"], "answers": [{"tags": [], "owner": {"reputation": 13626, "user_id": 492865, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/5c69a2080e68c8606961a18aba3a08ec?s=128&d=identicon&r=PG", "display_name": "Yuras", "link": "https://stackoverflow.com/users/492865/yuras"}, "is_accepted": true, "score": 6, "last_activity_date": 1433243050, "creation_date": 1433243050, "answer_id": 30594272, "question_id": 30593573, "link": "https://stackoverflow.com/questions/30593573/parsec-choice-in-parser-error-throws-but-does-not-go-to-next-parser/30594272#30594272", "title": "Parsec &lt;|&gt; choice in parser, Error throws but does not go to next parser", "body": "<p>From the <a href=\"https://hackage.haskell.org/package/parsec-3.1.9/docs/Text-Parsec.html#v:-60--124--62-\">documentation</a> for <code>&lt;|&gt;</code>:</p>\n\n<blockquote>\n  <p>The parser is called predictive since q is only tried when parser p didn't consume any input (i.e.. the look ahead is 1).</p>\n</blockquote>\n\n<p>In your case both the parses consume <code>\"#\\\\\"</code> before failing, so the other alternative can't be evaluated. You can use <code>try</code> to ensure backtracking works as expected:</p>\n\n<blockquote>\n  <p>The parser <code>try p</code> behaves like parser <code>p</code>, except that it pretends that it hasn't consumed any input when an error occurs.</p>\n</blockquote>\n\n<p>Something like the next:</p>\n\n<pre><code>try parseSpecialCharNotation &lt;|&gt; parseSingleChar\n</code></pre>\n\n<p>Side note: is it better to extract <code>\"#\\\\\"</code> out of the parsers because otherwise you are doing the same work twice. Something like the next:</p>\n\n<pre><code>do\n  string \"#\\\\\"\n  try parseSpecialCharNotation &lt;|&gt; parseSingleChar\n</code></pre>\n\n<p>Also, you can use <a href=\"https://hackage.haskell.org/package/parsec-3.1.9/docs/Text-Parsec-Char.html#v:string\"><code>string</code></a> combinator instead of a series of <code>char</code> parsers.</p>\n"}], "owner": {"reputation": 4733, "user_id": 728407, "user_type": "registered", "accept_rate": 73, "profile_image": "https://www.gravatar.com/avatar/26b3f058ce75a05fd2ccc561f1cfa501?s=128&d=identicon&r=PG", "display_name": "Ashish Negi", "link": "https://stackoverflow.com/users/728407/ashish-negi"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 218, "favorite_count": 0, "accepted_answer_id": 30594272, "answer_count": 1, "score": 2, "last_activity_date": 1433243050, "creation_date": 1433241022, "question_id": 30593573, "link": "https://stackoverflow.com/questions/30593573/parsec-choice-in-parser-error-throws-but-does-not-go-to-next-parser", "title": "Parsec &lt;|&gt; choice in parser, Error throws but does not go to next parser", "body": "<p>I am learning haskell with <code>Write yourself a scheme</code>.</p>\n\n<p>I am currently trying to implement a <code>char</code> recognition in scheme. A char is <code>#\\&lt;character&gt;</code> or <code>#\\&lt;character-name&gt;</code> like <code>#\\a</code> or <code>#\\</code> or <code>#\\space</code>.</p>\n\n<p>So i wrote the following code :</p>\n\n<pre><code>-- .. some code ..\ndata LispVal = Atom String\n             | List [LispVal]\n             | DottedList [LispVal] LispVal\n             | String String\n             | Number Integer\n             | Bool Bool\n             | Char Char deriving Show\n-- .... More code ...\nparseChar :: Parser LispVal\nparseChar = liftM Char (parseSingleChar &lt;|&gt; parseSpecialCharNotation)\n\nparseSingleChar :: Parser Char\nparseSingleChar = do string \"#\\\\\"\n                     x &lt;- letter\n                     return x\n\nparseSpecialCharNotation :: Parser Char\nparseSpecialCharNotation = do string \"#\\\\\"\n                              x &lt;- (parseSpace &lt;|&gt; parseNewline)\n                              return x\n\nparseSpace :: Parser Char\nparseSpace = do char 's'\n                char 'p'\n                char 'a'\n                char 'c'\n                char 'e'\n                return ' '\n\nparseNewline :: Parser Char\nparseNewline = do char 'n'\n                  char 'e'\n                  char 'w'\n                  char 'l'\n                  char 'i'\n                  char 'n'\n                  char 'e'\n                  return '\\n'\n\n-- .. some more code...\n\nreadExpr :: String -&gt; String\nreadExpr input = case parse parseExpr \"lisp\" input of\n                 Left err -&gt; \"Parse Error: \" ++ show err\n                 Right val -&gt; \"Found value: \" ++ show val\n</code></pre>\n\n<p>At this moment, i did not know about the <code>string</code> parser in <code>Parsec</code>. </p>\n\n<p>The problem is that i recognizes, <code>#\\a</code> but <code>#\\space</code> is treated as a <code>s</code>.</p>\n\n<pre><code>*Main&gt; readExpr \"#\\\\space\"\n\"Found value: Char 's'\"\n</code></pre>\n\n<p>To resolve this problem, i changed <code>parseChar</code> as</p>\n\n<pre><code>parseChar :: Parser LispVal\nparseChar = liftM Char (parseSpecialCharNotation &lt;|&gt; parseSingleChar)\n</code></pre>\n\n<p>but earlier problem is solved, but now it gives me errors with normal characters as -</p>\n\n<pre><code>*Main&gt; readExpr \"#\\\\s\"\n\"Parse Error: \\\"lisp\\\" (line 1, column 4):\\nunexpected end of input\\nexpecting \\\"p\\\"\"\n</code></pre>\n\n<p>Why is that happening ? Should not it had moved to <code>parseSingleChar</code> as <code>parseSpecialCharNotation</code> failed ?</p>\n\n<p>Full code at: <a href=\"https://gist.github.com/ashishnegi/a44aa0079851d06421a0\" rel=\"nofollow\">Gist</a></p>\n"}, {"tags": ["haskell", "types"], "answers": [{"comments": [{"owner": {"reputation": 375, "user_id": 2533786, "user_type": "registered", "accept_rate": 40, "profile_image": "https://www.gravatar.com/avatar/2cada3fb91b06579b0ab2b186695b32d?s=128&d=identicon&r=PG", "display_name": "bimmo", "link": "https://stackoverflow.com/users/2533786/bimmo"}, "edited": false, "score": 0, "creation_date": 1433244887, "post_id": 30593859, "comment_id": 49258192, "body": "&quot;Scoped type variables&quot; - Exactly what I wanted. And said so much more succinctly than my title!"}, {"owner": {"reputation": 75362, "user_id": 625403, "user_type": "registered", "accept_rate": 82, "profile_image": "https://www.gravatar.com/avatar/786eed7da67079cb5d63a49d469af25b?s=128&d=identicon&r=PG", "display_name": "amalloy", "link": "https://stackoverflow.com/users/625403/amalloy"}, "edited": false, "score": 0, "creation_date": 1433274508, "post_id": 30593859, "comment_id": 49278540, "body": "How would you even do this with asTypeOf and undefined? It seems to me that you can&#39;t ever get a value of type <code>a</code> to point asTypeOf at, because none are either passed in or returned from this function. You could only get hold of one via scoped type variables, at which point you no longer need asTypeOf or undefined."}, {"owner": {"reputation": 17809, "user_id": 1088108, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/63781cd38e91aa346a3849bc3ef3e550?s=128&d=identicon&r=PG&f=1", "display_name": "&#216;rjan Johansen", "link": "https://stackoverflow.com/users/1088108/%c3%98rjan-johansen"}, "reply_to_user": {"reputation": 75362, "user_id": 625403, "user_type": "registered", "accept_rate": 82, "profile_image": "https://www.gravatar.com/avatar/786eed7da67079cb5d63a49d469af25b?s=128&d=identicon&r=PG", "display_name": "amalloy", "link": "https://stackoverflow.com/users/625403/amalloy"}, "edited": false, "score": 2, "creation_date": 1433301847, "post_id": 30593859, "comment_id": 49287676, "body": "@amalloy Because <code>asTypeOf</code> never actually evaluates its second argument, just uses it for type inference, you can tie it into knots like this: <code>barrer = let min = minBound `asTypeOf` result; result = toEnum . someFunction . fromEnum $ min in result</code>"}, {"owner": {"reputation": 75362, "user_id": 625403, "user_type": "registered", "accept_rate": 82, "profile_image": "https://www.gravatar.com/avatar/786eed7da67079cb5d63a49d469af25b?s=128&d=identicon&r=PG", "display_name": "amalloy", "link": "https://stackoverflow.com/users/625403/amalloy"}, "reply_to_user": {"reputation": 17809, "user_id": 1088108, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/63781cd38e91aa346a3849bc3ef3e550?s=128&d=identicon&r=PG&f=1", "display_name": "&#216;rjan Johansen", "link": "https://stackoverflow.com/users/1088108/%c3%98rjan-johansen"}, "edited": false, "score": 0, "creation_date": 1433302144, "post_id": 30593859, "comment_id": 49287733, "body": "@&#216;rjanJohansen I get that you don&#39;t need an actual value for the asTypeOf, but you can&#39;t even get a handle to its type. Here, the return type of the function is <code>Int</code>, not <code>a</code>, and so you can&#39;t just use <code>asTypeOf result</code> to get something of type <code>a</code>. Maybe I&#39;m just not understanding your suggestion; can you write a specific function that has the OP&#39;s type signature, without scoped type variables and no ambiguity?"}, {"owner": {"reputation": 75362, "user_id": 625403, "user_type": "registered", "accept_rate": 82, "profile_image": "https://www.gravatar.com/avatar/786eed7da67079cb5d63a49d469af25b?s=128&d=identicon&r=PG", "display_name": "amalloy", "link": "https://stackoverflow.com/users/625403/amalloy"}, "edited": false, "score": 0, "creation_date": 1433302251, "post_id": 30593859, "comment_id": 49287757, "body": "That is, given OP&#39;s type signature, <code>asTypeOf minBound result</code> just gets you <code>minBound :: Int</code>, not <code>minBound :: a</code>."}, {"owner": {"reputation": 17809, "user_id": 1088108, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/63781cd38e91aa346a3849bc3ef3e550?s=128&d=identicon&r=PG&f=1", "display_name": "&#216;rjan Johansen", "link": "https://stackoverflow.com/users/1088108/%c3%98rjan-johansen"}, "reply_to_user": {"reputation": 75362, "user_id": 625403, "user_type": "registered", "accept_rate": 82, "profile_image": "https://www.gravatar.com/avatar/786eed7da67079cb5d63a49d469af25b?s=128&d=identicon&r=PG", "display_name": "amalloy", "link": "https://stackoverflow.com/users/625403/amalloy"}, "edited": false, "score": 0, "creation_date": 1433302571, "post_id": 30593859, "comment_id": 49287819, "body": "@amalloy Oh, that&#39;s the signature of <code>bar</code>, I interpreted OP as being more interested in <code>barrer</code>. I note there&#39;s a bit of unfortunate phrasing but they are doing more to the integer after constructing it."}, {"owner": {"reputation": 75362, "user_id": 625403, "user_type": "registered", "accept_rate": 82, "profile_image": "https://www.gravatar.com/avatar/786eed7da67079cb5d63a49d469af25b?s=128&d=identicon&r=PG", "display_name": "amalloy", "link": "https://stackoverflow.com/users/625403/amalloy"}, "edited": false, "score": 0, "creation_date": 1433302698, "post_id": 30593859, "comment_id": 49287856, "body": "Ah. Indeed, <code>barrer</code> is not a big deal to do. But I think <code>bar</code> still is impossible without scoped type variables, right?"}, {"owner": {"reputation": 17809, "user_id": 1088108, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/63781cd38e91aa346a3849bc3ef3e550?s=128&d=identicon&r=PG&f=1", "display_name": "&#216;rjan Johansen", "link": "https://stackoverflow.com/users/1088108/%c3%98rjan-johansen"}, "reply_to_user": {"reputation": 75362, "user_id": 625403, "user_type": "registered", "accept_rate": 82, "profile_image": "https://www.gravatar.com/avatar/786eed7da67079cb5d63a49d469af25b?s=128&d=identicon&r=PG", "display_name": "amalloy", "link": "https://stackoverflow.com/users/625403/amalloy"}, "edited": false, "score": 0, "creation_date": 1433302783, "post_id": 30593859, "comment_id": 49287876, "body": "@amalloy Yeah, In fact I don&#39;t think even scoped type variables help for that one."}], "tags": [], "owner": {"reputation": 1790, "user_id": 3350784, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/OTuvN.png?s=128&g=1", "display_name": "Yuuri", "link": "https://stackoverflow.com/users/3350784/yuuri"}, "is_accepted": true, "score": 14, "last_activity_date": 1433275183, "last_edit_date": 1433275183, "creation_date": 1433241872, "answer_id": 30593859, "question_id": 30593485, "link": "https://stackoverflow.com/questions/30593485/haskell-can-type-variables-be-used-within-function-definition/30593859#30593859", "title": "Haskell: Can type variables be used within function definition?", "body": "<p>The <a href=\"https://wiki.haskell.org/Scoped_type_variables\" rel=\"noreferrer\">ScopedTypeVariables</a> extension solves exactly your problem. The page also provides some alternative solutions (<code>asTypeOf</code> and <code>undefined</code> arguments).</p>\n"}], "owner": {"reputation": 375, "user_id": 2533786, "user_type": "registered", "accept_rate": 40, "profile_image": "https://www.gravatar.com/avatar/2cada3fb91b06579b0ab2b186695b32d?s=128&d=identicon&r=PG", "display_name": "bimmo", "link": "https://stackoverflow.com/users/2533786/bimmo"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 691, "favorite_count": 1, "accepted_answer_id": 30593859, "answer_count": 1, "score": 13, "last_activity_date": 1433302697, "creation_date": 1433240748, "last_edit_date": 1433302697, "question_id": 30593485, "link": "https://stackoverflow.com/questions/30593485/haskell-can-type-variables-be-used-within-function-definition", "title": "Haskell: Can type variables be used within function definition?", "body": "<p>I have a problem relating to the Haskell type system. This is not the first time I have encountered the type system's limitations. I will omit my project details and use a simplified example. Here is some code:</p>\n\n<pre><code>-- Works\nfoo :: (Bounded a, Enum a) =&gt; a\nfoo = minBound\n\n-- \"ambiguous\" constraint:\n-- 'a' has no occurrences in type declaration\nbar :: (Bounded a, Enum a) =&gt; Int\nbar = fromEnum minBound\n\n-- Too much information in return\n-- but I can show haskell the appropriate type of 'min'\nbaz :: (Bounded a, Enum a) =&gt; (a, Int)\nbaz = let min = minBound\n    in (min, someFunction . fromEnum $ min)\n\n-- Type constraint 'a' not ambiguous\n--     (or at least that isn't the compiler error message)\n-- but Haskell doesn't know which 'minBound' to use\nbarrer :: (Bounded a, Enum a) =&gt; a\nbarrer = let min = minBound -- &lt;- min's type is ambiguous\n    in toEnum . someFunction . fromEnum $ min\n</code></pre>\n\n<p>What I am trying to achieve is similar to <code>barrer</code>: First, use the <code>minBound</code> value specific to type <code>a</code> and 'cast' it to an integer. In my project, I proceed to transform this integer (to avoid intermediate arithmetic overflows when using type <code>a</code>) and 'cast' them back to type <code>a</code> (after a bit of <code>mod</code> magic). How can I tell Haskell the appropriate type of <code>minBound</code>? Is it possible?</p>\n\n<p>The obvious solution is to add an annotation of <code>minBound :: a</code>. This would also fix <code>bar</code>. The problem: The type variable <code>a</code> seems to be out of scope in the function definition, as Haskell freshens <code>minBound :: a</code> to <code>minBound a0</code> in the error message. Is there a way to do this type of annotation?</p>\n\n<p>One bad hack I used was to constrain the type of the <code>minBound</code> call by including it in the function's return type, a la <code>baz</code>. This solution is not ideal. Does anyone have some advise?</p>\n"}, {"tags": ["haskell", "instance", "typeclass", "haddock"], "owner": {"reputation": 745, "user_id": 1926884, "user_type": "registered", "accept_rate": 80, "profile_image": "https://www.gravatar.com/avatar/1783f4ed8a98a1a4b7a7321d4cea3fa4?s=128&d=identicon&r=PG", "display_name": "Rnhmjoj", "link": "https://stackoverflow.com/users/1926884/rnhmjoj"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 114, "favorite_count": 0, "answer_count": 0, "score": 5, "last_activity_date": 1433253062, "creation_date": 1433238264, "last_edit_date": 1433253062, "question_id": 30592583, "link": "https://stackoverflow.com/questions/30592583/haddock-imported-class-instances-are-not-documented", "title": "Haddock: imported class instances are not documented", "body": "<p>Due to mutually dependent imports I had to move the class instances in an <code>Instances</code> module and my datatypes in a <code>Types</code> module. The definitions of both two modules are then re-exported by the main module of the package.</p>\n\n<p>Haddock lists for my type the class instances derived with <code>deriving</code> but all the others are missing (though they seem correctly exported and working). Is it normal or should they be listed as well? What can I do?</p>\n\n<p><a href=\"https://hackage.haskell.org/package/number\" rel=\"nofollow\">This</a> is the package if needed.</p>\n\n<p>Thank you.</p>\n"}, {"tags": ["haskell", "dotfiles"], "answers": [{"tags": [], "owner": {"reputation": 30377, "user_id": 369198, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/71596bb1ca3ba3aa4400c3f407baec9f?s=128&d=identicon&r=PG", "display_name": "Michael Snoyman", "link": "https://stackoverflow.com/users/369198/michael-snoyman"}, "is_accepted": true, "score": 8, "last_activity_date": 1433252365, "last_edit_date": 1433252365, "creation_date": 1433235681, "answer_id": 30591659, "question_id": 30591519, "link": "https://stackoverflow.com/questions/30591519/an-executable-that-contains-data/30591659#30591659", "title": "An executable that contains data", "body": "<p>You can do this using Template Haskell. Check out the <a href=\"https://hackage.haskell.org/package/file-embed\" rel=\"nofollow\">file-embed</a> package.</p>\n"}], "owner": {"reputation": 713, "user_id": 2123737, "user_type": "registered", "accept_rate": 82, "profile_image": "https://www.gravatar.com/avatar/319770365a555574de7b3994c63c3c27?s=128&d=identicon&r=PG", "display_name": "Syd Kerckhove", "link": "https://stackoverflow.com/users/2123737/syd-kerckhove"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 90, "favorite_count": 2, "accepted_answer_id": 30591659, "answer_count": 1, "score": 6, "last_activity_date": 1433252365, "creation_date": 1433235290, "question_id": 30591519, "link": "https://stackoverflow.com/questions/30591519/an-executable-that-contains-data", "title": "An executable that contains data", "body": "<p>I've been thinking about a way to deploy configurations on a linux system,\nSpecifically dotfiles.</p>\n\n<p>I would really like to somehow compile all the dotfiles into one executable that, when executed, deploys them in the right place.\nHere comes the tricky part: the files are <em>not</em> available on the system where the executable is to be executed and I only want to 'ship' the executable. Nothing else.</p>\n\n<p>Is there a way to put the files into the executable, so that they can be safely extracted later?</p>\n\n<p>(I'm trying to build this in Haskell, but any language will do for the POC.))</p>\n"}, {"tags": ["haskell", "list-comprehension"], "answers": [{"tags": [], "owner": {"reputation": 81337, "user_id": 91757, "user_type": "registered", "accept_rate": 85, "profile_image": "https://www.gravatar.com/avatar/afaf752cb41c3968dbd570c6f6fa0dc3?s=128&d=identicon&r=PG", "display_name": "Frerich Raabe", "link": "https://stackoverflow.com/users/91757/frerich-raabe"}, "is_accepted": true, "score": 8, "last_activity_date": 1433233718, "creation_date": 1433233718, "answer_id": 30590996, "question_id": 30590909, "link": "https://stackoverflow.com/questions/30590909/haskell-grouping-list-elements-by-fst/30590996#30590996", "title": "Haskell grouping list elements by fst", "body": "<p>You can do this using <a href=\"http://hackage.haskell.org/package/base-4.8.0.0/docs/Data-List.html#v:groupBy\"><code>groupBy</code></a></p>\n\n<pre><code>\u03bb: groupBy (\\x y -&gt; fst x == fst y) [(1,1),(1,2),(2,1),(2,2),(2,3)]\n[[(1,1),(1,2)],[(2,1),(2,2),(2,3)]]\n</code></pre>\n\n<p>The <a href=\"http://hackage.haskell.org/package/base-4.8.0.0/docs/Data-Function.html#v:on\"><code>on</code></a> function is useful here to shorten the code a bit without obfuscating it:</p>\n\n<pre><code>\u03bb: groupBy ((==) `on` fst) [(1,1),(1,2),(2,1),(2,2),(2,3)]\n[[(1,1),(1,2)],[(2,1),(2,2),(2,3)]]\n</code></pre>\n"}], "owner": {"reputation": 368, "user_id": 4204160, "user_type": "registered", "accept_rate": 81, "profile_image": "https://www.gravatar.com/avatar/62550e8dec6bd6a777fe3c0013b820df?s=128&d=identicon&r=PG&f=1", "display_name": "Marcin", "link": "https://stackoverflow.com/users/4204160/marcin"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 594, "favorite_count": 0, "accepted_answer_id": 30590996, "answer_count": 1, "score": 4, "last_activity_date": 1433233718, "creation_date": 1433233398, "question_id": 30590909, "link": "https://stackoverflow.com/questions/30590909/haskell-grouping-list-elements-by-fst", "title": "Haskell grouping list elements by fst", "body": "<p>I'm trying to write a function </p>\n\n<pre><code>group::[(Int, Int)]-&gt;[[(Int, Int)]]\n</code></pre>\n\n<p>that would group elements of a list of tuples into subgroups dependant on the first coordinate, ie:</p>\n\n<pre><code>group [(1,1),(1,2),(2,1),(2,2),(2,3)]\n</code></pre>\n\n<p>should result in</p>\n\n<pre><code>[[(1,1),(1,2)],[(2,1),(2,2),(2,3)]]\n</code></pre>\n\n<p>I'd imagine list comprehension is the way, but I'm a bit stuck.. Could someone provide an advice/solution?</p>\n\n<p>PS the function could also take as an argument the maximum the first coordinate can take, if that would be of any help</p>\n"}, {"tags": ["haskell", "yesod"], "answers": [{"tags": [], "owner": {"reputation": 620, "user_id": 2576287, "user_type": "registered", "accept_rate": 56, "profile_image": "https://lh5.googleusercontent.com/-VegFz4P9Ovc/AAAAAAAAAAI/AAAAAAAAATo/Z-69W9rBCno/photo.jpg?sz=128", "display_name": "mrLSD", "link": "https://stackoverflow.com/users/2576287/mrlsd"}, "is_accepted": true, "score": 0, "last_activity_date": 1433357092, "creation_date": 1433357092, "answer_id": 30628185, "question_id": 30590540, "link": "https://stackoverflow.com/questions/30590540/yesod-errors-when-compiling/30628185#30628185", "title": "Yesod errors when compiling", "body": "<p><strong>1 -  Double example - set default value at field and for whole personeForm:</strong></p>\n\n<pre><code>data Person = Person \n    { name  ::  Text\n    , age   :: Maybe Int\n    }\n\npersoneForm :: Maybe Person -&gt; AForm Handler Person\npersoneForm person = Person\n    &lt;$&gt; areq textField \"Persone Name\" (name &lt;$&gt; person)\n    &lt;*&gt; aopt intField \"Persone Age\" (Just (Just 24))\n\n\ngetAformPersonR :: Handler Html\ngetAformPersonR = do\n    let person = Person \"Jack\" Nothing\n    (formWidget, formEnctype) &lt;- generateFormPost $ renderDivs $ personeForm $ Just person\n\n    defaultLayout $ do\n        $(widgetFile \"aformpersone\")\n</code></pre>\n\n<p><strong>2,3 - Not in scope:</strong></p>\n\n<p>You used same template for Get ang Post functions. And for that functions you should init same values.</p>\n"}], "owner": {"reputation": 15, "user_id": 4964236, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/a3b9bc2798abfc89b1de938e05ba05e0?s=128&d=identicon&r=PG&f=1", "display_name": "John Do", "link": "https://stackoverflow.com/users/4964236/john-do"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 56, "favorite_count": 0, "accepted_answer_id": 30628185, "answer_count": 1, "score": -1, "last_activity_date": 1433357092, "creation_date": 1433232019, "question_id": 30590540, "link": "https://stackoverflow.com/questions/30590540/yesod-errors-when-compiling", "title": "Yesod errors when compiling", "body": "<p>For AForm I have got some compile errors:</p>\n\n<p><strong>1. For default Int value:</strong></p>\n\n<pre><code>data Person = Person\n    { name  :: Text\n    , age   :: Maybe Int\n    }\n    deriving Show\n\nformPerson :: AForm Handler Person\nformPerson = Person\n    &lt;$&gt; areq textField \"Person Name\" Nothing\n    &lt;*&gt; aopt intField \"Person Age\" (Just 25)\n</code></pre>\n\n<p>Error  message:</p>\n\n<pre><code>No instance for (Num (Maybe Int)) arising from the literal \u201825\u2019\nIn the first argument of \u2018Just\u2019, namely \u201825\u2019\nIn the third argument of \u2018aopt\u2019, namely \u2018(Just 25)\u2019\nIn the second argument of \u2018(&lt;*&gt;)\u2019, namely\n  \u2018aopt intField \"Person Age\" (Just 25)\u2019\n</code></pre>\n\n<p><strong>2. Error at template:</strong>\ngetPersonR :: Handler Html</p>\n\n<pre><code>getPersonR = do\n    let myAge = 25::Int\n    defaultLayout $ do\n        $(widgetFile \"persone\")\n</code></pre>\n\n<p>And at template:</p>\n\n<pre><code>&lt;span&gt;My age: #{myAge}\n</code></pre>\n\n<p>End error:</p>\n\n<pre><code>Not in scope: \u2018myAge\u2019\nIn the splice: $(widgetFile \"persone\")\n</code></pre>\n\n<p><strong>3. Error at result:</strong></p>\n\n<pre><code>postPersonR :: Handler Html\npostPersonR = do\n    ((result, formWidget), formEnctype) &lt;- runFormPost formPerson\n    let title = \"Success!\"::Html\n    case result of\n        FormSuccess person -&gt;\n            defaultLayout $ do\n                setTitle title\n                $(widgetFile \"personresult\")\n        _ -&gt; \n            defaultLayout $ do\n                $(widgetFile \"person\")\n</code></pre>\n\n<p>and Template:</p>\n\n<pre><code>&lt;strong&gt;Your name: #{name person}\n</code></pre>\n\n<p>And error:</p>\n\n<pre><code>Couldn't match expected type \u2018Person -&gt; a0\u2019\n            with actual type \u2018blaze-markup-0.6.1.1:Text.Blaze.Internal.MarkupM\n                                ()\u2019\nThe function \u2018name\u2019 is applied to one argument,\nbut its type \u2018Html\u2019 has none\nIn the first argument of \u2018toHtml\u2019, namely \u2018name person\u2019\nIn the first argument of \u2018asWidgetT GHC.Base.. toWidget\u2019, namely\n  \u2018toHtml (name person)\u2019\n</code></pre>\n\n<p>How to fix issues?</p>\n"}, {"tags": ["haskell"], "comments": [{"owner": {"reputation": 46235, "user_id": 2541573, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/Z1qtP.png?s=128&g=1", "display_name": "jub0bs", "link": "https://stackoverflow.com/users/2541573/jub0bs"}, "edited": false, "score": 2, "creation_date": 1433224870, "post_id": 30588221, "comment_id": 49246011, "body": "Do you have to write your own function for that? <code>Data.List</code>&#39;s<code>isInfixOf</code> already provides this functionality (for lists that are instances of <code>Eq, not just for </code>String<code>s</code>)."}, {"owner": {"reputation": 837, "user_id": 4072022, "user_type": "registered", "accept_rate": 88, "profile_image": "https://www.gravatar.com/avatar/2b8d2b1ab1299eb31efacc0843964517?s=128&d=identicon&r=PG&f=1", "display_name": "Rumen Hristov", "link": "https://stackoverflow.com/users/4072022/rumen-hristov"}, "reply_to_user": {"reputation": 46235, "user_id": 2541573, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/Z1qtP.png?s=128&g=1", "display_name": "jub0bs", "link": "https://stackoverflow.com/users/2541573/jub0bs"}, "edited": false, "score": 0, "creation_date": 1433225997, "post_id": 30588221, "comment_id": 49246521, "body": "yes. I do. Can not use libraries"}], "answers": [{"comments": [{"owner": {"reputation": 4773, "user_id": 4148211, "user_type": "registered", "accept_rate": 55, "profile_image": "https://i.stack.imgur.com/DiKJf.jpg?s=128&g=1", "display_name": "frasertweedale", "link": "https://stackoverflow.com/users/4148211/frasertweedale"}, "edited": false, "score": 0, "creation_date": 1433226597, "post_id": 30588782, "comment_id": 49246809, "body": "Note that your argument order is flipped w.r.t. the question (but I favour this order)."}, {"owner": {"user_type": "does_not_exist", "display_name": "user1812457"}, "reply_to_user": {"reputation": 4773, "user_id": 4148211, "user_type": "registered", "accept_rate": 55, "profile_image": "https://i.stack.imgur.com/DiKJf.jpg?s=128&g=1", "display_name": "frasertweedale", "link": "https://stackoverflow.com/users/4148211/frasertweedale"}, "edited": false, "score": 0, "creation_date": 1433226700, "post_id": 30588782, "comment_id": 49246870, "body": "@frasertweedale Yep, this was on purpose. Thank you for pointing out."}, {"owner": {"reputation": 837, "user_id": 4072022, "user_type": "registered", "accept_rate": 88, "profile_image": "https://www.gravatar.com/avatar/2b8d2b1ab1299eb31efacc0843964517?s=128&d=identicon&r=PG&f=1", "display_name": "Rumen Hristov", "link": "https://stackoverflow.com/users/4072022/rumen-hristov"}, "edited": false, "score": 0, "creation_date": 1433226787, "post_id": 30588782, "comment_id": 49246934, "body": "xs marks the substring and ys marks the string I guess?"}, {"owner": {"user_type": "does_not_exist", "display_name": "user1812457"}, "reply_to_user": {"reputation": 837, "user_id": 4072022, "user_type": "registered", "accept_rate": 88, "profile_image": "https://www.gravatar.com/avatar/2b8d2b1ab1299eb31efacc0843964517?s=128&d=identicon&r=PG&f=1", "display_name": "Rumen Hristov", "link": "https://stackoverflow.com/users/4072022/rumen-hristov"}, "edited": false, "score": 1, "creation_date": 1433226852, "post_id": 30588782, "comment_id": 49246965, "body": "@RumenHristov At that point it should be obvious :) but yes"}, {"owner": {"reputation": 4773, "user_id": 4148211, "user_type": "registered", "accept_rate": 55, "profile_image": "https://i.stack.imgur.com/DiKJf.jpg?s=128&g=1", "display_name": "frasertweedale", "link": "https://stackoverflow.com/users/4148211/frasertweedale"}, "edited": false, "score": 0, "creation_date": 1433226888, "post_id": 30588782, "comment_id": 49246995, "body": "Use of <code>tail</code> causes empty list exception."}, {"owner": {"user_type": "does_not_exist", "display_name": "user1812457"}, "reply_to_user": {"reputation": 4773, "user_id": 4148211, "user_type": "registered", "accept_rate": 55, "profile_image": "https://i.stack.imgur.com/DiKJf.jpg?s=128&g=1", "display_name": "frasertweedale", "link": "https://stackoverflow.com/users/4148211/frasertweedale"}, "edited": false, "score": 0, "creation_date": 1433227227, "post_id": 30588782, "comment_id": 49247191, "body": "@frasertweedale yes, indeed. It should be correct now... is there a better way to do it? (Haskell is not my greatest strength :) )"}, {"owner": {"reputation": 837, "user_id": 4072022, "user_type": "registered", "accept_rate": 88, "profile_image": "https://www.gravatar.com/avatar/2b8d2b1ab1299eb31efacc0843964517?s=128&d=identicon&r=PG&f=1", "display_name": "Rumen Hristov", "link": "https://stackoverflow.com/users/4072022/rumen-hristov"}, "edited": false, "score": 0, "creation_date": 1433227297, "post_id": 30588782, "comment_id": 49247227, "body": "this is interesting. I learned something, I guess I can call obvious but not so apparant at the same time. Just testing a few things and then will give credit."}, {"owner": {"reputation": 837, "user_id": 4072022, "user_type": "registered", "accept_rate": 88, "profile_image": "https://www.gravatar.com/avatar/2b8d2b1ab1299eb31efacc0843964517?s=128&d=identicon&r=PG&f=1", "display_name": "Rumen Hristov", "link": "https://stackoverflow.com/users/4072022/rumen-hristov"}, "edited": false, "score": 0, "creation_date": 1433232280, "post_id": 30588782, "comment_id": 49250041, "body": "this always produces &quot;False&quot;"}, {"owner": {"user_type": "does_not_exist", "display_name": "user1812457"}, "reply_to_user": {"reputation": 837, "user_id": 4072022, "user_type": "registered", "accept_rate": 88, "profile_image": "https://www.gravatar.com/avatar/2b8d2b1ab1299eb31efacc0843964517?s=128&d=identicon&r=PG&f=1", "display_name": "Rumen Hristov", "link": "https://stackoverflow.com/users/4072022/rumen-hristov"}, "edited": false, "score": 0, "creation_date": 1433232558, "post_id": 30588782, "comment_id": 49250210, "body": "@RumenHristov Not on my computer.... <code>*Main&gt; substring &quot;in&quot; &quot;bring&quot; True</code>"}, {"owner": {"reputation": 837, "user_id": 4072022, "user_type": "registered", "accept_rate": 88, "profile_image": "https://www.gravatar.com/avatar/2b8d2b1ab1299eb31efacc0843964517?s=128&d=identicon&r=PG&f=1", "display_name": "Rumen Hristov", "link": "https://stackoverflow.com/users/4072022/rumen-hristov"}, "edited": false, "score": 0, "creation_date": 1433232860, "post_id": 30588782, "comment_id": 49250353, "body": "My bad. I had the order of the arguments backwards."}, {"owner": {"reputation": 100185, "user_id": 3234959, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/93bb12ca0f93dfddb33880316f7e66c2?s=128&d=identicon&r=PG&f=1", "display_name": "chi", "link": "https://stackoverflow.com/users/3234959/chi"}, "edited": false, "score": 0, "creation_date": 1433236029, "post_id": 30588782, "comment_id": 49252330, "body": "I&#39;d use <code>substring xs ys = prefix xs ys || substring xs (tail ys)</code> for the last case."}, {"owner": {"user_type": "does_not_exist", "display_name": "user1812457"}, "reply_to_user": {"reputation": 100185, "user_id": 3234959, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/93bb12ca0f93dfddb33880316f7e66c2?s=128&d=identicon&r=PG&f=1", "display_name": "chi", "link": "https://stackoverflow.com/users/3234959/chi"}, "edited": false, "score": 0, "creation_date": 1433236291, "post_id": 30588782, "comment_id": 49252487, "body": "@chi The last case of what do you exactly mean?"}, {"owner": {"reputation": 100185, "user_id": 3234959, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/93bb12ca0f93dfddb33880316f7e66c2?s=128&d=identicon&r=PG&f=1", "display_name": "chi", "link": "https://stackoverflow.com/users/3234959/chi"}, "edited": false, "score": 0, "creation_date": 1433239839, "post_id": 30588782, "comment_id": 49254762, "body": "In the definition of <code>substring</code> there&#39;s a first case <code>substring (x:xs) [] = False</code>, and a second case for the rest."}], "tags": [], "owner": {"user_type": "does_not_exist", "display_name": "user1812457"}, "is_accepted": true, "score": 6, "last_activity_date": 1573492353, "last_edit_date": 1573492353, "creation_date": 1433226157, "answer_id": 30588782, "question_id": 30588221, "link": "https://stackoverflow.com/questions/30588221/check-a-string-if-it-contains-a-given-substring-and-return-boolean/30588782#30588782", "title": "Check a string if it contains a given substring and return BOOLEAN", "body": "<p>A straight-forward implementation that does not use libraries or cool tricks at all could be:</p>\n\n<pre><code>substring :: String -&gt; String -&gt; Bool\nsubstring (_:_) [] = False\nsubstring xs ys\n    | prefix xs ys = True\n    | substring xs (tail ys) = True\n    | otherwise = False\n\nprefix :: String -&gt; String -&gt; Bool\nprefix [] _ = True\nprefix (_:_) [] = False\nprefix (x:xs) (y:ys) = (x == y) &amp;&amp; prefix xs ys\n</code></pre>\n\n<p>This is the \"canonical\" way for naive substring search (in any programming language I guess?): for every suffix of a string, you check if the substring is a prefix.</p>\n\n<p>Note that the substring argument comes before the string.</p>\n"}, {"comments": [{"owner": {"reputation": 837, "user_id": 4072022, "user_type": "registered", "accept_rate": 88, "profile_image": "https://www.gravatar.com/avatar/2b8d2b1ab1299eb31efacc0843964517?s=128&d=identicon&r=PG&f=1", "display_name": "Rumen Hristov", "link": "https://stackoverflow.com/users/4072022/rumen-hristov"}, "edited": false, "score": 0, "creation_date": 1433228330, "post_id": 30589153, "comment_id": 49247788, "body": "Yaa, I know the base cases can be simplified a bit. That&#39;s how I had it at first, but then I chose to write them all out explicitly."}, {"owner": {"reputation": 837, "user_id": 4072022, "user_type": "registered", "accept_rate": 88, "profile_image": "https://www.gravatar.com/avatar/2b8d2b1ab1299eb31efacc0843964517?s=128&d=identicon&r=PG&f=1", "display_name": "Rumen Hristov", "link": "https://stackoverflow.com/users/4072022/rumen-hristov"}, "edited": false, "score": 0, "creation_date": 1433231626, "post_id": 30589153, "comment_id": 49249671, "body": "This works, but even now it doesn&#39;t really work as per specs, because it needs to only return true if the substring is included as it is in the original string. IE: check &quot;the cat is gone&quot; &quot;tg&quot; will result true because the g in gone follows the t in cat. However it should only come to true if &quot;tg&quot; appears exactly as that in the original string."}, {"owner": {"reputation": 25744, "user_id": 2089675, "user_type": "registered", "accept_rate": 80, "profile_image": "https://i.stack.imgur.com/sBz5q.jpg?s=128&g=1", "display_name": "smac89", "link": "https://stackoverflow.com/users/2089675/smac89"}, "reply_to_user": {"reputation": 837, "user_id": 4072022, "user_type": "registered", "accept_rate": 88, "profile_image": "https://www.gravatar.com/avatar/2b8d2b1ab1299eb31efacc0843964517?s=128&d=identicon&r=PG&f=1", "display_name": "Rumen Hristov", "link": "https://stackoverflow.com/users/4072022/rumen-hristov"}, "edited": false, "score": 0, "creation_date": 1433233204, "post_id": 30589153, "comment_id": 49250540, "body": "@RumenHristov, fixed"}], "tags": [], "owner": {"reputation": 25744, "user_id": 2089675, "user_type": "registered", "accept_rate": 80, "profile_image": "https://i.stack.imgur.com/sBz5q.jpg?s=128&g=1", "display_name": "smac89", "link": "https://stackoverflow.com/users/2089675/smac89"}, "is_accepted": false, "score": 3, "last_activity_date": 1433233134, "last_edit_date": 1433233134, "creation_date": 1433227459, "answer_id": 30589153, "question_id": 30588221, "link": "https://stackoverflow.com/questions/30588221/check-a-string-if-it-contains-a-given-substring-and-return-boolean/30589153#30589153", "title": "Check a string if it contains a given substring and return BOOLEAN", "body": "<p>Reason it is not working is because you only seem to be matching on the first character of the second string:</p>\n\n<pre><code>check::[Char]-&gt;[Char]-&gt;Bool\ncheck [][]              =False\ncheck _[]               =False\ncheck []_               =False\ncheck(x:xs)(y:ys)\n | y == x               =True -- this line\n | otherwise            =check xs (y:ys)\n\nmain = do\nprint $ check \"bring\" \"in\"\n</code></pre>\n\n<p>Fix it by doing:</p>\n\n<pre><code>check::[Char]-&gt;[Char]-&gt;Bool\ncheck l s = check' l s True where\n    check' _ [] h          = True\n    check' [] _ h          = False\n    check' (x:xs) (y:ys) h = (y == x &amp;&amp; check' xs ys False) || (h &amp;&amp; check' xs (y:ys) h)\n\nmain = do\nprint $ check \"bring\" \"in\"\n</code></pre>\n\n<p>Also note as previously pointed out that an empty string is a subset of itself and any non-empty string. The extra boolean is to quickly eliminate the current search and start at the substring again</p>\n\n<p>Finally to be a good programmer, we can make this generic by doing this:</p>\n\n<pre><code>check::Eq a =&gt; [a]-&gt;[a]-&gt;Bool\ncheck l s = check' l s True where\n    check' _ [] h          = True\n    check' [] _ h          = False\n    check' (x:xs) (y:ys) h = (y == x &amp;&amp; check' xs ys False) || (h &amp;&amp; check' xs (y:ys) h)\n\nmain = do\nprint $ check \"bring\" \"in\"\n</code></pre>\n"}], "owner": {"reputation": 837, "user_id": 4072022, "user_type": "registered", "accept_rate": 88, "profile_image": "https://www.gravatar.com/avatar/2b8d2b1ab1299eb31efacc0843964517?s=128&d=identicon&r=PG&f=1", "display_name": "Rumen Hristov", "link": "https://stackoverflow.com/users/4072022/rumen-hristov"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 12192, "favorite_count": 1, "closed_date": 1433251400, "accepted_answer_id": 30588782, "answer_count": 2, "score": 4, "last_activity_date": 1573492353, "creation_date": 1433223855, "last_edit_date": 1433225921, "question_id": 30588221, "link": "https://stackoverflow.com/questions/30588221/check-a-string-if-it-contains-a-given-substring-and-return-boolean", "closed_reason": "Duplicate", "title": "Check a string if it contains a given substring and return BOOLEAN", "body": "<p>I am trying to come up with a haskell function that takes 2 string parameters. Then it checks to see if the 1st string contains the second string as a substring. For instance: \"bring\" contains the substring \"in\". If passed \"bring\" \"in\", the function should return true. Here is what I have so far, but it doesn't really work. Works partially. I don't know how to assign a true value in the recursive cases.</p>\n\n<pre><code>check::[Char]-&gt;[Char]-&gt;Bool\ncheck [][]              =False\ncheck _[]               =False\ncheck []_               =False\ncheck(x:xs)(y:ys)\n | y==x                 =True\n | otherwise            =check xs (y:ys)\n\nmain = do\nprint $ check \"bring\" \"in\"\n</code></pre>\n"}, {"tags": ["haskell", "stack-overflow", "ghci"], "comments": [{"owner": {"reputation": 165, "user_id": 4485049, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/626f8645e9e35a2ad579b6dcf716e77d?s=128&d=identicon&r=PG&f=1", "display_name": "peter a g", "link": "https://stackoverflow.com/users/4485049/peter-a-g"}, "edited": false, "score": 0, "creation_date": 1433732175, "post_id": 30586656, "comment_id": 49459347, "body": "As I wrote above, I am indebted to both Carsten and Reid, but I am going to credit Reid&#39;s Socratic question..."}], "answers": [{"comments": [{"owner": {"reputation": 48129, "user_id": 76051, "user_type": "registered", "accept_rate": 91, "profile_image": "https://i.stack.imgur.com/AGDxz.jpg?s=128&g=1", "display_name": "Carsten", "link": "https://stackoverflow.com/users/76051/carsten"}, "edited": false, "score": 1, "creation_date": 1433221717, "post_id": 30587138, "comment_id": 49244817, "body": "that&#39;s not it - this will be easy because if you pattern match on <code>[1..]</code> you will get <code>1 : _</code> at once"}, {"owner": {"reputation": 14485, "user_id": 190376, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/cd8280c5e1491b8cf55760750ed97dec?s=128&d=identicon&r=PG", "display_name": "Reid Barton", "link": "https://stackoverflow.com/users/190376/reid-barton"}, "reply_to_user": {"reputation": 48129, "user_id": 76051, "user_type": "registered", "accept_rate": 91, "profile_image": "https://i.stack.imgur.com/AGDxz.jpg?s=128&g=1", "display_name": "Carsten", "link": "https://stackoverflow.com/users/76051/carsten"}, "edited": false, "score": 0, "creation_date": 1433252833, "post_id": 30587138, "comment_id": 49264305, "body": "Maybe I assumed too much of the reader. If you try to show that <code>perms [1..]</code> is nonempty, you will soon find yourself needing to know whether <code>perms [2..]</code> is nonempty. That is the loop which makes <code>perms [1..] = _|_</code>."}, {"owner": {"reputation": 48129, "user_id": 76051, "user_type": "registered", "accept_rate": 91, "profile_image": "https://i.stack.imgur.com/AGDxz.jpg?s=128&g=1", "display_name": "Carsten", "link": "https://stackoverflow.com/users/76051/carsten"}, "edited": false, "score": 0, "creation_date": 1433254286, "post_id": 30587138, "comment_id": 49265538, "body": "ok sorry - I thought you was hinting at the pattern-match for <code>[]</code> (the empty list - yeah sorry: <i>nonempty</i> is something different) - maybe you should (have?) explain(ed) it a bit more"}], "tags": [], "owner": {"reputation": 14485, "user_id": 190376, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/cd8280c5e1491b8cf55760750ed97dec?s=128&d=identicon&r=PG", "display_name": "Reid Barton", "link": "https://stackoverflow.com/users/190376/reid-barton"}, "is_accepted": true, "score": 2, "last_activity_date": 1433218048, "creation_date": 1433218048, "answer_id": 30587138, "question_id": 30586656, "link": "https://stackoverflow.com/questions/30586656/why-cant-ghci-print-the-head-of-the-first-permutation-of-the-integers-calculat/30587138#30587138", "title": "why can&#39;t ghci print the head of the first permutation of the integers, calculated &#39;selection-style&#39;?", "body": "<p>How do you know that <code>perms [1..]</code> is nonempty?</p>\n"}, {"comments": [{"owner": {"reputation": 165, "user_id": 4485049, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/626f8645e9e35a2ad579b6dcf716e77d?s=128&d=identicon&r=PG&f=1", "display_name": "peter a g", "link": "https://stackoverflow.com/users/4485049/peter-a-g"}, "edited": false, "score": 0, "creation_date": 1433278373, "post_id": 30587752, "comment_id": 49280665, "body": "This seems clearly false to both you and Reid Barton below, but I expected, since  I Iet hs = map head p, ghci would not need to calculate ys  ( i.e. in conjunction with the take 1 hs).  I am obviously endowing more omniscience to the word &#39;lazy&#39; than is warranted. This is what I hadn&#39;t understood in the original post cited above."}, {"owner": {"reputation": 165, "user_id": 4485049, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/626f8645e9e35a2ad579b6dcf716e77d?s=128&d=identicon&r=PG&f=1", "display_name": "peter a g", "link": "https://stackoverflow.com/users/4485049/peter-a-g"}, "edited": false, "score": 0, "creation_date": 1433281272, "post_id": 30587752, "comment_id": 49281978, "body": "Namely - I guess this is obvious, but allow me to express my previous comment more explicitly - I thought that laziness would allow ghci NOT to calculate as much of the first term of perms [1..], when calculating take 1 $ map head p, where p = perms [1..] - in short, I guess I think laziness means &#39;left to right&#39;: take 1 =&gt; only need to calculate the first term to the right of the $, map head =&gt; only need to calculate the (first) y...  So laziness means ghci should have printed [1]. But not so!"}], "tags": [], "owner": {"reputation": 48129, "user_id": 76051, "user_type": "registered", "accept_rate": 91, "profile_image": "https://i.stack.imgur.com/AGDxz.jpg?s=128&g=1", "display_name": "Carsten", "link": "https://stackoverflow.com/users/76051/carsten"}, "is_accepted": false, "score": 4, "last_activity_date": 1433304987, "last_edit_date": 1433304987, "creation_date": 1433221534, "answer_id": 30587752, "question_id": 30586656, "link": "https://stackoverflow.com/questions/30586656/why-cant-ghci-print-the-head-of-the-first-permutation-of-the-integers-calculat/30587752#30587752", "title": "why can&#39;t ghci print the head of the first permutation of the integers, calculated &#39;selection-style&#39;?", "body": "<p>well let's see what it has to do (let's use the GHCi debugger)</p>\n\n<pre><code>\u03bb&gt; :break perms\nBreakpoint 0 activated...\n\u03bb&gt; perms [1..]\nStopped at perms\n\u03bb&gt; :step\nStopped at RHS perms xxs\nxxs :: [Integer] = 1 : _\n\u03bb&gt; :step\nStopped at RHS perms xxs (comprehension)\nxxs :: [Integer] = 1 : _\n\u03bb&gt; :step\nStopped at pix\n\u03bb&gt; :step\nStopped at RHS pix (x:xs)\nx :: Integer = 1\nxs :: [Integer] = _\n\u03bb&gt; :step\nStopped at RHS perms xxs (comprehension)\nxs :: [t] = _\n\u03bb&gt; :step\nStopped at perms\n\u03bb&gt; :step\nStopped at rhs perms xxs\n_result :: [[Integer]] = _\nxxs :: [Integer] = 2 : _\n...\n</code></pre>\n\n<p>I have tried to translate the position a bit and I removed all but the last <code>_result</code> (there you see that it still not in any WHNF for a list)</p>\n\n<p>The important line is the last one: Can you see that you stepped into the same line as at the beginning but now with the tail of your your infinite list? </p>\n\n<p>That's because you draw <code>ys &lt;- perms xs</code> and if you go on you will see <code>xxs = 3 : _</code> ... </p>\n\n<p>In the end you will have to traverse all of the list before you get any result - which is of course impossible here.</p>\n\n<h3>remarks</h3>\n\n<p><code>take 1 $ perm [1..]</code> will not change anything here as it has to evaluate the result of the above expression to a point where it gets <code>_:_</code> or <code>[]</code> but as you can see it never does - of course you can check yourself if you add something like</p>\n\n<pre><code>first () = take 1 $ perms [1..]\n</code></pre>\n\n<p>and then do</p>\n\n<pre><code>:break first\nfirst ()\n: step\n</code></pre>\n\n<p>in ghci - I think it is a fun way to explore a bit - although it can be a bit tedious</p>\n\n<h3>answer to your comment</h3>\n\n<p>lazy is no easy concept yes and in principle your reasoning is not bad - but both <code>take</code> and <code>map</code> need to deconstruct the given list into something like <code>_:_</code>, now this means that you need see at least the <code>(:)</code> constructor of the list (or <code>[]</code> for that matter) - but here (as I tried to show you with the debug-session) the <strong>chunk</strong> of the list never reaches this state (it<code>s the</code>_result` part) - that is no <em>problem</em> with laziness in Haskell but with your algorithm / the implementation details of your algorithm.</p>\n\n<p>To see that it <strong>can</strong> work you only need to have a look at <a href=\"https://hackage.haskell.org/package/base-4.8.0.0/docs/Data-List.html#v:permutations\" rel=\"nofollow\"><code>permutations</code></a> in the <code>Data.List</code> - if you try to run your code with this it will work just fine:</p>\n\n<pre><code>\u03bb&gt; import Data.List (permutations)\n\n\u03bb&gt; map head . take 1 $ permutations [1..]\n[1]\n\u03bb&gt; \n</code></pre>\n\n<p>so does this:</p>\n\n<pre><code>\u03bb&gt; import Data.List (permutations)\n\n\u03bb&gt; take 1 $ permutations [1..]\n</code></pre>\n\n<p>but of course this will continue printing till the end of time (memory, whatever)</p>\n\n<p>In case you are interested you can have a look at the <a href=\"https://hackage.haskell.org/package/base-4.8.0.0/docs/src/Data-OldList.html#permutations\" rel=\"nofollow\">implementation of <code>permutations</code></a> too.</p>\n"}], "owner": {"reputation": 165, "user_id": 4485049, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/626f8645e9e35a2ad579b6dcf716e77d?s=128&d=identicon&r=PG&f=1", "display_name": "peter a g", "link": "https://stackoverflow.com/users/4485049/peter-a-g"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 121, "favorite_count": 0, "accepted_answer_id": 30587138, "answer_count": 2, "score": 2, "last_activity_date": 1433732054, "creation_date": 1433214389, "last_edit_date": 1495541155, "question_id": 30586656, "link": "https://stackoverflow.com/questions/30586656/why-cant-ghci-print-the-head-of-the-first-permutation-of-the-integers-calculat", "title": "why can&#39;t ghci print the head of the first permutation of the integers, calculated &#39;selection-style&#39;?", "body": "<p>This no doubt moronic question is inspired from \n<a href=\"https://stackoverflow.com/questions/24484348/what-does-this-list-permutations-implementation-in-haskell-exactly-do\">What does this list permutations implementation in Haskell exactly do?</a></p>\n\n<p>Suppose</p>\n\n<pre><code>perms [] = [[]]\nperms xxs = [ (y:ys) | ( y, xs ) &lt;- pix xxs , ys &lt;- perms xs ]\n\n--where\npix [] = []\npix ( x:xs ) = ( x , xs ) : [ ( y, x : ys ) | ( y, ys ) &lt;- pix xs ]\n</code></pre>\n\n<p>Twan van Laarhoven writes \"the first thing this function does is pick the first element from the entire list, which is not lazy at all.\" OK - sure ! But I am confused -</p>\n\n<p>I do not understand why ghci does the following:</p>\n\n<pre><code>*Main&gt; let p = perms [1..]\n*Main&gt; let hs = map head p\n*Main&gt; take 1 hs\n*** Exception: stack overflow\n</code></pre>\n\n<p>Why can't ghci print [1]?</p>\n\n<p>Sigh...</p>\n\n<p>peter</p>\n\n<p>Comment on Answers:</p>\n\n<p>As I said in my replies to Carsten's answer, I had 'reasoned' that my</p>\n\n<pre><code>*Main&gt; let hs = map head p\n*Main&gt; take 1 hs\n</code></pre>\n\n<p>along with Haskell's laziness, would allow ghci not to calculate the ys in (y:ys) in perms, since the above only 'wanted' the value of the first 'y'; in short I was arguing that I was not really calculating the first term of perms [1..] at all.\nBut, as both Carsten and Reid Barton in effect point out below, laziness is besides the point, and my argument was wrong.</p>\n\n<p>To add to (and, I hope, not mangle) their answers, if </p>\n\n<pre><code>   ans = take 1 hs\n</code></pre>\n\n<p>then, because of the list comprehension in the definition of perms,</p>\n\n<pre><code>   ans is in the image of some function from the Cartesian product \n                            (pix [1..]) X perms [2..].\n</code></pre>\n\n<p>But how do I know that the Cartesian product, the domain of my function, is not the empty set? For, otherwise, ans does not exist... ( i.e., how do I know that the first term of perms[1..] exists? Or, as Reid Barton more succinctly put it, how do I know that perms [1..] is not empty?)</p>\n\n<p>The product is not empty if and only each factor is not empty. I know that the first is not empty (inspection!) - but how do I know that the perms [2..] factor is not empty?  Oh - alas, by recursion, I am dead.    </p>\n"}, {"tags": ["haskell", "web-crawler", "monads"], "comments": [{"owner": {"reputation": 44013, "user_id": 1477667, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/trgKM.jpg?s=128&g=1", "display_name": "dfeuer", "link": "https://stackoverflow.com/users/1477667/dfeuer"}, "edited": false, "score": 1, "creation_date": 1433216451, "post_id": 30584526, "comment_id": 49243168, "body": "BTW, <code>Data.Char</code> offers <code>isDigit</code>, which is more convenient efficient than defining your own that way."}, {"owner": {"reputation": 45, "user_id": 4962591, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/4fe672ee80daeb46897d8d08b14b70dc?s=128&d=identicon&r=PG&f=1", "display_name": "Gunther Rocket", "link": "https://stackoverflow.com/users/4962591/gunther-rocket"}, "edited": false, "score": 0, "creation_date": 1433245837, "post_id": 30584526, "comment_id": 49258843, "body": "Ah thanks, I didn&#39;t know that function exists."}, {"owner": {"reputation": 100892, "user_id": 745903, "user_type": "registered", "accept_rate": 74, "profile_image": "https://www.gravatar.com/avatar/50933f6638836741e620669b3940410e?s=128&d=identicon&r=PG", "display_name": "leftaroundabout", "link": "https://stackoverflow.com/users/745903/leftaroundabout"}, "edited": false, "score": 0, "creation_date": 1433452327, "post_id": 30584526, "comment_id": 49371425, "body": "@GuntherRocket: even if it didn&#39;t exist, you could have just inlined it: <code>getResultCounter search = read $ filter (`elem`&quot;0123456789&quot;) $ L.unpack parse</code>. No need to define it on the top level!"}], "answers": [{"comments": [{"owner": {"reputation": 45, "user_id": 4962591, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/4fe672ee80daeb46897d8d08b14b70dc?s=128&d=identicon&r=PG&f=1", "display_name": "Gunther Rocket", "link": "https://stackoverflow.com/users/4962591/gunther-rocket"}, "edited": false, "score": 0, "creation_date": 1433245668, "post_id": 30584764, "comment_id": 49258731, "body": "Thanks! It works now. I already tried something similar but I missed the mapM and thought id have to change all the functions that work with the ByteString. Anyway, now I understand monads a bit more."}], "tags": [], "owner": {"reputation": 100185, "user_id": 3234959, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/93bb12ca0f93dfddb33880316f7e66c2?s=128&d=identicon&r=PG&f=1", "display_name": "chi", "link": "https://stackoverflow.com/users/3234959/chi"}, "is_accepted": true, "score": 16, "last_activity_date": 1433200397, "last_edit_date": 1433200397, "creation_date": 1433200005, "answer_id": 30584764, "question_id": 30584526, "link": "https://stackoverflow.com/questions/30584526/how-can-i-get-the-value-of-a-monad-without-system-io-unsafe/30584764#30584764", "title": "How can I get the value of a Monad without System.IO.Unsafe?", "body": "<p>This is a <em>lie</em>:</p>\n\n<pre><code>getResultCounter :: String -&gt; Integer\n</code></pre>\n\n<p>The type signature above is promising that the resulting integer only depends on the input string, when this is not the case: Google can add/remove results from one call to the other, affecting the output.</p>\n\n<p>Making the type more honest, we get</p>\n\n<pre><code>getResultCounter :: String -&gt; IO Integer\n</code></pre>\n\n<p>This honestly admits it's going to interact with the external world. The code then is easily adapted to:</p>\n\n<pre><code>getResultCounter search = do\n    let url = \"http://www.google.de/search?q=\" ++ search\n    download &lt;- simpleHttp url    -- perform IO here\n    let parse = takeByteStringUntil \"&lt;\" \n                      $ dropByteStringUntil \"id=\\\"resultStats\\\"&gt;\" download\n    return (read $ filter isNum $ L.unpack parse :: Integer)\n</code></pre>\n\n<p>Above, I tried to preserve the original structure of the code.</p>\n\n<p>Now, in <code>main</code> we can no longer do</p>\n\n<pre><code>let res = map getResultCounter searches\n</code></pre>\n\n<p>but we can do</p>\n\n<pre><code>res &lt;- mapM getResultCounter searches\n</code></pre>\n\n<p>after importing <code>Control.Monad</code>.</p>\n"}], "owner": {"reputation": 45, "user_id": 4962591, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/4fe672ee80daeb46897d8d08b14b70dc?s=128&d=identicon&r=PG&f=1", "display_name": "Gunther Rocket", "link": "https://stackoverflow.com/users/4962591/gunther-rocket"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 208, "favorite_count": 1, "closed_date": 1433452432, "accepted_answer_id": 30584764, "answer_count": 1, "score": 2, "last_activity_date": 1433200397, "creation_date": 1433198555, "last_edit_date": 1433199348, "question_id": 30584526, "link": "https://stackoverflow.com/questions/30584526/how-can-i-get-the-value-of-a-monad-without-system-io-unsafe", "closed_reason": "Duplicate", "title": "How can I get the value of a Monad without System.IO.Unsafe?", "body": "<p>I just started learning Haskell and got my first project working today. Its a small program that uses <code>Network.HTTP.Conduit</code> and <code>Graphics.Rendering.Chart</code> (<a href=\"https://github.com/timbod7/haskell-chart\" rel=\"nofollow\">haskell-chart</a>) to plot the amount of google search results for a specific question with a changing number in it.</p>\n\n<p>My problem is that <code>simple-http</code> from the conduit package returns a monad (I hope I understood the concept of monads right...), but I only want to use the ByteString inside of it, that contains the html-code of the website. So until now i use <code>download = unsafePerformIO $ simpleHttp url</code> to use it later without caring about the monad - I guess that's not the best way to do that.</p>\n\n<p>So: Is there any better solution so that I don't have to carry the monad with me the whole evaluation? Or would it be better to leave it the way the result is returned (with the monad)?</p>\n\n<p>Here's the full program - the mentioned line is in <code>getResultCounter</code>. If things are coded not-so-well and could be done way better, please remark that too:</p>\n\n<pre><code>import System.IO.Unsafe\nimport Network.HTTP.Conduit (simpleHttp) \nimport qualified Data.ByteString.Lazy.Char8 as L\nimport Graphics.Rendering.Chart.Easy\nimport Graphics.Rendering.Chart.Backend.Cairo\n\nnumchars :: [Char]\nnumchars = \"1234567890\"\n\nisNum :: Char -&gt; Bool\nisNum = (\\x -&gt; x `elem` numchars) \n\nmain = do\n    putStrLn \"Please input your Search (The first 'X' is going to be replaced): \"\n    search &lt;- getLine\n    putStrLn \"X ranges from: \"\n    from &lt;- getLine\n    putStrLn \"To: \"\n    to &lt;- getLine\n    putStrLn \"In steps of (Only whole numbers are accepted):\"\n    step &lt;- getLine\n    putStrLn \"Please have some patience...\"\n    let range = [read from,(read from + read step)..read to] :: [Int]\n    let searches = map (replaceX search) range\n    let res = map getResultCounter searches\n    plotList search ([(zip range res)] :: [[(Int,Integer)]])\n    putStrLn \"Done.\"\n\n-- Creates a plot from the given data\nplotList name dat = toFile def (name++\".png\") $ do\n    layout_title .= name\n    plot (line \"Results\" dat)\n\n-- Calls the Google-site and returns the number of results\ngetResultCounter :: String -&gt; Integer\ngetResultCounter search = read $ filter isNum $ L.unpack parse :: Integer\n    where url = \"http://www.google.de/search?q=\" ++ search\n              download = unsafePerformIO $ simpleHttp url -- Not good \n              parse = takeByteStringUntil \"&lt;\" \n                      $ dropByteStringUntil \"id=\\\"resultStats\\\"&gt;\" download\n\n-- Drops a ByteString until the desired String is found\ndropByteStringUntil :: String -&gt; L.ByteString -&gt; L.ByteString\ndropByteStringUntil str cont = helper str cont 0\n    where helper s bs n | (bs == L.empty) = L.empty\n                        | (n &gt;= length s) = bs\n                        | ((s !! n) == L.head bs) = helper s (L.tail bs) (n+1)\n                        | ((s !! n) /= L.head bs) = helper s (L.tail bs) 0\n\n-- Takes a ByteString until the desired String is found\ntakeByteStringUntil :: String -&gt; L.ByteString -&gt; L.ByteString\ntakeByteStringUntil str cont = helper str cont 0\n    where helper s bs n | bs == L.empty = bs\n                        | n &gt;= length s = L.empty\n                        | s !! n == L.head bs = L.head bs `L.cons` \n                                                helper s (L.tail bs) (n + 1)\n                        | s !! n /= L.head bs = L.head bs `L.cons` \n                                                helper s (L.tail bs) 0\n\n-- Replaces the first 'X' in a string with the show value of the given value\nreplaceX :: (Show a) =&gt; String -&gt; a -&gt; String\nreplaceX str x | str == \"\" = \"\"\n               | head str == 'X' = show x ++ tail str\n               | otherwise = head str : replaceX (tail str) x\n</code></pre>\n"}, {"tags": ["haskell", "ghc"], "comments": [{"owner": {"reputation": 22266, "user_id": 649287, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/7c0ea0055b84020bf860c05f53ba53d5?s=128&d=identicon&r=PG", "display_name": "augustss", "link": "https://stackoverflow.com/users/649287/augustss"}, "edited": false, "score": 1, "creation_date": 1433202449, "post_id": 30583558, "comment_id": 49239924, "body": "No, types do not all have to be known at compile time. For instance, when compiling <code>id</code> it is not known what all possible arguments will be."}, {"owner": {"reputation": 29444, "user_id": 3072788, "user_type": "registered", "accept_rate": 82, "profile_image": "https://www.gravatar.com/avatar/220a45c2fcff7e7358d144551b116205?s=128&d=identicon&r=PG&f=1", "display_name": "Alec", "link": "https://stackoverflow.com/users/3072788/alec"}, "reply_to_user": {"reputation": 22266, "user_id": 649287, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/7c0ea0055b84020bf860c05f53ba53d5?s=128&d=identicon&r=PG", "display_name": "augustss", "link": "https://stackoverflow.com/users/649287/augustss"}, "edited": false, "score": 0, "creation_date": 1433283965, "post_id": 30583558, "comment_id": 49283007, "body": "@augustss Good point, but then what is the purpose of <code>SomeNat</code>?"}, {"owner": {"reputation": 22266, "user_id": 649287, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/7c0ea0055b84020bf860c05f53ba53d5?s=128&d=identicon&r=PG", "display_name": "augustss", "link": "https://stackoverflow.com/users/649287/augustss"}, "edited": false, "score": 1, "creation_date": 1433335987, "post_id": 30583558, "comment_id": 49307322, "body": "It&#39;s a type for an existentially quantified type.  You know it&#39;s of kind Nat, but not exactly which type."}], "answers": [{"comments": [{"owner": {"reputation": 34864, "user_id": 237428, "user_type": "registered", "accept_rate": 78, "profile_image": "https://i.stack.imgur.com/ThNhZ.jpg?s=128&g=1", "display_name": "Antal Spector-Zabusky", "link": "https://stackoverflow.com/users/237428/antal-spector-zabusky"}, "edited": false, "score": 1, "creation_date": 1433200129, "post_id": 30584413, "comment_id": 49239190, "body": "An important reason for the use of proxies is that the type-level <code>a</code> you&#39;re trying to pass in might not have kind <code>*</code>.  For instance, <code>proxy 3 -&gt; b</code> is well-kinded, but <code>3 -&gt; b</code> is not; <code>proxy Maybe -&gt; b</code> is well-kinded, but <code>Maybe -&gt; b</code> is not."}, {"owner": {"reputation": 22266, "user_id": 649287, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/7c0ea0055b84020bf860c05f53ba53d5?s=128&d=identicon&r=PG", "display_name": "augustss", "link": "https://stackoverflow.com/users/649287/augustss"}, "edited": false, "score": 1, "creation_date": 1433202270, "post_id": 30584413, "comment_id": 49239878, "body": "Furthermore, <code>undefined :: N</code> is only well-kinded if N has kind *."}], "tags": [], "owner": {"reputation": 100185, "user_id": 3234959, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/93bb12ca0f93dfddb33880316f7e66c2?s=128&d=identicon&r=PG&f=1", "display_name": "chi", "link": "https://stackoverflow.com/users/3234959/chi"}, "is_accepted": true, "score": 3, "last_activity_date": 1433199274, "last_edit_date": 1433199274, "creation_date": 1433197951, "answer_id": 30584413, "question_id": 30583558, "link": "https://stackoverflow.com/questions/30583558/understanding-ghc-typelits/30584413#30584413", "title": "Understanding `GHC.TypeLits`", "body": "<p>This question is quite broad -- I'll address a few points, only.</p>\n\n<p>The <code>proxy</code> type variable is just a type variable of kind <code>* -&gt; *</code>, i.e. the kind of type contructors. Pragmatically, if you have a function</p>\n\n<pre><code>foo :: proxy a -&gt; ...\n</code></pre>\n\n<p>you can pass to it values of type e.g. <code>Maybe Int</code>, choosing <code>proxy = Maybe</code> and <code>a = Int</code>. You can pass also values of type <code>[] Char</code> (also written as <code>[Char]</code>). Or, more commonly, a value of type <code>Proxy Int</code>, where <code>Proxy</code> is a data type defined as</p>\n\n<pre><code>data Proxy a = Proxy\n</code></pre>\n\n<p>i.e. a data type which does not carry any run-time information (there's a single value for it!), but which carries compile-time information (the <em>phantom</em> type variable <code>a</code>).</p>\n\n<p>Assume <code>N</code> is a type of kind <code>Nat</code> -- a compile-time natural. We can write a function</p>\n\n<pre><code>bar :: N -&gt; ...\n</code></pre>\n\n<p>but calling this would require us to build a value of type <code>N</code> -- which is immaterial. The purpose of type <code>N</code> is to carry compile-time information, only, and its run-time values are not things that we really want to use. In fact, <code>N</code> could have no values at all, except for bottom. We <em>could</em> call </p>\n\n<pre><code>bar (undefined :: N)\n</code></pre>\n\n<p>but this looks weird. Reading this, we must realize that <code>bar</code> is lazy in its first argument and that it will not cause divergence trying to use it. The problem is that the <code>bar :: N -&gt; ...</code> type signature is misleading: it claims that the result may depend on the value of the argument of type <code>N</code>, when this is not really the case. Instead, if we use</p>\n\n<pre><code>baz :: Proxy N -&gt; ...\n</code></pre>\n\n<p>the intent is clear -- there's only a single run-time value for that: <code>Proxy :: Proxy N</code>. It is equally clear that the <code>N</code> value is only present at compile time.</p>\n\n<p>Sometimes, instead of using the specific <code>Proxy N</code>, the code is slightly generalized to</p>\n\n<pre><code>foo :: proxy N -&gt; ...\n</code></pre>\n\n<p>which achieves the same goal, but permits also different <code>Proxy</code> types. (Personally, I'm not terribly thrilled by this generalization.)</p>\n\n<p>Back to the question: <code>natVal</code> is a function which turns a compile-time only natural into a run-time value. I.e. it converts <code>Proxy N</code> into <code>Int</code>, returning just the constant.</p>\n\n<p>You analogy with C++ templates might get closer if you used <em>type</em> template arguments to model compile time naturals. E.g.</p>\n\n<pre class=\"lang-cpp prettyprint-override\"><code>template &lt;typename N&gt; struct S { using pred = N; };\nstruct Z {};\n\ntemplate &lt;typename N&gt; int natVal();\ntemplate &lt;typename N&gt; int natVal() { return 1 + natVal&lt;typename N::pred&gt;(); }\ntemplate &lt;&gt;           int natVal&lt;Z&gt;() { return 0; }\n\nint main() {\n    cout &lt;&lt; natVal&lt;S&lt;S&lt;Z&gt;&gt;&gt;() &lt;&lt; endl;  // outputs 2\n    return 0;\n}\n</code></pre>\n\n<p>Just pretend there are no public constructors for <code>S</code> and <code>Z</code>: their run-time values are unimportant, only their compile-time information matters.</p>\n"}], "owner": {"reputation": 29444, "user_id": 3072788, "user_type": "registered", "accept_rate": 82, "profile_image": "https://www.gravatar.com/avatar/220a45c2fcff7e7358d144551b116205?s=128&d=identicon&r=PG&f=1", "display_name": "Alec", "link": "https://stackoverflow.com/users/3072788/alec"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 828, "favorite_count": 0, "accepted_answer_id": 30584413, "answer_count": 1, "score": 6, "last_activity_date": 1433199274, "creation_date": 1433193850, "last_edit_date": 1433195437, "question_id": 30583558, "link": "https://stackoverflow.com/questions/30583558/understanding-ghc-typelits", "title": "Understanding `GHC.TypeLits`", "body": "<p>I'm trying to wrap my head around the GHC extensions <code>KindSignatures</code> and <code>DataKinds</code>. Looking at the <a href=\"https://hackage.haskell.org/package/modular-arithmetic-1.1.0.0/docs/Data-Modular.html\">Data.Modular</a> package, I understand roughly that</p>\n\n<pre><code>newtype i `Mod` (n :: Nat) = Mod i deriving (Eq, Ord)\n</code></pre>\n\n<p>is sort of equivalent to declaring a c++ template <code>&lt;typename T, int N&gt;</code> (with the constructor taking only one argument of type <code>T</code>). However, looking at the <a href=\"https://hackage.haskell.org/package/base-4.7.0.0/docs/GHC-TypeLits.html\">GHC.TypeLits</a> package, I don't understand most of what is happening. Any general explanation about this package would be helpful. Before this question gets flagged as off topic though, here are some specific sub-questions:</p>\n\n<ul>\n<li>a <code>KnownNat</code> class makes sense, with required function letting you extract the type variable from the type, but what does <code>natVal</code> do, and what is the <code>proxy</code> type variable?</li>\n<li>Where would you use <code>someNatVal</code>?</li>\n<li>Finally, what is <code>SomeNat</code> - how can a type level number be unknown? Isn't the whole point of a type level number that it <strong>is</strong> known at compile time?</li>\n</ul>\n"}, {"tags": ["haskell"], "comments": [{"owner": {"reputation": 31301, "user_id": 1598537, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/c214754fba6f3a238a93af85a0ab4f58?s=128&d=identicon&r=PG", "display_name": "AndrewC", "link": "https://stackoverflow.com/users/1598537/andrewc"}, "edited": false, "score": 1, "creation_date": 1433193429, "post_id": 30582583, "comment_id": 49236685, "body": "What a well-asked question. Well done."}], "answers": [{"comments": [{"owner": {"reputation": 445, "user_id": 3834375, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/3262d94a862e25fc09204d0511481ce3?s=128&d=identicon&r=PG&f=1", "display_name": "Karl Marklund", "link": "https://stackoverflow.com/users/3834375/karl-marklund"}, "edited": false, "score": 0, "creation_date": 1433200038, "post_id": 30583072, "comment_id": 49239161, "body": "Thank you @bheklilr, it kind of make sense although I&#39;m not yet fully understand why changing to <code>doStuff $ mkState 5 &lt;==&gt; (forall n. Num n =&gt; State n -&gt; State n) $ (Num n =&gt; n -&gt; State n) </code>  resolves this. As far as I understand we now have <code>doStuff $ mkState 5 &lt;==&gt; (forall n. Num n =&gt; State n -&gt; State n) $ (State Integer) </code>.  Is it because of the special rules for the <code>$</code> operator you mention that the compiler now is able to deduce that <code>n</code> on the left hand side of  <code>$</code> must be <code>Integer</code>?"}, {"owner": {"reputation": 445, "user_id": 3834375, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/3262d94a862e25fc09204d0511481ce3?s=128&d=identicon&r=PG&f=1", "display_name": "Karl Marklund", "link": "https://stackoverflow.com/users/3834375/karl-marklund"}, "edited": false, "score": 0, "creation_date": 1433200721, "post_id": 30583072, "comment_id": 49239407, "body": "I&#39;ve briefly looked into <a href=\"http://stackoverflow.com/questions/21505975/write-gadt-record-with-constrained-type\">GADTs as an alternative solution for the class constraint</a> beforeposting this question but since I&#39;m new to Haskell and lenses I thought I was better off using <code>makeLenses</code> compared to <a href=\"http://stackoverflow.com/questions/28145369/makelenses-for-gadts-haskell\">making my own lenses</a>. I might investigate how to define my own lenses once I get more experienced with Haskell and lenses."}, {"owner": {"reputation": 1267, "user_id": 231469, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/0cf2a51b9015fcbe61ed91d8146b2714?s=128&d=identicon&r=PG", "display_name": "Dave Clarke", "link": "https://stackoverflow.com/users/231469/dave-clarke"}, "reply_to_user": {"reputation": 445, "user_id": 3834375, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/3262d94a862e25fc09204d0511481ce3?s=128&d=identicon&r=PG&f=1", "display_name": "Karl Marklund", "link": "https://stackoverflow.com/users/3834375/karl-marklund"}, "edited": false, "score": 0, "creation_date": 1433240259, "post_id": 30583072, "comment_id": 49255028, "body": "Perhaps you (@KarlMarklund) intended to write <code>(doStuff . mkState) $ 5.5</code> instead of <code>doStuff . mkState $ 5.5</code>. Thus the problem seems to be related to operator precedence, thus parsing, and not anything more complicated."}, {"owner": {"reputation": 445, "user_id": 3834375, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/3262d94a862e25fc09204d0511481ce3?s=128&d=identicon&r=PG&f=1", "display_name": "Karl Marklund", "link": "https://stackoverflow.com/users/3834375/karl-marklund"}, "reply_to_user": {"reputation": 1267, "user_id": 231469, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/0cf2a51b9015fcbe61ed91d8146b2714?s=128&d=identicon&r=PG", "display_name": "Dave Clarke", "link": "https://stackoverflow.com/users/231469/dave-clarke"}, "edited": false, "score": 0, "creation_date": 1433241459, "post_id": 30583072, "comment_id": 49255775, "body": "@DaveClarke Before introducing the type synonym <code>doStuff . mkState $ 5.5</code> worked but after introducing the type synonym it caused an error. I&#39;m now trying to understand the answer given by @bheklilr."}, {"owner": {"reputation": 445, "user_id": 3834375, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/3262d94a862e25fc09204d0511481ce3?s=128&d=identicon&r=PG&f=1", "display_name": "Karl Marklund", "link": "https://stackoverflow.com/users/3834375/karl-marklund"}, "edited": false, "score": 0, "creation_date": 1433250899, "post_id": 30583072, "comment_id": 49262729, "body": "Excellent @bheklilr! The added explanation was precisely what I needed. Now it all makes sense and I look forward to learn more about Haskell and the Haskell type system."}, {"owner": {"reputation": 1267, "user_id": 231469, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/0cf2a51b9015fcbe61ed91d8146b2714?s=128&d=identicon&r=PG", "display_name": "Dave Clarke", "link": "https://stackoverflow.com/users/231469/dave-clarke"}, "reply_to_user": {"reputation": 445, "user_id": 3834375, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/3262d94a862e25fc09204d0511481ce3?s=128&d=identicon&r=PG&f=1", "display_name": "Karl Marklund", "link": "https://stackoverflow.com/users/3834375/karl-marklund"}, "edited": false, "score": 0, "creation_date": 1433271208, "post_id": 30583072, "comment_id": 49276725, "body": "@KarlMarklund: I spoke to soon."}, {"owner": {"reputation": 445, "user_id": 3834375, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/3262d94a862e25fc09204d0511481ce3?s=128&d=identicon&r=PG&f=1", "display_name": "Karl Marklund", "link": "https://stackoverflow.com/users/3834375/karl-marklund"}, "edited": false, "score": 0, "creation_date": 1438087928, "post_id": 30583072, "comment_id": 51295604, "body": "@bheklilr Adding and using the type synonym worked but only for integers and not for floats, see my update to the original post."}], "tags": [], "owner": {"reputation": 51584, "user_id": 839246, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/9b0573c2b936b12828dd1e4cc04206dc?s=128&d=identicon&r=PG&f=1", "display_name": "bheklilr", "link": "https://stackoverflow.com/users/839246/bheklilr"}, "is_accepted": true, "score": 2, "last_activity_date": 1433247787, "last_edit_date": 1433247787, "creation_date": 1433191947, "answer_id": 30583072, "question_id": 30582583, "link": "https://stackoverflow.com/questions/30582583/using-makelenses-class-constraints-and-type-synonyms-together/30583072#30583072", "title": "Using makeLenses, class constraints and type synonyms together", "body": "<p>You see that error in particular because of the combination of the <code>.</code> operator and your use of <code>RankNTypes</code>.  If you change it from</p>\n\n<pre><code>test = doStuff . mkState $ 5.5\n</code></pre>\n\n<p>to</p>\n\n<pre><code>test = doStuff $ mkState 5.5\n</code></pre>\n\n<p>or even</p>\n\n<pre><code>test = doStuff (mkState 5.5)\n</code></pre>\n\n<p>it will compile.  Why is this?  Look at the types:</p>\n\n<pre><code>doStuff :: forall n. Num n =&gt; State n -&gt; State n\nmkState :: Num n =&gt; n -&gt; State n\n\n(doStuff) . (mkState) &lt;===&gt; (forall n. Num n =&gt; State n -&gt; State n) . (Num n =&gt; n -&gt; State n)\n</code></pre>\n\n<p>Hopefully the parentheses help make it clear here, the <code>n</code> from <code>forall n. Num n ...</code> for <code>doStuff</code> is a different type variable from the <code>Num n =&gt; ...</code> for <code>mkState</code> because the scope of the <code>forall</code> only extends to the end of the parentheses.  So these functions can't actually compose because the compiler sees them as separate types!  There are actually special rules for the <code>$</code> operator specifically for using the <code>ST</code> monad precisely for this reason, just so you can do <code>runST $ do ...</code>.</p>\n\n<p>You may be able to accomplish what you want easier using GADTs, but I don't believe <code>lens</code>' <code>TemplateHaskell</code> will work with GADT types.  However, you can write your own pretty easily in this case, so it isn't that big of a deal.</p>\n\n<hr>\n\n<p>A further explanation:</p>\n\n<pre><code>doStuff . mkState $ 5.5\n</code></pre>\n\n<p>is very different than</p>\n\n<pre><code>doStuff $ mkState 5.5\n</code></pre>\n\n<p>In the first one, <code>doStuff</code> says that <em>for all</em> <code>Num</code> types <code>n</code>, its type is <code>State n -&gt; State n</code>, whereas <code>mkState</code> says <em>for some</em> <code>Num</code> type <code>m</code>, its type is <code>m -&gt; State m</code>.  These two types are not the same because of the \"for all\" and \"for some\" quantifications (hence <code>ExistentialQuantification</code>), since composing them would mean that for some <code>Num m</code> you can produce all <code>Num n</code>.</p>\n\n<p>In the <code>doStuff $ mkState 5.5</code>, you have the equivalent of</p>\n\n<pre><code>(forall n. Num n =&gt; State n -&gt; State n) $ (Num m =&gt; State m)\n</code></pre>\n\n<p>Notice that the type after the <code>$</code> is not a function because <code>mkState 5.5</code> is fully applied.  So this works because <em>for all</em> <code>Num n</code> you can do <code>State n -&gt; State n</code>, and you're providing it some <code>Num m =&gt; State m</code>.  This works intuitively.  Again, the difference here is the composition versus application.  You can't compose a function that works on some types with a function that works on all types, but you can pass a value to a function that works on all types (\"all types\" here meaning <code>forall n. Num n =&gt; n</code>).</p>\n"}], "owner": {"reputation": 445, "user_id": 3834375, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/3262d94a862e25fc09204d0511481ce3?s=128&d=identicon&r=PG&f=1", "display_name": "Karl Marklund", "link": "https://stackoverflow.com/users/3834375/karl-marklund"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 324, "favorite_count": 0, "accepted_answer_id": 30583072, "answer_count": 1, "score": 6, "last_activity_date": 1438523511, "creation_date": 1433190131, "last_edit_date": 1495542590, "question_id": 30582583, "link": "https://stackoverflow.com/questions/30582583/using-makelenses-class-constraints-and-type-synonyms-together", "title": "Using makeLenses, class constraints and type synonyms together", "body": "<p>I'm quite new to Haskell and want to use <code>makeLenses</code> from <code>Control.Lens</code> and class constraints together with type synonyms to make my functions types more compact (readable?).  </p>\n\n<p>I've tried to come up with a minimal dummy example to demonstrate what I want to achieve and the example serves no other purpose than this.</p>\n\n<p>At the end of this post I've added an example closer to my original problem if you are interested in the context. </p>\n\n<p><strong>Minimal example</strong> </p>\n\n<p>As an example, say I define the following data type:</p>\n\n<pre><code>data State a = State { _a :: a\n                     } deriving Show     \n</code></pre>\n\n<p>, for which I also make lenses: </p>\n\n<pre><code>makeLenses ''State\n</code></pre>\n\n<p>In order to enforce a class constraint on the type parameter <code>a</code> used by the type constructor <code>State</code> I use a smart constructor: </p>\n\n<pre><code>mkState :: (Num a) =&gt;  a -&gt; State a\nmkState n = State {_a = n}\n</code></pre>\n\n<p>Next, say I have a number of functions with type signatures similar to this: </p>\n\n<pre><code>doStuff :: Num a =&gt; State a -&gt; State a\ndoStuff s = s &amp; a %~ (*2)\n</code></pre>\n\n<p>This all works as intended, for example: </p>\n\n<pre><code>test = doStuff . mkState $ 5.5 -- results in State {_a = 11.0}\n</code></pre>\n\n<p><strong>Problem</strong> </p>\n\n<p>I've tried to use the following type synonym: </p>\n\n<pre><code>type S = (Num n) =&gt; State n -- Requires the RankNTypes extensions\n</code></pre>\n\n<p>, together with: </p>\n\n<pre><code>{-# LANGUAGE RankNTypes #-}\n</code></pre>\n\n<p>, in an attempt to simplify the type signature of <code>doStuff</code>:</p>\n\n<pre><code>doStuff :: S -&gt; S\n</code></pre>\n\n<p>, but this gives the following error: </p>\n\n<pre><code>Couldn't match type `State a0' with `forall n. Num n =&gt; State n'\n    Expected type: a0 -&gt; S\n    Actual type: a0 -&gt; State a0\nIn the second argument of `(.)', namely `mkState'\n    In the expression: doStuff . mkState\n    In the expression: doStuff . mkState $ 5.5\nFailed, modules loaded: none.\n</code></pre>\n\n<p><strong>Question</strong></p>\n\n<p>My current knowledge of Haskell is not sufficient to understand what causes the above error. I hope someone can explain what causes the error and/or suggest other ways to construct the type synonym or why such a type synonym is not possible. </p>\n\n<p><strong>Background</strong></p>\n\n<p>My original problem looks closer to this: </p>\n\n<pre><code>data State r = State { _time :: Int\n                     , _ready :: r\n                     } deriving Show\n\nmakeLenses ''State\n\ndata Task = Task { ... }\n</code></pre>\n\n<p>Here I want to enforce the type of <code>_ready</code> being an instance of the <code>Queue</code> class using the following smart constructor:</p>\n\n<pre><code>mkState :: (Queue q) =&gt; Int -&gt; q Task -&gt; State (q Task)\nmkState t q  = State { _time = t\n                     , _ready = q\n                     }\n</code></pre>\n\n<p>I also have a number of functions with type signatures similar to this: </p>\n\n<pre><code>updateState :: Queue q =&gt; State (q Task) -&gt; Task -&gt; State (q Task)\nupdateState s x = s &amp; ready %~ (enqueue x) &amp; time %~ (+1)\n</code></pre>\n\n<p>I would like to use a type synonym <code>S</code> to be able to rewrite the type of such functions as: </p>\n\n<pre><code>updateState :: S -&gt; Task -&gt; S\n</code></pre>\n\n<p>, but as with the first minimal example I don't know how to define the type synonym <code>S</code> or whether it is possible at all. </p>\n\n<p>Maybe there is no real benefit in trying to simplify the type signatures?</p>\n\n<p><strong>Related reading</strong></p>\n\n<p>I've read the following related questions on SO:</p>\n\n<ul>\n<li><a href=\"https://stackoverflow.com/questions/11585891/class-constraints-for-data-records\">Class constraints for data records</a></li>\n<li><a href=\"https://stackoverflow.com/questions/24232829/are-type-synonyms-with-typeclass-constraints-possible\">Are type synonyms with typeclass constraints possible?</a></li>\n</ul>\n\n<p>This might also be related but given my current understanding of Haskell I cannot really understand all of it:</p>\n\n<ul>\n<li><a href=\"https://stackoverflow.com/questions/11493603/unifying-associated-type-synonyms-with-class-constraints\">Unifying associated type synonyms with class constraints</a></li>\n</ul>\n\n<p><strong>Follow-up</strong></p>\n\n<p>It's been a while since I've had the opportunity to do some Haskell. Thanks to @bheklilr I've now managed to introduce a type synonym only to hit the next type error I'm still not able to understand. I've posted the following follow-up question <a href=\"https://stackoverflow.com/questions/31772516/type-synonym-causes-type-error\">Type synonym causes type error</a> regarding the new type error.</p>\n"}, {"tags": ["variables", "haskell", "recursion", "io", "reference"], "comments": [{"owner": {"reputation": 100185, "user_id": 3234959, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/93bb12ca0f93dfddb33880316f7e66c2?s=128&d=identicon&r=PG&f=1", "display_name": "chi", "link": "https://stackoverflow.com/users/3234959/chi"}, "edited": false, "score": 0, "creation_date": 1433183446, "post_id": 30580185, "comment_id": 49231131, "body": "You can not &quot;replace every instance of Data.IORef with a function&quot; -- why do you believe that? In some simple cases you can, but generally you can not. Perhaps it might be true that you can perform a whole-program transformation to eliminate all the <code>IORef</code>s, but the transformation is not local, and requires a lot of state-passing."}, {"owner": {"reputation": 15757, "user_id": 176841, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/45a168cb9eb8454d66c78f18e29d9342?s=128&d=identicon&r=PG", "display_name": "jberryman", "link": "https://stackoverflow.com/users/176841/jberryman"}, "edited": false, "score": 1, "creation_date": 1433200760, "post_id": 30580185, "comment_id": 49239422, "body": "<code>IORef</code> is useful with concurrency. I also recently used it with some FFI code whose API demanded I pass some callback <code>:: Foo -&gt; IO ()</code> to be called multiple times (so the <code>IORef</code> was used for keeping track of state). Reasons not to use it when recursion would suffice are all the same reasons why implicit state makes programs more confusing, error-prone, difficult to refactor, etc."}], "answers": [{"comments": [{"owner": {"reputation": 1412, "user_id": 3809561, "user_type": "registered", "accept_rate": 58, "profile_image": "https://i.stack.imgur.com/RTS59.jpg?s=128&g=1", "display_name": "yyny", "link": "https://stackoverflow.com/users/3809561/yyny"}, "edited": false, "score": 0, "creation_date": 1433185556, "post_id": 30581094, "comment_id": 49232377, "body": "Inside the dostuff, that is"}, {"owner": {"reputation": 339851, "user_id": 149392, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/7a561ec0875fcbbe3066ea8fe288ec77?s=128&d=identicon&r=PG", "display_name": "sepp2k", "link": "https://stackoverflow.com/users/149392/sepp2k"}, "reply_to_user": {"reputation": 1412, "user_id": 3809561, "user_type": "registered", "accept_rate": 58, "profile_image": "https://i.stack.imgur.com/RTS59.jpg?s=128&g=1", "display_name": "yyny", "link": "https://stackoverflow.com/users/3809561/yyny"}, "edited": false, "score": 0, "creation_date": 1433186319, "post_id": 30581094, "comment_id": 49232788, "body": "@YoYoYonnY It does actually - my mistake. I guess I assumed that the <code>running</code> in <code>loop running</code> was supposed to refer to the same variable <code>running</code> that you received as a parameter. But you&#39;re right, if you reuse the same name for a different variable, the code can terminate. However that makes having a parameter pretty pointless in the first place - you could just as well wrap an <code>if</code> around the recursive call."}, {"owner": {"reputation": 1412, "user_id": 3809561, "user_type": "registered", "accept_rate": 58, "profile_image": "https://i.stack.imgur.com/RTS59.jpg?s=128&g=1", "display_name": "yyny", "link": "https://stackoverflow.com/users/3809561/yyny"}, "edited": false, "score": 0, "creation_date": 1433188798, "post_id": 30581094, "comment_id": 49234244, "body": "Yes... I just thought this would be a better demonstration because the two are so similair."}, {"owner": {"reputation": 81794, "user_id": 9859, "user_type": "registered", "accept_rate": 89, "profile_image": "https://i.stack.imgur.com/KEZOL.jpg?s=128&g=1", "display_name": "rampion", "link": "https://stackoverflow.com/users/9859/rampion"}, "edited": false, "score": 0, "creation_date": 1433201923, "post_id": 30581094, "comment_id": 49239769, "body": "<code>running &lt;- return False</code>, slightly different."}], "tags": [], "owner": {"reputation": 339851, "user_id": 149392, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/7a561ec0875fcbbe3066ea8fe288ec77?s=128&d=identicon&r=PG", "display_name": "sepp2k", "link": "https://stackoverflow.com/users/149392/sepp2k"}, "is_accepted": false, "score": 3, "last_activity_date": 1433187750, "last_edit_date": 1433187750, "creation_date": 1433185008, "answer_id": 30581094, "question_id": 30580185, "link": "https://stackoverflow.com/questions/30580185/data-ioref-vs-recursion/30581094#30581094", "title": "Data.IORef vs Recursion", "body": "<p>If your <code>{- Do stuff -}</code> in your first version directly assigns <code>keepRunning</code> to the result of some computation, you can of course rewrite it easily to make that computation the condition for the recursion and get rid of the <code>IORef</code>. That would be the preferable solution.</p>\n\n<p>However, if your first version sets <code>keepRunning</code> inside some other function, the equivalent ref-less version could become quite a bit more complicated. So which version is preferable would be less clear in that case. Though you could make the point that such a thing would be bad design in the first place. It's hard to say anything specific without knowing what <code>{- Do stuff -}</code> actually does.</p>\n\n<blockquote>\n  <p>Will the do blocks containing recursion slow the program down compared to outside the do block?</p>\n</blockquote>\n\n<p>No.</p>\n\n<blockquote>\n  <p>If you can replace every instance of Data.IORef with a function, then why does Data.IORef even exist?</p>\n</blockquote>\n\n<p>Depending on the APIs you work with, you might not be able to (say you have event handlers in a non-FRP GUI library). Further there are cases where you could remove IORef, but only by hurting performance and/or making code more complicated.</p>\n\n<p>That said your example of using an <code>IORef</code> as a loop condition is one where you could almost certainly write a better version without <code>IORef</code>.</p>\n"}], "owner": {"reputation": 1412, "user_id": 3809561, "user_type": "registered", "accept_rate": 58, "profile_image": "https://i.stack.imgur.com/RTS59.jpg?s=128&g=1", "display_name": "yyny", "link": "https://stackoverflow.com/users/3809561/yyny"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 111, "favorite_count": 0, "answer_count": 1, "score": 0, "last_activity_date": 1433187750, "creation_date": 1433181790, "last_edit_date": 1433182183, "question_id": 30580185, "link": "https://stackoverflow.com/questions/30580185/data-ioref-vs-recursion", "title": "Data.IORef vs Recursion", "body": "<h2>Data.IORef</h2>\n\n<pre><code>keepRunning &lt;- newIORef True\nlet loop = do\n    running &lt;- readIORef keepRunning\n    if running then\n        do\n            {- Do stuff -}\n            loop running\n            return ()\n    else\n        do\n            {- Do stuff -}\n            return ()\n</code></pre>\n\n<hr>\n\n<h2>Recursion</h2>\n\n<pre><code>let keepRunning = True\nlet loop running = if running then\n    do\n        {- Do stuff -}\n        loop running\n        return ()\n    else do\n        {- Do stuff -}\n        return ()\nloop keepRunning\n</code></pre>\n\n<hr>\n\n<p>Is there any reason to prefer one of the above methods above the other? Will the <code>do</code> blocks containing recursion slow the program down compared to outside the do block? If you can replace every instance of <code>Data.IORef</code> with a function, then why does <code>Data.IORef</code> even exist?</p>\n"}, {"tags": ["haskell"], "answers": [{"comments": [{"owner": {"user_type": "does_not_exist", "display_name": "user1908597"}, "edited": false, "score": 0, "creation_date": 1433179738, "post_id": 30579398, "comment_id": 49229190, "body": "Thank you for answering. The <code>a</code> in <code>Object a</code> was to make <code>Object</code> of kind <code>* -&gt; *</code>, making it intentional but probably misguided. I&#39;m unsure if it is good etiquette to ask another question in the comments, but is there another way to write this ADT so that I can apply <code>f</code> to the internal values?"}, {"owner": {"reputation": 51584, "user_id": 839246, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/9b0573c2b936b12828dd1e4cc04206dc?s=128&d=identicon&r=PG&f=1", "display_name": "bheklilr", "link": "https://stackoverflow.com/users/839246/bheklilr"}, "edited": false, "score": 2, "creation_date": 1433180299, "post_id": 30579398, "comment_id": 49229479, "body": "@unsymbol If I had a function <code>f :: Int -&gt; Int</code> and some <code>omap :: (a -&gt; b) -&gt; Object a -&gt; Object b</code>, then <code>omap f :: Object Int -&gt; Object Int</code>, but how would you apply <code>f</code>?  You can&#39;t make a decision based on the type of <code>f</code>, so how would you know to apply it to the value in the <code>I</code> constructor?  Additionally, what if <code>f :: Int -&gt; Double</code>, how might that get applied to the contents of an <code>Object</code> value?  Your best bet is to create a <code>bmap :: (Bool -&gt; Bool) -&gt; Object -&gt; Object</code>, <code>imap :: (Int -&gt; Int) -&gt; Object -&gt; Object</code>, etc, or just let users of your type pattern match on the constructors."}, {"owner": {"reputation": 100185, "user_id": 3234959, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/93bb12ca0f93dfddb33880316f7e66c2?s=128&d=identicon&r=PG&f=1", "display_name": "chi", "link": "https://stackoverflow.com/users/3234959/chi"}, "edited": false, "score": 0, "creation_date": 1433181367, "post_id": 30579398, "comment_id": 49230068, "body": "@unsymbol You need to use <code>a</code> in the definition of <code>Object a</code> so that you can apply <code>f</code> to it. Perhaps the real question is: why do you want to make <code>Object</code>  a functor? What is the problem you are trying to solve with functors?"}, {"owner": {"user_type": "does_not_exist", "display_name": "user1908597"}, "reply_to_user": {"reputation": 51584, "user_id": 839246, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/9b0573c2b936b12828dd1e4cc04206dc?s=128&d=identicon&r=PG&f=1", "display_name": "bheklilr", "link": "https://stackoverflow.com/users/839246/bheklilr"}, "edited": false, "score": 0, "creation_date": 1433182865, "post_id": 30579398, "comment_id": 49230836, "body": "Thank you both, your answers and discussion has been very helpful. I think it&#39;s quite clear that I&#39;m trying to use the wrong abstraction for my current design. I&#39;ll re-think! /cc @bheklilr"}], "tags": [], "owner": {"reputation": 100185, "user_id": 3234959, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/93bb12ca0f93dfddb33880316f7e66c2?s=128&d=identicon&r=PG&f=1", "display_name": "chi", "link": "https://stackoverflow.com/users/3234959/chi"}, "is_accepted": true, "score": 1, "last_activity_date": 1433179093, "creation_date": 1433179093, "answer_id": 30579398, "question_id": 30579291, "link": "https://stackoverflow.com/questions/30579291/unable-define-functor-instance-for-adt/30579398#30579398", "title": "Unable define functor instance for ADT", "body": "<p>You can use</p>\n\n<pre><code>instance Functor Object where\n  fmap f N     = N\n  fmap f (B x) = B x\n  fmap f (I i) = I i\n  fmap f (L xs) = L $ map (fmap f) xs\n</code></pre>\n\n<p>or also, more simply:</p>\n\n<pre><code>data Object a\n  = N\n  | B Bool\n  | I Int\n  | L [Object a]\n  deriving (Eq, Show, Functor)\n</code></pre>\n\n<p>after having enabled the <code>DeriveFunctor</code> extension.</p>\n\n<p>Note that your <code>a</code> is not used anywhere, making <code>Object a</code> a phantom type. Is that intentional?\nBecause of this, you can not really apply <code>f</code> to anything, since you would need a value of type <code>a</code>. You are trying to apply <code>f</code> to a fixed type as <code>Bool</code>, but this won't type check, since <code>f</code> is of type <code>a -&gt; b</code>, where <code>a</code> is the <code>a</code> in <code>Object a</code>, which does not have to be <code>Bool</code>.</p>\n"}], "owner": {"user_type": "does_not_exist", "display_name": "user1908597"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 121, "favorite_count": 0, "accepted_answer_id": 30579398, "answer_count": 1, "score": 2, "last_activity_date": 1433179093, "creation_date": 1433178730, "question_id": 30579291, "link": "https://stackoverflow.com/questions/30579291/unable-define-functor-instance-for-adt", "title": "Unable define functor instance for ADT", "body": "<p>I'm working on a library that parses a binary format into a Haskell value. The first step creates an ADT that provides extra type information over some primitive value. I've written a simplified version of this below as <code>Object</code>.</p>\n\n<p>I'd like for users of the library to either treat this value as a <code>Functor</code> or have some other means by which to extract values from the structure. I've been unable to write a valid <code>Functor</code> instance for <code>Object</code>. Is it possible to do so?</p>\n\n<pre><code>data Object a\n  = N\n  | B Bool\n  | I Int\n  | L [Object a]\n  deriving (Eq, Show)\n\ninstance Functor Object where\n  fmap f N     = N\n  fmap f (B x) = B $ f x\n  -- etc.\n\n-- GHC error.\n\n-- % ghci Object.hs\n-- GHCi, version 7.10.1: http://www.haskell.org/ghc/  :? for help\n-- [1 of 1] Compiling Main             ( Object.hs, interpreted )\n\n-- Object.hs:10:22:\n--     Couldn't match expected type \u2018Bool\u2019 with actual type \u2018b\u2019\n--       \u2018b\u2019 is a rigid type variable bound by\n--           the type signature for fmap :: (a -&gt; b) -&gt; Object a -&gt; Object b\n--           at Object.hs:9:3\n--     Relevant bindings include\n--       f :: a -&gt; b (bound at Object.hs:10:8)\n--       fmap :: (a -&gt; b) -&gt; Object a -&gt; Object b (bound at Object.hs:9:3)\n--     In the second argument of \u2018($)\u2019, namely \u2018f x\u2019\n--     In the expression: B $ f x\n\n-- Object.hs:10:24:\n--     Couldn't match expected type \u2018a\u2019 with actual type \u2018Bool\u2019\n--       \u2018a\u2019 is a rigid type variable bound by\n--           the type signature for fmap :: (a -&gt; b) -&gt; Object a -&gt; Object b\n--           at Object.hs:9:3\n--     Relevant bindings include\n--       f :: a -&gt; b (bound at Object.hs:10:8)\n--       fmap :: (a -&gt; b) -&gt; Object a -&gt; Object b (bound at Object.hs:9:3)\n--     In the first argument of \u2018f\u2019, namely \u2018x\u2019\n--     In the second argument of \u2018($)\u2019, namely \u2018f x\u2019\n-- Failed, modules loaded: none.\n-- Prelude&gt;\n</code></pre>\n"}, {"tags": ["haskell", "glade", "cabal-install"], "comments": [{"owner": {"reputation": 401, "user_id": 4868124, "user_type": "registered", "accept_rate": 62, "profile_image": "https://www.gravatar.com/avatar/86dc340359160250de50ea4860cb9931?s=128&d=identicon&r=PG&f=1", "display_name": "Michael Chav", "link": "https://stackoverflow.com/users/4868124/michael-chav"}, "edited": false, "score": 0, "creation_date": 1439084606, "post_id": 30569917, "comment_id": 51715350, "body": "Did you manage to fix this?"}, {"owner": {"reputation": 304, "user_id": 4801494, "user_type": "registered", "accept_rate": 92, "profile_image": "https://i.stack.imgur.com/w61dU.jpg?s=128&g=1", "display_name": "fayong lin", "link": "https://stackoverflow.com/users/4801494/fayong-lin"}, "reply_to_user": {"reputation": 401, "user_id": 4868124, "user_type": "registered", "accept_rate": 62, "profile_image": "https://www.gravatar.com/avatar/86dc340359160250de50ea4860cb9931?s=128&d=identicon&r=PG&f=1", "display_name": "Michael Chav", "link": "https://stackoverflow.com/users/4868124/michael-chav"}, "edited": false, "score": 0, "creation_date": 1439135629, "post_id": 30569917, "comment_id": 51725960, "body": "No I am still stuck. It&#39;s a shame because Real World Haskell is a great book."}, {"owner": {"reputation": 25144, "user_id": 477476, "user_type": "registered", "accept_rate": 85, "profile_image": "https://i.stack.imgur.com/Qf4TT.png?s=128&g=1", "display_name": "Cactus", "link": "https://stackoverflow.com/users/477476/cactus"}, "edited": false, "score": 0, "creation_date": 1439423771, "post_id": 30569917, "comment_id": 51860865, "body": "Do you really need Glade? Can&#39;t you use <code>Graphics.UI.Gtk.Builder</code> instead? Glade is deprecated in the 0.13 line AFAIK."}, {"owner": {"reputation": 304, "user_id": 4801494, "user_type": "registered", "accept_rate": 92, "profile_image": "https://i.stack.imgur.com/w61dU.jpg?s=128&g=1", "display_name": "fayong lin", "link": "https://stackoverflow.com/users/4801494/fayong-lin"}, "edited": false, "score": 0, "creation_date": 1439458753, "post_id": 30569917, "comment_id": 51874164, "body": "No I don&#39;t, but it&#39;s just I have little experience with GUI libraries and I was looking forward to use the glade chapter in RWH to learn one, since I made it to this point in the book. Is there any good resources to learn how to use <code>Graphics.UI.Gtk.Builder</code>?"}], "owner": {"reputation": 304, "user_id": 4801494, "user_type": "registered", "accept_rate": 92, "profile_image": "https://i.stack.imgur.com/w61dU.jpg?s=128&g=1", "display_name": "fayong lin", "link": "https://stackoverflow.com/users/4801494/fayong-lin"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 239, "favorite_count": 0, "answer_count": 0, "score": 4, "last_activity_date": 1439504760, "creation_date": 1433150749, "last_edit_date": 1439504760, "question_id": 30569917, "link": "https://stackoverflow.com/questions/30569917/real-world-haskell-chapter-23-how-to-install-gtk-and-glade", "title": "real world haskell - chapter 23 how to install gtk and glade", "body": "<p>I am working my way through the book real world haskell, this far I always found a way to adapt the code snippets to make them run but this time I am stuck.</p>\n\n<p>I have to install the gtk and glade bindings in order to run the GUI example in chapter 23.</p>\n\n<p>This is what I have done:</p>\n\n<pre><code>~/prog/Haskell/realWorldHaskell/chapter23 $ cabal sanbox init\n~/prog/Haskell/realWorldHaskell/chapter23 $ cabal install gtk2hs-buildtools\n~/prog/Haskell/realWorldHaskell/chapter23 $ cabal install gtk\n</code></pre>\n\n<p>which worked, but when I did: </p>\n\n<pre><code>~/prog/Haskell/realWorldHaskell/chapter23 $ cabal install glade\n</code></pre>\n\n<p>I get:</p>\n\n<pre><code>Resolving dependencies...\nNotice: installing into a sandbox located at\n/home/fayong/prog/Haskell/realWorldHaskell/chapter23/.cabal-sandbox\nConfiguring utf8-string-0.3.8...\nBuilding utf8-string-0.3.8...\nInstalled utf8-string-0.3.8\nConfiguring cairo-0.12.5.3...\nConfiguring glib-0.12.5.4...\nFailed to install cairo-0.12.5.3\nBuild log ( /home/fayong/prog/Haskell/realWorldHaskell/chapter23/.cabal-sandbox/logs/cairo-0.12.5.3.log ):\n[1 of 2] Compiling SetupWrapper     ( /tmp/cairo-0.12.5.3-13890/cairo-0.12.5.3/SetupWrapper.hs, /tmp/cairo-0.12.5.3-13890/cairo-0.12.5.3/dist/dist-sandbox-96c39190/setup/SetupWrapper.o )\n[2 of 2] Compiling Main             ( /tmp/cairo-0.12.5.3-13890/cairo-0.12.5.3/dist/dist-sandbox-96c39190/setup/setup.hs, /tmp/cairo-0.12.5.3-13890/cairo-0.12.5.3/dist/dist-sandbox-96c39190/setup/Main.o )\nLinking /tmp/cairo-0.12.5.3-13890/cairo-0.12.5.3/dist/dist-sandbox-96c39190/setup/setup ...\n[1 of 2] Compiling Gtk2HsSetup      ( Gtk2HsSetup.hs, dist/setup-wrapper/Gtk2HsSetup.o )\n\nGtk2HsSetup.hs:169:28:\n    Couldn't match expected type `IO\n                                    (Distribution.InstalledPackageInfo.InstalledPackageInfo_\n                                       ModuleName)'\n                with actual type `FilePath\n                                  -&gt; PackageDB\n                                  -&gt; IO Distribution.InstalledPackageInfo.InstalledPackageInfo'\n    In the return type of a call of `generateRegistrationInfo'\n    Probable cause: `generateRegistrationInfo' is applied to too few arguments\n    In a stmt of a 'do' block:\n      installedPkgInfoRaw &lt;- generateRegistrationInfo\n                               verbosity pkg lib lbi clbi inplace distPref\n    In the expression:\n      do { installedPkgInfoRaw &lt;- generateRegistrationInfo\n                                    verbosity pkg lib lbi clbi inplace distPref;\n           dllsInScope &lt;- getSearchPath &gt;&gt;= (filterM doesDirectoryExist)\n                          &gt;&gt;= getDlls;\n           let libs = fixLibs dllsInScope (extraLibraries installedPkgInfoRaw)\n               installedPkgInfo = ...;\n           case () of {\n             _ | modeGenerateRegFile -&gt; die \"Generate Reg File not supported\"\n               | modeGenerateRegScript -&gt; die \"Generate Reg Script not supported\"\n               | otherwise\n               -&gt; registerPackage\n                    verbosity installedPkgInfo pkg lbi inplace packageDbs } }\n\nGtk2HsSetup.hs:170:63:\n    Couldn't match type `[Char]' with `Bool'\n    Expected type: Bool\n      Actual type: FilePath\n    In the 7th argument of `generateRegistrationInfo', namely\n      `distPref'\n    In a stmt of a 'do' block:\n      installedPkgInfoRaw &lt;- generateRegistrationInfo\n                               verbosity pkg lib lbi clbi inplace distPref\n    In the expression:\n      do { installedPkgInfoRaw &lt;- generateRegistrationInfo\n                                    verbosity pkg lib lbi clbi inplace distPref;\n           dllsInScope &lt;- getSearchPath &gt;&gt;= (filterM doesDirectoryExist)\n                          &gt;&gt;= getDlls;\n           let libs = fixLibs dllsInScope (extraLibraries installedPkgInfoRaw)\n               installedPkgInfo = ...;\n           case () of {\n             _ | modeGenerateRegFile -&gt; die \"Generate Reg File not supported\"\n               | modeGenerateRegScript -&gt; die \"Generate Reg Script not supported\"\n               | otherwise\n               -&gt; registerPackage\n                    verbosity installedPkgInfo pkg lbi inplace packageDbs } }\nFailed to install glib-0.12.5.4\nBuild log ( /home/fayong/prog/Haskell/realWorldHaskell/chapter23/.cabal-sandbox/logs/glib-0.12.5.4.log ):\n[1 of 2] Compiling SetupWrapper     ( /tmp/glib-0.12.5.4-13890/glib-0.12.5.4/SetupWrapper.hs, /tmp/glib-0.12.5.4-13890/glib-0.12.5.4/dist/dist-sandbox-96c39190/setup/SetupWrapper.o )\n[2 of 2] Compiling Main             ( /tmp/glib-0.12.5.4-13890/glib-0.12.5.4/dist/dist-sandbox-96c39190/setup/setup.hs, /tmp/glib-0.12.5.4-13890/glib-0.12.5.4/dist/dist-sandbox-96c39190/setup/Main.o )\nLinking /tmp/glib-0.12.5.4-13890/glib-0.12.5.4/dist/dist-sandbox-96c39190/setup/setup ...\n[1 of 2] Compiling Gtk2HsSetup      ( Gtk2HsSetup.hs, dist/setup-wrapper/Gtk2HsSetup.o )\n\nGtk2HsSetup.hs:161:28:\n    Couldn't match expected type `IO\n                                    (Distribution.InstalledPackageInfo.InstalledPackageInfo_\n                                       ModuleName)'\n                with actual type `FilePath\n                                  -&gt; PackageDB\n                                  -&gt; IO Distribution.InstalledPackageInfo.InstalledPackageInfo'\n    In the return type of a call of `generateRegistrationInfo'\n    Probable cause: `generateRegistrationInfo' is applied to too few arguments\n    In a stmt of a 'do' block:\n      installedPkgInfoRaw &lt;- generateRegistrationInfo\n                               verbosity pkg lib lbi clbi inplace distPref\n    In the expression:\n      do { installedPkgInfoRaw &lt;- generateRegistrationInfo\n                                    verbosity pkg lib lbi clbi inplace distPref;\n           dllsInScope &lt;- getSearchPath &gt;&gt;= (filterM doesDirectoryExist)\n                          &gt;&gt;= getDlls;\n           let libs = fixLibs dllsInScope (extraLibraries installedPkgInfoRaw)\n               installedPkgInfo = ...;\n           case () of {\n             _ | modeGenerateRegFile -&gt; die \"Generate Reg File not supported\"\n               | modeGenerateRegScript -&gt; die \"Generate Reg Script not supported\"\n               | otherwise\n               -&gt; registerPackage\n                    verbosity installedPkgInfo pkg lbi inplace packageDbs } }\n\nGtk2HsSetup.hs:162:63:\n    Couldn't match type `[Char]' with `Bool'\n    Expected type: Bool\n      Actual type: FilePath\n    In the 7th argument of `generateRegistrationInfo', namely\n      `distPref'\n    In a stmt of a 'do' block:\n      installedPkgInfoRaw &lt;- generateRegistrationInfo\n                               verbosity pkg lib lbi clbi inplace distPref\n    In the expression:\n      do { installedPkgInfoRaw &lt;- generateRegistrationInfo\n                                    verbosity pkg lib lbi clbi inplace distPref;\n           dllsInScope &lt;- getSearchPath &gt;&gt;= (filterM doesDirectoryExist)\n                          &gt;&gt;= getDlls;\n           let libs = fixLibs dllsInScope (extraLibraries installedPkgInfoRaw)\n               installedPkgInfo = ...;\n           case () of {\n             _ | modeGenerateRegFile -&gt; die \"Generate Reg File not supported\"\n               | modeGenerateRegScript -&gt; die \"Generate Reg Script not supported\"\n               | otherwise\n               -&gt; registerPackage\n                    verbosity installedPkgInfo pkg lbi inplace packageDbs } }\ncabal: Error: some packages failed to install:\ncairo-0.12.5.3 failed during the configure step. The exception was:\nExitFailure 1\ngio-0.12.5.3 depends on glib-0.12.5.4 which failed to install.\nglade-0.12.5.0 depends on glib-0.12.5.4 which failed to install.\nglib-0.12.5.4 failed during the configure step. The exception was:\nExitFailure 1\ngtk-0.12.5.7 depends on glib-0.12.5.4 which failed to install.\npango-0.12.5.3 depends on glib-0.12.5.4 which failed to install.\n</code></pre>\n\n<p>I am doing anything wrong? I am quite new to haskell and cabal (and to programing in general)</p>\n\n<p>I am using ghc 7.6.3  and cabal 1.22.3.0</p>\n"}, {"tags": ["haskell", "stm"], "answers": [{"comments": [{"owner": {"reputation": 11062, "user_id": 296827, "user_type": "registered", "accept_rate": 92, "profile_image": "https://i.stack.imgur.com/eMQgS.jpg?s=128&g=1", "display_name": "dsign", "link": "https://stackoverflow.com/users/296827/dsign"}, "edited": false, "score": 0, "creation_date": 1433157876, "post_id": 30569725, "comment_id": 49214488, "body": "The missile-launching code will be kept then in the IO monad. Thanks!"}, {"owner": {"reputation": 13597, "user_id": 1463507, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/9d940a7d55911df9afca8e2dd525f3ee?s=128&d=identicon&r=PG", "display_name": "kqr", "link": "https://stackoverflow.com/users/1463507/kqr"}, "edited": false, "score": 4, "creation_date": 1433161303, "post_id": 30569725, "comment_id": 49216647, "body": "I find it worth pointing out that it&#39;s not a single missile launch that gives serious international side effects in this case \u2013 it&#39;s the 735 nuclear volleys when the transaction was retried a bunch of times you have to watch out for. ;)"}], "tags": [], "owner": {"reputation": 100185, "user_id": 3234959, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/93bb12ca0f93dfddb33880316f7e66c2?s=128&d=identicon&r=PG&f=1", "display_name": "chi", "link": "https://stackoverflow.com/users/3234959/chi"}, "is_accepted": true, "score": 9, "last_activity_date": 1433155909, "last_edit_date": 1433155909, "creation_date": 1433150054, "answer_id": 30569725, "question_id": 30569279, "link": "https://stackoverflow.com/questions/30569279/is-it-safe-to-use-trace-inside-a-stm-stransaction/30569725#30569725", "title": "Is it safe to use trace inside a STM stransaction?", "body": "<p>As long as you use <code>trace</code> for debug purposes only you should be OK. As a general rule, just assume that in the final production-ready version of your program there will be no <code>trace</code>s around.</p>\n\n<p>You will never observe segfaults from <code>trace</code>. Its \"unsafety\" stems from it  injecting observable effects in pure code. E.g., in STM, when a transaction retries, its effects are assumed to be rolled back. If <code>trace</code> was used to send a message to the user, you can't roll that back. If the output of <code>trace</code> triggers a missile launch, you will have to deal with international side effects. If <code>trace</code> instead just signals the developer with \"FYI, the code is doing X\", this is not part of the core logic of the program, and is perfectly fine.</p>\n"}], "owner": {"reputation": 11062, "user_id": 296827, "user_type": "registered", "accept_rate": 92, "profile_image": "https://i.stack.imgur.com/eMQgS.jpg?s=128&g=1", "display_name": "dsign", "link": "https://stackoverflow.com/users/296827/dsign"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 181, "favorite_count": 0, "accepted_answer_id": 30569725, "answer_count": 1, "score": 8, "last_activity_date": 1433155909, "creation_date": 1433148660, "question_id": 30569279, "link": "https://stackoverflow.com/questions/30569279/is-it-safe-to-use-trace-inside-a-stm-stransaction", "title": "Is it safe to use trace inside a STM stransaction?", "body": "<p>I have a transaction failing indefinitely for some reason, and I would like to use trace instructions inside. For example, to print the state of the MVar's before executing the transaction in this fragment:</p>\n\n<pre><code>    data_out &lt;- atomically $ do \n        rtg_state &lt;- takeTMVar ready_to_go \n        JobDescr hashid url &lt;- T.readTBChan next_job_descr\n        case rtg_state of \n            Ready_RTG n -&gt; do\n                putTMVar ready_to_go $ Processing_RTG n\n                putTMVar start_harvester_browser hashid\n                putTMVar next_test_url_to_check_chan  hashid\n                putTMVar next_harvest_url hashid\n                return (n,hashid,url)\n            _ -&gt; retry\n</code></pre>\n\n<p>Would that make the program segfault or miss-behave?</p>\n"}, {"tags": ["linux", "haskell"], "comments": [{"owner": {"reputation": 126897, "user_id": 791604, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/ce991df7a056248d5e4f6fc3659ba733?s=128&d=identicon&r=PG", "display_name": "Daniel Wagner", "link": "https://stackoverflow.com/users/791604/daniel-wagner"}, "edited": false, "score": 0, "creation_date": 1433129414, "post_id": 30565088, "comment_id": 49201468, "body": "That first error message (mentioning a specific directory) is a bit suspicious. Is that the exact command you&#39;re running? Do you have any shell aliases for <code>cabal</code>? What does <code>type -a cabal</code> say?"}, {"owner": {"user_type": "does_not_exist", "display_name": "user266003"}, "reply_to_user": {"reputation": 126897, "user_id": 791604, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/ce991df7a056248d5e4f6fc3659ba733?s=128&d=identicon&r=PG", "display_name": "Daniel Wagner", "link": "https://stackoverflow.com/users/791604/daniel-wagner"}, "edited": false, "score": 0, "creation_date": 1433129836, "post_id": 30565088, "comment_id": 49201542, "body": "@DanielWagner, what can it say if cabal isn&#39;t installed?"}, {"owner": {"reputation": 126897, "user_id": 791604, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/ce991df7a056248d5e4f6fc3659ba733?s=128&d=identicon&r=PG", "display_name": "Daniel Wagner", "link": "https://stackoverflow.com/users/791604/daniel-wagner"}, "edited": false, "score": 0, "creation_date": 1433130199, "post_id": 30565088, "comment_id": 49201617, "body": "It is not clear to me that cabal isn&#39;t installed. I can suggest several alternative explanations for the evidence you&#39;ve provided so far. Please give the output requested, so that we can narrow down the problem."}, {"owner": {"user_type": "does_not_exist", "display_name": "user266003"}, "reply_to_user": {"reputation": 126897, "user_id": 791604, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/ce991df7a056248d5e4f6fc3659ba733?s=128&d=identicon&r=PG", "display_name": "Daniel Wagner", "link": "https://stackoverflow.com/users/791604/daniel-wagner"}, "edited": false, "score": 0, "creation_date": 1433130299, "post_id": 30565088, "comment_id": 49201638, "body": "@DanielWagner, $ type -a cabal cabal is /usr/bin/cabal`"}, {"owner": {"reputation": 126897, "user_id": 791604, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/ce991df7a056248d5e4f6fc3659ba733?s=128&d=identicon&r=PG", "display_name": "Daniel Wagner", "link": "https://stackoverflow.com/users/791604/daniel-wagner"}, "edited": false, "score": 0, "creation_date": 1433130944, "post_id": 30565088, "comment_id": 49201763, "body": "That&#39;s a good sign. Perhaps your shell just needs to notice it; does running <code>rehash</code> fix things? If not, what does <code>file &#47;usr&#47;bin&#47;cabal</code> say? If it says it is a shell script or similar, what is the contents of <code>&#47;usr&#47;bin&#47;cabal</code>?"}, {"owner": {"user_type": "does_not_exist", "display_name": "user266003"}, "reply_to_user": {"reputation": 126897, "user_id": 791604, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/ce991df7a056248d5e4f6fc3659ba733?s=128&d=identicon&r=PG", "display_name": "Daniel Wagner", "link": "https://stackoverflow.com/users/791604/daniel-wagner"}, "edited": false, "score": 0, "creation_date": 1433131475, "post_id": 30565088, "comment_id": 49201863, "body": "rehash - command not found."}, {"owner": {"user_type": "does_not_exist", "display_name": "user266003"}, "reply_to_user": {"reputation": 126897, "user_id": 791604, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/ce991df7a056248d5e4f6fc3659ba733?s=128&d=identicon&r=PG", "display_name": "Daniel Wagner", "link": "https://stackoverflow.com/users/791604/daniel-wagner"}, "edited": false, "score": 0, "creation_date": 1433131485, "post_id": 30565088, "comment_id": 49201867, "body": "@DanielWagner, $ file /usr/bin/cabal /usr/bin/cabal: ELF 64-bit LSB  executable, x86-64, version 1 (SYSV), dynamically linked (uses shared libs), for GNU/Linux 2.6.24, BuildID[sha1]=52e0a2baaf74ac55bcb271d2fa8f10d7c3527f1f, stripped"}, {"owner": {"reputation": 126897, "user_id": 791604, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/ce991df7a056248d5e4f6fc3659ba733?s=128&d=identicon&r=PG", "display_name": "Daniel Wagner", "link": "https://stackoverflow.com/users/791604/daniel-wagner"}, "edited": false, "score": 2, "creation_date": 1433131573, "post_id": 30565088, "comment_id": 49201889, "body": "Oops, in bash, <code>rehash</code> is spelled <code>hash -r</code>. Sorry about that, zsh junkie here."}], "owner": {"user_type": "does_not_exist", "display_name": "user266003"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 57, "favorite_count": 0, "answer_count": 0, "score": 1, "last_activity_date": 1433129941, "creation_date": 1433128092, "last_edit_date": 1433129941, "question_id": 30565088, "link": "https://stackoverflow.com/questions/30565088/installing-hasking-via-install-haskell-platform-on-linux-cabal-isnt-install", "title": "Installing hasking via &quot;install haskell-platform&quot; on Linux - cabal isn&#39;t installed", "body": "<p>I installed haskell on Ubuntu 14 by:</p>\n\n<pre><code>sudo apt-get install haskell-platform\n</code></pre>\n\n<p>But cabal hasn't been installed for some reason:</p>\n\n<pre><code>$ cabal --version\n-bash: /home/me123/.cabal/bin/cabal: No such file or directory\n</code></pre>\n\n<p>And there's no </p>\n\n<pre><code>$ ls /home/alex/.cabal\nls: cannot access /home/me123/.cabal: No such file or directory\n</code></pre>\n\n<p>So how can install it or where can I find it if it's already installed?</p>\n\n<p>P.S.\nIt was installed previously but for some reason I deleted it by apt-get remove ghc and haskell-plathorm. So I want to install everything all over again.</p>\n"}, {"tags": ["haskell"], "comments": [{"owner": {"reputation": 44013, "user_id": 1477667, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/trgKM.jpg?s=128&g=1", "display_name": "dfeuer", "link": "https://stackoverflow.com/users/1477667/dfeuer"}, "edited": false, "score": 1, "creation_date": 1433139562, "post_id": 30564990, "comment_id": 49204268, "body": "The factorial one-liner that doesn&#39;t leak space when appropriately typed (unlike your implementation) is <code>fact n = product [1..n]</code>. There are, however, much faster multi-line definitions."}, {"owner": {"reputation": 3588, "user_id": 2706344, "user_type": "registered", "accept_rate": 46, "profile_image": "https://www.gravatar.com/avatar/d5450ccc81c173504d25c755092adf01?s=128&d=identicon&r=PG&f=1", "display_name": "principal-ideal-domain", "link": "https://stackoverflow.com/users/2706344/principal-ideal-domain"}, "edited": false, "score": 0, "creation_date": 1433143635, "post_id": 30564990, "comment_id": 49206288, "body": "You should also define your factorial for 0. 0!=1."}], "answers": [{"tags": [], "owner": {"reputation": 62902, "user_id": 90511, "user_type": "registered", "accept_rate": 91, "profile_image": "https://i.stack.imgur.com/nmOPo.png?s=128&g=1", "display_name": "hugomg", "link": "https://stackoverflow.com/users/90511/hugomg"}, "is_accepted": true, "score": 7, "last_activity_date": 1433127882, "creation_date": 1433127882, "answer_id": 30565060, "question_id": 30564990, "link": "https://stackoverflow.com/questions/30564990/how-am-i-computing-ex-incorrectly/30565060#30565060", "title": "How am I computing e^x incorrectly?", "body": "<p>Its an operator precedence issue. The <code>fd</code> has a higher precedence than the <code>**</code>. If you add extra parenthesis its clearer why you are getting a 6:</p>\n\n<pre><code>(x**(n `fd` (fact n)))\n</code></pre>\n\n<p>The way to fix this would be to put parenthesis around the exponentiation and then tweak things a bit so they typecheck:</p>\n\n<pre><code>((x^n) / (fromIntegral (fact n)))\n</code></pre>\n"}], "owner": {"reputation": 14609, "user_id": 667648, "user_type": "registered", "accept_rate": 84, "profile_image": "https://i.stack.imgur.com/mTpbt.jpg?s=128&g=1", "display_name": "Dair", "link": "https://stackoverflow.com/users/667648/dair"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 190, "favorite_count": 0, "accepted_answer_id": 30565060, "answer_count": 1, "score": 4, "last_activity_date": 1433127882, "creation_date": 1433127126, "question_id": 30564990, "link": "https://stackoverflow.com/questions/30564990/how-am-i-computing-ex-incorrectly", "title": "How am I computing e^x incorrectly?", "body": "<p>I am trying to estimate <code>e^x</code> using the power series for approximation in Haskell.</p>\n\n<pre><code>import Data.Function\n\n-- Take two integers and divide them and return a float as a result.\n-- So 1/2 would be 0.5\nfd :: Int -&gt; Int -&gt; Double\nfd = (/) `on` fromIntegral\n\n-- Helper function to compute factorial\nfact :: Int -&gt; Int\nfact 1 = 1\nfact n = n * fact (n-1)\n\n-- Calculate e^x using the power series for e^x (n is the number of\n-- of terms used to approximate e^x\ncomputeHelper :: Double -&gt; Int -&gt; Double -&gt; Double\ncomputeHelper x 0 res = res + 1\ncomputeHelper x n res = computeHelper x (n-1) (res + (x**n `fd` (fact n)))\n\ncompute :: Double -&gt; Int -&gt; Double\ncompute x n = computeHelper x n 0.0\n</code></pre>\n\n<p>Calling <code>compute 1 5</code> gives <code>6</code>. Which is incorrect.</p>\n\n<p>Both <code>fd</code> and <code>fact</code> appear to be working fine. Therefore, I'm guessing the issue is with <code>computeHelper</code>. However, following the same logic in Python:</p>\n\n<pre><code>from math import factorial\n\ndef compute(x, n, res=0):\n    if n == 0:\n        return res + 1\n    return compute(x, n-1, res + (x**n*1.0/(factorial(n))))\n\nprint compute(1, 5)\n</code></pre>\n\n<p>I get <code>2.71666666667</code> which is as expected, so I am confused why the Haskell version doesn't work.</p>\n"}, {"tags": ["haskell", "gadt"], "comments": [{"owner": {"reputation": 126897, "user_id": 791604, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/ce991df7a056248d5e4f6fc3659ba733?s=128&d=identicon&r=PG", "display_name": "Daniel Wagner", "link": "https://stackoverflow.com/users/791604/daniel-wagner"}, "edited": false, "score": 0, "creation_date": 1433131496, "post_id": 30564967, "comment_id": 49201869, "body": "By the way, you could certainly add a <code>typecheckbool (UIf a b c)</code> case to address the &quot;But <code>TIf TTrue TFalse TTrue</code> is actually totally valid&quot; concern."}], "answers": [{"comments": [{"owner": {"reputation": 13807, "user_id": 2407038, "user_type": "registered", "accept_rate": 64, "profile_image": "https://www.gravatar.com/avatar/538f6f4a9aa43841841de7d8e8b169fc?s=128&d=identicon&r=PG&f=1", "display_name": "user2407038", "link": "https://stackoverflow.com/users/2407038/user2407038"}, "edited": false, "score": 0, "creation_date": 1433275704, "post_id": 30565412, "comment_id": 49279258, "body": "Could this still be done if the term/type languages contained variables? Could the <code>Type</code> datatype represent such a language?"}, {"owner": {"reputation": 126897, "user_id": 791604, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/ce991df7a056248d5e4f6fc3659ba733?s=128&d=identicon&r=PG", "display_name": "Daniel Wagner", "link": "https://stackoverflow.com/users/791604/daniel-wagner"}, "reply_to_user": {"reputation": 13807, "user_id": 2407038, "user_type": "registered", "accept_rate": 64, "profile_image": "https://www.gravatar.com/avatar/538f6f4a9aa43841841de7d8e8b169fc?s=128&d=identicon&r=PG&f=1", "display_name": "user2407038", "link": "https://stackoverflow.com/users/2407038/user2407038"}, "edited": false, "score": 0, "creation_date": 1433278256, "post_id": 30565412, "comment_id": 49280593, "body": "@user2407038 It is certainly possible to define a language with a more expressive type system than Haskell&#39;s; then you will not be able to use Haskell&#39;s type-checker to check that terms in that language are type-correct. However, for the most part, if your language&#39;s type system is less expressive than Haskell&#39;s, then you can convince Haskell to check your terms for you -- though of course with more effort the more exciting your system is."}], "tags": [], "owner": {"reputation": 126897, "user_id": 791604, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/ce991df7a056248d5e4f6fc3659ba733?s=128&d=identicon&r=PG", "display_name": "Daniel Wagner", "link": "https://stackoverflow.com/users/791604/daniel-wagner"}, "is_accepted": true, "score": 6, "last_activity_date": 1433146836, "last_edit_date": 1433146836, "creation_date": 1433130809, "answer_id": 30565412, "question_id": 30564967, "link": "https://stackoverflow.com/questions/30564967/converting-an-untyped-ast-for-a-simple-typed-language-into-a-gadt/30565412#30565412", "title": "Converting an untyped AST for a simple typed language into a GADT", "body": "<p>The standard technique is to define an existential type:</p>\n\n<pre><code>data ETerm_ where\n    ETerm_ :: TTerm a -&gt; ETerm\n</code></pre>\n\n<p>In this case, you may also want some term-level evidence of which type you have; e.g.</p>\n\n<pre><code>data Type a where\n    TInt :: Type Int\n    TBool :: Type Bool\n</code></pre>\n\n<p>then the real <code>ETerm</code> would look like this:</p>\n\n<pre><code>data ETerm where\n    ETerm :: Type a -&gt; TTerm a -&gt; ETerm\n</code></pre>\n\n<p>The interesting case of type checking is then something like</p>\n\n<pre><code>typeCheck (UIf ucond ut uf) = do\n    ETerm TBool tcond &lt;- typeCheck ucond\n    ETerm tyt tt &lt;- typeCheck ut\n    ETerm tyf tf &lt;- typeCheck uf\n    case (tyt, tyf) of\n        (TBool, TBool) -&gt; return (ETerm TBool (TIf tcond tt tf))\n        (TInt , TInt ) -&gt; return (ETerm TInt  (TIf tcond tt tf))\n        _ -&gt; fail \"branches have different types\"\n</code></pre>\n"}, {"comments": [{"owner": {"reputation": 1122, "user_id": 1040688, "user_type": "registered", "accept_rate": 45, "profile_image": "https://www.gravatar.com/avatar/9c4cd276c08f9c97148ad90636def10c?s=128&d=identicon&r=PG", "display_name": "Gavin Wahl", "link": "https://stackoverflow.com/users/1040688/gavin-wahl"}, "edited": false, "score": 0, "creation_date": 1433200882, "post_id": 30569047, "comment_id": 49239460, "body": "This is helpful, especially if there&#39;s more than 2 types, thanks. Why doesn&#39;t pattern matching in the do block (<a href=\"http://lpaste.net/133738\" rel=\"nofollow noreferrer\">lpaste.net/133738</a>) work but a case statement does?"}, {"owner": {"reputation": 100185, "user_id": 3234959, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/93bb12ca0f93dfddb33880316f7e66c2?s=128&d=identicon&r=PG&f=1", "display_name": "chi", "link": "https://stackoverflow.com/users/3234959/chi"}, "reply_to_user": {"reputation": 1122, "user_id": 1040688, "user_type": "registered", "accept_rate": 45, "profile_image": "https://www.gravatar.com/avatar/9c4cd276c08f9c97148ad90636def10c?s=128&d=identicon&r=PG", "display_name": "Gavin Wahl", "link": "https://stackoverflow.com/users/1040688/gavin-wahl"}, "edited": false, "score": 0, "creation_date": 1433201138, "post_id": 30569047, "comment_id": 49239527, "body": "<code>Just Refl &lt;- ...</code> looks wrong, the <code>Just</code> was already removed (loosely speaking) by the <code>&lt;-</code> desugaring. Try <code>Refl &lt;- ...</code> instead. (I&#39;m not completely sure how that interacts with GADTs, though.)"}, {"owner": {"reputation": 1122, "user_id": 1040688, "user_type": "registered", "accept_rate": 45, "profile_image": "https://www.gravatar.com/avatar/9c4cd276c08f9c97148ad90636def10c?s=128&d=identicon&r=PG", "display_name": "Gavin Wahl", "link": "https://stackoverflow.com/users/1040688/gavin-wahl"}, "edited": false, "score": 0, "creation_date": 1433208484, "post_id": 30569047, "comment_id": 49241366, "body": "Can you give me a hint about how to prove <code>a :~: b) -&gt; Void</code>?"}], "tags": [], "owner": {"reputation": 100185, "user_id": 3234959, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/93bb12ca0f93dfddb33880316f7e66c2?s=128&d=identicon&r=PG&f=1", "display_name": "chi", "link": "https://stackoverflow.com/users/3234959/chi"}, "is_accepted": false, "score": 5, "last_activity_date": 1433233830, "last_edit_date": 1433233830, "creation_date": 1433147947, "answer_id": 30569047, "question_id": 30564967, "link": "https://stackoverflow.com/questions/30564967/converting-an-untyped-ast-for-a-simple-typed-language-into-a-gadt/30569047#30569047", "title": "Converting an untyped AST for a simple typed language into a GADT", "body": "<p>As a minor complement of @DanielWagner's answer, you might want to factorize type equality checks such as</p>\n\n<pre><code>...\ncase (tyt, tyf) of\n        (TBool, TBool) -&gt; return (ETerm TBool (TIf tcond tt tf))\n        (TInt , TInt ) -&gt; return (ETerm TInt  (TIf tcond tt tf))\n        _ -&gt; fail \"branches have different types\"\n</code></pre>\n\n<p>One way to do that is using equality witnesses:</p>\n\n<pre><code>import Data.Type.Equality\n\ntypeEq :: Type a -&gt; Type b -&gt; Maybe (a :~: b)\ntypeEq TInt  TInt  = Just Refl\ntypeEq TBool TBool = Just Refl\ntypeEq _     _     = Nothing\n\ntypeCheck :: UTerm -&gt; Maybe ETerm\ntypeCheck (UIf ucond ut uf) = do\n    ETerm TBool tcond &lt;- typeCheck ucond\n    ETerm tyt tt &lt;- typeCheck ut\n    ETerm tyf tf &lt;- typeCheck uf\n    case typeEq tyt tyf of\n        Just Refl -&gt; return (ETerm tyt (TIf tcond tt tf))\n        _         -&gt; fail \"branches have different types\"\n</code></pre>\n\n<p>This factorization is convenient if you need to check type equality in multiple parts of your type checking routine. It also allows for extending the language with pair types like <code>(t1,t2)</code>, which require a structural recursive approach to check type equality.</p>\n\n<p>One might even write a full decider for type equality</p>\n\n<pre><code>{-# LANGUAGE EmptyCase #-}\ntypeEq2 :: Type a -&gt; Type b -&gt; Either (a :~: b) ((a :~:b) -&gt; Void)\ntypeEq2 TInt  TInt  = Left Refl\ntypeEq2 TInt  TBool = Right (\\eq -&gt; case eq of)\ntypeEq2 TBool TBool = Left Refl\ntypeEq2 TBool TInt  = Right (\\eq -&gt; case eq of) \n</code></pre>\n\n<p>but this, I guess, will probably not be needed unless you are trying to model quite advanced types (e.g. GADTs).</p>\n\n<p>The code above uses and empty case to examine all the possible values <code>eq</code> can have. Since it has type e.g. <code>Int :~: Bool</code>, and there are no constructors matching with that type, we are left with no possible values for <code>eq</code> and so no case branch is needed. This will <em>not</em> trigger an exhaustiveness warning, since there are indeed no cases left unhandled (OT: I wish these warnings to be actual errors).</p>\n\n<p>Instead of using <code>EmptyCase</code> you can also use something like <code>case eq of _ -&gt; undefined</code>, but using bottoms in proof terms like the above one is fishy.</p>\n"}], "owner": {"reputation": 1122, "user_id": 1040688, "user_type": "registered", "accept_rate": 45, "profile_image": "https://www.gravatar.com/avatar/9c4cd276c08f9c97148ad90636def10c?s=128&d=identicon&r=PG", "display_name": "Gavin Wahl", "link": "https://stackoverflow.com/users/1040688/gavin-wahl"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 317, "favorite_count": 2, "accepted_answer_id": 30565412, "answer_count": 2, "score": 9, "last_activity_date": 1433233830, "creation_date": 1433126813, "question_id": 30564967, "link": "https://stackoverflow.com/questions/30564967/converting-an-untyped-ast-for-a-simple-typed-language-into-a-gadt", "title": "Converting an untyped AST for a simple typed language into a GADT", "body": "<p>I have an ADT representing the AST for a simple language:</p>\n\n<pre><code>data UTerm = UTrue\n      | UFalse\n      | UIf UTerm UTerm UTerm\n      | UZero\n      | USucc UTerm\n      | UIsZero UTerm\n</code></pre>\n\n<p>This data structure can represent invalid terms that don't follow the type\nrules of the language, like <code>UIsZero UFalse</code>, so I'd like to use a GADT that\nenforces well-typedness:</p>\n\n<pre><code>{-# LANGUAGE GADTs #-}\n\ndata TTerm a where\n  TTrue :: TTerm Bool\n  TFalse :: TTerm Bool\n  TIf :: TTerm Bool -&gt; TTerm a -&gt; TTerm a -&gt; TTerm a\n  TZero :: TTerm Int\n  TSucc :: TTerm Int -&gt; TTerm Int\n  TIsZero :: TTerm Int -&gt; TTerm Bool\n</code></pre>\n\n<p>My problem is to type check a UTerm and convert it into a TTerm. My first\nthought was <code>UTerm -&gt; Maybe (TTerm a)</code>, but this of course doesn't work because\nit's not valid for all <code>a</code>s. I don't even know what the type would be, because\nwe don't know if <code>a</code> is going to be Int or Bool. Then I thought I could write a\ndifferent type checking function for each of the possible values of <code>a</code>:</p>\n\n<pre><code>import Control.Applicative\n\ntypecheckbool :: UTerm -&gt; Maybe (TTerm Bool)\ntypecheckbool UTrue = Just TTrue\ntypecheckbool UFalse = Just TFalse\ntypecheckbool (UIsZero a) = TIsZero &lt;$&gt; typecheckint a\ntypecheckbool _ = Nothing\n\ntypecheckint :: UTerm -&gt; Maybe (TTerm Int)\ntypecheckint UZero = Just TZero\ntypecheckint (USucc a) = TSucc &lt;$&gt; typecheckint a\ntypecheckint (UIf a b c) = TIf &lt;$&gt; typecheckbool a &lt;*&gt; typecheckint b &lt;*&gt; typecheckint c\ntypecheckint UTrue = Nothing\ntypecheckint UFalse = Nothing\ntypecheckint (UIsZero _) = Nothing\n</code></pre>\n\n<p>This works for some cases, for a subset of the language where TIf requires its\nconsequent and alternative are Ints (But <code>TIf TTrue TFalse TTrue</code> is actually\ntotally valid), and where we know the target type of the expression we're\ntyping.</p>\n\n<p>What's the right way to convert from a UTerm to a TTerm?</p>\n"}, {"tags": ["haskell", "doctest", "quickcheck"], "comments": [{"owner": {"reputation": 1426, "user_id": 417377, "user_type": "registered", "accept_rate": 83, "profile_image": "https://www.gravatar.com/avatar/1aa2c99d2089ac6753753db614b2ff1a?s=128&d=identicon&r=PG", "display_name": "Martin Capodici", "link": "https://stackoverflow.com/users/417377/martin-capodici"}, "edited": false, "score": 0, "creation_date": 1433455312, "post_id": 30562722, "comment_id": 49372614, "body": "I have decided to not use DocTest to run QuickCheck now, but instead to import Test.QuickCheck.All and use the $quickCheckAll template. Not only does it solve this problem, but it also means I can have my tests type checked by ghc-mod. It was annoying having the test as a comment then realising I made a typing mistake only when I ran the test."}], "owner": {"reputation": 1426, "user_id": 417377, "user_type": "registered", "accept_rate": 83, "profile_image": "https://www.gravatar.com/avatar/1aa2c99d2089ac6753753db614b2ff1a?s=128&d=identicon&r=PG", "display_name": "Martin Capodici", "link": "https://stackoverflow.com/users/417377/martin-capodici"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 91, "favorite_count": 0, "answer_count": 0, "score": 3, "last_activity_date": 1433106547, "creation_date": 1433106547, "last_edit_date": 1495535212, "question_id": 30562722, "link": "https://stackoverflow.com/questions/30562722/control-number-of-quickcheck-test-cases-from-doctest", "title": "Control number of QuickCheck test cases from DocTest", "body": "<p>Is it possible to control the number of cases generated by QuickCheck when running doctest?</p>\n\n<p>For example you can do this when running QuickCheck from your haskell code (<a href=\"https://stackoverflow.com/questions/8116262/how-to-get-haskell-quickcheck-2-4-to-increase-tests\">see here for details</a>) using the maxSuccess parameter.</p>\n\n<p>However how do you do this when running doctest from the command line?</p>\n"}, {"tags": ["haskell", "frp", "ghcjs", "sodiumfrp"], "comments": [{"owner": {"reputation": 2662, "user_id": 377248, "user_type": "registered", "accept_rate": 80, "profile_image": "https://www.gravatar.com/avatar/2ff67f64a05a15eceb6de6a9421b15d8?s=128&d=identicon&r=PG", "display_name": "clinux", "link": "https://stackoverflow.com/users/377248/clinux"}, "edited": false, "score": 0, "creation_date": 1469435902, "post_id": 30561852, "comment_id": 64516623, "body": "This sounds like the behaviour got garbage collected. JavaScript does not have weak references, and sodium depends on weak references. It is true that GHCJS has its own simulation of weak references, however reachability of things finishes after the execution of main I believe."}, {"owner": {"reputation": 1001, "user_id": 4234663, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/20acdc3ff5edb482ae83b033c90c2166?s=128&d=identicon&r=PG", "display_name": "j-keck", "link": "https://stackoverflow.com/users/4234663/j-keck"}, "reply_to_user": {"reputation": 2662, "user_id": 377248, "user_type": "registered", "accept_rate": 80, "profile_image": "https://www.gravatar.com/avatar/2ff67f64a05a15eceb6de6a9421b15d8?s=128&d=identicon&r=PG", "display_name": "clinux", "link": "https://stackoverflow.com/users/377248/clinux"}, "edited": false, "score": 0, "creation_date": 1469437866, "post_id": 30561852, "comment_id": 64517821, "body": "yes, i know. i have a link to the bug @github added"}], "owner": {"reputation": 1001, "user_id": 4234663, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/20acdc3ff5edb482ae83b033c90c2166?s=128&d=identicon&r=PG", "display_name": "j-keck", "link": "https://stackoverflow.com/users/4234663/j-keck"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 154, "favorite_count": 0, "answer_count": 0, "score": 6, "last_activity_date": 1437545545, "creation_date": 1433101037, "last_edit_date": 1437545545, "question_id": 30561852, "link": "https://stackoverflow.com/questions/30561852/ghcjs-sodium-no-events-after-some-time", "title": "ghcjs + sodium: no events after some time", "body": "<p><strong>UPDATE:</strong> there is a issue in ghcjs: <a href=\"https://github.com/ghcjs/ghcjs/issues/296\" rel=\"nofollow\">https://github.com/ghcjs/ghcjs/issues/296</a></p>\n\n<hr>\n\n<p>i play with ghcjs and sodium but after 3 seconds my application doesn't emit events anymore.</p>\n\n<h2>a minimal example:</h2>\n\n<ul>\n<li>a button: emit events</li>\n<li>a counter behavior: counts the button clicks</li>\n<li>a div: displays the counter behavior</li>\n<li>after 3 seconds, the div doesn't update anymore</li>\n<li>if i reload the page, the counter updates again - for 3 seconds</li>\n</ul>\n\n<hr>\n\n<pre><code>{-# LANGUAGE OverloadedStrings #-}\nmodule Main where\n\nimport           Control.Applicative ((&lt;$&gt;))\nimport           Control.Concurrent  (forkIO, threadDelay)\nimport           Control.Monad       (forever)\nimport           Data.Default        (def)\nimport           Data.Text           (Text, pack)\nimport           FRP.Sodium\nimport           JavaScript.JQuery   hiding (Event)\n\n\nmain :: IO ()\nmain = do\n  body &lt;- select \"body\"\n\n  -- a button\n  (btn, btnE) &lt;- mkBtnE \"Click\"\n  appendJQuery btn body\n\n\n  -- a behavior: counter - increment when btnE (button event) arrive\n  counterB &lt;- sync $ accum 0 (const (+1) &lt;$&gt; btnE)\n\n\n  -- a div with the counter value\n  counterView &lt;- mkDiv $ fmap (pack . show) counterB\n  appendJQuery counterView body\n\n\n  -- wait -&gt; nothing changed\n  -- forkIO $ forever (threadDelay 1000000000)\n  return ()\n\n\n\n\nmkBtn :: Text -&gt; IO JQuery\nmkBtn label = select \"&lt;button/&gt;\" &gt;&gt;= setText label\n\n\nmkBtnE :: Text -&gt; IO (JQuery, Event ())\nmkBtnE label = do\n  (e, t) &lt;- sync newEvent\n  btn &lt;- mkBtn label\n  on (const $ sync $ t ()) \"click\" def btn\n  return (btn, e)\n\n\nmkDiv :: Behaviour Text -&gt; IO JQuery\nmkDiv b = do\n  div &lt;- select \"&lt;div/&gt;\"\n  sync $ listen (value b) (\\t -&gt; setText t div &gt;&gt; return ())\n  return div\n</code></pre>\n\n<hr>\n\n<p><strong>The full example is under <a href=\"https://github.com/j-keck/ghcjs-sodium\" rel=\"nofollow\">https://github.com/j-keck/ghcjs-sodium</a></strong></p>\n\n<p>thanks</p>\n"}, {"tags": ["haskell", "frp", "elm"], "answers": [{"tags": [], "owner": {"reputation": 126897, "user_id": 791604, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/ce991df7a056248d5e4f6fc3659ba733?s=128&d=identicon&r=PG", "display_name": "Daniel Wagner", "link": "https://stackoverflow.com/users/791604/daniel-wagner"}, "is_accepted": false, "score": 1, "last_activity_date": 1433121624, "creation_date": 1433121624, "answer_id": 30564436, "question_id": 30561548, "link": "https://stackoverflow.com/questions/30561548/what-is-a-sample-in-helm/30564436#30564436", "title": "What is a Sample in Helm?", "body": "<p>Probably the first argument there exists for historical reasons or for consistency with other functions offered by helm; but I don't know enough about either to say for sure.</p>\n\n<p>The intended use of the <code>update</code> function seems to be to wrap the appropriate constructor around its argument: <code>update p a s</code> will result in either <code>Changed a</code> or <code>Unchanged a</code> depending on whether <code>a</code> matches with the value stored in <code>s</code>. One might use this, for example, as an argument to <code>foldp</code>:</p>\n\n<pre><code>foldp (update undefined) :: Eq a =&gt; Sample a -&gt; Signal a -&gt; Signal (Sample a)\n</code></pre>\n\n<p>Downstream signals could then ignore <code>Unchanged</code> values easily.</p>\n"}], "owner": {"reputation": 95, "user_id": 4957593, "user_type": "registered", "profile_image": "https://graph.facebook.com/10206347933204742/picture?type=large", "display_name": "Kira Ghandhi", "link": "https://stackoverflow.com/users/4957593/kira-ghandhi"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 127, "favorite_count": 0, "answer_count": 1, "score": 3, "last_activity_date": 1433121624, "creation_date": 1433099313, "question_id": 30561548, "link": "https://stackoverflow.com/questions/30561548/what-is-a-sample-in-helm", "title": "What is a Sample in Helm?", "body": "<p>There doesn't seem to be much documentation for <code>Sample a</code> in the Haskell FRP library Helm. I am trying to write a function similar to <a href=\"http://package.elm-lang.org/packages/elm-lang/core/2.0.1/Signal#sampleOn\" rel=\"nofollow\"><code>sample on</code></a> in Elm and I think <code>update</code> could help. However I am confused about how <code>update</code> works because, from the source code <a href=\"http://hackage.haskell.org/package/helm-0.7.0/docs/FRP-Helm-Sample.html\" rel=\"nofollow\">here</a>,  it seems that the variable <code>p</code> is not used at all.</p>\n\n<p>What should this function be doing and why is the input <code>p</code> included if it isn't used? Is there a better way to do this? I think <code>seq</code> could work, but I tried implementing my animation with <code>seq</code> and it doesn't do the thing I am looking for.</p>\n"}, {"tags": ["haskell", "types"], "comments": [{"owner": {"reputation": 35578, "user_id": 3000206, "user_type": "registered", "accept_rate": 98, "profile_image": "https://i.stack.imgur.com/BK1fo.jpg?s=128&g=1", "display_name": "Carcigenicate", "link": "https://stackoverflow.com/users/3000206/carcigenicate"}, "edited": false, "score": 3, "creation_date": 1433091023, "post_id": 30559935, "comment_id": 49191383, "body": "Make sure you always use a type signature when you define a function so the compiler knows exactly what you&#39;re talking about."}, {"owner": {"reputation": 100185, "user_id": 3234959, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/93bb12ca0f93dfddb33880316f7e66c2?s=128&d=identicon&r=PG&f=1", "display_name": "chi", "link": "https://stackoverflow.com/users/3234959/chi"}, "edited": false, "score": 0, "creation_date": 1433095864, "post_id": 30559935, "comment_id": 49193108, "body": "Indeed, adding type signatures often dramatically improves GHC error messages."}], "answers": [{"comments": [{"owner": {"reputation": 100185, "user_id": 3234959, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/93bb12ca0f93dfddb33880316f7e66c2?s=128&d=identicon&r=PG&f=1", "display_name": "chi", "link": "https://stackoverflow.com/users/3234959/chi"}, "edited": false, "score": 0, "creation_date": 1433093352, "post_id": 30560336, "comment_id": 49192247, "body": "A bit off topic: I wonder if that will be optimized in the case of e.g. a <code>Double-&gt;Double</code> conversion. I mean, it seems silly to convert <code>1e100</code> to <code>Integer</code> just to convert it back into a <code>Double</code>. This however seems the only way to perform the truncation."}], "tags": [], "owner": {"reputation": 23816, "user_id": 572606, "user_type": "registered", "accept_rate": 81, "profile_image": "https://www.gravatar.com/avatar/c20a126ad0dce40e8fc4a43456107919?s=128&d=identicon&r=PG", "display_name": "shang", "link": "https://stackoverflow.com/users/572606/shang"}, "is_accepted": true, "score": 4, "last_activity_date": 1433093014, "creation_date": 1433093014, "answer_id": 30560336, "question_id": 30559935, "link": "https://stackoverflow.com/questions/30559935/haskell-no-instance-arising/30560336#30560336", "title": "Haskell: No instance arising", "body": "<p>Haskell doesn't do <em>any</em> automatic coercion between different numeric types so if you e.g. compare <code>x == y</code> then <code>x</code> and <code>y</code> have to have the exact same type (e.g. both are ints or both are floats).</p>\n\n<p>Now, if you look at the type of <code>floor</code> it's</p>\n\n<pre><code>floor :: (Integral b, RealFrac a) =&gt; a -&gt; b\n</code></pre>\n\n<p>Which means that you can only call it for fractional types and result type must be an integral type.</p>\n\n<p>When you call <code>f 1.1</code> inside <code>f</code> you end up making the comparison</p>\n\n<pre><code>floor 1.1 == 1.1\n</code></pre>\n\n<p>But now you have a problem because <code>floor</code> can only return integral types and in order to make the comparison the result has to have the same type as <code>1.1</code> which is definitely not integral.</p>\n\n<p>You need to define <code>f</code> as</p>\n\n<pre><code>let f x = fromIntegral (floor x) == x\n</code></pre>\n\n<p>The <a href=\"http://hackage.haskell.org/package/base-4.8.0.0/docs/Prelude.html#v:fromIntegral\" rel=\"nofollow\"><code>fromIntegral</code></a> call coerces the integral floor value back into a fractional value so that it can be compared with the original <code>x</code>.</p>\n"}], "owner": {"reputation": 1028, "user_id": 1717752, "user_type": "registered", "accept_rate": 69, "profile_image": "https://www.gravatar.com/avatar/59df9ec4676523399b240b7009f91413?s=128&d=identicon&r=PG", "display_name": "ominug", "link": "https://stackoverflow.com/users/1717752/ominug"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 276, "favorite_count": 0, "accepted_answer_id": 30560336, "answer_count": 1, "score": 1, "last_activity_date": 1433093171, "creation_date": 1433090766, "last_edit_date": 1433091144, "question_id": 30559935, "link": "https://stackoverflow.com/questions/30559935/haskell-no-instance-arising", "title": "Haskell: No instance arising", "body": "<p>Beginning with Haskell, I frequently encounter problems with types (and less helpful error messages of GHC). I defined following function:</p>\n\n\n\n<pre class=\"lang-none prettyprint-override\"><code>ghci&gt; let f x = floor x == x\nghci&gt; :t f\nf :: (Integral a, RealFrac a) =&gt; a -&gt; Bool\n</code></pre>\n\n<p>which succeeds, but the invocation seams to be difficult:</p>\n\n<pre class=\"lang-none prettyprint-override\"><code>ghci&gt; let a = 1.1\nghci&gt; f a\n\n&lt;interactive&gt;:296:1:\n    No instance for (Integral Double) arising from a use of `f'\n    Possible fix: add an instance declaration for (Integral Double)\n    In the expression: f a\n    In an equation for `it': it = f a\nghci&gt; let b = 2\nghci&gt; f b\n\n&lt;interactive&gt;:298:1:\n    No instance for (RealFrac Integer) arising from a use of `f'\n    Possible fix: add an instance declaration for (RealFrac Integer)\n    In the expression: f b\n    In an equation for `it': it = f b\n</code></pre>\n\n<p>How to define the function correctly?</p>\n"}, {"tags": ["arrays", "haskell"], "comments": [{"owner": {"reputation": 198293, "user_id": 707111, "user_type": "moderator", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/oXZkh.jpg?s=128&g=1", "display_name": "Ry-", "link": "https://stackoverflow.com/users/707111/ry"}, "edited": false, "score": 1, "creation_date": 1433090815, "post_id": 30559685, "comment_id": 49191316, "body": "What do you expect <code>getIndex (putIndex emptyArray 1 3) 2</code> to be, rather than an error? You haven\u2019t put anything at index 2."}], "answers": [{"comments": [{"owner": {"reputation": 724, "user_id": 816544, "user_type": "registered", "accept_rate": 41, "profile_image": "https://www.gravatar.com/avatar/713b44c5bbcfeceee8b415dde781a19f?s=128&d=identicon&r=PG", "display_name": "froehli", "link": "https://stackoverflow.com/users/816544/froehli"}, "edited": false, "score": 0, "creation_date": 1433093628, "post_id": 30559955, "comment_id": 49192350, "body": "thanks for your reply. Your substitution helped to understand where the index comes from."}], "tags": [], "owner": {"reputation": 48129, "user_id": 76051, "user_type": "registered", "accept_rate": 91, "profile_image": "https://i.stack.imgur.com/AGDxz.jpg?s=128&g=1", "display_name": "Carsten", "link": "https://stackoverflow.com/users/76051/carsten"}, "is_accepted": false, "score": 4, "last_activity_date": 1433096724, "last_edit_date": 1433096724, "creation_date": 1433090844, "answer_id": 30559955, "question_id": 30559685, "link": "https://stackoverflow.com/questions/30559685/array-in-haskell-defined-with-type-not-data/30559955#30559955", "title": "Array in Haskell defined with type (not data)", "body": "<ol>\n<li><code>ar' :: Int -&gt; a</code></li>\n<li>always (there is only the <code>putIndex ar i v</code> pattern and this will match always)</li>\n<li>well <code>j == i</code> if you call the resulting function/array at index <code>i</code> (it's the <code>i</code> from the call to <code>putIndex</code> - <code>j</code> is the argument for the local function <code>ar'</code>)</li>\n<li>otherwise the <strong>old</strong> array/function <code>ar</code> is used (you see you change the array at just the index <code>i = j</code></li>\n<li>every index in <code>emptyArray</code> will generate an error - with <code>putIndex</code> you change this here for <code>i = 1</code> but afterwards you call it for <code>i= 2</code> so it will use the definition of <code>emptyArray</code> (your <code>otherwise</code> case above) which is the error</li>\n<li>same situation as in 5 but here you call it with <code>i = 1</code> which you <code>putIndex</code> to 3</li>\n</ol>\n\n<p>Maybe you understand it like this: <code>emptyArray</code> is a function that always <code>errors</code></p>\n\n<p>You can then use <code>putIndex</code> to get a new array/function based on it's first argument that will do just the same as this argument - only at index <code>i</code> it will now return <code>v</code> - for all other indizes <code>i</code> it will return <code>ar i</code> (the old function/array at <em>index</em> i). </p>\n\n<p><code>getIndex</code> really is just calling the function/array for <em>at an index</em> </p>\n\n<p>Here is why <code>getIndex (putIndex emptyArray 1 3) 2</code> is an error:</p>\n\n<pre><code>getIndex (putIndex emptyArray 1 3) 2\n= (putIndex emptyArray 1 3) 2\n{ inside putIndex you get i = 1, v = 3 and j = 2 here }\n= emptyIndex 2\n= error ...\n</code></pre>\n\n<p>but for <code>getIndex (putIndex emptyArray 1 3) 1</code> it's:</p>\n\n<pre><code>getIndex (putIndex emptyArray 1 3) 1\n= (putIndex emptyArray 1 3) 1\n{ inside putIndex you get i = 1, v = 3 and j = 1 here - so the `j == 1` case}\n= 3\n</code></pre>\n"}, {"comments": [{"owner": {"reputation": 724, "user_id": 816544, "user_type": "registered", "accept_rate": 41, "profile_image": "https://www.gravatar.com/avatar/713b44c5bbcfeceee8b415dde781a19f?s=128&d=identicon&r=PG", "display_name": "froehli", "link": "https://stackoverflow.com/users/816544/froehli"}, "edited": false, "score": 0, "creation_date": 1433094003, "post_id": 30560042, "comment_id": 49192482, "body": "Thanks for your reply. The substitution helps a lot. So in this example an array is a cascade of <code>putIndex</code> functions and a <code>getIndex</code>call just specifies the <code>j</code> value to look through the  <code>if-then-else</code>construct. Which means that an <code>emptyArray foo</code> call will always appear (and fire an error) if no <code>putIndex foo array</code> call was done."}, {"owner": {"reputation": 51584, "user_id": 839246, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/9b0573c2b936b12828dd1e4cc04206dc?s=128&d=identicon&r=PG&f=1", "display_name": "bheklilr", "link": "https://stackoverflow.com/users/839246/bheklilr"}, "reply_to_user": {"reputation": 724, "user_id": 816544, "user_type": "registered", "accept_rate": 41, "profile_image": "https://www.gravatar.com/avatar/713b44c5bbcfeceee8b415dde781a19f?s=128&d=identicon&r=PG", "display_name": "froehli", "link": "https://stackoverflow.com/users/816544/froehli"}, "edited": false, "score": 0, "creation_date": 1433095535, "post_id": 30560042, "comment_id": 49192999, "body": "@froehli Correct, it&#39;s a big chain of if statements until <code>emptyArray</code> is hit."}], "tags": [], "owner": {"reputation": 51584, "user_id": 839246, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/9b0573c2b936b12828dd1e4cc04206dc?s=128&d=identicon&r=PG&f=1", "display_name": "bheklilr", "link": "https://stackoverflow.com/users/839246/bheklilr"}, "is_accepted": true, "score": 6, "last_activity_date": 1433091345, "creation_date": 1433091345, "answer_id": 30560042, "question_id": 30559685, "link": "https://stackoverflow.com/questions/30559685/array-in-haskell-defined-with-type-not-data/30560042#30560042", "title": "Array in Haskell defined with type (not data)", "body": "<p>Instead of answering all of your questions directly, I'll try to give an explanation to the rationale behind the <code>Array a</code> type here.</p>\n\n<p>Arrays can be thought of as a data structure that has particular properties, namely that given an index it can return a value associated with that index.  This means that we can characterize an array by describing what values are associated with particular indexes, and this sounds very much like a function mapping an input (the index) to an output (the value at that index).  Hence, an array can be thought of as no different from a function, provided you don't want to know the length or what indices are valid.  This is a rather limiting definition of an array, but as a learning exercise it's important to see how data structures can be turned into functions by considering what their most important operations are.</p>\n\n<blockquote>\n  <p>what is the type of <code>ar'</code></p>\n</blockquote>\n\n<p>Look at the type signature:</p>\n\n<pre><code>putIndex :: Array a -&gt; Int -&gt; a -&gt; Array a\nputIndex    ar         i      v  = ar'\n</code></pre>\n\n<p>So <code>ar :: Array a</code>, <code>i :: Int</code>, <code>v</code> :: a<code>, and</code>ar' :: Array a`.</p>\n\n<blockquote>\n  <p>when does the <code>ar'</code> pattern match?</p>\n</blockquote>\n\n<p>I assume you mean when does the definition of <code>ar'</code> get used.  <code>ar'</code> is an <code>Array a</code>, which means it's a function <code>Int -&gt; a</code>.  Which means it gets used whenever <code>getIndex</code> is called on it.</p>\n\n<blockquote>\n  <p>when is <code>j == i</code>?  <code>v</code> is the type of <code>a</code>?  In that case it would not return an array</p>\n</blockquote>\n\n<p>Look carefully at the definition of <code>putIndex</code>.  <code>ar'</code> is the return value of <code>putIndex</code>, not <code>v</code>.  <code>v</code> is the return value of <code>ar'</code> when <code>j == i</code>.  <code>v</code> has type <code>a</code>, as you can tell from the type signature of <code>putIndex</code>.  <code>putIndex</code> is a function that augments an existing function <code>ar</code>, by adding a check first for when <code>i == j</code>.</p>\n\n<blockquote>\n  <p>what happens in <code>otherwise = ar j</code></p>\n</blockquote>\n\n<p>If <code>j /= i</code>, then instead of returning <code>v</code> (the new value being associated with the index <code>i</code>), it looks up the value at index <code>j</code> in the original <code>ar</code>.  This might be more clearly stated as</p>\n\n<pre><code>putIndex originalArray indexToSet newValue = newArray\n    where\n        newArray j\n            | j == indexToSet = newValue\n            | otherwise       = getIndex originalArray j\n</code></pre>\n\n<blockquote>\n  <p>why does <code>getIndex (putIndex emptyArray 1 3) 2</code> generate an error?</p>\n</blockquote>\n\n<p>Essentially, you can turn index lookup into a bunch of nested if statements:</p>\n\n<pre><code>putIndex emptyArray i0 x0  ==&gt;  \\i -&gt; if i == i0\n                                    then x0\n                                    else emptyArray i\n\nputIndex (\n    putIndex emptyArray i0 x0\n    ) i1 x1                ==&gt;  \\i -&gt; if i == i1\n                                    then x1\n                                    else if i == i0\n                                            then x0\n                                            else emptyArray i\n\nputIndex (\n    putIndex (\n        putIndex emptyArray i0 x0\n        ) i1 x1\n    ) i2 x2                ==&gt;  \\i -&gt; if i == i2\n                                    then x2\n                                    else if i == i1\n                                            then x1\n                                            else if i == i0\n                                                    then x0\n                                                    else emptyArray i\n</code></pre>\n\n<p>And so on, adding a new layer of <code>if-then-else</code> for every new <code>putIndex</code>.  For your specific example</p>\n\n<pre><code>putIndex emptyArray 1 3  ==&gt;  \\i -&gt; if i == 1\n                                    then 3\n                                    else emptyArray i\n</code></pre>\n\n<p>Then</p>\n\n<pre><code>getIndex (putIndex emptyArray 1 3) 2\n</code></pre>\n\n<p>is equivalent to the expression</p>\n\n<pre><code>if 2 == 1 then 3 else emptyArray 2\n</code></pre>\n"}], "owner": {"reputation": 724, "user_id": 816544, "user_type": "registered", "accept_rate": 41, "profile_image": "https://www.gravatar.com/avatar/713b44c5bbcfeceee8b415dde781a19f?s=128&d=identicon&r=PG", "display_name": "froehli", "link": "https://stackoverflow.com/users/816544/froehli"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 177, "favorite_count": 0, "accepted_answer_id": 30560042, "answer_count": 2, "score": 3, "last_activity_date": 1433096724, "creation_date": 1433089333, "last_edit_date": 1433092298, "question_id": 30559685, "link": "https://stackoverflow.com/questions/30559685/array-in-haskell-defined-with-type-not-data", "title": "Array in Haskell defined with type (not data)", "body": "<pre><code>type Array a = Int -&gt; a\n\nemptyArray :: Array a\nemptyArray i =\n  error (\"Access to non-initialized index \" ++ show i)\n\nputIndex :: Array a -&gt; Int -&gt; a -&gt; Array a\nputIndex ar i v = ar'\n where ar' j | j==i      = v\n             | otherwise = ar j\n\ngetIndex :: Array a -&gt; Int -&gt; a\ngetIndex a i = (a i)\n</code></pre>\n\n<p>I don't understand the <code>emptyArray</code> and <code>putIndex</code> function. \nProblems are:</p>\n\n<ul>\n<li>what is the type of ar'</li>\n<li>when does the ar' pattern match?</li>\n<li>when is <code>j==i</code>?\n<ul>\n<li><code>v</code> is of the type <code>a</code> or? In that case it would not return an array.</li>\n</ul></li>\n<li>what happens in otherwise = ar j</li>\n<li>why does  <code>getIndex (putIndex emptyArray 1 3) 2</code> generate an error\n<ul>\n<li><code>getIndex (putIndex emptyArray 1 3) 1</code> returning 3 seems to be clear.</li>\n</ul></li>\n</ul>\n"}, {"tags": ["haskell", "ghc", "hsqml"], "answers": [{"tags": [], "owner": {"reputation": 18456, "user_id": 1198559, "user_type": "registered", "accept_rate": 70, "profile_image": "https://i.stack.imgur.com/bOjLe.png?s=128&g=1", "display_name": "jhegedus", "link": "https://stackoverflow.com/users/1198559/jhegedus"}, "is_accepted": false, "score": 1, "last_activity_date": 1433087611, "creation_date": 1433087611, "answer_id": 30559395, "question_id": 30559182, "link": "https://stackoverflow.com/questions/30559182/opengl-2-9-2-0-fails-to-compile-with-ghc-7-10-1/30559395#30559395", "title": "OpenGL-2.9.2.0 fails to compile with ghc 7.10.1", "body": "<p>OK, this is for the old version of OpenGL only. Newer versions should build ok. <a href=\"https://travis-ci.org/haskell-opengl/OpenGL\" rel=\"nofollow\">https://travis-ci.org/haskell-opengl/OpenGL</a></p>\n"}], "owner": {"reputation": 18456, "user_id": 1198559, "user_type": "registered", "accept_rate": 70, "profile_image": "https://i.stack.imgur.com/bOjLe.png?s=128&g=1", "display_name": "jhegedus", "link": "https://stackoverflow.com/users/1198559/jhegedus"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 66, "favorite_count": 0, "answer_count": 1, "score": 1, "last_activity_date": 1433087611, "creation_date": 1433086257, "question_id": 30559182, "link": "https://stackoverflow.com/questions/30559182/opengl-2-9-2-0-fails-to-compile-with-ghc-7-10-1", "title": "OpenGL-2.9.2.0 fails to compile with ghc 7.10.1", "body": "<p>Any idea what causing this ? And how can one fix it ?</p>\n\n<pre><code>joco@vm001:~$ cabal install hsqml-demo-samples\nResolving dependencies...\nConfiguring OpenGL-2.9.2.0...\nBuilding OpenGL-2.9.2.0...\nFailed to install OpenGL-2.9.2.0\nBuild log ( /home/joco/.cabal/logs/OpenGL-2.9.2.0.log ):\nConfiguring OpenGL-2.9.2.0...\nBuilding OpenGL-2.9.2.0...\nPreprocessing library OpenGL-2.9.2.0...\n[  1 of 117] Compiling Graphics.Rendering.OpenGL.GL.VertexAttributes ( Graphics/Rendering/OpenGL/GL/VertexAttributes.hs, dist/build/Graphics/Rendering/OpenGL/GL/VertexAttributes.o )\n\nGraphics/Rendering/OpenGL/GL/VertexAttributes.hs:25:1: Warning:\n    The import of \u2018Control.Applicative\u2019 is redundant\n      except perhaps to import instances from \u2018Control.Applicative\u2019\n    To import instances alone, use: import Control.Applicative()\n[  2 of 117] Compiling Graphics.Rendering.OpenGL.GL.Texturing.Filter ( Graphics/Rendering/OpenGL/GL/Texturing/Filter.hs, dist/build/Graphics/Rendering/OpenGL/GL/Texturing/Filter.o )\n[  3 of 117] Compiling Graphics.Rendering.OpenGL.GL.PointParameter ( Graphics/Rendering/OpenGL/GL/PointParameter.hs, dist/build/Graphics/Rendering/OpenGL/GL/PointParameter.o )\n[  4 of 117] Compiling Graphics.Rendering.OpenGL.GL.PixelFormat ( Graphics/Rendering/OpenGL/GL/PixelFormat.hs, dist/build/Graphics/Rendering/OpenGL/GL/PixelFormat.o )\n[  5 of 117] Compiling Graphics.Rendering.OpenGL.GL.ComparisonFunction ( Graphics/Rendering/OpenGL/GL/ComparisonFunction.hs, dist/build/Graphics/Rendering/OpenGL/GL/ComparisonFunction.o )\n[  6 of 117] Compiling Graphics.Rendering.OpenGL.GL.BlendingFactor ( Graphics/Rendering/OpenGL/GL/BlendingFactor.hs, dist/build/Graphics/Rendering/OpenGL/GL/BlendingFactor.o )\n[  7 of 117] Compiling Graphics.Rendering.OpenGL.GL.Texturing.PixelInternalFormat ( Graphics/Rendering/OpenGL/GL/Texturing/PixelInternalFormat.hs, dist/build/Graphics/Rendering/OpenGL/GL/Texturing/PixelInternalFormat.o )\n[  8 of 117] Compiling Graphics.Rendering.OpenGL.GL.FramebufferObjects.FramebufferTarget ( Graphics/Rendering/OpenGL/GL/FramebufferObjects/FramebufferTarget.hs, dist/build/Graphics/Rendering/OpenGL/GL/FramebufferObjects/FramebufferTarget.o )\n[  9 of 117] Compiling Graphics.Rendering.OpenGL.GL.BufferMode ( Graphics/Rendering/OpenGL/GL/BufferMode.hs, dist/build/Graphics/Rendering/OpenGL/GL/BufferMode.o )\n[ 10 of 117] Compiling Graphics.Rendering.OpenGL.GL.IOState ( Graphics/Rendering/OpenGL/GL/IOState.hs, dist/build/Graphics/Rendering/OpenGL/GL/IOState.o )\n\nGraphics/Rendering/OpenGL/GL/IOState.hs:32:10:\n    No instance for (Applicative (IOState s))\n      arising from the superclasses of an instance declaration\n    In the instance declaration for \u2018Monad (IOState s)\u2019\n\nGraphics/Rendering/OpenGL/GL/IOState.hs:45:4:\n    Could not deduce (Applicative (IOState a))\n      arising from a do statement\n    from the context (Storable a)\n      bound by the type signature for\n                 peekIOState :: Storable a =&gt; IOState a a\n      at Graphics/Rendering/OpenGL/GL/IOState.hs:43:16-40\n    In a stmt of a 'do' block: ptr &lt;- getIOState\n    In the expression:\n      do { ptr &lt;- getIOState;\n           x &lt;- liftIOState $ peek ptr;\n           putIOState (ptr `plusPtr` sizeOf x);\n           return x }\n    In an equation for \u2018peekIOState\u2019:\n        peekIOState\n          = do { ptr &lt;- getIOState;\n                 x &lt;- liftIOState $ peek ptr;\n                 putIOState (ptr `plusPtr` sizeOf x);\n                 .... }\n\nGraphics/Rendering/OpenGL/GL/IOState.hs:57:12:\n    Could not deduce (Applicative (IOState b))\n      arising from a use of \u2018replicateM\u2019\n    from the context (Integral a)\n      bound by the type signature for\n                 nTimes :: Integral a =&gt; a -&gt; IOState b c -&gt; IOState b [c]\n      at Graphics/Rendering/OpenGL/GL/IOState.hs:56:11-57\n    In the expression: replicateM (fromIntegral n)\n    In an equation for \u2018nTimes\u2019: nTimes n = replicateM (fromIntegral n)\ncabal: Error: some packages failed to install:\nOpenGL-2.9.2.0 failed during the building phase. The exception was:\nExitFailure 1\nhsqml-demo-samples-0.3.3.0 depends on OpenGL-2.9.2.0 which failed to install.\n</code></pre>\n"}, {"tags": ["haskell", "cabal", "cabal-install", "stackage"], "comments": [{"owner": {"reputation": 31301, "user_id": 1598537, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/c214754fba6f3a238a93af85a0ab4f58?s=128&d=identicon&r=PG", "display_name": "AndrewC", "link": "https://stackoverflow.com/users/1598537/andrewc"}, "edited": false, "score": 3, "creation_date": 1433194468, "post_id": 30557459, "comment_id": 49237165, "body": "You may find <a href=\"https://www.fpcomplete.com/blog/2015/04/announcing-lts-2\" rel=\"nofollow noreferrer\">this blog post about stackage 2.0</a> and it&#39;s links helpful if you&#39;re unfamiliar with stackage. I agree with <a href=\"http://stackoverflow.com/questions/30557459/my-installed-transformers-version-is-not-considered-by-cabal-install#comment49187290_30557659\">Sibi&#39;s advice below</a>"}], "answers": [{"comments": [{"owner": {"reputation": 43759, "user_id": 1651941, "user_type": "registered", "accept_rate": 97, "profile_image": "https://www.gravatar.com/avatar/a513bc1fa519d2fcf5e4e0d9b5500101?s=128&d=identicon&r=PG", "display_name": "Sibi", "link": "https://stackoverflow.com/users/1651941/sibi"}, "edited": false, "score": 5, "creation_date": 1433077399, "post_id": 30557659, "comment_id": 49187075, "body": "Note that this is not the recommended approach. Stackage is a curated set of packages that are know to build properly. Replacing their transformers with some random version may lead to breakage."}, {"owner": {"reputation": 3185, "user_id": 241899, "user_type": "registered", "accept_rate": 92, "profile_image": "https://www.gravatar.com/avatar/56dfa400a964081e78a0be24978e7cdf?s=128&d=identicon&r=PG", "display_name": "Vitaly Olegovitch", "link": "https://stackoverflow.com/users/241899/vitaly-olegovitch"}, "reply_to_user": {"reputation": 43759, "user_id": 1651941, "user_type": "registered", "accept_rate": 97, "profile_image": "https://www.gravatar.com/avatar/a513bc1fa519d2fcf5e4e0d9b5500101?s=128&d=identicon&r=PG", "display_name": "Sibi", "link": "https://stackoverflow.com/users/1651941/sibi"}, "edited": false, "score": 0, "creation_date": 1433077645, "post_id": 30557659, "comment_id": 49187152, "body": "@Sibi what is the recommended approach?"}, {"owner": {"reputation": 43759, "user_id": 1651941, "user_type": "registered", "accept_rate": 97, "profile_image": "https://www.gravatar.com/avatar/a513bc1fa519d2fcf5e4e0d9b5500101?s=128&d=identicon&r=PG", "display_name": "Sibi", "link": "https://stackoverflow.com/users/1651941/sibi"}, "edited": false, "score": 4, "creation_date": 1433078068, "post_id": 30557659, "comment_id": 49187290, "body": "To use the stackage packages as it is. If you have some global package causing problem, then I would remove them and use stackage exclusively. Also using sandbox for each project is a good idea."}, {"owner": {"reputation": 3185, "user_id": 241899, "user_type": "registered", "accept_rate": 92, "profile_image": "https://www.gravatar.com/avatar/56dfa400a964081e78a0be24978e7cdf?s=128&d=identicon&r=PG", "display_name": "Vitaly Olegovitch", "link": "https://stackoverflow.com/users/241899/vitaly-olegovitch"}, "reply_to_user": {"reputation": 43759, "user_id": 1651941, "user_type": "registered", "accept_rate": 97, "profile_image": "https://www.gravatar.com/avatar/a513bc1fa519d2fcf5e4e0d9b5500101?s=128&d=identicon&r=PG", "display_name": "Sibi", "link": "https://stackoverflow.com/users/1651941/sibi"}, "edited": false, "score": 0, "creation_date": 1433078786, "post_id": 30557659, "comment_id": 49187501, "body": "@Sibi could you please provide me a link to some web page (or article, or book) where this is explained?"}, {"owner": {"reputation": 44013, "user_id": 1477667, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/trgKM.jpg?s=128&g=1", "display_name": "dfeuer", "link": "https://stackoverflow.com/users/1477667/dfeuer"}, "edited": false, "score": 2, "creation_date": 1433131209, "post_id": 30557659, "comment_id": 49201807, "body": "<code>transformers</code> sits <i>very</i> far down in the package dependency structure. I believe it depends only on <code>base</code>; I imagine a large majority of packages on Hackage depend, directly or indirectly, on it. If you upgrade <code>transformers</code>, practically every dependency in the system will go screwy, which is the opposite of what you&#39;re going for if you&#39;re using Stackage."}, {"owner": {"reputation": 3185, "user_id": 241899, "user_type": "registered", "accept_rate": 92, "profile_image": "https://www.gravatar.com/avatar/56dfa400a964081e78a0be24978e7cdf?s=128&d=identicon&r=PG", "display_name": "Vitaly Olegovitch", "link": "https://stackoverflow.com/users/241899/vitaly-olegovitch"}, "reply_to_user": {"reputation": 44013, "user_id": 1477667, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/trgKM.jpg?s=128&g=1", "display_name": "dfeuer", "link": "https://stackoverflow.com/users/1477667/dfeuer"}, "edited": false, "score": 1, "creation_date": 1433150005, "post_id": 30557659, "comment_id": 49209625, "body": "@dfeuer thank you. Is there a way to make <code>cabal</code> see the installed <code>transformers</code> version in situations like mine? Do I have to provide more information to debug that? If yes, which information?"}, {"owner": {"reputation": 44013, "user_id": 1477667, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/trgKM.jpg?s=128&g=1", "display_name": "dfeuer", "link": "https://stackoverflow.com/users/1477667/dfeuer"}, "edited": false, "score": 0, "creation_date": 1433159229, "post_id": 30557659, "comment_id": 49215339, "body": "@VitalijZadneprovskij, I&#39;m no cabal expert."}], "tags": [], "owner": {"reputation": 3185, "user_id": 241899, "user_type": "registered", "accept_rate": 92, "profile_image": "https://www.gravatar.com/avatar/56dfa400a964081e78a0be24978e7cdf?s=128&d=identicon&r=PG", "display_name": "Vitaly Olegovitch", "link": "https://stackoverflow.com/users/241899/vitaly-olegovitch"}, "is_accepted": true, "score": 1, "last_activity_date": 1433782708, "last_edit_date": 1433782708, "creation_date": 1433076809, "answer_id": 30557659, "question_id": 30557459, "link": "https://stackoverflow.com/questions/30557459/my-installed-transformers-version-is-not-considered-by-cabal-install/30557659#30557659", "title": "My installed transformers version is not considered by cabal-install", "body": "<p>The reason of the problem was that my GHC was too old. I downloaded a newer version and solved the problem.</p>\n\n<p><strong>Failed (and wrong) attempt</strong></p>\n\n<p>You should have a <code>cabal.config</code> file in your current directory. Open it with any text editor and serach for the <code>transformers installed</code> string.</p>\n\n<p>Once you have found it, replace it with <code>transformers ==0.4.3.0</code> or any other version you like.</p>\n\n<p>It is a bad solution, because, as dfeurer writes:</p>\n\n<blockquote>\n  <p><code>transformers</code> sits very far down in the package dependency structure. I\n  believe it depends only on <code>base</code>; I imagine a large majority of\n  packages on Hackage depend, directly or indirectly, on it. If you\n  upgrade <code>transformers</code>, practically every dependency in the system will\n  go screwy, which is the opposite of what you're going for if you're\n  using Stackage.</p>\n</blockquote>\n\n<hr>\n\n<p><strong>Clean solution by Sibi</strong></p>\n\n<p>Use the stackage packages as it is. If you have some global package causing problem, then remove them and use stackage exclusively. Also using sandbox for each project is a good idea.</p>\n"}, {"comments": [{"owner": {"reputation": 3185, "user_id": 241899, "user_type": "registered", "accept_rate": 92, "profile_image": "https://www.gravatar.com/avatar/56dfa400a964081e78a0be24978e7cdf?s=128&d=identicon&r=PG", "display_name": "Vitaly Olegovitch", "link": "https://stackoverflow.com/users/241899/vitaly-olegovitch"}, "edited": false, "score": 0, "creation_date": 1433780839, "post_id": 30574830, "comment_id": 49486283, "body": "That does not solve the problem, see my secondo attempt in my question"}], "tags": [], "owner": {"reputation": 827, "user_id": 1276388, "user_type": "registered", "accept_rate": 93, "profile_image": "https://www.gravatar.com/avatar/4ae985df9e533570f5ac2ea9bfc25dfd?s=128&d=identicon&r=PG", "display_name": "\u0397\u03bb\u03b5\u03ba\u03c4\u03c1\u03bf\u03bb\u03cc\u03b3\u03bf\u03c2 \u039c\u03b7\u03c7\u03b1\u03bd\u03b9\u03ba\u03cc\u03c2", "link": "https://stackoverflow.com/users/1276388/%ce%97%ce%bb%ce%b5%ce%ba%cf%84%cf%81%ce%bf%ce%bb%cf%8c%ce%b3%ce%bf%cf%82-%ce%9c%ce%b7%cf%87%ce%b1%ce%bd%ce%b9%ce%ba%cf%8c%cf%82"}, "is_accepted": false, "score": 1, "last_activity_date": 1433165274, "creation_date": 1433165274, "answer_id": 30574830, "question_id": 30557459, "link": "https://stackoverflow.com/questions/30557459/my-installed-transformers-version-is-not-considered-by-cabal-install/30574830#30574830", "title": "My installed transformers version is not considered by cabal-install", "body": "<p>Try this <code>cabal install alex --allow-newer</code></p>\n"}], "owner": {"reputation": 3185, "user_id": 241899, "user_type": "registered", "accept_rate": 92, "profile_image": "https://www.gravatar.com/avatar/56dfa400a964081e78a0be24978e7cdf?s=128&d=identicon&r=PG", "display_name": "Vitaly Olegovitch", "link": "https://stackoverflow.com/users/241899/vitaly-olegovitch"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 306, "favorite_count": 1, "accepted_answer_id": 30557659, "answer_count": 2, "score": 3, "last_activity_date": 1433782708, "creation_date": 1433075503, "last_edit_date": 1495540706, "question_id": 30557459, "link": "https://stackoverflow.com/questions/30557459/my-installed-transformers-version-is-not-considered-by-cabal-install", "title": "My installed transformers version is not considered by cabal-install", "body": "<p>I am totally new to Haskell an cabal and I'm trying to make yesod work.</p>\n\n<p>My cabal version is cabal-install version 1.20.0.3\nusing version 1.20.0.2 of the Cabal library </p>\n\n<p>This is what happends when I tru to install alex:</p>\n\n<pre><code>$ cabal install alex\nResolving dependencies...\ncabal: Could not resolve dependencies:\ntrying: alex-3.1.4 (user goal)\nnext goal: QuickCheck (dependency of alex-3.1.4)\nrejecting: QuickCheck-2.8.1, 2.8 (global constraint requires ==2.7.6)\ntrying: QuickCheck-2.7.6\nnext goal: transformers (dependency of QuickCheck-2.7.6)\nrejecting: transformers-0.4.3.0, 0.4.2.0, 0.4.1.0, 0.3.0.0, 0.2.2.1, 0.2.2.0,\n0.2.1.0, 0.2.0.0, 0.1.4.0, 0.1.3.0, 0.1.1.0, 0.1.0.1, 0.1.0.0, 0.0.1.0,\n0.0.0.0, 0.4.0.0 (global constraint requires installed instance)\nDependency tree exhaustively searched.\n</code></pre>\n\n<p>Second attempt:</p>\n\n<pre><code>$ cabal install alex happy yesod-bin --allow-newer\nResolving dependencies...\ncabal: Could not resolve dependencies:\ntrying: alex-3.1.4 (user goal)\ntrying: QuickCheck-2.7.6/installed-1a8... (dependency of alex-3.1.4)\ntrying: tf-random-0.5/installed-ef3... (dependency of\nQuickCheck-2.7.6/installed-1a8...)\nnext goal: primitive (dependency of tf-random-0.5/installed-ef3...)\nrejecting: primitive-0.5.0.1/installed-8e5... (global constraint requires\n==0.6)\nrejecting: primitive-0.6 (conflict: tf-random =&gt;\nprimitive==0.5.0.1/installed-8e5...)\nrejecting: primitive-0.5.4.0, 0.5.3.0, 0.5.2.1, 0.5.1.0, 0.5.0.1, 0.5, 0.4.1,\n0.4.0.1, 0.4, 0.3.1, 0.3, 0.2.1, 0.2, 0.1 (global constraint requires ==0.6)\nDependency tree exhaustively searched.\n</code></pre>\n\n<p>What do I have to do to install alex?</p>\n\n<p>A related question is this one:\n<a href=\"https://stackoverflow.com/questions/28745558/cabal-install-global-constraint-requires-installed-instance\">cabal install --- global constraint requires installed instance</a></p>\n\n<p>The comment by @kosmikus on that question is:</p>\n\n<blockquote>\n  <p>So the Stackage LTS config file contains the constraint transformers\n  installed, meaning that only an already present version of\n  transformers can be used. This is reasonable, because GHC ships with a\n  specific version of transformers. For ghc-7.8, this is\n  transformers-0.3.0.0. For some reason, this installed version is not\n  considered by cabal-install. Your partial log doesn't contain\n  sufficient info to see why.</p>\n</blockquote>\n\n<p>How can I fix my Stackage LTS config file? Where is it on Ubuntu?</p>\n"}, {"tags": ["multithreading", "haskell", "memory", "garbage-collection", "ghc"], "comments": [{"owner": {"reputation": 58792, "user_id": 1006010, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/f683d229f3673c9dcc3f3f2796d75c09?s=128&d=identicon&r=PG", "display_name": "MathematicalOrchid", "link": "https://stackoverflow.com/users/1006010/mathematicalorchid"}, "edited": false, "score": 0, "creation_date": 1433151622, "post_id": 30556582, "comment_id": 49210613, "body": "What&#39;s your actual <i>question</i>? How to reduce memory usage?"}, {"owner": {"reputation": 721, "user_id": 2512324, "user_type": "registered", "accept_rate": 76, "profile_image": "https://www.gravatar.com/avatar/f9d51819edf28a5befe8b255e51d95d7?s=128&d=identicon&r=PG", "display_name": "user2512324", "link": "https://stackoverflow.com/users/2512324/user2512324"}, "reply_to_user": {"reputation": 58792, "user_id": 1006010, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/f683d229f3673c9dcc3f3f2796d75c09?s=128&d=identicon&r=PG", "display_name": "MathematicalOrchid", "link": "https://stackoverflow.com/users/1006010/mathematicalorchid"}, "edited": false, "score": 0, "creation_date": 1433152942, "post_id": 30556582, "comment_id": 49211453, "body": "Broadly yes. More specifically if I could find a way to enable per thread GC strategy in GHC."}, {"owner": {"reputation": 58792, "user_id": 1006010, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/f683d229f3673c9dcc3f3f2796d75c09?s=128&d=identicon&r=PG", "display_name": "MathematicalOrchid", "link": "https://stackoverflow.com/users/1006010/mathematicalorchid"}, "edited": false, "score": 0, "creation_date": 1433153903, "post_id": 30556582, "comment_id": 49212047, "body": "I was under the impression that recent versions of GHC <i>already</i> do per-thread GC, but I may be wrong about that..."}, {"owner": {"reputation": 721, "user_id": 2512324, "user_type": "registered", "accept_rate": 76, "profile_image": "https://www.gravatar.com/avatar/f9d51819edf28a5befe8b255e51d95d7?s=128&d=identicon&r=PG", "display_name": "user2512324", "link": "https://stackoverflow.com/users/2512324/user2512324"}, "reply_to_user": {"reputation": 58792, "user_id": 1006010, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/f683d229f3673c9dcc3f3f2796d75c09?s=128&d=identicon&r=PG", "display_name": "MathematicalOrchid", "link": "https://stackoverflow.com/users/1006010/mathematicalorchid"}, "edited": false, "score": 0, "creation_date": 1433157148, "post_id": 30556582, "comment_id": 49213988, "body": "I believe GHC uses a mark and sweep strategy. It uses a generational mechanism to manage memory. Please correct me if I am wrong."}, {"owner": {"reputation": 58792, "user_id": 1006010, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/f683d229f3673c9dcc3f3f2796d75c09?s=128&d=identicon&r=PG", "display_name": "MathematicalOrchid", "link": "https://stackoverflow.com/users/1006010/mathematicalorchid"}, "edited": false, "score": 0, "creation_date": 1433172782, "post_id": 30556582, "comment_id": 49225066, "body": "It&#39;s definitely generational, and I believe it&#39;s mark/sweep. However, I was under the impression that the youngest generation is per-core. I will see if I can find an actual reference for that though."}, {"owner": {"reputation": 721, "user_id": 2512324, "user_type": "registered", "accept_rate": 76, "profile_image": "https://www.gravatar.com/avatar/f9d51819edf28a5befe8b255e51d95d7?s=128&d=identicon&r=PG", "display_name": "user2512324", "link": "https://stackoverflow.com/users/2512324/user2512324"}, "reply_to_user": {"reputation": 58792, "user_id": 1006010, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/f683d229f3673c9dcc3f3f2796d75c09?s=128&d=identicon&r=PG", "display_name": "MathematicalOrchid", "link": "https://stackoverflow.com/users/1006010/mathematicalorchid"}, "edited": false, "score": 0, "creation_date": 1433185032, "post_id": 30556582, "comment_id": 49232071, "body": "For a web server like use cases where a thread is spawned for every request, per thread memory cleanup strategy seems to be a reasonable strategy."}], "answers": [{"tags": [], "owner": {"reputation": 58792, "user_id": 1006010, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/f683d229f3673c9dcc3f3f2796d75c09?s=128&d=identicon&r=PG", "display_name": "MathematicalOrchid", "link": "https://stackoverflow.com/users/1006010/mathematicalorchid"}, "is_accepted": false, "score": 1, "last_activity_date": 1433264866, "creation_date": 1433264866, "answer_id": 30602364, "question_id": 30556582, "link": "https://stackoverflow.com/questions/30556582/ghc-per-thread-gc-strategy/30602364#30602364", "title": "GHC per thread GC strategy", "body": "<p><a href=\"http://community.haskell.org/~simonmar/papers/local-gc.pdf\" rel=\"nofollow\">http://community.haskell.org/~simonmar/papers/local-gc.pdf</a></p>\n\n<p>This paper by Simon Marlow describes per-thread local heaps, and claims that this was implemented in GHC. It's dated 2011. I can't be sure if this is what the current version of GHC actually does (i.e., did this go into the release version of GHC, is it still the current status quo, etc.), but it seems my recollection wasn't completely made up.</p>\n\n<p>I will also point out the section of the GHC manual that explains the settings you can twiddle to adjust the garbage collector:</p>\n\n<p><a href=\"https://downloads.haskell.org/~ghc/latest/docs/html/users_guide/runtime-control.html#rts-options-gc\" rel=\"nofollow\">https://downloads.haskell.org/~ghc/latest/docs/html/users_guide/runtime-control.html#rts-options-gc</a></p>\n\n<p>In particular, by default GHC uses a 2-space collector, but adding the <code>-c</code> RTS option makes it use a slightly slower 1-space collector, which should eat less RAM. (I'm entirely unclear which generation(s) this information applies to.)</p>\n\n<p>I get the impression Simon Marlow is the guy who does most of the RTS stuff (including the garbage collector), so if you can find him on IRC, he's the guy to ask if you want the direct truth...</p>\n"}], "owner": {"reputation": 721, "user_id": 2512324, "user_type": "registered", "accept_rate": 76, "profile_image": "https://www.gravatar.com/avatar/f9d51819edf28a5befe8b255e51d95d7?s=128&d=identicon&r=PG", "display_name": "user2512324", "link": "https://stackoverflow.com/users/2512324/user2512324"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 382, "favorite_count": 1, "answer_count": 1, "score": 7, "last_activity_date": 1433264866, "creation_date": 1433069773, "last_edit_date": 1495542671, "question_id": 30556582, "link": "https://stackoverflow.com/questions/30556582/ghc-per-thread-gc-strategy", "title": "GHC per thread GC strategy", "body": "<p>I have a <a href=\"https://hackage.haskell.org/package/scotty\" rel=\"nofollow noreferrer\">Scotty</a> api server which constructs an <a href=\"http://elasticsearch.org\" rel=\"nofollow noreferrer\">Elasticsearch</a> query, fetches results from <a href=\"http://elasticsearch.org\" rel=\"nofollow noreferrer\">ES</a> and renders the json.</p>\n\n<p>In comparison to other servers like <a href=\"http://www.phoenixframework.org\" rel=\"nofollow noreferrer\">Phoenix</a> and <a href=\"https://gin-gonic.github.io/gin/\" rel=\"nofollow noreferrer\">Gin</a>, I'm getting higher CPU utilization and throughput for serving <a href=\"http://elasticsearch.org\" rel=\"nofollow noreferrer\">ES</a> responses by using <a href=\"https://github.com/bitemyapp/bloodhound\" rel=\"nofollow noreferrer\">BloodHound</a> but <a href=\"https://gin-gonic.github.io/gin/\" rel=\"nofollow noreferrer\">Gin</a> and <a href=\"http://www.phoenixframework.org\" rel=\"nofollow noreferrer\">Phoenix</a> were magnitudes better than <a href=\"https://hackage.haskell.org/package/scotty\" rel=\"nofollow noreferrer\">Scotty</a> in memory efficiency. </p>\n\n<p>Stats for Scotty</p>\n\n<pre><code> wrk -t30 -c100 -d30s \"http://localhost:3000/filters?apid=1&amp;hfa=true\"\nRunning 30s test @ http://localhost:3000/filters?apid=1&amp;hfa=true\n  30 threads and 100 connections\n  Thread Stats   Avg      Stdev     Max   +/- Stdev\n    Latency   192.04ms  305.45ms   1.95s    83.06%\n    Req/Sec   133.42    118.21     1.37k    75.54%\n  68669 requests in 30.10s, 19.97MB read\nRequests/sec:   2281.51\nTransfer/sec:    679.28KB\n</code></pre>\n\n<p>These stats are on my Mac having GHC 7.10.1 installed</p>\n\n<p>Processor info 2.5GHx i5<br />\nMemory info 8GB 1600 Mhz DDR3</p>\n\n<p>I am quite impressed by lightweight thread based concurrency of GHC but memory efficiency remains a big concern.</p>\n\n<p>Profiling memory usage yielded me the following stats</p>\n\n<pre><code>    39,222,354,072 bytes allocated in the heap\n     277,239,312 bytes copied during GC\n     522,218,848 bytes maximum residency (14 sample(s))\n         761,408 bytes maximum slop\n            1124 MB total memory in use (0 MB lost due to fragmentation)\n\n                                     Tot time (elapsed)  Avg pause  Max pause\n  Gen  0       373 colls,   373 par    2.802s   0.978s     0.0026s    0.0150s\n  Gen  1        14 colls,    13 par    0.534s   0.166s     0.0119s    0.0253s\n\n  Parallel GC work balance: 42.38% (serial 0%, perfect 100%)\n\n  TASKS: 18 (1 bound, 17 peak workers (17 total), using -N4)\n\n  SPARKS: 0 (0 converted, 0 overflowed, 0 dud, 0 GC'd, 0 fizzled)\n\n  INIT    time    0.001s  (  0.008s elapsed)\n  MUT     time   31.425s  ( 36.161s elapsed)\n  GC      time    3.337s  (  1.144s elapsed)\n  EXIT    time    0.000s  (  0.001s elapsed)\n  Total   time   34.765s  ( 37.314s elapsed)\n\n  Alloc rate    1,248,117,604 bytes per MUT second\n\n  Productivity  90.4% of total user, 84.2% of total elapsed\n\ngc_alloc_block_sync: 27215\nwhitehole_spin: 0\ngen[0].sync: 8919\ngen[1].sync: 30902\n</code></pre>\n\n<p><a href=\"http://www.phoenixframework.org\" rel=\"nofollow noreferrer\">Phoenix</a> never took more than 150 MB, while <a href=\"https://gin-gonic.github.io/gin/\" rel=\"nofollow noreferrer\">Gin</a> took much lower memory. </p>\n\n<p>I believe that GHC uses mark and sweep strategy for GC. I also believe it would have been better to use per thread incremental GC strategy akin to Erlang VM for better memory efficiency. </p>\n\n<p>And by interpreting Don Stewart's answer to a <a href=\"https://stackoverflow.com/questions/15236238/current-state-of-haskell-soft-real-time\">related question</a> there must be some way to change the GC strategy in GHC.</p>\n\n<p>I also noted that the memory usage remained stable and pretty low when the concurrency level was low, so I think memory usage booms up only when concurrency is pretty high. </p>\n\n<p>Any ideas/pointers to solve this issue.</p>\n"}, {"tags": ["list", "haskell"], "comments": [{"owner": {"reputation": 11366, "user_id": 3922954, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/76ba47d2fdd24ab56b0b273cce2075e5?s=128&d=identicon&r=PG&f=1", "display_name": "AJF", "link": "https://stackoverflow.com/users/3922954/ajf"}, "edited": false, "score": 0, "creation_date": 1433071699, "post_id": 30556356, "comment_id": 49185337, "body": "If you don&#39;t want to do it yourself, lenses are the way to go."}], "answers": [{"comments": [{"owner": {"reputation": 1969, "user_id": 3041008, "user_type": "registered", "accept_rate": 86, "profile_image": "https://i.stack.imgur.com/cqLI9.png?s=128&g=1", "display_name": "mucaho", "link": "https://stackoverflow.com/users/3041008/mucaho"}, "edited": false, "score": 0, "creation_date": 1433096955, "post_id": 30556586, "comment_id": 49193488, "body": "Would you be so kind and elaborate on the <code>cheatPiece</code> definition?"}], "tags": [], "owner": {"reputation": 23816, "user_id": 572606, "user_type": "registered", "accept_rate": 81, "profile_image": "https://www.gravatar.com/avatar/c20a126ad0dce40e8fc4a43456107919?s=128&d=identicon&r=PG", "display_name": "shang", "link": "https://stackoverflow.com/users/572606/shang"}, "is_accepted": true, "score": 3, "last_activity_date": 1433071196, "last_edit_date": 1433071196, "creation_date": 1433069777, "answer_id": 30556586, "question_id": 30556356, "link": "https://stackoverflow.com/questions/30556356/altering-a-single-value-in-list-of-lists-in-haskell-homework/30556586#30556586", "title": "Altering A Single Value in List of Lists in Haskell [Homework]", "body": "<p>I don't think your implementation is horrendous at all. That's pretty much the standard way to work with immutable, linked lists. </p>\n\n<p>I think the main thing that makes it feel clumsy is that working with indices and linked lists is never going to be very natural.</p>\n\n<p>So, in the context of a homework assignment, your implementation is, I think, the most correct way to implement <code>cheatPiece</code>. If you had control over the board presentation I might consider using, for example, a <a href=\"http://hackage.haskell.org/package/vector\" rel=\"nofollow\"><code>vector</code></a> or an <a href=\"http://hackage.haskell.org/package/containers-0.5.6.3/docs/Data-IntMap-Lazy.html\" rel=\"nofollow\"><code>IntMap</code></a> to store the columns.</p>\n\n<p>There's also always <a href=\"http://hackage.haskell.org/package/lens\" rel=\"nofollow\"><code>lens</code></a> which lets you work with nested, immutable structures using terser abstractions but if you are still new to Haskell then the <code>lens</code> package definitely does not have the gentlest of learning curves.</p>\n\n<pre><code>import Control.Lens\n\ndata Piece = X | O deriving Show\ntype GameState = [[Piece]]\n\ncheatPiece :: GameState -&gt; Int -&gt; Piece -&gt; GameState\ncheatPiece st i p = st &amp; ix i %~ (p:)\n</code></pre>\n"}, {"comments": [{"owner": {"reputation": 505, "user_id": 4612105, "user_type": "registered", "accept_rate": 70, "profile_image": "https://graph.facebook.com/10205926013086481/picture?type=large", "display_name": "Syzorr", "link": "https://stackoverflow.com/users/4612105/syzorr"}, "edited": false, "score": 0, "creation_date": 1433082565, "post_id": 30557728, "comment_id": 49188647, "body": "Thank you for that. I already ticked the first one as that primarily answered my question around the difficulty of doing this in some kind of sane way but your suggestions are excellent and definitely open my eyes a bit more to the different ways of tackling this."}], "tags": [], "owner": {"reputation": 1780, "user_id": 4168972, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/fc92e82d2eb21eb030d4c133c70ff554?s=128&d=identicon&r=PG&f=1", "display_name": "David Fletcher", "link": "https://stackoverflow.com/users/4168972/david-fletcher"}, "is_accepted": false, "score": 3, "last_activity_date": 1433077234, "creation_date": 1433077234, "answer_id": 30557728, "question_id": 30556356, "link": "https://stackoverflow.com/questions/30556356/altering-a-single-value-in-list-of-lists-in-haskell-homework/30557728#30557728", "title": "Altering A Single Value in List of Lists in Haskell [Homework]", "body": "<p>You could use the <code>take</code> and <code>drop</code> functions and the list-indexing operator <code>!!</code>.</p>\n\n<pre><code>cheatPiece xss n x = take n xss ++ [x : (xss !! i)] ++ drop (n + 1) xss\n</code></pre>\n\n<p>Or there's <code>splitAt</code> which combines take and drop - I'll throw in a check for when the index is too big:</p>\n\n<pre><code>cheatPiece xss n x = case splitAt n xss of\n                       (_, []) -&gt; error \"out of range\"\n                       (yss, zs:zss) -&gt; yss ++ [x:zs] ++ zss\n</code></pre>\n\n<p>But I'd be tempted to generalize that by writing a function for modifying an element at an index:</p>\n\n<pre><code>modifyAt :: Int -&gt; (a -&gt; a) -&gt; [a] -&gt; [a]\nmodifyAt n f xs = case splitAt n xs of\n                    (_, []) -&gt; error \"out of range\"\n                    (ys, z:zs) -&gt; ys ++ [f z] ++ zs\n</code></pre>\n\n<p>which can be used like this:</p>\n\n<pre><code>&gt; modifyAt 3 (+1000) [0..9]\n[0,1,2,1003,4,5,6,7,8,9]\n</code></pre>\n\n<p>Then your function would be</p>\n\n<pre><code>cheatPiece xss n x = modifyAt n (x:) xss\n</code></pre>\n"}], "owner": {"reputation": 505, "user_id": 4612105, "user_type": "registered", "accept_rate": 70, "profile_image": "https://graph.facebook.com/10205926013086481/picture?type=large", "display_name": "Syzorr", "link": "https://stackoverflow.com/users/4612105/syzorr"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 122, "favorite_count": 0, "accepted_answer_id": 30556586, "answer_count": 2, "score": 1, "last_activity_date": 1433077234, "creation_date": 1433068100, "question_id": 30556356, "link": "https://stackoverflow.com/questions/30556356/altering-a-single-value-in-list-of-lists-in-haskell-homework", "title": "Altering A Single Value in List of Lists in Haskell [Homework]", "body": "<p>Been having some real issues with this and haven't been able to find any guidance on doing this in any reading. Have been tasked with implementing functions to complete a Haskell version of Connect 4. The board is represented as a list of lists of pieces using Data.List.</p>\n\n<p>One of the functions is to drop a piece given the piece and column number. For this I would like to just add the piece to the appropriate column and be done with it but the only way I seem to be able to do it is recursing through the list until I get to the right column and then add the piece.</p>\n\n<p>Is there any way to do this better?</p>\n\n<p>My horrendous code is below:</p>\n\n<pre><code>cheatPiece :: GameState -&gt; Int -&gt; Piece -&gt; GameState\ncheatPiece [] _ _ = []\ncheatPiece (xs:xss) 0 x = (x:xs) : xss\ncheatPiece (xs:xss) n x = xs : cheatPiece xss (n-1) x\n</code></pre>\n"}, {"tags": ["windows", "haskell", "dll", "segmentation-fault", "mingw32"], "owner": {"reputation": 323, "user_id": 1953391, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/00d133b471cdc04a8c8821fd7b005c48?s=128&d=identicon&r=PG", "display_name": "tpsa", "link": "https://stackoverflow.com/users/1953391/tpsa"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 159, "favorite_count": 1, "answer_count": 0, "score": 5, "last_activity_date": 1433061729, "creation_date": 1433061729, "question_id": 30555469, "link": "https://stackoverflow.com/questions/30555469/haskell-making-windows-dll-libraries-segfault", "title": "haskell - making windows dll libraries - segfault", "body": "<p>Currently, I try to compile my haskell library, which was previously compiled on the arch linux as so. shared library), to windows dll library. I have read, that cabal does not support making haskell dll libraries out of box. According to <a href=\"https://downloads.haskell.org/~ghc/7.0.3/docs/html/users_guide/win32-dlls.html\" rel=\"noreferrer\">https://downloads.haskell.org/~ghc/7.0.3/docs/html/users_guide/win32-dlls.html</a> I have compiled such a library to dll (compilation works).</p>\n\n<pre><code>ghc -shared -o libLogic.dll dist/build/HSlogic_KA1QeY80keFKgyu69OtwOE.o \\ \n/c/ghc/ghc-7.10.1/lib/conta_47ajk3tbda43DFWyeF3oHQ/HScontainers-0.5.6.2-47ajk3tbda43DFWyeF3oHQ.o \\\n.cabal-sandbox/i386-windows-ghc-7.10.1/Missi_1lZqat04J1yLHrfGdhK9Qx/libHSMissingH-1.3.0.1-A2UVxmrfU \\\nxWGZUHs3Vx4et.a .cabal-sandbox/i386-windows-ghc-7.10.1/text_8rMotiVS8ISBkxP7UzusGU/HStext-1.2.1.1-1L7lZlUz0bO8ROU5DNNfWq.o \\\n.cabal-sandb ox/i386-windows-ghc-7.10.1/regex_1WudNAZWYEMJ7hjTqevDzK/HSregex-base-0.93.2-CsRFAGo3Jfi7vN1y74K9DT.o \\\n.cabal-sandbox/i386-windows-ghc-7.10.1/regex_4EmnRBpiUiN81uA3rzCqhM/HSregex-compat-0.95.1-DsaThvjcDpRGceYPQ2iyOg.o \\\n.cabal-sandbox/i386-windows-ghc-7.10.1/regex_FcyoJ8fpGysAR4JUIv3Onx/HSregex-posix-0.95.2-HrKRtQubtek4GEuR7lgLlg.o /c/ghc/ghc-7.10.1/lib/bytes_6vj5EoliHgNHISHCVCb069/HSbytestring-0.10.6.0-6vj5EoliHgNHISHCVCb069.o \\\n/c/ghc/ghc-7.10.1/lib/deeps_FpR4obOZALU1lutWnrBldi/HSdeepseq-1.4.1.1-FpR4obOZALU1lutWnrBldi.o \\\n/c/ghc/ghc-7.10.1/ lib/binar_EKE3c9Lmxb3DQpU0fPtru6/HSbinary-0.7.3.0-EKE3c9Lmxb3DQpU0fPtru6.o  \\\n/c/ghc/ghc-7.10.1/lib/array_FaHmcBFfuRM8kmZLEY8D5S/HSarray-0.5.1.0-FaHmcBFfuRM8kmZLEY8D5S.o  \\\n.cabal-sandbox/i386-windows-ghc-7.10.1/split_EzXNp9Mcx6zDnUvRChe0Sw/HSsplit-0.2.2-EcQml2WFBePDKSCjwazauo.o\n</code></pre>\n\n<p>This dll library is later used to link program with it (qt project)</p>\n\n<pre><code>win32:LIBS += -L../lcng-gui -lLogic ../lcng-gui/libLogic.dll.a\n</code></pre>\n\n<p>qt compilation also succeeds, but when I try to run the program - it segfaults in strlen/_mingw_pformat.</p>\n\n<p>What do I wrongly and what can I do to succeed in creating haskell dll library which could be used in any program with which it will be linked?</p>\n\n<p>library\n      -- .hs or .lhs file containing the Main module.\n      ghc-options:\n        -O3\n        -fwarn-unused-imports\n      extensions: CPP</p>\n\n<pre><code>  -- Modules included in this executable, other than Main.\n  -- other-modules:\n\n  -- LANGUAGE extensions used by modules in this package.\n  -- other-extensions:\n\n  -- Other library packages from which modules are imported.\n  build-depends:       base &gt;=4.8 &amp;&amp; &lt;4.9, containers &gt;=0.5 &amp;&amp; &lt;0.6,HUnit==1.2.*,split,text,MissingH,parsec &gt;= 3\n\n  -- Directories containing source files.\n  hs-source-dirs:      src\n  c-sources: src/hsbracket.c\n  extra-libraries: HSrts-ghc7.10.1\n\n  -- Base language which the package is written in.\n  default-language:    Haskell2010\n--  extra-libraries:     libHSrts-ghc7.10.1\n  exposed-modules: Bindings,Utils.Expressions,Parser.Expressions,Parser.Tokenizers,\n                   Types.Simple,Types.LExpressions,Parser.Operations,\n                   Provers.Prover,Utils.Commands,Parser.Simplifiers,\n                   Converters.Cnf,Converters.Lcn,Converters.Operators,\n                   Utils.Types.LExpressions,Utils.History,Parser.State,\n                   Solvers.Cnf,Graphs.Lcn,Utils.Sat,Types.Chess,Graphs.Formula,\n                   Graphs.Search,Types.Graphs\n</code></pre>\n\n<p>and hsbracket is defined accordingly to the ghc documentation:</p>\n\n<pre><code>#include &lt;HsFFI.h&gt;\n\nstatic void my_enter(void) __attribute__((constructor));\nstatic void my_enter(void)\n{\n  static char *argv[] = { \"libLogic.dll\", 0 }, **argv_ = argv;\n  static int argc = 1;\n  hs_init(&amp;argc, &amp;argv_);\n}\n\nstatic void my_exit(void) __attribute__((destructor));\nstatic void my_exit(void)\n{\n  hs_exit();\n}\n</code></pre>\n"}, {"tags": ["haskell", "cabal"], "comments": [{"owner": {"reputation": 94713, "user_id": 1139697, "user_type": "registered", "accept_rate": 86, "profile_image": "https://www.gravatar.com/avatar/5f136ddb684f39aaee1c028ee1950f6f?s=128&d=identicon&r=PG", "display_name": "Zeta", "link": "https://stackoverflow.com/users/1139697/zeta"}, "edited": false, "score": 2, "creation_date": 1433061427, "post_id": 30555221, "comment_id": 49182737, "body": "Did you try <a href=\"https://github.com/fpco/minghc\" rel=\"nofollow noreferrer\">MinGHC</a> instead?"}, {"owner": {"reputation": 18780, "user_id": 683218, "user_type": "registered", "accept_rate": 69, "profile_image": "https://i.stack.imgur.com/7Vy7c.png?s=128&g=1", "display_name": "tinlyx", "link": "https://stackoverflow.com/users/683218/tinlyx"}, "reply_to_user": {"reputation": 94713, "user_id": 1139697, "user_type": "registered", "accept_rate": 86, "profile_image": "https://www.gravatar.com/avatar/5f136ddb684f39aaee1c028ee1950f6f?s=128&d=identicon&r=PG", "display_name": "Zeta", "link": "https://stackoverflow.com/users/1139697/zeta"}, "edited": false, "score": 0, "creation_date": 1433123850, "post_id": 30555221, "comment_id": 49200438, "body": "@Zeta. I haven&#39;t. It looks like what I needed. Do you know if I can installed it without the MSys part? I have mine own msys with lots of stuff built in in the past."}], "answers": [{"tags": [], "owner": {"reputation": 18780, "user_id": 683218, "user_type": "registered", "accept_rate": 69, "profile_image": "https://i.stack.imgur.com/7Vy7c.png?s=128&g=1", "display_name": "tinlyx", "link": "https://stackoverflow.com/users/683218/tinlyx"}, "is_accepted": true, "score": 0, "last_activity_date": 1433547800, "last_edit_date": 1433547800, "creation_date": 1433505096, "answer_id": 30665863, "question_id": 30555221, "link": "https://stackoverflow.com/questions/30555221/how-to-set-up-cabal-for-ghc-7-10-on-windows-64-bit/30665863#30665863", "title": "How to set up cabal for ghc 7.10 on windows 64-bit", "body": "<p>Here is what worked for me.</p>\n\n<p>I used a previous version of 64-bit GHC, such as those in Haskell Platform, to compile a <code>cabal.exe</code>, and use it to do:</p>\n\n<pre><code>cabal install cabal-install\n</code></pre>\n\n<p>(boot-strapping).</p>\n\n<p>After this, the <code>cabal.exe</code> installed into the local cabal directory was 64-bit and worked just fine.</p>\n\n<p>Note: I have tried MinGHC 64-bit as @Zeta hinted, but the <code>cabal.exe</code> there was also 32-bit. It seems to be incompatible with the 64-bit GHC system, and gave me crashes just as the 32-bit <code>cabal.exe</code> downloaded from the official website.</p>\n"}], "owner": {"reputation": 18780, "user_id": 683218, "user_type": "registered", "accept_rate": 69, "profile_image": "https://i.stack.imgur.com/7Vy7c.png?s=128&g=1", "display_name": "tinlyx", "link": "https://stackoverflow.com/users/683218/tinlyx"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 359, "favorite_count": 0, "accepted_answer_id": 30665863, "answer_count": 1, "score": 3, "last_activity_date": 1433547800, "creation_date": 1433059789, "question_id": 30555221, "link": "https://stackoverflow.com/questions/30555221/how-to-set-up-cabal-for-ghc-7-10-on-windows-64-bit", "title": "How to set up cabal for ghc 7.10 on windows 64-bit", "body": "<p>I have just downloaded the newest GHC 7.10.1 version, and I am trying to set up the cabal system to make it work. But I couldn't find the 64-bit <code>cabal</code> binary for 64 bit windows.</p>\n\n<p>Haskell Platform does not have 7.10 yet. So I went to <a href=\"https://www.haskell.org/cabal/download.html\" rel=\"nofollow\">https://www.haskell.org/cabal/download.html</a> , but there is only binary for 32-bit windows. I tried to use that version to <code>cabal update</code>, but <code>cabal.exe</code> just crashed while setting up the initial config.</p>\n\n<p>I was wondering what's the procedure to set up <code>cabal</code> for 64-bit GHC?</p>\n"}, {"tags": ["list", "haskell", "nested"], "answers": [{"tags": [], "owner": {"reputation": 17293, "user_id": 736162, "user_type": "registered", "accept_rate": 78, "profile_image": "https://www.gravatar.com/avatar/eb6854f56cb2aa14ce798b53ea667639?s=128&d=identicon&r=PG", "display_name": "Andrea", "link": "https://stackoverflow.com/users/736162/andrea"}, "is_accepted": false, "score": 12, "last_activity_date": 1433047087, "last_edit_date": 1433047087, "creation_date": 1433046703, "answer_id": 30553858, "question_id": 30553458, "link": "https://stackoverflow.com/questions/30553458/nested-chunksof-in-haskell/30553858#30553858", "title": "Nested chunksOf in Haskell?", "body": "<p>A function like <code>nestedChunksOf</code> can't be done directly in Haskell, at least not one which operates on normal lists. The depth of the list is part of the type, so you can't have an arbitrary depth specified by a parameter.</p>\n\n<p>But what you <em>can</em> do is nest <code>chunksOf</code>.</p>\n\n<p>If we define <code>chunksOf</code> like this:</p>\n\n<pre><code>chunksOf :: Int -&gt; [a] -&gt; [[a]]\nchunksOf _ [] = []\nchunksOf n xs = fxs : chunksOf n sxs\n    where (fxs, sxs) = splitAt n xs\n</code></pre>\n\n<p>We can then nest it:</p>\n\n<pre><code>Main&gt; :l test.hs\n[1 of 1] Compiling Main             ( test.hs, interpreted )\nOk, modules loaded: Main.\n*Main&gt; chunksOf 3 [1,1,1,2,2,2,3,3,3,4,4,4]\n[[1,1,1],[2,2,2],[3,3,3],[4,4,4]]\n*Main&gt; chunksOf 2 $ chunksOf 3 [1,1,1,2,2,2,3,3,3,4,4,4]\n[[[1,1,1],[2,2,2]],[[3,3,3],[4,4,4]]]\n</code></pre>\n\n<p>I hope that accomplishes what you wanted!</p>\n"}, {"tags": [], "owner": {"reputation": 62421, "user_id": 216164, "user_type": "registered", "accept_rate": 89, "profile_image": "https://www.gravatar.com/avatar/786f224adbe0784cdf7d0f15476061fe?s=128&d=identicon&r=PG", "display_name": "Thomas M. DuBuisson", "link": "https://stackoverflow.com/users/216164/thomas-m-dubuisson"}, "is_accepted": false, "score": 2, "last_activity_date": 1433046977, "creation_date": 1433046977, "answer_id": 30553882, "question_id": 30553458, "link": "https://stackoverflow.com/questions/30553458/nested-chunksof-in-haskell/30553882#30553882", "title": "Nested chunksOf in Haskell?", "body": "<p>This can not be achieved in Haskell through \"normal\" means because it would require a dependent type - the type of the result depends on the length of the first argument.</p>\n\n<p>Perhaps a tuple solution would be acceptable?</p>\n\n<pre><code>{-# Language TypeFamilies #-}\n{-# Language FlexibleInstances #-}\nimport Data.List.Split\nclass NestedChunksOf a where\n    nco :: a -&gt; [b] -&gt; AList a b\n    type AList a b :: *\n\ninstance NestedChunksOf (Int,Int) where\n    nco (f,s) xs = chunksOf f (chunksOf s xs)\n    type AList (Int,Int) a = [[[a]]]\n\n\n-- More instances as desired.\n</code></pre>\n"}, {"comments": [{"owner": {"reputation": 11366, "user_id": 3922954, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/76ba47d2fdd24ab56b0b273cce2075e5?s=128&d=identicon&r=PG&f=1", "display_name": "AJF", "link": "https://stackoverflow.com/users/3922954/ajf"}, "edited": false, "score": 1, "creation_date": 1433061234, "post_id": 30555134, "comment_id": 49182685, "body": "This is great! Fantastic use of type families."}], "tags": [], "owner": {"reputation": 28873, "user_id": 1068232, "user_type": "registered", "accept_rate": 79, "profile_image": "https://www.gravatar.com/avatar/2a0a145ce58c20013969fe3f203531da?s=128&d=identicon&r=PG", "display_name": "Andr&#225;s Kov&#225;cs", "link": "https://stackoverflow.com/users/1068232/andr%c3%a1s-kov%c3%a1cs"}, "is_accepted": true, "score": 5, "last_activity_date": 1433059341, "last_edit_date": 1433059341, "creation_date": 1433059041, "answer_id": 30555134, "question_id": 30553458, "link": "https://stackoverflow.com/questions/30553458/nested-chunksof-in-haskell/30555134#30555134", "title": "Nested chunksOf in Haskell?", "body": "<p>It can be done fairly easily with dependent types. </p>\n\n<p>We'd like to express that the length of the <code>[Int]</code> argument determines the type of the result. We need two things for that: a list type with fixed length, and a type-level function which computes the return type from the length:</p>\n\n<pre><code>{-# LANGUAGE DataKinds, GADTs, TypeFamilies #-}\n\nimport Data.List.Split\n\ndata Nat = Z | S Nat -- natural numbers (zero, successor)\n\ndata Vec n a where -- \"n\" length lists of \"a\" elements\n  Nil  :: Vec Z a\n  (:&gt;) :: a -&gt; Vec n a -&gt; Vec (S n) a\ninfixr 5 :&gt;\n\ntype family Iterate n f a where\n  Iterate Z     f a = a\n  Iterate (S n) f a = f (Iterate n f a)\n</code></pre>\n\n<p><code>Iterate n f a</code> applies the type constructor <code>f</code> <code>n</code> times to an argument. For example, <code>Iterate (S (S Z)) [] Int</code> reduces to <code>[[Int]]</code>. <code>nestedChunksOf</code> can be written directly now:</p>\n\n<pre><code>nestedChunksOf :: Vec n Int -&gt; [a] -&gt; Iterate (S n) [] a\nnestedChunksOf Nil       as = as\nnestedChunksOf (n :&gt; ns) as = chunksOf n $ nestedChunksOf ns as\n</code></pre>\n\n<p>Usage:</p>\n\n<pre><code>&gt; nestedChunksOf (2 :&gt; 3 :&gt; Nil) [1,1,1,2,2,2,3,3,3,4,4,4]\n[[[1,1,1],[2,2,2]],[[3,3,3],[4,4,4]]]\n</code></pre>\n"}, {"tags": [], "owner": {"reputation": 60057, "user_id": 1333025, "user_type": "registered", "accept_rate": 65, "profile_image": "https://www.gravatar.com/avatar/79ab43010f900324ac5e2de19a2916cb?s=128&d=identicon&r=PG", "display_name": "Petr", "link": "https://stackoverflow.com/users/1333025/petr"}, "is_accepted": false, "score": 6, "last_activity_date": 1433060009, "creation_date": 1433060009, "answer_id": 30555252, "question_id": 30553458, "link": "https://stackoverflow.com/questions/30553458/nested-chunksof-in-haskell/30555252#30555252", "title": "Nested chunksOf in Haskell?", "body": "<p>As stated in the other answers, this can't be done directly as in Haskell you always need to know the type of an expression and thus distinguish between <code>[a]</code>, <code>[[a]]</code> etc. However, using <a href=\"http://en.wikipedia.org/wiki/Polymorphic_recursion\">polymorphic recursion</a> you can define a data type that allows such arbitrary nesting by wrapping each level in a constructor:</p>\n\n<pre><code>data NestedList a = Value a | Nested (NestedList [a])\n  deriving (Show)\n</code></pre>\n\n<p>So just <code>Value</code> is isomorphic to <code>a</code>, <code>Nested (Value ...)</code> is isomorphic to <code>[a]</code>, double <code>Nested</code> to <code>[[a]]</code> etc. Then you can implement</p>\n\n<pre><code>chunksOf :: Int -&gt; [a] -&gt; [[a]]\n...\n\nnestedChunksOf :: [Int] -&gt; [a] -&gt; NestedList a\nnestedChunksOf [] xs = Nested (Value xs)\nnestedChunksOf (c:cs) xs = Nested (nestedChunksOf cs $ chunksOf c xs)\n</code></pre>\n\n<p>And indeed</p>\n\n<pre><code>print $ nestedChunksOf [3, 2] [1,1,1,2,2,2,3,3,3,4,4,4]\n</code></pre>\n\n<p>outputs</p>\n\n<pre><code>Nested (Nested (Nested (Value [[[1,1,1],[2,2,2]],[[3,3,3],[4,4,4]]])))\n</code></pre>\n"}], "owner": {"reputation": 195, "user_id": 3881776, "user_type": "registered", "accept_rate": 75, "profile_image": "https://i.stack.imgur.com/r2Na3.jpg?s=128&g=1", "display_name": "fans656", "link": "https://stackoverflow.com/users/3881776/fans656"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 378, "favorite_count": 0, "accepted_answer_id": 30555134, "answer_count": 4, "score": 5, "last_activity_date": 1433060009, "creation_date": 1433041928, "question_id": 30553458, "link": "https://stackoverflow.com/questions/30553458/nested-chunksof-in-haskell", "title": "Nested chunksOf in Haskell?", "body": "<p>Say I want to do this:</p>\n\n<pre><code>nestedChunksOf [3, 2] [1,1,1,2,2,2,3,3,3,4,4,4] == [[[1,1,1], [2,2,2]], [[3,3,3], [4,4,4]]]\n</code></pre>\n\n<p>In Python, I can do this</p>\n\n<pre><code>def group(a, *ns):\n    for n in ns:\n        a = [a[i:i+n] for i in xrange(0, len(a), n)]\n    return a\n\ngroup([1,1,1,2,2,2,3,3,3,4,4,4], 3, 2) == [[[1,1,1],[2,2,2]],[[3,3,3],[4,4,4]]]\n</code></pre>\n\n<p>But in Haskell, I can't just say</p>\n\n<pre><code>nestedChunksOf :: [Int] -&gt; [a] -&gt; [[a]]\n</code></pre>\n\n<p>or</p>\n\n<pre><code>nestedChunksOf :: [Int] -&gt; [a] -&gt; [[[a]]]\n</code></pre>\n\n<p>So how can I achieve the same thing in Haskell?</p>\n"}, {"tags": ["haskell", "frp", "elm"], "answers": [{"comments": [{"owner": {"reputation": 95, "user_id": 4957593, "user_type": "registered", "profile_image": "https://graph.facebook.com/10206347933204742/picture?type=large", "display_name": "Kira Ghandhi", "link": "https://stackoverflow.com/users/4957593/kira-ghandhi"}, "edited": false, "score": 1, "creation_date": 1433043148, "post_id": 30553430, "comment_id": 49179352, "body": "Yes I am asking about merging events like <code>signal a -&gt; signal a -&gt; signal a</code>. Specifically I want the behavior to take the first signal that fires and discard the other. But, thank you, Ill upvote you once I have enough reputation."}, {"owner": {"reputation": 13699, "user_id": 11173, "user_type": "registered", "accept_rate": 77, "profile_image": "https://www.gravatar.com/avatar/6b5276e65cb7a7417188c9a035953cee?s=128&d=identicon&r=PG", "display_name": "Doug McClean", "link": "https://stackoverflow.com/users/11173/doug-mcclean"}, "reply_to_user": {"reputation": 95, "user_id": 4957593, "user_type": "registered", "profile_image": "https://graph.facebook.com/10206347933204742/picture?type=large", "display_name": "Kira Ghandhi", "link": "https://stackoverflow.com/users/4957593/kira-ghandhi"}, "edited": false, "score": 0, "creation_date": 1433043400, "post_id": 30553430, "comment_id": 49179395, "body": "Sure, sorry I couldn&#39;t be more helpful. In netwire it&#39;s <a href=\"http://hackage.haskell.org/package/netwire-5.0.1/docs/Control-Wire-Event.html#v:merge\" rel=\"nofollow noreferrer\">hackage.haskell.org/package/netwire-5.0.1/docs/&hellip;</a> but I don&#39;t see anything similar in helm."}], "tags": [], "owner": {"reputation": 13699, "user_id": 11173, "user_type": "registered", "accept_rate": 77, "profile_image": "https://www.gravatar.com/avatar/6b5276e65cb7a7417188c9a035953cee?s=128&d=identicon&r=PG", "display_name": "Doug McClean", "link": "https://stackoverflow.com/users/11173/doug-mcclean"}, "is_accepted": false, "score": 2, "last_activity_date": 1433041654, "creation_date": 1433041654, "answer_id": 30553430, "question_id": 30553388, "link": "https://stackoverflow.com/questions/30553388/how-do-i-merge-signals-in-helm/30553430#30553430", "title": "How do I merge signals in Helm?", "body": "<p>You can combine things using the <code>Applicative</code> instance. For example <code>liftA2 (,)</code> will have type <code>Signal a -&gt; Signal b -&gt; Signal (a,b)</code>.</p>\n\n<p>(I'm not 100% sure if this is your question, though. If your question is about merging events like <code>Event a -&gt; Event a -&gt; Event a</code>, I'm not sure helm has features like that. I can only find the documentation for behavior-like <code>Signal</code>s that have continuous semantics.)</p>\n"}, {"comments": [{"owner": {"reputation": 95, "user_id": 4957593, "user_type": "registered", "profile_image": "https://graph.facebook.com/10206347933204742/picture?type=large", "display_name": "Kira Ghandhi", "link": "https://stackoverflow.com/users/4957593/kira-ghandhi"}, "edited": false, "score": 0, "creation_date": 1438188725, "post_id": 30553671, "comment_id": 51351429, "body": "This ended up not working very well for some reason. It varied on different machines: I tried it on a linux computer and it worked fine, but when I tried it on a linux virtual box it made nothing happen at all. The way I fixed it was a hacky merge that basically took the signal I wanted to prevail each time with a <code>lift2</code>."}, {"owner": {"reputation": 5862, "user_id": 859279, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/6543ec0f2465bba1c6899f580bd1e20b?s=128&d=identicon&r=PG", "display_name": "Apanatshka", "link": "https://stackoverflow.com/users/859279/apanatshka"}, "reply_to_user": {"reputation": 95, "user_id": 4957593, "user_type": "registered", "profile_image": "https://graph.facebook.com/10206347933204742/picture?type=large", "display_name": "Kira Ghandhi", "link": "https://stackoverflow.com/users/4957593/kira-ghandhi"}, "edited": false, "score": 0, "creation_date": 1438193202, "post_id": 30553671, "comment_id": 51354110, "body": "Strange that the behaviour differed per machine, that sounds like a bug to me...   I don&#39;t understand how you&#39;d make a <code>merge</code> with <code>lift2</code>, how did you do that?"}, {"owner": {"reputation": 95, "user_id": 4957593, "user_type": "registered", "profile_image": "https://graph.facebook.com/10206347933204742/picture?type=large", "display_name": "Kira Ghandhi", "link": "https://stackoverflow.com/users/4957593/kira-ghandhi"}, "edited": false, "score": 0, "creation_date": 1438193417, "post_id": 30553671, "comment_id": 51354237, "body": "I&#39;m sure it&#39;s a bug. I had to present my project, though, on the virtualbox so had to make a work around. I think since the Helm people have tried a monoid implementation. Im sure that&#39;s also a bit buggy too. I think Im going to stick to Elm in the future."}], "tags": [], "owner": {"reputation": 5862, "user_id": 859279, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/6543ec0f2465bba1c6899f580bd1e20b?s=128&d=identicon&r=PG", "display_name": "Apanatshka", "link": "https://stackoverflow.com/users/859279/apanatshka"}, "is_accepted": true, "score": 2, "last_activity_date": 1433044463, "creation_date": 1433044463, "answer_id": 30553671, "question_id": 30553388, "link": "https://stackoverflow.com/questions/30553388/how-do-i-merge-signals-in-helm/30553671#30553671", "title": "How do I merge signals in Helm?", "body": "<p>I think the best way would be finding out how Helm's <code>Signal</code>s are implemented in terms of Elerea's stuff, and implementing <code>merge</code> in those more primitive terms. I'm afraid I can't help you there, because I don't know Helm well and I don't know Elerea at all. </p>\n\n<p>I <em>can</em> help you with a hacky solution based solely on Helm. You can use <code>timestamp</code> to distinguish different events from zipped signals: </p>\n\n<pre><code>merge sigL sigR =\n  let\n    tsMerge (t1,v1) (t2,v2) =\n        if t1 &gt;= t2\n          then v1\n          else v2\n  in\n    tsMerge &lt;~ timestamp sigL ~~ timestamp sigR\n</code></pre>\n"}], "owner": {"reputation": 95, "user_id": 4957593, "user_type": "registered", "profile_image": "https://graph.facebook.com/10206347933204742/picture?type=large", "display_name": "Kira Ghandhi", "link": "https://stackoverflow.com/users/4957593/kira-ghandhi"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 120, "favorite_count": 0, "accepted_answer_id": 30553671, "answer_count": 2, "score": 4, "last_activity_date": 1433044463, "creation_date": 1433041101, "last_edit_date": 1433043250, "question_id": 30553388, "link": "https://stackoverflow.com/questions/30553388/how-do-i-merge-signals-in-helm", "title": "How do I merge signals in Helm?", "body": "<p>I am working on a project using <a href=\"http://hackage.haskell.org/package/helm\" rel=\"nofollow\">Helm</a>, which is based on the Elm language. </p>\n\n<p>I need to trigger an event based on which signal out of a pair of signals arrives first. In Elm, I would use the <a href=\"http://package.elm-lang.org/packages/elm-lang/core/2.0.1/Signal#merge\" rel=\"nofollow\">merge</a> function, but I cannot find an equivalent in Helm. The closest I see is combine (in the signal library), which doesn't appear to do what I want. It seems that combine just takes a list of signals and makes them directly into a signal of lists, which is not quite what I'm looking for.</p>\n\n<p>EDIT: specifically I am looking for a function with signature <code>Signal a -&gt; Signal a -&gt; Signal a</code> that takes the first signal to fire and discards the second.</p>\n\n<p>What's the best way to accomplish this in Helm?</p>\n"}, {"tags": ["list", "haskell"], "answers": [{"comments": [{"owner": {"reputation": 2307, "user_id": 1024057, "user_type": "registered", "accept_rate": 90, "profile_image": "https://i.stack.imgur.com/vqtz8.png?s=128&g=1", "display_name": "Johann Bauer", "link": "https://stackoverflow.com/users/1024057/johann-bauer"}, "edited": false, "score": 0, "creation_date": 1433018591, "post_id": 30551130, "comment_id": 49174300, "body": "I&#39;m trying to write a haskell module that solves variants of the 15 puzzle: <a href=\"http://en.wikipedia.org/wiki/15_puzzle\" rel=\"nofollow noreferrer\">en.wikipedia.org/wiki/15_puzzle</a> . The tiles are stored in a list and I want to use this function to to swap the empty tile with one of its neighbors."}, {"owner": {"reputation": 2307, "user_id": 1024057, "user_type": "registered", "accept_rate": 90, "profile_image": "https://i.stack.imgur.com/vqtz8.png?s=128&g=1", "display_name": "Johann Bauer", "link": "https://stackoverflow.com/users/1024057/johann-bauer"}, "edited": false, "score": 0, "creation_date": 1433018639, "post_id": 30551130, "comment_id": 49174315, "body": "Maybe there&#39;s a better way to do this but I&#39;ll be happy if I can manage to find a solution that works after all"}, {"owner": {"reputation": 4190, "user_id": 2110623, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/a5f1b5f95d5b3bb75901fb546cd1c52d?s=128&d=identicon&r=PG", "display_name": "aochagavia", "link": "https://stackoverflow.com/users/2110623/aochagavia"}, "reply_to_user": {"reputation": 2307, "user_id": 1024057, "user_type": "registered", "accept_rate": 90, "profile_image": "https://i.stack.imgur.com/vqtz8.png?s=128&g=1", "display_name": "Johann Bauer", "link": "https://stackoverflow.com/users/1024057/johann-bauer"}, "edited": false, "score": 0, "creation_date": 1433019655, "post_id": 30551130, "comment_id": 49174616, "body": "I wonder how it would work out with the rest of your program if you had a list of <code>(number, (x, y))</code> tuples instead of just a list of integers. In the first case you could just <code>map</code> over the list and update the position of the square in the given position (leaving the rest of the elements unchanged)."}, {"owner": {"reputation": 17293, "user_id": 736162, "user_type": "registered", "accept_rate": 78, "profile_image": "https://www.gravatar.com/avatar/eb6854f56cb2aa14ce798b53ea667639?s=128&d=identicon&r=PG", "display_name": "Andrea", "link": "https://stackoverflow.com/users/736162/andrea"}, "reply_to_user": {"reputation": 2307, "user_id": 1024057, "user_type": "registered", "accept_rate": 90, "profile_image": "https://i.stack.imgur.com/vqtz8.png?s=128&g=1", "display_name": "Johann Bauer", "link": "https://stackoverflow.com/users/1024057/johann-bauer"}, "edited": false, "score": 1, "creation_date": 1433047676, "post_id": 30551130, "comment_id": 49180011, "body": "Like aochagavia I wonder if this is the correct data structure. Perhaps, @jreuab, you are looking for an Array?"}, {"owner": {"reputation": 2307, "user_id": 1024057, "user_type": "registered", "accept_rate": 90, "profile_image": "https://i.stack.imgur.com/vqtz8.png?s=128&g=1", "display_name": "Johann Bauer", "link": "https://stackoverflow.com/users/1024057/johann-bauer"}, "reply_to_user": {"reputation": 17293, "user_id": 736162, "user_type": "registered", "accept_rate": 78, "profile_image": "https://www.gravatar.com/avatar/eb6854f56cb2aa14ce798b53ea667639?s=128&d=identicon&r=PG", "display_name": "Andrea", "link": "https://stackoverflow.com/users/736162/andrea"}, "edited": false, "score": 0, "creation_date": 1433059226, "post_id": 30551130, "comment_id": 49182197, "body": "@Andrea Huh, I didn&#39;t even know something like an Array exists in Haskell. I guess that would really make more sense here."}, {"owner": {"reputation": 2307, "user_id": 1024057, "user_type": "registered", "accept_rate": 90, "profile_image": "https://i.stack.imgur.com/vqtz8.png?s=128&g=1", "display_name": "Johann Bauer", "link": "https://stackoverflow.com/users/1024057/johann-bauer"}, "edited": false, "score": 0, "creation_date": 1433059490, "post_id": 30551130, "comment_id": 49182255, "body": "@aochagavia I guess saving the coordinates would make this easier to read. It would also come in handy to calculate the Manhattan-distance."}, {"owner": {"reputation": 998, "user_id": 1836024, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/50fa26f5be475f53a7142b91b02afeda?s=128&d=identicon&r=PG", "display_name": "thetrutz", "link": "https://stackoverflow.com/users/1836024/thetrutz"}, "edited": false, "score": 0, "creation_date": 1484081481, "post_id": 30551130, "comment_id": 70361060, "body": "This answer does not seem to be correct! Try out: swapElementsAt 0 1 &quot;ab&quot; == &quot;bab&quot;"}, {"owner": {"reputation": 4190, "user_id": 2110623, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/a5f1b5f95d5b3bb75901fb546cd1c52d?s=128&d=identicon&r=PG", "display_name": "aochagavia", "link": "https://stackoverflow.com/users/2110623/aochagavia"}, "edited": false, "score": 0, "creation_date": 1485201881, "post_id": 30551130, "comment_id": 70817422, "body": "@thetruz thanks for pointing that out! I realized there were a couple of off by one errors. I think it should be fixed now."}, {"owner": {"reputation": 19307, "user_id": 1663462, "user_type": "registered", "accept_rate": 78, "profile_image": "https://www.gravatar.com/avatar/c30e0fa0f3a065c038c633a95066d299?s=128&d=identicon&r=PG", "display_name": "Chris Stryczynski", "link": "https://stackoverflow.com/users/1663462/chris-stryczynski"}, "edited": false, "score": 0, "creation_date": 1509485847, "post_id": 30551130, "comment_id": 81037149, "body": "Minor additional limitation : <code>swapElementsAt 0 0 &quot;abc&quot;</code> evalutes to <code>aabc</code>."}], "tags": [], "owner": {"reputation": 4190, "user_id": 2110623, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/a5f1b5f95d5b3bb75901fb546cd1c52d?s=128&d=identicon&r=PG", "display_name": "aochagavia", "link": "https://stackoverflow.com/users/2110623/aochagavia"}, "is_accepted": true, "score": 6, "last_activity_date": 1509484682, "last_edit_date": 1509484682, "creation_date": 1433018170, "answer_id": 30551130, "question_id": 30551033, "link": "https://stackoverflow.com/questions/30551033/swap-two-elements-in-a-list-by-its-indices/30551130#30551130", "title": "Swap two elements in a list by its indices", "body": "<p>Haskell doesn't have such a function, mainly because it is a little bit un-functional. What are you actually trying to achieve?</p>\n\n<p>You can implement your own version of it (maybe there is a more idiomatic way to write this). Note that I assume that <code>i &lt; j</code>, but it would be trivial to extend the function to correctly handle the other cases:</p>\n\n<pre><code>swapElementsAt :: Int -&gt; Int -&gt; [a] -&gt; [a]\nswapElementsAt i j xs = let elemI = xs !! i\n                            elemJ = xs !! j\n                            left = take i xs\n                            middle = take (j - i - 1) (drop (i + 1) xs)\n                            right = drop (j + 1) xs\n                    in  left ++ [elemJ] ++ middle ++ [elemI] ++ right\n</code></pre>\n"}, {"comments": [{"owner": {"reputation": 2307, "user_id": 1024057, "user_type": "registered", "accept_rate": 90, "profile_image": "https://i.stack.imgur.com/vqtz8.png?s=128&g=1", "display_name": "Johann Bauer", "link": "https://stackoverflow.com/users/1024057/johann-bauer"}, "edited": false, "score": 3, "creation_date": 1433059825, "post_id": 30551279, "comment_id": 49182332, "body": "<code>take a list</code> really is a great line ;)"}, {"owner": {"reputation": 998, "user_id": 1836024, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/50fa26f5be475f53a7142b91b02afeda?s=128&d=identicon&r=PG", "display_name": "thetrutz", "link": "https://stackoverflow.com/users/1836024/thetrutz"}, "edited": false, "score": 0, "creation_date": 1484081776, "post_id": 30551279, "comment_id": 70361214, "body": "This function is better than the accepted answer, because swapElementsAt&#39; 0 1 &quot;ab&quot; == &quot;ba&quot;, but it fails here: swapElementsAt&#39; 1 0 &quot;ab&quot; == &quot;aabb&quot;"}, {"owner": {"reputation": 2193, "user_id": 2856202, "user_type": "registered", "accept_rate": 50, "profile_image": "https://i.stack.imgur.com/AHuOz.png?s=128&g=1", "display_name": "eigenfield", "link": "https://stackoverflow.com/users/2856202/eigenfield"}, "edited": false, "score": 0, "creation_date": 1533320935, "post_id": 30551279, "comment_id": 90319668, "body": "i like this answer because i am able to make sense of it. Thank you."}], "tags": [], "owner": {"reputation": 3588, "user_id": 2706344, "user_type": "registered", "accept_rate": 46, "profile_image": "https://www.gravatar.com/avatar/d5450ccc81c173504d25c755092adf01?s=128&d=identicon&r=PG&f=1", "display_name": "principal-ideal-domain", "link": "https://stackoverflow.com/users/2706344/principal-ideal-domain"}, "is_accepted": false, "score": 5, "last_activity_date": 1433143700, "last_edit_date": 1433143700, "creation_date": 1433019117, "answer_id": 30551279, "question_id": 30551033, "link": "https://stackoverflow.com/questions/30551033/swap-two-elements-in-a-list-by-its-indices/30551279#30551279", "title": "Swap two elements in a list by its indices", "body": "<p>That's how I solved it:</p>\n\n<pre><code>swapElementsAt :: Int -&gt; Int -&gt; [a] -&gt; [a]\nswapElementsAt a b list = list1 ++ [list !! b] ++ list2 ++ [list !! a] ++ list3\n    where   list1 = take a list;\n            list2 = drop (succ a) (take b list);\n            list3 = drop (succ b) list\n</code></pre>\n\n<p>Here I used the convention that position 0 is the first. My function expects a&lt;=b.</p>\n\n<p>What I like most in my program is the line <code>take a list</code>.</p>\n\n<p>Edit: If you want to get more such cool lines, look at this code:</p>\n\n<pre><code>swapElementsAt :: Int -&gt; Int -&gt; [a] -&gt; [a]\nswapElementsAt a another list = list1 ++ [list !! another] ++ list2 ++ [list !! a] ++ list3\n    where   list1 = take a list;\n            list2 = drop (succ a) (take another list);\n            list3 = drop (succ another) list\n</code></pre>\n"}, {"tags": [], "owner": {"reputation": 3588, "user_id": 2706344, "user_type": "registered", "accept_rate": 46, "profile_image": "https://www.gravatar.com/avatar/d5450ccc81c173504d25c755092adf01?s=128&d=identicon&r=PG&f=1", "display_name": "principal-ideal-domain", "link": "https://stackoverflow.com/users/2706344/principal-ideal-domain"}, "is_accepted": false, "score": 1, "last_activity_date": 1433022330, "creation_date": 1433022330, "answer_id": 30551683, "question_id": 30551033, "link": "https://stackoverflow.com/questions/30551033/swap-two-elements-in-a-list-by-its-indices/30551683#30551683", "title": "Swap two elements in a list by its indices", "body": "<p>There is also a recursive solution:</p>\n\n<pre><code>setElementAt :: a -&gt; Int -&gt; [a] -&gt; [a]\nsetElementAt a 0 (_:tail) = a:tail\nsetElementAt a pos (b:tail) = b:(setElementAt a (pred pos) tail)\n\nswapElementsAt :: Int -&gt; Int -&gt; [a] -&gt; [a]\nswapElementsAt 0 b list@(c:tail) = (list !! b):(setElementAt c (pred b) tail)\nswapElementsAt a b (c:tail) = c:(swapElementsAt (pred a) (pred b) tail)\n</code></pre>\n"}, {"comments": [{"owner": {"reputation": 1793, "user_id": 1593359, "user_type": "registered", "accept_rate": 68, "profile_image": "https://i.stack.imgur.com/2ifAI.jpg?s=128&g=1", "display_name": "Soham Chowdhury", "link": "https://stackoverflow.com/users/1593359/soham-chowdhury"}, "edited": false, "score": 0, "creation_date": 1454151024, "post_id": 30552010, "comment_id": 57922623, "body": "There is indeed an off-by-one error, as you say. The second <code>splitAt</code> should be at <code>second - first - 1</code>."}, {"owner": {"reputation": 44013, "user_id": 1477667, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/trgKM.jpg?s=128&g=1", "display_name": "dfeuer", "link": "https://stackoverflow.com/users/1477667/dfeuer"}, "reply_to_user": {"reputation": 1793, "user_id": 1593359, "user_type": "registered", "accept_rate": 68, "profile_image": "https://i.stack.imgur.com/2ifAI.jpg?s=128&g=1", "display_name": "Soham Chowdhury", "link": "https://stackoverflow.com/users/1593359/soham-chowdhury"}, "edited": false, "score": 0, "creation_date": 1454164817, "post_id": 30552010, "comment_id": 57926953, "body": "Thanks, @SohamChowdhury."}, {"owner": {"reputation": 998, "user_id": 1836024, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/50fa26f5be475f53a7142b91b02afeda?s=128&d=identicon&r=PG", "display_name": "thetrutz", "link": "https://stackoverflow.com/users/1836024/thetrutz"}, "edited": false, "score": 0, "creation_date": 1484081978, "post_id": 30552010, "comment_id": 70361322, "body": "This function is better than at least two other functions I commented on, but it fails for the edge case: swap 0 1 &quot;ab&quot; == &quot;ba&quot;, swap 1 0 &quot;ab&quot; == &quot;ba&quot;, swap 0 0 &quot;a&quot; &lt;- throws exception"}, {"owner": {"reputation": 44013, "user_id": 1477667, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/trgKM.jpg?s=128&g=1", "display_name": "dfeuer", "link": "https://stackoverflow.com/users/1477667/dfeuer"}, "reply_to_user": {"reputation": 998, "user_id": 1836024, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/50fa26f5be475f53a7142b91b02afeda?s=128&d=identicon&r=PG", "display_name": "thetrutz", "link": "https://stackoverflow.com/users/1836024/thetrutz"}, "edited": false, "score": 0, "creation_date": 1484114931, "post_id": 30552010, "comment_id": 70371954, "body": "@thetrutz, that should fix it."}], "tags": [], "owner": {"reputation": 44013, "user_id": 1477667, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/trgKM.jpg?s=128&g=1", "display_name": "dfeuer", "link": "https://stackoverflow.com/users/1477667/dfeuer"}, "is_accepted": false, "score": 3, "last_activity_date": 1484114876, "last_edit_date": 1484114876, "creation_date": 1433025127, "answer_id": 30552010, "question_id": 30551033, "link": "https://stackoverflow.com/questions/30551033/swap-two-elements-in-a-list-by-its-indices/30552010#30552010", "title": "Swap two elements in a list by its indices", "body": "<p>This is a strange thing to do, but this should work, aside from the off-by-one errors you'll have to fix since I'm writing this on my phone. This version avoids going over the same segments of the list any more times than necessary.</p>\n\n<pre><code>swap' :: Int -&gt; Int -&gt; [a] -&gt; [a]\nswap' first second lst = beginning ++ [y] ++ middle ++ [x] ++ end\n  where\n    (beginning, (x : r)) = splitAt first lst\n    (middle, (y : end)) = splitAt (second - first - 1) r\n\nswap x y | x == y = id\n         | otherwise = swap' (min x y) (max x y)\n</code></pre>\n"}, {"tags": [], "owner": {"reputation": 42094, "user_id": 828361, "user_type": "registered", "accept_rate": 44, "profile_image": "https://www.gravatar.com/avatar/6a82397672dcc1fca31c32508ef0798b?s=128&d=identicon&r=PG", "display_name": "pigworker", "link": "https://stackoverflow.com/users/828361/pigworker"}, "is_accepted": false, "score": 19, "last_activity_date": 1433028684, "creation_date": 1433028684, "answer_id": 30552379, "question_id": 30551033, "link": "https://stackoverflow.com/questions/30551033/swap-two-elements-in-a-list-by-its-indices/30552379#30552379", "title": "Swap two elements in a list by its indices", "body": "<p><strong>Warning: differential calculus.</strong> I don't intend this answer entirely seriously, as it's rather a sledgehammer nutcracking. But it's a sledgehammer I keep handy, so why not have some sport? Apart from the fact that it's probably rather more than the questioner wanted to know, for which I apologize. It's an attempt to dig out the deeper structure behind the sensible answers which have already been suggested.</p>\n\n<p>The class of differentiable functors offers at least the following bits and pieces.</p>\n\n<pre><code>class (Functor f, Functor (D f)) =&gt; Diff (f :: * -&gt; *) where\n  type D f :: * -&gt; *\n  up   :: (I :*: D f) :-&gt; f\n  down :: f :-&gt; (f :.: (I :*: D f))\n</code></pre>\n\n<p>I suppose I'd better unpack some of those definitions. They're basic kit for combining functors. This thing</p>\n\n<pre><code>type (f :-&gt; g) = forall a. f a -&gt; g a\n</code></pre>\n\n<p>abbreviates polymorphic function types for operations on containers.</p>\n\n<p>Here are constant, identity, composition, sum and product for containers.</p>\n\n<pre><code>newtype K a x = K a                       deriving (Functor, Foldable, Traversable, Show)\nnewtype I x = I x                         deriving (Functor, Foldable, Traversable, Show)\nnewtype (f :.: g) x = C {unC :: f (g x)}  deriving (Functor, Foldable, Traversable, Show)\ndata (f :+: g) x = L (f x) | R (g x)      deriving (Functor, Foldable, Traversable, Show)\ndata (f :*: g) x = f x :*: g x            deriving (Functor, Foldable, Traversable, Show)\n</code></pre>\n\n<p><code>D</code> computes the derivative of a functor by the usual rules of calculus. It tells us how to represent a <em>one-hole context</em> for an element. Let's read the types of those operations again.</p>\n\n<pre><code>up   :: (I :*: D f) :-&gt; f\n</code></pre>\n\n<p>says we can make a whole <code>f</code> from the pair of <em>one</em> element and a context for that element in an <code>f</code>. It's \"up\", because we're navigating upward in a hierarchical structure, focusing on the whole rather than one element.</p>\n\n<pre><code>down :: f :-&gt; (f :.: (I :*: D f))\n</code></pre>\n\n<p>Meanwhile, we can decorate every element in a differentiable functor structure with <em>its</em> context, computing all the ways to go \"down\" to one element in particular.</p>\n\n<p>I'll leave the <code>Diff</code> instances for the basic components to the end of this answer. For lists we get</p>\n\n<pre><code>instance Diff [] where\n  type D [] = [] :*: []\n  up (I x :*: (xs :*: ys)) = xs ++ x : ys\n  down [] = C []\n  down (x : xs) = C ((I x :*: ([] :*: xs)) :\n    fmap (id *:* ((x :) *:* id)) (unC (down xs)))\n</code></pre>\n\n<p>where</p>\n\n<pre><code>(*:*) :: (f a -&gt; f' a) -&gt; (g a -&gt; g' a) -&gt; (f :*: g) a -&gt; (f' :*: g') a\n(ff' *:* gg') (f :*: g) = ff' f :*: gg' g\n</code></pre>\n\n<p>So, for example,</p>\n\n<pre><code>&gt; unC (down [0,1,2])\n[I 0 :*: ([] :*: [1,2]),I 1 :*: ([0] :*: [2]),I 2 :*: ([0,1] :*: [])]\n</code></pre>\n\n<p>picks out each element-in-context in turn.</p>\n\n<p>If <code>f</code> is also <code>Foldable</code>, we get a generalized <code>!!</code> operator...</p>\n\n<pre><code>getN :: (Diff f, Foldable f) =&gt; f x -&gt; Int -&gt; (I :*: D f) x\ngetN f n = foldMap (: []) (unC (down f)) !! n\n</code></pre>\n\n<p>...with the added bonus that we get the element's context as well as the element itself.</p>\n\n<pre><code>&gt; getN \"abcd\" 2\nI 'c' :*: (\"ab\" :*: \"d\")\n\n&gt; getN ((I \"a\" :*: I \"b\") :*: (I \"c\" :*: I \"d\")) 2\nI \"c\" :*: R ((I \"a\" :*: I \"b\") :*: L (K () :*: I \"d\"))\n</code></pre>\n\n<p>If we want a functor to offer swapping of <em>two</em> elements, it had better be twice differentiable, and its derivative had better be foldable too. Here goes.</p>\n\n<pre><code>swapN :: (Diff f, Diff (D f), Foldable f, Foldable (D f)) =&gt;\n  Int -&gt; Int -&gt; f x -&gt; f x\nswapN i j f = case compare i j of\n  { LT -&gt; go i j ; EQ -&gt; f ; GT -&gt; go j i } where\n  go i j = up (I y :*: up (I x :*: f'')) where\n    I x :*: f'   = getN f i          -- grab the left thing\n    I y :*: f''  = getN f' (j - 1)   -- grab the right thing\n</code></pre>\n\n<p>It's now easy to grab two elements out and plug them back in the other way around. If we're numbering the positions, we just need to be careful about the way removing elements renumbers the positions.</p>\n\n<pre><code>&gt; swapN 1 3 \"abcde\"\n\"adcbe\"\n\n&gt; swapN 1 2 ((I \"a\" :*: I \"b\") :*: (I \"c\" :*: I \"d\"))\n(I \"a\" :*: I \"c\") :*: (I \"b\" :*: I \"d\")\n</code></pre>\n\n<p>As ever, you don't have do dig down too far below a funny editing operation to find some differential structure at work.</p>\n\n<p><strong>For completeness.</strong> Here are the other instances involved in the above.</p>\n\n<pre><code>instance Diff (K a) where     -- constants have zero derivative\n  type D (K a) = K Void\n  up (_ :*: K z) = absurd z\n  down (K a) = C (K a)\n\ninstance Diff I where         -- identity has unit derivative\n  type D I = K ()\n  up (I x :*: K ()) = I x\n  down (I x) = C (I (I x :*: K ()))\n\ninstance (Diff f, Diff g) =&gt; Diff (f :+: g) where  -- commute with +\n  type D (f :+: g) = D f :+: D g\n  up (I x :*: L f') = L (up (I x :*: f'))\n  up (I x :*: R g') = R (up (I x :*: g'))\n  down (L f) = C (L (fmap (id *:* L) (unC (down f))))\n  down (R g) = C (R (fmap (id *:* R) (unC (down g))))\n\ninstance (Diff f, Diff g) =&gt; Diff (f :*: g) where  -- product rule\n  type D (f :*: g) = (D f :*: g) :+: (f :*: D g)\n  up (I x :*: (L (f' :*: g))) = up (I x :*: f') :*: g\n  up (I x :*: (R (f :*: g'))) = f :*: up (I x :*: g')\n  down (f :*: g) = C     (fmap (id *:* (L . (:*: g))) (unC (down f))\n                      :*: fmap (id *:* (R . (f :*:))) (unC (down g)))\n\ninstance (Diff f, Diff g) =&gt; Diff (f :.: g) where  -- chain rule\n  type D (f :.: g) = (D f :.: g) :*: D g\n  up (I x :*: (C f'g :*: g')) = C (up (I (up (I x :*: g')) :*: f'g))\n  down (C fg) = C (C (fmap inner (unC (down fg)))) where\n    inner (I g :*: f'g) = fmap wrap (unC (down g)) where\n      wrap (I x :*: g') = I x :*: (C f'g :*: g')\n</code></pre>\n"}, {"comments": [{"owner": {"reputation": 998, "user_id": 1836024, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/50fa26f5be475f53a7142b91b02afeda?s=128&d=identicon&r=PG", "display_name": "thetrutz", "link": "https://stackoverflow.com/users/1836024/thetrutz"}, "edited": false, "score": 0, "creation_date": 1484082245, "post_id": 30557189, "comment_id": 70361480, "body": "Yes, finally something, that does work! swapTwo&#39; 0 0 &quot;a&quot; == &quot;a&quot;, swapTwo&#39; 0 1 &quot;ab&quot; == &quot;ba&quot;, swapTwo&#39; 1 0 &quot;ab&quot; == &quot;ba&quot; and longer list work as well. This should be the accepted answer! Thank you very much, for that elegant solution!"}], "tags": [], "owner": {"reputation": 785, "user_id": 3087558, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/a43d21bfa85dc7dc360cafa7f69ba3b1?s=128&d=identicon&r=PG&f=1", "display_name": "fgv", "link": "https://stackoverflow.com/users/3087558/fgv"}, "is_accepted": false, "score": 6, "last_activity_date": 1433078455, "last_edit_date": 1433078455, "creation_date": 1433073764, "answer_id": 30557189, "question_id": 30551033, "link": "https://stackoverflow.com/questions/30551033/swap-two-elements-in-a-list-by-its-indices/30557189#30557189", "title": "Swap two elements in a list by its indices", "body": "<p>There are several working answers here, but I thought that a more idiomatic haskell example would be useful. </p>\n\n<p>In essence, we zip an infinite sequence of natural numbers with the original list to include ordering information in the first element of the resulting pairs, and then we use a simple right fold (catamorphism) to consume the list from the right and create a new list, but this time with the correct elements swapped. We finally extract all the second elements, discarding the first element containing the ordering.</p>\n\n<p>The indexing in this case is zero-based (congruent with Haskell's typical indexes) and the pointers must be in range or you'll get an exception (this can be easily prevented if you change the resulting type to Maybe [a]).</p>\n\n<pre><code>swapTwo :: Int -&gt; Int -&gt; [a] -&gt; [a]\nswapTwo f s xs = map snd . foldr (\\x a -&gt; \n        if fst x == f then ys !! s : a\n        else if fst x == s then ys !! f : a\n        else x : a) [] $ ys\n    where ys = zip [0..] xs\n</code></pre>\n\n<p>And a single liner, doing the swap in just one pass (combining the functionality of the foldr and map into a zipWith):</p>\n\n<pre><code>swapTwo' f s xs = zipWith (\\x y -&gt; \n    if x == f then xs !! s\n    else if x == s then xs !! f\n    else y) [0..] xs\n</code></pre>\n"}, {"comments": [{"owner": {"reputation": 44013, "user_id": 1477667, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/trgKM.jpg?s=128&g=1", "display_name": "dfeuer", "link": "https://stackoverflow.com/users/1477667/dfeuer"}, "edited": false, "score": 0, "creation_date": 1468209053, "post_id": 38295247, "comment_id": 64014445, "body": "I don&#39;t <i>think</i> you&#39;ve actually deforested anything. Unless GHC performs some fancy optimization (I haven&#39;t checked), your code will build up chains of function compositions. Those are generally no better than the lists they replace. Have you checked the GHC Core or done some profiling to see?"}, {"owner": {"reputation": 41, "user_id": 6570880, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/a1e20f3323048c8d026cd5f18aaa5d16?s=128&d=identicon&r=PG&f=1", "display_name": "seha", "link": "https://stackoverflow.com/users/6570880/seha"}, "reply_to_user": {"reputation": 44013, "user_id": 1477667, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/trgKM.jpg?s=128&g=1", "display_name": "dfeuer", "link": "https://stackoverflow.com/users/1477667/dfeuer"}, "edited": false, "score": 0, "creation_date": 1468217486, "post_id": 38295247, "comment_id": 64016924, "body": "No, I haven&#39;t. At least it avoids repeated case analysis. Anyway, thanks for your feedback! I&#39;ve tried to incorporate it into another solution."}], "tags": [], "owner": {"reputation": 41, "user_id": 6570880, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/a1e20f3323048c8d026cd5f18aaa5d16?s=128&d=identicon&r=PG&f=1", "display_name": "seha", "link": "https://stackoverflow.com/users/6570880/seha"}, "is_accepted": false, "score": 1, "last_activity_date": 1468175863, "creation_date": 1468175863, "answer_id": 38295247, "question_id": 30551033, "link": "https://stackoverflow.com/questions/30551033/swap-two-elements-in-a-list-by-its-indices/38295247#38295247", "title": "Swap two elements in a list by its indices", "body": "<p>I really like @dfeuer 's solution. However there's still room for optimization by way of deforestation:</p>\n\n<pre><code>swap' :: Int -&gt; Int -&gt; [a] -&gt; [a]\nswap' first second lst = beginning $ [y] ++ (middle $ [x] ++ end)\n  where\n    (beginning, (x : r)) = swapHelp first lst\n    (middle, (y : end)) = swapHelp (second - first - 1) r\n\nswapHelp :: Int -&gt; [a] -&gt; ([a] -&gt; [a],[a])\nswapHelp 0 l     = (    id , l)\nswapHelp n (h:t) = ((h:).f , r) where\n                   (     f , r) = swapHelp (n-1) t\n</code></pre>\n"}, {"comments": [{"owner": {"reputation": 44013, "user_id": 1477667, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/trgKM.jpg?s=128&g=1", "display_name": "dfeuer", "link": "https://stackoverflow.com/users/1477667/dfeuer"}, "edited": false, "score": 0, "creation_date": 1468381165, "post_id": 38300185, "comment_id": 64098399, "body": "I suspect that any fancy solution should probably start with something that looks approximately like <code>swap&#39; 0 !j xs = swap&#39;&#39; j xs; swap&#39; i !j (x : xs) = x : swap&#39; (i - 1) (j - 1) xs</code>. This reduces the problem to swapping the head of the list with some given position. It&#39;s still not clear to me how best to proceed from there."}, {"owner": {"reputation": 41, "user_id": 6570880, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/a1e20f3323048c8d026cd5f18aaa5d16?s=128&d=identicon&r=PG&f=1", "display_name": "seha", "link": "https://stackoverflow.com/users/6570880/seha"}, "reply_to_user": {"reputation": 44013, "user_id": 1477667, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/trgKM.jpg?s=128&g=1", "display_name": "dfeuer", "link": "https://stackoverflow.com/users/1477667/dfeuer"}, "edited": false, "score": 0, "creation_date": 1470599091, "post_id": 38300185, "comment_id": 65002723, "body": "It&#39;s easy if you pass the first element to your helper and letting it return the replaced element too. Great idea, see my edit."}], "tags": [], "owner": {"reputation": 41, "user_id": 6570880, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/a1e20f3323048c8d026cd5f18aaa5d16?s=128&d=identicon&r=PG&f=1", "display_name": "seha", "link": "https://stackoverflow.com/users/6570880/seha"}, "is_accepted": false, "score": 3, "last_activity_date": 1470678429, "last_edit_date": 1470678429, "creation_date": 1468217391, "answer_id": 38300185, "question_id": 30551033, "link": "https://stackoverflow.com/questions/30551033/swap-two-elements-in-a-list-by-its-indices/38300185#38300185", "title": "Swap two elements in a list by its indices", "body": "<p><strong><em>first-order one-pass</em> swapping</strong></p>\n\n<pre><code>swap 1 j    l  = let (jth,ith:l') = swapHelp j l ith in jth:l'\nswap j 1    l  = swap 1 j l\nswap i j (h:t) = h : swap (i-1) (j-1) t\n\nswapHelp 1 (h:t) x = (h,x:t)\nswapHelp n (h:t) x = (y,h:t') where\n                     (y,  t') = swapHelp (n-1) t x\n</code></pre>\n\n<ul>\n<li>now with <em>precondition</em> in compliance with original question, i.e. relaxed to <em>1 &lt;= i,j &lt;= length l</em> for <em>swap i j l</em></li>\n<li>draws heavily on an idea by @dfeuer to reduce the problem to swapping the 1st element of a list with another from a given position</li>\n</ul>\n"}, {"comments": [{"owner": {"reputation": 61419, "user_id": 849891, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/MbEO3.png?s=128&g=1", "display_name": "Will Ness", "link": "https://stackoverflow.com/users/849891/will-ness"}, "edited": false, "score": 1, "creation_date": 1587024502, "post_id": 61239655, "comment_id": 108347419, "body": "what about <code>swapItems 2 3 [9,8,7,1,2,3,4]</code>, does it swap the 2nd and the 3rd element in that list?  what about <code>swapItems 2 3 [1,2,3,3,3]</code>, does it swap <i>two</i> elements in the list?"}, {"owner": {"reputation": 587, "user_id": 1106226, "user_type": "registered", "accept_rate": 94, "profile_image": "https://i.stack.imgur.com/oxunr.png?s=128&g=1", "display_name": "Mihai B.", "link": "https://stackoverflow.com/users/1106226/mihai-b"}, "reply_to_user": {"reputation": 61419, "user_id": 849891, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/MbEO3.png?s=128&g=1", "display_name": "Will Ness", "link": "https://stackoverflow.com/users/849891/will-ness"}, "edited": false, "score": 0, "creation_date": 1587030681, "post_id": 61239655, "comment_id": 108350689, "body": "Good point, for lists with duplicates is needed a different approach. @WillNess"}, {"owner": {"reputation": 61419, "user_id": 849891, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/MbEO3.png?s=128&g=1", "display_name": "Will Ness", "link": "https://stackoverflow.com/users/849891/will-ness"}, "edited": false, "score": 1, "creation_date": 1587060444, "post_id": 61239655, "comment_id": 108368105, "body": "no, a different approach is needed for <i>any</i> lists, because the question asks about <i>positional</i> swapping, not the one based on value like it is in your answer."}], "tags": [], "owner": {"reputation": 587, "user_id": 1106226, "user_type": "registered", "accept_rate": 94, "profile_image": "https://i.stack.imgur.com/oxunr.png?s=128&g=1", "display_name": "Mihai B.", "link": "https://stackoverflow.com/users/1106226/mihai-b"}, "is_accepted": false, "score": 0, "last_activity_date": 1587114294, "last_edit_date": 1587114294, "creation_date": 1586989465, "answer_id": 61239655, "question_id": 30551033, "link": "https://stackoverflow.com/questions/30551033/swap-two-elements-in-a-list-by-its-indices/61239655#61239655", "title": "Swap two elements in a list by its indices", "body": "<p>For positional swapping, using a more complex fold function I have changed the value of the smalest (<code>min</code>) index with the value of the greates <code>(xs!!(y-ii))</code> and then keep the value for the greatest index in the temp, until find it, the  index(<code>max</code>).</p>\n\n<p>I used <code>min</code> and <code>max</code> to make sure I encounter in proper order the indices otherwise I would have to put more checks and conditions in the <code>folds</code> function.</p>\n\n<pre><code>folds _ _ _ _ [] = []\nfolds i z y tmp (x:xs)\n    | i == z = (xs!!(y-ii)):folds ii z y x xs\n    | i == y = tmp:folds ii z y 0 xs\n    | otherwise = x:folds ii z y tmp xs\n    where \n        ii = i+1\n\nswapElementsAt x y xs = folds 0 a b 0 xs\n    where\n        a = min x y\n        b = max x y\n</code></pre>\n\n<p>Results</p>\n\n<pre><code>&gt; swapElementsAt 0 1 [1,1,1,3,4,9]\n[1,1,1,3,4,9]\n&gt; swapElementsAt 0 5 [1,1,1,3,4,9]\n[9,1,1,3,4,1]\n&gt; swapElementsAt 3 1 [1,1,1,3,4,5]\n[1,3,1,1,4,5]\n&gt; swapElementsAt 1 3 [1,1,1,3,4,5]\n[1,3,1,1,4,5]\n&gt; swapElementsAt 5 4 [1,1,1,3,4,5]\n[1,1,1,3,5,4]\n\n</code></pre>\n"}], "owner": {"reputation": 2307, "user_id": 1024057, "user_type": "registered", "accept_rate": 90, "profile_image": "https://i.stack.imgur.com/vqtz8.png?s=128&g=1", "display_name": "Johann Bauer", "link": "https://stackoverflow.com/users/1024057/johann-bauer"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 9623, "favorite_count": 5, "accepted_answer_id": 30551130, "answer_count": 9, "score": 11, "last_activity_date": 1587114294, "creation_date": 1433017625, "question_id": 30551033, "link": "https://stackoverflow.com/questions/30551033/swap-two-elements-in-a-list-by-its-indices", "title": "Swap two elements in a list by its indices", "body": "<p>Is there any way to swap two elements in a list if the only thing I know about the elements is the position at which they occur in the list.</p>\n\n<p>To be more specific, I am looking for something like this:</p>\n\n<pre><code>swapElementsAt :: Int -&gt; Int -&gt; [Int] -&gt; [Int]\n</code></pre>\n\n<p>that would behave like that:</p>\n\n<pre><code>&gt; swapElementsAt 1 3 [5,4,3,2,1] -- swap the first and third elements\n[3,4,5,2,1]\n</code></pre>\n\n<p>I thought that a built-in function for this might exists in Haskell but I wasn't able to find it.</p>\n"}, {"tags": ["haskell", "cabal", "cabal-install", "leksah"], "answers": [{"comments": [{"owner": {"reputation": 18456, "user_id": 1198559, "user_type": "registered", "accept_rate": 70, "profile_image": "https://i.stack.imgur.com/bOjLe.png?s=128&g=1", "display_name": "jhegedus", "link": "https://stackoverflow.com/users/1198559/jhegedus"}, "edited": false, "score": 0, "creation_date": 1433054501, "post_id": 30553501, "comment_id": 49181225, "body": "many thanks ! a friend patched yesterday regex-tdfa-text-1.0.0.2 for ghc 7.10.3 (many thanks for that !) so I got leksah up and running with that patch, he will probably send the patch to the package maintainer"}], "tags": [], "owner": {"reputation": 386, "user_id": 946152, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/900fe348fc542ba21bf84a69d552829b?s=128&d=identicon&r=PG", "display_name": "Hamish Mackenzie", "link": "https://stackoverflow.com/users/946152/hamish-mackenzie"}, "is_accepted": false, "score": 4, "last_activity_date": 1433042450, "creation_date": 1433042450, "answer_id": 30553501, "question_id": 30550519, "link": "https://stackoverflow.com/questions/30550519/leksah-install-fails-due-to-regex-tdfa-text-1-0-0-2/30553501#30553501", "title": "leksah install fails due to regex-tdfa-text-1.0.0.2", "body": "<p>Run:</p>\n\n<pre><code>cabal install regex-tdfa-text --ghc-options=-XFlexibleContexts\n</code></pre>\n\n<p>Then try again.</p>\n"}], "owner": {"reputation": 18456, "user_id": 1198559, "user_type": "registered", "accept_rate": 70, "profile_image": "https://i.stack.imgur.com/bOjLe.png?s=128&g=1", "display_name": "jhegedus", "link": "https://stackoverflow.com/users/1198559/jhegedus"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 238, "favorite_count": 0, "answer_count": 1, "score": 3, "last_activity_date": 1433042450, "creation_date": 1433014469, "question_id": 30550519, "link": "https://stackoverflow.com/questions/30550519/leksah-install-fails-due-to-regex-tdfa-text-1-0-0-2", "title": "leksah install fails due to regex-tdfa-text-1.0.0.2", "body": "<p>On ubuntu 12.04, ghc 7.10.3, cabal 1.22.3, 4 gigs of RAM,  I get an error when installing leksah, following <a href=\"https://github.com/leksah/leksah\" rel=\"nofollow\">these</a> instructions.</p>\n\n<p>Any idea how to solve this ? What is causing this? </p>\n\n<pre><code>joco@vm001:~$ cabal install leksah\nResolving dependencies...\nConfiguring regex-tdfa-text-1.0.0.2...\nBuilding regex-tdfa-text-1.0.0.2...\nFailed to install regex-tdfa-text-1.0.0.2\nBuild log ( /home/joco/.cabal/logs/regex-tdfa-text-1.0.0.2.log ):\nConfiguring regex-tdfa-text-1.0.0.2...\nBuilding regex-tdfa-text-1.0.0.2...\nPreprocessing library regex-tdfa-text-1.0.0.2...\n[1 of 2] Compiling Text.Regex.TDFA.Text.Lazy ( Text/Regex/TDFA/Text/Lazy.hs, dist/build/Text/Regex/TDFA/Text/Lazy.o )\n\nText/Regex/TDFA/Text/Lazy.hs:77:9:\n    Non type-variable argument\n      in the constraint: Data.Array.Base.IArray a (Int, Int)\n    (Use FlexibleContexts to permit this)\n    When checking that \u2018go\u2019 has the inferred type\n      go :: forall t (a :: * -&gt; * -&gt; *) i.\n            (Functor (a i), Num i, GHC.Arr.Ix i,\n             Data.Array.Base.IArray a (Int, Int), Extract t) =&gt;\n            Int -&gt; t -&gt; [a i (Int, Int)] -&gt; [a i (t, (Int, Int))]\n    In the expression:\n      let\n        go i _ _ | i `seq` False = undefined\n        go _i _t [] = []\n        go i t (x : xs)\n          = let ... in fmap trans x : seq t' (go (off0 + len0) t' xs)\n      in go 0 source (matchAll regex source)\n    In an equation for \u2018matchAllText\u2019:\n        matchAllText regex source\n          = let\n              go i _ _ | i `seq` False = undefined\n              go _i _t [] = ...\n              go i t (x : xs) = ...\n            in go 0 source (matchAll regex source)\ncabal: Error: some packages failed to install:\nleksah-0.15.0.1 depends on regex-tdfa-text-1.0.0.2 which failed to install.\nregex-tdfa-text-1.0.0.2 failed during the building phase. The exception was:\nExitFailure 1\n\njoco@vm001:~$ cabal --version\ncabal-install version 1.22.4.0\nusing version 1.22.3.0 of the Cabal library \n\njoco@vm001:~$ ghc --version\nThe Glorious Glasgow Haskell Compilation System, version 7.10.1\n</code></pre>\n"}, {"tags": ["function", "haskell", "parameters", "arguments", "fold"], "comments": [{"owner": {"reputation": 94713, "user_id": 1139697, "user_type": "registered", "accept_rate": 86, "profile_image": "https://www.gravatar.com/avatar/5f136ddb684f39aaee1c028ee1950f6f?s=128&d=identicon&r=PG", "display_name": "Zeta", "link": "https://stackoverflow.com/users/1139697/zeta"}, "edited": false, "score": 4, "creation_date": 1433012696, "post_id": 30550186, "comment_id": 49172464, "body": "<code>break (flip elem &quot; \\t\\n&quot;)</code>?"}, {"owner": {"reputation": 10378, "user_id": 2476735, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/39e9447bbc32246fcd23b76b5e946618?s=128&d=identicon&r=PG&f=1", "display_name": "David Young", "link": "https://stackoverflow.com/users/2476735/david-young"}, "edited": false, "score": 0, "creation_date": 1433012713, "post_id": 30550186, "comment_id": 49172470, "body": "You can give <code>break</code> any function for its first argument. So you could just make a new function that is the predicate that you want and pass that to <code>break</code>."}, {"owner": {"reputation": 3566, "user_id": 4325010, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/048bff2cd5cae6d0a93ecd485f6690ad?s=128&d=identicon&r=PG&f=1", "display_name": "users at 4325010", "link": "https://stackoverflow.com/users/4325010/users-at-4325010"}, "reply_to_user": {"reputation": 94713, "user_id": 1139697, "user_type": "registered", "accept_rate": 86, "profile_image": "https://www.gravatar.com/avatar/5f136ddb684f39aaee1c028ee1950f6f?s=128&d=identicon&r=PG", "display_name": "Zeta", "link": "https://stackoverflow.com/users/1139697/zeta"}, "edited": false, "score": 0, "creation_date": 1433012995, "post_id": 30550186, "comment_id": 49172571, "body": "@Zeta Yes, it works, but could you explain it a little?"}, {"owner": {"reputation": 48129, "user_id": 76051, "user_type": "registered", "accept_rate": 91, "profile_image": "https://i.stack.imgur.com/AGDxz.jpg?s=128&g=1", "display_name": "Carsten", "link": "https://stackoverflow.com/users/76051/carsten"}, "edited": false, "score": 2, "creation_date": 1433013205, "post_id": 30550186, "comment_id": 49172641, "body": "<code>elem</code>checks if something is in a list so this will check if the argument is either <code>&#39;\\t&#39;</code> or <code>&#39;\\n&#39;</code> (a string is a list of chars) - now as <code>elem</code> wants it&#39;s arguments in the wrong order Zeta had to <code>flip</code> the function first"}, {"owner": {"reputation": 94713, "user_id": 1139697, "user_type": "registered", "accept_rate": 86, "profile_image": "https://www.gravatar.com/avatar/5f136ddb684f39aaee1c028ee1950f6f?s=128&d=identicon&r=PG", "display_name": "Zeta", "link": "https://stackoverflow.com/users/1139697/zeta"}, "reply_to_user": {"reputation": 48129, "user_id": 76051, "user_type": "registered", "accept_rate": 91, "profile_image": "https://i.stack.imgur.com/AGDxz.jpg?s=128&g=1", "display_name": "Carsten", "link": "https://stackoverflow.com/users/76051/carsten"}, "edited": false, "score": 0, "creation_date": 1433013278, "post_id": 30550186, "comment_id": 49172663, "body": "@Carsten: I wanted to use `elem`, but that doesn&#39;t really work in comments :/."}, {"owner": {"reputation": 100185, "user_id": 3234959, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/93bb12ca0f93dfddb33880316f7e66c2?s=128&d=identicon&r=PG&f=1", "display_name": "chi", "link": "https://stackoverflow.com/users/3234959/chi"}, "reply_to_user": {"reputation": 94713, "user_id": 1139697, "user_type": "registered", "accept_rate": 86, "profile_image": "https://www.gravatar.com/avatar/5f136ddb684f39aaee1c028ee1950f6f?s=128&d=identicon&r=PG", "display_name": "Zeta", "link": "https://stackoverflow.com/users/1139697/zeta"}, "edited": false, "score": 0, "creation_date": 1433014194, "post_id": 30550186, "comment_id": 49172963, "body": "@Zeta You can write <code>(`elem` &quot; \\t\\n&quot;)</code> if you surround it with double backticks. Roughly, two groups of N consecutive backticks can enclose any expression which uses only at most N-1 consecutive backticks. (SO should document this better, IMHO)"}, {"owner": {"reputation": 11366, "user_id": 3922954, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/76ba47d2fdd24ab56b0b273cce2075e5?s=128&d=identicon&r=PG&f=1", "display_name": "AJF", "link": "https://stackoverflow.com/users/3922954/ajf"}, "edited": false, "score": 0, "creation_date": 1433016316, "post_id": 30550186, "comment_id": 49173643, "body": "I actually quite like defining a function along the lines of <code>(&lt;&gt;) = liftM2 (||)</code> so you can do <code>break ((== &#39; &#39;) &lt;&gt; (== &#39;\\t&#39;) &lt;&gt; (== &#39;\\n&#39;)) xss</code>"}, {"owner": {"reputation": 126897, "user_id": 791604, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/ce991df7a056248d5e4f6fc3659ba733?s=128&d=identicon&r=PG", "display_name": "Daniel Wagner", "link": "https://stackoverflow.com/users/791604/daniel-wagner"}, "edited": false, "score": 1, "creation_date": 1433030545, "post_id": 30550186, "comment_id": 49177257, "body": "See also: <code>Data.Char.isSpace</code>, <code>Prelude.words</code>."}], "answers": [{"comments": [{"owner": {"reputation": 57219, "user_id": 33796, "user_type": "registered", "accept_rate": 70, "profile_image": "https://www.gravatar.com/avatar/08727b23ba62e634b32988cdff082663?s=128&d=identicon&r=PG", "display_name": "luqui", "link": "https://stackoverflow.com/users/33796/luqui"}, "edited": false, "score": 1, "creation_date": 1433018247, "post_id": 30550389, "comment_id": 49174203, "body": "This answer is great because it is right at the OP&#39;s level and opens up a new world without overexplaining."}], "tags": [], "owner": {"reputation": 3669, "user_id": 4876946, "user_type": "registered", "accept_rate": 87, "profile_image": "https://www.gravatar.com/avatar/5dc4839a7e9466d54f3791122f8f5d75?s=128&d=identicon&r=PG&f=1", "display_name": "Matt", "link": "https://stackoverflow.com/users/4876946/matt"}, "is_accepted": true, "score": 11, "last_activity_date": 1433018203, "last_edit_date": 1433018203, "creation_date": 1433013684, "answer_id": 30550389, "question_id": 30550186, "link": "https://stackoverflow.com/questions/30550186/multiple-parameters-of-a-function/30550389#30550389", "title": "Multiple parameters of a function", "body": "<p>Is this what you are looking for?</p>\n\n<pre><code>break (\\x -&gt; x == ' ' || x == '\\t' || x == '\\n') xss\n</code></pre>\n"}, {"tags": [], "owner": {"reputation": 94713, "user_id": 1139697, "user_type": "registered", "accept_rate": 86, "profile_image": "https://www.gravatar.com/avatar/5f136ddb684f39aaee1c028ee1950f6f?s=128&d=identicon&r=PG", "display_name": "Zeta", "link": "https://stackoverflow.com/users/1139697/zeta"}, "is_accepted": false, "score": 5, "last_activity_date": 1433013762, "creation_date": 1433013762, "answer_id": 30550407, "question_id": 30550186, "link": "https://stackoverflow.com/questions/30550186/multiple-parameters-of-a-function/30550407#30550407", "title": "Multiple parameters of a function", "body": "<p>Your current question isn't really about multiple parameters, but different predicates for <code>break</code>. Let's consider <code>break</code>'s type for a second:</p>\n\n<pre><code>break :: (a -&gt; Bool) -&gt; [a] -&gt; ([a], [a])\n</code></pre>\n\n<p>This type of function <code>(a -&gt; Bool)</code> is called a <em>predicate</em>. You can use anything that uses the right <code>a</code> and returns a <code>Bool</code>. That's why your first code typechecks:</p>\n\n<pre><code>ghci&gt; :t (== ' ')\n(== ' ') :: Char -&gt; Bool\n</code></pre>\n\n<p>Now, if you want to use several characters as possible break symbols, you need to use another <code>Char -&gt; Bool</code>. If the characters are fixed (and you don't have many of them), you can use a list <code>[Char]</code> and <code>elem</code>:</p>\n\n<pre><code>yourCharacters = [' ','\\t','\\n'] \n\npredicate :: Char -&gt; Bool\npredicate c = c `elem` yourCharacters\n</code></pre>\n\n<p>We can use this as predicate for <code>break</code>:</p>\n\n<pre><code>myBreak = break (`elem` yourCharacters)\n</code></pre>\n\n<p>At this point, you could also change <code>myBreak</code> so that it takes a list of characters, at which point you'll get:</p>\n\n<pre><code>myBreak' :: [Char] -&gt; [Char] -&gt; ([Char], [Char])\nmyBreak' limiters = break (`elem` limiters)\n-- myBreak' limiters str = break (`elem` limiters) str\n</code></pre>\n\n<p>HTH</p>\n"}], "owner": {"reputation": 3566, "user_id": 4325010, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/048bff2cd5cae6d0a93ecd485f6690ad?s=128&d=identicon&r=PG&f=1", "display_name": "users at 4325010", "link": "https://stackoverflow.com/users/4325010/users-at-4325010"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 652, "favorite_count": 0, "accepted_answer_id": 30550389, "answer_count": 2, "score": 4, "last_activity_date": 1433018203, "creation_date": 1433012611, "question_id": 30550186, "link": "https://stackoverflow.com/questions/30550186/multiple-parameters-of-a-function", "title": "Multiple parameters of a function", "body": "<p>How to give</p>\n\n<pre><code>break (== ' ') xxs\n</code></pre>\n\n<p>multiple boolean parameters without changing the definition? Or that is inevitable. For instance</p>\n\n<pre><code>break (== (' ' || '\\t' || '\\n')) xss\n</code></pre>\n\n<p><code>foldl</code> and <code>foldr</code> are one way, but here they are not applicable, or at least I haven't been able to use them.</p>\n"}, {"tags": ["haskell", "deserialization"], "comments": [{"owner": {"reputation": 167, "user_id": 3047722, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/3f12b90720fc935a0bf3f8c6ba6bb6f0?s=128&d=identicon&r=PG&f=1", "display_name": "Robert Bermani", "link": "https://stackoverflow.com/users/3047722/robert-bermani"}, "edited": false, "score": 0, "creation_date": 1433011475, "post_id": 30549890, "comment_id": 49172050, "body": "I would consider myself a Haskell novice, so maybe I&#39;m overlooking something obvious."}, {"owner": {"reputation": 28873, "user_id": 1068232, "user_type": "registered", "accept_rate": 79, "profile_image": "https://www.gravatar.com/avatar/2a0a145ce58c20013969fe3f203531da?s=128&d=identicon&r=PG", "display_name": "Andr&#225;s Kov&#225;cs", "link": "https://stackoverflow.com/users/1068232/andr%c3%a1s-kov%c3%a1cs"}, "edited": false, "score": 0, "creation_date": 1433015064, "post_id": 30549890, "comment_id": 49173217, "body": "I don&#39;t quite the get the bit with <code>Traversable</code>. <code>NetworkMsg</code> can&#39;t be that, or <code>Applicative</code>, because its kind doesn&#39;t match."}, {"owner": {"reputation": 28873, "user_id": 1068232, "user_type": "registered", "accept_rate": 79, "profile_image": "https://www.gravatar.com/avatar/2a0a145ce58c20013969fe3f203531da?s=128&d=identicon&r=PG", "display_name": "Andr&#225;s Kov&#225;cs", "link": "https://stackoverflow.com/users/1068232/andr%c3%a1s-kov%c3%a1cs"}, "edited": false, "score": 0, "creation_date": 1433015491, "post_id": 30549890, "comment_id": 49173368, "body": "It&#39;s also not clear to me what you&#39;re asking for here. Do I get it right that you want to parse <code>[String]</code> into tuples (or newtypes of tuples), where each <code>String</code> in the list encodes a tuple field?"}, {"owner": {"reputation": 167, "user_id": 3047722, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/3f12b90720fc935a0bf3f8c6ba6bb6f0?s=128&d=identicon&r=PG&f=1", "display_name": "Robert Bermani", "link": "https://stackoverflow.com/users/3047722/robert-bermani"}, "reply_to_user": {"reputation": 28873, "user_id": 1068232, "user_type": "registered", "accept_rate": 79, "profile_image": "https://www.gravatar.com/avatar/2a0a145ce58c20013969fe3f203531da?s=128&d=identicon&r=PG", "display_name": "Andr&#225;s Kov&#225;cs", "link": "https://stackoverflow.com/users/1068232/andr%c3%a1s-kov%c3%a1cs"}, "edited": false, "score": 0, "creation_date": 1433023959, "post_id": 30549890, "comment_id": 49175755, "body": "@Andr&#225;sKov&#225;cs, thanks I revised the question to try to make it more clear. I was proposing the idea of writing an instance of Applicative on each data type because I thought it would allow me to perform a sequence of reads and combine the results into the type, but I was just brainstorming."}], "answers": [{"comments": [{"owner": {"reputation": 167, "user_id": 3047722, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/3f12b90720fc935a0bf3f8c6ba6bb6f0?s=128&d=identicon&r=PG&f=1", "display_name": "Robert Bermani", "link": "https://stackoverflow.com/users/3047722/robert-bermani"}, "edited": false, "score": 0, "creation_date": 1433086570, "post_id": 30555325, "comment_id": 49189921, "body": "Shang, this is precisely what I was looking for! Thank you. I do have a master message type that represents the algebraic sum type of all of the message type constructors. I wanted to do it this way partly due to curiosity, and partly because I was hoping for something idiomatic and with less library dependencies."}], "tags": [], "owner": {"reputation": 23816, "user_id": 572606, "user_type": "registered", "accept_rate": 81, "profile_image": "https://www.gravatar.com/avatar/c20a126ad0dce40e8fc4a43456107919?s=128&d=identicon&r=PG", "display_name": "shang", "link": "https://stackoverflow.com/users/572606/shang"}, "is_accepted": true, "score": 1, "last_activity_date": 1433062243, "last_edit_date": 1433062243, "creation_date": 1433060538, "answer_id": 30555325, "question_id": 30549890, "link": "https://stackoverflow.com/questions/30549890/deserializing-many-network-messages-without-using-an-ad-hoc-parser-implementatio/30555325#30555325", "title": "Deserializing many network messages without using an ad-hoc parser implementation", "body": "<p>You are correct in that the constructors are essentially just functions so you can write generic instances for any number of types by just writing instances for the functions. You'll still need to write a separate instance \nfor all the different numbers of arguments, though.</p>\n\n<pre><code>{-# LANGUAGE FlexibleInstances #-}\n{-# LANGUAGE MultiParamTypeClasses #-}\n\nimport Text.Read\nimport Control.Applicative\n\nclass FieldParser p r where\n    parseFields :: p -&gt; [String] -&gt; Maybe r\n\ninstance Read a =&gt; FieldParser (a -&gt; r) r where\n    parseFields con [a] = con &lt;$&gt; readMaybe a\n    parseFields _ _ = Nothing\n\ninstance (Read a, Read b) =&gt; FieldParser (a -&gt; b -&gt; r) r where\n    parseFields con [a, b] = con &lt;$&gt; readMaybe a &lt;*&gt; readMaybe b\n    parseFields _ _ = Nothing\n\ninstance (Read a, Read b, Read c) =&gt; FieldParser (a -&gt; b -&gt; c -&gt; r) r where\n    parseFields con [a, b, c] = con &lt;$&gt; readMaybe a &lt;*&gt; readMaybe b &lt;*&gt; readMaybe c\n    parseFields _ _ = Nothing\n\n{- etc. for as many arguments as you need -}\n</code></pre>\n\n<p>Now you can use this type class to parse any message based on the constructor as long as the type-checker is able to figure out the resulting message type from context (i.e. it is not able to deduce it simply from the given constructor for these sort of multi-param type class instances).</p>\n\n<pre><code>data Test1 = Test1 {fieldA :: Int} deriving Show\ndata Test2 = Test2 {fieldB ::Int, fieldC :: Float} deriving Show\n\ntest :: String -&gt; [String] -&gt; IO ()\ntest tag fields = case tag of\n    \"Test1\" -&gt; case parseFields Test1 fields of\n        Just (a :: Test1) -&gt; putStrLn $ \"Succesfully parsed \" ++ show a\n        Nothing -&gt; putStrLn \"Parse error\"\n    \"Test2\" -&gt; case parseFields Test2 fields of\n        Just (a :: Test2) -&gt; putStrLn $ \"Succesfully parsed \" ++ show a\n        Nothing -&gt; putStrLn \"Parse error\"\n</code></pre>\n\n<p>I'd like to know how exactly you use the message types in the application, though, because having each message as its separate type makes it very difficult to have any sort of generic message handler. </p>\n\n<p>Is there some reason why you don't simply have a single message data type? Such as</p>\n\n<pre><code>data NetworkMsg\n    = NetworkMsg1 {fieldA :: Int}\n    | NetworkMsg2 {fieldB :: Int, fieldC :: Float}\n</code></pre>\n\n<p>Now, while the instances are built in pretty much the same way, you get much better type inference since the result type is always known.</p>\n\n<pre><code>instance Read a =&gt; MessageParser (a -&gt; NetworkMsg) where\n    parseMsg con [a] = con &lt;$&gt; readMaybe a\n\ninstance (Read a, Read b) =&gt; MessageParser (a -&gt; b -&gt; NetworkMsg) where\n    parseMsg con [a, b] = con &lt;$&gt; readMaybe a &lt;*&gt; readMaybe b\n\ninstance (Read a, Read b, Read c) =&gt; MessageParser (a -&gt; b -&gt; c -&gt; NetworkMsg) where\n    parseMsg con [a, b, c] = con &lt;$&gt; readMaybe a &lt;*&gt; readMaybe b &lt;*&gt; readMaybe c\n\nparseMessage :: String -&gt; [String] -&gt; Maybe NetworkMsg\nparseMessage tag fields = case tag of\n    \"NetworkMsg1\" -&gt; parseMsg NetworkMsg1 fields\n    \"NetworkMsg2\" -&gt; parseMsg NetworkMsg2 fields\n    _ -&gt; Nothing\n</code></pre>\n\n<p>I'm also not sure why you want to do type-generic programming specifically without actually using any of the tools meant for generics. GHC.Generics, SYB or Template Haskell is usually the best solution for this kind of problem.</p>\n"}], "owner": {"reputation": 167, "user_id": 3047722, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/3f12b90720fc935a0bf3f8c6ba6bb6f0?s=128&d=identicon&r=PG&f=1", "display_name": "Robert Bermani", "link": "https://stackoverflow.com/users/3047722/robert-bermani"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 79, "favorite_count": 0, "accepted_answer_id": 30555325, "answer_count": 1, "score": 3, "last_activity_date": 1433062243, "creation_date": 1433010918, "last_edit_date": 1433023545, "question_id": 30549890, "link": "https://stackoverflow.com/questions/30549890/deserializing-many-network-messages-without-using-an-ad-hoc-parser-implementatio", "title": "Deserializing many network messages without using an ad-hoc parser implementation", "body": "<p>I have a question pertaining to deserialization. I can envision a solution using Data.Data, Data.Typeable, or with GHC.Generics, but I'm curious if it can be accomplished without generics, SYB, or meta-programming.</p>\n\n<p><strong>Problem Description:</strong></p>\n\n<p>Given a list of [String] that is known to contain the fields of a locally defined algebraic data type, I would like to deserialize the [String] to construct the target data type. I could write a parser to do this, but I'm looking for a generalized solution that will deserialize to an arbitrary number of data types defined within the program without writing a parser for each type. With knowledge of the number and type of value constructors an algebraic type has, it's as simple as performing a <strong>read</strong> on each string to yield the appropriate values necessary to build up the type. However, I don't want to use generics, reflection, SYB, or meta-programming (unless it's otherwise impossible).</p>\n\n<p>Say I have around 50 types defined similar to this (all simple algebraic types composed of basic primitives (no nested or recursive types, just different combinations and orderings of primitives) :</p>\n\n<pre><code>data NetworkMsg = NetworkMsg { field1 :: Int, field2 :: Int, field3 :: Double}\n\ndata NetworkMsg2 = NetworkMsg2 { field1 :: Double, field2 :: Int, field3 :: Double }\n</code></pre>\n\n<p>I can determine the data-type to be associated with a [String] I've received over the network using a tag id that I parse before each [String].</p>\n\n<p><strong>Possible conjectured solution path:</strong></p>\n\n<p>Since data constructors are first-class values in Haskell, and actually have a type-- Can NetworkMsg constructor be thought of as a function, such as:</p>\n\n<pre><code>NetworkMsg :: Int -&gt; Int -&gt; Double -&gt; NetworkMsg\n</code></pre>\n\n<p>Could I transform this function into a function on tuples using uncurryN then copy the [String] into a tuple of the same shape the function now takes?</p>\n\n<pre><code>NetworkMsg' :: (Int, Int, Double) -&gt; NetworkMsg\n</code></pre>\n\n<p>I don't think this would work because I'd need knowledge of the value constructors and type information, which would require Data.Typeable, reflection, or some other metaprogramming technique.</p>\n\n<p>Basically, I'm looking for automatic deserialization of many types without writing type instance declarations or analyzing the type's shape at run-time. If it's not feasible, I'll do it an alternative way.</p>\n"}, {"tags": ["haskell", "yesod"], "comments": [{"owner": {"reputation": 30377, "user_id": 369198, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/71596bb1ca3ba3aa4400c3f407baec9f?s=128&d=identicon&r=PG", "display_name": "Michael Snoyman", "link": "https://stackoverflow.com/users/369198/michael-snoyman"}, "edited": false, "score": 0, "creation_date": 1433048333, "post_id": 30549575, "comment_id": 49180119, "body": "Checking the request header in the handler should just work for your use case. Is there something you&#39;ve tried that hasn&#39;t worked?"}, {"owner": {"reputation": 1646, "user_id": 950253, "user_type": "registered", "accept_rate": 36, "profile_image": "https://www.gravatar.com/avatar/600ad6f186f264928ea712bdc39336aa?s=128&d=identicon&r=PG", "display_name": "wedens", "link": "https://stackoverflow.com/users/950253/wedens"}, "reply_to_user": {"reputation": 30377, "user_id": 369198, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/71596bb1ca3ba3aa4400c3f407baec9f?s=128&d=identicon&r=PG", "display_name": "Michael Snoyman", "link": "https://stackoverflow.com/users/369198/michael-snoyman"}, "edited": false, "score": 0, "creation_date": 1433083311, "post_id": 30549575, "comment_id": 49188890, "body": "@MichaelSnoyman should I parse header manually or I can use some existing functions like <code>selectRep</code>?"}, {"owner": {"reputation": 30377, "user_id": 369198, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/71596bb1ca3ba3aa4400c3f407baec9f?s=128&d=identicon&r=PG", "display_name": "Michael Snoyman", "link": "https://stackoverflow.com/users/369198/michael-snoyman"}, "edited": false, "score": 0, "creation_date": 1433137281, "post_id": 30549575, "comment_id": 49203442, "body": "The function <a href=\"http://www.stackage.org/haddock/lts-2.11/yesod-core-1.4.9.1/Yesod-Core-Json.html#v:acceptsJson\" rel=\"nofollow noreferrer\">acceptsJson</a> may be what you&#39;re looking for."}, {"owner": {"reputation": 1646, "user_id": 950253, "user_type": "registered", "accept_rate": 36, "profile_image": "https://www.gravatar.com/avatar/600ad6f186f264928ea712bdc39336aa?s=128&d=identicon&r=PG", "display_name": "wedens", "link": "https://stackoverflow.com/users/950253/wedens"}, "reply_to_user": {"reputation": 30377, "user_id": 369198, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/71596bb1ca3ba3aa4400c3f407baec9f?s=128&d=identicon&r=PG", "display_name": "Michael Snoyman", "link": "https://stackoverflow.com/users/369198/michael-snoyman"}, "edited": false, "score": 0, "creation_date": 1433141288, "post_id": 30549575, "comment_id": 49205057, "body": "@MichaelSnoyman doc says it&#39;s based on <code>Accept</code> header. not <code>Content-Type</code>"}, {"owner": {"reputation": 30377, "user_id": 369198, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/71596bb1ca3ba3aa4400c3f407baec9f?s=128&d=identicon&r=PG", "display_name": "Michael Snoyman", "link": "https://stackoverflow.com/users/369198/michael-snoyman"}, "edited": false, "score": 0, "creation_date": 1433170076, "post_id": 30549575, "comment_id": 49223139, "body": "Sorry, my mistake, you&#39;re correct. That&#39;s not relevant. Looks like you&#39;ll just need to inspect <code>content-type</code> directly."}], "owner": {"reputation": 1646, "user_id": 950253, "user_type": "registered", "accept_rate": 36, "profile_image": "https://www.gravatar.com/avatar/600ad6f186f264928ea712bdc39336aa?s=128&d=identicon&r=PG", "display_name": "wedens", "link": "https://stackoverflow.com/users/950253/wedens"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 110, "favorite_count": 0, "answer_count": 0, "score": 1, "last_activity_date": 1433009194, "creation_date": 1433009194, "question_id": 30549575, "link": "https://stackoverflow.com/questions/30549575/yesod-content-negotiation-in-post-request-handlers", "title": "Yesod: content negotiation in POST request handlers", "body": "<p>I want to have the same handler (route) for POST request with content type <code>application/x-www-form-urlencoded</code> and <code>application/json</code>. The first one is used for forms in hamlet templates and the second one is for json api.\nIs it possible to define handler for both cases or it's better to create new route (and handler) for api requests?</p>\n"}, {"tags": ["haskell", "counter", "infinite-loop"], "answers": [{"tags": [], "owner": {"reputation": 100185, "user_id": 3234959, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/93bb12ca0f93dfddb33880316f7e66c2?s=128&d=identicon&r=PG&f=1", "display_name": "chi", "link": "https://stackoverflow.com/users/3234959/chi"}, "is_accepted": true, "score": 9, "last_activity_date": 1433009829, "last_edit_date": 1433009829, "creation_date": 1433009613, "answer_id": 30549659, "question_id": 30549552, "link": "https://stackoverflow.com/questions/30549552/how-could-this-code-enter-an-infinite-loop-aka-how-to-implement-a-counter-in-ha/30549659#30549659", "title": "How could this code enter an infinite loop? aka how to implement a counter in Haskell?", "body": "<pre><code>let index_player = index_player + 1\n</code></pre>\n\n<p>The above is a <em>recursive</em> definition, resulting in a <code>index_player</code> variable to be computed by adding one recursively -- forever. That does not terminate. It does not refer to the previous variable of the same name declared a few lines above.</p>\n\n<p>If you want a loop, you can adapt e.g.</p>\n\n<pre><code>xs &lt;- forM [0..100] $ \\i -&gt; do\n   print i\n   return (1000 + i)\n</code></pre>\n\n<p>The above prints all the numbers from 0 to 100, and defines <code>xs</code> to be the list of all the returned numbers, i.e. <code>[1000..1100]</code>. Remember to <code>import Control.Monad</code> to use <code>forM</code>.</p>\n"}], "owner": {"reputation": 34692, "user_id": 356440, "user_type": "registered", "accept_rate": 89, "profile_image": "https://www.gravatar.com/avatar/d16fc2844c1d9f8f815f318734554266?s=128&d=identicon&r=PG", "display_name": "Stephane Rolland", "link": "https://stackoverflow.com/users/356440/stephane-rolland"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 127, "favorite_count": 0, "accepted_answer_id": 30549659, "answer_count": 1, "score": 2, "last_activity_date": 1433073378, "creation_date": 1433009059, "last_edit_date": 1433073378, "question_id": 30549552, "link": "https://stackoverflow.com/questions/30549552/how-could-this-code-enter-an-infinite-loop-aka-how-to-implement-a-counter-in-ha", "title": "How could this code enter an infinite loop? aka how to implement a counter in Haskell?", "body": "<p>I have this code inside a function with side effects <code>... -&gt; IO()</code></p>\n\n<pre><code>let index_player = (-1)\ndronePositionByPlayer &lt;- replicateM nb_players $ do\n\n    let index_player = index_player + 1\n\n    dronePositions &lt;- replicateM nb_drones $ do\n        input_line &lt;- getLine\n        let input = words input_line \n        let dx = read (input!!0) :: Int \n        let dy = read (input!!1) :: Int\n        let dronePosition = DronePosition (Position dx dy) index_player\n        hPutStrLn stderr $ \"position = \" ++ show dronePosition\n        return (dronePosition)\n    return (dronePositions)\n</code></pre>\n\n<p>When I execute it, while parsing the input data (which is several lines containing each an x and y position) I have this trace on the stardard error output:</p>\n\n<pre><code>position = DronePosition (Position 703 892) Answer: &lt;&lt;loop&gt;&gt; \n</code></pre>\n\n<p>Obviously it can read the first position, but then it goes in infinite-loop, probably trying to display the field <code>index_player</code>.</p>\n\n<p><code>DronePosition</code> and <code>Position</code> are simple algebraic datatypes:</p>\n\n<pre><code>data Position = Position Int Int deriving Show\ndata DronePosition = DronePosition Position Drone deriving Show\n</code></pre>\n\n<p>What is ill-formed in my code ?</p>\n"}, {"tags": ["haskell", "reactive-programming", "frp", "reactive-banana"], "answers": [{"comments": [{"owner": {"reputation": 11009, "user_id": 403805, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/bcf3c21ce05cfb6788e25dcc3821b3c7?s=128&d=identicon&r=PG", "display_name": "Heinrich Apfelmus", "link": "https://stackoverflow.com/users/403805/heinrich-apfelmus"}, "reply_to_user": {"reputation": 939, "user_id": 743528, "user_type": "registered", "accept_rate": 73, "profile_image": "https://www.gravatar.com/avatar/527d3750f03157ce31f599d7e883c906?s=128&d=identicon&r=PG", "display_name": "miguel.negrao", "link": "https://stackoverflow.com/users/743528/miguel-negrao"}, "edited": false, "score": 0, "creation_date": 1433172123, "post_id": 30555311, "comment_id": 49224638, "body": "You also need to add a type signature to <code>networkDesc</code>, because otherwise, GHC will infer a monomorphic type signature for the local <code>let</code> binding, which is not what you want. Again, <code>networkDesc</code> needs to work for all starting times <code>t</code>."}, {"owner": {"reputation": 939, "user_id": 743528, "user_type": "registered", "accept_rate": 73, "profile_image": "https://www.gravatar.com/avatar/527d3750f03157ce31f599d7e883c906?s=128&d=identicon&r=PG", "display_name": "miguel.negrao", "link": "https://stackoverflow.com/users/743528/miguel-negrao"}, "edited": false, "score": 0, "creation_date": 1433176573, "post_id": 30555311, "comment_id": 49227431, "body": "Great, that did it ! I have to say, for someone unfamiliar with Rank2Types and phantom types it&#39;s pretty much impossible to understand how to properly use the phantom parameter t. For those not using dynamic event switching it would be useful to have a simpler version of the library, although that off-course would be more work and more maintenance. thanks for the help !"}, {"owner": {"reputation": 11009, "user_id": 403805, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/bcf3c21ce05cfb6788e25dcc3821b3c7?s=128&d=identicon&r=PG", "display_name": "Heinrich Apfelmus", "link": "https://stackoverflow.com/users/403805/heinrich-apfelmus"}, "reply_to_user": {"reputation": 939, "user_id": 743528, "user_type": "registered", "accept_rate": 73, "profile_image": "https://www.gravatar.com/avatar/527d3750f03157ce31f599d7e883c906?s=128&d=identicon&r=PG", "display_name": "miguel.negrao", "link": "https://stackoverflow.com/users/743528/miguel-negrao"}, "edited": false, "score": 0, "creation_date": 1433429114, "post_id": 30555311, "comment_id": 49357698, "body": "Fair enough. I intend to move away from the type parameter <code>t</code> because of such issues. See <a href=\"https://github.com/HeinrichApfelmus/reactive-banana/issues/97\" rel=\"nofollow noreferrer\">issue #97</a>."}], "tags": [], "owner": {"reputation": 11009, "user_id": 403805, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/bcf3c21ce05cfb6788e25dcc3821b3c7?s=128&d=identicon&r=PG", "display_name": "Heinrich Apfelmus", "link": "https://stackoverflow.com/users/403805/heinrich-apfelmus"}, "is_accepted": true, "score": 1, "last_activity_date": 1433060473, "creation_date": 1433060473, "answer_id": 30555311, "question_id": 30549293, "link": "https://stackoverflow.com/questions/30549293/how-to-solve-type-issues-with-moment-t-in-reactive-banana/30555311#30555311", "title": "how to solve type issues with Moment t in reactive-banana?", "body": "<p>You need to given an explicit type signature for your <code>startRBMidi</code> function, because it has a rank-2 type:</p>\n\n<pre><code>startRBMidi :: (forall t. Event t MIDIMessage -&gt; Moment t ()) -&gt; IO ()\n</code></pre>\n\n<p>This is similar to the type of the <code>compile</code> function.</p>\n\n<p>Essentially, this says that the argument function <code>f</code> needs to work for any starting time <code>t</code>.</p>\n"}], "owner": {"reputation": 939, "user_id": 743528, "user_type": "registered", "accept_rate": 73, "profile_image": "https://www.gravatar.com/avatar/527d3750f03157ce31f599d7e883c906?s=128&d=identicon&r=PG", "display_name": "miguel.negrao", "link": "https://stackoverflow.com/users/743528/miguel-negrao"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 94, "favorite_count": 0, "accepted_answer_id": 30555311, "answer_count": 1, "score": 2, "last_activity_date": 1433176702, "creation_date": 1433007377, "last_edit_date": 1433176702, "question_id": 30549293, "link": "https://stackoverflow.com/questions/30549293/how-to-solve-type-issues-with-moment-t-in-reactive-banana", "title": "how to solve type issues with Moment t in reactive-banana?", "body": "<p>I'm trying to write a function like so:</p>\n\n<pre><code>module Main where\n\nimport Reactive.Banana\nimport Reactive.Banana.Frameworks\n\n\nmain = putStrLn \"hello world\"\n\ntype MIDIMessage = (Int, Int, Double)\n\nstartRBMidi f = do\n    (addHandler, fire) &lt;- newAddHandler :: IO (AddHandler MIDIMessage, Handler MIDIMessage)\n    let\n        networkDesc = do\n            emidi &lt;- fromAddHandler (addHandler :: AddHandler MIDIMessage)\n            f emidi\n    network &lt;- compile networkDesc\n    actuate network\n    -- add fire to midi callbacks\n</code></pre>\n\n<p>but I can't get it to type check:</p>\n\n<pre><code>ghc --make -O2 test.hs \n[1 of 1] Compiling Main             ( test.hs, test.o )\n\ntest.hs:17:24:\n    Couldn't match type \u2018t\u2019 with \u2018t1\u2019\n      because type variable \u2018t1\u2019 would escape its scope\n    This (rigid, skolem) type variable is bound by\n      a type expected by the context: Frameworks t1 =&gt; Moment t1 ()\n      at test.hs:17:16-34\n    Expected type: Moment t1 ()\n      Actual type: Moment t ()\n    Relevant bindings include\n      networkDesc :: Moment t () (bound at test.hs:14:9)\n      f :: Event t MIDIMessage -&gt; Moment t () (bound at test.hs:11:13)\n      startRBMidi :: (Event t MIDIMessage -&gt; Moment t ()) -&gt; IO ()\n        (bound at test.hs:11:1)\n    In the first argument of \u2018compile\u2019, namely \u2018networkDesc\u2019\n    In a stmt of a 'do' block: network &lt;- compile networkDesc\n</code></pre>\n\n<p>I've tried different things with ScopedTypeVariables and forall t. but I can't get it to work. How can I type check this function ?</p>\n\n<p>[edit 1]</p>\n\n<p>Adding the type signature </p>\n\n<pre><code>{-# LANGUAGE Rank2Types #-}\nmodule Main where\nimport Reactive.Banana\nimport Reactive.Banana.Frameworks\n\nmain = putStrLn \"hello world\"\n\ntype MIDIMessage = (Int, Int, Double)\n\nstartRBMidi :: (forall t. Event t MIDIMessage -&gt; Moment t ()) -&gt; IO ()\nstartRBMidi f = do\n    (addHandler, fire) &lt;- newAddHandler :: IO (AddHandler MIDIMessage, Handler MIDIMessage)\n    let\n        networkDesc = do\n            emidi &lt;- fromAddHandler (addHandler :: AddHandler MIDIMessage)\n            f emidi\n    network &lt;- compile networkDesc\n    actuate network\n</code></pre>\n\n<p>I get:</p>\n\n<pre><code>test.hs:18:22:\nNo instance for (Frameworks t0)\n  arising from a use of \u2018fromAddHandler\u2019\nThe type variable \u2018t0\u2019 is ambiguous\nRelevant bindings include\n  networkDesc :: Moment t0 () (bound at test.hs:17:9)\nNote: there is a potential instance available:\n  instance Frameworks\n             (reactive-banana-0.8.0.4:Reactive.Banana.Internal.Phantom.FrameworksD,\n              t)\n    -- Defined in \u2018reactive-banana-0.8.0.4:Reactive.Banana.Internal.Phantom\u2019\nIn a stmt of a 'do' block:\n  emidi &lt;- fromAddHandler (addHandler :: AddHandler MIDIMessage)\nIn the expression:\n  do { emidi &lt;- fromAddHandler\n                  (addHandler :: AddHandler MIDIMessage);\n       f emidi }\nIn an equation for \u2018networkDesc\u2019:\n    networkDesc\n      = do { emidi &lt;- fromAddHandler\n                        (addHandler :: AddHandler MIDIMessage);\n             f emidi }\n\ntest.hs:20:24:\nCouldn't match type \u2018t0\u2019 with \u2018t\u2019\n  because type variable \u2018t\u2019 would escape its scope\nThis (rigid, skolem) type variable is bound by\n  a type expected by the context: Frameworks t =&gt; Moment t ()\n  at test.hs:20:16-34\nExpected type: Moment t ()\n  Actual type: Moment t0 ()\nRelevant bindings include\n  networkDesc :: Moment t0 () (bound at test.hs:17:9)\nIn the first argument of \u2018compile\u2019, namely \u2018networkDesc\u2019\nIn a stmt of a 'do' block: network &lt;- compile networkDesc\n</code></pre>\n\n<p>It's not easy to understand what is going on here... this is quite different from \"normal\" Haskell...</p>\n\n<p>Final solution</p>\n\n<pre><code>{-# LANGUAGE Rank2Types #-}\nmodule Main where\n\nimport Reactive.Banana\nimport Reactive.Banana.Frameworks\n\nmain = putStrLn \"hello world\"\n\ntype MIDIMessage = (Int, Int, Double)\n\nstartRBMidi :: (forall t. Event t MIDIMessage -&gt; Moment t ()) -&gt; IO ()\nstartRBMidi f = do\n    (addHandler, fire) &lt;- newAddHandler :: IO (AddHandler MIDIMessage, Handler MIDIMessage)\n    let\n        networkDesc :: forall t. Frameworks t =&gt; Moment t ()\n        networkDesc = do\n            emidi &lt;- fromAddHandler (addHandler :: AddHandler MIDIMessage)\n            f emidi\n    network &lt;- compile networkDesc\n    actuate network\n</code></pre>\n"}, {"tags": ["haskell", "yesod"], "comments": [{"owner": {"reputation": 716, "user_id": 4118267, "user_type": "registered", "accept_rate": 73, "profile_image": "https://i.stack.imgur.com/xIgkR.jpg?s=128&g=1", "display_name": "oriaj", "link": "https://stackoverflow.com/users/4118267/oriaj"}, "edited": false, "score": 0, "creation_date": 1433007541, "post_id": 30549275, "comment_id": 49170775, "body": "maybe someone have a full example to a Crud operation in a SubSite, can help me so much"}, {"owner": {"reputation": 30377, "user_id": 369198, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/71596bb1ca3ba3aa4400c3f407baec9f?s=128&d=identicon&r=PG", "display_name": "Michael Snoyman", "link": "https://stackoverflow.com/users/369198/michael-snoyman"}, "edited": false, "score": 0, "creation_date": 1433048404, "post_id": 30549275, "comment_id": 49180132, "body": "It&#39;s hard to tell from the information provided, but my guess is that you have the wrong type signature on <code>getDemoEditR</code> or <code>postDemoEditR</code>."}, {"owner": {"reputation": 716, "user_id": 4118267, "user_type": "registered", "accept_rate": 73, "profile_image": "https://i.stack.imgur.com/xIgkR.jpg?s=128&g=1", "display_name": "oriaj", "link": "https://stackoverflow.com/users/4118267/oriaj"}, "reply_to_user": {"reputation": 30377, "user_id": 369198, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/71596bb1ca3ba3aa4400c3f407baec9f?s=128&d=identicon&r=PG", "display_name": "Michael Snoyman", "link": "https://stackoverflow.com/users/369198/michael-snoyman"}, "edited": false, "score": 0, "creation_date": 1433272324, "post_id": 30549275, "comment_id": 49277347, "body": "thank you, you are right I have a mistake in postDemoEditR,"}], "answers": [{"tags": [], "owner": {"reputation": 716, "user_id": 4118267, "user_type": "registered", "accept_rate": 73, "profile_image": "https://i.stack.imgur.com/xIgkR.jpg?s=128&g=1", "display_name": "oriaj", "link": "https://stackoverflow.com/users/4118267/oriaj"}, "is_accepted": false, "score": 1, "last_activity_date": 1433272589, "creation_date": 1433272589, "answer_id": 30604712, "question_id": 30549275, "link": "https://stackoverflow.com/questions/30549275/create-edit-operation-in-a-yesod-subsite/30604712#30604712", "title": "create edit operation in a Yesod SubSite", "body": "<p>Michael Snoyman are right, I had an error in postDemoEditR, so the following code is the correction</p>\n\n<pre><code>getDemoEditR :: YesodPersist master\n         =&gt; YesodPersistBackend master ~ SqlBackend \n         =&gt; (Yesod master,RenderMessage master FormMessage) \n         =&gt; DemoId -&gt; HandlerT DemoCrud (HandlerT master IO) Html \ngetDemoEditR  demoId =  do\n           demo &lt;- lift $ runDB $ get404 demoId  \n           (widget, encoding) &lt;- lift $ generateFormPost $ renderBootstrap3 BootstrapBasicForm $ demoForm  (Just demo)\n           lift $ defaultLayout $ do     \n               [whamlet|\n                    &lt;form method=post&gt;\n                          ^{widget}\n                          &lt;div&gt;\n                                &lt;input type=submit&gt;\n                        |]  \n\n postDemoEditR :: YesodPersist master\n          =&gt; YesodPersistBackend master ~ SqlBackend \n          =&gt; (Yesod master,RenderMessage master FormMessage) \n          =&gt; DemoId -&gt; HandlerT DemoCrud (HandlerT master IO) Html\npostDemoEditR demoId  = do\n            demo &lt;- lift $  runDB $ get404 demoId\n            ((result,widget), encoding) &lt;- lift $ runFormPost $ renderBootstrap3 BootstrapBasicForm $ demoForm  (Just demo)\n            case result of\n                 FormSuccess demoResult -&gt; do \n                             _ &lt;- lift $ runDB $ replace demoId  demoResult\n                             redirect DemoNewR \n                 _ -&gt; lift $  defaultLayout $ do     \n                        [whamlet|\n                              &lt;form method=post&gt;\n                                    ^{widget}\n                                    &lt;div&gt;\n                                          &lt;input type=submit&gt;\n                        |]  \n</code></pre>\n"}], "owner": {"reputation": 716, "user_id": 4118267, "user_type": "registered", "accept_rate": 73, "profile_image": "https://i.stack.imgur.com/xIgkR.jpg?s=128&g=1", "display_name": "oriaj", "link": "https://stackoverflow.com/users/4118267/oriaj"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 93, "favorite_count": 0, "answer_count": 1, "score": 1, "last_activity_date": 1433272589, "creation_date": 1433007249, "question_id": 30549275, "link": "https://stackoverflow.com/questions/30549275/create-edit-operation-in-a-yesod-subsite", "title": "create edit operation in a Yesod SubSite", "body": "<p>I'm having many problems to create the CRUD operation in a SubSite in Yesod, I have the following routes</p>\n\n<pre><code>mkYesodSubData \"DemoCrud\" [parseRoutes|\n/demoNew DemoNewR GET POST\n/demoEdit/#DemoId DemoEditR GET POST\n|]\n</code></pre>\n\n<p>and the following subDispach instance</p>\n\n<pre><code>instance (Yesod master,RenderMessage master FormMessage, YesodPersist master, YesodPersistBackend master ~ SqlBackend) \n  =&gt; YesodSubDispatch DemoCrud (HandlerT master IO) \n  where\n yesodSubDispatch = $(mkYesodSubDispatch resourcesDemoCrud)\n</code></pre>\n\n<p>but have this error</p>\n\n<pre><code>Couldn't match expected type \u2018DemoId\n                              -&gt; HandlerT DemoCrud (HandlerT parent1 IO) a0\u2019\n            with actual type \u2018HandlerT DemoCrud (HandlerT master0 IO) Html\u2019\n</code></pre>\n\n<p>I was search but in the page example don't use Id in the routes</p>\n"}, {"tags": ["list", "function", "haskell", "list-comprehension", "elements"], "answers": [{"tags": [], "owner": {"reputation": 43759, "user_id": 1651941, "user_type": "registered", "accept_rate": 97, "profile_image": "https://www.gravatar.com/avatar/a513bc1fa519d2fcf5e4e0d9b5500101?s=128&d=identicon&r=PG", "display_name": "Sibi", "link": "https://stackoverflow.com/users/1651941/sibi"}, "is_accepted": true, "score": 3, "last_activity_date": 1433005962, "creation_date": 1433005962, "answer_id": 30549038, "question_id": 30548969, "link": "https://stackoverflow.com/questions/30548969/list-of-lists-take-next-element/30549038#30549038", "title": "List of lists, take next element", "body": "<p>You can do it like this:</p>\n\n<pre><code>getNext :: [[a]] -&gt; [a]\ngetNext xs = [ head $ drop y x | (x,y) &lt;- zip xs [0..]]\n</code></pre>\n\n<p>Although note that this function is partial because of <code>head</code>.</p>\n"}, {"tags": [], "owner": {"reputation": 204954, "user_id": 1903116, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/w6Ffg.jpg?s=128&g=1", "display_name": "thefourtheye", "link": "https://stackoverflow.com/users/1903116/thefourtheye"}, "is_accepted": false, "score": 2, "last_activity_date": 1433005995, "creation_date": 1433005995, "answer_id": 30549050, "question_id": 30548969, "link": "https://stackoverflow.com/questions/30548969/list-of-lists-take-next-element/30549050#30549050", "title": "List of lists, take next element", "body": "<p>You can <code>zip</code> the actual list of list of integers and another list which runs from <code>0</code> to infinity and get the corresponding elements, like this</p>\n\n<pre><code>picker :: [[Integer]] -&gt; [Integer]\npicker xs = [(x !! y) | (x, y) &lt;- (zip xs [0..])]\n\nmain = print $ picker [[1, 2, 3], [4, 5, 6], [7, 8, 9]]\n-- [1,5,9]\n</code></pre>\n\n<p>The expression <code>[0..]</code> will create an infinite list, lazily, starting from <code>0</code> and we <code>zip</code> it with <code>xs</code>. So, on every iteration, the result of <code>zip</code> would be used like this</p>\n\n<pre><code>[1, 2, 3] !! 0\n[4, 5, 6] !! 1\n[7, 8, 9] !! 2\n</code></pre>\n\n<p>We get element at index <code>0</code>, which is <code>1</code>, on the first iteration and <code>5</code> and <code>9</code> on the following iterations.</p>\n"}, {"tags": [], "owner": {"reputation": 314794, "user_id": 67579, "user_type": "registered", "accept_rate": 81, "profile_image": "https://i.stack.imgur.com/BJXub.png?s=128&g=1", "display_name": "Willem Van Onsem", "link": "https://stackoverflow.com/users/67579/willem-van-onsem"}, "is_accepted": false, "score": 3, "last_activity_date": 1433021904, "last_edit_date": 1433021904, "creation_date": 1433008226, "answer_id": 30549421, "question_id": 30548969, "link": "https://stackoverflow.com/questions/30548969/list-of-lists-take-next-element/30549421#30549421", "title": "List of lists, take next element", "body": "<p>As the other answers suggest, you can use a <code>zip</code> function and <code>zip</code> with the list of indices.</p>\n\n<p>The <em>Glasgow Haskell Compiler (GHC)</em> however offers the <a href=\"https://ghc.haskell.org/trac/haskell-prime/wiki/ParallelListComp\" rel=\"nofollow\"><em>Parallel List Comp</em></a> extension:</p>\n\n<pre><code>{-# LANGUAGE ParallelListComp #-}\n\ndiagonal :: [[a]] -&gt; [a]\ndiagonal ls = [l !! i | l &lt;- ls | i &lt;- [0..]]\n</code></pre>\n\n<p>The <a href=\"http://hackage.haskell.org/packages/archive/base/latest/doc/html/Prelude.html#v:-33--33-\" rel=\"nofollow\"><code>(!!)</code></a> operator gets the <em>i</em>-th element from a list.</p>\n\n<p>Furthermore it is always advisable to <em>use the most generic function signature</em>; so <code>[[a]] -&gt; [a]</code> instead of <code>[[Integer]] -&gt; [Integer]</code>. This can be useful if you later decide to take the diagonal of a matrix of <code>Double</code>'s, <code>String</code>, lists, custom types,...</p>\n"}], "owner": {"reputation": 3566, "user_id": 4325010, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/048bff2cd5cae6d0a93ecd485f6690ad?s=128&d=identicon&r=PG&f=1", "display_name": "users at 4325010", "link": "https://stackoverflow.com/users/4325010/users-at-4325010"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 140, "favorite_count": 0, "accepted_answer_id": 30549038, "answer_count": 3, "score": 2, "last_activity_date": 1433021904, "creation_date": 1433005610, "last_edit_date": 1433014193, "question_id": 30548969, "link": "https://stackoverflow.com/questions/30548969/list-of-lists-take-next-element", "title": "List of lists, take next element", "body": "<p>I have <code>[[Integer]] -&gt; [Integer]</code> and want to take the first element of the first sub-list, the second element of the second sub-list and .. the <em>n</em>-th element of the <em>n</em>-th sub-list and so on.</p>\n\n<p>I am trying to achieve this using list comprehensions. However, I first drop an incrementing number of elements and the take the head of the remaining. But there again I don't know how to use <code>drop (inc z) where z = 0</code> with <code>inc c = c + 1</code> as an already defined function, in presumably this:</p>\n\n<pre><code>getNext :: [[Integer]] -&gt; [Integer]\ngetNext xs = [y | drop (inc z) (y:ys) &lt;- xs, (y:_) &lt;- xs]\n           where z = 0\n</code></pre>\n\n<p>I know that the code above is not working, but again I had only so far come up to this and hit a wall.</p>\n"}, {"tags": ["c", "haskell", "ffi"], "answers": [{"tags": [], "owner": {"reputation": 51584, "user_id": 839246, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/9b0573c2b936b12828dd1e4cc04206dc?s=128&d=identicon&r=PG&f=1", "display_name": "bheklilr", "link": "https://stackoverflow.com/users/839246/bheklilr"}, "is_accepted": true, "score": 3, "last_activity_date": 1433011869, "creation_date": 1433011869, "answer_id": 30550050, "question_id": 30548229, "link": "https://stackoverflow.com/questions/30548229/how-do-i-create-a-storable-instance-for-this-structure-without-c2hs-or-other-too/30550050#30550050", "title": "How do I create a storable instance for this structure without c2hs or other tools?", "body": "<p>I can't currently guarantee that this will work exactly as shown (I don't have the environment set up on this computer), but it should be a good first step towards getting it right:</p>\n\n<pre class=\"lang-hs prettyprint-override\"><code>import Foreign.Storable\nimport Foreign.Ptr\n\ninstance Storable Atom where\n    -- Don't make this static, let the compiler choose depending\n    -- on the platform\n    sizeOf _ = 3 * sizeOf (0 :: Float) + sizeOf (0 :: Int)\n    -- You may need to fiddle with this, and with your corresponding C\n    -- code if you have the ability to, alignment can be tricky, but\n    -- in this case you can pretty safely assume it'll be the alignment\n    -- for `Float`\n    alignment _ = alignment (0 :: Float)\n    -- These are pretty straightforward, and obviously order matters here\n    -- a great deal.  I clearly haven't made this the most optimized it\n    -- could be, I'm going for clarity of code instead\n    peek ptr = do\n        let floatSize = sizeOf (0 :: Float)\n        x   &lt;- peek $ ptr `plusPtr` (0 * floatSize)\n        y   &lt;- peek $ ptr `plusPtr` (1 * floatSize)\n        z   &lt;- peek $ ptr `plusPtr` (2 * floatSize)\n        col &lt;- peek $ ptr `plusPtr` (3 * floatSize)\n        return $ Atom (V3 x y z) col\n    poke ptr (Atom (V3 x y z) col) = do\n        let floatSize = sizeOf (0 :: Float)\n        poke (ptr `plusPtr` (0 * floatSize)) x\n        poke (ptr `plusPtr` (1 * floatSize)) y\n        poke (ptr `plusPtr` (2 * floatSize)) z\n        poke (ptr `plusPtr` (3 * floatSize)) col\n</code></pre>\n\n<p>And this should just work!  It could be highly dependent on your C compiler and your platform, though, you'll want to do some extensive testing to make sure it's been laid out correctly.</p>\n"}], "owner": {"reputation": 44680, "user_id": 1031791, "user_type": "registered", "accept_rate": 54, "profile_image": "https://www.gravatar.com/avatar/fb710534fda446d2286074bb7692e65a?s=128&d=identicon&r=PG", "display_name": "MaiaVictor", "link": "https://stackoverflow.com/users/1031791/maiavictor"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 108, "favorite_count": 0, "accepted_answer_id": 30550050, "answer_count": 1, "score": 4, "last_activity_date": 1433011869, "creation_date": 1433001516, "question_id": 30548229, "link": "https://stackoverflow.com/questions/30548229/how-do-i-create-a-storable-instance-for-this-structure-without-c2hs-or-other-too", "title": "How do I create a storable instance for this structure without c2hs or other tools?", "body": "<p>This structure:</p>\n\n<pre><code>typedef struct Atom_ {\n    float x;\n    float y;\n    float z;\n    int col;\n} Atom;\n</code></pre>\n\n<p>corresponds to this type:</p>\n\n<pre><code>data Atom = Atom { pos :: V3 Float, col :: Int }\n</code></pre>\n\n<p>How do I create a storable instance for <code>Atom</code> so that I can send an <code>Atom</code>s on Haskell to a C function that expects an <code>Atom</code>?</p>\n"}, {"tags": ["haskell"], "comments": [{"owner": {"reputation": 100185, "user_id": 3234959, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/93bb12ca0f93dfddb33880316f7e66c2?s=128&d=identicon&r=PG&f=1", "display_name": "chi", "link": "https://stackoverflow.com/users/3234959/chi"}, "edited": false, "score": 0, "creation_date": 1433002565, "post_id": 30548209, "comment_id": 49169086, "body": "About the error itself: <code>Set</code> is not a type, <code>Set e</code> is a type. You forgot the <code>e</code> in the signature of <code>insert</code>."}, {"owner": {"reputation": 1367, "user_id": 1160885, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/dc61c1b2045efa54375188bdb6a33945?s=128&d=identicon&r=PG", "display_name": "Jedai", "link": "https://stackoverflow.com/users/1160885/jedai"}, "edited": false, "score": 0, "creation_date": 1433014672, "post_id": 30548209, "comment_id": 49173109, "body": "<code>empty</code> should be written <code>empty (Set s) = null s</code>. <code>if boolean then True else False</code> is exactly the same as just <code>boolean</code>."}], "answers": [{"comments": [{"owner": {"reputation": 103, "user_id": 2399650, "user_type": "registered", "accept_rate": 57, "profile_image": "https://i.stack.imgur.com/zwtpS.jpg?s=128&g=1", "display_name": "Samuel Barnes", "link": "https://stackoverflow.com/users/2399650/samuel-barnes"}, "edited": false, "score": 0, "creation_date": 1433004911, "post_id": 30548244, "comment_id": 49169839, "body": "I get this: Couldn&#39;t match type <code>[e0]&#39; with </code>Set e0&#39;     Expected type: [Set e0]       Actual type: [e]     In the second argument of <code>(:)&#39;, namely </code>s&#39;     In the expression: Set value : s     In an equation for `insert&#39;: insert (Set s) value = Set value : s"}, {"owner": {"reputation": 43759, "user_id": 1651941, "user_type": "registered", "accept_rate": 97, "profile_image": "https://www.gravatar.com/avatar/a513bc1fa519d2fcf5e4e0d9b5500101?s=128&d=identicon&r=PG", "display_name": "Sibi", "link": "https://stackoverflow.com/users/1651941/sibi"}, "reply_to_user": {"reputation": 103, "user_id": 2399650, "user_type": "registered", "accept_rate": 57, "profile_image": "https://i.stack.imgur.com/zwtpS.jpg?s=128&g=1", "display_name": "Samuel Barnes", "link": "https://stackoverflow.com/users/2399650/samuel-barnes"}, "edited": false, "score": 0, "creation_date": 1433005077, "post_id": 30548244, "comment_id": 49169903, "body": "@gravysam I think you are missing <code>$</code>according to the error report ? Also see this: <a href=\"http://ideone.com/3LpTPq\" rel=\"nofollow noreferrer\">ideone.com/3LpTPq</a>"}], "tags": [], "owner": {"reputation": 43759, "user_id": 1651941, "user_type": "registered", "accept_rate": 97, "profile_image": "https://www.gravatar.com/avatar/a513bc1fa519d2fcf5e4e0d9b5500101?s=128&d=identicon&r=PG", "display_name": "Sibi", "link": "https://stackoverflow.com/users/1651941/sibi"}, "is_accepted": true, "score": 3, "last_activity_date": 1433002776, "last_edit_date": 1433002776, "creation_date": 1433001620, "answer_id": 30548244, "question_id": 30548209, "link": "https://stackoverflow.com/questions/30548209/haskell-correctly-use-multiple-parameters/30548244#30548244", "title": "Haskell Correctly use Multiple Parameters", "body": "<p>You have to implement <code>insert</code> like as follows. Note that your type signature isn't correct. You cannot insert <code>Int</code> to a set of type <code>Set e</code> (you can only insert <code>Int</code> to a set of type <code>Set Int</code>).</p>\n\n<pre><code>insert :: Set e -&gt; e -&gt; Set e\ninsert (Set s) value = Set $ value : s\n</code></pre>\n\n<p>Note that the above <code>insert</code> doesn't take into account of duplicate elements(Hint: use <code>nub</code> for eliminating that).</p>\n"}], "owner": {"reputation": 103, "user_id": 2399650, "user_type": "registered", "accept_rate": 57, "profile_image": "https://i.stack.imgur.com/zwtpS.jpg?s=128&g=1", "display_name": "Samuel Barnes", "link": "https://stackoverflow.com/users/2399650/samuel-barnes"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 106, "favorite_count": 0, "accepted_answer_id": 30548244, "answer_count": 1, "score": 3, "last_activity_date": 1433002776, "creation_date": 1433001413, "question_id": 30548209, "link": "https://stackoverflow.com/questions/30548209/haskell-correctly-use-multiple-parameters", "title": "Haskell Correctly use Multiple Parameters", "body": "<p>I am trying to make my own \"Set\" datatype and when I try to declare an insert function the compiler complains about too few arguments:</p>\n\n<pre><code>quantities.hs:12:27:\nExpecting one more argument to `Set'\nIn the type signature for `insert': insert :: Set e -&gt; Int -&gt; Set\n</code></pre>\n\n<p>How can I correctly define the insert function to add a new element to my set?</p>\n\n<p>Here is what I have so far:</p>\n\n<pre><code>data Set e = Set [e]\n\nmySet :: Set Int\nmySet = Set [1, 2, 3, 4, 5]\n\nsetLength :: Set e -&gt; Int\nsetLength (Set s) = length s\n\nempty :: Set e -&gt; Bool\nempty (Set s) = if null s then True else False\n\ninsert :: Set e -&gt; Int -&gt; Set\ninsert set value = set : value\n\nmain = do print(insert mySet 1)\n</code></pre>\n"}, {"tags": ["parsing", "haskell", "ghc"], "comments": [{"owner": {"reputation": 4190, "user_id": 2110623, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/a5f1b5f95d5b3bb75901fb546cd1c52d?s=128&d=identicon&r=PG", "display_name": "aochagavia", "link": "https://stackoverflow.com/users/2110623/aochagavia"}, "edited": false, "score": 0, "creation_date": 1433000338, "post_id": 30547862, "comment_id": 49168339, "body": "You could look at the <a href=\"http://hackage.haskell.org/package/base-4.8.0.0/docs/src/Text-Read.html#read\" rel=\"nofollow noreferrer\">implementation</a> of the <code>read</code> function and tweak it..."}, {"owner": {"reputation": 51584, "user_id": 839246, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/9b0573c2b936b12828dd1e4cc04206dc?s=128&d=identicon&r=PG&f=1", "display_name": "bheklilr", "link": "https://stackoverflow.com/users/839246/bheklilr"}, "edited": false, "score": 3, "creation_date": 1433000893, "post_id": 30547862, "comment_id": 49168517, "body": "use a real parser like parsec?"}], "answers": [{"tags": [], "owner": {"reputation": 100185, "user_id": 3234959, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/93bb12ca0f93dfddb33880316f7e66c2?s=128&d=identicon&r=PG&f=1", "display_name": "chi", "link": "https://stackoverflow.com/users/3234959/chi"}, "is_accepted": true, "score": 1, "last_activity_date": 1433003265, "creation_date": 1433003265, "answer_id": 30548549, "question_id": 30547862, "link": "https://stackoverflow.com/questions/30547862/parsing-string-into-data-type-better-error-messages/30548549#30548549", "title": "Parsing string into data type : better error messages?", "body": "<p>If you only want a more graceful error handling, you can use</p>\n\n<pre><code>import Text.Read\n\nparseOuter :: Maybe Outer\nparseOuter = readMaybe \"Outer { inner = Inner { x = 4, y = 4.5 } }\"\n\nmain :: IO ()\nmain = do\n  case parseOther of\n    Just x  -&gt; print x\n    Nothing -&gt; putStrLn \"parse error\"\n</code></pre>\n\n<p>For more serious error handling, I'd use a proper parsing library like parsec. Parsec provides the <code>&lt;?&gt;</code> operator to decorate the parser with helpful error messages: e.g. <code>myParser &lt;?&gt; \"foo\"</code> will generate messages such as \"expected foo\" if a parse error occurs.</p>\n"}], "owner": {"reputation": 4738, "user_id": 917635, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/2365756407af40c28c05d4d30182dbac?s=128&d=identicon&r=PG", "display_name": "artella", "link": "https://stackoverflow.com/users/917635/artella"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 106, "favorite_count": 0, "accepted_answer_id": 30548549, "answer_count": 1, "score": 2, "last_activity_date": 1433003265, "creation_date": 1432999281, "question_id": 30547862, "link": "https://stackoverflow.com/questions/30547862/parsing-string-into-data-type-better-error-messages", "title": "Parsing string into data type : better error messages?", "body": "<p>Currently I am parsing strings into data types using \nthe <code>read</code> function from <code>Text.Read</code> as shown in the \nexample below : </p>\n\n<pre><code>module Main where\n\ndata Inner = Inner { x :: Int , y :: Double } deriving (Read,Show)\ndata Outer = Outer { inner :: Inner } deriving (Read,Show)\n\nparseOuter :: Outer\nparseOuter = read \"Outer { inner = Inner { x = 4, y = 4.5 } }\"\n\nmain = do\n  print parseOuter\n  --output : Outer {inner = Inner {x = 4, y = 4.5}}\n</code></pre>\n\n<p>However the error messages are not very good. For example if \nI accidentally make <code>x</code> a <code>Double</code> by doing <code>x = 4.3</code> then I \nget the error message shown in the program below : </p>\n\n<pre><code>module Main where\n\ndata Inner = Inner { x :: Int , y :: Double } deriving (Read,Show)\ndata Outer = Outer { inner :: Inner } deriving (Read,Show)\n\nparseOuter :: Outer\nparseOuter = read \"Outer { inner = Inner { x = 4.3 , y = 4.5 } }\"\n\nmain = do\n  print parseOuter\n  --output : *** Exception: Prelude.read: no parse\n</code></pre>\n\n<p>Is there functionality in haskell which would allow me to \ndo the above but with better error messages?</p>\n"}, {"tags": ["haskell", "haskell-snap-framework"], "owner": {"reputation": 215, "user_id": 2035316, "user_type": "registered", "accept_rate": 60, "profile_image": "https://www.gravatar.com/avatar/b84b148152679b9172a63ebb10a64f69?s=128&d=identicon&r=PG", "display_name": "Deck Pope", "link": "https://stackoverflow.com/users/2035316/deck-pope"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 57, "favorite_count": 0, "answer_count": 0, "score": 1, "last_activity_date": 1433084098, "creation_date": 1432996249, "last_edit_date": 1433084098, "question_id": 30547361, "link": "https://stackoverflow.com/questions/30547361/how-can-i-stream-to-all-clients", "title": "How can i stream to all clients?", "body": "<p>I am trying to broadcast a server event with Snap based on <a href=\"https://gist.github.com/deckool/faefa70142e4b2b915d8\" rel=\"nofollow\">this gist</a>.\nThe problem is that when another client connects the messages are splitted between them so client 1 gets event 1, client 2 gets event 2 and don't seems to get the hint why.</p>\n\n<p>I am trying to all the clients to get also event 1 and 2.</p>\n\n<p>Thanks</p>\n"}, {"tags": ["haskell", "programming-languages", "agda", "halting-problem", "computability"], "comments": [{"owner": {"reputation": 392, "user_id": 2154420, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/4eb8dcbb8a47d7d263704d73707f67e9?s=128&d=identicon&r=PG", "display_name": "user2154420", "link": "https://stackoverflow.com/users/2154420/user2154420"}, "reply_to_user": {"reputation": 100185, "user_id": 3234959, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/93bb12ca0f93dfddb33880316f7e66c2?s=128&d=identicon&r=PG&f=1", "display_name": "chi", "link": "https://stackoverflow.com/users/3234959/chi"}, "edited": false, "score": 0, "creation_date": 1432996097, "post_id": 30547230, "comment_id": 49167007, "body": "Okay good, that&#39;s where some of my confusion came from. Right now it is just underlining the <code>diverges \u22a5</code> part and saying unreachable clause. Any ideas on how to fix this? If it helps, the source I am looking at is: <a href=\"http://www.cs.bham.ac.uk/~mhe/papers/entcs87.pdf\" rel=\"nofollow noreferrer\">cs.bham.ac.uk/~mhe/papers/entcs87.pdf</a> bottom of page 22 to page 25 (sections 2.4 and 2.5)."}, {"owner": {"reputation": 42094, "user_id": 828361, "user_type": "registered", "accept_rate": 44, "profile_image": "https://www.gravatar.com/avatar/6a82397672dcc1fca31c32508ef0798b?s=128&d=identicon&r=PG", "display_name": "pigworker", "link": "https://stackoverflow.com/users/828361/pigworker"}, "edited": false, "score": 4, "creation_date": 1432998102, "post_id": 30547230, "comment_id": 49167632, "body": "Termination checking happens quite late in Agda&#39;s process of loading a file. The unreachable clause error will be noticed first. Just to clarify what&#39;s going on, the type S has one constructor, &quot;top&quot;, so the first equation for diverges covers all possible inputs. In the second equation, the argument &quot;bottom&quot; is taken to mean a fresh pattern variable, shadowing the defined &quot;bottom&quot;. But there&#39;s no situation where that equation can be invoked: if its argument gets stuck, then diverges gets stuck; if its argument gives a value, then that value is &quot;top&quot;. The error message is correct."}, {"owner": {"reputation": 392, "user_id": 2154420, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/4eb8dcbb8a47d7d263704d73707f67e9?s=128&d=identicon&r=PG", "display_name": "user2154420", "link": "https://stackoverflow.com/users/2154420/user2154420"}, "edited": false, "score": 0, "creation_date": 1432998441, "post_id": 30547230, "comment_id": 49167748, "body": "That makes sense. One last question: What exactly does \u22a5 mean (if that question makes sense)? Is it like an infinite loop? Also what do you mean by &quot;stuck&quot;? Sorry for all the questions, I just really want to get this down."}, {"owner": {"reputation": 42094, "user_id": 828361, "user_type": "registered", "accept_rate": 44, "profile_image": "https://www.gravatar.com/avatar/6a82397672dcc1fca31c32508ef0798b?s=128&d=identicon&r=PG", "display_name": "pigworker", "link": "https://stackoverflow.com/users/828361/pigworker"}, "edited": false, "score": 4, "creation_date": 1433002481, "post_id": 30547230, "comment_id": 49169057, "body": "The &quot;bottom&quot; symbol is just an ordinary identifier. It means whatever you make it mean. In the code above, you seem to be attempting to &quot;define&quot; it to compute recursively for ever: Agda will not accept such a definition. Meanwhile, an expression &quot;gets stuck&quot; if its evaluation terminates without giving a top-level constructor. Open expressions (which involve free variables) can get stuck (for want of knowing the values of the variables), but expressions with no free variables should never get stuck. Pattern matching on something stuck will itself get stuck. Stuckness snowballs."}], "answers": [{"comments": [{"owner": {"reputation": 11001, "user_id": 727667, "user_type": "registered", "accept_rate": 88, "profile_image": "https://www.gravatar.com/avatar/2e2cbd3a202d8d1cfe0cc2a9fff86733?s=128&d=identicon&r=PG", "display_name": "gallais", "link": "https://stackoverflow.com/users/727667/gallais"}, "edited": false, "score": 1, "creation_date": 1433171465, "post_id": 30559293, "comment_id": 49224149, "body": "Turing Completeness and Totality are different notions. See e.g. <a href=\"https://personal.cis.strath.ac.uk/conor.mcbride/TotallyFree.pdf\" rel=\"nofollow noreferrer\">this recent paper</a>."}, {"owner": {"reputation": 370, "user_id": 4557694, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/24e1eefea58ed065620e1b494503c0da?s=128&d=identicon&r=PG", "display_name": "Chad Groft", "link": "https://stackoverflow.com/users/4557694/chad-groft"}, "reply_to_user": {"reputation": 11001, "user_id": 727667, "user_type": "registered", "accept_rate": 88, "profile_image": "https://www.gravatar.com/avatar/2e2cbd3a202d8d1cfe0cc2a9fff86733?s=128&d=identicon&r=PG", "display_name": "gallais", "link": "https://stackoverflow.com/users/727667/gallais"}, "edited": false, "score": 0, "creation_date": 1433173391, "post_id": 30559293, "comment_id": 49225481, "body": "Interesting paper. I had understood totality to mean &quot;all legal programs halt&quot;. Clearly it doesn&#39;t mean that. Now I&#39;m at a loss as to the point of totality."}, {"owner": {"reputation": 11001, "user_id": 727667, "user_type": "registered", "accept_rate": 88, "profile_image": "https://www.gravatar.com/avatar/2e2cbd3a202d8d1cfe0cc2a9fff86733?s=128&d=identicon&r=PG", "display_name": "gallais", "link": "https://stackoverflow.com/users/727667/gallais"}, "edited": false, "score": 2, "creation_date": 1433191254, "post_id": 30559293, "comment_id": 49235510, "body": "Well, legal programs do terminate but you need to take into account co-programs (programs working with codata) which simply need to be productive."}], "tags": [], "owner": {"reputation": 370, "user_id": 4557694, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/24e1eefea58ed065620e1b494503c0da?s=128&d=identicon&r=PG", "display_name": "Chad Groft", "link": "https://stackoverflow.com/users/4557694/chad-groft"}, "is_accepted": false, "score": -2, "last_activity_date": 1433086965, "creation_date": 1433086965, "answer_id": 30559293, "question_id": 30547230, "link": "https://stackoverflow.com/questions/30547230/haltingproblem-in-agda/30559293#30559293", "title": "HaltingProblem in Agda?", "body": "<p>Your project probably isn't going to work, because Agda is not a Turing-complete language. For one thing, it only allows total functions, so it can't model any computation that might not halt. This means it can't even model full computations on Turing machines, for example, since Turing machines can fail to stop. So it's very unlikely that all the programs in the paper can be implemented in Agda.</p>\n\n<p>In fact, it's not even possible to code all total computations in Agda, by a simple diagonal argument. Imagine the following algorithm: \"Examine a text file and determine whether it's legal Agda. If it's not, output the empty string; if it is, run that Agda program on that very same text file, and add a space to the end of the output.\" This is a well-defined algorithm; most of the complexity is in \"determine whether it's legal Agda\" and \"run that Agda program\", and programs that do these certainly exist. But no Agda program can implement it, because any candidate would give different output when run on its own source code. Any total language is subject to a similar argument.</p>\n\n<p>Weird circular-with-a-twist arguments like this are at the core of understanding the Halting Problem, so the paper you're reading will probably contain many of them.</p>\n\n<p>Incidentally, the function <code>diverges</code> is <em>not</em> definable in Haskell. Computable functions in Haskell must give more defined outputs for more defined inputs, and \u22a4 is considered more defined than \u22a5 (it's an actual value, as opposed to the symbol for \"this is undefined\").</p>\n"}], "owner": {"reputation": 392, "user_id": 2154420, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/4eb8dcbb8a47d7d263704d73707f67e9?s=128&d=identicon&r=PG", "display_name": "user2154420", "link": "https://stackoverflow.com/users/2154420/user2154420"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 376, "favorite_count": 0, "answer_count": 1, "score": 2, "last_activity_date": 1433086965, "creation_date": 1432995349, "question_id": 30547230, "link": "https://stackoverflow.com/questions/30547230/haltingproblem-in-agda", "title": "HaltingProblem in Agda?", "body": "<p>I am working through a paper trying to implement their Haskell code in Agda. They want to formulate the halting problem by saying let <code>bot</code> be a program such that for any data type <code>a</code>:</p>\n\n<pre><code>bot :: a\nbot = bot\n</code></pre>\n\n<p>They go on to define </p>\n\n<pre><code>data S = T\n</code></pre>\n\n<p>so the Halting problem is said as:</p>\n\n<p>The function <code>diverges : S \u2192 S</code> defined by</p>\n\n<pre><code>diverges(T)= bot\ndiverges(bot)= T\n</code></pre>\n\n<p>is not computable and hence is not definable in our language</p>\n\n<p>I tried implementing this in Agda as:</p>\n\n<pre><code>data S : Set where\n  \u22a4 : S\n\n\u22a5 : _\n\u22a5 = \u22a5\n\ndiverges : S \u2192 S\ndiverges \u22a4 = \u22a5\ndiverges \u22a5 = \u22a4\n</code></pre>\n\n<p>and when I tried to load it, Agda said <code>diverges \u22a5 = \u22a4</code> is an unreachable clause. Is this the error I am supposed to get or did I just implement the Haskell code incorrectly?</p>\n"}, {"tags": ["haskell", "haskell-snap-framework"], "comments": [{"owner": {"reputation": 887, "user_id": 1622256, "user_type": "registered", "accept_rate": 58, "profile_image": "https://www.gravatar.com/avatar/4446ea0060a0859fdd3aeae71883dfdf?s=128&d=identicon&r=PG", "display_name": "Raghavan", "link": "https://stackoverflow.com/users/1622256/raghavan"}, "reply_to_user": {"reputation": 4190, "user_id": 2110623, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/a5f1b5f95d5b3bb75901fb546cd1c52d?s=128&d=identicon&r=PG", "display_name": "aochagavia", "link": "https://stackoverflow.com/users/2110623/aochagavia"}, "edited": false, "score": 0, "creation_date": 1432994124, "post_id": 30547004, "comment_id": 49166400, "body": "I have Edited the question . Thanks"}, {"owner": {"reputation": 48129, "user_id": 76051, "user_type": "registered", "accept_rate": 91, "profile_image": "https://i.stack.imgur.com/AGDxz.jpg?s=128&g=1", "display_name": "Carsten", "link": "https://stackoverflow.com/users/76051/carsten"}, "edited": false, "score": 0, "creation_date": 1432994326, "post_id": 30547004, "comment_id": 49166464, "body": "the example is pretty neat - what do you mean with <b>standard way</b>?"}, {"owner": {"reputation": 887, "user_id": 1622256, "user_type": "registered", "accept_rate": 58, "profile_image": "https://www.gravatar.com/avatar/4446ea0060a0859fdd3aeae71883dfdf?s=128&d=identicon&r=PG", "display_name": "Raghavan", "link": "https://stackoverflow.com/users/1622256/raghavan"}, "edited": false, "score": 0, "creation_date": 1432994451, "post_id": 30547004, "comment_id": 49166495, "body": "In Java world there is Jackson to this . Is there any library that does this in Haskell world ?"}, {"owner": {"reputation": 48129, "user_id": 76051, "user_type": "registered", "accept_rate": 91, "profile_image": "https://i.stack.imgur.com/AGDxz.jpg?s=128&g=1", "display_name": "Carsten", "link": "https://stackoverflow.com/users/76051/carsten"}, "edited": false, "score": 0, "creation_date": 1432996312, "post_id": 30547004, "comment_id": 49167062, "body": "does what? - parse JSON? The example is using it (look for AESON)"}, {"owner": {"reputation": 887, "user_id": 1622256, "user_type": "registered", "accept_rate": 58, "profile_image": "https://www.gravatar.com/avatar/4446ea0060a0859fdd3aeae71883dfdf?s=128&d=identicon&r=PG", "display_name": "Raghavan", "link": "https://stackoverflow.com/users/1622256/raghavan"}, "edited": false, "score": 0, "creation_date": 1432996490, "post_id": 30547004, "comment_id": 49167112, "body": "Got it , this is what I was looking for !! Thanks"}], "answers": [{"tags": [], "owner": {"reputation": 887, "user_id": 1622256, "user_type": "registered", "accept_rate": 58, "profile_image": "https://www.gravatar.com/avatar/4446ea0060a0859fdd3aeae71883dfdf?s=128&d=identicon&r=PG", "display_name": "Raghavan", "link": "https://stackoverflow.com/users/1622256/raghavan"}, "is_accepted": true, "score": 1, "last_activity_date": 1432996557, "creation_date": 1432996557, "answer_id": 30547398, "question_id": 30547004, "link": "https://stackoverflow.com/questions/30547004/how-to-i-get-the-haskell-data-value-from-the-request-body-in-snap-framework/30547398#30547398", "title": "How to I get the Haskell data value from the request body in Snap framework", "body": "<p>Thanks to Carsten . Found out that the Aeson library does exactly this .</p>\n\n<p><a href=\"https://hackage.haskell.org/package/aeson-0.6.1.0/docs/Data-Aeson.html\" rel=\"nofollow\">https://hackage.haskell.org/package/aeson-0.6.1.0/docs/Data-Aeson.html</a></p>\n"}], "owner": {"reputation": 887, "user_id": 1622256, "user_type": "registered", "accept_rate": 58, "profile_image": "https://www.gravatar.com/avatar/4446ea0060a0859fdd3aeae71883dfdf?s=128&d=identicon&r=PG", "display_name": "Raghavan", "link": "https://stackoverflow.com/users/1622256/raghavan"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 375, "favorite_count": 0, "accepted_answer_id": 30547398, "answer_count": 1, "score": 1, "last_activity_date": 1432996557, "creation_date": 1432993869, "last_edit_date": 1432994097, "question_id": 30547004, "link": "https://stackoverflow.com/questions/30547004/how-to-i-get-the-haskell-data-value-from-the-request-body-in-snap-framework", "title": "How to I get the Haskell data value from the request body in Snap framework", "body": "<p>I am new Snap and Haskell web development, I want to parse the request body to Haskell data value .</p>\n\n<p>I have tried the example from this <a href=\"https://github.com/raimohanska/snap-skeleton/blob/master/src/Examples/Restful.hs\" rel=\"nofollow\">https://github.com/raimohanska/snap-skeleton/blob/master/src/Examples/Restful.hs</a> . It seems to work , But wondering if there is any standard way to do this in Snap world .</p>\n"}, {"tags": ["haskell", "monads"], "comments": [{"owner": {"reputation": 48129, "user_id": 76051, "user_type": "registered", "accept_rate": 91, "profile_image": "https://i.stack.imgur.com/AGDxz.jpg?s=128&g=1", "display_name": "Carsten", "link": "https://stackoverflow.com/users/76051/carsten"}, "edited": false, "score": 0, "creation_date": 1432996766, "post_id": 30546986, "comment_id": 49167189, "body": "I think this is more a question about the design of <a href=\"https://hackage.haskell.org/package/mtl\" rel=\"nofollow noreferrer\">mtl</a> (right?) - why the naming conventions are that way seems to be a bit opinionated to me ..."}, {"owner": {"reputation": 11366, "user_id": 3922954, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/76ba47d2fdd24ab56b0b273cce2075e5?s=128&d=identicon&r=PG&f=1", "display_name": "AJF", "link": "https://stackoverflow.com/users/3922954/ajf"}, "edited": false, "score": 0, "creation_date": 1433067703, "post_id": 30546986, "comment_id": 49184305, "body": "Because they&#39;re subclasses of monads! <code>class (Monad m) =&gt; MonadXYZ m where ...</code>"}], "answers": [{"comments": [{"owner": {"reputation": 10492, "user_id": 1351298, "user_type": "registered", "accept_rate": 79, "profile_image": "https://i.stack.imgur.com/KJKqs.jpg?s=128&g=1", "display_name": "Electric Coffee", "link": "https://stackoverflow.com/users/1351298/electric-coffee"}, "edited": false, "score": 0, "creation_date": 1432995820, "post_id": 30547270, "comment_id": 49166920, "body": "I wasn&#39;t talking about <code>MonadState</code> specifically, but any class with the <code>Monad</code> prefix. I just used <code>MonadState</code> as an arbitrary example"}, {"owner": {"reputation": 51584, "user_id": 839246, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/9b0573c2b936b12828dd1e4cc04206dc?s=128&d=identicon&r=PG&f=1", "display_name": "bheklilr", "link": "https://stackoverflow.com/users/839246/bheklilr"}, "reply_to_user": {"reputation": 10492, "user_id": 1351298, "user_type": "registered", "accept_rate": 79, "profile_image": "https://i.stack.imgur.com/KJKqs.jpg?s=128&g=1", "display_name": "Electric Coffee", "link": "https://stackoverflow.com/users/1351298/electric-coffee"}, "edited": false, "score": 2, "creation_date": 1432995939, "post_id": 30547270, "comment_id": 49166964, "body": "@ElectricCoffee The same goes for <code>MonadReader</code>, <code>MonadIO</code>, <code>MonadError</code>, etc.  Each of these is a typeclass, not a type.  These are provided so that you can have more generic functions than just <code>StateT</code> allows.  You could even define your own instance of <code>MonadState</code> (or any of the others) as you need.  They&#39;re available to keep you from being tied down to just <code>StateT</code> or <code>ReaderT</code> or <code>IO</code> or whatever."}, {"owner": {"reputation": 10492, "user_id": 1351298, "user_type": "registered", "accept_rate": 79, "profile_image": "https://i.stack.imgur.com/KJKqs.jpg?s=128&g=1", "display_name": "Electric Coffee", "link": "https://stackoverflow.com/users/1351298/electric-coffee"}, "edited": false, "score": 0, "creation_date": 1432996002, "post_id": 30547270, "comment_id": 49166980, "body": "Could you give an example?"}], "tags": [], "owner": {"reputation": 100185, "user_id": 3234959, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/93bb12ca0f93dfddb33880316f7e66c2?s=128&d=identicon&r=PG&f=1", "display_name": "chi", "link": "https://stackoverflow.com/users/3234959/chi"}, "is_accepted": false, "score": 2, "last_activity_date": 1432995615, "creation_date": 1432995615, "answer_id": 30547270, "question_id": 30546986, "link": "https://stackoverflow.com/questions/30546986/why-are-some-typeclasses-prefixed-with-monad/30547270#30547270", "title": "Why are some typeclasses prefixed with &quot;Monad&quot;?", "body": "<p><code>MonadState</code> is not a monad, but is a subclass of <code>Monad</code>. <code>State</code> is a monad (and also a <code>MonadState</code>). The monad subclass <code>MonadState</code> is used to make functions such as <code>get</code>,<code>put</code> work on any monad which has a notion of a gettable/settable \"state\".</p>\n"}, {"comments": [{"owner": {"reputation": 10492, "user_id": 1351298, "user_type": "registered", "accept_rate": 79, "profile_image": "https://i.stack.imgur.com/KJKqs.jpg?s=128&g=1", "display_name": "Electric Coffee", "link": "https://stackoverflow.com/users/1351298/electric-coffee"}, "edited": false, "score": 0, "creation_date": 1432997416, "post_id": 30547501, "comment_id": 49167391, "body": "could you provide some example code of <code>Monad*</code> typeclasses in action?"}, {"owner": {"reputation": 48129, "user_id": 76051, "user_type": "registered", "accept_rate": 91, "profile_image": "https://i.stack.imgur.com/AGDxz.jpg?s=128&g=1", "display_name": "Carsten", "link": "https://stackoverflow.com/users/76051/carsten"}, "edited": false, "score": 0, "creation_date": 1432997829, "post_id": 30547501, "comment_id": 49167536, "body": "there is a really nice <a href=\"https://www.cs.virginia.edu/~wh5a/personal/Transformers.pdf\" rel=\"nofollow noreferrer\"><b>tutorial</b></a> for this"}, {"owner": {"reputation": 24211, "user_id": 1364288, "user_type": "registered", "accept_rate": 88, "profile_image": "https://i.stack.imgur.com/JVtNl.png?s=128&g=1", "display_name": "danidiaz", "link": "https://stackoverflow.com/users/1364288/danidiaz"}, "reply_to_user": {"reputation": 48129, "user_id": 76051, "user_type": "registered", "accept_rate": 91, "profile_image": "https://i.stack.imgur.com/AGDxz.jpg?s=128&g=1", "display_name": "Carsten", "link": "https://stackoverflow.com/users/76051/carsten"}, "edited": false, "score": 0, "creation_date": 1432998309, "post_id": 30547501, "comment_id": 49167695, "body": "@Carsten The tutorial doesn&#39;t cover the <code>mtl</code>, though."}, {"owner": {"reputation": 10492, "user_id": 1351298, "user_type": "registered", "accept_rate": 79, "profile_image": "https://i.stack.imgur.com/KJKqs.jpg?s=128&g=1", "display_name": "Electric Coffee", "link": "https://stackoverflow.com/users/1351298/electric-coffee"}, "edited": false, "score": 0, "creation_date": 1432999564, "post_id": 30547501, "comment_id": 49168096, "body": "I think I get it, but I&#39;m not sure"}, {"owner": {"reputation": 24211, "user_id": 1364288, "user_type": "registered", "accept_rate": 88, "profile_image": "https://i.stack.imgur.com/JVtNl.png?s=128&g=1", "display_name": "danidiaz", "link": "https://stackoverflow.com/users/1364288/danidiaz"}, "reply_to_user": {"reputation": 10492, "user_id": 1351298, "user_type": "registered", "accept_rate": 79, "profile_image": "https://i.stack.imgur.com/KJKqs.jpg?s=128&g=1", "display_name": "Electric Coffee", "link": "https://stackoverflow.com/users/1351298/electric-coffee"}, "edited": false, "score": 1, "creation_date": 1433000216, "post_id": 30547501, "comment_id": 49168304, "body": "@Electric Coffee Here&#39;s a possible exercise: write a function that asks for the reader environment, multiplies it with the current state, and stores the result in a &quot;log&quot;. It should work with a <code>ReaderT Int (WriterT [Int] (State Int)) ()</code> monad stack as well as <code>RWS Int [Int] Int ()</code>."}, {"owner": {"reputation": 44013, "user_id": 1477667, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/trgKM.jpg?s=128&g=1", "display_name": "dfeuer", "link": "https://stackoverflow.com/users/1477667/dfeuer"}, "edited": false, "score": 0, "creation_date": 1433024412, "post_id": 30547501, "comment_id": 49175888, "body": "@danidiaz, there is a tutorial covering mtl, called something like &quot;Monad Transformers Step by Step&quot;. It does quite a good job of showing how seductive the typeclass approach can be."}], "tags": [], "owner": {"reputation": 24211, "user_id": 1364288, "user_type": "registered", "accept_rate": 88, "profile_image": "https://i.stack.imgur.com/JVtNl.png?s=128&g=1", "display_name": "danidiaz", "link": "https://stackoverflow.com/users/1364288/danidiaz"}, "is_accepted": true, "score": 7, "last_activity_date": 1433000605, "last_edit_date": 1433000605, "creation_date": 1432997150, "answer_id": 30547501, "question_id": 30546986, "link": "https://stackoverflow.com/questions/30546986/why-are-some-typeclasses-prefixed-with-monad/30547501#30547501", "title": "Why are some typeclasses prefixed with &quot;Monad&quot;?", "body": "<p><code>State</code>, <code>StateT</code> and other types like them come from <a href=\"http://hackage.haskell.org/package/transformers\" rel=\"nofollow\"><code>transformers</code></a>, while the <code>MonadState</code> typeclass and other typeclasses like it come from <a href=\"http://hackage.haskell.org/package/mtl\" rel=\"nofollow\"><code>mtl</code></a>. Notice that the former are <em>types</em>, while the latter are <em>typeclasses</em>.</p>\n\n<p>The types from <code>transformers</code> are instances of <code>Monad</code> and <code>MonadTrans</code>. You can work directly with them, but there are a couple of annoyances:</p>\n\n<ul>\n<li><p>If you have a monad stack several layers deep, you have to sprinkle your code with a lot of calls to <code>lift</code> in order to access the functionality of each layer.</p></li>\n<li><p>Sometimes two different types provide the same \"interface\". For example, both <code>RWST</code> and <code>ReaderT</code> offer reader-like functionality like <code>ask</code>. When writing a function, it is annoying to have to commit to one of the other, as it reduces generality.</p></li>\n</ul>\n\n<p>The <code>Monad*</code> typeclasses from <code>mtl</code> alleviate these problems:</p>\n\n<ul>\n<li><p>They have \"pass-through\" instances that eliminate many calls to <code>lift</code> (or, more precisely, handle them automatically). For example, <code>StateT</code> is an instance of <code>MonadState</code>, but a <code>ReaderT</code> over <code>StateT</code> is also an instance of <code>MonadState</code>, so you can use <code>get</code> directly.</p>\n\n<pre><code>import Control.Monad\nimport Control.Monad.Reader\nimport Control.Monad.State\n\n-- put the environment in the state\nbar :: ReaderT Int (State Int) ()\nbar = ask &gt;&gt;= lift . put -- we use lift here\n\nbarMTL :: ReaderT Int (State Int) ()\n-- This ONLY works if we have imported the \n-- required instances from mtl.\n-- The MonadState instance for ReaderT, in particular.\nbarMTL = ask &gt;&gt;= put -- the put is auto-lifted\n</code></pre></li>\n<li><p>You can put a <code>Monad*</code> constraint in your functions and work against the <code>Monad*</code> \"interface\" instead of committing right away to a specific implementation of the monad. This way your functions become more general and choosing the exact \"implementation\" is delayed to the last possible moment.</p>\n\n<pre><code>import Control.Monad\nimport Control.Monad.State\nimport Control.Monad.RWS\n\n-- Dumb function that increments the state.\n-- Doesn't commit to a specific implementation of the monad.\nbaz :: MonadState Int m =&gt; m ()\nbaz = modify succ\n\nmain :: IO ()\nmain = do\n    -- run as State\n    print $ runState baz 0 \n    -- run as RWS\n    print $ runRWS (baz &gt;&gt; tell ()) () 0\n</code></pre></li>\n</ul>\n"}], "owner": {"reputation": 10492, "user_id": 1351298, "user_type": "registered", "accept_rate": 79, "profile_image": "https://i.stack.imgur.com/KJKqs.jpg?s=128&g=1", "display_name": "Electric Coffee", "link": "https://stackoverflow.com/users/1351298/electric-coffee"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 171, "favorite_count": 0, "accepted_answer_id": 30547501, "answer_count": 2, "score": 3, "last_activity_date": 1433058421, "creation_date": 1432993788, "last_edit_date": 1433058421, "question_id": 30546986, "link": "https://stackoverflow.com/questions/30546986/why-are-some-typeclasses-prefixed-with-monad", "title": "Why are some typeclasses prefixed with &quot;Monad&quot;?", "body": "<p>Reading through some code I sometimes come across typeclasses that are prefixed with <code>Monad</code>, examples of these are <code>MonadState</code>, <code>MonadIO</code>, <code>MonadReader</code>, etc.</p>\n\n<p>What exactly is the purpose of these?</p>\n\n<p>Taking <code>MonadState</code> as an example, I know that</p>\n\n<ul>\n<li><code>State</code> allows stateless state</li>\n<li><code>StateT</code> allows the use of other monads, like <code>IO</code> to <em>\"combine\"</em> the functionality of both</li>\n</ul>\n\n<p>But <code>MonadState</code> allows what exactly?</p>\n\n<p>I don't get the need for another group of similarly named types/typeclasses, can someone explain?</p>\n"}, {"tags": ["haskell", "cabal", "cabal-install"], "answers": [{"comments": [{"owner": {"reputation": 3961, "user_id": 176015, "user_type": "registered", "accept_rate": 40, "profile_image": "https://www.gravatar.com/avatar/398c96f77ec9b99b1e8122214227305d?s=128&d=identicon&r=PG", "display_name": "svenningsson", "link": "https://stackoverflow.com/users/176015/svenningsson"}, "edited": false, "score": 1, "creation_date": 1432990121, "post_id": 30546356, "comment_id": 49165145, "body": "The program I currently want to install is idris which comes with a ton of extra stuff like libraries. I&#39;d like to avoid having to figure out how to copy all that data by hand."}], "tags": [], "owner": {"reputation": 51584, "user_id": 839246, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/9b0573c2b936b12828dd1e4cc04206dc?s=128&d=identicon&r=PG&f=1", "display_name": "bheklilr", "link": "https://stackoverflow.com/users/839246/bheklilr"}, "is_accepted": false, "score": 1, "last_activity_date": 1432989914, "creation_date": 1432989914, "answer_id": 30546356, "question_id": 30545837, "link": "https://stackoverflow.com/questions/30545837/global-install-of-a-program-built-in-sandbox/30546356#30546356", "title": "Global install of a program built in sandbox", "body": "<p>If the binary is statically linked (which is true in most cases) then you can do the following</p>\n\n<pre><code>&gt; mkdir tools\n&gt; cd tools\n&gt; cabal sandbox init\n&gt; cabal install tool1 tool2\n# Wait a long time\n&gt; cp .cabal-sandbox/bin/tool1 ~/.cabal/bin\n&gt; cp .cabal-sandbox/bin/tool2 ~/.cabal/bin\n</code></pre>\n\n<p>On windows you'll have to do</p>\n\n<pre><code>&gt; cp .cabal-sandbox\\bin\\tool1.exe %APPDATA%\\Roaming\\cabal\\bin\n&gt; cp .cabal-sandbox\\bin\\tool2.exe %APPDATA%\\Roaming\\cabal\\bin\n</code></pre>\n\n<p>Obviously you should have your user cabal directory on your path.</p>\n\n<p>Your mileage may vary, it's dependent on the executable being built, so for some it might be more difficult to do this sort of thing.  In my experience this works pretty well, though.  I use it for ghc-mod, hlint, pointfree, and others.</p>\n"}, {"comments": [{"owner": {"reputation": 3961, "user_id": 176015, "user_type": "registered", "accept_rate": 40, "profile_image": "https://www.gravatar.com/avatar/398c96f77ec9b99b1e8122214227305d?s=128&d=identicon&r=PG", "display_name": "svenningsson", "link": "https://stackoverflow.com/users/176015/svenningsson"}, "edited": false, "score": 0, "creation_date": 1433057117, "post_id": 30554795, "comment_id": 49181776, "body": "Thanks. That&#39;s a very simple and pragmatic solution. Though I still wish cabal provided a means to solve the problem."}], "tags": [], "owner": {"reputation": 48129, "user_id": 76051, "user_type": "registered", "accept_rate": 91, "profile_image": "https://i.stack.imgur.com/AGDxz.jpg?s=128&g=1", "display_name": "Carsten", "link": "https://stackoverflow.com/users/76051/carsten"}, "is_accepted": false, "score": 3, "last_activity_date": 1433057183, "last_edit_date": 1433057183, "creation_date": 1433056113, "answer_id": 30554795, "question_id": 30545837, "link": "https://stackoverflow.com/questions/30545837/global-install-of-a-program-built-in-sandbox/30554795#30554795", "title": "Global install of a program built in sandbox", "body": "<h2>Linking <strong>Idris</strong> to a PATH-folder</h2>\n\n<p>If you are on linux it's as simple as putting a symbolic link somewhere into your path - I have a <code>~/bin</code> for that. So it's the same as bheklilr mentioned only that I usually get the dev-version from github:</p>\n\n<pre><code>git clone git://github.com/idris-lang/Idris-dev idris\ncd idris\ncabal sandbox init\ncabal update\ncabal install --dependencies only\nmake\n</code></pre>\n\n<p>after this I go to <code>~/bin</code> and use <code>ln -s [path to idris]/.cabal-sandbox/bin/idris</code> - you can link the other executables too if you like but this one will should be enough to play with <em>idris</em></p>\n"}], "owner": {"reputation": 3961, "user_id": 176015, "user_type": "registered", "accept_rate": 40, "profile_image": "https://www.gravatar.com/avatar/398c96f77ec9b99b1e8122214227305d?s=128&d=identicon&r=PG", "display_name": "svenningsson", "link": "https://stackoverflow.com/users/176015/svenningsson"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 124, "favorite_count": 0, "answer_count": 2, "score": 5, "last_activity_date": 1439390931, "creation_date": 1432986758, "last_edit_date": 1439390931, "question_id": 30545837, "link": "https://stackoverflow.com/questions/30545837/global-install-of-a-program-built-in-sandbox", "title": "Global install of a program built in sandbox", "body": "<p>I'm using sandboxes all the time when building Haskell programs and libraries. But occasionally, I build a program that I would like to install system wide. There doesn't seem to be an easy way of taking a program which is built in a sandbox and installing it outside of the sandbox.</p>\n"}, {"tags": ["haskell", "pattern-matching", "monads", "do-notation"], "comments": [{"owner": {"reputation": 126897, "user_id": 791604, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/ce991df7a056248d5e4f6fc3659ba733?s=128&d=identicon&r=PG", "display_name": "Daniel Wagner", "link": "https://stackoverflow.com/users/791604/daniel-wagner"}, "edited": false, "score": 4, "creation_date": 1432987572, "post_id": 30545781, "comment_id": 49164462, "body": "It&#39;s still syntactic sugar, the sugar is just a little bit sweeter than you were thinking."}, {"owner": {"reputation": 211, "user_id": 3525132, "user_type": "registered", "accept_rate": 60, "profile_image": "https://www.gravatar.com/avatar/6c3c589bdbd531ca5651f29149eef1ce?s=128&d=identicon&r=PG&f=1", "display_name": "Brrch", "link": "https://stackoverflow.com/users/3525132/brrch"}, "reply_to_user": {"reputation": 126897, "user_id": 791604, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/ce991df7a056248d5e4f6fc3659ba733?s=128&d=identicon&r=PG", "display_name": "Daniel Wagner", "link": "https://stackoverflow.com/users/791604/daniel-wagner"}, "edited": false, "score": 0, "creation_date": 1433081771, "post_id": 30545781, "comment_id": 49188359, "body": "If it really <i>is</i> a syntactic sugar, then how would it be desugared into using bind and return?"}, {"owner": {"reputation": 126897, "user_id": 791604, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/ce991df7a056248d5e4f6fc3659ba733?s=128&d=identicon&r=PG", "display_name": "Daniel Wagner", "link": "https://stackoverflow.com/users/791604/daniel-wagner"}, "edited": false, "score": 1, "creation_date": 1433095071, "post_id": 30545781, "comment_id": 49192854, "body": "The <a href=\"https://www.haskell.org/onlinereport/haskell2010/haskellch3.html#x8-470003.14\" rel=\"nofollow noreferrer\">Haskell Report</a> has the definitive answer to that."}], "answers": [{"comments": [{"owner": {"reputation": 8676, "user_id": 1113881, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/sBc0F.jpg?s=128&g=1", "display_name": "CR Drost", "link": "https://stackoverflow.com/users/1113881/cr-drost"}, "edited": false, "score": 0, "creation_date": 1432995742, "post_id": 30547212, "comment_id": 49166884, "body": "There is also a possibility which would work even beyond <code>do</code> notation: make all pattern matches that we can&#39;t prove terminate implicitly end with <code>_ -&gt; patternMatchFail &quot;Line number&quot;</code>and then make <code>class PatternMatchFailable pmf where patternMatchFail :: String -&gt; pmf</code> . Anything which is not part of that class is caught as a compiler error. (Note that it&#39;s the <i>output</i> type, not the input type, which says whether the pattern match can fail.)"}, {"owner": {"reputation": 211, "user_id": 3525132, "user_type": "registered", "accept_rate": 60, "profile_image": "https://www.gravatar.com/avatar/6c3c589bdbd531ca5651f29149eef1ce?s=128&d=identicon&r=PG&f=1", "display_name": "Brrch", "link": "https://stackoverflow.com/users/3525132/brrch"}, "edited": false, "score": 0, "creation_date": 1433060693, "post_id": 30547212, "comment_id": 49182548, "body": "I don&#39;t understand why it should have a different behavior at all."}, {"owner": {"reputation": 126897, "user_id": 791604, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/ce991df7a056248d5e4f6fc3659ba733?s=128&d=identicon&r=PG", "display_name": "Daniel Wagner", "link": "https://stackoverflow.com/users/791604/daniel-wagner"}, "reply_to_user": {"reputation": 8676, "user_id": 1113881, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/sBc0F.jpg?s=128&g=1", "display_name": "CR Drost", "link": "https://stackoverflow.com/users/1113881/cr-drost"}, "edited": false, "score": 1, "creation_date": 1433095262, "post_id": 30547212, "comment_id": 49192914, "body": "@ChrisDrost That would break referential transparency (in the same way the current translation using <code>fail</code> regrettably already does with particular implementations of <code>Monad</code>): inlining a definition would change the line number in a way observable from within the program."}, {"owner": {"reputation": 8676, "user_id": 1113881, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/sBc0F.jpg?s=128&g=1", "display_name": "CR Drost", "link": "https://stackoverflow.com/users/1113881/cr-drost"}, "reply_to_user": {"reputation": 126897, "user_id": 791604, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/ce991df7a056248d5e4f6fc3659ba733?s=128&d=identicon&r=PG", "display_name": "Daniel Wagner", "link": "https://stackoverflow.com/users/791604/daniel-wagner"}, "edited": false, "score": 0, "creation_date": 1433288703, "post_id": 30547212, "comment_id": 49284330, "body": "@DanielWagner: Interesting point, but I&#39;m not sure it&#39;s &quot;referential transparency&quot; you&#39;re talking about: I believe you&#39;re expecting two functions with the exact same definitions to be exactly the same function independent of where that code is written whereas this approach says they are not always, because of implicitly-inserted lines of code. But those lines could at present be explicitly inserted by a preprocessor, so there&#39;s no real <i>semantic</i> difference at the Haskell level."}, {"owner": {"reputation": 126897, "user_id": 791604, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/ce991df7a056248d5e4f6fc3659ba733?s=128&d=identicon&r=PG", "display_name": "Daniel Wagner", "link": "https://stackoverflow.com/users/791604/daniel-wagner"}, "reply_to_user": {"reputation": 8676, "user_id": 1113881, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/sBc0F.jpg?s=128&g=1", "display_name": "CR Drost", "link": "https://stackoverflow.com/users/1113881/cr-drost"}, "edited": false, "score": 0, "creation_date": 1433293840, "post_id": 30547212, "comment_id": 49285714, "body": "@ChrisDrost It is referential transparency. Referential transparency says you can replace a value with its definition and get the same result; but you cannot do this, because if you inline a definition that has a partial pattern, GHC will produce code that passes a different value to <code>fail</code>."}, {"owner": {"reputation": 8676, "user_id": 1113881, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/sBc0F.jpg?s=128&g=1", "display_name": "CR Drost", "link": "https://stackoverflow.com/users/1113881/cr-drost"}, "reply_to_user": {"reputation": 126897, "user_id": 791604, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/ce991df7a056248d5e4f6fc3659ba733?s=128&d=identicon&r=PG", "display_name": "Daniel Wagner", "link": "https://stackoverflow.com/users/791604/daniel-wagner"}, "edited": false, "score": 0, "creation_date": 1433343826, "post_id": 30547212, "comment_id": 49313689, "body": "@DanielWagner Yeah, no, I don&#39;t find much value in that. I don&#39;t complain that <code>let x = 3 + 3 in x * x</code> violates referential transparency merely because it produces a number distinct from <code>3 + 3 * 3 + 3</code>. Referential transparency is <b>semantic</b>, not <b>syntactic</b>. The fact is, you <i>can</i> replace a value with its definition and get the same result, but the &quot;definition&quot; is not literally what you&#39;ve written due to syntactic sugar. The claim that syntactic sugar (whether that sugar is operator-notation or implicit line numbers) amounts to a violation of referential transparency just seems silly."}, {"owner": {"reputation": 126897, "user_id": 791604, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/ce991df7a056248d5e4f6fc3659ba733?s=128&d=identicon&r=PG", "display_name": "Daniel Wagner", "link": "https://stackoverflow.com/users/791604/daniel-wagner"}, "reply_to_user": {"reputation": 8676, "user_id": 1113881, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/sBc0F.jpg?s=128&g=1", "display_name": "CR Drost", "link": "https://stackoverflow.com/users/1113881/cr-drost"}, "edited": false, "score": 1, "creation_date": 1433358359, "post_id": 30547212, "comment_id": 49323002, "body": "@ChrisDrost I agree that referential transparency is about semantically replacing a variable with its definition. I claim that replacing <code>let foo = do { False &lt;- return True; return () } in foo</code> with <code>let foo = do { False &lt;- return True; return () } in do { False &lt;- return True; return () }</code> <i>is</i> a semantic replacement, and produces a different result in GHC. Because you cannot safely do this kind of replacement, you throw away a very powerful reasoning tool and a very practical and commonly-used refactoring tool."}], "tags": [], "owner": {"reputation": 100185, "user_id": 3234959, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/93bb12ca0f93dfddb33880316f7e66c2?s=128&d=identicon&r=PG&f=1", "display_name": "chi", "link": "https://stackoverflow.com/users/3234959/chi"}, "is_accepted": false, "score": 1, "last_activity_date": 1432995215, "creation_date": 1432995215, "answer_id": 30547212, "question_id": 30545781, "link": "https://stackoverflow.com/questions/30545781/why-should-fail-method-exist-in-the-monad-type-class/30547212#30547212", "title": "Why should fail method exist in the monad type class?", "body": "<p>Code such as</p>\n\n<pre><code>\\(Just x) -&gt; ...\n</code></pre>\n\n<p>denotes a function. There's only one way to use such a value: apply it to some argument. When said argument does not match the pattern (e.g. is <code>Nothing</code>) application is impossible, and the only general option is to raise a runtime error/exception.</p>\n\n<p>Instead, when in a <code>do</code>-block, we have a type class around: a monad. Such class could, in theory, be extended to provide a behavior for such cases. Indeed, the designers of Haskell decided to add a <code>fail</code> method just for this case.</p>\n\n<p>Whether the choice was good or bad can be controversial. Just to present another design option, the <code>Monad</code> class could have been designed without <code>fail</code>, and blocks such as </p>\n\n<pre><code>do ... \n   Just x &lt;- ...\n   ...\n</code></pre>\n\n<p>could have been forbidden, or made to require a special <code>MonadFail</code> subclass of Monad. Erroring out is also a choice, but we like to write e.g.</p>\n\n<pre><code>catMaybes xs = do Just x &lt;- xs\n                  return x\n-- or\ncatMaybes xs = [ x | Just x &lt;- xs ]\n</code></pre>\n\n<p>to discard <code>Nothing</code>s from a list.</p>\n"}], "owner": {"reputation": 211, "user_id": 3525132, "user_type": "registered", "accept_rate": 60, "profile_image": "https://www.gravatar.com/avatar/6c3c589bdbd531ca5651f29149eef1ce?s=128&d=identicon&r=PG&f=1", "display_name": "Brrch", "link": "https://stackoverflow.com/users/3525132/brrch"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 119, "favorite_count": 0, "answer_count": 1, "score": 4, "last_activity_date": 1432995215, "creation_date": 1432986390, "last_edit_date": 1432987433, "question_id": 30545781, "link": "https://stackoverflow.com/questions/30545781/why-should-fail-method-exist-in-the-monad-type-class", "title": "Why should fail method exist in the monad type class?", "body": "<p>So I have this line of code:</p>\n\n<pre><code>[Nothing] &gt;&gt;= \\(Just x) -&gt; [x]\n</code></pre>\n\n<p>which of course gives exception, because the pattern doesn't match Nothing.</p>\n\n<p>On the other hand, this code gives a different result, []:</p>\n\n<pre><code>do\n  Just x &lt;- [Nothing]\n  return x\n</code></pre>\n\n<p>As I see it, they should produce the same result, because do-blocks should be desugared into using (>>=) and return. But this is not the case, making do-notation a feature rather than a syntactic sugar.</p>\n\n<p>I know that fail exists in the monad type class and I know that it is called when a pattern matching fails in a do-block, but I can't understand why it is a wanted behavior that should be different than using normal monad operations.</p>\n\n<p>So my questions is - why should the fail method exist at all?</p>\n"}, {"tags": ["haskell", "cpu-usage", "yesod"], "comments": [{"owner": {"reputation": 100768, "user_id": 1899640, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/47374ccb28e4b0d2454b64f7b975bc66?s=128&d=identicon&r=PG", "display_name": "that other guy", "link": "https://stackoverflow.com/users/1899640/that-other-guy"}, "edited": false, "score": 0, "creation_date": 1432967134, "post_id": 30543025, "comment_id": 49159046, "body": "Any loading and initialization will count (<code>cat</code> doesn&#39;t show anything because it loads in &lt;1ms). Does it increase further as time goes on? By how much?"}, {"owner": {"reputation": 1657, "user_id": 4183787, "user_type": "registered", "accept_rate": 62, "profile_image": "https://i.stack.imgur.com/XedpJ.png?s=128&g=1", "display_name": "zigazou", "link": "https://stackoverflow.com/users/4183787/zigazou"}, "reply_to_user": {"reputation": 100768, "user_id": 1899640, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/47374ccb28e4b0d2454b64f7b975bc66?s=128&d=identicon&r=PG", "display_name": "that other guy", "link": "https://stackoverflow.com/users/1899640/that-other-guy"}, "edited": false, "score": 0, "creation_date": 1432968654, "post_id": 30543025, "comment_id": 49159380, "body": "Yes, it increases as time goes on. I discovered this behaviour when I was looking at <code>top</code>, seeing my site in the first ten processes. So I decided to test with <code>time</code> to have better numbers than <code>top</code>."}, {"owner": {"reputation": 100185, "user_id": 3234959, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/93bb12ca0f93dfddb33880316f7e66c2?s=128&d=identicon&r=PG&f=1", "display_name": "chi", "link": "https://stackoverflow.com/users/3234959/chi"}, "edited": false, "score": 0, "creation_date": 1432969558, "post_id": 30543025, "comment_id": 49159582, "body": "The <code>0.352s</code> timing could be the setup of the runtime + Yesod. For a better comparison, try waiting 1m and waiting 2m and subtract times: this should give you a better CPU/s estimation."}, {"owner": {"reputation": 1657, "user_id": 4183787, "user_type": "registered", "accept_rate": 62, "profile_image": "https://i.stack.imgur.com/XedpJ.png?s=128&g=1", "display_name": "zigazou", "link": "https://stackoverflow.com/users/4183787/zigazou"}, "edited": false, "score": 1, "creation_date": 1432969909, "post_id": 30543025, "comment_id": 49159672, "body": "I added two more samples of the program running without idle GC. The leak increases as time goes on, meaning it is not the setup of the runtime and Yesod initialisation that have an effect"}, {"owner": {"reputation": 1657, "user_id": 4183787, "user_type": "registered", "accept_rate": 62, "profile_image": "https://i.stack.imgur.com/XedpJ.png?s=128&g=1", "display_name": "zigazou", "link": "https://stackoverflow.com/users/4183787/zigazou"}, "edited": false, "score": 0, "creation_date": 1432969959, "post_id": 30543025, "comment_id": 49159684, "body": "Actually the launching of my application takes approximately <code>0.080s</code>."}, {"owner": {"reputation": 100185, "user_id": 3234959, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/93bb12ca0f93dfddb33880316f7e66c2?s=128&d=identicon&r=PG&f=1", "display_name": "chi", "link": "https://stackoverflow.com/users/3234959/chi"}, "edited": false, "score": 0, "creation_date": 1432970991, "post_id": 30543025, "comment_id": 49159914, "body": "Nice. Maybe turning on the GHC profiling options will reveal something? <a href=\"https://downloads.haskell.org/~ghc/latest/docs/html/users_guide/profiling.html\" rel=\"nofollow noreferrer\">downloads.haskell.org/~ghc/latest/docs/html/users_guide/&hellip;</a>"}, {"owner": {"reputation": 94713, "user_id": 1139697, "user_type": "registered", "accept_rate": 86, "profile_image": "https://www.gravatar.com/avatar/5f136ddb684f39aaee1c028ee1950f6f?s=128&d=identicon&r=PG", "display_name": "Zeta", "link": "https://stackoverflow.com/users/1139697/zeta"}, "edited": false, "score": 0, "creation_date": 1432973175, "post_id": 30543025, "comment_id": 49160436, "body": "Also, the RTS statistics (<code>+RTS -s</code>) would be interesting."}, {"owner": {"reputation": 44013, "user_id": 1477667, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/trgKM.jpg?s=128&g=1", "display_name": "dfeuer", "link": "https://stackoverflow.com/users/1477667/dfeuer"}, "edited": false, "score": 0, "creation_date": 1433110648, "post_id": 30543025, "comment_id": 49197740, "body": "You should probably show us your code just in case, lest this be closed as off topic. Also, you might consider checking Yesod&#39;s bug tracker and perhaps filing a report."}, {"owner": {"reputation": 1657, "user_id": 4183787, "user_type": "registered", "accept_rate": 62, "profile_image": "https://i.stack.imgur.com/XedpJ.png?s=128&g=1", "display_name": "zigazou", "link": "https://stackoverflow.com/users/4183787/zigazou"}, "reply_to_user": {"reputation": 44013, "user_id": 1477667, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/trgKM.jpg?s=128&g=1", "display_name": "dfeuer", "link": "https://stackoverflow.com/users/1477667/dfeuer"}, "edited": false, "score": 0, "creation_date": 1433140200, "post_id": 30543025, "comment_id": 49204539, "body": "@dfeuer I posted it here because I am new to Haskell+Yesod and did not know if this is a standard behaviour of Yesod, a known or unknown leak, something Haskell does in background, or something resulting of a commonly found pattern. That\u2019s why I did not go straight to do a Yesod bug report."}, {"owner": {"reputation": 44013, "user_id": 1477667, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/trgKM.jpg?s=128&g=1", "display_name": "dfeuer", "link": "https://stackoverflow.com/users/1477667/dfeuer"}, "edited": false, "score": 1, "creation_date": 1433186239, "post_id": 30543025, "comment_id": 49232745, "body": "@zigazou, the only time I can think of when wheel-spinning is not a bug in a system is when it&#39;s some kind of defense against side-channel attacks. That seems highly unlikely in this context. You should, however, include your code (however trivial you think it is), GHC version number, Yesod version number, and detailed reproduction instructions in your bug report. Also, there are already a couple tickets about excessive CPU use in certain circumstances. Check that none of them apply before you file a new one."}, {"owner": {"reputation": 1044, "user_id": 476114, "user_type": "registered", "accept_rate": 78, "profile_image": "https://www.gravatar.com/avatar/18db9bf4cb83fb9c8f30aeb53b3ccfae?s=128&d=identicon&r=PG", "display_name": "Bzzt", "link": "https://stackoverflow.com/users/476114/bzzt"}, "edited": false, "score": 0, "creation_date": 1435428170, "post_id": 30543025, "comment_id": 50200137, "body": "I&#39;m using Yesod on an ARM project, and I&#39;m seeing consistent 14% cpu usage there while its doing nothing.  Its not a total dealbreaker, but its close.  I&#39;m going to try a test project in spock and see if that does the same thing."}], "answers": [{"tags": [], "owner": {"reputation": 1044, "user_id": 476114, "user_type": "registered", "accept_rate": 78, "profile_image": "https://www.gravatar.com/avatar/18db9bf4cb83fb9c8f30aeb53b3ccfae?s=128&d=identicon&r=PG", "display_name": "Bzzt", "link": "https://stackoverflow.com/users/476114/bzzt"}, "is_accepted": false, "score": 2, "last_activity_date": 1435429754, "creation_date": 1435429754, "answer_id": 31092097, "question_id": 30543025, "link": "https://stackoverflow.com/questions/30543025/haskell-small-cpu-leak/31092097#31092097", "title": "Haskell small CPU leak", "body": "<p>Found a <a href=\"https://github.com/yesodweb/yesod/issues/767\" rel=\"nofollow\">related bug</a> in the Yesod bug tracker.  Ran my program like this:</p>\n\n<blockquote>\n  <p>myserver +RTS -I0 -RTS Development</p>\n</blockquote>\n\n<p>And now idle CPU usage is down to almost nothing, compared to 14% or so before (ARM computer).  The I0 (that's I and zero) option turns off periodic garbage collection, which defaults to 0.3 secs I think.  Not sure about that implications for app responsiveness or memory usage, but for me at least this is definitely the culprit.  </p>\n"}], "owner": {"reputation": 1657, "user_id": 4183787, "user_type": "registered", "accept_rate": 62, "profile_image": "https://i.stack.imgur.com/XedpJ.png?s=128&g=1", "display_name": "zigazou", "link": "https://stackoverflow.com/users/4183787/zigazou"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 298, "favorite_count": 1, "answer_count": 1, "score": 8, "last_activity_date": 1435429754, "creation_date": 1432966900, "last_edit_date": 1433140934, "question_id": 30543025, "link": "https://stackoverflow.com/questions/30543025/haskell-small-cpu-leak", "title": "Haskell small CPU leak", "body": "<p>I\u2019m experiencing small CPU leaks using GHC 7.8.3 and Yesod 1.4.9.</p>\n\n<p>When I run my site with <code>time</code> and stop it (Ctrl+C) after 1 minute without doing anything (just run, no request at all), it consumes 1 second. It represents approximately 1.7% of CPU.</p>\n\n<pre><code>$ time mysite\n^C\n\nreal    1m0.226s\nuser    0m1.024s\nsys     0m0.060s\n</code></pre>\n\n<p>If I disable the idle garbage collector, it drops to 0.35 second (0.6% of CPU). Though it\u2019s better, it still consumes CPU without doing anything.</p>\n\n<pre><code>$ time mysite +RTS -I0 # Disable idle GC\n^C\n\nreal    1m0.519s\nuser    0m0.352s\nsys     0m0.064s\n\n$ time mysite +RTS -I0\n^C\n\nreal    4m0.676s\nuser    0m0.888s\nsys     0m0.468s\n\n$ time mysite +RTS -I0\n^C\n\nreal    7m28.282s\nuser    0m1.452s\nsys     0m0.976s\n</code></pre>\n\n<p>Compared to a <code>cat</code> command waiting indefinitely for something on the standard input:</p>\n\n<pre><code>$ time cat\n^C\n\nreal    1m1.349s\nuser    0m0.000s\nsys     0m0.000s\n</code></pre>\n\n<p>Is there anything else in Haskell that does consume CPU in the background ?</p>\n\n<p>Is it a leak from Yesod ?</p>\n\n<p>Or is it something that I have done in my program ? (I have only added handler functions, I don\u2019t do parallel computation)</p>\n\n<p><strong>Edit 2015-05-31 19:25</strong></p>\n\n<p>Here\u2019s the execution with the <code>-s</code> flag:</p>\n\n<pre><code>$ time mysite +RTS -I0 -s\n^C      23,138,184 bytes allocated in the heap\n       4,422,096 bytes copied during GC\n       2,319,960 bytes maximum residency (4 sample(s))\n         210,584 bytes maximum slop\n               6 MB total memory in use (0 MB lost due to fragmentation)\n\n                                    Tot time (elapsed)  Avg pause  Max pause\n  Gen  0        30 colls,     0 par    0.00s    0.00s     0.0001s    0.0003s\n  Gen  1         4 colls,     0 par    0.03s    0.04s     0.0103s    0.0211s\n\n  TASKS: 5 (1 bound, 4 peak workers (4 total), using -N1)\n\n  SPARKS: 0 (0 converted, 0 overflowed, 0 dud, 0 GC'd, 0 fizzled)\n\n  INIT    time    0.00s  (  0.00s elapsed)\n  MUT     time    0.86s  (224.38s elapsed)\n  GC      time    0.03s  (  0.05s elapsed)\n  RP      time    0.00s  (  0.00s elapsed)\n  PROF    time    0.00s  (  0.00s elapsed)\n  EXIT    time    0.00s  (  0.00s elapsed)\n  Total   time    0.90s  (224.43s elapsed)\n\n  Alloc rate    26,778,662 bytes per MUT second\n\n  Productivity  96.9% of total user, 0.4% of total elapsed\n\ngc_alloc_block_sync: 0\nwhitehole_spin: 0\ngen[0].sync: 0\ngen[1].sync: 0\n\n\nreal    3m44.447s\nuser    0m0.896s\nsys     0m0.320s\n</code></pre>\n\n<p>And with profiling:</p>\n\n<pre><code>$ time mysite +RTS -I0\n^C      23,024,424 bytes allocated in the heap\n      19,367,640 bytes copied during GC\n       2,319,960 bytes maximum residency (94 sample(s))\n         211,312 bytes maximum slop\n               6 MB total memory in use (0 MB lost due to fragmentation)\n\n                                    Tot time (elapsed)  Avg pause  Max pause\n  Gen  0        27 colls,     0 par    0.00s    0.00s     0.0002s    0.0005s\n  Gen  1        94 colls,     0 par    1.09s    1.04s     0.0111s    0.0218s\n\n  TASKS: 5 (1 bound, 4 peak workers (4 total), using -N1)\n\n  SPARKS: 0 (0 converted, 0 overflowed, 0 dud, 0 GC'd, 0 fizzled)\n\n  INIT    time    0.00s  (  0.00s elapsed)\n  MUT     time    1.00s  (201.66s elapsed)\n  GC      time    1.07s  (  1.03s elapsed)\n  RP      time    0.00s  (  0.00s elapsed)\n  PROF    time    0.02s  (  0.02s elapsed)\n  EXIT    time    0.00s  (  0.00s elapsed)\n  Total   time    2.09s  (202.68s elapsed)\n\n  Alloc rate    23,115,591 bytes per MUT second\n\n  Productivity  47.7% of total user, 0.5% of total elapsed\n\ngc_alloc_block_sync: 0\nwhitehole_spin: 0\ngen[0].sync: 0\ngen[1].sync: 0\n\n\nreal    3m22.697s\nuser    0m2.088s\nsys     0m0.060s\n</code></pre>\n\n<p>mysite.prof:</p>\n\n<pre><code>    Sun May 31 19:16 2015 Time and Allocation Profiling Report  (Final)\n\n       mysite +RTS -N -p -s -h -i0.1 -I0 -RTS\n\n    total time  =        0.05 secs   (49 ticks @ 1000 us, 1 processor)\n    total alloc =  17,590,528 bytes  (excludes profiling overheads)\n\nCOST CENTRE           MODULE                 %time %alloc\n\nMAIN                  MAIN                    98.0   93.7\nacquireSeedSystem.\\.\\ System.Random.MWC        2.0    0.0\ntoByteString          Data.Serialize.Builder   0.0    3.9\n\n\n                                                                                           individual     inherited\nCOST CENTRE                 MODULE                                       no.     entries  %time %alloc   %time %alloc\n\nMAIN                        MAIN                                        5684           0   98.0   93.7   100.0  100.0\n createSystemRandom         System.Random.MWC                          11396           0    0.0    0.0     2.0    0.3\n  withSystemRandom          System.Random.MWC                          11397           0    0.0    0.1     2.0    0.3\n   acquireSeedSystem        System.Random.MWC                          11399           0    0.0    0.0     2.0    0.2\n    acquireSeedSystem.\\     System.Random.MWC                          11401           1    0.0    0.2     2.0    0.2\n     acquireSeedSystem.\\.\\  System.Random.MWC                          11403           1    2.0    0.0     2.0    0.0\n sndS                       Data.Serialize.Put                         11386          21    0.0    0.0     0.0    0.0\n put                        Data.Serialize                             11384          21    0.0    0.0     0.0    0.0\n unPut                      Data.Serialize.Put                         11383          21    0.0    0.0     0.0    0.0\n toByteString               Data.Serialize.Builder                     11378          21    0.0    3.9     0.0    4.0\n  flush.\\                   Data.Serialize.Builder                     11393          21    0.0    0.0     0.0    0.0\n  withSize                  Data.Serialize.Builder                     11388           0    0.0    0.0     0.0    0.0\n   withSize.\\               Data.Serialize.Builder                     11389          21    0.0    0.0     0.0    0.0\n    runBuilder              Data.Serialize.Builder                     11390          21    0.0    0.0     0.0    0.0\n  runBuilder                Data.Serialize.Builder                     11382          21    0.0    0.0     0.0    0.0\n unstream/resize            Data.Text.Internal.Fusion                  11372         174    0.0    0.1     0.0    0.1\n CAF                        GHC.IO.Encoding                            11322           0    0.0    0.0     0.0    0.0\n CAF                        GHC.IO.FD                                  11319           0    0.0    0.0     0.0    0.0\n CAF                        GHC.IO.Handle.FD                           11318           0    0.0    0.2     0.0    0.2\n CAF                        GHC.Event.Thread                           11304           0    0.0    0.0     0.0    0.0\n CAF                        GHC.Conc.Signal                            11292           0    0.0    0.0     0.0    0.0\n CAF                        GHC.IO.Encoding.Iconv                      11288           0    0.0    0.0     0.0    0.0\n CAF                        GHC.TopHandler                             11284           0    0.0    0.0     0.0    0.0\n CAF                        GHC.Event.Control                          11271           0    0.0    0.0     0.0    0.0\n CAF                        Main                                       11263           0    0.0    0.0     0.0    0.0\n  main                      Main                                       11368           1    0.0    0.0     0.0    0.0\n CAF                        Application                                11262           0    0.0    0.0     0.0    0.0\n CAF                        Foundation                                 11261           0    0.0    0.0     0.0    0.0\n CAF                        Model                                      11260           0    0.0    0.1     0.0    0.3\n  unstream/resize           Data.Text.Internal.Fusion                  11375          35    0.0    0.1     0.0    0.1\n CAF                        Settings                                   11259           0    0.0    0.1     0.0    0.2\n  unstream/resize           Data.Text.Internal.Fusion                  11370          20    0.0    0.1     0.0    0.1\n CAF                        Database.Persist.Postgresql                 6229           0    0.0    0.3     0.0    0.9\n  unstream/resize           Data.Text.Internal.Fusion                  11373          93    0.0    0.6     0.0    0.6\n CAF                        Database.PostgreSQL.Simple.Transaction      6224           0    0.0    0.0     0.0    0.0\n CAF                        Database.PostgreSQL.Simple.TypeInfo.Static  6222           0    0.0    0.0     0.0    0.0\n CAF                        Database.PostgreSQL.Simple.Internal         6219           0    0.0    0.0     0.0    0.0\n CAF                        Yesod.Static                                6210           0    0.0    0.0     0.0    0.0\n CAF                        Crypto.Hash.Conduit                         6193           0    0.0    0.0     0.0    0.0\n CAF                        Yesod.Default.Config2                       6192           0    0.0    0.0     0.0    0.0\n  unstream/resize           Data.Text.Internal.Fusion                  11371           1    0.0    0.0     0.0    0.0\n CAF                        Yesod.Core.Internal.Util                    6154           0    0.0    0.0     0.0    0.0\n CAF                        Text.Libyaml                                6121           0    0.0    0.0     0.0    0.0\n CAF                        Data.Yaml                                   6120           0    0.0    0.0     0.0    0.0\n CAF                        Data.Yaml.Internal                          6119           0    0.0    0.0     0.0    0.0\n  unstream/resize           Data.Text.Internal.Fusion                  11369           1    0.0    0.0     0.0    0.0\n CAF                        Database.Persist.Quasi                      6055           0    0.0    0.0     0.0    0.0\n  unstream/resize           Data.Text.Internal.Fusion                  11376           1    0.0    0.0     0.0    0.0\n CAF                        Database.Persist.Sql.Internal               6046           0    0.0    0.0     0.0    0.0\n  unstream/resize           Data.Text.Internal.Fusion                  11377           6    0.0    0.0     0.0    0.0\n CAF                        Data.Pool                                   6036           0    0.0    0.0     0.0    0.0\n CAF                        Network.HTTP.Client.TLS                     6014           0    0.0    0.0     0.0    0.0\n CAF                        System.X509.Unix                            6010           0    0.0    0.0     0.0    0.0\n CAF                        Crypto.Hash.MD5                             5927           0    0.0    0.0     0.0    0.0\n CAF                        Data.Serialize                              5873           0    0.0    0.0     0.0    0.0\n  put                       Data.Serialize                             11385           1    0.0    0.0     0.0    0.0\n CAF                        Data.Serialize.Put                          5872           0    0.0    0.0     0.0    0.0\n  withSize                  Data.Serialize.Builder                     11387           1    0.0    0.0     0.0    0.0\n CAF                        Data.Serialize.Builder                      5870           0    0.0    0.0     0.0    0.0\n  flush                     Data.Serialize.Builder                     11392           1    0.0    0.0     0.0    0.0\n  toByteString              Data.Serialize.Builder                     11391           0    0.0    0.0     0.0    0.0\n  defaultSize               Data.Serialize.Builder                     11379           1    0.0    0.0     0.0    0.0\n   defaultSize.overhead     Data.Serialize.Builder                     11381           1    0.0    0.0     0.0    0.0\n   defaultSize.k            Data.Serialize.Builder                     11380           1    0.0    0.0     0.0    0.0\n CAF                        Crypto.Random.Entropy.Unix                  5866           0    0.0    0.0     0.0    0.0\n CAF                        Network.HTTP.Client.Manager                 5861           0    0.0    0.0     0.0    0.0\n  unstream/resize           Data.Text.Internal.Fusion                  11374           3    0.0    0.0     0.0    0.0\n CAF                        System.Random.MWC                           5842           0    0.0    0.0     0.0    0.0\n  coff                      System.Random.MWC                          11405           1    0.0    0.0     0.0    0.0\n  ioff                      System.Random.MWC                          11404           1    0.0    0.0     0.0    0.0\n  acquireSeedSystem         System.Random.MWC                          11398           1    0.0    0.0     0.0    0.0\n   acquireSeedSystem.random System.Random.MWC                          11402           1    0.0    0.0     0.0    0.0\n   acquireSeedSystem.nbytes System.Random.MWC                          11400           1    0.0    0.0     0.0    0.0\n  createSystemRandom        System.Random.MWC                          11394           1    0.0    0.0     0.0    0.0\n   withSystemRandom         System.Random.MWC                          11395           1    0.0    0.0     0.0    0.0\n CAF                        Data.Streaming.Network.Internal             5833           0    0.0    0.0     0.0    0.0\n CAF                        Data.Scientific                             5728           0    0.0    0.1     0.0    0.1\n CAF                        Data.Text.Array                             5722           0    0.0    0.0     0.0    0.0\n CAF                        Data.Text.Internal                          5718           0    0.0    0.0     0.0    0.0\n</code></pre>\n\n<p><strong>Edit 2015-06-01 08:40</strong></p>\n\n<p>You can browse source code at the following repository \u2192 <a href=\"https://github.com/Zigazou/Ouep\" rel=\"nofollow\">https://github.com/Zigazou/Ouep</a></p>\n"}, {"tags": ["haskell"], "answers": [{"comments": [{"owner": {"reputation": 3209, "user_id": 1276374, "user_type": "registered", "accept_rate": 48, "profile_image": "https://www.gravatar.com/avatar/7ce4a877cf573491b23fc6aa1bf18a1d?s=128&d=identicon&r=PG", "display_name": "Boris Mocialov", "link": "https://stackoverflow.com/users/1276374/boris-mocialov"}, "edited": false, "score": 0, "creation_date": 1433069283, "post_id": 30556389, "comment_id": 49184710, "body": "So, would it be possible then to do: <code>zipWith activations $! zipVectorWith (-) (weights &lt;&gt; prefixed) thresh</code> instead of line 93 ?"}, {"owner": {"reputation": 3209, "user_id": 1276374, "user_type": "registered", "accept_rate": 48, "profile_image": "https://www.gravatar.com/avatar/7ce4a877cf573491b23fc6aa1bf18a1d?s=128&d=identicon&r=PG", "display_name": "Boris Mocialov", "link": "https://stackoverflow.com/users/1276374/boris-mocialov"}, "edited": false, "score": 0, "creation_date": 1433071239, "post_id": 30556389, "comment_id": 49185210, "body": "I guess this makes sense. Tested <a href=\"https://gist.githubusercontent.com/rememmber/caf1401e60d7a99d48fa/raw/128b8780280bfd94f74baa1280c629fad0c6fb09/gistfile1.hs\" rel=\"nofollow noreferrer\">gist.githubusercontent.com/rememmber/caf1401e60d7a99d48fa/ra&zwnj;&#8203;w/&hellip;</a>"}, {"owner": {"reputation": 3209, "user_id": 1276374, "user_type": "registered", "accept_rate": 48, "profile_image": "https://www.gravatar.com/avatar/7ce4a877cf573491b23fc6aa1bf18a1d?s=128&d=identicon&r=PG", "display_name": "Boris Mocialov", "link": "https://stackoverflow.com/users/1276374/boris-mocialov"}, "edited": false, "score": 0, "creation_date": 1433071422, "post_id": 30556389, "comment_id": 49185271, "body": "BUT! <code>computeStep</code> in my opinion does not have ALL the data. Therefore list sizes would be different"}, {"owner": {"reputation": 44013, "user_id": 1477667, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/trgKM.jpg?s=128&g=1", "display_name": "dfeuer", "link": "https://stackoverflow.com/users/1477667/dfeuer"}, "edited": false, "score": 0, "creation_date": 1433130807, "post_id": 30556389, "comment_id": 49201734, "body": "Another option might be to use <code>StateT</code> to add the index counter."}], "tags": [], "owner": {"reputation": 178, "user_id": 4556658, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/176748782a450651ab1ef750943e5f35?s=128&d=identicon&r=PG&f=1", "display_name": "sdx23", "link": "https://stackoverflow.com/users/4556658/sdx23"}, "is_accepted": false, "score": 3, "last_activity_date": 1433068317, "creation_date": 1433068317, "answer_id": 30556389, "question_id": 30541807, "link": "https://stackoverflow.com/questions/30541807/mapping-function-from-list-to-data/30556389#30556389", "title": "mapping function from list to data", "body": "<p>For the map you may want something like</p>\n\n<pre><code>as = [(+1),(*2),(+(-3))]\nxs = [4,5,6]\nmain = print $ zipWith ($) as xs\n</code></pre>\n\n<p>The fold is more complicated but can be done with using the same idea: Zip the inputs with according activation functions and change the function-folded-over to use the values of the incoming tuples.</p>\n\n<p>However, I doubt you really need/want to change the fold. If I'm not mistaken the fold should just pass on the activation-functions list. So there's actually nothing to do.</p>\n"}], "owner": {"reputation": 3209, "user_id": 1276374, "user_type": "registered", "accept_rate": 48, "profile_image": "https://www.gravatar.com/avatar/7ce4a877cf573491b23fc6aa1bf18a1d?s=128&d=identicon&r=PG", "display_name": "Boris Mocialov", "link": "https://stackoverflow.com/users/1276374/boris-mocialov"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 386, "favorite_count": 0, "answer_count": 1, "score": 12, "last_activity_date": 1433847091, "creation_date": 1432955202, "last_edit_date": 1433200368, "question_id": 30541807, "link": "https://stackoverflow.com/questions/30541807/mapping-function-from-list-to-data", "title": "mapping function from list to data", "body": "<p>I am looking at changing the <a href=\"https://github.com/alpmestan/hnn\">hnn package</a> to support different activation functions for every node in a network. </p>\n\n<p>In particular, <a href=\"https://github.com/alpmestan/hnn/blob/master/AI/HNN/Recurrent/Network.hs#L108\">this line</a> and <a href=\"https://github.com/alpmestan/hnn/blob/master/AI/HNN/Recurrent/Network.hs#L93\">this line</a> use specific function (activation), but I am trying to extended that to support something like:</p>\n\n<pre><code>evalNet n@(Network{..}) inputs activations = do\n    s &lt;- foldM (\\x -&gt; computeStepM n x (activations!!N)) state inputsV\n</code></pre>\n\n<p>where <code>N</code> is the node id/index. </p>\n\n<p>Currently I am a stage where I have my list of activation functions of the same length as amount of nodes in the network.</p>\n\n<p>I need help (as I am lost in the package source code) to find a way to apply <code>Nth</code> <code>activations</code> function from the list.</p>\n\n<p>EDIT: I have tried <code>StateT</code> approach using <code>tick</code> (from documentation) and using <code>zip</code> function, both give multiple executions per every step, so the final result becomes wrong</p>\n"}, {"tags": ["haskell", "io-monad"], "comments": [{"owner": {"reputation": 100185, "user_id": 3234959, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/93bb12ca0f93dfddb33880316f7e66c2?s=128&d=identicon&r=PG&f=1", "display_name": "chi", "link": "https://stackoverflow.com/users/3234959/chi"}, "edited": false, "score": 1, "creation_date": 1432970592, "post_id": 30541686, "comment_id": 49159814, "body": "The &quot;general solution&quot; example looks like unrelated lists, and is confusing. Shouldn&#39;t those list be the tails of <code>[10,80,90,82,28]</code> ?"}], "answers": [{"comments": [{"owner": {"reputation": 489, "user_id": 3780993, "user_type": "registered", "accept_rate": 62, "profile_image": "https://www.gravatar.com/avatar/a9ad160badab2c6f405426f4e2a281fe?s=128&d=identicon&r=PG&f=1", "display_name": "ragesalmon", "link": "https://stackoverflow.com/users/3780993/ragesalmon"}, "edited": false, "score": 0, "creation_date": 1432955893, "post_id": 30541764, "comment_id": 49156897, "body": "This worked! If no one comments soon with a solution that does not require a function definition, I&#39;ll accept this."}], "tags": [], "owner": {"reputation": 314794, "user_id": 67579, "user_type": "registered", "accept_rate": 81, "profile_image": "https://i.stack.imgur.com/BJXub.png?s=128&g=1", "display_name": "Willem Van Onsem", "link": "https://stackoverflow.com/users/67579/willem-van-onsem"}, "is_accepted": true, "score": 6, "last_activity_date": 1432979211, "last_edit_date": 1432979211, "creation_date": 1432954801, "answer_id": 30541764, "question_id": 30541686, "link": "https://stackoverflow.com/questions/30541686/iterate-over-a-list-until-the-resulting-list-is-an-empty-list/30541764#30541764", "title": "Iterate over a list until the resulting list is an empty list", "body": "<p>What about exploiting the IO monad:</p>\n\n<pre><code>func [_] = return ()\nfunc (_:xs) = print xs &gt;&gt; func xs\n</code></pre>\n\n<p>When one calls this it results in:</p>\n\n<pre><code>*Main&gt; func [1, 8, 90, 100, 82]\n[8,90,100,82]\n[90,100,82]\n[100,82]\n[82]\n</code></pre>\n\n<p>As you can read <a href=\"https://wiki.haskell.org/IO_inside\" rel=\"nofollow\">here</a>, the <code>return</code> can be seen as the \"no operation\" operation and the binding operator<code>&gt;&gt;</code> can be seen as <em>perform the first operation before the second operation</em>.</p>\n"}, {"comments": [{"owner": {"reputation": 489, "user_id": 3780993, "user_type": "registered", "accept_rate": 62, "profile_image": "https://www.gravatar.com/avatar/a9ad160badab2c6f405426f4e2a281fe?s=128&d=identicon&r=PG&f=1", "display_name": "ragesalmon", "link": "https://stackoverflow.com/users/3780993/ragesalmon"}, "edited": false, "score": 0, "creation_date": 1432955137, "post_id": 30541765, "comment_id": 49156758, "body": "Sorry, I should have specified that I am looking for a more general solution, one that I could use a variety of functions for. I&#39;ll amend the original question"}, {"owner": {"reputation": 100185, "user_id": 3234959, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/93bb12ca0f93dfddb33880316f7e66c2?s=128&d=identicon&r=PG&f=1", "display_name": "chi", "link": "https://stackoverflow.com/users/3234959/chi"}, "reply_to_user": {"reputation": 489, "user_id": 3780993, "user_type": "registered", "accept_rate": 62, "profile_image": "https://www.gravatar.com/avatar/a9ad160badab2c6f405426f4e2a281fe?s=128&d=identicon&r=PG&f=1", "display_name": "ragesalmon", "link": "https://stackoverflow.com/users/3780993/ragesalmon"}, "edited": false, "score": 1, "creation_date": 1432970767, "post_id": 30541765, "comment_id": 49159859, "body": "@ragesalmon Turning this into a function which takes a list parameter is trivial. E.g. <code>foo list = mapM_ print . init . tails $ tail list</code>."}, {"owner": {"reputation": 26541, "user_id": 1532460, "user_type": "registered", "accept_rate": 88, "profile_image": "https://www.gravatar.com/avatar/dc5b338bf194a9e117af20bd9b2e4edb?s=128&d=identicon&r=PG", "display_name": "awesoon", "link": "https://stackoverflow.com/users/1532460/awesoon"}, "reply_to_user": {"reputation": 489, "user_id": 3780993, "user_type": "registered", "accept_rate": 62, "profile_image": "https://www.gravatar.com/avatar/a9ad160badab2c6f405426f4e2a281fe?s=128&d=identicon&r=PG&f=1", "display_name": "ragesalmon", "link": "https://stackoverflow.com/users/3780993/ragesalmon"}, "edited": false, "score": 1, "creation_date": 1432979055, "post_id": 30541765, "comment_id": 49161885, "body": "@ragesalmon, sorry for late comment. Of course, it is possible to extract this code into separate functions. Please, take a look at the update."}], "tags": [], "owner": {"reputation": 26541, "user_id": 1532460, "user_type": "registered", "accept_rate": 88, "profile_image": "https://www.gravatar.com/avatar/dc5b338bf194a9e117af20bd9b2e4edb?s=128&d=identicon&r=PG", "display_name": "awesoon", "link": "https://stackoverflow.com/users/1532460/awesoon"}, "is_accepted": false, "score": 6, "last_activity_date": 1432979002, "last_edit_date": 1432979002, "creation_date": 1432954809, "answer_id": 30541765, "question_id": 30541686, "link": "https://stackoverflow.com/questions/30541686/iterate-over-a-list-until-the-resulting-list-is-an-empty-list/30541765#30541765", "title": "Iterate over a list until the resulting list is an empty list", "body": "<p>You could use <code>mapM_</code> function to apply <code>print</code> for each element in the list. There is function <code>tails</code>, returns all final segments of the argument (however, it also returns empty list as last element, so, you could combine it with <code>init</code> function). Finally, you could skip first element, if you do not want to print it, use function <code>tail</code>:</p>\n\n<pre><code>import Data.List\n\nmain :: IO ()\nmain = mapM_ print . init . tails $ tail [1, 8, 90, 100, 82]\n</code></pre>\n\n<p>Prints:</p>\n\n<pre><code>[8,90,100,82]\n[90,100,82]\n[100,82]\n[82]\n</code></pre>\n\n<p>Of course, it is possible to solve your problem using separate functions. Note, that I add two more functions to make code more readable and reusable:</p>\n\n<pre><code>import Data.List\n\ntailsExceptOriginalAndEmpty :: [a] -&gt; [[a]]\ntailsExceptOriginalAndEmpty = init . tails . tail\n\nprintListofLists :: (Show a) =&gt; [[a]] -&gt; IO ()\nprintListofLists = mapM_ print\n\nprintTailsExceptOriginalAndEmpty :: (Show a) =&gt; [a] -&gt; IO ()\nprintTailsExceptOriginalAndEmpty = printListofLists . tailsExceptOriginalAndEmpty\n\nmain :: IO ()\nmain = printTailsExceptOriginalAndEmpty [1, 8, 90, 100, 82]\n</code></pre>\n\n<p>Note also, that you should handle case with empty input list. In the current implementation it will raise an error.</p>\n"}], "owner": {"reputation": 489, "user_id": 3780993, "user_type": "registered", "accept_rate": 62, "profile_image": "https://www.gravatar.com/avatar/a9ad160badab2c6f405426f4e2a281fe?s=128&d=identicon&r=PG&f=1", "display_name": "ragesalmon", "link": "https://stackoverflow.com/users/3780993/ragesalmon"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 611, "favorite_count": 0, "accepted_answer_id": 30541764, "answer_count": 2, "score": 2, "last_activity_date": 1433013433, "creation_date": 1432953829, "last_edit_date": 1433013433, "question_id": 30541686, "link": "https://stackoverflow.com/questions/30541686/iterate-over-a-list-until-the-resulting-list-is-an-empty-list", "title": "Iterate over a list until the resulting list is an empty list", "body": "<p>I'm trying to see if I can do something like this:</p>\n\n<p>Say I have a list: [1, 8, 90, 100, 82]</p>\n\n<p>Now, what I would like to do is something like this</p>\n\n<pre><code>print [8, 90, 100, 82]\nprint [90, 100, 82]\nprint [100, 82]\nprint [82]\n</code></pre>\n\n<p>So basically, I would like to print the remainder of the list until I get an empty list, and then stop. Is there some way I can do this in Haskell?</p>\n\n<p>EDIT: I'm looking for a more general solution. For example, I'd also like to be able to produce this:</p>\n\n<p>list [10, 80, 90, 82, 28]</p>\n\n<pre><code> [70, 80, 72, 18]\n [52, 62, 54]\n [10, 2]\n [8]\n</code></pre>\n"}, {"tags": ["haskell", "coding-style", "naming-conventions"], "answers": [{"tags": [], "owner": {"reputation": 24211, "user_id": 1364288, "user_type": "registered", "accept_rate": 88, "profile_image": "https://i.stack.imgur.com/JVtNl.png?s=128&g=1", "display_name": "danidiaz", "link": "https://stackoverflow.com/users/1364288/danidiaz"}, "is_accepted": false, "score": 4, "last_activity_date": 1432949846, "creation_date": 1432949846, "answer_id": 30541328, "question_id": 30540991, "link": "https://stackoverflow.com/questions/30540991/naming-conflict-between-field-values-and-local-scope-in-haskell/30541328#30541328", "title": "Naming conflict between field values and local scope in Haskell", "body": "<p>The <a href=\"https://downloads.haskell.org/~ghc/7.8.4/docs/html/users_guide/syntax-extns.html\" rel=\"nofollow\"><code>NamedFieldPuns</code></a> extension can help with this. When pattern-matching on a record, it binds a variable with the same name as a record field:</p>\n\n<pre><code>{-# LANGUAGE NamedFieldPuns #-}\n\nbaz :: (MonadState Qaax m) =&gt; m ()\nbaz = do\n  Qaax {foo} &lt;- get\n  return ()\n</code></pre>\n\n<p>One possible problem is that the accessor is shadowed for the rest of the <code>do</code> block.</p>\n"}, {"tags": [], "owner": {"reputation": 56659, "user_id": 450128, "user_type": "registered", "accept_rate": 62, "profile_image": "https://www.gravatar.com/avatar/2f72b3fdc99fe9fd1bbeb2f9da1d2c0a?s=128&d=identicon&r=PG", "display_name": "Ben", "link": "https://stackoverflow.com/users/450128/ben"}, "is_accepted": true, "score": 3, "last_activity_date": 1432950586, "creation_date": 1432950586, "answer_id": 30541391, "question_id": 30540991, "link": "https://stackoverflow.com/questions/30540991/naming-conflict-between-field-values-and-local-scope-in-haskell/30541391#30541391", "title": "Naming conflict between field values and local scope in Haskell", "body": "<p>Adding ' as a suffix is an established convention for forming distinct-but-related names. A key example is <code>foldl</code> and <code>foldl'</code>.</p>\n\n<p>In exported names like <code>foldl'</code> it's usually a good idea to come up with a consistent theme for what the ' means for your library (often it's \"stricter version of\", as in <code>foldl'</code>). But in local names you can be a lot freer to just use it \"another closely related thing I would like to have the same name as\".</p>\n\n<p>The downside is that it's not <em>very</em> distinct, so it can hurt readability; especially if you need to commonly refer to both versions. And when you find yourself needing <code>foo'''</code> you should probably think about a different naming scheme!</p>\n"}], "owner": {"reputation": 25321, "user_id": 163177, "user_type": "registered", "accept_rate": 86, "profile_image": "https://www.gravatar.com/avatar/e811b5337bcad19d52c8fed3a0ea0075?s=128&d=identicon&r=PG", "display_name": "John F. Miller", "link": "https://stackoverflow.com/users/163177/john-f-miller"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 113, "favorite_count": 1, "accepted_answer_id": 30541391, "answer_count": 2, "score": 5, "last_activity_date": 1432950586, "creation_date": 1432946017, "question_id": 30540991, "link": "https://stackoverflow.com/questions/30540991/naming-conflict-between-field-values-and-local-scope-in-haskell", "title": "Naming conflict between field values and local scope in Haskell", "body": "<p>This is a coding style question rather then a technical one.</p>\n\n<p>I have frequently encountered a problem where I use haskell's (less then optimal) record syntax (or lenses, the problem ends up the same) to create a <code>data</code> type.  I end up with field accessor functions named after my fields.  Being a conscientious programmer, I try to make my record field names meaningful.</p>\n\n<p>At some point later I need to get a field out of my type and keep its value in a local variable.  This is often done within a StateMonad in a <code>do</code> block.  The question is what do I call the local variable.  The most obvious name is already taken as the field accessor.  I find my self using abbreviations which tends to make my code less readable.</p>\n\n<p>Is there a Haskell coding convention that addresses this issue?</p>\n\n<p><strong>Example</strong></p>\n\n<pre><code>data Qaax = Qaax {\n      foo :: SomeFoo\n    , bar :: SomeBar\n    , ...\n    }\n\nbaz :: (MonadState Qaax m) =&gt; (...) -&gt; m ()\nbaz (...) = do\n  f &lt;- gets foo -- I'd really like to use something more descriptive then\n                -- `f` but `foo` is already taken.\n  ...\n  return ()\n</code></pre>\n"}, {"tags": ["c", "haskell", "code-generation", "ffi"], "comments": [{"owner": {"user_type": "does_not_exist", "display_name": "user4842163"}, "edited": false, "score": 0, "creation_date": 1432946967, "post_id": 30540933, "comment_id": 49155321, "body": "From what I can tell, that whole FFI is based around compile-time C code generation. Basically it&#39;s just making your Haskell code generate C code that is directly callable from C, so you inevitably have to use that older C code generator. You might have better luck if you want to avoid this to build a shared library with native Haskell that you communicate with from your C Python extension module, then import the Python extension module. So Python talks to a C dylib which talks to your Haskell dylib."}, {"owner": {"reputation": 62908, "user_id": 567620, "user_type": "registered", "accept_rate": 72, "profile_image": "https://i.stack.imgur.com/g8HIM.jpg?s=128&g=1", "display_name": "ely", "link": "https://stackoverflow.com/users/567620/ely"}, "edited": false, "score": 0, "creation_date": 1432947088, "post_id": 30540933, "comment_id": 49155349, "body": "If I understand your comment correctly, I believe that is already what I am trying to do. But the question is how to compile-then-include-and-use the Haskell code in the C code that will just wrap it and be compiled to a dynamic library for purposes of existing as a Python extension."}, {"owner": {"reputation": 62908, "user_id": 567620, "user_type": "registered", "accept_rate": 72, "profile_image": "https://i.stack.imgur.com/g8HIM.jpg?s=128&g=1", "display_name": "ely", "link": "https://stackoverflow.com/users/567620/ely"}, "edited": false, "score": 0, "creation_date": 1432947181, "post_id": 30540933, "comment_id": 49155377, "body": "In other words, what compilation steps are recommended to treat the source Haskell code that uses Foreign.C.Types? From that Wiki page I thought it was precisely this step of using <code>-C</code> to get C code (then I would make that C code a library rather than an executable as the Wiki example does), and then whatever else you want to do with it (Python stuff in my case)."}, {"owner": {"user_type": "does_not_exist", "display_name": "user4842163"}, "edited": false, "score": 0, "creation_date": 1432947236, "post_id": 30540933, "comment_id": 49155384, "body": "It&#39;s a bit different from what I can tell. That Haskell FFI seems to generate C code (header and source) along with object code to statically link to your C project. The shared library solution would have you create a Haskell dylib (aka shared library) as an independent project from your C project (so you don&#39;t need C code generation). The C project would then do symbol lookups into your Haskell dylib, dynamically linking to it at runtime and getting function pointers out of it, and call functions that way."}, {"owner": {"user_type": "does_not_exist", "display_name": "user4842163"}, "edited": false, "score": 0, "creation_date": 1432947460, "post_id": 30540933, "comment_id": 49155427, "body": "It&#39;s a bit more manual on the C side if you build Haskell shared libraries (dylibs/DLLs) this way as you&#39;ll have to write more code there to load your Haskell library, lookup symbols from it, and fetch function pointers out, and requires you to distribute an additional binary file with your software, but I think it&#39;ll give you much more peace of mind that trying to use that C-code-generating FFI. <a href=\"https://www.haskell.org/platform/doc/2014.2.0.0/ghc/users_guide/using-shared-libs.html\" rel=\"nofollow noreferrer\">haskell.org/platform/doc/2014.2.0.0/ghc/users_guide/&hellip;</a>"}, {"owner": {"reputation": 62908, "user_id": 567620, "user_type": "registered", "accept_rate": 72, "profile_image": "https://i.stack.imgur.com/g8HIM.jpg?s=128&g=1", "display_name": "ely", "link": "https://stackoverflow.com/users/567620/ely"}, "edited": false, "score": 0, "creation_date": 1432947460, "post_id": 30540933, "comment_id": 49155428, "body": "I see, you are suggesting something <a href=\"http://www.vex.net/~trebla/haskell/so.xhtml\" rel=\"nofollow noreferrer\">like this</a>. I&#39;ll certainly give it a look."}, {"owner": {"user_type": "does_not_exist", "display_name": "user4842163"}, "edited": false, "score": 0, "creation_date": 1432947783, "post_id": 30540933, "comment_id": 49155478, "body": "Yes, very much so. I&#39;m coming at this more from a C side, but that FFI seems more like a neat trick exploiting a legacy artifact of GHC that originally generated C code (not uncommon when building compilers to lean on another language this way, but generally not as efficient as skipping the middle man). So you have to marry that old C code generator if you use this FFI. With shared libraries, you have a much wider range of build options, and you can keep your Haskell project more separate/independent from the C Python module (both good and bad, but probably overall better for your case)."}, {"owner": {"reputation": 62908, "user_id": 567620, "user_type": "registered", "accept_rate": 72, "profile_image": "https://i.stack.imgur.com/g8HIM.jpg?s=128&g=1", "display_name": "ely", "link": "https://stackoverflow.com/users/567620/ely"}, "edited": false, "score": 0, "creation_date": 1433017435, "post_id": 30540933, "comment_id": 49173968, "body": "@Ike If interested, I wrote up a post about my experience following your idea and the tutorial I linked yesterday. <a href=\"http://suitdummy.blogspot.com/2015/05/invoke-haskell-functions-from-python.html\" rel=\"nofollow noreferrer\">Here&#39;s the post</a>."}, {"owner": {"user_type": "does_not_exist", "display_name": "user4842163"}, "edited": false, "score": 0, "creation_date": 1433021482, "post_id": 30540933, "comment_id": 49175085, "body": "Looks nice! One thing that might be interesting is that you might be able to potentially skip the C module middle man by actually using a <i>dynamic</i> FFI on the Python side which can use your Haskell shared libraries directly: <a href=\"http://eli.thegreenplace.net/2013/03/09/python-ffi-with-ctypes-and-cffi\" rel=\"nofollow noreferrer\">eli.thegreenplace.net/2013/03/09/&hellip;</a>"}, {"owner": {"reputation": 62908, "user_id": 567620, "user_type": "registered", "accept_rate": 72, "profile_image": "https://i.stack.imgur.com/g8HIM.jpg?s=128&g=1", "display_name": "ely", "link": "https://stackoverflow.com/users/567620/ely"}, "edited": false, "score": 0, "creation_date": 1433025881, "post_id": 30540933, "comment_id": 49176242, "body": "You are right that the middle C module is skippable, but not for that reason (since all of the modules I built were dynamic). I did update the post to reflect just using Cython directly on the Haskell shared library, which is nice. I think it is useful to think of it in terms of that intermediate C module that wraps haskell functions, though. Mainly this is because any non-trivial Haskell functions will eventually require you to deal with the Haskell API and you can&#39;t do that directly with Cython. So in such a case, you could write C wrappers that marshal Haskell, then use Cython on that."}, {"owner": {"reputation": 62908, "user_id": 567620, "user_type": "registered", "accept_rate": 72, "profile_image": "https://i.stack.imgur.com/g8HIM.jpg?s=128&g=1", "display_name": "ely", "link": "https://stackoverflow.com/users/567620/ely"}, "edited": false, "score": 0, "creation_date": 1433025979, "post_id": 30540933, "comment_id": 49176265, "body": "The <code>cffi</code> suggestion is great though. I did show an example in my post about why a simple use of <code>ctypes</code> is not a safe idea, but perhaps <code>cffi</code> takes care of exactly this sort of thing. Anyway, I&#39;m very glad I worked through this from scratch. Thank you again for the help."}, {"owner": {"user_type": "does_not_exist", "display_name": "user4842163"}, "edited": false, "score": 0, "creation_date": 1433028110, "post_id": 30540933, "comment_id": 49176750, "body": "NP -- what I meant is that this <code>cffi</code> will do that work of dynamically linking to your Haskell lib for you. ATM the C Python module would dynamically link to Haskell, and Python would dynamically link to the C module (Python-&gt;C-&gt;Haskell). Without that cffi, Python can only recognize dylib exports that match exactly what it wants, and unfortunately there&#39;s no Haskell Python lib (to my knowledge) that allows you to export what Python natively wants from a shared lib. So unfortunately we would normally have to export the symbols Python wants from C..."}, {"owner": {"user_type": "does_not_exist", "display_name": "user4842163"}, "edited": false, "score": 0, "creation_date": 1433028160, "post_id": 30540933, "comment_id": 49176761, "body": "With that cffi, you can make Python recognize any dylib-exported functions, not just the ones in the exact form it wants, and can then go straight from Python-&gt;Haskell shared lib. On the upside, that C middle man serves as kind of a proxy to wrap things into something a bit more Python-friendly. The <code>cffi</code> would allow Python to call functions straight from a dylib (in any form, not just Python API form), and would lose the safety and Pythonesque goodies (unless you add it back on top from Python)."}, {"owner": {"user_type": "does_not_exist", "display_name": "user4842163"}, "edited": false, "score": 0, "creation_date": 1433028646, "post_id": 30540933, "comment_id": 49176871, "body": "Oh, I think I understand now -- sorry, the way I said it was confusing. Before you had Haskell-&gt;C as a statically-linked process, forcing you to compile Haskell into C.  We eliminated that need with a shared lib. But we still have a C middleman, just as a separate dylib we don&#39;t have to bother with when building our now-independent Haskell dylib. But we can take that C project out of the picture completely using Python&#39;s cffi, and then you can focus on only working in Haskell and Python as your languages."}, {"owner": {"reputation": 14485, "user_id": 190376, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/cd8280c5e1491b8cf55760750ed97dec?s=128&d=identicon&r=PG", "display_name": "Reid Barton", "link": "https://stackoverflow.com/users/190376/reid-barton"}, "edited": false, "score": 0, "creation_date": 1433260442, "post_id": 30540933, "comment_id": 49270189, "body": "Have you tried just running the commands exactly as they are on that wiki page, with your presumably registerised compiler?"}, {"owner": {"reputation": 62908, "user_id": 567620, "user_type": "registered", "accept_rate": 72, "profile_image": "https://i.stack.imgur.com/g8HIM.jpg?s=128&g=1", "display_name": "ely", "link": "https://stackoverflow.com/users/567620/ely"}, "edited": false, "score": 0, "creation_date": 1433260659, "post_id": 30540933, "comment_id": 49270342, "body": "Yes, if you use &quot;-c&quot; it merely generates the object file, not the C files as needed nor as claimed. In my case, I need the C source files, not just the object files (although I did enjoy learning from the workaround of compiling to a shared library, then possibly including from that library in a separate C file that uses the HsFFI.h API, and <i>then</i> wrapping that with Cython)."}, {"owner": {"reputation": 62908, "user_id": 567620, "user_type": "registered", "accept_rate": 72, "profile_image": "https://i.stack.imgur.com/g8HIM.jpg?s=128&g=1", "display_name": "ely", "link": "https://stackoverflow.com/users/567620/ely"}, "edited": false, "score": 0, "creation_date": 1433260812, "post_id": 30540933, "comment_id": 49270468, "body": "Either of two things could fix that wiki article: (1) explaining that you need the unregisterised compiler and the -C option, or (2) explaining that you shouldn&#39;t expect (or need, for that article&#39;s sake) the .c file and to just use the object file."}, {"owner": {"reputation": 14485, "user_id": 190376, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/cd8280c5e1491b8cf55760750ed97dec?s=128&d=identicon&r=PG", "display_name": "Reid Barton", "link": "https://stackoverflow.com/users/190376/reid-barton"}, "edited": false, "score": 0, "creation_date": 1433262372, "post_id": 30540933, "comment_id": 49271412, "body": "I don&#39;t know why you need a .c file... normally the fate of a .c file is to be provided as input to a C compiler; and the C compiler will be just as happy to accept an already-compiled .o file. If Cython won&#39;t let you link to a .o file and insists that you provide a .c file plus a shared library, that sounds more like a limitation of Cython. Agreed that the wiki page is inaccurate, but the answer to your titular question is &quot;no&quot; as I described in my answer; there is no unregisterised mode requirement in normal cases."}, {"owner": {"reputation": 62908, "user_id": 567620, "user_type": "registered", "accept_rate": 72, "profile_image": "https://i.stack.imgur.com/g8HIM.jpg?s=128&g=1", "display_name": "ely", "link": "https://stackoverflow.com/users/567620/ely"}, "edited": false, "score": 0, "creation_date": 1433262515, "post_id": 30540933, "comment_id": 49271504, "body": "Cython is happy to let you link to the .o file. The problem is that you need to provide declarations for the functions you wish to use (from either .o or .so) in Cython (actually, this is a <i>benefit</i> of Cython). So if you wanted to invoke Haskell functions that did not <i>have to</i> be limited to Foreign.C.Types for their input and output args, then with only the .o or .so file, you need to have an annoying intermediate C file you write yourself that does whatever marshaling you want for the types. If you can get Haskell to give you the C file, though, you can just start directly in Cython."}, {"owner": {"reputation": 14485, "user_id": 190376, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/cd8280c5e1491b8cf55760750ed97dec?s=128&d=identicon&r=PG", "display_name": "Reid Barton", "link": "https://stackoverflow.com/users/190376/reid-barton"}, "edited": false, "score": 0, "creation_date": 1433262674, "post_id": 30540933, "comment_id": 49271598, "body": "Declarations are in the <code>_stub.h</code> file."}, {"owner": {"reputation": 62908, "user_id": 567620, "user_type": "registered", "accept_rate": 72, "profile_image": "https://i.stack.imgur.com/g8HIM.jpg?s=128&g=1", "display_name": "ely", "link": "https://stackoverflow.com/users/567620/ely"}, "edited": false, "score": 0, "creation_date": 1433262739, "post_id": 30540933, "comment_id": 49271637, "body": "Yes, but this too doesn&#39;t get created if you use <code>-c</code>. Instead, it appears to create a <code>.hi</code> file, which as far as I could tell is sort of like a header file, but intended for other Haskell consumers of the compiled code."}, {"owner": {"reputation": 14485, "user_id": 190376, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/cd8280c5e1491b8cf55760750ed97dec?s=128&d=identicon&r=PG", "display_name": "Reid Barton", "link": "https://stackoverflow.com/users/190376/reid-barton"}, "edited": false, "score": 0, "creation_date": 1433262893, "post_id": 30540933, "comment_id": 49271728, "body": "Yes, it does get created, did you try it?"}, {"owner": {"reputation": 62908, "user_id": 567620, "user_type": "registered", "accept_rate": 72, "profile_image": "https://i.stack.imgur.com/g8HIM.jpg?s=128&g=1", "display_name": "ely", "link": "https://stackoverflow.com/users/567620/ely"}, "edited": false, "score": 0, "creation_date": 1433262976, "post_id": 30540933, "comment_id": 49271787, "body": "Yes, for example, right now I typed <code>main = putStrLn &quot;hello&quot;</code> into a file named <code>foo.hs</code> and then typed <code>ghc -c foo.hs</code> and it creates for me <code>foo.hi</code> and <code>foo.o</code> and nothing else."}, {"owner": {"reputation": 14485, "user_id": 190376, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/cd8280c5e1491b8cf55760750ed97dec?s=128&d=identicon&r=PG", "display_name": "Reid Barton", "link": "https://stackoverflow.com/users/190376/reid-barton"}, "edited": false, "score": 0, "creation_date": 1433263023, "post_id": 30540933, "comment_id": 49271817, "body": "That&#39;s because there were no foreign export declarations in your Haskell source..."}, {"owner": {"reputation": 62908, "user_id": 567620, "user_type": "registered", "accept_rate": 72, "profile_image": "https://i.stack.imgur.com/g8HIM.jpg?s=128&g=1", "display_name": "ely", "link": "https://stackoverflow.com/users/567620/ely"}, "edited": false, "score": 0, "creation_date": 1433263081, "post_id": 30540933, "comment_id": 49271858, "body": "Ugh. Even when I did it for my source file that was just copied from the linked wiki page, it was the same (and that did have a foreign export). Just <code>.hi</code> and no other header-like files."}, {"owner": {"reputation": 62908, "user_id": 567620, "user_type": "registered", "accept_rate": 72, "profile_image": "https://i.stack.imgur.com/g8HIM.jpg?s=128&g=1", "display_name": "ely", "link": "https://stackoverflow.com/users/567620/ely"}, "edited": false, "score": 0, "creation_date": 1433263506, "post_id": 30540933, "comment_id": 49272101, "body": "Also, reading about the output into the .h file, it looks a little wonky to me. For example, it looks like if you declared a function of type <code>:: CInt -&gt; Cint</code>, the generated header would say actually it is <code>HsInt32</code>. I think that&#39;s a simple typedef, so likely not too hard to deal with. But for anything that has a Haskell type not directly amenable to a Python foreign C type, you now can&#39;t deal with it straight in Cython. You&#39;d need to create a C file, let the C file include from the Haskell library, and wrap the Haskell type so it can be accessed in Python."}, {"owner": {"reputation": 62908, "user_id": 567620, "user_type": "registered", "accept_rate": 72, "profile_image": "https://i.stack.imgur.com/g8HIM.jpg?s=128&g=1", "display_name": "ely", "link": "https://stackoverflow.com/users/567620/ely"}, "edited": false, "score": 0, "creation_date": 1433263580, "post_id": 30540933, "comment_id": 49272141, "body": "One thing I plan to explore though is what the workflow is like if you do Cython <code>cdef extern from &quot;HsFFI.h&quot;</code> and try to define a Python analogue for all of that. It&#39;s probably an extremely large and involved project, but could be interesting."}, {"owner": {"reputation": 14485, "user_id": 190376, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/cd8280c5e1491b8cf55760750ed97dec?s=128&d=identicon&r=PG", "display_name": "Reid Barton", "link": "https://stackoverflow.com/users/190376/reid-barton"}, "edited": false, "score": 0, "creation_date": 1433263591, "post_id": 30540933, "comment_id": 49272145, "body": "Try again I guess. It does generate the <code>Safe_stub.h</code> file for me (using the example and command copied from the wiki page), and it certainly is supposed to generate it, if it doesn&#39;t that&#39;s a bug."}, {"owner": {"reputation": 14485, "user_id": 190376, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/cd8280c5e1491b8cf55760750ed97dec?s=128&d=identicon&r=PG", "display_name": "Reid Barton", "link": "https://stackoverflow.com/users/190376/reid-barton"}, "edited": false, "score": 0, "creation_date": 1433263793, "post_id": 30540933, "comment_id": 49272281, "body": "Even if you do have to do some C-side marshalling to match up Haskell&#39;s ideas of C&#39;s types with Python&#39;s ideas of C&#39;s types, you wouldn&#39;t be any better off if you had C source for the <code>.o</code> file, which would be full of even more Haskell-specific types."}], "answers": [{"comments": [{"owner": {"reputation": 62908, "user_id": 567620, "user_type": "registered", "accept_rate": 72, "profile_image": "https://i.stack.imgur.com/g8HIM.jpg?s=128&g=1", "display_name": "ely", "link": "https://stackoverflow.com/users/567620/ely"}, "edited": false, "score": 0, "creation_date": 1432989536, "post_id": 30541951, "comment_id": 49164960, "body": "I don&#39;t think you read the wiki article very closely. For example, when I say that the <code>-c</code> option is a typo, what I mean is that the wiki article claims that with <code>-c</code> you will have a <code>.c</code> file, a <code>.h</code> file, and a <code>.o</code> file generated, such that you can use the functions available in the <code>.c</code> and <code>.h</code>files as I am describing. But this is false. The <code>-c</code> option does not produce these, and crucially it is exactly these <code>.c</code> and <code>.h</code> files needed in order to do the steps in the wiki, <i>not</i> the object file, which doesn&#39;t help -- so it has to be a typo."}, {"owner": {"reputation": 14485, "user_id": 190376, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/cd8280c5e1491b8cf55760750ed97dec?s=128&d=identicon&r=PG", "display_name": "Reid Barton", "link": "https://stackoverflow.com/users/190376/reid-barton"}, "reply_to_user": {"reputation": 62908, "user_id": 567620, "user_type": "registered", "accept_rate": 72, "profile_image": "https://i.stack.imgur.com/g8HIM.jpg?s=128&g=1", "display_name": "ely", "link": "https://stackoverflow.com/users/567620/ely"}, "edited": false, "score": 0, "creation_date": 1433036356, "post_id": 30541951, "comment_id": 49178242, "body": "That wiki page is partly out of date. There is no <code>_stub.c</code> file any more, you just link with the <code>.o</code> file. Note that the subsequent steps on the wiki already do not refer to the <code>_stub.c</code> file."}], "tags": [], "owner": {"reputation": 14485, "user_id": 190376, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/cd8280c5e1491b8cf55760750ed97dec?s=128&d=identicon&r=PG", "display_name": "Reid Barton", "link": "https://stackoverflow.com/users/190376/reid-barton"}, "is_accepted": false, "score": -1, "last_activity_date": 1432957720, "last_edit_date": 1592644375, "creation_date": 1432956722, "answer_id": 30541951, "question_id": 30540933, "link": "https://stackoverflow.com/questions/30540933/does-unregisterised-mode-requirement-prevent-haskells-basic-ffi-examples-in-nor/30541951#30541951", "title": "Does unregisterised mode requirement prevent Haskell&#39;s basic FFI examples in normal cases?", "body": "<p>You do not need an unregisterised GHC to export Haskell functions to C as described on that Wiki page. There are many specific questions here, so I'll answer them one by one.</p>\n<blockquote>\n<p>From the Haskell Wiki page about calling Haskell function from C, there is a nice short example that I am trying to reproduce, which boils down to compiling some Haskell code that uses the C FFI with command line options such as:</p>\n<pre><code> ghc -c -O Safe.hs\n</code></pre>\n<p>One point of note is that in the Haskell Wiki page, the compiler option used is actually -c (lower case) and this does not generate the intermediate C code, so it is likely a typo.</p>\n</blockquote>\n<p>It's not a typo. <code>-c</code> means &quot;compile to an object (<code>.o</code>) file&quot;, as opposed to the default of &quot;compile to an executable&quot;. (The option name matches the name of the same option in C compilers, which is why it makes no particular sense.)</p>\n<blockquote>\n<p>However, as I discovered when trying to compile with the -C option (the option that is documented as emitting intermediate C code), this is unavailable unless you build GHC in &quot;unregisterised mode&quot; which essentially drops GHC's native code generator and leaves only a very basic C code generator (what is used for these FFI examples) and the more highly optimized LLVM-based code generator.</p>\n<p>In fact, from some documentation about GHC, it suggests that you can only use the -C option in unregisterised mode.</p>\n<p>Is it true that you must build GHC in unregisterised mode in order to generate intermediate C code (via the -C option)?</p>\n</blockquote>\n<p>Yes, because only an unregisterised compiler compiles via intermediate C code at all. The GHC calling convention (with various global variables pinned to registers) that is used by registerised compilers (hence the name) cannot be expressed in C at all. And, whether a particular build of GHC produces registerised or unregisterised code is a decision that was made at compile time of that build of GHC.</p>\n<blockquote>\n<p>If this is true, doesn't it imply that you can't follow these instructions to call Haskell code from C code in almost any situation (since building in unregisterised mode is generally undesirable and very uncommon)?</p>\n</blockquote>\n<p>No, because you can call Haskell code that is built by a registerised compiler from C code as well. One of the nice features of C is that it has a relatively standard (per platform) ABI, so a compiler for any language can produce object files that are binary-compatible with C object files, without ever invoking the host C compiler at all.</p>\n<blockquote>\n<p>In my case, I have actually a Python library and some project constraints that imply the code must be callable from Python, but which can benefit greatly from writing a lot of it in Haskell and using Haskell functions.</p>\n<p>My goal is to create an extension module for Python, which is very easy to do using Cython with C source. So if I can create the Haskell-from-C source and compile it to a library, it will be pretty easy to call from Python. Then I can worry about how to generate that wrapper code automatically.</p>\n<p>But if it requires this very specialized way of building GHC, it won't be useful to anyone who needs to work with it later, because they probably won't have that specialized build and won't want to fuss with it.</p>\n<p>Such a simple FFI capability (the C code generation part) seems like something that should &quot;just work&quot; in the most vanilla of builds of any Haskell compiler, at least to me.</p>\n</blockquote>\n<p>Yes, it does just work with any build of GHC. It just doesn't actually pass through C as an intermediate form; the output of GHC is an object file.</p>\n"}], "owner": {"reputation": 62908, "user_id": 567620, "user_type": "registered", "accept_rate": 72, "profile_image": "https://i.stack.imgur.com/g8HIM.jpg?s=128&g=1", "display_name": "ely", "link": "https://stackoverflow.com/users/567620/ely"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 131, "favorite_count": 0, "answer_count": 1, "score": 2, "last_activity_date": 1432957720, "creation_date": 1432945499, "last_edit_date": 1432945836, "question_id": 30540933, "link": "https://stackoverflow.com/questions/30540933/does-unregisterised-mode-requirement-prevent-haskells-basic-ffi-examples-in-nor", "title": "Does unregisterised mode requirement prevent Haskell&#39;s basic FFI examples in normal cases?", "body": "<p>From the <a href=\"https://wiki.haskell.org/Calling_Haskell_from_C\" rel=\"nofollow\">Haskell Wiki page about calling Haskell function from C</a>, there is a nice short example that I am trying to reproduce, which boils down to compiling some Haskell code that uses the C FFI with command line options such as:</p>\n\n<p><code>ghc -c -O Safe.hs</code></p>\n\n<p>One point of note is that in the Haskell Wiki page, the compiler option used is actually <code>-c</code> (lower case) and this does not generate the intermediate C code, so it is likely a typo.</p>\n\n<p>However, as I discovered when trying to compile with the <code>-C</code> option (the option that is documented as emitting intermediate C code), this is unavailable unless you build GHC in \"unregisterised mode\" which essentially drops GHC's native code generator and leaves only a very basic C code generator (what is used for these FFI examples) and the more highly optimized LLVM-based code generator.</p>\n\n<p>In fact, <a href=\"https://downloads.haskell.org/~ghc/latest/docs/html/users_guide/code-generators.html\" rel=\"nofollow\">from some documentation about GHC</a>, it suggests that you can <em>only</em> use the <code>-C</code> option in unregisterised mode.</p>\n\n<p>Is it true that you must build GHC in unregisterised mode in order to generate intermediate C code (via the <code>-C</code> option)?</p>\n\n<p>If this is true, doesn't it imply that you can't follow these instructions to call Haskell code from C code in almost any situation (since building in unregisterised mode is generally undesirable and very uncommon)?</p>\n\n<p>In my case, I have actually a Python library and some project constraints that imply the code must be callable from Python, but which can benefit greatly from writing a lot of it in Haskell and using Haskell functions.</p>\n\n<p>My goal is to create an extension module for Python, which is very easy to do using Cython with C source. So if I can create the Haskell-from-C source and compile it to a library, it will be pretty easy to call from Python. Then I can worry about how to generate that wrapper code automatically.</p>\n\n<p>But if it requires this very specialized way of building GHC, it won't be useful to anyone who needs to work with it later, because they probably won't have that specialized build and won't want to fuss with it.</p>\n\n<p>Such a simple FFI capability (the C code generation part) seems like something that should \"just work\" in the most vanilla of builds of any Haskell compiler, at least to me.</p>\n"}, {"tags": ["class", "haskell", "instance"], "answers": [{"tags": [], "owner": {"reputation": 100185, "user_id": 3234959, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/93bb12ca0f93dfddb33880316f7e66c2?s=128&d=identicon&r=PG&f=1", "display_name": "chi", "link": "https://stackoverflow.com/users/3234959/chi"}, "is_accepted": true, "score": 4, "last_activity_date": 1432943647, "last_edit_date": 1432943647, "creation_date": 1432943175, "answer_id": 30540678, "question_id": 30540604, "link": "https://stackoverflow.com/questions/30540604/replacing-an-instance-declaration/30540678#30540678", "title": "Replacing an instance declaration", "body": "<p>Haskell instances are meant to be unique: there should be only one instance per type, in the whole program.</p>\n\n<p>Orphan modules can temporarily break uniqueness. Orphans are modules declaring an instance for a type, but not declaring the type not the class. In principle, two modules can import the same type from a third module and declare different instances for it. This \"works\" until a fourth module tries to import from both, causing a clash between the two instances which triggers a compiler error. So, in practice, uniqueness is still eventually guaranteed.</p>\n\n<p>Most instances for standard types are not declared in orphans, so you can not avoid to import them when you import the standard type. Hence, you are stuck with the standard instance.</p>\n\n<p>There are some Haskell extensions such as <code>OverlappingInstances</code> and <code>IncoherentInstances</code> which can break the instance uniqueness. I believe most Haskellers consider this to be a wart in the system, and not something to actively exploit. Indeed, when multiple instances are present for the same type, it is no longer clear how the compiler will choose. This makes the code very fragile, so I'd recommend not to attempt to break instance uniqueness.</p>\n"}], "owner": {"reputation": 2337, "user_id": 3595992, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/a8fc8a00391b1282338f66de57e3fea0?s=128&d=identicon&r=PG&f=1", "display_name": "JeanJouX", "link": "https://stackoverflow.com/users/3595992/jeanjoux"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 54, "favorite_count": 0, "accepted_answer_id": 30540678, "answer_count": 1, "score": 1, "last_activity_date": 1432943647, "creation_date": 1432942520, "question_id": 30540604, "link": "https://stackoverflow.com/questions/30540604/replacing-an-instance-declaration", "title": "Replacing an instance declaration", "body": "<p>I would like to replace an instance declaration of a standard type of Haskell library. For example, replacing the <code>Show</code> instance for boolean by : </p>\n\n<pre><code>instance Show Bool where\n  show True  = \"Vrai\"\n  show False = \"Faux\"\n</code></pre>\n\n<p>But when I try to do it, I get this error : </p>\n\n<pre><code>Duplicate instance declarations:\n  instance Show Bool -- Defined at Exemples01.hs:37:10\n  instance Show Bool -- Defined in `GHC.Show'\n</code></pre>\n\n<p><strong>Is it possible to replace an instance declaration with Haskell ?</strong></p>\n"}, {"tags": ["haskell"], "answers": [{"tags": [], "owner": {"reputation": 43759, "user_id": 1651941, "user_type": "registered", "accept_rate": 97, "profile_image": "https://www.gravatar.com/avatar/a513bc1fa519d2fcf5e4e0d9b5500101?s=128&d=identicon&r=PG", "display_name": "Sibi", "link": "https://stackoverflow.com/users/1651941/sibi"}, "is_accepted": false, "score": 1, "last_activity_date": 1432933372, "creation_date": 1432933372, "answer_id": 30539012, "question_id": 30538972, "link": "https://stackoverflow.com/questions/30538972/count-elements-of-each-sublist/30539012#30539012", "title": "Count elements of each sublist", "body": "<p>Note that your input list is list of list, so you have to do this:</p>\n\n<pre><code>count :: [[a]] -&gt; [Int]\ncount [] = []\ncount (x:xs) =  (myLength x):(count xs)\n</code></pre>\n\n<p>You need to calculate the length using <code>myLength</code> function and for each element of the list and build it up using <code>:</code> function. <code>xs</code> will be the rest of the list, which you have to pass it to <code>count</code> again to compute it.</p>\n"}, {"tags": [], "owner": {"reputation": 16233, "user_id": 4253229, "user_type": "registered", "accept_rate": 83, "profile_image": "https://lh4.googleusercontent.com/-e2FAQvlj5CQ/AAAAAAAAAAI/AAAAAAAAAqM/TlSnekirgNE/photo.jpg?sz=128", "display_name": "Eugene Sh.", "link": "https://stackoverflow.com/users/4253229/eugene-sh"}, "is_accepted": false, "score": 4, "last_activity_date": 1432934261, "creation_date": 1432934261, "answer_id": 30539212, "question_id": 30538972, "link": "https://stackoverflow.com/questions/30538972/count-elements-of-each-sublist/30539212#30539212", "title": "Count elements of each sublist", "body": "<p>There are Prelude defined <code>length</code> and <code>map</code>. So your count can be defined as simple as:</p>\n\n<pre><code>count = map length \n</code></pre>\n"}, {"tags": [], "owner": {"reputation": 726, "user_id": 1241445, "user_type": "registered", "accept_rate": 76, "profile_image": "https://i.stack.imgur.com/sAWfj.png?s=128&g=1", "display_name": "sacheie", "link": "https://stackoverflow.com/users/1241445/sacheie"}, "is_accepted": false, "score": 0, "last_activity_date": 1432941391, "last_edit_date": 1432941391, "creation_date": 1432939576, "answer_id": 30540189, "question_id": 30538972, "link": "https://stackoverflow.com/questions/30538972/count-elements-of-each-sublist/30540189#30540189", "title": "Count elements of each sublist", "body": "<p><strong>Eugene Sh</strong> offered the best (simplest) answer above: just use <code>map length</code> on your input.</p>\n\n<p>But it sounds like this problem is homework, where the intent is to demonstrate basic understanding of recursion. So really we shouldn't be helping you :) But I will try to explain in a way that gives more than merely the answer.</p>\n\n<p>With any recursive definition, you must first define your base cases. Since you are dealing with <em>lists of lists</em>, your simplest case is a list containing <strong>no sublists</strong> - its patterns looks like <code>[]</code>.</p>\n\n<p>You also have to define a <em>recursive case</em> (sometimes also called an <em>inductive case</em>), in which the right-hand side of the equation will contain a reference to the very function being defined.</p>\n\n<p>So, your two necessary definitions for a sublists length function called <code>len</code>:</p>\n\n<pre><code>len (xs:xss) = length xs : len xss\nlen _        = []\n</code></pre>\n\n<p>Our first line defines the recursive case; notice its right-hand side contains a reference to the function we are defining (<code>len</code>, in this example). We use the popular Haskell conventions of <code>xs</code> for a list of arbitrary content type, and <code>xss</code> for a list of lists. The overall pattern, <code>(xs:xss)</code> matches any input with a list (<code>xs</code>) followed by any number of further lists (<code>xss</code>) - note, this could mean <strong>zero</strong> further lists! In that case, the pattern would concretely be <code>xs:[]</code>.</p>\n\n<p>For the second line, we did not bother to give an explicit pattern - we used the <em>wildcard pattern</em> <code>_</code>. This communicates to Haskell (and other programmers) the fact that we want <code>[]</code> to be returned for <strong>any</strong> input other than the one matched by the line above. Thus, when our recursion finally reaches the end of the list, it encounters a pattern like <code>[]</code> - a single list, not followed by any other lists. This is our <em>base case</em>, where we define the final output which ends the recursion.</p>\n"}], "owner": {"reputation": 197, "user_id": 4329377, "user_type": "registered", "accept_rate": 50, "profile_image": "https://lh6.googleusercontent.com/--Jf-Vxi9HSQ/AAAAAAAAAAI/AAAAAAAAAzU/r3SujqRJNnc/photo.jpg?sz=128", "display_name": "Walle", "link": "https://stackoverflow.com/users/4329377/walle"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 997, "favorite_count": 0, "answer_count": 3, "score": 0, "last_activity_date": 1433061410, "creation_date": 1432933220, "last_edit_date": 1433061410, "question_id": 30538972, "link": "https://stackoverflow.com/questions/30538972/count-elements-of-each-sublist", "title": "Count elements of each sublist", "body": "<p>So I was strugging with this function doing calculation of length of each sublist. It takes a list containing sublists and return a new list with each element specifies the size of each sublist.</p>\n\n<p>Something like:</p>\n\n<pre><code>*Main&gt; count [[], [\"this\", \"is\"], [\"a\", \"test\", \"!!!\"]]\n</code></pre>\n\n<p>should return</p>\n\n<pre><code>[0,2,3]\n</code></pre>\n\n<p>Here is what I have so far, but it only prints the total size of every sublist of the entire list which is</p>\n\n<pre><code>[5]\n</code></pre>\n\n<p>Code:</p>\n\n<pre><code>count :: [[a]] -&gt; [Int]\ncount [] = []\ncount (x:xs) =  [1 + myLength (x:xs)]\n</code></pre>\n\n<p>Btw myLength is a trivial function I wrote to calculate the size. </p>\n"}, {"tags": ["haskell", "lenses"], "comments": [{"owner": {"reputation": 7189, "user_id": 2898458, "user_type": "registered", "accept_rate": 89, "profile_image": "https://www.gravatar.com/avatar/bc37a9f235a6fa726c8047459ecf0a3f?s=128&d=identicon&r=PG", "display_name": "randomusername", "link": "https://stackoverflow.com/users/2898458/randomusername"}, "edited": false, "score": 2, "creation_date": 1432929875, "post_id": 30538101, "comment_id": 49149700, "body": "This could be related to the Monomorphism Restriction. Try putting <code>{-# LANGUAGE NoMonomorphismRestriction #-}</code> at the top of your file."}, {"owner": {"reputation": 1126, "user_id": 104103, "user_type": "registered", "accept_rate": 50, "profile_image": "https://www.gravatar.com/avatar/ccf1cf3aa6e5cacc9d60e5422cb0100f?s=128&d=identicon&r=PG", "display_name": "BruceBerry", "link": "https://stackoverflow.com/users/104103/bruceberry"}, "reply_to_user": {"reputation": 7189, "user_id": 2898458, "user_type": "registered", "accept_rate": 89, "profile_image": "https://www.gravatar.com/avatar/bc37a9f235a6fa726c8047459ecf0a3f?s=128&d=identicon&r=PG", "display_name": "randomusername", "link": "https://stackoverflow.com/users/2898458/randomusername"}, "edited": false, "score": 0, "creation_date": 1432930372, "post_id": 30538101, "comment_id": 49149911, "body": "it worked! someone on #haskell also solved it by adding an explicit type signature to _table. according to him Rank2Types was messing with type inference."}], "answers": [{"tags": [], "owner": {"reputation": 44013, "user_id": 1477667, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/trgKM.jpg?s=128&g=1", "display_name": "dfeuer", "link": "https://stackoverflow.com/users/1477667/dfeuer"}, "is_accepted": true, "score": 4, "last_activity_date": 1432937462, "last_edit_date": 1495540691, "creation_date": 1432937462, "answer_id": 30539846, "question_id": 30538101, "link": "https://stackoverflow.com/questions/30538101/why-cant-i-bind-and-reuse-a-haskell-lens-like-a-normal-variable/30539846#30539846", "title": "Why can&#39;t I bind and reuse a haskell lens like a normal variable?", "body": "<p>This could be related to the Monomorphism Restriction. Try putting <code>{-# LANGUAGE NoMonomorphismRestriction #-}</code> at the top of your file. \u2013<a href=\"https://stackoverflow.com/questions/30538101/why-cant-i-bind-and-reuse-a-haskell-lens-like-a-normal-variable#comment49149700_30538101\">randomusername</a></p>\n\n<p>It worked! Someone on <code>#haskell</code> also solved it by adding an explicit type signature to <code>_table</code>. according to him <code>Rank2Types</code> was messing with type inference. \u2013 <a href=\"https://stackoverflow.com/questions/30538101/why-cant-i-bind-and-reuse-a-haskell-lens-like-a-normal-variable#comment49149911_30538101\">BruceBerry</a></p>\n"}], "owner": {"reputation": 1126, "user_id": 104103, "user_type": "registered", "accept_rate": 50, "profile_image": "https://www.gravatar.com/avatar/ccf1cf3aa6e5cacc9d60e5422cb0100f?s=128&d=identicon&r=PG", "display_name": "BruceBerry", "link": "https://stackoverflow.com/users/104103/bruceberry"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 126, "favorite_count": 1, "accepted_answer_id": 30539846, "answer_count": 1, "score": 2, "last_activity_date": 1432937462, "creation_date": 1432929547, "question_id": 30538101, "link": "https://stackoverflow.com/questions/30538101/why-cant-i-bind-and-reuse-a-haskell-lens-like-a-normal-variable", "title": "Why can&#39;t I bind and reuse a haskell lens like a normal variable?", "body": "<p>(I'm using lens-family, not lens)</p>\n\n<p>I have a fairly deep data structure and I need to focus on two parts that have a common path. So very intuitively I define <code>_table</code> with the intention to reuse it:</p>\n\n<pre><code>let _table = _sOutput.at (O.tName table)._Just'\ntp' &lt;- evalCacheable (_table.O._stPerm) M.empty\n... reuse _table\n</code></pre>\n\n<p>but this yields an error:</p>\n\n<pre><code>Could not deduce (Functor f0) arising from a use of \u2018_sOutput\u2019\nfrom the context (MonadReader (EvalConf State All) m, ...\n</code></pre>\n\n<p>Yet, directly pasting the value of <code>_table</code> into the argument works:</p>\n\n<pre><code>tp' &lt;- evalCacheable (_sOutput.at (O.tName table)._Just'.O._stPerm) M.empty\n</code></pre>\n\n<p>What is going on? I can give more details about the types involved, but to me this seems puzzling regardless. I was under the impression that</p>\n\n<pre><code>let x = y\nz &lt;- f x\n</code></pre>\n\n<p>was equivalent to</p>\n\n<pre><code>z &lt;- f y\n</code></pre>\n\n<p>in all cases.</p>\n"}, {"tags": ["haskell", "interpreter"], "answers": [{"comments": [{"owner": {"reputation": 102, "user_id": 4705978, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/ac4be7ff364dc1b0513e3984b2e17e38?s=128&d=identicon&r=PG&f=1", "display_name": "Cochemuacos", "link": "https://stackoverflow.com/users/4705978/cochemuacos"}, "edited": false, "score": 0, "creation_date": 1432927349, "post_id": 30537238, "comment_id": 49148461, "body": "Ohhh I see, this is more simple than I first thought. The &quot;black box&quot; was confusing me. Thank you!"}], "tags": [], "owner": {"reputation": 126897, "user_id": 791604, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/ce991df7a056248d5e4f6fc3659ba733?s=128&d=identicon&r=PG", "display_name": "Daniel Wagner", "link": "https://stackoverflow.com/users/791604/daniel-wagner"}, "is_accepted": true, "score": 3, "last_activity_date": 1432926361, "creation_date": 1432926361, "answer_id": 30537238, "question_id": 30536968, "link": "https://stackoverflow.com/questions/30536968/implementing-an-interpreter-in-haskell-exercise-cis194/30537238#30537238", "title": "Implementing an interpreter in Haskell exercise CIS194", "body": "<p>\"Black box\" means you can ignore how it's implemented and just use it. <code>let foo = bar in baz</code> binds a new variable <code>foo</code> to the expression <code>bar</code>, then results in <code>baz</code> (which may mention <code>foo</code>); presumably here the point is that the given Haskell expression should evaluate to <code>True</code> -- that is, this is a test case for your implementation.</p>\n"}], "owner": {"reputation": 102, "user_id": 4705978, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/ac4be7ff364dc1b0513e3984b2e17e38?s=128&d=identicon&r=PG&f=1", "display_name": "Cochemuacos", "link": "https://stackoverflow.com/users/4705978/cochemuacos"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 171, "favorite_count": 0, "accepted_answer_id": 30537238, "answer_count": 1, "score": 0, "last_activity_date": 1432926361, "creation_date": 1432925367, "question_id": 30536968, "link": "https://stackoverflow.com/questions/30536968/implementing-an-interpreter-in-haskell-exercise-cis194", "title": "Implementing an interpreter in Haskell exercise CIS194", "body": "<p>I'm lerning haskell from the material that can be found <a href=\"https://www.seas.upenn.edu/~cis194/lectures.html\" rel=\"nofollow\">here</a>. I'm begining <a href=\"https://www.seas.upenn.edu/~cis194/hw/03-ADTs.pdf\" rel=\"nofollow\">homework 3</a>  in which the objective is to write an interpreter for a simple language but I'm stuck in the first exercise:</p>\n\n<blockquote>\n  <p>Before we can start evaluating Expressions and Statements\n  we need some way to store and look up the state of a variable. We\n  define a <code>State</code> to be a function of type <code>String -&gt; Int</code>. This makes it\n  very easy to look up the value of a variable; to look up the value of\n  <code>\"A\"</code> in <code>state</code>, we simply call <code>state \"A\"</code>. Whenever we assign a variable,\n  we want to update the program <code>State</code>. Implement the following\n  function:</p>\n  \n  <p><code>extend :: State -&gt; String -&gt; Int -&gt; State</code></p>\n  \n  <p>Hint: You can use the input State as a black box for variables other\n  than the one you are assigning.</p>\n  \n  <p>Example:</p>\n  \n  <p><code>let st\u2019 = extend st \"A\" 5</code></p>\n  \n  <p><code>in st\u2019 \"A\" == 5</code></p>\n</blockquote>\n\n<p>I don't get what I'm supposed to be doing here. In the hint I'm not sure what \"black box\" means. In the example I get that <code>st'</code> is a State, but I'm not sure I get what <code>in st' \"A\" == 5</code> is doing.</p>\n\n<p>If someone could clarify both the hint and the example for me I think I would be able to solve this exercise.</p>\n"}, {"tags": ["haskell", "md5"], "answers": [{"tags": [], "owner": {"reputation": 11743, "user_id": 2597135, "user_type": "registered", "accept_rate": 99, "profile_image": "https://www.gravatar.com/avatar/9b8c6248f917c92724a033de96708542?s=128&d=identicon&r=PG", "display_name": "Uli K&#246;hler", "link": "https://stackoverflow.com/users/2597135/uli-k%c3%b6hler"}, "is_accepted": true, "score": 6, "last_activity_date": 1432923903, "creation_date": 1432923903, "answer_id": 30536584, "question_id": 30536583, "link": "https://stackoverflow.com/questions/30536583/compute-md5-digest-of-file-in-haskell/30536584#30536584", "title": "Compute MD5 digest of file in Haskell", "body": "<p>One option is to use the <a href=\"https://hackage.haskell.org/package/pureMD5\" rel=\"noreferrer\"><code>pureMD5</code></a> package, for example if you want to compute the hash of the file <code>foo.txt</code>:</p>\n\n<pre><code>import qualified Data.ByteString.Lazy as LB\nimport Data.Digest.Pure.MD5\n\nmain :: IO ()\nmain = do\n    fileContent &lt;- LB.readFile \"foo.txt\"\n    let md5Digest = md5 fileContent\n    print md5Digest\n</code></pre>\n\n<p>This code prints the the same MD5 sum as <code>md5sum foo.txt</code>.</p>\n\n<p>If you prefer a one-liner, you can use this one (the imports are the same as above):</p>\n\n<pre><code>LB.readFile \"foo.txt\" &gt;&gt;= print . md5\n</code></pre>\n"}, {"tags": [], "owner": {"reputation": 11743, "user_id": 2597135, "user_type": "registered", "accept_rate": 99, "profile_image": "https://www.gravatar.com/avatar/9b8c6248f917c92724a033de96708542?s=128&d=identicon&r=PG", "display_name": "Uli K&#246;hler", "link": "https://stackoverflow.com/users/2597135/uli-k%c3%b6hler"}, "is_accepted": false, "score": 2, "last_activity_date": 1432925515, "creation_date": 1432925515, "answer_id": 30537010, "question_id": 30536583, "link": "https://stackoverflow.com/questions/30536583/compute-md5-digest-of-file-in-haskell/30537010#30537010", "title": "Compute MD5 digest of file in Haskell", "body": "<p>Another option would be using <a href=\"https://hackage.haskell.org/package/cryptohash\" rel=\"nofollow\"><code>cryptohash</code></a> which is based on a C implementation and also provides other hashes algorithms like SHA1:</p>\n\n<pre><code>import qualified Data.ByteString.Lazy as LB\nimport Crypto.Hash\n\nmd5 :: LB.ByteString -&gt; Digest MD5\nmd5 = hashlazy\n\nmain :: IO ()\nmain = do\n    fileContent &lt;- LB.readFile \"foo.txt\"\n    let md5Digest = md5 fileContent\n    print $ digestToHexByteString md5Digest\n</code></pre>\n"}], "owner": {"reputation": 11743, "user_id": 2597135, "user_type": "registered", "accept_rate": 99, "profile_image": "https://www.gravatar.com/avatar/9b8c6248f917c92724a033de96708542?s=128&d=identicon&r=PG", "display_name": "Uli K&#246;hler", "link": "https://stackoverflow.com/users/2597135/uli-k%c3%b6hler"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 2026, "favorite_count": 1, "accepted_answer_id": 30536584, "answer_count": 2, "score": 9, "last_activity_date": 1432925515, "creation_date": 1432923903, "question_id": 30536583, "link": "https://stackoverflow.com/questions/30536583/compute-md5-digest-of-file-in-haskell", "title": "Compute MD5 digest of file in Haskell", "body": "<p>Using Haskell, how can I compute the MD5 digest of a file without using external tools like <code>md5sum</code>?</p>\n\n<p><strong>Note:</strong> This question intentionally shows no effort as I answered it right away.</p>\n"}, {"tags": ["haskell", "type-systems"], "comments": [{"owner": {"reputation": 51584, "user_id": 839246, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/9b0573c2b936b12828dd1e4cc04206dc?s=128&d=identicon&r=PG&f=1", "display_name": "bheklilr", "link": "https://stackoverflow.com/users/839246/bheklilr"}, "edited": false, "score": 0, "creation_date": 1432923604, "post_id": 30536407, "comment_id": 49146569, "body": "Why are you returning a list in the first place, looks like you&#39;d be better off with <code>Request -&gt; (String, String)</code> (<code>String</code> is just an alias for <code>[Char]</code>), then just have <code>prepareIp req = (&quot;Remote&quot;, head $ splitOn &quot;:&quot; $ show $ remoteHost req)</code>, and if that&#39;s not readable enough for you, then use a local <code>let</code>, such as <code>prepareIp req = let ip = head $ splitOn &quot;:&quot; $ show $ remoteHost req in (&quot;Remote&quot;, ip)</code>, although with more whitespace mixed in to make it easy to read."}, {"owner": {"reputation": 51584, "user_id": 839246, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/9b0573c2b936b12828dd1e4cc04206dc?s=128&d=identicon&r=PG&f=1", "display_name": "bheklilr", "link": "https://stackoverflow.com/users/839246/bheklilr"}, "edited": false, "score": 0, "creation_date": 1432923702, "post_id": 30536407, "comment_id": 49146635, "body": "You also probably should be pattern matching on the <code>SockAddr</code> returned by <code>remoteHost req</code> to extract the IP (as a <code>HostAddress</code> or <code>HostAddress6</code>), rather than converting it to a string to slice and dice."}, {"owner": {"reputation": 51584, "user_id": 839246, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/9b0573c2b936b12828dd1e4cc04206dc?s=128&d=identicon&r=PG&f=1", "display_name": "bheklilr", "link": "https://stackoverflow.com/users/839246/bheklilr"}, "edited": false, "score": 1, "creation_date": 1432923815, "post_id": 30536407, "comment_id": 49146694, "body": "As for why it thought you needed <code>Char</code> and not a <code>[Char]</code>, it&#39;s because when you have <code>ip &lt;-</code>, it extracts each element from the list on the right side of the <code>&lt;-</code>, and since in this case <code>head</code> returns a <code>String</code>, which is equivalent to <code>[Char]</code>, the compiler expects <code>ip</code> to have the type <code>Char</code>.  You really just need a <code>let</code> here, not monads."}, {"owner": {"reputation": 13379, "user_id": 1033027, "user_type": "registered", "accept_rate": 91, "profile_image": "https://www.gravatar.com/avatar/b56ea1c43a4ecb1060ec8bcb8d2bce78?s=128&d=identicon&r=PG", "display_name": "Jules", "link": "https://stackoverflow.com/users/1033027/jules"}, "reply_to_user": {"reputation": 51584, "user_id": 839246, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/9b0573c2b936b12828dd1e4cc04206dc?s=128&d=identicon&r=PG&f=1", "display_name": "bheklilr", "link": "https://stackoverflow.com/users/839246/bheklilr"}, "edited": false, "score": 0, "creation_date": 1432923856, "post_id": 30536407, "comment_id": 49146709, "body": "@bheklilr I didn&#39;t know pattern matching on a <code>Word32</code> was possible (since that&#39;s all a <code>HostAddress</code> is -- how could this be done?"}, {"owner": {"reputation": 51584, "user_id": 839246, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/9b0573c2b936b12828dd1e4cc04206dc?s=128&d=identicon&r=PG&f=1", "display_name": "bheklilr", "link": "https://stackoverflow.com/users/839246/bheklilr"}, "edited": false, "score": 0, "creation_date": 1432923992, "post_id": 30536407, "comment_id": 49146786, "body": "You would pattern match on the constructors of <code>SockAddr</code>, not on <code>Word32</code> itself: <code>case remoteHost req of { SockAddrInet port addr -&gt; ...; SockAddrInet6 port flow addr6 scope -&gt; ...; SockAddrUnix addr -&gt; ...}</code>."}, {"owner": {"reputation": 13379, "user_id": 1033027, "user_type": "registered", "accept_rate": 91, "profile_image": "https://www.gravatar.com/avatar/b56ea1c43a4ecb1060ec8bcb8d2bce78?s=128&d=identicon&r=PG", "display_name": "Jules", "link": "https://stackoverflow.com/users/1033027/jules"}, "reply_to_user": {"reputation": 51584, "user_id": 839246, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/9b0573c2b936b12828dd1e4cc04206dc?s=128&d=identicon&r=PG&f=1", "display_name": "bheklilr", "link": "https://stackoverflow.com/users/839246/bheklilr"}, "edited": false, "score": 0, "creation_date": 1432923996, "post_id": 30536407, "comment_id": 49146790, "body": "And thanks for the answer! That does make sense. You could make that an answer instead of keeping it in the comments."}, {"owner": {"reputation": 13379, "user_id": 1033027, "user_type": "registered", "accept_rate": 91, "profile_image": "https://www.gravatar.com/avatar/b56ea1c43a4ecb1060ec8bcb8d2bce78?s=128&d=identicon&r=PG", "display_name": "Jules", "link": "https://stackoverflow.com/users/1033027/jules"}, "reply_to_user": {"reputation": 51584, "user_id": 839246, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/9b0573c2b936b12828dd1e4cc04206dc?s=128&d=identicon&r=PG&f=1", "display_name": "bheklilr", "link": "https://stackoverflow.com/users/839246/bheklilr"}, "edited": false, "score": 0, "creation_date": 1432924053, "post_id": 30536407, "comment_id": 49146818, "body": "Awesome. I&#39;m still new to pattern matching, it isn&#39;t always obvious what can be pattern-matched on and how."}, {"owner": {"reputation": 13379, "user_id": 1033027, "user_type": "registered", "accept_rate": 91, "profile_image": "https://www.gravatar.com/avatar/b56ea1c43a4ecb1060ec8bcb8d2bce78?s=128&d=identicon&r=PG", "display_name": "Jules", "link": "https://stackoverflow.com/users/1033027/jules"}, "reply_to_user": {"reputation": 51584, "user_id": 839246, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/9b0573c2b936b12828dd1e4cc04206dc?s=128&d=identicon&r=PG&f=1", "display_name": "bheklilr", "link": "https://stackoverflow.com/users/839246/bheklilr"}, "edited": false, "score": 0, "creation_date": 1432927630, "post_id": 30536407, "comment_id": 49148613, "body": "Now it&#39;s giving me a strange versioning issue - apparently the <code>case of</code> block produces a <code>network-2.6.1.0:Network.Socket.Types.SockAddr</code> out of <code>remoteHost req</code>, while matching against <code>SockAddrInet port addr</code> (etc) needs a <code>network-2.6.0.2:Network.Socket.Types.SockAddr</code>."}], "answers": [{"tags": [], "owner": {"reputation": 51584, "user_id": 839246, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/9b0573c2b936b12828dd1e4cc04206dc?s=128&d=identicon&r=PG&f=1", "display_name": "bheklilr", "link": "https://stackoverflow.com/users/839246/bheklilr"}, "is_accepted": true, "score": 1, "last_activity_date": 1432927700, "creation_date": 1432927700, "answer_id": 30537620, "question_id": 30536407, "link": "https://stackoverflow.com/questions/30536407/haskell-converting-char-to-char/30537620#30537620", "title": "Haskell converting [Char] to Char", "body": "<p>The reason why you're seeing that error is because you're trying to shove everything into a monad when it doesn't need to be.  To illustrate, adding explicit type signatures everywhere and swapping <code>[]</code> for <code>m</code>:</p>\n\n<pre><code>getHostIp :: Request -&gt; m []\ngetHostIp req = head $ splitOn \":\" $ remoteHost req\n\nprepareIp :: Request -&gt; m ([Char], [Char])\nprepareIp req = do\n    ip &lt;- (getHostIp req :: m Char)\n    [(\"Remote\" :: [Char], ip :: [Char])]\n</code></pre>\n\n<p>Whenever you see <code>&lt;-</code>, the right side has to have some type like <code>m a</code> where <code>m</code> is some monadic type and <code>a</code> is whatever the result of that monadic action is.  Then, then left side of the <code>&lt;-</code> has type <code>a</code>.  Here you've used <code>&lt;-</code> to try to get the value out of a <code>[Char]</code>, when you really just want the value of that <code>[Char]</code> completely.  A <code>let</code> is appropriate here, and <code>do</code> notation is superfluous.  Since you're also returning only a single value, I'd recommend just returning <code>(String, String)</code> instead of <code>[(String, String)]</code>:</p>\n\n<pre><code>prepareIp :: Request -&gt; (String, String)\nprepareIp req =\n    let ip = getHostIp req\n    in (\"Remote\", ip)\n</code></pre>\n"}], "owner": {"reputation": 13379, "user_id": 1033027, "user_type": "registered", "accept_rate": 91, "profile_image": "https://www.gravatar.com/avatar/b56ea1c43a4ecb1060ec8bcb8d2bce78?s=128&d=identicon&r=PG", "display_name": "Jules", "link": "https://stackoverflow.com/users/1033027/jules"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 392, "favorite_count": 0, "accepted_answer_id": 30537620, "answer_count": 1, "score": 0, "last_activity_date": 1432927700, "creation_date": 1432923234, "question_id": 30536407, "link": "https://stackoverflow.com/questions/30536407/haskell-converting-char-to-char", "title": "Haskell converting [Char] to Char", "body": "<p>I'm working on a Haskell program that uses whte <code>Network.Wai</code> and <code>Network.Socket.Internal</code> modules. In this program, I have a function, defined like so:</p>\n\n<pre><code>prepareIp :: Request -&gt; [([Char], [Char])]\nprepareIp req = [(\"Remote\", head $ splitOn \":\" $ show $ remoteHost req)]\n</code></pre>\n\n<p>Originally, I made this a monadic expression (mostly for readability and clarity), written:</p>\n\n<pre><code>prepareIp :: Request -&gt; [([Char], [Char])]\nprepareIp req = do\n     ip &lt;- head $ splitOn \":\" $ show $ remoteHost req\n     [(\"Remote\", ip)]\n</code></pre>\n\n<p>While the former implementation does work properly, the monadic one threw an error I can't wrap my head around: its output type was not <code>[([Char], [Char])]</code>, but <code>[([Char], Char)]</code> -- the value <code>ip</code> was, for some reason, being turned into a single character rather than a string!</p>\n\n<p>I also tried prototyping this in GHCi and type-checking using the module references as well as <code>:t</code> in GHCi, but to no avail, and I still don't know what caused this error.</p>\n\n<p>Can anyone clue me in on why this type conflict is happening?</p>\n"}, {"tags": ["unit-testing", "haskell", "hspec"], "answers": [{"tags": [], "owner": {"reputation": 391, "user_id": 2759302, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/af6983cceac5aef7f452a8d4888e5208?s=128&d=identicon&r=PG", "display_name": "Simon Hengel", "link": "https://stackoverflow.com/users/2759302/simon-hengel"}, "is_accepted": true, "score": 8, "last_activity_date": 1433052951, "creation_date": 1433052951, "answer_id": 30554467, "question_id": 30536294, "link": "https://stackoverflow.com/questions/30536294/access-a-value-set-up-by-beforeall-during-tests/30554467#30554467", "title": "Access a value set up by `beforeAll` during tests", "body": "<p>Spec arguments are passed to your it blocks as regular function arguments (look at the associated type of the <code>Example</code> type class, if you want to understand what's going on).  A fully self-contained example would be:</p>\n\n<pre><code>import           Test.Hspec\n\nmain :: IO ()\nmain = hspec spec\n\nspec :: Spec\nspec = beforeAll (return \"foo\") $ do\n  describe \"something\" $ do\n    it \"some behavior\" $ \\xs -&gt; do\n      xs `shouldBe` \"foo\"\n\n    it \"some other behavior\" $ \\xs -&gt; do\n      xs `shouldBe` \"foo\"\n</code></pre>\n"}], "owner": {"reputation": 51262, "user_id": 208257, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/8d59503078761ba50620cbee4348882e?s=128&d=identicon&r=PG", "display_name": "Dan Burton", "link": "https://stackoverflow.com/users/208257/dan-burton"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 297, "favorite_count": 0, "accepted_answer_id": 30554467, "answer_count": 1, "score": 7, "last_activity_date": 1433052951, "creation_date": 1432922882, "question_id": 30536294, "link": "https://stackoverflow.com/questions/30536294/access-a-value-set-up-by-beforeall-during-tests", "title": "Access a value set up by `beforeAll` during tests", "body": "<p>Here's what I've got:</p>\n\n<pre><code>spec :: Spec\nspec = do\n  manager &lt;- runIO newManager\n\n  it \"foo\" $ do\n    -- code that uses manager\n\n  it \"bar\" $ do\n    -- code that usees manager\n</code></pre>\n\n<p>The docs for <code>runIO</code> suggest that I should probably be using <code>beforeAll</code> instead, since I do not need <code>manager</code> to <em>construct</em> the spec tree, I just need it to <em>run</em> each test, and in my use case it's better for them to all share the same manager rather than creating a new one for each test.</p>\n\n<blockquote>\n  <p>If you do not need the result of the IO action to construct the spec tree, beforeAll may be more suitable for your use case.</p>\n</blockquote>\n\n<pre><code>beforeAll :: IO a -&gt; SpecWith a -&gt; Spec\n</code></pre>\n\n<p>But I can't figure out how to access the manager from the tests.</p>\n\n<pre><code>spec :: Spec\nspec = beforeAll newManager go\n\ngo :: SpecWith Manager\ngo = do\n  it \"foo\" $ do\n    -- needs \"manager\" in scope\n  it \"bar\" $ do\n    -- needs \"manager\" in scope\n</code></pre>\n"}, {"tags": ["haskell", "arguments"], "comments": [{"owner": {"reputation": 58792, "user_id": 1006010, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/f683d229f3673c9dcc3f3f2796d75c09?s=128&d=identicon&r=PG", "display_name": "MathematicalOrchid", "link": "https://stackoverflow.com/users/1006010/mathematicalorchid"}, "edited": false, "score": 2, "creation_date": 1432914535, "post_id": 30533353, "comment_id": 49141308, "body": "Declare a type that bundles all these separate arguments up into one value? (Trying to find logical groupings is usually the fun part.) You may also want to define a <code>newtype</code> or at least a <code>type</code> alias for all those <code>Int</code> values."}, {"owner": {"reputation": 976, "user_id": 1274282, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/nBRxs.png?s=128&g=1", "display_name": "Taylor Fausak", "link": "https://stackoverflow.com/users/1274282/taylor-fausak"}, "edited": false, "score": 0, "creation_date": 1432931360, "post_id": 30533353, "comment_id": 49150397, "body": "I tried a bunch of different ideas in Strive, my API binding to Strava. I ultimately ended up with settings types and lenses. Check out <a href=\"https://github.com/tfausak/strive/issues/44\" rel=\"nofollow noreferrer\">this issue</a> for some discussion and <a href=\"https://github.com/tfausak/strive/tree/v1.0.1#segment-leaderboard\" rel=\"nofollow noreferrer\">this example</a> for how it looks now."}], "answers": [{"comments": [{"owner": {"reputation": 549, "user_id": 4396823, "user_type": "registered", "accept_rate": 83, "profile_image": "https://www.gravatar.com/avatar/e7493ed20de304e4d88666ff6977ae33?s=128&d=identicon&r=PG&f=1", "display_name": "Steve", "link": "https://stackoverflow.com/users/4396823/steve"}, "edited": false, "score": 0, "creation_date": 1432974909, "post_id": 30533960, "comment_id": 49160851, "body": "I love the last one. Thanks for all these"}, {"owner": {"reputation": 51584, "user_id": 839246, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/9b0573c2b936b12828dd1e4cc04206dc?s=128&d=identicon&r=PG&f=1", "display_name": "bheklilr", "link": "https://stackoverflow.com/users/839246/bheklilr"}, "reply_to_user": {"reputation": 549, "user_id": 4396823, "user_type": "registered", "accept_rate": 83, "profile_image": "https://www.gravatar.com/avatar/e7493ed20de304e4d88666ff6977ae33?s=128&d=identicon&r=PG&f=1", "display_name": "Steve", "link": "https://stackoverflow.com/users/4396823/steve"}, "edited": false, "score": 0, "creation_date": 1432999993, "post_id": 30533960, "comment_id": 49168233, "body": "@Steve it takes a ReaderT action and the value to be returned from a call to ask, and then runs the action using that value. If you&#39;ve used the State monad before then think of the Reader monad as a fixed state, you can only get it, not set it. It&#39;s often used to pass in static configuration."}], "tags": [], "owner": {"reputation": 51584, "user_id": 839246, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/9b0573c2b936b12828dd1e4cc04206dc?s=128&d=identicon&r=PG&f=1", "display_name": "bheklilr", "link": "https://stackoverflow.com/users/839246/bheklilr"}, "is_accepted": true, "score": 2, "last_activity_date": 1432915243, "last_edit_date": 1432915243, "creation_date": 1432914930, "answer_id": 30533960, "question_id": 30533353, "link": "https://stackoverflow.com/questions/30533353/best-practices-for-talking-to-an-api/30533960#30533960", "title": "Best practices for talking to an API", "body": "<p>You can combine these into more descriptive data types:</p>\n\n<pre><code>data Config = Config\n    { cKey :: Key\n    , cAccount :: Account\n    }\n</code></pre>\n\n<p>Then maybe have <code>type</code>s or <code>newtypes</code> to make the other arguments more descriptive:</p>\n\n<pre><code>-- I have no idea what these actually should be, I'm just making up something\ntype Count = Int\ntype Name = String\ntype Position = (Int, Int)\n\nmyApiFunction :: Config -&gt; Count -&gt; Name -&gt; Position -&gt; IO MyType\nmyApiFunction conf count name (x, y) =\n    myPreviousApiFunction (cKey conf)\n                          (cAccount conf)\n                          name\n                          name\n                          x\n                          y\n</code></pre>\n\n<p>If the <code>Config</code> is always needed, then I would recommend working in a <code>Reader</code> monad, which you can easily do as</p>\n\n<pre><code>myApiFunction\n    :: (MonadReader Config io, MonadIO io)\n    =&gt; Count -&gt; Name -&gt; Position\n    -&gt; io MyType\nmyApiFunction count name (x, y) = do\n    conf &lt;- ask\n    liftIO $ myPreviousApiFunction\n                (cKey conf)\n                (cAccount conf)\n                name\n                name\n                x\n                y\n</code></pre>\n\n<p>This uses the <code>mtl</code> library for monad transformers.  If you don't want to have to type that constraint over and over, you can also use the <code>ConstraintKinds</code> extension to alias it:</p>\n\n<pre><code>{-# LANGUAGE ConstraintKinds #-}\n{-# LANGUAGE FlexibleContexts #-}\n...\n\ntype ApiCtx io = (MonadReader Config io, MonadIO io)\n\n...\n\nmyApiFunction\n    :: ApiCtx io\n    =&gt; Count -&gt; Location -&gt; Position\n    -&gt; io MyType\nmyApiFunction ...\n</code></pre>\n\n<p>Depending on your specific application, you could also split it up into multiple function.  I've seen plenty of APIs before that had something like</p>\n\n<pre><code>withCount :: ApiCtx io =&gt; Count    -&gt; io a -&gt; io a\nwithName  :: ApiCtx io =&gt; Name     -&gt; io a -&gt; io a\nwithPos   :: ApiCtx io =&gt; Position -&gt; io a -&gt; io a\n\n(&amp;) :: a -&gt; (a -&gt; b) -&gt; b\n\nrequest :: ApiCtx io =&gt; io MyType \n</code></pre>\n\n<hr>\n\n<pre><code>&gt; :set +m   -- Multi-line input\n&gt; let r = request &amp; withCount 1\n|                 &amp; withName \"foo\"\n|                 &amp; withPos (1, 2)\n&gt; runReaderT r (Config key acct)\n</code></pre>\n\n<p>These are just a handful of techniques, there are others out there as well but they generally start becoming more complex after this.  Others will have different preferences on how to do this, and I'm sure plenty would disagree with me on whether some of these are even good practice (specifically <code>ConstraintKinds</code>, it isn't universally accepted).</p>\n\n<p>If you find yourself having type signatures that are too large a lot, even after applying some of these techniques, then maybe you're approaching the problem from the wrong direction, maybe those functions can be broken down into simpler intermediate steps, maybe some of those arguments can be grouped together logically into more specific data types, maybe you just need a larger record structure to handle setting up complex operations.  It's pretty open ended right now.</p>\n"}], "owner": {"reputation": 549, "user_id": 4396823, "user_type": "registered", "accept_rate": 83, "profile_image": "https://www.gravatar.com/avatar/e7493ed20de304e4d88666ff6977ae33?s=128&d=identicon&r=PG&f=1", "display_name": "Steve", "link": "https://stackoverflow.com/users/4396823/steve"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 85, "favorite_count": 0, "accepted_answer_id": 30533960, "answer_count": 1, "score": 4, "last_activity_date": 1432915243, "creation_date": 1432912971, "question_id": 30533353, "link": "https://stackoverflow.com/questions/30533353/best-practices-for-talking-to-an-api", "title": "Best practices for talking to an API", "body": "<p>I'm trying to create some bindings for an API in Haskell. I noticed some functions have a tremendous number of arguments, e.g.</p>\n\n<pre><code>myApiFunction :: Key -&gt; Account -&gt; Int -&gt; String -&gt; Int -&gt; Int -&gt; IO (MyType)\n</code></pre>\n\n<p>It's not necessarily bad, per se, to have this many arguments. But as a user  I don't like long argument functions. However, each of these args is absolutely 100% necessary.</p>\n\n<p>Is there a more haskell-ish way to abstract over the common parts of these functions? Everything past account here is used to build a URL, so I would need it available, and what it stands for depends entirely on the function. Certain things are consistent though, like <code>Key</code> and <code>Account</code>, and I'm wondering what the best to abstract over these arguments is.</p>\n\n<p>Thank you!</p>\n"}, {"tags": ["haskell"], "comments": [{"owner": {"reputation": 2628, "user_id": 1031434, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/15f496f9b9b31303923658f3a02254c1?s=128&d=identicon&r=PG", "display_name": "timdiels", "link": "https://stackoverflow.com/users/1031434/timdiels"}, "reply_to_user": {"reputation": 48129, "user_id": 76051, "user_type": "registered", "accept_rate": 91, "profile_image": "https://i.stack.imgur.com/AGDxz.jpg?s=128&g=1", "display_name": "Carsten", "link": "https://stackoverflow.com/users/76051/carsten"}, "edited": false, "score": 0, "creation_date": 1432915597, "post_id": 30533301, "comment_id": 49141995, "body": "@Carsten Thanks, <code>idOf</code> indeed worked. As for the constraint, I was trying to see if there was a feature in haskell to &#39;pattern match&#39; a type with a class. For the second example, is there a way to make it work without using <code>Graph a b | a -&gt; b</code>, and/or is there a reason from a design perspective to do the latter anyway?"}], "answers": [{"tags": [], "owner": {"reputation": 126897, "user_id": 791604, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/ce991df7a056248d5e4f6fc3659ba733?s=128&d=identicon&r=PG", "display_name": "Daniel Wagner", "link": "https://stackoverflow.com/users/791604/daniel-wagner"}, "is_accepted": true, "score": 5, "last_activity_date": 1432922142, "creation_date": 1432922142, "answer_id": 30536116, "question_id": 30533301, "link": "https://stackoverflow.com/questions/30533301/how-do-you-get-and-use-the-dependent-type-from-a-type-class-with-functional-depe/30536116#30536116", "title": "How do you get and use the dependent type from a type class with functional dependencies?", "body": "<p>It does indeed seem a bit odd that GHC complains about the minimal <code>f</code> you posted at the very top. But it seems to work okay with type families:</p>\n\n<pre><code>{-# LANGUAGE TypeFamilies #-}\nclass Identifiable a where\n    type IdOf a\n    idOf :: a -&gt; IdOf a\n\ninstance Identifiable Int where\n    type IdOf Int = Int\n    idOf a = a\n\nf :: a -&gt; [IdOf Int]\nf _ = [5 :: Int]\n</code></pre>\n\n<p>Perhaps you can adapt this idea to your larger example.</p>\n"}, {"tags": [], "owner": {"reputation": 14485, "user_id": 190376, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/cd8280c5e1491b8cf55760750ed97dec?s=128&d=identicon&r=PG", "display_name": "Reid Barton", "link": "https://stackoverflow.com/users/190376/reid-barton"}, "is_accepted": false, "score": 7, "last_activity_date": 1432925768, "creation_date": 1432925768, "answer_id": 30537079, "question_id": 30533301, "link": "https://stackoverflow.com/questions/30533301/how-do-you-get-and-use-the-dependent-type-from-a-type-class-with-functional-depe/30537079#30537079", "title": "How do you get and use the dependent type from a type class with functional dependencies?", "body": "<p>In GHC's implementation, functional dependencies can constrain the values of type variables that would otherwise be ambiguous (in the <code>show . read</code> sense). They cannot be used to provide evidence that two types are equal, in the way that equality constraints can. My understanding is that functional dependencies predate the addition of coercions to GHC's intermediate Core language, and these coercions are needed in general in order to translate the kinds of programs you are expecting to work into well-typed Core programs.</p>\n\n<p>(This situation is arguably for the best, since GHC does not really enforce the functional dependency condition globally and it would be easy to break type safety if programs like your first one were accepted. On the other hand, GHC could also do a better job of enforcing global consistency of instances.)</p>\n\n<p>The short version of this is that the type checker's logic around functional dependencies is not as strong as you might expect, especially in conjunction with newer type system features like GADTs. I recommend using type families in these situations instead, as exemplified by Daniel Wagner's answer.</p>\n\n<p><a href=\"https://ghc.haskell.org/trac/ghc/ticket/345\">https://ghc.haskell.org/trac/ghc/ticket/345</a> is an old ticket on a similar theme, so you can see that this is a long-standing known issue with functional dependencies and that using type families instead is the officially recommended solution.</p>\n\n<p>If you want to retain the style in which <code>Identifiable</code> has two type arguments, you can also set up your program in the form</p>\n\n<pre><code>type family IdOf a\nclass (b ~ IdOf a) =&gt; Identifiable a b where\n    idOf :: a -&gt; b\n\ntype instance IdOf Int = Int\ninstance Identifiable Int Int where\n    idOf a = a\n\nf :: Identifiable Int b =&gt; Int -&gt; [b]\nf a = [5 :: Int]\n</code></pre>\n"}], "owner": {"reputation": 2628, "user_id": 1031434, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/15f496f9b9b31303923658f3a02254c1?s=128&d=identicon&r=PG", "display_name": "timdiels", "link": "https://stackoverflow.com/users/1031434/timdiels"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 136, "favorite_count": 0, "accepted_answer_id": 30536116, "answer_count": 2, "score": 5, "last_activity_date": 1432930238, "creation_date": 1432912812, "last_edit_date": 1495542606, "question_id": 30533301, "link": "https://stackoverflow.com/questions/30533301/how-do-you-get-and-use-the-dependent-type-from-a-type-class-with-functional-depe", "title": "How do you get and use the dependent type from a type class with functional dependencies?", "body": "<p>How do you get and use the dependent type from a type class with functional dependencies?</p>\n\n<p>To clarify and give an example of my latest attempt (minimised from actual code I was writing):</p>\n\n<pre><code>class Identifiable a b | a -&gt; b where  -- if you know a, you know b\n    idOf :: a -&gt; b\n\ninstance Identifiable Int Int where\n    idOf a = a\n\nf :: Identifiable Int b =&gt; Int -&gt; [b]  -- Does ghc infer b from the functional dependency used in Identifiable, and the instance?\nf a = [5 :: Int]\n</code></pre>\n\n<p>But ghc does not infer b, it seems, as it prints this error:</p>\n\n<pre><code>Couldn't match expected type \u2018b\u2019 with actual type \u2018Int\u2019\n  \u2018b\u2019 is a rigid type variable bound by\n      the type signature for f :: Identifiable Int b =&gt; Int -&gt; [b]\n      at src/main.hs:57:6\nRelevant bindings include\n  f :: Int -&gt; [b] (bound at src/main.hs:58:1)\nIn the expression: 5 :: Int\nIn the expression: [5 :: Int]\nIn an equation for \u2018f\u2019: f a = [5 :: Int]\n</code></pre>\n\n<p>For context, here's a less minimised example:</p>\n\n<pre><code>data Graph a where\n    Graph :: (Identifiable a b) =&gt; GraphImpl b -&gt; Graph a\n\ngetImpl :: Identifiable a b =&gt; Graph a -&gt; GraphImpl b\ngetImpl (Graph impl) = impl\n</code></pre>\n\n<p>The workaround here would be to add b as type arg to Graph:</p>\n\n<pre><code>data Graph a b | a -&gt; b where\n    Graph :: (Identifiable a b) =&gt; GraphImpl b -&gt; Graph a\n</code></pre>\n\n<p>The full context: I have a <code>Graph</code> of entities that each have an id, each entity is assigned to 1 node. You can look up a node by entity. I also have a <code>Graph'</code>which consists of nodes (which can be assigned an entity), and to lookup a node you need to provide the node's id, which is an Int. <code>Graph</code> uses <code>Graph'</code> internally. I have an <code>IdMap</code> which maps ids of entities to ids of nodes in <code>Graph'</code>. This is my <code>Graph</code> definition:</p>\n\n<pre><code>data Graph a where\n    Graph  :: (Identifiable a b) =&gt; {\n    _idMap :: IdMap b,\n    _nextVertexId :: Int,\n    _graph :: Graph' a\n} -&gt; Graph a\n</code></pre>\n\n<hr>\n\n<p><strong>Answer</strong>: Use type families, see <a href=\"https://stackoverflow.com/a/30536116/1031434\">Daniel Wagner's answer</a>.\nFor the full story, see <a href=\"https://stackoverflow.com/a/30537079/1031434\">Reid Barton's answer</a>.</p>\n"}, {"tags": ["haskell", "graph"], "comments": [{"owner": {"reputation": 58792, "user_id": 1006010, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/f683d229f3673c9dcc3f3f2796d75c09?s=128&d=identicon&r=PG", "display_name": "MathematicalOrchid", "link": "https://stackoverflow.com/users/1006010/mathematicalorchid"}, "edited": false, "score": 0, "creation_date": 1432911591, "post_id": 30532695, "comment_id": 49139285, "body": "I don&#39;t know anything about a Haskell-specific tool. You&#39;ll probably end up using something powered by GraphVis."}, {"owner": {"reputation": 507143, "user_id": 1048572, "user_type": "registered", "accept_rate": 77, "profile_image": "https://www.gravatar.com/avatar/7f2c4de95e8f4f8f5a71c3aaf0ed312a?s=128&d=identicon&r=PG", "display_name": "Bergi", "link": "https://stackoverflow.com/users/1048572/bergi"}, "edited": false, "score": 0, "creation_date": 1432911818, "post_id": 30532695, "comment_id": 49139454, "body": "So you say you only care about <code>data</code> type declarations, not about the actual code?"}, {"owner": {"reputation": 2779, "user_id": 977026, "user_type": "registered", "accept_rate": 68, "profile_image": "https://www.gravatar.com/avatar/15b767a2c3503f273e9ad5270e4efdc1?s=128&d=identicon&r=PG", "display_name": "Schiavini", "link": "https://stackoverflow.com/users/977026/schiavini"}, "reply_to_user": {"reputation": 507143, "user_id": 1048572, "user_type": "registered", "accept_rate": 77, "profile_image": "https://www.gravatar.com/avatar/7f2c4de95e8f4f8f5a71c3aaf0ed312a?s=128&d=identicon&r=PG", "display_name": "Bergi", "link": "https://stackoverflow.com/users/1048572/bergi"}, "edited": false, "score": 0, "creation_date": 1432912231, "post_id": 30532695, "comment_id": 49139785, "body": "@Bergi, indeed, I only want to see the data declarations."}], "answers": [{"tags": [], "owner": {"reputation": 33184, "user_id": 247623, "user_type": "registered", "accept_rate": 72, "profile_image": "https://www.gravatar.com/avatar/bb9e67348d3e0e93ef12dd97c41a6c22?s=128&d=identicon&r=PG&f=1", "display_name": "Erik Kaplun", "link": "https://stackoverflow.com/users/247623/erik-kaplun"}, "is_accepted": false, "score": 4, "last_activity_date": 1432917983, "last_edit_date": 1432917983, "creation_date": 1432914838, "answer_id": 30533935, "question_id": 30532695, "link": "https://stackoverflow.com/questions/30532695/generating-diagram-of-haskell-data-structures/30533935#30533935", "title": "Generating diagram of Haskell data structures", "body": "<p>If I understand you correctly, you want to take the AST of some Haskell code and visualise that. How about first parsing it using <a href=\"https://hackage.haskell.org/package/haskell-src\" rel=\"nofollow\">https://hackage.haskell.org/package/haskell-src</a> and then generating output using <a href=\"https://hackage.haskell.org/package/graphviz\" rel=\"nofollow\">https://hackage.haskell.org/package/graphviz</a>. </p>\n\n<p>If it's not an AST you want to visualise, just map your data structure to GraphViz output and ignore the Parser.Haskell part. </p>\n\n<p>In any case, I'd assume rolling your own visualisation code would be the most flexible way, and given Haskell's expressiveness, probably not too laborious. </p>\n"}, {"tags": [], "owner": {"reputation": 24211, "user_id": 1364288, "user_type": "registered", "accept_rate": 88, "profile_image": "https://i.stack.imgur.com/JVtNl.png?s=128&g=1", "display_name": "danidiaz", "link": "https://stackoverflow.com/users/1364288/danidiaz"}, "is_accepted": false, "score": 5, "last_activity_date": 1432986204, "last_edit_date": 1432986204, "creation_date": 1432915673, "answer_id": 30534198, "question_id": 30532695, "link": "https://stackoverflow.com/questions/30532695/generating-diagram-of-haskell-data-structures/30534198#30534198", "title": "Generating diagram of Haskell data structures", "body": "<p>One option is to use the <a href=\"http://projects.haskell.org/diagrams/\" rel=\"nofollow noreferrer\"><code>diagrams</code></a> library, which has a variety of backends. The <code>diagrams-contrib</code> package includes auxiliary functions for <a href=\"http://hackage.haskell.org/package/diagrams-contrib-1.3.0/docs/Diagrams-TwoD-Layout-Tree.html\" rel=\"nofollow noreferrer\">rendering trees</a>. So perhaps you could convert your parse tree into a <a href=\"http://hackage.haskell.org/package/containers-0.5.6.3/docs/Data-Tree.html\" rel=\"nofollow noreferrer\">rose tree</a> from <code>Data.Tree</code> and render it in this way.</p>\n\n<p>The following example uses the SVG backend:</p>\n\n<pre><code>module Treeish where\n\n-- This example requires the containers, \n-- diagrams-core, diagrams-lib, diagrams-contrib and diagrams-svg packages\nimport Data.Tree\nimport Diagrams.Prelude \nimport Diagrams.TwoD.Layout.Tree (renderTree,symmLayout',_slHSep,_slVSep)\nimport Diagrams.Backend.SVG (SVG)\nimport Diagrams.Backend.SVG.CmdLine (defaultMain)\n\nexampleTree :: Tree String\nexampleTree = Node \"A\" [Node \"B\" [], Node \"C\" []]\n\nrenderNodeTree :: Tree String -&gt; QDiagram SVG V2 Double Any\nrenderNodeTree nodeTree = renderTree \n    (\\a -&gt; letter a `atop` square 1.03 # fc white) \n    (~~) \n    (symmLayout' (with{ _slHSep = 3,  _slVSep = 2}) nodeTree)\n  where\n     letter a = text a # font \"monospace\" # fontSize (local 0.47) \n\nmain :: IO ()\nmain = defaultMain (renderNodeTree exampleTree)\n</code></pre>\n\n<p><a href=\"http://hackage.haskell.org/package/diagrams-contrib-1.3.0/docs/Diagrams-TwoD-Layout-Tree.html#v:renderTree\" rel=\"nofollow noreferrer\"><code>renderTree</code></a> is a function that, given a function that creates a diagram for a tree node, and a function that creates a line between two given points, returns a function that creates a diagram out of a tree that has been annotated with node positions.</p>\n\n<p>The position annotations are added using the <a href=\"http://hackage.haskell.org/package/diagrams-contrib-1.3.0/docs/Diagrams-TwoD-Layout-Tree.html#v:symmLayout-39-\" rel=\"nofollow noreferrer\"><code>symmLayout'</code></a> function. </p>\n\n<p><a href=\"http://hackage.haskell.org/package/diagrams-lib-1.3/docs/Diagrams-Util.html\" rel=\"nofollow noreferrer\"><code>with</code></a> is just a synonym for <code>default</code> from <code>Data.Default</code>.</p>\n\n<p><a href=\"http://hackage.haskell.org/package/diagrams-lib-1.2.0.8/docs/Diagrams-TrailLike.html#v:-126--126-\" rel=\"nofollow noreferrer\"><code>(~~)</code></a> creates a line between two points.</p>\n\n<p>When the program is run from the command line (with something like <code>runhaskell Treeish -o foo.svg -w 300</code>) it will generate a SVG file that can be viewed in the browser:</p>\n\n<p><img src=\"https://i.stack.imgur.com/R3cyh.jpg\" alt=\"enter image description here\"></p>\n\n<p><a href=\"http://original.livestream.com/pivotallabs/video?clipId=pla_d5335c67-cda3-45a2-81ef-547b26ce403d\" rel=\"nofollow noreferrer\">Here</a> and <a href=\"http://original.livestream.com/pivotallabs/video?clipId=pla_f55a313d-c5ed-4dbc-b5dd-71b67f30e11f\" rel=\"nofollow noreferrer\">here</a> are two parts of a recent tutorial on <code>diagrams</code>.</p>\n"}], "owner": {"reputation": 2779, "user_id": 977026, "user_type": "registered", "accept_rate": 68, "profile_image": "https://www.gravatar.com/avatar/15b767a2c3503f273e9ad5270e4efdc1?s=128&d=identicon&r=PG", "display_name": "Schiavini", "link": "https://stackoverflow.com/users/977026/schiavini"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 529, "favorite_count": 1, "answer_count": 2, "score": 5, "last_activity_date": 1432986204, "creation_date": 1432911113, "last_edit_date": 1432912264, "question_id": 30532695, "link": "https://stackoverflow.com/questions/30532695/generating-diagram-of-haskell-data-structures", "title": "Generating diagram of Haskell data structures", "body": "<p>I am searching for a tool that, given a file with several data structures in Haskell, is able to generate a diagram with the relationships between the data structures.</p>\n\n<p>I currently have a file with a parse tree (+- 600 lines) and I'd like to see the parse tree more visually. What are my options?</p>\n\n<p>Thanks in advance.</p>\n"}, {"tags": ["haskell"], "comments": [{"owner": {"reputation": 48129, "user_id": 76051, "user_type": "registered", "accept_rate": 91, "profile_image": "https://i.stack.imgur.com/AGDxz.jpg?s=128&g=1", "display_name": "Carsten", "link": "https://stackoverflow.com/users/76051/carsten"}, "edited": false, "score": 0, "creation_date": 1432909717, "post_id": 30531944, "comment_id": 49137845, "body": "why does it have to be <code>Functor</code>s <code>fmap</code>? - Why don&#39;t you just go with your definition (name it <code>imap</code> if you want ;) ) - if the function is useful for you go with it"}, {"owner": {"reputation": 51584, "user_id": 839246, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/9b0573c2b936b12828dd1e4cc04206dc?s=128&d=identicon&r=PG&f=1", "display_name": "bheklilr", "link": "https://stackoverflow.com/users/839246/bheklilr"}, "edited": false, "score": 0, "creation_date": 1432909747, "post_id": 30531944, "comment_id": 49137868, "body": "You can&#39;t put extra constraints on the <code>fmap</code> implementation like that, what if I tried <code>fmap show</code>?  Strings don&#39;t implement <code>Num</code>, so it doesn&#39;t typecheck.  You could instead make a <code>UnitFunctor</code> class with a <code>ufmap</code> function that adds the <code>Ord</code> and <code>Num</code> constraints, that would work just fine.  It can&#39;t be a true <code>Functor</code> with the restrictions you want, but there&#39;s nothing stopping you from making a restricted <code>Functor</code>."}, {"owner": {"reputation": 7575, "user_id": 663299, "user_type": "registered", "accept_rate": 91, "profile_image": "https://www.gravatar.com/avatar/f3a117b27e019d6d19b46698a21c8a11?s=128&d=identicon&r=PG", "display_name": "mhwombat", "link": "https://stackoverflow.com/users/663299/mhwombat"}, "edited": false, "score": 0, "creation_date": 1432910036, "post_id": 30531944, "comment_id": 49138072, "body": "Yeah, creating my own version of <code>fmap</code> is a reasonable solution."}], "answers": [{"tags": [], "owner": {"reputation": 64094, "user_id": 476408, "user_type": "registered", "accept_rate": 70, "profile_image": "https://www.gravatar.com/avatar/2bc1bffafe7aa29ef900b98d1fd1e94e?s=128&d=identicon&r=PG", "display_name": "J. Abrahamson", "link": "https://stackoverflow.com/users/476408/j-abrahamson"}, "is_accepted": false, "score": 5, "last_activity_date": 1432910429, "creation_date": 1432910429, "answer_id": 30532458, "question_id": 30531944, "link": "https://stackoverflow.com/questions/30531944/a-type-thats-easy-to-do-arithmetic-with-and-is-guaranteed-in-bounds/30532458#30532458", "title": "A type that&#39;s easy to do arithmetic with and is guaranteed in bounds", "body": "<p>You're going to face some difficulty with what you ask because the numbers on [0, 1] are not <em>closed</em> under the <code>(+)</code> operation. In other words, the \"within [0, 1]\" guarantee is not preserved by addition.</p>\n\n<p>So there are a few ways to interpret what you want. One is that you could be looking for \"phases\" of operation between each you re-constrain the values to lie on [0, 1]</p>\n\n<pre><code>mapConstrain :: (Num a, Ord a) =&gt; (a -&gt; a) -&gt; (UnitInterval a -&gt; UnitInterval a)\nmapConstrain f (UnitInterval val) = UnitInterval (max 0 (min 1 (f val)))\n</code></pre>\n\n<p>Having operations like this alone will be constraining you will find as it is difficult to write something like</p>\n\n<pre><code>a :: UnitInterval Double\nb :: UnitInterval Double\na + b\n</code></pre>\n\n<p>using <code>mapConstrain</code>. The <code>Applicative</code> typeclass suggests a mechanism for lifting this issue, however.</p>\n\n<p>Another way forward would be to do constraining after every operation. Then we could instantiate <code>Num</code></p>\n\n<pre><code>newtype UnitInterval a = UI a\n\nconstrain :: (Num a, Ord a) =&gt; a -&gt; a\nconstrain = max 0 . min 1\n\ninstance Num a =&gt; Num (UnitInterval a) where\n  UI a + UI b = UI (constrain $ a + b)\n  UI a * UI b = UI (constrain $ a * b) -- not technically needed!\n  abs (UI a)  = UI a\n  signum (UI a) = UI (signum a)\n  ...\n</code></pre>\n\n<p>The final way forward is to allow for unbounded operations but only let users \"view\" <code>UnitInterval</code> values which are valid. This has perhaps the simplest implementation because you get to automatically derive <code>Num</code></p>\n\n<pre><code>newtype UnitInterval a = UI a deriving Num\n\ngetUI :: (Num a, Ord a) =&gt; UnitInterval a -&gt; Maybe a\ngetUI (UI a) = if (a &lt;= 1 &amp;&amp; a &gt;= 0) then Just a else Nothing\n</code></pre>\n\n<p>Alternatively, you could just hit it with one final <code>constrain</code>. Of course, this mode of operation allows <code>UnitInterval</code> values to go outside of [0, 1] so long as they arrive back there before being viewed.</p>\n"}, {"tags": [], "owner": {"reputation": 44013, "user_id": 1477667, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/trgKM.jpg?s=128&g=1", "display_name": "dfeuer", "link": "https://stackoverflow.com/users/1477667/dfeuer"}, "is_accepted": false, "score": 1, "last_activity_date": 1432940049, "creation_date": 1432940049, "answer_id": 30540279, "question_id": 30531944, "link": "https://stackoverflow.com/questions/30531944/a-type-thats-easy-to-do-arithmetic-with-and-is-guaranteed-in-bounds/30540279#30540279", "title": "A type that&#39;s easy to do arithmetic with and is guaranteed in bounds", "body": "<p>When I think about numbers between zero and one, I tend to think about one of two things:</p>\n\n<h3>Rational numbers</h3>\n\n<pre><code>data SM = SM {diff :: Natural, den :: Natural}\n\ntoRatio :: SM -&gt; Ratio Natural\ntoRatio (SM diff den) = (1 + den + diff) / (1 + den)\n\ninstance Eq SM where\n  SM diffx denx == SM diffy deny =\n     diffx * (deny + 1) == diffy * (denx + 1)\n</code></pre>\n\n<p>Such numbers are truly guaranteed to lie in the correct range.</p>\n\n<h3>Computable real numbers</h3>\n\n<p>These are much more horrible, but there's a package out there for them. Roughly speaking, you can represent numbers between 0 and 1 as infinite streams of bits. Implementing multiplication will be an interesting challenge; if you somehow manage to figure out division, you won't have to worry about division by zero because it will simply run forever.</p>\n"}], "owner": {"reputation": 7575, "user_id": 663299, "user_type": "registered", "accept_rate": 91, "profile_image": "https://www.gravatar.com/avatar/f3a117b27e019d6d19b46698a21c8a11?s=128&d=identicon&r=PG", "display_name": "mhwombat", "link": "https://stackoverflow.com/users/663299/mhwombat"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 88, "favorite_count": 0, "answer_count": 2, "score": 6, "last_activity_date": 1432940049, "creation_date": 1432909091, "question_id": 30531944, "link": "https://stackoverflow.com/questions/30531944/a-type-thats-easy-to-do-arithmetic-with-and-is-guaranteed-in-bounds", "title": "A type that&#39;s easy to do arithmetic with and is guaranteed in bounds", "body": "<p>Bear with me... this problem takes some explaining, but I think it's an interesting problem, and I assume others have faced it.</p>\n\n<p>I would like to have a type that I <em>know</em> will always have a value between 0 and 1, inclusive.\nThat's easy enough to do, I can create a type <code>UnitInterval</code> and only expose my smart constructor, <code>toUnitInterval</code> and deconstructor <code>fromUnitInterval</code>.</p>\n\n<pre><code>{-# LANGUAGE GeneralizedNewtypeDeriving #-}\n\n-- | A number on the unit interval 0 to 1, inclusive.\nnewtype UnitInterval = UnitInterval Double\n  deriving (Show, Eq, Ord, Fractional, Floating)\n\n-- | Convert a value to a @UnitInterval@. The value will be capped to\n--   the unit interval.\ntoUnitInterval :: Double -&gt; UnitInterval\ntoUnitInterval = UnitInterval . max 0 . min 1\n\nfromUnitInterval :: UnitInterval -&gt; Double\nfromUnitInterval (UnitInterval x) = x\n</code></pre>\n\n<p>So far so good. But users of my module will find that arithmetic with <code>UnitInterval</code>s and <code>Double</code>s is messy. For example, </p>\n\n<pre><code>\u03bb&gt; let a = toUnitInterval 0.5\n\u03bb&gt; let b = 0.25 :: Double\n\u03bb&gt; toUnitInterval $ (fromUnitInterval a) * b\nUnitInterval 0.125\n</code></pre>\n\n<p>Of course I could make <code>UnitInterval</code> a derived instance of <code>Num</code>, so I can easily do arithmetic as long as I stick to <code>UnitInterval</code>s.</p>\n\n<pre><code>\u03bb&gt; a*a\nUnitInterval 0.25\n\u03bb&gt; a+a+a\nUnitInterval 1.5 -- Oops! out of range\n</code></pre>\n\n<p>But I could write a custom implementation of <code>Num</code> for <code>UnitInterval</code>s, where operations like <code>+</code> do bounds checking.\nBut users of my module will need to do complex calculations where partial results won't be in range.\nSo they'll have to convert everything to <code>Double</code>s, do the calculation, and convert back to <code>UnitInterval</code>s at the end.</p>\n\n<p>But wait... maybe there's a better way. I could make <code>UnitInterval</code> a functor!\nAn expression like <code>fmap (\\x -&gt; x * exp x) a</code> should give the result \n<code>UnitInterval 0.8243606353500641</code>.\nNice, clean code.\nNow, <code>Functor</code> has the kind <code>(* \u2192 *)</code>, and <code>UnitInterval</code> has the kind <code>*</code>. \nBut I can change that, like so...</p>\n\n<pre><code>{-# LANGUAGE GeneralizedNewtypeDeriving #-}\n\n-- | A number on the unit interval 0 to 1, inclusive.\nnewtype UnitInterval a = UnitInterval a\n  deriving (Show, Eq, Ord, Num, Fractional, Floating)\n\n-- | Convert a value to a @UnitInterval@. The value will be capped to\n--   the unit interval.\ntoUnitInterval :: (Num a, Ord a) =&gt; a -&gt; UnitInterval a\ntoUnitInterval = UnitInterval . max 0 . min 1\n\nfromUnitInterval :: UnitInterval a -&gt; a\nfromUnitInterval (UnitInterval x) = x\n\ninstance Functor UnitInterval  where\n  fmap f (UnitInterval x) = toUnitInterval (f x) -- line 16\n</code></pre>\n\n<p>But that doesn't compile.\nAnd in hindsight, I see that's because I would need to constrain the result of <code>fmap</code>,\nwhich would give it a different type signature than the one in <code>Functor</code>.</p>\n\n<pre><code>amy.hs:16:29:\n    No instance for (Num b) arising from a use of \u2018toUnitInterval\u2019\n    Possible fix:\n      add (Num b) to the context of\n        the type signature for\n          fmap \u2237 (a \u2192 b) \u2192 UnitInterval a \u2192 UnitInterval b\n    In the expression: toUnitInterval (f x)\n    In an equation for \u2018fmap\u2019:\n        fmap f (UnitInterval x) = toUnitInterval (f x)\n    In the instance declaration for \u2018Functor UnitInterval\u2019\n</code></pre>\n\n<p>Sigh... back to the first version, with ugly arithmetic. Does anyone have a better solution?</p>\n"}, {"tags": ["haskell", "persistence", "yesod"], "answers": [{"comments": [{"owner": {"reputation": 716, "user_id": 4118267, "user_type": "registered", "accept_rate": 73, "profile_image": "https://i.stack.imgur.com/xIgkR.jpg?s=128&g=1", "display_name": "oriaj", "link": "https://stackoverflow.com/users/4118267/oriaj"}, "edited": false, "score": 0, "creation_date": 1432915060, "post_id": 30532282, "comment_id": 49141648, "body": "Great, it works! Thanks!, i need modify the YesodDispatch, as well <code>instance (Yesod master,RenderMessage master FormMessage, YesodPersist master, YesodPersistBackend master ~ SqlBackend)        =&gt; YesodSubDispatch DemoCrud (HandlerT master IO)        where      yesodSubDispatch = $(mkYesodSubDispatch resourcesDemoCrud)</code>"}], "tags": [], "owner": {"reputation": 1657, "user_id": 4183787, "user_type": "registered", "accept_rate": 62, "profile_image": "https://i.stack.imgur.com/XedpJ.png?s=128&g=1", "display_name": "zigazou", "link": "https://stackoverflow.com/users/4183787/zigazou"}, "is_accepted": true, "score": 1, "last_activity_date": 1432909941, "last_edit_date": 1495542112, "creation_date": 1432909941, "answer_id": 30532282, "question_id": 30531861, "link": "https://stackoverflow.com/questions/30531861/use-rundb-in-a-subsite-yesod/30532282#30532282", "title": "use runDB in a SubSite Yesod", "body": "<p>You need to add the following constraint to the <code>postDemoNewR</code> declaration:</p>\n\n<pre><code>YesodPersist master =&gt; YesodPersistBackend master ~ SqlBackend =&gt; \u2026\n</code></pre>\n\n<p>The first constraint tells <code>master</code> must have persistent abilities while the second constraint tells the backend used for persistent should be an SQL backend.</p>\n\n<p><a href=\"https://stackoverflow.com/questions/29961138/how-to-create-a-custom-field-which-queries-the-database\">You can find something similar in this other question</a></p>\n"}], "owner": {"reputation": 716, "user_id": 4118267, "user_type": "registered", "accept_rate": 73, "profile_image": "https://i.stack.imgur.com/xIgkR.jpg?s=128&g=1", "display_name": "oriaj", "link": "https://stackoverflow.com/users/4118267/oriaj"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 111, "favorite_count": 0, "accepted_answer_id": 30532282, "answer_count": 1, "score": 0, "last_activity_date": 1432909941, "creation_date": 1432908798, "question_id": 30531861, "link": "https://stackoverflow.com/questions/30531861/use-rundb-in-a-subsite-yesod", "title": "use runDB in a SubSite Yesod", "body": "<p>i want create a post method in a SubSite to create a new entity, i have this AForm</p>\n\n<pre><code>demoForm :: RenderMessage master FormMessage =&gt; Maybe Demo -&gt; AForm    (HandlerT master IO) Demo\ndemoForm   demo = Demo \n            &lt;$&gt; areq textField (fieldSettingsLabel (\"fieldone\"::T.Text))   (demoFieldOne &lt;$&gt; demo)\n            &lt;*&gt; areq intField  (fieldSettingsLabel (\"fieldone\"::T.Text))   (demoFieldTwo &lt;$&gt; demo)\n            &lt;*&gt; areq boolField (fieldSettingsLabel (\"fieldThree\"::T.Text)) (demoFieldThree &lt;$&gt; demo) \n            &lt;*&gt; areq dayField  (fieldSettingsLabel (\"fieldFour\"::T.Text))  (demoFieldFour &lt;$&gt; demo) \n</code></pre>\n\n<p>and the Post method:</p>\n\n<pre><code>   postDemoNewR :: (Yesod master,RenderMessage master FormMessage) =&gt; HandlerT DemoCrud (HandlerT master IO) Html\n   postDemoNewR = do\n            tp &lt;- getRouteToParent \n            ((result,widget), encoding) &lt;- lift $ runFormPost $ renderBootstrap3 BootstrapBasicForm $ demoForm  Nothing\n            case result of\n                 FormSuccess demo -&gt; do\n\n                             _ &lt;- lift $  runDB $ insert demo\n                             redirect DemoNewR\n                 _ -&gt; lift $ defaultLayout $ do\n                 let actionR = DemoNewR                \n                 [whamlet|\n                    &lt;form method=post action=@{tp DemoNewR} encType=#{encoding}&gt;\n                          ^{widget}\n                    &lt;button .btn .btn-default&gt; default text create\n               |]\n</code></pre>\n\n<p>but have the following error</p>\n\n<pre><code>  Could not deduce (YesodPersistBackend master\n                  ~ persistent-2.1.3:Database.Persist.Sql.Types.SqlBackend)\nfrom the context (Yesod master, RenderMessage master FormMessage)\n  bound by the type signature for\n             postDemoNewR :: (Yesod master, RenderMessage master FormMessage) =&gt;\n</code></pre>\n\n<p>I thing that I need add YesodPersist but i'm not sure how</p>\n"}, {"tags": ["haskell", "template-haskell"], "comments": [{"owner": {"reputation": 51584, "user_id": 839246, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/9b0573c2b936b12828dd1e4cc04206dc?s=128&d=identicon&r=PG&f=1", "display_name": "bheklilr", "link": "https://stackoverflow.com/users/839246/bheklilr"}, "edited": false, "score": 3, "creation_date": 1432906693, "post_id": 30530282, "comment_id": 49135634, "body": "I can understand wanting an example to learn TH with, but this would be easier to do with <code>lookup&#39; key = fromJust . Map.lookup key</code>"}, {"owner": {"reputation": 721, "user_id": 2512324, "user_type": "registered", "accept_rate": 76, "profile_image": "https://www.gravatar.com/avatar/f9d51819edf28a5befe8b255e51d95d7?s=128&d=identicon&r=PG", "display_name": "user2512324", "link": "https://stackoverflow.com/users/2512324/user2512324"}, "reply_to_user": {"reputation": 51584, "user_id": 839246, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/9b0573c2b936b12828dd1e4cc04206dc?s=128&d=identicon&r=PG&f=1", "display_name": "bheklilr", "link": "https://stackoverflow.com/users/839246/bheklilr"}, "edited": false, "score": 1, "creation_date": 1432910834, "post_id": 30530282, "comment_id": 49138664, "body": "@bheklilr I am quite aware of that but I just wanted to know if it could be done using TH just out of curiosity."}, {"owner": {"reputation": 58792, "user_id": 1006010, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/f683d229f3673c9dcc3f3f2796d75c09?s=128&d=identicon&r=PG", "display_name": "MathematicalOrchid", "link": "https://stackoverflow.com/users/1006010/mathematicalorchid"}, "edited": false, "score": 2, "creation_date": 1432912280, "post_id": 30530282, "comment_id": 49139831, "body": "Another possibility that isn&#39;t TH is to just write a normal Haskell function that saves Haskell source code to another file, and then compile that file as normal. Just throwing that out there..."}, {"owner": {"reputation": 721, "user_id": 2512324, "user_type": "registered", "accept_rate": 76, "profile_image": "https://www.gravatar.com/avatar/f9d51819edf28a5befe8b255e51d95d7?s=128&d=identicon&r=PG", "display_name": "user2512324", "link": "https://stackoverflow.com/users/2512324/user2512324"}, "reply_to_user": {"reputation": 58792, "user_id": 1006010, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/f683d229f3673c9dcc3f3f2796d75c09?s=128&d=identicon&r=PG", "display_name": "MathematicalOrchid", "link": "https://stackoverflow.com/users/1006010/mathematicalorchid"}, "edited": false, "score": 1, "creation_date": 1432923638, "post_id": 30530282, "comment_id": 49146589, "body": "@MathematicalOrchid That too is an option for solving the problem without using TH"}], "answers": [{"tags": [], "owner": {"reputation": 314794, "user_id": 67579, "user_type": "registered", "accept_rate": 81, "profile_image": "https://i.stack.imgur.com/BJXub.png?s=128&g=1", "display_name": "Willem Van Onsem", "link": "https://stackoverflow.com/users/67579/willem-van-onsem"}, "is_accepted": true, "score": 6, "last_activity_date": 1433800258, "last_edit_date": 1495535203, "creation_date": 1433708476, "answer_id": 30698081, "question_id": 30530282, "link": "https://stackoverflow.com/questions/30530282/generate-a-function-using-template-haskell/30698081#30698081", "title": "Generate a function using Template Haskell", "body": "<p>You can do this using two files:</p>\n\n<p>a \"maker\" file: <strong><code>Maker.hs</code></strong>:</p>\n\n<pre><code>module Maker where\n\n{-# LANGUAGE TemplateHaskell #-}\n\nimport Language.Haskell.TH\n\nmaker items = do\n    x &lt;- newName \"x\"\n    lamE [varP x] (caseE (varE x) (map (\\(a,b) -&gt; match (litP $ stringL a) (normalB $ litE $ integerL b) []) items))\n</code></pre>\n\n<p>and the main file: <strong><code>Main.hs</code></strong>:</p>\n\n<pre><code>{-# LANGUAGE TemplateHaskell #-}\n\nimport Language.Haskell.TH\nimport Maker\n\nfunction = $(maker [(\"five\",5),(\"six\",6)])\n</code></pre>\n\n<p>In that case <code>function</code> will be of the type <code>[Char] -&gt; Int</code> and will be compiled as:</p>\n\n<pre><code>\\x -&gt; case x of\n    \"five\" -&gt; 5\n    \"six\" -&gt; 6\n</code></pre>\n\n<p>It is thus as if you would have written:</p>\n\n<pre><code>function = \\x -&gt; case x of\n    \"five\" -&gt; 5\n    \"six\" -&gt; 6\n</code></pre>\n\n<p>yourself. Evidently that's not going to pay off for two or three cases, but as you have written in the question yourself, when you want to use thousands of cases, or a list of items generated by list comprehension, this starts to pay off.</p>\n\n<h1>Making template Haskell yourself</h1>\n\n<p>This section aims to briefly describe how to write template Haskell yourself. This tutorial is not <em>\"a complete introduction to...\"</em>: there are other techniques to do this.</p>\n\n<p>In order to write template Haskell, you can first try a few expressions, and then try to <em>generalize</em> them using <code>map</code>, <code>fold</code>, etc.</p>\n\n<h2>Analyze the AST tree</h2>\n\n<p>First you better take a look on how Haskell would parse a certain expression itself. You can do this with <code>runQ</code> and brackets <a href=\"https://stackoverflow.com/a/7489277/67579\"><code>[| ... |]</code></a> with <code>...</code> the expression you wish to analyze. So for instance:</p>\n\n<pre><code>$ ghci -XTemplateHaskell\nGHCi, version 7.6.3: http://www.haskell.org/ghc/  :? for help\nLoading package ghc-prim ... linking ... done.\nLoading package integer-gmp ... linking ... done.\nLoading package base ... linking ... done.\nPrelude&gt; :m Language.Haskell.TH\nPrelude Language.Haskell.TH&gt; runQ [| \\x -&gt; case x of \"five\" -&gt; 5; \"six\" -&gt; 6 |]\nLoading package array-0.4.0.1 ... linking ... done.\nLoading package deepseq-1.3.0.1 ... linking ... done.\nLoading package containers-0.5.0.0 ... linking ... done.\nLoading package pretty-1.1.1.0 ... linking ... done.\nLoading package template-haskell ... linking ... done.\nLamE [VarP x_0] (CaseE (VarE x_0) [Match (LitP (StringL \"five\")) (NormalB (LitE (IntegerL 5))) [],Match (LitP (StringL \"six\")) (NormalB (LitE (IntegerL 6))) []])\n</code></pre>\n\n<p>The AST is thus:</p>\n\n<pre><code>LamE [VarP x_0] (CaseE (VarE x_0) [Match (LitP (StringL \"five\")) (NormalB (LitE (IntegerL 5))) [],Match (LitP (StringL \"six\")) (NormalB (LitE (IntegerL 6))) []])\n</code></pre>\n\n<p>So now we have <em>derived</em> the <em>Abstract Syntax Tree (AST)</em> from that expression. A hint is to make the expressions generic enough. For instance use multiple cases in the <code>case</code> block, since using a single case doesn't tell you how you should add a second one to your expression. Now we wish to create such abstract syntax tree ourselves.</p>\n\n<h2>Create variable names</h2>\n\n<p>A first aspect is the variables, like <code>VarP x_0</code> and <code>VarE x_0</code>. You cannot simply <em>copy-paste</em> them. Here <code>x_0</code> is a name. In order to make sure you don't use a name that already exists, you can use <code>newName</code>.  Now you can construct the following expression to fully replicate it:</p>\n\n<pre><code>maker = do\n    x &lt;- newName \"x\"\n    return $ LamE [VarP x] (CaseE (VarE x) [Match (LitP (StringL \"five\")) (NormalB (LitE (IntegerL 5))) [],Match (LitP (StringL \"six\")) (NormalB (LitE (IntegerL 6))) []])\n</code></pre>\n\n<h2>Generalize the function</h2>\n\n<p>Evidently we are not interested in constructing a fixed abstract syntax tree, otherwise we could have written it ourselves. Now the point is that you introduce one or more variables, and reason about that variables. For every tuple <code>(\"five\",5)</code>, etc. we introduce a <code>Match</code> statement:</p>\n\n<pre><code>Match (LitP (StringL \"five\")) (NormalB (LitE (IntegerL 5))) []\n</code></pre>\n\n<p>Now we can easily generalize this with <code>\\(a,b)</code>:</p>\n\n<pre><code>\\(a,b) -&gt; Match (LitP (StringL a)) (NormalB (LitE (IntegerL b))) []\n</code></pre>\n\n<p>and then use the <code>map</code> to iterate over all items:</p>\n\n<pre><code>map (\\(a,b) -&gt; Match (LitP (StringL a)) (NormalB (LitE (IntegerL b))) []) items\n</code></pre>\n\n<p>with <code>items</code> the list of tuples for which we wish to generate cases. Now we're done:</p>\n\n<pre><code>maker items = do\n    x &lt;- newName \"x\"\n    return $ LamE [VarP x] (CaseE (VarE x) (map (\\(a,b) -&gt; Match (LitP (StringL a)) (NormalB (LitE (IntegerL b))) []) items))\n</code></pre>\n\n<p>Now you can simply omit the <code>return</code> because the library has lowercase variants for all these items. You can furthermore try to \"<em>cleanup</em>\" the code a little bit (like for instance <code>(NormalB (LitE (IntegerL b)))</code> to <code>(NormalB $ LitE $ IntegerL b)</code>, etc.); for instance using <code>hlint</code>.</p>\n\n<pre><code>maker items = do\n    x &lt;- newName \"x\"\n    lamE [varP x] (caseE (varE x) (map (\\(a,b) -&gt; match (litP $ stringL a) (normalB $ litE $ integerL b) []) items))\n</code></pre>\n\n<p>The <em>maker</em> here is some kind of function that makes/constructs the function.</p>\n\n<h2>Careful for <em>infinite lists</em></h2>\n\n<p>Be aware that the compiler will evaluate what it is in between the dollar brackets <code>$()</code>. If you for instance would use an infinite list:</p>\n\n<pre><code>function = $(maker [(show i,i)|i&lt;-[1..]]) -- Don't do this!\n</code></pre>\n\n<p>This will keep allocating memory for the abstract syntax tree and eventually run out of memory. The compiler does <em>not</em> expand an AST at run time.</p>\n"}, {"tags": [], "owner": {"reputation": 20862, "user_id": 376113, "user_type": "registered", "accept_rate": 72, "profile_image": "https://www.gravatar.com/avatar/d3a5bd12fe6d876527a3cf4ac0de5fc6?s=128&d=identicon&r=PG", "display_name": "mb14", "link": "https://stackoverflow.com/users/376113/mb14"}, "is_accepted": false, "score": 2, "last_activity_date": 1433709350, "creation_date": 1433709350, "answer_id": 30698220, "question_id": 30530282, "link": "https://stackoverflow.com/questions/30530282/generate-a-function-using-template-haskell/30698220#30698220", "title": "Generate a function using Template Haskell", "body": "<p>Yes</p>\n\n<pre><code>import Language.Haskell.TH\n\ngenerateDict :: String -&gt; [(String, Int)] -&gt; Q [Dec]\ngenerateDict fname sns = do\n    let clauses = map clause sns\n    return $ [FunD (mkName fname) clauses]\n        where clause (s,n) =\n                Clause [LitP . IntegerL $ toInteger  n]\n                       (NormalB . LitE $ StringL s )\n                       []\n</code></pre>\n\n<p>And then</p>\n\n<pre><code>generateDict \"myDict\" $ zip (words \"One Two Tree Four\") [1..]\n\nmyDict 1 -- =&gt; \"One\"\n</code></pre>\n"}], "owner": {"reputation": 721, "user_id": 2512324, "user_type": "registered", "accept_rate": 76, "profile_image": "https://www.gravatar.com/avatar/f9d51819edf28a5befe8b255e51d95d7?s=128&d=identicon&r=PG", "display_name": "user2512324", "link": "https://stackoverflow.com/users/2512324/user2512324"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 694, "favorite_count": 2, "accepted_answer_id": 30698081, "answer_count": 2, "score": 10, "last_activity_date": 1433800258, "creation_date": 1432904351, "last_edit_date": 1433700180, "question_id": 30530282, "link": "https://stackoverflow.com/questions/30530282/generate-a-function-using-template-haskell", "title": "Generate a function using Template Haskell", "body": "<p>Is it possible to define a function using Template Haskell? For example </p>\n\n<pre><code>convertStringToValue :: String -&gt; Int\nconvertStringToValue \"three\" = 3\nconvertStringToValue \"four\" = 4\n</code></pre>\n\n<p>I also have a <code>Map [Char] Int</code>.</p>\n\n<pre><code>fromList [(\"five\",5),(\"six\",6)]\n</code></pre>\n\n<p>How can I add functions </p>\n\n<pre><code>convertStringToValue \"six\" = 6\nconvertStringToValue \"five\" = 5\n</code></pre>\n\n<p>at compile time using Template Haskell and the <code>Map</code>? It appears quite silly to use Template Haskell for this purpose but I would like to know nevertheless. </p>\n"}, {"tags": ["xml", "haskell", "copy", "equality"], "comments": [{"owner": {"reputation": 51584, "user_id": 839246, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/9b0573c2b936b12828dd1e4cc04206dc?s=128&d=identicon&r=PG&f=1", "display_name": "bheklilr", "link": "https://stackoverflow.com/users/839246/bheklilr"}, "edited": false, "score": 1, "creation_date": 1432905206, "post_id": 30528241, "comment_id": 49134580, "body": "You don&#39;t want to fix the last problem, the <code>&amp;</code> symbol is reserved in XML and gets encoded as <code>&amp;amp;</code>.  Any and every XML decoder will recognize that correctly.  HXT is actually cleaning up your input for you, as your input wasn&#39;t valid XML to begin with.  I would leave those the same.  If you&#39;re worried about it being &quot;human readable&quot;, then don&#39;t use XML as a configuration format, use YAML or JSON or INI or anything but XML, which is designed to be computer readable, not human readable."}, {"owner": {"reputation": 668, "user_id": 2155544, "user_type": "registered", "accept_rate": 56, "profile_image": "https://www.gravatar.com/avatar/caae6ef08bc308aaa3c34324286bad6d?s=128&d=identicon&r=PG", "display_name": "Michael restore Monica Cellio", "link": "https://stackoverflow.com/users/2155544/michael-restore-monica-cellio"}, "reply_to_user": {"reputation": 51584, "user_id": 839246, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/9b0573c2b936b12828dd1e4cc04206dc?s=128&d=identicon&r=PG&f=1", "display_name": "bheklilr", "link": "https://stackoverflow.com/users/839246/bheklilr"}, "edited": false, "score": 0, "creation_date": 1432933088, "post_id": 30528241, "comment_id": 49151205, "body": "I <i>do</i> want to fix that last problem.  The original file contained an entity within an attribute value which would be expanded to the value of the entity by the processor.  The re-written file would have as the attribute value an ampersand followed by some letters followed by a semi-colon."}, {"owner": {"reputation": 51584, "user_id": 839246, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/9b0573c2b936b12828dd1e4cc04206dc?s=128&d=identicon&r=PG&f=1", "display_name": "bheklilr", "link": "https://stackoverflow.com/users/839246/bheklilr"}, "edited": false, "score": 0, "creation_date": 1432934253, "post_id": 30528241, "comment_id": 49151710, "body": "That would make your XML file non-compliant, just saying.  And again, if you were to load that back in with HXT or HaXml the text of that attribute would be exactly <code>&quot;&amp;Label;&quot;</code>, you could still do your processing on it.  However, it&#39;s being stored in the file as <code>&quot;&amp;amp;Label;&quot;</code> because <code>&amp;</code> is a <a href=\"http://www.w3resource.com/xml/reserved-markup-characters.php\" rel=\"nofollow noreferrer\">reserved character for XML</a>.  It&#39;s like if you wanted an element like <code>&lt;test&gt;&lt;&lt;&#47;test&gt;</code>, this wouldn&#39;t parse well because of the extra <code>&lt;</code>, instead you would have in the XML file <code>&lt;test&gt;&amp;lt;&lt;&#47;test&gt;</code>."}, {"owner": {"reputation": 51584, "user_id": 839246, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/9b0573c2b936b12828dd1e4cc04206dc?s=128&d=identicon&r=PG&f=1", "display_name": "bheklilr", "link": "https://stackoverflow.com/users/839246/bheklilr"}, "edited": false, "score": 0, "creation_date": 1432934279, "post_id": 30528241, "comment_id": 49151718, "body": "What happens when someone tries to have a variable name (presuming substitution here) of <code>lt</code>, <code>gt</code>, <code>amp</code>, <code>apos</code>, <code>quot</code>?"}, {"owner": {"reputation": 668, "user_id": 2155544, "user_type": "registered", "accept_rate": 56, "profile_image": "https://www.gravatar.com/avatar/caae6ef08bc308aaa3c34324286bad6d?s=128&d=identicon&r=PG", "display_name": "Michael restore Monica Cellio", "link": "https://stackoverflow.com/users/2155544/michael-restore-monica-cellio"}, "reply_to_user": {"reputation": 51584, "user_id": 839246, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/9b0573c2b936b12828dd1e4cc04206dc?s=128&d=identicon&r=PG&f=1", "display_name": "bheklilr", "link": "https://stackoverflow.com/users/839246/bheklilr"}, "edited": false, "score": 0, "creation_date": 1432941755, "post_id": 30528241, "comment_id": 49154241, "body": "Regrettably I still don&#39;t understand your point.  If the input file contained for example <code>&lt;tag attr=&quot;&amp;apos;&quot;&gt;</code> then the output would be <code>&lt;tag attr=&quot;&amp;amp;apos;&quot;&gt;</code> and I just don&#39;t understand how (1) the input is ill-formed/non-compliant and (2) the output is equivalent to the input or a corrected version of the input."}, {"owner": {"reputation": 51584, "user_id": 839246, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/9b0573c2b936b12828dd1e4cc04206dc?s=128&d=identicon&r=PG&f=1", "display_name": "bheklilr", "link": "https://stackoverflow.com/users/839246/bheklilr"}, "edited": false, "score": 0, "creation_date": 1432943549, "post_id": 30528241, "comment_id": 49154628, "body": "The xml standard used several characters in its syntax that can lead to ambiguity when parsing. The standard then accounts for this by allowing them to be interpreted by special escape sequences, much as you might have <code>\\n</code> in a haskell string to indicate a literal new line character. When one of these escape sequences is found, a compliant parser will instead return the actual character that sequence represents. Your desired substitution syntax overlaps with xml escape sequences, in that it uses the same syntax. Hxt tries to help out by correctly encoding those sequences."}, {"owner": {"reputation": 51584, "user_id": 839246, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/9b0573c2b936b12828dd1e4cc04206dc?s=128&d=identicon&r=PG&f=1", "display_name": "bheklilr", "link": "https://stackoverflow.com/users/839246/bheklilr"}, "edited": false, "score": 0, "creation_date": 1432943649, "post_id": 30528241, "comment_id": 49154648, "body": "If you tried to parse an attribute containing <code>&amp;apos;</code>, it would be read in as the character <code>&#39;</code> (a single apostrophe) and NOT as the string <code>&quot;&amp;apos;&quot;</code>."}, {"owner": {"reputation": 668, "user_id": 2155544, "user_type": "registered", "accept_rate": 56, "profile_image": "https://www.gravatar.com/avatar/caae6ef08bc308aaa3c34324286bad6d?s=128&d=identicon&r=PG", "display_name": "Michael restore Monica Cellio", "link": "https://stackoverflow.com/users/2155544/michael-restore-monica-cellio"}, "reply_to_user": {"reputation": 51584, "user_id": 839246, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/9b0573c2b936b12828dd1e4cc04206dc?s=128&d=identicon&r=PG&f=1", "display_name": "bheklilr", "link": "https://stackoverflow.com/users/839246/bheklilr"}, "edited": false, "score": 0, "creation_date": 1432948832, "post_id": 30528241, "comment_id": 49155649, "body": "If I had an attribute containing <code>&amp;apos;</code> I would expect it to be read as <code>&#39;</code>.  That is exactly what i would want.  Similarly, with <code>attr=&quot;&amp;Field;&quot;</code> I would expect <code>attr</code> to have the value <code>thing</code> taken from an <code>&lt;ENTITY Field &quot;thing&quot;&gt;</code> declaration elsewhere in a DTD.  That would be during &#39;normal&#39; processing.  But I am asking about what apparently is called round-trip processing, where the output should be equal to the input, except for explicit transformations performed by my code;  i.e., entity substitutions should not be made."}, {"owner": {"reputation": 668, "user_id": 2155544, "user_type": "registered", "accept_rate": 56, "profile_image": "https://www.gravatar.com/avatar/caae6ef08bc308aaa3c34324286bad6d?s=128&d=identicon&r=PG", "display_name": "Michael restore Monica Cellio", "link": "https://stackoverflow.com/users/2155544/michael-restore-monica-cellio"}, "reply_to_user": {"reputation": 51584, "user_id": 839246, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/9b0573c2b936b12828dd1e4cc04206dc?s=128&d=identicon&r=PG&f=1", "display_name": "bheklilr", "link": "https://stackoverflow.com/users/839246/bheklilr"}, "edited": false, "score": 0, "creation_date": 1432952907, "post_id": 30528241, "comment_id": 49156367, "body": "OK, I do now see what you&#39;re saying and I&#39;ll have to think further on how to achieve what I want."}], "owner": {"reputation": 668, "user_id": 2155544, "user_type": "registered", "accept_rate": 56, "profile_image": "https://www.gravatar.com/avatar/caae6ef08bc308aaa3c34324286bad6d?s=128&d=identicon&r=PG", "display_name": "Michael restore Monica Cellio", "link": "https://stackoverflow.com/users/2155544/michael-restore-monica-cellio"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 75, "favorite_count": 0, "answer_count": 0, "score": 3, "last_activity_date": 1432899588, "creation_date": 1432898338, "last_edit_date": 1432899588, "question_id": 30528241, "link": "https://stackoverflow.com/questions/30528241/copying-xml-input-to-output-verbatim-in-haskell", "title": "Copying XML input to output verbatim in Haskell", "body": "<p>As per title.  The application is user-written configuration files which might from time to time have to be updated in certain parts but otherwise should be unchanged.  A starting point is just to be able to pass input to output unchanged.</p>\n\n<p>I accept that the inputs <code>&lt;tag&gt;&lt;/tag&gt;</code> and <code>&lt;tag/&gt;</code> are pretty much equivalent and probably won't be distinguished on output but other than that, I'd like to preserve the XML as much as possible.</p>\n\n<p>The first attempt was <strong>Text.XML.HaXml.SAX.saxParse</strong> but that suppresses whitespace after a comment so that for example:</p>\n\n<pre><code>&lt;!-- next section: --&gt;\n&lt;section&gt;\n    ...\n&lt;/section&gt;\n</code></pre>\n\n<p>is parsed as:</p>\n\n<pre><code>&lt;!-- next section: --&gt;&lt;section&gt;\n    ...\n&lt;/section&gt;\n</code></pre>\n\n<p>which is an unacceptable change.  The next attempt was via HXT at <a href=\"http://pastebin.com/qNyVuBK7\" rel=\"nofollow\">http://pastebin.com/qNyVuBK7</a> and this works quite well except that entities in attribute data are munged;  e.g.,</p>\n\n<pre><code>&lt;view UID=\"&amp;Label;\" ifNotNull=\"&amp;Term;\"&gt;\n</code></pre>\n\n<p>becomes</p>\n\n<pre><code>&lt;view UID=\"&amp;amp;Label;\" ifNotNull=\"&amp;amp;Term;\"&gt;\n</code></pre>\n\n<p>even though entities in normal textual data are passed correctly.  Can anyone suggest how to fix that last problem, or another way to achieve the objective?</p>\n\n<p>It seems that <a href=\"https://hackage.haskell.org/package/roundtrip-xml-0.2.0.0\" rel=\"nofollow\">https://hackage.haskell.org/package/roundtrip-xml-0.2.0.0</a> might help but I can't find any documentation on how to use it.</p>\n"}, {"tags": ["haskell", "random", "lazy-evaluation", "infinite", "evaluation-strategy"], "comments": [{"owner": {"reputation": 28873, "user_id": 1068232, "user_type": "registered", "accept_rate": 79, "profile_image": "https://www.gravatar.com/avatar/2a0a145ce58c20013969fe3f203531da?s=128&d=identicon&r=PG", "display_name": "Andr&#225;s Kov&#225;cs", "link": "https://stackoverflow.com/users/1068232/andr%c3%a1s-kov%c3%a1cs"}, "edited": false, "score": 0, "creation_date": 1432897049, "post_id": 30527699, "comment_id": 49128914, "body": "You mean <code>main</code> terminates and <code>main&#39;</code> hangs?"}, {"owner": {"reputation": 33184, "user_id": 247623, "user_type": "registered", "accept_rate": 72, "profile_image": "https://www.gravatar.com/avatar/bb9e67348d3e0e93ef12dd97c41a6c22?s=128&d=identicon&r=PG&f=1", "display_name": "Erik Kaplun", "link": "https://stackoverflow.com/users/247623/erik-kaplun"}, "reply_to_user": {"reputation": 28873, "user_id": 1068232, "user_type": "registered", "accept_rate": 79, "profile_image": "https://www.gravatar.com/avatar/2a0a145ce58c20013969fe3f203531da?s=128&d=identicon&r=PG", "display_name": "Andr&#225;s Kov&#225;cs", "link": "https://stackoverflow.com/users/1068232/andr%c3%a1s-kov%c3%a1cs"}, "edited": false, "score": 0, "creation_date": 1432897103, "post_id": 30527699, "comment_id": 49128949, "body": "@Andr&#225;sKov&#225;cs yes, exactly."}, {"owner": {"reputation": 2846, "user_id": 4347335, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/eb7e6f293a134a5defec74e12cae42cc?s=128&d=identicon&r=PG&f=1", "display_name": "cchalmers", "link": "https://stackoverflow.com/users/4347335/cchalmers"}, "edited": false, "score": 3, "creation_date": 1432897867, "post_id": 30527699, "comment_id": 49129490, "body": "There&#39;s an important difference between the two. <code>evalRandIO</code> uses <code>IO</code> to get the initial generator, generating an infinite list from this doesn&#39;t require any more IO. <code>randomIO</code> requires an <code>IO</code> call for every random number, so it hangs when it tries to return in infinite list (unless you use <code>unsaveInterleaveIO</code>)."}, {"owner": {"reputation": 33184, "user_id": 247623, "user_type": "registered", "accept_rate": 72, "profile_image": "https://www.gravatar.com/avatar/bb9e67348d3e0e93ef12dd97c41a6c22?s=128&d=identicon&r=PG&f=1", "display_name": "Erik Kaplun", "link": "https://stackoverflow.com/users/247623/erik-kaplun"}, "reply_to_user": {"reputation": 2846, "user_id": 4347335, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/eb7e6f293a134a5defec74e12cae42cc?s=128&d=identicon&r=PG&f=1", "display_name": "cchalmers", "link": "https://stackoverflow.com/users/4347335/cchalmers"}, "edited": false, "score": 0, "creation_date": 1432903453, "post_id": 30527699, "comment_id": 49133344, "body": "@cchalmers: how would you use unsafeInterleaveIO in this case? I tried but couldn&#39;t figure it out."}, {"owner": {"reputation": 2846, "user_id": 4347335, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/eb7e6f293a134a5defec74e12cae42cc?s=128&d=identicon&r=PG&f=1", "display_name": "cchalmers", "link": "https://stackoverflow.com/users/4347335/cchalmers"}, "edited": false, "score": 1, "creation_date": 1432905080, "post_id": 30527699, "comment_id": 49134480, "body": "@ErikAllik I don&#39;t think you can use it with <code>sequence</code> because <code>sequence</code> already demands the full list. It works with something like <code>inf = do {r &lt;- randomIO; rs &lt;- unsafeInterleaveIO inf; return (r:rs)}</code>."}], "answers": [{"tags": [], "owner": {"reputation": 28873, "user_id": 1068232, "user_type": "registered", "accept_rate": 79, "profile_image": "https://www.gravatar.com/avatar/2a0a145ce58c20013969fe3f203531da?s=128&d=identicon&r=PG", "display_name": "Andr&#225;s Kov&#225;cs", "link": "https://stackoverflow.com/users/1068232/andr%c3%a1s-kov%c3%a1cs"}, "is_accepted": false, "score": 3, "last_activity_date": 1432898187, "creation_date": 1432898187, "answer_id": 30528180, "question_id": 30527699, "link": "https://stackoverflow.com/questions/30527699/infinite-random-sequence-loops-with-randomio-but-not-with-getrandom/30528180#30528180", "title": "Infinite random sequence loops with randomIO but not with getRandom", "body": "<p>Sequencing lists is strict in the IO monad but possibly lazy in the State monad. <code>Rand</code> is just a <a href=\"http://hackage.haskell.org/package/MonadRandom-0.4/docs/src/Control-Monad-Random.html#RandT\" rel=\"nofollow\">wrapped <code>StateT</code></a>, so it can be lazy:</p>\n\n<pre><code>type Rand g = RandT g Identity\nnewtype RandT g m a = RandT (StateT g m a)\n</code></pre>\n\n<p><code>evalRandIO</code> queries the IO random number generator just once at the beginning, then runs the <code>State</code>-ful computation on the acquired <code>StdGen</code>:</p>\n\n<pre><code>evalRandT :: (Monad m) =&gt; RandT g m a -&gt; g -&gt; m a\nevalRandT (RandT x) g = evalStateT x g\n\nevalRand :: Rand g a -&gt; g -&gt; a\nevalRand x g = runIdentity (evalRandT x g)\n\nevalRandIO :: Rand StdGen a -&gt; IO a\nevalRandIO x = fmap (evalRand x) newStdGen\n</code></pre>\n\n<p>In contrast, <code>sequence $ repeat randomIO</code> contains an infinite number of side effecting IO actions, because each <code>randomIO</code> modifies the global random number generator. We can't inspect the return value until all the effects are performed. It's similar to doing <code>sequence $ repeat getLine</code>, which just reads lines repeatedly, and never returns. </p>\n"}], "owner": {"reputation": 33184, "user_id": 247623, "user_type": "registered", "accept_rate": 72, "profile_image": "https://www.gravatar.com/avatar/bb9e67348d3e0e93ef12dd97c41a6c22?s=128&d=identicon&r=PG&f=1", "display_name": "Erik Kaplun", "link": "https://stackoverflow.com/users/247623/erik-kaplun"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 102, "favorite_count": 1, "answer_count": 1, "score": 1, "last_activity_date": 1432898187, "creation_date": 1432896722, "last_edit_date": 1432898095, "question_id": 30527699, "link": "https://stackoverflow.com/questions/30527699/infinite-random-sequence-loops-with-randomio-but-not-with-getrandom", "title": "Infinite random sequence loops with randomIO but not with getRandom", "body": "<p>I'm having difficulty trying to figure out a way to reason about why the following two, seemingly equivalent definitions of an infinite random number sequence (<code>inf</code> and <code>inf'</code>) are evaluated completely differently:</p>\n\n<pre><code>import Control.Monad.Random (Rand, evalRandIO, getRandom)\nimport System.Random        (Random, RandomGen, randomIO)\n\ninf :: (RandomGen g, Random a) =&gt; Rand g [a]\ninf = sequence (repeat getRandom)\n\ninf' :: (Random a) =&gt; IO [a]\ninf' = sequence (repeat randomIO)\n\n-- OK\nmain = do\n  i &lt;- evalRandIO inf\n  putStrLn $ show $ take 5 (i :: [Int])\n\n-- HANGS\nmain' = do\n  i &lt;- inf'\n  putStrLn $ show $ take 5 (i :: [Int])\n</code></pre>\n\n<p>when called, <code>main'</code> terminates and prints 5 random integers, whereas <code>main</code> loops infinitely \u2014\u00a0what causes <code>sequence . repeat</code> to be evaluated differently on <code>getRandom</code> than it does on <code>randomIO</code>?</p>\n"}, {"tags": ["haskell", "exception", "asynchronous"], "comments": [{"owner": {"reputation": 1011, "user_id": 1846758, "user_type": "registered", "accept_rate": 83, "profile_image": "https://www.gravatar.com/avatar/51d73b3b1efd718864b0ee0438afe551?s=128&d=identicon&r=PG", "display_name": "highfly22", "link": "https://stackoverflow.com/users/1846758/highfly22"}, "edited": false, "score": 0, "creation_date": 1433124446, "post_id": 30526928, "comment_id": 49200554, "body": "The following operations are guaranteed not to be interruptible: everything from Control.Exception except for throwTo ..."}], "answers": [{"tags": [], "owner": {"reputation": 13626, "user_id": 492865, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/5c69a2080e68c8606961a18aba3a08ec?s=128&d=identicon&r=PG", "display_name": "Yuras", "link": "https://stackoverflow.com/users/492865/yuras"}, "is_accepted": true, "score": 5, "last_activity_date": 1432894797, "creation_date": 1432894797, "answer_id": 30527096, "question_id": 30526928, "link": "https://stackoverflow.com/questions/30526928/the-function-mask-is-interrupted-by-asynchronous-exception/30527096#30527096", "title": "The function mask_ is interrupted by asynchronous exception", "body": "<p><code>mask</code> doesn't block all async exceptions, it just postpones them until the next <a href=\"http://hackage.haskell.org/package/base-4.8.0.0/docs/Control-Exception.html#interruptible\" rel=\"noreferrer\">interruptible action</a>. Use <code>uniterruptibleMask</code> to block all async exceptions.</p>\n"}], "owner": {"reputation": 1011, "user_id": 1846758, "user_type": "registered", "accept_rate": 83, "profile_image": "https://www.gravatar.com/avatar/51d73b3b1efd718864b0ee0438afe551?s=128&d=identicon&r=PG", "display_name": "highfly22", "link": "https://stackoverflow.com/users/1846758/highfly22"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 57, "favorite_count": 0, "accepted_answer_id": 30527096, "answer_count": 1, "score": 0, "last_activity_date": 1432894797, "creation_date": 1432894326, "question_id": 30526928, "link": "https://stackoverflow.com/questions/30526928/the-function-mask-is-interrupted-by-asynchronous-exception", "title": "The function mask_ is interrupted by asynchronous exception", "body": "<pre><code>import Control.Exception\nimport System.Timeout\nimport Control.Concurrent\n\nmaskWorker :: IO ()\nmaskWorker = mask_ $ do \n      threadDelay 10000\n      putStrLn $ \"Return\"\n\nuninterruptWorker :: IO ()\nuninterruptWorker = uninterruptibleMask_ $ do\n      threadDelay 10000\n      putStrLn $ \"Return\"\n\ntest :: IO () -&gt; IO ()\ntest worker = do\n             pid &lt;- forkIO worker\n             threadDelay 5000\n             throwTo pid UserInterrupt\n             threadDelay 15000\n             putStrLn \"The end\"\n</code></pre>\n\n<p>The function mask_ should ignore the asynchronous exception till it returns. But \"test maskWorker\" doesn't print \"Return\". Why?</p>\n"}, {"tags": ["haskell"], "comments": [{"owner": {"reputation": 10320, "user_id": 453616, "user_type": "registered", "accept_rate": 88, "profile_image": "https://www.gravatar.com/avatar/f5c35ad8a6275273c50d1274fd549d84?s=128&d=identicon&r=PG", "display_name": "gspr", "link": "https://stackoverflow.com/users/453616/gspr"}, "edited": false, "score": 0, "creation_date": 1432894367, "post_id": 30526853, "comment_id": 49127228, "body": "Not that it answers your question, but you should know that Haskell lists (<code>[a]</code>) are <i>not</i> arrays, but rather linked lists, and that these of course have performance characteristics that are completely different from that of arrays. If you really want arrays (probably not in this case), check out <a href=\"https://hackage.haskell.org/package/vector\" rel=\"nofollow noreferrer\">vector</a>, which is pretty much the canonical choice for array these days."}, {"owner": {"reputation": 10320, "user_id": 453616, "user_type": "registered", "accept_rate": 88, "profile_image": "https://www.gravatar.com/avatar/f5c35ad8a6275273c50d1274fd549d84?s=128&d=identicon&r=PG", "display_name": "gspr", "link": "https://stackoverflow.com/users/453616/gspr"}, "edited": false, "score": 0, "creation_date": 1432894818, "post_id": 30526853, "comment_id": 49127493, "body": "It seems also that you&#39;ll be doing a lot of membership tests. Maybe you want to consider <a href=\"http://hackage.haskell.org/package/containers-0.5.6.3/docs/Data-Set.html\" rel=\"nofollow noreferrer\"><code>Set</code></a>, where such checks can be done in logarithmic time."}, {"owner": {"reputation": 10320, "user_id": 453616, "user_type": "registered", "accept_rate": 88, "profile_image": "https://www.gravatar.com/avatar/f5c35ad8a6275273c50d1274fd549d84?s=128&d=identicon&r=PG", "display_name": "gspr", "link": "https://stackoverflow.com/users/453616/gspr"}, "edited": false, "score": 0, "creation_date": 1432895765, "post_id": 30526853, "comment_id": 49128077, "body": "Here&#39;s a sketch: 1) Write a function that merges two sets if they have an intersection. 2) Write a function that produces the list of all pairs of elements from two lists. 3) Pass the function from 1 over the list from 2 until it finds a pair it can do its thing with. If you ever traverse all of the list from 2 without 1 doing anything, you are done."}, {"owner": {"reputation": 1216, "user_id": 2682133, "user_type": "registered", "accept_rate": 65, "profile_image": "https://i.stack.imgur.com/e6O9c.jpg?s=128&g=1", "display_name": "Hennes", "link": "https://stackoverflow.com/users/2682133/hennes"}, "reply_to_user": {"reputation": 10320, "user_id": 453616, "user_type": "registered", "accept_rate": 88, "profile_image": "https://www.gravatar.com/avatar/f5c35ad8a6275273c50d1274fd549d84?s=128&d=identicon&r=PG", "display_name": "gspr", "link": "https://stackoverflow.com/users/453616/gspr"}, "edited": false, "score": 0, "creation_date": 1432895799, "post_id": 30526853, "comment_id": 49128095, "body": "That&#39;s cool, Data.Set would fit perfectly in here. There is a union to combine to sets and there is intersection to check for overlapping. Nice!"}, {"owner": {"reputation": 1216, "user_id": 2682133, "user_type": "registered", "accept_rate": 65, "profile_image": "https://i.stack.imgur.com/e6O9c.jpg?s=128&g=1", "display_name": "Hennes", "link": "https://stackoverflow.com/users/2682133/hennes"}, "reply_to_user": {"reputation": 10320, "user_id": 453616, "user_type": "registered", "accept_rate": 88, "profile_image": "https://www.gravatar.com/avatar/f5c35ad8a6275273c50d1274fd549d84?s=128&d=identicon&r=PG", "display_name": "gspr", "link": "https://stackoverflow.com/users/453616/gspr"}, "edited": false, "score": 0, "creation_date": 1432895921, "post_id": 30526853, "comment_id": 49128156, "body": "Function 1 and function 2 are easy. But the third thing kills me. Also building all kind of pairs in function 2 could be an overkill as well."}], "answers": [{"comments": [{"owner": {"reputation": 1216, "user_id": 2682133, "user_type": "registered", "accept_rate": 65, "profile_image": "https://i.stack.imgur.com/e6O9c.jpg?s=128&g=1", "display_name": "Hennes", "link": "https://stackoverflow.com/users/2682133/hennes"}, "edited": false, "score": 0, "creation_date": 1432898704, "post_id": 30528152, "comment_id": 49130052, "body": "Try this input: solve [[5,6,14],[18,19,20],[5,13,14],[1,2,9],[17,18,19],[20,21,22]&zwnj;&#8203;]"}, {"owner": {"reputation": 1216, "user_id": 2682133, "user_type": "registered", "accept_rate": 65, "profile_image": "https://i.stack.imgur.com/e6O9c.jpg?s=128&g=1", "display_name": "Hennes", "link": "https://stackoverflow.com/users/2682133/hennes"}, "edited": false, "score": 0, "creation_date": 1432925837, "post_id": 30528152, "comment_id": 49147736, "body": "Works great. Thanks a lot."}, {"owner": {"reputation": 46235, "user_id": 2541573, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/Z1qtP.png?s=128&g=1", "display_name": "jub0bs", "link": "https://stackoverflow.com/users/2541573/jub0bs"}, "reply_to_user": {"reputation": 1216, "user_id": 2682133, "user_type": "registered", "accept_rate": 65, "profile_image": "https://i.stack.imgur.com/e6O9c.jpg?s=128&g=1", "display_name": "Hennes", "link": "https://stackoverflow.com/users/2682133/hennes"}, "edited": false, "score": 1, "creation_date": 1439899832, "post_id": 30528152, "comment_id": 52040548, "body": "@Hennes Please consider accepting Sibi&#39;s answer, if it solves your problem."}], "tags": [], "owner": {"reputation": 43759, "user_id": 1651941, "user_type": "registered", "accept_rate": 97, "profile_image": "https://www.gravatar.com/avatar/a513bc1fa519d2fcf5e4e0d9b5500101?s=128&d=identicon&r=PG", "display_name": "Sibi", "link": "https://stackoverflow.com/users/1651941/sibi"}, "is_accepted": false, "score": 1, "last_activity_date": 1432899896, "last_edit_date": 1432899896, "creation_date": 1432898107, "answer_id": 30528152, "question_id": 30526853, "link": "https://stackoverflow.com/questions/30526853/merge-list-elements-conditionally/30528152#30528152", "title": "Merge list elements conditionally", "body": "<p>One way to do this using <code>List</code> data structure would be like as follows. Initially write a predicate function for finding out if two list has any common elements between them:</p>\n\n<pre><code>hasCommon :: Eq a =&gt; [a] -&gt; [a] -&gt; Bool\nhasCommon xs ys = not . null $ intersect xs ys\n\n\u03bb&gt; hasCommon [1,2,3] [3]\nTrue\n\u03bb&gt; hasCommon [1,2,3] [4]\nFalse\n</code></pre>\n\n<p>Now, you can implement a <code>solve</code> function which will give you your desired functionality:</p>\n\n<pre><code>solve :: Eq a =&gt; [[a]] -&gt; [[a]]\nsolve xs = case xs' of\n             [] -&gt; []\n             x'@(x:[]) -&gt; x'\n             x'@(x1:x2:[]) -&gt; x'\n             x'@(x1:x2:xs) -&gt; x1:(solve (x2:xs))\n    where xs' = aux (head xs) (tail xs) []\n          aux :: Eq a =&gt; [a] -&gt; [[a]] -&gt; [[a]] -&gt; [[a]]\n          aux acc [] temp = (acc:temp)\n          aux acc (y:ys) temp = if (acc `hasCommon` y)\n                                then aux (union acc y) (ys ++ temp) []\n                                else aux acc ys (y:temp)\n</code></pre>\n\n<p>The main part of the function is the <code>aux</code>. The function accepts three parameter. The first parameter for that function is the initial head of the input list which is used to compare it with the rest of the input list. The second parameter of the <code>aux</code> function is the <code>tail</code> of the input list. The third parameter is the temporary variable which you keep around to keep track of the elements which has been already processed. You handle two cases within the function: If the tail of the input list is empty, then you return <code>[acc] ++ temp</code> which will hold your result. That will be built up in the other case which will be described now. In the other case, you check if the head of the input list has any common elements with the head of the tail of the input list. If it has any common elements, then see how I'm passing around values to the <code>aux</code> function. Basically I populate the second input with <code>ys ++ temp</code> so that we traverse the already traversed elements. And the first parameter is the union of <code>xs</code> and <code>y</code>. The else part in that case is self-explanatory.</p>\n\n<p>Demo in <code>ghci</code>:</p>\n\n<pre><code>\u03bb&gt; solve [[5,6,14],[1,2,9],[11,12,13],[6,13,14],[5,13,14]]\n[[5,6,14,13,11,12],[1,2,9]]\n\u03bb&gt; solve [[5,6,14],[18,19,20],[5,13,14],[1,2,9],[17,18,19],[20,21,22]]\n[[5,6,14,13],[18,19,20,21,22,17],[1,2,9]]\n</code></pre>\n"}], "owner": {"reputation": 1216, "user_id": 2682133, "user_type": "registered", "accept_rate": 65, "profile_image": "https://i.stack.imgur.com/e6O9c.jpg?s=128&g=1", "display_name": "Hennes", "link": "https://stackoverflow.com/users/2682133/hennes"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 902, "favorite_count": 0, "answer_count": 1, "score": 0, "last_activity_date": 1433002890, "creation_date": 1432894131, "last_edit_date": 1433002890, "question_id": 30526853, "link": "https://stackoverflow.com/questions/30526853/merge-list-elements-conditionally", "title": "Merge list elements conditionally", "body": "<p>I'm still a newbie to haskell, but I'm trying hard to learn it. But now I came to a point, where I think I have to learn a completely new chapter of haskell.</p>\n\n<p>So this is an list of lists of Int containing these numbers:</p>\n\n<pre><code>[[5,6,14],[1,2,9],[11,12,13],[6,13,14],[5,13,14]]\n</code></pre>\n\n<p>In the beginning all inner lists contain three numbers. The goal is to merge all overlapping lists into bigger ones:</p>\n\n<pre><code>[[5,6,14],[1,2,9],[11,12,13],[6,13,14],[5,13,14]]\nmerging elements at index 0 and 3 because of the common 6 in both lists.\n[[5,6,14,13],[1,2,9],[11,12,13],[5,13,14]]\nmerging elements at index 0 and 2 because of the common 13 in both lists.\n[[5,6,14,13,11,12],[1,2,9],[5,13,14]]\nmerging elements at index 0 and 2 because of the common 5,13 &amp; 14 in both lists.\n[[5,6,14,13,11,12],[1,2,9]]\n</code></pre>\n\n<p>And this should be the result of the function. The order of the lists inside the list is as irrelevant as the order of elements inside the innermost lists.</p>\n\n<p>I know how to code this in any other imperative language, but here I'm stuck.</p>\n"}, {"tags": ["haskell", "lambda", "functional-programming", "ghc"], "comments": [{"owner": {"reputation": 171740, "user_id": 869736, "user_type": "registered", "accept_rate": 82, "profile_image": "https://www.gravatar.com/avatar/671f732e3c68c387c702112a30e5ebd8?s=128&d=identicon&r=PG&f=1", "display_name": "Louis Wasserman", "link": "https://stackoverflow.com/users/869736/louis-wasserman"}, "edited": false, "score": 2, "creation_date": 1432879683, "post_id": 30522023, "comment_id": 49118403, "body": "It looks like the actual output type of <code>churchNumber</code> is determined by the <code>Int</code> parameter, which can&#39;t really work?"}, {"owner": {"reputation": 3074, "user_id": 1608276, "user_type": "registered", "accept_rate": 28, "profile_image": "https://i.stack.imgur.com/XiZ2q.jpg?s=128&g=1", "display_name": "luochen1990", "link": "https://stackoverflow.com/users/1608276/luochen1990"}, "reply_to_user": {"reputation": 171740, "user_id": 869736, "user_type": "registered", "accept_rate": 82, "profile_image": "https://www.gravatar.com/avatar/671f732e3c68c387c702112a30e5ebd8?s=128&d=identicon&r=PG&f=1", "display_name": "Louis Wasserman", "link": "https://stackoverflow.com/users/869736/louis-wasserman"}, "edited": false, "score": 0, "creation_date": 1432886160, "post_id": 30522023, "comment_id": 49121876, "body": "Yes, that&#39;s really what happend, Is there any way to make things work?"}, {"owner": {"reputation": 75362, "user_id": 625403, "user_type": "registered", "accept_rate": 82, "profile_image": "https://www.gravatar.com/avatar/786eed7da67079cb5d63a49d469af25b?s=128&d=identicon&r=PG", "display_name": "amalloy", "link": "https://stackoverflow.com/users/625403/amalloy"}, "edited": false, "score": 1, "creation_date": 1432886272, "post_id": 30522023, "comment_id": 49121951, "body": "I believe church numerals and stuff like that work mostly in the untyped lambda calculus, and need some adjusting when you apply them to a typed language."}, {"owner": {"reputation": 100185, "user_id": 3234959, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/93bb12ca0f93dfddb33880316f7e66c2?s=128&d=identicon&r=PG&f=1", "display_name": "chi", "link": "https://stackoverflow.com/users/3234959/chi"}, "edited": false, "score": 0, "creation_date": 1432889413, "post_id": 30522023, "comment_id": 49123937, "body": "There might be some way to do this if you write <code>3</code> using Peano naturals and you define a custom type class/type family. But I fear it would be quite ad-hoc for this case and quite inconvenient, unless you really need to generalize this to many other cases."}, {"owner": {"reputation": 54864, "user_id": 404970, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/o6X94.jpg?s=128&g=1", "display_name": "molbdnilo", "link": "https://stackoverflow.com/users/404970/molbdnilo"}, "edited": false, "score": 1, "creation_date": 1432898764, "post_id": 30522023, "comment_id": 49130096, "body": "<code>churchNumber n f</code> must have the same type as <code>f</code>. You can compose e.g. <code>(+1)</code> how many times you want, and the composition still has the same type: <code>Num a =&gt; a -&gt; a</code>. If you compose <code>(.)</code>, the type grows with the number of compositions - compare <code>:t (.)</code> and <code>:t ((.) . (.) . (.))</code>. (I don&#39;t know how to solve it - you might be able to introduce a data type that acts like a &quot;trampoline&quot; between the types.)"}, {"owner": {"reputation": 14485, "user_id": 190376, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/cd8280c5e1491b8cf55760750ed97dec?s=128&d=identicon&r=PG", "display_name": "Reid Barton", "link": "https://stackoverflow.com/users/190376/reid-barton"}, "edited": false, "score": 0, "creation_date": 1432912421, "post_id": 30522023, "comment_id": 49139942, "body": "Your addition at the end is wrong, you cannot group (for example) <code>(a -&gt; a1 -&gt; a2 -&gt; a3 -&gt; b)</code> as <code>(a&#39;&#39;&#39; -&gt; b) where a&#39;&#39;&#39; = a -&gt; a1 -&gt; a2 -&gt; a3</code>."}], "owner": {"reputation": 3074, "user_id": 1608276, "user_type": "registered", "accept_rate": 28, "profile_image": "https://i.stack.imgur.com/XiZ2q.jpg?s=128&g=1", "display_name": "luochen1990", "link": "https://stackoverflow.com/users/1608276/luochen1990"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 206, "favorite_count": 0, "answer_count": 0, "score": 0, "last_activity_date": 1487139859, "creation_date": 1432878554, "last_edit_date": 1487139859, "question_id": 30522023, "link": "https://stackoverflow.com/questions/30522023/complains-cannot-construct-the-infinite-type-when-applying-churchnumbers-on-mu", "title": "Complains &quot;cannot construct the infinite type&quot; when applying churchNumbers on multi-parameter functions", "body": "<p>I want to use churchNumber to reduce code like these\uff1a</p>\n\n<pre><code>f = ((.) . (.) . (.))\n</code></pre>\n\n<p>to</p>\n\n<pre><code>f = churchNumber 3 (.)\n</code></pre>\n\n<p>but the ghc compiler complains these:</p>\n\n<blockquote>\n  <p>pointfree.hs:24:29:\n     Occurs check: cannot construct the infinite type: b ~ a0 -> b\n     Expected type: (b -> c) -> b -> c\n       Actual type: (b -> c) -> (a0 -> b) -> a0 -> c\n     Relevant bindings include\n       pointfree3 :: (b -> c) -> b -> c (bound at pointfree.hs:24:1)\n     In the second argument of \u2018churchNumber\u2019, namely \u2018(.)\u2019\n     In the expression: churchNumber 3 (.)</p>\n  \n  <p>pointfree.hs:24:29:\n     Occurs check: cannot construct the infinite type: c ~ a0 -> c\n     Expected type: (b -> c) -> b -> c\n       Actual type: (b -> c) -> (a0 -> b) -> a0 -> c\n     Relevant bindings include\n       pointfree3 :: (b -> c) -> b -> c (bound at pointfree.hs:24:1)\n     In the second argument of \u2018churchNumber\u2019, namely \u2018(.)\u2019\n     In the expression: churchNumber 3 (.)</p>\n</blockquote>\n\n<p>and here is my complete code:</p>\n\n<pre><code>--{-# LANGUAGE #-}\n\nimport Control.Arrow\n\ntype Point = (Float, Float)\ndata RegularPolygen = RegularPolygen Int Float Point deriving (Show)\n\noutline (RegularPolygen n r o) = [let (i', n') = (($i) &amp;&amp;&amp; ($n)) fromIntegral; theta = (i' * 2.0 * pi / n') in (r * sin theta, -r * cos theta) | i &lt;- [0..n-1]]\n\n\ncalc n r o = outline (RegularPolygen n r o)\ncalc' n r = (.) outline (RegularPolygen n r)\ncalc'' n = ((.) . (.)) outline (RegularPolygen n)\ncalc''' = ((.) . (.) . (.)) outline RegularPolygen\n--calc'''' = (churchNumber 3 (.)) outline RegularPolygen\nps = calc''' 4 1 (0, 0)\n\n---- The definition of churchNumber ----\n\nchurchNumber :: (Arrow a) =&gt; Int -&gt; a b b -&gt; a b b\nchurchNumber n f = if n == 0 then returnA else f &gt;&gt;&gt; churchNumber (n - 1) f\n\na = churchNumber 3 (+1) 0\npointfree3 = churchNumber 3 (.)\n--pointfree n = churchNumber n (.)\n--f = pointfree 1 (+1) (+)\n--x = f 1 2\n</code></pre>\n\n<p>Is there any way to make that work?</p>\n\n<hr>\n\n<p>If we observe the type of <code>(.)</code>, <code>((.) . (.))</code>, <code>((.) . (.) . (.))</code> etc. , we got that:</p>\n\n<pre><code>(.)\n    :: (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c\n\n((.) . (.))\n    :: (b -&gt; c) -&gt; (a -&gt; a1 -&gt; b) -&gt; a -&gt; a1 -&gt; c\n\n((.) . (.) . (.))\n    :: (b -&gt; c) -&gt; (a -&gt; a1 -&gt; a2 -&gt; b) -&gt; a -&gt; a1 -&gt; a2 -&gt; c\n\n((.) . (.) . (.) . (.))\n    :: (b -&gt; c) -&gt; (a -&gt; a1 -&gt; a2 -&gt; a3 -&gt; b) -&gt; a -&gt; a1 -&gt; a2 -&gt; a3 -&gt; c\n</code></pre>\n\n<p>And if transform them to things below, you can find that they <strong>almost have the same type</strong>, do they really have the same type??</p>\n\n<pre><code>(.)\n    :: (b -&gt; c) -&gt; (f b) -&gt; (f c) where f b = (a -&gt; b)\n\n((.) . (.))\n    :: (b -&gt; c) -&gt; (f b) -&gt; (f c) where f b = (a -&gt; a1 -&gt; b)\n\n((.) . (.) . (.))\n    :: (b -&gt; c) -&gt; (f b) -&gt; (f c) where f b = (a -&gt; a1 -&gt; a2 -&gt; b)\n\n((.) . (.) . (.) . (.))\n    :: (b -&gt; c) -&gt; (f b) -&gt; (f c) where f b = (a -&gt; a1 -&gt; a2 -&gt; a3 -&gt; b)\n</code></pre>\n"}, {"tags": ["list", "haskell", "compiler-flags", "algebraic-data-types", "gadt"], "comments": [{"owner": {"reputation": 57219, "user_id": 33796, "user_type": "registered", "accept_rate": 70, "profile_image": "https://www.gravatar.com/avatar/08727b23ba62e634b32988cdff082663?s=128&d=identicon&r=PG", "display_name": "luqui", "link": "https://stackoverflow.com/users/33796/luqui"}, "edited": false, "score": 3, "creation_date": 1432873980, "post_id": 30520219, "comment_id": 49116547, "body": "The &quot;no instance for <code>Equal Int</code>&quot; error you are getting is because there is no instance for <code>Equal Int</code>  :-P.  You have to define it: <code>instance Equal Int where ...</code>  (It&#39;s actually pretty rare that the correct solution to &quot;no instance&quot; errors is to define an instance, but in this case it is)"}, {"owner": {"reputation": 57219, "user_id": 33796, "user_type": "registered", "accept_rate": 70, "profile_image": "https://www.gravatar.com/avatar/08727b23ba62e634b32988cdff082663?s=128&d=identicon&r=PG", "display_name": "luqui", "link": "https://stackoverflow.com/users/33796/luqui"}, "edited": false, "score": 3, "creation_date": 1432874150, "post_id": 30520219, "comment_id": 49116593, "body": "Also I observe that your GADT studies might be getting in the way of a good understanding of typeclasses, a fundamental feature of the language.  I suggest taking a step back from GADTs until you are proficient with typeclasses, and perhaps study the <a href=\"https://hackage.haskell.org/package/base-4.7.0.0/docs/src/Prelude.html\" rel=\"nofollow noreferrer\">prelude</a> and how its classes and instances are defined."}, {"owner": {"reputation": 57219, "user_id": 33796, "user_type": "registered", "accept_rate": 70, "profile_image": "https://www.gravatar.com/avatar/08727b23ba62e634b32988cdff082663?s=128&d=identicon&r=PG", "display_name": "luqui", "link": "https://stackoverflow.com/users/33796/luqui"}, "edited": false, "score": 0, "creation_date": 1432874793, "post_id": 30520219, "comment_id": 49116744, "body": "Oops that&#39;s a terrible prelude link. Try <a href=\"https://www.haskell.org/onlinereport/standard-prelude.html\" rel=\"nofollow noreferrer\">the one from the report</a>"}, {"owner": {"reputation": 56659, "user_id": 450128, "user_type": "registered", "accept_rate": 62, "profile_image": "https://www.gravatar.com/avatar/2f72b3fdc99fe9fd1bbeb2f9da1d2c0a?s=128&d=identicon&r=PG", "display_name": "Ben", "link": "https://stackoverflow.com/users/450128/ben"}, "edited": false, "score": 0, "creation_date": 1432875269, "post_id": 30520219, "comment_id": 49116881, "body": "Try actually using <code>Cons 1 Nil :: List Int</code>, instead of just <code>Nil :: List Int</code>; you&#39;ll <i>still</i> get an error about <code>No instance for (Equal Int)</code>. The problem is that you haven&#39;t defined how you can use <code>Int</code> with <code>=+=</code> before trying to use <code>List Int</code> with <code>=+=</code>; this has nothing to do with whether you use the GADT approach or the constraint-on-the-instance approach. The GADT approach <b>does not</b> remove the burden of proving that the elements in the list can be compared for equality, it just <i>moves</i> the burden of proof from the use sites of <code>==</code> to the construction sites of your lists."}], "answers": [{"comments": [{"owner": {"reputation": 593, "user_id": 1913936, "user_type": "registered", "accept_rate": 37, "profile_image": "https://i.stack.imgur.com/8HuWb.jpg?s=128&g=1", "display_name": "Timothy Swan", "link": "https://stackoverflow.com/users/1913936/timothy-swan"}, "edited": false, "score": 0, "creation_date": 1432872766, "post_id": 30520375, "comment_id": 49116230, "body": "Currently, your answer appears to only work for the Eq class built into Haskell. However, I need a solution that works for any class. I am updating the question accordingly."}, {"owner": {"reputation": 13734, "user_id": 938694, "user_type": "registered", "accept_rate": 59, "profile_image": "https://www.gravatar.com/avatar/b6678a430a805dd78366d6e135b49f2d?s=128&d=identicon&r=PG", "display_name": "Cubic", "link": "https://stackoverflow.com/users/938694/cubic"}, "reply_to_user": {"reputation": 593, "user_id": 1913936, "user_type": "registered", "accept_rate": 37, "profile_image": "https://i.stack.imgur.com/8HuWb.jpg?s=128&g=1", "display_name": "Timothy Swan", "link": "https://stackoverflow.com/users/1913936/timothy-swan"}, "edited": false, "score": 1, "creation_date": 1432873437, "post_id": 30520375, "comment_id": 49116379, "body": "@TimothySwan No. The deriving part only works with a handful of builtin classes, but manually defining instances always works."}, {"owner": {"reputation": 593, "user_id": 1913936, "user_type": "registered", "accept_rate": 37, "profile_image": "https://i.stack.imgur.com/8HuWb.jpg?s=128&g=1", "display_name": "Timothy Swan", "link": "https://stackoverflow.com/users/1913936/timothy-swan"}, "reply_to_user": {"reputation": 13734, "user_id": 938694, "user_type": "registered", "accept_rate": 59, "profile_image": "https://www.gravatar.com/avatar/b6678a430a805dd78366d6e135b49f2d?s=128&d=identicon&r=PG", "display_name": "Cubic", "link": "https://stackoverflow.com/users/938694/cubic"}, "edited": false, "score": 0, "creation_date": 1432873959, "post_id": 30520375, "comment_id": 49116537, "body": "@Cubic Yes. I know. I just updated my question to show how manually defining the instance with my own definition of Eq still didn&#39;t work the same in the case without the compiler flags."}, {"owner": {"reputation": 593, "user_id": 1913936, "user_type": "registered", "accept_rate": 37, "profile_image": "https://i.stack.imgur.com/8HuWb.jpg?s=128&g=1", "display_name": "Timothy Swan", "link": "https://stackoverflow.com/users/1913936/timothy-swan"}, "edited": false, "score": 0, "creation_date": 1432931937, "post_id": 30520375, "comment_id": 49150686, "body": "@bheklilr I understand why the custom Equal class did not work. I needed to define the equality to work for Int type since I was using those in the actual expressions."}], "tags": [], "owner": {"reputation": 51584, "user_id": 839246, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/9b0573c2b936b12828dd1e4cc04206dc?s=128&d=identicon&r=PG&f=1", "display_name": "bheklilr", "link": "https://stackoverflow.com/users/839246/bheklilr"}, "is_accepted": true, "score": 8, "last_activity_date": 1432906391, "last_edit_date": 1432906391, "creation_date": 1432868186, "answer_id": 30520375, "question_id": 30520219, "link": "https://stackoverflow.com/questions/30520219/how-to-define-eq-instance-of-list-without-gadts-or-datatype-contexts/30520375#30520375", "title": "How to define Eq instance of List without GADTs or Datatype Contexts", "body": "<p>It looks like you're trying to restrict lists to only be able to hold values that implement <code>Eq</code>, and you can't do that without extensions.  You can, however, tell the compiler how to compare two <code>List a</code>s when <code>a</code> has a type that implements <code>Eq</code>.  There are two easy ways to do this.  The simplest is with a deriving statement:</p>\n\n<pre><code>data List a = Nil | Cons a (List a) deriving (Eq)\n</code></pre>\n\n<p>Or you can define it manually:</p>\n\n<pre><code>instance Eq a =&gt; Eq (List a) where\n    (Cons a b) == (Const c d) = (a == c) &amp;&amp; (b == d)\n    Nil == Nil = True\n    _ == _ = False\n</code></pre>\n\n<p>Now whenever you fill your <code>List</code> type with something that implements <code>Eq</code>, the list will also be comparable using <code>==</code>.  There's no need to restrict the values that can be inside <code>Cons</code>.  You can certainly have a normal list of functions, like</p>\n\n<pre><code>fs1 :: [Int -&gt; Int]\nfs1 = [(+1), (*3), (+2), (*4)]\n</code></pre>\n\n<p>Or in your case</p>\n\n<pre><code>fs2 :: List (Int -&gt; Int)\nfs2 = Cons (+1) $ Cons (*3) $ Cons (+2) $ Cons (*4) Nil\n</code></pre>\n\n<p>Which can be used as</p>\n\n<pre><code>&gt; map ($ 10) fs1\n[11, 30, 12, 40]\n</code></pre>\n\n<p>And given</p>\n\n<pre><code>map' :: (a -&gt; b) -&gt; List a -&gt; List b\nmap' f Nil = Nil\nmap' f (Cons x xs) = Cons (f x) (map' f xs)\n</code></pre>\n\n<p>Then</p>\n\n<pre><code>&gt; map' ($ 10) fs2\nCons 11 (Cons 30 (Cons 12 (Cons 40 Nil)))\n</code></pre>\n\n<p>Although to actually view it in GHCi you should also derive <code>Show</code>:</p>\n\n<pre><code>data List a = Nil | Cons a (List a) deriving (Eq, Show)\n</code></pre>\n\n<p>There are several other useful typeclasses that can be derived in GHC, too.</p>\n\n<hr>\n\n<p>To make it work with your custom <code>Equal</code> typeclass, you'll have to write multiple instances by hand:</p>\n\n<pre><code>class Equal a where\n    (=+=) :: a -&gt; a -&gt; Bool\n    (/+=) :: a -&gt; a -&gt; Bool\n    x =+= y = not (x /+= y)\n    x /+= y = not (x =+= y)\n\ninstance Equal Int where\n    x =+= y = x == y\n\ninstance Equal a =&gt; Equal (List a) where\n    (Cons a b) =+= (Cons c d) = (a =+= c) &amp;&amp; (b =+= d)\n    Nil =+= Nil = True\n    _ =+= _ = False\n</code></pre>\n\n<p>Now because you have an instance <code>Equal Int</code> and <code>Equal a =&gt; Equal (List a)</code>, you can compare two <code>List Int</code>s:</p>\n\n<pre><code>&gt; let x = Cons 1 (Cons 2 (Cons 3 Nil)) :: List Int\n&gt; let y = Cons 1 (Cons 2 (Cons 3 Nil)) :: List Int\n&gt; x =+= y\nTrue\n&gt; x =+= Nil\nFalse\n</code></pre>\n\n<p>For whatever type you want to store in a <code>List</code> and use <code>=+=</code> on, you'll have to implement <code>Equal</code> for that type.</p>\n"}, {"comments": [{"owner": {"reputation": 593, "user_id": 1913936, "user_type": "registered", "accept_rate": 37, "profile_image": "https://i.stack.imgur.com/8HuWb.jpg?s=128&g=1", "display_name": "Timothy Swan", "link": "https://stackoverflow.com/users/1913936/timothy-swan"}, "edited": false, "score": 0, "creation_date": 1432872120, "post_id": 30520447, "comment_id": 49116095, "body": "It appears as though this solution works as long as I actually use the built in Eq class. Strangely, a custom built Eq class, which otherwise works, does not work with this solution. I defined one as follows: class Equal a where       (=+=) :: a -&gt; a -&gt; Bool       (/+=) :: a -&gt; a -&gt; Bool       x =+= y = not (x /+= y)       x /+= y = not (x =+= y)"}, {"owner": {"reputation": 57219, "user_id": 33796, "user_type": "registered", "accept_rate": 70, "profile_image": "https://www.gravatar.com/avatar/08727b23ba62e634b32988cdff082663?s=128&d=identicon&r=PG", "display_name": "luqui", "link": "https://stackoverflow.com/users/33796/luqui"}, "reply_to_user": {"reputation": 593, "user_id": 1913936, "user_type": "registered", "accept_rate": 37, "profile_image": "https://i.stack.imgur.com/8HuWb.jpg?s=128&g=1", "display_name": "Timothy Swan", "link": "https://stackoverflow.com/users/1913936/timothy-swan"}, "edited": false, "score": 2, "creation_date": 1432873885, "post_id": 30520447, "comment_id": 49116523, "body": "@TimothySwan, there is nothing special about the built-in <code>Eq</code> class except that it has a bunch of defined instances for built-in types. You should be able to emulate it completely, including with this solution (which is the standard solution to your problem and I have done it many times)"}], "tags": [], "owner": {"reputation": 56659, "user_id": 450128, "user_type": "registered", "accept_rate": 62, "profile_image": "https://www.gravatar.com/avatar/2f72b3fdc99fe9fd1bbeb2f9da1d2c0a?s=128&d=identicon&r=PG", "display_name": "Ben", "link": "https://stackoverflow.com/users/450128/ben"}, "is_accepted": false, "score": 3, "last_activity_date": 1432868850, "creation_date": 1432868850, "answer_id": 30520447, "question_id": 30520219, "link": "https://stackoverflow.com/questions/30520219/how-to-define-eq-instance-of-list-without-gadts-or-datatype-contexts/30520447#30520447", "title": "How to define Eq instance of List without GADTs or Datatype Contexts", "body": "<p>The usual solution to this is to to use this structure:</p>\n\n<pre><code>data List a = Nil | Cons a (List a)\n\ninstance Eq a =&gt; Eq (List a) where\n (Cons a b) == (Cons c d) = (a == c) &amp;&amp; (b == d)\n Nil == Nil = True\n _ == _ = False\n</code></pre>\n\n<p>Noticed I've added <code>Eq a</code> as a constraint to the <em>instance</em>, not to the data type. This way all the lists that you could compare for equality the way you're trying to write it can be compared for equality, but you also allow the existence of lists of things which cannot be compared for equality. And this is supported by every version of Haskell you will encounter, even very old ones, with no extensions.</p>\n\n<p>This approach then also extends nicely when you want to add a <code>Show</code> instance, an <code>Ord</code> instance, etc; to do it your way you have to keep going back and making the data structure more restrictive by adding more constraints (potentially breaking existing code that worked fine because it didn't need those instances). Whereas if you leave the data type unconstrained and just make your instances <code>Show a =&gt; Show (List a)</code>, <code>Ord a =&gt; Ord (List a)</code>, etc, then you can show <em>and</em> order lists of types which happen to support both, but you can still have (and show) lists of types that support <code>Show</code> but not <code>Ord</code> and vice versa.</p>\n\n<p>Plus, there are lots of useful type classes for parameterised types (such as <code>List a</code>) that <em>require</em> them to be fully generic in their type parameter. Examples are <code>Functor</code>, <code>Applicative</code>, <code>Monad</code>; it is not possible to correctly implement these for the constrained list type you're trying to create.</p>\n\n<p>While it <em>is</em> possible to create constrained lists like you're trying to (but only by using extensions, as you've found), it has been found to be usually much more useful to leave your data types fully generic in their type parameter, and if a particular usage of your type needs to impose restrictions on the type parameter you impose them <em>at that usage site</em>, not at <strong>every</strong> use of the data type. This should be your \"default setting\"; depart from it when you have a good reason (you may well have such a reason here, but you haven't given it to us in the question, so nobody can recommend the best way of handling it).</p>\n"}], "owner": {"reputation": 593, "user_id": 1913936, "user_type": "registered", "accept_rate": 37, "profile_image": "https://i.stack.imgur.com/8HuWb.jpg?s=128&g=1", "display_name": "Timothy Swan", "link": "https://stackoverflow.com/users/1913936/timothy-swan"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 1091, "favorite_count": 0, "accepted_answer_id": 30520375, "answer_count": 2, "score": 3, "last_activity_date": 1432906391, "creation_date": 1432867096, "last_edit_date": 1432873855, "question_id": 30520219, "link": "https://stackoverflow.com/questions/30520219/how-to-define-eq-instance-of-list-without-gadts-or-datatype-contexts", "title": "How to define Eq instance of List without GADTs or Datatype Contexts", "body": "<p>I am using <code>Glasgow Haskell Compiler, Version 7.8.3, stage 2 booted by GHC version 7.6.3</code>.</p>\n\n<p>I attempted to use the following data definition for a List type in Haskell:</p>\n\n<pre><code>data Eq a =&gt; List a = Nil | Cons a (List a)\n</code></pre>\n\n<p>However, the <code>-XDatatypeContexts</code> flag is required, depricated, and even removed from the language by default. It is widely viewed as a misfeature of the language. I also do not want to have to use special flags for my definition of List since I am trying to replicate the functionality of the existing list type.\nThen I was able to use the following segment of code instead:</p>\n\n<pre><code>data List a where\n Nil :: List a\n Cons :: Eq a =&gt; a -&gt; List a -&gt; List a\n</code></pre>\n\n<p>It runs fine. The visible issue with this solution is that now I need to use the <code>-XGADTs</code> flag, which I still don't want to depend on in this case since it is not necessary for the built in version of list to function. Is there a way to restrict the type within <code>Cons</code> to be <code>Eq a</code> so that I can compare two lists without the need for compiler flags and without using the <code>derived</code> keyword?\nThe remaining code is as follows:</p>\n\n<pre><code>instance Eq (List a) where\n (Cons a b) == (Cons c d) = (a == c) &amp;&amp; (b == d)\n Nil == Nil = True\n _ == _ = False\ntestfunction = Nil :: List Int\nmain = print (if testfunction == Nil then \"printed\" else \"not printed\")\n</code></pre>\n\n<p>I see that the following solution works:</p>\n\n<pre><code>data List a = Nil | Cons a (List a)\ninstance Eq a =&gt; Eq (List a) where\n (Cons a b) == (Cons c d) = (a == c) &amp;&amp; (b == d)\n Nil == Nil = True\n _ == _ = False\ntestfunction = Nil :: List Int\nmain = print (if testfunction == Nil then \"printed\" else \"not printed\")\n</code></pre>\n\n<p>However, for some reason, it does not work with a manual definition for Eq (Equals here).</p>\n\n<pre><code>class Equal a where  \n (=+=) :: a -&gt; a -&gt; Bool  \n (/+=) :: a -&gt; a -&gt; Bool  \n x =+= y = not (x /+= y)  \n x /+= y = not (x =+= y)\ndata List a = Nil | Cons a (List a)\ninstance Equal a =&gt; Equal (List a) where\n (Cons a b) =+= (Cons c d) = (a =+= c) &amp;&amp; (b =+= d)\n Nil =+= Nil = True\n _ =+= _ = False\ntestfunction = Nil :: List Int\nmain = print (if testfunction =+= Nil then \"printed\" else \"not printed\")\n</code></pre>\n\n<p>I get the following error:</p>\n\n<pre><code>No instance for (Equal Int) arising from a use of \u2018=+=\u2019\n    In the expression: testfunction =+= Nil\n    In the first argument of \u2018print\u2019, namely\n      \u2018(if testfunction =+= Nil then \"printed\" else \"not printed\")\u2019\n    In the expression:\n      print (if testfunction =+= Nil then \"printed\" else \"not printed\")\n</code></pre>\n\n<p>However, by using GADT's, I can show that my Equal class does actually function. This code works:</p>\n\n<pre><code>class Equal a where  \n (=+=) :: a -&gt; a -&gt; Bool  \n (/+=) :: a -&gt; a -&gt; Bool  \n x =+= y = not (x /+= y)  \n x /+= y = not (x =+= y)\ndata List a where\n Nil :: List a\n Cons :: Equal a =&gt; a -&gt; List a -&gt; List a\ninstance Equal (List a) where\n (Cons a b) =+= (Cons c d) = (a =+= c) &amp;&amp; (b =+= d)\n Nil =+= Nil = True\n _ =+= _ = False\ntestfunction = Nil :: List Int\nmain = print (if testfunction =+= Nil then \"printed\" else \"not printed\")\n</code></pre>\n\n<p>However, I have to use <code>instance Equal (List a) where</code> instead of <code>instance Equal a =&gt; Equal (List a) where</code> otherwise I get the error:</p>\n\n<pre><code>No instance for (Equal Int) arising from a use of \u2018=+=\u2019\n    In the expression: testfunction =+= Nil\n    In the first argument of \u2018print\u2019, namely\n      \u2018(if testfunction =+= Nil then \"printed\" else \"not printed\")\u2019\n    In the expression:\n      print (if testfunction =+= Nil then \"printed\" else \"not printed\")\n</code></pre>\n"}, {"tags": ["haskell", "syntastic"], "comments": [{"owner": {"reputation": 49959, "user_id": 866915, "user_type": "registered", "accept_rate": 70, "profile_image": "https://www.gravatar.com/avatar/09242131d6e17cbbe31e8547514da6e5?s=128&d=identicon&r=PG", "display_name": "ErikR", "link": "https://stackoverflow.com/users/866915/erikr"}, "edited": false, "score": 6, "creation_date": 1432858443, "post_id": 30518927, "comment_id": 49113054, "body": "Just add <code>module Foo where</code> at the beginning."}], "answers": [{"tags": [], "owner": {"reputation": 51584, "user_id": 839246, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/9b0573c2b936b12828dd1e4cc04206dc?s=128&d=identicon&r=PG&f=1", "display_name": "bheklilr", "link": "https://stackoverflow.com/users/839246/bheklilr"}, "is_accepted": true, "score": 30, "last_activity_date": 1432858996, "creation_date": 1432858996, "answer_id": 30519208, "question_id": 30518927, "link": "https://stackoverflow.com/questions/30518927/how-to-avoid-main-is-not-defined-in-module-main-when-using-syntastic/30519208#30519208", "title": "How to avoid &quot;\u2018main\u2019 is not defined in module \u2018Main\u2019&quot; when using syntastic", "body": "<p>Testing with <code>ghc-mod</code> (which backs syntastic, although hdevtools is possible too):</p>\n\n<pre class=\"lang-sh prettyprint-override\"><code>$ cat test1.hs\nf :: Int -&gt; Int\nf x = x + 1\n$ ghc-mod check test.hs\ntest1.hs:1:1:The IO action 'main' is not defined in module 'Main'\n$ cat test2.hs\nmodule Test where\n\nf :: Int -&gt; Int\nf x = x + 1\n$ ghc-mod check test.hs\n$\n</code></pre>\n\n<p>So you can just put a dummy module declaration in your file and the warning will go away.</p>\n\n<p>The reason why this warning pops up is because by default in Haskell any undeclared module has the name <code>Main</code>.  Since you haven't defined a <code>main :: IO ()</code> and the module name is implicitly <code>Main</code> ghc-mod throws a warning.  If you declare it to be something other than <code>Main</code>, ghc-mod thinks you're just exporting everything in the module, since everything is implicitly exported from a module.</p>\n"}, {"tags": [], "owner": {"reputation": 1619, "user_id": 4661875, "user_type": "registered", "accept_rate": 64, "profile_image": "https://i.stack.imgur.com/KeUsL.png?s=128&g=1", "display_name": "Bussller", "link": "https://stackoverflow.com/users/4661875/bussller"}, "is_accepted": false, "score": 6, "last_activity_date": 1590984215, "last_edit_date": 1590984215, "creation_date": 1565787435, "answer_id": 57495181, "question_id": 30518927, "link": "https://stackoverflow.com/questions/30518927/how-to-avoid-main-is-not-defined-in-module-main-when-using-syntastic/57495181#57495181", "title": "How to avoid &quot;\u2018main\u2019 is not defined in module \u2018Main\u2019&quot; when using syntastic", "body": "<p>Though it is a late answer, for the sake of completion adding the following will stop the warning.</p>\n\n<pre><code>main :: IO ()\nmain = return ()\n</code></pre>\n"}], "owner": {"reputation": 124764, "user_id": 90848, "user_type": "registered", "accept_rate": 90, "profile_image": "https://i.stack.imgur.com/tK3A3.jpg?s=128&g=1", "display_name": "Laurence Gonsalves", "link": "https://stackoverflow.com/users/90848/laurence-gonsalves"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 14853, "favorite_count": 5, "accepted_answer_id": 30519208, "answer_count": 2, "score": 28, "last_activity_date": 1590984215, "creation_date": 1432857021, "question_id": 30518927, "link": "https://stackoverflow.com/questions/30518927/how-to-avoid-main-is-not-defined-in-module-main-when-using-syntastic", "title": "How to avoid &quot;\u2018main\u2019 is not defined in module \u2018Main\u2019&quot; when using syntastic", "body": "<p>I'm trying to write a module in Haskell. It does not have a <code>main</code> because it's not meant to be a stand-alone program.</p>\n\n<p>I just started using syntastic, and it is constantly reporting:</p>\n\n<pre><code>The IO action \u2018main\u2019 is not defined in module \u2018Main\u2019\n</code></pre>\n\n<p>This is preventing it from reporting other real errors in my module. If I try to work around this by adding a dummy main, it starts complaining that everything else is \"Defined but not used\".</p>\n\n<p>How can I tell syntastic (and whatever checker it's using under the covers) that there isn't supposed to be a <code>main</code>?</p>\n"}, {"tags": ["c", "haskell", "vector", "monads"], "comments": [{"owner": {"reputation": 1424, "user_id": 756714, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/a0c58c5ad07c97f187f3a9241c4d2639?s=128&d=identicon&r=PG", "display_name": "vivian", "link": "https://stackoverflow.com/users/756714/vivian"}, "edited": false, "score": 0, "creation_date": 1432840437, "post_id": 30514331, "comment_id": 49105522, "body": "Try using <code>unsafeToForeignPtr</code> <a href=\"http://hackage.haskell.org/package/hmatrix-0.16.1.5/docs/Numeric-LinearAlgebra-Devel.html\" rel=\"nofollow noreferrer\">hackage.haskell.org/package/hmatrix-0.16.1.5/docs/&hellip;</a>"}, {"owner": {"reputation": 1424, "user_id": 756714, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/a0c58c5ad07c97f187f3a9241c4d2639?s=128&d=identicon&r=PG", "display_name": "vivian", "link": "https://stackoverflow.com/users/756714/vivian"}, "edited": false, "score": 0, "creation_date": 1432840930, "post_id": 30514331, "comment_id": 49105813, "body": "Or the <code>vector</code> package <a href=\"http://hackage.haskell.org/package/vector-0.10.12.3/docs/Data-Vector-Storable.html\" rel=\"nofollow noreferrer\">hackage.haskell.org/package/vector-0.10.12.3/docs/&hellip;</a>"}, {"owner": {"reputation": 3209, "user_id": 1276374, "user_type": "registered", "accept_rate": 48, "profile_image": "https://www.gravatar.com/avatar/7ce4a877cf573491b23fc6aa1bf18a1d?s=128&d=identicon&r=PG", "display_name": "Boris Mocialov", "link": "https://stackoverflow.com/users/1276374/boris-mocialov"}, "reply_to_user": {"reputation": 1424, "user_id": 756714, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/a0c58c5ad07c97f187f3a9241c4d2639?s=128&d=identicon&r=PG", "display_name": "vivian", "link": "https://stackoverflow.com/users/756714/vivian"}, "edited": false, "score": 0, "creation_date": 1432841581, "post_id": 30514331, "comment_id": 49106210, "body": "@vivian Tried <code>(fptr, len) &lt;- unsafeToForeignPtr0 (feed es)</code> , but again, I am getting <code>Couldn&#39;t match expected type \u2018Vector a0\u2019 with actual type \u2018IO (Vector Double)\u2019</code> Due to IO wrapping"}, {"owner": {"reputation": 3209, "user_id": 1276374, "user_type": "registered", "accept_rate": 48, "profile_image": "https://www.gravatar.com/avatar/7ce4a877cf573491b23fc6aa1bf18a1d?s=128&d=identicon&r=PG", "display_name": "Boris Mocialov", "link": "https://stackoverflow.com/users/1276374/boris-mocialov"}, "reply_to_user": {"reputation": 1424, "user_id": 756714, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/a0c58c5ad07c97f187f3a9241c4d2639?s=128&d=identicon&r=PG", "display_name": "vivian", "link": "https://stackoverflow.com/users/756714/vivian"}, "edited": false, "score": 0, "creation_date": 1432842050, "post_id": 30514331, "comment_id": 49106494, "body": "P.S. This is the first time I am dealing with Monads, so I may be doing it all wrong."}, {"owner": {"reputation": 14485, "user_id": 190376, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/cd8280c5e1491b8cf55760750ed97dec?s=128&d=identicon&r=PG", "display_name": "Reid Barton", "link": "https://stackoverflow.com/users/190376/reid-barton"}, "edited": false, "score": 1, "creation_date": 1432842253, "post_id": 30514331, "comment_id": 49106606, "body": "Yes, you are doing it partly &quot;all wrong&quot;. You should start with a tutorial on IO that explains that values of type <code>IO a</code> are not &quot;IO wrapped [values of type <code>a</code>]&quot; but rather IO actions that would produce a value of type <code>a</code> if executed. And, it looks like you want the third argument of <code>process</code> to just have type <code>Ptr Double</code>."}, {"owner": {"reputation": 3209, "user_id": 1276374, "user_type": "registered", "accept_rate": 48, "profile_image": "https://www.gravatar.com/avatar/7ce4a877cf573491b23fc6aa1bf18a1d?s=128&d=identicon&r=PG", "display_name": "Boris Mocialov", "link": "https://stackoverflow.com/users/1276374/boris-mocialov"}, "reply_to_user": {"reputation": 14485, "user_id": 190376, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/cd8280c5e1491b8cf55760750ed97dec?s=128&d=identicon&r=PG", "display_name": "Reid Barton", "link": "https://stackoverflow.com/users/190376/reid-barton"}, "edited": false, "score": 0, "creation_date": 1432842378, "post_id": 30514331, "comment_id": 49106662, "body": "@ReidBarton The third argument is an <code>out</code> variable that is expected to be used to communicate the vector in one form or another back to the C program"}, {"owner": {"reputation": 14485, "user_id": 190376, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/cd8280c5e1491b8cf55760750ed97dec?s=128&d=identicon&r=PG", "display_name": "Reid Barton", "link": "https://stackoverflow.com/users/190376/reid-barton"}, "edited": false, "score": 0, "creation_date": 1432843772, "post_id": 30514331, "comment_id": 49107438, "body": "Yes, I see that. But in C a pointer can be used for that also. You should first write down the C type you want your function to have. From your example usage it looks like <code>void process(int *, double *, double *)</code> (not sure why the first argument needs to be a pointer, but OK). Then just directly transcribe that into a Haskell type."}, {"owner": {"reputation": 3209, "user_id": 1276374, "user_type": "registered", "accept_rate": 48, "profile_image": "https://www.gravatar.com/avatar/7ce4a877cf573491b23fc6aa1bf18a1d?s=128&d=identicon&r=PG", "display_name": "Boris Mocialov", "link": "https://stackoverflow.com/users/1276374/boris-mocialov"}, "reply_to_user": {"reputation": 14485, "user_id": 190376, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/cd8280c5e1491b8cf55760750ed97dec?s=128&d=identicon&r=PG", "display_name": "Reid Barton", "link": "https://stackoverflow.com/users/190376/reid-barton"}, "edited": false, "score": 0, "creation_date": 1432844195, "post_id": 30514331, "comment_id": 49107658, "body": "@ReidBarton I do not know how to do that, but I will try to find out"}, {"owner": {"reputation": 3209, "user_id": 1276374, "user_type": "registered", "accept_rate": 48, "profile_image": "https://www.gravatar.com/avatar/7ce4a877cf573491b23fc6aa1bf18a1d?s=128&d=identicon&r=PG", "display_name": "Boris Mocialov", "link": "https://stackoverflow.com/users/1276374/boris-mocialov"}, "reply_to_user": {"reputation": 14485, "user_id": 190376, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/cd8280c5e1491b8cf55760750ed97dec?s=128&d=identicon&r=PG", "display_name": "Reid Barton", "link": "https://stackoverflow.com/users/190376/reid-barton"}, "edited": false, "score": 0, "creation_date": 1432844672, "post_id": 30514331, "comment_id": 49107878, "body": "@ReidBarton I may be wring, but is it this you are telling me about? <a href=\"https://www.haskell.org/platform/doc/2014.2.0.0/ghc/users_guide/ffi.html#ffi-newtype-io\" rel=\"nofollow noreferrer\">haskell.org/platform/doc/2014.2.0.0/ghc/users_guide/&hellip;</a>"}, {"owner": {"reputation": 126897, "user_id": 791604, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/ce991df7a056248d5e4f6fc3659ba733?s=128&d=identicon&r=PG", "display_name": "Daniel Wagner", "link": "https://stackoverflow.com/users/791604/daniel-wagner"}, "edited": false, "score": 0, "creation_date": 1432848685, "post_id": 30514331, "comment_id": 49109920, "body": "See also: &quot;<a href=\"http://stackoverflow.com/q/8626392/791604\">Can I turn <code>IO [[String]]</code> into <code>[[String]]</code>?</a>&quot;."}, {"owner": {"reputation": 3209, "user_id": 1276374, "user_type": "registered", "accept_rate": 48, "profile_image": "https://www.gravatar.com/avatar/7ce4a877cf573491b23fc6aa1bf18a1d?s=128&d=identicon&r=PG", "display_name": "Boris Mocialov", "link": "https://stackoverflow.com/users/1276374/boris-mocialov"}, "reply_to_user": {"reputation": 126897, "user_id": 791604, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/ce991df7a056248d5e4f6fc3659ba733?s=128&d=identicon&r=PG", "display_name": "Daniel Wagner", "link": "https://stackoverflow.com/users/791604/daniel-wagner"}, "edited": false, "score": 0, "creation_date": 1432853115, "post_id": 30514331, "comment_id": 49111547, "body": "@DanielWagner thank you, that was the most valuable comment"}, {"owner": {"reputation": 3209, "user_id": 1276374, "user_type": "registered", "accept_rate": 48, "profile_image": "https://www.gravatar.com/avatar/7ce4a877cf573491b23fc6aa1bf18a1d?s=128&d=identicon&r=PG", "display_name": "Boris Mocialov", "link": "https://stackoverflow.com/users/1276374/boris-mocialov"}, "edited": false, "score": 0, "creation_date": 1432853255, "post_id": 30514331, "comment_id": 49111599, "body": "To summarise, to flatten/unwrap <code>IO (anything?)</code>, the action must be performed: <code>result &lt;- (feed ..)</code>"}], "owner": {"reputation": 3209, "user_id": 1276374, "user_type": "registered", "accept_rate": 48, "profile_image": "https://www.gravatar.com/avatar/7ce4a877cf573491b23fc6aa1bf18a1d?s=128&d=identicon&r=PG", "display_name": "Boris Mocialov", "link": "https://stackoverflow.com/users/1276374/boris-mocialov"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 174, "favorite_count": 0, "answer_count": 0, "score": 0, "last_activity_date": 1432840149, "creation_date": 1432837456, "last_edit_date": 1432840149, "question_id": 30514331, "link": "https://stackoverflow.com/questions/30514331/return-iodata-vector-storable-vector-from-haskell-to-c", "title": "return IO(Data.Vector.Storable.Vector) from Haskell to C", "body": "<p>I am trying to pass <code>IO (Data.Vector.Storable.Vector Double)</code> from Haskell to C, but there seem to be a problem as Haskell does not allow that. In this case, should I pass a pointer to the vector back to the C program (then how to wrap this object in Ptr) or is there another way? </p>\n\n<p>Also, <code>Data.Vector.Storable</code> seem to have <code>toList</code> function, but when I try to use it, the program does not compile complaining that the Vector is wrapped in IO Monad. </p>\n\n<p>I have tried to find a way to unwrap Vector from IO Monad, but failed to find anything specific, seems like to do so, the IO wrapped object has to be passed to another function, which would have to return back the IO wrapped object again, which, in my opinion, would lead to the same problem again as IO wrapped objects cannot be passed back to C program from the interface.</p>\n\n<pre><code>{-# LANGUAGE ForeignFunctionInterface #-}\nmodule Safe where\n\nimport Foreign\nimport Foreign.C.Types\nimport Data.Vector.Storable\nimport AI.HNN.Recurrent.Network\n\nforeign export ccall process :: Ptr CInt -&gt; Ptr Double -&gt; IO (Data.Vector.Storable.Vector Double) -&gt; IO ()\n\nfeed :: [Double] -&gt; IO (Data.Vector.Storable.Vector Double)\nfeed adj = do\n    let numNeurons = 3\n        numInputs  = 1\n        thresholds = Prelude.replicate numNeurons 0.5\n        inputs     = [[0.38], [0.75]]\n    n &lt;- createNetwork numNeurons numInputs adj thresholds :: IO (Network Double)\n    output &lt;- evalNet n inputs sigmoid\n    return output\n\npeekInt :: Ptr CInt -&gt; IO Int\npeekInt = fmap fromIntegral . peek\n\nprocess :: Ptr CInt -&gt; Ptr Double -&gt; IO (Data.Vector.Storable.Vector Double) -&gt; IO ()\nprocess n xs result = do\n    n &lt;- peekInt n\n    es &lt;- peekArray n xs\n    poke result $ (feed es)\n</code></pre>\n\n<p>Calling and collecting from C</p>\n\n<pre><code>double res = [output_size];\nint asize = sizeof(weights)/sizeof(double);\nprocess(&amp;asize, &amp;weights, &amp;res);\n</code></pre>\n"}, {"tags": ["haskell", "yesod"], "answers": [{"tags": [], "owner": {"reputation": 11743, "user_id": 2597135, "user_type": "registered", "accept_rate": 99, "profile_image": "https://www.gravatar.com/avatar/9b8c6248f917c92724a033de96708542?s=128&d=identicon&r=PG", "display_name": "Uli K&#246;hler", "link": "https://stackoverflow.com/users/2597135/uli-k%c3%b6hler"}, "is_accepted": true, "score": 3, "last_activity_date": 1432835883, "creation_date": 1432835883, "answer_id": 30513844, "question_id": 30513843, "link": "https://stackoverflow.com/questions/30513843/send-301-redirect-in-yesod/30513844#30513844", "title": "Send 301 redirect in Yesod", "body": "<p>You can find an example in the <code>test/YesodCoreTest/Redirect.hs</code> file available in the current <a href=\"https://hackage.haskell.org/package/yesod-core-1.4.9.1/yesod-core-1.4.9.1.tar.gz\" rel=\"nofollow\">Yesod 1.4.9.1 archive</a>:</p>\n\n<pre class=\"lang-haskell prettyprint-override\"><code>import qualified Network.HTTP.Types as H\n\nmyR :: Handler Html\nmyR = redirectWith H.status301 HomeR\n</code></pre>\n\n<p>For a list of available response codes, see the <a href=\"https://hackage.haskell.org/package/http-types/docs/Network-HTTP-Types.html\" rel=\"nofollow\">Network.HTTP.Types documentation</a>.</p>\n"}], "owner": {"reputation": 11743, "user_id": 2597135, "user_type": "registered", "accept_rate": 99, "profile_image": "https://www.gravatar.com/avatar/9b8c6248f917c92724a033de96708542?s=128&d=identicon&r=PG", "display_name": "Uli K&#246;hler", "link": "https://stackoverflow.com/users/2597135/uli-k%c3%b6hler"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 304, "favorite_count": 0, "accepted_answer_id": 30513844, "answer_count": 1, "score": 2, "last_activity_date": 1502710866, "creation_date": 1432835883, "question_id": 30513843, "link": "https://stackoverflow.com/questions/30513843/send-301-redirect-in-yesod", "title": "Send 301 redirect in Yesod", "body": "<p>With this <a href=\"http://www.yesodweb.com/\" rel=\"nofollow\">Yesod</a> handler:</p>\n\n<pre class=\"lang-haskell prettyprint-override\"><code>myR :: Handler Html\nmyR = redirect HomeR\n</code></pre>\n\n<p>I can redirect using the 303/302 status code according to <a href=\"https://hackage.haskell.org/package/yesod-core-1.4.9.1/docs/Yesod-Core-Handler.html#v:redirect\" rel=\"nofollow\">the documentation</a></p>\n\n<p>The documentation states that <a href=\"https://hackage.haskell.org/package/yesod-core-1.4.9.1/docs/Yesod-Core-Handler.html#v:redirectWith\" rel=\"nofollow\">redirectWith</a> shall be used for other status codes. What would be an example of using <code>redirectWith</code> with a 301 status code?</p>\n"}, {"tags": ["image", "haskell", "juicy-pixels"], "answers": [{"tags": [], "owner": {"reputation": 14485, "user_id": 190376, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/cd8280c5e1491b8cf55760750ed97dec?s=128&d=identicon&r=PG", "display_name": "Reid Barton", "link": "https://stackoverflow.com/users/190376/reid-barton"}, "is_accepted": true, "score": 4, "last_activity_date": 1432832367, "creation_date": 1432832367, "answer_id": 30512775, "question_id": 30512442, "link": "https://stackoverflow.com/questions/30512442/juicypixels-cant-load-png-files/30512775#30512775", "title": "JuicyPixels can&#39;t load PNG files", "body": "<blockquote>\n<pre><code>loadSampleImage path = case decodePng path of\n</code></pre>\n</blockquote>\n\n<p>You're trying to literally decode the string \"test.png\" as a PNG. You want <code>readPng</code>, not <code>decodePng</code>. (Or you can just use <code>readImage</code> and not care about what format the file is in.)</p>\n"}], "owner": {"reputation": 3375, "user_id": 1460976, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/05204a29048df8b7a455bb82646083c3?s=128&d=identicon&r=PG", "display_name": "Matt", "link": "https://stackoverflow.com/users/1460976/matt"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 347, "favorite_count": 0, "accepted_answer_id": 30512775, "answer_count": 1, "score": 1, "last_activity_date": 1432832367, "creation_date": 1432831265, "question_id": 30512442, "link": "https://stackoverflow.com/questions/30512442/juicypixels-cant-load-png-files", "title": "JuicyPixels can&#39;t load PNG files", "body": "<p>I'm trying to learn how load, modify and save images using JuicyPixels version 3.2.5.1. I have the following code:</p>\n\n<pre><code>{-# LANGUAGE OverloadedStrings #-}\n\nimport Codec.Picture\n\nimageCreator :: String -&gt; IO ()\nimageCreator path = writePng path $ generateImage pixelRenderer 250 300\n   where pixelRenderer x y = PixelRGB8 (fromIntegral x) (fromIntegral y) 128\n\nloadSampleImage path = case decodePng path of\n  Left errorMsg -&gt; putStrLn errorMsg\n  Right sampleImage -&gt; putStrLn \"Loaded Successfully\"\n\nmain = do \n  imageCreator \"test.png\"\n  loadSampleImage \"test.png\"\n</code></pre>\n\n<p>The <code>imageCreator</code> function is taken with a slight modification from the JuicyPixels documentation: <a href=\"https://hackage.haskell.org/package/JuicyPixels-3.2.5.1/docs/Codec-Picture.html\" rel=\"nofollow\">https://hackage.haskell.org/package/JuicyPixels-3.2.5.1/docs/Codec-Picture.html</a> The modification was the addition of the two calls to <code>fromIntegral</code>, as this example did not compile without them. (It seems strange to me that an example in the documentation wouldn't compile, so if I'm doing something stupid, please let me know)</p>\n\n<p>Running this program will create an image called \"test.png\" and will print:</p>\n\n<blockquote>\n  <p>Invalid PNG file, signature broken</p>\n</blockquote>\n\n<p>which is presumably the error message coming from the call to <code>decodePng</code>. I have tried this with a few other PNGs, one that I created in Gimp, and another that I created in MS paint. I did so by removing the <code>imageCreator \"test.png\"</code> line from my main function, to avoid overwriting the images I wanted to test. </p>\n\n<p>What should I change in order to load PNG images?</p>\n"}, {"tags": ["haskell", "attoparsec"], "answers": [{"comments": [{"owner": {"reputation": 167, "user_id": 3047722, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/3f12b90720fc935a0bf3f8c6ba6bb6f0?s=128&d=identicon&r=PG&f=1", "display_name": "Robert Bermani", "link": "https://stackoverflow.com/users/3047722/robert-bermani"}, "edited": false, "score": 0, "creation_date": 1432826268, "post_id": 30508695, "comment_id": 49096699, "body": "Thanks, much appreciated. It appears this will get me there using Attoparsec, so I&#39;ll mark it as the answer."}], "tags": [], "owner": {"reputation": 28873, "user_id": 1068232, "user_type": "registered", "accept_rate": 79, "profile_image": "https://www.gravatar.com/avatar/2a0a145ce58c20013969fe3f203531da?s=128&d=identicon&r=PG", "display_name": "Andr&#225;s Kov&#225;cs", "link": "https://stackoverflow.com/users/1068232/andr%c3%a1s-kov%c3%a1cs"}, "is_accepted": true, "score": 5, "last_activity_date": 1432821400, "creation_date": 1432821400, "answer_id": 30508695, "question_id": 30505255, "link": "https://stackoverflow.com/questions/30505255/does-attoparsec-support-saving-and-modifying-user-state/30508695#30508695", "title": "Does Attoparsec support saving and modifying user state?", "body": "<p>You can use <code>StateT s Parser</code>, just be mindful that backtracking in the parser also rolls back the state, so you only get those stateful actions that were invoked on the code path with the successful parse.</p>\n\n<pre><code>{-# LANGUAGE OverloadedStrings #-}\n\nimport Data.Attoparsec.ByteString.Char8\nimport Control.Monad.State\nimport Control.Applicative\n\ntest :: StateT Int Parser ()\ntest = do\n  many $ choice [\n    (modify (+1) *&gt; lift (string \"car\")),\n    (modify (+1) *&gt; lift (string \"cat\"))]\n  pure ()\n\nparseOnly (runStateT test 0) \"catcatcat\"\n-- Right ((),3)\n</code></pre>\n\n<p>Also, we can use most of the <code>Attoparsec</code> combinators out of the box, because they have generic types with <code>Alternative</code>, <code>MonadPlus</code>, <code>Applicative</code> or <code>Monad</code> constraints, and <code>StateT</code> defines lift-through instances for these. We can use <code>lift</code> for the basic <code>Parser</code>-s. </p>\n"}], "owner": {"reputation": 167, "user_id": 3047722, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/3f12b90720fc935a0bf3f8c6ba6bb6f0?s=128&d=identicon&r=PG&f=1", "display_name": "Robert Bermani", "link": "https://stackoverflow.com/users/3047722/robert-bermani"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 369, "favorite_count": 2, "accepted_answer_id": 30508695, "answer_count": 1, "score": 6, "last_activity_date": 1432821400, "creation_date": 1432812460, "question_id": 30505255, "link": "https://stackoverflow.com/questions/30505255/does-attoparsec-support-saving-and-modifying-user-state", "title": "Does Attoparsec support saving and modifying user state?", "body": "<p>I'm using Attoparsec, and I would like to track a user state value throughout a parsing task.</p>\n\n<p>I'm familiar with the monadic functions getState, putState, and modifyState of Parsec, but I can't seem to find an analogue within Attoparsec. Is there a trivial way to do this with something internal to Attoparsec or by using a State monad?</p>\n"}, {"tags": ["haskell", "lazy-evaluation"], "comments": [{"owner": {"reputation": 43759, "user_id": 1651941, "user_type": "registered", "accept_rate": 97, "profile_image": "https://www.gravatar.com/avatar/a513bc1fa519d2fcf5e4e0d9b5500101?s=128&d=identicon&r=PG", "display_name": "Sibi", "link": "https://stackoverflow.com/users/1651941/sibi"}, "edited": false, "score": 3, "creation_date": 1432807226, "post_id": 30502941, "comment_id": 49082187, "body": "One can argue that it&#39;s not always the case: <code>foldl (*) 1 [0, undefined]</code>"}, {"owner": {"reputation": 58792, "user_id": 1006010, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/f683d229f3673c9dcc3f3f2796d75c09?s=128&d=identicon&r=PG", "display_name": "MathematicalOrchid", "link": "https://stackoverflow.com/users/1006010/mathematicalorchid"}, "edited": false, "score": 11, "creation_date": 1432810617, "post_id": 30502941, "comment_id": 49084513, "body": "Alternatively, how about NaN? Because, in IEEE floating-point, anything * NaN = NaN. In particular, 0 * NaN = NaN."}], "answers": [{"comments": [{"owner": {"reputation": 538, "user_id": 4875652, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/6ea513cad32d33ca70db6369d6277875?s=128&d=identicon&r=PG&f=1", "display_name": "Sergio Losilla", "link": "https://stackoverflow.com/users/4875652/sergio-losilla"}, "edited": false, "score": 0, "creation_date": 1432812423, "post_id": 30503289, "comment_id": 49085843, "body": "<code>foldr (*) 1 [0..]</code> does not evaluate in one step for me. Neither does it with <code>myProduct</code>. What did I miss?"}, {"owner": {"reputation": 13772, "user_id": 379311, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/c993f4f111e6ff3211ccda1b98828253?s=128&d=identicon&r=PG", "display_name": "Yann Vernier", "link": "https://stackoverflow.com/users/379311/yann-vernier"}, "reply_to_user": {"reputation": 538, "user_id": 4875652, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/6ea513cad32d33ca70db6369d6277875?s=128&d=identicon&r=PG&f=1", "display_name": "Sergio Losilla", "link": "https://stackoverflow.com/users/4875652/sergio-losilla"}, "edited": false, "score": 2, "creation_date": 1432813016, "post_id": 30503289, "comment_id": 49086325, "body": "Not sure. It does for me with <code>myProduct</code>: <code>let myProduct a b = case (a,b) of (0,_) -&gt; 0 ; (_,0) -&gt; 0; (x,y) -&gt; x*y</code> followed by <code>foldr myProduct 1 [0..]</code> produces 0 in ghci."}, {"owner": {"reputation": 538, "user_id": 4875652, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/6ea513cad32d33ca70db6369d6277875?s=128&d=identicon&r=PG&f=1", "display_name": "Sergio Losilla", "link": "https://stackoverflow.com/users/4875652/sergio-losilla"}, "edited": false, "score": 0, "creation_date": 1432813574, "post_id": 30503289, "comment_id": 49086779, "body": "Son of a gun! If you change the order of the cases (or the patterns in the case I posted) it doesn&#39;t work any more! Any explanation for that?"}, {"owner": {"reputation": 13772, "user_id": 379311, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/c993f4f111e6ff3211ccda1b98828253?s=128&d=identicon&r=PG", "display_name": "Yann Vernier", "link": "https://stackoverflow.com/users/379311/yann-vernier"}, "reply_to_user": {"reputation": 538, "user_id": 4875652, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/6ea513cad32d33ca70db6369d6277875?s=128&d=identicon&r=PG&f=1", "display_name": "Sergio Losilla", "link": "https://stackoverflow.com/users/4875652/sergio-losilla"}, "edited": false, "score": 6, "creation_date": 1432813777, "post_id": 30503289, "comment_id": 49086910, "body": "Yes. The pattern matching is strict; if it has to check for <code>_ 0</code>, it must determine whether the second argument is zero or not, meaning it must be evaluated. The shortcut must be in the first pattern."}, {"owner": {"reputation": 44013, "user_id": 1477667, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/trgKM.jpg?s=128&g=1", "display_name": "dfeuer", "link": "https://stackoverflow.com/users/1477667/dfeuer"}, "edited": false, "score": 1, "creation_date": 1432827933, "post_id": 30503289, "comment_id": 49097983, "body": "You can write a right fold that uses constant space and terminates as soon as it finds a 0. The trick is to fold a function that takes <i>three</i> arguments instead of two. Can you see how?"}, {"owner": {"reputation": 126897, "user_id": 791604, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/ce991df7a056248d5e4f6fc3659ba733?s=128&d=identicon&r=PG", "display_name": "Daniel Wagner", "link": "https://stackoverflow.com/users/791604/daniel-wagner"}, "reply_to_user": {"reputation": 44013, "user_id": 1477667, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/trgKM.jpg?s=128&g=1", "display_name": "dfeuer", "link": "https://stackoverflow.com/users/1477667/dfeuer"}, "edited": false, "score": 0, "creation_date": 1432848892, "post_id": 30503289, "comment_id": 49110006, "body": "@dfeuer Doesn&#39;t <code>foldr myProduct</code> (using <code>myProduct</code> as defined in the question) already use constant space (well, enough space for a constant number of numbers, anyway) and terminate as soon as it finds a 0, without requiring a three-argument function?"}, {"owner": {"reputation": 61419, "user_id": 849891, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/MbEO3.png?s=128&g=1", "display_name": "Will Ness", "link": "https://stackoverflow.com/users/849891/will-ness"}, "reply_to_user": {"reputation": 44013, "user_id": 1477667, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/trgKM.jpg?s=128&g=1", "display_name": "dfeuer", "link": "https://stackoverflow.com/users/1477667/dfeuer"}, "edited": false, "score": 0, "creation_date": 1432849092, "post_id": 30503289, "comment_id": 49110090, "body": "@dfeuer I think that&#39;s a left fold though; indeed implemented with <code>foldr</code>."}, {"owner": {"reputation": 61419, "user_id": 849891, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/MbEO3.png?s=128&g=1", "display_name": "Will Ness", "link": "https://stackoverflow.com/users/849891/will-ness"}, "reply_to_user": {"reputation": 126897, "user_id": 791604, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/ce991df7a056248d5e4f6fc3659ba733?s=128&d=identicon&r=PG", "display_name": "Daniel Wagner", "link": "https://stackoverflow.com/users/791604/daniel-wagner"}, "edited": false, "score": 0, "creation_date": 1432849260, "post_id": 30503289, "comment_id": 49110165, "body": "@DanielWagner what if there&#39;s no 0 though? it will cause a stack explosion then, certainly not constant space operation - it forces the 2nd argument if 1st is non-zero. Similarly, if first 0 is a 100th element, it will unwind the 100 stack frames multiplying the 0 back, after finding that 100-th element, stopping the list scan, and starting the multiplications created on the stack."}], "tags": [], "owner": {"reputation": 13772, "user_id": 379311, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/c993f4f111e6ff3211ccda1b98828253?s=128&d=identicon&r=PG", "display_name": "Yann Vernier", "link": "https://stackoverflow.com/users/379311/yann-vernier"}, "is_accepted": true, "score": 21, "last_activity_date": 1432846350, "last_edit_date": 1432846350, "creation_date": 1432807265, "answer_id": 30503289, "question_id": 30502941, "link": "https://stackoverflow.com/questions/30502941/why-doesnt-product-0-evaluate-to-0-instantly/30503289#30503289", "title": "Why doesn&#39;t product [0..] evaluate to 0 &quot;instantly&quot;?", "body": "<p>Because the multiply operator doesn't know it's getting chained, and the fold function doesn't know the multiply operator's particular behaviour for any argument. With that combination, it needs to exhaust the list to finish the fold. In fact, for this reason <a href=\"https://www.haskell.org/hoogle/?hoogle=foldl\" rel=\"noreferrer\">foldl</a> doesn't work at all on infinite lists. <a href=\"https://www.haskell.org/hoogle/?hoogle=foldr\" rel=\"noreferrer\">foldr</a> does, because it can expand the function from the head of the list. </p>\n\n<pre><code>foldl (*) 1 [0..] -&gt; (((..(((1*0)*1)*2)*3....)*inf\n</code></pre>\n\n<p>The outermost multiplication in the foldl case can never be found, because the list is infinite. It therefore cannot follow the chain to conclude the result is zero. It can, and does, calculate the product along the list, and that product happens to stay zero, but it will not terminate. If you use <a href=\"https://www.haskell.org/hoogle/?hoogle=scanl\" rel=\"noreferrer\">scanl</a> instead you can see these intermediate products. </p>\n\n<pre><code>foldr (*) 1 [0..] -&gt; 0*(1*(2*(3*((...((inf*1)))...)))\n</code></pre>\n\n<p>The outermost multiplication in the foldr case is found immediately, because the rest of the list is in fact left as a lazy thunk. It only runs one step:</p>\n\n<pre><code>foldr (*) 1 [0..] -&gt; 0*(foldr (*) 1 [1..])\n</code></pre>\n\n<p>So because your custom multiplication operator <code>myProduct</code> is not strict in the second argument if the first argument is zero, <code>foldr myProduct 1 [0..]</code> can terminate. </p>\n\n<p>As a side note, the prelude product function is restricted to finite lists (and may be implemented with foldl). Even if it used foldr, it probably would not shortcut because the standard multiply operator is strict; doing otherwise would be computationally expensive in the common case where the products are neither zero nor chained. </p>\n\n<pre><code>-- sum and product compute the sum or product of a finite list of numbers.\n\nsum, product     :: (Num a) =&gt; [a] -&gt; a\nsum              =  foldl (+) 0  \nproduct          =  foldl (*) 1\n</code></pre>\n\n<p>In addition, there's a reason it does not use foldr; as we could see in the expansions and scanl function, the left folds can compute as they consume the list. The right fold, if the operator does not shortcut, needs to build an expression as large as the list itself to even begin computation. This difference is because it's the innermost expression that starts the computation in the strict case, but the outermost expression that produces the result, allowing the lazy case. <a href=\"https://wiki.haskell.org/Lazy_vs._non-strict\" rel=\"noreferrer\">Lazy vs. non-strict</a> in the Haskell wiki might explain better than I can, and even mentions that pattern matching, which you used to describe the shortcut in myProduct, can be strict. </p>\n"}, {"comments": [{"owner": {"reputation": 126897, "user_id": 791604, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/ce991df7a056248d5e4f6fc3659ba733?s=128&d=identicon&r=PG", "display_name": "Daniel Wagner", "link": "https://stackoverflow.com/users/791604/daniel-wagner"}, "edited": false, "score": 2, "creation_date": 1432849021, "post_id": 30513587, "comment_id": 49110059, "body": "<a href=\"http://hackage.haskell.org/package/unamb-0.2.5/docs/Data-Unamb.html#v:pmult\" rel=\"nofollow noreferrer\">Impossible, you say?</a>"}], "tags": [], "owner": {"reputation": 62902, "user_id": 90511, "user_type": "registered", "accept_rate": 91, "profile_image": "https://i.stack.imgur.com/nmOPo.png?s=128&g=1", "display_name": "hugomg", "link": "https://stackoverflow.com/users/90511/hugomg"}, "is_accepted": false, "score": 2, "last_activity_date": 1432835026, "creation_date": 1432835026, "answer_id": 30513587, "question_id": 30502941, "link": "https://stackoverflow.com/questions/30502941/why-doesnt-product-0-evaluate-to-0-instantly/30513587#30513587", "title": "Why doesn&#39;t product [0..] evaluate to 0 &quot;instantly&quot;?", "body": "<p>If you switch the first two lines:</p>\n\n<pre><code>myProduct _ 0 = 0\nmyProduct 0 _ = 0\nmyProduct a b = a*b\n</code></pre>\n\n<p>the second argument will always be evaluated before the first one and the infinite foldr won't work anymore.</p>\n\n<p>Since its impossible to define a <code>myProduct</code> that works lazily for both arguments (not evaluating the second if the first is 0 and not evaluating the first if the second is 0) maybe we are better off with having <code>*</code> always evaluate both its arguments.</p>\n"}, {"tags": [], "owner": {"reputation": 61419, "user_id": 849891, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/MbEO3.png?s=128&g=1", "display_name": "Will Ness", "link": "https://stackoverflow.com/users/849891/will-ness"}, "is_accepted": false, "score": 0, "last_activity_date": 1432892873, "last_edit_date": 1432892873, "creation_date": 1432849895, "answer_id": 30517691, "question_id": 30502941, "link": "https://stackoverflow.com/questions/30502941/why-doesnt-product-0-evaluate-to-0-instantly/30517691#30517691", "title": "Why doesn&#39;t product [0..] evaluate to 0 &quot;instantly&quot;?", "body": "<p>You can have it thusly:</p>\n\n<pre><code>myproduct xs = foldr op id xs 1\n  where\n    op x r acc = if x==0 then 0 else acc `seq` r (acc*x)\n</code></pre>\n\n<p>This is a right fold that multiplies the numbers from the left, operating in constant space, and stops as soon as a 0 is encountered.</p>\n"}], "owner": {"reputation": 538, "user_id": 4875652, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/6ea513cad32d33ca70db6369d6277875?s=128&d=identicon&r=PG&f=1", "display_name": "Sergio Losilla", "link": "https://stackoverflow.com/users/4875652/sergio-losilla"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 537, "favorite_count": 1, "accepted_answer_id": 30503289, "answer_count": 3, "score": 16, "last_activity_date": 1432892873, "creation_date": 1432806344, "question_id": 30502941, "link": "https://stackoverflow.com/questions/30502941/why-doesnt-product-0-evaluate-to-0-instantly", "title": "Why doesn&#39;t product [0..] evaluate to 0 &quot;instantly&quot;?", "body": "<p>I am trying to understand laziness. Because 0 multiplied with any number is 0, shouldn't <code>product [0..]</code> evaluate to 0? I tried also <code>foldl (*) 1 [0..]</code>, and to define my own product as</p>\n\n<pre><code>myProduct 0 _ = 0\nmyProduct _ 0 = 0\nmyProduct a b = a*b\n</code></pre>\n\n<p>Why doesn't the fold stop as soon as a 0 is found?</p>\n"}]