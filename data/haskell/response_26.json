[{"tags": ["haskell", "anonymous-function"], "answers": [{"tags": [], "owner": {"reputation": 16233, "user_id": 4253229, "user_type": "registered", "accept_rate": 83, "profile_image": "https://lh4.googleusercontent.com/-e2FAQvlj5CQ/AAAAAAAAAAI/AAAAAAAAAqM/TlSnekirgNE/photo.jpg?sz=128", "display_name": "Eugene Sh.", "link": "https://stackoverflow.com/users/4253229/eugene-sh"}, "is_accepted": false, "score": 6, "last_activity_date": 1436382094, "creation_date": 1436382094, "answer_id": 31301462, "question_id": 31301307, "link": "https://stackoverflow.com/questions/31301307/haskell-anonymous-function-with-two-arguments/31301462#31301462", "title": "Haskell: anonymous function with two arguments", "body": "<p>Giving a function of two arguments only one is resulting in a <a href=\"https://wiki.haskell.org/Partial_application\">partial application</a> of that function, whose result is a function of one (the remaining) argument. While in your case the signature of the returned function is <code>Integer -&gt; Integer</code>.</p>\n"}, {"tags": [], "owner": {"reputation": 226, "user_id": 3877789, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/73466b04693c12f3d61485569f65bb33?s=128&d=identicon&r=PG", "display_name": "Adam Saltz", "link": "https://stackoverflow.com/users/3877789/adam-saltz"}, "is_accepted": true, "score": 11, "last_activity_date": 1436392706, "last_edit_date": 1436392706, "creation_date": 1436382206, "answer_id": 31301497, "question_id": 31301307, "link": "https://stackoverflow.com/questions/31301307/haskell-anonymous-function-with-two-arguments/31301497#31301497", "title": "Haskell: anonymous function with two arguments", "body": "<p>Look at it this way: if you had provided a value for y, you'd get an integer.  If you don't provide a value, you'll get an expression which takes an integer (which you call y) and returns an integer, i.e. a function </p>\n\n<pre><code>Integer -&gt; Integer\n</code></pre>\n\n<p>This works for named functions too.  E.g. </p>\n\n<pre><code>plus :: Int -&gt; Int -&gt; Int\nplus x y = x + y\n</code></pre>\n\n<p>You can check in ghci that the type of <code>plus 1</code> is <code>Int -&gt; Int</code>.  In fact, this process works for any function in Haskell.  You read more at the <a href=\"https://wiki.haskell.org/Partial_application\" rel=\"noreferrer\">HaskellWiki</a>.</p>\n"}, {"tags": [], "owner": {"reputation": 100892, "user_id": 745903, "user_type": "registered", "accept_rate": 74, "profile_image": "https://www.gravatar.com/avatar/50933f6638836741e620669b3940410e?s=128&d=identicon&r=PG", "display_name": "leftaroundabout", "link": "https://stackoverflow.com/users/745903/leftaroundabout"}, "is_accepted": false, "score": 7, "last_activity_date": 1436394866, "last_edit_date": 1436394866, "creation_date": 1436394452, "answer_id": 31304911, "question_id": 31301307, "link": "https://stackoverflow.com/questions/31301307/haskell-anonymous-function-with-two-arguments/31304911#31304911", "title": "Haskell: anonymous function with two arguments", "body": "<p>Note that</p>\n\n<pre><code>\\x y -&gt; y+y\n</code></pre>\n\n<p>is syntactic sugar for</p>\n\n<pre><code>\\x -&gt; (\\y -&gt; y+y)\n</code></pre>\n\n<p>i.e. rather than saying &ldquo;a lambda function of two arguments&rdquo; you might say it's a function of only one argument. The return type just happens to be again a function.</p>\n\n<p>This <a href=\"https://en.wikipedia.org/wiki/Currying\" rel=\"noreferrer\">currying</a> technique is really crucial for good Haskell code; partial application makes many things very concise without sacrificing readability. For example,</p>\n\n<pre><code>GHCi&gt; map (logBase 2) [1,2,4,8,16]\n[0.0, 1.0, 2.0, 3.0, 4.0]\n</code></pre>\n\n<p>Here I've used <code>logBase</code> as a function of a single argument (<code>2</code>), which gives me a simple number\u2192number function that can be mapped over a list. Without currying, I would have needed to write <code>map (\\x -&gt; logBase(2,x)) [1,2,4,8,16]</code>.</p>\n"}], "owner": {"reputation": 33, "user_id": 5095388, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/6c93dfb9eadc7f24a1815778438c55ba?s=128&d=identicon&r=PG&f=1", "display_name": "haxl", "link": "https://stackoverflow.com/users/5095388/haxl"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 6767, "favorite_count": 1, "accepted_answer_id": 31301497, "answer_count": 3, "score": 3, "last_activity_date": 1436394866, "creation_date": 1436381603, "question_id": 31301307, "link": "https://stackoverflow.com/questions/31301307/haskell-anonymous-function-with-two-arguments", "title": "Haskell: anonymous function with two arguments", "body": "<p>I have the following anonymous function:</p>\n\n<pre><code>(\\x y -&gt; y+y) (5*(7+20))\n</code></pre>\n\n<p>As far as I understand anonymous functions, x should be (5*(7+20)) and y is not given (which is where it gets fishy). When I try to execute that function, GHCI tells me the return value is</p>\n\n<pre><code>Integer -&gt; Integer\n</code></pre>\n\n<p>So obviously my interpretation is wrong here and I just can't see why. Can anyone explain to me what is happening here?</p>\n"}, {"tags": ["haskell", "profiling", "ghc"], "comments": [{"owner": {"reputation": 84731, "user_id": 510937, "user_type": "registered", "accept_rate": 80, "profile_image": "https://www.gravatar.com/avatar/70b13a9ae1aae1ca1aa6ac8dab4643f2?s=128&d=identicon&r=PG", "display_name": "Bakuriu", "link": "https://stackoverflow.com/users/510937/bakuriu"}, "edited": false, "score": 2, "creation_date": 1436380706, "post_id": 31300771, "comment_id": 50592113, "body": "<code>compare</code> and <code>==</code> <b>are already</b> the most specific names. They are the names of the methods from the <code>Ord</code> class. The <code>deriving</code> clause is an <code>instance</code> declaration where you defined the dictionary associated to an instance of the class. It seems like if you want to remove overloading from the code, but to do this you probably simply have to remove polymorphism from the code or use some <code>PRAGMA</code> for the compiler."}, {"owner": {"reputation": 293, "user_id": 4530052, "user_type": "registered", "accept_rate": 33, "profile_image": "https://www.gravatar.com/avatar/67c7db4146b0cff401bf789ce8ed8fa5?s=128&d=identicon&r=PG&f=1", "display_name": "Oxy", "link": "https://stackoverflow.com/users/4530052/oxy"}, "reply_to_user": {"reputation": 84731, "user_id": 510937, "user_type": "registered", "accept_rate": 80, "profile_image": "https://www.gravatar.com/avatar/70b13a9ae1aae1ca1aa6ac8dab4643f2?s=128&d=identicon&r=PG", "display_name": "Bakuriu", "link": "https://stackoverflow.com/users/510937/bakuriu"}, "edited": false, "score": 1, "creation_date": 1436381622, "post_id": 31300771, "comment_id": 50592720, "body": "I don&#39;t want to remove overloading. I just want to find out if <code>==</code> is for type <code>A</code> or <code>B</code>. It could be easily done for hand written instances: set a different name for the implementation of each instance. But, since the implementation of the <code>Eq</code> is hidden from me (unless I implement it myself, not using the <code>deriving</code> keyword), I cannot use the <code>SCC</code> pragma."}, {"owner": {"reputation": 293, "user_id": 4530052, "user_type": "registered", "accept_rate": 33, "profile_image": "https://www.gravatar.com/avatar/67c7db4146b0cff401bf789ce8ed8fa5?s=128&d=identicon&r=PG&f=1", "display_name": "Oxy", "link": "https://stackoverflow.com/users/4530052/oxy"}, "reply_to_user": {"reputation": 84731, "user_id": 510937, "user_type": "registered", "accept_rate": 80, "profile_image": "https://www.gravatar.com/avatar/70b13a9ae1aae1ca1aa6ac8dab4643f2?s=128&d=identicon&r=PG", "display_name": "Bakuriu", "link": "https://stackoverflow.com/users/510937/bakuriu"}, "edited": false, "score": 1, "creation_date": 1436381868, "post_id": 31300771, "comment_id": 50592876, "body": "By the way, <code>compare</code> and <code>==</code> are not the most specific names, I guess. They could be something like <code>A.compare</code> or <code>== of B</code>."}, {"owner": {"reputation": 4565, "user_id": 1134885, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/7c428466054762cf7d4b5fb5f4396fa2?s=128&d=identicon&r=PG", "display_name": "NovaDenizen", "link": "https://stackoverflow.com/users/1134885/novadenizen"}, "edited": false, "score": 0, "creation_date": 1436389600, "post_id": 31300771, "comment_id": 50597312, "body": "I haven&#39;t used it, and it looks like it requires Template Haskell, but <a href=\"https://www.cs.york.ac.uk/fp/darcs/derive/derive.htm\" rel=\"nofollow noreferrer\">Data.Derive</a> can spit out the code for derived instances, though possibly not the same code GHC generates."}, {"owner": {"reputation": 17809, "user_id": 1088108, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/63781cd38e91aa346a3849bc3ef3e550?s=128&d=identicon&r=PG&f=1", "display_name": "&#216;rjan Johansen", "link": "https://stackoverflow.com/users/1088108/%c3%98rjan-johansen"}, "edited": false, "score": 1, "creation_date": 1436499495, "post_id": 31300771, "comment_id": 50649338, "body": "There&#39;s a 3 year old open <a href=\"https://ghc.haskell.org/trac/ghc/ticket/7105\" rel=\"nofollow noreferrer\">GHC feature request</a> for this, which alas seems to have got little attention."}], "answers": [{"comments": [{"owner": {"reputation": 293, "user_id": 4530052, "user_type": "registered", "accept_rate": 33, "profile_image": "https://www.gravatar.com/avatar/67c7db4146b0cff401bf789ce8ed8fa5?s=128&d=identicon&r=PG&f=1", "display_name": "Oxy", "link": "https://stackoverflow.com/users/4530052/oxy"}, "edited": false, "score": 0, "creation_date": 1436479348, "post_id": 31303825, "comment_id": 50644076, "body": "This sounds to be a reasonable workaround, but I get weird field names such as <code>g2_ag0CR</code> and <code>b_aidSP</code> in the output. Optimization is also turned off with <code>-O0</code>, but it doesn&#39;t help."}, {"owner": {"reputation": 4565, "user_id": 1134885, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/7c428466054762cf7d4b5fb5f4396fa2?s=128&d=identicon&r=PG", "display_name": "NovaDenizen", "link": "https://stackoverflow.com/users/1134885/novadenizen"}, "reply_to_user": {"reputation": 293, "user_id": 4530052, "user_type": "registered", "accept_rate": 33, "profile_image": "https://www.gravatar.com/avatar/67c7db4146b0cff401bf789ce8ed8fa5?s=128&d=identicon&r=PG&f=1", "display_name": "Oxy", "link": "https://stackoverflow.com/users/4530052/oxy"}, "edited": false, "score": 0, "creation_date": 1436479579, "post_id": 31303825, "comment_id": 50644161, "body": "Those are unique names GHC generates.  They&#39;re created there and only used there, so you can manually rename them to anything you want, like <code>mytype_compare</code> or <code>mytype_eq</code>."}, {"owner": {"reputation": 293, "user_id": 4530052, "user_type": "registered", "accept_rate": 33, "profile_image": "https://www.gravatar.com/avatar/67c7db4146b0cff401bf789ce8ed8fa5?s=128&d=identicon&r=PG&f=1", "display_name": "Oxy", "link": "https://stackoverflow.com/users/4530052/oxy"}, "edited": false, "score": 0, "creation_date": 1436485715, "post_id": 31303825, "comment_id": 50646108, "body": "All right, it seems that this approach is not so straight forward. I had to fix a lot of things manually, but I cannot figure out this one: there are a few calls to a <code>$con2tag_Foo</code> function, which I cannot find the definition in the dump. Do you have any idea about it?"}, {"owner": {"reputation": 17809, "user_id": 1088108, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/63781cd38e91aa346a3849bc3ef3e550?s=128&d=identicon&r=PG&f=1", "display_name": "&#216;rjan Johansen", "link": "https://stackoverflow.com/users/1088108/%c3%98rjan-johansen"}, "edited": false, "score": 0, "creation_date": 1436501122, "post_id": 31303825, "comment_id": 50649748, "body": "Googling for <code>con2tag_Foo ghc</code> found me <a href=\"https://git.haskell.org/ghc.git/blob/08af5517f9057f999ef6db382b2b9b51aea215c9:/compiler/typecheck/TcGenDeriv.lhs#l1842\" rel=\"nofollow noreferrer\">this explanation</a>. <code>con2tag_Foo :: Foo ... -&gt; Int#</code> seems to be a function for converting a value of type <code>Foo ...</code> to an <code>Int#</code> tag for its constructor, numbered starting at 0, and is (or was, the file seems to have no HEAD version?) used to make more efficient instances of various classes."}, {"owner": {"reputation": 4565, "user_id": 1134885, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/7c428466054762cf7d4b5fb5f4396fa2?s=128&d=identicon&r=PG", "display_name": "NovaDenizen", "link": "https://stackoverflow.com/users/1134885/novadenizen"}, "edited": false, "score": 0, "creation_date": 1436511360, "post_id": 31303825, "comment_id": 50653298, "body": "<code>$con2tag</code> looks like it&#39;s deep internal GHC magic.  I think it represents an inaccessible ghc-internal function created along with the datatype."}, {"owner": {"reputation": 293, "user_id": 4530052, "user_type": "registered", "accept_rate": 33, "profile_image": "https://www.gravatar.com/avatar/67c7db4146b0cff401bf789ce8ed8fa5?s=128&d=identicon&r=PG&f=1", "display_name": "Oxy", "link": "https://stackoverflow.com/users/4530052/oxy"}, "edited": false, "score": 0, "creation_date": 1436809872, "post_id": 31303825, "comment_id": 50756933, "body": "How about a generic implementation of <code>Ord</code> similar to the one available for <a href=\"https://hackage.haskell.org/package/generic-deriving-1.5.0/docs/Generics-Deriving-Eq.html\" rel=\"nofollow noreferrer\"><code>Eq</code></a> or <a href=\"http://hackage.haskell.org/package/hashable-generics-1.1.8/docs/Data-Hashable-Generic.html\" rel=\"nofollow noreferrer\"><code>Hashable</code></a>? Is there any <code>GOrd</code> implementation available?"}], "tags": [], "owner": {"reputation": 4565, "user_id": 1134885, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/7c428466054762cf7d4b5fb5f4396fa2?s=128&d=identicon&r=PG", "display_name": "NovaDenizen", "link": "https://stackoverflow.com/users/1134885/novadenizen"}, "is_accepted": false, "score": 4, "last_activity_date": 1436389872, "creation_date": 1436389872, "answer_id": 31303825, "question_id": 31300771, "link": "https://stackoverflow.com/questions/31300771/profiling-ghc-generated-functions-with-deriving-keyword/31303825#31303825", "title": "Profiling GHC generated functions with `deriving` keyword", "body": "<p>Use <a href=\"https://downloads.haskell.org/~ghc/6.10.4/docs/html/users_guide/options-debugging.html\" rel=\"nofollow\"><code>-ddump-deriv</code></a> to dump out the code for the actual derived instances GHC generates, then grab the code and put it under your own explicitly defined functions.  Then explicitly derive the instances and point them at your functions.</p>\n"}], "owner": {"reputation": 293, "user_id": 4530052, "user_type": "registered", "accept_rate": 33, "profile_image": "https://www.gravatar.com/avatar/67c7db4146b0cff401bf789ce8ed8fa5?s=128&d=identicon&r=PG&f=1", "display_name": "Oxy", "link": "https://stackoverflow.com/users/4530052/oxy"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 88, "favorite_count": 0, "answer_count": 1, "score": 2, "last_activity_date": 1436389872, "creation_date": 1436380068, "question_id": 31300771, "link": "https://stackoverflow.com/questions/31300771/profiling-ghc-generated-functions-with-deriving-keyword", "title": "Profiling GHC generated functions with `deriving` keyword", "body": "<p>I am trying to optimize a Haskell program. In the profiler output, I see that a lot of time is spent inside <code>compare</code> and <code>==</code> functions. But, the GHC profiler doesn't tell me anything more than the module name of those functions. I guess these are the GHC generated functions using deriving <code>Eq</code> and <code>Ord</code>. I wonder if there is an easy way to pinpoint where the actual problem is. For instance, using\n<code>{-# SCC \"more-specific-name\" #-}</code> for those functions.</p>\n"}, {"tags": ["haskell", "cabal", "yesod"], "comments": [{"owner": {"reputation": 84731, "user_id": 510937, "user_type": "registered", "accept_rate": 80, "profile_image": "https://www.gravatar.com/avatar/70b13a9ae1aae1ca1aa6ac8dab4643f2?s=128&d=identicon&r=PG", "display_name": "Bakuriu", "link": "https://stackoverflow.com/users/510937/bakuriu"}, "edited": false, "score": 1, "creation_date": 1436379681, "post_id": 31300398, "comment_id": 50591514, "body": "well... if the <i>yesod developers</i> strongly suggest one of the options, why do you ask us?"}, {"owner": {"reputation": 1040, "user_id": 4031371, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/442e7ad304b6b890126c2edc315570e1?s=128&d=identicon&r=PG", "display_name": "Robin", "link": "https://stackoverflow.com/users/4031371/robin"}, "reply_to_user": {"reputation": 84731, "user_id": 510937, "user_type": "registered", "accept_rate": 80, "profile_image": "https://www.gravatar.com/avatar/70b13a9ae1aae1ca1aa6ac8dab4643f2?s=128&d=identicon&r=PG", "display_name": "Bakuriu", "link": "https://stackoverflow.com/users/510937/bakuriu"}, "edited": false, "score": 0, "creation_date": 1436380182, "post_id": 31300398, "comment_id": 50591831, "body": "i would like to know the differences between them and if someone has made different/better experiences with one of them"}], "answers": [{"comments": [{"owner": {"reputation": 30377, "user_id": 369198, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/71596bb1ca3ba3aa4400c3f407baec9f?s=128&d=identicon&r=PG", "display_name": "Michael Snoyman", "link": "https://stackoverflow.com/users/369198/michael-snoyman"}, "edited": false, "score": 0, "creation_date": 1436460789, "post_id": 31302936, "comment_id": 50633897, "body": "I&#39;m curious, who&#39;s saying to stay away from stack? What reasons do they give? This is news to me. In addition, <a href=\"https://www.fpcomplete.com/blog/2015/06/why-is-stack-not-cabal\" rel=\"nofollow noreferrer\">this comparison blog post</a> may be quite useful in understanding things."}, {"owner": {"reputation": 9139, "user_id": 773228, "user_type": "registered", "accept_rate": 62, "profile_image": "https://www.gravatar.com/avatar/baaecdda322cf4462a0dd018d7959b1e?s=128&d=identicon&r=PG&f=1", "display_name": "Justin Wood", "link": "https://stackoverflow.com/users/773228/justin-wood"}, "reply_to_user": {"reputation": 30377, "user_id": 369198, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/71596bb1ca3ba3aa4400c3f407baec9f?s=128&d=identicon&r=PG", "display_name": "Michael Snoyman", "link": "https://stackoverflow.com/users/369198/michael-snoyman"}, "edited": false, "score": 1, "creation_date": 1436464008, "post_id": 31302936, "comment_id": 50635855, "body": "After re-reading my answer, I believe I have mis-represented the comments that people have made to me regarding using stack. I&#39;m going to make an edit to my answer with an explanation."}, {"owner": {"reputation": 30377, "user_id": 369198, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/71596bb1ca3ba3aa4400c3f407baec9f?s=128&d=identicon&r=PG", "display_name": "Michael Snoyman", "link": "https://stackoverflow.com/users/369198/michael-snoyman"}, "edited": false, "score": 0, "creation_date": 1436476015, "post_id": 31302936, "comment_id": 50642551, "body": "Thanks, that attitude makes more sense to me."}], "tags": [], "owner": {"reputation": 9139, "user_id": 773228, "user_type": "registered", "accept_rate": 62, "profile_image": "https://www.gravatar.com/avatar/baaecdda322cf4462a0dd018d7959b1e?s=128&d=identicon&r=PG&f=1", "display_name": "Justin Wood", "link": "https://stackoverflow.com/users/773228/justin-wood"}, "is_accepted": true, "score": 3, "last_activity_date": 1436464435, "last_edit_date": 1436464435, "creation_date": 1436386874, "answer_id": 31302936, "question_id": 31300398, "link": "https://stackoverflow.com/questions/31300398/haskell-environment/31302936#31302936", "title": "Haskell Environment", "body": "<p>There are actually three different packages that are being talked about here. </p>\n\n<ol>\n<li><a href=\"https://hackage.haskell.org/package/cabal-install\" rel=\"nofollow\"><code>cabal-install</code></a> is the current stable binary to build your applications.</li>\n<li><a href=\"https://hackage.haskell.org/package/stack\" rel=\"nofollow\"><code>stack</code></a> was just released to the public recently. I believe it is trying to replace <code>cabal-install</code> as a better, more convenient tool. At the very least, it is showing the Haskell community a different way of something things.</li>\n<li><a href=\"https://hackage.haskell.org/package/Cabal\" rel=\"nofollow\"><code>Cabal</code></a> is the library that both <code>cabal-install</code> and <code>stack</code> are based off of.</li>\n</ol>\n\n<p>As for the differences between the first two tools. </p>\n\n<p><code>cabal-install</code> is a mature application used nearly everywhere within the Haskell community (at least in open source, I have no idea what people are doing behind closed doors).</p>\n\n<p><code>stack</code> is still a new (at least to the public) application used in some newer projects. Some more information can be found <a href=\"https://www.fpcomplete.com/blog/2015/06/announcing-first-public-beta-stack\" rel=\"nofollow\">here</a>. But some of the highlights are:</p>\n\n<ul>\n<li>running <code>stack build</code> in a projects directory will install GHC (Haskell compiler) as well as the needed dependencies for the project.</li>\n<li><code>stack</code>, by default, runs off of <a href=\"https://www.stackage.org/\" rel=\"nofollow\">stackage</a>. Which is a curated version of <a href=\"https://hackage.haskell.org/\" rel=\"nofollow\">hackage</a>. Meaning you can expect the different packages to play nicely with each other. Leading to reproducible builds.</li>\n<li>You can still fall back on hackage should you choose to.</li>\n</ul>\n\n<p>The great thing about these two applications is that they can be used by different people for the same project. If you decide you want to use <code>cabal-install</code> with sandboxes, and someone comes along and wants to help with your project, they can just add the files that <code>stack</code> needs and they can use <code>stack</code> while you continue to use <code>cabal-install</code>. Or vice-versa.</p>\n\n<p><a href=\"https://np.reddit.com/r/haskell/comments/3a6p9h/how_stack_lowers_the_barrier_to_open_source/\" rel=\"nofollow\">here</a> is one persons experience after using <code>stack</code> for the first time. They claim that it is a little bit easier to get started because there are a couple less steps required to get started. If nothing else, people highlight the pros and cons of each tool.</p>\n\n<p><strong>Note</strong>: I'm still fairly new to Haskell, and have never actually used <code>stack</code>. <strike>I've actually been told to stay away from it unless building something in <code>yesod</code></strike>.</p>\n\n<p><strong>Edit</strong>: As stated in a comment under this answer, I believe I have mis-represented what people have told me about stack. The comments people have given me when I asked if I should switch over to stack were more along the lines of, <em>If you are comfortable enough using cabal sandboxes, there is no reason to switch over to stack unless you are having issues</em>.</p>\n"}, {"tags": [], "owner": {"reputation": 43759, "user_id": 1651941, "user_type": "registered", "accept_rate": 97, "profile_image": "https://www.gravatar.com/avatar/a513bc1fa519d2fcf5e4e0d9b5500101?s=128&d=identicon&r=PG", "display_name": "Sibi", "link": "https://stackoverflow.com/users/1651941/sibi"}, "is_accepted": false, "score": 3, "last_activity_date": 1436387347, "creation_date": 1436387347, "answer_id": 31303061, "question_id": 31300398, "link": "https://stackoverflow.com/questions/31300398/haskell-environment/31303061#31303061", "title": "Haskell Environment", "body": "<p>The lead developer of Yesod (Michael Snoyman) is actively involved with the Stack tool. So, I would recommend you to set up Yesod with Stack. Also, Yesod has a quite a complex set of dependencies and using Stackage as the default curated source, helps very much in the installation process (which Stack takes care of by default).</p>\n\n<p>Also <a href=\"https://www.fpcomplete.com/blog/2015/06/why-is-stack-not-cabal\" rel=\"nofollow\">read this post</a> for understanding the differences of Stack from cabal.</p>\n"}], "owner": {"reputation": 1040, "user_id": 4031371, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/442e7ad304b6b890126c2edc315570e1?s=128&d=identicon&r=PG", "display_name": "Robin", "link": "https://stackoverflow.com/users/4031371/robin"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 151, "favorite_count": 1, "accepted_answer_id": 31302936, "answer_count": 2, "score": 2, "last_activity_date": 1436464435, "creation_date": 1436378938, "question_id": 31300398, "link": "https://stackoverflow.com/questions/31300398/haskell-environment", "title": "Haskell Environment", "body": "<p>I recently finished the book \"learnyouahaskell\" and now I would like to apply my acquired knowledge by building a yesod application.</p>\n\n<p>However I am not sure about how to get started.</p>\n\n<p>There seems to be two options on how to set up a yesod project. One is with <a href=\"https://github.com/commercialhaskell/stack\" rel=\"nofollow\">Stack</a>, and the other is with cabal sandboxes.</p>\n\n<p>But what are the differences (If any?) and the similarities between them? Does one count as best practice whereas the other doesn't?</p>\n\n<p>The yesod <a href=\"http://www.yesodweb.com/page/quickstart\" rel=\"nofollow\">quickstart</a> suggests using stack, is this fine or should I use cabal sanbox?</p>\n"}, {"tags": ["haskell", "functional-programming"], "comments": [{"owner": {"reputation": 641, "user_id": 3861396, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/7c5461c6b9136f38ca27541a6b45a6cc?s=128&d=identicon&r=PG&f=1", "display_name": "2016rshah", "link": "https://stackoverflow.com/users/3861396/2016rshah"}, "edited": false, "score": 0, "creation_date": 1436375703, "post_id": 31299223, "comment_id": 50589041, "body": "Is there any reason that you need to use a monad? Or are you open to other solutions to the problem?"}, {"owner": {"reputation": 865, "user_id": 3694032, "user_type": "registered", "accept_rate": 82, "profile_image": "https://www.gravatar.com/avatar/32d8fabde29edf207ac92275275af90a?s=128&d=identicon&r=PG&f=1", "display_name": "rem", "link": "https://stackoverflow.com/users/3694032/rem"}, "reply_to_user": {"reputation": 641, "user_id": 3861396, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/7c5461c6b9136f38ca27541a6b45a6cc?s=128&d=identicon&r=PG&f=1", "display_name": "2016rshah", "link": "https://stackoverflow.com/users/3861396/2016rshah"}, "edited": false, "score": 1, "creation_date": 1436377730, "post_id": 31299223, "comment_id": 50590286, "body": "I did solve the problem not using monad, but I think this is a good place to see how the list monad works"}, {"owner": {"reputation": 49959, "user_id": 866915, "user_type": "registered", "accept_rate": 70, "profile_image": "https://www.gravatar.com/avatar/09242131d6e17cbbe31e8547514da6e5?s=128&d=identicon&r=PG", "display_name": "ErikR", "link": "https://stackoverflow.com/users/866915/erikr"}, "edited": false, "score": 0, "creation_date": 1436383288, "post_id": 31299223, "comment_id": 50593748, "body": "You&#39;re trying to solve the problem by running the Collatz sequence backwards stating with 1. Let&#39;s say you do a breadth-wise expansion. Then your termination condition is &quot;have I seen all of the numbers [1..10^6]  somewhere in my search?&quot; Also, the first time you see a number you want to record the length of the chain to that number. You can stop running the Collatz sequence backwards when you get back to 1, but a sequence could go arbitrarily high before coming back to 1. Maybe use a priority queue to select which numbers to expand next?"}, {"owner": {"reputation": 865, "user_id": 3694032, "user_type": "registered", "accept_rate": 82, "profile_image": "https://www.gravatar.com/avatar/32d8fabde29edf207ac92275275af90a?s=128&d=identicon&r=PG&f=1", "display_name": "rem", "link": "https://stackoverflow.com/users/3694032/rem"}, "edited": false, "score": 0, "creation_date": 1436385309, "post_id": 31299223, "comment_id": 50595023, "body": "I see the problem now -- since I don&#39;t have a way to predict which number will produce the longest chain while end at a point below 1m, there is no way to prioritize the list. Otherwise I could have known the answer in the first place."}], "answers": [{"comments": [{"owner": {"reputation": 865, "user_id": 3694032, "user_type": "registered", "accept_rate": 82, "profile_image": "https://www.gravatar.com/avatar/32d8fabde29edf207ac92275275af90a?s=128&d=identicon&r=PG&f=1", "display_name": "rem", "link": "https://stackoverflow.com/users/3694032/rem"}, "edited": false, "score": 0, "creation_date": 1436385886, "post_id": 31302343, "comment_id": 50595327, "body": "Thanks about the extra info, will definitely look into it!"}, {"owner": {"reputation": 21654, "user_id": 107331, "user_type": "registered", "accept_rate": 80, "profile_image": "https://www.gravatar.com/avatar/cf6d0868b2b4c69bac3e6f265a32b6a7?s=128&d=identicon&r=PG", "display_name": "Daniel Martin", "link": "https://stackoverflow.com/users/107331/daniel-martin"}, "reply_to_user": {"reputation": 865, "user_id": 3694032, "user_type": "registered", "accept_rate": 82, "profile_image": "https://www.gravatar.com/avatar/32d8fabde29edf207ac92275275af90a?s=128&d=identicon&r=PG&f=1", "display_name": "rem", "link": "https://stackoverflow.com/users/3694032/rem"}, "edited": false, "score": 0, "creation_date": 1436453686, "post_id": 31302343, "comment_id": 50629186, "body": "Note that just by changing the data structure used for the CAF around slightly, I was able to take the total time from ~ 55 seconds to ~ 35 seconds on my laptop. Structure matters, and you should experiment with it."}], "tags": [], "owner": {"reputation": 21654, "user_id": 107331, "user_type": "registered", "accept_rate": 80, "profile_image": "https://www.gravatar.com/avatar/cf6d0868b2b4c69bac3e6f265a32b6a7?s=128&d=identicon&r=PG", "display_name": "Daniel Martin", "link": "https://stackoverflow.com/users/107331/daniel-martin"}, "is_accepted": true, "score": 3, "last_activity_date": 1436384946, "creation_date": 1436384946, "answer_id": 31302343, "question_id": 31299223, "link": "https://stackoverflow.com/questions/31299223/using-non-deterministic-list-monad-to-find-long-collatz-sequences/31302343#31302343", "title": "Using non-deterministic list monad to find long Collatz sequences", "body": "<p>I think that this approach - while interesting - is fundamentally doomed. Suppose I discover that all the seeds which result in a chain of length 500 are above 2,000,000. How can I know that I won't find that in three more steps there's a seed under 1,000,000 that gets me there? I see no way to know when you're done.</p>\n\n<p>The only viable approach I see to this problem is to compute the collatz length for every number from 1 to 999,999 and then do something like:</p>\n\n<pre><code>main :: IO ()\nmain = do\n  let collatzMax = maximumBy (compare `on` collatzLength) [1..999999]\n  print collatzMax\n</code></pre>\n\n<p>On the other hand, this provides a great opportunity to learn about <a href=\"https://wiki.haskell.org/Constant_applicative_form\" rel=\"nofollow\">CAFs</a> since the function <code>collatzLength</code> could be naively defined as:</p>\n\n<pre><code>collatzLength 1 = 1\ncollatzLength n | n `mod` 2 == 0 = 1 + collatzLength (n `div` 2)\ncollatzLength n = 1 + collatzLength (3 * n + 1)\n</code></pre>\n\n<p>And that kind of recursion screams out for a CAF.</p>\n\n<p>Sure, there are memoization modules that will go and build the CAF for you, but building one yourself is a useful exercise. It's a whole little mini-course in lazy infinitely-recursive data structures.</p>\n\n<p>If that defeats you, you can glance at <a href=\"https://gist.github.com/fizbin/6f498ea97038b29e7abf\" rel=\"nofollow\">this spoiler</a> of how to use a CAF and then rewrite it using a different data structure. (what about a 10-way tree instead of a binary tree? What about traversing the tree in a different order? Can you remove the call to <code>showIntAtBase</code>?)</p>\n"}, {"tags": [], "owner": {"reputation": 60057, "user_id": 1333025, "user_type": "registered", "accept_rate": 65, "profile_image": "https://www.gravatar.com/avatar/79ab43010f900324ac5e2de19a2916cb?s=128&d=identicon&r=PG", "display_name": "Petr", "link": "https://stackoverflow.com/users/1333025/petr"}, "is_accepted": false, "score": 0, "last_activity_date": 1436640495, "creation_date": 1436640495, "answer_id": 31360624, "question_id": 31299223, "link": "https://stackoverflow.com/questions/31299223/using-non-deterministic-list-monad-to-find-long-collatz-sequences/31360624#31360624", "title": "Using non-deterministic list monad to find long Collatz sequences", "body": "<p>Your idea is interesting, although not the most efficient one. It could be worth trying, although it'll be probably memory intensive. Some thoughts:</p>\n\n<ul>\n<li>As some chains can go over 1000000, so you can't just filter out everything less in <code>collatz</code>. You need to keep all the numbers in each pass.</li>\n<li><p>Calling <code>collatz</code> this way is inefficient, as it computes the sets all over again. Making it an infinite list that shares values would be more efficient:</p>\n\n<pre><code>collatz :: [[Integer]]\ncollatz = [1] : map (&gt;&gt;= poss) collatz\n</code></pre></li>\n<li><p>You need to figure out when you're done. For this you'd need to go through the number lists generated by <code>collatz</code> and count how many of them are below 1000000. When you have seen all the numbers below the limit, the last list will contain the numbers with the longest chain.</p></li>\n</ul>\n\n<p>That said, I'm afraid this approach isn't computationally feasible. In particular, you'll generate exponentially many numbers and exponentially large ones. For example, if the longest chain would be 500, the result of <code>collatz</code> in that step would contain numbers up to 2^500. And as mentioned, there is no way to tell which of these huge numbers might be the one leading to the solution, so you can't just discard them.</p>\n"}], "owner": {"reputation": 865, "user_id": 3694032, "user_type": "registered", "accept_rate": 82, "profile_image": "https://www.gravatar.com/avatar/32d8fabde29edf207ac92275275af90a?s=128&d=identicon&r=PG&f=1", "display_name": "rem", "link": "https://stackoverflow.com/users/3694032/rem"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 129, "favorite_count": 1, "accepted_answer_id": 31302343, "answer_count": 2, "score": 1, "last_activity_date": 1437016309, "creation_date": 1436375373, "last_edit_date": 1437016309, "question_id": 31299223, "link": "https://stackoverflow.com/questions/31299223/using-non-deterministic-list-monad-to-find-long-collatz-sequences", "title": "Using non-deterministic list monad to find long Collatz sequences", "body": "<p>I wrote the following code to solve Project Euler's <a href=\"https://projecteuler.net/problem=14\" rel=\"nofollow\">No. 14</a>: </p>\n\n<p>The following iterative (Collatz) sequence is defined for the set of positive integers:</p>\n\n<pre><code>n \u2192 n/2 (n is even)\nn \u2192 3n + 1 (n is odd)\n</code></pre>\n\n<p>Q: Which starting number, under one million, produces the longest chain?</p>\n\n<p>And my code: </p>\n\n<pre><code>collatz :: Integer -&gt; [Integer]\ncollatz 1 = [1] \ncollatz n = \n    filter (&lt; 1000000) prev &gt;&gt;= poss\n    where prev = collatz (n - 1)\n\nposs :: Integer -&gt; [Integer]\nposs prev\n    | even prev &amp;&amp; prev `mod` 3 == 1 &amp;&amp; (prev - 1) `div` 3 &gt; 1 = [2 * prev, (prev - 1) `div` 3]\n    | otherwise = [2 * prev]\n</code></pre>\n\n<p>Where <code>collatz n</code> returns a list of numbers that will generate a Collatz chain of length n. The problem is, I can only either not restrict the result or restrict the whole chain, instead of only the seed number, to be under 1000,000. Is it possible to use this model to solve the problem at all?</p>\n"}, {"tags": ["haskell", "module", "namespaces"], "answers": [{"comments": [{"owner": {"reputation": 84731, "user_id": 510937, "user_type": "registered", "accept_rate": 80, "profile_image": "https://www.gravatar.com/avatar/70b13a9ae1aae1ca1aa6ac8dab4643f2?s=128&d=identicon&r=PG", "display_name": "Bakuriu", "link": "https://stackoverflow.com/users/510937/bakuriu"}, "edited": false, "score": 0, "creation_date": 1436380056, "post_id": 31299505, "comment_id": 50591753, "body": "Something I find a bit annoying of the <code>hiding</code> solution is that it may happen that GHC warns you that the <code>import</code> is useless when it is <b>not</b>. However when you get the warning it means you should simply use the <code>NoImplicitPrelude</code> extension for that file. Still it sounds like buggy behaviour for GHC. It should never state that an import is useless if it has a non-empty <code>hiding</code> clause where at least a name <code>n</code> is defined in the imported module and also in the current module."}, {"owner": {"reputation": 1336, "user_id": 2801316, "user_type": "registered", "accept_rate": 87, "profile_image": "https://i.stack.imgur.com/cqx1a.jpg?s=128&g=1", "display_name": "FtheBuilder", "link": "https://stackoverflow.com/users/2801316/fthebuilder"}, "edited": false, "score": 0, "creation_date": 1436392236, "post_id": 31299505, "comment_id": 50598591, "body": "I&#39;ve read the the <b>Haskell Wiki article</b> you shared and it is really clarifying, so just to complete, to solve the problem and still access <i>Prelude&#39;s elem</i> one solution could be:  <code>import Prelude hiding (elem)</code> <code>import qualified Prelude (elem)</code>. This way I could still access Prelude&#39;s <code>elem</code> but only through <code>Prelude.elem</code>, the other Pelude functions remain the same..."}], "tags": [], "owner": {"reputation": 34864, "user_id": 237428, "user_type": "registered", "accept_rate": 78, "profile_image": "https://i.stack.imgur.com/ThNhZ.jpg?s=128&g=1", "display_name": "Antal Spector-Zabusky", "link": "https://stackoverflow.com/users/237428/antal-spector-zabusky"}, "is_accepted": true, "score": 5, "last_activity_date": 1436376761, "last_edit_date": 1436376761, "creation_date": 1436376226, "answer_id": 31299505, "question_id": 31299146, "link": "https://stackoverflow.com/questions/31299146/name-conflict-in-haskell-while-creating-modules/31299505#31299505", "title": "Name conflict in Haskell while creating modules", "body": "<p>While the <code>Prelude</code> module is in scope by default, this can be overridden.  Any module that does <em>not</em> explicitly import <code>Prelude</code> has an implicit <code>import Prelude</code> at the start; however, if you explicitly import the Prelude, then this isn't added.  Thus, you can import <code>Prelude</code> except for <code>elem</code> by using <code>hiding</code>:</p>\n\n<pre><code>import Prelude hiding (elem)\n</code></pre>\n\n<p>In the context of your code, this is</p>\n\n<pre><code>module Tree(Tree(..), singleton, insert, elem) where\n\nimport Prelude hiding (elem)\n\ndata Tree a = Empty | Node a (Tree a) (Tree a) deriving (Show)\n\n-- ...\n\nelem :: (Ord a) =&gt; a -&gt; Tree a -&gt; Bool\ne `elem` Empty = False\ne `elem` (Node e2 left right)\n  | e == e2 = True\n  | e &gt; e2 = e `elem` right\n  | e &lt; e2 = e `elem` left\n</code></pre>\n\n<p>If you still need to refer to <code>Prelude.elem</code>, you can always add an extra <code>import qualified Prelude</code> line, too.</p>\n\n<p>For more on module imports, see <a href=\"https://wiki.haskell.org/Import\" rel=\"nofollow\">the Haskell Wiki's nice summary of <code>import</code></a>, including the various options for how to import modules and a bit about (suppressing the) implicit <code>Prelude</code> import.</p>\n\n<hr>\n\n<p>(Of course, although you're generally unlikely to need it, the final arbiter for modules is <a href=\"https://www.haskell.org/onlinereport/haskell2010/haskellch5.html/haskellch5.html\" rel=\"nofollow\">the Haskell 2010 report, Ch. 5</a>; <a href=\"https://www.haskell.org/onlinereport/haskell2010/haskellch5.html#x11-1010005.3\" rel=\"nofollow\">\u00a75.3</a> is on import syntax, <a href=\"https://www.haskell.org/onlinereport/haskell2010/haskellch5.html#x11-1070005.5\" rel=\"nofollow\">\u00a75.5</a> is on name conflicts, and <a href=\"https://www.haskell.org/onlinereport/haskell2010/haskellch5.html#x11-1110005.6\" rel=\"nofollow\">\u00a75.6</a> is on the <code>Prelude</code> (including <a href=\"https://www.haskell.org/onlinereport/haskell2010/haskellch5.html#x11-1130005.6.2\" rel=\"nofollow\">\u00a75.6.2</a>, \"Shadowing Prelude Names\").</p>\n"}], "owner": {"reputation": 1336, "user_id": 2801316, "user_type": "registered", "accept_rate": 87, "profile_image": "https://i.stack.imgur.com/cqx1a.jpg?s=128&g=1", "display_name": "FtheBuilder", "link": "https://stackoverflow.com/users/2801316/fthebuilder"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 606, "favorite_count": 0, "accepted_answer_id": 31299505, "answer_count": 1, "score": 2, "last_activity_date": 1436376761, "creation_date": 1436375115, "question_id": 31299146, "link": "https://stackoverflow.com/questions/31299146/name-conflict-in-haskell-while-creating-modules", "title": "Name conflict in Haskell while creating modules", "body": "<p>In the following code I had to use <code>elem'</code> instead of simply <code>elem</code>, because prelude already has a function <code>elem</code>, how could I use <code>elem</code> while declaring Tree module, avoiding conflicts??</p>\n\n<pre><code>module Tree(Tree(..), singleton, insert, elem') where\n\ndata Tree a = Empty | Node a (Tree a) (Tree a) deriving (Show)\n\nsingleton :: a -&gt; Tree a\nsingleton a = Node a Empty Empty\n\ninsert :: (Ord a) =&gt; a -&gt; Tree a -&gt; Tree a\ninsert e Empty = singleton e\ninsert e tree@(Node e2 left right)\n  | e == e2 = tree\n  | e &gt; e2 = Node e2 left (insert e right)\n  | e &lt; e2 = Node e2 (insert e left) right\n\nelem' :: (Ord a) =&gt; a -&gt; Tree a -&gt; Bool\ne `elem'` Empty = False\ne `elem'` (Node e2 left right)\n  | e == e2 = True\n  | e &gt; e2 = e `elem'` right\n  | e &lt; e2 = e `elem'` left\n</code></pre>\n"}, {"tags": ["haskell", "nixos", "nix"], "answers": [{"tags": [], "owner": {"reputation": 43759, "user_id": 1651941, "user_type": "registered", "accept_rate": 97, "profile_image": "https://www.gravatar.com/avatar/a513bc1fa519d2fcf5e4e0d9b5500101?s=128&d=identicon&r=PG", "display_name": "Sibi", "link": "https://stackoverflow.com/users/1651941/sibi"}, "is_accepted": false, "score": 2, "last_activity_date": 1436397218, "creation_date": 1436397218, "answer_id": 31305450, "question_id": 31298942, "link": "https://stackoverflow.com/questions/31298942/if-for-a-package-a-distribution-exists-for-nixos-then-is-it-possible-to-easily/31305450#31305450", "title": "If for a package a distribution exists for NixOS, then is it possible to (easily) install that package to Ubuntu using Nix, if yes how?", "body": "<blockquote>\n  <p>For this package there is a distribution for NixOS. </p>\n</blockquote>\n\n<p>There is no distribution for NixOS. NixOS is the actual Linux distribution built on top of Nix package manager. Your link just shows their Hydra build farm which is used for building various nix packages.</p>\n\n<blockquote>\n  <p>If such a distribution for NixOS exists then is it easy to install the same package to Ubuntu on which the Nix package manager is installed ?</p>\n</blockquote>\n\n<p>Again, no such distribution exists. If you want to use Nix in your Ubuntu distribution then you can install just the Nix package manager and can install any package using the <code>nix-env</code> tool. An example to install the Haskell <code>text</code> package:</p>\n\n<pre><code>nix-env -i -A nixpkgs.haskellPackages.text\n</code></pre>\n"}, {"tags": [], "owner": {"reputation": 1484, "user_id": 2541778, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/930c28082137d9918a90608c665c5af2?s=128&d=identicon&r=PG", "display_name": "Peter Simons", "link": "https://stackoverflow.com/users/2541778/peter-simons"}, "is_accepted": false, "score": 0, "last_activity_date": 1484859815, "creation_date": 1484859815, "answer_id": 41751676, "question_id": 31298942, "link": "https://stackoverflow.com/questions/31298942/if-for-a-package-a-distribution-exists-for-nixos-then-is-it-possible-to-easily/41751676#41751676", "title": "If for a package a distribution exists for NixOS, then is it possible to (easily) install that package to Ubuntu using Nix, if yes how?", "body": "<p>The answer to you question can be found in the <a href=\"http://nixos.org/nixpkgs/manual/#users-guide-to-the-haskell-infrastructure\" rel=\"nofollow noreferrer\">Nixpkgs user manual</a>. I'm citing the relevant bit from \"8.5.1. How to install Haskell packages\":</p>\n\n<blockquote>\n  <p>We [keep] all Haskell-related packages in a separate attribute set called <code>haskellPackages</code>, which the following command will list:</p>\n\n<pre><code>$ nix-env -f \"&lt;nixpkgs&gt;\" -qaP -A haskellPackages\nhaskellPackages.a50         a50-0.5\nhaskellPackages.abacate     haskell-abacate-0.0.0.0\nhaskellPackages.abcBridge   haskell-abcBridge-0.12\nhaskellPackages.afv         afv-0.1.1\nhaskellPackages.alex        alex-3.1.4\nhaskellPackages.Allure      Allure-0.4.101.1\nhaskellPackages.alms        alms-0.6.7\n[... some 8000 entries omitted  ...]\n</code></pre>\n  \n  <p>To install any of those packages into your profile, refer to them by their attribute path (first column):</p>\n\n<pre><code>$ nix-env -f \"&lt;nixpkgs&gt;\" -iA haskellPackages.Allure ...\n</code></pre>\n  \n  <p>The attribute path of any Haskell packages corresponds to the name of that particular package on Hackage: the package cabal-install has the attribute haskellPackages.cabal-install, and so on.</p>\n</blockquote>\n\n<p>In your specific case, this means that running</p>\n\n<pre><code>nix-env -f \"&lt;nixpkgs&gt;\" -iA haskellPackages.SourceGraph\n</code></pre>\n\n<p>or </p>\n\n<pre><code>nix-shell -p haskellPackages.SourceGraph\n</code></pre>\n\n<p>will make that package available for you to run.</p>\n"}], "owner": {"reputation": 18456, "user_id": 1198559, "user_type": "registered", "accept_rate": 70, "profile_image": "https://i.stack.imgur.com/bOjLe.png?s=128&g=1", "display_name": "jhegedus", "link": "https://stackoverflow.com/users/1198559/jhegedus"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 141, "favorite_count": 0, "answer_count": 2, "score": 0, "last_activity_date": 1484859815, "creation_date": 1436374422, "question_id": 31298942, "link": "https://stackoverflow.com/questions/31298942/if-for-a-package-a-distribution-exists-for-nixos-then-is-it-possible-to-easily", "title": "If for a package a distribution exists for NixOS, then is it possible to (easily) install that package to Ubuntu using Nix, if yes how?", "body": "<p>Here is <a href=\"https://hackage.haskell.org/package/SourceGraph\" rel=\"nofollow\">this</a> Haskell package. For this package there is a <a href=\"http://hydra.nixos.org/job/nixpkgs/trunk/haskellPackages.SourceGraph.x86_64-linux\" rel=\"nofollow\">distribution</a> for NixOS. </p>\n\n<p>If such a distribution for NixOS exists then is it easy to install the same package to Ubuntu on which the Nix package manager is installed ?</p>\n\n<p>If yes, how ?</p>\n\n<p>If not, why not ?</p>\n"}, {"tags": ["haskell", "list-comprehension"], "comments": [{"owner": {"reputation": 46235, "user_id": 2541573, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/Z1qtP.png?s=128&g=1", "display_name": "jub0bs", "link": "https://stackoverflow.com/users/2541573/jub0bs"}, "edited": false, "score": 0, "creation_date": 1436373547, "post_id": 31298466, "comment_id": 50587760, "body": "Have you considered using a <code>Map String Int</code> as an intermediate representation of the &quot;list to validate&quot;? Then you could just walk along the template, building a new <code>[(String, Maybe Int)]</code> value by filling in the <code>Int</code> value when one is associated to the <code>String</code> under focus in that map."}, {"owner": {"reputation": 13379, "user_id": 1033027, "user_type": "registered", "accept_rate": 91, "profile_image": "https://www.gravatar.com/avatar/b56ea1c43a4ecb1060ec8bcb8d2bce78?s=128&d=identicon&r=PG", "display_name": "Jules", "link": "https://stackoverflow.com/users/1033027/jules"}, "reply_to_user": {"reputation": 46235, "user_id": 2541573, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/Z1qtP.png?s=128&g=1", "display_name": "jub0bs", "link": "https://stackoverflow.com/users/2541573/jub0bs"}, "edited": false, "score": 0, "creation_date": 1436373770, "post_id": 31298466, "comment_id": 50587901, "body": "Think you could link me to a docpage for that? I&#39;m still starting out with Haskell, and googling just brings up a bunch of pages about the <code>Map</code>, <code>String</code>, and <code>Int</code> types, separately. Other than that, it sounds like a promising lead."}, {"owner": {"reputation": 1521, "user_id": 365807, "user_type": "registered", "accept_rate": 56, "profile_image": "https://www.gravatar.com/avatar/8c9db2824164d60fe55d2b0c1c361f20?s=128&d=identicon&r=PG", "display_name": "Fraser", "link": "https://stackoverflow.com/users/365807/fraser"}, "edited": false, "score": 1, "creation_date": 1436374309, "post_id": 31298466, "comment_id": 50588235, "body": "<a href=\"https://hackage.haskell.org/package/containers-0.5.6.3/docs/Data-Map-Strict.html\" rel=\"nofollow noreferrer\">hackage.haskell.org/package/containers-0.5.6.3/docs/&hellip;</a>"}], "answers": [{"tags": [], "owner": {"reputation": 46235, "user_id": 2541573, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/Z1qtP.png?s=128&g=1", "display_name": "jub0bs", "link": "https://stackoverflow.com/users/2541573/jub0bs"}, "is_accepted": true, "score": 1, "last_activity_date": 1436964544, "last_edit_date": 1436964544, "creation_date": 1436376592, "answer_id": 31299635, "question_id": 31298466, "link": "https://stackoverflow.com/questions/31298466/populating-a-list-of-tuples-in-a-semantic-way/31299635#31299635", "title": "Populating a list of tuples in a semantic way", "body": "<p>You essentially want to <em>map</em> a function to your list of strings (which you call \"template\"), i.e. the function that</p>\n\n<ul>\n<li>takes a string <code>xs</code>,</li>\n<li>returns\n\n<ul>\n<li><code>(xs, Just n)</code> if an integer <code>n</code> is associated to <code>xs</code> in your \"list to validate\",</li>\n<li><code>(xs, Nothing)</code> otherwise.</li>\n</ul></li>\n</ul>\n\n<p>Here is one possible approach:</p>\n\n<pre class=\"lang-hs prettyprint-override\"><code>import Data.List     ( lookup )\nimport Control.Monad ( join )\n\nconsolidate :: [String] -&gt; [(String, Maybe Int)] -&gt; [(String, Maybe Int)]\nconsolidate temp l = map (\\xs -&gt; (xs, join $ lookup xs l)) temp\n</code></pre>\n\n<p>However, you will get faster lookup if you build a <a href=\"http://hackage.haskell.org/package/containers-0.5.6.3/docs/Data-Map.html\" rel=\"nofollow\"><code>Map</code></a> holding the key-value pairs of your association list (the \"list to validate\"):</p>\n\n<pre class=\"lang-hs prettyprint-override\"><code>import qualified Data.Map as M\nimport Data.Maybe (maybe)\n\nconsolidate :: [String] -&gt; [(String, Maybe Int)] -&gt; [(String, Maybe Int)]\nconsolidate temp l = map (\\cs -&gt; (cs, M.lookup cs $ fromList' l)) temp\n\nfromList' :: Ord a =&gt; [(a, Maybe b)] -&gt; M.Map a b\nfromList' xs = foldr insertJust M.empty xs\n\ninsertJust :: Ord a =&gt; (a, Maybe b) -&gt; M.Map a b -&gt; M.Map a b\ninsertJust (xs, maybeVal) mp = maybe mp (\\n -&gt; M.insert xs n mp) maybeVal\n</code></pre>\n\n<p>In GHCi:</p>\n\n<pre><code>\u03bb&gt; let myTemplate = [\"hello\", \"world\", \"this\", \"is\", \"a\", \"test\"]\n\u03bb&gt; let myList = [(\"hello\", Just 1), (\"world\", Just 2), (\"test\", Just 3)]\n\u03bb&gt; consolidate myTemplate myList \n[(\"hello\",Just 1),(\"world\",Just 2),(\"this\",Nothing),(\"is\",Nothing),(\"a\",Nothing),(\"test\",Just 3)]\n</code></pre>\n"}], "owner": {"reputation": 13379, "user_id": 1033027, "user_type": "registered", "accept_rate": 91, "profile_image": "https://www.gravatar.com/avatar/b56ea1c43a4ecb1060ec8bcb8d2bce78?s=128&d=identicon&r=PG", "display_name": "Jules", "link": "https://stackoverflow.com/users/1033027/jules"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 217, "favorite_count": 0, "accepted_answer_id": 31299635, "answer_count": 1, "score": 1, "last_activity_date": 1436964544, "creation_date": 1436372934, "question_id": 31298466, "link": "https://stackoverflow.com/questions/31298466/populating-a-list-of-tuples-in-a-semantic-way", "title": "Populating a list of tuples in a semantic way", "body": "<p>I'm working on a piece of code where I have to process lists of tuples where both the order and names of the \"keys\" (<code>fst</code>s of the tuples) match a certain template. I'm implementing fault tolerance by validating and (if needed) generating a valid list based on the input.</p>\n\n<p>Here's an example of what I mean:</p>\n\n<p>Given the template of keys, <code>[\"hello\", \"world\", \"this\", \"is\", \"a\", \"test\"]</code>, and a list <code>[(\"hello\", Just 1), (\"world\", Just 2), (\"test\", Just 3)]</code>, passing it to my function <code>validate</code> would cause it to fail validation - as the order and values of the keys do not match up with the template.</p>\n\n<p>Upon failing validation, I want to generate a new list, which would look like <code>[(\"hello\", Just 1), (\"world\", Just 2), (\"this\", Nothing), (\"is\", Nothing), (\"a\", Nothing), (\"test\", Just 3)]</code>.</p>\n\n<p>I tried performing this last step using an (incomplete) list comprehension:</p>\n\n<pre><code>[(x, y) | x &lt;- template, y &lt;- l]\n</code></pre>\n\n<p>(Obviously, this is missing the step where empty entries would be replaced with <code>Nothing</code>s, and works under the assumption that the input is of type <code>[(String, Maybe Int)]</code>).</p>\n\n<p>What would be the easiest semantic way of doing this?</p>\n"}, {"tags": ["haskell", "z3", "sbv"], "comments": [{"owner": {"reputation": 100185, "user_id": 3234959, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/93bb12ca0f93dfddb33880316f7e66c2?s=128&d=identicon&r=PG&f=1", "display_name": "chi", "link": "https://stackoverflow.com/users/3234959/chi"}, "edited": false, "score": 1, "creation_date": 1436373194, "post_id": 31296186, "comment_id": 50587510, "body": "Your <code>prove</code> line is equivalent to <code>prove (forall &quot;x&quot; .== forall &quot;x&quot;)</code>. I never used SBV, but this looks wrong to me."}, {"owner": {"reputation": 10726, "user_id": 889902, "user_type": "registered", "accept_rate": 70, "profile_image": "https://i.stack.imgur.com/ops76.png?s=128&g=1", "display_name": "Wojciech Danilo", "link": "https://stackoverflow.com/users/889902/wojciech-danilo"}, "reply_to_user": {"reputation": 100185, "user_id": 3234959, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/93bb12ca0f93dfddb33880316f7e66c2?s=128&d=identicon&r=PG&f=1", "display_name": "chi", "link": "https://stackoverflow.com/users/3234959/chi"}, "edited": false, "score": 0, "creation_date": 1436374932, "post_id": 31296186, "comment_id": 50588592, "body": "You are right. Anyway I was even unable to compile it because we cannot use <code>.==</code> on symbolic (without formal &quot;x&quot; should be also a symbolic value)"}], "answers": [{"comments": [{"owner": {"reputation": 10726, "user_id": 889902, "user_type": "registered", "accept_rate": 70, "profile_image": "https://i.stack.imgur.com/ops76.png?s=128&g=1", "display_name": "Wojciech Danilo", "link": "https://stackoverflow.com/users/889902/wojciech-danilo"}, "edited": false, "score": 0, "creation_date": 1436395545, "post_id": 31299545, "comment_id": 50599890, "body": "Thank you very much for the reply. Unfortunately I cannot use this interface, because I do not want to run the proves on integers. I want to run them on my own &quot;types&quot; and my own functions (like +, which for the type A will be defined associative, but without 0 element, etc). In fact that is what I&#39;m trying to code right now. If you&#39;ve got any hints regarding this, I would be very thankful if you share it with me! :)"}, {"owner": {"reputation": 18055, "user_id": 936310, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/302ec54987694b9746abf8e2e0ad8caf?s=128&d=identicon&r=PG&f=1", "display_name": "alias", "link": "https://stackoverflow.com/users/936310/alias"}, "reply_to_user": {"reputation": 10726, "user_id": 889902, "user_type": "registered", "accept_rate": 70, "profile_image": "https://i.stack.imgur.com/ops76.png?s=128&g=1", "display_name": "Wojciech Danilo", "link": "https://stackoverflow.com/users/889902/wojciech-danilo"}, "edited": false, "score": 0, "creation_date": 1546999802, "post_id": 31299545, "comment_id": 95037545, "body": "Best way to do that would be to use uninterpreted functions. Sorry for the late reply here; please contact me if you still have issues."}], "tags": [], "owner": {"reputation": 18055, "user_id": 936310, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/302ec54987694b9746abf8e2e0ad8caf?s=128&d=identicon&r=PG&f=1", "display_name": "alias", "link": "https://stackoverflow.com/users/936310/alias"}, "is_accepted": false, "score": 4, "last_activity_date": 1436376337, "creation_date": 1436376337, "answer_id": 31299545, "question_id": 31296186, "link": "https://stackoverflow.com/questions/31296186/symbolic-theory-proving-using-sbv-and-haskell/31299545#31299545", "title": "Symbolic theory proving using SBV and Haskell", "body": "<p>Your use of the API isn't quite right. The simplest way to prove mathematical equalities would be to use simple functions. For instance, associativity over unbounded Integers can be expressed this way:</p>\n\n<pre><code>prove $ \\x y z -&gt; x + (y + z) .== (x + y) + (z :: SInteger)\n</code></pre>\n\n<p>If you need a more programmatic interface (and sometimes you will), then you can use the <code>Symbolic</code> monad, thusly:</p>\n\n<pre><code>plusAssoc = prove $ do x &lt;- sInteger \"x\"\n                       y &lt;- sInteger \"y\"\n                       z &lt;- sInteger \"z\"\n                       return $ x + (y + z) .== (x + y) + z\n</code></pre>\n\n<p>I'd recommend browsing through many of the examples provided in the hackage site to get familiar with the API: <a href=\"https://hackage.haskell.org/package/sbv\" rel=\"nofollow\">https://hackage.haskell.org/package/sbv</a></p>\n"}, {"comments": [{"owner": {"reputation": 10726, "user_id": 889902, "user_type": "registered", "accept_rate": 70, "profile_image": "https://i.stack.imgur.com/ops76.png?s=128&g=1", "display_name": "Wojciech Danilo", "link": "https://stackoverflow.com/users/889902/wojciech-danilo"}, "edited": false, "score": 0, "creation_date": 1436399411, "post_id": 31305711, "comment_id": 50601095, "body": "That is a really great answer. If I could I would uproot it man times, thanks! :) You&#39;ve mentioned that SMT-solvers are not good at resolving this kind of problems. IS there any &quot;other&quot; type of solvers that is specialised in this domain?"}, {"owner": {"reputation": 18055, "user_id": 936310, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/302ec54987694b9746abf8e2e0ad8caf?s=128&d=identicon&r=PG&f=1", "display_name": "alias", "link": "https://stackoverflow.com/users/936310/alias"}, "reply_to_user": {"reputation": 10726, "user_id": 889902, "user_type": "registered", "accept_rate": 70, "profile_image": "https://i.stack.imgur.com/ops76.png?s=128&g=1", "display_name": "Wojciech Danilo", "link": "https://stackoverflow.com/users/889902/wojciech-danilo"}, "edited": false, "score": 2, "creation_date": 1436399723, "post_id": 31305711, "comment_id": 50601205, "body": "If you have heavy use of quantifiers and &quot;deep&quot; mathematical theorems, you pretty much have to resort to using traditional theorem provers, such as Isabelle, HOL, or Coq. While these are &quot;manual,&quot; (i.e., you have to develop the proof yourself), they have made tremendous progress in the last decade or so that they will be able to discharge many proof goals with little effort. But they are not push-button tools like SMT-solvers are; so some manual work will be needed. This answer seems appropriate for further reading: <a href=\"http://mathoverflow.net/questions/8260/proof-assistants-for-mathematics\" title=\"proof assistants for mathematics\">mathoverflow.net/questions/8260/&hellip;</a>"}, {"owner": {"reputation": 10726, "user_id": 889902, "user_type": "registered", "accept_rate": 70, "profile_image": "https://i.stack.imgur.com/ops76.png?s=128&g=1", "display_name": "Wojciech Danilo", "link": "https://stackoverflow.com/users/889902/wojciech-danilo"}, "edited": false, "score": 0, "creation_date": 1436873531, "post_id": 31305711, "comment_id": 50784377, "body": "I&#39;ve got yet another small question regarding this topic. I wanted to use this solver in my own type-checker. I do not think using HOL or Coq in a type checker of other language is a good decision (It feels awkward at last). I have heavy use of quantifiers (lets say the language is similar to Haskell in some way). I was planning to use Z3, but after your answer I&#39;m not sure if that is a good solution. Would you have any further suggestions to me regarding this topic? I would be very thankful for any hint than would help me choose the best solution here :)"}], "tags": [], "owner": {"reputation": 18055, "user_id": 936310, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/302ec54987694b9746abf8e2e0ad8caf?s=128&d=identicon&r=PG&f=1", "display_name": "alias", "link": "https://stackoverflow.com/users/936310/alias"}, "is_accepted": true, "score": 12, "last_activity_date": 1436399289, "last_edit_date": 1436399289, "creation_date": 1436398848, "answer_id": 31305711, "question_id": 31296186, "link": "https://stackoverflow.com/questions/31296186/symbolic-theory-proving-using-sbv-and-haskell/31305711#31305711", "title": "Symbolic theory proving using SBV and Haskell", "body": "<p>That sort of reasoning is indeed possible, through the use of uninterpreted sorts and functions. Be warned, however, that reasoning about such structures typically requires quantified axioms, and SMT-solvers are usually not terribly good at reasoning with quantifiers.</p>\n\n<p>Having said that, here's how I would go about it, using SBV.</p>\n\n<p>First, some boiler-plate code to get an uninterpreted type <code>T</code>:</p>\n\n<pre><code>{-# LANGUAGE DeriveDataTypeable #-}\n\nimport Data.Generics\nimport Data.SBV\n\n-- Uninterpreted type T\ndata T = TBase () deriving (Eq, Ord, Data, Typeable, Read, Show)\ninstance SymWord T\ninstance HasKind T\ntype ST = SBV T\n</code></pre>\n\n<p>Once you do this, you'll have access to an uninterpreted type <code>T</code> and its symbolic counterpart <code>ST</code>. Let's declare <code>plus</code> and <code>zero</code>, again just uninterpreted constants with the right types:</p>\n\n<pre><code>-- Uninterpreted addition\nplus :: ST -&gt; ST -&gt; ST\nplus = uninterpret \"plus\"\n\n-- Uninterpreted zero\nzero :: ST\nzero = uninterpret \"zero\"\n</code></pre>\n\n<p>So far, all we told SBV is that there exists a type <code>T</code>, and a function <code>plus</code>, and a constant <code>zero</code>; expressly being uninterpreted. That is, the SMT solver makes no assumptions other than the fact that they have the given types.</p>\n\n<p>Let's first try to prove that <code>0+x = x</code>:</p>\n\n<pre><code>bad = prove $ \\x -&gt; zero `plus` x .== x\n</code></pre>\n\n<p>If you try this, you'll get the following response:</p>\n\n<pre><code>*Main&gt; bad\nFalsifiable. Counter-example:\n  s0 = T!val!0 :: T\n</code></pre>\n\n<p>What the SMT solver is telling you is that the property does not hold, and here's a value where it doesn't hold. The value <code>T!val!0</code> is a <code>Z3</code> specific response; other solvers can return other things. It's essentially an internal identifier for a habitant of the type <code>T</code>; and other than that we know nothing about it. This isn't terribly useful of course, as you don't really know what associations it made for <code>plus</code> and <code>zero</code>, but it is to be expected.</p>\n\n<p>To prove the property, let's tell the SMT solver two more things. First, that <code>plus</code> is commutative. And second, that <code>zero</code> added on the right doesn't do anything. These are done via <code>addAxiom</code> calls. Unfortunately, you have to write your axioms in the SMTLib syntax, as SBV doesn't (at least yet) support axioms written using Haskell. Note also we switch to using the <code>Symbolic</code> monad here:</p>\n\n<pre><code>good = prove $ do\n         addAxiom \"plus-zero-axioms\"\n                  [ \"(assert (forall ((x T) (y T)) (= (plus x y) (plus y x))))\"\n                  , \"(assert (forall ((x T)) (= (plus x zero) x)))\"\n                  ]\n         x &lt;- free \"x\"\n         return $ zero `plus` x .== x\n</code></pre>\n\n<p>Note how we told the solver <code>x+y = y+x</code> and <code>x+0 = x</code>, and asked it to prove <code>0+x = x</code>. Writing axioms this way looks really ugly since you have to use the SMTLib syntax, but that's the current state of affairs. Now we have:</p>\n\n<pre><code>*Main&gt; good\nQ.E.D.\n</code></pre>\n\n<p>Quantified axioms and uninterpreted-types/functions are not the easiest things to use via the SBV interface, but you can get some mileage out of it this way. If you have heavy use of quantifiers in your axioms, it's unlikely that the solver will be able to answer your queries; and will likely respond <code>unknown</code>. It all depends on the solver you use, and how hard the properties to prove are.</p>\n"}], "owner": {"reputation": 10726, "user_id": 889902, "user_type": "registered", "accept_rate": 70, "profile_image": "https://i.stack.imgur.com/ops76.png?s=128&g=1", "display_name": "Wojciech Danilo", "link": "https://stackoverflow.com/users/889902/wojciech-danilo"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 557, "favorite_count": 3, "accepted_answer_id": 31305711, "answer_count": 2, "score": 12, "last_activity_date": 1436399289, "creation_date": 1436366967, "last_edit_date": 1436373231, "question_id": 31296186, "link": "https://stackoverflow.com/questions/31296186/symbolic-theory-proving-using-sbv-and-haskell", "title": "Symbolic theory proving using SBV and Haskell", "body": "<p>I'm using <a href=\"http://leventerkok.github.io/sbv/\">SBV</a> (with Z3 backend) in Haskell to create some theory provers. I want to check if forall <code>x</code> and <code>y</code> with given constrains (like <code>x + y = y + x</code>, where <code>+</code> is a \"plus operator\", not addition) some other terms are valid. I want to define axioms about the <code>+</code> expression (like associativity, identity etc.) and then check for further equalities, like check if <code>a + (b + c) == (a + c) + b</code> is valid formal <code>a</code>, <code>b</code> and <code>c</code>.</p>\n\n<p>I was trying to accomplish it using something like:</p>\n\n<pre><code>main = do\n    let x = forall \"x\"\n    let y = forall \"y\"\n    out &lt;- prove $ (x .== x)\n    print \"end\"\n</code></pre>\n\n<p>But it seems we cannot use the <code>.==</code> operator on symbolic values. Is this a missing feature or wrong usage? Are we able to do it somehow using SBV?</p>\n"}, {"tags": ["haskell"], "comments": [{"owner": {"reputation": 865, "user_id": 3694032, "user_type": "registered", "accept_rate": 82, "profile_image": "https://www.gravatar.com/avatar/32d8fabde29edf207ac92275275af90a?s=128&d=identicon&r=PG&f=1", "display_name": "rem", "link": "https://stackoverflow.com/users/3694032/rem"}, "edited": false, "score": 0, "creation_date": 1436365465, "post_id": 31295515, "comment_id": 50581745, "body": "How is this down-voted the second after I posted it ?!!!"}, {"owner": {"reputation": 16233, "user_id": 4253229, "user_type": "registered", "accept_rate": 83, "profile_image": "https://lh4.googleusercontent.com/-e2FAQvlj5CQ/AAAAAAAAAAI/AAAAAAAAAqM/TlSnekirgNE/photo.jpg?sz=128", "display_name": "Eugene Sh.", "link": "https://stackoverflow.com/users/4253229/eugene-sh"}, "edited": false, "score": 0, "creation_date": 1436365512, "post_id": 31295515, "comment_id": 50581790, "body": "I also wonder why it was downvoted.."}, {"owner": {"reputation": 865, "user_id": 3694032, "user_type": "registered", "accept_rate": 82, "profile_image": "https://www.gravatar.com/avatar/32d8fabde29edf207ac92275275af90a?s=128&d=identicon&r=PG&f=1", "display_name": "rem", "link": "https://stackoverflow.com/users/3694032/rem"}, "reply_to_user": {"reputation": 16233, "user_id": 4253229, "user_type": "registered", "accept_rate": 83, "profile_image": "https://lh4.googleusercontent.com/-e2FAQvlj5CQ/AAAAAAAAAAI/AAAAAAAAAqM/TlSnekirgNE/photo.jpg?sz=128", "display_name": "Eugene Sh.", "link": "https://stackoverflow.com/users/4253229/eugene-sh"}, "edited": false, "score": 0, "creation_date": 1436365609, "post_id": 31295515, "comment_id": 50581869, "body": "I did get a warning to modify my title before I could submit, but it would suck if that automatically downvotes"}, {"owner": {"reputation": 16233, "user_id": 4253229, "user_type": "registered", "accept_rate": 83, "profile_image": "https://lh4.googleusercontent.com/-e2FAQvlj5CQ/AAAAAAAAAAI/AAAAAAAAAqM/TlSnekirgNE/photo.jpg?sz=128", "display_name": "Eugene Sh.", "link": "https://stackoverflow.com/users/4253229/eugene-sh"}, "edited": false, "score": 0, "creation_date": 1436365752, "post_id": 31295515, "comment_id": 50582001, "body": "I don&#39;t think there is such a functionality on SO.. Anyway, to your question. Are you sure any of the numbers generated by <code>[n * (n + 1) </code>div` 2 | n &lt;- [1..]]` will satisfy <code>factors n == 0</code> ? Update: Ok, you have got an answer.."}, {"owner": {"reputation": 51584, "user_id": 839246, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/9b0573c2b936b12828dd1e4cc04206dc?s=128&d=identicon&r=PG&f=1", "display_name": "bheklilr", "link": "https://stackoverflow.com/users/839246/bheklilr"}, "edited": false, "score": 0, "creation_date": 1436368935, "post_id": 31295515, "comment_id": 50584638, "body": "@rem Not the downvoter, but I&#39;d say the reason might have been because you don&#39;t actually have a question in this post.  Your title is also pretty poorly worded.  Users of So really prefer good grammar and well worded posts.  For one thing, putting &quot;haskell&quot; in the title doesn&#39;t help much when you&#39;ve tagged the post with &quot;haskell&quot;.  Again, I&#39;m not the one who gave you a downvote, just trying to give a critique of what others may find wrong with your post so that in the future you can try to avoid those mistakes.  Better questions, even ones with simple solutions, make SO better for everyone =)"}, {"owner": {"reputation": 865, "user_id": 3694032, "user_type": "registered", "accept_rate": 82, "profile_image": "https://www.gravatar.com/avatar/32d8fabde29edf207ac92275275af90a?s=128&d=identicon&r=PG&f=1", "display_name": "rem", "link": "https://stackoverflow.com/users/3694032/rem"}, "reply_to_user": {"reputation": 51584, "user_id": 839246, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/9b0573c2b936b12828dd1e4cc04206dc?s=128&d=identicon&r=PG&f=1", "display_name": "bheklilr", "link": "https://stackoverflow.com/users/839246/bheklilr"}, "edited": false, "score": 0, "creation_date": 1436370546, "post_id": 31295515, "comment_id": 50585815, "body": "thanks @bheklilr, I&#39;ll watch out in the future!"}], "answers": [{"tags": [], "owner": {"reputation": 199084, "user_id": 56338, "user_type": "registered", "accept_rate": 44, "profile_image": "https://www.gravatar.com/avatar/92fb4563ddc5ceeaa8b19b60a7a172f4?s=128&d=identicon&r=PG", "display_name": "sth", "link": "https://stackoverflow.com/users/56338/sth"}, "is_accepted": true, "score": 0, "last_activity_date": 1436365902, "last_edit_date": 1436365902, "creation_date": 1436365732, "answer_id": 31295690, "question_id": 31295515, "link": "https://stackoverflow.com/questions/31295515/haskell-list-comprehension-non-termination/31295690#31295690", "title": "haskell list comprehension non termination", "body": "<p>The problem is that <code>factors 1</code> doesn't terminate. The <code>takeWhile</code> looks at the input until it finds a factor greater than <code>intSqrt 1</code>, but there are no such factors.</p>\n\n<p>You could simplify the list comprehension to avoid the <code>takeWhile</code> altogether:</p>\n\n<pre><code>facs = [x | x &lt;- [1..intSqrt n], n `mod` x == 0]\n</code></pre>\n"}], "owner": {"reputation": 865, "user_id": 3694032, "user_type": "registered", "accept_rate": 82, "profile_image": "https://www.gravatar.com/avatar/32d8fabde29edf207ac92275275af90a?s=128&d=identicon&r=PG&f=1", "display_name": "rem", "link": "https://stackoverflow.com/users/3694032/rem"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 66, "favorite_count": 0, "accepted_answer_id": 31295690, "answer_count": 1, "score": 1, "last_activity_date": 1436365902, "creation_date": 1436365328, "question_id": 31295515, "link": "https://stackoverflow.com/questions/31295515/haskell-list-comprehension-non-termination", "title": "haskell list comprehension non termination", "body": "<p>I have code: </p>\n\n<pre><code>import Data.List\n\ntriangles :: [Int]\ntriangles = takeWhile (\\n -&gt; factors n /= 0) [n * (n + 1) `div` 2 | n &lt;- [1..]]\ntriangles' = takeWhile (/= 0) [n * (n + 1) `div` 2 | n &lt;- [1..]]\n\nintSqrt :: Int -&gt; Int \nintSqrt = floor . sqrt . fromIntegral\n\nfactors :: Int -&gt; Int \nfactors n = 2 * length facs\n    where facs = takeWhile (&lt;= intSqrt n) [x | x &lt;- [1..], n `mod` x == 0]\n</code></pre>\n\n<p><code>triangles'</code> prints a ton of numbers instantly, whereas <code>triangles</code> gets stuck before printing anything at all. I saw a similar problem which was caused by infinite mutual recursion, but I don't think I've introduced any recursion here. </p>\n"}, {"tags": ["haskell", "compiler-errors", "typeclass"], "answers": [{"comments": [{"owner": {"user_type": "does_not_exist", "display_name": "user266003"}, "edited": false, "score": 0, "creation_date": 1436368643, "post_id": 31296697, "comment_id": 50584374, "body": "Ok. So alias get the same instances implemented as their original types, right?"}, {"owner": {"reputation": 49959, "user_id": 866915, "user_type": "registered", "accept_rate": 70, "profile_image": "https://www.gravatar.com/avatar/09242131d6e17cbbe31e8547514da6e5?s=128&d=identicon&r=PG", "display_name": "ErikR", "link": "https://stackoverflow.com/users/866915/erikr"}, "edited": false, "score": 1, "creation_date": 1436426169, "post_id": 31296697, "comment_id": 50609604, "body": "Yup - when you say <code>type A = B</code>, then A is just another name for B, and typicalness are defined on types not on their names."}], "tags": [], "owner": {"reputation": 49959, "user_id": 866915, "user_type": "registered", "accept_rate": 70, "profile_image": "https://www.gravatar.com/avatar/09242131d6e17cbbe31e8547514da6e5?s=128&d=identicon&r=PG", "display_name": "ErikR", "link": "https://stackoverflow.com/users/866915/erikr"}, "is_accepted": true, "score": 4, "last_activity_date": 1436368191, "creation_date": 1436368191, "answer_id": 31296697, "question_id": 31295473, "link": "https://stackoverflow.com/questions/31295473/type-alias-and-instance-where/31296697#31296697", "title": "Type alias and &quot;instance ... where&quot;", "body": "<p>Are you importing <code>Data.UUID.Aeson</code> (from the uuid-aeson package)?</p>\n\n<p>This works for me:</p>\n\n<pre><code>import Data.UUID\nimport Data.UUID.Aeson\nimport Data.Aeson\n\ntype MyUUID = UUID\n\ndata U2 = U2 MyUUID Int\n\ninstance ToJSON U2 where\n  toJSON(U2 a b) = toJSON a\n</code></pre>\n"}], "owner": {"user_type": "does_not_exist", "display_name": "user266003"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 77, "favorite_count": 0, "accepted_answer_id": 31296697, "answer_count": 1, "score": 1, "last_activity_date": 1436373919, "creation_date": 1436365199, "last_edit_date": 1436373919, "question_id": 31295473, "link": "https://stackoverflow.com/questions/31295473/type-alias-and-instance-where", "title": "Type alias and &quot;instance ... where&quot;", "body": "<p>I have a type alias:</p>\n\n<pre><code>type MyId = UUID\n</code></pre>\n\n<p>And a data type:</p>\n\n<pre><code>data MyData = MyData { myId :: MyId, .... }\n</code></pre>\n\n<p>And then I create instances for <code>FromJSON</code> and <code>ToJSON</code> for <code>MyData</code></p>\n\n<pre><code>instance FromJSON MyData where\n  parseJSON (Object v) = ....\n\ninstance ToJSON MyData where\n  toJSON (Object v) = ....\n</code></pre>\n\n<p>I wonder, why do I have the errors: </p>\n\n<pre><code>1) No instance for (`FromJSON MyId`) arising from a use of \u2018.:\u2019\n2) No instance for (ToJSON MyId) arising from a use of \u2018.=\u2019\n</code></pre>\n\n<p><code>instance FromJSON</code> and <code>ToJSON</code> for <code>UUID</code> are already implemented, doesn't <code>MyId</code> have them automatically? If not, how would I implement them?</p>\n\n<pre><code>instance FromJSON MyId where\n  parseJSON (Object v) = --- ? It's already UUID for which FromJSON is implemented\n\ninstance ToJSON MyId where\n  toJSON (Object v) = --- ? It's already UUID for which FromJSON is implemented\n</code></pre>\n"}, {"tags": ["haskell", "monads"], "answers": [{"tags": [], "owner": {"reputation": 1359, "user_id": 3346496, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/2b1230f0444613f0e8d74e5a71439d1e?s=128&d=identicon&r=PG&f=1", "display_name": "monocell", "link": "https://stackoverflow.com/users/3346496/monocell"}, "is_accepted": false, "score": 0, "last_activity_date": 1436368770, "creation_date": 1436368770, "answer_id": 31296915, "question_id": 31295316, "link": "https://stackoverflow.com/questions/31295316/a-generic-monadic/31296915#31296915", "title": "a generic monadic `(&lt;|&gt;)`?", "body": "<p>Since (&lt;|>) gets it's powers from applicative isn't this impossible?\nIt feels like the type you are looking for is something like</p>\n\n<pre><code>Monad m =&gt; a -&gt;[m (Maybe a)] -&gt; m a\n</code></pre>\n\n<p>instead? Or maybe</p>\n\n<pre><code>Monad m =&gt; a -&gt; (a -&gt; Bool) -&gt; [m a] -&gt; m a\n</code></pre>\n\n<p>Hoogle doesn't give me anything for either.</p>\n"}, {"comments": [{"owner": {"reputation": 67060, "user_id": 783743, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/835bdcdab3e4bf466f0d59f809c50035?s=128&d=identicon&r=PG", "display_name": "Aadit M Shah", "link": "https://stackoverflow.com/users/783743/aadit-m-shah"}, "edited": false, "score": 1, "creation_date": 1436371332, "post_id": 31297396, "comment_id": 50586330, "body": "It should be <code>getAorB = getA &gt;&gt;= maybe getB (return . Just)</code>."}, {"owner": {"reputation": 507143, "user_id": 1048572, "user_type": "registered", "accept_rate": 77, "profile_image": "https://www.gravatar.com/avatar/7f2c4de95e8f4f8f5a71c3aaf0ed312a?s=128&d=identicon&r=PG", "display_name": "Bergi", "link": "https://stackoverflow.com/users/1048572/bergi"}, "reply_to_user": {"reputation": 67060, "user_id": 783743, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/835bdcdab3e4bf466f0d59f809c50035?s=128&d=identicon&r=PG", "display_name": "Aadit M Shah", "link": "https://stackoverflow.com/users/783743/aadit-m-shah"}, "edited": false, "score": 1, "creation_date": 1436371543, "post_id": 31297396, "comment_id": 50586476, "body": "@AaditMShah: No, <code>getB</code> doesn&#39;t return a <code>Maybe</code>"}, {"owner": {"reputation": 49959, "user_id": 866915, "user_type": "registered", "accept_rate": 70, "profile_image": "https://www.gravatar.com/avatar/09242131d6e17cbbe31e8547514da6e5?s=128&d=identicon&r=PG", "display_name": "ErikR", "link": "https://stackoverflow.com/users/866915/erikr"}, "edited": false, "score": 0, "creation_date": 1436374177, "post_id": 31297396, "comment_id": 50588141, "body": "Anther possibility:  <code>join $ fmap (maybe getB (return . Just)) getA</code>"}, {"owner": {"reputation": 507143, "user_id": 1048572, "user_type": "registered", "accept_rate": 77, "profile_image": "https://www.gravatar.com/avatar/7f2c4de95e8f4f8f5a71c3aaf0ed312a?s=128&d=identicon&r=PG", "display_name": "Bergi", "link": "https://stackoverflow.com/users/1048572/bergi"}, "reply_to_user": {"reputation": 49959, "user_id": 866915, "user_type": "registered", "accept_rate": 70, "profile_image": "https://www.gravatar.com/avatar/09242131d6e17cbbe31e8547514da6e5?s=128&d=identicon&r=PG", "display_name": "ErikR", "link": "https://stackoverflow.com/users/866915/erikr"}, "edited": false, "score": 0, "creation_date": 1436374241, "post_id": 31297396, "comment_id": 50588184, "body": "@user5402: Uh, <code>join . fmap</code> == <code>&gt;&gt;=</code>?"}, {"owner": {"reputation": 1679, "user_id": 1722752, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/ef35ad86b627ba3176b6aea8a184f51c?s=128&d=identicon&r=PG", "display_name": "MigMit", "link": "https://stackoverflow.com/users/1722752/migmit"}, "edited": false, "score": 0, "creation_date": 1436431796, "post_id": 31297396, "comment_id": 50613094, "body": "@Bergi: <code>:t \\getA getB -&gt; do {a &lt;- getA; case a of {Just _ -&gt; return a; Nothing -&gt; getB}}</code> returns <code>m (Maybe t) -&gt; m (Maybe t) -&gt; m (Maybe t)</code>. So, yes, <code>getB</code> does return a <code>Maybe</code>."}, {"owner": {"reputation": 507143, "user_id": 1048572, "user_type": "registered", "accept_rate": 77, "profile_image": "https://www.gravatar.com/avatar/7f2c4de95e8f4f8f5a71c3aaf0ed312a?s=128&d=identicon&r=PG", "display_name": "Bergi", "link": "https://stackoverflow.com/users/1048572/bergi"}, "reply_to_user": {"reputation": 1679, "user_id": 1722752, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/ef35ad86b627ba3176b6aea8a184f51c?s=128&d=identicon&r=PG", "display_name": "MigMit", "link": "https://stackoverflow.com/users/1722752/migmit"}, "edited": false, "score": 0, "creation_date": 1436462107, "post_id": 31297396, "comment_id": 50634697, "body": "@MigMit: Oops, you&#39;re right. I somehow read that as <code>Just a  -&gt; return a</code>."}], "tags": [], "owner": {"reputation": 507143, "user_id": 1048572, "user_type": "registered", "accept_rate": 77, "profile_image": "https://www.gravatar.com/avatar/7f2c4de95e8f4f8f5a71c3aaf0ed312a?s=128&d=identicon&r=PG", "display_name": "Bergi", "link": "https://stackoverflow.com/users/1048572/bergi"}, "is_accepted": false, "score": 2, "last_activity_date": 1436374367, "last_edit_date": 1436374367, "creation_date": 1436369949, "answer_id": 31297396, "question_id": 31295316, "link": "https://stackoverflow.com/questions/31295316/a-generic-monadic/31297396#31297396", "title": "a generic monadic `(&lt;|&gt;)`?", "body": "<p>You can use the <a href=\"http://hackage.haskell.org/package/base-4.8.0.0/docs/Prelude.html#v:maybe\" rel=\"nofollow\"><code>maybe</code> function</a> (<code>b -&gt; (a -&gt; b) -&gt; Maybe a -&gt; b</code>) with its default value:</p>\n\n<pre><code>getAorB :: Monad m =&gt; m a\ngetAorB = getA &gt;&gt;= maybe getB return\n</code></pre>\n\n<p>I don't think there's a single function that does this anywhere.</p>\n\n<p>Trying to use an <a href=\"http://hackage.haskell.org/package/base-4.8.0.0/docs/Control-Applicative.html#t:Alternative\" rel=\"nofollow\">Alternative</a> (such as <a href=\"http://hackage.haskell.org/package/transformers-0.4.3.0/docs/Control-Monad-Trans-Maybe.html\" rel=\"nofollow\">MaybeT</a>) doesn't work well here imo as it considers the second action to be fallible as well, which your <code>getB</code> isn't. If it if was, you should consider using <code>MaybeT</code> though:</p>\n\n<pre><code>getAorB :: Monad m =&gt; m (Maybe a)\ngetAorB = runMaybeT $ MaybeT getA &lt;|&gt; MaybeT getB\n</code></pre>\n"}, {"tags": [], "owner": {"reputation": 1679, "user_id": 1722752, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/ef35ad86b627ba3176b6aea8a184f51c?s=128&d=identicon&r=PG", "display_name": "MigMit", "link": "https://stackoverflow.com/users/1722752/migmit"}, "is_accepted": false, "score": 1, "last_activity_date": 1436371176, "creation_date": 1436371176, "answer_id": 31297853, "question_id": 31295316, "link": "https://stackoverflow.com/questions/31295316/a-generic-monadic/31297853#31297853", "title": "a generic monadic `(&lt;|&gt;)`?", "body": "<p>Sounds like an <code>mplus</code> for <code>MaybeT</code>.</p>\n"}, {"tags": [], "owner": {"reputation": 126897, "user_id": 791604, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/ce991df7a056248d5e4f6fc3659ba733?s=128&d=identicon&r=PG", "display_name": "Daniel Wagner", "link": "https://stackoverflow.com/users/791604/daniel-wagner"}, "is_accepted": false, "score": 0, "last_activity_date": 1436372041, "creation_date": 1436372041, "answer_id": 31298148, "question_id": 31295316, "link": "https://stackoverflow.com/questions/31295316/a-generic-monadic/31298148#31298148", "title": "a generic monadic `(&lt;|&gt;)`?", "body": "<p>To hide all the transformers:</p>\n\n<pre><code>import Control.Monad.Trans.Maybe\n\ngetAOrB :: m (Maybe a) -&gt; m (Maybe a) -&gt; m (Maybe a)\ngetAOrB getA getB = runMaybeT (MaybeT getA &lt;|&gt; MaybeT getB)\n</code></pre>\n\n<p>But I would probably just use <code>MaybeT</code> everywhere instead:</p>\n\n<pre><code>getAOrB' :: MaybeT m a -&gt; MaybeT m a -&gt; MaybeT m a\ngetAOrB' = (&lt;|&gt;)\n</code></pre>\n\n<p>Note that this type is slightly different than the type of your first implementation; it has the same type as your second implementation but better behavior.</p>\n"}], "owner": {"reputation": 49959, "user_id": 866915, "user_type": "registered", "accept_rate": 70, "profile_image": "https://www.gravatar.com/avatar/09242131d6e17cbbe31e8547514da6e5?s=128&d=identicon&r=PG", "display_name": "ErikR", "link": "https://stackoverflow.com/users/866915/erikr"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 110, "favorite_count": 0, "answer_count": 4, "score": 2, "last_activity_date": 1436374367, "creation_date": 1436364809, "last_edit_date": 1436367194, "question_id": 31295316, "link": "https://stackoverflow.com/questions/31295316/a-generic-monadic", "title": "a generic monadic `(&lt;|&gt;)`?", "body": "<p>I'm looking for a more concise / idiomatic way of writing <code>getAorB</code>:</p>\n\n<pre><code>getAorB = do\n  a &lt;- getA\n  case a of\n    Just _  -&gt; return a\n    Nothing -&gt; getB\n</code></pre>\n\n<p>Does this already exist as a library function somewhere?</p>\n\n<p>Note that <code>liftM2 (&lt;|&gt;) getA getB</code> is the same as:</p>\n\n<pre><code>do a &lt;- getA\n   b &lt;- getB\n   return $ a &lt;|&gt; b\n</code></pre>\n\n<p>which is different from <code>getAorB</code> since bind is always called on <code>getB</code> even if <code>getA</code> returns a <code>Just</code>.</p>\n"}, {"tags": ["c", "haskell", "segmentation-fault", "z3"], "comments": [{"owner": {"reputation": 16233, "user_id": 4253229, "user_type": "registered", "accept_rate": 83, "profile_image": "https://lh4.googleusercontent.com/-e2FAQvlj5CQ/AAAAAAAAAAI/AAAAAAAAAqM/TlSnekirgNE/photo.jpg?sz=128", "display_name": "Eugene Sh.", "link": "https://stackoverflow.com/users/4253229/eugene-sh"}, "edited": false, "score": 1, "creation_date": 1436364524, "post_id": 31295038, "comment_id": 50580968, "body": "Segmentation fault is clearly caused by a bug. Probably you should report it to the devs."}, {"owner": {"reputation": 10726, "user_id": 889902, "user_type": "registered", "accept_rate": 70, "profile_image": "https://i.stack.imgur.com/ops76.png?s=128&g=1", "display_name": "Wojciech Danilo", "link": "https://stackoverflow.com/users/889902/wojciech-danilo"}, "reply_to_user": {"reputation": 16233, "user_id": 4253229, "user_type": "registered", "accept_rate": 83, "profile_image": "https://lh4.googleusercontent.com/-e2FAQvlj5CQ/AAAAAAAAAAI/AAAAAAAAAqM/TlSnekirgNE/photo.jpg?sz=128", "display_name": "Eugene Sh.", "link": "https://stackoverflow.com/users/4253229/eugene-sh"}, "edited": false, "score": 0, "creation_date": 1436364719, "post_id": 31295038, "comment_id": 50581124, "body": "@EugeneSh. In a standard library yes, but looking at similar problems (<a href=\"http://stackoverflow.com/questions/9059923/z3-segmentation-fault?rq=1\" title=\"z3 segmentation fault\">stackoverflow.com/questions/9059923/z3-segmentation-fault?r&zwnj;&#8203;q=1</a>) it seems that segmentation faults in S3 are used sometimes to denote an obsolete API or wrong usage ... heh ;)"}, {"owner": {"reputation": 10726, "user_id": 889902, "user_type": "registered", "accept_rate": 70, "profile_image": "https://i.stack.imgur.com/ops76.png?s=128&g=1", "display_name": "Wojciech Danilo", "link": "https://stackoverflow.com/users/889902/wojciech-danilo"}, "reply_to_user": {"reputation": 16233, "user_id": 4253229, "user_type": "registered", "accept_rate": 83, "profile_image": "https://lh4.googleusercontent.com/-e2FAQvlj5CQ/AAAAAAAAAAI/AAAAAAAAAqM/TlSnekirgNE/photo.jpg?sz=128", "display_name": "Eugene Sh.", "link": "https://stackoverflow.com/users/4253229/eugene-sh"}, "edited": false, "score": 0, "creation_date": 1436364872, "post_id": 31295038, "comment_id": 50581246, "body": "Anyway I&#39;ve just reported it here: <a href=\"https://github.com/Z3Prover/z3/issues/153\" rel=\"nofollow noreferrer\">github.com/Z3Prover/z3/issues/153</a>"}, {"owner": {"reputation": 16233, "user_id": 4253229, "user_type": "registered", "accept_rate": 83, "profile_image": "https://lh4.googleusercontent.com/-e2FAQvlj5CQ/AAAAAAAAAAI/AAAAAAAAAqM/TlSnekirgNE/photo.jpg?sz=128", "display_name": "Eugene Sh.", "link": "https://stackoverflow.com/users/4253229/eugene-sh"}, "edited": false, "score": 1, "creation_date": 1436364924, "post_id": 31295038, "comment_id": 50581281, "body": "Still, the incorrect usage should yield an error correctly handled, not SEGFAULT. It is a bug anyway.."}, {"owner": {"reputation": 10726, "user_id": 889902, "user_type": "registered", "accept_rate": 70, "profile_image": "https://i.stack.imgur.com/ops76.png?s=128&g=1", "display_name": "Wojciech Danilo", "link": "https://stackoverflow.com/users/889902/wojciech-danilo"}, "reply_to_user": {"reputation": 16233, "user_id": 4253229, "user_type": "registered", "accept_rate": 83, "profile_image": "https://lh4.googleusercontent.com/-e2FAQvlj5CQ/AAAAAAAAAAI/AAAAAAAAAqM/TlSnekirgNE/photo.jpg?sz=128", "display_name": "Eugene Sh.", "link": "https://stackoverflow.com/users/4253229/eugene-sh"}, "edited": false, "score": 0, "creation_date": 1436364975, "post_id": 31295038, "comment_id": 50581317, "body": "I know, I know, I was laughing reading that reply from S3 devs :)"}], "answers": [{"tags": [], "owner": {"reputation": 18055, "user_id": 936310, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/302ec54987694b9746abf8e2e0ad8caf?s=128&d=identicon&r=PG&f=1", "display_name": "alias", "link": "https://stackoverflow.com/users/936310/alias"}, "is_accepted": false, "score": 1, "last_activity_date": 1436425436, "creation_date": 1436425436, "answer_id": 31310323, "question_id": 31295038, "link": "https://stackoverflow.com/questions/31295038/segmentation-fault-in-z3-haskell/31310323#31310323", "title": "Segmentation fault in Z3 (Haskell)", "body": "<p>You should really be reporting this to the Haskell Z3 package maintainers; as they should protect from this sort of usage in the first place. You can find their contact info on: <a href=\"http://hackage.haskell.org/package/z3\" rel=\"nofollow\">http://hackage.haskell.org/package/z3</a></p>\n"}, {"comments": [{"owner": {"reputation": 10726, "user_id": 889902, "user_type": "registered", "accept_rate": 70, "profile_image": "https://i.stack.imgur.com/ops76.png?s=128&g=1", "display_name": "Wojciech Danilo", "link": "https://stackoverflow.com/users/889902/wojciech-danilo"}, "edited": false, "score": 0, "creation_date": 1436795476, "post_id": 31383215, "comment_id": 50747338, "body": "Thank you very much for the help @iago. So does it mean that Z3 is no longer used in Microsoft? Are there any reasons behind it? Does it have any consequences regarding the future of Z3 development?"}, {"owner": {"reputation": 277, "user_id": 1064567, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/1c6d70982e8f87fe26ec767ca1c7ad43?s=128&d=identicon&r=PG", "display_name": "iago", "link": "https://stackoverflow.com/users/1064567/iago"}, "reply_to_user": {"reputation": 10726, "user_id": 889902, "user_type": "registered", "accept_rate": 70, "profile_image": "https://i.stack.imgur.com/ops76.png?s=128&g=1", "display_name": "Wojciech Danilo", "link": "https://stackoverflow.com/users/889902/wojciech-danilo"}, "edited": false, "score": 0, "creation_date": 1436797386, "post_id": 31383215, "comment_id": 50748703, "body": "I think you understood me wrong. David and I (the authors of the Haskell bindings) are not working for Microsoft. We created this project because Microsoft does not provide official bindings for Haskell, our bindings are unofficial. As far as I can tell Z3 is a very active project within Microsoft Research."}, {"owner": {"reputation": 277, "user_id": 1064567, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/1c6d70982e8f87fe26ec767ca1c7ad43?s=128&d=identicon&r=PG", "display_name": "iago", "link": "https://stackoverflow.com/users/1064567/iago"}, "reply_to_user": {"reputation": 10726, "user_id": 889902, "user_type": "registered", "accept_rate": 70, "profile_image": "https://i.stack.imgur.com/ops76.png?s=128&g=1", "display_name": "Wojciech Danilo", "link": "https://stackoverflow.com/users/889902/wojciech-danilo"}, "edited": false, "score": 1, "creation_date": 1436797578, "post_id": 31383215, "comment_id": 50748836, "body": "Having clarified this, the fact that we don&#39;t use Haskell+Z3 at work anymore, means that we don&#39;t actively develop the <i>z3-haskell</i> bindings that much, however, we do actively maintain them. (In fact, I&#39;m discussing the bug right now with David.) At least once a year we release a new version with enhancements and better coverage of the API, but the patches mostly come from users of the library. The people developing <a href=\"http://rise4fun.com/Boogaloo\" rel=\"nofollow noreferrer\">Boogaloo</a> for instance, have made quite a few contributions."}, {"owner": {"reputation": 10726, "user_id": 889902, "user_type": "registered", "accept_rate": 70, "profile_image": "https://i.stack.imgur.com/ops76.png?s=128&g=1", "display_name": "Wojciech Danilo", "link": "https://stackoverflow.com/users/889902/wojciech-danilo"}, "edited": false, "score": 0, "creation_date": 1436804708, "post_id": 31383215, "comment_id": 50753828, "body": "Ahh got it. I&#39;m sorry I was sure you are the developer and maintainer of Z3. Sorry for the confusion!"}], "tags": [], "owner": {"reputation": 277, "user_id": 1064567, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/1c6d70982e8f87fe26ec767ca1c7ad43?s=128&d=identicon&r=PG", "display_name": "iago", "link": "https://stackoverflow.com/users/1064567/iago"}, "is_accepted": true, "score": 3, "last_activity_date": 1436791370, "last_edit_date": 1436791370, "creation_date": 1436789875, "answer_id": 31383215, "question_id": 31295038, "link": "https://stackoverflow.com/questions/31295038/segmentation-fault-in-z3-haskell/31383215#31383215", "title": "Segmentation fault in Z3 (Haskell)", "body": "<p>This is a bug in our library. In 4.0.0 we introduced automatic memory management, but we missed the interaction with error handling. It seems that memory management code executes before error handling code. Thus, when <code>mkBVmul</code> returns, memory management code tries to increment the reference count of the result object, which turns to be <em>null</em>, before the library knows that there was an error.</p>\n\n<p>I have created an issue for this (cf. <a href=\"https://bitbucket.org/iago/z3-haskell/issues/5/segmentation-fault-due-to-type-error\" rel=\"nofollow\">https://bitbucket.org/iago/z3-haskell/issues/5/segmentation-fault-due-to-type-error</a>), and I will look into solving it soon. But we would highly appreciate that you report to us segmentation faults in the future. Today we don't use this library at work so, even though I do maintain it, and I do try to help whoever wants to contribute, I mostly rely on users to report errors and contribute with patches. </p>\n\n<p>That being said, once the bug is fixed, what you will get is a Haskell exception carrying the error code <em>Z3_SORT_ERROR</em>. The fact that <em>z3-haskell</em> bindings provide little type-safety is a design decision. Writing a type-safe Z3 API is non-trivial and requires quite a bit of type hackery and a few GHC extensions. Our target users are tool writers who use Z3 as a backend. Most of them don't want to deal with marshaling and memory management themselves, but still want low-level access to Z3's API. </p>\n\n<p>We don't expect people to write SMT problems directly using our bindings, <em>sbv</em> is more suitable for that. It's certainly possible to create a type-safe wrapper for <em>z3-haskell</em>, as a separate package. I have this in my to-do list, I just didn't find the time for it.</p>\n"}], "owner": {"reputation": 10726, "user_id": 889902, "user_type": "registered", "accept_rate": 70, "profile_image": "https://i.stack.imgur.com/ops76.png?s=128&g=1", "display_name": "Wojciech Danilo", "link": "https://stackoverflow.com/users/889902/wojciech-danilo"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 199, "favorite_count": 0, "accepted_answer_id": 31383215, "answer_count": 2, "score": 2, "last_activity_date": 1436791370, "creation_date": 1436364146, "question_id": 31295038, "link": "https://stackoverflow.com/questions/31295038/segmentation-fault-in-z3-haskell", "title": "Segmentation fault in Z3 (Haskell)", "body": "<p>I'm using Haskell to create some Z3 formulas. When I try to run the following code I get segmentation fault (although other examples made by me work great). Does anybody know if that is a bug in Z3? The API used in Haskell is a mirror of the C API names:</p>\n\n<pre><code>{-# LANGUAGE NoMonomorphismRestriction #-}\n{-# LANGUAGE TupleSections #-}\n\nimport Z3.Monad\nimport Control.Monad.IO.Class\nimport Control.Applicative\nimport Data.Traversable\nimport Prelude hiding (sequence)\n\nmain = do\n    out &lt;- evalZ3 $ do\n        is  &lt;- mkIntSort\n        _3  &lt;- mkInteger 3\n        _5  &lt;- mkInteger 5\n        _10 &lt;- mkInteger 10\n        x   &lt;- mkFreshIntVar \"x\"\n        y   &lt;- mkFreshIntVar \"y\"\n        y2  &lt;- mkBvmul y y\n\n        assert =&lt;&lt; mkAnd =&lt;&lt; sequence\n            [ mkEq x y2\n            ]\n        return ()\n\n    print \"end\"\n</code></pre>\n"}, {"tags": ["json", "haskell"], "comments": [{"owner": {"reputation": 51584, "user_id": 839246, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/9b0573c2b936b12828dd1e4cc04206dc?s=128&d=identicon&r=PG&f=1", "display_name": "bheklilr", "link": "https://stackoverflow.com/users/839246/bheklilr"}, "edited": false, "score": 1, "creation_date": 1436360545, "post_id": 31293081, "comment_id": 50577760, "body": "You have errors because your code is pretty malformed.  For example on the line <code>&lt;*&gt; (v .: &quot;var3_1&quot; v .: &quot;var3_2&quot;)</code>, you probably really want <code>&lt;*&gt; ((,) &lt;$&gt; v .: &quot;var3_1&quot; &lt;*&gt; v .: &quot;var3_2&quot;)</code>, as this will actually construct a tuple out of those two values.  Having <code>v .: &quot;var3_1&quot; v .: &quot;var3_2&quot;</code> makes it look like to the compiler that you&#39;re trying <code>v .: (&quot;var3_1&quot; v) .: &quot;var3_2&quot;</code> since function application binds more tightly than all operators, and <code>&quot;var3_1&quot; v</code> doesn&#39;t make any sense whatsoever."}, {"owner": {"user_type": "does_not_exist", "display_name": "user266003"}, "reply_to_user": {"reputation": 51584, "user_id": 839246, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/9b0573c2b936b12828dd1e4cc04206dc?s=128&d=identicon&r=PG&f=1", "display_name": "bheklilr", "link": "https://stackoverflow.com/users/839246/bheklilr"}, "edited": false, "score": 0, "creation_date": 1436362602, "post_id": 31293081, "comment_id": 50579362, "body": "@bheklilr, I&#39;ve fixed FromJson, thank you. Could you help me fix ToJson?"}, {"owner": {"reputation": 51584, "user_id": 839246, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/9b0573c2b936b12828dd1e4cc04206dc?s=128&d=identicon&r=PG&f=1", "display_name": "bheklilr", "link": "https://stackoverflow.com/users/839246/bheklilr"}, "edited": false, "score": 0, "creation_date": 1436364105, "post_id": 31293081, "comment_id": 50580606, "body": "You just have to keep doing what you&#39;re doing.  Just do <code>object [&quot;var1&quot; .= var1, &quot;var2_1&quot; .= sVar1 var2, &quot;var2_2&quot; .= sVar2 var2, &quot;var3_1&quot; .= fst var3, &quot;var3_2&quot; .= snd var3, ...]</code>."}, {"owner": {"reputation": 51584, "user_id": 839246, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/9b0573c2b936b12828dd1e4cc04206dc?s=128&d=identicon&r=PG&f=1", "display_name": "bheklilr", "link": "https://stackoverflow.com/users/839246/bheklilr"}, "edited": false, "score": 0, "creation_date": 1436364205, "post_id": 31293081, "comment_id": 50580694, "body": "I will suggest that you change up your JSON structure a bit though.  It&#39;d be better of your <code>MySubClass1</code> was an entire sub-object in the JSON structure, so you could have <code>{&quot;var1&quot;: &quot;UUID&quot;, &quot;var2&quot;: {&quot;svar1&quot;: &quot;12345&quot;, &quot;svar2&quot;: &quot;67890&quot;}, ...}</code> and so on."}], "owner": {"user_type": "does_not_exist", "display_name": "user266003"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 46, "favorite_count": 0, "answer_count": 0, "score": 0, "last_activity_date": 1436359417, "creation_date": 1436359417, "question_id": 31293081, "link": "https://stackoverflow.com/questions/31293081/to-and-from-json-for-custom-data-types", "title": "To and From JSON for custom data types", "body": "<p>I have the following classes:</p>\n\n<pre><code>type ID = UUID\n\ndata MySubClass1 = MySubClass1\n    { sVar1 :: UTCTime\n    , sVar2 :: UTCTime\n    }\n\ndata MyMainClass = MyMainClass\n    { var1 :: ID\n    , var2 :: MySubClass1\n    , var3 :: (Int, String)\n    , var4 :: Maybe String\n    }\n</code></pre>\n\n<p>And here's JSON itself:</p>\n\n<pre><code>{\n  \"var1\" : ...,\n  \"var2_1\": ...,\n  \"var2_2\": ...,\n  \"var3_1\": ...,\n  \"var3_2\": ...,\n  \"var4\": ...,\n\n  \"svar1\": ...,\n  \"svar2\": ...\n}\n</code></pre>\n\n<p>And I need to create the instances of JSON for them:</p>\n\n<pre><code>--OK\ninstance FromJSON MySubClass1 where\n  parseJSON (Object v) = \n    MySubClass1 &lt;$&gt; v .: \"svar1\" \n           &lt;*&gt; v .: \"svar2\" \n\n--OK\ninstance ToJSON MySubClass1 where\n  toJSON (MySubClass1 sVar1 sVar2) =\n    object [\"svar1\" .= sVar1\n      , \"svar2\" .= sVar2\n    ]\n</code></pre>\n\n<p>And here's I have a difficulty</p>\n\n<pre><code>instance FromJSON MyMainClass where\n  parseJSON (Object v) = \n    MyMainClass &lt;$&gt; v .: \"var1\" \n           &lt;*&gt; (MySubClass1 v .: \"var2_1\" v .: \"var2_2\") -- error\n           &lt;*&gt; (v .: \"var3_1\" v .: \"var3_2\") -- error\n           &lt;*&gt; v .:? \"var4\" \n\ninstance ToJSON MyMainClass where\n  toJSON (MyMainClass var1 var2 var3 var4) =\n    object [\"var1\" .= var1\n      , \"var2\" .= ---???\n      , -- what's next?\n    ]\n</code></pre>\n\n<p>Most of the errors say that the types don't match.</p>\n"}, {"tags": ["haskell", "macros", "lisp", "monads"], "answers": [{"comments": [{"owner": {"reputation": 3485, "user_id": 1483503, "user_type": "registered", "accept_rate": 72, "profile_image": "https://www.gravatar.com/avatar/652348761699d4193e073409caa287d6?s=128&d=identicon&r=PG", "display_name": "mljrg", "link": "https://stackoverflow.com/users/1483503/mljrg"}, "edited": false, "score": 0, "creation_date": 1436356669, "post_id": 31291295, "comment_id": 50574733, "body": "Can Haskell monads be as useful as Lisp macros to remove boilerplate code?"}, {"owner": {"reputation": 43759, "user_id": 1651941, "user_type": "registered", "accept_rate": 97, "profile_image": "https://www.gravatar.com/avatar/a513bc1fa519d2fcf5e4e0d9b5500101?s=128&d=identicon&r=PG", "display_name": "Sibi", "link": "https://stackoverflow.com/users/1651941/sibi"}, "reply_to_user": {"reputation": 3485, "user_id": 1483503, "user_type": "registered", "accept_rate": 72, "profile_image": "https://www.gravatar.com/avatar/652348761699d4193e073409caa287d6?s=128&d=identicon&r=PG", "display_name": "mljrg", "link": "https://stackoverflow.com/users/1483503/mljrg"}, "edited": false, "score": 8, "creation_date": 1436357519, "post_id": 31291295, "comment_id": 50575378, "body": "@mljrg If you are looking for Lisp macro equivalent in Haskell, then you have to go for Template Haskell. Monad and macro are two different things and comparing them is not proper."}, {"owner": {"reputation": 58792, "user_id": 1006010, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/f683d229f3673c9dcc3f3f2796d75c09?s=128&d=identicon&r=PG", "display_name": "MathematicalOrchid", "link": "https://stackoverflow.com/users/1006010/mathematicalorchid"}, "reply_to_user": {"reputation": 3485, "user_id": 1483503, "user_type": "registered", "accept_rate": 72, "profile_image": "https://www.gravatar.com/avatar/652348761699d4193e073409caa287d6?s=128&d=identicon&r=PG", "display_name": "mljrg", "link": "https://stackoverflow.com/users/1483503/mljrg"}, "edited": false, "score": 0, "creation_date": 1436357557, "post_id": 31291295, "comment_id": 50575411, "body": "@mljrg Surely that depends what you&#39;re trying to do. I&#39;m no expert, but I would expect macros to be more powerful in principle. I can&#39;t comment on whether they&#39;re actually more useful in practice."}, {"owner": {"reputation": 865, "user_id": 3694032, "user_type": "registered", "accept_rate": 82, "profile_image": "https://www.gravatar.com/avatar/32d8fabde29edf207ac92275275af90a?s=128&d=identicon&r=PG&f=1", "display_name": "rem", "link": "https://stackoverflow.com/users/3694032/rem"}, "edited": false, "score": 0, "creation_date": 1436363183, "post_id": 31291295, "comment_id": 50579825, "body": "I feel like it&#39;s closer to compare lisp macros to haskell&#39;s laziness - you can sort of achieve lazy evaluation with quoted macros"}, {"owner": {"reputation": 1706, "user_id": 1840613, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/c2dfd4d21060ccd9b972864e0f6cb8c4?s=128&d=identicon&r=PG", "display_name": "Jeremy List", "link": "https://stackoverflow.com/users/1840613/jeremy-list"}, "reply_to_user": {"reputation": 3485, "user_id": 1483503, "user_type": "registered", "accept_rate": 72, "profile_image": "https://www.gravatar.com/avatar/652348761699d4193e073409caa287d6?s=128&d=identicon&r=PG", "display_name": "mljrg", "link": "https://stackoverflow.com/users/1483503/mljrg"}, "edited": false, "score": 0, "creation_date": 1436414494, "post_id": 31291295, "comment_id": 50604775, "body": "@mljrg monads in general don&#39;t reduce boilerplate code, although some of them reduce nested case statements."}], "tags": [], "owner": {"reputation": 58792, "user_id": 1006010, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/f683d229f3673c9dcc3f3f2796d75c09?s=128&d=identicon&r=PG", "display_name": "MathematicalOrchid", "link": "https://stackoverflow.com/users/1006010/mathematicalorchid"}, "is_accepted": true, "score": 7, "last_activity_date": 1436360277, "last_edit_date": 1436360277, "creation_date": 1436354845, "answer_id": 31291295, "question_id": 31289469, "link": "https://stackoverflow.com/questions/31289469/what-can-be-done-with-a-haskell-monad-that-cannot-be-done-with-a-lisp-macro-and/31291295#31291295", "title": "What can be done with a Haskell monad that cannot be done with a Lisp macro, and vice-versa?", "body": "<p>That's kind of an odd comparison. It's a bit like asking \"what can a petrol car do that a diesel generator cannot?\" Er, well, those aren't really the same class of thing...</p>\n\n<p>Lisp macros [which I know almost nothing about] allow you to do compile-time meta-programming. You can use that to achieve all sorts of useful things, from eliminating a bit of boilerplate code to virtually defining an entire new programming language.</p>\n\n<p>Haskell monads are a useful way to structure certain kinds of computations. They make it easy to do certain things which are otherwise a bit tedious. (E.g., checking the result of each and every function to make sure it succeeded before running the next function.) All of this is a <em>run-time</em> thing, though; it has nothing to do with compile-time code generation.</p>\n"}, {"comments": [{"owner": {"reputation": 46737, "user_id": 31615, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/1127d0098e693682f382758abd9f6c76?s=128&d=identicon&r=PG", "display_name": "Svante", "link": "https://stackoverflow.com/users/31615/svante"}, "edited": false, "score": 1, "creation_date": 1436445099, "post_id": 31299551, "comment_id": 50622292, "body": "Closures are not \u201crudimentary OO\u201d."}, {"owner": {"reputation": 44043, "user_id": 1565698, "user_type": "registered", "accept_rate": 38, "profile_image": "https://www.gravatar.com/avatar/7dace33805b9dcdec5aa63308daf88dc?s=128&d=identicon&r=PG", "display_name": "Sylwester", "link": "https://stackoverflow.com/users/1565698/sylwester"}, "reply_to_user": {"reputation": 46737, "user_id": 31615, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/1127d0098e693682f382758abd9f6c76?s=128&d=identicon&r=PG", "display_name": "Svante", "link": "https://stackoverflow.com/users/31615/svante"}, "edited": false, "score": 1, "creation_date": 1436467676, "post_id": 31299551, "comment_id": 50637977, "body": "@Svante objects and closures over lexical scopes <a href=\"http://c2.com/cgi/wiki?ClosuresAndObjectsAreEquivalent\" rel=\"nofollow noreferrer\">serves the same purpose</a>."}, {"owner": {"reputation": 46737, "user_id": 31615, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/1127d0098e693682f382758abd9f6c76?s=128&d=identicon&r=PG", "display_name": "Svante", "link": "https://stackoverflow.com/users/31615/svante"}, "edited": false, "score": 1, "creation_date": 1436513666, "post_id": 31299551, "comment_id": 50654678, "body": "No.  They can be used for similar purposes.  You should not reduce one to the part that overlaps with the other."}], "tags": [], "owner": {"reputation": 44043, "user_id": 1565698, "user_type": "registered", "accept_rate": 38, "profile_image": "https://www.gravatar.com/avatar/7dace33805b9dcdec5aa63308daf88dc?s=128&d=identicon&r=PG", "display_name": "Sylwester", "link": "https://stackoverflow.com/users/1565698/sylwester"}, "is_accepted": false, "score": 3, "last_activity_date": 1436524013, "last_edit_date": 1436524013, "creation_date": 1436376357, "answer_id": 31299551, "question_id": 31289469, "link": "https://stackoverflow.com/questions/31289469/what-can-be-done-with-a-haskell-monad-that-cannot-be-done-with-a-lisp-macro-and/31299551#31299551", "title": "What can be done with a Haskell monad that cannot be done with a Lisp macro, and vice-versa?", "body": "<p>If you can implement something with Lisp you can improve its syntax with a macro. Thus the macro part is just to make it look better or/and reduce code size.</p>\n\n<p>You don't need macros to implement monads. Marijn Haverbeke has made a <a href=\"http://marijnhaverbeke.nl/monad.html\" rel=\"nofollow\">monad implementation</a> using <code>defstruct</code> and <code>defgeneic</code>.</p>\n\n<p>Of course <code>defstruct</code> and <code>defgeneric</code> might use macros to implement it's magic, but it's not actually needed to implement monads. You can implement monads with closures. In the code below its used as a rudimentary OO with encapsulation and message passing.</p>\n\n<pre class=\"lang-lisp prettyprint-override\"><code>(defun maybe (val)\n  (lambda (msg &amp;optional f m)\n    (case msg\n      ((bind) (if val (funcall f val) m))\n      (otherwise val))))\n\n(defun bind (m f)\n  (funcall m 'bind f m)) ;message passing\n\n(defun value (m)\n  (funcall m 'value))    ; message passig\n</code></pre>\n\n<p>Macros are functions that work on syntax. In a lazy language like Haskell macros can be replaced by functions since the arguments are evaluated only when needed. Eg. In CL,which has eager evaluation, you would need a macro to make your own <code>if</code> but you could do the same with a function in Haskell.</p>\n"}], "owner": {"reputation": 3485, "user_id": 1483503, "user_type": "registered", "accept_rate": 72, "profile_image": "https://www.gravatar.com/avatar/652348761699d4193e073409caa287d6?s=128&d=identicon&r=PG", "display_name": "mljrg", "link": "https://stackoverflow.com/users/1483503/mljrg"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 1182, "favorite_count": 0, "closed_date": 1436540656, "accepted_answer_id": 31291295, "answer_count": 2, "score": 1, "last_activity_date": 1436524013, "creation_date": 1436349944, "last_edit_date": 1436353349, "question_id": 31289469, "link": "https://stackoverflow.com/questions/31289469/what-can-be-done-with-a-haskell-monad-that-cannot-be-done-with-a-lisp-macro-and", "closed_reason": "Needs more focus", "title": "What can be done with a Haskell monad that cannot be done with a Lisp macro, and vice-versa?", "body": "<p>My current understanding is that macros can implement any imaginable concept, including monads, because they \"have the compiler at hands\". Is this true? For example, I have came across this <a href=\"https://common-lisp.net/project/cl-monad-macros/monad-macros.htm\" rel=\"nofollow\">link</a></p>\n\n<p>Please, give me facts and examples, no passionate answers. Thank you.</p>\n"}, {"tags": ["list", "haskell"], "comments": [{"owner": {"reputation": 100892, "user_id": 745903, "user_type": "registered", "accept_rate": 74, "profile_image": "https://www.gravatar.com/avatar/50933f6638836741e620669b3940410e?s=128&d=identicon&r=PG", "display_name": "leftaroundabout", "link": "https://stackoverflow.com/users/745903/leftaroundabout"}, "edited": false, "score": 0, "creation_date": 1436347970, "post_id": 31288206, "comment_id": 50569133, "body": "Type signature please..."}, {"owner": {"reputation": 3516, "user_id": 4233758, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/zNTBC.jpg?s=128&g=1", "display_name": "Aleksandar", "link": "https://stackoverflow.com/users/4233758/aleksandar"}, "reply_to_user": {"reputation": 100892, "user_id": 745903, "user_type": "registered", "accept_rate": 74, "profile_image": "https://www.gravatar.com/avatar/50933f6638836741e620669b3940410e?s=128&d=identicon&r=PG", "display_name": "leftaroundabout", "link": "https://stackoverflow.com/users/745903/leftaroundabout"}, "edited": false, "score": 0, "creation_date": 1436348698, "post_id": 31288206, "comment_id": 50569615, "body": "@leftaroundabout added"}], "answers": [{"tags": [], "owner": {"reputation": 126897, "user_id": 791604, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/ce991df7a056248d5e4f6fc3659ba733?s=128&d=identicon&r=PG", "display_name": "Daniel Wagner", "link": "https://stackoverflow.com/users/791604/daniel-wagner"}, "is_accepted": false, "score": 1, "last_activity_date": 1436385062, "creation_date": 1436385062, "answer_id": 31302383, "question_id": 31288206, "link": "https://stackoverflow.com/questions/31288206/how-to-insert-a-list-in-a-list-in-all-possible-ways/31302383#31302383", "title": "How to insert a list in a list in all possible ways?", "body": "<p>Here is one implementation idea: for each element in the first list, we will choose (nondeterministically) a position in the second list to insert it, then recurse. For this to work, we first need a way to nondeterministically choose a position; thus:</p>\n\n<pre><code>choose :: [a] -&gt; [([a], [a])]\nchoose = go [] where\n    go before xs = (before, xs) : case xs of\n        []   -&gt; []\n        x:xs -&gt; go (x:before) xs\n</code></pre>\n\n<p>For example:</p>\n\n<pre><code>&gt; choose \"abcd\"\n[(\"\",\"abcd\"),(\"a\",\"bcd\"),(\"ba\",\"cd\"),(\"cba\",\"d\"),(\"dcba\",\"\")]\n</code></pre>\n\n<p>Now we can use this tool to do the insertion:</p>\n\n<pre><code>insert :: [a] -&gt; [a] -&gt; [[a]]\ninsert [] ys = [ys]\ninsert (x:xs) ys = do\n    (before, after) &lt;- choose ys\n    rest &lt;- insert xs (reverse after)\n    return (before ++ [x] ++ rest)\n</code></pre>\n\n<p>In ghci:</p>\n\n<pre><code>&gt; insert \"ab\" \"cde\"\n[\"abcde\",\"aebcd\",\"adebc\",\"acdeb\",\"cabde\",\"caebd\",\"cadeb\",\"dcabe\",\"dcaeb\",\"edcab\"]\n</code></pre>\n"}, {"tags": [], "owner": {"reputation": 126897, "user_id": 791604, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/ce991df7a056248d5e4f6fc3659ba733?s=128&d=identicon&r=PG", "display_name": "Daniel Wagner", "link": "https://stackoverflow.com/users/791604/daniel-wagner"}, "is_accepted": false, "score": 1, "last_activity_date": 1436385649, "creation_date": 1436385649, "answer_id": 31302554, "question_id": 31288206, "link": "https://stackoverflow.com/questions/31288206/how-to-insert-a-list-in-a-list-in-all-possible-ways/31302554#31302554", "title": "How to insert a list in a list in all possible ways?", "body": "<p>In this answer, I will give the minimal change needed to fix the code you already have (without completely rewriting your code). The first change needed is to update your type signatures to return lists of strings:</p>\n\n<pre><code>insert'' :: Char -&gt; String -&gt; [(String, String)] -&gt; [String]\ninsert' :: (String, String) -&gt; [String]\n</code></pre>\n\n<p>Now your compiler will complain that the first clause of <code>insert'</code> is returning a <code>String</code> instead of a <code>[String]</code>, which is easily fixed:</p>\n\n<pre><code>insert' ([], ys) = [ys]\n</code></pre>\n\n<p>...and that the second clause of <code>insert''</code> is trying to append a <code>String</code> to a <code>[String]</code> when running <code>[h] ++ insert' (b, y)</code>. This one takes some thinking to figure out what you really meant; but my conclusion is that instead of <code>x ++ [h] ++ insert' (b, y)</code>, you really want to run <code>\\t -&gt; x ++ [h] ++ t</code> for each element in <code>insert' (b, y)</code>. Thus:</p>\n\n<pre><code>insert'' h b ((x, y):xs) =\n  (map (\\t -&gt; x ++ [h] ++ t) (insert' (b, y))) ++ (insert'' h b xs)\n</code></pre>\n\n<p>The complete final code is:</p>\n\n<pre><code>import Data.List \n\ninsert'' :: Char -&gt; String -&gt; [(String, String)] -&gt; [String]\ninsert'' _ _ ([]) = []\ninsert'' h b ((x, y):xs) =\n  (map (\\t -&gt; x ++ [h] ++ t) (insert' (b, y))) ++ (insert'' h b xs)\n\ninsert' :: (String, String) -&gt; [String]\ninsert' ([], ys) = [ys]\ninsert' (xs, ys) = \n  insert'' h b lists\n  where\n     h = head xs\n     b = tail xs\n     lists = zip (tails ys) (inits ys) \n</code></pre>\n\n<p>Now ghci will happily produce good answers:</p>\n\n<pre><code>&gt; insert' (\"aaa\", \"bb\")\n[\"bbaaa\",\"babaa\",\"baaba\",\"baaab\",\"abbaa\",\"ababa\",\"abaab\",\"aabba\",\"aabab\",\"aaabb\"]\n</code></pre>\n"}, {"comments": [{"owner": {"reputation": 75362, "user_id": 625403, "user_type": "registered", "accept_rate": 82, "profile_image": "https://www.gravatar.com/avatar/786eed7da67079cb5d63a49d469af25b?s=128&d=identicon&r=PG", "display_name": "amalloy", "link": "https://stackoverflow.com/users/625403/amalloy"}, "edited": false, "score": 0, "creation_date": 1436412253, "post_id": 31302839, "comment_id": 50604198, "body": "This is my favorite by far. It&#39;s exactly the solution I came up with, modulo some style/naming changes. I think it&#39;s much simpler to think of it this way (walk through the lists, choosing one element nondeterministically from them at each step)."}], "tags": [], "owner": {"reputation": 2133, "user_id": 2494576, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/69dcf21a7cf379c1f25476d80a73338f?s=128&d=identicon&r=PG", "display_name": "felix-eku", "link": "https://stackoverflow.com/users/2494576/felix-eku"}, "is_accepted": true, "score": 3, "last_activity_date": 1436386558, "creation_date": 1436386558, "answer_id": 31302839, "question_id": 31288206, "link": "https://stackoverflow.com/questions/31288206/how-to-insert-a-list-in-a-list-in-all-possible-ways/31302839#31302839", "title": "How to insert a list in a list in all possible ways?", "body": "<p>An other implementation idea as in Daniel Wagners first post is to choose in each step a element from one of the lists and prepending it to the results generated by the function called with only the remaining parts of the list:</p>\n\n<pre><code>interleave :: [a] -&gt; [a] -&gt; [[a]]\ninterleave xs           []           = [xs]\ninterleave []           ys           = [ys]\ninterleave xs@(x : xs') ys@(y : ys') = \n  map (x :) (interleave xs' ys) ++ map (y :) (interleave xs ys')\n</code></pre>\n\n<p>For your intial example this produces:</p>\n\n<pre><code>ghci&gt; interleave \"bb\" \"aaa\"\n[\"bbaaa\",\"babaa\",\"baaba\",\"baaab\",\"abbaa\",\"ababa\",\"abaab\",\"aabba\",\"aabab\",\"aaabb\"]\n</code></pre>\n"}], "owner": {"reputation": 3516, "user_id": 4233758, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/zNTBC.jpg?s=128&g=1", "display_name": "Aleksandar", "link": "https://stackoverflow.com/users/4233758/aleksandar"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 518, "favorite_count": 0, "accepted_answer_id": 31302839, "answer_count": 3, "score": 1, "last_activity_date": 1436386558, "creation_date": 1436346597, "last_edit_date": 1436348665, "question_id": 31288206, "link": "https://stackoverflow.com/questions/31288206/how-to-insert-a-list-in-a-list-in-all-possible-ways", "title": "How to insert a list in a list in all possible ways?", "body": "<p>I am trying to enumerate all the possible merges of two lists.\nIn example inserting <code>\"bb\"</code> into <code>\"aaa\"</code> would look like</p>\n\n<pre><code>[\"bbaaa\", \"babaa\", \"baaba\", \"baaab\", \"abbaa\", \"ababa\", \"abaab\", \"aabba\", \"aabab\", \"aaabb\"]\n</code></pre>\n\n<p>What I currently did is this</p>\n\n<pre><code>import Data.List \n\ninsert'' :: Char -&gt; String -&gt; [(String, String)] -&gt; String\ninsert'' _ _ ([]) = []\ninsert'' h b ((x, y):xs) =\n  (x ++ [h] ++ (insert' (b, y))) ++ (insert'' h b xs)\n\ninsert' :: (String, String) -&gt; String\ninsert' ([], ys) = ys\ninsert' (xs, ys) = \n  insert'' h b lists\n  where\n     h = head xs\n     b = tail xs\n     lists = zip (tails ys) (inits ys) \n</code></pre>\n\n<p>This returns for <code>(\"aaa\", \"bb\")</code></p>\n\n<pre><code>\"bbaaababaaabaababbaababaababbabababb\"\n</code></pre>\n\n<p>a concatenated string, I tried making it a list of strings, but I just cannot wrap my head around this function. I always seems to get infinite type construction.</p>\n\n<p>How could I rewrite the function, so it would return a list of strings?</p>\n"}, {"tags": ["haskell"], "answers": [{"tags": [], "owner": {"reputation": 58792, "user_id": 1006010, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/f683d229f3673c9dcc3f3f2796d75c09?s=128&d=identicon&r=PG", "display_name": "MathematicalOrchid", "link": "https://stackoverflow.com/users/1006010/mathematicalorchid"}, "is_accepted": true, "score": 1, "last_activity_date": 1436346450, "creation_date": 1436346450, "answer_id": 31288160, "question_id": 31287921, "link": "https://stackoverflow.com/questions/31287921/haskell-using-the-same-operator-on-different-types-in-a-function/31288160#31288160", "title": "Haskell: Using the same operator on different types in a function", "body": "<p>The type signature <code>a -&gt; a -&gt; Bool</code> says that there must exist some type <code>a</code> for which <code>op</code> has that type. But you want this to work for <em>more than one</em> type <code>a</code>. You can't do that in Haskell '98.</p>\n\n<p>If you turn on rank-2 types (or rank-N types), then you can do</p>\n\n<pre><code>evalComparison :: Exp -&gt; (forall a. a -&gt; a -&gt; Bool) -&gt; Exp -&gt; Result Value\n</code></pre>\n\n<p>This says that whatever you pass in as <code>op</code> has to work for <em>multiple</em> types <code>a</code>. In fact, it says that <code>op</code> has to work for <em>all possible types</em> <code>a</code>. But that's probably too much. What you want is probably closer to</p>\n\n<p>evalComparison :: Exp -> (forall a. Ord a => a -> a -> Bool) -> Exp -> Result Value</p>\n\n<p>This says that <code>op</code> has to work for every possible <code>a</code> that implements <code>Ord</code>.</p>\n\n<p>Although frankly at that point, you might as well just call <code>compare</code> explicitly in your case-expression. Have <code>evalComparison</code> return an <code>Ordering</code>, and then apply a <code>Ordering -&gt; Result Value</code> to that. <code>Ordering</code> is only one type, which should make things simpler.</p>\n"}], "owner": {"reputation": 33, "user_id": 4696751, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/1a56b701ae33edee5d685ae512d252d1?s=128&d=identicon&r=PG&f=1", "display_name": "Mike", "link": "https://stackoverflow.com/users/4696751/mike"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 205, "favorite_count": 1, "accepted_answer_id": 31288160, "answer_count": 1, "score": 2, "last_activity_date": 1436346450, "creation_date": 1436345767, "question_id": 31287921, "link": "https://stackoverflow.com/questions/31287921/haskell-using-the-same-operator-on-different-types-in-a-function", "title": "Haskell: Using the same operator on different types in a function", "body": "<p>I'm writing a simple interpreter in Haskell. I have 3 possible variable types: <code>bool</code>, <code>int</code> and <code>string</code>. To avoid repetition in evaluating comparisons, I've written a function that takes 2 expressions and an operator:</p>\n\n<pre><code>data Value = IntVal Integer\n           | StringVal String\n           | BoolVal Bool\n           | ...\n\nevalComparison :: Ord a =&gt; Exp -&gt; (a -&gt; a -&gt; Bool) -&gt; Exp -&gt; Result Value\nevalComparison expr1 op expr2 = do\n  val1 &lt;- evalExp expr1\n  val2 &lt;- evalExp expr2\n  return $ BoolVal $\n    case (val1, val2) of\n      (IntVal i1, IntVal i2)       -&gt; op i1 i2 (*)\n      (StringVal s1, StringVal s2) -&gt; op s1 s2 (**)\n      (BoolVal b1, BoolVal b2)     -&gt; op b1 b2 (***)\n      otherwise                    -&gt; error \"Expected values of the same type!\"\n</code></pre>\n\n<p>It's intended usage is, for example:</p>\n\n<pre><code>evalExp :: Exp -&gt; Result Value\n...\nevalExp (ELessThen e1 e2) = evalComparison e1 (&lt;) e2\n</code></pre>\n\n<p>(And so on for other comparison operators).</p>\n\n<p>The problem is - it doesn't work. GHC says it <em>couldn't match type Integer with [Char] in line</em> <code>(**)</code> and similarly <em>Integer with Bool in line </em> <code>(***)</code>.</p>\n\n<p>I think I know where the problem lies: once the <code>a</code> from the operator's type is determined as <code>Integer</code> in line <code>(*)</code>, it cannot be changed. So my question is twofold:</p>\n\n<ol>\n<li><p>Why does this problem arise, provided that the result type (<code>Bool</code>) is always the same regardless of the operator's arguments' types?</p></li>\n<li><p>What can be done to make this work?</p></li>\n</ol>\n"}, {"tags": ["haskell", "infinite", "sieve"], "comments": [{"owner": {"reputation": 46235, "user_id": 2541573, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/Z1qtP.png?s=128&g=1", "display_name": "jub0bs", "link": "https://stackoverflow.com/users/2541573/jub0bs"}, "edited": false, "score": 1, "creation_date": 1436343114, "post_id": 31286276, "comment_id": 50565955, "body": "I haven&#39;t worked out the details, but you most likely get stuck in a nonterminating computation because you pass <code>sieve</code> (instead of only an appropriate prefix of <code>sieve</code>, i.e. <code>takeWhile (\\p -&gt; p^2 &lt;= n) sieve</code>) to <code>isPrime</code>."}, {"owner": {"reputation": 7558, "user_id": 448496, "user_type": "registered", "accept_rate": 90, "profile_image": "https://i.stack.imgur.com/BZtrd.png?s=128&g=1", "display_name": "rubik", "link": "https://stackoverflow.com/users/448496/rubik"}, "reply_to_user": {"reputation": 46235, "user_id": 2541573, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/Z1qtP.png?s=128&g=1", "display_name": "jub0bs", "link": "https://stackoverflow.com/users/2541573/jub0bs"}, "edited": false, "score": 0, "creation_date": 1436343269, "post_id": 31286276, "comment_id": 50566044, "body": "@Jubobs I tried adding your suggested modification and it works! Now I am really confused. Why should it work with <code>takeWhile (\\p -&gt; p^2 &lt;= n)</code> and not with <code>takeWhile (&lt;n)</code>?"}], "answers": [{"comments": [{"owner": {"reputation": 7558, "user_id": 448496, "user_type": "registered", "accept_rate": 90, "profile_image": "https://i.stack.imgur.com/BZtrd.png?s=128&g=1", "display_name": "rubik", "link": "https://stackoverflow.com/users/448496/rubik"}, "edited": false, "score": 0, "creation_date": 1436343136, "post_id": 31286978, "comment_id": 50565971, "body": "But why doesn&#39;t it work when I add the <code>takeWhile</code>? With that it should stop after a finite number of values."}, {"owner": {"reputation": 7558, "user_id": 448496, "user_type": "registered", "accept_rate": 90, "profile_image": "https://i.stack.imgur.com/BZtrd.png?s=128&g=1", "display_name": "rubik", "link": "https://stackoverflow.com/users/448496/rubik"}, "edited": false, "score": 0, "creation_date": 1436343311, "post_id": 31286978, "comment_id": 50566070, "body": "I&#39;m puzzled. I tried @Jubobs&#39;s suggested modification and it works. I cannot understand why his <code>takeWhile</code> works while mine does not."}, {"owner": {"reputation": 7558, "user_id": 448496, "user_type": "registered", "accept_rate": 90, "profile_image": "https://i.stack.imgur.com/BZtrd.png?s=128&g=1", "display_name": "rubik", "link": "https://stackoverflow.com/users/448496/rubik"}, "edited": false, "score": 0, "creation_date": 1436343474, "post_id": 31286978, "comment_id": 50566171, "body": "Oh now it&#39;s clear, thanks! Using the other <code>takeWhile</code> works because it only uses already computed primes."}], "tags": [], "owner": {"reputation": 81337, "user_id": 91757, "user_type": "registered", "accept_rate": 85, "profile_image": "https://www.gravatar.com/avatar/afaf752cb41c3968dbd570c6f6fa0dc3?s=128&d=identicon&r=PG", "display_name": "Frerich Raabe", "link": "https://stackoverflow.com/users/91757/frerich-raabe"}, "is_accepted": true, "score": 4, "last_activity_date": 1436343689, "last_edit_date": 1436343689, "creation_date": 1436343095, "answer_id": 31286978, "question_id": 31286276, "link": "https://stackoverflow.com/questions/31286276/sieve-gets-stuck-at-the-beginning/31286978#31286978", "title": "Sieve gets stuck at the beginning", "body": "<p>You cause an infinite recursion by applying <code>all</code> to the entire <code>sieve</code> and not just the values which you sieved so far. I.e. For the second element, <code>isPrime</code> tests <em>all</em> values in <code>sieve</code> instead of just <code>2</code>.</p>\n\n<p>In your Python version, you wrote</p>\n\n<pre><code>is_prime(n, ps)\n</code></pre>\n\n<p>which only tests <code>n</code> against all numbers sieved so far. The Python equivalent of what you did in Haskell is basically</p>\n\n<pre><code>is_prime(n, sieve())\n</code></pre>\n\n<p>Now, using <code>takeWhile (&lt;n)</code> won't help because that also requires calculating the sieve elements. Imagine what happens for the second element of <code>sieve</code> (which should be 3): it tests all values of the sieve for which <code>&lt; 3</code> holds, but in order to test that you actually need to evaluate the sieve elements. So you still have an infinite recursion.</p>\n"}, {"tags": [], "owner": {"reputation": 818, "user_id": 4287267, "user_type": "registered", "accept_rate": 95, "profile_image": "https://i.stack.imgur.com/MxZkq.png?s=128&g=1", "display_name": "mjgalindo", "link": "https://stackoverflow.com/users/4287267/mjgalindo"}, "is_accepted": false, "score": 0, "last_activity_date": 1436343389, "creation_date": 1436343389, "answer_id": 31287072, "question_id": 31286276, "link": "https://stackoverflow.com/questions/31286276/sieve-gets-stuck-at-the-beginning/31287072#31287072", "title": "Sieve gets stuck at the beginning", "body": "<p>I'd say the comprehension list in sieve won't end until it completes, never. To use take like that, sieve would have to return the elements one by one. For instance, <code>[1..]</code> shows <code>1, 2 ,3 ,4...</code> to infinity but your sieve only shows <code>[2</code>.</p>\n\n<p>Or clearly not what I said</p>\n"}], "owner": {"reputation": 7558, "user_id": 448496, "user_type": "registered", "accept_rate": 90, "profile_image": "https://i.stack.imgur.com/BZtrd.png?s=128&g=1", "display_name": "rubik", "link": "https://stackoverflow.com/users/448496/rubik"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 57, "favorite_count": 1, "accepted_answer_id": 31286978, "answer_count": 2, "score": 2, "last_activity_date": 1436343689, "creation_date": 1436340873, "last_edit_date": 1436343414, "question_id": 31286276, "link": "https://stackoverflow.com/questions/31286276/sieve-gets-stuck-at-the-beginning", "title": "Sieve gets stuck at the beginning", "body": "<p>I wrote the following sieve:</p>\n\n<pre class=\"lang-hs prettyprint-override\"><code>isPrime :: Integer -&gt; [Integer] -&gt; Bool\nisPrime n = all (\\i -&gt; n `mod` i /= 0)\n\n\nsieve :: [Integer]\nsieve = 2 : [i | i &lt;- [3,5..], isPrime i sieve]\n</code></pre>\n\n<p>but I don't understand why it gets stuck after the first value. Running <code>take 10 sieve</code> results in <code>[2,</code> and nothing happens. It probably has something to do with infinite recursion. May the problem be that <code>sieve</code> is growing and at the same time it's used inside <code>isPrime</code>? For that reason I also tried modifying <code>isPrime</code> as follows, but without success:</p>\n\n<pre class=\"lang-hs prettyprint-override\"><code>isPrime :: Integer -&gt; [Integer] -&gt; Bool\nisPrime n = all (\\i -&gt; n `mod` i /= 0) . takeWhile (&lt;n)\n</code></pre>\n\n<p><strong>EDIT</strong>: Surprisingly, @Jubobs's modification works:</p>\n\n<pre class=\"lang-hs prettyprint-override\"><code>isPrime :: Integer -&gt; [Integer] -&gt; Bool\nisPrime n = all (\\i -&gt; n `mod` i /= 0) . takeWhile (\\p -&gt; p^2 &lt;= n)\n</code></pre>\n\n<p>I cannot understand why this version of <code>takeWhile</code> works while the other does not. I see that with my previous version I tested many unnecessary divisors, but they were in a finite number nontheless.</p>\n\n<hr>\n\n<p>The code should basically be equivalent to the following Python code:</p>\n\n<pre class=\"lang-py prettyprint-override\"><code>def is_prime(n, ps):\n    for i in ps:\n        if n % i == 0: return False\n    return True\n\n\ndef sieve():\n    yield 2\n    n = 3\n    ps = [2]\n    while True:\n        if is_prime(n, ps):\n            yield n\n            ps.append(n)\n        n += 2\n</code></pre>\n"}, {"tags": ["haskell", "monads"], "comments": [{"owner": {"reputation": 28456, "user_id": 1094403, "user_type": "registered", "accept_rate": 83, "profile_image": "https://www.gravatar.com/avatar/3770aa7eae5c211921493abd0d2c9f5a?s=128&d=identicon&r=PG", "display_name": "Luis Casillas", "link": "https://stackoverflow.com/users/1094403/luis-casillas"}, "edited": false, "score": 1, "creation_date": 1436316998, "post_id": 31281655, "comment_id": 50556720, "body": "<a href=\"http://stackoverflow.com/questions/12658443/how-to-decorate-a-tree-in-haskell\" title=\"how to decorate a tree in haskell\">stackoverflow.com/questions/12658443/&hellip;</a>"}], "answers": [{"comments": [{"owner": {"reputation": 1764, "user_id": 2478883, "user_type": "registered", "accept_rate": 92, "profile_image": "https://i.stack.imgur.com/ys9QL.png?s=128&g=1", "display_name": "Ryoichiro Oka", "link": "https://stackoverflow.com/users/2478883/ryoichiro-oka"}, "edited": false, "score": 0, "creation_date": 1436315815, "post_id": 31281663, "comment_id": 50556427, "body": "Haha that&#39;s clever! Thanks for your answer. But I&#39;m still wondering how it could be implemented within Monad transformer."}, {"owner": {"reputation": 2846, "user_id": 4347335, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/eb7e6f293a134a5defec74e12cae42cc?s=128&d=identicon&r=PG&f=1", "display_name": "cchalmers", "link": "https://stackoverflow.com/users/4347335/cchalmers"}, "reply_to_user": {"reputation": 1764, "user_id": 2478883, "user_type": "registered", "accept_rate": 92, "profile_image": "https://i.stack.imgur.com/ys9QL.png?s=128&g=1", "display_name": "Ryoichiro Oka", "link": "https://stackoverflow.com/users/2478883/ryoichiro-oka"}, "edited": false, "score": 1, "creation_date": 1436316587, "post_id": 31281663, "comment_id": 50556601, "body": "@RyoichiroOka There&#39;s different ways to do that in <a href=\"http://stackoverflow.com/questions/29125149/how-would-i-use-lens-in-haskell-to-duplicate-pythons-enumerate\">this question</a>."}, {"owner": {"reputation": 198293, "user_id": 707111, "user_type": "moderator", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/oXZkh.jpg?s=128&g=1", "display_name": "Ry-", "link": "https://stackoverflow.com/users/707111/ry"}, "reply_to_user": {"reputation": 1764, "user_id": 2478883, "user_type": "registered", "accept_rate": 92, "profile_image": "https://i.stack.imgur.com/ys9QL.png?s=128&g=1", "display_name": "Ryoichiro Oka", "link": "https://stackoverflow.com/users/2478883/ryoichiro-oka"}, "edited": false, "score": 1, "creation_date": 1436317499, "post_id": 31281663, "comment_id": 50556847, "body": "@RyoichiroOka: Edited."}, {"owner": {"reputation": 57219, "user_id": 33796, "user_type": "registered", "accept_rate": 70, "profile_image": "https://www.gravatar.com/avatar/08727b23ba62e634b32988cdff082663?s=128&d=identicon&r=PG", "display_name": "luqui", "link": "https://stackoverflow.com/users/33796/luqui"}, "reply_to_user": {"reputation": 1764, "user_id": 2478883, "user_type": "registered", "accept_rate": 92, "profile_image": "https://i.stack.imgur.com/ys9QL.png?s=128&g=1", "display_name": "Ryoichiro Oka", "link": "https://stackoverflow.com/users/2478883/ryoichiro-oka"}, "edited": false, "score": 5, "creation_date": 1436319559, "post_id": 31281663, "comment_id": 50557349, "body": "@RyoichiroOka, just clearing up in case you have a mistake in your mind: <code>zip [0..]</code> is not some clever hack that works in this case where in general you need a state transformer; rather, state is almost never necessary and most problems can be solved by combining standard functions.  State really should be one of your last resorts."}], "tags": [], "owner": {"reputation": 198293, "user_id": 707111, "user_type": "moderator", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/oXZkh.jpg?s=128&g=1", "display_name": "Ry-", "link": "https://stackoverflow.com/users/707111/ry"}, "is_accepted": true, "score": 6, "last_activity_date": 1436317478, "last_edit_date": 1436317478, "creation_date": 1436315737, "answer_id": 31281663, "question_id": 31281655, "link": "https://stackoverflow.com/questions/31281655/index-contents-of-a-list-a-int-a/31281663#31281663", "title": "Index contents of a list ([a] -&gt; [(Int, a)])", "body": "<p>No need to go to all that trouble.</p>\n\n<pre><code>indexed = zip [0..]\n</code></pre>\n\n<p>If you want to use monad transformers, I think there\u2019s this:</p>\n\n<pre><code>indexed :: [a] -&gt; [(Int, a)]\nindexed ns = evalState (runListT lt) 0 where\n    lt = do\n        n &lt;- ListT $ return ns\n        i &lt;- get &lt;* modify (+1)\n        return (i, n)\n</code></pre>\n"}], "owner": {"reputation": 1764, "user_id": 2478883, "user_type": "registered", "accept_rate": 92, "profile_image": "https://i.stack.imgur.com/ys9QL.png?s=128&g=1", "display_name": "Ryoichiro Oka", "link": "https://stackoverflow.com/users/2478883/ryoichiro-oka"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 192, "favorite_count": 2, "accepted_answer_id": 31281663, "answer_count": 1, "score": 2, "last_activity_date": 1436317478, "creation_date": 1436315665, "question_id": 31281655, "link": "https://stackoverflow.com/questions/31281655/index-contents-of-a-list-a-int-a", "title": "Index contents of a list ([a] -&gt; [(Int, a)])", "body": "<p>I want a function that takes in a list and indexes out all the contents: <code>indexed :: [a] -&gt; [(Int, a)]</code>. Or the returned value can be whatever Monad as long as it contains indexed values of the original list.</p>\n\n<p>I thought that I would need StateT to temporary remember and inclement index numbers while processing each element, but I'm not familiar with Monad transformer thingy and I need some help write the function.</p>\n\n<p>I believe it will look similar to this (this is sure not working):</p>\n\n<pre><code>indexed ns = do\n  n &lt;- ns\n  i &lt;- get\n  put (i + 1)\n  return (i, n)\n</code></pre>\n\n<p>How would you write it?</p>\n"}, {"tags": ["haskell"], "answers": [{"comments": [{"owner": {"reputation": 46858, "user_id": 967492, "user_type": "registered", "accept_rate": 67, "profile_image": "https://www.gravatar.com/avatar/526ea226101e199d029049dda22a4e58?s=128&d=identicon&r=PG", "display_name": "potong", "link": "https://stackoverflow.com/users/967492/potong"}, "edited": false, "score": 0, "creation_date": 1436334467, "post_id": 31280749, "comment_id": 50561215, "body": "I guess the place where my understanding falters is when you say: <i>we check the array and see that the element has not yet been evaluated, then we follow the definition and see that to evaluate it, we need to evaluate is89 ! 4, so we do that</i>. How come, where did this spring from? BTHW isn&#39;t the first index 4 not 2?"}, {"owner": {"reputation": 796, "user_id": 2337954, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/6ac2ebcf2a09563be6eceb2d36a9f531?s=128&d=identicon&r=PG", "display_name": "mniip", "link": "https://stackoverflow.com/users/2337954/mniip"}, "reply_to_user": {"reputation": 46858, "user_id": 967492, "user_type": "registered", "accept_rate": 67, "profile_image": "https://www.gravatar.com/avatar/526ea226101e199d029049dda22a4e58?s=128&d=identicon&r=PG", "display_name": "potong", "link": "https://stackoverflow.com/users/967492/potong"}, "edited": false, "score": 0, "creation_date": 1436354851, "post_id": 31280749, "comment_id": 50573493, "body": "@potong, In haskell (specifically STG-based implemtation like GHC), every value is either an evaluated value, or a closure (a piece of code) explaining how to evaluate it, and when that code is executed, the closure is replaced with the evaluated value."}], "tags": [], "owner": {"reputation": 796, "user_id": 2337954, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/6ac2ebcf2a09563be6eceb2d36a9f531?s=128&d=identicon&r=PG", "display_name": "mniip", "link": "https://stackoverflow.com/users/2337954/mniip"}, "is_accepted": true, "score": 4, "last_activity_date": 1436310325, "last_edit_date": 1436310325, "creation_date": 1436309575, "answer_id": 31280749, "question_id": 31280605, "link": "https://stackoverflow.com/questions/31280605/how-is-this-listarray-populated/31280749#31280749", "title": "How is this listArray populated?", "body": "<p>Haskell's laziness is also about calculating every value only once, and this array is a rather classical memoization technique.</p>\n\n<p>So we are asked to calculate <code>is89 ! 2</code>, we check the array and see that the element has not yet been evaluated, then we follow the definition and see that to evaluate it, we need to evaluate <code>is89 ! 4</code>, so we do that. Again we check the array and see that it isn't evaluated yet. And so on, we check <code>16</code>, <code>37</code>, <code>58</code>, and then finally arrive at <code>89</code>, we check the array and see that the value has been evaluated! (Per definition it is <code>True</code>). Then we backtrack and update the index <code>58</code> to also \"be evaluated\" and contain <code>True</code>, and so on with <code>37</code>, <code>16</code>, <code>4</code>, and <code>2</code>, and this is when we return and say that the value we were asked is <code>True</code>.</p>\n\n<p>Next time, suppose, that we are asked <code>is89 ! 11</code>, we check the array, and see that it is not evaluated yet, and that we need <code>is89 ! 2</code>, but we already evaluated that one earlier! So we just use the result of the evaluation from the past.</p>\n\n<p>In the end we have achieved a lookup table that is only populated with values that are demanded, i.e memoization.</p>\n"}], "owner": {"reputation": 46858, "user_id": 967492, "user_type": "registered", "accept_rate": 67, "profile_image": "https://www.gravatar.com/avatar/526ea226101e199d029049dda22a4e58?s=128&d=identicon&r=PG", "display_name": "potong", "link": "https://stackoverflow.com/users/967492/potong"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 276, "favorite_count": 0, "accepted_answer_id": 31280749, "answer_count": 1, "score": 2, "last_activity_date": 1436323652, "creation_date": 1436308805, "last_edit_date": 1436323652, "question_id": 31280605, "link": "https://stackoverflow.com/questions/31280605/how-is-this-listarray-populated", "title": "How is this listArray populated?", "body": "<p>Having correctly answered <a href=\"https://projecteuler.net/problem=92\" rel=\"nofollow\">euler question 92</a> using a brute force solution I read through the thread 92 looking for other haskell solutions. The last solution is blisteringly fast but has me stumped as to how it implements an array showing if the numbers 0 to 567 boil down to chains ending in 1 (False) or 89 (True).</p>\n\n<pre><code>import Data.List\nimport Data.Array\nimport Data.Char\n\nb = (is89!) . sum . map ((^2) . digitToInt) . show\nis89 = listArray (0, 567) $ False:False:(map b [2..88] ++ [True] ++ map b [90..567])\n</code></pre>\n\n<p>I thought I understood the lazy nature of haskell and the way it can use prior values in lists to generate future values such as in generating primes, fibonacci numbers or such like. But in this instance the indexes seem to dance about (within the bounds of 0 to 567) and I am lost as to how the value of an index ends up False or True. </p>\n\n<p>For instance the first value in the first map is 2 which when squared and summed is 4. But index 4 has not been prepopulated yet. The only values prepopulated as far as I can see are 0,1 and 89.</p>\n\n<p>Could someone walk me through slowly how this array is populated</p>\n"}, {"tags": ["haskell", "cabal-install"], "comments": [{"owner": {"reputation": 15757, "user_id": 176841, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/45a168cb9eb8454d66c78f18e29d9342?s=128&d=identicon&r=PG", "display_name": "jberryman", "link": "https://stackoverflow.com/users/176841/jberryman"}, "edited": false, "score": 0, "creation_date": 1436318827, "post_id": 31280410, "comment_id": 50557189, "body": "What are you actually typing? Are those even real options?"}, {"owner": {"reputation": 4565, "user_id": 1134885, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/7c428466054762cf7d4b5fb5f4396fa2?s=128&d=identicon&r=PG", "display_name": "NovaDenizen", "link": "https://stackoverflow.com/users/1134885/novadenizen"}, "edited": false, "score": 0, "creation_date": 1436326994, "post_id": 31280410, "comment_id": 50559019, "body": "The problem is in one of the things you haven&#39;t told us about, and we know the things you&#39;ve told us about aren&#39;t accurate."}], "answers": [{"comments": [{"owner": {"reputation": 2501, "user_id": 2868481, "user_type": "registered", "accept_rate": 48, "profile_image": "https://www.gravatar.com/avatar/d32920192c6bebcffb83fffd557b9553?s=128&d=identicon&r=PG&f=1", "display_name": "d8d0d65b3f7cf42", "link": "https://stackoverflow.com/users/2868481/d8d0d65b3f7cf42"}, "edited": false, "score": 0, "creation_date": 1445796851, "post_id": 31284379, "comment_id": 54463222, "body": "Wrong. Have you actually tried <code>cabal install crypto-api --disable-profiling --disable-documentation</code>, in an empty sandbox? It will fail, with the error I mentioned. Abbreviation of flags to unique prefixes is allowed, the implemetation uses <a href=\"https://github.com/haskell/cabal/blob/master/Cabal/Distribution/GetOpt.hs\" rel=\"nofollow noreferrer\">github.com/haskell/cabal/blob/master/Cabal/Distribution/&hellip;</a>"}], "tags": [], "owner": {"reputation": 2152, "user_id": 1103600, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/7830fb399137c319ff68dca3e3b6f7e2?s=128&d=identicon&r=PG", "display_name": "Arnon", "link": "https://stackoverflow.com/users/1103600/arnon"}, "is_accepted": false, "score": -1, "last_activity_date": 1436334119, "creation_date": 1436334119, "answer_id": 31284379, "question_id": 31280410, "link": "https://stackoverflow.com/questions/31280410/cabal-install-disable-prof-not-working/31284379#31284379", "title": "cabal install --disable-prof not working?", "body": "<p>You used the wrong flags.</p>\n\n<p>You need <code>--disable-profiling --disable-documentation</code></p>\n"}, {"tags": [], "owner": {"reputation": 37486, "user_id": 371753, "user_type": "registered", "accept_rate": 83, "profile_image": "https://i.stack.imgur.com/znFEK.jpg?s=128&g=1", "display_name": "sclv", "link": "https://stackoverflow.com/users/371753/sclv"}, "is_accepted": false, "score": 0, "last_activity_date": 1457901248, "creation_date": 1457901248, "answer_id": 35975472, "question_id": 31280410, "link": "https://stackoverflow.com/questions/31280410/cabal-install-disable-prof-not-working/35975472#35975472", "title": "cabal install --disable-prof not working?", "body": "<p>Odds are a package <em>lower</em> in the dependency tree is forcing profiling builds, and then failing when the package it depends on has not been built that way.</p>\n"}], "owner": {"reputation": 2501, "user_id": 2868481, "user_type": "registered", "accept_rate": 48, "profile_image": "https://www.gravatar.com/avatar/d32920192c6bebcffb83fffd557b9553?s=128&d=identicon&r=PG&f=1", "display_name": "d8d0d65b3f7cf42", "link": "https://stackoverflow.com/users/2868481/d8d0d65b3f7cf42"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 53, "favorite_count": 0, "answer_count": 2, "score": 1, "last_activity_date": 1457901248, "creation_date": 1436307904, "question_id": 31280410, "link": "https://stackoverflow.com/questions/31280410/cabal-install-disable-prof-not-working", "title": "cabal install --disable-prof not working?", "body": "<p>To save time, I am trying to build a package (in a sandbox) with <code>--disable-doc --disable-prof</code>, but it's failing: when compiling some dependency (crypto-api), I get     </p>\n\n<pre><code>Could not find module \u2018System.Entropy\u2019\nPerhaps you haven't installed the profiling libraries for package   \n\u2018entropy-0.3.7@entro_GdlGosmsZhO5QKbUBFjD3f\u2019?\n</code></pre>\n\n<p>Sure I have not, and I don't want to.</p>\n\n<p>What's happening? (The workaround is to <code>--disable-doc</code> only.)</p>\n"}, {"tags": ["haskell", "monads", "monad-transformers"], "answers": [{"comments": [{"owner": {"reputation": 14449, "user_id": 105678, "user_type": "registered", "accept_rate": 89, "profile_image": "https://www.gravatar.com/avatar/859da59b3e4097fa659aabb55412de10?s=128&d=identicon&r=PG", "display_name": "Sean Clark Hess", "link": "https://stackoverflow.com/users/105678/sean-clark-hess"}, "edited": false, "score": 0, "creation_date": 1436380019, "post_id": 31289255, "comment_id": 50591725, "body": "Thanks pingu. I hadn&#39;t understood that the EitherT ServantErr a type in my server function was optional, because I still need to handle errors somehow. I thought I needed to end up with that. I didn&#39;t realize I could do it in my run function. See my answer below."}], "tags": [], "owner": {"reputation": 76, "user_id": 4561843, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/8RhJh.jpg?s=128&g=1", "display_name": "pingu", "link": "https://stackoverflow.com/users/4561843/pingu"}, "is_accepted": true, "score": 5, "last_activity_date": 1436349466, "creation_date": 1436349466, "answer_id": 31289255, "question_id": 31279943, "link": "https://stackoverflow.com/questions/31279943/using-servant-with-readert-io-a/31289255#31289255", "title": "Using servant with ReaderT IO a", "body": "<p>You were almost there, test should be:</p>\n\n<pre><code>test :: ReaderT Int IO String\ntest = giveMeAMessage\n</code></pre>\n\n<p>As for your other questions, I don't have time to answer just now but us servant developers should probably make it easier or better documented.</p>\n\n<p>Could you please read through the source for whichever part confuses you, and then ask specific questions?</p>\n"}, {"comments": [{"owner": {"reputation": 806, "user_id": 1527537, "user_type": "registered", "accept_rate": 74, "profile_image": "https://www.gravatar.com/avatar/5cac7130ae6a4029c6fc00eadc5868e6?s=128&d=identicon&r=PG", "display_name": "Joe Shanahan", "link": "https://stackoverflow.com/users/1527537/joe-shanahan"}, "edited": false, "score": 2, "creation_date": 1498638367, "post_id": 31300720, "comment_id": 76574857, "body": "I was looking at this recently.The following blog post covers this topic with reasonable depth and uses some Servant util functions designed for this very purpose: <a href=\"https://kseo.github.io/posts/2017-01-18-natural-transformations-in-servant.html\" rel=\"nofollow noreferrer\">kseo.github.io/posts/&hellip;</a>"}], "tags": [], "owner": {"reputation": 14449, "user_id": 105678, "user_type": "registered", "accept_rate": 89, "profile_image": "https://www.gravatar.com/avatar/859da59b3e4097fa659aabb55412de10?s=128&d=identicon&r=PG", "display_name": "Sean Clark Hess", "link": "https://stackoverflow.com/users/105678/sean-clark-hess"}, "is_accepted": false, "score": 9, "last_activity_date": 1436379937, "creation_date": 1436379937, "answer_id": 31300720, "question_id": 31279943, "link": "https://stackoverflow.com/questions/31279943/using-servant-with-readert-io-a/31300720#31300720", "title": "Using servant with ReaderT IO a", "body": "<p>After help from lots of folks and hours of reading random things here's a complete example of using Servant with ReaderT, done as fancy as I can (using newtype, and GeneralizedNewtypeDeriving, I also added ExceptT for exceptions). </p>\n\n<pre><code>{-# LANGUAGE OverloadedStrings #-}\n{-# LANGUAGE TypeOperators #-}\n{-# LANGUAGE DataKinds #-}\n{-# LANGUAGE PolyKinds #-}\n{-# LANGUAGE GeneralizedNewtypeDeriving #-}\n\nmodule Serials.Route.Test where\n\nimport Control.Monad.Trans (lift)\nimport Control.Monad.Trans.Either\nimport Control.Monad.Except\nimport Control.Monad.Reader\nimport Control.Monad.IO.Class (liftIO, MonadIO)\nimport Data.Monoid\nimport Data.Text (Text, pack)\nimport Data.Text.Lazy (fromStrict)\nimport Data.Text.Lazy.Encoding (encodeUtf8, decodeUtf8)\nimport Data.Aeson\nimport Data.ByteString.Lazy (ByteString)\nimport Servant.Server\nimport Servant\nimport Database.RethinkDB.NoClash\nimport System.Environment\n\ndata AppError = Invalid Text | NotFound | ServerError Text\n\nnewtype App a = App {\n  runApp :: ReaderT Int (ExceptT AppError IO) a\n} deriving (Monad, Functor, Applicative, MonadReader Int, MonadError AppError, MonadIO)\n\ntype TestAPI =\n        \"a\" :&gt; Get '[JSON] String\n    :&lt;|&gt; \"b\" :&gt; Get '[JSON] String\n    :&lt;|&gt; \"c\" :&gt; Get '[JSON] String\n\ngiveMeAMessage :: App String\ngiveMeAMessage = do\n    code &lt;- ask\n    name &lt;- getProgName'\n    throwError $ Invalid \"your input is invalid. not really, just to test\"\n    return $ show code &lt;&gt; name\n\ntestMaybe :: App (Maybe String)\ntestMaybe = return $ Nothing\n\ntestErr :: App (Either String String)\ntestErr = return $ Left \"Oh no!\"\n\ngetProgName' :: MonadIO m =&gt; m String\ngetProgName' = liftIO $ getProgName\n\nhello :: IO String\nhello = return \"hello\"\n\n---------------------------------------------------------------\n\n-- return a 404 if Nothing\nisNotFound :: App (Maybe a) -&gt; App a\nisNotFound action = do\n    res &lt;- action\n    case res of\n      Nothing -&gt; throwError $ NotFound\n      Just v  -&gt; return v\n\n-- map to a generic error\nisError :: Show e =&gt; App (Either e a) -&gt; App a\nisError action = do\n    res &lt;- action\n    case res of\n      Left e -&gt; throwError $ ServerError $ pack $ show e\n      Right v -&gt; return v\n\n-- wow, it's IN My monad here! that's swell\ntestServerT ::ServerT TestAPI App\ntestServerT = getA :&lt;|&gt; getB :&lt;|&gt; getC\n  where\n\n    getA :: App String\n    getA = giveMeAMessage\n    -- you can also lift IO functions\n    --getA = liftIO $ hello\n\n    -- I can map app functions that return Maybes and Eithers to \n    -- app exceptions using little functions like this\n    getB :: App String\n    getB = isNotFound $ testMaybe\n\n    getC :: App String\n    getC = isError $ testErr\n\n-- this is awesome because I can easily map error codes here\nrunAppT :: Int -&gt; App a -&gt; EitherT ServantErr IO a\nrunAppT code action = do\n    res &lt;- liftIO $ runExceptT $ runReaderT (runApp action) code\n\n    -- branch based on the error or value\n    EitherT $ return $ case res of\n      Left (Invalid text) -&gt; Left err400 { errBody = textToBSL text }\n      Left (NotFound)     -&gt; Left err404\n      Left (ServerError text) -&gt; Left err500 { errBody = textToBSL text }\n      Right a  -&gt; Right a\n\ntextToBSL :: Text -&gt; ByteString\ntextToBSL = encodeUtf8 . fromStrict\n\ntestServer' :: Int -&gt; Server TestAPI\ntestServer' code = enter (Nat $ (runAppT code)) testServerT\n</code></pre>\n"}, {"tags": [], "owner": {"reputation": 68390, "user_id": 55246, "user_type": "registered", "accept_rate": 69, "profile_image": "https://www.gravatar.com/avatar/c25ae0f8b2c34d0766717abab05b2efb?s=128&d=identicon&r=PG", "display_name": "Sridhar Ratnakumar", "link": "https://stackoverflow.com/users/55246/sridhar-ratnakumar"}, "is_accepted": false, "score": 2, "last_activity_date": 1522677478, "creation_date": 1522677478, "answer_id": 49612696, "question_id": 31279943, "link": "https://stackoverflow.com/questions/31279943/using-servant-with-readert-io-a/49612696#49612696", "title": "Using servant with ReaderT IO a", "body": "<p>Recent versions of servant have simplified this a lot. See <a href=\"http://haskell-servant.readthedocs.io/en/stable/cookbook/using-custom-monad/UsingCustomMonad.html\" rel=\"nofollow noreferrer\">Using a custom monad</a> in the servant cookbook.</p>\n\n<pre><code>nt :: State -&gt; AppM a -&gt; Handler a\nnt s x = runReaderT x s\n\napp :: State -&gt; Application\napp s = serve api $ hoistServer api (nt s) server\n</code></pre>\n"}], "owner": {"reputation": 14449, "user_id": 105678, "user_type": "registered", "accept_rate": 89, "profile_image": "https://www.gravatar.com/avatar/859da59b3e4097fa659aabb55412de10?s=128&d=identicon&r=PG", "display_name": "Sean Clark Hess", "link": "https://stackoverflow.com/users/105678/sean-clark-hess"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 1532, "favorite_count": 4, "accepted_answer_id": 31289255, "answer_count": 3, "score": 8, "last_activity_date": 1522677478, "creation_date": 1436305798, "question_id": 31279943, "link": "https://stackoverflow.com/questions/31279943/using-servant-with-readert-io-a", "title": "Using servant with ReaderT IO a", "body": "<p>I'm using the <code>servant</code> library for my JSON API. I need some help to get a <code>ServerT MyAPI (ReaderT a IO)</code> monad stack working. </p>\n\n<p>Here's an example using <code>ReaderT</code>, but without integrating it with servant:</p>\n\n<pre><code>-- this code works\n\ntype TestAPI =\n         \"a\" :&gt; Get '[JSON] String\n    :&lt;|&gt; \"b\" :&gt; Get '[JSON] String\n\ntest2 :: EitherT ServantErr IO String\ntest2 = return \"asdf\"\n\ntestServer :: Int -&gt; Server TestAPI\ntestServer code = test :&lt;|&gt; test2\n  where\n    test :: EitherT ServantErr IO String\n    test = liftIO $ runReaderT (giveMeAMessage) code\n\n-- this is contrived. In my real application I want to use a Reader for the database connection. \ngiveMeAMessage :: ReaderT Int IO String\ngiveMeAMessage = do\n    code &lt;- ask\n    name &lt;- liftIO $ getProgName\n    return $ show code &lt;&gt; name\n</code></pre>\n\n<p>So, now I would like to get it working with ServerT, following the example in <a href=\"https://haskell-servant.github.io/posts/2015-05-10-servant-0.4-released.html\" rel=\"noreferrer\">this article</a>.</p>\n\n<pre><code>-- this code doesn't compile \n\ntestServerT :: ServerT TestAPI (ReaderT Int IO)\ntestServerT = test :&lt;|&gt; test\n  where\n\n    test :: EitherT ServantErr (ReaderT Int IO) String\n    test = lift $ giveMeAMessage\n\ntestServer' :: Int -&gt; Server TestAPI\ntestServer' code = enter (Nat $ liftIO . (`runReaderT` code)) testServerT\n</code></pre>\n\n<p>I get the following error:</p>\n\n<pre><code>server/Serials/Route/Test.hs:43:15:\n    Couldn't match type \u2018EitherT ServantErr (ReaderT Int IO) String\u2019\n                  with \u2018ReaderT Int IO [Char]\u2019\n    Expected type: ServerT TestAPI (ReaderT Int IO)\n      Actual type: EitherT ServantErr (ReaderT Int IO) String\n                  :&lt;|&gt; EitherT ServantErr (ReaderT Int IO) String\n    In the expression: test :&lt;|&gt; test\n    In an equation for \u2018testServerT\u2019:\n        testServerT\n          = test :&lt;|&gt; test\n          where\n              test :: EitherT ServantErr (ReaderT Int IO) String\n              test = lift $ giveMeAMessage\nFailed, modules loaded: none.\n</code></pre>\n\n<p>How can I get rid of the error?</p>\n\n<p>Followup question: I understand monad transformers generally, but I'm lost. What topics or links should I study to know enough to answer my own question? </p>\n"}, {"tags": ["haskell", "networking"], "answers": [{"comments": [{"owner": {"reputation": 489, "user_id": 3780993, "user_type": "registered", "accept_rate": 62, "profile_image": "https://www.gravatar.com/avatar/a9ad160badab2c6f405426f4e2a281fe?s=128&d=identicon&r=PG&f=1", "display_name": "ragesalmon", "link": "https://stackoverflow.com/users/3780993/ragesalmon"}, "edited": false, "score": 0, "creation_date": 1436412459, "post_id": 31282246, "comment_id": 50604252, "body": "I actually ended up using Data.Conduit.Network instead, but thank you for your suggestion!"}], "tags": [], "owner": {"reputation": 4565, "user_id": 1134885, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/7c428466054762cf7d4b5fb5f4396fa2?s=128&d=identicon&r=PG", "display_name": "NovaDenizen", "link": "https://stackoverflow.com/users/1134885/novadenizen"}, "is_accepted": false, "score": 1, "last_activity_date": 1436320582, "last_edit_date": 1436320582, "creation_date": 1436320272, "answer_id": 31282246, "question_id": 31279673, "link": "https://stackoverflow.com/questions/31279673/reading-from-a-socket-while-keeping-the-connection-open/31282246#31282246", "title": "Reading from a Socket while keeping the connection open", "body": "<p><code>hGet</code> keeps trying to read until it has as many bytes as you asked for, namely 1024.  You probably want to use <a href=\"https://hackage.haskell.org/package/bytestring-0.9.2.1/docs/Data-ByteString-Lazy.html#v:hGetNonBlocking\" rel=\"nofollow\"><code>hGetNonBlocking</code></a> instead.  Or something like:</p>\n\n<pre><code>do\n    r1 &lt;- BSL.hGet h 1\n    rRest &lt;- BSL.hGetNonBlocking h 1024\n    return (r1 BS.append rRest)\n</code></pre>\n"}], "owner": {"reputation": 489, "user_id": 3780993, "user_type": "registered", "accept_rate": 62, "profile_image": "https://www.gravatar.com/avatar/a9ad160badab2c6f405426f4e2a281fe?s=128&d=identicon&r=PG&f=1", "display_name": "ragesalmon", "link": "https://stackoverflow.com/users/3780993/ragesalmon"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 114, "favorite_count": 0, "answer_count": 1, "score": 0, "last_activity_date": 1436320582, "creation_date": 1436304755, "question_id": 31279673, "link": "https://stackoverflow.com/questions/31279673/reading-from-a-socket-while-keeping-the-connection-open", "title": "Reading from a Socket while keeping the connection open", "body": "<p>currently I have some code which creates a server and a client for some testing purposes.</p>\n\n<p>Server code</p>\n\n<pre><code>import Network.Socket\nimport Network.Socket.ByteString as NSB\nimport Network.Socket.ByteString.Lazy as NSBL\nimport Data.ByteString.Lazy as BSL\nimport Data.ByteString as BS\nimport Data.HashMap as HM\nimport System.IO as IO\n\nmain = withSocketsDo $ do\n  sock &lt;- socket AF_INET Stream 0\n  setSocketOption sock ReuseAddr 1\n  bindSocket sock (SockAddrInet (fromInteger 8585) iNADDR_ANY)\n  listen sock 100\n  servLoop sock\n\nservLoop sock = do\n  client = accept sock\n  IO.putStrLn \"Got a connection\"\n  h &lt;- SocketToHandle client ReadWriteMode\n  hSetBuffering h NoBuffering\n  req &lt;- BSL.hGet h 1024\n  IO.putStrLn \"Got some contents:\"\n  IO.putStrLn $ show req\n</code></pre>\n\n<p>Client Code</p>\n\n<pre><code>import Network.Socket\nimport Network.BSD\nimport Control.Monad\nimport System.IO as IO\nimport Data.Text as T\nimport Data.ByteString.Lazy as BSL\nimport Data.MessagePack as MP\n\nmain = withSocketsDo $ do\n  sock &lt;- socket AF_INET Stream 0\n  setSocketOption sock ReuseAddr 1\n  addr &lt;- liftM hostAddresses $ getHostByName \"localhost\"\n  connect sock $ SockAddrInet (fromInteger 8585) (Prelude.head addr)\n  handle &lt;- socketToHandle sock ReadWriteMode\n  replicateM_ 5 $ BSL.hPut handle $ MP.pack (\"Hello host\" :: Text)\n  hFlush handle\n  getLine\n  replicateM_ 5 $ BSL.hPut handle $ MP.pack (\"Hello host\" :: Text)\n  hFlush handle\n  hClose handle\n</code></pre>\n\n<p>The observed behaviour is that the message is not sent until hClose handle is called on the client side. However, I would like to keep the handle open for sending more requests and receiving responses rapidly. Am I going about this the right way? And if so, is there a way to keep the handle open but read and write the socket?</p>\n"}, {"tags": ["haskell"], "comments": [{"owner": {"reputation": 126897, "user_id": 791604, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/ce991df7a056248d5e4f6fc3659ba733?s=128&d=identicon&r=PG", "display_name": "Daniel Wagner", "link": "https://stackoverflow.com/users/791604/daniel-wagner"}, "edited": false, "score": 0, "creation_date": 1436298708, "post_id": 31277718, "comment_id": 50549915, "body": "Can you use <code>cabal -v</code> to find out which program is running when these messages are printed?"}, {"owner": {"reputation": 13920, "user_id": 371228, "user_type": "registered", "accept_rate": 96, "profile_image": "https://www.gravatar.com/avatar/a4028c5dd749d198d7a8f2601d4afe07?s=128&d=identicon&r=PG", "display_name": "bdesham", "link": "https://stackoverflow.com/users/371228/bdesham"}, "reply_to_user": {"reputation": 126897, "user_id": 791604, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/ce991df7a056248d5e4f6fc3659ba733?s=128&d=identicon&r=PG", "display_name": "Daniel Wagner", "link": "https://stackoverflow.com/users/791604/daniel-wagner"}, "edited": false, "score": 0, "creation_date": 1436299067, "post_id": 31277718, "comment_id": 50550124, "body": "@DanielWagner I tried <code>cabal -v2</code> and it doesn\u2019t show anything more than what I posted; right after that it says \u201cBuilding C Sources\u2026\u201d."}, {"owner": {"reputation": 14485, "user_id": 190376, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/cd8280c5e1491b8cf55760750ed97dec?s=128&d=identicon&r=PG", "display_name": "Reid Barton", "link": "https://stackoverflow.com/users/190376/reid-barton"}, "edited": false, "score": 0, "creation_date": 1436334361, "post_id": 31277718, "comment_id": 50561174, "body": "Maybe <code>-optl--enable-stdcall-fixup</code> or <code>-optl-Wl,--enable-stdcall-fixup</code> (depending on how ghc works on Windows)."}, {"owner": {"reputation": 13920, "user_id": 371228, "user_type": "registered", "accept_rate": 96, "profile_image": "https://www.gravatar.com/avatar/a4028c5dd749d198d7a8f2601d4afe07?s=128&d=identicon&r=PG", "display_name": "bdesham", "link": "https://stackoverflow.com/users/371228/bdesham"}, "reply_to_user": {"reputation": 14485, "user_id": 190376, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/cd8280c5e1491b8cf55760750ed97dec?s=128&d=identicon&r=PG", "display_name": "Reid Barton", "link": "https://stackoverflow.com/users/190376/reid-barton"}, "edited": false, "score": 0, "creation_date": 1436367033, "post_id": 31277718, "comment_id": 50583083, "body": "@ReidBarton Adding <code>-optl-Wl,--enable-stdcall-fixup</code> to the <code>ghc-options</code> worked, thanks! Can you post that as an answer?"}], "answers": [{"tags": [], "owner": {"reputation": 14485, "user_id": 190376, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/cd8280c5e1491b8cf55760750ed97dec?s=128&d=identicon&r=PG", "display_name": "Reid Barton", "link": "https://stackoverflow.com/users/190376/reid-barton"}, "is_accepted": true, "score": 2, "last_activity_date": 1436454406, "creation_date": 1436454406, "answer_id": 31321426, "question_id": 31277718, "link": "https://stackoverflow.com/questions/31277718/how-do-i-invoke-the-enable-stdcall-fixup-option/31321426#31321426", "title": "How do I invoke the \u201c--enable-stdcall-fixup\u201d option?", "body": "<p>Googling indicates that <code>--enable-stdcall-fixup</code> is an option to ld. There are a few different pathways by which cabal's final link step can happen, but in your case it is apparently</p>\n\n<pre><code>Cabal -&gt; ghc (link step) -&gt; gcc -&gt; ld\n</code></pre>\n\n<p>so to match this you must specify</p>\n\n<pre><code>ghc-options: -optl-Wl,--enable-stdcall-fixup\n</code></pre>\n"}], "owner": {"reputation": 13920, "user_id": 371228, "user_type": "registered", "accept_rate": 96, "profile_image": "https://www.gravatar.com/avatar/a4028c5dd749d198d7a8f2601d4afe07?s=128&d=identicon&r=PG", "display_name": "bdesham", "link": "https://stackoverflow.com/users/371228/bdesham"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 1276, "favorite_count": 0, "accepted_answer_id": 31321426, "answer_count": 1, "score": 4, "last_activity_date": 1436454406, "creation_date": 1436297588, "last_edit_date": 1436298212, "question_id": 31277718, "link": "https://stackoverflow.com/questions/31277718/how-do-i-invoke-the-enable-stdcall-fixup-option", "title": "How do I invoke the \u201c--enable-stdcall-fixup\u201d option?", "body": "<p>While building a DLL under Windows I get the following output:</p>\n\n<pre><code>Linking main.exe ...\nWarning: resolving _findPeaksWrapper by linking to _findPeaksWrapper@16\nUse --enable-stdcall-fixup to disable these warnings\nCreating library file: HSdll.dll.a\nUse --disable-stdcall-fixup to disable these fixups\n</code></pre>\n\n<p>It\u2019s not clear to me where I should be placing the <code>--enable-stdcall-fixup</code> flag. Putting it into the <code>ghc-options</code> field of my .cabal file gives a GHC error, while putting it into <code>cc-options</code> or <code>ld-options</code> seems not to do anything (the warnings are still displayed). Where should this flag go?</p>\n"}, {"tags": ["haskell"], "answers": [{"tags": [], "owner": {"reputation": 7575, "user_id": 663299, "user_type": "registered", "accept_rate": 91, "profile_image": "https://www.gravatar.com/avatar/f3a117b27e019d6d19b46698a21c8a11?s=128&d=identicon&r=PG", "display_name": "mhwombat", "link": "https://stackoverflow.com/users/663299/mhwombat"}, "is_accepted": false, "score": 15, "last_activity_date": 1436290208, "creation_date": 1436290208, "answer_id": 31275505, "question_id": 31275366, "link": "https://stackoverflow.com/questions/31275366/using-when-unless-without-saving-the-result-of-a-monadic-action/31275505#31275505", "title": "Using when/unless without saving the result of a Monadic action", "body": "<p>In <code>Control.Monad.Extra</code>, check out <code>whenM</code>. For your example, that would be:</p>\n\n<pre><code>foo = whenM (checker bar) doStuff\n</code></pre>\n\n<p>Here's a longer example, just to show you how to multiple statements in your <code>whenM</code> structure.</p>\n\n<pre><code>foo = do\n  doStuff1\n  doStuff2\n  whenM (checker bar) $ do\n    doStuff3\n    doStuff4\n    doStuff5\n  doStuff6\n</code></pre>\n"}, {"tags": [], "owner": {"reputation": 75362, "user_id": 625403, "user_type": "registered", "accept_rate": 82, "profile_image": "https://www.gravatar.com/avatar/786eed7da67079cb5d63a49d469af25b?s=128&d=identicon&r=PG", "display_name": "amalloy", "link": "https://stackoverflow.com/users/625403/amalloy"}, "is_accepted": true, "score": 10, "last_activity_date": 1436295436, "creation_date": 1436295436, "answer_id": 31277096, "question_id": 31275366, "link": "https://stackoverflow.com/questions/31275366/using-when-unless-without-saving-the-result-of-a-monadic-action/31277096#31277096", "title": "Using when/unless without saving the result of a Monadic action", "body": "<p>The most straightforward answer is to desugar the <code>do</code> by hand, and then see if you can write some code that's equivalent but prettier. Your <code>do</code> desugars to:</p>\n\n<pre><code>checker bar &gt;&gt;= \\x -&gt; when x dostuff\n</code></pre>\n\n<p>So, the answer will have to look like <code>checker bar &gt;&gt;= f</code>, where <code>f</code> is equivalent to </p>\n\n<pre><code>\\x -&gt; when x dostuff\n</code></pre>\n\n<p>Well, that's a lot like partially applying <code>when</code>, right? Except you want to supply the second argument instead of the first, so you need to <code>flip</code> it:</p>\n\n<pre><code>checker bar &gt;&gt;= flip when dostuff\n</code></pre>\n"}], "owner": {"reputation": 790, "user_id": 334632, "user_type": "registered", "accept_rate": 94, "profile_image": "https://i.stack.imgur.com/SL2Mb.jpg?s=128&g=1", "display_name": "Joe Hillenbrand", "link": "https://stackoverflow.com/users/334632/joe-hillenbrand"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 130, "favorite_count": 0, "accepted_answer_id": 31277096, "answer_count": 2, "score": 8, "last_activity_date": 1436295436, "creation_date": 1436289748, "question_id": 31275366, "link": "https://stackoverflow.com/questions/31275366/using-when-unless-without-saving-the-result-of-a-monadic-action", "title": "Using when/unless without saving the result of a Monadic action", "body": "<p>Is there a way to write this without the variable <code>x</code>?</p>\n\n<pre><code>foo = do\n  x &lt;- checker bar\n  when x dostuff\n</code></pre>\n\n<p>I'm imagining something similar to LambdaCase:</p>\n\n<pre><code>foo' = do\n  checker bar &gt;&gt;= \\case\n    True -&gt; dostuff\n    _    -&gt; return ()\n</code></pre>\n\n<p>but without the second case pattern, obviously.</p>\n"}, {"tags": ["haskell"], "comments": [{"owner": {"reputation": 13734, "user_id": 938694, "user_type": "registered", "accept_rate": 59, "profile_image": "https://www.gravatar.com/avatar/b6678a430a805dd78366d6e135b49f2d?s=128&d=identicon&r=PG", "display_name": "Cubic", "link": "https://stackoverflow.com/users/938694/cubic"}, "edited": false, "score": 0, "creation_date": 1436290567, "post_id": 31275339, "comment_id": 50545166, "body": "This isn&#39;t so much about optimization, as it is about termination. Your code <i>is</i> extremely inefficient, but before that it doesn&#39;t terminate."}], "answers": [{"tags": [], "owner": {"reputation": 13734, "user_id": 938694, "user_type": "registered", "accept_rate": 59, "profile_image": "https://www.gravatar.com/avatar/b6678a430a805dd78366d6e135b49f2d?s=128&d=identicon&r=PG", "display_name": "Cubic", "link": "https://stackoverflow.com/users/938694/cubic"}, "is_accepted": true, "score": 3, "last_activity_date": 1436290520, "creation_date": 1436290520, "answer_id": 31275615, "question_id": 31275339, "link": "https://stackoverflow.com/questions/31275339/haskell-list-comprehension-optimization/31275615#31275615", "title": "haskell list comprehension optimization", "body": "<p>No, this will never return. Haskell has non-strict semantics, so a compliant implementation doesn't need to evaluate parts of an expression that are unused; However it is not a theorem prover. The runtime system does not attempt to prove that there can't be any larger number in your list. Instead, when your expression is evaluated <code>max</code> <em>will</em> have to look at every single item in your list to determine its maximum value. Which is going to be a problem, because per what I said above, your list can never be determined to be done (because the source list is infinite, there's always more elements that are potentially included in your list expression).</p>\n\n<p>What you need here is <code>takeWhile</code> followed by <code>filter</code> before your max.</p>\n\n<p>Also, I probably don't need to point this out but your primes method is incredibly inefficient and will take a <em>really</em> long time to generate numbers as high as you seem to need for this problem.</p>\n"}], "owner": {"reputation": 865, "user_id": 3694032, "user_type": "registered", "accept_rate": 82, "profile_image": "https://www.gravatar.com/avatar/32d8fabde29edf207ac92275275af90a?s=128&d=identicon&r=PG&f=1", "display_name": "rem", "link": "https://stackoverflow.com/users/3694032/rem"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 100, "favorite_count": 0, "accepted_answer_id": 31275615, "answer_count": 1, "score": 1, "last_activity_date": 1436290520, "creation_date": 1436289678, "question_id": 31275339, "link": "https://stackoverflow.com/questions/31275339/haskell-list-comprehension-optimization", "title": "haskell list comprehension optimization", "body": "<p>I have a piece of code written for project euler: </p>\n\n<pre><code>primes :: [Integer]\nprimes = filter isPrime [2..]\n    where isPrime n = not $ any (\\x -&gt; n `mod` x == 0) [2..n-1]\n\nans = max [x | x &lt;- primes, 600851475143 `mod` x == 0]\n</code></pre>\n\n<p>Of course I didn't wait for it to terminate. But I'm wondering will it ever return? I guess it depends on whether haskell knows to stop at 600851475143?</p>\n"}, {"tags": ["haskell", "emacs", "haskell-mode"], "answers": [{"tags": [], "owner": {"reputation": 1421, "user_id": 814846, "user_type": "registered", "accept_rate": 79, "profile_image": "https://www.gravatar.com/avatar/92d418d6934ed583bab89df95974b6bf?s=128&d=identicon&r=PG", "display_name": "haroldcarr", "link": "https://stackoverflow.com/users/814846/haroldcarr"}, "is_accepted": false, "score": 2, "last_activity_date": 1436290135, "creation_date": 1436290135, "answer_id": 31275478, "question_id": 31274733, "link": "https://stackoverflow.com/questions/31274733/haskell-and-emacs/31275478#31275478", "title": "Haskell and Emacs", "body": "<p>You need to add</p>\n\n<pre><code>(require 'haskell-mode-autoloads)\n</code></pre>\n"}, {"tags": [], "owner": {"reputation": 63, "user_id": 3928303, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/89f1e801413c6845075db4a2ad39ed25?s=128&d=identicon&r=PG&f=1", "display_name": "Greg", "link": "https://stackoverflow.com/users/3928303/greg"}, "is_accepted": false, "score": 0, "last_activity_date": 1491378885, "creation_date": 1491378885, "answer_id": 43225153, "question_id": 31274733, "link": "https://stackoverflow.com/questions/31274733/haskell-and-emacs/43225153#43225153", "title": "Haskell and Emacs", "body": "<p>I was getting the same error when trying to run</p>\n\n<pre><code>(define-key haskell-mode-map [f8] 'haskell-navigate-imports)\n</code></pre>\n\n<p>in .emacs</p>\n\n<p>But using eval-after-load fixed it. I couldn't get the require to work. YMMV</p>\n\n<pre><code>(eval-after-load 'haskell-mode\n      '(define-key haskell-mode-map [f8] 'haskell-navigate-imports))\n</code></pre>\n"}], "owner": {"reputation": 9567, "user_id": 1900722, "user_type": "registered", "accept_rate": 70, "profile_image": "https://i.stack.imgur.com/nGsJr.jpg?s=128&g=1", "display_name": "anquegi", "link": "https://stackoverflow.com/users/1900722/anquegi"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 700, "favorite_count": 0, "answer_count": 2, "score": 2, "last_activity_date": 1491378885, "creation_date": 1436287749, "last_edit_date": 1436342691, "question_id": 31274733, "link": "https://stackoverflow.com/questions/31274733/haskell-and-emacs", "title": "Haskell and Emacs", "body": "<p>I'm trying to learn Haskell. I have configured Emacs for Haskell development, I followed this blog post:</p>\n\n<p><a href=\"http://tim.dysinger.net/posts/2014-02-18-haskell-with-emacs.html\" rel=\"nofollow\">http://tim.dysinger.net/posts/2014-02-18-haskell-with-emacs.html</a></p>\n\n<p>The system works but I always get this error:</p>\n\n<blockquote>\n  <p>Error (el-get): while initializing haskell-mode: Symbol's value as variable is void: haskell-mode-map</p>\n</blockquote>\n\n<p>I looked up the files and the variable is defined, I do not know why this is happening. </p>\n"}, {"tags": ["haskell", "recursion"], "comments": [{"owner": {"reputation": 641, "user_id": 3861396, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/7c5461c6b9136f38ca27541a6b45a6cc?s=128&d=identicon&r=PG&f=1", "display_name": "2016rshah", "link": "https://stackoverflow.com/users/3861396/2016rshah"}, "edited": false, "score": 0, "creation_date": 1436281315, "post_id": 31272099, "comment_id": 50538865, "body": "Do you want the code used to define the <code>interleave</code> method?"}], "answers": [{"tags": [], "owner": {"reputation": 796, "user_id": 2337954, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/6ac2ebcf2a09563be6eceb2d36a9f531?s=128&d=identicon&r=PG", "display_name": "mniip", "link": "https://stackoverflow.com/users/2337954/mniip"}, "is_accepted": true, "score": 3, "last_activity_date": 1436281489, "creation_date": 1436281489, "answer_id": 31272398, "question_id": 31272099, "link": "https://stackoverflow.com/questions/31272099/haskell-recursion-interleave-function-in-programming-in-haskell-ch-11/31272398#31272398", "title": "Haskell Recursion: interleave function in Programming in Haskell ch.11", "body": "<p>Between lines two and three you miss something:</p>\n\n<pre class=\"lang-haskell prettyprint-override\"><code>[3,4,5,6,7]:map (4:) (interleave 3 [5,6,7])\n= [3,4,5,6,7]:map (4:) ([3,5,6,7]:map (5:) (interleave 3 [6,7]))\n= [3,4,5,6,7]:[4,3,5,6,7]:map (4:) (map (5:) (interleave 3 [6,7]))\n</code></pre>\n\n<p>So at the end you have a bunch of <code>map (x:)</code> and all all lists contain all the elements of the original list</p>\n"}], "owner": {"reputation": 25, "user_id": 5089983, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/185d75f8cd264c969acebf8cfeb65ad7?s=128&d=identicon&r=PG&f=1", "display_name": "hsforever", "link": "https://stackoverflow.com/users/5089983/hsforever"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 168, "favorite_count": 0, "accepted_answer_id": 31272398, "answer_count": 1, "score": 2, "last_activity_date": 1436281489, "creation_date": 1436280768, "last_edit_date": 1436281124, "question_id": 31272099, "link": "https://stackoverflow.com/questions/31272099/haskell-recursion-interleave-function-in-programming-in-haskell-ch-11", "title": "Haskell Recursion: interleave function in Programming in Haskell ch.11", "body": "<p>I cannot figure out how the recursive mechanism for the following 'interleave' function in Programming in Haskell Ch.11 works.</p>\n\n<pre><code>-- Definition\ninterleave :: a -&gt; [a] -&gt; [[a]]\ninterleave a [] = [[a]]\ninterleave x (y:ys) = (x:y:ys):map (y:) (interleave x ys)\n\n-- Example\n&gt; interleave 3 [4,5,6,7]\n[[3,4,5,6,7],[4,3,5,6,7],[4,5,3,6,7],[4,5,6,3,7],[4,5,6,7,3]]\n</code></pre>\n\n<p>How does it work under the hood?</p>\n\n<p>I am stuck at reasoning like this:   </p>\n\n<pre><code>interleave 3 [4,5,6,7]\n= [3,4,5,6,7]:map (4:) (interleave 3 [5,6,7])\n= [3,4,5,6,7]:[4,3,5,6,7]:map (5:) (interleave 3 [6,7])\n= [3,4,5,6,7]:[4,3,5,6,7]:[5,3,6,7]:map (6:) (interleave 3 [7])\n= [3,4,5,6,7]:[4,3,5,6,7]:[5,3,6,7]:[6,3,7]:map (7:) (interleave 3 [])\n= [3,4,5,6,7]:[4,3,5,6,7]:[5,3,6,7]:[6,3,7]:[7,3]:[[3]]\n\n= [[3,4,5,6,7],[4,3,5,6,7],[5,3,6,7],[6,3,7],[7,3],[3]]\n???\n/= [[3,4,5,6,7],[4,3,5,6,7],[4,5,3,6,7],[4,5,6,3,7],[4,5,6,7,3]]\n</code></pre>\n\n<p>Please enlighten me.. Many thanks in advance.</p>\n"}, {"tags": ["haskell"], "answers": [{"tags": [], "owner": {"reputation": 49959, "user_id": 866915, "user_type": "registered", "accept_rate": 70, "profile_image": "https://www.gravatar.com/avatar/09242131d6e17cbbe31e8547514da6e5?s=128&d=identicon&r=PG", "display_name": "ErikR", "link": "https://stackoverflow.com/users/866915/erikr"}, "is_accepted": true, "score": 2, "last_activity_date": 1436261491, "creation_date": 1436261491, "answer_id": 31264846, "question_id": 31264234, "link": "https://stackoverflow.com/questions/31264234/parsing-a-http-post-request-using-ctor/31264846#31264846", "title": "Parsing a http Post request using ctor, &lt;$", "body": "<p>Specific examples of the expression <code>ctor &lt;$ string name &lt;* char ' '</code> are:</p>\n\n<pre><code>Get &lt;$ string \"GET\" &lt;* char ' '\n</code></pre>\n\n<p>and</p>\n\n<pre><code>Post &lt;$ string \"POST\" &lt;* char ' '\n</code></pre>\n\n<p><code>Get</code> and <code>Post</code> are constructors for the GET and POST HTTP verbs. They probably come from a data definition like:</p>\n\n<pre><code>data HttpVerb = Get | Post | Head | ...\n</code></pre>\n\n<p>The <code>&lt;$</code> operator is defined to be <code>fmap . const</code> (see <a href=\"http://hackage.haskell.org/package/base4.8.0.0/docs/Prelude.html#v:-60--36-\" rel=\"nofollow\">here</a>) and has type:</p>\n\n<pre><code>&lt;$ :: a -&gt; f b -&gt; f a\n</code></pre>\n\n<p>In other words, it simply wraps up <code>a</code> in the functor but after evaluating its second argument <code>f b</code>. Note that you normally see <code>&lt;$&gt;</code> used here and that the value <code>b</code> is ignored. The absence of the <code>&gt;</code> in the operator serves to indicate that the value to the right is ignored. Similarly for the <code>&lt;*</code> operator.</p>\n\n<p>So, the parser computation <code>Get &lt;$ string \"GET\" &lt;* char ' '</code> returns <code>f Get</code> (where <code>f</code> is the parser functor) but only if <code>string \"GET\"</code> and <code>char ' '</code> succeed.</p>\n\n<p>The equivalent monadic expression is:</p>\n\n<pre><code>do string \"GET\"; char ' '; return Get\n</code></pre>\n"}], "owner": {"user_type": "does_not_exist", "display_name": "user2879704"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 62, "favorite_count": 0, "accepted_answer_id": 31264846, "answer_count": 1, "score": 0, "last_activity_date": 1436261491, "creation_date": 1436259902, "question_id": 31264234, "link": "https://stackoverflow.com/questions/31264234/parsing-a-http-post-request-using-ctor", "title": "Parsing a http Post request using ctor, &lt;$", "body": "<pre><code>-- file: ch16/HttpRequestParser.hs\np_request :: CharParser () HttpRequest\np_request = q \"GET\" Get (pure Nothing)\n        &lt;|&gt; q \"POST\" Post (Just &lt;$&gt; many anyChar)\n  where q name ctor body = liftM4 HttpRequest req url p_headers body\n            where req = ctor &lt;$ string name &lt;* char ' '\n        url = optional (char '/') *&gt;\n              manyTill notEOL (try $ string \" HTTP/1.\" &lt;* oneOf \"01\")\n              &lt;* crlf\n</code></pre>\n\n<p>The above <a href=\"https://github.com/cyga/real-world-haskell/blob/master/ch16/HttpRequestParser.hs#L26\" rel=\"nofollow\">snippet</a> is meant for parsing a http request..</p>\n\n<p>variable <code>ctor</code> is seen on the left side and the right side,</p>\n\n<pre><code>q name ctor body = liftM4 HttpRequest req url p_headers body  --- ctor assigned a value\n       where req = ctor &lt;$ string name &lt;* char ' '            --- ctor used as a function\n</code></pre>\n\n<p>And the variable <code>name</code> is as well seen on LHS and RHS.</p>\n\n<p>And <code>&lt;$&gt;</code> maps all list elements to a constant value. In this context,</p>\n\n<pre><code>ctor &lt;$ string name &lt;* char ' '\n</code></pre>\n\n<p>what does it return?</p>\n"}, {"tags": ["haskell", "types", "naming-conventions"], "comments": [{"owner": {"reputation": 11366, "user_id": 3922954, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/76ba47d2fdd24ab56b0b273cce2075e5?s=128&d=identicon&r=PG&f=1", "display_name": "AJF", "link": "https://stackoverflow.com/users/3922954/ajf"}, "edited": false, "score": 1, "creation_date": 1436282267, "post_id": 31263331, "comment_id": 50539652, "body": "<code>String</code> is a type, <code>string</code> is a function."}], "answers": [{"tags": [], "owner": {"reputation": 69792, "user_id": 493122, "user_type": "registered", "accept_rate": 96, "profile_image": "https://www.gravatar.com/avatar/1f90ae01c2e24801c2df9189179b0ccd?s=128&d=identicon&r=PG", "display_name": "Shoe", "link": "https://stackoverflow.com/users/493122/shoe"}, "is_accepted": false, "score": 3, "last_activity_date": 1436257822, "creation_date": 1436257822, "answer_id": 31263517, "question_id": 31263331, "link": "https://stackoverflow.com/questions/31263331/string-vs-string-in-haskell/31263517#31263517", "title": "string vs String in haskell?", "body": "<p>One is <a href=\"http://hackage.haskell.org/package/base-4.8.0.0/docs/Prelude.html\" rel=\"nofollow\">a type</a>, the other is <a href=\"http://hackage.haskell.org/package/parsec-3.1.9/docs/Text-Parsec-Char.html\" rel=\"nofollow\">a function</a>.</p>\n"}, {"tags": [], "owner": {"reputation": 19480, "user_id": 2491900, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/W8FMW.jpg?s=128&g=1", "display_name": "shree.pat18", "link": "https://stackoverflow.com/users/2491900/shree-pat18"}, "is_accepted": false, "score": 5, "last_activity_date": 1436258311, "last_edit_date": 1436258311, "creation_date": 1436257910, "answer_id": 31263551, "question_id": 31263331, "link": "https://stackoverflow.com/questions/31263331/string-vs-string-in-haskell/31263551#31263551", "title": "string vs String in haskell?", "body": "<p>Looks like <code>string</code> is the function from <code>Text.Parsec.Char</code> while <code>String</code> is the usual Type.</p>\n\n<p>In fact, in the same chapter of <a href=\"http://book.realworldhaskell.org/read/using-parsec.html\" rel=\"nofollow\">RealWorldHaskell</a>, this function is explicitly mentioned under 'Choices and Errors;:</p>\n\n<blockquote>\n  <p>This must be done carefully. Recall that our earlier definition of eol was simply char '\\n'. There is a parser called string that we can use to match the multi-character patterns. Let's start by thinking of how we would add support for \\n\\r</p>\n</blockquote>\n"}, {"comments": [{"owner": {"reputation": 44013, "user_id": 1477667, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/trgKM.jpg?s=128&g=1", "display_name": "dfeuer", "link": "https://stackoverflow.com/users/1477667/dfeuer"}, "edited": false, "score": 0, "creation_date": 1436328146, "post_id": 31263650, "comment_id": 50559279, "body": "You probably shouldn&#39;t use the name <code>Void</code> as you have. That&#39;s a common name for the canonical uninhabited type. See, for example, <code>Data.Void</code>."}], "tags": [], "owner": {"reputation": 84731, "user_id": 510937, "user_type": "registered", "accept_rate": 80, "profile_image": "https://www.gravatar.com/avatar/70b13a9ae1aae1ca1aa6ac8dab4643f2?s=128&d=identicon&r=PG", "display_name": "Bakuriu", "link": "https://stackoverflow.com/users/510937/bakuriu"}, "is_accepted": true, "score": 9, "last_activity_date": 1436336100, "last_edit_date": 1436336100, "creation_date": 1436258179, "answer_id": 31263650, "question_id": 31263331, "link": "https://stackoverflow.com/questions/31263331/string-vs-string-in-haskell/31263650#31263650", "title": "string vs String in haskell?", "body": "<p>In Haskell <em>value and type variable names</em> start with a lower-case letter while <em>value and type constructor names, type synonyms, and classes</em> start with a capital letter. For example:</p>\n\n<pre><code>data Tree a = Empty\n            | Node a (Tree a) (Tree a)\n\nheight Empty = 0\nheight (Node _ l r) = max (height l) (height r) + 1\n</code></pre>\n\n<p>Note that <code>Tree</code> is a type constructor name, <code>Empty</code> and <code>Node</code> are value constructor names and <code>height</code> is a function name. In your case <code>String</code> is the name of the type \"string\" which is simply a synonym for <code>[Char]</code>, while <code>string</code> is a function.</p>\n"}], "owner": {"user_type": "does_not_exist", "display_name": "user2879704"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 150, "favorite_count": 0, "accepted_answer_id": 31263650, "answer_count": 3, "score": 2, "last_activity_date": 1436336100, "creation_date": 1436257275, "last_edit_date": 1436302397, "question_id": 31263331, "link": "https://stackoverflow.com/questions/31263331/string-vs-string-in-haskell", "title": "string vs String in haskell?", "body": "<p>For type declarations as <a href=\"https://github.com/cyga/real-world-haskell/blob/master/ch16/HttpRequestParser.hs#L21\" rel=\"nofollow\">here</a>, <code>String</code> is used:</p>\n\n<pre><code>p_pair :: CharParser () (String, Maybe String)\n</code></pre>\n\n<p>And in some other places as <a href=\"https://github.com/cyga/real-world-haskell/blob/master/ch16/HttpRequestParser.hs#L31\" rel=\"nofollow\">here</a>, <code>string</code> is used:</p>\n\n<pre><code>req = ctor &lt;$ string name &lt;* char ' '\n</code></pre>\n\n<p>Note the capitalization difference between <code>String</code> and <code>string</code></p>\n\n<p>What is the difference between <code>String</code> and <code>string</code> in Haskell?</p>\n"}, {"tags": ["haskell", "types"], "answers": [{"comments": [{"owner": {"reputation": 1593, "user_id": 2287402, "user_type": "registered", "accept_rate": 78, "profile_image": "https://i.stack.imgur.com/Q5Rvg.png?s=128&g=1", "display_name": "Elie G&#233;nard", "link": "https://stackoverflow.com/users/2287402/elie-g%c3%a9nard"}, "edited": false, "score": 0, "creation_date": 1436256225, "post_id": 31262602, "comment_id": 50521254, "body": "You are using the package <a href=\"https://hackage.haskell.org/package/simple-vec3-0.1.0.1\" rel=\"nofollow noreferrer\">simple-vec3</a> but I want to use <a href=\"https://hackage.haskell.org/package/Vec\" rel=\"nofollow noreferrer\">Vec</a>. The problem is that I can construct a <code>V.Vec3F</code> directly like this: <code>V.Vec3F 3 5 2</code> whereas it doesn&#39;t work with my own <code>Vec3</code> defined as <code>type Vec3 = V.Vec3F</code>."}, {"owner": {"reputation": 51584, "user_id": 839246, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/9b0573c2b936b12828dd1e4cc04206dc?s=128&d=identicon&r=PG&f=1", "display_name": "bheklilr", "link": "https://stackoverflow.com/users/839246/bheklilr"}, "reply_to_user": {"reputation": 1593, "user_id": 2287402, "user_type": "registered", "accept_rate": 78, "profile_image": "https://i.stack.imgur.com/Q5Rvg.png?s=128&g=1", "display_name": "Elie G&#233;nard", "link": "https://stackoverflow.com/users/2287402/elie-g%c3%a9nard"}, "edited": false, "score": 1, "creation_date": 1436272099, "post_id": 31262602, "comment_id": 50531550, "body": "@ElieGnrd Your <code>Vec3</code> is not a data constructor, only a type constructor.  You can&#39;t construct values with it at all.  If I say that <code>type IntList = [Int]</code>, I still have to use the data constructors for <code>[Int]</code> to construct something of type <code>IntList</code> because it&#39;s just an alias.  Another example would be <code>type Environment = Data.Map.Map String String</code>, I can have a value of type <code>Environment</code>, but it&#39;s indistinguishable from a value of type <code>Data.Map.Map String String</code> and either can be used in the other&#39;s place.  It&#39;s just another name for the same type, nothing more."}, {"owner": {"reputation": 1593, "user_id": 2287402, "user_type": "registered", "accept_rate": 78, "profile_image": "https://i.stack.imgur.com/Q5Rvg.png?s=128&g=1", "display_name": "Elie G&#233;nard", "link": "https://stackoverflow.com/users/2287402/elie-g%c3%a9nard"}, "edited": false, "score": 0, "creation_date": 1436275425, "post_id": 31262602, "comment_id": 50534098, "body": "Thanks! That made me understand some things."}], "tags": [], "owner": {"reputation": 39903, "user_id": 128645, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/3697685173ba67283f38ba931bd71f8c?s=128&d=identicon&r=PG", "display_name": "Jeff Foster", "link": "https://stackoverflow.com/users/128645/jeff-foster"}, "is_accepted": true, "score": 1, "last_activity_date": 1436254949, "creation_date": 1436254949, "answer_id": 31262602, "question_id": 31262201, "link": "https://stackoverflow.com/questions/31262201/wrap-data-vec-types/31262602#31262602", "title": "Wrap Data.Vec types", "body": "<p><code>Vec3</code> is not a data constructor, it's a <a href=\"https://hackage.haskell.org/package/simple-vec3-0.1.0.1/docs/Data-Vec3.html\" rel=\"nofollow\">type</a> (in this case, a <code>class</code>).  Perhaps you could wrap your own wrapper around the constructor to achieve what you want?</p>\n\n<pre><code>makeVec :: (Double,Double,Double) -&gt; Vec3\nmakeVec = V.fromXYZ -- TODO some float mangling\n</code></pre>\n"}], "owner": {"reputation": 1593, "user_id": 2287402, "user_type": "registered", "accept_rate": 78, "profile_image": "https://i.stack.imgur.com/Q5Rvg.png?s=128&g=1", "display_name": "Elie G&#233;nard", "link": "https://stackoverflow.com/users/2287402/elie-g%c3%a9nard"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 49, "favorite_count": 0, "accepted_answer_id": 31262602, "answer_count": 1, "score": 2, "last_activity_date": 1436254949, "creation_date": 1436253656, "question_id": 31262201, "link": "https://stackoverflow.com/questions/31262201/wrap-data-vec-types", "title": "Wrap Data.Vec types", "body": "<p>I'd like to wrap some of the types of <code>Data.Vec</code> in my own types but it doesn't seem to work. For example, I'd like to have my own <code>Vec3</code> that would be a <code>Vec3F</code> so I did something like this:</p>\n\n<p><strong>Types.h</strong>:</p>\n\n<pre><code>module Types\n( Vec3(..)\n) where\n\nimport qualified Data.Vec as V\n\ntype Vec3 = V.Vec3 Float \n</code></pre>\n\n<p><strong>Main.hs</strong>:</p>\n\n<pre><code>import Types\n\nvect :: Vec3\nvect = Vec3 3 2 4\n\nmain = return ()\n</code></pre>\n\n<p>GHC complains and gives me this error:</p>\n\n<pre><code>Main.hs:4:8: Not in scope: data constructor `Vec3'\n</code></pre>\n\n<p>Is it because my new type has the same name as a type of <code>Data.Vec</code> despite the fact that I did a qualified import?</p>\n\n<p>If so is there way of doing this without changing the name of my type?</p>\n\n<p>If not, how can I export from my <code>Types</code> module only some types of <code>Data.Vec</code>?</p>\n"}, {"tags": ["haskell", "io-monad", "alternative-functor"], "comments": [{"owner": {"reputation": 15004, "user_id": 562906, "user_type": "registered", "accept_rate": 60, "profile_image": "https://www.gravatar.com/avatar/7a15f15ed0023f4177a518b6c15ca4b6?s=128&d=identicon&r=PG", "display_name": "sinelaw", "link": "https://stackoverflow.com/users/562906/sinelaw"}, "edited": false, "score": 2, "creation_date": 1436255472, "post_id": 31261905, "comment_id": 50520830, "body": "What are you trying to achieve with that <code>&lt;|&gt;</code>?"}, {"owner": {"reputation": 7296, "user_id": 324315, "user_type": "registered", "accept_rate": 66, "profile_image": "https://www.gravatar.com/avatar/fbb413736c6866ac28a73a44ab56c6b5?s=128&d=identicon&r=PG&f=1", "display_name": "Randomize", "link": "https://stackoverflow.com/users/324315/randomize"}, "reply_to_user": {"reputation": 15004, "user_id": 562906, "user_type": "registered", "accept_rate": 60, "profile_image": "https://www.gravatar.com/avatar/7a15f15ed0023f4177a518b6c15ca4b6?s=128&d=identicon&r=PG", "display_name": "sinelaw", "link": "https://stackoverflow.com/users/562906/sinelaw"}, "edited": false, "score": 0, "creation_date": 1436255767, "post_id": 31261905, "comment_id": 50521008, "body": "If the first &quot;readFile&quot; fails for some reason (like file not found) move to the second one, basically a generic alternative to &quot;if exists then...else...&quot;. Although they look having same output (Bytestring) I think they need to &quot;inherit&quot; Alternative =&gt; in some way too."}], "answers": [{"comments": [{"owner": {"reputation": 7296, "user_id": 324315, "user_type": "registered", "accept_rate": 66, "profile_image": "https://www.gravatar.com/avatar/fbb413736c6866ac28a73a44ab56c6b5?s=128&d=identicon&r=PG&f=1", "display_name": "Randomize", "link": "https://stackoverflow.com/users/324315/randomize"}, "edited": false, "score": 0, "creation_date": 1436256603, "post_id": 31262928, "comment_id": 50521431, "body": "Thank for your hint. I am trying to avoid program flows by exception cos I would like to have a &quot;chain of &lt;|&gt;&quot; (or similar). Anyway as you stated it might be a problem with &quot;types&quot;."}], "tags": [], "owner": {"reputation": 153048, "user_id": 9204, "user_type": "registered", "accept_rate": 82, "profile_image": "https://www.gravatar.com/avatar/c79937a093ff9e963c563e22cd385f30?s=128&d=identicon&r=PG", "display_name": "Alexey Romanov", "link": "https://stackoverflow.com/users/9204/alexey-romanov"}, "is_accepted": false, "score": 2, "last_activity_date": 1436256024, "creation_date": 1436256024, "answer_id": 31262928, "question_id": 31261905, "link": "https://stackoverflow.com/questions/31261905/alternative-io-error-for/31262928#31262928", "title": "Alternative IO error for &lt;|&gt;", "body": "<p>The error just says that <code>IO</code> is not an instance of <code>Alternative</code> and so <code>&lt;|&gt;</code> is not defined for it, as you can see from <a href=\"https://downloads.haskell.org/~ghc/latest/docs/html/libraries/base/Control-Applicative.html#g:2\" rel=\"nofollow\">documentation</a>. Is your intended meaning \"try <code>B.readFile foo</code> and if it fails, use <code>simpleHttp bar</code> instead\"? If so, you can do </p>\n\n<pre><code>catch (B.readFile foo) (\\(_ :: SomeException) -&gt; simpleHttp bar)\n</code></pre>\n\n<p>(<code>catch</code> is from <a href=\"https://hackage.haskell.org/package/base-4.7.0.2/docs/Control-Exception.html#g:5\" rel=\"nofollow\"><code>Control.Exception</code></a>, and you should use <code>Data.ByteString.Strict</code> instead of <code>Lazy</code> to make sure exception gets thrown inside the scope of <code>catch</code>; you'll also need <code>ScopedTypeVariables</code> extension to write the above instead of something like <code>\\e -&gt; let _ = e :: SomeException in simpleHttp bar</code>).</p>\n"}, {"comments": [{"owner": {"reputation": 7296, "user_id": 324315, "user_type": "registered", "accept_rate": 66, "profile_image": "https://www.gravatar.com/avatar/fbb413736c6866ac28a73a44ab56c6b5?s=128&d=identicon&r=PG&f=1", "display_name": "Randomize", "link": "https://stackoverflow.com/users/324315/randomize"}, "edited": false, "score": 0, "creation_date": 1436259153, "post_id": 31263127, "comment_id": 50523010, "body": "Thank you. Trying to apply to a monad IO context doesn&#39;t sound good unless I execute first every single possible operation and combine the result after (weird way to manage indeterminism)"}, {"owner": {"reputation": 126897, "user_id": 791604, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/ce991df7a056248d5e4f6fc3659ba733?s=128&d=identicon&r=PG", "display_name": "Daniel Wagner", "link": "https://stackoverflow.com/users/791604/daniel-wagner"}, "edited": false, "score": 0, "creation_date": 1436291612, "post_id": 31263127, "comment_id": 50545799, "body": "Your questions don&#39;t necessarily sound unanswerable. <code>empty</code> can throw an exception, and failure can be defined as &quot;throws an exception&quot;. Perhaps things are a bit complicated with the modern exception mechanism, but probably &quot;throws one of these five types of exception&quot; is a pretty good answer, too. I believe there is even a <code>MonadPlus</code> instance for <code>IO</code> -- which has practically the same interface as <code>Alternative</code>."}, {"owner": {"reputation": 126897, "user_id": 791604, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/ce991df7a056248d5e4f6fc3659ba733?s=128&d=identicon&r=PG", "display_name": "Daniel Wagner", "link": "https://stackoverflow.com/users/791604/daniel-wagner"}, "edited": false, "score": 0, "creation_date": 1436291929, "post_id": 31263127, "comment_id": 50545971, "body": "(Quick update to keep myself honest: I looked in <code>base</code> all the way back to version <code>3</code>, and didn&#39;t find a <code>MonadPlus</code> instance for <code>IO</code>. So that part of my previous comment is wrong.)"}, {"owner": {"reputation": 1889, "user_id": 4540658, "user_type": "registered", "accept_rate": 88, "profile_image": "https://i.stack.imgur.com/9vCJz.jpg?s=128&g=1", "display_name": "Dannyu NDos", "link": "https://stackoverflow.com/users/4540658/dannyu-ndos"}, "edited": false, "score": 0, "creation_date": 1515490152, "post_id": 31263127, "comment_id": 83309140, "body": "According to Hackage, there&#39;ve been <code>instance Alternative IO</code> since <code>base</code> version 4.9.0.0. It seems <code>empty</code> just raises an error with message <code>&quot;mzero&quot;</code>. But what does <code>&lt;|&gt;</code> do?"}, {"owner": {"reputation": 15004, "user_id": 562906, "user_type": "registered", "accept_rate": 60, "profile_image": "https://www.gravatar.com/avatar/7a15f15ed0023f4177a518b6c15ca4b6?s=128&d=identicon&r=PG", "display_name": "sinelaw", "link": "https://stackoverflow.com/users/562906/sinelaw"}, "reply_to_user": {"reputation": 1889, "user_id": 4540658, "user_type": "registered", "accept_rate": 88, "profile_image": "https://i.stack.imgur.com/9vCJz.jpg?s=128&g=1", "display_name": "Dannyu NDos", "link": "https://stackoverflow.com/users/4540658/dannyu-ndos"}, "edited": false, "score": 1, "creation_date": 1517150165, "post_id": 31263127, "comment_id": 83967770, "body": "@DannyuNDos - according to the source,  <code>a &lt;|&gt; b</code> will run <code>a</code> and if it throws an exception, swallows the exception and runs <code>b</code>: <a href=\"https://hackage.haskell.org/package/base-4.10.1.0/docs/src/GHC.IO.html#mplusIO\" rel=\"nofollow noreferrer\">hackage.haskell.org/package/base-4.10.1.0/docs/src/&hellip;</a>"}], "tags": [], "owner": {"reputation": 15004, "user_id": 562906, "user_type": "registered", "accept_rate": 60, "profile_image": "https://www.gravatar.com/avatar/7a15f15ed0023f4177a518b6c15ca4b6?s=128&d=identicon&r=PG", "display_name": "sinelaw", "link": "https://stackoverflow.com/users/562906/sinelaw"}, "is_accepted": false, "score": 3, "last_activity_date": 1436256619, "creation_date": 1436256619, "answer_id": 31263127, "question_id": 31261905, "link": "https://stackoverflow.com/questions/31261905/alternative-io-error-for/31263127#31263127", "title": "Alternative IO error for &lt;|&gt;", "body": "<p>Besides your actual problem, here's why IO can't be an Alternative.</p>\n\n<p>First, what would you do for <a href=\"https://hackage.haskell.org/package/base-4.8.0.0/docs/Control-Applicative.html#v:empty\" rel=\"nofollow\"><code>empty</code></a>? It will need to have type <code>forall a. IO a</code> - an IO action that returns any type of value!</p>\n\n<p>Second, how do you define failure (used for <code>&lt;|&gt;</code>)? For types such as <code>Maybe</code>, empty is obvious (<code>Nothing</code>) and failure can be defined as <code>Nothing</code> as well. So if the first argument is Nothing, return the second. But what about IO? The (confused) notion of failure on monads is magical and not represented at the type level, in other words, there is no explicit failure value.</p>\n\n<p>It <em>could</em> work if you wrapped all your IO actions in <code>Maybe</code> (or <code>Either</code>) so that for example, <code>readFile' :: FilePath -&gt; IO (Maybe String)</code>. Then by lifting <code>&lt;|&gt;</code> you could combine actions. You would have to catch failures (exceptions) and translate them to <code>Nothing</code> in your wrapper.</p>\n\n<p>(For convenience one could make an instance of <code>Alternative</code> for all <code>Alternative f, Monad m =&gt; m f</code> but that requires type composition? I'm not sure)</p>\n"}, {"comments": [{"owner": {"reputation": 7296, "user_id": 324315, "user_type": "registered", "accept_rate": 66, "profile_image": "https://www.gravatar.com/avatar/fbb413736c6866ac28a73a44ab56c6b5?s=128&d=identicon&r=PG&f=1", "display_name": "Randomize", "link": "https://stackoverflow.com/users/324315/randomize"}, "edited": false, "score": 0, "creation_date": 1436260672, "post_id": 31264065, "comment_id": 50524017, "body": "Thanks! very interesting suggestion and I liked the linked article too. It makes easy &quot;centralise&quot; exceptions running IO on the bottom of the stack."}], "tags": [], "owner": {"reputation": 49959, "user_id": 866915, "user_type": "registered", "accept_rate": 70, "profile_image": "https://www.gravatar.com/avatar/09242131d6e17cbbe31e8547514da6e5?s=128&d=identicon&r=PG", "display_name": "ErikR", "link": "https://stackoverflow.com/users/866915/erikr"}, "is_accepted": true, "score": 2, "last_activity_date": 1436259433, "creation_date": 1436259433, "answer_id": 31264065, "question_id": 31261905, "link": "https://stackoverflow.com/questions/31261905/alternative-io-error-for/31264065#31264065", "title": "Alternative IO error for &lt;|&gt;", "body": "<p>Here is an example of what you can do based on the blog post <a href=\"http://chromaticleaves.com/posts/guard-io-with-errort.html\" rel=\"nofollow\">Playing Catch: Handling IO Exceptions with ErrorT</a>.</p>\n\n<pre><code>{-# LANGUAGE GeneralizedNewtypeDeriving #-}\n\nmodule Lib where\n\nimport qualified Data.ByteString.Lazy as B\nimport Network.HTTP.Conduit (simpleHttp)\nimport Control.Monad.Base\nimport Control.Applicative\nimport Control.Monad.Error\nimport System.IO.Error\n\nnewtype MyApp a = MyApp {\n  getApp :: ErrorT String IO a\n  } deriving (Functor, Applicative, Alternative, Monad, MonadIO, MonadError String, MonadBase IO)\n\nmyReadFile path = do\n  r &lt;- liftIO $ tryIOError $ B.readFile path \n  case r of\n    Left e  -&gt; throwError (strMsg \"readFile error\")\n    Right x -&gt; return x\n\nmySimpleHttp bar = do\n  r &lt;- liftIO $ tryIOError $ simpleHttp bar\n  case r of\n    Left e -&gt; throwError (strMsg \"simpleHttp error\")\n    Right x -&gt; return x\n\ngetFeed foo bar =  myReadFile foo &lt;|&gt; mySimpleHttp bar\n\nrunApp = runErrorT . getApp\n\ndoit = do result &lt;- runApp $ getFeed \"some/file.txt\" \"http://example.com/\"\n          case result of\n            Left e  -&gt; putStrLn $ \"error: \" ++ e\n            Right r -&gt; do putStrLn $ \"got a result\"; print r\n</code></pre>\n\n<p>I've been very explicit in this example - the article mentions ways you can reduce the amount of boiler-plate code.</p>\n\n<p>My cabal <code>build-depends:</code> setting:</p>\n\n<pre><code>build-depends: base &gt;= 4.7 &amp;&amp; &lt; 5, bytestring, mtl, http-conduit, transformers-base\n</code></pre>\n"}], "owner": {"reputation": 7296, "user_id": 324315, "user_type": "registered", "accept_rate": 66, "profile_image": "https://www.gravatar.com/avatar/fbb413736c6866ac28a73a44ab56c6b5?s=128&d=identicon&r=PG&f=1", "display_name": "Randomize", "link": "https://stackoverflow.com/users/324315/randomize"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 254, "favorite_count": 0, "accepted_answer_id": 31264065, "answer_count": 3, "score": 2, "last_activity_date": 1614132098, "creation_date": 1436252672, "last_edit_date": 1614132098, "question_id": 31261905, "link": "https://stackoverflow.com/questions/31261905/alternative-io-error-for", "title": "Alternative IO error for &lt;|&gt;", "body": "<p>I am using the operator <code>&lt;|&gt;</code> for:</p>\n\n<pre><code>import qualified Data.ByteString.Lazy as B\nimport Network.HTTP.Conduit (simpleHttp)\nimport Data.Aeson\nimport Data.Maybe\n\ndata FooBar = FooBar {\n    name :: !Text,\n    surname :: !Text\n    } deriving (Show,Generic)\n\ninstance FromJSON FooBar\ninstance ToJSON FooBar\n\ngetFeed :: String -&gt; String -&gt; IO (FooBar)\ngetFeed foo bar =  decode &lt;$&gt; (B.readFile foo &lt;|&gt; simpleHttp bar)\n</code></pre>\n\n<p>But when I try to compile it I get:</p>\n\n<pre><code>No instance for (Alternative IO) arising from a use of \u2018&lt;|&gt;\u2019\n    In the second argument of \u2018(&lt;$&gt;)\u2019, namely\n      \u2018(B.readFile foo &lt;|&gt; simpleHttp bar)\u2019\n    In the expression:\n      decode &lt;$&gt; (B.readFile foo &lt;|&gt; simpleHttp bar)\n    In an equation for \u2018getFeed\u2019:\n        getFeed env id\n          = decode &lt;$&gt; (B.readFile foo &lt;|&gt; simpleHttp bar)\n</code></pre>\n\n<p>The error is a bit obscure to me. Any idea how to fix that?\n(BTW some insight from this reply: <a href=\"https://stackoverflow.com/questions/13080606/confused-by-the-meaning-of-the-alternative-type-class-and-its-relationship-to\">Confused by the meaning of the &#39;Alternative&#39; type class and its relationship to other type classes</a>)</p>\n"}, {"tags": ["haskell", "ghc", "typeclass", "frp", "type-families"], "answers": [{"comments": [{"owner": {"reputation": 18456, "user_id": 1198559, "user_type": "registered", "accept_rate": 70, "profile_image": "https://i.stack.imgur.com/bOjLe.png?s=128&g=1", "display_name": "jhegedus", "link": "https://stackoverflow.com/users/1198559/jhegedus"}, "edited": false, "score": 0, "creation_date": 1436253277, "post_id": 31261982, "comment_id": 50519552, "body": "Many thanks, where is this defined &quot;The point of class Functor (Behaviour t) =&gt; Reflex t where data Behaviour t :: * -&gt; * is to enforce the requirement that for any type t which is an instance of Reflex, whatever datatype you define as the associated data type Behaviour t, you must also make that type into an instance of Functor.&quot; ? How do you know this ? Which SPJ paper describes this ?"}, {"owner": {"reputation": 18456, "user_id": 1198559, "user_type": "registered", "accept_rate": 70, "profile_image": "https://i.stack.imgur.com/bOjLe.png?s=128&g=1", "display_name": "jhegedus", "link": "https://stackoverflow.com/users/1198559/jhegedus"}, "edited": false, "score": 0, "creation_date": 1436253630, "post_id": 31261982, "comment_id": 50519769, "body": "More specifically , where is the meaning of the syntax <code>Functor (F a) =&gt; Funky a</code> defined ? Is it in the type families papers of SPJ ?"}, {"owner": {"reputation": 56659, "user_id": 450128, "user_type": "registered", "accept_rate": 62, "profile_image": "https://www.gravatar.com/avatar/2f72b3fdc99fe9fd1bbeb2f9da1d2c0a?s=128&d=identicon&r=PG", "display_name": "Ben", "link": "https://stackoverflow.com/users/450128/ben"}, "reply_to_user": {"reputation": 18456, "user_id": 1198559, "user_type": "registered", "accept_rate": 70, "profile_image": "https://i.stack.imgur.com/bOjLe.png?s=128&g=1", "display_name": "jhegedus", "link": "https://stackoverflow.com/users/1198559/jhegedus"}, "edited": false, "score": 1, "creation_date": 1436261067, "post_id": 31261982, "comment_id": 50524271, "body": "@jhegedus That&#39;s just ordinary type class constraint syntax. Its meaning doesn&#39;t really change when type families are involved (type families just adds more kinds of things you can mention in constraints). <code>class Functor (F a) =&gt; Funky a</code> just means that for all instances declared for the <code>Funky</code> class there must be a <code>Functor</code> instance for <code>F a</code> (for the same <code>a</code>). This is no different from how <code>class Eq a =&gt; Ord a</code> means that for all instances of <code>Ord</code> there must be an instance of <code>Eq</code>."}, {"owner": {"reputation": 18456, "user_id": 1198559, "user_type": "registered", "accept_rate": 70, "profile_image": "https://i.stack.imgur.com/bOjLe.png?s=128&g=1", "display_name": "jhegedus", "link": "https://stackoverflow.com/users/1198559/jhegedus"}, "reply_to_user": {"reputation": 56659, "user_id": 450128, "user_type": "registered", "accept_rate": 62, "profile_image": "https://www.gravatar.com/avatar/2f72b3fdc99fe9fd1bbeb2f9da1d2c0a?s=128&d=identicon&r=PG", "display_name": "Ben", "link": "https://stackoverflow.com/users/450128/ben"}, "edited": false, "score": 0, "creation_date": 1436265511, "post_id": 31261982, "comment_id": 50527249, "body": "@Ben The difference I mean is the difference between <code>Functor (F a) =&gt; Funky a</code> and <code>F a =&gt; Funky a</code>, the latter is classical, ordinary type class construct, the former, AFAIK is not. What do you think ? Can you write <code>class A( B c) =&gt; D c where ...</code> in Haskell 98 without turning on some language extensions ? I think not but I am not sure."}, {"owner": {"reputation": 18456, "user_id": 1198559, "user_type": "registered", "accept_rate": 70, "profile_image": "https://i.stack.imgur.com/bOjLe.png?s=128&g=1", "display_name": "jhegedus", "link": "https://stackoverflow.com/users/1198559/jhegedus"}, "reply_to_user": {"reputation": 56659, "user_id": 450128, "user_type": "registered", "accept_rate": 62, "profile_image": "https://www.gravatar.com/avatar/2f72b3fdc99fe9fd1bbeb2f9da1d2c0a?s=128&d=identicon&r=PG", "display_name": "Ben", "link": "https://stackoverflow.com/users/450128/ben"}, "edited": false, "score": 0, "creation_date": 1436266064, "post_id": 31261982, "comment_id": 50527599, "body": "@Ben how do YOU know the following : &quot;class Functor (F a) =&gt; Funky a just means that for all instances declared for the Funky class there must be a Functor instance for F a (for the same a)&quot;? Where is this rule coming from ? I think this rule is not described in textbooks on Haskell98. So where is it described ? In other words, how do YOU know what &quot;class Functor (F a) =&gt; Funky a&quot; MEANS ? Have you read about this somewhere ? If yes, where ?"}, {"owner": {"reputation": 56659, "user_id": 450128, "user_type": "registered", "accept_rate": 62, "profile_image": "https://www.gravatar.com/avatar/2f72b3fdc99fe9fd1bbeb2f9da1d2c0a?s=128&d=identicon&r=PG", "display_name": "Ben", "link": "https://stackoverflow.com/users/450128/ben"}, "reply_to_user": {"reputation": 18456, "user_id": 1198559, "user_type": "registered", "accept_rate": 70, "profile_image": "https://i.stack.imgur.com/bOjLe.png?s=128&g=1", "display_name": "jhegedus", "link": "https://stackoverflow.com/users/1198559/jhegedus"}, "edited": false, "score": 0, "creation_date": 1436266193, "post_id": 31261982, "comment_id": 50527673, "body": "@jhegedus I can&#39;t remember off the top of my head. You <i>can</i> definitely write things like <code>class Eq a =&gt; Eq (Maybe a)</code> though. There&#39;s not really any new concepts involved in saying <code>class Eq (Maybe a) =&gt; Eq a</code> instead, whether or not it&#39;s Haskell 98."}, {"owner": {"reputation": 56659, "user_id": 450128, "user_type": "registered", "accept_rate": 62, "profile_image": "https://www.gravatar.com/avatar/2f72b3fdc99fe9fd1bbeb2f9da1d2c0a?s=128&d=identicon&r=PG", "display_name": "Ben", "link": "https://stackoverflow.com/users/450128/ben"}, "reply_to_user": {"reputation": 18456, "user_id": 1198559, "user_type": "registered", "accept_rate": 70, "profile_image": "https://i.stack.imgur.com/bOjLe.png?s=128&g=1", "display_name": "jhegedus", "link": "https://stackoverflow.com/users/1198559/jhegedus"}, "edited": false, "score": 0, "creation_date": 1436266450, "post_id": 31261982, "comment_id": 50527844, "body": "@jhegedus The rule is just that in a class declaration the stuff before the <code>=&gt;</code> is specifying constraints that must hold for every instance of the class that is declared. All I need to know is how to read a constraint (every Haskell text or tutorial that covers type classes at all will go over the basics of this), and that specifically for class declarations it&#39;s a constraint that must be satisfied for every instance. That&#39;s true whether the constraint is one allowed by Haskell 98 or a more advanced one."}, {"owner": {"reputation": 25144, "user_id": 477476, "user_type": "registered", "accept_rate": 85, "profile_image": "https://i.stack.imgur.com/Qf4TT.png?s=128&g=1", "display_name": "Cactus", "link": "https://stackoverflow.com/users/477476/cactus"}, "reply_to_user": {"reputation": 18456, "user_id": 1198559, "user_type": "registered", "accept_rate": 70, "profile_image": "https://i.stack.imgur.com/bOjLe.png?s=128&g=1", "display_name": "jhegedus", "link": "https://stackoverflow.com/users/1198559/jhegedus"}, "edited": false, "score": 0, "creation_date": 1436271929, "post_id": 31261982, "comment_id": 50531432, "body": "@jhegedus did you miss the <code>FlexibleContexts</code> bit in my sample code by chance?"}, {"owner": {"reputation": 18456, "user_id": 1198559, "user_type": "registered", "accept_rate": 70, "profile_image": "https://i.stack.imgur.com/bOjLe.png?s=128&g=1", "display_name": "jhegedus", "link": "https://stackoverflow.com/users/1198559/jhegedus"}, "edited": false, "score": 0, "creation_date": 1436272037, "post_id": 31261982, "comment_id": 50531508, "body": "No, that is alright. I can see that. But that alone does not say where it is the meaning of the class declaration defined, it is not in any Haskell98 textbooks AFAIK."}, {"owner": {"reputation": 18456, "user_id": 1198559, "user_type": "registered", "accept_rate": 70, "profile_image": "https://i.stack.imgur.com/bOjLe.png?s=128&g=1", "display_name": "jhegedus", "link": "https://stackoverflow.com/users/1198559/jhegedus"}, "edited": false, "score": 0, "creation_date": 1436272088, "post_id": 31261982, "comment_id": 50531543, "body": "@Cactus It&#39;s my 4th question for which I search the answer, all the 1-3 parts are answered, for which I am very thankful."}, {"owner": {"reputation": 56659, "user_id": 450128, "user_type": "registered", "accept_rate": 62, "profile_image": "https://www.gravatar.com/avatar/2f72b3fdc99fe9fd1bbeb2f9da1d2c0a?s=128&d=identicon&r=PG", "display_name": "Ben", "link": "https://stackoverflow.com/users/450128/ben"}, "reply_to_user": {"reputation": 18456, "user_id": 1198559, "user_type": "registered", "accept_rate": 70, "profile_image": "https://i.stack.imgur.com/bOjLe.png?s=128&g=1", "display_name": "jhegedus", "link": "https://stackoverflow.com/users/1198559/jhegedus"}, "edited": false, "score": 1, "creation_date": 1436273063, "post_id": 31261982, "comment_id": 50532253, "body": "@jhegedus I&#39;m not sure that you&#39;ll find much more of the meaning of <i>specifically</i> the type class constraints that you can write with FlexibleContexts; even the GHC documentation for the FlexibleContexts extension (which you quote and link to) doesn&#39;t say much about what the constraints mean, just about the now-allowed form of the constraints. The reason is that the constraints still mean exactly the same thing as they always did (&quot;there must be an instance matching this constraint when you use the thing I&#39;m declaring&quot;), you can just use more flexible rules for defining the constraints."}, {"owner": {"reputation": 18456, "user_id": 1198559, "user_type": "registered", "accept_rate": 70, "profile_image": "https://i.stack.imgur.com/bOjLe.png?s=128&g=1", "display_name": "jhegedus", "link": "https://stackoverflow.com/users/1198559/jhegedus"}, "reply_to_user": {"reputation": 56659, "user_id": 450128, "user_type": "registered", "accept_rate": 62, "profile_image": "https://www.gravatar.com/avatar/2f72b3fdc99fe9fd1bbeb2f9da1d2c0a?s=128&d=identicon&r=PG", "display_name": "Ben", "link": "https://stackoverflow.com/users/450128/ben"}, "edited": false, "score": 0, "creation_date": 1436274217, "post_id": 31261982, "comment_id": 50533190, "body": "@Ben, basically when you say <code>A t =&gt; B t</code> then that means that <code>t</code> must be of type <code>A</code> if  <code>t</code> is of type <code>B</code> right ? This is a predicate, so generalizing this rule would give : writing <code>A b =&gt; B t</code> implies that <code>b</code> must be of type <code>A</code> if <code>t</code> is of type <code>B</code>, right ?  This rule generalization was confusing me and I was just looking for some specification where  this generalization is described. Perhaps this is the only meaningful generalization of the basic Haskell 98 rule and that is the reason why it is not specified anywhere explicitly."}, {"owner": {"reputation": 25144, "user_id": 477476, "user_type": "registered", "accept_rate": 85, "profile_image": "https://i.stack.imgur.com/Qf4TT.png?s=128&g=1", "display_name": "Cactus", "link": "https://stackoverflow.com/users/477476/cactus"}, "reply_to_user": {"reputation": 18456, "user_id": 1198559, "user_type": "registered", "accept_rate": 70, "profile_image": "https://i.stack.imgur.com/bOjLe.png?s=128&g=1", "display_name": "jhegedus", "link": "https://stackoverflow.com/users/1198559/jhegedus"}, "edited": false, "score": 0, "creation_date": 1437444580, "post_id": 31261982, "comment_id": 51019477, "body": "@jhegedus: does <a href=\"http://research.microsoft.com/en-us/um/people/simonpj/Papers/type-class-design-space/\" rel=\"nofollow noreferrer\">research.microsoft.com/en-us/um/people/simonpj/Papers/&hellip;</a> contain an answer to what you think your question is?"}], "tags": [], "owner": {"reputation": 25144, "user_id": 477476, "user_type": "registered", "accept_rate": 85, "profile_image": "https://i.stack.imgur.com/Qf4TT.png?s=128&g=1", "display_name": "Cactus", "link": "https://stackoverflow.com/users/477476/cactus"}, "is_accepted": true, "score": 5, "last_activity_date": 1436252910, "creation_date": 1436252910, "answer_id": 31261982, "question_id": 31261665, "link": "https://stackoverflow.com/questions/31261665/which-language-extensions-enable-to-write-class-a-b-c-d-c-where-wha/31261982#31261982", "title": "Which language extensions enable to write &quot;class A (B c) =&gt; D c where ...&quot; ? What is the meaning of this type class declaration?", "body": "<p>First of all, as you've correctly guessed, <code>Behaviour</code> is an <a href=\"https://wiki.haskell.org/GHC/Type_families#Detailed_definition_of_data_families\">associated data type</a>, so falls under the <code>TypeFamilies</code> extension.</p>\n\n<p>The point of <code>class Functor (Behaviour t) =&gt; Reflex t where data Behaviour t :: * -&gt; *</code> is to enforce the requirement that for any type <code>t</code> which is an instance of <code>Reflex</code>, whatever datatype you define as the associated data type <code>Behaviour t</code>, you must also make that type into an instance of <code>Functor</code>.</p>\n\n<p>Here's a small example: suppose I this class definition:</p>\n\n<pre><code>{-# LANGUAGE TypeFamilies, FlexibleContexts #-}\n\nclass Functor (F a) =&gt; Funky a where\n    data F a :: * -&gt; *\n</code></pre>\n\n<p>This allows writing something like</p>\n\n<pre><code>frobulate :: (Funky a) =&gt; F a Int -&gt; F a Bool\nfrobulate = fmap (&lt; 5)\n</code></pre>\n\n<p>since <code>frobulate</code> is free to assume from <code>Funky a</code> that <code>Functor (F a)</code>.</p>\n\n<p>The following by itself is rejected by the type checker:</p>\n\n<pre><code>instance Funky Int where\n    data F Int a = MkF a\n</code></pre>\n\n<p>because the associated datatype <code>F Int</code> is not an instance of <code>Functor</code>:</p>\n\n<pre><code>No instance for (Functor (F Int))\n  arising from the superclasses of an instance declaration\nIn the instance declaration for `Funky Int'\n</code></pre>\n\n<p>which forces you to also add an instance definition like</p>\n\n<pre><code>instance Functor (F Int) where\n    fmap f (MkF x) = MkF (f x)\n</code></pre>\n\n<p>Note that the latter <code>Functor</code> instance also requires <code>FlexibleInstances</code> to be turned on.</p>\n"}, {"tags": [], "owner": {"reputation": 18456, "user_id": 1198559, "user_type": "registered", "accept_rate": 70, "profile_image": "https://i.stack.imgur.com/bOjLe.png?s=128&g=1", "display_name": "jhegedus", "link": "https://stackoverflow.com/users/1198559/jhegedus"}, "is_accepted": false, "score": 0, "last_activity_date": 1436302235, "last_edit_date": 1436302235, "creation_date": 1436298108, "answer_id": 31277890, "question_id": 31261665, "link": "https://stackoverflow.com/questions/31261665/which-language-extensions-enable-to-write-class-a-b-c-d-c-where-wha/31277890#31277890", "title": "Which language extensions enable to write &quot;class A (B c) =&gt; D c where ...&quot; ? What is the meaning of this type class declaration?", "body": "<p>Here is my understanding of the answers. It took me a while to understand it, so I write it down, perhaps it helps for others.</p>\n\n<p>The traditional type class declaration (Haskell 98) <code>class (Eq a) =&gt; MyClass a where</code> <strong>says</strong> that if <code>a</code> is an instance of <code>MyClass</code> then <code>a</code> has to be an instance of <code>Eq</code>, the left side <code>Eq a</code> ( meaning that <code>a</code> is instance of <code>Eq</code>) is a predicate that has to be true if the right side is true <code>MyClass a</code> (meaning that <code>a</code> is instance of <code>MyClass</code>).</p>\n\n<p>So in other words a class declaration is like <code>class ($Predicate) =&gt; MyClass classInstance</code>, where <code>$Predicate</code> can be for example <code>Eq a</code> which means that <code>a</code> is an instance of <code>Eq</code>. </p>\n\n<p>But if one enables the <code>FlexibleContexts</code> language extension then the predicate can be something more complex than just <code>ATypeClass typeParameter</code>.</p>\n\n<p>It can be <code>ATypeClass SomeComplexType</code> which means - by <strong>generalizing</strong> the rule for Haskell 98 that <code>SomeComplexType</code> is an instance of <code>ATypeClass</code>. </p>\n\n<p>This generalization process is described implicitly in the Haskell Report (as explained in Daniel's answer). </p>\n\n<p>The following three short programs demonstrate this generalization rule. The first one compiles the second one not and the third one compiles again.</p>\n\n<p>The second one fails to compile because <code>Smells</code> is not <code>StringLike</code>, as required in <code>IntLike</code>'s class declaration. However if we remove that constraint (in the third program) then the program compiles again.</p>\n\n<p>Here is a toy example which compiles:</p>\n\n<pre><code>{-# LANGUAGE FlexibleContexts #-}\n\n\nclass StringLike a where\n getString :: a-&gt;String\n\nclass (StringLike Smells) =&gt;IntLike a where\n getInt :: a-&gt; Int\n\ninstance IntLike Colors where\n  getInt x = 0\n\ninstance StringLike Colors where\n getString x = \"Hello\"\n\ninstance StringLike Smells where\n getString x = \"Bad\"\n\ndata Colors = Blue | Red\ndata Smells = Rose | Trash\n</code></pre>\n\n<p>The following fails however: </p>\n\n<pre><code>{-# LANGUAGE FlexibleContexts #-}\n\n\nclass StringLike a where\n getString :: a-&gt;String\n\nclass (StringLike Smells) =&gt;IntLike a where\n getInt :: a-&gt; Int\n\ninstance IntLike Colors where\n  getInt x = 0\n\ninstance StringLike Colors where\n getString x = \"Hello\"\n\n\ndata Colors = Blue | Red\ndata Smells = Rose | Trash\n</code></pre>\n\n<p>with the  error message:</p>\n\n<pre><code>test.hs:10:10:\n    No instance for (StringLike Smells)\n      arising from the superclasses of an instance declaration\n    In the instance declaration for `IntLike Colors'\nFailed, modules loaded: none.\n</code></pre>\n\n<p>However, the following compiles again just fine :</p>\n\n<pre><code>{-# LANGUAGE FlexibleContexts #-}\n\n\nclass StringLike a where\n getString :: a-&gt;String\n\nclass (StringLike Smells) =&gt;IntLike a where\n getInt :: a-&gt; Int\n\n\ninstance StringLike Colors where\n getString x = \"Hello\"\n\n\ndata Colors = Blue | Red\ndata Smells = Rose | Trash\n</code></pre>\n"}, {"comments": [{"owner": {"reputation": 18456, "user_id": 1198559, "user_type": "registered", "accept_rate": 70, "profile_image": "https://i.stack.imgur.com/bOjLe.png?s=128&g=1", "display_name": "jhegedus", "link": "https://stackoverflow.com/users/1198559/jhegedus"}, "edited": false, "score": 0, "creation_date": 1436301723, "post_id": 31278348, "comment_id": 50551527, "body": "This is very interesting. Many thanks Daniel, I update my answer."}], "tags": [], "owner": {"reputation": 126897, "user_id": 791604, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/ce991df7a056248d5e4f6fc3659ba733?s=128&d=identicon&r=PG", "display_name": "Daniel Wagner", "link": "https://stackoverflow.com/users/791604/daniel-wagner"}, "is_accepted": false, "score": 3, "last_activity_date": 1436302171, "last_edit_date": 1436302171, "creation_date": 1436299752, "answer_id": 31278348, "question_id": 31261665, "link": "https://stackoverflow.com/questions/31261665/which-language-extensions-enable-to-write-class-a-b-c-d-c-where-wha/31278348#31278348", "title": "Which language extensions enable to write &quot;class A (B c) =&gt; D c where ...&quot; ? What is the meaning of this type class declaration?", "body": "<p>For part 4: the Haskell Report <a href=\"https://www.haskell.org/onlinereport/haskell2010/haskellch4.html#x10-770004.3.2\" rel=\"nofollow\">says</a>:</p>\n\n<blockquote>\n  <p>Assume that the type variables in the instance type <code>(T u1 \u2026 uk)</code> satisfy the constraints in the instance context <code>cx\u2032</code>. Under this assumption, the following two conditions must also be satisfied:</p>\n  \n  <ol>\n  <li>The constraints expressed by the superclass context <code>cx[(T u1 \u2026 uk)/u]</code> of <code>C</code> must be satisfied. In other words, <code>T</code> must be an instance of each of <code>C</code>'s superclasses and the contexts of all superclass instances must be implied by <code>cx\u2032</code>.</li>\n  <li>Any constraints on the type variables in the instance type that are required for the class method declarations in <code>d</code> to be well-typed must also be satisfied.</li>\n  </ol>\n</blockquote>\n\n<p>None of this discussion assumes that superclass contexts are of the simplified form demanded elsewhere in the report; and therefore can (and does) serve as the meaning of more complicated superclass contexts.</p>\n"}], "owner": {"reputation": 18456, "user_id": 1198559, "user_type": "registered", "accept_rate": 70, "profile_image": "https://i.stack.imgur.com/bOjLe.png?s=128&g=1", "display_name": "jhegedus", "link": "https://stackoverflow.com/users/1198559/jhegedus"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 136, "favorite_count": 2, "accepted_answer_id": 31261982, "answer_count": 3, "score": 4, "last_activity_date": 1436302235, "creation_date": 1436251865, "last_edit_date": 1436271872, "question_id": 31261665, "link": "https://stackoverflow.com/questions/31261665/which-language-extensions-enable-to-write-class-a-b-c-d-c-where-wha", "title": "Which language extensions enable to write &quot;class A (B c) =&gt; D c where ...&quot; ? What is the meaning of this type class declaration?", "body": "<p>I am trying to understand the following class declaration :</p>\n\n<pre><code>class (MonadHold t (PushM t), MonadSample t (PullM t), Functor (Event t), Functor (Behavior t)) =&gt; Reflex t where\n  data Behavior t :: * -&gt; *\n</code></pre>\n\n<p>which is in the <a href=\"https://github.com/ryantrinkle/reflex/blob/master/src/Reflex/Class.hs\" rel=\"nofollow\">Reflex</a> FRP library.</p>\n\n<p>1 ) What language extensions make it possible to write <code>Functor (Behavior t) =&gt; Reflex t</code> ? I guess it is a combination of Language extensions. I am guessing Type Families are involved, but what else ? </p>\n\n<p>In other words, what language extension do I have to turn on such that a code containing <code>class A (B c) =&gt; D c where ...</code> compiles ?</p>\n\n<p>2 ) What is the meaning of <code>class A (B c) =&gt; D c where ...</code> ? </p>\n\n<p>3 ) Could you give a super simple example explaining why and when one wants to write <code>class A (B c) =&gt; D c where ...</code> ?</p>\n\n<p>4 ) Where is it described what  <code>class A (B c) =&gt; D c where ...</code> means ? I guess there is an SPJ paper or talk describing it could you please point to it ?</p>\n\n<p>Edit:</p>\n\n<p>Further related info:</p>\n\n<p><a href=\"https://downloads.haskell.org/~ghc/7.8.4/docs/html/users_guide/type-class-extensions.html\" rel=\"nofollow\">Here</a> it is written:</p>\n\n<blockquote>\n  <p>In Haskell 98 the context of a class declaration (which introduces\n  superclasses) must be simple; that is, each predicate must consist of\n  a class applied to type variables.</p>\n</blockquote>\n\n<p>If I interpret the above citation correctly then in Haskell98 only <code>class A b=&gt;C b where</code> shaped class declarations are allowed, which means that <code>class A(B c) =&gt; D c</code> is not allowed. So the question is, if the latter is allowed, and the former is not, who and what defines the MEANING for the latter ? The latter is not correct Haskell 98 syntax so its meaning is also not described in any Haskell 98 book, then where it is the MEANING of the latter described/documented/specified?</p>\n"}, {"tags": ["scala", "haskell", "typeclass"], "answers": [{"comments": [{"owner": {"reputation": 24028, "user_id": 383200, "user_type": "registered", "accept_rate": 60, "profile_image": "https://www.gravatar.com/avatar/a9dc722f936cb1059adaae4fe39c07f0?s=128&d=identicon&r=PG", "display_name": "Carl", "link": "https://stackoverflow.com/users/383200/carl"}, "edited": false, "score": 3, "creation_date": 1436245295, "post_id": 31260058, "comment_id": 50516114, "body": "More than that..  You can have different implicits in scope in different contexts without errors. So you can construct some <code>Set</code> value with one kind of equality in scope, then use it with a different kind of equality in scope, leading to inconsistent and buggy results. Mere equality is a bit weak to show this, but something like Haskell&#39;s <code>Ord</code> is sufficient with binary search trees."}], "tags": [], "owner": {"reputation": 9485, "user_id": 20371, "user_type": "registered", "accept_rate": 88, "profile_image": "https://www.gravatar.com/avatar/32c7a412ad0caf812ae974df5eb8ffcd?s=128&d=identicon&r=PG", "display_name": "Yawar", "link": "https://stackoverflow.com/users/20371/yawar"}, "is_accepted": false, "score": 5, "last_activity_date": 1436245562, "last_edit_date": 1436245562, "creation_date": 1436245131, "answer_id": 31260058, "question_id": 31259389, "link": "https://stackoverflow.com/questions/31259389/typeclasses-in-haskell-v-scala/31260058#31260058", "title": "Typeclasses in Haskell v. Scala", "body": "<p>One problem the Scala version can have that the Haskell version can't, is that in Scala you can define more than one instance of <code>Equal[Int]</code> in scope when the implicit resolution machinery is trying to find an instance. Which is when you can get an error like:</p>\n\n<pre><code>&lt;console&gt;:12: error: ambiguous implicit values:\n both value EqualInt1 of type =&gt; Equal[Int]\n and value EqualInt2 of type =&gt; Equal[Int]\n match expected type Equal[Int]\n              f(1, 2)\n               ^\n</code></pre>\n\n<p>Update. As Carl points out in a comment, another problem is that you can have different instances in scope at different points in the code, so that calling <code>f</code> could use these different instances with very different results and no compile-time or run-time errors.</p>\n"}], "owner": {"reputation": 37991, "user_id": 409976, "user_type": "registered", "accept_rate": 68, "profile_image": "https://www.gravatar.com/avatar/9ccda0b49cc974197399eae01ebd6850?s=128&d=identicon&r=PG", "display_name": "Kevin Meredith", "link": "https://stackoverflow.com/users/409976/kevin-meredith"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 735, "favorite_count": 1, "answer_count": 1, "score": 6, "last_activity_date": 1436245562, "creation_date": 1436240798, "last_edit_date": 1436241643, "question_id": 31259389, "link": "https://stackoverflow.com/questions/31259389/typeclasses-in-haskell-v-scala", "title": "Typeclasses in Haskell v. Scala", "body": "<p>Given the following implementations of <code>f</code> in Haskell and Scala:</p>\n\n<pre><code>Prelude&gt; let f x y = x == y\nPrelude&gt; :t f\nf :: Eq a =&gt; a -&gt; a -&gt; Bool\n</code></pre>\n\n<p>Scala:</p>\n\n<pre><code>scala&gt; trait Equal[A] { def ===(x: A, y: A): Boolean }\ndefined trait Equal\n\nscala&gt; implicit val equalsInt = new Equal[Int] {\n     |  def ===(x: Int, y: Int):Boolean = (x == y)\n     | }\nequalsInt: Equal[Int] = $anon$1@3daa422a\n\nscala&gt; def f[A : Equal](x: A, y: A): Boolean = \n     |   implicitly[Equal[A]].===(x, y)\nf: [A](x: A, y: A)(implicit evidence$1: Equal[A])Boolean\n\nscala&gt; f(10, 20)\nres0: Boolean = false\n\nscala&gt; f(55, 55)\nres1: Boolean = true\n</code></pre>\n\n<p>Watching this video, <a href=\"https://www.youtube.com/watch?v=hIZxTQP1ifo\">Typeclasses v. the World</a>, my incomplete understanding is that Scala's implicit resolution, i.e. how it achieves type-classes, is susceptible to <em>incorrect/inconsistent</em> resolution of implicits. But, Haskell does not use implicits for typeclasses, so there's no such problem in Haskell.</p>\n\n<p>Considering the differences between Scala and Haskell's typeclass implementations, what are the possible problems of the above <code>f</code> definition in Scala that are absent from Haskell?</p>\n"}, {"tags": ["haskell"], "comments": [{"owner": {"reputation": 531, "user_id": 548027, "user_type": "registered", "accept_rate": 20, "profile_image": "https://www.gravatar.com/avatar/d8e89f41f702a6504b25edf6b9ca190d?s=128&d=identicon&r=PG", "display_name": "Adam R. Nelson", "link": "https://stackoverflow.com/users/548027/adam-r-nelson"}, "edited": false, "score": 0, "creation_date": 1436220605, "post_id": 31256154, "comment_id": 50509885, "body": "Haven&#39;t figured this out yet, but I&#39;ve found that a simpler program makes the problem show up: if you define <code>newtype Foo a = Foo a</code>, then define an instance <code>Rec r =&gt; Rec (Foo r)</code>, with <code>encodeToRec (Foo r) = x where x = encodeToRec r</code>, it gives the same error. Even though the instance doesn&#39;t refer to <code>Type</code> at all. Strange..."}, {"owner": {"reputation": 20544, "user_id": 1073695, "user_type": "registered", "accept_rate": 60, "profile_image": "https://www.gravatar.com/avatar/2dca512cb7914943d46461d0bbbacd5a?s=128&d=identicon&r=PG", "display_name": "Jo So", "link": "https://stackoverflow.com/users/1073695/jo-so"}, "reply_to_user": {"reputation": 531, "user_id": 548027, "user_type": "registered", "accept_rate": 20, "profile_image": "https://www.gravatar.com/avatar/d8e89f41f702a6504b25edf6b9ca190d?s=128&d=identicon&r=PG", "display_name": "Adam R. Nelson", "link": "https://stackoverflow.com/users/548027/adam-r-nelson"}, "edited": false, "score": 0, "creation_date": 1436221026, "post_id": 31256154, "comment_id": 50510044, "body": "@AdamR.Nelson Thanks for the simplification. I didn&#39;t feel like working that out, hope that OP isn&#39;t too long :-)"}, {"owner": {"reputation": 43759, "user_id": 1651941, "user_type": "registered", "accept_rate": 97, "profile_image": "https://www.gravatar.com/avatar/a513bc1fa519d2fcf5e4e0d9b5500101?s=128&d=identicon&r=PG", "display_name": "Sibi", "link": "https://stackoverflow.com/users/1651941/sibi"}, "edited": false, "score": 0, "creation_date": 1436221281, "post_id": 31256154, "comment_id": 50510145, "body": "This seems strange. The <code>++</code> expression should not typecheck since <code>t</code> doesn&#39;t have the constraint <code>Rec</code> ?"}, {"owner": {"reputation": 57219, "user_id": 33796, "user_type": "registered", "accept_rate": 70, "profile_image": "https://www.gravatar.com/avatar/08727b23ba62e634b32988cdff082663?s=128&d=identicon&r=PG", "display_name": "luqui", "link": "https://stackoverflow.com/users/33796/luqui"}, "edited": false, "score": 2, "creation_date": 1436221325, "post_id": 31256154, "comment_id": 50510156, "body": "Yes, typeclasses cannot do this kind of specializing selection, because of the way type inference happens. The <code>(Type t) =&gt; Rec t</code> instance will always be chosen, no matter what.  You can think of instance matching going in reverse -- first we look for <code>Rec t</code> and see if the <code>t</code> matches our type (which it definitely will), and only after we have committed to that choice do we go on to check the <code>(Type t)</code> constraint."}, {"owner": {"reputation": 43759, "user_id": 1651941, "user_type": "registered", "accept_rate": 97, "profile_image": "https://www.gravatar.com/avatar/a513bc1fa519d2fcf5e4e0d9b5500101?s=128&d=identicon&r=PG", "display_name": "Sibi", "link": "https://stackoverflow.com/users/1651941/sibi"}, "edited": false, "score": 0, "creation_date": 1436221417, "post_id": 31256154, "comment_id": 50510199, "body": "But if you want to typecheck your original program with the <code>let -in</code> expression, just add a <code>Type r</code> constraint to it."}, {"owner": {"reputation": 20544, "user_id": 1073695, "user_type": "registered", "accept_rate": 60, "profile_image": "https://www.gravatar.com/avatar/2dca512cb7914943d46461d0bbbacd5a?s=128&d=identicon&r=PG", "display_name": "Jo So", "link": "https://stackoverflow.com/users/1073695/jo-so"}, "reply_to_user": {"reputation": 43759, "user_id": 1651941, "user_type": "registered", "accept_rate": 97, "profile_image": "https://www.gravatar.com/avatar/a513bc1fa519d2fcf5e4e0d9b5500101?s=128&d=identicon&r=PG", "display_name": "Sibi", "link": "https://stackoverflow.com/users/1651941/sibi"}, "edited": false, "score": 0, "creation_date": 1436221502, "post_id": 31256154, "comment_id": 50510222, "body": "@Sibi: But <code>Type r</code> is not what I want."}, {"owner": {"reputation": 100185, "user_id": 3234959, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/93bb12ca0f93dfddb33880316f7e66c2?s=128&d=identicon&r=PG&f=1", "display_name": "chi", "link": "https://stackoverflow.com/users/3234959/chi"}, "edited": false, "score": 2, "creation_date": 1436221589, "post_id": 31256154, "comment_id": 50510255, "body": "This does not answer.. but: overlapping instances make the code too fragile, IMHO, and are rarely worth the candle. Knowing which instance is the one which is being used is tricky, and relying on it looks quite dangerous to me. (In Agda at least you can pass instances explicitly, if you really want, so they are not so evil.)"}, {"owner": {"reputation": 20544, "user_id": 1073695, "user_type": "registered", "accept_rate": 60, "profile_image": "https://www.gravatar.com/avatar/2dca512cb7914943d46461d0bbbacd5a?s=128&d=identicon&r=PG", "display_name": "Jo So", "link": "https://stackoverflow.com/users/1073695/jo-so"}, "reply_to_user": {"reputation": 57219, "user_id": 33796, "user_type": "registered", "accept_rate": 70, "profile_image": "https://www.gravatar.com/avatar/08727b23ba62e634b32988cdff082663?s=128&d=identicon&r=PG", "display_name": "luqui", "link": "https://stackoverflow.com/users/33796/luqui"}, "edited": false, "score": 0, "creation_date": 1436221848, "post_id": 31256154, "comment_id": 50510346, "body": "@luqui: If I get you right, I should avoid creating instances like <code>Type t</code>, just because the &quot;type pattern&quot; <code>t</code> matches any type (ignoring any constraints on the instance)?"}, {"owner": {"reputation": 100892, "user_id": 745903, "user_type": "registered", "accept_rate": 74, "profile_image": "https://www.gravatar.com/avatar/50933f6638836741e620669b3940410e?s=128&d=identicon&r=PG", "display_name": "leftaroundabout", "link": "https://stackoverflow.com/users/745903/leftaroundabout"}, "edited": false, "score": 1, "creation_date": 1436223878, "post_id": 31256154, "comment_id": 50510991, "body": "@JoSo: that&#39;s right, don&#39;t do <code>instance (Bar t) =&gt; Foo t</code>, as it basically limits your class to that one instance (so you could as well define the class methods as top-level functions)."}], "answers": [{"comments": [{"owner": {"reputation": 43759, "user_id": 1651941, "user_type": "registered", "accept_rate": 97, "profile_image": "https://www.gravatar.com/avatar/a513bc1fa519d2fcf5e4e0d9b5500101?s=128&d=identicon&r=PG", "display_name": "Sibi", "link": "https://stackoverflow.com/users/1651941/sibi"}, "edited": false, "score": 0, "creation_date": 1436485061, "post_id": 31257347, "comment_id": 50645928, "body": "Are you sure both the bug are same ? The example shown in the linked ticket involves type family. Probably file another ghc issue to get confirmation ? Will you do that or shall I file an issue ? (There is no harm in asking ghc-devs if it is a bug even if it is a duplicated of the linked bug.)"}], "tags": [], "owner": {"reputation": 21417, "user_id": 925978, "user_type": "registered", "accept_rate": 84, "profile_image": "https://www.gravatar.com/avatar/06e4467a5bd1538a92cefb20db07897a?s=128&d=identicon&r=PG&f=1", "display_name": "crockeea", "link": "https://stackoverflow.com/users/925978/crockeea"}, "is_accepted": false, "score": 1, "last_activity_date": 1436226021, "last_edit_date": 1495540695, "creation_date": 1436225172, "answer_id": 31257347, "question_id": 31256154, "link": "https://stackoverflow.com/questions/31256154/haskell-let-binding-chooses-wrong-instance/31257347#31257347", "title": "Haskell - let binding chooses wrong instance", "body": "<p>This smells a lot like a <a href=\"https://ghc.haskell.org/trac/ghc/ticket/10338\" rel=\"nofollow noreferrer\">known bug</a>: your code compiles when I remove the generic instance, but GHC doesn't find a supplied constraint in its presence. I have a corresponding SO question <a href=\"https://stackoverflow.com/questions/29763655/monomorphism-restriction-triggered-when-generic-instance-defined\">here</a>.\nIf this is the same bug, it might not be fixed for a while (if ever).</p>\n"}], "owner": {"reputation": 20544, "user_id": 1073695, "user_type": "registered", "accept_rate": 60, "profile_image": "https://www.gravatar.com/avatar/2dca512cb7914943d46461d0bbbacd5a?s=128&d=identicon&r=PG", "display_name": "Jo So", "link": "https://stackoverflow.com/users/1073695/jo-so"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 119, "favorite_count": 0, "answer_count": 1, "score": 4, "last_activity_date": 1436226021, "creation_date": 1436218912, "last_edit_date": 1436221999, "question_id": 31256154, "link": "https://stackoverflow.com/questions/31256154/haskell-let-binding-chooses-wrong-instance", "title": "Haskell - let binding chooses wrong instance", "body": "<p>The following Test took me by surprise</p>\n\n<pre><code>{-# LANGUAGE FlexibleInstances #-}\n{-# LANGUAGE UndecidableInstances #-}\nmodule Test where\n\nclass Type t where\n    encodeToField :: t -&gt; String\n\nclass Rec r where\n    encodeToRec :: r -&gt; String\n\ndata X a b = X a b\n\ninstance (Type t) =&gt; Rec t where\n    encodeToRec = encodeToField\n\ninstance (Type t, Rec r) =&gt; Rec (X t r) where\n    encodeToRec (X t r) =\n        let x = encodeToField t\n            y = encodeToRec r\n         in x ++ y\n</code></pre>\n\n<p>ghc fails on this with</p>\n\n<pre><code>Test.hs:19:17\nCould not deduce (Type r) arising from a use of `encodeToRec'\nfrom the context (Type t, Rec r)\n</code></pre>\n\n<p>For some reason ghc wants to use the <code>Type t =&gt; Rec t</code> instance at <code>y = encodeToRec r</code>, instead of just taking the <code>Rec r</code> from the context of the instance declaration.</p>\n\n<p>If I avoid the let binding and instead write</p>\n\n<pre><code>instance (Type t, Rec r) =&gt; Rec (X t r) where\n    encodeToRec (X t r) = encodeToRec t ++ encodeToRec r\n</code></pre>\n\n<p>it compiles.</p>\n\n<p>Is this a bug in ghc or should that behaviour be expected because of the language extensions used?</p>\n"}, {"tags": ["parsing", "haskell", "recursion", "functional-programming"], "comments": [{"owner": {"reputation": 51584, "user_id": 839246, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/9b0573c2b936b12828dd1e4cc04206dc?s=128&d=identicon&r=PG&f=1", "display_name": "bheklilr", "link": "https://stackoverflow.com/users/839246/bheklilr"}, "edited": false, "score": 2, "creation_date": 1436219063, "post_id": 31256085, "comment_id": 50509274, "body": "Do you want to do this without recursion or without explicit recursion?  If you use a fold then it&#39;s still using recursion, and technically if you&#39;re using a list then you&#39;re using a recursive type (in Haskell).  You could use a vector type if you know what size to make it to start with, but trying to un-recurse recursive data structures isn&#39;t a very valuable exercise IMO."}, {"owner": {"reputation": 44680, "user_id": 1031791, "user_type": "registered", "accept_rate": 54, "profile_image": "https://www.gravatar.com/avatar/fb710534fda446d2286074bb7692e65a?s=128&d=identicon&r=PG", "display_name": "MaiaVictor", "link": "https://stackoverflow.com/users/1031791/maiavictor"}, "reply_to_user": {"reputation": 51584, "user_id": 839246, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/9b0573c2b936b12828dd1e4cc04206dc?s=128&d=identicon&r=PG&f=1", "display_name": "bheklilr", "link": "https://stackoverflow.com/users/839246/bheklilr"}, "edited": false, "score": 0, "creation_date": 1436219254, "post_id": 31256085, "comment_id": 50509358, "body": "@bheklilr, I updated my question to make my definition of &quot;recursive function&quot; unambiguous. Thank you!"}, {"owner": {"reputation": 57219, "user_id": 33796, "user_type": "registered", "accept_rate": 70, "profile_image": "https://www.gravatar.com/avatar/08727b23ba62e634b32988cdff082663?s=128&d=identicon&r=PG", "display_name": "luqui", "link": "https://stackoverflow.com/users/33796/luqui"}, "edited": false, "score": 0, "creation_date": 1436221043, "post_id": 31256085, "comment_id": 50510054, "body": "Instead of folding on the structure of the tree, you could fold on the tokenized input.  That way the size of the structure is bounded by the size of the input, so you can have some hope of a provably total program.  I think this constitutes writing a bottom-up rather than top-down parser."}, {"owner": {"reputation": 44680, "user_id": 1031791, "user_type": "registered", "accept_rate": 54, "profile_image": "https://www.gravatar.com/avatar/fb710534fda446d2286074bb7692e65a?s=128&d=identicon&r=PG", "display_name": "MaiaVictor", "link": "https://stackoverflow.com/users/1031791/maiavictor"}, "edited": false, "score": 0, "creation_date": 1436221120, "post_id": 31256085, "comment_id": 50510093, "body": "I was thinking about that. I would need to build the stack manually, correct?"}, {"owner": {"reputation": 11986, "user_id": 3237465, "user_type": "registered", "accept_rate": 76, "profile_image": "https://i.stack.imgur.com/vOArX.png?s=128&g=1", "display_name": "user3237465", "link": "https://stackoverflow.com/users/3237465/user3237465"}, "edited": false, "score": 5, "creation_date": 1436223370, "post_id": 31256085, "comment_id": 50510830, "body": "&quot;Total&quot; doesn&#39;t mean, that you can&#39;t have recursion or even infinite chains of something. It&#39;s ok to parse an infinite string in a total function \u2014 you just need corecursion for that. All total functions must be either structurally recursive (you can find some techniques <a href=\"http://stackoverflow.com/questions/19642921/assisting-agdas-termination-checker\">here</a>) or productive (see e.g. <a href=\"http://adam.chlipala.net/cpdt/html/Coinductive.html\" rel=\"nofollow noreferrer\">this</a>). There is a <a href=\"http://www.cse.chalmers.se/~nad/publications/danielsson-parser-combinators.pdf\" rel=\"nofollow noreferrer\">paper</a> about total parser combinators."}, {"owner": {"reputation": 2115, "user_id": 1934349, "user_type": "registered", "accept_rate": 73, "profile_image": "https://i.stack.imgur.com/LyNoA.jpg?s=128&g=1", "display_name": "paulotorrens", "link": "https://stackoverflow.com/users/1934349/paulotorrens"}, "edited": false, "score": 1, "creation_date": 1436230467, "post_id": 31256085, "comment_id": 50512588, "body": "Total parser combinators... for God&#39;s sake, I&#39;m gonna quit IT and open a food truck. Will be easier."}, {"owner": {"reputation": 44680, "user_id": 1031791, "user_type": "registered", "accept_rate": 54, "profile_image": "https://www.gravatar.com/avatar/fb710534fda446d2286074bb7692e65a?s=128&d=identicon&r=PG", "display_name": "MaiaVictor", "link": "https://stackoverflow.com/users/1031791/maiavictor"}, "reply_to_user": {"reputation": 11986, "user_id": 3237465, "user_type": "registered", "accept_rate": 76, "profile_image": "https://i.stack.imgur.com/vOArX.png?s=128&g=1", "display_name": "user3237465", "link": "https://stackoverflow.com/users/3237465/user3237465"}, "edited": false, "score": 0, "creation_date": 1436232926, "post_id": 31256085, "comment_id": 50513160, "body": "@user3237465 does it mean those parsers have a normal form? If so, that&#39;s very interesting, I&#39;m going to read the paper soon, thanks for the links!"}, {"owner": {"reputation": 11986, "user_id": 3237465, "user_type": "registered", "accept_rate": 76, "profile_image": "https://i.stack.imgur.com/vOArX.png?s=128&g=1", "display_name": "user3237465", "link": "https://stackoverflow.com/users/3237465/user3237465"}, "edited": false, "score": 0, "creation_date": 1436236581, "post_id": 31256085, "comment_id": 50513967, "body": "@Viclib, I don&#39;t understand your question. What normal forms do you mean? Total parsing always terminates, but since the paper contains a lot of coinductive stuff, I don&#39;t think parsers always produce terms in canonical forms (I didn&#39;t read the paper properly though)."}, {"owner": {"reputation": 44680, "user_id": 1031791, "user_type": "registered", "accept_rate": 54, "profile_image": "https://www.gravatar.com/avatar/fb710534fda446d2286074bb7692e65a?s=128&d=identicon&r=PG", "display_name": "MaiaVictor", "link": "https://stackoverflow.com/users/1031791/maiavictor"}, "edited": false, "score": 1, "creation_date": 1436237717, "post_id": 31256085, "comment_id": 50514213, "body": "I mean the normal form in the sense that there are no more redexes on the term, including inside abstractions. That is, the term is &quot;strongly normalizing&quot;, as defined <a href=\"https://en.wikipedia.org/wiki/Normal_form_(abstract_rewriting)\" rel=\"nofollow noreferrer\">on this article</a>. I find that is the only sensible definition of totality, and is actually included on its definition on the respective Wikipedia article. There are terms that are provably terminating, but not strongly normalizing - after reading a bit, I guess those parsers fit that category. :("}, {"owner": {"reputation": 14611, "user_id": 1046610, "user_type": "registered", "accept_rate": 86, "profile_image": "https://i.stack.imgur.com/F2ZRG.jpg?s=128&g=1", "display_name": "Ricardo Souza", "link": "https://stackoverflow.com/users/1046610/ricardo-souza"}, "edited": false, "score": 0, "creation_date": 1436285521, "post_id": 31256085, "comment_id": 50542063, "body": "I think this is more of a programers.stackexchange.com question. you may get more feedback there."}], "answers": [{"comments": [{"owner": {"reputation": 44680, "user_id": 1031791, "user_type": "registered", "accept_rate": 54, "profile_image": "https://www.gravatar.com/avatar/fb710534fda446d2286074bb7692e65a?s=128&d=identicon&r=PG", "display_name": "MaiaVictor", "link": "https://stackoverflow.com/users/1031791/maiavictor"}, "edited": false, "score": 0, "creation_date": 1437696336, "post_id": 31531513, "comment_id": 51151673, "body": "You are awesome! I seriously don&#39;t know how to thank you anymore."}], "tags": [], "owner": {"reputation": 126897, "user_id": 791604, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/ce991df7a056248d5e4f6fc3659ba733?s=128&d=identicon&r=PG", "display_name": "Daniel Wagner", "link": "https://stackoverflow.com/users/791604/daniel-wagner"}, "is_accepted": true, "score": 4, "last_activity_date": 1437458880, "creation_date": 1437458880, "answer_id": 31531513, "question_id": 31256085, "link": "https://stackoverflow.com/questions/31256085/how-to-write-a-parser-for-a-mutually-recursive-adt-without-recursion-and-side-ef/31531513#31531513", "title": "How to write a parser for a mutually recursive ADT without recursion and side effects?", "body": "<p>tl;dr: Church-encode your input list, and use that to drive your recursion.</p>\n\n<p>A proper Church-encoding of lists requires <code>RankNTypes</code>, and looks a bit like this:</p>\n\n<pre><code>{-# LANGUAGE RankNTypes #-}\n\ndata List a = List { runList :: forall r. (a -&gt; r -&gt; r) -&gt; r -&gt; r }\ninstance Show a =&gt; Show (List a) where\n    showsPrec n (List xs) = showsPrec n (xs (:) [])\n\nnilVal :: List a\nnilVal = List $ \\cons nil -&gt; nil\n\nconsVal :: a -&gt; List a -&gt; List a\nconsVal a (List as) = List $ \\cons nil -&gt; cons a (as cons nil)\n\n-- handy for pattern-matching\nuncons :: List a -&gt; Maybe (a, List a)\nuncons (List xs) = xs cons nil where\n    cons x Nothing = Just (x, nilVal)\n    cons x (Just (x', xs)) = Just (x, consVal x' xs)\n    nil = Nothing\n</code></pre>\n\n<p>Now we just have to write our parser. I'm really bad with parsing theory, so I threw something awful together. Probably somebody who knows a thing or two about that domain could give you some more principled advice here. I'm going to parse the grammar:</p>\n\n<pre><code>tree -&gt; 0 N list\nlist -&gt; 0 tree list | 1\n</code></pre>\n\n<p>My parser state will keep track of what \"hole\" we're currently parsing. For non-terminals, we'll actually need a stack of the holes. Thus, the terminal holes have one of these forms:</p>\n\n<pre><code>* N list\n0 * list\n* tree list\n*\n</code></pre>\n\n<p>We'll collapse the last two. Notice that none of these holes have interesting information <em>before</em> them, so we don't need to store anything in a <code>THole</code>. The non-terminal holes have one of these forms:</p>\n\n<pre><code>0 N *\n0 * list\n0 tree *\n</code></pre>\n\n<p>In this case, the hole in the tree formation rule has a number before it that we will need later, and the second kind of hole in the list formation rule has a tree before it that we'll need to keep, so <code>NTHole</code> will need those in the constructors. Thus:</p>\n\n<pre><code>data Tree = Node Int [Tree]\n    deriving (Eq, Ord, Read, Show)\n\ndata THole\n    = TreeT0\n    | TreeT1\n    | ListT\n    deriving (Eq, Ord, Read, Show)\n\ndata NTHole\n    = TreeNT Int\n    | ListNT0\n    | ListNT1 Tree\n    deriving (Eq, Ord, Read, Show)\n</code></pre>\n\n<p>Our current parser state will be the terminal hole we're currently in, and the stack of non-terminal holes we need to fill as rules get reduced.</p>\n\n<pre><code>type RawState = (THole, List NTHole)\ninitRawState = (TreeT0, nilVal)\n</code></pre>\n\n<p>...well, except that we have two more states of interest: done with the list, and error.</p>\n\n<pre><code>type State = Maybe (Either RawState Tree)\ninitState = Just (Left initRawState)\n</code></pre>\n\n<p>Now we can write a step function that takes a good state and handles it. Again, you would want a parser generator tool to create one of these for you, but this language is small enough that I did it by hand.</p>\n\n<pre><code>stepRaw :: Int -&gt; RawState -&gt; State\nstepRaw 0 (TreeT0, xs) = Just (Left (TreeT1, xs))\nstepRaw n (TreeT1, xs) = Just (Left (ListT , consVal (TreeNT n) xs))\nstepRaw 0 (ListT , xs) = Just (Left (TreeT0, consVal ListNT0    xs))\nstepRaw 1 (ListT , xs) = fst (runList xs cons nil) [] where\n    cons v (f, xs) = flip (,) (consVal v xs) $ case v of\n        ListNT1 t -&gt; \\acc -&gt; f (t:acc)\n        TreeNT  n -&gt; \\acc -&gt; let t = Node n acc in case uncons xs of\n            Nothing -&gt; Just (Right t)\n            Just (ListNT0, xs) -&gt; Just (Left (ListT, consVal (ListNT1 t) xs))\n            _ -&gt; Nothing\n        _ -&gt; \\acc -&gt; Nothing\n    nil = (\\acc -&gt; Nothing, nilVal)\nstepRaw _ _ = Nothing\n\nstep :: Int -&gt; State -&gt; State\nstep n v = v &gt;&gt;= either (stepRaw n) (const Nothing)\n</code></pre>\n\n<p>It turns out that this parser actually runs backwards, which is unfortunate but not a fundamental limitation. It was just easier for me to think in this direction. As required, there is no recursion here. We can try it out on your sample <code>List Int</code> in ghci.</p>\n\n<pre><code>*Main&gt; let x = foldr consVal nilVal [1,1,40,0,0,1,30,0,0,1,20,0,0,10,0]\n*Main&gt; runList x step initState\nJust (Right (Node 10 [Node 20 [],Node 30 [],Node 40 []]))\n</code></pre>\n\n<p>I use <code>foldr</code> to build <code>x</code>, and <code>foldr</code> is recursive, so you might scream about that. But we could easily define <code>x</code> without <code>foldr</code>; the built-in list syntax is just more convenient to read and write than long chains of <code>consVal</code> and <code>nilVal</code>.</p>\n"}], "owner": {"reputation": 44680, "user_id": 1031791, "user_type": "registered", "accept_rate": 54, "profile_image": "https://www.gravatar.com/avatar/fb710534fda446d2286074bb7692e65a?s=128&d=identicon&r=PG", "display_name": "MaiaVictor", "link": "https://stackoverflow.com/users/1031791/maiavictor"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 910, "favorite_count": 0, "accepted_answer_id": 31531513, "answer_count": 1, "score": 6, "last_activity_date": 1437458880, "creation_date": 1436218659, "last_edit_date": 1436289672, "question_id": 31256085, "link": "https://stackoverflow.com/questions/31256085/how-to-write-a-parser-for-a-mutually-recursive-adt-without-recursion-and-side-ef", "title": "How to write a parser for a mutually recursive ADT without recursion and side effects?", "body": "<p><strong>Warning: long and complicated question incoming.</strong></p>\n\n<p>Some believe <a href=\"https://uf-ias-2012.wikispaces.com/file/view/turner.pdf\" rel=\"nofollow\">total functional programming</a> is a valuable idea, and so is finding techniques for doing it. Minding that, how can I write a parser for a mutually recursive ADT without recursion and side effects? Here, I'm defining as \"recursive\" any term that isn't <a href=\"https://en.wikipedia.org/wiki/Normal_form_(abstract_rewriting)\" rel=\"nofollow\">strongly normalizing</a>. </p>\n\n<p><strong>What I have tried:</strong></p>\n\n<p>Mind this following mutually recursive ADT:</p>\n\n<pre><code>data Tree = Node Int [Tree]\ntree = Node 10 [Node 20 [], Node 30 [], Node 40 []]\n</code></pre>\n\n<p>The value, <code>tree</code>, could be serialized as:</p>\n\n<pre><code>tree_serial = [0,10,0,0,20,1,0,0,30,1,0,0,40,1,1] :: [Int]\n</code></pre>\n\n<p>Using ints for simplicity, here, <code>0</code> denotes the beginning of a <code>Node</code> or a <code>Cons</code> cell (depending on the state of the parser), 1 denotes <code>Nil</code> and the remaining denotes data. We could easily write a parser for it using side effects:</p>\n\n<pre><code>var string = [0,10,0,0,20,1,0,0,30,1,0,0,40,1,1];\n\nfunction parse(string){\n    function getInt(){\n        return string.shift();\n    };\n    function parseTree(){\n        var chr = getInt();\n        if (chr === 0)\n            return [\"Node\",getInt(),parseList()];\n    };\n    function parseList(){\n        var chr = getInt();\n        if (chr === 0)\n            return [\"Cons\",parseTree(),parseList()];\n        if (chr === 1)\n            return \"Nil\";\n    };\n    return parseTree();\n};\n\nconsole.log(JSON.stringify(parse(string)));\n</code></pre>\n\n<p>Here, <code>getInt</code> is side-effective: it gets the next int from the string. We could easily and elegantly translate this to Haskell using Parsec or similar - but for better understanding, I skipped those and defined a stripped down parser type:</p>\n\n<pre><code>data Parser res = GetInt (Int -&gt; Parser res) | Return res\nrunParser (GetInt fn) (c:cs) = runParser (fn c) cs\nrunParser (Return res) c     = res\n</code></pre>\n\n<p>This works similar to a monadic parser, except more explicitly:</p>\n\n<pre><code>main = do\n    let parsePair = (GetInt (\\a -&gt; (GetInt (\\b -&gt; Return (a,b)))))\n    print $ runParser parsePair [1,2,3,4,5] \n</code></pre>\n\n<p>Using this, we could define our parser without side effects:</p>\n\n<pre><code>data Tree = Node Int [Tree] deriving Show\n\nparseTree = treeParser Return where\n    treeParser = (\\ cont -&gt; \n        GetInt (\\ _ -&gt;  \n            GetInt (\\ tag -&gt; \n                listParser (\\ listParsingResult -&gt; \n                    (cont (Node tag listParsingResult)))))) \n    listParser = (\\ cont -&gt; \n        GetInt (\\ a -&gt; \n            if a == 0 \n                then treeParser (\\x -&gt; listParser (\\y -&gt; cont (x : y)))\n                else cont []))\n\nmain = do\n    let treeData = [0,10,0,0,20,1,0,0,30,1,0,0,40,1,1]\n    print $ runParser parseTree treeData\n</code></pre>\n\n<p>This outputs <code>Node 10 [Node 20 [],Node 30 [],Node 40 []]</code>, as expected. Notice this still uses recursion, and I had to use <code>cont</code> to pass the control between the two recursive functions. Now, there are 2 strategies to get rid of recursion I'm aware of: </p>\n\n<pre><code>1. Use folds.\n\n2. Use church numbers for bounded recursion.\n</code></pre>\n\n<p>Using folds is obviously not viable here, since there is no structure to fold on (we are building it!). If we were parsing a list instead of a Tree, using church numbers would be perfect since they work exactly like the Y-combinator for bounded recursion - and, knowing the length of the list, we could just write <code>toChurch listLength listParser init</code>. The problem with this case, though, is that there is mutual recursion going on, and it is not obvious which church number to use. We have many layers of lists and trees of unpredictable lengths. Indeed, if we use a big enough church number, it works without recursion, but at the cost of added work. This is one of the last examples of an actually useful program I couldn't replicate \"correctly\" without recursion. Can it be done? </p>\n\n<p>For completeness, here is a JavaScript program which parses that tree without recursion, but using made-up church numbers:</p>\n\n<pre><code>function runParser(f){return function(str){\n    var a = f(str[0]);\n    return a(str.slice(1));\n}};\nfunction Const(a){return function(b){return a}};\nfunction toChurch(n){return (function(f){return (function(a){ \n    for (var i=0; i&lt;n; ++i) \n        a  =  f(a); \n    return a; \n}) }) };\nfunction parser(get){\n    return toChurch(50)(function(rec){\n        return function (res){\n            return get(function(a){\n                return [get(function(b){\n                    return toChurch(50)(function(recl){\n                        return function(res){\n                            return get(function(a){\n                                return [\n                                    rec(function(a){\n                                        return recl(function(b){\n                                            return res([\"Cons\",a,b])\n                                        })\n                                    }),\n                                    res(\"Nil\")][a];\n                            });\n                        };\n                    })(0)(function(x){return res([\"Node\",b,x])});\n                })][a];\n            });\n        };\n    })(0)(Const);\n};\nvar string = [0,200,0,0,300,0,0,400,1,0,0,500,1,0,0,500,1,1,0,0,600,0,0,700,1,0,0,800,1,0,0,900,1,1,1];\nconsole.log(JSON.stringify(parser(runParser)(string)));\n</code></pre>\n\n<p>Notice that <code>50</code> constant inside the <code>parser</code> function: it is completely arbitrary as a bound. I'm not sure there are \"right\" choices for those which would \"fit perfectly\" a specific parseable value.</p>\n"}, {"tags": ["haskell", "ghc"], "comments": [{"owner": {"reputation": 13807, "user_id": 2407038, "user_type": "registered", "accept_rate": 64, "profile_image": "https://www.gravatar.com/avatar/538f6f4a9aa43841841de7d8e8b169fc?s=128&d=identicon&r=PG&f=1", "display_name": "user2407038", "link": "https://stackoverflow.com/users/2407038/user2407038"}, "edited": false, "score": 4, "creation_date": 1436203687, "post_id": 31251163, "comment_id": 50500990, "body": "<a href=\"https://downloads.haskell.org/~ghc/latest/docs/html/users_guide/type-class-extensions.html#instance-rules\" rel=\"nofollow noreferrer\">Here</a> is the relevant section in the ghc user guide. Flexible contexts allows class instance contexts to be something other than <code>C0 a0, C1 a1 ... Cn an</code>, where <code>C</code> is a class and <code>a</code> is a type variable mentioned in the instance head. It exists because sometimes very complex constraints are needed to properly express your program logic - this is essentially the motivation behind <i>all</i> typechecker extensions."}], "answers": [{"comments": [{"owner": {"reputation": 11366, "user_id": 3922954, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/76ba47d2fdd24ab56b0b273cce2075e5?s=128&d=identicon&r=PG&f=1", "display_name": "AJF", "link": "https://stackoverflow.com/users/3922954/ajf"}, "edited": false, "score": 3, "creation_date": 1436216309, "post_id": 31252435, "comment_id": 50507992, "body": "I found the <code>Show</code> instance for the <a href=\"https://hackage.haskell.org/package/free-3.2/docs/Control-Monad-Free.html\" rel=\"nofollow noreferrer\">Free monad</a> quite a good example of this extension&#39;s uses."}, {"owner": {"reputation": 12386, "user_id": 121828, "user_type": "registered", "accept_rate": 39, "profile_image": "https://www.gravatar.com/avatar/f357c6ead80f1f23ef621e7775810268?s=128&d=identicon&r=PG", "display_name": "Sam", "link": "https://stackoverflow.com/users/121828/sam"}, "edited": false, "score": 1, "creation_date": 1451473398, "post_id": 31252435, "comment_id": 56797523, "body": "So why is this apparently useful feature not enabled by default?"}, {"owner": {"reputation": 3611, "user_id": 1029158, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/YmuXk.jpg?s=128&g=1", "display_name": "DiegoNolan", "link": "https://stackoverflow.com/users/1029158/diegonolan"}, "edited": false, "score": 1, "creation_date": 1451508744, "post_id": 31252435, "comment_id": 56816048, "body": "It isn&#39;t part of the Haskell standard so it isn&#39;t enabled by default. It is a GHC specific extension."}], "tags": [], "owner": {"reputation": 3611, "user_id": 1029158, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/YmuXk.jpg?s=128&g=1", "display_name": "DiegoNolan", "link": "https://stackoverflow.com/users/1029158/diegonolan"}, "is_accepted": true, "score": 63, "last_activity_date": 1567040973, "last_edit_date": 1567040973, "creation_date": 1436205026, "answer_id": 31252435, "question_id": 31251163, "link": "https://stackoverflow.com/questions/31251163/what-is-the-flexiblecontexts-extension-good-for-could-you-please-explain-it-usi/31252435#31252435", "title": "What is the FlexibleContexts extension good for? Could you please explain it using a simple example?", "body": "<p>Without <code>FlexibleContexts</code> all typeclass constraints on function definitions must have type variables. For example:</p>\n\n<pre><code>add :: Num a =&gt; a -&gt; a -&gt; a \nadd = (+)\n</code></pre>\n\n<p>Where <code>a</code> is the type variable. With <code>FlexibleContexts</code> enabled you can have any type inside a typeclass.</p>\n\n<pre><code>intAdd :: Num Int =&gt; Int -&gt; Int -&gt; Int \nintAdd = (+)\n</code></pre>\n\n<p>This example is pretty contrived but it is the simplest I can think of. <code>FlexibleContexts</code> is usually only used with <code>MultiParamTypeClasses</code>. Here is an example:</p>\n\n<pre><code>class Shower a b where\n  myShow :: a -&gt; b\n\ndoSomething :: Shower a String =&gt; a -&gt; String\ndoSomething = myShow\n</code></pre>\n\n<p>Here you can see we say that we only want a <code>Shower a String</code>. Without <code>FlexibleContexts</code> <code>String</code> would have to be a type variable instead of a concrete type.</p>\n"}, {"tags": [], "owner": {"reputation": 51584, "user_id": 839246, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/9b0573c2b936b12828dd1e4cc04206dc?s=128&d=identicon&r=PG&f=1", "display_name": "bheklilr", "link": "https://stackoverflow.com/users/839246/bheklilr"}, "is_accepted": false, "score": 8, "last_activity_date": 1436207279, "last_edit_date": 1495535472, "creation_date": 1436207279, "answer_id": 31253041, "question_id": 31251163, "link": "https://stackoverflow.com/questions/31251163/what-is-the-flexiblecontexts-extension-good-for-could-you-please-explain-it-usi/31253041#31253041", "title": "What is the FlexibleContexts extension good for? Could you please explain it using a simple example?", "body": "<p>Commonly it's used with the <code>MultiParamTypeClasses</code> extension, for example when using the <code>mtl</code> library you might write</p>\n\n<pre><code>doSomethingWithState :: MonadState MyState m =&gt; m ()\ndoSomethingWithState = do\n    current &lt;- get\n    let something1 = computeSomething1 current\n        something2 = computeSomething2 current something1\n    put something2\n</code></pre>\n\n<p>And similarly with <code>MonadReader</code> and <code>MonadWriter</code>, along with other similar typeclasses.  Without <code>FlexibleContexts</code> you can't use this constraint.</p>\n\n<p>(Note that this answer was based on <a href=\"https://stackoverflow.com/a/31252435/839246\">@DiegoNolan's</a> but rewritten to use an existing library that should make sense to LYAH readers).</p>\n"}, {"tags": [], "owner": {"reputation": 12493, "user_id": 106906, "user_type": "registered", "accept_rate": 78, "profile_image": "https://www.gravatar.com/avatar/d246a4b19295137980d6c6f831eba665?s=128&d=identicon&r=PG", "display_name": "Dogweather", "link": "https://stackoverflow.com/users/106906/dogweather"}, "is_accepted": false, "score": 6, "last_activity_date": 1535870506, "creation_date": 1535870506, "answer_id": 52134614, "question_id": 31251163, "link": "https://stackoverflow.com/questions/31251163/what-is-the-flexiblecontexts-extension-good-for-could-you-please-explain-it-usi/52134614#52134614", "title": "What is the FlexibleContexts extension good for? Could you please explain it using a simple example?", "body": "<p>I've discovered a use for it apart from those mentioned: it results in clearer error messages from GHC. E.g. normally,</p>\n\n<pre><code>Prelude&gt; max (1, 2) 3\n\n&lt;interactive&gt;:1:1: error:\n    \u2022 Non type-variable argument in the constraint: Num (a, b)\n      (Use FlexibleContexts to permit this)\n    \u2022 When checking the inferred type\n        it :: forall a b.\n              (Num (a, b), Num b, Num a, Ord b, Ord a) =&gt;\n              (a, b)\n</code></pre>\n\n<p>And with FlexibleContexts enabled:</p>\n\n<pre><code>Prelude&gt; max (1, 2) 3\n\n&lt;interactive&gt;:1:1: error:\n    \u2022 No instance for (Num (Integer, Integer))\n        arising from a use of \u2018it\u2019\n    \u2022 In the first argument of \u2018print\u2019, namely \u2018it\u2019\n      In a stmt of an interactive GHCi command: print it\n</code></pre>\n\n<p>Here's <a href=\"https://www.reddit.com/r/haskellquestions/comments/9c98hk/help_understanding_the_error_message_for_max_1_2_3/\" rel=\"noreferrer\">a discussion</a>.</p>\n"}, {"tags": [], "owner": {"reputation": 44013, "user_id": 1477667, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/trgKM.jpg?s=128&g=1", "display_name": "dfeuer", "link": "https://stackoverflow.com/users/1477667/dfeuer"}, "is_accepted": false, "score": 2, "last_activity_date": 1567186008, "creation_date": 1567186008, "answer_id": 57730965, "question_id": 31251163, "link": "https://stackoverflow.com/questions/31251163/what-is-the-flexiblecontexts-extension-good-for-could-you-please-explain-it-usi/57730965#57730965", "title": "What is the FlexibleContexts extension good for? Could you please explain it using a simple example?", "body": "<p><code>FlexibleContexts</code> is often used with type families. For example, when using <code>GHC.Generics</code>, it's common to see signatures like</p>\n\n<pre><code>foo :: (Generic a, GFoo (Rep a)) =&gt; Int -&gt; a -&gt; a\n</code></pre>\n\n<p>This can be seen as a variation of the <code>MultiParamTypeClasses</code> usage:</p>\n\n<pre><code>class (Generic a, rep ~ Rep a) =&gt; MPGeneric rep a\ninstance (Generic a, rep ~ Rep a) =&gt; MPGeneric rep a\n\nmpFoo :: (MPGeneric rep a, GFoo rep) =&gt; Int -&gt; a -&gt; a\n</code></pre>\n\n<p>As <a href=\"https://stackoverflow.com/questions/31251163/what-is-the-flexiblecontexts-extension-good-for-could-you-please-explain-it-usi#comment50507992_31252435\">AJFarmar pointed out</a>, <code>FlexibleContexts</code> is also useful with neither MPTCs nor type families. Here's a simple example:</p>\n\n<pre><code>newtype Ap f a = Ap (f a)\nderiving instance Show (f a) =&gt; Show (Ap f a)\n</code></pre>\n\n<p>The alternative approach using <code>Show1</code> is significantly more awkward.</p>\n\n<p>A more involved example is provided by AJFarmar's comment:</p>\n\n<pre><code>data Free f a = Pure a | Free (f (Free f a))\nderiving instance (Show a, Show (f (Free f a))) =&gt; Show (Free f a)\n</code></pre>\n\n<p>This brings in <code>UndecidableInstances</code> as well, since it's recursive, but it does a good job of explaining just what it needs to be able to show <code>Free f a</code>. In bleeding-edge GHC Haskell, an alternative would be to use <code>QuantifiedConstraints</code>:</p>\n\n<pre><code>deriving instance (Show a, forall x. Show x =&gt; Show (f x)) =&gt; Show (Free f a)\n</code></pre>\n\n<p>but this is overkill because we only need to show <code>f</code> applied to <code>Free f a</code>.</p>\n"}], "owner": {"reputation": 18456, "user_id": 1198559, "user_type": "registered", "accept_rate": 70, "profile_image": "https://i.stack.imgur.com/bOjLe.png?s=128&g=1", "display_name": "jhegedus", "link": "https://stackoverflow.com/users/1198559/jhegedus"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 12072, "favorite_count": 10, "accepted_answer_id": 31252435, "answer_count": 4, "score": 42, "last_activity_date": 1579452392, "creation_date": 1436200636, "last_edit_date": 1579452392, "question_id": 31251163, "link": "https://stackoverflow.com/questions/31251163/what-is-the-flexiblecontexts-extension-good-for-could-you-please-explain-it-usi", "title": "What is the FlexibleContexts extension good for? Could you please explain it using a simple example?", "body": "<p>I was trying to understand what the FlexibleContexts extension is doing by searching for web pages that would explain it to mere mortals (people who have read LYHFGG, for example, like me) but I did not find any such resource.</p>\n\n<p><strong>Therefore</strong> I ask the experts on the topic: Could you please explain what this extension does, why it exists, and give one or two simple examples how and why one should use it?</p>\n\n<p><strong>Furthermore</strong>, If I am reading someone else's code <a href=\"https://github.com/ryantrinkle/reflex/blob/develop/test/Reflex/Test/CrossImpl.hs\" rel=\"noreferrer\">which</a> uses this extension, then what should I know about the extension in order to understand the code written using this extension?</p>\n"}, {"tags": ["haskell"], "answers": [{"comments": [{"owner": {"reputation": 13807, "user_id": 2407038, "user_type": "registered", "accept_rate": 64, "profile_image": "https://www.gravatar.com/avatar/538f6f4a9aa43841841de7d8e8b169fc?s=128&d=identicon&r=PG&f=1", "display_name": "user2407038", "link": "https://stackoverflow.com/users/2407038/user2407038"}, "edited": false, "score": 3, "creation_date": 1436203836, "post_id": 31249268, "comment_id": 50501073, "body": "Your definition of <code>Tree</code> gives a distinctly different datatype than the original definition of <code>Tree</code>. Something like <code>data Tree a = Tree a [Tree a] | Leaf a</code> would more closely match the original."}], "tags": [], "owner": {"reputation": 58792, "user_id": 1006010, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/f683d229f3673c9dcc3f3f2796d75c09?s=128&d=identicon&r=PG", "display_name": "MathematicalOrchid", "link": "https://stackoverflow.com/users/1006010/mathematicalorchid"}, "is_accepted": true, "score": 8, "last_activity_date": 1436195087, "creation_date": 1436195087, "answer_id": 31249268, "question_id": 31249175, "link": "https://stackoverflow.com/questions/31249175/can-i-partially-derive-show/31249268#31249268", "title": "Can I partially derive Show?", "body": "<p>The only way I can see to do this is to separate into two types.</p>\n\n<pre><code>data Tree node = Tree node [Tree node]\ndata Node = A | B | C deriving Show\n\ninstance Show node =&gt; Show (Tree node) where ....\n</code></pre>\n"}, {"tags": [], "owner": {"reputation": 531, "user_id": 548027, "user_type": "registered", "accept_rate": 20, "profile_image": "https://www.gravatar.com/avatar/d8e89f41f702a6504b25edf6b9ca190d?s=128&d=identicon&r=PG", "display_name": "Adam R. Nelson", "link": "https://stackoverflow.com/users/548027/adam-r-nelson"}, "is_accepted": false, "score": 1, "last_activity_date": 1436221450, "creation_date": 1436221450, "answer_id": 31256708, "question_id": 31249175, "link": "https://stackoverflow.com/questions/31249175/can-i-partially-derive-show/31256708#31256708", "title": "Can I partially derive Show?", "body": "<p>Following MathematicalOrchid's reponse, the best way to do this is with a new type, but here's a better way to organize the types:</p>\n\n<pre><code>data Node = Leaf Leaf | Tree Node [Node] deriving Eq\ndata Leaf = A | B | C deriving (Eq, Show)\n\ninstance Show Node where\n  show (Tree node children) = printTree (Tree node children)\n  show (Leaf l) = show l\n</code></pre>\n"}], "owner": {"reputation": 5535, "user_id": 644812, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/11e9cf1828ab0f637b86cb71f7fda9dc?s=128&d=identicon&r=PG", "display_name": "default.kramer", "link": "https://stackoverflow.com/users/644812/default-kramer"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 197, "favorite_count": 0, "accepted_answer_id": 31249268, "answer_count": 2, "score": 5, "last_activity_date": 1436221450, "creation_date": 1436194829, "question_id": 31249175, "link": "https://stackoverflow.com/questions/31249175/can-i-partially-derive-show", "title": "Can I partially derive Show?", "body": "<p>I have written this code to pretty-print a tree:</p>\n\n<pre><code>data Node = A | B | C | Tree Node [Node]\n    deriving (Show, Eq)\n\nprintTree' :: Int -&gt; Node -&gt; [String]\nprintTree' spaceCount (Tree node children) = (printTree' spaceCount node)\n    ++ concat (map (\\child -&gt; printTree' (spaceCount+2) child) children)\nprintTree' spaceCount leaf = [(replicate spaceCount ' ') ++ (show leaf)]\n\nprintTree :: Node -&gt; String\nprintTree node = unlines (printTree' 0 node)\n</code></pre>\n\n<p>Example output:</p>\n\n<pre><code>*Main&gt; putStr $ printTree $ Tree A [Tree A [A,B,C], C]\nA\n  A\n    A\n    B\n    C\n  C\n</code></pre>\n\n<p>Now I would like to make this the implementation for <code>show</code>. This approach is close but I can't find a way to call the built-in <code>show</code>:</p>\n\n<pre><code>instance Show Node where\n    show (Tree node children) = printTree (Tree node children)\n    show _ = \"node... can I call the built-in show here?\"\n</code></pre>\n\n<p>(In this example, I could just deal with A, B, and C. But in the real code, there are many node types.)</p>\n"}, {"tags": ["sqlite", "csv", "haskell"], "comments": [{"owner": {"reputation": 36513, "user_id": 752976, "user_type": "registered", "accept_rate": 84, "profile_image": "https://i.stack.imgur.com/j7Uis.jpg?s=128&g=1", "display_name": "Bartek Banachewicz", "link": "https://stackoverflow.com/users/752976/bartek-banachewicz"}, "edited": false, "score": 0, "creation_date": 1436176078, "post_id": 31241933, "comment_id": 50482868, "body": "Google just for <code>Couldn&#39;t match type \u2018[Char]\u2019 with \u2018ByteString\u2019</code>.<code>ByteString</code> isn&#39;t a <code>String</code>, but conversion utilities exist."}, {"owner": {"reputation": 20862, "user_id": 376113, "user_type": "registered", "accept_rate": 72, "profile_image": "https://www.gravatar.com/avatar/d3a5bd12fe6d876527a3cf4ac0de5fc6?s=128&d=identicon&r=PG", "display_name": "mb14", "link": "https://stackoverflow.com/users/376113/mb14"}, "edited": false, "score": 0, "creation_date": 1436204218, "post_id": 31241933, "comment_id": 50501272, "body": "Note that instanciating <code>ToField UTCTime</code> is not recommended in package as it&#39;s an <code>orphan instance</code> and will leak in everywhere."}, {"owner": {"reputation": 23, "user_id": 2593288, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/b921e3d89427828c068af5e173ad2f07?s=128&d=identicon&r=PG", "display_name": "crito", "link": "https://stackoverflow.com/users/2593288/crito"}, "reply_to_user": {"reputation": 20862, "user_id": 376113, "user_type": "registered", "accept_rate": 72, "profile_image": "https://www.gravatar.com/avatar/d3a5bd12fe6d876527a3cf4ac0de5fc6?s=128&d=identicon&r=PG", "display_name": "mb14", "link": "https://stackoverflow.com/users/376113/mb14"}, "edited": false, "score": 0, "creation_date": 1436249534, "post_id": 31241933, "comment_id": 50517637, "body": "@mb14, I <i>think</i> I half understand the issue of orphan instances. My little script reads data from a SQLite file, runs a serious of transformations and dumps it again in CSV format. Does this mean, to prevent orphan instances, I have to define different types for every stage and convert between the types? Or how else should I convert dates to strings than instantiating <code>ToField UTCTime</code>?"}, {"owner": {"reputation": 20862, "user_id": 376113, "user_type": "registered", "accept_rate": 72, "profile_image": "https://www.gravatar.com/avatar/d3a5bd12fe6d876527a3cf4ac0de5fc6?s=128&d=identicon&r=PG", "display_name": "mb14", "link": "https://stackoverflow.com/users/376113/mb14"}, "edited": false, "score": 0, "creation_date": 1436296396, "post_id": 31241933, "comment_id": 50548666, "body": "The problem of <code>orphan instance</code> is if you need write another script similar but uses a different format for date (and therefore define a difference instace of <code>ToField UTC</code> )and then you decide to write a 3rd script which uses both, (let&#39;s say you need to read two csv and join them) then the <code>ToField UTCTime</code> instances of both file will collide and there is no way resolve this collision. How to avoid it ? Just a write a date function conversion somewhere and use it directly in your <code>fromRow</code> definition : <code>fromRow = Visit &lt;$&gt; field &lt;*&gt; fieldDate &lt;*&gt; field ...</code>."}], "answers": [{"comments": [{"owner": {"reputation": 23, "user_id": 2593288, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/b921e3d89427828c068af5e173ad2f07?s=128&d=identicon&r=PG", "display_name": "crito", "link": "https://stackoverflow.com/users/2593288/crito"}, "edited": false, "score": 1, "creation_date": 1436196266, "post_id": 31247393, "comment_id": 50496600, "body": "Thanks @Bzzt, that helped a lot. I didn&#39;t have to enable the <code>OverloadedStrings</code> Language extension but converting the <code>String</code> to a <code>ByteString</code> worked. I added the import: <code>import Data.ByteString.Char8 (pack)</code> and changed the instance to <code>toField t = pack $ formatTime defaultTimeLocale &quot;%d-%m-%Y %H:%M:%S&quot; t</code>. Great."}], "tags": [], "owner": {"reputation": 1044, "user_id": 476114, "user_type": "registered", "accept_rate": 78, "profile_image": "https://www.gravatar.com/avatar/18db9bf4cb83fb9c8f30aeb53b3ccfae?s=128&d=identicon&r=PG", "display_name": "Bzzt", "link": "https://stackoverflow.com/users/476114/bzzt"}, "is_accepted": true, "score": 0, "last_activity_date": 1436191847, "last_edit_date": 1436191847, "creation_date": 1436189993, "answer_id": 31247393, "question_id": 31241933, "link": "https://stackoverflow.com/questions/31241933/convert-utctime-to-csv-field-with-haskell-cassava/31247393#31247393", "title": "Convert UTCTime to CSV field with Haskell/cassava", "body": "<p>Have you tried {-# LANGUAGE OverloadedStrings #-} in your History.Types file?  Not sure if that would work, but maybe worth a try.  </p>\n\n<p>ToField has to return a ByteString because it returns a Field, and a Field IS a ByteString:</p>\n\n<p><a href=\"http://haddock.stackage.org/lts-2.17/cassava-0.4.3.0/Data-Csv.html#t:Field\" rel=\"nofollow\">http://haddock.stackage.org/lts-2.17/cassava-0.4.3.0/Data-Csv.html#t:Field</a></p>\n\n<p>You are calling formatTime correctly, its just that formatTime returns a String and not a ByteString.  </p>\n\n<p>You can directly convert with <a href=\"http://www.stackage.org/lts-2.17/hoogle?q=String%20-%3E%20ByteString\" rel=\"nofollow\">fromString or pack</a>.  So just call formatTime like you are now and convert the result.  </p>\n"}, {"comments": [{"owner": {"reputation": 23, "user_id": 2593288, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/b921e3d89427828c068af5e173ad2f07?s=128&d=identicon&r=PG", "display_name": "crito", "link": "https://stackoverflow.com/users/2593288/crito"}, "edited": false, "score": 0, "creation_date": 1436249642, "post_id": 31249557, "comment_id": 50517689, "body": "Thanks @Reite. It&#39;s my first time using a strictly typed language, it still is quite mind boggling to me. You solution feels very elegant."}], "tags": [], "owner": {"reputation": 1585, "user_id": 1413081, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/1d8d1f596731eaae04f3ade303d211ca?s=128&d=identicon&r=PG", "display_name": "Reite", "link": "https://stackoverflow.com/users/1413081/reite"}, "is_accepted": false, "score": 2, "last_activity_date": 1436195907, "creation_date": 1436195907, "answer_id": 31249557, "question_id": 31241933, "link": "https://stackoverflow.com/questions/31241933/convert-utctime-to-csv-field-with-haskell-cassava/31249557#31249557", "title": "Convert UTCTime to CSV field with Haskell/cassava", "body": "<p>Your problem is that <code>toField</code> has the signature <code>a -&gt; Field</code>. If you look at the <code>Field</code> type its definition is <code>type Field = ByteString</code>. The result of <code>formatTime</code> is a <code>String</code>. So the problem is that you provide a <code>String</code> where a <code>ByteString</code> is expected.</p>\n\n<p>Since <code>String</code> is a very common type the first thing you should do is to check if there is already an instance for <code>ToField String</code> you can use. If you look at <a href=\"https://hackage.haskell.org/package/cassava-0.4.3.0/docs/Data-Csv.html#t:ToField\" rel=\"nofollow\">the definition</a> there is. This means that you can specialize the <code>toField</code> function to have the signature <code>String -&gt; Field</code> and the use it like this:</p>\n\n<pre><code>instance ToField UTCTime where\n      toField = toField . formatTime defaultTimeLocale \"%d-%m-%Y %H:%M:%S\"\n</code></pre>\n"}], "owner": {"reputation": 23, "user_id": 2593288, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/b921e3d89427828c068af5e173ad2f07?s=128&d=identicon&r=PG", "display_name": "crito", "link": "https://stackoverflow.com/users/2593288/crito"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 364, "favorite_count": 1, "accepted_answer_id": 31247393, "answer_count": 2, "score": 1, "last_activity_date": 1436195907, "creation_date": 1436174108, "last_edit_date": 1436175075, "question_id": 31241933, "link": "https://stackoverflow.com/questions/31241933/convert-utctime-to-csv-field-with-haskell-cassava", "title": "Convert UTCTime to CSV field with Haskell/cassava", "body": "<p>I started learning Haskell and I try to query data from a SQLite file and dump it again as CSV. I have an issue formating <code>UTCTime</code> fields, so that <code>cassava</code> can format it correctly. This is my type:</p>\n\n<pre><code>    module History.Types\n      (Visit)\n      where\n\n    import Data.ByteString as B\n    import Data.Csv\n    import Data.Text (Text)\n    import Data.Time\n    import Data.Time.Format\n    import Database.SQLite.Simple.FromRow\n\n    data Visit = Visit\n      { url :: Text\n      , title :: Text\n      , visit_count :: Int\n      , typed_count :: Int\n      , last_visit_time :: UTCTime\n      , visit_time :: UTCTime\n      , from_visit :: Int\n      }\n      deriving (Show)\n\n    instance FromRow Visit where\n      fromRow = Visit &lt;$&gt; field\n                      &lt;*&gt; field\n                      &lt;*&gt; field\n                      &lt;*&gt; field\n                      &lt;*&gt; field\n                      &lt;*&gt; field\n                      &lt;*&gt; field\n\n    instance ToField UTCTime where\n      toField t = formatTime defaultTimeLocale \"%d-%m-%Y %H:%M:%S\" t\n\n    instance ToRecord Visit where\n      toRecord (Visit url\n                      title\n                      visit_count\n                      typed_count\n                      last_visit_time\n                      visit_time\n                      from_visit) = record [ toField visit_time\n                                           , toField url\n                                           , toField title\n                                           , toField visit_count\n                                           , toField typed_count\n                                           , toField from_visit\n                                           , toField last_visit_time\n                                           ]\n</code></pre>\n\n<p>And my SQLite code:</p>\n\n<pre><code>    {-# LANGUAGE OverloadedStrings #-}\n\n    module History.DB\n      (queryHistory)\n      where\n\n    import History.Types (Visit)\n\n    import Data.Text (Text)\n    import Database.SQLite.Simple (open, query_, close, Query)\n\n    q :: Query\n    q = \"\\\n    \\SELECT urls.url \\\n    \\     , urls.title \\\n    \\     , urls.visit_count \\\n    \\     , urls.typed_count \\\n    \\     , datetime(urls.last_visit_time/1000000-11644473600,'unixepoch','localtime') \\\n    \\     , datetime(visits.visit_time/1000000-11644473600,'unixepoch','localtime') \\\n    \\     , visits.from_visit \\\n    \\FROM urls, visits \\\n    \\WHERE urls.id = visits.id \\\n    \\ORDER BY visits.visit_time\"\n\n    queryHistory :: FilePath -&gt; IO [Visit]\n    queryHistory dbPath =\n      do conn &lt;- open dbPath\n         history &lt;- query_ conn q\n         close conn\n         return history\n</code></pre>\n\n<p>Compiling this code leads to the following error:</p>\n\n<pre><code>    src/History/Types.hs:34:15:\n        Couldn't match type \u2018[Char]\u2019 with \u2018ByteString\u2019\n          Expected type: Field\n          Actual type: String\n        In the expression:\n          formatTime defaultTimeLocale \"%d-%m-%Y %H:%M:%S\" t\n        In an equation for \u2018toField\u2019:\n          toField t = formatTime defaultTimeLocale \"%d-%m-%Y %H:%M:%S\" t\n</code></pre>\n\n<p>So clearly I make a mess with when formatting the date type into a string. I look at the type information of <a href=\"https://downloads.haskell.org/~ghc/latest/docs/html/libraries/time/Data-Time-Format.html\" rel=\"nofollow\"><code>formatTime</code></a> and don't really understand why my <code>String</code> (I assume the error relates to the date formatting string) has to be a <code>ByteString</code>. So my questions are:</p>\n\n<ol>\n<li>Is the error related to the time formatting string, and if yes, why is a regular string not working?</li>\n<li>Is this the right way to format date types to be written to a CSV file using <code>cassava</code>? </li>\n</ol>\n"}, {"tags": ["haskell", "interpolation", "yesod", "shakespeare-text"], "comments": [{"owner": {"reputation": 6942, "user_id": 1540749, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/dd6c24a0bc5c0a59a456aa8b08a78b6a?s=128&d=identicon&r=PG", "display_name": "josejuan", "link": "https://stackoverflow.com/users/1540749/josejuan"}, "edited": false, "score": 2, "creation_date": 1436170269, "post_id": 31240477, "comment_id": 50479265, "body": "Are you including <code>$(widgetFile &quot;homepage&quot;)</code> in some other handler? (what&#39;s in line number 37?)"}, {"owner": {"reputation": 58792, "user_id": 1006010, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/f683d229f3673c9dcc3f3f2796d75c09?s=128&d=identicon&r=PG", "display_name": "MathematicalOrchid", "link": "https://stackoverflow.com/users/1006010/mathematicalorchid"}, "edited": false, "score": 0, "creation_date": 1436172429, "post_id": 31240477, "comment_id": 50480481, "body": "Is this a Template Haskell staging restriction? (TH requires that any function you call is defined in a separate module - because otherwise it won&#39;t be compiled yet.)"}, {"owner": {"reputation": 827, "user_id": 1276388, "user_type": "registered", "accept_rate": 93, "profile_image": "https://www.gravatar.com/avatar/4ae985df9e533570f5ac2ea9bfc25dfd?s=128&d=identicon&r=PG", "display_name": "\u0397\u03bb\u03b5\u03ba\u03c4\u03c1\u03bf\u03bb\u03cc\u03b3\u03bf\u03c2 \u039c\u03b7\u03c7\u03b1\u03bd\u03b9\u03ba\u03cc\u03c2", "link": "https://stackoverflow.com/users/1276388/%ce%97%ce%bb%ce%b5%ce%ba%cf%84%cf%81%ce%bf%ce%bb%cf%8c%ce%b3%ce%bf%cf%82-%ce%9c%ce%b7%cf%87%ce%b1%ce%bd%ce%b9%ce%ba%cf%8c%cf%82"}, "reply_to_user": {"reputation": 6942, "user_id": 1540749, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/dd6c24a0bc5c0a59a456aa8b08a78b6a?s=128&d=identicon&r=PG", "display_name": "josejuan", "link": "https://stackoverflow.com/users/1540749/josejuan"}, "edited": false, "score": 0, "creation_date": 1436177570, "post_id": 31240477, "comment_id": 50483875, "body": "I removed <code>$(widgetFile &quot;homepage&quot;)</code> part in postHomeR to make it work. I don&#39;t know why it works though. Thanks for pointing that out @josejuan."}, {"owner": {"reputation": 6942, "user_id": 1540749, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/dd6c24a0bc5c0a59a456aa8b08a78b6a?s=128&d=identicon&r=PG", "display_name": "josejuan", "link": "https://stackoverflow.com/users/1540749/josejuan"}, "edited": false, "score": 1, "creation_date": 1436178477, "post_id": 31240477, "comment_id": 50484465, "body": "@\u0397\u03bb\u03b5\u03ba\u03c4\u03c1\u03bf\u03bb\u03cc\u03b3\u03bf\u03c2\u039c\u03b7\u03c7\u03b1\u03bd\u03b9\u03ba\u03cc\u03c2 &quot;I don&#39;t know why it works though&quot; think with <code>widgetFile</code> as a kind of macro expansion then, is clear why <code>randomX</code> is not defined (into <code>postHomeR</code>) :)"}, {"owner": {"reputation": 1044, "user_id": 476114, "user_type": "registered", "accept_rate": 78, "profile_image": "https://www.gravatar.com/avatar/18db9bf4cb83fb9c8f30aeb53b3ccfae?s=128&d=identicon&r=PG", "display_name": "Bzzt", "link": "https://stackoverflow.com/users/476114/bzzt"}, "edited": false, "score": 1, "creation_date": 1436211560, "post_id": 31240477, "comment_id": 50505438, "body": "if homepage.hamlet contains #{randomX}, then you have to have a randomX value in scope everywhere $(widgetFile &quot;homepage&quot;) is used.  If $(widgetFile &quot;homepage&quot;) appears in both postHomeR and getHomeR, then you need to have a randomX defined in both postHomeR and getHomeR also."}, {"owner": {"reputation": 827, "user_id": 1276388, "user_type": "registered", "accept_rate": 93, "profile_image": "https://www.gravatar.com/avatar/4ae985df9e533570f5ac2ea9bfc25dfd?s=128&d=identicon&r=PG", "display_name": "\u0397\u03bb\u03b5\u03ba\u03c4\u03c1\u03bf\u03bb\u03cc\u03b3\u03bf\u03c2 \u039c\u03b7\u03c7\u03b1\u03bd\u03b9\u03ba\u03cc\u03c2", "link": "https://stackoverflow.com/users/1276388/%ce%97%ce%bb%ce%b5%ce%ba%cf%84%cf%81%ce%bf%ce%bb%cf%8c%ce%b3%ce%bf%cf%82-%ce%9c%ce%b7%cf%87%ce%b1%ce%bd%ce%b9%ce%ba%cf%8c%cf%82"}, "reply_to_user": {"reputation": 1044, "user_id": 476114, "user_type": "registered", "accept_rate": 78, "profile_image": "https://www.gravatar.com/avatar/18db9bf4cb83fb9c8f30aeb53b3ccfae?s=128&d=identicon&r=PG", "display_name": "Bzzt", "link": "https://stackoverflow.com/users/476114/bzzt"}, "edited": false, "score": 1, "creation_date": 1436224144, "post_id": 31240477, "comment_id": 50511078, "body": "Ah, I see. Thanks @Bzzt , +josejuan"}, {"owner": {"reputation": 7297, "user_id": 1176156, "user_type": "registered", "accept_rate": 80, "profile_image": "https://www.gravatar.com/avatar/89604545aa57aa3d14306af60126e193?s=128&d=identicon&r=PG", "display_name": "MaxGabriel", "link": "https://stackoverflow.com/users/1176156/maxgabriel"}, "edited": false, "score": 0, "creation_date": 1436288817, "post_id": 31240477, "comment_id": 50544122, "body": "For anyone else running into a similar error, you can use the line number in the error message to see which call to <code>widgetFile</code> is failing (line 37, in this case)"}], "owner": {"reputation": 827, "user_id": 1276388, "user_type": "registered", "accept_rate": 93, "profile_image": "https://www.gravatar.com/avatar/4ae985df9e533570f5ac2ea9bfc25dfd?s=128&d=identicon&r=PG", "display_name": "\u0397\u03bb\u03b5\u03ba\u03c4\u03c1\u03bf\u03bb\u03cc\u03b3\u03bf\u03c2 \u039c\u03b7\u03c7\u03b1\u03bd\u03b9\u03ba\u03cc\u03c2", "link": "https://stackoverflow.com/users/1276388/%ce%97%ce%bb%ce%b5%ce%ba%cf%84%cf%81%ce%bf%ce%bb%cf%8c%ce%b3%ce%bf%cf%82-%ce%9c%ce%b7%cf%87%ce%b1%ce%bd%ce%b9%ce%ba%cf%8c%cf%82"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 215, "favorite_count": 0, "answer_count": 0, "score": 0, "last_activity_date": 1436169278, "creation_date": 1436169278, "question_id": 31240477, "link": "https://stackoverflow.com/questions/31240477/how-to-do-variable-interpolation-in-hamlet", "title": "How to do variable interpolation in hamlet?", "body": "<p>Say i want to display a random number everytime i refresh a page. Here's my code:  </p>\n\n<pre><code>...\nimport System.Random\n...\n\ngetHomeR :: Handler Html\ngetHomeR = do\n  randomX &lt;- liftIO $ randomRIO (1,999::Int)\n  defaultLayout $ do\n    setTitle \"Welcome To Yesod!\"\n    $(widgetFile \"homepage\")\n    toWidgetBody [hamlet|&lt;div&gt;#{randomX}|]\n</code></pre>\n\n<p>That works fine. </p>\n\n<p>I use the default scaffolded site. Now when I want to use  <code>#{randomX}</code> in <code>homepage.hamlet</code></p>\n\n<pre><code>&lt;div&gt;#{randomX}\n</code></pre>\n\n<p>It gives me an error </p>\n\n<pre><code>Handler/Home.hs:37:11:\nNot in scope: \u2018randomX\u2019\nPerhaps you meant one of these:\n  \u2018randomR\u2019 (imported from System.Random),\n  \u2018random\u2019 (imported from System.Random),\n  \u2018randoms\u2019 (imported from System.Random)\nIn the splice: $(widgetFile \"homepage\")\n</code></pre>\n\n<p>How do i apply variable interpolation in a hamlet file?</p>\n\n<p>Sorry for bad english.</p>\n"}, {"tags": ["haskell"], "comments": [{"owner": {"reputation": 28845, "user_id": 238232, "user_type": "registered", "accept_rate": 99, "profile_image": "https://www.gravatar.com/avatar/ccda2293fc93c7a871956102004ac19d?s=128&d=identicon&r=PG", "display_name": "cnd", "link": "https://stackoverflow.com/users/238232/cnd"}, "edited": false, "score": 0, "creation_date": 1436167516, "post_id": 31239402, "comment_id": 50477698, "body": "setPort :: Int -&gt; Config m a -&gt; Config m a ; defaultConfig :: MonadSnap m =&gt; Config m a"}], "answers": [{"tags": [], "owner": {"reputation": 1706, "user_id": 1840613, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/c2dfd4d21060ccd9b972864e0f6cb8c4?s=128&d=identicon&r=PG", "display_name": "Jeremy List", "link": "https://stackoverflow.com/users/1840613/jeremy-list"}, "is_accepted": false, "score": 4, "last_activity_date": 1436166895, "creation_date": 1436166895, "answer_id": 31239755, "question_id": 31239402, "link": "https://stackoverflow.com/questions/31239402/haskell-type-signature/31239755#31239755", "title": "Haskell type signature", "body": "<p>The <code>-&gt;</code> infix type constructor takes an argument type on the left and a result type on the right. <code>config</code> has no parameters, and it makes no sense to write <code>-&gt;</code> with nothing on the left, so the result type is the only type.</p>\n\n<p>You can do the same thing with types you're more familiar with. For example:</p>\n\n<pre><code>example1 :: Int\nexample1 = 1\n\nexample2 :: Maybe Integer\nexample2 = Just 2\n\nexample3 :: [Double]\nexample3 = [1,2,3]\n\nexample4 :: Either String Int\nexample4 = Right 4\n</code></pre>\n"}, {"comments": [{"owner": {"reputation": 1818, "user_id": 589352, "user_type": "registered", "accept_rate": 72, "profile_image": "https://www.gravatar.com/avatar/ba318b431c968c4883f4f365d989abea?s=128&d=identicon&r=PG", "display_name": "jaybee", "link": "https://stackoverflow.com/users/589352/jaybee"}, "edited": false, "score": 0, "creation_date": 1436195801, "post_id": 31239814, "comment_id": 50496264, "body": "Although <code>()</code> is used in monadic code as a placeholder to mean &quot;nothing of interest&quot;, it&#39;s better known as <i>unit</i> than <i>empty</i>, which is more accurate because it has exactly one value (not none, as empty might indicate)."}, {"owner": {"reputation": 48129, "user_id": 76051, "user_type": "registered", "accept_rate": 91, "profile_image": "https://i.stack.imgur.com/AGDxz.jpg?s=128&g=1", "display_name": "Carsten", "link": "https://stackoverflow.com/users/76051/carsten"}, "reply_to_user": {"reputation": 1818, "user_id": 589352, "user_type": "registered", "accept_rate": 72, "profile_image": "https://www.gravatar.com/avatar/ba318b431c968c4883f4f365d989abea?s=128&d=identicon&r=PG", "display_name": "jaybee", "link": "https://stackoverflow.com/users/589352/jaybee"}, "edited": false, "score": 0, "creation_date": 1436196283, "post_id": 31239814, "comment_id": 50496617, "body": "yeah of course - but in this case I think it&#39;s ok to assume that it was meant to just say there is <i>nothing of interest</i>  for <code>other</code> don&#39;t you think? (that&#39;s why I put it in cursive)"}, {"owner": {"reputation": 1818, "user_id": 589352, "user_type": "registered", "accept_rate": 72, "profile_image": "https://www.gravatar.com/avatar/ba318b431c968c4883f4f365d989abea?s=128&d=identicon&r=PG", "display_name": "jaybee", "link": "https://stackoverflow.com/users/589352/jaybee"}, "edited": false, "score": 2, "creation_date": 1436196890, "post_id": 31239814, "comment_id": 50497017, "body": "Agreed. I just pointed out the name of <code>()</code> because the OP seems to be an early beginner and may not know what people mean who read that signature aloud and pronounce it unit."}], "tags": [], "owner": {"reputation": 48129, "user_id": 76051, "user_type": "registered", "accept_rate": 91, "profile_image": "https://i.stack.imgur.com/AGDxz.jpg?s=128&g=1", "display_name": "Carsten", "link": "https://stackoverflow.com/users/76051/carsten"}, "is_accepted": false, "score": 4, "last_activity_date": 1436167062, "creation_date": 1436167062, "answer_id": 31239814, "question_id": 31239402, "link": "https://stackoverflow.com/questions/31239402/haskell-type-signature/31239814#31239814", "title": "Haskell type signature", "body": "<p>It's not really a function here - it's a value (well it's the configuration for snap): a <a href=\"https://hackage.haskell.org/package/snap-server-0.9.5.1/docs/Snap-Http-Server-Config.html#t:Config\" rel=\"nofollow\">Snap <code>Config</code></a> with the <a href=\"https://hackage.haskell.org/package/snap-core-0.9.7.0/docs/Snap-Core.html#t:Snap\" rel=\"nofollow\"><code>Snap</code></a> monad and <em>empty</em> <code>()</code> additional (<code>other</code>) information sitting on it.</p>\n\n<p>As you can read in the documentation it's more or less a starting point and you use the <a href=\"https://hackage.haskell.org/package/snap-server-0.9.5.1/docs/Snap-Http-Server-Config.html\" rel=\"nofollow\">functions here</a> to set additional informations.</p>\n\n<p>So in a sense it's just the same as writing</p>\n\n<pre><code>myInt :: Int\nmyInt = 4\n</code></pre>\n"}], "owner": {"reputation": 4829, "user_id": 1852230, "user_type": "registered", "accept_rate": 40, "profile_image": "https://www.gravatar.com/avatar/1c009726dbacdd3e428afeb48d9eef63?s=128&d=identicon&r=PG", "display_name": "jcm", "link": "https://stackoverflow.com/users/1852230/jcm"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 97, "favorite_count": 1, "answer_count": 2, "score": 2, "last_activity_date": 1436167062, "creation_date": 1436165651, "question_id": 31239402, "link": "https://stackoverflow.com/questions/31239402/haskell-type-signature", "title": "Haskell type signature", "body": "<p>I'm having trouble understanding this type signature:</p>\n\n<pre><code>config :: Config Snap ()\nconfig = setPort 8888 defaultConfig\n</code></pre>\n\n<p>Where are the <code>-&gt;</code> stating the params and return type of the function? What am I missing here?</p>\n"}, {"tags": ["haskell"], "answers": [{"tags": [], "owner": {"reputation": 1706, "user_id": 1840613, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/c2dfd4d21060ccd9b972864e0f6cb8c4?s=128&d=identicon&r=PG", "display_name": "Jeremy List", "link": "https://stackoverflow.com/users/1840613/jeremy-list"}, "is_accepted": true, "score": 3, "last_activity_date": 1436168427, "creation_date": 1436168427, "answer_id": 31240219, "question_id": 31239163, "link": "https://stackoverflow.com/questions/31239163/print-each-value-in-list-n-times/31240219#31240219", "title": "Print each value in list &quot;n&quot; times", "body": "<p>When you use the pattern <code>fn n (x:xs) = ...</code> that means <code>x</code> is the first element in the list and <code>xs</code> is the rest of the list. Your case statement is checking whether or not <code>x</code> is an empty list, but the pattern match (<code>(x:xs)</code>) already extracted it from the list. What you want is probably one of these (the compiler knows they are the same so which one you use is a matter of taste):</p>\n\n<pre><code>-- Version that uses a pattern match\nfn :: Int -&gt; [a] -&gt; [a]\nreplicate' n x = take n (repeat x)\nfn _ [] = []\nfn n (x:xs) = (replicate' n x) ++ fn n xs\n\n-- Version that uses a case statement\nfn :: Int -&gt; [a] -&gt; [a]\nreplicate' n x = take n (repeat x)\nfn n l = case l of [] -&gt; []\n                   (x:xs) -&gt;  (replicate' n x) ++ fn n xs\n</code></pre>\n\n<p>This one also \"fixes the error\", but is probably not what you actually want:</p>\n\n<pre><code>fn :: Int -&gt; [[a]] -&gt; [[a]]\nreplicate' n x = take n (repeat x)\nfn n (x:xs) = case x of [] -&gt; []\n                        (_) -&gt;  (replicate' n x) ++ fn n xs\n</code></pre>\n"}, {"comments": [{"owner": {"reputation": 28456, "user_id": 1094403, "user_type": "registered", "accept_rate": 83, "profile_image": "https://www.gravatar.com/avatar/3770aa7eae5c211921493abd0d2c9f5a?s=128&d=identicon&r=PG", "display_name": "Luis Casillas", "link": "https://stackoverflow.com/users/1094403/luis-casillas"}, "edited": false, "score": 1, "creation_date": 1436208002, "post_id": 31245678, "comment_id": 50503384, "body": "Using <code>concatMap</code> here would be a minor stylistic improvement, IMHO."}, {"owner": {"reputation": 785, "user_id": 3087558, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/a43d21bfa85dc7dc360cafa7f69ba3b1?s=128&d=identicon&r=PG&f=1", "display_name": "fgv", "link": "https://stackoverflow.com/users/3087558/fgv"}, "reply_to_user": {"reputation": 28456, "user_id": 1094403, "user_type": "registered", "accept_rate": 83, "profile_image": "https://www.gravatar.com/avatar/3770aa7eae5c211921493abd0d2c9f5a?s=128&d=identicon&r=PG", "display_name": "Luis Casillas", "link": "https://stackoverflow.com/users/1094403/luis-casillas"}, "edited": false, "score": 0, "creation_date": 1436211877, "post_id": 31245678, "comment_id": 50505597, "body": "@LuisCasillas absolutely right, concatMap would be a bit better! Anyway, I thought that a composition of independent concat and map would be easier to understand, since the OP says that basic constructs are preferred."}], "tags": [], "owner": {"reputation": 785, "user_id": 3087558, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/a43d21bfa85dc7dc360cafa7f69ba3b1?s=128&d=identicon&r=PG&f=1", "display_name": "fgv", "link": "https://stackoverflow.com/users/3087558/fgv"}, "is_accepted": false, "score": 3, "last_activity_date": 1436185173, "creation_date": 1436185173, "answer_id": 31245678, "question_id": 31239163, "link": "https://stackoverflow.com/questions/31239163/print-each-value-in-list-n-times/31245678#31245678", "title": "Print each value in list &quot;n&quot; times", "body": "<p>Jeremy List's explanation directly addresses the OP's question. However, sometimes structured recursion provides a more elegant solution to problems. In this case, for example, this one liner does exactly what the OP asks:</p>\n\n<pre><code>fn :: Int -&gt; [a] -&gt; [a]\nfn n = concat . map (replicate n)\n</code></pre>\n\n<p>In sum, <em>map</em> lifts <em>replicate</em> to operate in values of the list, and <em>concat</em> concatenates the resulting list of lists.</p>\n\n<p>I hope this helps. </p>\n"}, {"comments": [{"owner": {"reputation": 865, "user_id": 3694032, "user_type": "registered", "accept_rate": 82, "profile_image": "https://www.gravatar.com/avatar/32d8fabde29edf207ac92275275af90a?s=128&d=identicon&r=PG&f=1", "display_name": "rem", "link": "https://stackoverflow.com/users/3694032/rem"}, "edited": false, "score": 0, "creation_date": 1436276190, "post_id": 31252266, "comment_id": 50534743, "body": "great answer! reveals how list is a monad"}], "tags": [], "owner": {"reputation": 20862, "user_id": 376113, "user_type": "registered", "accept_rate": 72, "profile_image": "https://www.gravatar.com/avatar/d3a5bd12fe6d876527a3cf4ac0de5fc6?s=128&d=identicon&r=PG", "display_name": "mb14", "link": "https://stackoverflow.com/users/376113/mb14"}, "is_accepted": false, "score": 1, "last_activity_date": 1436277550, "last_edit_date": 1436277550, "creation_date": 1436204451, "answer_id": 31252266, "question_id": 31239163, "link": "https://stackoverflow.com/questions/31239163/print-each-value-in-list-n-times/31252266#31252266", "title": "Print each value in list &quot;n&quot; times", "body": "<p>Using do notation</p>\n\n<pre><code>replicate' n xs = do\n      x  &lt;- xs\n      replicate n x\n</code></pre>\n\n<p>which can be written as</p>\n\n<pre><code>replicate' n xs = xs &gt;&gt;= replicate n\n</code></pre>\n\n<p>or </p>\n\n<pre><code>replicate' n = (&gt;&gt;= replicate n)\n</code></pre>\n"}], "owner": {"reputation": 625, "user_id": 3970193, "user_type": "registered", "accept_rate": 67, "profile_image": "https://www.gravatar.com/avatar/c8603ff901556ada8180282750eda599?s=128&d=identicon&r=PG", "display_name": "Gaara", "link": "https://stackoverflow.com/users/3970193/gaara"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 1520, "favorite_count": 0, "accepted_answer_id": 31240219, "answer_count": 3, "score": 0, "last_activity_date": 1436277550, "creation_date": 1436164796, "question_id": 31239163, "link": "https://stackoverflow.com/questions/31239163/print-each-value-in-list-n-times", "title": "Print each value in list &quot;n&quot; times", "body": "<p>I am a beginner and I am trying to solve this <a href=\"https://www.hackerrank.com/challenges/fp-list-replication\" rel=\"nofollow\">code</a>. Given n and a List,  return a new list containing all the elements of list repeated n times. \nBelow is my implementation</p>\n\n<pre><code>fn :: Int -&gt; [a] -&gt; [a]\nreplicate' n x = take n (repeat x)\nfn n (x:xs) = case x of [] -&gt; []\n                        (_) -&gt;  (replicate' n x) ++ fn n xs\n</code></pre>\n\n<p>But I am getting error saying </p>\n\n<pre><code>Couldn't match type `a' with `[t0]'\n  `a' is a rigid type variable bound by\n      the type signature for fn :: Int -&gt; [a] -&gt; [a] at temp.hs:3:1\nIn the pattern: []\nIn a case alternative: [] -&gt; []\nIn the expression:\n  case x of {\n    [] -&gt; []\n    (_) -&gt; (replicate' n x) ++ fn n xs }\n</code></pre>\n\n<p>I am not sure where the error is. \nNote: I am not attempting monad, any library. I am using only basic constructs\nEdit: I am not worried about printing as of now. I want to return the list as specified in the logic. Print can be taken care later.</p>\n"}, {"tags": ["debugging", "haskell", "ghc", "ghci"], "answers": [{"tags": [], "owner": {"reputation": 39903, "user_id": 128645, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/3697685173ba67283f38ba931bd71f8c?s=128&d=identicon&r=PG", "display_name": "Jeff Foster", "link": "https://stackoverflow.com/users/128645/jeff-foster"}, "is_accepted": false, "score": 7, "last_activity_date": 1436165790, "creation_date": 1436165790, "answer_id": 31239450, "question_id": 31238766, "link": "https://stackoverflow.com/questions/31238766/haskell-finding-the-source-of-incomplete-record-construction/31239450#31239450", "title": "Haskell: Finding the source of incomplete record construction", "body": "<p>If you use <code>-Wall</code> in the ghc-options of your cabal file it'll give a warning of incomplete records.</p>\n\n<pre><code>module Foo where\ndata Bar = Bar { bar :: String, baz :: String }\nf = Bar { baz = \"foo\" }\n\nFoo.hs:5:5: Warning:\n  Fields of \u2018Bar\u2019 not initialised: bar\n  In the expression: Bar {baz = \"foo\"}\n  In an equation for \u2018f\u2019: f = Bar {baz = \"foo\"}\nOk, modules loaded: Foo.\n</code></pre>\n"}, {"comments": [{"owner": {"reputation": 58792, "user_id": 1006010, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/f683d229f3673c9dcc3f3f2796d75c09?s=128&d=identicon&r=PG", "display_name": "MathematicalOrchid", "link": "https://stackoverflow.com/users/1006010/mathematicalorchid"}, "edited": false, "score": 1, "creation_date": 1436172588, "post_id": 31239771, "comment_id": 50480588, "body": "I had no idea you could actually get a stack trace. Pity you need to recompile the entire Haskell Platform for profiling, but hey..."}, {"owner": {"reputation": 7230, "user_id": 788337, "user_type": "registered", "accept_rate": 70, "profile_image": "https://i.stack.imgur.com/wiVpx.png?s=128&g=1", "display_name": "jmite", "link": "https://stackoverflow.com/users/788337/jmite"}, "edited": false, "score": 0, "creation_date": 1436212489, "post_id": 31239771, "comment_id": 50505907, "body": "Thankfully I&#39;ve had enough past troubles with profiling that I already had my entire sandbox compiled with profiling enabled..."}], "tags": [], "owner": {"reputation": 528, "user_id": 3066608, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/t0ZlK.png?s=128&g=1", "display_name": "creichert", "link": "https://stackoverflow.com/users/3066608/creichert"}, "is_accepted": true, "score": 6, "last_activity_date": 1436211107, "last_edit_date": 1436211107, "creation_date": 1436166936, "answer_id": 31239771, "question_id": 31238766, "link": "https://stackoverflow.com/questions/31238766/haskell-finding-the-source-of-incomplete-record-construction/31239771#31239771", "title": "Haskell: Finding the source of incomplete record construction", "body": "<p>Compiling with -Wall (or -Werror) is a good first start to finding the source of an uninitialized field. However, it might not be the source of the error. Missing record field initializions have a specific error message:</p>\n\n<pre><code>Prelude&gt; data A = A { a :: Int } deriving Show\nPrelude&gt; A {}\nA {a = *** Exception: &lt;interactive&gt;:11:1-4: Missing field in record construction a\n</code></pre>\n\n<p>If you add a strictness annotation to a record field, an error will be thrown at compile time:</p>\n\n<pre><code>Prelude&gt; data A = A { a :: !Int } deriving Show\nPrelude&gt; let a = A { }\n\n&lt;interactive&gt;:26:9:\n    Constructor \u2018A\u2019 does not have the required strict field(s): a\n    In the expression: A {}\n    In an equation for \u2018a\u2019: a = A {}\n</code></pre>\n\n<p>Another option for finding the source of the error is to compile with profiling enabled and pass the -xc RTS flag. </p>\n\n<p>From the GHC Users Guide:\n<a href=\"https://downloads.haskell.org/~ghc/latest/docs/html/users_guide/runtime-control.html\" rel=\"nofollow\">https://downloads.haskell.org/~ghc/latest/docs/html/users_guide/runtime-control.html</a></p>\n\n<blockquote>\n  <p>-xc (Only available when the program is compiled for profiling.) When an exception is raised in the program, this option causes a stack\n  trace to be dumped to stderr.</p>\n  \n  <p>This can be particularly useful for debugging: if your program is\n  complaining about a head [] error and you haven't got a clue which bit\n  of code is causing it, compiling with -prof -fprof-auto and running\n  with +RTS -xc -RTS will tell you exactly the call stack at the point\n  the error was raised.</p>\n  \n  <p>The output contains one report for each exception raised in the\n  program (the program might raise and catch several exceptions during\n  its execution), where each report looks something like this:</p>\n  \n  <p>*** Exception raised (reporting due to +RTS -xc), stack trace:   GHC.List.CAF   --> evaluated by: Main.polynomial.table_search,<br>\n  called from Main.polynomial.theta_index,   called from\n  Main.polynomial,   called from Main.zonal_pressure,   called from\n  Main.make_pressure.p,   called from Main.make_pressure,   called from\n  Main.compute_initial_state.p,   called from\n  Main.compute_initial_state,   called from Main.CAF   ...</p>\n</blockquote>\n"}], "owner": {"reputation": 7230, "user_id": 788337, "user_type": "registered", "accept_rate": 70, "profile_image": "https://i.stack.imgur.com/wiVpx.png?s=128&g=1", "display_name": "jmite", "link": "https://stackoverflow.com/users/788337/jmite"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 446, "favorite_count": 1, "accepted_answer_id": 31239771, "answer_count": 2, "score": 3, "last_activity_date": 1436211107, "creation_date": 1436163035, "question_id": 31238766, "link": "https://stackoverflow.com/questions/31238766/haskell-finding-the-source-of-incomplete-record-construction", "title": "Haskell: Finding the source of incomplete record construction", "body": "<p>I'm trying to debug a large, complicated program in Haskell, which I didn't entirely write myself.</p>\n\n<p>I'm trying to print my data structures to diagnose a bug, but when I do so, I get the following error: <code>error: Prelude.undefined</code>. As you can see, this error is extremely non-informative.</p>\n\n<p>I'm reasonably sure that this is coming from a record that I've \"partially\" initialized, where I'm trying to access a field whose value has not been set.</p>\n\n<p>The program (a compiler) is spread over two cabal projects, a library, and an executable which uses that library. This makes debugging using GHCI/cabal-repl hard: I can't run use GHCi on the executable, because it's not the source of the error, but recreating the input the executable gives to the library is too complicated to do by hand.</p>\n\n<p>I'm wondering: what can I do to get more information about where the incorrect record is being created, what field is the source of the error, etc. Is there an RTS option or something I can use to give more information for error output?</p>\n"}, {"tags": ["haskell", "tree", "binary-tree", "huffman-code", "algebraic-data-types"], "comments": [{"owner": {"reputation": 13807, "user_id": 2407038, "user_type": "registered", "accept_rate": 64, "profile_image": "https://www.gravatar.com/avatar/538f6f4a9aa43841841de7d8e8b169fc?s=128&d=identicon&r=PG&f=1", "display_name": "user2407038", "link": "https://stackoverflow.com/users/2407038/user2407038"}, "edited": false, "score": 2, "creation_date": 1436145814, "post_id": 31235960, "comment_id": 50471692, "body": "Your datatype isn&#39;t really suitable for representing Huffman trees because you don&#39;t store frequencies anywhere. Frequencies can be implicit at nodes (which is inefficient) but you must have the frequency at the leaves."}], "answers": [{"tags": [], "owner": {"reputation": 4565, "user_id": 1134885, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/7c428466054762cf7d4b5fb5f4396fa2?s=128&d=identicon&r=PG", "display_name": "NovaDenizen", "link": "https://stackoverflow.com/users/1134885/novadenizen"}, "is_accepted": true, "score": 5, "last_activity_date": 1436142279, "creation_date": 1436142279, "answer_id": 31236343, "question_id": 31235960, "link": "https://stackoverflow.com/questions/31235960/building-proper-tree/31236343#31236343", "title": "Building proper tree", "body": "<p>You're not constructing the Huffman tree correctly.  The process is supposed to go like this:</p>\n\n<ol>\n<li>Turn all the source symbols into single-element huffman trees</li>\n<li>Pair each source symbol up with its frequency into a big list of tree/frequency pairs.</li>\n<li>If there is just one tree/frequency pair left, that tree is your Huffman tree.</li>\n<li>Else remove the two trees/frequency pairs with the lowest freqyency, combine the trees and add the frequencies to make a new tree/frequency pair, and add it back to the list.</li>\n<li>Goto 3.</li>\n</ol>\n\n<p>So I'd change it to <code>plant :: [(HuffTree,Int)] -&gt; HuffTree</code>.  In the second case I'd sort the elements, pluck off the first two, combine them, then call <code>plant</code> recursively.  You might also want to swith to <code>(Int,HuffTree)</code> pairs so that you can use the default sort implementation.  You'd also need to add <code>Ord</code> to your <code>HuffTree</code> deriving clause.</p>\n"}], "owner": {"reputation": 3566, "user_id": 4325010, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/048bff2cd5cae6d0a93ecd485f6690ad?s=128&d=identicon&r=PG&f=1", "display_name": "users at 4325010", "link": "https://stackoverflow.com/users/4325010/users-at-4325010"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 117, "favorite_count": 0, "accepted_answer_id": 31236343, "answer_count": 1, "score": 0, "last_activity_date": 1436142279, "creation_date": 1436138591, "question_id": 31235960, "link": "https://stackoverflow.com/questions/31235960/building-proper-tree", "title": "Building proper tree", "body": "<p>So, I have that Huffman tree, that is used for encoding strings. And I have defined the function <code>plant</code>, but I am not sure whether my tree is not tilting too much only to the one side. Here is my code:</p>\n\n<pre><code>data HuffTree\n    = Leaf Char\n    | HuffTree |*| HuffTree     \n    deriving (Eq, Show)\n</code></pre>\n\n<p><code>|*|</code> is an infix Constructor. </p>\n\n<pre><code>plant :: [(Char,Int)] -&gt; HuffTree\nplant [(x,y)] = (Leaf x)\nplant ((x,y):xs) = plant xs |*| (Leaf x) \n</code></pre>\n\n<p>For me, it looks one-sided and hence it really doesn`t implies the encoding idea, since not being a real binary tree. How could I turn it into a regular binary tree? </p>\n"}, {"tags": ["haskell"], "comments": [{"owner": {"reputation": 126897, "user_id": 791604, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/ce991df7a056248d5e4f6fc3659ba733?s=128&d=identicon&r=PG", "display_name": "Daniel Wagner", "link": "https://stackoverflow.com/users/791604/daniel-wagner"}, "edited": false, "score": 1, "creation_date": 1436137966, "post_id": 31235736, "comment_id": 50470421, "body": "Your type claims you can convert from one type of number <code>a</code> to another type <code>b</code>. But <code>sqrt</code> doesn&#39;t do that."}], "answers": [{"tags": [], "owner": {"reputation": 1044, "user_id": 476114, "user_type": "registered", "accept_rate": 78, "profile_image": "https://www.gravatar.com/avatar/18db9bf4cb83fb9c8f30aeb53b3ccfae?s=128&d=identicon&r=PG", "display_name": "Bzzt", "link": "https://stackoverflow.com/users/476114/bzzt"}, "is_accepted": true, "score": 7, "last_activity_date": 1436137748, "creation_date": 1436137748, "answer_id": 31235871, "question_id": 31235736, "link": "https://stackoverflow.com/questions/31235736/haskell-cant-deduce-type/31235871#31235871", "title": "Haskell can&#39;t deduce type?", "body": "<p>What you're saying is you have a function going from Num a to Floating b.  The sqrt function requires a Floating type as input, but you are only guaranteeing Num.  Here's the type of sqrt:</p>\n\n<pre><code>Main&gt; :t sqrt\nsqrt :: Floating a =&gt; a -&gt; a\n</code></pre>\n\n<p>So, let's copy sqrt and make this a ftn from Floating to Floating:</p>\n\n<pre><code>sqrtNum :: (Num a, Floating a) =&gt; a -&gt; a\nsqrtNum x = sqrt x\n</code></pre>\n\n<p>I left the Num, although only Floating is required.  <a href=\"http://haddocks.fpcomplete.com/fp/7.8/20140916-162/haskell2010/Prelude.html#t:Fractional\" rel=\"noreferrer\">Floating is a Fractional, and Fractional is a Num.</a></p>\n"}, {"tags": [], "owner": {"reputation": 8676, "user_id": 1113881, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/sBc0F.jpg?s=128&g=1", "display_name": "CR Drost", "link": "https://stackoverflow.com/users/1113881/cr-drost"}, "is_accepted": false, "score": 3, "last_activity_date": 1436156032, "creation_date": 1436156032, "answer_id": 31237699, "question_id": 31235736, "link": "https://stackoverflow.com/questions/31235736/haskell-cant-deduce-type/31237699#31237699", "title": "Haskell can&#39;t deduce type?", "body": "<p>If that wasn't clear enough, let's peek \"under the hood\". Type classes are a form of syntactic sugar where Haskell stores a library of functions at the type level.  Typeclass constraints can therefore be implemented simply as extra arguments which get passed along implicitly. For example if I write:</p>\n\n<pre><code>class Truthy a where\n    truthy :: a -&gt; Bool\n\ninstance Truthy Integer where\n    truthy = (== 0)\n\ninstance Truthy Bool where\n    truthy = id\n</code></pre>\n\n<p>then we could define a function like:</p>\n\n<pre><code>maybeTruthy :: Truthy x =&gt; x -&gt; Maybe x\nmaybeTruthy x | truthy x  = Just x\n              | otherwise = Nothing\n</code></pre>\n\n<p>The key here is that what I am doing is exactly the same as this slightly more convoluted piece of code:</p>\n\n<pre><code>data Truthifier x = Truthifier {truthify :: x -&gt; Bool}\n\nboolTruthifier :: Truthifier Bool\nboolTruthifier = Truthifier id\n\nintegerTruthifier :: Truthifier Integer\nintegerTruthifier = Truthifier (== 0)\n\nmaybeTruthified :: Truthifier x -&gt; x -&gt; Maybe x\nmaybeTruthified lib x | truthify lib x = Just x\n                      | otherwise      = Nothing\n</code></pre>\n\n<p>The only difference is that Haskell has effectively bound, e.g., <code>boolTruthifier</code> to the <code>Bool</code> type, so that I do not need to pass it explicitly to <code>maybeTruthy</code> because it \"comes along for the ride\" via the type <code>Bool</code> of the argument to the function. Above I could easily define <code>notTruthifier = Truthifier not</code> and I could start doing things with <code>maybeTruthified notTruthifier</code> instead of <code>maybeTruthified boolTruthifier</code>. </p>\n\n<p>This explains, for example, why Haskell by default forbids <code>instance (Num a) =&gt; Truthy a</code>, and you have to instead write <code>newtype TruthNum x = TruthNum x</code> and then <code>instance (Num a) =&gt; Truthy (TruthNum a)</code>: Haskell has to have a top-level type to register that function library with; if you give it <code>(Num a) =&gt; Truthy a</code> then it has no better place to put it than on <code>a</code> -- that is, on all functions -- whereas in the latter case it puts it directly on the <code>TruthNum</code> type and only uses it when the <code>x</code> also has a dictionary for the <code>Num</code> functions.</p>\n\n<p>How <code>sqrt</code> fits into all of this: in GHCi you will find out that the type of <code>sqrt</code> is:</p>\n\n<pre><code>Prelude&gt; :t sqrt\nsqrt :: Floating a =&gt; a -&gt; a\n</code></pre>\n\n<p>In other words, <code>sqrt</code> can be done on a value of any type, if that type has the <code>Floating</code> dictionary defined for it. Its <code>sqrt</code> returns a value <strong>of the same type</strong>, since the signature is <code>a -&gt; a</code>.</p>\n\n<p>You tried to write <code>(Num a, Floating b) =&gt; a -&gt; b</code>. This is a more permissive type than what the definition actually allows. </p>\n"}], "owner": {"reputation": 52, "user_id": 1852369, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/e6d3adf932d0713c3321ab26912ab396?s=128&d=identicon&r=PG&f=1", "display_name": "Wolf", "link": "https://stackoverflow.com/users/1852369/wolf"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 196, "favorite_count": 0, "accepted_answer_id": 31235871, "answer_count": 2, "score": 1, "last_activity_date": 1436156032, "creation_date": 1436136415, "question_id": 31235736, "link": "https://stackoverflow.com/questions/31235736/haskell-cant-deduce-type", "title": "Haskell can&#39;t deduce type?", "body": "<p>I've tried countless google searches for an answer but being pretty new to Haskell, I didn't understand half the things I found and the other half just didn't quite relate.</p>\n\n<p>My problem is this, if I run these statements in ghci</p>\n\n<pre><code>Prelude&gt; let x = 5 :: (Num a) =&gt; a\nPrelude&gt; sqrt x\n</code></pre>\n\n<p>I get what I expect</p>\n\n<pre><code>2.23606797749979\n</code></pre>\n\n<p>But, if I put this in a file and compile (granted what I'm doing here is pretty trivial)</p>\n\n<pre><code>sqrtNum :: (Num a, Floating b) =&gt; a -&gt; b\nsqrtNum x = sqrt x\n</code></pre>\n\n<p>I get this</p>\n\n<pre><code>myfile.hs:2:18:\n    Could not deduce (a ~ b)\n    from the context (Num a, Floating b)\n      bound by the type signature for\n                 sqrtNum :: (Num a, Floating b) =&gt; a -&gt; b\n      at test2.hs:1:12-40\n      `a' is a rigid type variable bound by\n          the type signature for sqrtNum :: (Num a, Floating b) =&gt; a -&gt; b\n          at test2.hs:1:12\n      `b' is a rigid type variable bound by\n          the type signature for sqrtNum :: (Num a, Floating b) =&gt; a -&gt; b\n          at test2.hs:1:12\n    Relevant bindings include\n      x :: a (bound at test2.hs:2:9)\n      sqrtNum :: a -&gt; b (bound at test2.hs:2:1)\n    In the first argument of `sqrt', namely `x'\n    In the expression: sqrt x\n</code></pre>\n\n<p>The problem's probably very simple and I'm just overseeing it (as such are my experiences with every other error I encounter) but this one just isn't clicking.</p>\n\n<p>Thanks in advance!</p>\n"}, {"tags": ["list", "haskell", "overloading", "counting"], "comments": [{"owner": {"reputation": 24028, "user_id": 383200, "user_type": "registered", "accept_rate": 60, "profile_image": "https://www.gravatar.com/avatar/a9dc722f936cb1059adaae4fe39c07f0?s=128&d=identicon&r=PG", "display_name": "Carl", "link": "https://stackoverflow.com/users/383200/carl"}, "edited": false, "score": 12, "creation_date": 1436131870, "post_id": 31235155, "comment_id": 50469011, "body": "Every element of a list must be the same type.  If you want some other structure, you don&#39;t want a list."}, {"owner": {"reputation": 2179, "user_id": 412549, "user_type": "registered", "accept_rate": 50, "profile_image": "https://www.gravatar.com/avatar/a194a155579e30bda0926705aeb9d165?s=128&d=identicon&r=PG&f=1", "display_name": "Franky", "link": "https://stackoverflow.com/users/412549/franky"}, "edited": false, "score": 2, "creation_date": 1436161835, "post_id": 31235155, "comment_id": 50475067, "body": "We call those structures <i>tree</i>s in haskell."}], "answers": [{"comments": [{"owner": {"reputation": 6015, "user_id": 390808, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/a0f6edad668a0b63171eeb2a8aea39cd?s=128&d=identicon&r=PG", "display_name": "Sven Koschnicke", "link": "https://stackoverflow.com/users/390808/sven-koschnicke"}, "edited": false, "score": 1, "creation_date": 1436173285, "post_id": 31236394, "comment_id": 50481011, "body": "Your <code>countNest</code> function doesn&#39;t count the elements but sums their value."}, {"owner": {"reputation": 4565, "user_id": 1134885, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/7c428466054762cf7d4b5fb5f4396fa2?s=128&d=identicon&r=PG", "display_name": "NovaDenizen", "link": "https://stackoverflow.com/users/1134885/novadenizen"}, "reply_to_user": {"reputation": 6015, "user_id": 390808, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/a0f6edad668a0b63171eeb2a8aea39cd?s=128&d=identicon&r=PG", "display_name": "Sven Koschnicke", "link": "https://stackoverflow.com/users/390808/sven-koschnicke"}, "edited": false, "score": 0, "creation_date": 1436196470, "post_id": 31236394, "comment_id": 50496738, "body": "Yes, I slightly misread the question.  It actually counts now."}, {"owner": {"reputation": 33184, "user_id": 247623, "user_type": "registered", "accept_rate": 72, "profile_image": "https://www.gravatar.com/avatar/bb9e67348d3e0e93ef12dd97c41a6c22?s=128&d=identicon&r=PG&f=1", "display_name": "Erik Kaplun", "link": "https://stackoverflow.com/users/247623/erik-kaplun"}, "edited": false, "score": 0, "creation_date": 1436199061, "post_id": 31236394, "comment_id": 50498422, "body": "re &quot;silliness&quot;: in a dynamic environment it&#39;s just the equivalent of a sum type \u2014 why is that silly?"}, {"owner": {"reputation": 4565, "user_id": 1134885, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/7c428466054762cf7d4b5fb5f4396fa2?s=128&d=identicon&r=PG", "display_name": "NovaDenizen", "link": "https://stackoverflow.com/users/1134885/novadenizen"}, "reply_to_user": {"reputation": 33184, "user_id": 247623, "user_type": "registered", "accept_rate": 72, "profile_image": "https://www.gravatar.com/avatar/bb9e67348d3e0e93ef12dd97c41a6c22?s=128&d=identicon&r=PG&f=1", "display_name": "Erik Kaplun", "link": "https://stackoverflow.com/users/247623/erik-kaplun"}, "edited": false, "score": 0, "creation_date": 1436210396, "post_id": 31236394, "comment_id": 50504766, "body": "@ErikAllik Sum types are not silly.  Keeping your baby food, rat poison, floor wax, and dessert toppings in the same jar is silly."}, {"owner": {"reputation": 33184, "user_id": 247623, "user_type": "registered", "accept_rate": 72, "profile_image": "https://www.gravatar.com/avatar/bb9e67348d3e0e93ef12dd97c41a6c22?s=128&d=identicon&r=PG&f=1", "display_name": "Erik Kaplun", "link": "https://stackoverflow.com/users/247623/erik-kaplun"}, "edited": false, "score": 0, "creation_date": 1436263926, "post_id": 31236394, "comment_id": 50526160, "body": "I know what you mean but in a dynamically typed language, the &quot;plain&quot; representation is as good as using &quot;separate jars&quot; \u2014 in one way or another you&#39;ll end up branching based on the type of the item, regardless of whether it&#39;s an actual type check or just a boolean attribute. And it&#39;s just as easy to forget the check with or without an additional layer of jars. Or, in other words: <code>[1, [2, 3]]</code> is just as fool proof or error prone as is <code>[Left(1), Right([2, 3])]</code> in a language such as, say, Python. Furthermore, they are semantically isomorphic/equivalent because dynamic languages have RTTI."}, {"owner": {"reputation": 33184, "user_id": 247623, "user_type": "registered", "accept_rate": 72, "profile_image": "https://www.gravatar.com/avatar/bb9e67348d3e0e93ef12dd97c41a6c22?s=128&d=identicon&r=PG&f=1", "display_name": "Erik Kaplun", "link": "https://stackoverflow.com/users/247623/erik-kaplun"}, "edited": false, "score": 0, "creation_date": 1436264235, "post_id": 31236394, "comment_id": 50526367, "body": "Alternatively: you could say the runtime types <i>are</i> the jar."}, {"owner": {"reputation": 4565, "user_id": 1134885, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/7c428466054762cf7d4b5fb5f4396fa2?s=128&d=identicon&r=PG", "display_name": "NovaDenizen", "link": "https://stackoverflow.com/users/1134885/novadenizen"}, "reply_to_user": {"reputation": 33184, "user_id": 247623, "user_type": "registered", "accept_rate": 72, "profile_image": "https://www.gravatar.com/avatar/bb9e67348d3e0e93ef12dd97c41a6c22?s=128&d=identicon&r=PG&f=1", "display_name": "Erik Kaplun", "link": "https://stackoverflow.com/users/247623/erik-kaplun"}, "edited": false, "score": 0, "creation_date": 1436280894, "post_id": 31236394, "comment_id": 50538527, "body": "@ErikAllik No, there&#39;s a tremendous difference between a program proven by the compiler to type check and a program that has to repeatedly check the type of every argument at every calculation at run time."}, {"owner": {"reputation": 33184, "user_id": 247623, "user_type": "registered", "accept_rate": 72, "profile_image": "https://www.gravatar.com/avatar/bb9e67348d3e0e93ef12dd97c41a6c22?s=128&d=identicon&r=PG&f=1", "display_name": "Erik Kaplun", "link": "https://stackoverflow.com/users/247623/erik-kaplun"}, "edited": false, "score": 0, "creation_date": 1436303746, "post_id": 31236394, "comment_id": 50552489, "body": "so basically we&#39;ve descended into an argument about dynamic vs static, which was something I didn&#39;t say anything about, so let&#39;s not continue it."}], "tags": [], "owner": {"reputation": 4565, "user_id": 1134885, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/7c428466054762cf7d4b5fb5f4396fa2?s=128&d=identicon&r=PG", "display_name": "NovaDenizen", "link": "https://stackoverflow.com/users/1134885/novadenizen"}, "is_accepted": false, "score": 7, "last_activity_date": 1436196362, "last_edit_date": 1436196362, "creation_date": 1436142904, "answer_id": 31236394, "question_id": 31235155, "link": "https://stackoverflow.com/questions/31235155/haskell-how-to-count-elements-in-nested-list/31236394#31236394", "title": "Haskell - how to count elements in nested list", "body": "<p>You can't make freeform lists-within-lists like that in Haskell.  Dynamically typed langues will tolerate silliness like that, but strongly-typed Haskell won't.</p>\n\n<p><code>1</code> is of type <code>Int</code>, and <code>[2,3,4]</code> is of a different type <code>[Int]</code>.  Things in a list have to be of the same type.</p>\n\n<p>However, you could do something like this:</p>\n\n<pre><code>data Nest a = Elem a | List [Nest a]\n\nexample ::Nest Int\nexample = List [Elem 1, List [Elem 2, Elem 3, Elem 4], List [Elem 5, List [Elem 6]]]\n\ncountNest :: Nest a -&gt; Int\ncountNest (Elem x) = 1\ncountNest (List xs) = sum $ map countNest xs\n</code></pre>\n"}, {"tags": [], "owner": {"reputation": 58792, "user_id": 1006010, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/f683d229f3673c9dcc3f3f2796d75c09?s=128&d=identicon&r=PG", "display_name": "MathematicalOrchid", "link": "https://stackoverflow.com/users/1006010/mathematicalorchid"}, "is_accepted": false, "score": 4, "last_activity_date": 1436172862, "creation_date": 1436172862, "answer_id": 31241528, "question_id": 31235155, "link": "https://stackoverflow.com/questions/31235155/haskell-how-to-count-elements-in-nested-list/31241528#31241528", "title": "Haskell - how to count elements in nested list", "body": "<blockquote>\n  <p>Let's say I have nested lsit: [1, [2, 3, 4], [5, [6]]]</p>\n</blockquote>\n\n<p>You can't have that list. It won't type-check. Try typing it by itself in GHCi; it'll just spit an error message at you. Since this input can't exist in the first place, trying to write a function to process it is a doomed endeavor.</p>\n\n<p>Instead, you need to define a custom data type for this. See the other answers.</p>\n"}, {"tags": [], "owner": {"reputation": 1818, "user_id": 589352, "user_type": "registered", "accept_rate": 72, "profile_image": "https://www.gravatar.com/avatar/ba318b431c968c4883f4f365d989abea?s=128&d=identicon&r=PG", "display_name": "jaybee", "link": "https://stackoverflow.com/users/589352/jaybee"}, "is_accepted": false, "score": 0, "last_activity_date": 1436196618, "last_edit_date": 1495540280, "creation_date": 1436196618, "answer_id": 31249796, "question_id": 31235155, "link": "https://stackoverflow.com/questions/31235155/haskell-how-to-count-elements-in-nested-list/31249796#31249796", "title": "Haskell - how to count elements in nested list", "body": "<p>As others have said, the simplest way to do this is with a different data structure, like the <a href=\"https://stackoverflow.com/a/31236394/589352\">tree</a> NovaDenizen defined. However, just so you know, Haskell's type system enables various ways of creating \"lists\" in which the elements have different types : see <a href=\"https://wiki.haskell.org/Heterogenous_collections\" rel=\"nofollow noreferrer\">https://wiki.haskell.org/Heterogenous_collections</a></p>\n"}], "owner": {"reputation": 123, "user_id": 780214, "user_type": "registered", "accept_rate": 20, "profile_image": "https://www.gravatar.com/avatar/8b7ae4b96ae79c7caf6f3b4251357a64?s=128&d=identicon&r=PG", "display_name": "rnd", "link": "https://stackoverflow.com/users/780214/rnd"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 1241, "favorite_count": 0, "answer_count": 3, "score": 2, "last_activity_date": 1436196618, "creation_date": 1436131639, "question_id": 31235155, "link": "https://stackoverflow.com/questions/31235155/haskell-how-to-count-elements-in-nested-list", "title": "Haskell - how to count elements in nested list", "body": "<p>Lets say I have nested lsit: [1, [2, 3, 4], [5, [6]]] and I want to count how many elements it has. In this case it is six elements. I have written such code for doing this:</p>\n\n<pre><code>totalElems :: [a] -&gt; Int\ntotalElems (x:xs) = case (x, xs) of\n                    (_, []) -&gt; 0\n                    (y:ys, _) -&gt; 1 + totalElems ys + totalElems xs\n                    (_, _) -&gt; 1 + totalElems xs\n</code></pre>\n\n<p>But I've got an error:</p>\n\n<pre><code>a.hs:4:42:\n    Couldn't match expected type \u2018a\u2019 with actual type \u2018[a0]\u2019\n      \u2018a\u2019 is a rigid type variable bound by\n          the type signature for totalElems :: [a] -&gt; Int at a.hs:1:15\n    Relevant bindings include\n      xs :: [a] (bound at a.hs:2:15)\n      x :: a (bound at a.hs:2:13)\n      totalElems :: [a] -&gt; Int (bound at a.hs:2:1)\n    In the pattern: y : ys\n    In the pattern: (y : ys, _)\n    In a case alternative:\n        (y : ys, _) -&gt; 1 + totalElems ys + totalElems xs\n</code></pre>\n\n<p>How I can do this in Haskell?</p>\n"}, {"tags": ["haskell", "list-comprehension"], "answers": [{"tags": [], "owner": {"reputation": 2111, "user_id": 1434220, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/d48e2a034dc8b5a8d28840c68e71f902?s=128&d=identicon&r=PG", "display_name": "hdgarrood", "link": "https://stackoverflow.com/users/1434220/hdgarrood"}, "is_accepted": false, "score": 2, "last_activity_date": 1436132053, "creation_date": 1436132053, "answer_id": 31235216, "question_id": 31235096, "link": "https://stackoverflow.com/questions/31235096/translating-list-comprehensions-to-definitions-using-map-and-concat/31235216#31235216", "title": "translating list comprehensions to definitions using map and concat", "body": "<p>I would guess that:</p>\n\n<ul>\n<li>e is any expression, as you say</li>\n<li>q is any expression with type <code>Bool</code></li>\n<li>b is also any expression with type <code>Bool</code> (this seems a bit strange, though, perhaps I'm wrong...)</li>\n<li>p is any pattern. For example, <code>Right x</code>, <code>Just _</code>, <code>x@(y,z)</code></li>\n<li>Q is a bunch of list comprehension elements separated by commas. By \"list comprehension element\" I mean either guards (i.e. expressions of type <code>Bool</code>) or pattern matches, e.g <code>x &lt;- xs</code>, <code>Right x &lt;- xs</code>.</li>\n</ul>\n"}, {"tags": [], "owner": {"reputation": 126897, "user_id": 791604, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/ce991df7a056248d5e4f6fc3659ba733?s=128&d=identicon&r=PG", "display_name": "Daniel Wagner", "link": "https://stackoverflow.com/users/791604/daniel-wagner"}, "is_accepted": true, "score": 5, "last_activity_date": 1436132211, "creation_date": 1436132211, "answer_id": 31235238, "question_id": 31235096, "link": "https://stackoverflow.com/questions/31235096/translating-list-comprehensions-to-definitions-using-map-and-concat/31235238#31235238", "title": "translating list comprehensions to definitions using map and concat", "body": "<p>This translation comes straight out of the official <a href=\"https://www.haskell.org/onlinereport/haskell2010/haskellch3.html#x8-420003.11\" rel=\"noreferrer\">Haskell Report</a>, which has this additional sentence:</p>\n\n<blockquote>\n  <p>where <code>e</code> ranges over expressions, <code>p</code> over patterns, <code>l</code> over list-valued expressions, <code>b</code> over boolean expressions, <code>decls</code> over declaration lists, <code>q</code> over qualifiers, and <code>Q</code> over sequences of qualifiers. <code>ok</code> is a fresh variable. The function <code>concatMap</code>, and boolean value <code>True</code>, are defined in the <code>Prelude</code>.</p>\n</blockquote>\n\n<p>If you wonder what any of those terms means, the Report has further details.</p>\n"}], "owner": {"reputation": 1877, "user_id": 965613, "user_type": "registered", "accept_rate": 97, "profile_image": "https://i.stack.imgur.com/UiRBe.png?s=128&g=1", "display_name": "planarian", "link": "https://stackoverflow.com/users/965613/planarian"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 206, "favorite_count": 0, "accepted_answer_id": 31235238, "answer_count": 2, "score": 2, "last_activity_date": 1436132211, "creation_date": 1436131208, "question_id": 31235096, "link": "https://stackoverflow.com/questions/31235096/translating-list-comprehensions-to-definitions-using-map-and-concat", "title": "translating list comprehensions to definitions using map and concat", "body": "<p>From <em>Thinking Functionally with Haskell</em>, pg 67:</p>\n\n<pre><code>[...] list comprehensions are translated into equivalent definitions in\nterms of map and concat. The translation rules are:\n\n[e | True]       = [e] \n[e | q]          = [e | q, True] \n[e | b, Q]       = if b then [e | Q] else [] \n[e | p &lt;- xs, Q] = let ok p = [e | Q]\n                       ok _ = []\n                   in concat (map ok xs)\n</code></pre>\n\n<p>The author nowhere defines e, q, Q, or b. I take it that the first means \"expression,\" but I've never seen the others before. Could someone please enlighten me?</p>\n"}, {"tags": ["haskell"], "comments": [{"owner": {"reputation": 6581, "user_id": 461202, "user_type": "registered", "accept_rate": 83, "profile_image": "https://www.gravatar.com/avatar/6f780ff5bfdfea60bdc260664f00b574?s=128&d=identicon&r=PG", "display_name": "zegkljan", "link": "https://stackoverflow.com/users/461202/zegkljan"}, "edited": false, "score": 4, "creation_date": 1436119519, "post_id": 31233323, "comment_id": 50465416, "body": "Well, in a situation where you need to drop the last element. What do you want us to tell you? It&#39;s just a function that does exactly that. Try to implement it yourself using head &amp; tail and you&#39;ll see that it&#39;s quite convenient to have a function already available."}, {"owner": {"reputation": 43759, "user_id": 1651941, "user_type": "registered", "accept_rate": 97, "profile_image": "https://www.gravatar.com/avatar/a513bc1fa519d2fcf5e4e0d9b5500101?s=128&d=identicon&r=PG", "display_name": "Sibi", "link": "https://stackoverflow.com/users/1651941/sibi"}, "edited": false, "score": 0, "creation_date": 1436119646, "post_id": 31233323, "comment_id": 50465464, "body": "I remember using it when doing some Web scraping, if you are looking for some real world use case."}, {"owner": {"reputation": 37416, "user_id": 66814, "user_type": "registered", "accept_rate": 52, "profile_image": "https://i.stack.imgur.com/syRQP.jpg?s=128&g=1", "display_name": "Boon", "link": "https://stackoverflow.com/users/66814/boon"}, "edited": false, "score": 0, "creation_date": 1436119648, "post_id": 31233323, "comment_id": 50465466, "body": "Could you tell me in what situation you have found yourself needing to drop the last element?"}, {"owner": {"reputation": 37416, "user_id": 66814, "user_type": "registered", "accept_rate": 52, "profile_image": "https://i.stack.imgur.com/syRQP.jpg?s=128&g=1", "display_name": "Boon", "link": "https://stackoverflow.com/users/66814/boon"}, "reply_to_user": {"reputation": 43759, "user_id": 1651941, "user_type": "registered", "accept_rate": 97, "profile_image": "https://www.gravatar.com/avatar/a513bc1fa519d2fcf5e4e0d9b5500101?s=128&d=identicon&r=PG", "display_name": "Sibi", "link": "https://stackoverflow.com/users/1651941/sibi"}, "edited": false, "score": 0, "creation_date": 1436119689, "post_id": 31233323, "comment_id": 50465479, "body": "@Sibi Why do you need to drop the last element in your web scraping task?"}, {"owner": {"reputation": 43759, "user_id": 1651941, "user_type": "registered", "accept_rate": 97, "profile_image": "https://www.gravatar.com/avatar/a513bc1fa519d2fcf5e4e0d9b5500101?s=128&d=identicon&r=PG", "display_name": "Sibi", "link": "https://stackoverflow.com/users/1651941/sibi"}, "edited": false, "score": 0, "creation_date": 1436119819, "post_id": 31233323, "comment_id": 50465521, "body": "@Boon Because I didn&#39;t need the last element tag present in the list."}], "answers": [{"comments": [{"owner": {"reputation": 37416, "user_id": 66814, "user_type": "registered", "accept_rate": 52, "profile_image": "https://i.stack.imgur.com/syRQP.jpg?s=128&g=1", "display_name": "Boon", "link": "https://stackoverflow.com/users/66814/boon"}, "edited": false, "score": 0, "creation_date": 1436122271, "post_id": 31233640, "comment_id": 50466252, "body": "Thanks - that&#39;s a good use case."}], "tags": [], "owner": {"reputation": 44321, "user_id": 318174, "user_type": "registered", "accept_rate": 71, "profile_image": "https://www.gravatar.com/avatar/916b39039a8269e3c45b5ce2b98675a9?s=128&d=identicon&r=PG", "display_name": "Adam Gent", "link": "https://stackoverflow.com/users/318174/adam-gent"}, "is_accepted": true, "score": 4, "last_activity_date": 1436121073, "creation_date": 1436121073, "answer_id": 31233640, "question_id": 31233323, "link": "https://stackoverflow.com/questions/31233323/what-are-the-few-practical-use-cases-of-haskells-init-function/31233640#31233640", "title": "What are the few practical use cases of Haskell&#39;s init function?", "body": "<p>Often times in functional reactive stream programming the first and/or last elements are dummies to indicate start and end. Haskell has laziness so lists can be used as streams.</p>\n"}], "owner": {"reputation": 37416, "user_id": 66814, "user_type": "registered", "accept_rate": 52, "profile_image": "https://i.stack.imgur.com/syRQP.jpg?s=128&g=1", "display_name": "Boon", "link": "https://stackoverflow.com/users/66814/boon"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 157, "favorite_count": 0, "closed_date": 1436123601, "accepted_answer_id": 31233640, "answer_count": 1, "score": -3, "last_activity_date": 1436123746, "creation_date": 1436119002, "last_edit_date": 1436123746, "question_id": 31233323, "link": "https://stackoverflow.com/questions/31233323/what-are-the-few-practical-use-cases-of-haskells-init-function", "closed_reason": "Needs more focus", "title": "What are the few practical use cases of Haskell&#39;s init function?", "body": "<p>Haskell's init function takes a list and returns everything except its last element.  In what situation is such a functionality useful? I am looking for one or two practical use cases.</p>\n\n<p>e.g.</p>\n\n<pre><code>&gt; init [1, 2, 3, 4, 5]\n\n[1, 2, 3, 4]\n</code></pre>\n"}, {"tags": ["haskell", "emacs", "haskell-mode"], "answers": [{"tags": [], "owner": {"reputation": 43759, "user_id": 1651941, "user_type": "registered", "accept_rate": 97, "profile_image": "https://www.gravatar.com/avatar/a513bc1fa519d2fcf5e4e0d9b5500101?s=128&d=identicon&r=PG", "display_name": "Sibi", "link": "https://stackoverflow.com/users/1651941/sibi"}, "is_accepted": true, "score": 2, "last_activity_date": 1436114391, "creation_date": 1436114391, "answer_id": 31232629, "question_id": 31231839, "link": "https://stackoverflow.com/questions/31231839/installing-haskell-mode-into-emacs-on-ubuntu-12/31232629#31232629", "title": "Installing haskell-mode into Emacs on Ubuntu 12", "body": "<p>Go to your <code>init.el</code> file (<code>~/.emacs.d/init.el</code>) and place this there:</p>\n\n<pre><code>(setq package-archives\n      '((\"gnu\"         . \"http://elpa.gnu.org/packages/\")\n        (\"original\"    . \"http://tromey.com/elpa/\")\n        (\"org\"         . \"http://orgmode.org/elpa/\")\n        (\"marmalade\"   . \"http://marmalade-repo.org/packages/\")\n        (\"melpa\" . \"http://melpa.milkbox.net/packages/\")))\n\n(package-initialize)\n</code></pre>\n\n<p>And then do <code>M-x package-refresh-contents</code> and you can install <code>haskell-mode</code> from there. Also make sure that your Emacs version is >= 24 since <code>package.el</code> is bundled with only higher version. If you are using older version, you may have to manually install that package.</p>\n"}, {"tags": [], "owner": {"reputation": 6792, "user_id": 102675, "user_type": "registered", "accept_rate": 74, "profile_image": "https://www.gravatar.com/avatar/efd2bd4aad1e1e7e5c04d677e35c31c8?s=128&d=identicon&r=PG", "display_name": "Simon Woodside", "link": "https://stackoverflow.com/users/102675/simon-woodside"}, "is_accepted": false, "score": 0, "last_activity_date": 1480479027, "last_edit_date": 1480479027, "creation_date": 1480385516, "answer_id": 40856694, "question_id": 31231839, "link": "https://stackoverflow.com/questions/31231839/installing-haskell-mode-into-emacs-on-ubuntu-12/40856694#40856694", "title": "Installing haskell-mode into Emacs on Ubuntu 12", "body": "<p>This requires <code>emacs24</code> or newer.</p>\n\n<h2>First, install <code>MELPA</code>:</h2>\n\n<pre><code>sudo emacs /etc/emacs/site-start.el\n</code></pre>\n\n<p>Paste in this code: (from <a href=\"https://melpa.org/#/getting-started\" rel=\"nofollow noreferrer\">https://melpa.org/#/getting-started</a>)</p>\n\n<pre><code>(require 'package) ;; You might already have this line\n(add-to-list 'package-archives\n             '(\"melpa\" . \"https://melpa.org/packages/\"))\n(when (&lt; emacs-major-version 24)\n  ;; For important compatibility libraries like cl-lib\n  (add-to-list 'package-archives '(\"gnu\" . \"http://elpa.gnu.org/packages/\")))\n(package-initialize) ;; You might already have this line\n</code></pre>\n\n<p>Save and exit.</p>\n\n<h2>Second, install <code>haskell-mode</code></h2>\n\n<p>To get haskell pretty-printing and indentation, do this to install haskell-mode:</p>\n\n<pre><code>emacs\nM-x package-list-packages RET (Type meta-key and S, then type package-list-packages and hit return)\nC-s haskell-mode RET (Type control-S to search, type nginx and hit return to find the haskell-mode package)\ni (to mark it to install)\nx (to execute installation of marked packages)\n</code></pre>\n\n<h2>Use <code>haskell-mode</code></h2>\n\n<p>Haskell mode will load automatically for haskell files. IF you want to load it manually, you can switch into haskell-mode with <code>M-x haskell-mode</code>.</p>\n"}], "owner": {"reputation": 18456, "user_id": 1198559, "user_type": "registered", "accept_rate": 70, "profile_image": "https://i.stack.imgur.com/bOjLe.png?s=128&g=1", "display_name": "jhegedus", "link": "https://stackoverflow.com/users/1198559/jhegedus"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 314, "favorite_count": 0, "accepted_answer_id": 31232629, "answer_count": 2, "score": 0, "last_activity_date": 1480479027, "creation_date": 1436109379, "question_id": 31231839, "link": "https://stackoverflow.com/questions/31231839/installing-haskell-mode-into-emacs-on-ubuntu-12", "title": "Installing haskell-mode into Emacs on Ubuntu 12", "body": "<p>I'm following <a href=\"https://github.com/haskell/haskell-mode\" rel=\"nofollow noreferrer\">these</a> instructions to install haskell-mode on Ubuntu 12. However when I get to the point of typing <code>M-x customize-option RET pac</code> then Emacs says: no match! All the customizable variables are shown in the picture below.</p>\n\n<p>Any idea what is going wrong?</p>\n\n<p><img src=\"https://i.stack.imgur.com/W3YB3.png\" alt=\"enter image description here\"></p>\n"}, {"tags": ["haskell", "exception", "exception-handling"], "answers": [{"comments": [{"owner": {"reputation": 11617, "user_id": 576549, "user_type": "registered", "accept_rate": 74, "profile_image": "https://i.stack.imgur.com/E3mRg.png?s=128&g=1", "display_name": "Eugene Loy", "link": "https://stackoverflow.com/users/576549/eugene-loy"}, "edited": false, "score": 0, "creation_date": 1436390032, "post_id": 31232092, "comment_id": 50597546, "body": "As a side note for anyone who are having similar situation, in my actual app it was not enough to <code>evaluate</code> expression to WHNF, and I had to also use <code>force</code> (<a href=\"http://hackage.haskell.org/packages/archive/deepseq/latest/doc/html/Control-DeepSeq.html#v:force\" rel=\"nofollow noreferrer\">hackage.haskell.org/packages/archive/deepseq/latest/doc/htm&zwnj;&#8203;l/&hellip;</a>)"}, {"owner": {"reputation": 100892, "user_id": 745903, "user_type": "registered", "accept_rate": 74, "profile_image": "https://www.gravatar.com/avatar/50933f6638836741e620669b3940410e?s=128&d=identicon&r=PG", "display_name": "leftaroundabout", "link": "https://stackoverflow.com/users/745903/leftaroundabout"}, "reply_to_user": {"reputation": 11617, "user_id": 576549, "user_type": "registered", "accept_rate": 74, "profile_image": "https://i.stack.imgur.com/E3mRg.png?s=128&g=1", "display_name": "Eugene Loy", "link": "https://stackoverflow.com/users/576549/eugene-loy"}, "edited": false, "score": 0, "creation_date": 1436390198, "post_id": 31232092, "comment_id": 50597639, "body": "@EugenyLoy: then again, as I said, you probably shouldn&#39;t be using exceptions at all. With a proper error monad the whole issue doesn&#39;t arise in the first place, and the result is evaluate exactly as deeply as needed to be sure there&#39;s no error."}], "tags": [], "owner": {"reputation": 100892, "user_id": 745903, "user_type": "registered", "accept_rate": 74, "profile_image": "https://www.gravatar.com/avatar/50933f6638836741e620669b3940410e?s=128&d=identicon&r=PG", "display_name": "leftaroundabout", "link": "https://stackoverflow.com/users/745903/leftaroundabout"}, "is_accepted": true, "score": 9, "last_activity_date": 1436135965, "last_edit_date": 1495541646, "creation_date": 1436111118, "answer_id": 31232092, "question_id": 31231542, "link": "https://stackoverflow.com/questions/31231542/handling-exceptions-thrown-by-pure-code-with-try/31232092#31232092", "title": "Handling exceptions thrown by pure code with `try`", "body": "<p>Well, basically (<a href=\"https://stackoverflow.com/a/31231587/745903\">as Sebastian Redl pointed out earlier</a>) this is a strictness issue. <code>return thrower</code> does not in any way evaluate <code>thrower</code>, so <code>try</code> <em>succeeds</em>. Only when the content of the <code>Either SomeException Int</code> is printed, namely <code>Right thrower</code>, does <code>read</code> actually try to parse <code>\"A\"</code>, and fails... but at this point, the <code>try</code> is already over.</p>\n\n<p>The way to prevent this is to <a href=\"http://hackage.haskell.org/packages/archive/base/latest/doc/html/Control-Exception-Base.html#v:evaluate\" rel=\"nofollow noreferrer\">inject the parse result <em>strictly</em></a> into the <code>IO</code> monad, with</p>\n\n<pre><code>main = do\n    x &lt;- try $ evaluate thrower :: IO (Either SomeException Int)\n    print x\n</code></pre>\n\n<p>Why the <code>try</code> fails with your code in GHCi I don't know; I daresay it shouldn't. <sub>Aha: <a href=\"https://stackoverflow.com/a/31232517/745903\">as Reid noted</a>, <em>it doesn't fail actually</em>!</sub></p>\n\n<p>Arguably, this is an example for why exceptions should generally be avoided in Haskell. <a href=\"http://hackage.haskell.org/package/mtl-2.2.1/docs/Control-Monad-Error-Class.html#t:MonadError\" rel=\"nofollow noreferrer\">Use a suitable monad transformer</a> to make it explicit what errors might occur, and to get reliable evaluation of the error-checking.</p>\n"}, {"comments": [{"owner": {"reputation": 100185, "user_id": 3234959, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/93bb12ca0f93dfddb33880316f7e66c2?s=128&d=identicon&r=PG&f=1", "display_name": "chi", "link": "https://stackoverflow.com/users/3234959/chi"}, "edited": false, "score": 0, "creation_date": 1436125537, "post_id": 31232517, "comment_id": 50467270, "body": "Very good point. I did not notice the <code>Right</code>, and thought it was a <code>Left</code>."}, {"owner": {"reputation": 100892, "user_id": 745903, "user_type": "registered", "accept_rate": 74, "profile_image": "https://www.gravatar.com/avatar/50933f6638836741e620669b3940410e?s=128&d=identicon&r=PG", "display_name": "leftaroundabout", "link": "https://stackoverflow.com/users/745903/leftaroundabout"}, "edited": false, "score": 0, "creation_date": 1436135814, "post_id": 31232517, "comment_id": 50469970, "body": "Neither did I, well spotted."}], "tags": [], "owner": {"reputation": 14485, "user_id": 190376, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/cd8280c5e1491b8cf55760750ed97dec?s=128&d=identicon&r=PG", "display_name": "Reid Barton", "link": "https://stackoverflow.com/users/190376/reid-barton"}, "is_accepted": false, "score": 7, "last_activity_date": 1436113721, "creation_date": 1436113721, "answer_id": 31232517, "question_id": 31231542, "link": "https://stackoverflow.com/questions/31231542/handling-exceptions-thrown-by-pure-code-with-try/31232517#31232517", "title": "Handling exceptions thrown by pure code with `try`", "body": "<p>Part of what you're missing is that when you ran your code in ghci, <code>try</code> also did not catch the error raised by <code>read \"A\" :: Int</code>. Weren't you expecting a <code>Left &lt;something&gt;</code> result? See leftaroundabout's answer for why that is.</p>\n\n<p>The difference between ghci and ghc here is probably due to output buffering: output to stdout (like <code>\"Right \"</code> here) is unbuffered in ghci, but line buffered by default in a compiled program.</p>\n"}], "owner": {"reputation": 11617, "user_id": 576549, "user_type": "registered", "accept_rate": 74, "profile_image": "https://i.stack.imgur.com/E3mRg.png?s=128&g=1", "display_name": "Eugene Loy", "link": "https://stackoverflow.com/users/576549/eugene-loy"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 203, "favorite_count": 0, "accepted_answer_id": 31232092, "answer_count": 2, "score": 6, "last_activity_date": 1436135965, "creation_date": 1436107558, "question_id": 31231542, "link": "https://stackoverflow.com/questions/31231542/handling-exceptions-thrown-by-pure-code-with-try", "title": "Handling exceptions thrown by pure code with `try`", "body": "<p>I am playing with exceptions in haskell and stumbled upon one thing I can't understand yet.</p>\n\n<p>In GHCi I do:</p>\n\n<pre><code>Prelude Control.Exception&gt; let thrower = (read \"A\") :: Int\nPrelude Control.Exception&gt; :{\nPrelude Control.Exception| let main = do\nPrelude Control.Exception|     x &lt;- (try $ return thrower) :: IO (Either SomeException Int)\nPrelude Control.Exception|     print x\nPrelude Control.Exception| :}\nPrelude Control.Exception&gt; main\n</code></pre>\n\n<p>This defines <code>thrower</code>, my test expression that will fail with exception. </p>\n\n<p>Then I define <code>main</code> that wraps that expression into <code>try</code> (wrapping it into <code>IO</code> first, since <code>try</code> accepts <code>IO</code>) and then unwraps it from <code>IO</code> (produced by <code>try</code>) and <code>print</code>s it.</p>\n\n<p>Everything looks great so far - evaluating <code>main</code> in repl gives back exception wrapped into Either:</p>\n\n<pre><code>Right *** Exception: Prelude.read: no parse\n</code></pre>\n\n<p>However, if I try to compile and execute same code as an app:</p>\n\n<pre><code>module Main where\n\nimport Control.Exception\n\nthrower = (read \"A\") :: Int\n\nmain = do\n    x &lt;- (try $ return thrower) :: IO (Either SomeException Int)\n    print x\n</code></pre>\n\n<p>... it gets crashed with exception:</p>\n\n<pre><code>haskelltest.exe: Prelude.read: no parse\n</code></pre>\n\n<p>It seems like exception slipped past <code>try</code>.</p>\n\n<p>What am I missing here and what is the correct way to handle this?</p>\n"}, {"tags": ["haskell", "extract", "monads"], "comments": [{"owner": {"reputation": 46235, "user_id": 2541573, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/Z1qtP.png?s=128&g=1", "display_name": "jub0bs", "link": "https://stackoverflow.com/users/2541573/jub0bs"}, "edited": false, "score": 0, "creation_date": 1436099012, "post_id": 31230278, "comment_id": 50459510, "body": "Did you implement <code>csvFile</code> yourself? If so, show us how. Otherwise, tell us  where you got it from (edit your question and add your imports)."}, {"owner": {"reputation": 30739, "user_id": 1804599, "user_type": "registered", "accept_rate": 84, "profile_image": "https://i.stack.imgur.com/v91P3.jpg?s=128&g=1", "display_name": "rightfold", "link": "https://stackoverflow.com/users/1804599/rightfold"}, "edited": false, "score": 2, "creation_date": 1436099025, "post_id": 31230278, "comment_id": 50459514, "body": "with <code>fmap</code> or <code>&gt;&gt;=</code>."}, {"owner": {"reputation": 302, "user_id": 4742633, "user_type": "registered", "accept_rate": 47, "profile_image": "https://www.gravatar.com/avatar/b64bd428ea67772ed5eb5a1aa4d6108d?s=128&d=identicon&r=PG", "display_name": "Xlaech", "link": "https://stackoverflow.com/users/4742633/xlaech"}, "reply_to_user": {"reputation": 30739, "user_id": 1804599, "user_type": "registered", "accept_rate": 84, "profile_image": "https://i.stack.imgur.com/v91P3.jpg?s=128&g=1", "display_name": "rightfold", "link": "https://stackoverflow.com/users/1804599/rightfold"}, "edited": false, "score": 0, "creation_date": 1436099673, "post_id": 31230278, "comment_id": 50459660, "body": "@rightfold can you give an application example?"}, {"owner": {"reputation": 46235, "user_id": 2541573, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/Z1qtP.png?s=128&g=1", "display_name": "jub0bs", "link": "https://stackoverflow.com/users/2541573/jub0bs"}, "edited": false, "score": 0, "creation_date": 1436101703, "post_id": 31230278, "comment_id": 50460105, "body": "@NicolasAntor As far as I know, no module called <code>Data.CSV</code> is available on Hackage. However, there are <a href=\"http://hackage.haskell.org/package/cassava-0.4.3.0/docs/Data-Csv.html\" rel=\"nofollow noreferrer\"><code>Data.Csv</code></a> and <a href=\"http://hackage.haskell.org/package/csv-0.1.2/docs/Text-CSV.html\" rel=\"nofollow noreferrer\"><code>Text.CSV</code></a> modules. Did you mean one of those two? Besides, <code>myFile &lt;- parseFromFile csvFile path</code> is illegal outside a <code>do</code> block. You should always post self-contained, minimal, working code."}, {"owner": {"reputation": 302, "user_id": 4742633, "user_type": "registered", "accept_rate": 47, "profile_image": "https://www.gravatar.com/avatar/b64bd428ea67772ed5eb5a1aa4d6108d?s=128&d=identicon&r=PG", "display_name": "Xlaech", "link": "https://stackoverflow.com/users/4742633/xlaech"}, "edited": false, "score": 0, "creation_date": 1436126117, "post_id": 31230278, "comment_id": 50467429, "body": "<a href=\"http://hackage.haskell.org/package/MissingH-1.3.0.1/docs/Data-CSV.html\" rel=\"nofollow noreferrer\">hackage.haskell.org/package/MissingH-1.3.0.1/docs/Data-CSV.h&zwnj;&#8203;tml</a>"}], "answers": [{"comments": [{"owner": {"reputation": 302, "user_id": 4742633, "user_type": "registered", "accept_rate": 47, "profile_image": "https://www.gravatar.com/avatar/b64bd428ea67772ed5eb5a1aa4d6108d?s=128&d=identicon&r=PG", "display_name": "Xlaech", "link": "https://stackoverflow.com/users/4742633/xlaech"}, "edited": false, "score": 0, "creation_date": 1436099511, "post_id": 31230352, "comment_id": 50459632, "body": "yeah here it would work. But if i want to use a other function from outside of the monad?"}, {"owner": {"reputation": 1747, "user_id": 1971462, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/qCUpC.jpg?s=128&g=1", "display_name": "Michael Rawson", "link": "https://stackoverflow.com/users/1971462/michael-rawson"}, "reply_to_user": {"reputation": 302, "user_id": 4742633, "user_type": "registered", "accept_rate": 47, "profile_image": "https://www.gravatar.com/avatar/b64bd428ea67772ed5eb5a1aa4d6108d?s=128&d=identicon&r=PG", "display_name": "Xlaech", "link": "https://stackoverflow.com/users/4742633/xlaech"}, "edited": false, "score": 0, "creation_date": 1436099761, "post_id": 31230352, "comment_id": 50459677, "body": "You can&#39;t &quot;get out of&quot; the I/O monad (this is deliberate). You can either give <code>list</code>, a pure value, to another function (such as <code>doMyProcessing</code> in the example), or return an <code>IO [[String]]</code> and use it in another function in the I/O monad."}, {"owner": {"reputation": 302, "user_id": 4742633, "user_type": "registered", "accept_rate": 47, "profile_image": "https://www.gravatar.com/avatar/b64bd428ea67772ed5eb5a1aa4d6108d?s=128&d=identicon&r=PG", "display_name": "Xlaech", "link": "https://stackoverflow.com/users/4742633/xlaech"}, "edited": false, "score": 0, "creation_date": 1436099824, "post_id": 31230352, "comment_id": 50459692, "body": "So i can&#39;t use a function of type String -&gt; Char -&gt; [String] in IO?"}, {"owner": {"reputation": 9455, "user_id": 1172541, "user_type": "registered", "accept_rate": 30, "profile_image": "https://i.stack.imgur.com/LROoN.png?s=128&g=1", "display_name": "PyRulez", "link": "https://stackoverflow.com/users/1172541/pyrulez"}, "reply_to_user": {"reputation": 302, "user_id": 4742633, "user_type": "registered", "accept_rate": 47, "profile_image": "https://www.gravatar.com/avatar/b64bd428ea67772ed5eb5a1aa4d6108d?s=128&d=identicon&r=PG", "display_name": "Xlaech", "link": "https://stackoverflow.com/users/4742633/xlaech"}, "edited": false, "score": 0, "creation_date": 1436099833, "post_id": 31230352, "comment_id": 50459695, "body": "@NicolasAntor IO means that this isn&#39;t actually any list, but an action that may be performed to get a list. That is what IO is, the monad of actions."}, {"owner": {"reputation": 9455, "user_id": 1172541, "user_type": "registered", "accept_rate": 30, "profile_image": "https://i.stack.imgur.com/LROoN.png?s=128&g=1", "display_name": "PyRulez", "link": "https://stackoverflow.com/users/1172541/pyrulez"}, "reply_to_user": {"reputation": 302, "user_id": 4742633, "user_type": "registered", "accept_rate": 47, "profile_image": "https://www.gravatar.com/avatar/b64bd428ea67772ed5eb5a1aa4d6108d?s=128&d=identicon&r=PG", "display_name": "Xlaech", "link": "https://stackoverflow.com/users/4742633/xlaech"}, "edited": false, "score": 0, "creation_date": 1436099861, "post_id": 31230352, "comment_id": 50459701, "body": "@NicolasAntor Another way to think of it, is, how do you get data out of the Reader monad?"}], "tags": [], "owner": {"reputation": 1747, "user_id": 1971462, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/qCUpC.jpg?s=128&g=1", "display_name": "Michael Rawson", "link": "https://stackoverflow.com/users/1971462/michael-rawson"}, "is_accepted": false, "score": 2, "last_activity_date": 1436099427, "creation_date": 1436099427, "answer_id": 31230352, "question_id": 31230278, "link": "https://stackoverflow.com/questions/31230278/haskell-get-data-in-parsec-io/31230352#31230352", "title": "haskell: Get Data in Parsec IO", "body": "<p>You may just pattern-match on it* - you can ignore the <code>IO</code> layer as you are already working in the I/O monad:</p>\n\n<pre><code>main = do\n  myFile &lt;- parseFromFile csvFile path\n  case myFile of\n    Left _ -&gt; error \"parse error\" -- do something useful here\n    Right list -&gt; print $ doMyProcessing list -- process your list here\n</code></pre>\n\n<p>*I'm not sure about your knowledge level, so I've given a fairly minimal answer. Ask for more explanation if you need it.</p>\n"}], "owner": {"reputation": 302, "user_id": 4742633, "user_type": "registered", "accept_rate": 47, "profile_image": "https://www.gravatar.com/avatar/b64bd428ea67772ed5eb5a1aa4d6108d?s=128&d=identicon&r=PG", "display_name": "Xlaech", "link": "https://stackoverflow.com/users/4742633/xlaech"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 126, "favorite_count": 0, "answer_count": 1, "score": 1, "last_activity_date": 1436099427, "creation_date": 1436098857, "last_edit_date": 1436099064, "question_id": 31230278, "link": "https://stackoverflow.com/questions/31230278/haskell-get-data-in-parsec-io", "title": "haskell: Get Data in Parsec IO", "body": "<p>I have read in a csv File via Parsec and Data.CSV:</p>\n\n<pre><code>import Text.ParserCombinators.Parsec\n-- package MissingH\nimport Data.CSV \nimport Data.Either.Utils\nmyFile &lt;- parseFromFile csvFile path\n</code></pre>\n\n<p>This seems to give me something of type </p>\n\n<pre><code>IO (Either ParseError [[String]])\n</code></pre>\n\n<p>Now i want to do a lot of stuff on my list of lists.\nFor a start i need to map a split on it, since my csv is tab-seperated.</p>\n\n<p><strong>How do i extract the List from this type-structure?</strong></p>\n\n<p>I already found</p>\n\n<p>import Data.Either\n   fromRights</p>\n"}, {"tags": ["haskell", "typeclass", "functor", "traversable"], "comments": [{"owner": {"reputation": 126897, "user_id": 791604, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/ce991df7a056248d5e4f6fc3659ba733?s=128&d=identicon&r=PG", "display_name": "Daniel Wagner", "link": "https://stackoverflow.com/users/791604/daniel-wagner"}, "edited": false, "score": 2, "creation_date": 1436126790, "post_id": 31229674, "comment_id": 50467604, "body": "&quot;You cannot define a <code>Traversable</code> instance without defining the <code>Functor</code> instance first!&quot; Well, &quot;first&quot; is such a squirrely term..."}, {"owner": {"reputation": 7283, "user_id": 348716, "user_type": "registered", "accept_rate": 86, "profile_image": "https://www.gravatar.com/avatar/9d46cbdc3830248a0615f14ae4b7b33d?s=128&d=identicon&r=PG", "display_name": "Anupam Jain", "link": "https://stackoverflow.com/users/348716/anupam-jain"}, "reply_to_user": {"reputation": 126897, "user_id": 791604, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/ce991df7a056248d5e4f6fc3659ba733?s=128&d=identicon&r=PG", "display_name": "Daniel Wagner", "link": "https://stackoverflow.com/users/791604/daniel-wagner"}, "edited": false, "score": 0, "creation_date": 1436182879, "post_id": 31229674, "comment_id": 50487213, "body": "Yeah, that was a bit of a brain fart. Like assuming 1 comes before 2, due to years of counting procedurally from 0-10.  And then you consider the question - what comes first, &#39;-1&#39; or &#39;-2&#39;, and are enlightened."}], "answers": [{"comments": [{"owner": {"reputation": 46235, "user_id": 2541573, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/Z1qtP.png?s=128&g=1", "display_name": "jub0bs", "link": "https://stackoverflow.com/users/2541573/jub0bs"}, "edited": false, "score": 0, "creation_date": 1436095036, "post_id": 31229751, "comment_id": 50458639, "body": "<i>Usually, the instance can in fact be created automatically [...]</i> Isn&#39;t that always the case?"}, {"owner": {"reputation": 100892, "user_id": 745903, "user_type": "registered", "accept_rate": 74, "profile_image": "https://www.gravatar.com/avatar/50933f6638836741e620669b3940410e?s=128&d=identicon&r=PG", "display_name": "leftaroundabout", "link": "https://stackoverflow.com/users/745903/leftaroundabout"}, "reply_to_user": {"reputation": 46235, "user_id": 2541573, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/Z1qtP.png?s=128&g=1", "display_name": "jub0bs", "link": "https://stackoverflow.com/users/2541573/jub0bs"}, "edited": false, "score": 4, "creation_date": 1436095152, "post_id": 31229751, "comment_id": 50458662, "body": "@Jubobs: not quite, for some GADTs I have gotten errors about well-kindedness with <code>DeriveFunctor</code>. But possibly this was just a bug in GHC-7.8."}, {"owner": {"reputation": 7283, "user_id": 348716, "user_type": "registered", "accept_rate": 86, "profile_image": "https://www.gravatar.com/avatar/9d46cbdc3830248a0615f14ae4b7b33d?s=128&d=identicon&r=PG", "display_name": "Anupam Jain", "link": "https://stackoverflow.com/users/348716/anupam-jain"}, "edited": false, "score": 2, "creation_date": 1436095496, "post_id": 31229751, "comment_id": 50458717, "body": "Damn, I had subconciously assumed that &#39;subclass&#39; definitions cannot refer to &#39;superclass&#39; definitions. Obviously that is a somewhat of an arbitrary requirement in hindsight. That&#39;s what you get when you have to use &lt;OOP language of the day&gt; half of the time."}, {"owner": {"reputation": 46235, "user_id": 2541573, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/Z1qtP.png?s=128&g=1", "display_name": "jub0bs", "link": "https://stackoverflow.com/users/2541573/jub0bs"}, "edited": false, "score": 0, "creation_date": 1436101094, "post_id": 31229751, "comment_id": 50459954, "body": "@leftaroundabout Good to know. Thanks."}, {"owner": {"reputation": 24028, "user_id": 383200, "user_type": "registered", "accept_rate": 60, "profile_image": "https://www.gravatar.com/avatar/a9dc722f936cb1059adaae4fe39c07f0?s=128&d=identicon&r=PG", "display_name": "Carl", "link": "https://stackoverflow.com/users/383200/carl"}, "reply_to_user": {"reputation": 46235, "user_id": 2541573, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/Z1qtP.png?s=128&g=1", "display_name": "jub0bs", "link": "https://stackoverflow.com/users/2541573/jub0bs"}, "edited": false, "score": 3, "creation_date": 1436108414, "post_id": 31229751, "comment_id": 50461978, "body": "@Jubobs <code>DeriveFunctor</code> also bails out if it sees a type family used in certain ways, even in cases where you can prove it&#39;s still a valid functor."}], "tags": [], "owner": {"reputation": 100892, "user_id": 745903, "user_type": "registered", "accept_rate": 74, "profile_image": "https://www.gravatar.com/avatar/50933f6638836741e620669b3940410e?s=128&d=identicon&r=PG", "display_name": "leftaroundabout", "link": "https://stackoverflow.com/users/745903/leftaroundabout"}, "is_accepted": true, "score": 11, "last_activity_date": 1436094693, "creation_date": 1436094693, "answer_id": 31229751, "question_id": 31229674, "link": "https://stackoverflow.com/questions/31229674/what-is-the-point-of-fmapdefault-in-data-traversable/31229751#31229751", "title": "What is the point of &#39;fmapDefault&#39; in &#39;Data.Traversable&#39;?", "body": "<p>It allows you to write</p>\n\n<pre><code>data Foo a = ...\n\ninstance Functor Foo where -- we do define the functor instance, but we \u201ccheat\u201d\n  fmap = fmapDefault       -- by using `Traversable` in its implementation!\n\ninstance Traversable Foo where\n  traverse = ...           -- only do this manually.\n</code></pre>\n\n<p>That said, I don't think this is really sensible. Functor instances are usually trivial to do by hand, and the obvious implementation will indeed likely be more efficient than a <code>Traversable</code> derived one. Usually, the instance can in fact be created automatically:</p>\n\n<pre><code>{-# LANGUAGE DeriveFunctor #-}\n\ndata Foo a = ...\n       deriving (Functor)\n</code></pre>\n"}], "owner": {"reputation": 7283, "user_id": 348716, "user_type": "registered", "accept_rate": 86, "profile_image": "https://www.gravatar.com/avatar/9d46cbdc3830248a0615f14ae4b7b33d?s=128&d=identicon&r=PG", "display_name": "Anupam Jain", "link": "https://stackoverflow.com/users/348716/anupam-jain"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 154, "favorite_count": 0, "accepted_answer_id": 31229751, "answer_count": 1, "score": 8, "last_activity_date": 1436094693, "creation_date": 1436094012, "question_id": 31229674, "link": "https://stackoverflow.com/questions/31229674/what-is-the-point-of-fmapdefault-in-data-traversable", "title": "What is the point of &#39;fmapDefault&#39; in &#39;Data.Traversable&#39;?", "body": "<p>I'm looking at the documentation for <code>Data.Traversable</code> and came across <code>fmapDefault</code> - <a href=\"https://downloads.haskell.org/~ghc/latest/docs/html/libraries/base/Data-Traversable.html#g:3\" rel=\"noreferrer\">https://downloads.haskell.org/~ghc/latest/docs/html/libraries/base/Data-Traversable.html#g:3</a></p>\n\n<pre><code>fmapDefault :: Traversable t =&gt; (a -&gt; b) -&gt; t a -&gt; t b\n</code></pre>\n\n<p>The documentation states that -</p>\n\n<blockquote>\n  <p>This function may be used as a value for fmap in a Functor instance, provided that traverse is defined.</p>\n</blockquote>\n\n<p>So presumably it can be used to derive an <code>fmap</code> for a <code>Traversable</code> instance. However, <code>Traversable</code> has <code>Functor</code> as a superclass.</p>\n\n<pre><code>class (Functor t, Foldable t) =&gt; Traversable t where\n    ...\n</code></pre>\n\n<p>So you cannot define a <code>Traversable</code> instance without defining the <code>Functor</code> instance first! And wherever you have a <code>Traversable</code>, you have access to an <code>fmap</code>, which is equivalent to (and perhaps more efficient than) <code>fmapDefault</code>.</p>\n\n<p>So where would one use <code>fmapDefault</code>, instead of the much more familiar <code>fmap</code>?</p>\n"}, {"tags": ["sockets", "haskell", "stream"], "answers": [{"tags": [], "owner": {"reputation": 4565, "user_id": 1134885, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/7c428466054762cf7d4b5fb5f4396fa2?s=128&d=identicon&r=PG", "display_name": "NovaDenizen", "link": "https://stackoverflow.com/users/1134885/novadenizen"}, "is_accepted": false, "score": 1, "last_activity_date": 1436144581, "creation_date": 1436144581, "answer_id": 31236535, "question_id": 31229516, "link": "https://stackoverflow.com/questions/31229516/stream-vs-handle-respondhttp-throws-error/31236535#31236535", "title": "Stream Vs Handle, respondHTTP throws error", "body": "<p>A <code>HandleStream</code> from <code>Network.TCP</code> and a <code>Handle</code> from <code>System.IO</code> are two different things; there is no superclass-subclass relationship.  They are not interchangeable.</p>\n\n<p>Create your <code>Socket</code>, then pass it to <a href=\"http://hackage.haskell.org/package/HTTP-4000.2.20/docs/Network-TCP.html#v:socketConnection\" rel=\"nofollow\"><code>socketConnection</code></a>, not <code>accept</code>.  That will return a <code>HandleStream</code> like you need.</p>\n"}], "owner": {"user_type": "does_not_exist", "display_name": "user2879704"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 38, "favorite_count": 0, "answer_count": 1, "score": 0, "last_activity_date": 1436144581, "creation_date": 1436092945, "last_edit_date": 1436095718, "question_id": 31229516, "link": "https://stackoverflow.com/questions/31229516/stream-vs-handle-respondhttp-throws-error", "title": "Stream Vs Handle, respondHTTP throws error", "body": "<p><code>Network.accept</code> returns me a Handle on accepting a connection, which i am passing as an argument to <code>respondHTTP</code> (from Network.HTTP.Base)\nTheir types are,</p>\n\n<pre><code>accept :: Socket -&gt; IO (Handle, HostName, PortNumber)\nrespondHTTP :: HStream ty =&gt; HandleStream ty -&gt; Response ty -&gt; IO ()\n</code></pre>\n\n<p>This line -- <a href=\"https://github.com/madhavan020985/haskell-examples/blob/master/simpleserver.hs#L43\" rel=\"nofollow\">git-code</a></p>\n\n<pre><code>handleResponse = Kleisli (print ||| respondHTTP c)\n</code></pre>\n\n<p>, throws error as,</p>\n\n<pre><code>simpleserver.hs:43:53:\n    Couldn't match expected type \u2018Network.TCP.HandleStream ty\u2019\n                with actual type \u2018Handle\u2019\n    Relevant bindings include\n      handleResponse :: Kleisli IO (Either b (Response ty)) ()\n        (bound at simpleserver.hs:43:5)\n    In the first argument of \u2018respondHTTP\u2019, namely \u2018c\u2019\n    In the second argument of \u2018(|||)\u2019, namely \u2018respondHTTP c\u2019\n</code></pre>\n\n<p>How can i convert the <code>Handle</code> (returned from <code>Network.accept)</code> into a <code>Stream</code> before passing it to <code>respondHTTP</code>?</p>\n"}, {"tags": ["haskell", "function-composition", "category-theory", "arrows", "category-abstractions"], "comments": [{"owner": {"reputation": 5668, "user_id": 712526, "user_type": "registered", "accept_rate": 50, "profile_image": "https://www.gravatar.com/avatar/06e3c4065e9d08da698b4f4de3959294?s=128&d=identicon&r=PG", "display_name": "jpaugh", "link": "https://stackoverflow.com/users/712526/jpaugh"}, "edited": false, "score": 1, "creation_date": 1436085374, "post_id": 31228515, "comment_id": 50456383, "body": "That blog has a <a href=\"https://wiki.haskell.org/Arrow_tutorial#Kleisli_Arrows\" rel=\"nofollow noreferrer\">link</a> to an article about Kleisli Arrows that seems useful. I believe these two operators represent some kind of function composition (for Arrows which are functions). For other kinds of Arrows, I&#39;m not sure, as arrows are a little strange to me."}], "answers": [{"comments": [{"owner": {"user_type": "does_not_exist", "display_name": "user2879704"}, "edited": false, "score": 0, "creation_date": 1436089335, "post_id": 31228567, "comment_id": 50457216, "body": "that is a beautiful example... thanks... why would someone do <code>show . sqrt . (+2) . abs</code> instead of <code>show $ sqrt $ (+2) $ abs n</code>. i know, dot <code>.</code> is all about some function composition , but does it solve any problem that <code>$</code> doesn&#39;t solve?"}, {"owner": {"reputation": 100892, "user_id": 745903, "user_type": "registered", "accept_rate": 74, "profile_image": "https://www.gravatar.com/avatar/50933f6638836741e620669b3940410e?s=128&d=identicon&r=PG", "display_name": "leftaroundabout", "link": "https://stackoverflow.com/users/745903/leftaroundabout"}, "edited": false, "score": 3, "creation_date": 1436094253, "post_id": 31228567, "comment_id": 50458441, "body": "@MadhavanKumar: well, this is in fact an excellent example for what <code>$</code> doesn&#39;t solve: it can&#39;t be generalised to work in arbitrary categories. (<a href=\"http://stackoverflow.com/questions/31118949/generalising-like-control-category-generalises/31120454#31120454\">Some categories have a generalisation of <code>$</code>, but most don&#39;t \u2013 including <code>Kleisli</code></a>.) Apart from that, point-free style is often more concise, can be somewhat easier refactored, and doesn&#39;t require you to introduce a variable name... however, these aren&#39;t always advantages; sometimes point-free is harder to understand (\u201cpointless code\u201d)."}, {"owner": {"reputation": 4530, "user_id": 94687, "user_type": "registered", "accept_rate": 45, "profile_image": "https://www.gravatar.com/avatar/ef249e4381c9d55297cddc4bd5b5c3c2?s=128&d=identicon&r=PG", "display_name": "imz -- Ivan Zakharyaschev", "link": "https://stackoverflow.com/users/94687/imz-ivan-zakharyaschev"}, "edited": false, "score": 1, "creation_date": 1436097606, "post_id": 31228567, "comment_id": 50459190, "body": "Then, are <code>&lt;=&lt;</code> and <code>&gt;=&gt;</code> also special cases of <code>&lt;&lt;&lt;</code> and <code>&gt;&gt;&gt;</code> that work for monads?"}, {"owner": {"reputation": 4530, "user_id": 94687, "user_type": "registered", "accept_rate": 45, "profile_image": "https://www.gravatar.com/avatar/ef249e4381c9d55297cddc4bd5b5c3c2?s=128&d=identicon&r=PG", "display_name": "imz -- Ivan Zakharyaschev", "link": "https://stackoverflow.com/users/94687/imz-ivan-zakharyaschev"}, "edited": false, "score": 0, "creation_date": 1436097757, "post_id": 31228567, "comment_id": 50459224, "body": "I have written code similar to your example, but using <code>&lt;*&gt;</code> and <code>&lt;$&gt;</code> in the applicative which is a composition of of the applicative for function (composition) and for the effect I&#39;m interested in (logging in your example), i.e., Compose (a-&gt;) (Reader ..). Perhaps you are cleaner"}, {"owner": {"reputation": 507143, "user_id": 1048572, "user_type": "registered", "accept_rate": 77, "profile_image": "https://www.gravatar.com/avatar/7f2c4de95e8f4f8f5a71c3aaf0ed312a?s=128&d=identicon&r=PG", "display_name": "Bergi", "link": "https://stackoverflow.com/users/1048572/bergi"}, "reply_to_user": {"reputation": 4530, "user_id": 94687, "user_type": "registered", "accept_rate": 45, "profile_image": "https://www.gravatar.com/avatar/ef249e4381c9d55297cddc4bd5b5c3c2?s=128&d=identicon&r=PG", "display_name": "imz -- Ivan Zakharyaschev", "link": "https://stackoverflow.com/users/94687/imz-ivan-zakharyaschev"}, "edited": false, "score": 2, "creation_date": 1436099841, "post_id": 31228567, "comment_id": 50459697, "body": "@imz--IvanZakharyaschev: Yes, I think so, only that <code>&gt;=&gt;</code> don&#39;t need that <code>Kleisli</code> newtype wrapper around the monadic function."}], "tags": [], "owner": {"reputation": 100892, "user_id": 745903, "user_type": "registered", "accept_rate": 74, "profile_image": "https://www.gravatar.com/avatar/50933f6638836741e620669b3940410e?s=128&d=identicon&r=PG", "display_name": "leftaroundabout", "link": "https://stackoverflow.com/users/745903/leftaroundabout"}, "is_accepted": true, "score": 21, "last_activity_date": 1436087166, "last_edit_date": 1436087166, "creation_date": 1436085513, "answer_id": 31228567, "question_id": 31228515, "link": "https://stackoverflow.com/questions/31228515/control-category-what-does-and-mean/31228567#31228567", "title": "Control.Category, what does &gt;&gt;&gt; and &lt;&lt;&lt; mean?", "body": "<p>As Hackage and/or Hoogle will tell you,</p>\n\n<pre><code>(&gt;&gt;&gt;) :: Category k =&gt; a`k`b  -&gt; b`k`c  -&gt; a`k`c\n(&lt;&lt;&lt;) :: Category k =&gt; b`k`c  -&gt; a`k`b  -&gt; a`k`c\n</code></pre>\n\n<p>Observe that the latter is actually the same as</p>\n\n<pre><code>(.)   :: Category k =&gt; b`k`c  -&gt; a`k`b  -&gt; a`k`c\n</code></pre>\n\n<p>or, in its <code>Prelude</code> form, specialised to the <strong>Hask</strong> category of functions,</p>\n\n<pre><code>(.)   ::               (b-&gt;c) -&gt; (a-&gt;b) -&gt; (a-&gt;c)\n</code></pre>\n\n<p>So, <code>&lt;&lt;&lt;</code> and <code>&gt;&gt;&gt;</code> simply compose functions, or more generally morphisms/arrows.</p>\n\n<p><code>&lt;&lt;&lt;</code> composes in the same direction as the familiar <code>.</code>, while <code>&gt;&gt;&gt;</code> flips the arguments so that &ldquo;data flows from left to right&rdquo;.</p>\n\n<hr>\n\n<p>Now, what arrow composition <em>means</em>, for categories other than <strong>Hask</strong>, depends of course on the category. <code>Kleisli IO</code> is an easy to understand example: say we have a pure function</p>\n\n<pre><code>pipe :: Double -&gt; String\npipe = show . sqrt . (+2) . abs\n</code></pre>\n\n<p>As I said, this can also be written</p>\n\n<pre><code>pipe = abs &gt;&gt;&gt; (+2) &gt;&gt;&gt; sqrt &gt;&gt;&gt; show\n</code></pre>\n\n<p>Now, if you want to add primitive IO logging (like you might in an imperative language), you can introduce</p>\n\n<pre><code>type (-|&gt;) = Kleisli IO\n\nabs', add2', sqrt' :: Num a =&gt; a -|&gt; a\nshow' :: Show a =&gt; a -|&gt; String\n\nabs'  = Kleisli $ \\x -&gt; do putStrLn (\"Absolute of \"++show x++\"...\")\n                           return $ abs x\nadd2' = Kleisli $ \\x -&gt; do putStrLn (\"Add 2 to \"++show x++\"...\")\n                           return $ x + 2\nsqrt' = Kleisli $ \\x -&gt; do putStrLn (\"Square root of \"++show x++\"...\")\n                           return $ sqrt x\nshow' = Kleisli $ \\x -&gt; do putStrLn (\"Show \"++show x++\"...\")\n                           return $ show x\n</code></pre>\n\n<p>With that, you can define</p>\n\n<pre><code>pipe' :: Double -|&gt; String\n</code></pre>\n\n<p>in <em>exactly</em> the same way as before, i.e.</p>\n\n<pre><code>pipe' = abs' &gt;&gt;&gt; add2' &gt;&gt;&gt; sqrt' &gt;&gt;&gt; show'\n</code></pre>\n\n<p>But you'll now get the intermediate results printed out as a side-effect.</p>\n"}], "owner": {"user_type": "does_not_exist", "display_name": "user2879704"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 700, "favorite_count": 1, "accepted_answer_id": 31228567, "answer_count": 1, "score": 16, "last_activity_date": 1559484215, "creation_date": 1436085083, "last_edit_date": 1559484215, "question_id": 31228515, "link": "https://stackoverflow.com/questions/31228515/control-category-what-does-and-mean", "title": "Control.Category, what does &gt;&gt;&gt; and &lt;&lt;&lt; mean?", "body": "<p>I am following <a href=\"https://lstephen.wordpress.com/2008/02/14/a-simple-haskell-web-server/\" rel=\"noreferrer\">this blog</a>, to write a simple http server in haskell,</p>\n\n<p>Usage of <code>&gt;&gt;&gt;</code> is not clear to me. What does this code snippet do?</p>\n\n<pre><code>handleHttpConnection r c = runKleisli\n    (receiveRequest &gt;&gt;&gt; handleRequest r &gt;&gt;&gt; handleResponse) c &gt;&gt;\n    close c\n</code></pre>\n\n<p>Similary on <a href=\"http://newartisans.com/2012/10/arrows-are-simpler-than-they-appear/\" rel=\"noreferrer\">this link</a>, i am seeing <code>&lt;&lt;&lt;</code></p>\n\n<pre><code>let h =     arr (++ \"!\")\n          &lt;&lt;&lt; arr foo\n          &lt;&lt;&lt; Kleisli bar\n          &lt;&lt;&lt; arr id\n</code></pre>\n\n<p>What does <code>&lt;&lt;&lt;</code> and <code>&gt;&gt;&gt;</code> do? (<a href=\"http://hackage.haskell.org/package/base-4.8.0.0/docs/Control-Category.html\" rel=\"noreferrer\">Hackage document</a> is very concise and couldn't get much out of it.)</p>\n"}, {"tags": ["haskell"], "answers": [{"tags": [], "owner": {"reputation": 34889, "user_id": 86604, "user_type": "registered", "accept_rate": 80, "profile_image": "https://www.gravatar.com/avatar/329af917389e6cf8e146c03012f5319a?s=128&d=identicon&r=PG", "display_name": "Ingo", "link": "https://stackoverflow.com/users/86604/ingo"}, "is_accepted": false, "score": 4, "last_activity_date": 1436089006, "creation_date": 1436089006, "answer_id": 31228991, "question_id": 31228444, "link": "https://stackoverflow.com/questions/31228444/regarding-haskell-type-classes-num-vs-read/31228991#31228991", "title": "Regarding Haskell type classes (Num vs Read)", "body": "<p>Difference is that read could potentially result in any type, whereas fromIntegral yields a number. \nThere is some defaulting going on with regard to numbers in ghci, so that ghci can just use the default type. </p>\n"}, {"tags": [], "owner": {"reputation": 133729, "user_id": 98117, "user_type": "registered", "accept_rate": 80, "profile_image": "https://www.gravatar.com/avatar/4704a2a1d16b276070962ee01fb6149f?s=128&d=identicon&r=PG", "display_name": "hammar", "link": "https://stackoverflow.com/users/98117/hammar"}, "is_accepted": true, "score": 12, "last_activity_date": 1436089908, "creation_date": 1436089908, "answer_id": 31229092, "question_id": 31228444, "link": "https://stackoverflow.com/questions/31228444/regarding-haskell-type-classes-num-vs-read/31229092#31229092", "title": "Regarding Haskell type classes (Num vs Read)", "body": "<p>It works because of <a href=\"https://www.haskell.org/onlinereport/haskell2010/haskellch4.html#x10-790004.3.4\">type defaulting</a>, which causes ambiguous type variables to be defaulted to <code>Integer</code> or <code>Double</code> (or some other user-defined default). This only happens for <code>Num</code> and its subclasses.</p>\n\n<p>In GHCi, <a href=\"https://downloads.haskell.org/~ghc/latest/docs/html/users_guide/interactive-evaluation.html#extended-default-rules\">the rules for defaulting are relaxed</a> to also work for <code>Show</code>, <code>Eq</code> and <code>Ord</code>, and also <code>()</code> is added to the list of default types. This allows expressions like <code>[] == []</code> to type check.</p>\n"}], "owner": {"reputation": 2988, "user_id": 452414, "user_type": "registered", "accept_rate": 80, "profile_image": "https://i.stack.imgur.com/rDMfs.png?s=128&g=1", "display_name": "babon", "link": "https://stackoverflow.com/users/452414/babon"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 146, "favorite_count": 0, "accepted_answer_id": 31229092, "answer_count": 2, "score": 8, "last_activity_date": 1436089908, "creation_date": 1436084453, "question_id": 31228444, "link": "https://stackoverflow.com/questions/31228444/regarding-haskell-type-classes-num-vs-read", "title": "Regarding Haskell type classes (Num vs Read)", "body": "<p>Can someone please explain what I am missing here:</p>\n\n<pre><code>Prelude&gt; :t read\nread :: (Read a) =&gt; String -&gt; a \nPrelude&gt; read \"4\"\n\n&lt;interactive&gt;:1:0:\n    Ambiguous type variable `a' in the constraint:\n      `Read a' arising from a use of `read' at &lt;interactive&gt;:1:0-7\n    Probable fix: add a type signature that fixes these type variable(s)\n</code></pre>\n\n<p><code>read \"4\"</code> raises an error as ghci doesn't know which concrete type we want, it only knows that we have a <code>Read</code> type class. <code>read \"4\" :: Int</code> works fine. This is clear to me.</p>\n\n<p>Now, following the above logic, I expected <code>fromIntegral 4</code> to raise an error:</p>\n\n<pre><code>Prelude&gt; :t fromIntegral\nfromIntegral :: (Integral a, Num b) =&gt; a -&gt; b\nPrelude&gt; fromIntegral 4\n4\n</code></pre>\n\n<p>However, it works fine. Why is a type annotaion NOT required in this case? I expected the above to fail; and ONLY</p>\n\n<pre><code>Prelude&gt; fromIntegral 4 :: Int\n</code></pre>\n\n<p>to work.</p>\n\n<p>NB - I am reading \"Learn you a Haskell for great good\" and have covered till chapter 5. Is what I am asking discussed in chapter 7 (or some other chapter)?</p>\n\n<p>Thanks.</p>\n"}, {"tags": ["haskell"], "answers": [{"tags": [], "owner": {"reputation": 75362, "user_id": 625403, "user_type": "registered", "accept_rate": 82, "profile_image": "https://www.gravatar.com/avatar/786eed7da67079cb5d63a49d469af25b?s=128&d=identicon&r=PG", "display_name": "amalloy", "link": "https://stackoverflow.com/users/625403/amalloy"}, "is_accepted": false, "score": 2, "last_activity_date": 1436076752, "creation_date": 1436076752, "answer_id": 31227628, "question_id": 31227570, "link": "https://stackoverflow.com/questions/31227570/expected-a-type-but-request-has-kind/31227628#31227628", "title": "Expected a type, but \u2018Request\u2019 has kind \u2018* -&gt; *\u2019", "body": "<p><a href=\"http://hackage.haskell.org/package/HTTP-4000.2.20/docs/Network-HTTP-Base.html#t:Request\" rel=\"nofollow\">Look at</a> the type of <code>Request</code>: it needs a single type parameter, which it uses to determine what to do with the body of the http request. That's exactly what the error message is telling you: haskell expected one argument to <code>Request</code>, and you gave it zero.</p>\n"}, {"tags": [], "owner": {"reputation": 48129, "user_id": 76051, "user_type": "registered", "accept_rate": 91, "profile_image": "https://i.stack.imgur.com/AGDxz.jpg?s=128&g=1", "display_name": "Carsten", "link": "https://stackoverflow.com/users/76051/carsten"}, "is_accepted": true, "score": 5, "last_activity_date": 1436076879, "creation_date": 1436076879, "answer_id": 31227645, "question_id": 31227570, "link": "https://stackoverflow.com/questions/31227570/expected-a-type-but-request-has-kind/31227645#31227645", "title": "Expected a type, but \u2018Request\u2019 has kind \u2018* -&gt; *\u2019", "body": "<p><a href=\"https://hackage.haskell.org/package/HTTP-4000.2.20/docs/Network-HTTP-Base.html#t:Request\"><code>Request</code></a> has data in the form of a generic type attached to it (the <code>a</code> in <code>Request a</code> and it represents the request-<em>body</em>) - this is meant when Haskell tells you that <code>Request</code> has <strong>kind</strong> <code>* -&gt; *</code> </p>\n\n<p>So you basically have to fix it - either think of a fixed type and add it:</p>\n\n<pre><code>type RequestHandler = Request String -&gt; IO Response\n</code></pre>\n\n<p>there are already types for this (for example <a href=\"https://hackage.haskell.org/package/HTTP-4000.2.20/docs/Network-HTTP-Base.html#t:Request_String\"><code>Request_String</code></a> so you could say:</p>\n\n<pre><code>type RequestHandler = Request_String -&gt; IO Response\n</code></pre>\n\n<p>too. Or you make your handler generic:</p>\n\n<pre><code>type RequestHandler a = Request a -&gt; IO Response\n</code></pre>\n\n<p>of course with this you will have to change some of your other functions/definitions too (for example the <code>helloWorldHandler</code>).</p>\n"}], "owner": {"user_type": "does_not_exist", "display_name": "user2879704"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 2182, "favorite_count": 0, "accepted_answer_id": 31227645, "answer_count": 2, "score": 3, "last_activity_date": 1436076879, "creation_date": 1436076028, "question_id": 31227570, "link": "https://stackoverflow.com/questions/31227570/expected-a-type-but-request-has-kind", "title": "Expected a type, but \u2018Request\u2019 has kind \u2018* -&gt; *\u2019", "body": "<p>I wrote simple hello world server (http) and i have declared my request handler's type as,</p>\n\n<pre><code>type RequestHandler = Request -&gt; IO Response\n</code></pre>\n\n<p>It throws error as,</p>\n\n<pre><code>simpleserver.hs:11:23:\n    Expecting one more argument to \u2018Request\u2019\n    Expected a type, but \u2018Request\u2019 has kind \u2018* -&gt; *\u2019\n    In the type \u2018Request -&gt; IO Response\u2019\n    In the type declaration for \u2018RequestHandler\u2019\n</code></pre>\n\n<p><a href=\"https://github.com/madhavan020985/haskell-examples/blob/master/simpleserver.hs#L11\" rel=\"nofollow\">complete-code</a></p>\n\n<p>This error message makes no sense to me..</p>\n\n<p>Why is this error thrown and how can i fix this?</p>\n"}, {"tags": ["postgresql", "haskell", "cube"], "comments": [{"owner": {"reputation": 669, "user_id": 3714434, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/06a65866e8ef0ee97ab4cd4c4ffaadc6?s=128&d=identicon&r=PG&f=1", "display_name": "ibotty", "link": "https://stackoverflow.com/users/3714434/ibotty"}, "edited": false, "score": 0, "creation_date": 1436086645, "post_id": 31226073, "comment_id": 50456671, "body": "Did you try adding a <code>Cube</code> datatype and the <code>FromField</code> and <code>ToField</code> instances? If you succeed, be sure to contribute to upstream. lpsmith is supportive to these kind of additions."}, {"owner": {"reputation": 13264, "user_id": 190887, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/b1a747d0a7e3450408e0f07adba49111?s=128&d=identicon&r=PG", "display_name": "Inaimathi", "link": "https://stackoverflow.com/users/190887/inaimathi"}, "reply_to_user": {"reputation": 669, "user_id": 3714434, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/06a65866e8ef0ee97ab4cd4c4ffaadc6?s=128&d=identicon&r=PG&f=1", "display_name": "ibotty", "link": "https://stackoverflow.com/users/3714434/ibotty"}, "edited": false, "score": 1, "creation_date": 1436134496, "post_id": 31226073, "comment_id": 50469619, "body": "@ibotty - <a href=\"https://github.com/lpsmith/postgresql-simple/pull/152\" rel=\"nofollow noreferrer\">Yes</a>. I don&#39;t need <code>FromField</code> for my puproses, and it looks like it would be hard to add, so I left that out (if there&#39;s reading I could do to figure it out I&#39;d give it a try, but the non-primitve <a href=\"https://github.com/lpsmith/postgresql-simple/blob/master/src/Database/PostgreSQL/Simple/FromField.hs\" rel=\"nofollow noreferrer\"><code>FromField</code></a> definitions look intimidating enough that I don&#39;t want to go in without knowing more about the approach)."}, {"owner": {"reputation": 669, "user_id": 3714434, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/06a65866e8ef0ee97ab4cd4c4ffaadc6?s=128&d=identicon&r=PG&f=1", "display_name": "ibotty", "link": "https://stackoverflow.com/users/3714434/ibotty"}, "edited": false, "score": 0, "creation_date": 1436203587, "post_id": 31226073, "comment_id": 50500927, "body": "great! Thumbs up! I don&#39;t have time to guide you through the non-trivial instances. But be assured, it&#39;s not that hard. Pretty sure you had bigger obstacles you overcame in haskell before."}], "answers": [{"tags": [], "owner": {"reputation": 13264, "user_id": 190887, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/b1a747d0a7e3450408e0f07adba49111?s=128&d=identicon&r=PG", "display_name": "Inaimathi", "link": "https://stackoverflow.com/users/190887/inaimathi"}, "is_accepted": true, "score": 0, "last_activity_date": 1436315318, "creation_date": 1436315318, "answer_id": 31281611, "question_id": 31226073, "link": "https://stackoverflow.com/questions/31226073/using-cubes-in-postgresql-simple/31281611#31281611", "title": "Using cubes in postgresql-simple", "body": "<p>You can use <a href=\"http://hackage.haskell.org/package/postgresql-cube-0.1.0.0\" rel=\"nofollow\">this mini-library</a> I wrote. Once you include that, you can do </p>\n\n<pre><code>execute \"INSERT INTO table(cube_field, name) VALUES(?, ?) RETURNING id\" (Cube [[1, 2, 3]], \"Testing\")\n</code></pre>\n\n<p>and, more importantly,</p>\n\n<pre><code>executeMany \"INSERT INTO table(cube_field, name) VALUES(?, ?) RETURNING id\"\n            [(Cube [[1, 2]], \"One\"), (Cube [[3, 4]], \"Two\"), (Cube [[5, 6]], \"Three\")]\n</code></pre>\n\n<p>There's no <code>fromField</code> instance, so you can't select <code>Cube</code>s at this point. I won't be adding that because it looks non-trivial, and I don't need it for my use-case, but <a href=\"https://github.com/Inaimathi/postgresql-cube\" rel=\"nofollow\">patches are definitely welcome</a>.</p>\n"}], "owner": {"reputation": 13264, "user_id": 190887, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/b1a747d0a7e3450408e0f07adba49111?s=128&d=identicon&r=PG", "display_name": "Inaimathi", "link": "https://stackoverflow.com/users/190887/inaimathi"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 410, "favorite_count": 0, "accepted_answer_id": 31281611, "answer_count": 1, "score": 0, "last_activity_date": 1436315318, "creation_date": 1436054123, "question_id": 31226073, "link": "https://stackoverflow.com/questions/31226073/using-cubes-in-postgresql-simple", "title": "Using cubes in postgresql-simple", "body": "<p>How are you meant to use <a href=\"http://www.postgresql.org/docs/9.1/static/cube.html\" rel=\"nofollow\"><code>cube</code>s</a> with <a href=\"https://hackage.haskell.org/package/postgresql-simple-0.4.10.0/docs/Database-PostgreSQL-Simple.html\" rel=\"nofollow\"><code>postgresql-simple</code></a>?</p>\n\n<p>At the moment, I'm doing things like</p>\n\n<pre><code>query conn \"SELECT thing FROM table WHERE coord &lt;@ cube('?, ?') ORDER BY cube_distance(coord, cube('?')) ASC\" \n      (In [a, b, c], In [d, e, f], In [g, h, i])\n</code></pre>\n\n<p>which works fine, but feels like a misuse of <code>In</code>. It also fails in the case of <code>executeMany</code>. For example</p>\n\n<pre><code>executeMany conn \"INSERT INTO table(thing, coord) VALUES(?, cube('?'))\" lst\n</code></pre>\n\n<p>where <code>lst :: [(String, In [Float])]</code> fails with a <code>syntax error in multi-row template</code>. The equivalent, but less efficient</p>\n\n<pre><code>mapM_ (execute conn \"INSERT INTO table(thing, coord) VALUES(?, cube('?'))\") lst\n</code></pre>\n\n<p>works fine, so I'm assuming this has to do with how <code>executeMany</code> organizes the arguments for insertion. </p>\n\n<p>However, the docs make no mention of a <code>Cube</code> type, and I can't find an example of its use, so I'm not really sure what I'm <em>supposed</em> to do.</p>\n"}, {"tags": ["haskell", "optimization", "linked-list"], "comments": [{"owner": {"reputation": 5239, "user_id": 116712, "user_type": "registered", "accept_rate": 40, "profile_image": "https://www.gravatar.com/avatar/701608e36b9a5e769889abc8e76e3f08?s=128&d=identicon&r=PG", "display_name": "pablochan", "link": "https://stackoverflow.com/users/116712/pablochan"}, "edited": false, "score": 0, "creation_date": 1436046594, "post_id": 31225280, "comment_id": 50450663, "body": "Maybe just use a Sequence? <a href=\"http://hackage.haskell.org/package/containers-0.5.6.3/docs/Data-Sequence.html\" rel=\"nofollow noreferrer\">hackage.haskell.org/package/containers-0.5.6.3/docs/&hellip;</a>"}, {"owner": {"reputation": 8676, "user_id": 1113881, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/sBc0F.jpg?s=128&g=1", "display_name": "CR Drost", "link": "https://stackoverflow.com/users/1113881/cr-drost"}, "edited": false, "score": 0, "creation_date": 1436046653, "post_id": 31225280, "comment_id": 50450676, "body": "I guess the obvious first question is, &quot;what are you doing that the amortized-O(1) cost of list reversal isn&#39;t working out for you?&quot; Because lists are already pretty fast and can get even faster for this sort of application if you make them spine-strict; moreover you can&#39;t asymptotically get faster than them for this purpose so you&#39;re chasing a better multiplicative constant -- and that only comes when you simplify the code that actually gets run by the CPU, reduce memory allocations, etc."}, {"owner": {"reputation": 3975, "user_id": 1031627, "user_type": "registered", "accept_rate": 72, "profile_image": "https://i.stack.imgur.com/yamFN.jpg?s=128&g=1", "display_name": "Luka Horvat", "link": "https://stackoverflow.com/users/1031627/luka-horvat"}, "edited": false, "score": 0, "creation_date": 1436046656, "post_id": 31225280, "comment_id": 50450677, "body": "I did try them out and they were even slower."}, {"owner": {"reputation": 3975, "user_id": 1031627, "user_type": "registered", "accept_rate": 72, "profile_image": "https://i.stack.imgur.com/yamFN.jpg?s=128&g=1", "display_name": "Luka Horvat", "link": "https://stackoverflow.com/users/1031627/luka-horvat"}, "reply_to_user": {"reputation": 8676, "user_id": 1113881, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/sBc0F.jpg?s=128&g=1", "display_name": "CR Drost", "link": "https://stackoverflow.com/users/1113881/cr-drost"}, "edited": false, "score": 0, "creation_date": 1436046788, "post_id": 31225280, "comment_id": 50450703, "body": "@ChrisDrost I&#39;m aware of that and that&#39;s exactly what I want to do! Hopefully someone can show me how. What I&#39;m doing in the <code>test</code> function is actually more or less what&#39;s happening in my original application. I&#39;m hesitant to get into more details than needed because, despite peoples best intentions, my original desires will get overlooked and I&#39;ll just get the &quot;here&#39;s a package that already does that&quot; answers."}, {"owner": {"reputation": 3975, "user_id": 1031627, "user_type": "registered", "accept_rate": 72, "profile_image": "https://i.stack.imgur.com/yamFN.jpg?s=128&g=1", "display_name": "Luka Horvat", "link": "https://stackoverflow.com/users/1031627/luka-horvat"}, "reply_to_user": {"reputation": 8676, "user_id": 1113881, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/sBc0F.jpg?s=128&g=1", "display_name": "CR Drost", "link": "https://stackoverflow.com/users/1113881/cr-drost"}, "edited": false, "score": 0, "creation_date": 1436046993, "post_id": 31225280, "comment_id": 50450734, "body": "@ChrisDrost What I&#39;m looking for here is a 2 times speed increase over what I&#39;m doing with the regular list. If you can achieve that WITH the regular list, I would also accept that answer."}, {"owner": {"reputation": 117024, "user_id": 200291, "user_type": "registered", "accept_rate": 81, "profile_image": "https://www.gravatar.com/avatar/399cacf55045372a29f1f844d12ee777?s=128&d=identicon&r=PG", "display_name": "icktoofay", "link": "https://stackoverflow.com/users/200291/icktoofay"}, "edited": false, "score": 0, "creation_date": 1436049700, "post_id": 31225280, "comment_id": 50451217, "body": "Have you tried using a difference list?"}, {"owner": {"reputation": 3975, "user_id": 1031627, "user_type": "registered", "accept_rate": 72, "profile_image": "https://i.stack.imgur.com/yamFN.jpg?s=128&g=1", "display_name": "Luka Horvat", "link": "https://stackoverflow.com/users/1031627/luka-horvat"}, "reply_to_user": {"reputation": 117024, "user_id": 200291, "user_type": "registered", "accept_rate": 81, "profile_image": "https://www.gravatar.com/avatar/399cacf55045372a29f1f844d12ee777?s=128&d=identicon&r=PG", "display_name": "icktoofay", "link": "https://stackoverflow.com/users/200291/icktoofay"}, "edited": false, "score": 0, "creation_date": 1436051039, "post_id": 31225280, "comment_id": 50451414, "body": "@icktoofay I didn&#39;t. I&#39;ll see if it makes a <i>difference</i> (ehehehehe)"}, {"owner": {"reputation": 3975, "user_id": 1031627, "user_type": "registered", "accept_rate": 72, "profile_image": "https://i.stack.imgur.com/yamFN.jpg?s=128&g=1", "display_name": "Luka Horvat", "link": "https://stackoverflow.com/users/1031627/luka-horvat"}, "reply_to_user": {"reputation": 117024, "user_id": 200291, "user_type": "registered", "accept_rate": 81, "profile_image": "https://www.gravatar.com/avatar/399cacf55045372a29f1f844d12ee777?s=128&d=identicon&r=PG", "display_name": "icktoofay", "link": "https://stackoverflow.com/users/200291/icktoofay"}, "edited": false, "score": 0, "creation_date": 1436055059, "post_id": 31225280, "comment_id": 50451998, "body": "@icktoofay It did! This does solve my original problem and I&#39;ll be sure to check out how DLists are done. The question still stands and I would love to get an answer."}], "answers": [{"comments": [{"owner": {"reputation": 3975, "user_id": 1031627, "user_type": "registered", "accept_rate": 72, "profile_image": "https://i.stack.imgur.com/yamFN.jpg?s=128&g=1", "display_name": "Luka Horvat", "link": "https://stackoverflow.com/users/1031627/luka-horvat"}, "edited": false, "score": 0, "creation_date": 1436084629, "post_id": 31226263, "comment_id": 50456236, "body": "I am going to accept this answer, though I wouldn&#39;t mind a bit of elaboration on how I could make my current method better. I realize trade offs have to be made but isn&#39;t the whole point of having special cases that allow mutation so that you can write algorithms that perform better with it? Is mutation really just outright slow in GHC? Anything I can do about it?"}, {"owner": {"reputation": 785, "user_id": 3087558, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/a43d21bfa85dc7dc360cafa7f69ba3b1?s=128&d=identicon&r=PG&f=1", "display_name": "fgv", "link": "https://stackoverflow.com/users/3087558/fgv"}, "edited": false, "score": 0, "creation_date": 1436102207, "post_id": 31226263, "comment_id": 50460239, "body": "While it is true that there are cases where a mutable data structure can perform better than an immutable one, yours doesn&#39;t seem to be one of them. If you haven&#39;t, I recommend that you take a look at Okasaki&#39;s Purely Functional Data Structures book (<a href=\"https://rads.stackoverflow.com/amzn/click/com/0521663504\" rel=\"nofollow noreferrer\" rel=\"nofollow noreferrer\">amazon.com/Purely-Functional-Structures-Chris-Okasaki/dp/&hellip;</a>) or just his paper on Queues and dQueues (<a href=\"http://www.westpoint.edu/eecs/SiteAssets/SitePages/Faculty%20Publication%20Documents/Okasaki/jfp95queue.pdf\" rel=\"nofollow noreferrer\">westpoint.edu/eecs/SiteAssets/SitePages/&hellip;</a>)."}, {"owner": {"reputation": 24028, "user_id": 383200, "user_type": "registered", "accept_rate": 60, "profile_image": "https://www.gravatar.com/avatar/a9dc722f936cb1059adaae4fe39c07f0?s=128&d=identicon&r=PG", "display_name": "Carl", "link": "https://stackoverflow.com/users/383200/carl"}, "reply_to_user": {"reputation": 3975, "user_id": 1031627, "user_type": "registered", "accept_rate": 72, "profile_image": "https://i.stack.imgur.com/yamFN.jpg?s=128&g=1", "display_name": "Luka Horvat", "link": "https://stackoverflow.com/users/1031627/luka-horvat"}, "edited": false, "score": 0, "creation_date": 1436107810, "post_id": 31226263, "comment_id": 50461793, "body": "@LukaHorvat First, the slowness mostly is due to boxed values with the garbage collector. If your mutable cell contains only unboxed values, there is no slowness. Second, despite that, mutability can be a win even with boxed values in the cases where it can shave an asymptotic factor of O(log n) off your algorithm."}, {"owner": {"reputation": 3975, "user_id": 1031627, "user_type": "registered", "accept_rate": 72, "profile_image": "https://i.stack.imgur.com/yamFN.jpg?s=128&g=1", "display_name": "Luka Horvat", "link": "https://stackoverflow.com/users/1031627/luka-horvat"}, "edited": false, "score": 0, "creation_date": 1436107992, "post_id": 31226263, "comment_id": 50461842, "body": "@Carl So the case where my mutable values are boxed and I&#39;m trying to reduce the multiplicative constant is where I&#39;m stuck with that tradeoff?"}, {"owner": {"reputation": 24028, "user_id": 383200, "user_type": "registered", "accept_rate": 60, "profile_image": "https://www.gravatar.com/avatar/a9dc722f936cb1059adaae4fe39c07f0?s=128&d=identicon&r=PG", "display_name": "Carl", "link": "https://stackoverflow.com/users/383200/carl"}, "reply_to_user": {"reputation": 3975, "user_id": 1031627, "user_type": "registered", "accept_rate": 72, "profile_image": "https://i.stack.imgur.com/yamFN.jpg?s=128&g=1", "display_name": "Luka Horvat", "link": "https://stackoverflow.com/users/1031627/luka-horvat"}, "edited": false, "score": 0, "creation_date": 1436108306, "post_id": 31226263, "comment_id": 50461949, "body": "@LukaHorvat Well, that&#39;s where you&#39;re going to be paying most for the tradeoffs, yes."}], "tags": [], "owner": {"reputation": 24028, "user_id": 383200, "user_type": "registered", "accept_rate": 60, "profile_image": "https://www.gravatar.com/avatar/a9dc722f936cb1059adaae4fe39c07f0?s=128&d=identicon&r=PG", "display_name": "Carl", "link": "https://stackoverflow.com/users/383200/carl"}, "is_accepted": true, "score": 5, "last_activity_date": 1436057621, "last_edit_date": 1436057621, "creation_date": 1436056739, "answer_id": 31226263, "question_id": 31225280, "link": "https://stackoverflow.com/questions/31225280/why-is-my-mutable-linked-list-slower-than-the-immutable-variant/31226263#31226263", "title": "Why is my mutable linked list slower than the immutable variant?", "body": "<p>The simple reason is that the tradeoffs GHC's runtime system (especially the garbage collector) makes are designed to make immutable data as fast as possible, at the expense of speed in code that mutates cells pointing to boxed values.  In particular, the GC system makes lots of optimizations that assume values are mutated at most once (lazy evaluation).  When those conditions aren't true, it adds a bunch of overhead because it has to work around those optimizations.</p>\n\n<p>As for solving it, it seems someone else mentioned difference lists, and they do indeed work.  No need to use the package, though.  It's a sufficiently simple data type that you might as well inline your uses of it, unless you need the instances the package provides.</p>\n\n<p>The basic idea is that you don't work with lists, you work with functions instead.</p>\n\n<pre><code>nil :: [a] -&gt; [a]\nnil = id\n\nsnoc :: a -&gt; ([a] -&gt; [a]) -&gt; [a] -&gt; [a]\nsnoc x f = f . (x :)\n\ntoList :: ([a] -&gt; [a]) -&gt; [a]\ntoList f = f []\n</code></pre>\n\n<p>This gives you really good performance in the use case where you perform a bunch of <code>snoc</code> operations, followed by converting it to a list a single time.  It's <em>really</em> bad when your pattern is <code>snoc</code> a single element, traverse, repeat.</p>\n"}], "owner": {"reputation": 3975, "user_id": 1031627, "user_type": "registered", "accept_rate": 72, "profile_image": "https://i.stack.imgur.com/yamFN.jpg?s=128&g=1", "display_name": "Luka Horvat", "link": "https://stackoverflow.com/users/1031627/luka-horvat"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 210, "favorite_count": 0, "accepted_answer_id": 31226263, "answer_count": 1, "score": 2, "last_activity_date": 1436057621, "creation_date": 1436045667, "last_edit_date": 1436046094, "question_id": 31225280, "link": "https://stackoverflow.com/questions/31225280/why-is-my-mutable-linked-list-slower-than-the-immutable-variant", "title": "Why is my mutable linked list slower than the immutable variant?", "body": "<p>I have a use case where I need a structure that has a constant time insertion and then can be iterated from oldest to newest. Basically a queue. The difference is that the insertion and iteration happen in separate steps to a simple list is ALMOST good enough. I just need to do one reverse at the end.\nThis reverse is what I'm trying to get rid off.</p>\n\n<p>I've set out to implement this myself inside the <code>ST</code> monad.\nThe resulting performance is 4 times slower. I'll include all of the relevant code (it's self contained) and the function I'm using to benchmark it. You can compile it yourself provided you install the <code>timeit</code> package.</p>\n\n<pre><code>{-# LANGUAGE ViewPatterns #-}\nmodule LinkedListSpecial where\n\nimport Prelude hiding (mapM_)\nimport Control.Monad.ST\nimport Data.STRef\nimport Data.Foldable (mapM_, foldlM, forM_)\nimport System.TimeIt\n\ndata LLN s a = Stub (STRef s (Maybe (LLN s a)))\n             | LLN a (STRef s (Maybe (LLN s a)))\n\ngetRef :: LLN s a -&gt; STRef s (Maybe (LLN s a))\ngetRef (Stub ref)  = ref\ngetRef (LLN _ ref) = ref\n\nemptyNode :: ST s (LLN s a)\nemptyNode = fmap Stub (newSTRef Nothing)\n\nmakeNode :: a -&gt; ST s (LLN s a)\nmakeNode x = fmap (LLN x) $! newSTRef Nothing\n\nappend :: LLN s a -&gt; a -&gt; ST s (LLN s a)\nappend (getRef -&gt; ref) x = do\n    new &lt;- makeNode x\n    writeSTRef ref (Just new)\n    return new\n\niter :: (a -&gt; ST s ()) -&gt; LLN s a -&gt; ST s ()\niter f (Stub ref) = do\n    next &lt;- readSTRef ref\n    mapM_ (iter f) next\niter f (LLN x ref) = do\n    f x\n    next &lt;- readSTRef ref\n    mapM_ (iter f) next\n\nfromList :: [a] -&gt; ST s (LLN s a, LLN s a)\nfromList xs = do\n    f &lt;- emptyNode\n    l &lt;- foldlM append f xs\n    return (f, l)\n\ntest :: IO ()\ntest = do\n    let seedList = [1..1000000]\n    print \"Normal list\"\n    timeIt $ print $ runST $ do\n        ref &lt;- newSTRef []\n        forM_ seedList (\\i -&gt; modifySTRef' ref (i :))\n        list &lt;- readSTRef ref\n        return (sum list :: Integer)\n    print \"Linked list\"\n    timeIt $ print $ runST $ do\n        (listBegin, _) &lt;- fromList seedList\n        s &lt;- newSTRef (0 :: Integer)\n        iter (\\i -&gt; modifySTRef' s (+ i)) listBegin\n        readSTRef s\n</code></pre>\n\n<p>I would appreciate it if someone more skilled in optimization would tell me what can be improved.</p>\n\n<p>Edit:\nThe performance drop is less drastic when running compiled code, but my list is still about twice as slow.</p>\n"}, {"tags": ["haskell", "ghci"], "comments": [{"owner": {"reputation": 22266, "user_id": 649287, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/7c0ea0055b84020bf860c05f53ba53d5?s=128&d=identicon&r=PG", "display_name": "augustss", "link": "https://stackoverflow.com/users/649287/augustss"}, "edited": false, "score": 6, "creation_date": 1436040379, "post_id": 31224457, "comment_id": 50449308, "body": "I&#39;ve seen similar problems. A type error in one function makes ghc &quot;confused&quot; about another function.  I think it&#39;s because it stops applying defaulting after a type error.  This problem has just gotten worse in newer versions of ghc and is very annoying since the real error is often not the first reported error.  It&#39;s really a ghc bug."}, {"owner": {"reputation": 100892, "user_id": 745903, "user_type": "registered", "accept_rate": 74, "profile_image": "https://www.gravatar.com/avatar/50933f6638836741e620669b3940410e?s=128&d=identicon&r=PG", "display_name": "leftaroundabout", "link": "https://stackoverflow.com/users/745903/leftaroundabout"}, "edited": false, "score": 2, "creation_date": 1436041544, "post_id": 31224457, "comment_id": 50449561, "body": "Right, this is a GHC bug and it&#39;s pretty annoying. However, note that <code>^</code> in particular is a bit of a problem child: its signature completely decouples the exponent and basis/result-types, making a polymorphic argument such as numerical literals ambiguous. I have therefore made it a habit to locally constrict <code>(^) :: Num a =&gt; a -&gt; Int -&gt; a</code>. With that done, you can actually get quite far without feeling the need for defaulting at all, because most functions couple the argument- and result types in some rigid way that allows unambiguous inference of all local types from the top-level signature."}, {"owner": {"reputation": 100185, "user_id": 3234959, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/93bb12ca0f93dfddb33880316f7e66c2?s=128&d=identicon&r=PG&f=1", "display_name": "chi", "link": "https://stackoverflow.com/users/3234959/chi"}, "edited": false, "score": 0, "creation_date": 1436041599, "post_id": 31224457, "comment_id": 50449571, "body": "I found GHC 7.10 to be better at this than GHC 7.8. Which version are you using?"}, {"owner": {"reputation": 43759, "user_id": 1651941, "user_type": "registered", "accept_rate": 97, "profile_image": "https://www.gravatar.com/avatar/a513bc1fa519d2fcf5e4e0d9b5500101?s=128&d=identicon&r=PG", "display_name": "Sibi", "link": "https://stackoverflow.com/users/1651941/sibi"}, "edited": false, "score": 2, "creation_date": 1436050531, "post_id": 31224457, "comment_id": 50451353, "body": "Ok, I just tested with <code>ghc-7.10.1</code> and it just shows a single error (the more reasonable second one). So, I guess things are better now than they were before."}, {"owner": {"reputation": 17809, "user_id": 1088108, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/63781cd38e91aa346a3849bc3ef3e550?s=128&d=identicon&r=PG&f=1", "display_name": "&#216;rjan Johansen", "link": "https://stackoverflow.com/users/1088108/%c3%98rjan-johansen"}, "edited": false, "score": 4, "creation_date": 1436072865, "post_id": 31224457, "comment_id": 50454142, "body": "This was <a href=\"https://ghc.haskell.org/trac/ghc/ticket/9033\" rel=\"nofollow noreferrer\">GHC bug ticket #9033</a>, fixed in April 2014."}, {"owner": {"reputation": 100185, "user_id": 3234959, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/93bb12ca0f93dfddb33880316f7e66c2?s=128&d=identicon&r=PG&f=1", "display_name": "chi", "link": "https://stackoverflow.com/users/3234959/chi"}, "reply_to_user": {"reputation": 17809, "user_id": 1088108, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/63781cd38e91aa346a3849bc3ef3e550?s=128&d=identicon&r=PG&f=1", "display_name": "&#216;rjan Johansen", "link": "https://stackoverflow.com/users/1088108/%c3%98rjan-johansen"}, "edited": false, "score": 0, "creation_date": 1436098458, "post_id": 31224457, "comment_id": 50459355, "body": "@&#216;rjanJohansen That could be expanded in a short answer."}, {"owner": {"reputation": 17809, "user_id": 1088108, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/63781cd38e91aa346a3849bc3ef3e550?s=128&d=identicon&r=PG&f=1", "display_name": "&#216;rjan Johansen", "link": "https://stackoverflow.com/users/1088108/%c3%98rjan-johansen"}, "reply_to_user": {"reputation": 100185, "user_id": 3234959, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/93bb12ca0f93dfddb33880316f7e66c2?s=128&d=identicon&r=PG&f=1", "display_name": "chi", "link": "https://stackoverflow.com/users/3234959/chi"}, "edited": false, "score": 1, "creation_date": 1436139696, "post_id": 31224457, "comment_id": 50470698, "body": "@chi OK, I tried to collect together the main points mentioned."}], "answers": [{"comments": [{"owner": {"reputation": 5151, "user_id": 2565025, "user_type": "registered", "accept_rate": 66, "profile_image": "https://graph.facebook.com/24803583/picture?type=large", "display_name": "Joe Susnick", "link": "https://stackoverflow.com/users/2565025/joe-susnick"}, "edited": false, "score": 0, "creation_date": 1436217164, "post_id": 31236063, "comment_id": 50508376, "body": "Thanks, it looked like a bug but as a relatively new programmer I never like to be the boy who cried defect."}], "tags": [], "owner": {"reputation": 17809, "user_id": 1088108, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/63781cd38e91aa346a3849bc3ef3e550?s=128&d=identicon&r=PG&f=1", "display_name": "&#216;rjan Johansen", "link": "https://stackoverflow.com/users/1088108/%c3%98rjan-johansen"}, "is_accepted": true, "score": 3, "last_activity_date": 1436139564, "creation_date": 1436139564, "answer_id": 31236063, "question_id": 31224457, "link": "https://stackoverflow.com/questions/31224457/why-does-a-typo-in-a-haskell-function-declaration-cause-ghci-to-throw-errors-aro/31236063#31236063", "title": "Why does a typo in a Haskell function declaration cause GHCi to throw errors around previously compiling code?", "body": "<p>This was <a href=\"https://ghc.haskell.org/trac/ghc/ticket/9033\" rel=\"nofollow\">GHC bug ticket #9033</a>, reported in April 2014 and quickly fixed.</p>\n\n<p>Basically, whenever a file contained almost <em>any</em> type error, GHC would skip the type class defaulting step, which could cause other parts of the file to give spurious ambiguous type errors.</p>\n\n<p>As @leftaroundabout notes, the <code>^</code> operator is a frequent trigger of this, since its second argument type is unconnected with the other types and so very often needs defaulting.</p>\n\n<p>The GHC version listed in the ticket is 7.8.2, and 7.8.3 was released in July 2104, so I assume versions 7.8.3 and later have the fix.</p>\n"}], "owner": {"reputation": 5151, "user_id": 2565025, "user_type": "registered", "accept_rate": 66, "profile_image": "https://graph.facebook.com/24803583/picture?type=large", "display_name": "Joe Susnick", "link": "https://stackoverflow.com/users/2565025/joe-susnick"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 162, "favorite_count": 0, "accepted_answer_id": 31236063, "answer_count": 1, "score": 10, "last_activity_date": 1436139564, "creation_date": 1436038517, "question_id": 31224457, "link": "https://stackoverflow.com/questions/31224457/why-does-a-typo-in-a-haskell-function-declaration-cause-ghci-to-throw-errors-aro", "title": "Why does a typo in a Haskell function declaration cause GHCi to throw errors around previously compiling code?", "body": "<p>Here's sort of a weird question. Learning Haskell through LearnYouaHaskell, great book btw, and I'm going through implementing various examples. </p>\n\n<p><strong>This compiles in GHCi</strong></p>\n\n<pre><code>cylinder :: (RealFloat a) =&gt; a -&gt; a -&gt; a\ncylinder r h =\n    let sideArea = 2 * pi * r * h\n    topArea = pi * r ^2\n    in  sideArea + 2 * topArea\n</code></pre>\n\n<p><strong>This compiles in GHCi</strong></p>\n\n<pre><code>zipWith' :: (a -&gt; b -&gt; c) -&gt; [a] -&gt; [b] -&gt; [c]  \nzipWith' _ [] _ = []  \nzipWith' _ _ [] = []  \nzipWith' f (x:xs) (y:ys) = f x y : zipWith' f xs ys \n</code></pre>\n\n<p><strong>If I intentionally make a typo and declare the second function as so</strong></p>\n\n<pre><code>zipWith' :: (a -&gt; b -&gt; c) -&gt; [a] -&gt; [b] -&gt; [c]  \nzipWith' _ [] _ = []  \nzipWith' _ _ [] = []  \nzipWith' f (x:xs) (y:ys) = f xs y : zipWith' f xs ys \n</code></pre>\n\n<p><strong>Then the first and second function throw errors during compilation</strong> - at least that's what I think is happening.</p>\n\n<p>Sorry in advance for the code dump.</p>\n\n<p><strong>It throws this previously unseen error message about the cylinder function which I did not change</strong></p>\n\n<pre><code>Prelude&gt; :l functions2.hs\n[1 of 1] Compiling Main             ( functions2.hs, interpreted )\n\nfunctions2.hs:4:26:\n    Could not deduce (Integral b0) arising from a use of \u2018^\u2019\n    from the context (RealFloat a)\n      bound by the type signature for\n                 cylinder :: RealFloat a =&gt; a -&gt; a -&gt; a\n      at functions2.hs:1:13-40\n    The type variable \u2018b0\u2019 is ambiguous\n    Note: there are several potential instances:\n      instance Integral Int -- Defined in \u2018GHC.Real\u2019\n      instance Integral Integer -- Defined in \u2018GHC.Real\u2019\n      instance Integral GHC.Types.Word -- Defined in \u2018GHC.Real\u2019\n    In the second argument of \u2018(*)\u2019, namely \u2018r ^ 2\u2019\n    In the expression: pi * r ^ 2\n    In an equation for \u2018topArea\u2019: topArea = pi * r ^ 2\n\nfunctions2.hs:4:27:\n    Could not deduce (Num b0) arising from the literal \u20182\u2019\n    from the context (RealFloat a)\n      bound by the type signature for\n                 cylinder :: RealFloat a =&gt; a -&gt; a -&gt; a\n      at functions2.hs:1:13-40\n    The type variable \u2018b0\u2019 is ambiguous\n    Note: there are several potential instances:\n      instance Num Double -- Defined in \u2018GHC.Float\u2019\n      instance Num Float -- Defined in \u2018GHC.Float\u2019\n      instance Integral a =&gt; Num (GHC.Real.Ratio a)\n        -- Defined in \u2018GHC.Real\u2019\n      ...plus three others\n    In the second argument of \u2018(^)\u2019, namely \u20182\u2019\n    In the second argument of \u2018(*)\u2019, namely \u2018r ^ 2\u2019\n    In the expression: pi * r ^ 2\n</code></pre>\n\n<p><strong>As well as this much more reasonable error message about the typo in the second function</strong></p>\n\n<pre><code>functions2.hs:12:30:\n    Couldn't match expected type \u2018a\u2019 with actual type \u2018[a]\u2019\n      \u2018a\u2019 is a rigid type variable bound by\n          the type signature for\n            zipWith' :: (a -&gt; b -&gt; c) -&gt; [a] -&gt; [b] -&gt; [c]\n          at functions2.hs:9:13\n    Relevant bindings include\n      xs :: [a] (bound at functions2.hs:12:15)\n      x :: a (bound at functions2.hs:12:13)\n      f :: a -&gt; b -&gt; c (bound at functions2.hs:12:10)\n      zipWith' :: (a -&gt; b -&gt; c) -&gt; [a] -&gt; [b] -&gt; [c]\n        (bound at functions2.hs:10:1)\n    In the first argument of \u2018f\u2019, namely \u2018xs\u2019\n    In the first argument of \u2018(:)\u2019, namely \u2018f xs y\u2019\nFailed, modules loaded: none. \n</code></pre>\n\n<p>Why? Is this a common bug? Did I break something in the first by ruining the second? Please advise.</p>\n"}, {"tags": ["haskell", "fay"], "comments": [{"owner": {"reputation": 33184, "user_id": 247623, "user_type": "registered", "accept_rate": 72, "profile_image": "https://www.gravatar.com/avatar/bb9e67348d3e0e93ef12dd97c41a6c22?s=128&d=identicon&r=PG&f=1", "display_name": "Erik Kaplun", "link": "https://stackoverflow.com/users/247623/erik-kaplun"}, "edited": false, "score": 3, "creation_date": 1436024373, "post_id": 31221493, "comment_id": 50444601, "body": "Fay is a very small subset of Haskell; if you want more, check out GHCJS or Haste."}], "owner": {"reputation": 7296, "user_id": 324315, "user_type": "registered", "accept_rate": 66, "profile_image": "https://www.gravatar.com/avatar/fbb413736c6866ac28a73a44ab56c6b5?s=128&d=identicon&r=PG&f=1", "display_name": "Randomize", "link": "https://stackoverflow.com/users/324315/randomize"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 54, "favorite_count": 0, "answer_count": 0, "score": 1, "last_activity_date": 1436018623, "creation_date": 1436018623, "question_id": 31221493, "link": "https://stackoverflow.com/questions/31221493/data-tree-for-fay", "title": "Data.Tree for Fay", "body": "<p>I am using <code>Data.Tree.unfoldTree</code> in a Fay script but it cannot be compiled and it is not included in fay-base. Is there a way to import from <code>Data.Tree</code>?</p>\n"}, {"tags": ["haskell", "exception-handling"], "answers": [{"comments": [{"owner": {"reputation": 10492, "user_id": 1351298, "user_type": "registered", "accept_rate": 79, "profile_image": "https://i.stack.imgur.com/KJKqs.jpg?s=128&g=1", "display_name": "Electric Coffee", "link": "https://stackoverflow.com/users/1351298/electric-coffee"}, "edited": false, "score": 0, "creation_date": 1436031100, "post_id": 31223291, "comment_id": 50446533, "body": "you say <code>fail</code> works different now, could you provide an example of how it was, and how equivalent code would need to be written?"}, {"owner": {"reputation": 17809, "user_id": 1088108, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/63781cd38e91aa346a3849bc3ef3e550?s=128&d=identicon&r=PG&f=1", "display_name": "&#216;rjan Johansen", "link": "https://stackoverflow.com/users/1088108/%c3%98rjan-johansen"}, "reply_to_user": {"reputation": 10492, "user_id": 1351298, "user_type": "registered", "accept_rate": 79, "profile_image": "https://i.stack.imgur.com/KJKqs.jpg?s=128&g=1", "display_name": "Electric Coffee", "link": "https://stackoverflow.com/users/1351298/electric-coffee"}, "edited": false, "score": 0, "creation_date": 1436032725, "post_id": 31223291, "comment_id": 50447071, "body": "@ElectricCoffee I expanded that bit."}, {"owner": {"reputation": 126897, "user_id": 791604, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/ce991df7a056248d5e4f6fc3659ba733?s=128&d=identicon&r=PG", "display_name": "Daniel Wagner", "link": "https://stackoverflow.com/users/791604/daniel-wagner"}, "edited": false, "score": 1, "creation_date": 1436032947, "post_id": 31223291, "comment_id": 50447155, "body": "@&#216;rjanJohansen Another pattern I&#39;ve used occasionally: <code>do { y &lt;- myErrorTAction &gt;&gt;= maybe (throwError ...) return; ... }</code>. Avoids having to add an indentation level, and can be adapted to other pattern matches; e.g. <code>do { y_ &lt;- myErrorTAction; y &lt;- case y_ of { Nothing -&gt; throwError ...; Just v -&gt; return v }; ... }</code> which adds a layer of indentation but only temporarily (i.e. would not require nested indentation if you want to do two pattern matches)."}, {"owner": {"reputation": 17809, "user_id": 1088108, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/63781cd38e91aa346a3849bc3ef3e550?s=128&d=identicon&r=PG&f=1", "display_name": "&#216;rjan Johansen", "link": "https://stackoverflow.com/users/1088108/%c3%98rjan-johansen"}, "reply_to_user": {"reputation": 126897, "user_id": 791604, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/ce991df7a056248d5e4f6fc3659ba733?s=128&d=identicon&r=PG", "display_name": "Daniel Wagner", "link": "https://stackoverflow.com/users/791604/daniel-wagner"}, "edited": false, "score": 0, "creation_date": 1436033604, "post_id": 31223291, "comment_id": 50447377, "body": "@DanielWagner Thanks, added the first part."}], "tags": [], "owner": {"reputation": 17809, "user_id": 1088108, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/63781cd38e91aa346a3849bc3ef3e550?s=128&d=identicon&r=PG&f=1", "display_name": "&#216;rjan Johansen", "link": "https://stackoverflow.com/users/1088108/%c3%98rjan-johansen"}, "is_accepted": true, "score": 14, "last_activity_date": 1436033545, "last_edit_date": 1436033545, "creation_date": 1436030397, "answer_id": 31223291, "question_id": 31221410, "link": "https://stackoverflow.com/questions/31221410/adapting-error-to-except/31223291#31223291", "title": "Adapting Error to Except", "body": "<p>Short answer is: Replace <code>Error</code> by nothing at all, replace <code>ErrorT</code> by <code>ExceptT</code>, and things should continue to work as long as you don't use <code>Error</code>s methods, <code>fail</code> (which now has a different definition), or failing pattern matches in <code>do</code> notation.</p>\n\n<p>The essential difference between the old <code>Control.Monad.Error</code> system and the new <code>Control.Monad.Except</code> system is that the new system imposes <em>no</em> class restriction on the error/exception type.</p>\n\n<p>It was found that the ability to use any error/exception type at all, polymorphically, was more useful than the somewhat hacky ability to customize conversion of string error messages.</p>\n\n<p>So the class <code>Error</code> has simply disappeared.</p>\n\n<p>As a side effect, <code>fail</code> for <code>ExceptT</code> now is lifted from the underlying monad.  This also changes the effect of failing patterns in <code>do</code> notation.</p>\n\n<p>The old definition was:</p>\n\n<pre><code>fail msg = ErrorT $ return (Left (strMsg msg))\n</code></pre>\n\n<p>which I think is equivalent to</p>\n\n<pre><code>fail msg = throwError (strMsg msg)\n</code></pre>\n\n<p>If you still need this behavior, you can instead use</p>\n\n<pre><code>throwError yourIntendedErrorValue\n</code></pre>\n\n<p>(<code>throwE</code> works instead if you're using <code>transformers</code> (i.e. <code>Control.Monad.Trans.Except</code>) rather than <code>mtl</code>.)</p>\n\n<p>The old <code>do</code> pattern matching failure would apply to things like</p>\n\n<pre><code>do\n    Just x &lt;- myErrorTAction\n    ...\n</code></pre>\n\n<p>when the action actually returns <code>Nothing</code>.  This is more awkward, but you could e.g. replace it with an explicit <code>case</code> match (essentially desugaring it):</p>\n\n<pre><code>do\n    y &lt;- myErrorTAction\n    case y of\n        Nothing -&gt; throwE ...\n        Just x -&gt; do\n           ...\n</code></pre>\n\n<p>@DanielWagner suggests the following to avoid extra indentation:</p>\n\n<pre><code>do\n    x &lt;- myErrorTAction &gt;&gt;= maybe (throwError ...) return\n    ...\n</code></pre>\n\n<p>The removal of <code>Error</code> also eliminates the need for an inconsistency in naming that <code>Control.Monad.Error</code> had: Most transformers follow the rule that <code>SomethingT</code> is the name of the transformer, and <code>Something</code> is a type alias for <code>SomethingT ... Identity</code>.  The old <code>ErrorT</code> broke that because the <code>Error</code> class was used for something entirely different.</p>\n\n<p>In the new system, <code>Except e = ExceptT e Identity</code>, like for other transformers.</p>\n"}], "owner": {"reputation": 10492, "user_id": 1351298, "user_type": "registered", "accept_rate": 79, "profile_image": "https://i.stack.imgur.com/KJKqs.jpg?s=128&g=1", "display_name": "Electric Coffee", "link": "https://stackoverflow.com/users/1351298/electric-coffee"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 1425, "favorite_count": 5, "accepted_answer_id": 31223291, "answer_count": 1, "score": 16, "last_activity_date": 1436033545, "creation_date": 1436018046, "question_id": 31221410, "link": "https://stackoverflow.com/questions/31221410/adapting-error-to-except", "title": "Adapting Error to Except", "body": "<p>Now that <code>Control.Monad.Error</code> is deprecated, and <code>Control.Monad.Except</code> reigns supreme, a lot of sources online haven't caught up, and still show examples of how to use <code>Error</code>.</p>\n\n<p>So how would I go about turning</p>\n\n<pre><code>instance Error MyError where\n  noMsg  = ...\n  strMsg = ...\n</code></pre>\n\n<p>into something using <code>Except</code>. Just replacing <code>Error</code> with <code>Except</code> didn't work as <code>Except</code> expects additional type parameters</p>\n\n<p>I understand that those exact methods don't exist in <code>Except</code>, so what's the alternative?</p>\n"}, {"tags": ["haskell", "package", "cabal"], "answers": [{"comments": [{"owner": {"reputation": 13264, "user_id": 190887, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/b1a747d0a7e3450408e0f07adba49111?s=128&d=identicon&r=PG", "display_name": "Inaimathi", "link": "https://stackoverflow.com/users/190887/inaimathi"}, "edited": false, "score": 0, "creation_date": 1436017077, "post_id": 31221172, "comment_id": 50442422, "body": "That gives me the error <code>&#47;Users&#47;inaimathi&#47;projects&#47;hs-test&#47;.cabal-sandbox&#47;package.cac&zwnj;&#8203;he: openBinaryFile: does not exist (No such file or directory)</code>, after which <code>ghci</code> exits. I had to do <code>ghci -package-db .cabal-sandbox&#47;x86_64-osx-ghc-7.10.1-packages.conf.d</code> (the last part being architecture specific). <a href=\"http://stackoverflow.com/a/17054974/190887\">This answer</a> helped."}, {"owner": {"reputation": 2152, "user_id": 1103600, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/7830fb399137c319ff68dca3e3b6f7e2?s=128&d=identicon&r=PG", "display_name": "Arnon", "link": "https://stackoverflow.com/users/1103600/arnon"}, "reply_to_user": {"reputation": 13264, "user_id": 190887, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/b1a747d0a7e3450408e0f07adba49111?s=128&d=identicon&r=PG", "display_name": "Inaimathi", "link": "https://stackoverflow.com/users/190887/inaimathi"}, "edited": false, "score": 0, "creation_date": 1436017143, "post_id": 31221172, "comment_id": 50442438, "body": "Yup, hence my &#39;or thereabouts...&#39;, couldn&#39;t check what the answer was for a Mac..."}], "tags": [], "owner": {"reputation": 2152, "user_id": 1103600, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/7830fb399137c319ff68dca3e3b6f7e2?s=128&d=identicon&r=PG", "display_name": "Arnon", "link": "https://stackoverflow.com/users/1103600/arnon"}, "is_accepted": true, "score": 1, "last_activity_date": 1436016596, "creation_date": 1436016596, "answer_id": 31221172, "question_id": 31220908, "link": "https://stackoverflow.com/questions/31220908/postgresql-could-not-find-module/31221172#31221172", "title": "PostgreSQL &quot;Could not find module&quot;", "body": "<p>You need to start GHCi with a <code>-package-db=...</code> flag pointing to <code>/Users/inaimathi/projects/hs-test/.cabal-sandbox</code></p>\n\n<p>so\n<code>ghci -package-db=/Users/inaimathi/projects/hs-test/.cabal-sandbox</code>\nor thereabouts...</p>\n"}], "owner": {"reputation": 13264, "user_id": 190887, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/b1a747d0a7e3450408e0f07adba49111?s=128&d=identicon&r=PG", "display_name": "Inaimathi", "link": "https://stackoverflow.com/users/190887/inaimathi"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 178, "favorite_count": 0, "accepted_answer_id": 31221172, "answer_count": 1, "score": 2, "last_activity_date": 1436016596, "creation_date": 1436014727, "question_id": 31220908, "link": "https://stackoverflow.com/questions/31220908/postgresql-could-not-find-module", "title": "PostgreSQL &quot;Could not find module&quot;", "body": "<p>I'm trying to use Posgres and a <code>cabal</code> sandbox for a new project. I've got <code>postgresql-simple</code> installed, as evidenced by installation outputs:</p>\n\n<pre><code>$ cabal install postgresql-simple\nResolving dependencies...\nAll the requested packages are already installed:\npostgresql-simple-0.4.10.0\nUse --reinstall if you want to reinstall anyway.\nNotice: installing into a sandbox located at\n/Users/inaimathi/projects/hs-test/.cabal-sandbox\n</code></pre>\n\n<p>but when I try to import the library in <code>ghci</code>, I get the error</p>\n\n<pre><code>ghci\nGHCi, version 7.10.1: http://www.haskell.org/ghc/  :? for help\nPrelude&gt; import Database.PostgreSQL.Simple\nimport Database.PostgreSQL.Simple\n\n&lt;no location info&gt;:\n    Could not find module \u2018Database.PostgreSQL.Simple\u2019\n    It is not a module in the current program, or in any known package.\nPrelude&gt; \n</code></pre>\n\n<p>Can anyone point out what I'm doing wrong?</p>\n"}, {"tags": ["haskell", "polymorphism"], "comments": [{"owner": {"reputation": 11366, "user_id": 3922954, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/76ba47d2fdd24ab56b0b273cce2075e5?s=128&d=identicon&r=PG&f=1", "display_name": "AJF", "link": "https://stackoverflow.com/users/3922954/ajf"}, "edited": false, "score": 3, "creation_date": 1436014732, "post_id": 31220903, "comment_id": 50441758, "body": "Look up <code>Bifunctor</code>, <code>Trifunctor</code> and so on."}, {"owner": {"reputation": 4782, "user_id": 1339698, "user_type": "registered", "accept_rate": 86, "profile_image": "https://www.gravatar.com/avatar/7d43d1dd397dceade900eb917cec4167?s=128&d=identicon&r=PG", "display_name": "jsdw", "link": "https://stackoverflow.com/users/1339698/jsdw"}, "reply_to_user": {"reputation": 11366, "user_id": 3922954, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/76ba47d2fdd24ab56b0b273cce2075e5?s=128&d=identicon&r=PG&f=1", "display_name": "AJF", "link": "https://stackoverflow.com/users/3922954/ajf"}, "edited": false, "score": 6, "creation_date": 1436014972, "post_id": 31220903, "comment_id": 50441838, "body": "Off the bat, my impression is that these take a function per tuple item (having looked at the tuple instance of it), which avoids the above issue. Please correct me if I&#39;m wrong though!"}], "answers": [{"tags": [], "owner": {"reputation": 542, "user_id": 1956587, "user_type": "registered", "accept_rate": 82, "profile_image": "https://www.gravatar.com/avatar/e92d52f1c16bcf435ef24f7a474fde04?s=128&d=identicon&r=PG", "display_name": "tolUene", "link": "https://stackoverflow.com/users/1956587/toluene"}, "is_accepted": false, "score": 0, "last_activity_date": 1436026971, "creation_date": 1436026971, "answer_id": 31222807, "question_id": 31220903, "link": "https://stackoverflow.com/questions/31220903/haskell-how-to-create-most-generic-function-possible-that-applies-a-function-to/31222807#31222807", "title": "Haskell: How to create most generic function possible that applies a function to tuple items", "body": "<p>What you want is a function with a type</p>\n\n<pre><code>applyToTuple :: (a -&gt; b) -&gt; (c, d) -&gt; (b, b)\n</code></pre>\n\n<p>where the compiler would check if <code>a</code>, <code>c</code>, and <code>d</code> are in the same typeclass. This is unfortunately not possible as far as I know (though there may be an extension for that somewhere). When you pass a function of a certain typeclass to another function, it's type becomes that of the first thing it is applied to (observation from GHC):</p>\n\n<pre><code>applyToTuple f (x, y) = (f x, f y)\n</code></pre>\n\n<p>has a derived type of <code>applyToTuple :: (t -&gt; t1) -&gt; (t, t) -&gt; (t1, t1)</code>.\nTesting it with <code>show</code> shows these results:</p>\n\n<pre><code>\u03bb&gt; applyToTuple show (8, 9)\n(\"8\",\"9\")\n\u03bb&gt; applyToTuple show (8, [8,9])\n\n&lt;interactive&gt;:5:14:\n    No instance for (Show t0) arising from a use of `show'\n    The type variable `t0' is ambiguous\n    Possible fix: add a type signature that fixes these type variable(s)\n    Note: there are several potential instances:\n      instance Show Double -- Defined in `GHC.Float'\n      instance Show Float -- Defined in `GHC.Float'\n      instance (Integral a, Show a) =&gt; Show (GHC.Real.Ratio a)\n        -- Defined in `GHC.Real'\n      ...plus 28 others\n    In the first argument of `applyToTuple', namely `show'\n    In the expression: applyToTuple show (8, [8, 9])\n    In an equation for `it': it = applyToTuple show (8, [8, 9])\n\n&lt;interactive&gt;:5:20:\n    No instance for (Num [t0]) arising from the literal `8'\n    Possible fix: add an instance declaration for (Num [t0])\n    In the expression: 8\n    In the second argument of `applyToTuple', namely `(8, [8, 9])'\n    In the expression: applyToTuple show (8, [8, 9])\n\n&lt;interactive&gt;:5:24:\n    No instance for (Num t0) arising from the literal `8'\n    The type variable `t0' is ambiguous\n    Possible fix: add a type signature that fixes these type variable(s)\n    Note: there are several potential instances:\n      instance Num Double -- Defined in `GHC.Float'\n      instance Num Float -- Defined in `GHC.Float'\n      instance Integral a =&gt; Num (GHC.Real.Ratio a)\n        -- Defined in `GHC.Real'\n      ...plus three others\n    In the expression: 8\n    In the expression: [8, 9]\n    In the second argument of `applyToTuple', namely `(8, [8, 9])'\n</code></pre>\n\n<p>You can, however do something like <code>applyToTuple' f1 f2 (x, y) = (f1 x, f2 y)</code>. I think you may be able to use <a href=\"https://wiki.haskell.org/Template_Haskell\" rel=\"nofollow\">Template Haskell</a> to transform that into what you want.</p>\n"}, {"comments": [{"owner": {"reputation": 4782, "user_id": 1339698, "user_type": "registered", "accept_rate": 86, "profile_image": "https://www.gravatar.com/avatar/7d43d1dd397dceade900eb917cec4167?s=128&d=identicon&r=PG", "display_name": "jsdw", "link": "https://stackoverflow.com/users/1339698/jsdw"}, "edited": false, "score": 0, "creation_date": 1436046336, "post_id": 31223058, "comment_id": 50450611, "body": "Thankyou, an interesting answer that gave me some more things to find out about :)"}, {"owner": {"reputation": 10378, "user_id": 2476735, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/39e9447bbc32246fcd23b76b5e946618?s=128&d=identicon&r=PG&f=1", "display_name": "David Young", "link": "https://stackoverflow.com/users/2476735/david-young"}, "reply_to_user": {"reputation": 4782, "user_id": 1339698, "user_type": "registered", "accept_rate": 86, "profile_image": "https://www.gravatar.com/avatar/7d43d1dd397dceade900eb917cec4167?s=128&d=identicon&r=PG", "display_name": "jsdw", "link": "https://stackoverflow.com/users/1339698/jsdw"}, "edited": false, "score": 0, "creation_date": 1436119563, "post_id": 31223058, "comment_id": 50465431, "body": "@jsdw Okay, it&#39;s a bit more complex, but I figured out how you might go about writing a function that works with all three examples in your question and I updated my answer."}, {"owner": {"reputation": 4782, "user_id": 1339698, "user_type": "registered", "accept_rate": 86, "profile_image": "https://www.gravatar.com/avatar/7d43d1dd397dceade900eb917cec4167?s=128&d=identicon&r=PG", "display_name": "jsdw", "link": "https://stackoverflow.com/users/1339698/jsdw"}, "edited": false, "score": 0, "creation_date": 1436168096, "post_id": 31223058, "comment_id": 50478048, "body": "Thanks for the time you put into this. I did a bit of reading and ConstraintKinds look awesome. Essentially, constraints can be used as types and Proxy is a very simple data type (one liner) used to get those constraint types into a function so that we can use as constraints within it. Haskell you continue to bend my mind."}], "tags": [], "owner": {"reputation": 10378, "user_id": 2476735, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/39e9447bbc32246fcd23b76b5e946618?s=128&d=identicon&r=PG&f=1", "display_name": "David Young", "link": "https://stackoverflow.com/users/2476735/david-young"}, "is_accepted": true, "score": 15, "last_activity_date": 1438062609, "last_edit_date": 1438062609, "creation_date": 1436028793, "answer_id": 31223058, "question_id": 31220903, "link": "https://stackoverflow.com/questions/31220903/haskell-how-to-create-most-generic-function-possible-that-applies-a-function-to/31223058#31223058", "title": "Haskell: How to create most generic function possible that applies a function to tuple items", "body": "<p>You were pretty close with the last one, but you need to add constraints:</p>\n\n<pre><code>{-# LANGUAGE RankNTypes      #-}\n{-# LANGUAGE ConstraintKinds #-}\nimport Data.Proxy\n\nboth :: (c a, c b)\n     =&gt; Proxy c\n        -&gt; (forall x. c x =&gt; x -&gt; r)\n        -&gt; (a, b)\n        -&gt; (r, r)\nboth Proxy f (x, y) = (f x, f y)\n\ndemo :: (String, String)\ndemo = both (Proxy :: Proxy Show) show ('a', True)\n</code></pre>\n\n<p>The <code>Proxy</code> is necessary to pass the ambiguity check. I think this is because it wouldn't otherwise know which part of the constraint to use from the function.</p>\n\n<p>In order to unify this with other cases, you need to allow empty constraints. It might be possible, but I'm not sure. You can't partially apply type families, which might make it a bit trickier.</p>\n\n<p>This is a bit more flexible than I thought it would be though:</p>\n\n<pre><code>demo2 :: (Char, Char)\ndemo2 = both (Proxy :: Proxy ((~) Char)) id ('a', 'b')\n</code></pre>\n\n<p>I had no idea you could partially apply type equality until this moment, haha.</p>\n\n<p>Unfortunately, this doesn't work:</p>\n\n<pre><code>demo3 :: (Int, Int)\ndemo3 = both (Proxy :: Proxy ((~) [a])) length ([1,2,3::Int], \"hello\")\n</code></pre>\n\n<p>For the particular case of lists though, we can use <code>IsList</code> from <code>GHC.Exts</code> to get this to work (<code>IsList</code> is usually used with the <code>OverloadedLists</code> extension, but we don't need that here):</p>\n\n<pre><code>demo3 :: (Int, Int)\ndemo3 = both (Proxy :: Proxy IsList) (length . toList) ([1,2,3], \"hello\")\n</code></pre>\n\n<p>Of course, the simplest (and even more general) solution is to use a function of type <code>(a -&gt; a') -&gt; (b -&gt; b') -&gt; (a, b) -&gt; (a', b')</code> (like <a href=\"https://hackage.haskell.org/package/bifunctors-5/docs/Data-Bifunctor.html#v:bimap\" rel=\"nofollow\"><code>bimap</code> from <code>Data.Bifunctor</code></a> or <a href=\"https://hackage.haskell.org/package/base-4.8.0.0/docs/Control-Arrow.html#v:-42--42--42-\" rel=\"nofollow\"><code>(***)</code> from <code>Control.Arrow</code></a>) and just give it the same function twice:</p>\n\n<pre><code>\u03bb&gt; bimap length length ([1,2,3], \"hello\")\n(3,5)\n</code></pre>\n\n<h2>Unifying all three examples from the question</h2>\n\n<p>Okay, after some more thought and coding, I figured out how to at least unify the three examples you gave into a single function. It's not the most intuitive thing maybe, but it seems to work. The trick is that, in addition to what we have above, we allow the function to give back two different result types (the elements of the resulting pair can be of different types) if we give the type system the following restriction:</p>\n\n<blockquote>\n  <p>Both result types must have a relation to the corresponding input type given by a two-parameter type class (we can look at a one parameter type class as a logical predicate on a type and we can look at a two parameter type class as capturing a binary relation between two types).</p>\n</blockquote>\n\n<p>This is necessary for something like <code>applyToTuple (+5) (10 :: Int, 2.3 :: Float)</code>, since it gives you back <code>(Int, Float)</code>.</p>\n\n<p>With this, we get:</p>\n\n<pre><code>{-# LANGUAGE RankNTypes            #-}\n{-# LANGUAGE ConstraintKinds       #-}\n{-# LANGUAGE FlexibleInstances     #-}\n{-# LANGUAGE MultiParamTypeClasses #-}\nimport Data.Proxy\n\nimport GHC.Exts\n\nboth :: (c a, c b\n        ,p a r1  -- p is a relation between a and r1\n        ,p b r2  -- and also a relation between b and r2\n        )\n     =&gt; Proxy c\n        -&gt; Proxy p\n        -&gt; (forall r x. (c x, p x r) =&gt; x -&gt; r) -- An input type x and a corresponding\n                                                -- result type r are valid iff the p from\n                                                -- before is a relation between x and r,\n                                                -- where x is an instance of c\n        -&gt; (a, b)\n        -&gt; (r1, r2)\nboth Proxy Proxy f (x, y) = (f x, f y)\n</code></pre>\n\n<p><code>Proxy p</code> represents our relation between the input and output types. Next, we define a convenience class (which, as far as I know, doesn't exist anywhere already):</p>\n\n<pre><code>class r ~ a =&gt; Constant a b r\ninstance Constant a b a      -- We restrict the first and the third type argument to\n                             -- be the same\n</code></pre>\n\n<p>This lets us use <code>both</code> when the result type stays the same by partially applying <code>Constant</code> to the type we know it will be (I also didn't know you could partially apply type classes until now. I'm learning a lot for this answer, haha). For example, if we know that it will be <code>Int</code> in both results:</p>\n\n<pre><code>example1 :: (Int, Int)\nexample1 =\n  both (Proxy :: Proxy IsList)         -- The argument must be an IsList instance\n       (Proxy :: Proxy (Constant Int)) -- The result type must be Int\n       (length . toList)\n       ([1,2,3], \"hello\")\n</code></pre>\n\n<p>Likewise for your second test case:</p>\n\n<pre><code>example2 :: (String, String)\nexample2 =\n  both (Proxy :: Proxy Show)              -- The argument must be a Show instance\n       (Proxy :: Proxy (Constant String)) -- The result type must be String\n       show\n       ('a', True)\n</code></pre>\n\n<p>The third one is where it gets a bit more interesting:</p>\n\n<pre><code>example3 :: (Int, Float)\nexample3 =\n  both (Proxy :: Proxy Num)  -- Constrain the the argument to be a Num instance\n       (Proxy :: Proxy (~))  -- &lt;- Tell the type system that the result type of\n                             --    (+5) is the same as the argument type.\n       (+5)\n       (10 :: Int, 2.3 :: Float)\n</code></pre>\n\n<p>Our relation between input and output type here is actually only slightly more complex than the other two examples: instead of ignoring the first type in the relation, we say that the input and output types must be the same (which works since <code>(+5) :: Num a =&gt; a -&gt; a</code>). In other words, in this particular case, our relation is the equality relation.</p>\n"}], "owner": {"reputation": 4782, "user_id": 1339698, "user_type": "registered", "accept_rate": 86, "profile_image": "https://www.gravatar.com/avatar/7d43d1dd397dceade900eb917cec4167?s=128&d=identicon&r=PG", "display_name": "jsdw", "link": "https://stackoverflow.com/users/1339698/jsdw"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 548, "favorite_count": 1, "accepted_answer_id": 31223058, "answer_count": 2, "score": 16, "last_activity_date": 1438062609, "creation_date": 1436014690, "last_edit_date": 1436500124, "question_id": 31220903, "link": "https://stackoverflow.com/questions/31220903/haskell-how-to-create-most-generic-function-possible-that-applies-a-function-to", "title": "Haskell: How to create most generic function possible that applies a function to tuple items", "body": "<p>This is a personal exercise to understand the limits of Haskell's type system a little better. I want to create the most generic function I can that applies some function to each entry in a 2 entry tuple eg:</p>\n\n<pre><code>applyToTuple fn (a,b) = (fn a, fn b)\n</code></pre>\n\n<p>I am trying to make this function work in each of the following cases:</p>\n\n<pre><code>(1) applyToTuple length ([1,2,3] \"hello\")\n(2) applyToTuple show ((2 :: Double), 'c')\n(3) applyToTuple (+5) (10 :: Int, 2.3 :: Float)\n</code></pre>\n\n<p>So for <code>length</code> the items in the pair must be <code>Foldable</code>, for show they must be instances of <code>Show</code> etc.</p>\n\n<p>Using <code>RankNTypes</code> I can go some of the way, for example:</p>\n\n<pre><code>{-# LANGUAGE RankNTypes #-}\napplyToTupleFixed :: (forall t1. f t1 -&gt; c) -&gt; (f a, f b) -&gt; (c, c)\napplyToTupleFixed fn (a,b) = (fn a, fn b)\n</code></pre>\n\n<p>This allows a function that can work on a general context <code>f</code> to be applied to items in that context. <code>(1)</code> works with this, but the tuple items in <code>(2)</code> and <code>(3)</code> have no context and so they don't work (and anyway, 3 would return different types). I could of course define a context to place items in eg:</p>\n\n<pre><code>data Sh a = Show a =&gt; Sh a\ninstance Show (Sh a) where show (Sh a) = show a\n\napplyToTuple show (Sh (2 :: Double), Sh 'c')\n</code></pre>\n\n<p>to get other examples working. I am just wondering whether it is possible to define such a generic function in Haskell without having to wrap the items in the tuples or give applyToTuple a more specific type signature.</p>\n"}, {"tags": ["haskell", "emacs", "cabal", "ghci"], "comments": [{"owner": {"reputation": 2063, "user_id": 3188445, "user_type": "registered", "accept_rate": 64, "profile_image": "https://www.gravatar.com/avatar/456b429580f304e24b652ca52363b603?s=128&d=identicon&r=PG&f=1", "display_name": "user3188445", "link": "https://stackoverflow.com/users/3188445/user3188445"}, "edited": false, "score": 7, "creation_date": 1437895222, "post_id": 31220370, "comment_id": 51216050, "body": "Can you post a minimal <code>~&#47;.emacs</code> file that allows you to reproduce the problem?"}, {"owner": {"reputation": 700, "user_id": 3551468, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/ea5ccf89430297a62c9065e5ec808c8c?s=128&d=identicon&r=PG&f=1", "display_name": "GuiltyDolphin", "link": "https://stackoverflow.com/users/3551468/guiltydolphin"}, "edited": false, "score": 0, "creation_date": 1442163922, "post_id": 31220370, "comment_id": 52960418, "body": "Does this problem occur when running in a directory with a &#39;myproject.cabal&#39;? If so, have you tried running it without the cabal file?"}, {"owner": {"reputation": 568, "user_id": 1867082, "user_type": "registered", "accept_rate": 73, "profile_image": "https://www.gravatar.com/avatar/582ce4225fd51413e5758c795263759b?s=128&d=identicon&r=PG&f=1", "display_name": "Gracjan Polak", "link": "https://stackoverflow.com/users/1867082/gracjan-polak"}, "edited": false, "score": 0, "creation_date": 1442313812, "post_id": 31220370, "comment_id": 53021601, "body": "Linking to reported issue: <a href=\"https://github.com/haskell/haskell-mode/issues/876\" rel=\"nofollow noreferrer\">github.com/haskell/haskell-mode/issues/876</a>"}, {"owner": {"reputation": 206, "user_id": 3943027, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/4b609c6568ccf94f887297f33ebc9f62?s=128&d=identicon&r=PG&f=1", "display_name": "Pierre R", "link": "https://stackoverflow.com/users/3943027/pierre-r"}, "edited": false, "score": 0, "creation_date": 1445079894, "post_id": 31220370, "comment_id": 54177597, "body": "I am aware of a potential problem (&quot;stuck-mode&quot;) when using evil. If you use evil, please check out <a href=\"https://github.com/syl20bnr/spacemacs/issues/3271\" rel=\"nofollow noreferrer\">github.com/syl20bnr/spacemacs/issues/3271</a>"}, {"owner": {"reputation": 6241, "user_id": 722869, "user_type": "registered", "accept_rate": 85, "profile_image": "https://www.gravatar.com/avatar/1c5c02f9165e188ab81a53efabc062e2?s=128&d=identicon&r=PG", "display_name": "daj", "link": "https://stackoverflow.com/users/722869/daj"}, "edited": false, "score": 0, "creation_date": 1445458774, "post_id": 31220370, "comment_id": 54338011, "body": "thanks, I&#39;m not using evil"}, {"owner": {"reputation": 814, "user_id": 1124673, "user_type": "registered", "accept_rate": 80, "profile_image": "https://i.stack.imgur.com/9Rv6G.jpg?s=128&g=1", "display_name": "gusridd", "link": "https://stackoverflow.com/users/1124673/gusridd"}, "reply_to_user": {"reputation": 568, "user_id": 1867082, "user_type": "registered", "accept_rate": 73, "profile_image": "https://www.gravatar.com/avatar/582ce4225fd51413e5758c795263759b?s=128&d=identicon&r=PG&f=1", "display_name": "Gracjan Polak", "link": "https://stackoverflow.com/users/1867082/gracjan-polak"}, "edited": false, "score": 1, "creation_date": 1464651092, "post_id": 31220370, "comment_id": 62559817, "body": "I&#39;ve read that this issue as reported in the link posted by @GracjanPolak has been closed by the following pull-request <a href=\"https://github.com/haskell/haskell-mode/pull/1116/files\" rel=\"nofollow noreferrer\">github.com/haskell/haskell-mode/pull/1116/files</a>"}], "answers": [{"tags": [], "owner": {"reputation": 15803, "user_id": 537998, "user_type": "registered", "accept_rate": 80, "profile_image": "https://www.gravatar.com/avatar/7d0a55cd0bbfbb4c9b3cb96ead1a114e?s=128&d=identicon&r=PG", "display_name": "Kirk Strobeck", "link": "https://stackoverflow.com/users/537998/kirk-strobeck"}, "is_accepted": true, "score": 1, "last_activity_date": 1469512432, "creation_date": 1469512432, "answer_id": 38581965, "question_id": 31220370, "link": "https://stackoverflow.com/questions/31220370/emacs-interactive-haskell-repl-non-response-if-either-the-cabal-or-working-direc/38581965#38581965", "title": "Emacs Interactive-Haskell repl non-response if either the cabal or working directory set to project directory", "body": "<p><strong>This is a known bug.</strong> and a good catch!</p>\n\n<p>The pull request <a href=\"https://github.com/haskell/haskell-mode/pull/1116/files\" rel=\"nofollow\">https://github.com/haskell/haskell-mode/pull/1116/files</a> solves it.</p>\n"}], "owner": {"reputation": 6241, "user_id": 722869, "user_type": "registered", "accept_rate": 85, "profile_image": "https://www.gravatar.com/avatar/1c5c02f9165e188ab81a53efabc062e2?s=128&d=identicon&r=PG", "display_name": "daj", "link": "https://stackoverflow.com/users/722869/daj"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 1749, "favorite_count": 3, "accepted_answer_id": 38581965, "answer_count": 1, "score": 123, "last_activity_date": 1469761868, "creation_date": 1436011121, "last_edit_date": 1457420063, "question_id": 31220370, "link": "https://stackoverflow.com/questions/31220370/emacs-interactive-haskell-repl-non-response-if-either-the-cabal-or-working-direc", "title": "Emacs Interactive-Haskell repl non-response if either the cabal or working directory set to project directory", "body": "<p>I'm running into odd behavior with the Interactive-Haskell repl in <code>emacs</code>. When I source a file, the <code>emacs</code> mini buffer shows a series of interactive prompts:</p>\n\n<pre><code>Start a new project named 'myproject'?\nCabal dir (guessed from myproject.cabal):\nBuild target (empty for default):\nSet current directory:\n</code></pre>\n\n<p>If I leave either the cabal directory or the current directory to the default value of the project directory, the repl is unresponsive. I get a lambda prompt in the interactive Haskell window, I can type, but when I press enter, it never evaluates. The cursor stays on the same line as if I did not press enter at all. </p>\n\n<p>If I change both of those directories to some path other than my project directory, then the repl behaves normally and evaluates expressions as expected.</p>\n"}, {"tags": ["haskell", "gcc", "linker", "ld", "wxhaskell"], "comments": [{"owner": {"reputation": 2152, "user_id": 1103600, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/7830fb399137c319ff68dca3e3b6f7e2?s=128&d=identicon&r=PG", "display_name": "Arnon", "link": "https://stackoverflow.com/users/1103600/arnon"}, "edited": false, "score": 0, "creation_date": 1436016647, "post_id": 31216967, "comment_id": 50442308, "body": "Can you find <code>libwxc.so</code> (or dll)?"}], "answers": [{"tags": [], "owner": {"reputation": 2152, "user_id": 1103600, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/7830fb399137c319ff68dca3e3b6f7e2?s=128&d=identicon&r=PG", "display_name": "Arnon", "link": "https://stackoverflow.com/users/1103600/arnon"}, "is_accepted": true, "score": 2, "last_activity_date": 1436045196, "creation_date": 1436045196, "answer_id": 31225230, "question_id": 31216967, "link": "https://stackoverflow.com/questions/31216967/linker-error-while-building-statically-linked-wxhaskell-application/31225230#31225230", "title": "Linker error while building statically-linked wxHaskell application", "body": "<p>What the linker is telling you is that it can't find the library because it is not in the standard location that it knows...\nAdd it to GHC's library search path by adding the <code>-L</code> flag to the command:</p>\n\n<pre><code>ghc -static .... -LE:/wxhaskell/wxc .... \n</code></pre>\n"}], "owner": {"reputation": 117, "user_id": 1990237, "user_type": "registered", "accept_rate": 80, "profile_image": "https://www.gravatar.com/avatar/3e7df8fc4b7eca5a027a440f56d86cb8?s=128&d=identicon&r=PG&f=1", "display_name": "Verbatim", "link": "https://stackoverflow.com/users/1990237/verbatim"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 151, "favorite_count": 0, "accepted_answer_id": 31225230, "answer_count": 1, "score": 1, "last_activity_date": 1436045196, "creation_date": 1435984909, "last_edit_date": 1436044976, "question_id": 31216967, "link": "https://stackoverflow.com/questions/31216967/linker-error-while-building-statically-linked-wxhaskell-application", "title": "Linker error while building statically-linked wxHaskell application", "body": "<p>I am trying to statically link a wxHaskell Windows application using this <code>ghc -static -optl-static</code> flag. But ld.exe returns a linker error </p>\n\n<blockquote>\n  <p>c:/program files/haskell platform/2014.2.0.0/mingw/bin/../lib/gcc/x86_64-w64-mingw32/4.6.3/../../../../x86_64-w64-mingw32/bin/ld.exe: cannot find -lwxc\n  collect2: ld returned 1 exit status</p>\n</blockquote>\n\n<p>I seemingly can't find lwxc in my system anywhere. Is there anything that I can do?</p>\n\n<p>Edit:\nI have libwxc.a in</p>\n\n<blockquote>\n  <p>E:\\wxhaskell\\wxc\\libwxc.a</p>\n</blockquote>\n"}, {"tags": ["haskell", "ghc", "typeclass"], "answers": [{"tags": [], "owner": {"reputation": 26, "user_id": 3285458, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/defc07e2f1b2191c9dcd5212a4a85de6?s=128&d=identicon&r=PG&f=1", "display_name": "kludgy", "link": "https://stackoverflow.com/users/3285458/kludgy"}, "is_accepted": true, "score": 1, "last_activity_date": 1436038102, "last_edit_date": 1436038102, "creation_date": 1435998873, "answer_id": 31218667, "question_id": 31216859, "link": "https://stackoverflow.com/questions/31216859/how-to-use-a-typeclass-like-hasdynflags-m-in-ghc/31218667#31218667", "title": "How to use a typeclass like `HasDynFlags m` in GHC", "body": "<p>According to the class definition,</p>\n\n<pre><code>class HasDynFlags m where\n    getDynFlags :: m DynFlags\n</code></pre>\n\n<p><code>m</code> is satisfied by kind <code>(* -&gt; *)</code>. The kind <code>(* -&gt; *)</code> is implied by the type <code>m DynFlags</code>, which demonstrates that <code>m</code> is a type constructor taking exactly one type parameter.</p>\n\n<p>There are no further constraints on <code>m</code> here. Specifically, the resulting type needn't be a Functor (or Monad), although given common naming conventions for type variables in Haskell, there's a good chance Monad is the motivating case.</p>\n\n<p>EDIT: To answer the second question, the Functor or Monad class constraints we expect are introduced in more specific contexts. For example, consider the type,</p>\n\n<pre><code>(HasDynFlags m, Monad m) =&gt; m DynFlags\n</code></pre>\n\n<p>I think that's all there is to it.</p>\n"}], "owner": {"reputation": 2966, "user_id": 315302, "user_type": "registered", "accept_rate": 85, "profile_image": "https://www.gravatar.com/avatar/1d57a52c98eee46fb4bc92e0b4ffe163?s=128&d=identicon&r=PG", "display_name": "Javran", "link": "https://stackoverflow.com/users/315302/javran"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 48, "favorite_count": 0, "accepted_answer_id": 31218667, "answer_count": 1, "score": 1, "last_activity_date": 1436038102, "creation_date": 1435983873, "question_id": 31216859, "link": "https://stackoverflow.com/questions/31216859/how-to-use-a-typeclass-like-hasdynflags-m-in-ghc", "title": "How to use a typeclass like `HasDynFlags m` in GHC", "body": "<p>While playing with GHC code base, I find a typeclass named <a href=\"https://downloads.haskell.org/~ghc/7.10.1/docs/html/libraries/ghc-7.10.1/DynFlags.html#t:HasDynFlags\" rel=\"nofollow\"><code>HasDynFlags</code></a>:</p>\n\n<pre><code>class HasDynFlags m where\n    getDynFlags :: m DynFlags\n</code></pre>\n\n<p>Although the typeclass name looks self-explanatory, I couldn't find other\nconstraints in the typeclass definition that says <code>m</code> has to be <code>Monad</code> or at least <code>Functor</code> so we can get access to that value.</p>\n\n<p>However, most use of it I find in the code base is inside a do-notation, e.g <code>dynFlag &lt;- getDynFlags</code> where <code>m</code> is further constrainted to be an instance of <code>Monad</code>. </p>\n\n<p>My questions are:</p>\n\n<ul>\n<li>For <code>HasDynFlags m</code>, does <code>m</code> have to be at least <code>Functor</code> to make this typeclass useful?</li>\n<li>If the answer to the first question is no, then how are we supposed to get access to a value of <code>DynFlags</code> given <code>getDynFlags :: m DynFlags</code>, without any further knowledge about <code>m</code>?</li>\n</ul>\n"}, {"tags": ["haskell", "ghci", "runhaskell"], "comments": [{"owner": {"reputation": 126897, "user_id": 791604, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/ce991df7a056248d5e4f6fc3659ba733?s=128&d=identicon&r=PG", "display_name": "Daniel Wagner", "link": "https://stackoverflow.com/users/791604/daniel-wagner"}, "edited": false, "score": 2, "creation_date": 1435979157, "post_id": 31216280, "comment_id": 50433729, "body": "The question is good on its own. But you may be asking the wrong question; are you aware of <code>cabal repl</code>, <code>cabal run</code>, and <code>cabal exec</code>, which start <code>ghci</code>, an executable from your <code>*.cabal</code> file, and an arbitrary process, respectively, with environment variables set that inform GHC of the appropriate paths?"}], "answers": [{"tags": [], "owner": {"reputation": 14485, "user_id": 190376, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/cd8280c5e1491b8cf55760750ed97dec?s=128&d=identicon&r=PG", "display_name": "Reid Barton", "link": "https://stackoverflow.com/users/190376/reid-barton"}, "is_accepted": true, "score": 3, "last_activity_date": 1435979793, "creation_date": 1435979793, "answer_id": 31216544, "question_id": 31216280, "link": "https://stackoverflow.com/questions/31216280/how-to-specify-sandbox-directory-for-runhaskell/31216544#31216544", "title": "How to specify sandbox directory for runhaskell?", "body": "<p>Sandboxes are a concept specific to Cabal, and runhaskell (and the rest of the GHC suite) has no idea about them. The relevant concept to GHC is the package database path, which can be controlled either by command-line flags like <code>-package-db</code> or by the environment variable <code>GHC_PACKAGE_PATH</code>. <code>runhaskell</code> seems not to support <code>-package-db</code>, so setting <code>GHC_PACKAGE_PATH</code> is the best bet. Or of course you can let Cabal do the work with <code>cabal exec</code> as Daniel Wagner pointed out in a comment.</p>\n\n<p><code>cabal exec</code> works by setting <code>GHC_PACKAGE_PATH</code>, so if for some reason you want to set the variable manually, you can see what value Cabal sets it to with the command <code>cabal exec printenv GHC_PACKAGE_PATH</code>.</p>\n"}], "owner": {"reputation": 6241, "user_id": 722869, "user_type": "registered", "accept_rate": 85, "profile_image": "https://www.gravatar.com/avatar/1c5c02f9165e188ab81a53efabc062e2?s=128&d=identicon&r=PG", "display_name": "daj", "link": "https://stackoverflow.com/users/722869/daj"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 136, "favorite_count": 0, "accepted_answer_id": 31216544, "answer_count": 1, "score": 3, "last_activity_date": 1435979793, "creation_date": 1435976809, "question_id": 31216280, "link": "https://stackoverflow.com/questions/31216280/how-to-specify-sandbox-directory-for-runhaskell", "title": "How to specify sandbox directory for runhaskell?", "body": "<p>By default, runhaskell seems to ignore shared sandbox paths.</p>\n\n<p>When running a haskell file from the command line using runhaskell, how do I set the sandbox directory?</p>\n"}, {"tags": ["haskell", "arrows"], "comments": [{"owner": {"reputation": 8444, "user_id": 1837203, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/d4db7eb958bf0c84072c8e9658700167?s=128&d=identicon&r=PG", "display_name": "jaket", "link": "https://stackoverflow.com/users/1837203/jaket"}, "edited": false, "score": 0, "creation_date": 1435974393, "post_id": 31216004, "comment_id": 50432999, "body": "<code>runKleisli (Kleisli $ filterA (== 8)) [8, 9]</code>?"}, {"owner": {"reputation": 542, "user_id": 1956587, "user_type": "registered", "accept_rate": 82, "profile_image": "https://www.gravatar.com/avatar/e92d52f1c16bcf435ef24f7a474fde04?s=128&d=identicon&r=PG", "display_name": "tolUene", "link": "https://stackoverflow.com/users/1956587/toluene"}, "reply_to_user": {"reputation": 8444, "user_id": 1837203, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/d4db7eb958bf0c84072c8e9658700167?s=128&d=identicon&r=PG", "display_name": "jaket", "link": "https://stackoverflow.com/users/1837203/jaket"}, "edited": false, "score": 0, "creation_date": 1435974732, "post_id": 31216004, "comment_id": 50433052, "body": "@jaket that fixes that I guess. However, it doesn&#39;t fix the type signature thing"}, {"owner": {"reputation": 21654, "user_id": 107331, "user_type": "registered", "accept_rate": 80, "profile_image": "https://www.gravatar.com/avatar/cf6d0868b2b4c69bac3e6f265a32b6a7?s=128&d=identicon&r=PG", "display_name": "Daniel Martin", "link": "https://stackoverflow.com/users/107331/daniel-martin"}, "edited": false, "score": 0, "creation_date": 1435976428, "post_id": 31216004, "comment_id": 50433279, "body": "In your update you use <code>f</code> as though it were a function in <code>if f x then ...</code> - that use of <code>f</code> is why GHC is insisting that the function typechecks only if the <code>arr</code> type is in fact <code>(-&gt;)</code>. See my answer below."}, {"owner": {"reputation": 21654, "user_id": 107331, "user_type": "registered", "accept_rate": 80, "profile_image": "https://www.gravatar.com/avatar/cf6d0868b2b4c69bac3e6f265a32b6a7?s=128&d=identicon&r=PG", "display_name": "Daniel Martin", "link": "https://stackoverflow.com/users/107331/daniel-martin"}, "reply_to_user": {"reputation": 8444, "user_id": 1837203, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/d4db7eb958bf0c84072c8e9658700167?s=128&d=identicon&r=PG", "display_name": "jaket", "link": "https://stackoverflow.com/users/1837203/jaket"}, "edited": false, "score": 0, "creation_date": 1435977080, "post_id": 31216004, "comment_id": 50433374, "body": "Also, note that @jaket&#39;s version of <code>runKleisli (Kleisli $ filterA (== 8)) [8, 9]</code> is not what you want - it&#39;s bound to the monad <code>[]</code>, even with a properly typed <code>filterA</code>."}], "answers": [{"comments": [{"owner": {"reputation": 542, "user_id": 1956587, "user_type": "registered", "accept_rate": 82, "profile_image": "https://www.gravatar.com/avatar/e92d52f1c16bcf435ef24f7a474fde04?s=128&d=identicon&r=PG", "display_name": "tolUene", "link": "https://stackoverflow.com/users/1956587/toluene"}, "edited": false, "score": 0, "creation_date": 1435975341, "post_id": 31216154, "comment_id": 50433122, "body": "But by the type signature I supplied in my post, <code>f</code> would already be an arrow. How would I go about that?"}, {"owner": {"reputation": 8444, "user_id": 1837203, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/d4db7eb958bf0c84072c8e9658700167?s=128&d=identicon&r=PG", "display_name": "jaket", "link": "https://stackoverflow.com/users/1837203/jaket"}, "reply_to_user": {"reputation": 542, "user_id": 1956587, "user_type": "registered", "accept_rate": 82, "profile_image": "https://www.gravatar.com/avatar/e92d52f1c16bcf435ef24f7a474fde04?s=128&d=identicon&r=PG", "display_name": "tolUene", "link": "https://stackoverflow.com/users/1956587/toluene"}, "edited": false, "score": 0, "creation_date": 1435975825, "post_id": 31216154, "comment_id": 50433182, "body": "oh wait. I see what you&#39;re talking about. give me a sec."}], "tags": [], "owner": {"reputation": 8444, "user_id": 1837203, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/d4db7eb958bf0c84072c8e9658700167?s=128&d=identicon&r=PG", "display_name": "jaket", "link": "https://stackoverflow.com/users/1837203/jaket"}, "is_accepted": false, "score": 0, "last_activity_date": 1435975748, "last_edit_date": 1435975748, "creation_date": 1435975221, "answer_id": 31216154, "question_id": 31216004, "link": "https://stackoverflow.com/questions/31216004/haskell-control-arrow-trying-to-write-a-filtera-function/31216154#31216154", "title": "Haskell Control.Arrow: trying to write a filterA function", "body": "<p>As mentioned in my comment:</p>\n\n<pre><code>runKleisli (Kleisli $ filterA (== 8)) [8, 9]\n</code></pre>\n\n<p>Next you need to lift <code>f :: a -&gt; b</code> into an arrow <code>arr a b</code> </p>\n\n<pre><code>(first (arr f &amp;&amp;&amp; arr id)\n        ^^^\n</code></pre>\n\n<p>in your function:</p>\n\n<pre><code>filterA :: ArrowChoice arr =&gt; (a -&gt; Bool) -&gt; arr [a] [a]\nfilterA f = arr listcase &gt;&gt;&gt;\n            arr (const []) ||| (first (f &amp;&amp;&amp; arr id) &gt;&gt;&gt;\n            arr (\\((b,x),xs) -&gt; if b then\n                x : (filterA f xs)\n                else filterA f xs\n            ))\n</code></pre>\n"}, {"comments": [{"owner": {"reputation": 542, "user_id": 1956587, "user_type": "registered", "accept_rate": 82, "profile_image": "https://www.gravatar.com/avatar/e92d52f1c16bcf435ef24f7a474fde04?s=128&d=identicon&r=PG", "display_name": "tolUene", "link": "https://stackoverflow.com/users/1956587/toluene"}, "edited": false, "score": 0, "creation_date": 1436023158, "post_id": 31216199, "comment_id": 50444258, "body": "Thank you, that works. I&#39;ve rewritten the function to use toEither like this: <code>filterA f = arr listcase &gt;&gt;&gt;             arr (const []) ||| ((f &amp;&amp;&amp; arr id) *** filterA f &gt;&gt;^             toEither &gt;&gt;&gt; (arr id ||| (arr uncurry (:))))</code> and <code>toEither ((True, x), xs) = Right (x, xs)</code> <code>toEither ((False, _), xs) = Left xs</code> and I&#39;ve observed some behaviour that I don&#39;t completely understand. The version using <code>&gt;&gt;^ toEither</code> works, while a version using <code>&gt;&gt;&gt; arr toEither</code> doesn&#39;t compile. But isn&#39;t <code>&gt;&gt;^</code> defined as <code>a &gt;&gt;^ f = a &gt;&gt;&gt; arr f</code>?"}, {"owner": {"reputation": 21654, "user_id": 107331, "user_type": "registered", "accept_rate": 80, "profile_image": "https://www.gravatar.com/avatar/cf6d0868b2b4c69bac3e6f265a32b6a7?s=128&d=identicon&r=PG", "display_name": "Daniel Martin", "link": "https://stackoverflow.com/users/107331/daniel-martin"}, "reply_to_user": {"reputation": 542, "user_id": 1956587, "user_type": "registered", "accept_rate": 82, "profile_image": "https://www.gravatar.com/avatar/e92d52f1c16bcf435ef24f7a474fde04?s=128&d=identicon&r=PG", "display_name": "tolUene", "link": "https://stackoverflow.com/users/1956587/toluene"}, "edited": false, "score": 1, "creation_date": 1436025429, "post_id": 31216199, "comment_id": 50444913, "body": "Your complilation woes are coming from other things far away from what you changed not having the types you think they do. You want <code>arr (uncurry (:))</code> or <code>(arr $ uncurry (:))</code> - that is, don&#39;t apply <code>arr</code> directly to <code>uncurry</code>. If you do that, then both the <code>&gt;&gt;&gt; arr toEither</code> and <code>&gt;&gt;^ toEither</code> variants will compile as expected"}, {"owner": {"reputation": 21654, "user_id": 107331, "user_type": "registered", "accept_rate": 80, "profile_image": "https://www.gravatar.com/avatar/cf6d0868b2b4c69bac3e6f265a32b6a7?s=128&d=identicon&r=PG", "display_name": "Daniel Martin", "link": "https://stackoverflow.com/users/107331/daniel-martin"}, "reply_to_user": {"reputation": 542, "user_id": 1956587, "user_type": "registered", "accept_rate": 82, "profile_image": "https://www.gravatar.com/avatar/e92d52f1c16bcf435ef24f7a474fde04?s=128&d=identicon&r=PG", "display_name": "tolUene", "link": "https://stackoverflow.com/users/1956587/toluene"}, "edited": false, "score": 0, "creation_date": 1436025967, "post_id": 31216199, "comment_id": 50445092, "body": "If you&#39;re trying to work with generic arrows, since both <code>&gt;&gt;^</code> and <code>&gt;&gt;&gt;</code> associate to the right (that is, both are <code>infixr 1</code>), you want to be careful about expressions of the form <code>a &gt;&gt;^ b &gt;&gt;&gt; c</code> , that is where there&#39;s any <code>&gt;&gt;&gt;</code> to the right of <code>&gt;&gt;^</code>, since that means the same as <code>a &gt;&gt;^ (b &gt;&gt;&gt; c)</code>, and so the <code>c</code> arrow will be used in the <code>(-&gt;)</code> arrow instance, and not the general arrow the whole function is in."}], "tags": [], "owner": {"reputation": 21654, "user_id": 107331, "user_type": "registered", "accept_rate": 80, "profile_image": "https://www.gravatar.com/avatar/cf6d0868b2b4c69bac3e6f265a32b6a7?s=128&d=identicon&r=PG", "display_name": "Daniel Martin", "link": "https://stackoverflow.com/users/107331/daniel-martin"}, "is_accepted": true, "score": 1, "last_activity_date": 1435976698, "last_edit_date": 1435976698, "creation_date": 1435975941, "answer_id": 31216199, "question_id": 31216004, "link": "https://stackoverflow.com/questions/31216004/haskell-control-arrow-trying-to-write-a-filtera-function/31216199#31216199", "title": "Haskell Control.Arrow: trying to write a filterA function", "body": "<p>Your problem is that you're trying to do the recursion inside the function definition that you wrap with <code>arr</code>, and you call <code>filterA f</code> as though it were a function in this line:</p>\n\n<pre><code>                x : (filterA f xs)\n</code></pre>\n\n<p>That only works if the arrow type is <code>(-&gt;)</code>, which is what one of the type errors is telling you.</p>\n\n<p>Instead, you need to do the recursion at the arrow level, as in:</p>\n\n<pre><code>listcase :: [t] -&gt; Either () (t, [t])\nlistcase [] = Left ()\nlistcase (x:xs) = Right (x, xs)\n\nfilterA :: (ArrowChoice arr) =&gt; arr a Bool -&gt; arr [a] [a]\nfilterA f = listcase ^&gt;&gt;\n            arr (const []) ||| ((f &amp;&amp;&amp; arr id) *** filterA f &gt;&gt;^\n                                (\\((b, x), xs) -&gt; if b then x:xs else xs))\n</code></pre>\n\n<p>(which does compile)</p>\n\n<p>Your <code>runKleisli</code> example is a bit confused, you meant to say:</p>\n\n<pre><code>runKleisli (filterA $ Kleisli $ return . (== 8)) [8,9]\n</code></pre>\n\n<p>or</p>\n\n<pre><code>runKleisli (filterA $ arr (== 8)) [8,9] :: IO [Int]\n</code></pre>\n\n<p>That's straight from looking at the types.</p>\n"}, {"tags": [], "owner": {"reputation": 60057, "user_id": 1333025, "user_type": "registered", "accept_rate": 65, "profile_image": "https://www.gravatar.com/avatar/79ab43010f900324ac5e2de19a2916cb?s=128&d=identicon&r=PG", "display_name": "Petr", "link": "https://stackoverflow.com/users/1333025/petr"}, "is_accepted": false, "score": 1, "last_activity_date": 1436099330, "creation_date": 1436099330, "answer_id": 31230338, "question_id": 31216004, "link": "https://stackoverflow.com/questions/31216004/haskell-control-arrow-trying-to-write-a-filtera-function/31230338#31230338", "title": "Haskell Control.Arrow: trying to write a filterA function", "body": "<p>Just to complement the other answers: Using the <a href=\"https://www.haskell.org/arrows/syntax.html\" rel=\"nofollow\">Arrow syntax</a> (see also the GHC manual, Chapter <a href=\"https://downloads.haskell.org/~ghc/6.10.3/docs/html/users_guide/arrow-notation.html\" rel=\"nofollow\">Arrow notation</a>) you can write function somewhat more readable:</p>\n\n<pre><code>{-# LANGUAGE Arrows #-}\n\nimport Control.Arrow\n\nfilterA :: (ArrowChoice arr) =&gt; arr a Bool -&gt; arr [a] [a]\nfilterA f = farr\n  where\n    farr = proc xs -&gt;\n            case xs of\n                []       -&gt; returnA -&lt; []\n                (x:xs')  -&gt; do\n                    b   &lt;- f    -&lt; x\n                    ys' &lt;- farr -&lt; xs'\n                    returnA -&lt; if b then x : ys' else ys'\n</code></pre>\n\n<p>The result translated internally to the arrow notation will be probably somewhat less concise, but hopefully the compiler will optimize for you.</p>\n"}], "owner": {"reputation": 542, "user_id": 1956587, "user_type": "registered", "accept_rate": 82, "profile_image": "https://www.gravatar.com/avatar/e92d52f1c16bcf435ef24f7a474fde04?s=128&d=identicon&r=PG", "display_name": "tolUene", "link": "https://stackoverflow.com/users/1956587/toluene"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 136, "favorite_count": 0, "accepted_answer_id": 31216199, "answer_count": 3, "score": 1, "last_activity_date": 1436099330, "creation_date": 1435973606, "last_edit_date": 1435974908, "question_id": 31216004, "link": "https://stackoverflow.com/questions/31216004/haskell-control-arrow-trying-to-write-a-filtera-function", "title": "Haskell Control.Arrow: trying to write a filterA function", "body": "<p>I am trying to write a <code>filterA :: (ArrowChoice arr) =&gt; arr a Bool -&gt; arr [a] [a]</code> function that removes every element from a list for which <code>f :: arr a Bool</code> returns <code>False</code>. This is what I have so far</p>\n\n<pre><code>listcase [] = Left ()\nlistcase (x:xs) = Right (x, xs)\n\nfilterA f = arr listcase &gt;&gt;&gt;\n            arr (const []) ||| (first (f &amp;&amp;&amp; arr id) &gt;&gt;&gt;\n            arr (\\((b,x),xs) -&gt; if b then\n                x : (filterA f xs)\n                else filterA f xs\n            ))\n</code></pre>\n\n<p>Now this works when testing it with <code>(-&gt;) a</code> Arrows, like this:</p>\n\n<pre><code>\u03bb&gt; filterA (== 8) [8,9]\n[8]\n</code></pre>\n\n<p>It doesn't work however, for Kleisli Arrows like</p>\n\n<pre><code>\u03bb&gt; runKleisli (Kleisli $ filterA (== 8)) (return [8,9] :: [IO Int])\n\n&lt;interactive&gt;:160:47:\n    Couldn't match expected type `IO Int' with actual type `[t0]'\n    In the first argument of `return', namely `[8, 9]'\n    In the second argument of `runKleisli', namely\n      `(return [8, 9] :: [IO Int])'\n    In the expression:\n      runKleisli (Kleisli $ filterA (== 8)) (return [8, 9] :: [IO Int])\n</code></pre>\n\n<p>And when adding a type signature <code>filterA :: (Arrow arr) =&gt; arr a Bool -&gt; arr [a] [a]</code> or <code>filterA :: (ArrowChoice arr) =&gt; arr a Bool -&gt; arr [a] [a]</code>, it throws this error: </p>\n\n<pre><code>arrows.hs:11:22:\n    Could not deduce (arr ~ (-&gt;))\n    from the context (Arrow arr)\n      bound by the type signature for\n                 filterA :: Arrow arr =&gt; arr a Bool -&gt; arr [a] [a]\n      at arrows.hs:7:12-51\n      `arr' is a rigid type variable bound by\n            the type signature for\n              filterA :: Arrow arr =&gt; arr a Bool -&gt; arr [a] [a]\n            at arrows.hs:7:12\n    Expected type: [a] -&gt; [a]\n      Actual type: arr [a] [a]\n    The function `filterA' is applied to two arguments,\n    but its type `arr a Bool -&gt; arr [a] [a]' has only one\n    In the second argument of `(:)', namely `(filterA f xs)'\n    In the expression: x : (filterA f xs)\n</code></pre>\n\n<p>I do not understand why. Did I miss something?</p>\n\n<p><strong>Edit</strong>:\n@jaket's comment worked (I guess that was kinda stupid) but the type signature still doesn't match.\nI also updated the code to be more compact (still getting the same error though) </p>\n\n<pre><code>filterA f = arr listcase &gt;&gt;&gt;\n            arr (const []) ||| (arr toEither &gt;&gt;&gt;\n            (filterA f) ||| (second (filterA f) &gt;&gt;&gt; arr uncurry (:)))\n  where toEither (x, xs) = if f x then Right (x, xs) else Left xs\n</code></pre>\n\n<p>GHC infers the type as <code>filterA :: (a -&gt; Bool) -&gt; [a] -&gt; [a]</code>, by the way.</p>\n"}, {"tags": ["haskell", "yesod", "esqueleto"], "comments": [{"owner": {"reputation": 1044, "user_id": 476114, "user_type": "registered", "accept_rate": 78, "profile_image": "https://www.gravatar.com/avatar/18db9bf4cb83fb9c8f30aeb53b3ccfae?s=128&d=identicon&r=PG", "display_name": "Bzzt", "link": "https://stackoverflow.com/users/476114/bzzt"}, "edited": false, "score": 0, "creation_date": 1436560126, "post_id": 31215471, "comment_id": 50682577, "body": "when you execute the sql, check the yesod console output for the full text of the sql statement and its parameters.  cut and paste into a document, edit out the quotes and try to execute it directly in the psql command line.  Maybe will help give you insight as to the specific problem."}], "owner": {"reputation": 557, "user_id": 4587327, "user_type": "registered", "accept_rate": 18, "profile_image": "https://lh6.googleusercontent.com/-eepjCZh3Ed8/AAAAAAAAAAI/AAAAAAAAAG8/qey1ipv0gxI/photo.jpg?sz=128", "display_name": "Ryan Monreal", "link": "https://stackoverflow.com/users/4587327/ryan-monreal"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 30, "favorite_count": 0, "answer_count": 0, "score": 1, "last_activity_date": 1435970883, "creation_date": 1435967917, "last_edit_date": 1435970883, "question_id": 31215471, "link": "https://stackoverflow.com/questions/31215471/yesod-esqueleto-unknow-for-modelid-while-joining", "title": "Yesod Esqueleto Unknow for ModelId While Joining", "body": "<p>I have a problem when it comes on compiling my code on esqueleto. For some reason my IDE which is fpcomplete says that there is now an error. But, when I build it it says the My ModelId is unknown.</p>\n\n<p>Here is my code:</p>\n\n<pre><code>qryStrainsList ::  SqlBackend -&gt; IO [RawWeedsInfo]\nqryStrainsList backend = (flip runReaderT) backend\n    $ select \n    $ from $ \\(strains `LeftOuterJoin` strainsInfo) -&gt; do\n         on $ (strains ^. StrainsId) ==.  strainsInfo ^. StrainsAdditionalInformationStrainId\n         return ( strains   ^. StrainsId\n            , strains   ^. StrainsName\n            , strains ^. StrainsStrainType\n            , strains ^. StrainsDescription\n            , strainsInfo ^. StrainsAdditionalInformationIncludeType\n            , strainsInfo ^. StrainsAdditionalInformationExcludeType\n            , strainsInfo ^. StrainsAdditionalInformationSymptoms\n            , strainsInfo ^. StrainsAdditionalInformationConditions\n            , strains ^. StrainsFlavor\n            , strains ^. StrainsThcLevel\n            , strains ^. StrainsCbdLevel\n            , strains ^. StrainsPhotoPeriod\n            , strains ^. StrainsBreeders\n      )\n</code></pre>\n\n<p>The error message is this:</p>\n\n<pre><code>The code threw an exception : \nIOException: user error (Postgresql.withStmt': \n    bad result status FatalError (\n    (\"PGRES_FATAL_ERROR\",\"ERROR:  \n           zero-length delimited identifier at or near \\\"\\\"\\\"\\\"\\nLINE \n    1: SELECT \\\"strains\\\".\\\"\\\", \\\"strains\\\".\\\"name\\\", \\\"strains\\\".\\\"strain_typ...\\n                         ^\\n\")))\n</code></pre>\n\n<p>Maybe this will also help: I'm using FpComplete as an IDE with Esqueleto 2.0.1 (This was the version supported by the IDE, I think.)</p>\n\n<p>Thanks.</p>\n"}, {"tags": ["haskell", "pattern-matching"], "comments": [{"owner": {"reputation": 9455, "user_id": 1172541, "user_type": "registered", "accept_rate": 30, "profile_image": "https://i.stack.imgur.com/LROoN.png?s=128&g=1", "display_name": "PyRulez", "link": "https://stackoverflow.com/users/1172541/pyrulez"}, "edited": false, "score": 2, "creation_date": 1435962741, "post_id": 31214814, "comment_id": 50430905, "body": "If you use GHC, you can make use of <a href=\"http://downloads.haskell.org/~ghc/latest/docs/html/users_guide/syntax-extns.html#record-wildcards\" rel=\"nofollow noreferrer\">Record Wildcards</a>."}], "answers": [{"comments": [{"owner": {"reputation": 46235, "user_id": 2541573, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/Z1qtP.png?s=128&g=1", "display_name": "jub0bs", "link": "https://stackoverflow.com/users/2541573/jub0bs"}, "edited": false, "score": 0, "creation_date": 1435964542, "post_id": 31214874, "comment_id": 50431291, "body": "Correct me if I&#39;m wrong, but pattern synonyms don&#39;t allow you to define a more &quot;concise&quot; synonym for <code>Node n left right</code> and use that synonym in place of the <code>Node n left right</code> pattern in the LHS of equations. Records widlcards, as suggested by PyRulez in his comment, seem closer to what the OP is looking for."}, {"owner": {"reputation": 46235, "user_id": 2541573, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/Z1qtP.png?s=128&g=1", "display_name": "jub0bs", "link": "https://stackoverflow.com/users/2541573/jub0bs"}, "edited": false, "score": 0, "creation_date": 1435997870, "post_id": 31214874, "comment_id": 50437426, "body": "Ok; I can see how what you describe can be useful in the OP&#39;case."}, {"owner": {"reputation": 100185, "user_id": 3234959, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/93bb12ca0f93dfddb33880316f7e66c2?s=128&d=identicon&r=PG&f=1", "display_name": "chi", "link": "https://stackoverflow.com/users/3234959/chi"}, "reply_to_user": {"reputation": 46235, "user_id": 2541573, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/Z1qtP.png?s=128&g=1", "display_name": "jub0bs", "link": "https://stackoverflow.com/users/2541573/jub0bs"}, "edited": false, "score": 1, "creation_date": 1435998665, "post_id": 31214874, "comment_id": 50437581, "body": "@Jubobs I now tried to apply the PyRulez suggestion, so this should answer to the &quot;shortening&quot; part as well."}], "tags": [], "owner": {"reputation": 100185, "user_id": 3234959, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/93bb12ca0f93dfddb33880316f7e66c2?s=128&d=identicon&r=PG&f=1", "display_name": "chi", "link": "https://stackoverflow.com/users/3234959/chi"}, "is_accepted": true, "score": 4, "last_activity_date": 1436033069, "last_edit_date": 1436033069, "creation_date": 1435962607, "answer_id": 31214874, "question_id": 31214814, "link": "https://stackoverflow.com/questions/31214814/haskell-reuse-patterns/31214874#31214874", "title": "Haskell reuse patterns", "body": "<p>This only answers the part:</p>\n\n<blockquote>\n  <p>If I want to [...] change my datatype, I have to change all the functions.</p>\n</blockquote>\n\n<p>In that case, you can avoid to change all the functions by\ndefining a custom pattern with the <a href=\"https://downloads.haskell.org/~ghc/latest/docs/html/users_guide/syntax-extns.html#pattern-synonyms\" rel=\"nofollow\">pattern synonyms extension</a>:</p>\n\n<pre><code>{-# LANGUAGE PatternSynonyms #-}\n\n-- The old type:\n-- data Tree = Node Int Tree Tree\n--           | Leaf \n\n-- The new type\ndata Tree = NewNode Tree Int Tree  -- changed name &amp; argument order\n          | Leaf\n\npattern Node n left right = NewNode left n right\n\nadd :: Tree -&gt; Int -&gt; Tree\nadd (Node n left right) x = Node (n+x) (add left x) (add right x) \nadd (Leaf) x = Leaf\n\n-- etc.\n</code></pre>\n\n<p>Above, I renamed the old constructor <code>Node</code> into <code>NewNode</code>, also changing the order of its arguments. Then, I defined a <code>pattern Node</code> as a compatibility bridge, making the old patterns below work once again.</p>\n\n<hr>\n\n<p>The question also asks:</p>\n\n<blockquote>\n  <p>Is there a way to reuse these patterns, so I only have to define them once?</p>\n</blockquote>\n\n<p>@PyRulez commented on using record wildcards to shorten patterns. Here's a possible way:</p>\n\n<pre><code>{-# LANGUAGE ViewPatterns, RecordWildCards #-}\n\n-- an auxiliary record type to define the custom pattern \ndata R = RNode { left::Tree , n::Int, right::Tree } | RLeaf\n-- a function to convert a Tree to a R\ntoR :: Tree -&gt; R\ntoR (NewNode l n r) = RNode l n r\ntoR _ = RLeaf\n\n-- Here we use a shorter pattern:\nadd2 :: Tree -&gt; Int -&gt; Tree\nadd2 (toR -&gt; RNode{..}) x = Node (n+x) (add2 left x) (add2 right x)\n  -- ^^^^^^^^^^^^^^^^^^^ this brings in scope left, n, right\nadd2 (toR -&gt; RLeaf) x = Leaf\n</code></pre>\n\n<p>In this specific case, there's not a huge gain in space. However, no matter how large the pattern is, after the record definition (and auxiliary function) we only have to write <code>toR -&gt; RNode{...}</code>.</p>\n\n<p>I am not sure I really like this, though. </p>\n\n<p>First, the record pollutes the global name space with three (partial!) functions <code>left :: R -&gt; Tree, n :: R -&gt; Int, right :: R -&gt; Tree</code>. This will trigger a few warnings if you try to use e.g. <code>n</code> as an argument of another unrelated function (<code>The local name shadows the global name n</code>). </p>\n\n<p>Second, the record wildcards extension brings in scope some variables which are not written in the code -- the reader has to know (or guess) what these variables are. Also note that the <code>RNode{..}</code> pattern brings e.g. <code>n</code> into scope with a different type than the global name: <code>Int</code> rather than <code>R -&gt; Int</code>. A reader may think that <code>n</code> is the global one and be misled even at the type level.</p>\n\n<p>Third, the code above uses view patterns, and these currently confuse the exhaustiveness checker:</p>\n\n<pre><code>Patterns.hs:23:1: Warning:\n    Pattern match(es) are non-exhaustive\n    In an equation for \u2018add2\u2019: Patterns not matched: _ _\n</code></pre>\n\n<p>In this specific case, we could simply write</p>\n\n<pre><code>add2 :: Tree -&gt; Int -&gt; Tree\nadd2 (node -&gt; RNode{..}) x = Node (n+x) (add2 left x) (add2 right x)\nadd2 _ x = Leaf\n</code></pre>\n\n<p>to avoid the warning, but we do not always have that option, in general.</p>\n"}], "owner": {"reputation": 332, "user_id": 2165613, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/2b3d7a5b421c036dd1d394055719581b?s=128&d=identicon&r=PG", "display_name": "Emiel Steerneman", "link": "https://stackoverflow.com/users/2165613/emiel-steerneman"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 248, "favorite_count": 1, "accepted_answer_id": 31214874, "answer_count": 1, "score": 9, "last_activity_date": 1436033069, "creation_date": 1435962016, "question_id": 31214814, "link": "https://stackoverflow.com/questions/31214814/haskell-reuse-patterns", "title": "Haskell reuse patterns", "body": "<p>In the code below, the same pattern match <strong>(Node n left right)</strong> is used by three different functions. If I want to add a pattern, e.g. <strong>(Node n (Leaf) (Leaf))</strong> or change my datatype, I have to change all the functions. Is there a way to reuse these patterns, so I only have to define them once?</p>\n\n<pre><code>data Tree = Node Int Tree Tree\n          | Leaf \n\nadd :: Tree -&gt; Int -&gt; Tree\nadd (Node n left right) x = Node (n+x) (add left x) (add right x) \nadd (Leaf) x = Leaf\n\nsubtract :: Tree -&gt; Int -&gt; Tree\nsubtract (Node n left right) x = Node (n-x) (subtract left x) (subtract right x) \nsubtract (Leaf) x = Leaf\n\nswap :: Tree -&gt; Tree\nswap (Node n left right) = Node n right left\nswap (Leaf) = Leaf\n</code></pre>\n\n<p>I tried </p>\n\n<pre><code>matchNode = (PNode n left right)\nadd matchNode x = Node (n+x) (add left x) (add right x) \n</code></pre>\n\n<p>but it won't allow me to use the pattern _, and I can't extract <strong>n</strong>, <strong>left</strong>, and <strong>right</strong> from it.</p>\n"}, {"tags": ["haskell", "cabal"], "answers": [{"comments": [{"owner": {"reputation": 6116, "user_id": 1241368, "user_type": "registered", "accept_rate": 81, "profile_image": "https://www.gravatar.com/avatar/7019dabd783b2ecfaf04f5440ebb56df?s=128&d=identicon&r=PG", "display_name": "Mike Izbicki", "link": "https://stackoverflow.com/users/1241368/mike-izbicki"}, "edited": false, "score": 0, "creation_date": 1435957051, "post_id": 31214045, "comment_id": 50429430, "body": "Is it not possible in just the cabal configuration? I have about 20 or so scripts that I&#39;d like to run, and I don&#39;t want to have create empty haskell programs for each of them.  My current solution of using a makefile would be easier."}, {"owner": {"reputation": 34015, "user_id": 1026598, "user_type": "registered", "accept_rate": 85, "profile_image": "https://www.gravatar.com/avatar/e4cf2da845e7862bd0b0e4edd405f77d?s=128&d=identicon&r=PG", "display_name": "Gabriel Gonzalez", "link": "https://stackoverflow.com/users/1026598/gabriel-gonzalez"}, "reply_to_user": {"reputation": 6116, "user_id": 1241368, "user_type": "registered", "accept_rate": 81, "profile_image": "https://www.gravatar.com/avatar/7019dabd783b2ecfaf04f5440ebb56df?s=128&d=identicon&r=PG", "display_name": "Mike Izbicki", "link": "https://stackoverflow.com/users/1241368/mike-izbicki"}, "edited": false, "score": 0, "creation_date": 1435958081, "post_id": 31214045, "comment_id": 50429741, "body": "You can run all of them within the same Haskell program.  You don&#39;t have to create a separate Haskell program for each script"}, {"owner": {"reputation": 6116, "user_id": 1241368, "user_type": "registered", "accept_rate": 81, "profile_image": "https://www.gravatar.com/avatar/7019dabd783b2ecfaf04f5440ebb56df?s=128&d=identicon&r=PG", "display_name": "Mike Izbicki", "link": "https://stackoverflow.com/users/1241368/mike-izbicki"}, "edited": false, "score": 0, "creation_date": 1435959295, "post_id": 31214045, "comment_id": 50430077, "body": "True, but then when I run <code>cabal test</code>, if any test fails it won&#39;t tell me which one failed.  It will just tell me that one of the bash scripts failed."}, {"owner": {"reputation": 34015, "user_id": 1026598, "user_type": "registered", "accept_rate": 85, "profile_image": "https://www.gravatar.com/avatar/e4cf2da845e7862bd0b0e4edd405f77d?s=128&d=identicon&r=PG", "display_name": "Gabriel Gonzalez", "link": "https://stackoverflow.com/users/1026598/gabriel-gonzalez"}, "reply_to_user": {"reputation": 6116, "user_id": 1241368, "user_type": "registered", "accept_rate": 81, "profile_image": "https://www.gravatar.com/avatar/7019dabd783b2ecfaf04f5440ebb56df?s=128&d=identicon&r=PG", "display_name": "Mike Izbicki", "link": "https://stackoverflow.com/users/1241368/mike-izbicki"}, "edited": false, "score": 0, "creation_date": 1435959872, "post_id": 31214045, "comment_id": 50430239, "body": "You can add more descriptive error handling to your Haskell script.  Cabal also saves the stdout and stderr that your test script emits"}], "tags": [], "owner": {"reputation": 34015, "user_id": 1026598, "user_type": "registered", "accept_rate": 85, "profile_image": "https://www.gravatar.com/avatar/e4cf2da845e7862bd0b0e4edd405f77d?s=128&d=identicon&r=PG", "display_name": "Gabriel Gonzalez", "link": "https://stackoverflow.com/users/1026598/gabriel-gonzalez"}, "is_accepted": false, "score": 2, "last_activity_date": 1435956515, "creation_date": 1435956515, "answer_id": 31214045, "question_id": 31213883, "link": "https://stackoverflow.com/questions/31213883/how-to-use-cabal-with-bash-tests/31214045#31214045", "title": "How to use cabal with bash tests", "body": "<p>First you need to add a test-suite to your cabal file.  For this you will use the <code>exitcode-stdio</code> test suite, which will look something like this:</p>\n\n<pre><code>Name:           foo\nVersion:        1.0\nLicense:        BSD3\nCabal-Version:  &gt;= 1.9.2\nBuild-Type:     Simple\n\nTest-Suite test-foo\n    type:       exitcode-stdio-1.0\n    main-is:    test-foo.hs\n    build-depends: base\n</code></pre>\n\n<p>The above example test-suite was taken from <a href=\"https://www.haskell.org/cabal/users-guide/developing-packages.html#test-suites\" rel=\"nofollow\">the Cabal documentation for test suites</a></p>\n\n<p>Then in your <code>test-foo.hs</code> file you would run the bash script and die with an exception for a non-zero exit code.  You can do this using <code>System.Process</code>:</p>\n\n<pre><code>-- test-foo.hs\nimport System.Exit (ExitSuccess)\nimport System.Process (system)\n\nmain = do\n    -- This dies with a pattern match failure if the shell command fails\n    ExitSuccess &lt;- system \"./myprog\"\n    return ()\n</code></pre>\n\n<p>Then you can run the above test using <code>cabal test</code> and it will report a test failure if your shell program has a non-zero exit code.</p>\n"}, {"tags": [], "owner": {"reputation": 21654, "user_id": 107331, "user_type": "registered", "accept_rate": 80, "profile_image": "https://www.gravatar.com/avatar/cf6d0868b2b4c69bac3e6f265a32b6a7?s=128&d=identicon&r=PG", "display_name": "Daniel Martin", "link": "https://stackoverflow.com/users/107331/daniel-martin"}, "is_accepted": false, "score": 3, "last_activity_date": 1435968740, "creation_date": 1435968740, "answer_id": 31215557, "question_id": 31213883, "link": "https://stackoverflow.com/questions/31213883/how-to-use-cabal-with-bash-tests/31215557#31215557", "title": "How to use cabal with bash tests", "body": "<p>This module will allow you to run all <code>.sh</code> scripts in a specific subdirectory as a test. Furthermore, this uses the <code>test-framework</code> package so that if you want, you can run the test as:</p>\n\n<pre><code>cabal test '--test-option=--jxml=dist/test/$test-suite.xml'\n</code></pre>\n\n<p>And you can then obtain junit-style XML from the tests. This is currently checked in in <a href=\"https://github.com/fizbin/cabal-demo-backflip/tree/def4ae0e2dd127220bacb02742f888748a9406ff\" rel=\"nofollow\">my project for testing cabal things</a>. The test code:</p>\n\n<pre><code>import Data.List (isSuffixOf)\nimport Control.Applicative\nimport Test.Framework (defaultMain, testGroup, Test)\nimport Test.Framework.Providers.HUnit\nimport Test.HUnit (assertFailure)\nimport System.Directory\nimport System.Exit (ExitCode(..))\nimport System.Process\n\n\nmain :: IO ()\nmain = makeTests \"test\" &gt;&gt;= defaultMain\n\n-- Make a test out of those things which end in \".sh\" and are executable\n-- Make a testgroup out of directories\nmakeTests :: FilePath -&gt; IO [Test]\nmakeTests dir = do\n  origDir &lt;- getCurrentDirectory\n  contents &lt;- getDirectoryContents dir\n  setCurrentDirectory dir\n  retval &lt;- mapM fileFunc contents\n  setCurrentDirectory origDir\n  return $ concat retval\n  where\n    fileFunc \".\" = return []\n    fileFunc \"..\" = return []\n    fileFunc f | \".sh\" `isSuffixOf` f = do\n      fullName &lt;- canonicalizePath f\n      isExecutable &lt;- executable &lt;$&gt; getPermissions fullName\n      let hunitTest = mkTest fullName\n      return [testCase f hunitTest | isExecutable]\n    fileFunc d = do\n      fullName &lt;- canonicalizePath d\n      isSearchable &lt;- searchable &lt;$&gt; getPermissions fullName\n      if isSearchable\n        then do subTests &lt;- makeTests d\n                return [testGroup d subTests]\n        else return []\n    mkTest fullName = do\n      execResult &lt;- system fullName\n      case execResult of\n        ExitSuccess -&gt; return ()\n        ExitFailure code -&gt; assertFailure (\"Failed with code \" ++ show code)\n</code></pre>\n\n<p>I use this with this clause in my <code>.cabal</code> file:</p>\n\n<pre><code>test-suite BackflipShellTests\n  type:                exitcode-stdio-1.0\n  main-is:             BackflipShellTests.hs\n  hs-source-dirs:      test\n  build-depends:       backflip, base, test-framework-hunit,\n                       test-framework, directory, process, HUnit\n  default-language:    Haskell2010\n</code></pre>\n\n<p>Note that though I placed the <code>.sh</code> tests and the test module in the same directory (called <code>test</code>), there's no inherent reason to do so.</p>\n"}], "owner": {"reputation": 6116, "user_id": 1241368, "user_type": "registered", "accept_rate": 81, "profile_image": "https://www.gravatar.com/avatar/7019dabd783b2ecfaf04f5440ebb56df?s=128&d=identicon&r=PG", "display_name": "Mike Izbicki", "link": "https://stackoverflow.com/users/1241368/mike-izbicki"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 217, "favorite_count": 1, "answer_count": 2, "score": 5, "last_activity_date": 1435968740, "creation_date": 1435955645, "question_id": 31213883, "link": "https://stackoverflow.com/questions/31213883/how-to-use-cabal-with-bash-tests", "title": "How to use cabal with bash tests", "body": "<p>For my project, I've written some unit tests as bash scripts.  There really was no reasonable way to write the tests in Haskell.  </p>\n\n<p>I'd like these scripts to run when I type <code>cabal test</code>.  How do I make that happen?</p>\n"}, {"tags": ["haskell"], "comments": [{"owner": {"reputation": 34015, "user_id": 1026598, "user_type": "registered", "accept_rate": 85, "profile_image": "https://www.gravatar.com/avatar/e4cf2da845e7862bd0b0e4edd405f77d?s=128&d=identicon&r=PG", "display_name": "Gabriel Gonzalez", "link": "https://stackoverflow.com/users/1026598/gabriel-gonzalez"}, "edited": false, "score": 0, "creation_date": 1435954115, "post_id": 31213315, "comment_id": 50428469, "body": "How are you launching <code>ghci</code>?  Are you running <code>ghci</code> from the command line or some other method?"}, {"owner": {"reputation": 1614, "user_id": 4422095, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/62eef831911aa459ae9e18e0ce4dee02?s=128&d=identicon&r=PG&f=1", "display_name": "Stan Shunpike", "link": "https://stackoverflow.com/users/4422095/stan-shunpike"}, "reply_to_user": {"reputation": 34015, "user_id": 1026598, "user_type": "registered", "accept_rate": 85, "profile_image": "https://www.gravatar.com/avatar/e4cf2da845e7862bd0b0e4edd405f77d?s=128&d=identicon&r=PG", "display_name": "Gabriel Gonzalez", "link": "https://stackoverflow.com/users/1026598/gabriel-gonzalez"}, "edited": false, "score": 0, "creation_date": 1435954200, "post_id": 31213315, "comment_id": 50428505, "body": "There is a link in my start menu that I click. Does that answer your question?"}, {"owner": {"reputation": 46235, "user_id": 2541573, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/Z1qtP.png?s=128&g=1", "display_name": "jub0bs", "link": "https://stackoverflow.com/users/2541573/jub0bs"}, "edited": false, "score": 1, "creation_date": 1435954235, "post_id": 31213315, "comment_id": 50428524, "body": "I don&#39;t use Windows, but <code>:!cd</code> should give you the current directory, and <code>:cd &lt;dir&gt;</code> should change directory to <code>&lt;dir&gt;</code>."}, {"owner": {"reputation": 1545, "user_id": 2670439, "user_type": "registered", "accept_rate": 89, "profile_image": "https://i.stack.imgur.com/wFcPA.jpg?s=128&g=1", "display_name": "SwiftsNamesake", "link": "https://stackoverflow.com/users/2670439/swiftsnamesake"}, "edited": false, "score": 0, "creation_date": 1501304101, "post_id": 31213315, "comment_id": 77731903, "body": "If you&#39;re using stack, you could simply run <code>stack ghci</code>."}], "answers": [{"comments": [{"owner": {"reputation": 6144, "user_id": 684285, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/e54dafa761a462367daa2d560bd72a86?s=128&d=identicon&r=PG", "display_name": "Evi1M4chine", "link": "https://stackoverflow.com/users/684285/evi1m4chine"}, "edited": false, "score": 0, "creation_date": 1515337620, "post_id": 31213669, "comment_id": 83254257, "body": "\u201cIf you omit the directory, you will change to your home again.\u201d \u2190 This is actually POSIX standard behavior of <code>cd</code>, if <code>$HOME</code> is set, and so, implied by <code>cd</code>, even in GHCi. :) (If <code>$HOME</code> is unset, the behavior is undefined. <code>bash</code> does just show an error that the variable is not set.)"}, {"owner": {"reputation": 1072, "user_id": 1627959, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/rZFhx.jpg?s=128&g=1", "display_name": "Tim", "link": "https://stackoverflow.com/users/1627959/tim"}, "edited": false, "score": 0, "creation_date": 1522499542, "post_id": 31213669, "comment_id": 86183185, "body": "And all of that works in exactly the same way on a Mac: Prelude&gt;:! ls will get the contents. Prelude&gt;:! cd &lt;YourChosenPath&gt; etc."}], "tags": [], "owner": {"reputation": 94713, "user_id": 1139697, "user_type": "registered", "accept_rate": 86, "profile_image": "https://www.gravatar.com/avatar/5f136ddb684f39aaee1c028ee1950f6f?s=128&d=identicon&r=PG", "display_name": "Zeta", "link": "https://stackoverflow.com/users/1139697/zeta"}, "is_accepted": true, "score": 25, "last_activity_date": 1435954276, "creation_date": 1435954276, "answer_id": 31213669, "question_id": 31213315, "link": "https://stackoverflow.com/questions/31213315/how-to-set-current-directory-in-ghci/31213669#31213669", "title": "How to set current directory in GHCi?", "body": "<blockquote>\n  <p>How do I set the current directory? </p>\n</blockquote>\n\n<p>GHCi provides the <code>:cd &lt;dir&gt;</code> command. You can get the list of all commands with <code>:?</code>. If you omit the directory, you will change to your home again.</p>\n\n<blockquote>\n  <p>How do I get the GHCi to tell me what the path for current directory is so I can check what it is set at when I want to? </p>\n</blockquote>\n\n<p>Funny enough, GHCi doesn't provide a command for this, but you can use Window's <code>cd</code> command. In order to execute an external command, you need to use <code>:!</code>, e.g. <code>:! cd</code>.</p>\n\n<h3>Example</h3>\n\n<pre>ghci> :! cd\nC:\\Users\\Zeta\nghci> :cd workspace\nghci> :cd stackoverflow\nghci> :! cd\nC:\\Users\\Zeta\\workspace\\stackoverflow\nghci> :cd\nghci> :!cd\nC:\\Users\\Zeta\n</pre>\n"}, {"tags": [], "owner": {"reputation": 21, "user_id": 7911263, "user_type": "registered", "profile_image": "https://lh4.googleusercontent.com/-lA6ET_NkscM/AAAAAAAAAAI/AAAAAAAABCg/wAVu_gJxRv0/photo.jpg?sz=128", "display_name": "\uac15\uc900\ubaa8", "link": "https://stackoverflow.com/users/7911263/%ea%b0%95%ec%a4%80%eb%aa%a8"}, "is_accepted": false, "score": 1, "last_activity_date": 1540739288, "creation_date": 1540739288, "answer_id": 53032948, "question_id": 31213315, "link": "https://stackoverflow.com/questions/31213315/how-to-set-current-directory-in-ghci/53032948#53032948", "title": "How to set current directory in GHCi?", "body": "<p>well just answer is <code>:cd</code>  as @Zeta wroted\nbut futher more, for searching someone like me</p>\n\n<ul>\n<li>path: <code>:cd</code></li>\n<li>path with command: <code>:! cd</code> just like vim <code>!</code> is  of user's OS console</li>\n<li><code>:cd &lt;DIR&gt;</code> is almost equor <code>:! cd &lt;DIR&gt;</code></li>\n<li>there's another way <code>:show paths</code> that shows somepaths, and there's current dicectory</li>\n</ul>\n\n<p>PS> Searched some conf.d(~/.ghci/ghci.conf) like one but failed.</p>\n"}, {"tags": [], "owner": {"reputation": 570, "user_id": 3295004, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/IGNvT.jpg?s=128&g=1", "display_name": "fp_mora", "link": "https://stackoverflow.com/users/3295004/fp-mora"}, "is_accepted": false, "score": 1, "last_activity_date": 1615588429, "creation_date": 1615588429, "answer_id": 66608092, "question_id": 31213315, "link": "https://stackoverflow.com/questions/31213315/how-to-set-current-directory-in-ghci/66608092#66608092", "title": "How to set current directory in GHCi?", "body": "<p>What worked for me in Windows 10 with GHCi-8.10.4 is</p>\n<pre><code>:cd c:\\\\Work\\Finance\\UT Trial Balance\n</code></pre>\n<p>And</p>\n<pre><code>:cd ..\n</code></pre>\n<p>Works well, too. One assumes Haskell strings [Char] but no, literal strings. The spaces do not even have to be escaped. The Windows backward slash works, too. ugh.\nYou still have to use</p>\n<pre><code>:! cd\n</code></pre>\n<p>to see where you are. I am assumming, now I can <code>:l</code> my code in my working directory.</p>\n<p>If you go out with like <code>:! bash -i</code> it is a fork and separate. You can cd all over but it will not change the GHCi working directory.</p>\n<p>And <code>:! pwd</code> works in my GHCi.</p>\n<p>Now you get very many Linux tools when you install Haskell-dev. It's sweet. I got rid of Cygwin and installed <strong>Ubuntu 20.04.1 LTS</strong> in windows last year which is real Linux on Windows but the commands are not available at the Windows command line. Now, with Haskell-dev I get Linux everywhere for free. Joy.</p>\n"}], "owner": {"reputation": 1614, "user_id": 4422095, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/62eef831911aa459ae9e18e0ce4dee02?s=128&d=identicon&r=PG&f=1", "display_name": "Stan Shunpike", "link": "https://stackoverflow.com/users/4422095/stan-shunpike"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 13565, "favorite_count": 6, "accepted_answer_id": 31213669, "answer_count": 3, "score": 15, "last_activity_date": 1615588429, "creation_date": 1435952514, "last_edit_date": 1508219280, "question_id": 31213315, "link": "https://stackoverflow.com/questions/31213315/how-to-set-current-directory-in-ghci", "title": "How to set current directory in GHCi?", "body": "<p>I am new to Haskell and using a Windows PC. I am trying to set up my GHCi interface so that I can write my code in my text editor before executing it using the GHCi.</p>\n\n<p>Currently, my GHCi reads </p>\n\n<pre><code>$ ghci GHCi, version 6.12.1: http://www.haskell.org/ghc/ :? for help \nLoading package ghc-prim ... linking ... done. \nLoading package integer-gmp ... linking ... done. \nLoading package base ... linking ... done.\nPrelude&gt;\n</code></pre>\n\n<p>According to this <a href=\"https://downloads.haskell.org/~ghc/7.8.1/docs/html/users_guide/loading-source-files.html\" rel=\"noreferrer\">site</a>, I have to save my Haskell files to the current directory or specify some other directory in order to access them. This is what I don't know how to do. </p>\n\n<p><strong>My Questions:</strong></p>\n\n<ol>\n<li>How do I set the current directory? </li>\n<li>How do I get the GHCi to tell me what the path for current directory is so I can check what it is set at when I want to? </li>\n</ol>\n\n<p>Please explain starting from the line </p>\n\n<pre><code>Prelude&gt;\n</code></pre>\n\n<p>as noted above so that I can follow along. </p>\n\n<p><strong>Note:</strong> </p>\n\n<p>The example Haskell code given was </p>\n\n<p>file name: Main.hs </p>\n\n<pre><code>main = print(fac(20))\n\nfac 0 = 1\nfac n = n * fac(n-1) \n</code></pre>\n\n<p>and in the GHCi</p>\n\n<pre><code>prelude&gt; :load Main \nCompiling Main ( Main.hs, interpreted ) \nOk, modules loaded: Main. \n*Main&gt; fac 17 \n355687428096000\n</code></pre>\n\n<p>So I want to save Main.hs to a directory, specify this as the current directory in the GHCi, and then run the above code. </p>\n"}, {"tags": ["haskell", "generic-programming"], "comments": [{"owner": {"reputation": 6581, "user_id": 461202, "user_type": "registered", "accept_rate": 83, "profile_image": "https://www.gravatar.com/avatar/6f780ff5bfdfea60bdc260664f00b574?s=128&d=identicon&r=PG", "display_name": "zegkljan", "link": "https://stackoverflow.com/users/461202/zegkljan"}, "edited": false, "score": 3, "creation_date": 1435950615, "post_id": 31212928, "comment_id": 50427279, "body": "If the input data is going to be <code>NamedPoint</code> why cannot the function be typed as <code>f :: NamedPoint -&gt; [Int]</code>?"}, {"owner": {"reputation": 590, "user_id": 514156, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/14bc8841a38ecf3db2e7f3d0d68f6668?s=128&d=identicon&r=PG", "display_name": "user514156", "link": "https://stackoverflow.com/users/514156/user514156"}, "reply_to_user": {"reputation": 6581, "user_id": 461202, "user_type": "registered", "accept_rate": 83, "profile_image": "https://www.gravatar.com/avatar/6f780ff5bfdfea60bdc260664f00b574?s=128&d=identicon&r=PG", "display_name": "zegkljan", "link": "https://stackoverflow.com/users/461202/zegkljan"}, "edited": false, "score": 0, "creation_date": 1435951181, "post_id": 31212928, "comment_id": 50427488, "body": "In this case it could. But I was thinking this behavior could be useful for extracting generalized types. ill edit my question to be more specific."}, {"owner": {"reputation": 22266, "user_id": 649287, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/7c0ea0055b84020bf860c05f53ba53d5?s=128&d=identicon&r=PG", "display_name": "augustss", "link": "https://stackoverflow.com/users/649287/augustss"}, "edited": false, "score": 0, "creation_date": 1435962176, "post_id": 31212928, "comment_id": 50430762, "body": "For this task, uniplate is the simplest choice.  Your f is simply the universeBi function."}], "answers": [{"comments": [{"owner": {"reputation": 33184, "user_id": 247623, "user_type": "registered", "accept_rate": 72, "profile_image": "https://www.gravatar.com/avatar/bb9e67348d3e0e93ef12dd97c41a6c22?s=128&d=identicon&r=PG&f=1", "display_name": "Erik Kaplun", "link": "https://stackoverflow.com/users/247623/erik-kaplun"}, "edited": false, "score": 1, "creation_date": 1435958784, "post_id": 31213000, "comment_id": 50429929, "body": "&quot;this is not possible&quot; is a bit of an overstatement \u2014 it&#39;s not trivial and not, strictly speaking, possible with the exact signature mentioned (<code>a :: [Int]</code>) but it&#39;s definitely possible to achieve what the OP asks."}, {"owner": {"reputation": 6581, "user_id": 461202, "user_type": "registered", "accept_rate": 83, "profile_image": "https://www.gravatar.com/avatar/6f780ff5bfdfea60bdc260664f00b574?s=128&d=identicon&r=PG", "display_name": "zegkljan", "link": "https://stackoverflow.com/users/461202/zegkljan"}, "reply_to_user": {"reputation": 33184, "user_id": 247623, "user_type": "registered", "accept_rate": 72, "profile_image": "https://www.gravatar.com/avatar/bb9e67348d3e0e93ef12dd97c41a6c22?s=128&d=identicon&r=PG&f=1", "display_name": "Erik Kaplun", "link": "https://stackoverflow.com/users/247623/erik-kaplun"}, "edited": false, "score": 0, "creation_date": 1435959065, "post_id": 31213000, "comment_id": 50430020, "body": "@ErikAllik Thanks for your notice, I didn&#39;t know. I edited the answer to be more accurate."}], "tags": [], "owner": {"reputation": 6581, "user_id": 461202, "user_type": "registered", "accept_rate": 83, "profile_image": "https://www.gravatar.com/avatar/6f780ff5bfdfea60bdc260664f00b574?s=128&d=identicon&r=PG", "display_name": "zegkljan", "link": "https://stackoverflow.com/users/461202/zegkljan"}, "is_accepted": false, "score": 9, "last_activity_date": 1435987900, "last_edit_date": 1435987900, "creation_date": 1435950864, "answer_id": 31213000, "question_id": 31212928, "link": "https://stackoverflow.com/questions/31212928/is-there-a-generic-function-that-takes-a-data-structure-and-returns-all-ints-in/31213000#31213000", "title": "Is there a generic function that takes a data structure and returns all ints in it?", "body": "<p>This is not possible with a function of the type signature you described. Think about what the <code>f :: a -&gt; [Int]</code> means: <code>f</code> is supposed to be a function that takes a value of <strong>any</strong> possible type and returns a list of <code>Int</code>s. How should such a function be defined? The only possible definition is that it ignores the argument and returns a constant value, something like</p>\n\n<pre><code>f :: a -&gt; [Int]\nf _ = [0]\n</code></pre>\n\n<p>If you know what your <code>a</code> is going to be, why not just use that type? Like this:</p>\n\n<pre><code>f :: NamedPoint -&gt; [Int]\nf (NamedPoint _ a b) = [a, b]\n</code></pre>\n\n<p>If you wanted some \"general\" function returning all <code>Int</code>s from a datatype, one option would be to define a typeclass</p>\n\n<pre><code>class IntContainer a where\n    f :: a -&gt; [Int]\n</code></pre>\n\n<p>and then define instances for the datatypes you are interested in</p>\n\n<pre><code>instance IntContainer NamedPoint where\n    f (NamedPoint _ a b) = [a, b]\n</code></pre>\n"}, {"tags": [], "owner": {"reputation": 2846, "user_id": 4347335, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/eb7e6f293a134a5defec74e12cae42cc?s=128&d=identicon&r=PG&f=1", "display_name": "cchalmers", "link": "https://stackoverflow.com/users/4347335/cchalmers"}, "is_accepted": true, "score": 10, "last_activity_date": 1435958613, "last_edit_date": 1435958613, "creation_date": 1435958177, "answer_id": 31214286, "question_id": 31212928, "link": "https://stackoverflow.com/questions/31212928/is-there-a-generic-function-that-takes-a-data-structure-and-returns-all-ints-in/31214286#31214286", "title": "Is there a generic function that takes a data structure and returns all ints in it?", "body": "<p>The <a href=\"http://hackage.haskell.org/package/base-4.8.0.0/docs/Data-Data.html\" rel=\"noreferrer\"><code>Data</code></a> class is capable of this. I've found the easiest way to work with it is with the <a href=\"https://hackage.haskell.org/package/lens-4.11/docs/Data-Data-Lens.html#v:template\" rel=\"noreferrer\"><code>template</code></a> traversal from the <a href=\"https://hackage.haskell.org/package/lens\" rel=\"noreferrer\"><code>lens</code></a> package. This essentially lets you set or get anything with a <code>Data</code> instance. In ghci:</p>\n\n<pre><code>&gt; import Data.Data\n&gt; import Control.Lens\n&gt; import Data.Data.Lens\n\n&gt; -- Data is a derivable class\n&gt; :set -XDeriveDataTypeable\n&gt; data NamedPoint = NamedPoint String Int Int deriving (Data, Show)\n&gt; data Person = Name String Int Int Int deriving (Data, Show)\n&gt; let namedPoint = NamedPoint \"hey\" 1 2\n&gt; let tommy = Name \"Tommy\" 1 2 3\n\n&gt; let ints = toListOf template :: Data a =&gt; a -&gt; [Int]\n&gt; ints namedPoint\n[1,2]\n&gt; ints tommy\n[1,2,3]\n</code></pre>\n\n<p>Because <code>template</code> is a traversal, you can also map over values (but you may need to specify the type):</p>\n\n<pre><code>&gt; namedPoint &amp; template *~ (10 :: Int)\nNamedPoint \"hey\" 10 20\n&gt; import Data.Char\n&gt; tommy &amp; template %~ toUpper\nName \"TOMMY\" 1 2 3\n</code></pre>\n"}], "owner": {"reputation": 590, "user_id": 514156, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/14bc8841a38ecf3db2e7f3d0d68f6668?s=128&d=identicon&r=PG", "display_name": "user514156", "link": "https://stackoverflow.com/users/514156/user514156"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 134, "favorite_count": 1, "accepted_answer_id": 31214286, "answer_count": 2, "score": 6, "last_activity_date": 1435987900, "creation_date": 1435950478, "last_edit_date": 1435958579, "question_id": 31212928, "link": "https://stackoverflow.com/questions/31212928/is-there-a-generic-function-that-takes-a-data-structure-and-returns-all-ints-in", "title": "Is there a generic function that takes a data structure and returns all ints in it?", "body": "<p>I think the type signature would look like <code>f :: a -&gt; [Int]</code>\ninput data would look like <code>data NamedPoint = NamedPoint String Int Int</code></p>\n\n<pre><code>data Person = Name Int Int Int\n</code></pre>\n\n<p>and using it in the REPL would look like this:</p>\n\n<pre><code>&gt;&gt; let namedPoint = NamedPoint \"hey\" 1 2\n&gt;&gt; let tommy = Person \"Tommy\" 1 2 3\n&gt;&gt; f namedPoint\n&gt;&gt; [1,2] \n&gt;&gt; f Tommy\n&gt;&gt; [1,2,3]\n</code></pre>\n\n<p>I think this would be useful as an alternative to records for when you are too lazy to write getters for data with alot of parameters.  </p>\n"}, {"tags": ["haskell", "foldable"], "comments": [{"owner": {"reputation": 2846, "user_id": 4347335, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/eb7e6f293a134a5defec74e12cae42cc?s=128&d=identicon&r=PG&f=1", "display_name": "cchalmers", "link": "https://stackoverflow.com/users/4347335/cchalmers"}, "edited": false, "score": 4, "creation_date": 1435943749, "post_id": 31211384, "comment_id": 50424885, "body": "<a href=\"https://hackage.haskell.org/package/base-compat\" rel=\"nofollow noreferrer\">base-compat</a>"}, {"owner": {"reputation": 5412, "user_id": 1626632, "user_type": "registered", "accept_rate": 73, "profile_image": "https://www.gravatar.com/avatar/9a63a74d81c3e3abfb4a1ecb56fd3eff?s=128&d=identicon&r=PG", "display_name": "Helmut Grohne", "link": "https://stackoverflow.com/users/1626632/helmut-grohne"}, "reply_to_user": {"reputation": 2846, "user_id": 4347335, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/eb7e6f293a134a5defec74e12cae42cc?s=128&d=identicon&r=PG&f=1", "display_name": "cchalmers", "link": "https://stackoverflow.com/users/4347335/cchalmers"}, "edited": false, "score": 1, "creation_date": 1435944820, "post_id": 31211384, "comment_id": 50425330, "body": "Note that since <code>toList</code> becomes a method of <code>Foldable</code>, <code>base-compat</code> chooses to not define it and thus <code>toList</code> is missing in <code>Prelude.Compat</code> but available in a recent <code>Prelude</code>."}], "owner": {"reputation": 5412, "user_id": 1626632, "user_type": "registered", "accept_rate": 73, "profile_image": "https://www.gravatar.com/avatar/9a63a74d81c3e3abfb4a1ecb56fd3eff?s=128&d=identicon&r=PG", "display_name": "Helmut Grohne", "link": "https://stackoverflow.com/users/1626632/helmut-grohne"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 78, "favorite_count": 0, "answer_count": 0, "score": 2, "last_activity_date": 1435942389, "creation_date": 1435942389, "question_id": 31211384, "link": "https://stackoverflow.com/questions/31211384/emulate-burning-bridges-on-ghc-7-8", "title": "Emulate &quot;burning bridges&quot; on GHC 7.8", "body": "<p>Is there a simple way to emulate the burning bridges proposal (also called foldable/traversable proposal, part of <a href=\"https://ghc.haskell.org/trac/ghc/wiki/Prelude710\" rel=\"nofollow\">GHC 7.10</a>) on GHC 7.8 or possibly older?</p>\n\n<p>Some aspects are genuinely hard to emulate. This includes the changing in class hierarchies. Most likely, that part cannot be emulated.</p>\n\n<p>New functions and function replacements can simply be imported from <code>Data.Foldable</code> and friends. Yet, functions such as <code>length</code> or <code>null</code> are not available with the new type signatures. The following snippet achieves some aspects of pretending burning bridges:</p>\n\n<pre><code>import Prelude hiding (elem, foldr, length, maximum, null)\nimport Data.Foldable (Foldable, elem, foldMap, foldr, maximum, toList)\nimport Data.Traversable (Traversable, traverse)\n\nlength :: Foldable t =&gt; t a -&gt; Int -- will become a method of Foldable\nlength = Data.Foldable.foldl' (\\c _ -&gt; c + 1) 0\nnull :: Foldable t =&gt; t a -&gt; Bool -- will become a method of Foldable\nnull = foldr (\\_ _ -&gt; False) True\n</code></pre>\n\n<p>Is there some package that does this in a more complete way?</p>\n"}, {"tags": ["haskell", "opengl", "functional-programming"], "comments": [{"owner": {"reputation": 57219, "user_id": 33796, "user_type": "registered", "accept_rate": 70, "profile_image": "https://www.gravatar.com/avatar/08727b23ba62e634b32988cdff082663?s=128&d=identicon&r=PG", "display_name": "luqui", "link": "https://stackoverflow.com/users/33796/luqui"}, "edited": false, "score": 0, "creation_date": 1436037815, "post_id": 31210958, "comment_id": 50448600, "body": "Assuming <code>Vbo</code>s are allocated in <code>IO</code>, you will need to <code>unsafePerformIO</code> so you can generate the <code>Vbo</code> &quot;when&quot; the pure data structure is created.  You will have to make sure that the creation call is not actually made until the graphics stuff is initialized; laziness may just handle this for you."}, {"owner": {"reputation": 1593, "user_id": 2287402, "user_type": "registered", "accept_rate": 78, "profile_image": "https://i.stack.imgur.com/Q5Rvg.png?s=128&g=1", "display_name": "Elie G&#233;nard", "link": "https://stackoverflow.com/users/2287402/elie-g%c3%a9nard"}, "reply_to_user": {"reputation": 57219, "user_id": 33796, "user_type": "registered", "accept_rate": 70, "profile_image": "https://www.gravatar.com/avatar/08727b23ba62e634b32988cdff082663?s=128&d=identicon&r=PG", "display_name": "luqui", "link": "https://stackoverflow.com/users/33796/luqui"}, "edited": false, "score": 0, "creation_date": 1436515740, "post_id": 31210958, "comment_id": 50655812, "body": "Hi @luqui, I read things about <code>unsafePerformIO</code> but I&#39;m not sure how to use it. Can you be more specific?"}], "owner": {"reputation": 1593, "user_id": 2287402, "user_type": "registered", "accept_rate": 78, "profile_image": "https://i.stack.imgur.com/Q5Rvg.png?s=128&g=1", "display_name": "Elie G&#233;nard", "link": "https://stackoverflow.com/users/2287402/elie-g%c3%a9nard"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 98, "favorite_count": 0, "answer_count": 0, "score": 2, "last_activity_date": 1435940536, "creation_date": 1435940536, "question_id": 31210958, "link": "https://stackoverflow.com/questions/31210958/opengl-vao-initialization-in-haskell", "title": "OpenGL VAO initialization in Haskell", "body": "<p>I'm writing a kind of framework in Haskell. For now I'm just trying to draw a line on the screen with OpenGL. The idea is that the user just writes something like this:</p>\n\n<pre><code>module BBApp\n( app\n) where\n\nimport BB.Main\n\nline :: Polyline\nline = newPolyline\n\npoints :: [Point]\npoints = [Point 2 4 2, Point 89 3 78, Point 32 43 8]\n\nconstructLine :: Polyline -&gt; Polyline\nconstructLine line = addPoints points line\n\napp :: App \napp = do\n    draw . constructLine $ line\n</code></pre>\n\n<p>Then the <code>app</code> written by the user is called in an infinite loop in the main.</p>\n\n<p>The polyline is constructed like this:</p>\n\n<pre><code>data Polyline = Polyline { points :: [Point], vbo :: Vbo }\n\nnewPolyline :: Polyline\nnewPolyline = Polyline { points = [], vbo = newVbo }\n</code></pre>\n\n<p><code>newVbo</code> creates a new vertex array using <code>glGenVertexArrays</code> from <code>Graphics.Rendering.OpenGL.Raw</code>. My problem is that a new vertex array is generated at each iteration of the main loop.\nHow can I make my <code>Polyline</code> to be represented by a unique vertex array?</p>\n"}, {"tags": ["haskell", "cabal", "cabal-install"], "answers": [{"comments": [{"owner": {"reputation": 14485, "user_id": 190376, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/cd8280c5e1491b8cf55760750ed97dec?s=128&d=identicon&r=PG", "display_name": "Reid Barton", "link": "https://stackoverflow.com/users/190376/reid-barton"}, "edited": false, "score": 1, "creation_date": 1435941083, "post_id": 31210696, "comment_id": 50423763, "body": "It&#39;s also possible that the package would actually build fine against a newer version of base if only it didn&#39;t have a <code>base &lt; 4.5</code> constraint. OP can try adding <code>--allow-newer=base</code>."}], "tags": [], "owner": {"reputation": 7002, "user_id": 827593, "user_type": "registered", "accept_rate": 50, "profile_image": "https://www.gravatar.com/avatar/4d852cf0e1b0e4036e07754fc3925f46?s=128&d=identicon&r=PG", "display_name": "JP Moresmau", "link": "https://stackoverflow.com/users/827593/jp-moresmau"}, "is_accepted": false, "score": 3, "last_activity_date": 1435939330, "last_edit_date": 1495542664, "creation_date": 1435939330, "answer_id": 31210696, "question_id": 31210536, "link": "https://stackoverflow.com/questions/31210536/cabal-sandbox-uses-system-level-packages/31210696#31210696", "title": "cabal sandbox uses system level packages", "body": "<p>Cabal always use the global package database. Sandboxing only means you don't use the user package database. Presumably it's to make sure you have the base packages and ghc available.</p>\n\n<p>If you have a mismatch on base that means the package you try to install is not compatible with your version of GHC. I would avoid installing different versions of base.</p>\n\n<p>Related questions (without clear answers):</p>\n\n<p><a href=\"https://stackoverflow.com/questions/21587200/how-to-get-cabal-to-ignore-the-global-package-db-when-using-a-sandbox\">How to get cabal to ignore the global package DB when using a sandbox</a></p>\n\n<p><a href=\"https://stackoverflow.com/questions/30685248/cabal-sandbox-v-global-package-db\">cabal sandbox v. global package db</a></p>\n"}], "owner": {"user_type": "does_not_exist", "display_name": "user2879704"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 119, "favorite_count": 0, "answer_count": 1, "score": 2, "last_activity_date": 1435939330, "creation_date": 1435938741, "question_id": 31210536, "link": "https://stackoverflow.com/questions/31210536/cabal-sandbox-uses-system-level-packages", "title": "cabal sandbox uses system level packages", "body": "<p>I am trying to run a <a href=\"https://github.com/chrisdone/haskelldb-demo\" rel=\"nofollow\">haskelldb-demo</a></p>\n\n<pre><code>cabal sandbox init &amp;&amp; cabal install --only-dependencies\n</code></pre>\n\n<p>It needs <code>HDBC-postgresql-2.2.3.1</code> which needs base package version as <code>base&gt;=3 &amp;&amp; &lt;4.5</code>. My system has <code>base</code> pkg versioned 4.7+.</p>\n\n<p>I am using cabal sandbox but cabal install still refers to the base (v4.7.0.2)package from the global repository and rejects all versions of HDBC-postgresql</p>\n\n<pre><code>rejecting: HDBC-postgresql-2.2.3.1 (conflict: base==4.7.0.2/installed-bfd...,\nHDBC-postgresql =&gt; base&gt;=3 &amp;&amp; &lt;4.5)\n</code></pre>\n\n<p>why does cabal refer to the system level packages, inspite me making a sandbox?</p>\n"}, {"tags": ["sql", "haskell", "persistent"], "answers": [{"comments": [{"owner": {"reputation": 1489, "user_id": 2925659, "user_type": "registered", "accept_rate": 88, "profile_image": "https://i.stack.imgur.com/Ifwgn.jpg?s=128&g=1", "display_name": "ruben.moor", "link": "https://stackoverflow.com/users/2925659/ruben-moor"}, "edited": false, "score": 0, "creation_date": 1435939743, "post_id": 31210526, "comment_id": 50423201, "body": "if I don&#39;t use <code>getBy</code> but e.g. an esqueleto query, I typically use <code>entityVal</code> and drop the id ... I just didn&#39;t notice."}, {"owner": {"reputation": 1489, "user_id": 2925659, "user_type": "registered", "accept_rate": 88, "profile_image": "https://i.stack.imgur.com/Ifwgn.jpg?s=128&g=1", "display_name": "ruben.moor", "link": "https://stackoverflow.com/users/2925659/ruben-moor"}, "edited": false, "score": 4, "creation_date": 1435998921, "post_id": 31210526, "comment_id": 50437639, "body": "For completeness sake: <code>fromSqlKey . entityKey :: Entity record -&gt; Int64</code> on an entity retrieved from the database (e.g. <code>Entity foo</code>) gives the id."}], "tags": [], "owner": {"reputation": 7002, "user_id": 827593, "user_type": "registered", "accept_rate": 50, "profile_image": "https://www.gravatar.com/avatar/4d852cf0e1b0e4036e07754fc3925f46?s=128&d=identicon&r=PG", "display_name": "JP Moresmau", "link": "https://stackoverflow.com/users/827593/jp-moresmau"}, "is_accepted": true, "score": 6, "last_activity_date": 1435938710, "creation_date": 1435938710, "answer_id": 31210526, "question_id": 31209989, "link": "https://stackoverflow.com/questions/31209989/how-to-get-the-id-of-a-database-entity-with-persistent/31210526#31210526", "title": "How to get the id of a database entity with Persistent?", "body": "<p>A <code>Foo</code> by itself doesn't have an id, since <code>Foos</code> can exist outside of the database (before they are written). That's why a select operation for example gives you back a list of Entity, that contains both the key and the object.</p>\n\n<p>See <a href=\"http://hackage.haskell.org/package/persistent-2.2/docs/Database-Persist-Types.html#t:Entity\" rel=\"noreferrer\">http://hackage.haskell.org/package/persistent-2.2/docs/Database-Persist-Types.html#t:Entity</a></p>\n\n<p>For example, see the yesod book (<a href=\"http://www.yesodweb.com/book/persistent\" rel=\"noreferrer\">http://www.yesodweb.com/book/persistent</a>) on fetching from a primary key constraint:</p>\n\n<pre><code>personId &lt;- insert $ Person \"Michael\" \"Snoyman\" 26\nmaybePerson &lt;- getBy $ PersonName \"Michael\" \"Snoyman\"\ncase maybePerson of\n    Nothing -&gt; liftIO $ putStrLn \"Just kidding, not really there\"\n    Just (Entity personId person) -&gt; liftIO $ print person\n</code></pre>\n\n<p>the return type of getBy is an Entity wrapping both the key (<code>personId</code>) and the value (<code>person</code>).</p>\n"}], "owner": {"reputation": 1489, "user_id": 2925659, "user_type": "registered", "accept_rate": 88, "profile_image": "https://i.stack.imgur.com/Ifwgn.jpg?s=128&g=1", "display_name": "ruben.moor", "link": "https://stackoverflow.com/users/2925659/ruben-moor"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 1966, "favorite_count": 1, "accepted_answer_id": 31210526, "answer_count": 1, "score": 6, "last_activity_date": 1435938710, "creation_date": 1435936636, "question_id": 31209989, "link": "https://stackoverflow.com/questions/31209989/how-to-get-the-id-of-a-database-entity-with-persistent", "title": "How to get the id of a database entity with Persistent?", "body": "<p>I have a database model, using Persistent like so</p>\n\n<pre><code>import           Database.Persist.TH (mkPersist, persistUpperCase,\n                                  share, sqlSettings)\n\nshare [mkPersist sqlSettings] [persistUpperCase|\nFoo\n    field1 Int\n    field2 Bool\n|]\n</code></pre>\n\n<p>And I am able to get an object <code>foo :: Foo</code> from the database. I can access the fields with <code>fooField1 foo :: Int</code> and <code>fooField2 foo :: Bool</code>. And because I use <code>sqlSettings</code>, I know there is an <code>Int64</code>-representation of a database key the \"id\" stored with every entity. E.g. when I use <code>get . toSqlKey :: Int64 -&gt; ...</code></p>\n\n<p>Given my <code>foo :: Foo</code>, how do I get the <code>id :: Int64</code>?</p>\n"}, {"tags": ["haskell"], "comments": [{"owner": {"reputation": 10320, "user_id": 453616, "user_type": "registered", "accept_rate": 88, "profile_image": "https://www.gravatar.com/avatar/f5c35ad8a6275273c50d1274fd549d84?s=128&d=identicon&r=PG", "display_name": "gspr", "link": "https://stackoverflow.com/users/453616/gspr"}, "edited": false, "score": 1, "creation_date": 1435933203, "post_id": 31208316, "comment_id": 50419740, "body": "It&#39;s probably also worth noting that if you want an <i>efficient</i> way of getting at the bit representation of these types, you may be barking up the wrong tree somewhere else. What do you want to do?"}], "answers": [{"comments": [{"owner": {"reputation": 11066, "user_id": 147057, "user_type": "registered", "accept_rate": 89, "profile_image": "https://www.gravatar.com/avatar/cf9d83a95db2460ccb18f311fa8a766c?s=128&d=identicon&r=PG", "display_name": "max taldykin", "link": "https://stackoverflow.com/users/147057/max-taldykin"}, "edited": false, "score": 1, "creation_date": 1435932459, "post_id": 31208575, "comment_id": 50419277, "body": "there is no need to use <code>Storable</code>, it is better to use <a href=\"https://hackage.haskell.org/package/base-4.8.0.0/docs/Data-Bits.html#v:bitSizeMaybe\" rel=\"nofollow noreferrer\"><code>Data.Bits.bitSizeMaybe</code></a>"}, {"owner": {"reputation": 10320, "user_id": 453616, "user_type": "registered", "accept_rate": 88, "profile_image": "https://www.gravatar.com/avatar/f5c35ad8a6275273c50d1274fd549d84?s=128&d=identicon&r=PG", "display_name": "gspr", "link": "https://stackoverflow.com/users/453616/gspr"}, "reply_to_user": {"reputation": 11066, "user_id": 147057, "user_type": "registered", "accept_rate": 89, "profile_image": "https://www.gravatar.com/avatar/cf9d83a95db2460ccb18f311fa8a766c?s=128&d=identicon&r=PG", "display_name": "max taldykin", "link": "https://stackoverflow.com/users/147057/max-taldykin"}, "edited": false, "score": 0, "creation_date": 1435932623, "post_id": 31208575, "comment_id": 50419370, "body": "@maxtaldykin: Ah, I didn&#39;t know. Thanks. I&#39;d still prefer <code>Storable</code> - it&#39;s been around for much longer than <code>bitSizeMaybe</code>. I also feel it&#39;s more appropriate for <code>bitList</code> to work with typeclasses than to return <code>Maybe [Bool]</code>."}, {"owner": {"reputation": 11066, "user_id": 147057, "user_type": "registered", "accept_rate": 89, "profile_image": "https://www.gravatar.com/avatar/cf9d83a95db2460ccb18f311fa8a766c?s=128&d=identicon&r=PG", "display_name": "max taldykin", "link": "https://stackoverflow.com/users/147057/max-taldykin"}, "edited": false, "score": 0, "creation_date": 1435934320, "post_id": 31208575, "comment_id": 50420433, "body": "using <code>Storable</code> prevents from getting bits of <code>Integer</code> because there is no <code>instance Storable Integer</code>"}, {"owner": {"reputation": 10320, "user_id": 453616, "user_type": "registered", "accept_rate": 88, "profile_image": "https://www.gravatar.com/avatar/f5c35ad8a6275273c50d1274fd549d84?s=128&d=identicon&r=PG", "display_name": "gspr", "link": "https://stackoverflow.com/users/453616/gspr"}, "reply_to_user": {"reputation": 11066, "user_id": 147057, "user_type": "registered", "accept_rate": 89, "profile_image": "https://www.gravatar.com/avatar/cf9d83a95db2460ccb18f311fa8a766c?s=128&d=identicon&r=PG", "display_name": "max taldykin", "link": "https://stackoverflow.com/users/147057/max-taldykin"}, "edited": false, "score": 0, "creation_date": 1435934905, "post_id": 31208575, "comment_id": 50420739, "body": "Sure, but the documentation for <code>bitSizeMaybe</code> says &quot;returns Nothing for types that do not have a fixed bitsize, like Integer&quot;, so it won&#39;t help :-)"}, {"owner": {"reputation": 11066, "user_id": 147057, "user_type": "registered", "accept_rate": 89, "profile_image": "https://www.gravatar.com/avatar/cf9d83a95db2460ccb18f311fa8a766c?s=128&d=identicon&r=PG", "display_name": "max taldykin", "link": "https://stackoverflow.com/users/147057/max-taldykin"}, "edited": false, "score": 0, "creation_date": 1435936661, "post_id": 31208575, "comment_id": 50421694, "body": "please see my answer, it is easy to handle <code>Nothing</code> and extract valid number of bits (which is infinite for <code>Integer</code>)."}, {"owner": {"reputation": 10320, "user_id": 453616, "user_type": "registered", "accept_rate": 88, "profile_image": "https://www.gravatar.com/avatar/f5c35ad8a6275273c50d1274fd549d84?s=128&d=identicon&r=PG", "display_name": "gspr", "link": "https://stackoverflow.com/users/453616/gspr"}, "reply_to_user": {"reputation": 11066, "user_id": 147057, "user_type": "registered", "accept_rate": 89, "profile_image": "https://www.gravatar.com/avatar/cf9d83a95db2460ccb18f311fa8a766c?s=128&d=identicon&r=PG", "display_name": "max taldykin", "link": "https://stackoverflow.com/users/147057/max-taldykin"}, "edited": false, "score": 0, "creation_date": 1435936732, "post_id": 31208575, "comment_id": 50421730, "body": "Oh, sorry, I misunderstood. My bad. I like your answer, then!"}], "tags": [], "owner": {"reputation": 10320, "user_id": 453616, "user_type": "registered", "accept_rate": 88, "profile_image": "https://www.gravatar.com/avatar/f5c35ad8a6275273c50d1274fd549d84?s=128&d=identicon&r=PG", "display_name": "gspr", "link": "https://stackoverflow.com/users/453616/gspr"}, "is_accepted": false, "score": 6, "last_activity_date": 1435932525, "last_edit_date": 1435932525, "creation_date": 1435931768, "answer_id": 31208575, "question_id": 31208316, "link": "https://stackoverflow.com/questions/31208316/convert-int-or-integer-to-word8-or-bit/31208575#31208575", "title": "Convert Int or Integer to [Word8] or [Bit]", "body": "<p>Both <code>Int</code> and <code>Integer</code> are instances of the <a href=\"http://hackage.haskell.org/package/base-4.8.0.0/docs/Data-Bits.html#t:Bits\" rel=\"nofollow\"><code>Bits</code></a> typeclass, so you can extract single bits at will using that class's functions.</p>\n\n<p>Since <code>Int</code> is also an instance of <a href=\"http://hackage.haskell.org/package/base-4.8.0.0/docs/Foreign-Storable.html#t:Storable\" rel=\"nofollow\"><code>Storable</code></a>, you can get its size using <code>sizeOf</code>. An (inefficient) implementation of what you want for <code>Int</code>, and other types that are instances of both <code>Bits</code> and <code>Storable</code>, is thus:</p>\n\n<pre><code>import Foreign.Storable\nimport Data.Bits\n\nbitList :: (Storable a, Bits a) =&gt; a -&gt; [Bool]\nbitList x = map (testBit x) [0..8*(sizeOf x)-1]\n</code></pre>\n\n<p>This gives for example</p>\n\n<pre><code>bitList (0 :: Int) == [False,False,False,False,False,False,False,False,False,False,False,False,False,False,False,False,False,False,False,False,False,False,False,False,False,False,False,False,False,False,False,False,False,False,False,False,False,False,False,False,False,False,False,False,False,False,False,False,False,False,False,False,False,False,False,False,False,False,False,False,False,False,False,False]\nbitList (-1 :: Int) == [True,True,True,True,True,True,True,True,True,True,True,True,True,True,True,True,True,True,True,True,True,True,True,True,True,True,True,True,True,True,True,True,True,True,True,True,True,True,True,True,True,True,True,True,True,True,True,True,True,True,True,True,True,True,True,True,True,True,True,True,True,True,True,True]\nbitList (16 :: Word8) == [False,False,False,False,True,False,False,False]\nbitList (maxBound ::Word32) == [True,True,True,True,True,True,True,True,True,True,True,True,True,True,True,True,True,True,True,True,True,True,True,True,True,True,True,True,True,True,True,True]\n</code></pre>\n"}, {"comments": [{"owner": {"reputation": 21654, "user_id": 107331, "user_type": "registered", "accept_rate": 80, "profile_image": "https://www.gravatar.com/avatar/cf6d0868b2b4c69bac3e6f265a32b6a7?s=128&d=identicon&r=PG", "display_name": "Daniel Martin", "link": "https://stackoverflow.com/users/107331/daniel-martin"}, "edited": false, "score": 0, "creation_date": 1435932729, "post_id": 31208816, "comment_id": 50419442, "body": "The code in <code>cereal</code> only calls that on <code>Integer</code>s that it first calls <code>abs</code> on; no promises for what that code does with negative values."}], "tags": [], "owner": {"reputation": 21654, "user_id": 107331, "user_type": "registered", "accept_rate": 80, "profile_image": "https://www.gravatar.com/avatar/cf6d0868b2b4c69bac3e6f265a32b6a7?s=128&d=identicon&r=PG", "display_name": "Daniel Martin", "link": "https://stackoverflow.com/users/107331/daniel-martin"}, "is_accepted": false, "score": 2, "last_activity_date": 1435932538, "creation_date": 1435932538, "answer_id": 31208816, "question_id": 31208316, "link": "https://stackoverflow.com/questions/31208316/convert-int-or-integer-to-word8-or-bit/31208816#31208816", "title": "Convert Int or Integer to [Word8] or [Bit]", "body": "<p>Here are appropriate functions for doing that to an <code>Integer</code> ripped from the <a href=\"https://hackage.haskell.org/package/cereal-0.4.1.1/docs/src/Data-Serialize.html#unroll\" rel=\"nofollow\">innards of the cereal package</a>:</p>\n\n<pre><code>--\n-- Fold and unfold an Integer to and from a list of its bytes\n--\nunroll :: Integer -&gt; [Word8]\nunroll = unfoldr step\n  where\n    step 0 = Nothing\n    step i = Just (fromIntegral i, i `shiftR` 8)\n\nroll :: [Word8] -&gt; Integer\nroll   = foldr unstep 0\n  where\n    unstep b a = a `shiftL` 8 .|. fromIntegral b\n</code></pre>\n"}, {"comments": [{"owner": {"reputation": 5359, "user_id": 582917, "user_type": "registered", "accept_rate": 81, "profile_image": "https://www.gravatar.com/avatar/98a347823cd1db90af884b227a29c29e?s=128&d=identicon&r=PG", "display_name": "CMCDragonkai", "link": "https://stackoverflow.com/users/582917/cmcdragonkai"}, "edited": false, "score": 0, "creation_date": 1464680424, "post_id": 31209236, "comment_id": 62568750, "body": "When I pass a <code>Int</code> into it, and then run <code>length</code> on the result, I get 65. Shouldn&#39;t it be 64?"}, {"owner": {"reputation": 11066, "user_id": 147057, "user_type": "registered", "accept_rate": 89, "profile_image": "https://www.gravatar.com/avatar/cf9d83a95db2460ccb18f311fa8a766c?s=128&d=identicon&r=PG", "display_name": "max taldykin", "link": "https://stackoverflow.com/users/147057/max-taldykin"}, "reply_to_user": {"reputation": 5359, "user_id": 582917, "user_type": "registered", "accept_rate": 81, "profile_image": "https://www.gravatar.com/avatar/98a347823cd1db90af884b227a29c29e?s=128&d=identicon&r=PG", "display_name": "CMCDragonkai", "link": "https://stackoverflow.com/users/582917/cmcdragonkai"}, "edited": false, "score": 0, "creation_date": 1464682349, "post_id": 31209236, "comment_id": 62569924, "body": "That&#39;s a bug, thanks for noticing. Fixed by adding <code>subtract 1</code>."}], "tags": [], "owner": {"reputation": 11066, "user_id": 147057, "user_type": "registered", "accept_rate": 89, "profile_image": "https://www.gravatar.com/avatar/cf9d83a95db2460ccb18f311fa8a766c?s=128&d=identicon&r=PG", "display_name": "max taldykin", "link": "https://stackoverflow.com/users/147057/max-taldykin"}, "is_accepted": false, "score": 2, "last_activity_date": 1464682283, "last_edit_date": 1464682283, "creation_date": 1435933958, "answer_id": 31209236, "question_id": 31208316, "link": "https://stackoverflow.com/questions/31208316/convert-int-or-integer-to-word8-or-bit/31209236#31209236", "title": "Convert Int or Integer to [Word8] or [Bit]", "body": "<p>Another version of approach suggested by @gspr but without requiring <code>Storable</code> (and it supports <code>Integer</code>s as a bonus!):</p>\n\n<pre><code>import Data.Bits\n\nbitList :: Bits a =&gt; a -&gt; [Bool]\nbitList x =\n    [ testBit x i\n    | i &lt;- maybe [0..] (enumFromTo 0 . subtract 1) (bitSizeMaybe x)\n    ]\n</code></pre>\n\n<p>It correctly guesses sizes of ints and words, but beware it will give you infinite number of bits for <code>Integer</code>.</p>\n"}, {"tags": [], "owner": {"reputation": 5359, "user_id": 582917, "user_type": "registered", "accept_rate": 81, "profile_image": "https://www.gravatar.com/avatar/98a347823cd1db90af884b227a29c29e?s=128&d=identicon&r=PG", "display_name": "CMCDragonkai", "link": "https://stackoverflow.com/users/582917/cmcdragonkai"}, "is_accepted": false, "score": 0, "last_activity_date": 1464704492, "creation_date": 1464704492, "answer_id": 37548328, "question_id": 31208316, "link": "https://stackoverflow.com/questions/31208316/convert-int-or-integer-to-word8-or-bit/37548328#37548328", "title": "Convert Int or Integer to [Word8] or [Bit]", "body": "<p>I extended @max-taldykin by converting it to show the bits right to left, similar to how the bits are usually shown.</p>\n\n<pre><code>import Data.Bits (FiniteBits, finiteBitSize, testBit)\nimport Data.Int (Int32)\n\nbitList :: FiniteBits a =&gt; a -&gt; [Bool]\nbitList x = let size = finiteBitSize x\n            in [testBit x i | i &lt;- enumFromThenTo size (size - 1) 0]\n\nbitListToNum :: Num b =&gt; [Bool] -&gt; [b]\nbitListToNum = map (\\b -&gt; case b of { True -&gt; 1; False -&gt; 0 })\n\nmain = do \n    let listOfBits = bitList (65 :: Int32)\n    print $ bitListToNum listOfBits\n</code></pre>\n\n<p>Also provided a function to convert it to digits.</p>\n\n<p>Updated here: <a href=\"https://gist.github.com/a7f3ba5976accc113736f3b22929dddc\" rel=\"nofollow\">https://gist.github.com/a7f3ba5976accc113736f3b22929dddc</a></p>\n"}, {"tags": [], "owner": {"reputation": 1455, "user_id": 706882, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/1b8e621d3734b19dbb87061e1b9157e0?s=128&d=identicon&r=PG", "display_name": "sbditto85", "link": "https://stackoverflow.com/users/706882/sbditto85"}, "is_accepted": false, "score": 0, "last_activity_date": 1504293199, "creation_date": 1504293199, "answer_id": 46006646, "question_id": 31208316, "link": "https://stackoverflow.com/questions/31208316/convert-int-or-integer-to-word8-or-bit/46006646#46006646", "title": "Convert Int or Integer to [Word8] or [Bit]", "body": "<p>You can use <a href=\"https://hackage.haskell.org/package/vector-0.12.0.1/docs/Data-Vector-Storable.html\" rel=\"nofollow noreferrer\">Data.Vector.Storable</a> and <code>unsafeCast</code> to then convert it to another int type and then pull them out by index.</p>\n\n<pre><code>let w32 = 800 :: Int32\n    vec = singleton w32\n    vec' = unsafeCase vec :: Vector Word8\nin toList vec'\n</code></pre>\n\n<p>or something similar with <a href=\"https://hackage.haskell.org/package/base-4.10.0.0/docs/Foreign-Ptr.html\" rel=\"nofollow noreferrer\">Ptr</a> and stuff.</p>\n\n<p><strong>NOTE:</strong> as it suggests this is an unsafe action so verify the data as much as you can before hand.</p>\n"}], "owner": {"reputation": 2167, "user_id": 459877, "user_type": "registered", "accept_rate": 71, "profile_image": "https://i.stack.imgur.com/QdrXY.jpg?s=128&g=1", "display_name": "beta", "link": "https://stackoverflow.com/users/459877/beta"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 1093, "favorite_count": 1, "answer_count": 5, "score": 2, "last_activity_date": 1504293199, "creation_date": 1435930989, "question_id": 31208316, "link": "https://stackoverflow.com/questions/31208316/convert-int-or-integer-to-word8-or-bit", "title": "Convert Int or Integer to [Word8] or [Bit]", "body": "<p>Is there an efficient way to convert an <code>Int</code> (and preferably <code>Integer</code>) to a list of <code>Word8</code> or even a list of bits? {G,H}oogling for <code>Int -&gt; [Word8]</code> did not yield any promising results\u2026</p>\n"}, {"tags": ["haskell", "haskelldb"], "comments": [{"owner": {"reputation": 28845, "user_id": 238232, "user_type": "registered", "accept_rate": 99, "profile_image": "https://www.gravatar.com/avatar/ccda2293fc93c7a871956102004ac19d?s=128&d=identicon&r=PG", "display_name": "cnd", "link": "https://stackoverflow.com/users/238232/cnd"}, "edited": false, "score": 0, "creation_date": 1435929327, "post_id": 31207602, "comment_id": 50417218, "body": "not in <code>Database.HaskellDB</code> ?"}, {"owner": {"user_type": "does_not_exist", "display_name": "user2879704"}, "reply_to_user": {"reputation": 28845, "user_id": 238232, "user_type": "registered", "accept_rate": 99, "profile_image": "https://www.gravatar.com/avatar/ccda2293fc93c7a871956102004ac19d?s=128&d=identicon&r=PG", "display_name": "cnd", "link": "https://stackoverflow.com/users/238232/cnd"}, "edited": false, "score": 0, "creation_date": 1435929562, "post_id": 31207602, "comment_id": 50417357, "body": "import <code>Database.HaskellDB</code> solved it.. thanks, Heather... donno how you got it.."}], "answers": [{"tags": [], "owner": {"reputation": 28845, "user_id": 238232, "user_type": "registered", "accept_rate": 99, "profile_image": "https://www.gravatar.com/avatar/ccda2293fc93c7a871956102004ac19d?s=128&d=identicon&r=PG", "display_name": "cnd", "link": "https://stackoverflow.com/users/238232/cnd"}, "is_accepted": true, "score": 4, "last_activity_date": 1435930296, "creation_date": 1435930296, "answer_id": 31208076, "question_id": 31207602, "link": "https://stackoverflow.com/questions/31207602/haskelldb-database-variable-is-not-in-scope/31208076#31208076", "title": "HaskellDB - &#39;Database&#39; variable is not in scope", "body": "<blockquote>\n  <p>import Database.HaskellDB</p>\n</blockquote>\n\n<p><code>Database</code> defined there, it should help</p>\n\n<p>( <a href=\"https://github.com/m4dc4p/haskelldb/blob/master/src/Database/HaskellDB.hs#L68\" rel=\"nofollow\">https://github.com/m4dc4p/haskelldb/blob/master/src/Database/HaskellDB.hs#L68</a> )</p>\n"}], "owner": {"user_type": "does_not_exist", "display_name": "user2879704"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 186, "favorite_count": 0, "accepted_answer_id": 31208076, "answer_count": 1, "score": 3, "last_activity_date": 1435930296, "creation_date": 1435928762, "question_id": 31207602, "link": "https://stackoverflow.com/questions/31207602/haskelldb-database-variable-is-not-in-scope", "title": "HaskellDB - &#39;Database&#39; variable is not in scope", "body": "<p>I am trying to run this haskelldb hello world example,</p>\n\n<pre><code>module Caturday.Model.Connect where\n\nimport Database.HaskellDB.HDBC\nimport Database.HaskellDB.Sql.PostgreSQL\nimport Database.HDBC.PostgreSQL (connectPostgreSQL)\n\nwithDB :: [(String,String)] -&gt; (Database -&gt; IO a) -&gt; IO a\nwithDB opts = hdbcConnect generator (connectPostgreSQL conninfo)\n  where conninfo = unwords [ k ++ \"=\" ++ v | (k,v) &lt;- opts ]\n\nopts = [(\"host\",\"localhost\")\n       ,(\"user\",\"your_username\")\n       ,(\"password\",\"your_password\")\n       ,(\"dbname\",\"your_db_name\")]\n</code></pre>\n\n<p>This code is taken from the <a href=\"http://chrisdone.com/posts/haskelldb-tutorial\" rel=\"nofollow\">site</a>  </p>\n\n<p>On doing runhaskell db.hs, it throws error as,</p>\n\n<pre><code>db.hs:7:33: Not in scope: type constructor or class \u2018Database\u2019\n</code></pre>\n\n<p>And the line is,</p>\n\n<pre><code>withDB :: [(String,String)] -&gt; (Database -&gt; IO a) -&gt; IO a\n</code></pre>\n"}, {"tags": ["haskell", "shared-libraries", "ghc", "cabal", "haskell-stack"], "comments": [{"owner": {"reputation": 12058, "user_id": 205756, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/3c43a4d8967538063b38e41f4559a975?s=128&d=identicon&r=PG", "display_name": "alternative", "link": "https://stackoverflow.com/users/205756/alternative"}, "edited": false, "score": 1, "creation_date": 1436039889, "post_id": 31201161, "comment_id": 50449218, "body": "First you probably need to create a C-exported wrapper for the C++ api."}, {"owner": {"reputation": 440, "user_id": 4943325, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/O6XAD.png?s=128&g=1", "display_name": "Der Vogel", "link": "https://stackoverflow.com/users/4943325/der-vogel"}, "reply_to_user": {"reputation": 12058, "user_id": 205756, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/3c43a4d8967538063b38e41f4559a975?s=128&d=identicon&r=PG", "display_name": "alternative", "link": "https://stackoverflow.com/users/205756/alternative"}, "edited": false, "score": 0, "creation_date": 1436293696, "post_id": 31201161, "comment_id": 50546977, "body": "Isn&#39;t is possible to directly create the wrapper in Haskell? I mean, if I have to create a C wrapper and then a Haskell one, what&#39;s the point?"}, {"owner": {"reputation": 12058, "user_id": 205756, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/3c43a4d8967538063b38e41f4559a975?s=128&d=identicon&r=PG", "display_name": "alternative", "link": "https://stackoverflow.com/users/205756/alternative"}, "edited": false, "score": 1, "creation_date": 1436665032, "post_id": 31201161, "comment_id": 50707508, "body": "Naming conventions in C++ are much more complicated than in C. I don&#39;t think FFI supports the name mangling for non-extern-C things."}, {"owner": {"reputation": 3291, "user_id": 1456761, "user_type": "registered", "accept_rate": 97, "profile_image": "https://i.stack.imgur.com/gvNnG.png?s=128&g=1", "display_name": "Tobias Brandt", "link": "https://stackoverflow.com/users/1456761/tobias-brandt"}, "edited": false, "score": 4, "creation_date": 1438113793, "post_id": 31201161, "comment_id": 51313758, "body": "If you know the name-mangling scheme you can use <code>System.Win32.DLL</code> from the <code>Win32</code> package and <code>System.Posix.DynamicLinker</code> from the <code>unix</code> package. However, the name-mangling will probably differ between the two platforms, so you have to do the work twice. If you write a C wrapper, you only have to do it once."}, {"owner": {"reputation": 91026, "user_id": 131433, "user_type": "registered", "accept_rate": 76, "profile_image": "https://www.gravatar.com/avatar/e6eeaf8698180e971e169a925d8e0f4f?s=128&d=identicon&r=PG", "display_name": "bmargulies", "link": "https://stackoverflow.com/users/131433/bmargulies"}, "edited": false, "score": 2, "creation_date": 1451350016, "post_id": 31201161, "comment_id": 56747718, "body": "Just learn to love extern &quot;C&quot;{} in C++."}, {"owner": {"reputation": 94553, "user_id": 775806, "user_type": "registered", "accept_rate": 96, "profile_image": "https://i.stack.imgur.com/XNd2C.png?s=128&g=1", "display_name": "n. &#39;pronouns&#39; m.", "link": "https://stackoverflow.com/users/775806/n-pronouns-m"}, "edited": false, "score": 1, "creation_date": 1467613226, "post_id": 31201161, "comment_id": 63783020, "body": "You don&#39;t need to create any C wrapper. Necessary <code>extern &quot;C&quot;</code> is already in place (one would have a hard time creating the Python wrapper without it)."}], "answers": [{"comments": [{"owner": {"reputation": 103, "user_id": 2434815, "user_type": "registered", "accept_rate": 75, "profile_image": "https://i.stack.imgur.com/5L5Bq.jpg?s=128&g=1", "display_name": "Poniros", "link": "https://stackoverflow.com/users/2434815/poniros"}, "edited": false, "score": 0, "creation_date": 1612215786, "post_id": 38176871, "comment_id": 116692703, "body": "This is for exporting a haskell dll for use in other languages. OP&#39;s asking how to use a dll exported from C++ in a haskell program."}], "tags": [], "owner": {"reputation": 987, "user_id": 1895544, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/9810a079a08d263f69f513db10475659?s=128&d=identicon&r=PG", "display_name": "Philip Rollins", "link": "https://stackoverflow.com/users/1895544/philip-rollins"}, "is_accepted": false, "score": 0, "last_activity_date": 1467612084, "last_edit_date": 1467612084, "creation_date": 1467605716, "answer_id": 38176871, "question_id": 31201161, "link": "https://stackoverflow.com/questions/31201161/how-to-use-a-dll-in-a-haskell-project/38176871#38176871", "title": "How to use a DLL in a Haskell project?", "body": "<p>Answer from <a href=\"https://downloads.haskell.org/~ghc/7.0.3/docs/html/users_guide/win32-dlls.html\" rel=\"nofollow\">this documentation</a>:</p>\n\n<pre><code>ghc -c Adder.hs\nghc -c StartEnd.c\nghc -shared -o Adder.dll Adder.o Adder_stub.o StartEnd.o\n</code></pre>\n"}, {"tags": [], "owner": {"reputation": 455, "user_id": 2703165, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/2fe9e454e869a4e038b5feb52e1edb5f?s=128&d=identicon&r=PG&f=1", "display_name": "Simon Bourne", "link": "https://stackoverflow.com/users/2703165/simon-bourne"}, "is_accepted": false, "score": 2, "last_activity_date": 1467645324, "last_edit_date": 1495540055, "creation_date": 1467645324, "answer_id": 38187924, "question_id": 31201161, "link": "https://stackoverflow.com/questions/31201161/how-to-use-a-dll-in-a-haskell-project/38187924#38187924", "title": "How to use a DLL in a Haskell project?", "body": "<ol>\n<li><p>You'll need to use <code>extra-lib-dirs</code> and <code>extra-libraries</code> in the <code>executable</code> section of your <code>.cabal</code> file like so:</p>\n\n<pre><code>name:                 MyApp\nversion:              0.1.0.0\nsynopsis:\nhomepage:\nauthor:               simon.bourne\ncategory:\nbuild-type:           Simple\ncabal-version:        &gt;=1.10\n\nlibrary\n  exposed-modules:      HelloWorld\n  build-depends:        base &gt;= 4.7 &amp;&amp; &lt; 5\n  hs-source-dirs:       src\n  default-language:     Haskell2010\n\nexecutable MyApp\n  main-is:              Main.hs\n  extra-lib-dirs:       lib\n  extra-libraries:      helloWorld\n  build-depends:        base &gt;= 4.7 &amp;&amp; &lt; 5,\n                        MyApp\n  hs-source-dirs:       app\n\ndefault-language: Haskell2010\n</code></pre>\n\n<p>Put your dll and .so in <code>lib</code>. Be warned, you'll run into link order problems if you use a static library (<code>.a</code> instead of <code>.so</code>) on linux.</p>\n\n<p>See <a href=\"https://github.com/simon-bourne/HaskellFFILinkerProblem\" rel=\"nofollow noreferrer\">this</a> for an example. Don't be fooled by the name as it works fine with <code>.so</code> files.</p></li>\n<li><p><code>stack ghci</code> should just work provided it can find your library (<code>LD_LIBRARY_PATH</code> on linux).</p></li>\n<li><p>The C API (mentioned in the comments on your question) is already there. You just need to write the Haskell FFI signatures, for example:</p>\n\n<pre><code>foreign import ccall safe \"helloWorld\" c_helloWorld :: IO ()\n</code></pre>\n\n<p>I'd very strongly advise using <code>safe</code> ccalls, and don't wrap the functions in <code>unsafePerformIO</code>.</p>\n\n<p>If you need to pass non opaque structs, you might want to investigate <code>c2hs</code> or <code>hsc2hs</code>, but I don't think you'll need to. See this <a href=\"https://stackoverflow.com/questions/6009031/difference-between-hsc2hs-and-c2hs\">question</a> for more details.</p></li>\n</ol>\n"}, {"tags": [], "owner": {"reputation": 329, "user_id": 971883, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/ab5062317cc23f37e24ff80f0b6261e8?s=128&d=identicon&r=PG", "display_name": "Bet", "link": "https://stackoverflow.com/users/971883/bet"}, "is_accepted": false, "score": 1, "last_activity_date": 1468595060, "last_edit_date": 1495535323, "creation_date": 1468595060, "answer_id": 38399425, "question_id": 31201161, "link": "https://stackoverflow.com/questions/31201161/how-to-use-a-dll-in-a-haskell-project/38399425#38399425", "title": "How to use a DLL in a Haskell project?", "body": "<p>You need to create a C-exported wrapper for the C++ api and Haskell wrapper to FFI to C-exported wrapper.</p>\n\n<p>Marshaling between C# and Haskell described here:\n<a href=\"https://stackoverflow.com/questions/16615641/calling-haskell-from-c-sharp\">Calling Haskell from C#</a></p>\n\n<p>but it very similar marshaling between C++ and Haskell</p>\n\n<p>For example, create C++ export function:</p>\n\n<pre><code>extern \"C\" __declspec(dllexport) int __cdecl addFive(int number);\n\nextern \"C\" __declspec(dllexport) int __cdecl addFive(int number)\n{\n    return number + 5;\n}\n</code></pre>\n\n<p>In Haskell you need import code:</p>\n\n<pre><code>foreign import ccall \"addFive\" addFive :: Int -&gt; Int\n</code></pre>\n\n<p>Then you can use addFive in Haskell as typical Haskell-function</p>\n\n<p>For compbound data types (classes and structures) you need create C++ data-type analog in Haskell. Then you need describe how marshal data types from C++ to Haskell and from Haskell to C++.</p>\n\n<p>In Haskell it means that you need create Storable instance for you data types.</p>\n"}], "owner": {"reputation": 440, "user_id": 4943325, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/O6XAD.png?s=128&g=1", "display_name": "Der Vogel", "link": "https://stackoverflow.com/users/4943325/der-vogel"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 1734, "favorite_count": 2, "answer_count": 3, "score": 44, "last_activity_date": 1468595060, "creation_date": 1435908889, "last_edit_date": 1450107138, "question_id": 31201161, "link": "https://stackoverflow.com/questions/31201161/how-to-use-a-dll-in-a-haskell-project", "title": "How to use a DLL in a Haskell project?", "body": "<p>I would like to use an external library, <a href=\"http://www.cs.ox.ac.uk/isg/tools/RDFox/\">RDFox</a>, in a Haskell project. </p>\n\n<p><strong>Context:</strong> I am working on Windows and Linux, both 64 bits, using GHC\u00a07.10 and <a href=\"https://github.com/commercialhaskell/stack\">stack</a>. RDFox is programmed in C++. RDFox shared libraries (.dll, .so) can be downloaded with Java and Python wrappers.</p>\n\n<p><strong>Aim:</strong> I would like to reuse the compiled libraries from RDFox (.dll, .so) in my project in Haskell, so I need to create a Haskell wrapper for RDFox.</p>\n\n<p><strong>Issues:</strong> Being relatively new to Haskell, I have difficulty to know where to start. I found several pages about the subject (from the Haskell wiki and StackOverflow), but the workflow and configuration are not clear to me.</p>\n\n<p><strong>Questions:</strong> I would like to know:</p>\n\n<blockquote>\n  <ol>\n  <li>How to configure stack and cabal to use external library, to build on Windows <em>or</em> Linux (different machines, same repository).</li>\n  <li>How to configure GHCi for interactive testing on this external library.</li>\n  <li>Is the translation of the Python wrapper to Haskell the best way to go? I would like to avoid the analysis of the RDFox C++ code.</li>\n  </ol>\n</blockquote>\n"}, {"tags": ["haskell", "scotty"], "comments": [{"owner": {"reputation": 3794, "user_id": 137871, "user_type": "registered", "accept_rate": 81, "profile_image": "https://www.gravatar.com/avatar/48469162d45686615c6bf0eb4304bf26?s=128&d=identicon&r=PG", "display_name": "insitu", "link": "https://stackoverflow.com/users/137871/insitu"}, "edited": false, "score": 0, "creation_date": 1435908457, "post_id": 31199923, "comment_id": 50404963, "body": "From <a href=\"https://github.com/scotty-web/scotty/blob/master/Web/Scotty/Action.hs\" rel=\"nofollow noreferrer\">scotty&#39;s source code</a> I can see I basically inlined the <code>text</code> function which I used previously..."}, {"owner": {"reputation": 3794, "user_id": 137871, "user_type": "registered", "accept_rate": 81, "profile_image": "https://www.gravatar.com/avatar/48469162d45686615c6bf0eb4304bf26?s=128&d=identicon&r=PG", "display_name": "insitu", "link": "https://stackoverflow.com/users/137871/insitu"}, "reply_to_user": {"reputation": 46235, "user_id": 2541573, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/Z1qtP.png?s=128&g=1", "display_name": "jub0bs", "link": "https://stackoverflow.com/users/2541573/jub0bs"}, "edited": false, "score": 0, "creation_date": 1435912108, "post_id": 31199923, "comment_id": 50406950, "body": "@Jubobs: thanks for taking care of my mistakes !"}, {"owner": {"reputation": 3794, "user_id": 137871, "user_type": "registered", "accept_rate": 81, "profile_image": "https://www.gravatar.com/avatar/48469162d45686615c6bf0eb4304bf26?s=128&d=identicon&r=PG", "display_name": "insitu", "link": "https://stackoverflow.com/users/137871/insitu"}, "edited": false, "score": 2, "creation_date": 1435934494, "post_id": 31199923, "comment_id": 50420537, "body": "The real problem is that I use lazy <code>Text</code> as result of <code>toCSV</code>: this leads to an explosion of memory used, mostly in <code>Data.Text.Lazy.Internal.Fusion</code> module. When I replace lazy text with strict text, memory consumption drops from 2GB to 40MB... I lose streaming of output in the process though. I might regain it if I handle manually transforming the list of objects to a CSV output."}, {"owner": {"reputation": 61, "user_id": 2749546, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/1751e83b850bf0ced44247df2f800cad?s=128&d=identicon&r=PG&f=1", "display_name": "kdkeyser", "link": "https://stackoverflow.com/users/2749546/kdkeyser"}, "edited": false, "score": 0, "creation_date": 1435945393, "post_id": 31199923, "comment_id": 50425558, "body": "Maybe conduit (or pipes) could be useful here, with a conduit that does the CSV transformation on individual objects? I&#39;ve had good experiences with large data transfers through a conduit/Warp server. Memory consumption was in the order of a couple of MB&#39;s, even with throughputs in the order of 1 GB/s"}, {"owner": {"reputation": 3794, "user_id": 137871, "user_type": "registered", "accept_rate": 81, "profile_image": "https://www.gravatar.com/avatar/48469162d45686615c6bf0eb4304bf26?s=128&d=identicon&r=PG", "display_name": "insitu", "link": "https://stackoverflow.com/users/137871/insitu"}, "reply_to_user": {"reputation": 61, "user_id": 2749546, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/1751e83b850bf0ced44247df2f800cad?s=128&d=identicon&r=PG&f=1", "display_name": "kdkeyser", "link": "https://stackoverflow.com/users/2749546/kdkeyser"}, "edited": false, "score": 0, "creation_date": 1435955022, "post_id": 31199923, "comment_id": 50428770, "body": "Yes, makes sense. But this means having a lazy structure which implies that I should delay the CSV transformation at the individual record level and stream that. Actually  I should make things in such a way that <code>toCSV as = map toCSV as</code>"}], "answers": [{"comments": [{"owner": {"reputation": 3794, "user_id": 137871, "user_type": "registered", "accept_rate": 81, "profile_image": "https://www.gravatar.com/avatar/48469162d45686615c6bf0eb4304bf26?s=128&d=identicon&r=PG", "display_name": "insitu", "link": "https://stackoverflow.com/users/137871/insitu"}, "edited": false, "score": 0, "creation_date": 1435913441, "post_id": 31202382, "comment_id": 50407632, "body": "Thanks. That&#39;s what I am trying to do (See my edited question) but it is still too eager. Maybe I need to do something to the headers in order to use chunked encoding output?"}, {"owner": {"reputation": 61, "user_id": 2749546, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/1751e83b850bf0ced44247df2f800cad?s=128&d=identicon&r=PG&f=1", "display_name": "kdkeyser", "link": "https://stackoverflow.com/users/2749546/kdkeyser"}, "reply_to_user": {"reputation": 3794, "user_id": 137871, "user_type": "registered", "accept_rate": 81, "profile_image": "https://www.gravatar.com/avatar/48469162d45686615c6bf0eb4304bf26?s=128&d=identicon&r=PG", "display_name": "insitu", "link": "https://stackoverflow.com/users/137871/insitu"}, "edited": false, "score": 0, "creation_date": 1435914800, "post_id": 31202382, "comment_id": 50408541, "body": "Chunked encoding should not be necessary. But I notice you only flush after you&#39;ve mapped over all of the chunks and called build on them. I would try to call flush after every build step, by moving the flush within the map."}, {"owner": {"reputation": 3794, "user_id": 137871, "user_type": "registered", "accept_rate": 81, "profile_image": "https://www.gravatar.com/avatar/48469162d45686615c6bf0eb4304bf26?s=128&d=identicon&r=PG", "display_name": "insitu", "link": "https://stackoverflow.com/users/137871/insitu"}, "edited": false, "score": 0, "creation_date": 1435915754, "post_id": 31202382, "comment_id": 50409116, "body": "Actually, doing flush once works because <code>send</code> function do send data: I can confirm this because I traced its execution (using simple <code>putStrLn</code>) and could see the output in the client."}], "tags": [], "owner": {"reputation": 61, "user_id": 2749546, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/1751e83b850bf0ced44247df2f800cad?s=128&d=identicon&r=PG&f=1", "display_name": "kdkeyser", "link": "https://stackoverflow.com/users/2749546/kdkeyser"}, "is_accepted": true, "score": 2, "last_activity_date": 1435912973, "creation_date": 1435912973, "answer_id": 31202382, "question_id": 31199923, "link": "https://stackoverflow.com/questions/31199923/how-do-i-prevent-scotty-from-eating-up-memory-for-large-text-output/31202382#31202382", "title": "How do I prevent scotty from eating up memory for large text output?", "body": "<p>Take a look at the <a href=\"https://hackage.haskell.org/package/scotty-0.10.1/docs/Web-Scotty-Trans.html#v:stream\" rel=\"nofollow\" title=\"stream\">\"stream\"</a> function in Web.Scotty.Trans. It is made for the purpose of having finer grained control over the size of the data that is generated before it is flushed to the socket. </p>\n\n<p>You call it with a StreamingBody argument, which is in fact a function of the type (Builder -> IO ()) -> IO () -> IO ().</p>\n\n<p>So you write a function:</p>\n\n<pre><code>doMyStreaming send flush =\n...\n</code></pre>\n\n<p>in which you send and flush your data in pieces, and then call the stream function with doMyStreaming as argument instead of the call to \"raw\".</p>\n"}], "owner": {"reputation": 3794, "user_id": 137871, "user_type": "registered", "accept_rate": 81, "profile_image": "https://www.gravatar.com/avatar/48469162d45686615c6bf0eb4304bf26?s=128&d=identicon&r=PG", "display_name": "insitu", "link": "https://stackoverflow.com/users/137871/insitu"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 239, "favorite_count": 0, "accepted_answer_id": 31202382, "answer_count": 1, "score": 4, "last_activity_date": 1435919399, "creation_date": 1435904688, "last_edit_date": 1435919399, "question_id": 31199923, "link": "https://stackoverflow.com/questions/31199923/how-do-i-prevent-scotty-from-eating-up-memory-for-large-text-output", "title": "How do I prevent scotty from eating up memory for large text output?", "body": "<p>I have a Scotty/WAI application and one of the endpoints sends a large <code>Text</code> output built from a list of elements. Here is the relevant code:</p>\n\n<pre><code>  import Data.Text.Lazy as L\n  import Data.Text.Lazy.Encoding as E\n\n  class (Show csv) =&gt; ToCSV csv where\n    toCSV :: csv -&gt; L.Text\n    toCSV = pack . show\n\n  instance (ToCSV c) =&gt; ToCSV [c] where\n    toCSV []     = empty\n    toCSV (c:cs) = toCSV c &lt;&gt; \"\\n\" &lt;&gt; toCSV cs\n\n\n  get \"/api/transactions\" $ accept \"text/csv\" $ do\n    purp &lt;- selectPurpose\n    txs &lt;- allEntries &lt;$&gt; inWeb (listTransactions purp)\n    setHeader \"Content-Type\" \"text/csv\"\n    raw $ E.encodeUtf8 $ toCSV txs\n</code></pre>\n\n<p>As I understand <a href=\"http://hackage.haskell.org/package/scotty-0.10.1/docs/Web-Scotty.html\" rel=\"nofollow\">Scotty's documentation</a> the output should be lazily built and sent over the wire without the need to build the whole text/bytestring in memory. However this is not the behaviour that I observe: when I call this endpoint the server starts to eat up memory and I infer it is building the whole string, before sending it in one go.</p>\n\n<p>Am I missing something?</p>\n\n<p><em>Edit 1</em>:</p>\n\n<p>I have written a <code>doStream</code> function that's supposed to send chunks of resulting BS one by one:</p>\n\n<pre><code>doStream :: Text -&gt; W.StreamingBody   \ndoStream t build flush = do\n  let bs = E.encodeUtf8 t\n  mapM_ (\\ chunk -&gt; build (B.fromByteString chunk)) (BS.toChunks bs)\n  flush\n</code></pre>\n\n<p>but actually it still builds the whole output in memory... </p>\n\n<p><em>Edit 2</em>:</p>\n\n<p>Actually, streaming this way works fine. The server process still eats up a lot of memory though, which might be actually garbage collectible upon sending each chunk. I will try to analyze memory usage more deeply to see where this consumption comes from. </p>\n\n<p><em>Edit 3</em>:</p>\n\n<p>I tried to limit heap to 2GB but this makes the process crash. Some memory is retained during the whole transformation process...</p>\n"}, {"tags": ["macos", "haskell", "rust", "ffi"], "comments": [{"owner": {"reputation": 163, "user_id": 5075794, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/1567b434ed6dfd5fe053b7280f659e01?s=128&d=identicon&r=PG&f=1", "display_name": "chalkandpaste", "link": "https://stackoverflow.com/users/5075794/chalkandpaste"}, "reply_to_user": {"reputation": 269529, "user_id": 155423, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/419218774d04a581476ea1887a0921e0?s=128&d=identicon&r=PG", "display_name": "Shepmaster", "link": "https://stackoverflow.com/users/155423/shepmaster"}, "edited": false, "score": 0, "creation_date": 1435938076, "post_id": 31196449, "comment_id": 50422453, "body": "Sorry about that. @Shepmaster --typo on my part, should be .c."}, {"owner": {"reputation": 163, "user_id": 5075794, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/1567b434ed6dfd5fe053b7280f659e01?s=128&d=identicon&r=PG&f=1", "display_name": "chalkandpaste", "link": "https://stackoverflow.com/users/5075794/chalkandpaste"}, "reply_to_user": {"reputation": 14485, "user_id": 190376, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/cd8280c5e1491b8cf55760750ed97dec?s=128&d=identicon&r=PG", "display_name": "Reid Barton", "link": "https://stackoverflow.com/users/190376/reid-barton"}, "edited": false, "score": 0, "creation_date": 1435938105, "post_id": 31196449, "comment_id": 50422464, "body": "@ReidBarton I cut down all the extraneous stuff. Focusing on compiling a dynamic library on my mac using Rust and Haskell."}], "answers": [{"comments": [{"owner": {"reputation": 163, "user_id": 5075794, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/1567b434ed6dfd5fe053b7280f659e01?s=128&d=identicon&r=PG&f=1", "display_name": "chalkandpaste", "link": "https://stackoverflow.com/users/5075794/chalkandpaste"}, "edited": false, "score": 0, "creation_date": 1435957784, "post_id": 31212434, "comment_id": 50429643, "body": "Thanks a bunch man. I realized the last night that I got the return type wrong--I had a build that somehow worked (I haven&#39;t been able to reproduce today) and got type unit/empty tuple returns, but couldn&#39;t figure out what allowed it to build (nothing in my terminal history allowed me to reproduce).  Again, much thanks @Shepmaster!"}], "tags": [], "owner": {"reputation": 269529, "user_id": 155423, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/419218774d04a581476ea1887a0921e0?s=128&d=identicon&r=PG", "display_name": "Shepmaster", "link": "https://stackoverflow.com/users/155423/shepmaster"}, "is_accepted": true, "score": 5, "last_activity_date": 1435947653, "creation_date": 1435947653, "answer_id": 31212434, "question_id": 31196449, "link": "https://stackoverflow.com/questions/31196449/calling-dynamically-linked-haskell-code-from-rust/31212434#31212434", "title": "Calling dynamically linked Haskell code from Rust", "body": "<p>When you compile your shared library, it looks like you need to link against <code>libffi</code> as well:</p>\n\n<pre><code>ghc -o libfibonacci.dylib -shared -dynamic -fPIC \\\n  Fibonacci.hs wrapper.c -lHSrts -lffi\n</code></pre>\n\n<p>I deduced this by going into my GHC library directory (<code>/usr/local/lib/ghc-7.10.1/rts</code>) and then grepping for the symbol <code>ffi_call</code>:</p>\n\n<pre><code>$ grep -lRa ffi_call .\n./include/ffi.h\n./rts/libHSrts-ghc7.10.1.dylib\n...\n</code></pre>\n\n<p>I then used <code>nm</code> to find which exact library had it:</p>\n\n<pre><code>for i in *dylib; do\n   if nm $i | grep -q 'T.*ffi_call'; then\n       echo \"== $i\";\n   fi;\ndone\n</code></pre>\n\n<p>I was then able to run with:</p>\n\n<pre><code>DYLD_LIBRARY_PATH='.' ./main\n</code></pre>\n\n<p>Unfortunately, it appears your code isn't quite right, as I just get a bunch of empty tuples. You forgot to have a return type on the function, and then you run into a problem that the 46th or so Fibbonacci is too big for a <code>u32</code>.</p>\n\n<p>Additionally, you should be using the types from the <code>libc</code> package, and it may be safest to use a <code>u64</code> here.</p>\n\n<p>I have installed GHC 7.10.1 using Homebrew, but hopefully the same pattern would work elsewhere.</p>\n"}, {"tags": [], "owner": {"reputation": 14485, "user_id": 190376, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/cd8280c5e1491b8cf55760750ed97dec?s=128&d=identicon&r=PG", "display_name": "Reid Barton", "link": "https://stackoverflow.com/users/190376/reid-barton"}, "is_accepted": false, "score": 5, "last_activity_date": 1435958577, "creation_date": 1435958577, "answer_id": 31214339, "question_id": 31196449, "link": "https://stackoverflow.com/questions/31196449/calling-dynamically-linked-haskell-code-from-rust/31214339#31214339", "title": "Calling dynamically linked Haskell code from Rust", "body": "<p>You mention two different final link commands,</p>\n\n<pre><code>ghc -o libfibonacci.so -shared -dynamic -fPIC Fibonacci.o wrapper.o -lHSrts\n</code></pre>\n\n<p>and</p>\n\n<pre><code>ghc -o libfibonacci.so -shared -static haskell/Fibonacci.o haskell/wrapper.o -lHSrts\n</code></pre>\n\n<p>It might be worth explicitly describing what some of these flags mean.</p>\n\n<ul>\n<li><p><code>-shared</code> tells ghc to produce a shared object (rather than an executable).</p></li>\n<li><p><code>-dynamic</code> tells ghc to link the output against the dynamic library versions of its Haskell dependencies (base, ghc-prim, etc.)</p></li>\n<li><p><code>-static</code> is the opposite of <code>-dynamic</code>, it tells ghc to link against the static library versions of Haskell dependencies.</p></li>\n<li><p><code>-lHSrts</code> means to link against the (static or shared) library libHSrts. <strong>But</strong> in GHC, only the static library actually has the basename libHSrts (so that the library file name is <code>libHSrts.a</code>). The shared library version has file name <code>libHSrts-ghc7.8.4.so</code> (adjust for your GHC version). So, <code>-lHSrts</code> really means to link against the static library version of the RTS.</p></li>\n</ul>\n\n<p>So the second command is linking against the static versions of all Haskell dependencies, including the RTS. This may work on OS X where all code must be generated as PIC, but it won't work on a normal Linux binary distribution of GHC because a shared library must be PIC code, but the static Haskell libraries shipped with GHC are built as non-PIC (they are intended to be linked into non-relocatable executables). I don't totally understand why GHC is not smart enough to add <code>-lffi</code> itself here, possibly it doesn't really expect this combination of options since it won't work on a normal Linux setup.</p>\n\n<p>The first command is odd, because you are linking statically against the RTS, but dynamically against all other Haskell dependencies. If you change the library name in the <code>-l</code> option to <code>-lHSrts-ghc7.8.4</code>, then things will Just Work on Linux, and probably everywhere else (other than Windows).</p>\n"}], "owner": {"reputation": 163, "user_id": 5075794, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/1567b434ed6dfd5fe053b7280f659e01?s=128&d=identicon&r=PG&f=1", "display_name": "chalkandpaste", "link": "https://stackoverflow.com/users/5075794/chalkandpaste"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 644, "favorite_count": 2, "accepted_answer_id": 31212434, "answer_count": 2, "score": 15, "last_activity_date": 1570017977, "creation_date": 1435881259, "last_edit_date": 1435947775, "question_id": 31196449, "link": "https://stackoverflow.com/questions/31196449/calling-dynamically-linked-haskell-code-from-rust", "title": "Calling dynamically linked Haskell code from Rust", "body": "<p>I'm trying to compile some Rust code with some Haskell code. I have a test system set up with a file, <code>Fibonacci.hs</code> with a function which computes fibonacci numbers in Haskell and exports the function as <code>fibonacci_hs</code> via Haskell's FFI (as here: <a href=\"https://github.com/nh2/haskell-from-python\" rel=\"noreferrer\">https://github.com/nh2/haskell-from-python</a>, though I'll copy and paste at the bottom), and in <code>wrapper.c</code> have defined the functions to export to be called for initializing and exiting Haskell's RTS. </p>\n\n<p>The code looks like this:</p>\n\n<pre><code>{- Fibonacci.hs -}\n{-# LANGUAGE ForeignFunctionInterface #-}\n\nmodule Fibonacci where\n\nimport Foreign.C.Types\n\nfibonacci :: Int -&gt; Int\nfibonacci n = fibs !! n\n    where fibs = 0 : 1 : zipWith (+) fibs (tail fibs)\n\nfibonacci_hs :: CInt -&gt; CInt\nfibonacci_hs = fromIntegral . fibonacci . fromIntegral\n\nforeign export ccall fibonacci_hs :: CInt -&gt; CInt\n</code></pre>\n\n<hr>\n\n<pre><code>// wrapper.c\n\n#include &lt;stdlib.h&gt;\n#include \"HsFFI.h\"\n\nvoid\nexample_init (void)\n{\n  hs_init (NULL, NULL);\n}\n\nvoid\nexample_exit (void)\n{\n  hs_exit ();\n}\n</code></pre>\n\n<p>I compile these via:</p>\n\n<p><code>ghc -c -dynamic -fPIC Fibonacci.hs</code></p>\n\n<p><code>ghc -c -dynamic -fPIC wrapper.c</code></p>\n\n<p>and I link the objects into a shared/dynamic library (more on this in a second) via:</p>\n\n<p><code>ghc -o libfibonacci.so -shared -dynamic -fPIC Fibonacci.o wrapper.o -lHSrts</code></p>\n\n<p>On running the Python example code from the linked repository, it runs just fine on my mac, but I can't get it to link with Rust.</p>\n\n<p>In Rust my code looks something like this:</p>\n\n<pre><code>//main.rs\n#[link(name = \"fibonacci\")]\nextern {\n    fn fibonacci_hs (n : i32); // c_int = i32\n    fn fib_init (); // start hs rts\n    fn fib_exit (); // kill hs rts\n}\n\nfn main () {\n    unsafe {\n        fib_init();\n        for i in 0..100 {\n            println!(\"{:?}th fibonacci : {:?}\", i, fibonacci_hs(i));\n        }\n        fib_exit();\n    }\n}\n</code></pre>\n\n<p>And I compile with <code>rustc main.rs -L .</code> (since shared library file is local).</p>\n\n<p>The error I generate on Mac, when compiled with a dynamic library (<code>ghc -o libfibonacci.so -shared -static haskell/Fibonacci.o haskell/wrapper.o -lHSrts</code> then 'rustc main.rs -L . ) is at runtime:</p>\n\n<pre><code>dyld: Symbol not found: _ffi_call\n  Referenced from: ./libfibonacci.so\n  Expected in: flat namespace\n in ./libfibonacci.so\nTrace/BPT trap: 5\n</code></pre>\n\n<p>Thanks for any help in advance.</p>\n"}, {"tags": ["haskell", "yesod"], "comments": [{"owner": {"reputation": 14485, "user_id": 190376, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/cd8280c5e1491b8cf55760750ed97dec?s=128&d=identicon&r=PG", "display_name": "Reid Barton", "link": "https://stackoverflow.com/users/190376/reid-barton"}, "edited": false, "score": 1, "creation_date": 1435899720, "post_id": 31195652, "comment_id": 50401356, "body": "The OverloadedStrings extension makes string <i>literals</i> overloaded. It doesn&#39;t actually make String and Text the same type."}, {"owner": {"reputation": 81, "user_id": 4337782, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/60PNy.jpg?s=128&g=1", "display_name": "Ehdrian", "link": "https://stackoverflow.com/users/4337782/ehdrian"}, "reply_to_user": {"reputation": 14485, "user_id": 190376, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/cd8280c5e1491b8cf55760750ed97dec?s=128&d=identicon&r=PG", "display_name": "Reid Barton", "link": "https://stackoverflow.com/users/190376/reid-barton"}, "edited": false, "score": 0, "creation_date": 1435936888, "post_id": 31195652, "comment_id": 50421818, "body": "Ya... I do realize that... The issue is that I&#39;m using code I lifted right out of a tutorial - and it works if I compile it separately . I think it has something to do with my imports."}], "answers": [{"comments": [{"owner": {"reputation": 81, "user_id": 4337782, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/60PNy.jpg?s=128&g=1", "display_name": "Ehdrian", "link": "https://stackoverflow.com/users/4337782/ehdrian"}, "edited": false, "score": 0, "creation_date": 1435936816, "post_id": 31196556, "comment_id": 50421772, "body": "Thanks I&#39;ll check that out - i&#39;m thinning out my imports right now and will see what i&#39;m actually doing with them ;)"}, {"owner": {"reputation": 81, "user_id": 4337782, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/60PNy.jpg?s=128&g=1", "display_name": "Ehdrian", "link": "https://stackoverflow.com/users/4337782/ehdrian"}, "edited": false, "score": 0, "creation_date": 1435939030, "post_id": 31196556, "comment_id": 50422902, "body": "Ive updated my code: removed classyprelude and put &lt;span&gt;#{y} in the shamlet instead of just #{y}.   I added/changed these imports: import Text.Blaze.Html.Renderer.Text (renderHtml) import Data.Text (Text, append, pack)  Now i get this: Couldn&#39;t match expected type \u2018Text\u2019                 with actual type \u2018Data.Text.Internal.Lazy.Text\u2019     NB: \u2018Text\u2019 is defined in \u2018Data.Text.Internal\u2019         \u2018Data.Text.Internal.Lazy.Text\u2019           is defined in \u2018Data.Text.Internal.Lazy\u2019     In the second argument of \u2018($)\u2019, namely       \u2018renderHtml"}, {"owner": {"reputation": 81, "user_id": 4337782, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/60PNy.jpg?s=128&g=1", "display_name": "Ehdrian", "link": "https://stackoverflow.com/users/4337782/ehdrian"}, "edited": false, "score": 0, "creation_date": 1435955652, "post_id": 31196556, "comment_id": 50428972, "body": "This put me on the right path.  I have a lot to learn about Haskell types.  The learning curve is much higher than C for me! :)"}], "tags": [], "owner": {"reputation": 30377, "user_id": 369198, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/71596bb1ca3ba3aa4400c3f407baec9f?s=128&d=identicon&r=PG", "display_name": "Michael Snoyman", "link": "https://stackoverflow.com/users/369198/michael-snoyman"}, "is_accepted": true, "score": 3, "last_activity_date": 1435882234, "creation_date": 1435882234, "answer_id": 31196556, "question_id": 31195652, "link": "https://stackoverflow.com/questions/31195652/haskell-noob-quasiquotes-overloadedstrings-in-yesod-not-working/31196556#31196556", "title": "Haskell Noob: QuasiQuotes OverloadedStrings in Yesod not Working?", "body": "<p>The putStrLn from ClassyPrelude takes a Text, not a String. The simplest solution would be to change the Renderer import to the Text version of the module.</p>\n"}], "owner": {"reputation": 81, "user_id": 4337782, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/60PNy.jpg?s=128&g=1", "display_name": "Ehdrian", "link": "https://stackoverflow.com/users/4337782/ehdrian"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 159, "favorite_count": 0, "accepted_answer_id": 31196556, "answer_count": 1, "score": 1, "last_activity_date": 1435882234, "creation_date": 1435875936, "last_edit_date": 1435876244, "question_id": 31195652, "link": "https://stackoverflow.com/questions/31195652/haskell-noob-quasiquotes-overloadedstrings-in-yesod-not-working", "title": "Haskell Noob: QuasiQuotes OverloadedStrings in Yesod not Working?", "body": "<p>I'm not sure why I cant get this working....</p>\n\n<p>I have QuasiQuotes and OverloadedStrings at the top of my hs file, at the top of main.hs, maindevel.hs and also declared in my foo.cabal file.</p>\n\n<p>The ERROR:</p>\n\n<pre><code>Couldn't match type \u2018[Char]\u2019 with \u2018Text\u2019\n    Expected type: Text\n    Actual type: String\nIn the second argument of \u2018($)\u2019, namely\n    \u2018renderHtml (GHC.Base.id (toHtml y))\u2019\nIn the expression:\n    putStrLn $ renderHtml (GHC.Base.id (toHtml y))\n</code></pre>\n\n<p>Code:</p>\n\n<pre><code>module Widgets.MainWidgets where\n{-# LANGUAGE GADTs #-}\n{-# LANGUAGE QuasiQuotes #-}                      \n{-# LANGUAGE TemplateHaskell #-}\n{-# LANGUAGE TypeFamilies #-}\n{-# LANGUAGE DeriveGeneric #-}\n{-# LANGUAGE OverloadedStrings, TypeSynonymInstances, FlexibleInstances #-}\nimport Import\n\nimport Text.Hamlet (shamlet)\nimport Text.Blaze.Html.Renderer.String (renderHtml)\nimport Data.Char (toLower)\nimport Data.List (sort)\nimport qualified Data.Text    as T\nimport qualified Data.Text.IO as T\n\nimport ClassyPrelude\nimport Yesod\nimport Data.Time.Clock\nimport Data.Time.Calendar\nimport Data.Time.LocalTime\nimport Data.Time.Format\n\ngetCurrYear :: String\ngetCurrYear = formatTime defaultTimeLocale \"%y\" getCurrentTime\n\ngetYear :: IO ()\ngetYear = putStrLn $ renderHtml\n    [shamlet|#{y}|]\n        where y = getCurrYear\n</code></pre>\n\n<p>I also have this in my foo.cabal file:</p>\n\n<pre><code>extensions: TemplateHaskell\n            QuasiQuotes\n            OverloadedStrings\n            NoImplicitPrelude\n            CPP\n            MultiParamTypeClasses\n            TypeFamilies\n            GADTs\n            GeneralizedNewtypeDeriving\n            FlexibleContexts\n            EmptyDataDecls\n            NoMonomorphismRestriction\n            DeriveDataTypeable\n            ViewPatterns\n            TupleSections\n            RecordWildCards\n            TypeSynonymInstances\n            FlexibleInstances\n            DeriveGeneric\n</code></pre>\n\n<p>Any idea why I get the String/Text conversion error?\nThanks in advance!\nAdrian</p>\n"}, {"tags": ["haskell", "functional-programming", "linear-algebra"], "comments": [{"owner": {"reputation": 57219, "user_id": 33796, "user_type": "registered", "accept_rate": 70, "profile_image": "https://www.gravatar.com/avatar/08727b23ba62e634b32988cdff082663?s=128&d=identicon&r=PG", "display_name": "luqui", "link": "https://stackoverflow.com/users/33796/luqui"}, "edited": false, "score": 2, "creation_date": 1435875732, "post_id": 31195556, "comment_id": 50395701, "body": "For a very elegant treatment of linear algebra in Haskell, read Conal Elliott&#39;s paper <a href=\"http://conal.net/papers/beautiful-differentiation/\" rel=\"nofollow noreferrer\">beautiful differentiation</a>"}], "answers": [{"comments": [{"owner": {"reputation": 44680, "user_id": 1031791, "user_type": "registered", "accept_rate": 54, "profile_image": "https://www.gravatar.com/avatar/fb710534fda446d2286074bb7692e65a?s=128&d=identicon&r=PG", "display_name": "MaiaVictor", "link": "https://stackoverflow.com/users/1031791/maiavictor"}, "edited": false, "score": 0, "creation_date": 1435878737, "post_id": 31195855, "comment_id": 50396598, "body": "I&#39;m not sure I understand what you said. The function receives two 2d arrays. It puts a copy of the second array on each element of the first (ho? / wouldn&#39;t that be a 4d array? and what happens with the element that was there?), then puts a copy of the first array on each element of the second (same). With the result (supposedly 3d, not 4d), it does element-wise multiplication (so, a zipWith). And then it collapses the extra dimension by summing. I think I get some of it, but I don&#39;t get the beginning nor how that is the same as matrix multiplication."}, {"owner": {"reputation": 126897, "user_id": 791604, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/ce991df7a056248d5e4f6fc3659ba733?s=128&d=identicon&r=PG", "display_name": "Daniel Wagner", "link": "https://stackoverflow.com/users/791604/daniel-wagner"}, "reply_to_user": {"reputation": 44680, "user_id": 1031791, "user_type": "registered", "accept_rate": 54, "profile_image": "https://www.gravatar.com/avatar/fb710534fda446d2286074bb7692e65a?s=128&d=identicon&r=PG", "display_name": "MaiaVictor", "link": "https://stackoverflow.com/users/1031791/maiavictor"}, "edited": false, "score": 2, "creation_date": 1435882986, "post_id": 31195855, "comment_id": 50397634, "body": "@Viclib Let&#39;s suppose the first array is <code>m x n</code> and the second is <code>n x p</code>. Then we make <code>p</code> copies of the first array to produce an <code>m x n x p</code> array, and <code>m</code> copies of the second array to produce an <code>m x n x p</code> array. (This is the part I believe you misunderstood.) Then (and these parts I believe you understood well) we zip those together with <code>*</code>, and collapse the middle <code>n</code> dimension by summing along it to produce an <code>m x p</code> array."}, {"owner": {"reputation": 44680, "user_id": 1031791, "user_type": "registered", "accept_rate": 54, "profile_image": "https://www.gravatar.com/avatar/fb710534fda446d2286074bb7692e65a?s=128&d=identicon&r=PG", "display_name": "MaiaVictor", "link": "https://stackoverflow.com/users/1031791/maiavictor"}, "edited": false, "score": 0, "creation_date": 1435891174, "post_id": 31195855, "comment_id": 50399316, "body": "But that implements matrix multiplication, I asked for... <i>looks at the title</i>. Oh. ... you... just take your \u2713."}, {"owner": {"reputation": 126897, "user_id": 791604, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/ce991df7a056248d5e4f6fc3659ba733?s=128&d=identicon&r=PG", "display_name": "Daniel Wagner", "link": "https://stackoverflow.com/users/791604/daniel-wagner"}, "reply_to_user": {"reputation": 44680, "user_id": 1031791, "user_type": "registered", "accept_rate": 54, "profile_image": "https://www.gravatar.com/avatar/fb710534fda446d2286074bb7692e65a?s=128&d=identicon&r=PG", "display_name": "MaiaVictor", "link": "https://stackoverflow.com/users/1031791/maiavictor"}, "edited": false, "score": 0, "creation_date": 1435893332, "post_id": 31195855, "comment_id": 50399738, "body": "@Viclib Oh no! I guess maybe I didn&#39;t read your question carefully enough to realize the bold part didn&#39;t fit the rest..."}], "tags": [], "owner": {"reputation": 126897, "user_id": 791604, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/ce991df7a056248d5e4f6fc3659ba733?s=128&d=identicon&r=PG", "display_name": "Daniel Wagner", "link": "https://stackoverflow.com/users/791604/daniel-wagner"}, "is_accepted": true, "score": 4, "last_activity_date": 1435877179, "creation_date": 1435877179, "answer_id": 31195855, "question_id": 31195556, "link": "https://stackoverflow.com/questions/31195556/elegant-implementation-of-n-dimensional-matrix-multiplication-using-lists/31195855#31195855", "title": "Elegant implementation of n-dimensional matrix multiplication using lists?", "body": "<p>It just so happens I have some code lying around for doing n-dimensional matrix operations which I thought was quite cute when I wrote it at least:</p>\n\n<pre><code>{-# LANGUAGE NoMonomorphismRestriction #-}\nmodule MultiArray where\n\nimport Control.Arrow\nimport Control.Monad\nimport Data.Ix\nimport Data.Maybe\n\nimport Data.Array (Array)\nimport qualified Data.Array as A\n\n-- {{{ from Dmwit.hs\ndeleteAt n   xs = take n xs ++ drop (n + 1) xs\ninsertAt n x xs = take n xs ++ x : drop n xs\n\ndoublify f g xs ys = f (uncurry g) (zip xs ys)\nany2 = doublify any\nall2 = doublify all\n-- }}}\n\n-- makes the most sense when ls and hs have the same length\ninstance Ix a =&gt; Ix [a] where\n    range     = sequence . map range . uncurry zip\n    inRange   = all2 inRange . uncurry zip\n    rangeSize = product . uncurry (zipWith (curry rangeSize))\n\n    index (ls, hs) xs = fst . foldr step (0, 1) $ zip indices sizes where\n        indices = zipWith index (zip ls hs) xs\n        sizes   = map rangeSize $ zip ls hs\n        step (i, b) (s, p) = (s + p * i, p * b)\n\nfold :: (Enum i, Ix i) =&gt; ([a] -&gt; b) -&gt; Int -&gt; Array [i] a -&gt; Array [i] b\nfold f n a = A.array newBound assocs where\n    (oldLowBound, oldHighBound) = A.bounds a\n    (newLowBoundBeg , dimLow : newLowBoundEnd ) = splitAt n oldLowBound\n    (newHighBoundBeg, dimHigh: newHighBoundEnd) = splitAt n oldHighBound\n    assocs   = [(beg ++ end, f [a A.! (beg ++ i : end) | i &lt;- [dimLow..dimHigh]])\n               | beg &lt;- range (newLowBoundBeg, newHighBoundBeg)\n               , end &lt;- range (newLowBoundEnd, newHighBoundEnd)\n               ]\n    newBound = (newLowBoundBeg ++ newLowBoundEnd, newHighBoundBeg ++ newHighBoundEnd)\n\nflatten a = check a &gt;&gt; return value where\n    check = guard . (1==) . length . fst . A.bounds\n    value = A.ixmap ((head *** head) . A.bounds $ a) return a\n\nelementWise :: (MonadPlus m, Ix i) =&gt; (a -&gt; b -&gt; c) -&gt; Array i a -&gt; Array i b -&gt; m (Array i c)\nelementWise f a b = check &gt;&gt; return value where\n    check = guard $ A.bounds a == A.bounds b\n    value = A.listArray (A.bounds a) (zipWith f (A.elems a) (A.elems b))\n\nunsafeFlatten       a   = fromJust $ flatten       a\nunsafeElementWise f a b = fromJust $ elementWise f a b\n\nmatrixMult a b = fold sum 1 $ unsafeElementWise (*) a' b' where\n    aBounds = (join (***) (!!0)) $ A.bounds a\n    bBounds = (join (***) (!!1)) $ A.bounds b\n    a' = copy 2 bBounds a\n    b' = copy 0 aBounds b\n\nbijection f g a = A.ixmap ((f *** f) . A.bounds $ a) g a\nunFlatten       = bijection return head\nmatrixTranspose = bijection reverse reverse\ncopy n (low, high) a = A.ixmap (newBounds a) (deleteAt n) a where\n    newBounds = (insertAt n low *** insertAt n high) . A.bounds\n</code></pre>\n\n<p>The cute bit here is <code>matrixMult</code>, which is one of the only operations that is specialized to two-dimensional arrays. It expands its first argument along one dimension (by putting a copy of the two-dimensional object into each slice of the three-dimensional object); expands its second along another; does pointwise multiplication (now in a three-dimensional array); then collapses the fabricated third dimension by summing. Quite nice.</p>\n"}], "owner": {"reputation": 44680, "user_id": 1031791, "user_type": "registered", "accept_rate": 54, "profile_image": "https://www.gravatar.com/avatar/fb710534fda446d2286074bb7692e65a?s=128&d=identicon&r=PG", "display_name": "MaiaVictor", "link": "https://stackoverflow.com/users/1031791/maiavictor"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 557, "favorite_count": 0, "accepted_answer_id": 31195855, "answer_count": 1, "score": 8, "last_activity_date": 1435891082, "creation_date": 1435875448, "last_edit_date": 1435891082, "question_id": 31195556, "link": "https://stackoverflow.com/questions/31195556/elegant-implementation-of-n-dimensional-matrix-multiplication-using-lists", "title": "Elegant implementation of n-dimensional matrix multiplication using lists?", "body": "<p>List functions allow us to implement arbitrarily-dimensional vector math quite elegantly. For example:</p>\n\n<pre><code>on   = (.) . (.)\nadd  = zipWith (+)\nsub  = zipWith (-)\nmul  = zipWith (*)\ndist = len `on` sub\ndot  = sum `on` mul\nlen  = sqrt . join dot\n</code></pre>\n\n<p>And so on.</p>\n\n<pre><code>main = print $ add [1,2,3] [1,1,1] -- [2,3,4]\nmain = print $ len [1,1,1]         -- 1.7320508075688772\nmain = print $ dot [2,0,0] [2,0,0] -- 4\n</code></pre>\n\n<p>Of course, this is not the most efficient solution, but is insightful to look at, as one can say <code>map</code>, <code>zipWith</code> and such generalize those vector operations. There is one function I couldn't implement elegantly, though - that is cross products. Since a possible n-dimensional generalization of cross products is the nd matrix determinant, <strong>how can I implement matrix multiplication elegantly?</strong></p>\n\n<p>Edit: yes, I asked a completely unrelated question to the problem I set up. Fml.</p>\n"}, {"tags": ["haskell", "gcc", "build", "ghc", "haskell-stack"], "comments": [{"owner": {"reputation": 2152, "user_id": 1103600, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/7830fb399137c319ff68dca3e3b6f7e2?s=128&d=identicon&r=PG", "display_name": "Arnon", "link": "https://stackoverflow.com/users/1103600/arnon"}, "edited": false, "score": 1, "creation_date": 1435904436, "post_id": 31194891, "comment_id": 50402925, "body": "Can I suggest you run this instead: <code>C:\\\\Users\\\\Razvan\\\\AppData\\\\Local\\\\Programs\\\\stack\\\\i386-win&zwnj;&#8203;dows\\\\ghc-7.8.4\\\\bin&zwnj;&#8203;\\\\runhaskell.exe -clear-package-db -package-db=C:\\Users\\Razvan\\AppData\\Roaming\\stack\\snapshots\\&zwnj;&#8203;i386-windows\\lts-2.1&zwnj;&#8203;3\\7.8.4\\pkgdb\\ -global-package-db -package=Cabal-1.18.1.5 C:\\Users\\Razvan\\AppData\\Local\\Temp\\stack124196\\Setup.hs --builddir=.stack-work\\dist\\i386-windows\\Cabal-1.18.1.5\\ build</code>  (I reordered the package settings for you)"}, {"owner": {"reputation": 20326, "user_id": 750216, "user_type": "registered", "accept_rate": 74, "profile_image": "https://www.gravatar.com/avatar/974fb481d985024715a6816dfbb9cebf?s=128&d=identicon&r=PG", "display_name": "R\u0103zvan Flavius Panda", "link": "https://stackoverflow.com/users/750216/r%c4%83zvan-flavius-panda"}, "reply_to_user": {"reputation": 2152, "user_id": 1103600, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/7830fb399137c319ff68dca3e3b6f7e2?s=128&d=identicon&r=PG", "display_name": "Arnon", "link": "https://stackoverflow.com/users/1103600/arnon"}, "edited": false, "score": 0, "creation_date": 1436039811, "post_id": 31194891, "comment_id": 50449198, "body": "@Arnon It outputs <code>ghc: can&#39;t find a package database at C:UsersRazvanAppDataRoamingstacksnapshotsi386-windowslts-2.1&zwnj;&#8203;37.8.4pkgdb -global-package-db</code> The lack of double backslash is probably the problem."}], "owner": {"reputation": 20326, "user_id": 750216, "user_type": "registered", "accept_rate": 74, "profile_image": "https://www.gravatar.com/avatar/974fb481d985024715a6816dfbb9cebf?s=128&d=identicon&r=PG", "display_name": "R\u0103zvan Flavius Panda", "link": "https://stackoverflow.com/users/750216/r%c4%83zvan-flavius-panda"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 497, "favorite_count": 0, "answer_count": 0, "score": 2, "last_activity_date": 1435872231, "creation_date": 1435872231, "question_id": 31194891, "link": "https://stackoverflow.com/questions/31194891/haskell-stack-build-error-ghc-exe-could-not-execute", "title": "Haskell Stack build error - ghc.exe: could not execute", "body": "<p>Getting following error when trying to <code>stack build</code> <a href=\"https://github.com/snowdriftcoop/snowdrift\" rel=\"nofollow\">snowdrift</a> on Windows:</p>\n\n<pre><code>Linking .stack-work\\dist\\i386-windows\\Cabal-1.18.1.5\\build\\SnowdriftEmailDaemon\\SnowdriftEmailDaemon.exe ...\nghc.exe: could not execute: C:\\Users\\Razvan\\AppData\\Local\\Programs\\stack\\i386-windows\\ghc-7.8.4\\lib/../mingw/bin/gcc.exe\nCompleted all 6 actions.\n\n--  While building package Snowdrift-0.1.4 using:\n      C:\\\\Users\\\\Razvan\\\\AppData\\\\Local\\\\Programs\\\\stack\\\\i386-windows\\\\ghc-7.8.4\\\\bin\\\\runhaskell.exe -package=Cabal-1.18.1.5 -clear-package-db -global-package-db -package-db=C:\\Users\\Razvan\\AppData\\Roaming\\stack\\snapshots\\i386-windows\\lts-2.13\\7.8.4\\pkgdb\\ C:\\Users\\Razvan\\AppData\\Local\\Temp\\stack124196\\Setup.hs --builddir=.stack-work\\dist\\i386-windows\\Cabal-1.18.1.5\\ build\n    Process exited with code: ExitFailure 1\n</code></pre>\n\n<p>My question is how to obtain more information on this error as it is quite vague. Looking under <code>.\\.stack-work\\logs</code> I can't find any snowdrift related log. It is almost like setting the stack verbosity level to debug does not affect ghc/gcc verbosity level or maybe extra error information is just not there.</p>\n\n<p>More information on the issue <a href=\"https://github.com/commercialhaskell/stack/issues/466\" rel=\"nofollow\">here</a>.</p>\n"}, {"tags": ["haskell"], "answers": [{"tags": [], "owner": {"reputation": 28873, "user_id": 1068232, "user_type": "registered", "accept_rate": 79, "profile_image": "https://www.gravatar.com/avatar/2a0a145ce58c20013969fe3f203531da?s=128&d=identicon&r=PG", "display_name": "Andr&#225;s Kov&#225;cs", "link": "https://stackoverflow.com/users/1068232/andr%c3%a1s-kov%c3%a1cs"}, "is_accepted": false, "score": 3, "last_activity_date": 1435855965, "creation_date": 1435855965, "answer_id": 31190427, "question_id": 31190048, "link": "https://stackoverflow.com/questions/31190048/accessing-bidimensional-newlistarray-in-haskell/31190427#31190427", "title": "accessing bidimensional newListArray in Haskell", "body": "<p><code>xa &lt;- nLA ((1,n),(1,n)) xs</code> creates an array with one element, since the lowest and highest indices are both <code>(1,n)</code>. Of course, <code>readArray xa (1, 1)</code> fails on your examples because  the <code>(1,1)</code> index isn't in the arrays. <code>nLA ((1,1),(1,n)) xs</code> makes more sense in this context.</p>\n"}, {"comments": [{"owner": {"reputation": 35, "user_id": 2385965, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/e205002cc9cc237ab2b16ca67f3246b9?s=128&d=identicon&r=PG", "display_name": "JC Saenz", "link": "https://stackoverflow.com/users/2385965/jc-saenz"}, "edited": false, "score": 0, "creation_date": 1435858037, "post_id": 31190609, "comment_id": 50386876, "body": "Thank you so much. About the semicolons and brackets you&#39;re right, it looks like I am trying to embed C into Haskell"}], "tags": [], "owner": {"reputation": 11066, "user_id": 147057, "user_type": "registered", "accept_rate": 89, "profile_image": "https://www.gravatar.com/avatar/cf9d83a95db2460ccb18f311fa8a766c?s=128&d=identicon&r=PG", "display_name": "max taldykin", "link": "https://stackoverflow.com/users/147057/max-taldykin"}, "is_accepted": true, "score": 2, "last_activity_date": 1435856922, "last_edit_date": 1435856922, "creation_date": 1435856602, "answer_id": 31190609, "question_id": 31190048, "link": "https://stackoverflow.com/questions/31190048/accessing-bidimensional-newlistarray-in-haskell/31190609#31190609", "title": "accessing bidimensional newListArray in Haskell", "body": "<p>In the first argument to <code>newListArray</code> you need to provide lowest and highest index in array. In your code you are providing <code>((1,n),(1,n))</code>. This means that lowest and highest indices are equal to <code>(1,n)</code>. Hence the result will be single-element array. And the index of that element will be <code>(1,n)</code>.</p>\n\n<p>The <code>Error in array index</code> is because you are trying to read element at index <code>(1,1)</code> but there is no such element in array.</p>\n\n<p>Your code will run without errors if <code>(1,n)</code> equals <code>(1,1)</code>. This will be the case only for single element <code>xs</code> (try <code>bs [123]</code>).</p>\n\n<p>If you really want two-dimensional array, you need to provide sizes of both dimensions. E.g.:</p>\n\n<pre><code>bs m n xs = runST $ nLa ((1,1), (m,n)) xs &gt;&gt;= getElems\n</code></pre>\n\n<p>But in this case you need <code>xs</code> to be of length m*n to fill that array.</p>\n\n<hr>\n\n<p>Btw, please don't use curly braces and semicolons in Haskell:</p>\n\n<pre><code>bs :: Ord a =&gt; [a] -&gt; [a] \nbs xs = runST $ do\n    let n = length xs\n    xa &lt;- nLA ((1,n),(1,n)) xs \n    readArray xa (1,1)\n    getElems xa\n</code></pre>\n"}], "owner": {"reputation": 35, "user_id": 2385965, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/e205002cc9cc237ab2b16ca67f3246b9?s=128&d=identicon&r=PG", "display_name": "JC Saenz", "link": "https://stackoverflow.com/users/2385965/jc-saenz"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 145, "favorite_count": 0, "accepted_answer_id": 31190609, "answer_count": 2, "score": 2, "last_activity_date": 1436197958, "creation_date": 1435854815, "last_edit_date": 1436197958, "question_id": 31190048, "link": "https://stackoverflow.com/questions/31190048/accessing-bidimensional-newlistarray-in-haskell", "title": "accessing bidimensional newListArray in Haskell", "body": "<p>The following Haskell code is compiled with no errors or warnings:</p>\n\n<pre><code>import Control.Monad.ST\nomport Data.Array.ST\n\nnLA :: (Ix i) =&gt; (i,i) -&gt; [e] -&gt; ST s ((STArray s) i e) \nnLA = newListArray \n\nbs :: (Ord a) =&gt; [a] -&gt; [a] \nbs xs = runST $ \n         do { xa &lt;- nLA ((1,n),(1,n)) xs; \n              readArray xa (1,1); \n              getElems xa} \n         where n = length xs \n</code></pre>\n\n<p>but GHCi complains when the input to function <code>bs</code> is </p>\n\n<pre><code>bs [((1,1),1),((1,2),2),((2,1),3),((2,2),4)]\n*** Exception: Error in array index\n</code></pre>\n\n<p>or the input </p>\n\n<pre><code>bs [(1,1),(2,2),(3,3),(4,4)]\n*** Exception: Error in array index\n</code></pre>\n\n<p>So, what is the correct way to access the values from the array <code>xa</code>?</p>\n"}, {"tags": ["haskell", "esqueleto"], "comments": [{"owner": {"reputation": 62421, "user_id": 216164, "user_type": "registered", "accept_rate": 89, "profile_image": "https://www.gravatar.com/avatar/786f224adbe0784cdf7d0f15476061fe?s=128&d=identicon&r=PG", "display_name": "Thomas M. DuBuisson", "link": "https://stackoverflow.com/users/216164/thomas-m-dubuisson"}, "edited": false, "score": 1, "creation_date": 1435852684, "post_id": 31188262, "comment_id": 50383770, "body": "Never having heard of the library, but looking at the types, I think <code>EntityField</code> if your data type, right?  So if you make it a functor then just <code>(fmap (fmap fromIntegral))</code>"}, {"owner": {"reputation": 295, "user_id": 3697018, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/c2d6d8638ac5ca493f849639e46202b4?s=128&d=identicon&r=PG&f=1", "display_name": "Joel Hermanns", "link": "https://stackoverflow.com/users/3697018/joel-hermanns"}, "reply_to_user": {"reputation": 62421, "user_id": 216164, "user_type": "registered", "accept_rate": 89, "profile_image": "https://www.gravatar.com/avatar/786f224adbe0784cdf7d0f15476061fe?s=128&d=identicon&r=PG", "display_name": "Thomas M. DuBuisson", "link": "https://stackoverflow.com/users/216164/thomas-m-dubuisson"}, "edited": false, "score": 0, "creation_date": 1435854031, "post_id": 31188262, "comment_id": 50384633, "body": "<a href=\"https://hackage.haskell.org/package/esqueleto\" rel=\"nofollow noreferrer\">esqueleto</a> builds on top of <a href=\"https://hackage.haskell.org/package/persistent\" rel=\"nofollow noreferrer\">persistent</a> where <a href=\"https://hackage.haskell.org/package/persistent-2.2/docs/Database-Persist-Class.html#t:EntityField\" rel=\"nofollow noreferrer\"><code>EntityField</code></a> comes from. I tried using <code>fmap</code> already. I&#39;ve tried your suggestion and I get (as earlier when using <code>fmap</code>): <code>No instance for (Functor SqlExpr) ...</code>. `<a href=\"http://hackage.haskell.org/package/esqueleto-2.2.7/docs/Database-Esqueleto.html#t:SqlExpr\" rel=\"nofollow noreferrer\">SqlExpr</a> is GADT defined in esqueleto and I don&#39;t know how to write that instance."}, {"owner": {"reputation": 62421, "user_id": 216164, "user_type": "registered", "accept_rate": 89, "profile_image": "https://www.gravatar.com/avatar/786f224adbe0784cdf7d0f15476061fe?s=128&d=identicon&r=PG", "display_name": "Thomas M. DuBuisson", "link": "https://stackoverflow.com/users/216164/thomas-m-dubuisson"}, "edited": false, "score": 0, "creation_date": 1435866459, "post_id": 31188262, "comment_id": 50391511, "body": "What is the code you tried with?"}, {"owner": {"reputation": 295, "user_id": 3697018, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/c2d6d8638ac5ca493f849639e46202b4?s=128&d=identicon&r=PG&f=1", "display_name": "Joel Hermanns", "link": "https://stackoverflow.com/users/3697018/joel-hermanns"}, "reply_to_user": {"reputation": 62421, "user_id": 216164, "user_type": "registered", "accept_rate": 89, "profile_image": "https://www.gravatar.com/avatar/786f224adbe0784cdf7d0f15476061fe?s=128&d=identicon&r=PG", "display_name": "Thomas M. DuBuisson", "link": "https://stackoverflow.com/users/216164/thomas-m-dubuisson"}, "edited": false, "score": 0, "creation_date": 1435903980, "post_id": 31188262, "comment_id": 50402727, "body": "Sorry, added the code to the post (should&#39;ve done that before) :)"}], "answers": [{"comments": [{"owner": {"reputation": 295, "user_id": 3697018, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/c2d6d8638ac5ca493f849639e46202b4?s=128&d=identicon&r=PG&f=1", "display_name": "Joel Hermanns", "link": "https://stackoverflow.com/users/3697018/joel-hermanns"}, "edited": false, "score": 1, "creation_date": 1435904139, "post_id": 31194313, "comment_id": 50402792, "body": "Awesome, that works! Although <code>floor_</code> is not supported by sqlite, which I use for development, similar functions like <code>round_</code> work pretty well. Looks like I just missed these functions when checking the docs. Thanks! However, I&#39;m also interested if there is a better solution."}], "tags": [], "owner": {"reputation": 100185, "user_id": 3234959, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/93bb12ca0f93dfddb33880316f7e66c2?s=128&d=identicon&r=PG&f=1", "display_name": "chi", "link": "https://stackoverflow.com/users/3234959/chi"}, "is_accepted": false, "score": 1, "last_activity_date": 1435869873, "creation_date": 1435869873, "answer_id": 31194313, "question_id": 31188262, "link": "https://stackoverflow.com/questions/31188262/multiplying-int-and-double-values-in-esqueleto/31194313#31194313", "title": "Multiplying Int and double values in esqueleto?", "body": "<p>I am not an expert, but you might try to apply <code>_floor</code> to your <strong>integer</strong> parameter:</p>\n\n<pre><code>floor_ :: (..., PersistField a, Num a, PersistField b, Num b)\n       =&gt; expr (Value a) -&gt; expr (Value b)\n</code></pre>\n\n<p>This might be able to turn your integer into a double, since <code>a</code> and <code>b</code> can be different. Usually you use it to turn doubles into integers, but it might also work the other way around.</p>\n\n<p>Some similar Esqueleto functions might work as well.</p>\n\n<p>And yes, this is a hack. I hope some expert can suggest a better solution.</p>\n"}, {"tags": [], "owner": {"reputation": 295, "user_id": 3697018, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/c2d6d8638ac5ca493f849639e46202b4?s=128&d=identicon&r=PG&f=1", "display_name": "Joel Hermanns", "link": "https://stackoverflow.com/users/3697018/joel-hermanns"}, "is_accepted": true, "score": 0, "last_activity_date": 1437023276, "creation_date": 1437023276, "answer_id": 31445726, "question_id": 31188262, "link": "https://stackoverflow.com/questions/31188262/multiplying-int-and-double-values-in-esqueleto/31445726#31445726", "title": "Multiplying Int and double values in esqueleto?", "body": "<p>As mentioned in the discussion <a href=\"https://groups.google.com/forum/#!topic/yesodweb/8e_P0uJ0jSA\" rel=\"nofollow\">here</a> there is now (since esqueleto version 2.2.9) <a href=\"https://hackage.haskell.org/package/esqueleto-2.2.9/docs/Database-Esqueleto.html#v:castNum\" rel=\"nofollow\">castNum</a> for this purpose:</p>\n\n<pre><code>castNum :: (Num a, Num b) =&gt; expr (Value a) -&gt; expr (Value b)\n</code></pre>\n"}], "owner": {"reputation": 295, "user_id": 3697018, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/c2d6d8638ac5ca493f849639e46202b4?s=128&d=identicon&r=PG&f=1", "display_name": "Joel Hermanns", "link": "https://stackoverflow.com/users/3697018/joel-hermanns"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 219, "favorite_count": 0, "accepted_answer_id": 31445726, "answer_count": 2, "score": 3, "last_activity_date": 1437023276, "creation_date": 1435849604, "last_edit_date": 1436542327, "question_id": 31188262, "link": "https://stackoverflow.com/questions/31188262/multiplying-int-and-double-values-in-esqueleto", "title": "Multiplying Int and double values in esqueleto?", "body": "<p>The problem I'm facing is pretty simple: Basically I'm trying to calculate the product of an Int and a Double. In plain Haskell I would just run</p>\n\n<pre><code>product = (fromIntegral int_val) * double_val\n</code></pre>\n\n<p>However I can't figure out how to do it in esqueleto. I'm having a table B that has a column \"amount\" of type Int and a table C that has a column \"price\" of type Double. When trying to extract both and calculate the product, like this</p>\n\n<pre><code>(b ^. BAmount) *. (c ^. CPrice) \n</code></pre>\n\n<p>I'm getting a type error (as expected):</p>\n\n<pre><code>Couldn't match type \u2018Double\u2019 with \u2018Int\u2019\nExpected type: EntityField Drink Int\n  Actual type: EntityField Drink Double\n</code></pre>\n\n<p>I couldn't find anything in the docs that helped me and I actually have no idea how to go on. (For more code see the full example below).</p>\n\n<p>Possible Solution: I could of course just store the price as an Int, but I'm interested if this can be done with esqueleto. </p>\n\n<p><strong>Full example</strong>:</p>\n\n<p>Database:</p>\n\n<p>Table A: Id|Name</p>\n\n<p>Table B: Id|AId|BId|Amount \nwhere Amount is an Int and AId and BId are references to Table A and B.</p>\n\n<p>Table C: Id|Name|Price ,\nhere is Price a Double</p>\n\n<p>The query I've written is as follows:</p>\n\n<pre><code>result &lt;- liftIO $ runDb $ select $\n            from $ \\(a, b, c) -&gt; do\n              where_ (a ^. AId ==. b ^. BAId)\n              where_ (b ^. BCId ==. c ^. CId)\n              let product = (b ^. BAmount) *. (c ^. CPrice)\n              let total = sum_ product :: SqlExpr (Value (Maybe Double))\n              groupBy $ a ^. AName\n              return (a ^. AName)\n</code></pre>\n\n<p><strong>EDIT</strong>:</p>\n\n<p>I've tried using <code>fmap</code> and <code>fromIntegral</code> like this:</p>\n\n<pre><code>let product = fmap fromIntegral (b ^. BAmount) *. (c ^. CPrice)\n</code></pre>\n\n<p>which results in two errors:\n<code>No instance for (Functor SqlExpr)</code>\nand\n<code>No instance for (Num (Value Double))</code></p>\n\n<p>As suggested in the comments (by @Thomas M. DuBuisson), I tried:</p>\n\n<pre><code>let product = fmap (fmap fromIntegral) (b ^. BAmount) *. (c ^. CPrice)\n</code></pre>\n\n<p>which solves the second problem, but I still get <code>No instance for (Functor SqlExpr)</code>.</p>\n\n<p><strong>EDIT 2</strong>:</p>\n\n<p>I've asked about this on the Yesod mailing list. The discussion can be found <a href=\"https://groups.google.com/forum/#!topic/yesodweb/8e_P0uJ0jSA\" rel=\"nofollow\">here</a>.</p>\n"}, {"tags": ["haskell"], "answers": [{"comments": [{"owner": {"reputation": 314, "user_id": 2032903, "user_type": "registered", "accept_rate": 86, "profile_image": "https://i.stack.imgur.com/0xnps.jpg?s=128&g=1", "display_name": "Robin", "link": "https://stackoverflow.com/users/2032903/robin"}, "edited": false, "score": 0, "creation_date": 1435849410, "post_id": 31187679, "comment_id": 50381421, "body": "Ha, I knew there is a Haskell way, thank you! Could you tell me as well why we require a Monad here?"}, {"owner": {"reputation": 24028, "user_id": 383200, "user_type": "registered", "accept_rate": 60, "profile_image": "https://www.gravatar.com/avatar/a9dc722f936cb1059adaae4fe39c07f0?s=128&d=identicon&r=PG", "display_name": "Carl", "link": "https://stackoverflow.com/users/383200/carl"}, "reply_to_user": {"reputation": 314, "user_id": 2032903, "user_type": "registered", "accept_rate": 86, "profile_image": "https://i.stack.imgur.com/0xnps.jpg?s=128&g=1", "display_name": "Robin", "link": "https://stackoverflow.com/users/2032903/robin"}, "edited": false, "score": 0, "creation_date": 1435849819, "post_id": 31187679, "comment_id": 50381703, "body": "@Robin Well, <code>[]</code> is already an instance of <code>Monad</code>. Hard to solve a list problem without lists. As for the import of <code>Control.Monad</code>, it&#39;s just because that&#39;s where <code>replicateM</code> is kept."}, {"owner": {"reputation": 314, "user_id": 2032903, "user_type": "registered", "accept_rate": 86, "profile_image": "https://i.stack.imgur.com/0xnps.jpg?s=128&g=1", "display_name": "Robin", "link": "https://stackoverflow.com/users/2032903/robin"}, "edited": false, "score": 1, "creation_date": 1435850951, "post_id": 31187679, "comment_id": 50382515, "body": "thank you. It seems I need to read some more chapters about Monads."}], "tags": [], "owner": {"reputation": 24028, "user_id": 383200, "user_type": "registered", "accept_rate": 60, "profile_image": "https://www.gravatar.com/avatar/a9dc722f936cb1059adaae4fe39c07f0?s=128&d=identicon&r=PG", "display_name": "Carl", "link": "https://stackoverflow.com/users/383200/carl"}, "is_accepted": true, "score": 7, "last_activity_date": 1435849597, "last_edit_date": 1435849597, "creation_date": 1435848216, "answer_id": 31187679, "question_id": 31187623, "link": "https://stackoverflow.com/questions/31187623/cartesian-product-resulting-in-list-of-list-of-fixed-length-the-haskell-way/31187679#31187679", "title": "Cartesian Product resulting in List of List of fixed length (the haskell way)", "body": "<p><code>sequence</code> works:</p>\n\n<pre><code>Prelude&gt; sequence (replicate 4 [1,0])\n[[1,1,1,1],[1,1,1,0],[1,1,0,1],[1,1,0,0],[1,0,1,1],[1,0,1,0],[1,0,0,1],[1,0,0,0],[0,1,1,1],[0,1,1,0],[0,1,0,1],[0,1,0,0],[0,0,1,1],[0,0,1,0],[0,0,0,1],[0,0,0,0]]\n</code></pre>\n\n<p>But the pairing of sequence and replicate already has a name:</p>\n\n<pre><code>Prelude&gt; import Control.Monad\nPrelude Control.Monad&gt; replicateM 4 [1,0]\n[[1,1,1,1],[1,1,1,0],[1,1,0,1],[1,1,0,0],[1,0,1,1],[1,0,1,0],[1,0,0,1],[1,0,0,0],[0,1,1,1],[0,1,1,0],[0,1,0,1],[0,1,0,0],[0,0,1,1],[0,0,1,0],[0,0,0,1],[0,0,0,0]]\n</code></pre>\n\n<p>Since <code>sequence</code> is doing all the interesting work, let's take a closer look at it.</p>\n\n<pre><code>sequence :: Monad m =&gt; [m a] -&gt; m [a]\nsequence [] = return []\nsequence (x:xs) = do\n    x'  &lt;- x\n    xs' &lt;- sequence xs\n    return (x':xs')\n</code></pre>\n\n<p>(There are shorter ways to write that, but this is the most straightforward.)</p>\n\n<p>It turns out <code>sequence</code> doesn't contain any of the interesting logic either.  That's the only obvious function with that type signature that uses the entirety of its argument. So the real magic must be in the <code>Monad</code> instance for <code>[]</code>, I guess.</p>\n\n<pre><code>instance Monad [] where\n    return x = [x]\n    xs &gt;&gt;= f = concatMap f xs\n</code></pre>\n\n<p>This just passes the buck to <code>concatMap</code> - but maybe it's starting to make more sense now..</p>\n\n<pre><code>concatMap :: (a -&gt; [b]) -&gt; [a] -&gt; [b]\nconcatMap _ [] = []\nconcatMap f (x:xs) = f x ++ concatMap f xs\n</code></pre>\n\n<p>I'm not sure how much all that helps, but it's worth keeping in mind.</p>\n\n<p>Possibly more helpful is to specialize the type signature of <code>sequence</code> to <code>m ~ []</code>:</p>\n\n<pre><code>sequence :: [[a]] -&gt; [[a]]\n</code></pre>\n\n<p>In this specific case, <code>sequence</code> might actually be better renamed to <code>sequences</code>. It creates all the sequences that consist of choosing one element from each inner list.</p>\n"}], "owner": {"reputation": 314, "user_id": 2032903, "user_type": "registered", "accept_rate": 86, "profile_image": "https://i.stack.imgur.com/0xnps.jpg?s=128&g=1", "display_name": "Robin", "link": "https://stackoverflow.com/users/2032903/robin"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 83, "favorite_count": 0, "accepted_answer_id": 31187679, "answer_count": 1, "score": 1, "last_activity_date": 1435849597, "creation_date": 1435848047, "last_edit_date": 1435849140, "question_id": 31187623, "link": "https://stackoverflow.com/questions/31187623/cartesian-product-resulting-in-list-of-list-of-fixed-length-the-haskell-way", "title": "Cartesian Product resulting in List of List of fixed length (the haskell way)", "body": "<p>I want to create a sequence of elements ([0, 1]) of fixed length (e.g. 4) such that it results in a list of lists of elements containing all combinations of [0,1].</p>\n\n<p>I solved it using an imperative programming approach:</p>\n\n<pre><code>Prelude &gt; let base = [1, 0]\nPrelude &gt; [[x0, x1, x2, x3] | x0 &lt;- base, x1 &lt;- base, x2 &lt;- base, x3 &lt;- base]\n[[1,1,1,1],[1,1,1,0],[1,1,0,1], ... [0,0,0,0]]\n</code></pre>\n\n<p>which I think is improvable.</p>\n\n<p>What is the idiomatic way of doing this?</p>\n"}, {"tags": ["haskell", "greedy"], "answers": [{"tags": [], "owner": {"reputation": 49959, "user_id": 866915, "user_type": "registered", "accept_rate": 70, "profile_image": "https://www.gravatar.com/avatar/09242131d6e17cbbe31e8547514da6e5?s=128&d=identicon&r=PG", "display_name": "ErikR", "link": "https://stackoverflow.com/users/866915/erikr"}, "is_accepted": true, "score": 3, "last_activity_date": 1435848767, "creation_date": 1435848767, "answer_id": 31187910, "question_id": 31187229, "link": "https://stackoverflow.com/questions/31187229/matroid-type-class-error-in-haskell/31187910#31187910", "title": "Matroid type class (error) in Haskell", "body": "<p>The error message is indicating that GHC doesn't know which <code>Matroid</code> instance you want for <code>weightedG</code>.</p>\n\n<p>It knows that you want a <code>Matroid WGraph a</code> for some type <code>a</code>, and you have\ndefined an instance <code>Matroid Graph Edge</code>, but since type classes are open there is no way for GHC conclude that <code>a</code> must be <code>Edge</code>. Later or in another module you (or someone else) could define a <code>Matroid WGraph String</code> instance - for instance.</p>\n\n<p>One way around this is to introduce a functional dependency between the matroid type and the element type like this:</p>\n\n<pre><code>{-# LANGUAGE FunctionalDependencies #-}\n\nclass Matroid matroid a | matroid -&gt; a where\n   ...\n</code></pre>\n\n<p>This tells GHC that the <code>matroid</code> type determines the edge type <code>a</code>. With this change I got your code to compile.</p>\n"}], "owner": {"reputation": 123, "user_id": 4458219, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/312a2bec07f730b53dcd3f445daccb78?s=128&d=identicon&r=PG", "display_name": "Richard Eager", "link": "https://stackoverflow.com/users/4458219/richard-eager"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 89, "favorite_count": 1, "accepted_answer_id": 31187910, "answer_count": 1, "score": 2, "last_activity_date": 1435848767, "creation_date": 1435847156, "last_edit_date": 1435848320, "question_id": 31187229, "link": "https://stackoverflow.com/questions/31187229/matroid-type-class-error-in-haskell", "title": "Matroid type class (error) in Haskell", "body": "<p>A finite matroid M is a pair (E, I), where E is a finite set (called the ground set) and I is a family of subsets of E (called independent sets).</p>\n\n<p>A weighted matroid is a matroid W equipped with a weight function w: E -> Int (positive integers).</p>\n\n<p>We can define a (weighted) matroid typeclass as follows:</p>\n\n<pre><code>{-# LANGUAGE FlexibleInstances #-}\n{-# LANGUAGE MultiParamTypeClasses #-}\n\nclass Matroid matroid a where\n  weight :: matroid -&gt; a -&gt; Int \n  groundSet :: matroid -&gt; [a]\n  indepSet :: [a] -&gt; Bool\n</code></pre>\n\n<p>We can then define various algorithms for matroids.  For example choosing a basis set F with minimal weight.  When applied to graphs, this is Kruskal's algorithm for finding a minimal weight spanning tree.</p>\n\n<p>An instance of a (weighted) matroid is a (weighted) graph G = (E, w) where E is a collection of edges, w is a weight function.  To define a matroid from a graph, we take the ground set to be the collection of edges E and a subset F of E is independent if and only if it is acyclic.</p>\n\n<pre><code>instance Matroid WGraph Edge where\n  weight = wT \n  groundSet = gSet\n  indepSet = iSet\n\ntype Vertex = Int\ntype Edge = (Vertex, Vertex)\ntype Graph = [Edge]\ntype WtFun = Edge -&gt; Int\ntype WGraph = (Graph, WtFun)\n\ngSet :: WGraph -&gt; [Edge]\ngSet (es,wt) = es \n\nwT :: WGraph -&gt; (WtFun)\nwT (es,wt) = wt\n-- stub\niSet :: [Edge] -&gt; Bool\niSet edges = True\n</code></pre>\n\n<p>However given a weighted graph, the following code has a type error </p>\n\n<pre><code>weightedG = (es, wt)::WGraph\nes = [(4,5),(6,7),(5,7)]::[Edge]\nwt :: (Edge -&gt; Int)\nwt (4,5) = 15\nwt (6,7) = 11\nwt (5,7) = 9\ngs = groundSet weightedG\n\nNo instance for (Matroid WGraph a0)\n  arising from a use of `groundSet'\nThe type variable `a0' is ambiguous\n</code></pre>\n\n<p>How can we specify that a0 should be an Edge type?</p>\n\n<p>Code for copy/paste:</p>\n\n<pre><code>{-# LANGUAGE FlexibleInstances #-}\n{-# LANGUAGE MultiParamTypeClasses #-}\n\nclass Matroid matroid a where\n  weight :: matroid -&gt; a -&gt; Int \n  groundSet :: matroid -&gt; [a]\n  indepSet :: [a] -&gt; Bool\n\ninstance Matroid WGraph Edge where\n  weight = wT \n  groundSet = gSet\n  indepSet = iSet\n\ntype Vertex = Int\ntype Edge = (Vertex, Vertex)\ntype Graph = [Edge]\ntype WtFun = Edge -&gt; Int\ntype WGraph = (Graph, WtFun)\n\ngSet :: WGraph -&gt; [Edge]\ngSet (es,wt) = es \n\nwT :: WGraph -&gt; (WtFun)\nwT (es,wt) = wt\n\n-- fix for real implementation\niSet :: [Edge] -&gt; Bool\niSet edges = True\n\nweightedG = (es, wt)::WGraph\nes = [(4,5),(6,7),(5,7)]::[Edge]\nwt :: (Edge -&gt; Int)\nwt (4,5) = 15\nwt (6,7) = 11\nwt (5,7) = 9\ngs = groundSet weightedG\n</code></pre>\n"}, {"tags": ["haskell", "pattern-matching"], "answers": [{"tags": [], "owner": {"reputation": 24266, "user_id": 946226, "user_type": "registered", "accept_rate": 59, "profile_image": "https://www.gravatar.com/avatar/5823d09208b1e4b63bbfcd189492032c?s=128&d=identicon&r=PG", "display_name": "Joachim Breitner", "link": "https://stackoverflow.com/users/946226/joachim-breitner"}, "is_accepted": true, "score": 11, "last_activity_date": 1435841345, "creation_date": 1435841345, "answer_id": 31185147, "question_id": 31184778, "link": "https://stackoverflow.com/questions/31184778/is-using-patterns-to-get-the-pattern-value-redundant/31185147#31185147", "title": "Is using @-patterns to get the pattern value redundant?", "body": "<p>One difference is that the original code is undefined for values constructed with <code>Atom</code>, i.e. there is no line</p>\n\n<pre><code>eval val@(Atom _) = val\n</code></pre>\n\n<p>And whether this is a copy\u2019n\u2019paste error or not, it highlights the important difference in style:</p>\n\n<p>The first style encourages you to think about each value individually, making an explicit assertion \u201cthis is the right equation for this\u201d. If you later add more constructors t othe <code>LispVal</code> type, you get runtime errors (or compiler warnings with <code>-fwarn-incomplete-patterns</code>, which is good practice).</p>\n\n<p>The second style asserts: <code>eval</code> will only have to look at <code>List</code> values, and all others can be treated individually. In particular, later additions to the data type should work just as well, and you don\u2019t want to be bothered about this function then.</p>\n\n<p>Operationally, they are equivalent.</p>\n"}], "owner": {"reputation": 10492, "user_id": 1351298, "user_type": "registered", "accept_rate": 79, "profile_image": "https://i.stack.imgur.com/KJKqs.jpg?s=128&g=1", "display_name": "Electric Coffee", "link": "https://stackoverflow.com/users/1351298/electric-coffee"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 108, "favorite_count": 1, "accepted_answer_id": 31185147, "answer_count": 1, "score": 4, "last_activity_date": 1435841345, "creation_date": 1435840324, "question_id": 31184778, "link": "https://stackoverflow.com/questions/31184778/is-using-patterns-to-get-the-pattern-value-redundant", "title": "Is using @-patterns to get the pattern value redundant?", "body": "<p>I'm going through <a href=\"https://en.wikibooks.org/wiki/Write_Yourself_a_Scheme_in_48_Hours\" rel=\"nofollow\">Write Yourself a Scheme in 48 Hours</a>, and in it I've come across some seemingly redundant code; they use @-patterns and then return the value itself, let me explain.</p>\n\n<p>Here's the relevant code:</p>\n\n<pre><code>data LispVal = Atom String\n             | List [LispVal]\n             | DottedList [LispVal] LispVal\n             | Number Integer\n             | String String\n             | Bool Bool\n\neval :: LispVal -&gt; LispVal -- code in question starts here\neval val@(String _) = val\neval val@(Number _) = val\neval val@(Bool _)   = val\neval (List [Atom \"quote\", val]) = val\n</code></pre>\n\n<p>It seems to me that the entire eval function could just as easily be re-written as</p>\n\n<pre><code>eval :: LispVal -&gt; LispVal\neval (List [Atom \"quote\", val]) = val\neval val = val\n</code></pre>\n\n<p>And have the bottom case account for all the @-patterns in the original code.</p>\n\n<p>Am I mistaken in thinking this, and is there an actual benefit of doing it the way they did? Or is the other way more concise?</p>\n"}, {"tags": ["haskell", "set-difference"], "comments": [{"owner": {"reputation": 22266, "user_id": 649287, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/7c0ea0055b84020bf860c05f53ba53d5?s=128&d=identicon&r=PG", "display_name": "augustss", "link": "https://stackoverflow.com/users/649287/augustss"}, "edited": false, "score": 0, "creation_date": 1435836901, "post_id": 31179907, "comment_id": 50372331, "body": "Maybe you should consider Data.IntSet."}, {"owner": {"reputation": 3516, "user_id": 4233758, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/zNTBC.jpg?s=128&g=1", "display_name": "Aleksandar", "link": "https://stackoverflow.com/users/4233758/aleksandar"}, "reply_to_user": {"reputation": 22266, "user_id": 649287, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/7c0ea0055b84020bf860c05f53ba53d5?s=128&d=identicon&r=PG", "display_name": "augustss", "link": "https://stackoverflow.com/users/649287/augustss"}, "edited": false, "score": 1, "creation_date": 1435855936, "post_id": 31179907, "comment_id": 50385703, "body": "The problem with the Set structure is that it does not hold repetition count. For instance if we have in the first list 4 ones, and in the second 2 ones. The set difference will be [1], as there are more ones in the first list, than in the other."}, {"owner": {"reputation": 126897, "user_id": 791604, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/ce991df7a056248d5e4f6fc3659ba733?s=128&d=identicon&r=PG", "display_name": "Daniel Wagner", "link": "https://stackoverflow.com/users/791604/daniel-wagner"}, "edited": false, "score": 1, "creation_date": 1435856372, "post_id": 31179907, "comment_id": 50385961, "body": "You seem to be against using library code, for some reason, but <a href=\"http://hackage.haskell.org/package/data-ordlist-0.4.7.0/docs/Data-List-Ordered.html\" rel=\"nofollow noreferrer\">Data.List.Ordered</a> has set- and bag-like operations on sorted lists, including <a href=\"http://hackage.haskell.org/package/data-ordlist-0.4.7.0/docs/Data-List-Ordered.html#v:minus\" rel=\"nofollow noreferrer\">minus</a>."}, {"owner": {"reputation": 3516, "user_id": 4233758, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/zNTBC.jpg?s=128&g=1", "display_name": "Aleksandar", "link": "https://stackoverflow.com/users/4233758/aleksandar"}, "edited": false, "score": 0, "creation_date": 1435859302, "post_id": 31179907, "comment_id": 50387579, "body": "This is part of a problem, published on a a competitive programming site, which does not include modules such as MultiSet and List.Ordered"}], "answers": [{"tags": [], "owner": {"reputation": 36513, "user_id": 752976, "user_type": "registered", "accept_rate": 84, "profile_image": "https://i.stack.imgur.com/j7Uis.jpg?s=128&g=1", "display_name": "Bartek Banachewicz", "link": "https://stackoverflow.com/users/752976/bartek-banachewicz"}, "is_accepted": true, "score": 6, "last_activity_date": 1435828361, "creation_date": 1435828361, "answer_id": 31180357, "question_id": 31179907, "link": "https://stackoverflow.com/questions/31179907/is-there-a-difference-ord-operator-on-lists-in-haskell/31180357#31180357", "title": "Is there a difference Ord operator on lists in haskell?", "body": "<blockquote>\n  <p>As integers are in ord group it can be done faster.</p>\n</blockquote>\n\n<p>Yes, but it requires building a sorted index. And that's pretty much what <code>Data.Multiset</code> is doing. You could of course write an operation that does that manually, but you'd be effectively reimplementing <code>Multiset</code> by then.</p>\n"}, {"tags": [], "owner": {"reputation": 3516, "user_id": 4233758, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/zNTBC.jpg?s=128&g=1", "display_name": "Aleksandar", "link": "https://stackoverflow.com/users/4233758/aleksandar"}, "is_accepted": false, "score": 1, "last_activity_date": 1435855843, "creation_date": 1435855843, "answer_id": 31190385, "question_id": 31179907, "link": "https://stackoverflow.com/questions/31179907/is-there-a-difference-ord-operator-on-lists-in-haskell/31190385#31190385", "title": "Is there a difference Ord operator on lists in haskell?", "body": "<p>As I could not use <code>Data.MultiSet</code> I needed to imeplement my own solution via lists, so I will post the solution.</p>\n\n<p>In order to get the set difference of two lists with repetitons, we first need to group the numbers together, to get the amount of repetitions of each number:</p>\n\n<pre><code>tupleGroup [] _ = []\ntupleGroup (hd:tl) (x, y) \n  | hd == x = (x, succ y) : tupleGroup tl (x, succ y)\n  | otherwise = (hd, 1) : tupleGroup tl (hd, 1)\n\ngroup' [] = []\ngroup' (hd:tl) = tupleGroup tl (hd, 1) \n</code></pre>\n\n<p>In order to call the helper function group' we first need to sort the list, as tupleGroup needs a sorted list.</p>\n\n<p>Next function is the difference function, in which we supply the grouped lists:</p>\n\n<pre><code>difference [] [] = []\ndifference (hd:tl)  [] = fst hd : difference tl []\ndifference [] (hd:tl) = []\ndifference (hd1:tl1) (hd2:tl2) \n  | x1 == x2 &amp;&amp; y1 &gt; y2 = x1 : difference tl1 tl2\n  | x1 == x2 = difference tl1 tl2\n  | x1 &lt; x2 = x1 : difference tl1 (hd2:tl2)\n  | otherwise = difference (hd1:tl1) tl2\n  where \n    x1 = fst hd1\n    x2 = fst hd2\n    y1 = snd hd1\n    y2 = snd hd2\n</code></pre>\n\n<p>The function will return a list of all numbers, which the repetition count is bigger in the first list, than in the second one.</p>\n"}], "owner": {"reputation": 3516, "user_id": 4233758, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/zNTBC.jpg?s=128&g=1", "display_name": "Aleksandar", "link": "https://stackoverflow.com/users/4233758/aleksandar"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 532, "favorite_count": 0, "accepted_answer_id": 31180357, "answer_count": 2, "score": 4, "last_activity_date": 1435859669, "creation_date": 1435827258, "last_edit_date": 1435859669, "question_id": 31179907, "link": "https://stackoverflow.com/questions/31179907/is-there-a-difference-ord-operator-on-lists-in-haskell", "title": "Is there a difference Ord operator on lists in haskell?", "body": "<p>I would like to do set difference between 2 integer lists, which allow repetitions in haskell.</p>\n\n<p>So in case of having <code>[1,2,1,4,3] [1,2,4]</code>, the difference would be <code>[1,3]</code></p>\n\n<p>Currently I can do it via the normal <code>\\\\</code> operator <code>listA \\\\ listB</code>.</p>\n\n<p>But the problem is this too slow. As integers are in ord group it can be done faster.</p>\n\n<p>I am aware of the <code>Data.Multiset</code> module, which would do it faster, but is there a native way to do it on lists without the <code>Data.Multiset</code> module?</p>\n"}, {"tags": ["haskell", "rethinkdb"], "comments": [{"owner": {"reputation": 5636, "user_id": 243581, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/c2d196ce09c988b9e2782f5a04a987aa?s=128&d=identicon&r=PG", "display_name": "AtnNn", "link": "https://stackoverflow.com/users/243581/atnnn"}, "edited": false, "score": 0, "creation_date": 1435828965, "post_id": 31177018, "comment_id": 50367041, "body": "Where is the runDB function from, and what is its type?"}, {"owner": {"reputation": 8143, "user_id": 1004369, "user_type": "registered", "accept_rate": 74, "profile_image": "https://www.gravatar.com/avatar/b7e385af406a6422cea353066baf068a?s=128&d=identicon&r=PG", "display_name": "r.sendecky", "link": "https://stackoverflow.com/users/1004369/r-sendecky"}, "reply_to_user": {"reputation": 5636, "user_id": 243581, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/c2d196ce09c988b9e2782f5a04a987aa?s=128&d=identicon&r=PG", "display_name": "AtnNn", "link": "https://stackoverflow.com/users/243581/atnnn"}, "edited": false, "score": 0, "creation_date": 1435829331, "post_id": 31177018, "comment_id": 50367327, "body": "Its return type is the same as &#39;run&#39; , it just wraps the DB connection and returns ReQL. I am sorry for not giving the type, i will add it as soon as I am home."}, {"owner": {"reputation": 11066, "user_id": 147057, "user_type": "registered", "accept_rate": 89, "profile_image": "https://www.gravatar.com/avatar/cf9d83a95db2460ccb18f311fa8a766c?s=128&d=identicon&r=PG", "display_name": "max taldykin", "link": "https://stackoverflow.com/users/147057/max-taldykin"}, "edited": false, "score": 0, "creation_date": 1435858780, "post_id": 31177018, "comment_id": 50387299, "body": "Are you sure <code>insert</code> will return an object with &quot;errors&quot; key? according to <a href=\"http://hackage.haskell.org/package/rethinkdb-2.0.0.0/docs/Database-RethinkDB.html#v:insert\" rel=\"nofollow noreferrer\">documentation</a> it returns <code>WriteResponse</code>."}, {"owner": {"reputation": 8143, "user_id": 1004369, "user_type": "registered", "accept_rate": 74, "profile_image": "https://www.gravatar.com/avatar/b7e385af406a6422cea353066baf068a?s=128&d=identicon&r=PG", "display_name": "r.sendecky", "link": "https://stackoverflow.com/users/1004369/r-sendecky"}, "edited": false, "score": 0, "creation_date": 1435899332, "post_id": 31177018, "comment_id": 50401251, "body": "Yeah, my bad. I was confused by GHCI output which complained about the ReQL mismatch."}], "answers": [{"comments": [{"owner": {"reputation": 8143, "user_id": 1004369, "user_type": "registered", "accept_rate": 74, "profile_image": "https://www.gravatar.com/avatar/b7e385af406a6422cea353066baf068a?s=128&d=identicon&r=PG", "display_name": "r.sendecky", "link": "https://stackoverflow.com/users/1004369/r-sendecky"}, "edited": false, "score": 0, "creation_date": 1435898274, "post_id": 31192795, "comment_id": 50400944, "body": "Thank you. I was confused by the GHCI output about the ReQL mismatch.  This particular example with response result works. Thank you. But, to be honest, I was hoping to get a more general answer here. I still would like  to understand ReQL to a Type conversion. I updated the question with another example. Thank you for helping."}, {"owner": {"reputation": 5636, "user_id": 243581, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/c2d196ce09c988b9e2782f5a04a987aa?s=128&d=identicon&r=PG", "display_name": "AtnNn", "link": "https://stackoverflow.com/users/243581/atnnn"}, "reply_to_user": {"reputation": 8143, "user_id": 1004369, "user_type": "registered", "accept_rate": 74, "profile_image": "https://www.gravatar.com/avatar/b7e385af406a6422cea353066baf068a?s=128&d=identicon&r=PG", "display_name": "r.sendecky", "link": "https://stackoverflow.com/users/1004369/r-sendecky"}, "edited": false, "score": 0, "creation_date": 1435951164, "post_id": 31192795, "comment_id": 50427477, "body": "If you have a value of type <i>ReQL</i>, use <i>run</i> to evaluate it and get an <i>Aeson.Value</i> back."}, {"owner": {"reputation": 8143, "user_id": 1004369, "user_type": "registered", "accept_rate": 74, "profile_image": "https://www.gravatar.com/avatar/b7e385af406a6422cea353066baf068a?s=128&d=identicon&r=PG", "display_name": "r.sendecky", "link": "https://stackoverflow.com/users/1004369/r-sendecky"}, "edited": false, "score": 0, "creation_date": 1435951680, "post_id": 31192795, "comment_id": 50427672, "body": "Thank you. That is exactly what I did. I think I finally got it."}], "tags": [], "owner": {"reputation": 5636, "user_id": 243581, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/c2d196ce09c988b9e2782f5a04a987aa?s=128&d=identicon&r=PG", "display_name": "AtnNn", "link": "https://stackoverflow.com/users/243581/atnnn"}, "is_accepted": true, "score": 2, "last_activity_date": 1435864399, "creation_date": 1435864399, "answer_id": 31192795, "question_id": 31177018, "link": "https://stackoverflow.com/questions/31177018/rethinkdb-convert-reql-to-an-integer-type/31192795#31192795", "title": "RethinkDB: convert ReQL to an Integer type", "body": "<p>You can use the <em>Result</em> instance for <a href=\"https://hackage.haskell.org/package/rethinkdb-1.16.0.0/docs/Database-RethinkDB.html#t:WriteResponse\" rel=\"nofollow\"><em>WriteResponse</em></a> following the example in the <a href=\"https://hackage.haskell.org/package/rethinkdb-1.16.0.0/docs/Database-RethinkDB.html#v:insert\" rel=\"nofollow\">docs for <em>insert</em></a></p>\n\n<pre><code>res &lt;- runDB $ table \"articles\" # insert doc\nif writeResponseErrors res == 0\n</code></pre>\n\n<p>The <em>R.!</em> operator is meant for constructing queries of type <em>ReQL</em>, not for examining results.</p>\n"}], "owner": {"reputation": 8143, "user_id": 1004369, "user_type": "registered", "accept_rate": 74, "profile_image": "https://www.gravatar.com/avatar/b7e385af406a6422cea353066baf068a?s=128&d=identicon&r=PG", "display_name": "r.sendecky", "link": "https://stackoverflow.com/users/1004369/r-sendecky"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 172, "favorite_count": 0, "accepted_answer_id": 31192795, "answer_count": 1, "score": 1, "last_activity_date": 1435899004, "creation_date": 1435818572, "last_edit_date": 1435899004, "question_id": 31177018, "link": "https://stackoverflow.com/questions/31177018/rethinkdb-convert-reql-to-an-integer-type", "title": "RethinkDB: convert ReQL to an Integer type", "body": "<p>Cannot figure out how to convert reql to a type</p>\n\n<p>I insert a document and get the result back which is an object with \"errors\" key. I simply need to see if it 0 or not?</p>\n\n<p>So a simple function like this:</p>\n\n<pre><code>savePerson :: Handler ()\nsavePerson = do\n  let load = fromJust . extract [\"data\", \"attributes\"]\n  doc &lt;- load &lt;$&gt; jsonBody'\n  res &lt;- runDB $ table \"articles\" # insert doc\n  if (res R.! \"errors\") == 0\n  then setStatus status204\n  else setStatus status500\n</code></pre>\n\n<p>This obveously does not compile but it gives the example of what I want.\nI need to convert reql to Integer for comparison.\nHow do I convert types from reql to haskell types?</p>\n\n<p>Thanks</p>\n\n<p><strong>EDIT</strong></p>\n\n<p>Apologies for not providing some data types.</p>\n\n<pre><code>import Web.Spock (runQuery)\nimport Database.RethinkDB.NoClash\n\n\nrunDB :: (Result a, Expr q) =&gt; q -&gt; Handler a\nrunDB act = runQuery $ \\hdl -&gt; run hdl act\n\nrunDB' :: Expr q =&gt; q -&gt; Handler Datum\nrunDB' act = runQuery $ \\hdl -&gt; run' hdl act\n</code></pre>\n\n<p><strong>EDIT2</strong></p>\n\n<p>Thank you <code>AtnNn</code> for the answer the first example works. But I still cannot figure out the ReQL conversion. It is my bad I cannot come up with a good example. I'll try another one.\nI simpy get some json, construct response json with <code>Aeson</code> and send it back removing the <code>id</code> attribute</p>\n\n<pre><code>fetchPerson :: Text -&gt; Handler ()\nfetchPerson oid = do\n  res &lt;- runDB' $ table \"articles\" # get (expr oid)\n  json $ object [\n    \"data\" .= [\n      \"type\" .= (\"articles\"::Text),\n      \"id\" .= oid,\n      \"attributes\" .= (res # without [\"id\"])\n      ]\n    ]\n</code></pre>\n\n<p>Now, <code>(res # without [\"id\"])</code> still gives me ReQL, right? And I need to convert it to a type that is <code>ToJSON</code> instance or <code>Aeson Value</code> type.\nHow do I do it? How do I generally convert ReQL to a haskell type?</p>\n\n<p>Thanks</p>\n"}, {"tags": ["haskell", "frp", "reactive-banana"], "comments": [{"owner": {"reputation": 25144, "user_id": 477476, "user_type": "registered", "accept_rate": 85, "profile_image": "https://i.stack.imgur.com/Qf4TT.png?s=128&g=1", "display_name": "Cactus", "link": "https://stackoverflow.com/users/477476/cactus"}, "edited": false, "score": 0, "creation_date": 1435809944, "post_id": 31175319, "comment_id": 50357941, "body": "Could you simply multiply your <code>[Entry]</code> with something else in its <code>accumB</code> that tells you the source of the last change? So you&#39;d get <code>([Entry], ReasonItChanged)</code> with some appropriate datatype <code>data ReasonItChanged = UserAdded | UserRemoved</code>."}, {"owner": {"reputation": 18999, "user_id": 825637, "user_type": "registered", "accept_rate": 85, "profile_image": "https://www.gravatar.com/avatar/825a58fde1ef99db42c5354dab6cd472?s=128&d=identicon&r=PG", "display_name": "MasterMastic", "link": "https://stackoverflow.com/users/825637/mastermastic"}, "reply_to_user": {"reputation": 25144, "user_id": 477476, "user_type": "registered", "accept_rate": 85, "profile_image": "https://i.stack.imgur.com/Qf4TT.png?s=128&g=1", "display_name": "Cactus", "link": "https://stackoverflow.com/users/477476/cactus"}, "edited": false, "score": 0, "creation_date": 1435812393, "post_id": 31175319, "comment_id": 50358565, "body": "@Cactus Err.. well I really wanted to avoid add that complexity, but if FRP/reactive-banana doesn&#39;t have a better way, I&#39;ll resort. I&#39;ll try it nevertheless. Thanks a lot."}, {"owner": {"reputation": 11009, "user_id": 403805, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/bcf3c21ce05cfb6788e25dcc3821b3c7?s=128&d=identicon&r=PG", "display_name": "Heinrich Apfelmus", "link": "https://stackoverflow.com/users/403805/heinrich-apfelmus"}, "edited": false, "score": 1, "creation_date": 1435826269, "post_id": 31175319, "comment_id": 50365102, "body": "Have you looked at the <a href=\"https://wiki.haskell.org/Reactive-banana/Examples#crud\" rel=\"nofollow noreferrer\">CRUD.hs</a> example? It deals with a similar situation. The idea is that currently selected item comes from two sources: User clicks in the list box, and changes from within the program. The easiest way to go about it is to treat the latter as &quot;suggestions&quot;, but the former as &quot;definitive&quot;."}], "answers": [{"tags": [], "owner": {"reputation": 18999, "user_id": 825637, "user_type": "registered", "accept_rate": 85, "profile_image": "https://www.gravatar.com/avatar/825a58fde1ef99db42c5354dab6cd472?s=128&d=identicon&r=PG", "display_name": "MasterMastic", "link": "https://stackoverflow.com/users/825637/mastermastic"}, "is_accepted": true, "score": 2, "last_activity_date": 1435816588, "creation_date": 1435816588, "answer_id": 31176576, "question_id": 31175319, "link": "https://stackoverflow.com/questions/31175319/how-to-know-what-made-a-behavior-change/31176576#31176576", "title": "How to know what made a behavior change?", "body": "<p>I gave Cactus's suggestion in the comments a try, and it turns out it couldn't been done (I'd have to bind <code>changes</code> in the middle of <code>let</code> block where the selection behavior, and the list behavior is, but they depend on each other).</p>\n\n<p>So I decided to start again from scratch but over-do it this time, and wrap the entire state in it's own data-type which the network will merely drive. So really all the network will do is call functions on the network according to events, and that's it. It turned out much superior imo, because there's no applicative-style mess, all the functionality is really just simple functions, and it's more modular (I could decide to just not use FRP at all for example, and the changes would be extremely minor -- just switch the firing with the functions; although I'd still have to find where to put the state, which would probably be something impure like <code>IORef</code>).</p>\n\n<p>It's so clean, it looks something similar to this:</p>\n\n<pre><code>data DbState = DbState Database SelectedItem LastAction Etc Etc\nemptyState :: DbState\nstateRemove, stateAdd :: DbState -&gt; DbState\n</code></pre>\n\n<p>and the behavior is just:</p>\n\n<pre><code>let bDb = accumB emptyState $ unions\n      [stateAdd &lt;$ eAddEntry\n      ,stateRemove &lt;$ eRemoveEntry\n      ]\n</code></pre>\n\n<p>Prior, I had length lines filled with lambdas, <code>&lt;$&gt;</code>, <code>&lt;*&gt;</code>, etc. all over.</p>\n\n<p>And now I just <code>rectimate'</code> and see the changes through that <code>LastAction</code>.<br />\nI also added error-checking extremely trivially like that.</p>\n"}], "owner": {"reputation": 18999, "user_id": 825637, "user_type": "registered", "accept_rate": 85, "profile_image": "https://www.gravatar.com/avatar/825a58fde1ef99db42c5354dab6cd472?s=128&d=identicon&r=PG", "display_name": "MasterMastic", "link": "https://stackoverflow.com/users/825637/mastermastic"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 55, "favorite_count": 0, "accepted_answer_id": 31176576, "answer_count": 1, "score": 1, "last_activity_date": 1435816588, "creation_date": 1435809236, "question_id": 31175319, "link": "https://stackoverflow.com/questions/31175319/how-to-know-what-made-a-behavior-change", "title": "How to know what made a behavior change?", "body": "<p>I'm writing a network description for a a listbox logic.<br />\nIt's really simple: I have a behavior for the (<code>Maybe</code>) current selected item, and I want it so that whenever the user adds a new item to the list, the current selected item will select the just-created value.</p>\n\n<p>It's also possible for the user to remove items from the list, and cause various of other changes, so I have to know when a new item is created; I can't just select the last item on every change.</p>\n\n<p>I don't really have any code to show for it because all my speculations on what to do can't even be written with the API*, but I have the context of <code>Frameworks t</code> and (simplified):</p>\n\n<pre><code>bDb :: Behavior t [Entry] -- Created with accumB.\nbSelected :: Behavior t (Maybe Entry) -- Created with accumB.\neAddEntry :: Event t () -- User clicked an add button. Created with fromAddHandler.\n</code></pre>\n\n<p>* Well, I did think about using <code>eAddEntry</code> to select the last entry, but that's so bad and even if it will work it's just a race between the adding of new item and the selecting of it.</p>\n\n<p>How can I go about it?</p>\n"}, {"tags": ["haskell", "io", "monads", "side-effects", "io-monad"], "comments": [{"owner": {"reputation": 51584, "user_id": 839246, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/9b0573c2b936b12828dd1e4cc04206dc?s=128&d=identicon&r=PG&f=1", "display_name": "bheklilr", "link": "https://stackoverflow.com/users/839246/bheklilr"}, "edited": false, "score": 1, "creation_date": 1435805562, "post_id": 31174841, "comment_id": 50357010, "body": "This is probably due to the default line buffering for Haskell.  Try adding <code>import System.IO</code> at the top of your code, then put <code>hSetBuffering stdout NoBuffering</code> before <code>putStr &quot;test&quot;</code>.  I&#39;ve seen this get a lot of people (and it got me when I was first starting with Haskell)."}, {"owner": {"reputation": 11617, "user_id": 576549, "user_type": "registered", "accept_rate": 74, "profile_image": "https://i.stack.imgur.com/E3mRg.png?s=128&g=1", "display_name": "Eugene Loy", "link": "https://stackoverflow.com/users/576549/eugene-loy"}, "reply_to_user": {"reputation": 51584, "user_id": 839246, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/9b0573c2b936b12828dd1e4cc04206dc?s=128&d=identicon&r=PG&f=1", "display_name": "bheklilr", "link": "https://stackoverflow.com/users/839246/bheklilr"}, "edited": false, "score": 0, "creation_date": 1435806415, "post_id": 31174841, "comment_id": 50357193, "body": "@bheklilr it worked, thanks. Please, post this as an answer, so I could accept it."}, {"owner": {"reputation": 51584, "user_id": 839246, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/9b0573c2b936b12828dd1e4cc04206dc?s=128&d=identicon&r=PG&f=1", "display_name": "bheklilr", "link": "https://stackoverflow.com/users/839246/bheklilr"}, "edited": false, "score": 0, "creation_date": 1435806657, "post_id": 31174841, "comment_id": 50357232, "body": "I just pointed it back to a very similar question that already has a good accepted answer with more detail that I probably would have put here."}], "owner": {"reputation": 11617, "user_id": 576549, "user_type": "registered", "accept_rate": 74, "profile_image": "https://i.stack.imgur.com/E3mRg.png?s=128&g=1", "display_name": "Eugene Loy", "link": "https://stackoverflow.com/users/576549/eugene-loy"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 61, "favorite_count": 0, "closed_date": 1435806606, "answer_count": 0, "score": 0, "last_activity_date": 1435806463, "creation_date": 1435805265, "last_edit_date": 1435806463, "question_id": 31174841, "link": "https://stackoverflow.com/questions/31174841/io-monad-and-ordering", "closed_reason": "Duplicate", "title": "IO monad and ordering", "body": "<p>I am playing with IO monad and learning to harness side effects in Haskell and it seems like I got it wrong.</p>\n\n<p>Consider the following code:</p>\n\n<pre><code>main = do\n    putStr \"test\"\n    getLine\n    return ()\n</code></pre>\n\n<p>My understanding here is that <code>do</code> \"glues\" three IO monads into one. My assumption is that they will be executed in sequence, i.e. \"test\" will be printed first, then line read, and then dummy <code>return ()</code> will produce <code>()</code></p>\n\n<p>However, when I run compiled app it always waits for line to be read <strong>before</strong> printing \"test\".</p>\n\n<p>Reordering <code>putStr</code>/<code>getLine</code> does nothig. \"Unwrapping\" value from IO monad, like this:</p>\n\n<pre><code>main = do\n    _ &lt;- putStr \"test\"\n    _ &lt;- getLine\n    return ()\n</code></pre>\n\n<p>... does not change the result either.</p>\n\n<p>What am I missing here? How to enforce order on IO actions?</p>\n"}, {"tags": ["haskell", "cabal", "sdl-2", "cabal-install"], "comments": [{"owner": {"reputation": 94713, "user_id": 1139697, "user_type": "registered", "accept_rate": 86, "profile_image": "https://www.gravatar.com/avatar/5f136ddb684f39aaee1c028ee1950f6f?s=128&d=identicon&r=PG", "display_name": "Zeta", "link": "https://stackoverflow.com/users/1139697/zeta"}, "edited": false, "score": 0, "creation_date": 1435814896, "post_id": 31174403, "comment_id": 50359344, "body": "That&#39;s a <a href=\"https://github.com/haskell-game/sdl2/issues/43\" rel=\"nofollow noreferrer\">standing issue</a>."}, {"owner": {"reputation": 1, "user_id": 4303344, "user_type": "registered", "profile_image": "https://lh5.googleusercontent.com/-m9kboWjcEzo/AAAAAAAAAAI/AAAAAAAAAFg/lIjBQvL0FwE/photo.jpg?sz=128", "display_name": "kaervin", "link": "https://stackoverflow.com/users/4303344/kaervin"}, "reply_to_user": {"reputation": 94713, "user_id": 1139697, "user_type": "registered", "accept_rate": 86, "profile_image": "https://www.gravatar.com/avatar/5f136ddb684f39aaee1c028ee1950f6f?s=128&d=identicon&r=PG", "display_name": "Zeta", "link": "https://stackoverflow.com/users/1139697/zeta"}, "edited": false, "score": 0, "creation_date": 1435834130, "post_id": 31174403, "comment_id": 50370508, "body": "That seems to be a different issue though. I got the whole pkg-config working, and now am getting this error."}], "owner": {"reputation": 1, "user_id": 4303344, "user_type": "registered", "profile_image": "https://lh5.googleusercontent.com/-m9kboWjcEzo/AAAAAAAAAAI/AAAAAAAAAFg/lIjBQvL0FwE/photo.jpg?sz=128", "display_name": "kaervin", "link": "https://stackoverflow.com/users/4303344/kaervin"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 282, "favorite_count": 0, "answer_count": 0, "score": 0, "last_activity_date": 1435801442, "creation_date": 1435801442, "question_id": 31174403, "link": "https://stackoverflow.com/questions/31174403/installing-sdl2-with-cabal", "title": "installing sdl2 with cabal", "body": "<p>I am trying to install the SDL2 package for Haskell via Cabal under windows.\nAnd after some rather tedious configuration, I am getting this error:</p>\n\n<pre><code>C:\\Users\\kaervin&gt;cabal install sdl2 --extra-include-dirs=C:\\SDL2-2.0.3\\include --extra-lib-dirs=C:\\SDL2-2.0.3\\i686-w64-mingw32\\lib\nResolving dependencies...\nConfiguring sdl2-1.3.1...\nBuilding sdl2-1.3.1...\nFailed to install sdl2-1.3.1\nLast 10 lines of the build log ( C:\\Users\\kaervin\\AppData\\Roaming\\cabal\\logs\\sdl2-1.3.1.log ):\nC:\\Users\\kaervin\\AppData\\Local\\Temp\\sdl2-1.3.1-8956\\sdl2-1.3.1\\dist\\doc\\html\\sdl2\ndoesn't exist or isn't a directory\nsdl2-1.3.1: library-dirs: /usr/local/cross-tools/i686-w64-mingw32/lib is a\nrelative path which makes no sense (as there is nothing for it to be relative\nto). You can make paths relative to the package database itself by using\n${pkgroot}. (use --force to override)\nsdl2-1.3.1: include-dirs: /usr/local/cross-tools/i686-w64-mingw32/include/SDL2\nis a relative path which makes no sense (as there is nothing for it to be\nrelative to). You can make paths relative to the package database itself by\nusing ${pkgroot}. (use --force to override)\ncabal: Error: some packages failed to install:\nsdl2-1.3.1 failed during the building phase. The exception was:\nExitFailure 1\n</code></pre>\n\n<p>I am using:</p>\n\n<pre><code>C:\\Users\\kaervin&gt;cabal --version\ncabal-install version 1.18.0.5\nusing version 1.18.1.3 of the Cabal library\n</code></pre>\n\n<p>I would appreciate any help!</p>\n"}]