[{"tags": ["haskell", "haskell-wai", "haskell-warp"], "answers": [{"tags": [], "owner": {"reputation": 1178, "user_id": 1667161, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/233658d12fabd9d72b04d0a6916f6389?s=128&d=identicon&r=PG", "display_name": "liminalisht", "link": "https://stackoverflow.com/users/1667161/liminalisht"}, "is_accepted": false, "score": 1, "last_activity_date": 1493899372, "creation_date": 1493899372, "answer_id": 43782384, "question_id": 43771843, "link": "https://stackoverflow.com/questions/43771843/how-to-server-a-folder-of-images-css-js-in-wai-warp/43782384#43782384", "title": "How to server a folder of images/css/js in Wai/Warp?", "body": "<p><a href=\"https://hackage.haskell.org/package/wai-middleware-static-0.8.1/docs/Network-Wai-Middleware-Static.html#t:Policy\" rel=\"nofollow noreferrer\">Network.Wai.Middleware.Static</a> has a <code>staticPolicy</code> fn that takes a <code>Policy</code> and returns <code>Middleware</code> you can add to your Wai app. A <code>Policy</code> will define how the URI supplied by the user will be mapped to a filepath. Check out <code>addBase</code> for constructing a <code>Policy</code>; this may suit your needs just fine. </p>\n"}], "owner": {"reputation": 117, "user_id": 7905648, "user_type": "registered", "accept_rate": 50, "profile_image": "https://www.gravatar.com/avatar/c376072a422d4c9983c0808f56ca8300?s=128&d=identicon&r=PG&f=1", "display_name": "user7905648", "link": "https://stackoverflow.com/users/7905648/user7905648"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 193, "favorite_count": 0, "answer_count": 1, "score": 1, "last_activity_date": 1493899372, "creation_date": 1493855938, "question_id": 43771843, "link": "https://stackoverflow.com/questions/43771843/how-to-server-a-folder-of-images-css-js-in-wai-warp", "title": "How to server a folder of images/css/js in Wai/Warp?", "body": "<p>I have this simple Wai/Warp application</p>\n\n<pre><code>app :: Wai.Application\napp req respond = respond $ case Wai.rawPathInfo req of\n    \"/\" -&gt; Wai.responseFile status200 [(\"Content-Type\", \"text/html\")] \"views/index.html\" Nothing\n    _ -&gt; notFound\n\n\nnotFound :: Wai.Response\nnotFound = Wai.responseLBS status404 [(\"Content-Type\", \"text/plain\")] \"404 - Not Found\"\n\nmain :: IO ()\nmain = do\n    port &lt;- getEnv \"PORT\"\n    let setting = Warp.setPort (read port :: Int) Warp.defaultSettings\n    putStrLn $ \"start server on the port \" ++ port\n    Warp.runSettings setting app\n</code></pre>\n\n<p>How can I add a folder \"images\" to the route so that any image I'll be able to refer to any image from the index.html as \"images/something.jpg\"? I know how to add an exact route, but here I need to add a whole folder.</p>\n"}, {"tags": ["haskell", "data-structures"], "owner": {"reputation": 4639, "user_id": 3986708, "user_type": "registered", "accept_rate": 71, "profile_image": "https://i.stack.imgur.com/g0JCF.jpg?s=128&g=1", "display_name": "hgiesel", "link": "https://stackoverflow.com/users/3986708/hgiesel"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 27, "favorite_count": 0, "closed_date": 1493848776, "answer_count": 0, "score": 1, "last_activity_date": 1493848377, "creation_date": 1493848377, "question_id": 43770613, "link": "https://stackoverflow.com/questions/43770613/how-to-work-with-data-structures-in-haskell", "closed_reason": "Duplicate", "title": "How to work with data structures in Haskell", "body": "<p>I'm trying to write a simple Terminal game in Haskell</p>\n\n<p>I have a function:</p>\n\n<pre><code>moveDirection :: Direction -&gt; Position -&gt; Position\n</code></pre>\n\n<p>which is supposed to move a player. A player looks like this:</p>\n\n<pre><code>data Player = Player String Position Hp\n</code></pre>\n\n<p>So I want to apply the <code>moveDirection</code> function to <code>Player</code>. I could easily do this writing a <em>lift</em> function (I don't know how to call this type of function otherwise):</p>\n\n<pre><code>movePlayer :: (Position -&gt; Position) -&gt; Player -&gt; Player\n</code></pre>\n\n<p>But I already see myself doing this quite a lot of times, every time I want to act on some part of a data structure.\nIs there some easier way to do this? Some common idioms?</p>\n"}, {"tags": ["haskell", "types", "haskell-lens", "type-families"], "comments": [{"owner": {"reputation": 34864, "user_id": 237428, "user_type": "registered", "accept_rate": 78, "profile_image": "https://i.stack.imgur.com/ThNhZ.jpg?s=128&g=1", "display_name": "Antal Spector-Zabusky", "link": "https://stackoverflow.com/users/237428/antal-spector-zabusky"}, "edited": false, "score": 0, "creation_date": 1493848610, "post_id": 43770536, "comment_id": 74582725, "body": "Possible duplicate of <a href=\"http://stackoverflow.com/questions/13846284/illegal-polymorphic-or-qualified-type-using-rankntypes-and-typefamilies\">Illegal polymorphic or qualified type using RankNTypes and TypeFamilies</a>"}, {"owner": {"reputation": 100892, "user_id": 745903, "user_type": "registered", "accept_rate": 74, "profile_image": "https://www.gravatar.com/avatar/50933f6638836741e620669b3940410e?s=128&d=identicon&r=PG", "display_name": "leftaroundabout", "link": "https://stackoverflow.com/users/745903/leftaroundabout"}, "reply_to_user": {"reputation": 34864, "user_id": 237428, "user_type": "registered", "accept_rate": 78, "profile_image": "https://i.stack.imgur.com/ThNhZ.jpg?s=128&g=1", "display_name": "Antal Spector-Zabusky", "link": "https://stackoverflow.com/users/237428/antal-spector-zabusky"}, "edited": false, "score": 0, "creation_date": 1493854750, "post_id": 43770536, "comment_id": 74584644, "body": "@AntalSpector-Zabusky perhaps related, but this is definitely not a duplicate."}], "answers": [{"comments": [{"owner": {"reputation": 44013, "user_id": 1477667, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/trgKM.jpg?s=128&g=1", "display_name": "dfeuer", "link": "https://stackoverflow.com/users/1477667/dfeuer"}, "edited": false, "score": 0, "creation_date": 1493860442, "post_id": 43771634, "comment_id": 74585743, "body": "Nice! If only we had implication constraints, we could express nifty things like &quot;must at least be a <code>Traversal</code>&quot;. I asked about such ideas some time back. Do you have a tricky way to express the concept without explicit dictionary manipulation?"}, {"owner": {"reputation": 100892, "user_id": 745903, "user_type": "registered", "accept_rate": 74, "profile_image": "https://www.gravatar.com/avatar/50933f6638836741e620669b3940410e?s=128&d=identicon&r=PG", "display_name": "leftaroundabout", "link": "https://stackoverflow.com/users/745903/leftaroundabout"}, "reply_to_user": {"reputation": 44013, "user_id": 1477667, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/trgKM.jpg?s=128&g=1", "display_name": "dfeuer", "link": "https://stackoverflow.com/users/1477667/dfeuer"}, "edited": false, "score": 0, "creation_date": 1493891214, "post_id": 43771634, "comment_id": 74599229, "body": "Phew, no idea. I suspect it would open a bit of can of worms if we tried obtaining such constraints from arbitrary polymorphic types. Is this even decidable?"}, {"owner": {"reputation": 2567, "user_id": 3780203, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/b3f3f9ab585dc56fa27e203ce4eb27fd?s=128&d=identicon&r=PG&f=1", "display_name": "ephrion", "link": "https://stackoverflow.com/users/3780203/ephrion"}, "edited": false, "score": 0, "creation_date": 1493919772, "post_id": 43771634, "comment_id": 74619602, "body": "Nice! This solved my problem. Now, I just need to figure out how to case on that information at the value level..."}], "tags": [], "owner": {"reputation": 100892, "user_id": 745903, "user_type": "registered", "accept_rate": 74, "profile_image": "https://www.gravatar.com/avatar/50933f6638836741e620669b3940410e?s=128&d=identicon&r=PG", "display_name": "leftaroundabout", "link": "https://stackoverflow.com/users/745903/leftaroundabout"}, "is_accepted": true, "score": 4, "last_activity_date": 1493925113, "last_edit_date": 1493925113, "creation_date": 1493854501, "answer_id": 43771634, "question_id": 43770536, "link": "https://stackoverflow.com/questions/43770536/type-families-cant-return-a-rankn-type-workarounds-or-alternatives/43771634#43771634", "title": "Type families can&#39;t return a RankN type -- workarounds or alternatives?", "body": "<p>A lens <em>is</em> already a traversal, only its Rank2 quantifier doesn't make use of the full constraint (it merely requires <code>Functor</code>, not <code>Applicative</code>).</p>\n\n<pre><code>type Lens s t a b      = \u2200 f . Functor f     =&gt; (a -&gt; f b) -&gt; s -&gt; f t\ntype Traversal s t a b = \u2200 f . Applicative f =&gt; (a -&gt; f b) -&gt; s -&gt; f t\n</code></pre>\n\n<p>It is at the level of this constraint that you should introduce your type family:</p>\n\n<pre><code>import GHC.Exts (Constraint)\ntype family FieldOpticConstraint key keys :: (* -&gt; *) -&gt; Constraint where\n  FieldOpticConstraint key '[] = Applicative\n  FieldOpticConstraint key (key =: val ': xs) = Functor\n  FieldOpticConstraint key (_ ': xs) = FieldOpticConstraint key xs\n</code></pre>\n\n<p>Then <code>field</code> should not yield a <code>LensOrTraversal</code>, but always a custom Rank2-signature with the <em>constraint</em> determined by the type family.</p>\n"}], "owner": {"reputation": 2567, "user_id": 3780203, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/b3f3f9ab585dc56fa27e203ce4eb27fd?s=128&d=identicon&r=PG&f=1", "display_name": "ephrion", "link": "https://stackoverflow.com/users/3780203/ephrion"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 65, "favorite_count": 0, "accepted_answer_id": 43771634, "answer_count": 1, "score": 4, "last_activity_date": 1493925113, "creation_date": 1493848030, "question_id": 43770536, "link": "https://stackoverflow.com/questions/43770536/type-families-cant-return-a-rankn-type-workarounds-or-alternatives", "title": "Type families can&#39;t return a RankN type -- workarounds or alternatives?", "body": "<p>I'm playing with an extensible record library, and I'm wanting to write a function <code>field</code> that can operate as either a <code>Lens</code> or a <code>Traversal</code> based on whether or not the <code>Symbol</code> key is in the list of keys. The type family is given:</p>\n\n<pre><code>type family LensOrTraversal key keys s t a b where\n    LensOrTraversal key '[] s t a b = \n        Traversal s t a b\n    LensOrTraversal key (key =: val ': xs) s t a b = \n        Lens s t a b\n    LensOrTraversal key (foo =: bar ': xs) s t a b = \n        LensOrTraversal key xs s t a b\n</code></pre>\n\n<p>This code gives me an error:</p>\n\n<pre><code>/home/matt/Projects/hash-rekt/src/Data/HashRecord/Internal.hs:433:5: \nerror:\n    \u2022 Illegal polymorphic type: Traversal s t a b\n    \u2022 In the equations for closed type family \u2018LensOrTraversal\u2019\n      In the type family declaration for \u2018LensOrTraversal\u2019\n</code></pre>\n\n<p>Ideally, I'd like to be able to reuse the <code>field</code> name for both lenses and traversals, as it would allow you to write</p>\n\n<pre><code>&gt;&gt;&gt; let testMap = empty &amp; field @\"foo\" .~ 'a'\n&gt;&gt;&gt; :t testMap\nHashRecord '[\"foo\" =: Char]\n&gt;&gt;&gt; testMap ^. field @\"foo\" \n'a'\n&gt;&gt;&gt; testMap ^. field @\"bar\"\nType error\n&gt;&gt;&gt; testMap ^? field @\"bar\"\nNothing\n</code></pre>\n\n<p>which follows common <code>lens</code> idioms. I can provide an <code>fieldTraversal</code> function that does what I want, but I'd prefer to overload the name <code>field</code> if possible. How would you work around this limitation of type families?</p>\n"}, {"tags": ["haskell"], "comments": [{"owner": {"reputation": 100185, "user_id": 3234959, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/93bb12ca0f93dfddb33880316f7e66c2?s=128&d=identicon&r=PG&f=1", "display_name": "chi", "link": "https://stackoverflow.com/users/3234959/chi"}, "edited": false, "score": 2, "creation_date": 1493842393, "post_id": 43769032, "comment_id": 74579762, "body": "I can&#39;t see anything wrong in your code. Double check the indentation, and check if you have any tab characters in your source (there are none I can see in your post). I&#39;d also recommend to turn on warnings with <code>-Wall</code>, sometimes it can reveal something important."}, {"owner": {"reputation": 11, "user_id": 7322258, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/d2dc105c9e8ad45935936b584975412c?s=128&d=identicon&r=PG&f=1", "display_name": "Kocsis Elod", "link": "https://stackoverflow.com/users/7322258/kocsis-elod"}, "reply_to_user": {"reputation": 100185, "user_id": 3234959, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/93bb12ca0f93dfddb33880316f7e66c2?s=128&d=identicon&r=PG&f=1", "display_name": "chi", "link": "https://stackoverflow.com/users/3234959/chi"}, "edited": false, "score": 0, "creation_date": 1493843240, "post_id": 43769032, "comment_id": 74580215, "body": "I&#39;ve double checked for tab characters, and it seems that there was one, right in front of that line, disguised and not seen by my editor. Thanks for the suggestion. Problem solved, case closed. Thank you, again!"}], "owner": {"reputation": 11, "user_id": 7322258, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/d2dc105c9e8ad45935936b584975412c?s=128&d=identicon&r=PG&f=1", "display_name": "Kocsis Elod", "link": "https://stackoverflow.com/users/7322258/kocsis-elod"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 40, "favorite_count": 0, "closed_date": 1493844349, "answer_count": 0, "score": 0, "last_activity_date": 1493841874, "creation_date": 1493841874, "question_id": 43769032, "link": "https://stackoverflow.com/questions/43769032/parse-error-on-input", "closed_reason": "Duplicate", "title": "Parse error on input &#39;&lt;-&#39;", "body": "<p>I'm having some problems with parsing the code.\nI'm getting the following error message :</p>\n\n<blockquote>\n  <p>project.hs:82:17: error:\n  parse error on input \u2018&lt;-\u2019\n     Perhaps this statement should be within a 'do' block?</p>\n</blockquote>\n\n<p>The code is the following :</p>\n\n<pre><code>firstLetters_main :: IO() \nfirstLetters_main = do\n    system \"cls\"\n    putStr \"Input file : \"\n    op1 &lt;- getLine\n    putStr \"Output file : \"\n    op2 &lt;- getLine\n    let ans1 = read op1\n    let ans2 = read op2\n    istream &lt;- readFile ans1\n    ostream &lt;- openFile ans2 WriteMode\n    let str = lines istream\n    hPutStrLn ostream (show (firstLetters str))\n</code></pre>\n\n<p>The error message points to the line :</p>\n\n<pre><code>ostream &lt;- openFile ans2 WriteMode\n</code></pre>\n\n<p>This program is changing every sentences starting words first letter to upper case if it isn't already( firstLetters ) without changing the input files structure, in case it has more lines, and puts it in an output file.</p>\n\n<p>Thanks in advance! </p>\n"}, {"tags": ["performance", "haskell", "io", "monads"], "comments": [{"owner": {"reputation": 14781, "user_id": 630160, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/4445f21326af525a8ad19af7e3ae41a8?s=128&d=identicon&r=PG", "display_name": "epsilonhalbe", "link": "https://stackoverflow.com/users/630160/epsilonhalbe"}, "edited": false, "score": 0, "creation_date": 1493839784, "post_id": 43768327, "comment_id": 74578389, "body": "Performance is something - a bit tricky in any language (I believe) - I worry less about your samplings than about your calculating the mean - it looks a bit like a space leak to me. When you (really) want performance it is best to do the coding and measuring thing and then optimize where necessary - &quot;premature optimization&quot; and Knuth you know"}, {"owner": {"reputation": 817, "user_id": 1077657, "user_type": "registered", "accept_rate": 86, "profile_image": "https://www.gravatar.com/avatar/77827a893cf80112cc4157d96d81f5e0?s=128&d=identicon&r=PG", "display_name": "BenJacob", "link": "https://stackoverflow.com/users/1077657/benjacob"}, "reply_to_user": {"reputation": 14781, "user_id": 630160, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/4445f21326af525a8ad19af7e3ae41a8?s=128&d=identicon&r=PG", "display_name": "epsilonhalbe", "link": "https://stackoverflow.com/users/630160/epsilonhalbe"}, "edited": false, "score": 0, "creation_date": 1493840413, "post_id": 43768327, "comment_id": 74578699, "body": "I see so analyse the code and then look for optimisation areas? Also could you explain why mean is a leak?"}, {"owner": {"reputation": 23444, "user_id": 414413, "user_type": "registered", "accept_rate": 79, "profile_image": "https://www.gravatar.com/avatar/6de2113f01432aa844dc85070ff33e89?s=128&d=identicon&r=PG", "display_name": "Cirdec", "link": "https://stackoverflow.com/users/414413/cirdec"}, "edited": false, "score": 0, "creation_date": 1493841312, "post_id": 43768327, "comment_id": 74579175, "body": "@BenJacob There can be a leak if <code>action</code> isn&#39;t strict enough that executing it forces the resulting value to be calculated. You could be building up a list of all the thunks to calculate leaking memory until <code>mean</code> forces them all."}, {"owner": {"reputation": 44013, "user_id": 1477667, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/trgKM.jpg?s=128&g=1", "display_name": "dfeuer", "link": "https://stackoverflow.com/users/1477667/dfeuer"}, "edited": false, "score": 0, "creation_date": 1493860660, "post_id": 43768327, "comment_id": 74585794, "body": "Indeed, you are quite definitely building up the whole list. <code>replicateM</code> and <code>mapM</code> (or <code>traverse</code>) for many-element structures In <code>IO</code> have similar problems. To go modular, you really need to use a streaming library of some sort. In this case, what you&#39;re doing is simple enough to manage pretty easily with plain recursion, strictly accumulating sum and count by hand as you perform the actions."}, {"owner": {"reputation": 34158, "user_id": 7203016, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/ybAMw.png?s=128&g=1", "display_name": "K. A. Buhr", "link": "https://stackoverflow.com/users/7203016/k-a-buhr"}, "edited": false, "score": 0, "creation_date": 1494014405, "post_id": 43768327, "comment_id": 74665188, "body": "It&#39;s hard to give a good answer without a concrete <code>action</code> and value for <code>n</code>.  If each <code>action</code> takes a few seconds and <code>n</code> is around 1000, a space leak isn&#39;t a concern.  Depending on <code>action</code>&#39;s structure, &quot;doing the sampling later&quot; may or may not be helpful.  If you are using more than a handful of random numbers, you should be aware that <code>System.Random</code> is inappropriate for high-performance applications.  Etc., etc., etc.  Do you have a (possibly simplified) complete, runnable example you can provide?"}], "owner": {"reputation": 817, "user_id": 1077657, "user_type": "registered", "accept_rate": 86, "profile_image": "https://www.gravatar.com/avatar/77827a893cf80112cc4157d96d81f5e0?s=128&d=identicon&r=PG", "display_name": "BenJacob", "link": "https://stackoverflow.com/users/1077657/benjacob"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 144, "favorite_count": 0, "answer_count": 0, "score": 0, "last_activity_date": 1493839259, "creation_date": 1493839259, "question_id": 43768327, "link": "https://stackoverflow.com/questions/43768327/performance-of-replicatem-in-io-monad", "title": "Performance of replicateM in IO monad", "body": "<p>I have an IO action called <code>action</code> in which I am doing a fairly heavy computation. I am using an IO monad in in order to have easy access to random numbers further down in the computation.</p>\n\n<p>I also have the below functions which replicate the action and take the mean of the result. Because the action takes a fair amount of time to complete, I was wondering what the effect on the performance is from doing the sampling in this manner. Would it be better to do the sampling later in the evaluation so that parts of the program that are the same for each sample are not repeated or does the Haskell compiler optimise this already?</p>\n\n<pre><code>samp :: (Fractional b) =&gt; Int -&gt; IO b -&gt; IO b\nsamp n action = do\n  samples &lt;- replicateM n action\n  return $ mean samples\n\nmean :: (Fractional a) =&gt; [a] -&gt; a\nmean as =  s / (genericLength as)\n  where s = sum as\n</code></pre>\n"}, {"tags": ["haskell", "boolean-logic"], "comments": [{"owner": {"reputation": 314794, "user_id": 67579, "user_type": "registered", "accept_rate": 81, "profile_image": "https://i.stack.imgur.com/BJXub.png?s=128&g=1", "display_name": "Willem Van Onsem", "link": "https://stackoverflow.com/users/67579/willem-van-onsem"}, "edited": false, "score": 0, "creation_date": 1493831065, "post_id": 43766074, "comment_id": 74573451, "body": "But your function does not return two elements?"}, {"owner": {"reputation": 4185, "user_id": 1424121, "user_type": "registered", "accept_rate": 62, "profile_image": "https://www.gravatar.com/avatar/c6f5c5cd761b9ce4493fd875cc041ac3?s=128&d=identicon&r=PG", "display_name": "ryachza", "link": "https://stackoverflow.com/users/1424121/ryachza"}, "edited": false, "score": 0, "creation_date": 1493831243, "post_id": 43766074, "comment_id": 74573543, "body": "I think you might be looking to <code>`xor`</code> (backticks needed to make it infix). As it is now you are applying <code>a</code> to two arguments, <code>xor</code> and <code>b</code>."}, {"owner": {"reputation": 100768, "user_id": 1899640, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/47374ccb28e4b0d2454b64f7b975bc66?s=128&d=identicon&r=PG", "display_name": "that other guy", "link": "https://stackoverflow.com/users/1899640/that-other-guy"}, "edited": false, "score": 2, "creation_date": 1493831889, "post_id": 43766074, "comment_id": 74573924, "body": "You currently implement a whole function, and then try to debug why it fails. You can make things much easier on yourself if you start small and build out. For example, <code>fulladder a b c = True ++ True</code> could be a good first dummy implementation: it fails, but it&#39;s much shorter and easier to look up. Once you&#39;ve fixed that, you can expand to <code>fulladder a b c = (True xor True, True)</code>, and so on until you get to your full expression."}], "answers": [{"tags": [], "owner": {"reputation": 314794, "user_id": 67579, "user_type": "registered", "accept_rate": 81, "profile_image": "https://i.stack.imgur.com/BJXub.png?s=128&g=1", "display_name": "Willem Van Onsem", "link": "https://stackoverflow.com/users/67579/willem-van-onsem"}, "is_accepted": false, "score": 8, "last_activity_date": 1493831547, "creation_date": 1493831547, "answer_id": 43766246, "question_id": 43766074, "link": "https://stackoverflow.com/questions/43766074/full-adder-in-haskell/43766246#43766246", "title": "Full adder in haskell", "body": "<p>The return type of your function is a <strong>tuple</strong>. Indeed:</p>\n\n<pre><code>fulladder :: Bool -&gt; Bool -&gt; Bool -&gt; <b>(Bool, Bool)</b>\n--                                   ^ 2-tuple</code></pre>\n\n<p>Now <code>(++) :: [a] -&gt; [a] -&gt; [a]</code> concatenates <strong>lists</strong>. So this will definitely not work to construct a tuple. So the first error we resolve is:</p>\n\n<pre><code>fulladder :: Bool -&gt; Bool -&gt; Bool -&gt;(Bool, Bool)\nfulladder a b c =  <b>(</b> c xor (a xor b) <b>,</b> (a&&b) || ((a xor b) && c) <b>)</b>\n--                 ^ tuple syntax    ^                            ^ </code></pre>\n\n<p>Next in Haskell you specify a function followed by the arguments. So <code>c xor a</code> won't work. You should use <code>xor c a</code> (or use backtics). So we should rewrite it to:</p>\n\n<pre><code>fulladder :: Bool -&gt; Bool -&gt; Bool -&gt;(Bool, Bool)\nfulladder a b c =  ( <b>xor</b> c (<b>xor</b> a b) , (a&&b) || ((<b>xor</b> a b) && c) )\n--                   ^      ^ right order          ^</code></pre>\n\n<p>or alternatively:</p>\n\n<pre><code>fulladder :: Bool -&gt; Bool -&gt; Bool -&gt;(Bool, Bool)\nfulladder a b c =  ( c <b>`xor`</b> (a <b>`xor`</b> b) , (a&&b) || ((a <b>`xor`</b> b) && c) )\n--                     ^   ^    ^   ^ backtics           ^   ^</code></pre>\n\n<p>Now the function generates:</p>\n\n<pre><code>*Main&gt; fulladder False False False\n(False,False)\n*Main&gt; fulladder False False True\n(True,False)\n*Main&gt; fulladder False True False\n(True,False)\n*Main&gt; fulladder False True True\n(False,True)\n*Main&gt; fulladder True False False\n(True,False)\n*Main&gt; fulladder True False True\n(False,True)\n*Main&gt; fulladder True True False\n(False,True)\n*Main&gt; fulladder True True True\n(True,True)\n</code></pre>\n\n<p>Which is the correct result for the <em>output</em> and <em>carry</em> tuple.</p>\n"}], "owner": {"reputation": 31, "user_id": 7958861, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/b470ebf6114b565daced785eecc96040?s=128&d=identicon&r=PG&f=1", "display_name": "T.T", "link": "https://stackoverflow.com/users/7958861/t-t"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 831, "favorite_count": 0, "answer_count": 1, "score": 3, "last_activity_date": 1493831769, "creation_date": 1493831009, "last_edit_date": 1493831769, "question_id": 43766074, "link": "https://stackoverflow.com/questions/43766074/full-adder-in-haskell", "title": "Full adder in haskell", "body": "<p>Haskell newbie here. I need some help with writing a function for a full adder. \nI've got the following:</p>\n\n<pre><code>xor :: Bool -&gt; Bool -&gt; Bool\nxor True False = True\nxor False True = True\nxor _ _ = False\n\nfulladder :: Bool -&gt; Bool -&gt; Bool -&gt;(Bool, Bool)\nfulladder a b c =  c xor (a xor b) ++ (a&amp;&amp;b) || ((a xor b) &amp;&amp; c)      \n</code></pre>\n\n<p>and I'm getting the following error:</p>\n\n<pre><code>  * Couldn't match expected type `(Bool -&gt; Bool -&gt; Bool)\n                                    -&gt; Bool -&gt; Bool'\n                  with actual type `Bool'\n  * The function `a' is applied to two arguments,\n      but its type `Bool' has none\n      In the first argument of `(&amp;&amp;)', namely `(a xor b)'\n      In the second argument of `(||)', namely `((a xor b) &amp;&amp; c)'\n</code></pre>\n"}, {"tags": ["java", "haskell", "java-stream", "primes", "sieve-of-eratosthenes"], "comments": [{"owner": {"reputation": 45896, "user_id": 2442804, "user_type": "registered", "accept_rate": 80, "profile_image": "https://i.stack.imgur.com/wBmyS.jpg?s=128&g=1", "display_name": "luk2302", "link": "https://stackoverflow.com/users/2442804/luk2302"}, "edited": false, "score": 2, "creation_date": 1493816238, "post_id": 43760641, "comment_id": 74562532, "body": "<i>&quot;am I deluding myself when I try to think of Java streams as comparable to Haskell lists&quot;</i> - I would say yes. <i>Maybe</i> you can do similar things but they certainly will be faaaaar more complicated to do in Java."}, {"owner": {"reputation": 7030, "user_id": 3032349, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/3cd8d19756aa9bc73d8045ae988ae728?s=128&d=identicon&r=PG&f=1", "display_name": "ThreeFx", "link": "https://stackoverflow.com/users/3032349/threefx"}, "edited": false, "score": 0, "creation_date": 1493816911, "post_id": 43760641, "comment_id": 74563057, "body": "Having worked with C# (LINQ) and Haskell all I can say is getting Java&#39;s streams to do similar stuff is not straightforward. I would recommend staying closer to idiomatic Java. IMHO Java lacks the built-ins to express these complicated ideas cleanly and concisely."}, {"owner": {"reputation": 37219, "user_id": 1523776, "user_type": "moderator", "accept_rate": 87, "profile_image": "https://www.gravatar.com/avatar/b3e0b5c8e42a8c38009ef2d969f8dabb?s=128&d=identicon&r=PG", "display_name": "Benjamin Hodgson", "link": "https://stackoverflow.com/users/1523776/benjamin-hodgson"}, "edited": false, "score": 11, "creation_date": 1493818718, "post_id": 43760641, "comment_id": 74564575, "body": "By the way, <a href=\"https://www.cs.hmc.edu/~oneill/papers/Sieve-JFP.pdf\" rel=\"nofollow noreferrer\">that&#39;s not the Sieve of Eratosthenes</a>."}, {"owner": {"reputation": 61419, "user_id": 849891, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/MbEO3.png?s=128&g=1", "display_name": "Will Ness", "link": "https://stackoverflow.com/users/849891/will-ness"}, "reply_to_user": {"reputation": 239210, "user_id": 2711488, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/FhkI9.jpg?s=128&g=1", "display_name": "Holger", "link": "https://stackoverflow.com/users/2711488/holger"}, "edited": false, "score": 0, "creation_date": 1493827225, "post_id": 43760641, "comment_id": 74571193, "body": "@Holger yes, &quot;stream&quot; is redundant for those coming from &quot;java&quot; tag, but what about others who come from &quot;haskell&quot; or even just &quot;sieve-of-eratosthenes&quot; for whom &quot;stream&quot; makes much more sense? What&#39;s the harm in having &quot;stream&quot; as additional tag?"}, {"owner": {"reputation": 239210, "user_id": 2711488, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/FhkI9.jpg?s=128&g=1", "display_name": "Holger", "link": "https://stackoverflow.com/users/2711488/holger"}, "reply_to_user": {"reputation": 61419, "user_id": 849891, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/MbEO3.png?s=128&g=1", "display_name": "Will Ness", "link": "https://stackoverflow.com/users/849891/will-ness"}, "edited": false, "score": 0, "creation_date": 1493827382, "post_id": 43760641, "comment_id": 74571289, "body": "@Will Ness: \u201cstream\u201d simply is a <i>wrong</i> tag. There is no stream here, unless you\u2019re talking about the Java-specific <code>Stream</code> API, which is covered by \u201cjava-stream\u201d. Why should a Haskell programmer ever consider the FP code of this question to have anything to do with <i>streams</i>?"}, {"owner": {"reputation": 61419, "user_id": 849891, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/MbEO3.png?s=128&g=1", "display_name": "Will Ness", "link": "https://stackoverflow.com/users/849891/will-ness"}, "reply_to_user": {"reputation": 239210, "user_id": 2711488, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/FhkI9.jpg?s=128&g=1", "display_name": "Holger", "link": "https://stackoverflow.com/users/2711488/holger"}, "edited": false, "score": 1, "creation_date": 1493832285, "post_id": 43760641, "comment_id": 74574137, "body": "@Holger because lazy lists are streams?"}, {"owner": {"reputation": 383, "user_id": 1636349, "user_type": "registered", "accept_rate": 53, "profile_image": "https://www.gravatar.com/avatar/8f83228cad358e4b2fa414266597147d?s=128&d=identicon&r=PG", "display_name": "user1636349", "link": "https://stackoverflow.com/users/1636349/user1636349"}, "reply_to_user": {"reputation": 239210, "user_id": 2711488, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/FhkI9.jpg?s=128&g=1", "display_name": "Holger", "link": "https://stackoverflow.com/users/2711488/holger"}, "edited": false, "score": 0, "creation_date": 1493883752, "post_id": 43760641, "comment_id": 74594331, "body": "@Holger: I used the &quot;stream&quot; tag in the sense of the Java stream API. I was trying to refine things so that I wouldn&#39;t get conventional non-stream-based &quot;solutions&quot;."}, {"owner": {"reputation": 117, "user_id": 3753045, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/EvZYk.jpg?s=128&g=1", "display_name": "Du\u0161an", "link": "https://stackoverflow.com/users/3753045/du%c5%a1an"}, "edited": false, "score": 0, "creation_date": 1493884796, "post_id": 43760641, "comment_id": 74594964, "body": "@user1636349 then you&#39;re looking for the &quot;java-stream&quot; tag. Your question will then even attract more attention from people familiar with Java 8 Stream."}, {"owner": {"reputation": 61419, "user_id": 849891, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/MbEO3.png?s=128&g=1", "display_name": "Will Ness", "link": "https://stackoverflow.com/users/849891/will-ness"}, "reply_to_user": {"reputation": 117, "user_id": 3753045, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/EvZYk.jpg?s=128&g=1", "display_name": "Du\u0161an", "link": "https://stackoverflow.com/users/3753045/du%c5%a1an"}, "edited": false, "score": 0, "creation_date": 1493895687, "post_id": 43760641, "comment_id": 74602227, "body": "@Du\u0161an yes they (the OP) are; but what about all others? Q&amp;A entries on SO are to serve the whole community, and &quot;stream&quot; has a general meaning outside of Java concerns. I hope someone would restore the tag, still (don&#39;t particularly want to edit war)."}, {"owner": {"reputation": 383, "user_id": 1636349, "user_type": "registered", "accept_rate": 53, "profile_image": "https://www.gravatar.com/avatar/8f83228cad358e4b2fa414266597147d?s=128&d=identicon&r=PG", "display_name": "user1636349", "link": "https://stackoverflow.com/users/1636349/user1636349"}, "reply_to_user": {"reputation": 7030, "user_id": 3032349, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/3cd8d19756aa9bc73d8045ae988ae728?s=128&d=identicon&r=PG&f=1", "display_name": "ThreeFx", "link": "https://stackoverflow.com/users/3032349/threefx"}, "edited": false, "score": 0, "creation_date": 1494067590, "post_id": 43760641, "comment_id": 74677453, "body": "@ThreeFX: now that I have a Java solution (below), I&#39;d be interested to see how you&#39;d do it in C# if you have a solution handy..."}, {"owner": {"reputation": 61419, "user_id": 849891, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/MbEO3.png?s=128&g=1", "display_name": "Will Ness", "link": "https://stackoverflow.com/users/849891/will-ness"}, "edited": false, "score": 0, "creation_date": 1494149478, "post_id": 43760641, "comment_id": 74697040, "body": "@user1636349 you could try asking another question with similar text and &quot;C#&quot; and &quot;stream&quot; tags instead of &quot;java&quot; and &quot;java-stream&quot;."}], "answers": [{"comments": [{"owner": {"reputation": 239210, "user_id": 2711488, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/FhkI9.jpg?s=128&g=1", "display_name": "Holger", "link": "https://stackoverflow.com/users/2711488/holger"}, "edited": false, "score": 0, "creation_date": 1493830864, "post_id": 43763404, "comment_id": 74573315, "body": "Close to <a href=\"http://stackoverflow.com/a/20007272/2711488\">this one</a>, though, I\u2019d prefer to implement a true Sieve of Eratosthenes like <a href=\"http://stackoverflow.com/a/37282074/2711488\">shown here</a>\u2026"}, {"owner": {"reputation": 383, "user_id": 1636349, "user_type": "registered", "accept_rate": 53, "profile_image": "https://www.gravatar.com/avatar/8f83228cad358e4b2fa414266597147d?s=128&d=identicon&r=PG", "display_name": "user1636349", "link": "https://stackoverflow.com/users/1636349/user1636349"}, "reply_to_user": {"reputation": 239210, "user_id": 2711488, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/FhkI9.jpg?s=128&g=1", "display_name": "Holger", "link": "https://stackoverflow.com/users/2711488/holger"}, "edited": false, "score": 1, "creation_date": 1493883161, "post_id": 43763404, "comment_id": 74593970, "body": "@Holger: OK, but that requires a defined limit for the number of primes to be generated. The Haskell solution processes an infinite list."}, {"owner": {"reputation": 383, "user_id": 1636349, "user_type": "registered", "accept_rate": 53, "profile_image": "https://www.gravatar.com/avatar/8f83228cad358e4b2fa414266597147d?s=128&d=identicon&r=PG", "display_name": "user1636349", "link": "https://stackoverflow.com/users/1636349/user1636349"}, "edited": false, "score": 0, "creation_date": 1493883280, "post_id": 43763404, "comment_id": 74594034, "body": "Thanks for this! I can see I&#39;ve got a way to go before streams become an automatic part of my Java vocabulary -- but I should expect that, it took ~2 years for OOP to sink in, and that was over 20 years ago -- my brain cells aren&#39;t more sprightly now than they were then!"}, {"owner": {"reputation": 239210, "user_id": 2711488, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/FhkI9.jpg?s=128&g=1", "display_name": "Holger", "link": "https://stackoverflow.com/users/2711488/holger"}, "reply_to_user": {"reputation": 383, "user_id": 1636349, "user_type": "registered", "accept_rate": 53, "profile_image": "https://www.gravatar.com/avatar/8f83228cad358e4b2fa414266597147d?s=128&d=identicon&r=PG", "display_name": "user1636349", "link": "https://stackoverflow.com/users/1636349/user1636349"}, "edited": false, "score": 0, "creation_date": 1493891049, "post_id": 43763404, "comment_id": 74599106, "body": "@user1636349: that\u2019s an intrinsic limitation of the actual Sieve of Eratosthenes algorithm. On the other hand, this Stream solution will build a linked <code>Predicate</code> chain behind the scene, which eats up far more memory, though the performance degradation will be so big that it will appear to hang before ever reaching the <code>OutOfMemoryError</code>. You may run the solution of this answer without a <code>limit(\u2026)</code>, to see when it will hang or throw either, <code>StackOverflowError</code> or <code>OutOfMemoryError</code>. Then take the last prime it printed times ten, pass it to my <code>BitSet</code> based solution and watch the difference\u2026"}, {"owner": {"reputation": 383, "user_id": 1636349, "user_type": "registered", "accept_rate": 53, "profile_image": "https://www.gravatar.com/avatar/8f83228cad358e4b2fa414266597147d?s=128&d=identicon&r=PG", "display_name": "user1636349", "link": "https://stackoverflow.com/users/1636349/user1636349"}, "reply_to_user": {"reputation": 239210, "user_id": 2711488, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/FhkI9.jpg?s=128&g=1", "display_name": "Holger", "link": "https://stackoverflow.com/users/2711488/holger"}, "edited": false, "score": 0, "creation_date": 1494067866, "post_id": 43763404, "comment_id": 74677523, "body": "@Holger: fair enough, but I asked the question purely out of academic interest, to see if I can learn more about the uses (and limitations) of streams. I can now see more of the limitations, and the solution given is one I would never have thought of myself, even if it is implementationally a monster. I really don&#39;t give a flying F about the SoE or efficient ways of finding primes per se, just the relationship of streams to stuff I already know (like Haskell lists) to help me get my head around it all."}, {"owner": {"reputation": 61419, "user_id": 849891, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/MbEO3.png?s=128&g=1", "display_name": "Will Ness", "link": "https://stackoverflow.com/users/849891/will-ness"}, "reply_to_user": {"reputation": 239210, "user_id": 2711488, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/FhkI9.jpg?s=128&g=1", "display_name": "Holger", "link": "https://stackoverflow.com/users/2711488/holger"}, "edited": false, "score": 1, "creation_date": 1494157055, "post_id": 43763404, "comment_id": 74699095, "body": "@Holger maybe it is possible to augment this algorithm by <a href=\"http://stackoverflow.com/questions/1764163/explain-this-chunk-of-haskell-code-that-outputs-a-stream-of-primes/8871918#8871918\"><i>postponement</i></a> (also, <a href=\"http://stackoverflow.com/questions/2211990/how-to-implement-an-efficient-infinite-generator-of-prime-numbers-in-python/10733621#10733621\">this</a> and <a href=\"https://stackoverflow.com/questions/13894417/double-stream-feed-to-prevent-unneeded-memoization/13895347#13895347\">this</a>), to achieve dramatic speedups."}, {"owner": {"reputation": 61419, "user_id": 849891, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/MbEO3.png?s=128&g=1", "display_name": "Will Ness", "link": "https://stackoverflow.com/users/849891/will-ness"}, "reply_to_user": {"reputation": 239210, "user_id": 2711488, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/FhkI9.jpg?s=128&g=1", "display_name": "Holger", "link": "https://stackoverflow.com/users/2711488/holger"}, "edited": false, "score": 0, "creation_date": 1494199994, "post_id": 43763404, "comment_id": 74712050, "body": "@Holger what that means is, having a limit is not an intrinsic trait of the sieve of Eratosthenes."}, {"owner": {"reputation": 239210, "user_id": 2711488, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/FhkI9.jpg?s=128&g=1", "display_name": "Holger", "link": "https://stackoverflow.com/users/2711488/holger"}, "reply_to_user": {"reputation": 61419, "user_id": 849891, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/MbEO3.png?s=128&g=1", "display_name": "Will Ness", "link": "https://stackoverflow.com/users/849891/will-ness"}, "edited": false, "score": 0, "creation_date": 1494227595, "post_id": 43763404, "comment_id": 74719512, "body": "@Will Ness: did you read <a href=\"http://stackoverflow.com/questions/43760641/java-8-streams-and-the-sieve-of-eratosthenes/43763404?noredirect=1#comment74564575_43760641\">this comment</a>? Not every algorithm calculating primes is the <a href=\"https://en.wikipedia.org/wiki/Sieve_of_Eratosthenes\" rel=\"nofollow noreferrer\">Sieve of Eratosthenes</a>. The Sieve of Eratosthenes is what I have shown in my answer, not what has been shown in the question. The Sieve needs a size limit, but as explained in previous comment, these FP solution only pretend to be limitless while failing long before the <code>BitSet</code> based true Sieve hits its limit."}, {"owner": {"reputation": 61419, "user_id": 849891, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/MbEO3.png?s=128&g=1", "display_name": "Will Ness", "link": "https://stackoverflow.com/users/849891/will-ness"}, "reply_to_user": {"reputation": 239210, "user_id": 2711488, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/FhkI9.jpg?s=128&g=1", "display_name": "Holger", "link": "https://stackoverflow.com/users/2711488/holger"}, "edited": false, "score": 0, "creation_date": 1494231002, "post_id": 43763404, "comment_id": 74721328, "body": "@Holger Yes I did (and didn&#39;t need to read the comment to know what it&#39;s about). Have you looked into any of the links I provided? the essence of the sieve is captured by equation <code>primes = [2..] \\ [[p*p,p*p+p..] for p in primes]</code>, and there&#39;s no limit inherent in that. Merging the composites streams <a href=\"http://stackoverflow.com/a/42150321/849891\">via an array, by chunks</a> between successive squares of primes, we get the theoretical complexity of the sieve, too, per prime produced (amortized). Merging by a tree of <code>union</code> nodes (or a priority queue) we only pay an additional log factor."}, {"owner": {"reputation": 239210, "user_id": 2711488, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/FhkI9.jpg?s=128&g=1", "display_name": "Holger", "link": "https://stackoverflow.com/users/2711488/holger"}, "reply_to_user": {"reputation": 61419, "user_id": 849891, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/MbEO3.png?s=128&g=1", "display_name": "Will Ness", "link": "https://stackoverflow.com/users/849891/will-ness"}, "edited": false, "score": 0, "creation_date": 1494231682, "post_id": 43763404, "comment_id": 74721704, "body": "@Will Ness: I\u2019m not willing to read tons of links of unfamiliar-to-me Haskell code, when right the first one is full of <code>mod</code> or similar operations, which is an immediate prove of not being the Sieve of Eratosthenes. There seems to be a habit amongst some developers to call everything that calculates prime number as \u201cSieve of Eratosthenes\u201d. The Sieve of Eratosthenes is that algorithm that allows to do the entire thing with addition only, nothing else."}, {"owner": {"reputation": 61419, "user_id": 849891, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/MbEO3.png?s=128&g=1", "display_name": "Will Ness", "link": "https://stackoverflow.com/users/849891/will-ness"}, "reply_to_user": {"reputation": 239210, "user_id": 2711488, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/FhkI9.jpg?s=128&g=1", "display_name": "Holger", "link": "https://stackoverflow.com/users/2711488/holger"}, "edited": false, "score": 0, "creation_date": 1494233553, "post_id": 43763404, "comment_id": 74722715, "body": "@Holger the links I gave you contain lots of verbal explanations, and a <a href=\"http://stackoverflow.com/questions/2211990/how-to-implement-an-efficient-infinite-generator-of-prime-numbers-in-python/10733621#10733621\">44 upvotes Python answer</a>, that has no mod operations in it whatsoever. (and do you see any mods in the mathy pseudocode in my comment? I don&#39;t)"}, {"owner": {"reputation": 239210, "user_id": 2711488, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/FhkI9.jpg?s=128&g=1", "display_name": "Holger", "link": "https://stackoverflow.com/users/2711488/holger"}, "reply_to_user": {"reputation": 61419, "user_id": 849891, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/MbEO3.png?s=128&g=1", "display_name": "Will Ness", "link": "https://stackoverflow.com/users/849891/will-ness"}, "edited": false, "score": 0, "creation_date": 1494234724, "post_id": 43763404, "comment_id": 74723453, "body": "@Will Ness: As said, I\u2019m not willing to read <i>all of them</i>, to find the one that might prove your point. But now that you made me doing that anyway, I have to admit that <code>yield</code> seems to be quite a useful tool. I don\u2019t see any way to do a similar thing in Java (with a reasonable code size). Still, I have my doubts whether this can still be considered the Sieve of Eratosthenes. It\u2019s great, it\u2019s efficient, it deserves its upvotes, but that doesn\u2019t prove it to be the Sieve of Eratosthenes in its original sense. That might have been the starting point though\u2026"}, {"owner": {"reputation": 61419, "user_id": 849891, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/MbEO3.png?s=128&g=1", "display_name": "Will Ness", "link": "https://stackoverflow.com/users/849891/will-ness"}, "reply_to_user": {"reputation": 239210, "user_id": 2711488, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/FhkI9.jpg?s=128&g=1", "display_name": "Holger", "link": "https://stackoverflow.com/users/2711488/holger"}, "edited": false, "score": 0, "creation_date": 1494237794, "post_id": 43763404, "comment_id": 74725431, "body": "@Holger just as you said, the true sieve does its job by (generating the composites of each found prime by) addition, and (my words) finding the primes in between. Which is what all of them do, that I linked to. as for <code>yield</code>, generators <i>are</i> streams, in a sense. --- as for the &quot;starting point&quot;, it was in my <a href=\"http://stackoverflow.com/questions/43760641/java-8-streams-and-the-sieve-of-eratosthenes/43763404?noredirect=1#comment74699095_43763404\">original comment</a> (though it was the 2nd link there)."}, {"owner": {"reputation": 61419, "user_id": 849891, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/MbEO3.png?s=128&g=1", "display_name": "Will Ness", "link": "https://stackoverflow.com/users/849891/will-ness"}, "edited": false, "score": 0, "creation_date": 1494251378, "post_id": 43763404, "comment_id": 74734773, "body": "lastly, I should&#39;ve stressed that the postponement technique is equally applicable to this (trial division) code and brings its complexity down from <i>n^2</i> to about <i>n^1.5</i>, in <i>n</i> primes produced (as was explained in the 1st link in my original comment)."}], "tags": [], "owner": {"reputation": 29444, "user_id": 3072788, "user_type": "registered", "accept_rate": 82, "profile_image": "https://www.gravatar.com/avatar/220a45c2fcff7e7358d144551b116205?s=128&d=identicon&r=PG&f=1", "display_name": "Alec", "link": "https://stackoverflow.com/users/3072788/alec"}, "is_accepted": true, "score": 12, "last_activity_date": 1493822932, "creation_date": 1493822932, "answer_id": 43763404, "question_id": 43760641, "link": "https://stackoverflow.com/questions/43760641/java-8-streams-and-the-sieve-of-eratosthenes/43763404#43763404", "title": "Java 8: streams and the Sieve of Eratosthenes", "body": "<p>Sure, it is possible, but greatly complicated by the fact that Java streams have no simple way of being decomposed into their head and their tail (you can easily get either one of these, but not both since the stream will already have been <em>consumed</em> by then - sounds like someone could use linear types...).</p>\n\n<p>The solution, is to keep a mutable variable around. For instance, that mutable variable can be the predicate that tests whether a number is a multiple of any other number seen so far.</p>\n\n<pre><code>import java.util.stream.*;\nimport java.util.function.IntPredicate;\n\npublic class Primes {\n\n   static IntPredicate isPrime = x -&gt; true;\n   static IntStream primes = IntStream\n                               .iterate(2, i -&gt; i + 1)\n                               .filter(i -&gt; isPrime.test(i))\n                               .peek(i -&gt; isPrime = isPrime.and(v -&gt; v % i != 0));\n\n   public static void main(String[] args) {\n      // Print out the first 10 primes.\n      primes.limit(10)\n            .forEach(p -&gt; System.out.println(p));\n\n   }\n}\n</code></pre>\n\n<p>Then, you get the expected result:</p>\n\n<pre><code>$ javac Primes.java\n$ java Primes\n2\n3\n5\n7\n11\n13\n17\n19\n23\n29\n</code></pre>\n"}, {"comments": [{"owner": {"reputation": 383, "user_id": 1636349, "user_type": "registered", "accept_rate": 53, "profile_image": "https://www.gravatar.com/avatar/8f83228cad358e4b2fa414266597147d?s=128&d=identicon&r=PG", "display_name": "user1636349", "link": "https://stackoverflow.com/users/1636349/user1636349"}, "edited": false, "score": 0, "creation_date": 1493883381, "post_id": 43771897, "comment_id": 74594090, "body": "Thanks. I wanted a Java solution, and I&#39;ve only ever played with Scala, but I&#39;ll ponder this... :)"}], "tags": [], "owner": {"reputation": 117, "user_id": 3753045, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/EvZYk.jpg?s=128&g=1", "display_name": "Du\u0161an", "link": "https://stackoverflow.com/users/3753045/du%c5%a1an"}, "is_accepted": false, "score": 3, "last_activity_date": 1493892155, "last_edit_date": 1493892155, "creation_date": 1493857135, "answer_id": 43771897, "question_id": 43760641, "link": "https://stackoverflow.com/questions/43760641/java-8-streams-and-the-sieve-of-eratosthenes/43771897#43771897", "title": "Java 8: streams and the Sieve of Eratosthenes", "body": "<p>If you'd accept a Scala solution instead, here it is:</p>\n\n<pre class=\"lang-scala prettyprint-override\"><code>def sieve(nums:Stream[Int]):Stream[Int] = nums.head #:: sieve(nums.filter{_ % nums.head &gt; 0})\nval primes:Stream[Int] = sieve(Stream.from(2))\n</code></pre>\n\n<p>It is not as elegant as the Haskell solution but it comes pretty close IMO.\nHere is the output:</p>\n\n<pre><code>scala&gt; primes take 10 foreach println\n2\n3\n5\n7\n11\n13\n17\n19\n23\n29\n</code></pre>\n\n<p>Scala's <a href=\"https://www.scala-lang.org/api/current/scala/collection/immutable/Stream.html\" rel=\"nofollow noreferrer\">Stream</a> is a lazy list which is far lazier than the Java 8 Stream. In the documentation you can even find the\nexample Fibonacci sequence implemantation which corresponds to the <a href=\"https://wiki.haskell.org/The_Fibonacci_sequence#Canonical_zipWith_implementation\" rel=\"nofollow noreferrer\">canonical Haskell zipWith implementation</a>.</p>\n"}, {"tags": [], "owner": {"reputation": 11, "user_id": 9418326, "user_type": "registered", "profile_image": "https://lh3.googleusercontent.com/-XdUIqdMkCWA/AAAAAAAAAAI/AAAAAAAAAAA/4252rscbv5M/photo.jpg?sz=128", "display_name": "\u0412\u043b\u0430\u0434\u0438\u043c\u0438\u0440 \u041a\u0443\u0440\u043e\u0432", "link": "https://stackoverflow.com/users/9418326/%d0%92%d0%bb%d0%b0%d0%b4%d0%b8%d0%bc%d0%b8%d1%80-%d0%9a%d1%83%d1%80%d0%be%d0%b2"}, "is_accepted": false, "score": 0, "last_activity_date": 1519735091, "creation_date": 1519735091, "answer_id": 49008908, "question_id": 43760641, "link": "https://stackoverflow.com/questions/43760641/java-8-streams-and-the-sieve-of-eratosthenes/49008908#49008908", "title": "Java 8: streams and the Sieve of Eratosthenes", "body": "<p>May be such solution?</p>\n\n<pre><code>public class ErythropheneSieveFunctionBitSet implements IntFunction&lt;BitSet&gt; {\n\n    @Override\n    public BitSet apply(int value) {\n        BitSet set = new BitSet();\n        fillSet(set, value);\n\n        int s = set.stream().min().getAsInt();\n        while (s * s &lt;= value) {\n            int temp = s;\n            int i = 0;\n            int multipleTemp;\n            while ((multipleTemp = s * (s + i)) &lt;= value) {\n                set.clear(multipleTemp);\n                i++;\n            }\n            s = set.stream().filter(x -&gt; x &gt; temp).min().getAsInt();\n        }\n\n        return set;\n    }\n\n    private void fillSet(BitSet set, int value) {\n        for (int i = 2; i &lt; value; i++) {\n            set.set(i);\n        }\n    }\n}\n</code></pre>\n"}, {"comments": [{"owner": {"reputation": 714, "user_id": 3126317, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/3b2ff8888829b737847fb890598b2523?s=128&d=identicon&r=PG&f=1", "display_name": "DanaJ", "link": "https://stackoverflow.com/users/3126317/danaj"}, "edited": false, "score": 0, "creation_date": 1553713805, "post_id": 55381223, "comment_id": 97491517, "body": "I realize this is a more optimized trial division than the OP, but it is still trial division and not a sieve."}, {"owner": {"reputation": 43, "user_id": 8200934, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/ZjZXj.jpg?s=128&g=1", "display_name": "Nobby Nobbs", "link": "https://stackoverflow.com/users/8200934/nobby-nobbs"}, "reply_to_user": {"reputation": 714, "user_id": 3126317, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/3b2ff8888829b737847fb890598b2523?s=128&d=identicon&r=PG&f=1", "display_name": "DanaJ", "link": "https://stackoverflow.com/users/3126317/danaj"}, "edited": false, "score": 1, "creation_date": 1553770560, "post_id": 55381223, "comment_id": 97511890, "body": "@DanaJ You are correct. I added a streams implementation of the actual sieve to my answer."}], "tags": [], "owner": {"reputation": 43, "user_id": 8200934, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/ZjZXj.jpg?s=128&g=1", "display_name": "Nobby Nobbs", "link": "https://stackoverflow.com/users/8200934/nobby-nobbs"}, "is_accepted": false, "score": 3, "last_activity_date": 1553770460, "last_edit_date": 1553770460, "creation_date": 1553701338, "answer_id": 55381223, "question_id": 43760641, "link": "https://stackoverflow.com/questions/43760641/java-8-streams-and-the-sieve-of-eratosthenes/55381223#55381223", "title": "Java 8: streams and the Sieve of Eratosthenes", "body": "<p>EDIT: The sieve, unoptimised, returning an infinite stream of primes</p>\n\n<pre><code>public static Stream&lt;Integer&gt; primeStreamEra() {\n    final HashMap&lt;Integer, Integer&gt; seedsFactors =\n        new HashMap&lt;Integer, Integer&gt;();\n    return IntStream.iterate(1, i -&gt; i + 1)\n                    .filter(i -&gt; {\n                        final int currentNum = i;\n                        seedsFactors.entrySet().parallelStream()\n                            .forEach(e -&gt; {\n                                // Update all factors until they have\n                                //the closest value that is &gt;= currentNum\n                                while(e.getValue() &lt; currentNum)\n                                    e.setValue(e.getValue() + e.getKey());\n                            });\n                        if(!seedsFactors.containsValue(i)) {\n                            if(i != 1)\n                                seedsFactors.put(i, i);\n                            return true;\n                        }\n                        return false;\n                    }).boxed();\n}\n</code></pre>\n\n<p>Test:</p>\n\n<pre><code>public static void main(String[] args) {\n    primeStreamEra().forEach(i -&gt; System.out.println(i));\n}\n</code></pre>\n\n<p>Initial Post:</p>\n\n<p>A somewhat simpler solution that avoids some unnecessary operations (such as testing even numbers).</p>\n\n<p>We iterate all odd numbers from 3 until the limit.</p>\n\n<p>Within the filter function:</p>\n\n<ul>\n<li>We test for all primes we have found that are smaller/equal than sqrt(currentNumber) rounded down.</li>\n<li>If they divide our current number return <code>false</code>.</li>\n<li>Else add to the list of found primes and return <code>true</code>.</li>\n</ul>\n\n<p>Function:</p>\n\n<pre><code>public static IntStream primeStream(final int limit) {\n    final ArrayList&lt;Integer&gt; primes = new ArrayList&lt;Integer&gt;();\n    IntStream primesThreeToLimit =  \n           IntStream.iterate(3, i -&gt; i + 2)\n                    .takeWhile(i -&gt; i &lt;= limit)\n                    .filter(i -&gt; {\n                        final int testUntil = (int) Math.sqrt((double) limit);\n                        for(Integer p: primes) {\n                            if(i % p == 0) return false;\n                            if(p &gt; testUntil) break;\n                        }\n                        primes.add(i);\n                        return true;\n                    });\n    return IntStream.concat(IntStream.of(1,2), primesThreeToLimit);\n}\n</code></pre>\n\n<p>Test:</p>\n\n<pre><code>public static void main(String[] args) {\n    System.out.println(Arrays.toString(primeStream(50).toArray()));\n}\n</code></pre>\n\n<p>Output: <code>[1, 2, 3, 5, 7, 11, 13, 17, 19, 23, 29, 31, 37, 41, 43, 47]</code></p>\n\n<p>Edit: To convert from <code>IntStream</code> to <code>Stream&lt;Integer&gt;</code> just do <code>primeStream(50).boxed()</code>.</p>\n"}, {"comments": [{"owner": {"reputation": 1096, "user_id": 8838577, "user_type": "registered", "profile_image": "https://lh5.googleusercontent.com/-Gal5UsnOx50/AAAAAAAAAAI/AAAAAAAAAEQ/nzCNyD1zcXo/photo.jpg?sz=128", "display_name": "Aashish Pawar", "link": "https://stackoverflow.com/users/8838577/aashish-pawar"}, "edited": false, "score": 0, "creation_date": 1589732157, "post_id": 55622625, "comment_id": 109404057, "body": "for Java 9 takewhile can we just use filter ? to get same efficiency on Java 8. By the way great answer"}], "tags": [], "owner": {"reputation": 641, "user_id": 6122976, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/7Mc2a.jpg?s=128&g=1", "display_name": "wilmol", "link": "https://stackoverflow.com/users/6122976/wilmol"}, "is_accepted": false, "score": 1, "last_activity_date": 1555112760, "last_edit_date": 1555112760, "creation_date": 1554938779, "answer_id": 55622625, "question_id": 43760641, "link": "https://stackoverflow.com/questions/43760641/java-8-streams-and-the-sieve-of-eratosthenes/55622625#55622625", "title": "Java 8: streams and the Sieve of Eratosthenes", "body": "<p>An alternative solution, you can implement the Collector interface.</p>\n\n<pre><code>  public static void main(String[] args)\n  {\n    Collector&lt;Integer, List&lt;Integer&gt;, List&lt;Integer&gt;&gt; sieve = new Collector&lt;Integer, List&lt;Integer&gt;, List&lt;Integer&gt;&gt;()\n    {\n      @Override\n      public Supplier&lt;List&lt;Integer&gt;&gt; supplier()\n      {\n        return ArrayList::new;\n      }\n\n      @Override\n      public BiConsumer&lt;List&lt;Integer&gt;, Integer&gt; accumulator()\n      {\n        return (prevPrimes, candidate) -&gt;\n        {\n          if (prevPrimes.stream().noneMatch(p -&gt; candidate % p == 0))\n          {\n            prevPrimes.add(candidate);\n          }\n        };\n      }\n\n      @Override\n      public BinaryOperator&lt;List&lt;Integer&gt;&gt; combiner()\n      {\n        return (list1, list2) -&gt;\n        {\n          list1.addAll(list2);\n          return list1;\n        };\n      }\n\n      @Override\n      public Function&lt;List&lt;Integer&gt;, List&lt;Integer&gt;&gt; finisher()\n      {\n        return Function.identity();\n      }\n\n      @Override\n      public Set&lt;Characteristics&gt; characteristics()\n      {\n        Set&lt;Characteristics&gt; set = new HashSet&lt;&gt;();\n        set.add(Characteristics.IDENTITY_FINISH);\n        return set;\n      }\n    };\n\n    List&lt;Integer&gt; primesBelow1000 = IntStream.range(2, 1000)\n        .boxed()\n        .collect(sieve);\n\n    primesBelow1000.forEach(System.out::println);\n  }\n</code></pre>\n\n<p>More concisely:</p>\n\n<pre><code>  public static void main(String[] args)\n  {\n\n    List&lt;Integer&gt; primesBelow1000 = IntStream.range(2, 1000)\n        .boxed()\n        .collect(\n            ArrayList::new,\n            (primes, candidate) -&gt;\n            {\n              if (primes.stream().noneMatch(p -&gt; candidate % p == 0))\n              {\n                primes.add(candidate);\n              }\n            },\n            List::addAll\n        );\n\n    primesBelow1000.forEach(System.out::println);\n  }\n</code></pre>\n\n<p>More efficient (using Java 9 TakeWhile to change O(n) to O(sqrt(n))):</p>\n\n<pre><code>List&lt;Long&gt; primesBelowLimit = LongStream.range(2, below)\n        .collect(\n                ArrayList::new,\n                (primes, candidate) -&gt;\n                {\n                    long candidateRoot = (long) Math.sqrt(candidate);\n                    if (primes.stream()\n                        .takeWhile(p -&gt; p &lt;= candidateRoot)\n                        .noneMatch(p -&gt; candidate % p == 0))\n                    {\n                        primes.add(candidate);\n                    }\n                },\n                List::addAll\n        );\n</code></pre>\n"}], "owner": {"reputation": 383, "user_id": 1636349, "user_type": "registered", "accept_rate": 53, "profile_image": "https://www.gravatar.com/avatar/8f83228cad358e4b2fa414266597147d?s=128&d=identicon&r=PG", "display_name": "user1636349", "link": "https://stackoverflow.com/users/1636349/user1636349"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 1801, "favorite_count": 0, "accepted_answer_id": 43763404, "answer_count": 5, "score": 7, "last_activity_date": 1555112760, "creation_date": 1493816031, "last_edit_date": 1494238843, "question_id": 43760641, "link": "https://stackoverflow.com/questions/43760641/java-8-streams-and-the-sieve-of-eratosthenes", "title": "Java 8: streams and the Sieve of Eratosthenes", "body": "<p>The Sieve of Eratosthenes can be implemented very neatly in Haskell, using laziness to generate an infinite list and then remove all multiples of the head of the list from its tail:</p>\n\n<pre><code>primes :: [Int]\nprimes = sieve [2..]\nsieve (x:xs) = x : sieve [y | y &lt;- xs, y `mod` x &gt; 0]\n</code></pre>\n\n<p>I'm trying to learn about using streams in Java 8, but I figure out if there's a way of achieving the same result in Java as the Haskell code above. If I treat a Haskell lazy list as equivalent to a Java stream, it seems that I need to take a stream headed by 2 and produce a new stream with all multiples of 2 removed, and then take that stream and produce a new stream with all multiples of 3 removed, and...</p>\n\n<p>And I have no idea how to proceed.</p>\n\n<p>Is there any way of doing this, or am I deluding myself when I try to think of Java streams as comparable to Haskell lists?</p>\n"}, {"tags": ["haskell", "monads"], "comments": [{"owner": {"reputation": 57219, "user_id": 33796, "user_type": "registered", "accept_rate": 70, "profile_image": "https://www.gravatar.com/avatar/08727b23ba62e634b32988cdff082663?s=128&d=identicon&r=PG", "display_name": "luqui", "link": "https://stackoverflow.com/users/33796/luqui"}, "edited": false, "score": 3, "creation_date": 1493797720, "post_id": 43754165, "comment_id": 74549747, "body": "<a href=\"https://hackage.haskell.org/package/base-4.9.1.0/docs/Control-Monad.html#v:mzero\" rel=\"nofollow noreferrer\"><code>mzero</code> from <code>Control.Monad</code></a>"}, {"owner": {"reputation": 2313, "user_id": 5318306, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/897fd4f3b92d28c5c1eb28a8024661a1?s=128&d=identicon&r=PG&f=1", "display_name": "Gurkenglas", "link": "https://stackoverflow.com/users/5318306/gurkenglas"}, "edited": false, "score": 9, "creation_date": 1493799516, "post_id": 43754165, "comment_id": 74550836, "body": "<a href=\"https://hackage.haskell.org/package/base-4.9.1.0/docs/Control-Applicative.html#v:empty\" rel=\"nofollow noreferrer\">empty from Control.Applicative, the same but more general</a>"}, {"owner": {"reputation": 23111, "user_id": 1319998, "user_type": "registered", "accept_rate": 58, "profile_image": "https://www.gravatar.com/avatar/9f600f4583bec89109ce8c0c098951ae?s=128&d=identicon&r=PG", "display_name": "Michal Charemza", "link": "https://stackoverflow.com/users/1319998/michal-charemza"}, "reply_to_user": {"reputation": 57219, "user_id": 33796, "user_type": "registered", "accept_rate": 70, "profile_image": "https://www.gravatar.com/avatar/08727b23ba62e634b32988cdff082663?s=128&d=identicon&r=PG", "display_name": "luqui", "link": "https://stackoverflow.com/users/33796/luqui"}, "edited": false, "score": 0, "creation_date": 1493810143, "post_id": 43754165, "comment_id": 74558032, "body": "@luqui Feel free to put an answer!"}, {"owner": {"reputation": 23111, "user_id": 1319998, "user_type": "registered", "accept_rate": 58, "profile_image": "https://www.gravatar.com/avatar/9f600f4583bec89109ce8c0c098951ae?s=128&d=identicon&r=PG", "display_name": "Michal Charemza", "link": "https://stackoverflow.com/users/1319998/michal-charemza"}, "reply_to_user": {"reputation": 2313, "user_id": 5318306, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/897fd4f3b92d28c5c1eb28a8024661a1?s=128&d=identicon&r=PG&f=1", "display_name": "Gurkenglas", "link": "https://stackoverflow.com/users/5318306/gurkenglas"}, "edited": false, "score": 0, "creation_date": 1493810154, "post_id": 43754165, "comment_id": 74558042, "body": "@Gurkenglas  Also free to put an answer!"}], "answers": [{"tags": [], "owner": {"reputation": 23111, "user_id": 1319998, "user_type": "registered", "accept_rate": 58, "profile_image": "https://www.gravatar.com/avatar/9f600f4583bec89109ce8c0c098951ae?s=128&d=identicon&r=PG", "display_name": "Michal Charemza", "link": "https://stackoverflow.com/users/1319998/michal-charemza"}, "is_accepted": false, "score": 3, "last_activity_date": 1494315230, "creation_date": 1494315230, "answer_id": 43863843, "question_id": 43754165, "link": "https://stackoverflow.com/questions/43754165/nothing-in-maybet-monad-more-concise-way/43863843#43863843", "title": "Nothing in MaybeT monad: more concise way?", "body": "<p>Inspired by the comment from @luqui</p>\n\n<hr>\n\n<p>To behave as <code>Nothing</code> in the plain <code>Maybe</code> monad, <code>maybeTNothing</code> should satisfy the equations</p>\n\n<pre><code>maybeTNothing &gt;&gt;= f  =  maybeTNothing\nv &gt;&gt; maybeTNothing   =  maybeTNothing\n</code></pre>\n\n<p>This is exactly the requirements on <a href=\"https://hackage.haskell.org/package/base-4.9.1.0/docs/Control-Monad.html#t:MonadPlus\" rel=\"nofollow noreferrer\"><code>mzero</code></a> from <code>MonadPlus</code>, which <code>MaybeT</code> is an instance of. So we can just use <code>mzero</code></p>\n\n<pre><code>maybeTNothing = mzero\n</code></pre>\n\n<hr>\n\n<p><a href=\"https://hackage.haskell.org/package/base-4.9.1.0/docs/Control-Monad.html#t:MonadPlus\" rel=\"nofollow noreferrer\">https://hackage.haskell.org/package/base-4.9.1.0/docs/Control-Monad.html#t:MonadPlus</a></p>\n"}], "owner": {"reputation": 23111, "user_id": 1319998, "user_type": "registered", "accept_rate": 58, "profile_image": "https://www.gravatar.com/avatar/9f600f4583bec89109ce8c0c098951ae?s=128&d=identicon&r=PG", "display_name": "Michal Charemza", "link": "https://stackoverflow.com/users/1319998/michal-charemza"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 348, "favorite_count": 0, "answer_count": 1, "score": 5, "last_activity_date": 1494315230, "creation_date": 1493797677, "question_id": 43754165, "link": "https://stackoverflow.com/questions/43754165/nothing-in-maybet-monad-more-concise-way", "title": "Nothing in MaybeT monad: more concise way?", "body": "<p>I'm experimenting with the <code>MaybeT</code> monad, specifically <code>MaybeT Identity String</code></p>\n\n<pre><code>import Control.Monad.Trans.Maybe\nimport Control.Monad.Identity\nimport Data.Maybe\n\nmain :: IO ()\nmain = putStrLn . show . runIdentity . runMaybeT $ maybeGetString\n\nmaybeGetString :: MaybeT Identity String\nmaybeGetString = return \"first\" &gt;&gt;\n                 maybeTNothing &gt;&gt; \n                 return \"second\"\n\nmaybeTNothing :: MaybeT Identity String\nmaybeTNothing = MaybeT $ return Nothing\n</code></pre>\n\n<p>The experession for the <code>MaybeT</code> equivalent of <code>Nothing</code> seems to be <code>MaybeT $ return Nothing</code>, which feels a bit verbose, and it feels unexpected to me to have to explicitly use the <code>MaybeT</code> constructor.</p>\n\n<p>Is there a shorter/nicer/clearer way of writing <code>Nothing</code> in the <code>MaybeT</code> monad?</p>\n"}, {"tags": ["haskell", "types", "where-clause"], "comments": [{"owner": {"reputation": 57219, "user_id": 33796, "user_type": "registered", "accept_rate": 70, "profile_image": "https://www.gravatar.com/avatar/08727b23ba62e634b32988cdff082663?s=128&d=identicon&r=PG", "display_name": "luqui", "link": "https://stackoverflow.com/users/33796/luqui"}, "edited": false, "score": 4, "creation_date": 1493797667, "post_id": 43753864, "comment_id": 74549716, "body": "Read up on <a href=\"https://wiki.haskell.org/Scoped_type_variables\" rel=\"nofollow noreferrer\">Scoped Type Variables</a>"}], "answers": [{"comments": [{"owner": {"reputation": 2019, "user_id": 5800895, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/0cab3b0361b7e54267c70c02754f21de?s=128&d=identicon&r=PG&f=1", "display_name": "Derek Elkins left SE", "link": "https://stackoverflow.com/users/5800895/derek-elkins-left-se"}, "edited": false, "score": 1, "creation_date": 1493836974, "post_id": 43765578, "comment_id": 74576891, "body": "Just to emphasize, to trigger the use of the extension you <i>must</i> explicitly quantify."}], "tags": [], "owner": {"reputation": 100185, "user_id": 3234959, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/93bb12ca0f93dfddb33880316f7e66c2?s=128&d=identicon&r=PG&f=1", "display_name": "chi", "link": "https://stackoverflow.com/users/3234959/chi"}, "is_accepted": true, "score": 4, "last_activity_date": 1493829269, "creation_date": 1493829269, "answer_id": 43765578, "question_id": 43753864, "link": "https://stackoverflow.com/questions/43753864/specifying-the-type-of-a-function-in-a-where-clause/43765578#43765578", "title": "Specifying the type of a function in a where clause", "body": "<p>In basic Haskell, every type signature is implicitly quantified universally</p>\n\n<pre><code>foo :: Bool -&gt; a -&gt; a -&gt; a\nfoo b x y = bar y\n   where bar :: a -&gt; a\n         bar y | b         = x\n               | otherwise = y \n</code></pre>\n\n<p>actually means:</p>\n\n<pre><code>foo :: forall a. Bool -&gt; a -&gt; a -&gt; a\nfoo b x y = bar y\n   where bar :: forall a1. a1 -&gt; a1\n         bar y | b         = x\n               | otherwise = y \n</code></pre>\n\n<p>and <em>fails</em> to compile since <code>x</code> is not of type <code>a1</code>.</p>\n\n<p>Removing the type signature of <code>bar</code> makes it compile, and the compiler will associate to bar the correct type <code>a -&gt; a</code> where <code>a</code> is NOT quantified universally. Note that this is a type that the compiler can infer, but that the user is prevented to write.</p>\n\n<p>This is rather inconvenient!</p>\n\n<p>So, the <code>ScopedTypeVarables</code> GHC extension circumvents that, allowing one to write</p>\n\n<pre><code>foo :: forall a. Bool -&gt; a -&gt; a -&gt; a\nfoo b x y = bar y\n   where bar :: a -&gt; a\n         bar y | b         = x\n               | otherwise = y \n</code></pre>\n\n<p>and here the first <code>forall a.</code> makes <code>a</code> to be in scope in inner declarations. Further, the type of <code>bar</code> remains <code>a -&gt; a</code> and is not universally quantified since <code>a</code> is now in scope. Hence, it compiles and the user was now able to write the wanted type annotation.</p>\n"}], "owner": {"reputation": 4593, "user_id": 2289983, "user_type": "registered", "accept_rate": 92, "profile_image": "https://i.stack.imgur.com/LG4hj.jpg?s=128&g=1", "display_name": "Damian Nadales", "link": "https://stackoverflow.com/users/2289983/damian-nadales"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 120, "favorite_count": 0, "accepted_answer_id": 43765578, "answer_count": 1, "score": 3, "last_activity_date": 1493829269, "creation_date": 1493796728, "last_edit_date": 1493797164, "question_id": 43753864, "link": "https://stackoverflow.com/questions/43753864/specifying-the-type-of-a-function-in-a-where-clause", "title": "Specifying the type of a function in a where clause", "body": "<p>I have the following Monad instance, based on the material in <a href=\"http://www.scs.stanford.edu/16wi-cs240h/slides/iteratee-slides.html#(19)\" rel=\"nofollow noreferrer\">these slides</a>:</p>\n\n<pre><code>{-# LANGUAGE InstanceSigs #-}\n\nnewtype Iter a = Iter { runIter :: Chunk -&gt; Result a }\n\ninstance Monad Iter where\n  return = Iter . Done\n  (&gt;&gt;=) :: Iter a -&gt; (a -&gt; Iter b) -&gt; Iter b\n  (Iter iter0) &gt;&gt;= fiter = Iter $ \\chunk -&gt; continue (iter0 chunk)\n    where continue :: Result a -&gt; Result b\n          continue (Done x rest)     = runIter (fiter x) rest\n          continue (NeedInput iter1) = NeedInput (iter1 &gt;&gt;= fiter)\n          continue (NeedIO ior)      = NeedIO (liftM continue ior)\n          continue (Failed e)        = Failed e\n</code></pre>\n\n<p>This will give the following error:</p>\n\n<pre><code>\u2022 Couldn't match type \u2018b\u2019 with \u2018b1\u2019\n  \u2018b\u2019 is a rigid type variable bound by\n    the type signature for:\n      (&gt;&gt;=) :: forall a b. Iter a -&gt; (a -&gt; Iter b) -&gt; Iter b\n    at Iteratee.hs:211:12\n  \u2018b1\u2019 is a rigid type variable bound by\n    the type signature for:\n      continue :: forall a1 b1. Result a1 -&gt; Result b1\n    at Iteratee.hs:214:23\n  Expected type: Result b1\n    Actual type: Result b\n\u2022 In the expression: runIter (fiter x) rest\n  In an equation for \u2018continue\u2019:\n      continue (Done x rest) = runIter (fiter x) rest\n  In an equation for \u2018&gt;&gt;=\u2019:\n      (Iter iter0) &gt;&gt;= fiter\n        = Iter $ \\ chunk -&gt; continue (iter0 chunk)\n        where\n            continue :: Result a -&gt; Result b\n            continue (Done x rest) = runIter (fiter x) rest\n            continue (NeedInput iter1) = NeedInput (iter1 &gt;&gt;= fiter)\n            continue (NeedIO ior) = NeedIO (liftM continue ior)\n            continue (Failed e) = Failed e\n\u2022 Relevant bindings include\n    continue :: Result a1 -&gt; Result b1 (bound at Iteratee.hs:215:11)\n    fiter :: a -&gt; Iter b (bound at Iteratee.hs:212:20)\n    (&gt;&gt;=) :: Iter a -&gt; (a -&gt; Iter b) -&gt; Iter b\n      (bound at Iteratee.hs:212:3)\n</code></pre>\n\n<p>To add to my confusion, if I leave <code>continue</code> undefined but I assign a type the code compiles.</p>\n\n<p>My guess is that this problem is caused by continue actually having type</p>\n\n<pre><code>continue :: forall a1 b1. Result a1 -&gt; Result b1\n</code></pre>\n\n<p>hence the two <code>a</code>'s and <code>b</code>'s from the types above are actually different. But nevertheless, <code>continue</code> above must have a type. My question is then, which is the type of this function assigned by the compiler when the types are omitted. </p>\n\n<p><em>EDIT</em>:</p>\n\n<p>If the <code>iter</code> parameter is explicitly passed then the code compiles:</p>\n\n<pre><code>instance Monad Iter where\n  return = Iter . Done\n  (&gt;&gt;=) :: Iter a -&gt; (a -&gt; Iter b) -&gt; Iter b\n  (Iter iter0) &gt;&gt;= fiter0 = Iter $ \\chunk -&gt; continue fiter0 (iter0 chunk)\n    where continue :: (a -&gt; Iter b) -&gt; Result a -&gt; Result b\n          continue fiter (Done x rest)     = runIter (fiter x) rest\n          continue fiter (NeedInput iter1) = NeedInput (iter1 &gt;&gt;= fiter)\n          continue fiter (NeedIO ior)      = NeedIO (liftM (continue fiter) ior)\n          continue _ (Failed e)        = Failed e\n</code></pre>\n\n<p>However I'd like to avoid having to pass the parameter explicitly, while being able to give <code>continue</code> a type.</p>\n"}, {"tags": ["list", "parsing", "haskell", "compiler-errors", "tree"], "comments": [{"owner": {"reputation": 62421, "user_id": 216164, "user_type": "registered", "accept_rate": 89, "profile_image": "https://www.gravatar.com/avatar/786f224adbe0784cdf7d0f15476061fe?s=128&d=identicon&r=PG", "display_name": "Thomas M. DuBuisson", "link": "https://stackoverflow.com/users/216164/thomas-m-dubuisson"}, "edited": false, "score": 0, "creation_date": 1493792154, "post_id": 43752251, "comment_id": 74546732, "body": "I suggest you ask a separate question about bang patterns.  One question - per stackoverflow question is best.  In short: No, you aren&#39;t using them right."}, {"owner": {"reputation": 75362, "user_id": 625403, "user_type": "registered", "accept_rate": 82, "profile_image": "https://www.gravatar.com/avatar/786eed7da67079cb5d63a49d469af25b?s=128&d=identicon&r=PG", "display_name": "amalloy", "link": "https://stackoverflow.com/users/625403/amalloy"}, "edited": false, "score": 0, "creation_date": 1493792176, "post_id": 43752251, "comment_id": 74546739, "body": "The bangs don&#39;t make much sense to me here, but I could be wrong. Either way I think that&#39;s a separate question than the pattern-matching problem you&#39;re having."}, {"owner": {"reputation": 315, "user_id": 7940372, "user_type": "registered", "accept_rate": 58, "profile_image": "https://www.gravatar.com/avatar/3e5744471a061ee3bf3a29ce9bb5a4a7?s=128&d=identicon&r=PG&f=1", "display_name": "420fedoras", "link": "https://stackoverflow.com/users/7940372/420fedoras"}, "reply_to_user": {"reputation": 62421, "user_id": 216164, "user_type": "registered", "accept_rate": 89, "profile_image": "https://www.gravatar.com/avatar/786f224adbe0784cdf7d0f15476061fe?s=128&d=identicon&r=PG", "display_name": "Thomas M. DuBuisson", "link": "https://stackoverflow.com/users/216164/thomas-m-dubuisson"}, "edited": false, "score": 0, "creation_date": 1493793210, "post_id": 43752251, "comment_id": 74547235, "body": "@ThomasM.DuBuisson yeah was only a minor side question, a yes or no was all I was looking for, so thanks"}], "answers": [{"comments": [{"owner": {"reputation": 315, "user_id": 7940372, "user_type": "registered", "accept_rate": 58, "profile_image": "https://www.gravatar.com/avatar/3e5744471a061ee3bf3a29ce9bb5a4a7?s=128&d=identicon&r=PG&f=1", "display_name": "420fedoras", "link": "https://stackoverflow.com/users/7940372/420fedoras"}, "edited": false, "score": 0, "creation_date": 1493793775, "post_id": 43752390, "comment_id": 74547509, "body": "I see, that makes sense. In that case, why does the compiler not give me a parse error for the first line?"}, {"owner": {"reputation": 57219, "user_id": 33796, "user_type": "registered", "accept_rate": 70, "profile_image": "https://www.gravatar.com/avatar/08727b23ba62e634b32988cdff082663?s=128&d=identicon&r=PG", "display_name": "luqui", "link": "https://stackoverflow.com/users/33796/luqui"}, "reply_to_user": {"reputation": 315, "user_id": 7940372, "user_type": "registered", "accept_rate": 58, "profile_image": "https://www.gravatar.com/avatar/3e5744471a061ee3bf3a29ce9bb5a4a7?s=128&d=identicon&r=PG&f=1", "display_name": "420fedoras", "link": "https://stackoverflow.com/users/7940372/420fedoras"}, "edited": false, "score": 1, "creation_date": 1493795832, "post_id": 43752390, "comment_id": 74548579, "body": "@420fedoras I think it&#39;s a phase thing.  By playing a little in ghci, it seems like <code>[] x</code> <i>does</i> parse as a pattern (same was a <code>Just x</code>), since <code>[]</code> is considered to be a constructor.  Then later, during typechecking, it complains that <code>[]</code> was given too many arguments."}], "tags": [], "owner": {"reputation": 75362, "user_id": 625403, "user_type": "registered", "accept_rate": 82, "profile_image": "https://www.gravatar.com/avatar/786eed7da67079cb5d63a49d469af25b?s=128&d=identicon&r=PG", "display_name": "amalloy", "link": "https://stackoverflow.com/users/625403/amalloy"}, "is_accepted": false, "score": 3, "last_activity_date": 1493792076, "creation_date": 1493792076, "answer_id": 43752390, "question_id": 43752251, "link": "https://stackoverflow.com/questions/43752251/haskell-parse-error-in-case-statement-involving-lists/43752390#43752390", "title": "Haskell: Parse error in case statement (involving lists!)", "body": "<p><code>case a b of ...</code> does not match against both <code>a</code> and <code>b</code>, but rather matches on the result of calling <code>a</code> as a function, with the argument <code>b</code>. A <code>case</code> expression always matches against exactly one value, and even the first clause (which you think is working) is definitely not working.</p>\n\n<p>To match against two values, you wrap them up in a tuple, and then break apart the tuple in each clause, like so:</p>\n\n<pre><code>case (hs, tree) of\n  ([], (Node _ a b)) -&gt; ...\n  ([h], (Node _ a b)) -&gt; ...\n  ...\n</code></pre>\n"}], "owner": {"reputation": 315, "user_id": 7940372, "user_type": "registered", "accept_rate": 58, "profile_image": "https://www.gravatar.com/avatar/3e5744471a061ee3bf3a29ce9bb5a4a7?s=128&d=identicon&r=PG&f=1", "display_name": "420fedoras", "link": "https://stackoverflow.com/users/7940372/420fedoras"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 248, "favorite_count": 0, "answer_count": 1, "score": 1, "last_activity_date": 1493792076, "creation_date": 1493791591, "question_id": 43752251, "link": "https://stackoverflow.com/questions/43752251/haskell-parse-error-in-case-statement-involving-lists", "title": "Haskell: Parse error in case statement (involving lists!)", "body": "<p>I'm having trouble with (I assume) the types I am working with (for an assignment on huffman coding) in my case statement. I want to work from the top of the tree down to each leaf and return a list of key value pairs. [ ] passes fine, but [h] returns a parse error and I'm not sure why.</p>\n\n<pre><code>type HCode = [Bit]\ndata Bit = L | R deriving (Eq, Show)\ndata Tree a = Leaf Int a | Node Int (Tree a) (Tree a) deriving (Eq)\n\nconvert :: Ord a =&gt; HCode -&gt; Tree a -&gt; [(a,HCode)]\nconvert hs tree =\n  case hs tree of\n    []     (Node _ a b) -&gt; (convert [L]            a)++(convert [R]            b)\n    [h]    (Node _ a b) -&gt; (convert !([h]++[L])    a)++(convert !([h]++[R])    b)\n    (h:hs) (Node _ a b) -&gt; (convert !((h:hs)++[L]) a)++(convert !((h:hs)++[R]) b)\n    [h]    (Leaf _ a)   -&gt; [(a, [h])]\n    (h:hs) (Leaf _ a)   -&gt; [(a, (h:hs))]\n</code></pre>\n\n<p>Also I haven't used bangs before but I think they are appropriate here? Would they have an impact on performance? Am I even using them in the right context?</p>\n"}, {"tags": ["haskell"], "comments": [{"owner": {"reputation": 1589, "user_id": 2535671, "user_type": "registered", "accept_rate": 87, "profile_image": "https://www.gravatar.com/avatar/fca1ba52e0c41803e676d449ef242e75?s=128&d=identicon&r=PG&f=1", "display_name": "Julian Leviston", "link": "https://stackoverflow.com/users/2535671/julian-leviston"}, "edited": false, "score": 0, "creation_date": 1493779912, "post_id": 43750234, "comment_id": 74542982, "body": "By the way, I should say that I know that in TH I can obtain an <code>Info</code>-like thing, which is similar to <code>GHCI</code>&#39;s <code>:info</code> command, which is great for finding all the instances of a typeclass, say, but I don&#39;t know how I could use that to find all the possible available declarations (including imported ones)."}, {"owner": {"reputation": 14781, "user_id": 630160, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/4445f21326af525a8ad19af7e3ae41a8?s=128&d=identicon&r=PG", "display_name": "epsilonhalbe", "link": "https://stackoverflow.com/users/630160/epsilonhalbe"}, "edited": false, "score": 0, "creation_date": 1493791542, "post_id": 43750234, "comment_id": 74546448, "body": "Do you want that info at compile time or at runtime that you pass it a file and get the imports and functions"}, {"owner": {"reputation": 1589, "user_id": 2535671, "user_type": "registered", "accept_rate": 87, "profile_image": "https://www.gravatar.com/avatar/fca1ba52e0c41803e676d449ef242e75?s=128&d=identicon&r=PG&f=1", "display_name": "Julian Leviston", "link": "https://stackoverflow.com/users/2535671/julian-leviston"}, "reply_to_user": {"reputation": 14781, "user_id": 630160, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/4445f21326af525a8ad19af7e3ae41a8?s=128&d=identicon&r=PG", "display_name": "epsilonhalbe", "link": "https://stackoverflow.com/users/630160/epsilonhalbe"}, "edited": false, "score": 0, "creation_date": 1493795177, "post_id": 43750234, "comment_id": 74548209, "body": "@epsilonhalbe No, I know a way to get the imports and functions, as I described. What I want is to get all the declarations that a module can use within its scope (so that includes all the declarations all the way up the tree of dependencies). I don&#39;t care if it&#39;s runtime or compiletime, I don&#39;t think."}, {"owner": {"reputation": 14781, "user_id": 630160, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/4445f21326af525a8ad19af7e3ae41a8?s=128&d=identicon&r=PG", "display_name": "epsilonhalbe", "link": "https://stackoverflow.com/users/630160/epsilonhalbe"}, "edited": false, "score": 0, "creation_date": 1493829766, "post_id": 43750234, "comment_id": 74572676, "body": "I would use ghc as a library for this and maybe take a look at ghcid, ghc-mod to see what they are using. Maybe you need cacal (the library) too. What do you think your function getalltld should return\u200bif you import bytestring stuff but it is not installed on your system. How about qualified imports, records...! I think your question is a bit too broad right now."}, {"owner": {"reputation": 1589, "user_id": 2535671, "user_type": "registered", "accept_rate": 87, "profile_image": "https://www.gravatar.com/avatar/fca1ba52e0c41803e676d449ef242e75?s=128&d=identicon&r=PG&f=1", "display_name": "Julian Leviston", "link": "https://stackoverflow.com/users/2535671/julian-leviston"}, "reply_to_user": {"reputation": 14781, "user_id": 630160, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/4445f21326af525a8ad19af7e3ae41a8?s=128&d=identicon&r=PG", "display_name": "epsilonhalbe", "link": "https://stackoverflow.com/users/630160/epsilonhalbe"}, "edited": false, "score": 0, "creation_date": 1493846128, "post_id": 43750234, "comment_id": 74581717, "body": "I had a bit of an epiphony when I awoke today. To get all definitions in scope is actually as simple as a) getting all the top level definitions of the module under question (which I can do), and b) getting all the exports of the definitions of the imported modules, which I can also do. Nothing else <i>can</i> be in scope, obviously! It&#39;s still not as good as a semantic solution, but I think it will definitely cover me for now at least. By the way, <code>hint</code> <b>is</b> GHC as a library, it&#39;s some convenience stuff over it, in case you didn&#39;t know."}, {"owner": {"reputation": 1589, "user_id": 2535671, "user_type": "registered", "accept_rate": 87, "profile_image": "https://www.gravatar.com/avatar/fca1ba52e0c41803e676d449ef242e75?s=128&d=identicon&r=PG&f=1", "display_name": "Julian Leviston", "link": "https://stackoverflow.com/users/2535671/julian-leviston"}, "reply_to_user": {"reputation": 14781, "user_id": 630160, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/4445f21326af525a8ad19af7e3ae41a8?s=128&d=identicon&r=PG", "display_name": "epsilonhalbe", "link": "https://stackoverflow.com/users/630160/epsilonhalbe"}, "edited": false, "score": 0, "creation_date": 1493846254, "post_id": 43750234, "comment_id": 74581775, "body": "... as to if things aren&#39;t installed on the system, that will be handled by a subsystem of what I&#39;m implementing. That is, a user will only be able to import what <i>is</i> installed on the system, and if one wants something else installed, one will have to run a separate command to do so."}, {"owner": {"reputation": 1979, "user_id": 2789312, "user_type": "registered", "accept_rate": 92, "profile_image": "https://i.stack.imgur.com/4OgOz.png?s=128&g=1", "display_name": "palik", "link": "https://stackoverflow.com/users/2789312/palik"}, "edited": false, "score": 0, "creation_date": 1493930146, "post_id": 43750234, "comment_id": 74625418, "body": "In <a href=\"https://mail.haskell.org/pipermail/haskell-cafe/2017-May/126987.html\" rel=\"nofollow noreferrer\">haskell-cafe</a> appears a post related to the topic"}], "answers": [{"tags": [], "owner": {"reputation": 1589, "user_id": 2535671, "user_type": "registered", "accept_rate": 87, "profile_image": "https://www.gravatar.com/avatar/fca1ba52e0c41803e676d449ef242e75?s=128&d=identicon&r=PG&f=1", "display_name": "Julian Leviston", "link": "https://stackoverflow.com/users/2535671/julian-leviston"}, "is_accepted": true, "score": 0, "last_activity_date": 1495942525, "creation_date": 1495942525, "answer_id": 44223576, "question_id": 43750234, "link": "https://stackoverflow.com/questions/43750234/better-way-to-get-a-list-of-the-top-level-declarations/44223576#44223576", "title": "Better way to get a list of the top level declarations", "body": "<p>Self-answering because it's been a while and I spiked out a proof of concept ages ago, so I'll put it here for others, even if it is fairly messy.</p>\n\n<p>So, assuming we have this file as <code>TestModule.hs</code>:</p>\n\n<pre><code>module TestModule (g, h) where\n\nimport Data.List as L\n\nf = head\n\ng = f [f]\n\nh = L.map\n</code></pre>\n\n<p>Then the following code can be used to show how we can pull out the top level declarations and use them by using <code>Hint</code>'s <code>Language.Haskell.Interpreter</code> module and the <code>Language.Haskell.Exts.SrcLoc</code> module from the <code>haskell-src-exts</code> package:</p>\n\n<pre><code>import Data.List\nimport Control.Monad\nimport qualified Language.Haskell.Interpreter as I\nimport Language.Haskell.Interpreter (Interpreter, GhcError(..), InterpreterError(..))\nimport qualified Language.Haskell.Exts as H\nimport Language.Haskell.Exts.SrcLoc\n\nmain :: IO ()\nmain = do r &lt;- I.runInterpreter interpreterTest\n          case r of\n            Left err -&gt; putStrLn $ errorString err\n            Right () -&gt; return ()\n\nerrorString :: InterpreterError -&gt; String\nerrorString (WontCompile es) = intercalate \"\\n\" (header : map unbox es)\n  where\n    header = \"ERROR: Won't compile:\"\n    unbox (GhcError e) = e\nerrorString e = show e\n\np :: String -&gt; Interpreter ()\np = I.liftIO . putStrLn\n\nemptyLine :: Interpreter ()\nemptyLine = p \"\"\n\ninterpreterTest :: Interpreter ()\ninterpreterTest =\n  do\n    p \"Finding out what the module exports are.\"\n    p \"To do this, we grab the text of the src/TestModule.hs\"\n    moduleContents &lt;- I.liftIO . readFile $ \"src/TestModule.hs\"\n    emptyLine\n    p \"Next, we find what the import module names are, so we can load them\"\n    p \"To do that, we'll parse the contents of src/TestModule.hs as AST\"\n    let\n      parseResult = H.parseModule moduleContents\n      parsedModuleDeclE =\n        case parseResult of\n          H.ParseOk parsed -&gt; Right parsed\n          H.ParseFailed _ errorReason -&gt; Left errorReason\n      (moduleDeclarations, moduleImports) =\n        case parsedModuleDeclE of\n          Left _ -&gt;\n            ([], [])\n          Right (H.Module _ _ _ _ _ importDecls decls) -&gt; (decls, importDecls)\n    p $ show moduleImports\n    emptyLine\n    p \"Now we can pull the module names out of the ImportDecl values:\"\n    let\n      moduleNames =\n        do\n          H.ModuleName s &lt;- fmap H.importModule moduleImports\n          return s\n    p $ show moduleNames\n    emptyLine\n    p \"After this we can obtain a list of the module exports for each of these modules and join them together:\"\n    I.loadModules [\"src/TestModule.hs\"]\n    I.setTopLevelModules [\"TestModule\"]\n    topLevelImportDecls &lt;- fmap concat $ mapM I.getModuleExports moduleNames\n    -- p $ show $ do { I.Fun f &lt;- topLevelImportDecls ; return f } -- filter for functions only\n    p $ show $ fmap I.name topLevelImportDecls\n    emptyLine\n    p \"Then, we can get the top level declarations of the initial module and add them, too:\"\n    -- p $ show moduleDeclarations -- AST in haskell types\n    let\n      localDeclaractions =\n        do\n          (H.PatBind _ (H.PVar (H.Ident declName)) _ _) &lt;- moduleDeclarations\n          return declName\n      availableDeclarations =\n        localDeclaractions ++ fmap I.name topLevelImportDecls\n    p $ show localDeclaractions\n    emptyLine\n    p \"Finally, we have our big list:\"\n    p $ show availableDeclarations\n    emptyLine\n    p \"Now, what about we get all of their types, just for fun?\"\n    typesOfAll &lt;- sequence $ fmap (\\n -&gt; fmap ((n ++ \" :: \") ++) (I.typeOf n)) availableDeclarations\n    p $ Data.List.intercalate \"\\n\" typesOfAll\n    return ()\n</code></pre>\n"}], "owner": {"reputation": 1589, "user_id": 2535671, "user_type": "registered", "accept_rate": 87, "profile_image": "https://www.gravatar.com/avatar/fca1ba52e0c41803e676d449ef242e75?s=128&d=identicon&r=PG&f=1", "display_name": "Julian Leviston", "link": "https://stackoverflow.com/users/2535671/julian-leviston"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 482, "favorite_count": 0, "accepted_answer_id": 44223576, "answer_count": 1, "score": 2, "last_activity_date": 1495942525, "creation_date": 1493779635, "last_edit_date": 1493780507, "question_id": 43750234, "link": "https://stackoverflow.com/questions/43750234/better-way-to-get-a-list-of-the-top-level-declarations", "title": "Better way to get a list of the top level declarations", "body": "<p>I have a module called <code>EditorTest</code> in a similarly-named file.</p>\n\n<p>It imports some modules. It also has some declarations in it, as any Haskell module does.</p>\n\n<p>I'd like to programmatically obtain a list of the top level <strong>available</strong> declarations within the context of that module.</p>\n\n<p>What I have so far is a way to get the top level <em>local</em> declarations of this module only, by using <code>hint</code>. That's fine, and I figure I could recurse the imports (and so on into those modules, etc), collecting a list of them, then use hint to grab all the available declaration names... but if possible, I'm after an easier way to find the available declarations in a given module. I figure Haskell's API should have some way to do that.</p>\n\n<p>Is there such a thing?</p>\n"}, {"tags": ["haskell", "yesod", "monad-transformers"], "comments": [{"owner": {"reputation": 40537, "user_id": 465378, "user_type": "registered", "accept_rate": 85, "profile_image": "https://www.gravatar.com/avatar/c03b8d34978563858020eff0d14cc17b?s=128&d=identicon&r=PG", "display_name": "Alexis King", "link": "https://stackoverflow.com/users/465378/alexis-king"}, "edited": false, "score": 0, "creation_date": 1493766536, "post_id": 43748598, "comment_id": 74540279, "body": "Try using <a href=\"https://hackage.haskell.org/package/lifted-base-0.2.3.10/docs/Control-Exception-Lifted.html#v:catch\" rel=\"nofollow noreferrer\">the version of <code>catch</code> from the lifted-base package</a>."}, {"owner": {"reputation": 4538, "user_id": 499478, "user_type": "registered", "accept_rate": 63, "profile_image": "https://www.gravatar.com/avatar/791526e67831fbd70e3d179a6c585b44?s=128&d=identicon&r=PG", "display_name": "Wizek", "link": "https://stackoverflow.com/users/499478/wizek"}, "reply_to_user": {"reputation": 40537, "user_id": 465378, "user_type": "registered", "accept_rate": 85, "profile_image": "https://www.gravatar.com/avatar/c03b8d34978563858020eff0d14cc17b?s=128&d=identicon&r=PG", "display_name": "Alexis King", "link": "https://stackoverflow.com/users/465378/alexis-king"}, "edited": false, "score": 0, "creation_date": 1493766673, "post_id": 43748598, "comment_id": 74540312, "body": "@AlexisKing Thanks, giving that a try."}, {"owner": {"reputation": 4538, "user_id": 499478, "user_type": "registered", "accept_rate": 63, "profile_image": "https://www.gravatar.com/avatar/791526e67831fbd70e3d179a6c585b44?s=128&d=identicon&r=PG", "display_name": "Wizek", "link": "https://stackoverflow.com/users/499478/wizek"}, "reply_to_user": {"reputation": 40537, "user_id": 465378, "user_type": "registered", "accept_rate": 85, "profile_image": "https://www.gravatar.com/avatar/c03b8d34978563858020eff0d14cc17b?s=128&d=identicon&r=PG", "display_name": "Alexis King", "link": "https://stackoverflow.com/users/465378/alexis-king"}, "edited": false, "score": 0, "creation_date": 1493766783, "post_id": 43748598, "comment_id": 74540332, "body": "@AlexisKing I get the exact same type error: <code>Couldn&#39;t match type \u2018(-&gt;) e0\u2019 with \u2018IO\u2019</code>"}, {"owner": {"reputation": 4538, "user_id": 499478, "user_type": "registered", "accept_rate": 63, "profile_image": "https://www.gravatar.com/avatar/791526e67831fbd70e3d179a6c585b44?s=128&d=identicon&r=PG", "display_name": "Wizek", "link": "https://stackoverflow.com/users/499478/wizek"}, "reply_to_user": {"reputation": 40537, "user_id": 465378, "user_type": "registered", "accept_rate": 85, "profile_image": "https://www.gravatar.com/avatar/c03b8d34978563858020eff0d14cc17b?s=128&d=identicon&r=PG", "display_name": "Alexis King", "link": "https://stackoverflow.com/users/465378/alexis-king"}, "edited": false, "score": 0, "creation_date": 1493767017, "post_id": 43748598, "comment_id": 74540381, "body": "@AlexisKing Nevermind that. I was just missing the argument: <code>(\\(e ::  SomeException) -&gt; r400)</code>."}, {"owner": {"reputation": 4538, "user_id": 499478, "user_type": "registered", "accept_rate": 63, "profile_image": "https://www.gravatar.com/avatar/791526e67831fbd70e3d179a6c585b44?s=128&d=identicon&r=PG", "display_name": "Wizek", "link": "https://stackoverflow.com/users/499478/wizek"}, "reply_to_user": {"reputation": 40537, "user_id": 465378, "user_type": "registered", "accept_rate": 85, "profile_image": "https://www.gravatar.com/avatar/c03b8d34978563858020eff0d14cc17b?s=128&d=identicon&r=PG", "display_name": "Alexis King", "link": "https://stackoverflow.com/users/465378/alexis-king"}, "edited": false, "score": 0, "creation_date": 1493767079, "post_id": 43748598, "comment_id": 74540395, "body": "I guess it just wasn&#39;t clear at first glance from the type error for either of us :)"}, {"owner": {"reputation": 4538, "user_id": 499478, "user_type": "registered", "accept_rate": 63, "profile_image": "https://www.gravatar.com/avatar/791526e67831fbd70e3d179a6c585b44?s=128&d=identicon&r=PG", "display_name": "Wizek", "link": "https://stackoverflow.com/users/499478/wizek"}, "reply_to_user": {"reputation": 40537, "user_id": 465378, "user_type": "registered", "accept_rate": 85, "profile_image": "https://www.gravatar.com/avatar/c03b8d34978563858020eff0d14cc17b?s=128&d=identicon&r=PG", "display_name": "Alexis King", "link": "https://stackoverflow.com/users/465378/alexis-king"}, "edited": false, "score": 0, "creation_date": 1493767125, "post_id": 43748598, "comment_id": 74540411, "body": "Oh, and while it works with <code>lifted-base</code> too, It works without it as well."}], "answers": [{"tags": [], "owner": {"reputation": 4538, "user_id": 499478, "user_type": "registered", "accept_rate": 63, "profile_image": "https://www.gravatar.com/avatar/791526e67831fbd70e3d179a6c585b44?s=128&d=identicon&r=PG", "display_name": "Wizek", "link": "https://stackoverflow.com/users/499478/wizek"}, "is_accepted": true, "score": 2, "last_activity_date": 1493767259, "creation_date": 1493767259, "answer_id": 43748715, "question_id": 43748598, "link": "https://stackoverflow.com/questions/43748598/how-can-i-catch-an-exception-within-a-yesod-handler/43748715#43748715", "title": "How can I `catch` an exception within a Yesod Handler?", "body": "<p>I was just missing the argument for <code>catch</code>:</p>\n\n<pre><code>foos &lt;- (return $ map (encode .&gt; cs .&gt; jsonToFoo body)\n  `catch` (\\(e :: SomeException) -&gt; r400)\n</code></pre>\n\n<p>Too bad it wasn't more apparent for me from the type error.</p>\n"}], "owner": {"reputation": 4538, "user_id": 499478, "user_type": "registered", "accept_rate": 63, "profile_image": "https://www.gravatar.com/avatar/791526e67831fbd70e3d179a6c585b44?s=128&d=identicon&r=PG", "display_name": "Wizek", "link": "https://stackoverflow.com/users/499478/wizek"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 185, "favorite_count": 1, "accepted_answer_id": 43748715, "answer_count": 1, "score": 0, "last_activity_date": 1493767259, "creation_date": 1493766425, "question_id": 43748598, "link": "https://stackoverflow.com/questions/43748598/how-can-i-catch-an-exception-within-a-yesod-handler", "title": "How can I `catch` an exception within a Yesod Handler?", "body": "<p>When I tried:</p>\n\n<pre><code>foos &lt;- (return $ map (encode .&gt; cs .&gt; jsonToFoo body) `catch` r400\n</code></pre>\n\n<p>I got the following type error:</p>\n\n<pre><code>/path/to/File.hs:47:78: error:\n    \u2022 Couldn't match type \u2018(-&gt;) e0\u2019 with \u2018IO\u2019\n        arising from a functional dependency between:\n          constraint \u2018MonadBase IO ((-&gt;) e0)\u2019 arising from a use of \u2018r400\u2019\n          instance \u2018MonadBase ((-&gt;) r) ((-&gt;) r)\u2019 at &lt;no location info&gt;\n    \u2022 In the second argument of \u2018catch\u2019, namely \u2018r400\u2019\n      In a stmt of a 'do' block:\n        foos &lt;- (return $ map (encode .&gt; cs .&gt; jsonToFoo) body)\n                `catch` r400\n      In the expression:\n        do { (body :: [Value]) &lt;- requireJsonBody;\n             foos &lt;- (return $ map (encode .&gt; cs .&gt; jsonToFoo) body)\n                     `catch` r400;\n             .... }\n</code></pre>\n\n<p>If there is a way, it involves <code>liftIO</code>, doesn't it? </p>\n"}, {"tags": ["haskell", "recursion", "functional-programming", "tail-recursion"], "comments": [{"owner": {"reputation": 314794, "user_id": 67579, "user_type": "registered", "accept_rate": 81, "profile_image": "https://i.stack.imgur.com/BJXub.png?s=128&g=1", "display_name": "Willem Van Onsem", "link": "https://stackoverflow.com/users/67579/willem-van-onsem"}, "edited": false, "score": 3, "creation_date": 1493752747, "post_id": 43745611, "comment_id": 74534199, "body": "Euh that&#39;s not the syntax for calling a function in Haskell."}, {"owner": {"reputation": 654, "user_id": 7501619, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/dfb3e55ff104cf8485859d00fc6ecbcb?s=128&d=identicon&r=PG&f=1", "display_name": "Taren", "link": "https://stackoverflow.com/users/7501619/taren"}, "edited": false, "score": 0, "creation_date": 1493824070, "post_id": 43745611, "comment_id": 74568898, "body": "You don&#39;t really have to care but it might be interesting to you that even the tail recursive variant consumes memory for each step. Because haskell is lazy this builds up a huge computation like <code>0+500000+499999+499998...</code> which is only executed after we are done recurring. The fix would be to use seq/bang patterns or use some other source of strictness like <code>foldl&#39; (+) 0</code>."}], "answers": [{"comments": [{"owner": {"reputation": 175, "user_id": 7137698, "user_type": "registered", "accept_rate": 0, "profile_image": "https://www.gravatar.com/avatar/73a2bcd04ae13a5ea09112f4bbc6cd4c?s=128&d=identicon&r=PG&f=1", "display_name": "Anil ", "link": "https://stackoverflow.com/users/7137698/anil"}, "edited": false, "score": 1, "creation_date": 1493753652, "post_id": 43745668, "comment_id": 74534623, "body": "Thank you helped me a lot. We started recently with Haskell at the university and I am new to this functional programming."}, {"owner": {"reputation": 507143, "user_id": 1048572, "user_type": "registered", "accept_rate": 77, "profile_image": "https://www.gravatar.com/avatar/7f2c4de95e8f4f8f5a71c3aaf0ed312a?s=128&d=identicon&r=PG", "display_name": "Bergi", "link": "https://stackoverflow.com/users/1048572/bergi"}, "edited": false, "score": 1, "creation_date": 1493813713, "post_id": 43745668, "comment_id": 74560618, "body": "It&#39;s confusing though to pass <code>x</code> to the <code>y</code> parameter."}, {"owner": {"reputation": 314794, "user_id": 67579, "user_type": "registered", "accept_rate": 81, "profile_image": "https://i.stack.imgur.com/BJXub.png?s=128&g=1", "display_name": "Willem Van Onsem", "link": "https://stackoverflow.com/users/67579/willem-van-onsem"}, "reply_to_user": {"reputation": 507143, "user_id": 1048572, "user_type": "registered", "accept_rate": 77, "profile_image": "https://www.gravatar.com/avatar/7f2c4de95e8f4f8f5a71c3aaf0ed312a?s=128&d=identicon&r=PG", "display_name": "Bergi", "link": "https://stackoverflow.com/users/1048572/bergi"}, "edited": false, "score": 1, "creation_date": 1493813865, "post_id": 43745668, "comment_id": 74560738, "body": "@Bergi: Indeed. I did not take a look at the variable names. I modified the code."}], "tags": [], "owner": {"reputation": 314794, "user_id": 67579, "user_type": "registered", "accept_rate": 81, "profile_image": "https://i.stack.imgur.com/BJXub.png?s=128&g=1", "display_name": "Willem Van Onsem", "link": "https://stackoverflow.com/users/67579/willem-van-onsem"}, "is_accepted": false, "score": 5, "last_activity_date": 1493817756, "last_edit_date": 1495539195, "creation_date": 1493752912, "answer_id": 43745668, "question_id": 43745611, "link": "https://stackoverflow.com/questions/43745611/where-is-the-mistake-in-this-tail-recursive-haskell-function/43745668#43745668", "title": "Where is the mistake in this tail recursive Haskell function?", "body": "<p>Your line:</p>\n\n<pre><code>help x y = if y==0 then x else <b>help(x+y,y-1)</b></code></pre>\n\n<p>is not the correct syntax for calling a function. Because here the Haskell compiler will interpret it as:</p>\n\n<pre><code>help x y = if y==0 then x else help <b>(x+y,y-1)</b>\n--                                  ^ a tuple</code></pre>\n\n<p>Instead you should write:</p>\n\n<pre><code>help x y = if y==0 then x else help <b>(x+y) (y-1)</b>\n--                                  ^ two arguments</code></pre>\n\n<p>Furthermore you can also use guards, like:</p>\n\n<pre><code>helper x y | y == 0 = x\n           | otherwise = help (x+y) (y-1)\n</code></pre>\n\n<p>Finally there is also an error in the first line of <code>sum2</code>. It should be <code>x</code> instead of <code>y</code>:</p>\n\n<pre><code>sum2 x = help 0 <b>x</b></code></pre>\n\n<p>So in full, we get:</p>\n\n<pre><code>sum2 x = help 0 x\nhelper s x | x == 0 = s\n           | otherwise = help (s+x) (x-1)\n</code></pre>\n\n<p>I also renamed <code>y</code> in the <code>helper</code> to <code>x</code> and <code>x</code> to <code>s</code> (as in <code>s</code>um) to make it less confusing (kudos to <a href=\"https://stackoverflow.com/questions/43745611/where-is-the-mistake-in-this-tail-recursive-haskell-function/43745668?noredirect=1#comment74560618_43745668\">@Bergi</a> for commenting on this).</p>\n\n<p>Or use an <em>eta reduction</em>:</p>\n\n<pre><code>sum2 = help 0</code></pre>\n\n<p>Finally note that you do not need recursion for this. An implementation that would work faster is the following:</p>\n\n<pre><code>sum3 x = div (x*(x+1)) 2\n</code></pre>\n\n<p>Since:</p>\n\n<pre> n\n---\n\\       (n+1) n\n/   i = -------\n---        2\ni=1</pre>\n"}], "owner": {"reputation": 175, "user_id": 7137698, "user_type": "registered", "accept_rate": 0, "profile_image": "https://www.gravatar.com/avatar/73a2bcd04ae13a5ea09112f4bbc6cd4c?s=128&d=identicon&r=PG&f=1", "display_name": "Anil ", "link": "https://stackoverflow.com/users/7137698/anil"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 211, "favorite_count": 0, "answer_count": 1, "score": 1, "last_activity_date": 1493817756, "creation_date": 1493752681, "last_edit_date": 1493813372, "question_id": 43745611, "link": "https://stackoverflow.com/questions/43745611/where-is-the-mistake-in-this-tail-recursive-haskell-function", "title": "Where is the mistake in this tail recursive Haskell function?", "body": "<p>I have to implement a sum function in Haskell in two ways. One function with tail recursion and the other without tail recursion.</p>\n\n<p>Here is the one without tail recursion and it works perfectly</p>\n\n<pre><code>sum1 x = if x==0 then 0 else x + sum1(x-1)\n</code></pre>\n\n<p>Here is my attempt with tail recursion and it doesn't work:</p>\n\n<pre><code>sum2 x = help 0 y\nhelp x y = if y==0 then x else help(x+y,y-1)\n</code></pre>\n\n<p>Can someone point out the mistake?</p>\n"}, {"tags": ["haskell"], "comments": [{"owner": {"reputation": 51584, "user_id": 839246, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/9b0573c2b936b12828dd1e4cc04206dc?s=128&d=identicon&r=PG&f=1", "display_name": "bheklilr", "link": "https://stackoverflow.com/users/839246/bheklilr"}, "edited": false, "score": 1, "creation_date": 1493749932, "post_id": 43744636, "comment_id": 74532584, "body": "Consider the simplest shift, just taking the head and placing it after the tail.  This can be accomplished pretty easily with pattern matching.  Then take a look at the <code>iterate</code> function, it will repeatedly apply a function to an input, so <code>iterate (+1) 0</code> returns <code>[0, 1, 2, 3, 4, ...]</code>.  How can you use it to your advantage?"}, {"owner": {"reputation": 57219, "user_id": 33796, "user_type": "registered", "accept_rate": 70, "profile_image": "https://www.gravatar.com/avatar/08727b23ba62e634b32988cdff082663?s=128&d=identicon&r=PG", "display_name": "luqui", "link": "https://stackoverflow.com/users/33796/luqui"}, "edited": false, "score": 0, "creation_date": 1493755220, "post_id": 43744636, "comment_id": 74535480, "body": "In <code>rot</code>, you are giving <code>reverseWords</code> two arguments, but it only takes one.  Also, I don&#39;t know what rotating has to do with reversing.  I think you want to break the string up into a list of words and then call <code>shiftt</code> on that list."}], "answers": [{"tags": [], "owner": {"reputation": 62252, "user_id": 1435869, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/TrEd9.jpg?s=128&g=1", "display_name": "karakfa", "link": "https://stackoverflow.com/users/1435869/karakfa"}, "is_accepted": false, "score": 0, "last_activity_date": 1493756584, "creation_date": 1493756584, "answer_id": 43746605, "question_id": 43744636, "link": "https://stackoverflow.com/questions/43744636/rotate-a-string-in-haskell-with-some-exceptions/43746605#43746605", "title": "rotate a string in haskell with some exceptions", "body": "<p>create a list of all rotations, then filter out based on your predicate.  For example,</p>\n\n<pre><code>rotations x = take (length x) $ iterate rot1 x\n        where rot1 = drop 1 x ++ take 1 x\n\n\nfilteredRots = map unwords . filter (\\x -&gt; length (head x) &gt; 2) . rotations . words\n</code></pre>\n\n<p>and use as </p>\n\n<pre><code>&gt; filteredRots \"Now I want to scream\"\n\n[\"Now I want to scream\",\"want to scream Now I\",\"scream Now I want to\"]\n</code></pre>\n\n<p>Prelude></p>\n"}], "owner": {"reputation": 47, "user_id": 7699349, "user_type": "registered", "accept_rate": 0, "profile_image": "https://www.gravatar.com/avatar/366e6c514b0f542fe75e20e7222e115f?s=128&d=identicon&r=PG", "display_name": "Bob", "link": "https://stackoverflow.com/users/7699349/bob"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 233, "favorite_count": 0, "answer_count": 1, "score": 0, "last_activity_date": 1493756584, "creation_date": 1493749013, "question_id": 43744636, "link": "https://stackoverflow.com/questions/43744636/rotate-a-string-in-haskell-with-some-exceptions", "title": "rotate a string in haskell with some exceptions", "body": "<p>I want to rotate a string in haskell, so if I give \"Now I  want to scream\" to rotate [[want to scream now I],[scream now I want to]] , if the string start with \"I\" or \"to\" then must eliminate it. Till now I still have problems with the rotation. </p>\n\n<pre><code>reverseWords :: String -&gt; String\nreverseWords = unwords . reverse . words\n\nshiftt :: [a] -&gt; Int -&gt; [a]\nshiftt l n = drop n l  ++ take n l\n\nrot::String-&gt;[String]\nrot l = [ reverseWords l i | i &lt;- [0 .. (length l) -1]]\n</code></pre>\n"}, {"tags": ["haskell", "recursion", "scope", "tail-recursion"], "comments": [{"owner": {"reputation": 314794, "user_id": 67579, "user_type": "registered", "accept_rate": 81, "profile_image": "https://i.stack.imgur.com/BJXub.png?s=128&g=1", "display_name": "Willem Van Onsem", "link": "https://stackoverflow.com/users/67579/willem-van-onsem"}, "edited": false, "score": 2, "creation_date": 1493747330, "post_id": 43744172, "comment_id": 74531175, "body": "In your line <code>zum n = add_sum m n</code> where do you define <code>m</code>?"}, {"owner": {"reputation": 97, "user_id": 7953486, "user_type": "registered", "accept_rate": 80, "profile_image": "https://www.gravatar.com/avatar/aca02eb0d7689dc6bd0a38698146f482?s=128&d=identicon&r=PG&f=1", "display_name": "Pelin", "link": "https://stackoverflow.com/users/7953486/pelin"}, "reply_to_user": {"reputation": 314794, "user_id": 67579, "user_type": "registered", "accept_rate": 81, "profile_image": "https://i.stack.imgur.com/BJXub.png?s=128&g=1", "display_name": "Willem Van Onsem", "link": "https://stackoverflow.com/users/67579/willem-van-onsem"}, "edited": false, "score": 0, "creation_date": 1493747935, "post_id": 43744172, "comment_id": 74531529, "body": "ahh, yes! thanks! It is that line. I  found the problem!  It should be: zum n = add_sum 0 n where"}, {"owner": {"reputation": 61419, "user_id": 849891, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/MbEO3.png?s=128&g=1", "display_name": "Will Ness", "link": "https://stackoverflow.com/users/849891/will-ness"}, "edited": false, "score": 2, "creation_date": 1493748004, "post_id": 43744172, "comment_id": 74531562, "body": "good. you can add an answer (it is allowed) and accept it, to mark the issue resolved."}, {"owner": {"reputation": 97, "user_id": 7953486, "user_type": "registered", "accept_rate": 80, "profile_image": "https://www.gravatar.com/avatar/aca02eb0d7689dc6bd0a38698146f482?s=128&d=identicon&r=PG&f=1", "display_name": "Pelin", "link": "https://stackoverflow.com/users/7953486/pelin"}, "edited": false, "score": 0, "creation_date": 1493748718, "post_id": 43744172, "comment_id": 74531949, "body": "done! thanks again."}, {"owner": {"reputation": 2567, "user_id": 994206, "user_type": "registered", "accept_rate": 84, "profile_image": "https://www.gravatar.com/avatar/699bacad8f85a069dda312cc29e03baa?s=128&d=identicon&r=PG", "display_name": "Mokosha", "link": "https://stackoverflow.com/users/994206/mokosha"}, "edited": false, "score": 0, "creation_date": 1493748783, "post_id": 43744172, "comment_id": 74531994, "body": "I&#39;m not sure that this is tail-recursive, by the way. The compiler might be smart enough to recognize it, but using guards is syntactic sugar for a large if/else expression. Someone can correct me if I&#39;m wrong, but I think your function will expand to <code>if n == 0 then m else if (n - 1) == 0 then m+1 else if ...</code>. More info <a href=\"http://stackoverflow.com/questions/4092864/tail-recursion-in-haskell\">here</a>. You want to define <code>add_sum</code> in a way that it matches against the arguments rather than using guards."}, {"owner": {"reputation": 97, "user_id": 7953486, "user_type": "registered", "accept_rate": 80, "profile_image": "https://www.gravatar.com/avatar/aca02eb0d7689dc6bd0a38698146f482?s=128&d=identicon&r=PG&f=1", "display_name": "Pelin", "link": "https://stackoverflow.com/users/7953486/pelin"}, "reply_to_user": {"reputation": 2567, "user_id": 994206, "user_type": "registered", "accept_rate": 84, "profile_image": "https://www.gravatar.com/avatar/699bacad8f85a069dda312cc29e03baa?s=128&d=identicon&r=PG", "display_name": "Mokosha", "link": "https://stackoverflow.com/users/994206/mokosha"}, "edited": false, "score": 0, "creation_date": 1493756827, "post_id": 43744172, "comment_id": 74536369, "body": "@Mokosha hmm, I hesitate now too. I will read a bit more about it."}], "answers": [{"tags": [], "owner": {"reputation": 62252, "user_id": 1435869, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/TrEd9.jpg?s=128&g=1", "display_name": "karakfa", "link": "https://stackoverflow.com/users/1435869/karakfa"}, "is_accepted": false, "score": 0, "last_activity_date": 1493748807, "creation_date": 1493748807, "answer_id": 43744577, "question_id": 43744172, "link": "https://stackoverflow.com/questions/43744172/variable-not-in-scope-tail-recursive-sum-haskell/43744577#43744577", "title": "variable not in scope - tail recursive sum - Haskell", "body": "<p>perhaps cleaner this way?</p>\n\n<pre><code>sum n = go 0 n\n     where go m 0 = m\n           go m n = go (m+n) (n-1)\n\n\n&gt; sum 4\n10\n</code></pre>\n"}, {"tags": [], "owner": {"reputation": 66, "user_id": 7954509, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/fc539b417a3a7adb3ef62c0841bfa70f?s=128&d=identicon&r=PG&f=1", "display_name": "GrainOfSalt", "link": "https://stackoverflow.com/users/7954509/grainofsalt"}, "is_accepted": false, "score": 1, "last_activity_date": 1493840082, "creation_date": 1493840082, "answer_id": 43768548, "question_id": 43744172, "link": "https://stackoverflow.com/questions/43744172/variable-not-in-scope-tail-recursive-sum-haskell/43768548#43768548", "title": "variable not in scope - tail recursive sum - Haskell", "body": "<p>In the second line of your code </p>\n\n<pre><code>zum n = add_sum m n where\n</code></pre>\n\n<p>'m' is not defined. Perhaps it was intended that instead of an 'm', there needs to be 0 there.</p>\n"}], "owner": {"reputation": 97, "user_id": 7953486, "user_type": "registered", "accept_rate": 80, "profile_image": "https://www.gravatar.com/avatar/aca02eb0d7689dc6bd0a38698146f482?s=128&d=identicon&r=PG&f=1", "display_name": "Pelin", "link": "https://stackoverflow.com/users/7953486/pelin"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 265, "favorite_count": 0, "answer_count": 2, "score": 0, "last_activity_date": 1493840082, "creation_date": 1493747265, "last_edit_date": 1493800741, "question_id": 43744172, "link": "https://stackoverflow.com/questions/43744172/variable-not-in-scope-tail-recursive-sum-haskell", "title": "variable not in scope - tail recursive sum - Haskell", "body": "<p>I am stuck with the <code>variable not in scope: m</code> error. \nThis is supposed to be a code to sum n numbers in a tail recursion way. </p>\n\n<pre><code>zum :: Integer-&gt; Integer \nzum n = add_sum m n where\nadd_sum :: Integer-&gt; Integer-&gt; Integer\nadd_sum m n\n    | n == 0    = m\n    | otherwise = add_sum (m+n) (n-1)\n</code></pre>\n"}, {"tags": ["haskell", "yesod", "haskell-stack", "haskell-warp"], "comments": [{"owner": {"reputation": 24028, "user_id": 383200, "user_type": "registered", "accept_rate": 60, "profile_image": "https://www.gravatar.com/avatar/a9dc722f936cb1059adaae4fe39c07f0?s=128&d=identicon&r=PG", "display_name": "Carl", "link": "https://stackoverflow.com/users/383200/carl"}, "edited": false, "score": 0, "creation_date": 1493819748, "post_id": 43744025, "comment_id": 74565450, "body": "Are you sure that header has been updated in the github version?"}, {"owner": {"reputation": 69847, "user_id": 3853934, "user_type": "registered", "accept_rate": 88, "profile_image": "https://i.stack.imgur.com/GtQuz.jpg?s=128&g=1", "display_name": "Micha\u0142 Per\u0142akowski", "link": "https://stackoverflow.com/users/3853934/micha%c5%82-per%c5%82akowski"}, "reply_to_user": {"reputation": 24028, "user_id": 383200, "user_type": "registered", "accept_rate": 60, "profile_image": "https://www.gravatar.com/avatar/a9dc722f936cb1059adaae4fe39c07f0?s=128&d=identicon&r=PG", "display_name": "Carl", "link": "https://stackoverflow.com/users/383200/carl"}, "edited": false, "score": 0, "creation_date": 1493821354, "post_id": 43744025, "comment_id": 74566751, "body": "@Carl I think it displays the version from the <code>.cabal</code> file, and the version has been updated there."}], "answers": [{"tags": [], "owner": {"reputation": 69847, "user_id": 3853934, "user_type": "registered", "accept_rate": 88, "profile_image": "https://i.stack.imgur.com/GtQuz.jpg?s=128&g=1", "display_name": "Micha\u0142 Per\u0142akowski", "link": "https://stackoverflow.com/users/3853934/micha%c5%82-per%c5%82akowski"}, "is_accepted": true, "score": 0, "last_activity_date": 1493848171, "creation_date": 1493848171, "answer_id": 43770572, "question_id": 43744025, "link": "https://stackoverflow.com/questions/43744025/force-yesod-to-use-newer-version-of-warp/43770572#43770572", "title": "Force Yesod to use newer version of Warp", "body": "<p>I have been using <code>stack exec -- yesod devel</code> to run my server, and apparently this was causing the problem. When I run the executable built by stack, it works fine.</p>\n"}], "owner": {"reputation": 69847, "user_id": 3853934, "user_type": "registered", "accept_rate": 88, "profile_image": "https://i.stack.imgur.com/GtQuz.jpg?s=128&g=1", "display_name": "Micha\u0142 Per\u0142akowski", "link": "https://stackoverflow.com/users/3853934/micha%c5%82-per%c5%82akowski"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 50, "favorite_count": 0, "accepted_answer_id": 43770572, "answer_count": 1, "score": 0, "last_activity_date": 1493848171, "creation_date": 1493746627, "question_id": 43744025, "link": "https://stackoverflow.com/questions/43744025/force-yesod-to-use-newer-version-of-warp", "title": "Force Yesod to use newer version of Warp", "body": "<p>I installed Yesod using Stack. It currently uses Warp v3.2.11.1, but I want it to use <a href=\"https://github.com/yesodweb/wai/tree/master/warp\" rel=\"nofollow noreferrer\">the latest version available on GitHub</a> (it hasn't been released yet). I added the following to my <code>stack.yaml</code> file:</p>\n\n<pre class=\"lang-yaml prettyprint-override\"><code>packages:\n- '.'\n- location:\n    git: git@github.com:yesodweb/wai.git\n    commit: 9fd0dcf221e4946d3588eea3ccd87492ca718d6a\n  extra-dep: true\n  subdirs:\n    - warp\n</code></pre>\n\n<p>When I import Warp in <code>Application.hs</code> and print the Warp version, I get 3.2.11.2, but when I make HTTP requests to my server, the \"Server\" response header is \"Warp/3.2.11.1\", which means that Yesod is still using the old version of Warp. How can I force Yesod to use the newer version?</p>\n"}, {"tags": ["haskell"], "comments": [{"owner": {"reputation": 35578, "user_id": 3000206, "user_type": "registered", "accept_rate": 98, "profile_image": "https://i.stack.imgur.com/BK1fo.jpg?s=128&g=1", "display_name": "Carcigenicate", "link": "https://stackoverflow.com/users/3000206/carcigenicate"}, "edited": false, "score": 4, "creation_date": 1493733389, "post_id": 43739760, "comment_id": 74522367, "body": "Do you mean &quot;pipe&quot;? And have you read a tutorial on comprehensions? Any decent guide will surely cover this."}], "answers": [{"comments": [{"owner": {"reputation": 14781, "user_id": 630160, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/4445f21326af525a8ad19af7e3ae41a8?s=128&d=identicon&r=PG", "display_name": "epsilonhalbe", "link": "https://stackoverflow.com/users/630160/epsilonhalbe"}, "edited": false, "score": 1, "creation_date": 1493741922, "post_id": 43739963, "comment_id": 74528283, "body": "this notation is heavily inspired by mathematical set notation see <a href=\"https://wikimedia.org/api/rest_v1/media/math/render/svg/19e5efdbd0e7c51808d2a463128b2cdf2afb8ff4\" rel=\"nofollow noreferrer\">wikimedia.org/api/rest_v1/media/math/render/svg/&hellip;</a> (definition of a torus)."}], "tags": [], "owner": {"reputation": 2677, "user_id": 5244950, "user_type": "registered", "accept_rate": 76, "profile_image": "https://i.stack.imgur.com/8iSIn.png?s=128&g=1", "display_name": "AJ_", "link": "https://stackoverflow.com/users/5244950/aj"}, "is_accepted": false, "score": 2, "last_activity_date": 1493733961, "creation_date": 1493733961, "answer_id": 43739963, "question_id": 43739760, "link": "https://stackoverflow.com/questions/43739760/what-does-pipe-symbol-mean/43739963#43739963", "title": "What does pipe symbol mean?", "body": "<p>Its expression/syntax for list comprehensions. An easy example is the following, </p>\n\n<pre><code>import Data.Char (toUpper)\n[toUpper c | c &lt;- s]\n</code></pre>\n\n<p>You pass a string (list of chars), [ s ],  \"Hello\", to the generator [ c &lt;- s ] , this feeds each character of s to the left-hand expression [ toUpper c ], building a new list. The result of this list comprehension would be \"HELLO\". </p>\n"}], "owner": {"reputation": 1, "user_id": 4039485, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/42a5da06280a2885b2bae48ac29849f1?s=128&d=identicon&r=PG&f=1", "display_name": "Rozza Smith", "link": "https://stackoverflow.com/users/4039485/rozza-smith"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 1172, "favorite_count": 0, "answer_count": 1, "score": -4, "last_activity_date": 1493755662, "creation_date": 1493733319, "last_edit_date": 1493755662, "question_id": 43739760, "link": "https://stackoverflow.com/questions/43739760/what-does-pipe-symbol-mean", "title": "What does pipe symbol mean?", "body": "<p>The following is the haskell comprehensions, what I don't understand is the pipe symbol. What does it mean and what is its role in the function?</p>\n\n<pre><code>boomBangs xs = [ if x &lt; 10 then \"BOOM!\" else \"BANG!\" | x &lt;- xs, odd x]\n\nghci&gt; let xxs = [[1,3,5,2,3,1,2,4,5],[1,2,3,4,5,6,7,8,9],[1,2,4,2,1,6,3,1,3,2,3,6]]  \n\nghci&gt; [ [ x | x &lt;- xs, even x ] | xs &lt;- xxs] \n\n[[2,2,4],[2,4,6,8],[2,4,2,6,2,6]]\n</code></pre>\n"}, {"tags": ["haskell", "evaluation"], "answers": [{"comments": [{"owner": {"reputation": 670, "user_id": 7781818, "user_type": "registered", "accept_rate": 80, "profile_image": "https://www.gravatar.com/avatar/13f5392f913a0f47fab3e6719bda4b08?s=128&d=identicon&r=PG&f=1", "display_name": "Chris", "link": "https://stackoverflow.com/users/7781818/chris"}, "edited": false, "score": 0, "creation_date": 1493729725, "post_id": 43738261, "comment_id": 74519746, "body": "Thanks a lot, you say that &quot;by default&quot; functions are not memoized. If I wanted one to be how would I tell ghc? (also I edited the wrong type-signature)"}, {"owner": {"reputation": 100892, "user_id": 745903, "user_type": "registered", "accept_rate": 74, "profile_image": "https://www.gravatar.com/avatar/50933f6638836741e620669b3940410e?s=128&d=identicon&r=PG", "display_name": "leftaroundabout", "link": "https://stackoverflow.com/users/745903/leftaroundabout"}, "reply_to_user": {"reputation": 670, "user_id": 7781818, "user_type": "registered", "accept_rate": 80, "profile_image": "https://www.gravatar.com/avatar/13f5392f913a0f47fab3e6719bda4b08?s=128&d=identicon&r=PG&f=1", "display_name": "Chris", "link": "https://stackoverflow.com/users/7781818/chris"}, "edited": false, "score": 0, "creation_date": 1493729998, "post_id": 43738261, "comment_id": 74519943, "body": "That&#39;s a bit of a different topic, but one simple and reliable way to achieve memoisation of a function is to wrap it in <a href=\"http://hackage.haskell.org/package/MemoTrie-0.6.7/docs/Data-MemoTrie.html#v:memo\" rel=\"nofollow noreferrer\"><code>memo</code></a> from the MemoTrie library."}, {"owner": {"reputation": 654, "user_id": 7501619, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/dfb3e55ff104cf8485859d00fc6ecbcb?s=128&d=identicon&r=PG&f=1", "display_name": "Taren", "link": "https://stackoverflow.com/users/7501619/taren"}, "edited": false, "score": 5, "creation_date": 1493737389, "post_id": 43738261, "comment_id": 74525362, "body": "If e1 doesn&#39;t depend on either a or b I&#39;d expect ghc to float it out so it is memoized, at least with -O2. Edit: Even with -O it floats the entire rhs to the top level: <code>f2 :: Int; f2 =   case $w$sg 10000# of ww { __DEFAULT -&gt;   I# (-# (+# ww (*# 2# ww)) (*# ww ww))   }</code> Ghc is very float happy to the point where it it can be quite hard to stop it from doing this. Just making e1 a function that takes unit will generally NOT be enough to stop it from being memoized like this."}, {"owner": {"reputation": 100892, "user_id": 745903, "user_type": "registered", "accept_rate": 74, "profile_image": "https://www.gravatar.com/avatar/50933f6638836741e620669b3940410e?s=128&d=identicon&r=PG", "display_name": "leftaroundabout", "link": "https://stackoverflow.com/users/745903/leftaroundabout"}, "reply_to_user": {"reputation": 654, "user_id": 7501619, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/dfb3e55ff104cf8485859d00fc6ecbcb?s=128&d=identicon&r=PG&f=1", "display_name": "Taren", "link": "https://stackoverflow.com/users/7501619/taren"}, "edited": false, "score": 1, "creation_date": 1493738689, "post_id": 43738261, "comment_id": 74526341, "body": "@Taren: GHC sure does this when <code>e1</code> is just a small <code>Int</code> value in an <code>Int</code> that it can optimise the hell out of \u2013 but for these you wouldn&#39;t care about memory usage anyway. For big, indirection-heavy, non-inlineable computations, I think it&#39;s quite a bit less agressive."}, {"owner": {"reputation": 654, "user_id": 7501619, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/dfb3e55ff104cf8485859d00fc6ecbcb?s=128&d=identicon&r=PG&f=1", "display_name": "Taren", "link": "https://stackoverflow.com/users/7501619/taren"}, "edited": false, "score": 2, "creation_date": 1493739541, "post_id": 43738261, "comment_id": 74526936, "body": "@leftaroundabout  Try <code>g i = [1..i]</code> and <code>e1 = g 10000000</code> with -O2. Ghc floated it out for me resulting in ~600mb peak memory usage."}, {"owner": {"reputation": 100892, "user_id": 745903, "user_type": "registered", "accept_rate": 74, "profile_image": "https://www.gravatar.com/avatar/50933f6638836741e620669b3940410e?s=128&d=identicon&r=PG", "display_name": "leftaroundabout", "link": "https://stackoverflow.com/users/745903/leftaroundabout"}, "edited": false, "score": 0, "creation_date": 1493740063, "post_id": 43738261, "comment_id": 74527248, "body": "Interesting, but what was the test case? The interesting question is not whether so much memory is consumed when first using the value, but whether merely holding a reference to something that might later use that value again prevents it from being garbage collected."}, {"owner": {"reputation": 654, "user_id": 7501619, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/dfb3e55ff104cf8485859d00fc6ecbcb?s=128&d=identicon&r=PG&f=1", "display_name": "Taren", "link": "https://stackoverflow.com/users/7501619/taren"}, "edited": false, "score": 0, "creation_date": 1493740219, "post_id": 43738261, "comment_id": 74527333, "body": "@leftaroundabout As test case I printed the result in main. Without the floating this could interleave garbage collection with printing, resulting in constant memory usage. If the reference is floated to the top level I don&#39;t think it would  be garbage collected at all. Here is a quick and dirty comparison that might be broken: <a href=\"http://imgur.com/a/nRsuH\" rel=\"nofollow noreferrer\">imgur.com/a/nRsuH</a>"}, {"owner": {"reputation": 61419, "user_id": 849891, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/MbEO3.png?s=128&g=1", "display_name": "Will Ness", "link": "https://stackoverflow.com/users/849891/will-ness"}, "edited": false, "score": 0, "creation_date": 1493769600, "post_id": 43738261, "comment_id": 74540971, "body": "naming it and forcing it with <code>seq</code> is the way to guarantee it that&#39;s actually in the language spec (i.e. <a href=\"https://www.haskell.org/onlinereport/basic.html\" rel=\"nofollow noreferrer\">the Report</a>). <code>f5 a b = if a==b           then &lt;simple computation&gt;           else e1 </code>seq` (e1 + 2 * e1 - e1^2)  where e1 = &lt;lengthy computation&gt;` is the solution you want then. all the other tricky and compiler-dependent stuff is unreliable."}], "tags": [], "owner": {"reputation": 100892, "user_id": 745903, "user_type": "registered", "accept_rate": 74, "profile_image": "https://www.gravatar.com/avatar/50933f6638836741e620669b3940410e?s=128&d=identicon&r=PG", "display_name": "leftaroundabout", "link": "https://stackoverflow.com/users/745903/leftaroundabout"}, "is_accepted": true, "score": 10, "last_activity_date": 1493740515, "last_edit_date": 1493740515, "creation_date": 1493729182, "answer_id": 43738261, "question_id": 43737684, "link": "https://stackoverflow.com/questions/43737684/will-the-result-of-let-and-where-expressions-be-stored-in-haskell/43738261#43738261", "title": "will the result of `let` and `where` expressions be stored in haskell?", "body": "<p>As a rule, code in the <code>where</code> or <code>let</code> block of a <a href=\"https://wiki.haskell.org/Constant_applicative_form\" rel=\"noreferrer\">constant applicative form</a> is evaluated <em>only once, and only as deep as necessary</em> (i.e., if it's not <em>used</em> at all it also won't be evaluated at all).</p>\n\n<p><code>f</code> is not a constant applicative form because it has arguments; it's equivalent to</p>\n\n<pre><code>f' = \\a b -&gt; let e1 = &lt;lengthy computation&gt;\n             in if a==b\n                 then &lt;simple computation&gt;\n                 else e1 + 2 * e1 - e1^2\n</code></pre>\n\n<p>So, <code>e1</code> is evaluated <em>once every time you call the function with both arguments</em>. This is likely also what you want, and in fact the best behaviour possible if <code>&lt;lengthy computation&gt;</code> depends on both <code>a</code> and <code>b</code>. If it, say, only depends on <code>a</code>, you can do better:</p>\n\n<pre><code>f\u2082 a = \\b -&gt; \n  if a==b then &lt;simple computation&gt;\n           else e1 + 2 * e1 - e1^2\n where e1 = &lt;lengthy computation&gt;\n</code></pre>\n\n<p>This form will be more efficient when you do e.g. <code>map (f 34) [1,3,9,2,9]</code>: in that example, <code>e1</code> would only be computed <em>once for the entire list</em>. (But <code>&lt;lengthy computation&gt;</code> won't have <code>b</code> in scope, so it <em>can't</em> depend on it.)</p>\n\n<p>OTOH, there can also be scenarios where you don't <em>want</em> <code>e1</code> to be kept at all. (E.g. if it occupies a lot of memory, but is rather <em>quick</em> to compute). In this case, you can just make it a \u201cnullary function\u201d</p>\n\n<pre><code>f\u2083 a b\n  | a==b = &lt;simple computation&gt;\n  | otherwise = e1() + 2 * e1() - e1()^2\n where e1 () = &lt;lengthy computation&gt;\n</code></pre>\n\n<p>Functions are not memoized by default, so in the above, <code>&lt;lengthy computation&gt;</code> is done zero times if <code>a==b</code> and three times else.</p>\n\n<p>Yet another possibility is to force that <code>e1</code> is always evaluated exactly once. You can do that with <code>seq</code>:</p>\n\n<pre><code>f\u2084 a b = e1 `seq` if a==b\n          then &lt;simple computation&gt;\n          else e1 + 2 * e1 - e1^2\n where e1 = &lt;lengthy computation&gt;\n</code></pre>\n\n<p>This is the only of the suggestions that actually changes something about the <em>semantics</em>, not just the performance: assume we define always <code>e1 = error \"too tough\"</code>. Then <code>f</code>, <code>f'</code>, <code>f\u2082</code> and <code>f\u2083</code> will all still work provided that <code>a==b</code>; however <code>f\u2084</code> will even fail in that case.</p>\n\n<hr>\n\n<p>As for optimisations (<code>-O</code> or <code>-O2</code>) \u2013 these generally won't change anything about the strictness properties of your program (i.e. can't change between the behaviour of <code>f</code> and <code>f\u2084</code>). Beyond that, the compiler is pretty much free to make any change it considers benefitial to performance. But <em>usually</em>, it will not change anything about what I said above. The main exception, as Taren remarks, is something like <code>f\u2083</code>: the compiler will readily inline <code>e1 ()</code> and then share a reference to the computed value, which prevents the garbage collector from reclaiming the memory. So it's better not to rely on this (anyway somewhat hackish) technique.</p>\n"}, {"tags": [], "owner": {"reputation": 654, "user_id": 7501619, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/dfb3e55ff104cf8485859d00fc6ecbcb?s=128&d=identicon&r=PG&f=1", "display_name": "Taren", "link": "https://stackoverflow.com/users/7501619/taren"}, "is_accepted": false, "score": 4, "last_activity_date": 1493738436, "creation_date": 1493738436, "answer_id": 43741641, "question_id": 43737684, "link": "https://stackoverflow.com/questions/43737684/will-the-result-of-let-and-where-expressions-be-stored-in-haskell/43741641#43741641", "title": "will the result of `let` and `where` expressions be stored in haskell?", "body": "<p>You can check actually check out how GHC will optimize your code:</p>\n\n<pre><code>ghc -ddump-simpl -dsuppress-idinfo -dsuppress-coercions -dsuppress-type-applications -dsuppress-uniques -dsuppress-module-prefixes -fforce-recomp .\\scratch.hs\n</code></pre>\n\n<p>This is a bit of a mouthful so you might want to alias it. The results of this very much depend on the optimization level so you might want to try this out with each.</p>\n\n<p>With <code>g i = sum [1..i]</code> as expensive computation and -O2 I get this output:</p>\n\n<pre><code>==================== Tidy Core ====================\nResult size of Tidy Core = {terms: 64, types: 23, coercions: 0}\n\nRec {\n-- RHS size: {terms: 16, types: 3, coercions: 0}\n$wgo :: Int# -&gt; Int# -&gt; Int#\n$wgo =\n  \\ (w :: Int#) (ww :: Int#) -&gt;\n    case w of wild {\n      __DEFAULT -&gt; $wgo (+# wild 1#) (+# ww wild);\n      10000# -&gt; +# ww 10000#\n    }\nend Rec }\n\n-- RHS size: {terms: 15, types: 1, coercions: 0}\nf2 :: Int\nf2 =\n  case $wgo 1# 0# of ww { __DEFAULT -&gt;\n  I# (-# (+# ww (*# 2# ww)) (*# ww ww))\n  }\n\n-- RHS size: {terms: 2, types: 0, coercions: 0}\nf1 :: Int\nf1 = I# 42#\n\n-- RHS size: {terms: 17, types: 8, coercions: 0}\nf :: Int -&gt; Int -&gt; Int\nf =\n  \\ (a :: Int) (b :: Int) -&gt;\n    case a of _ { I# x -&gt;\n    case b of _ { I# y -&gt;\n    case tagToEnum# (==# x y) of _ {\n      False -&gt; f2;\n      True -&gt; f1\n    }\n    }\n    }\n</code></pre>\n\n<p>Which is pretty ugly when compared to your haskell version but with a bit of squinting it isn't much more complicated. $wgo is our expensive function. The interesting part here is that f1 or f2, the possible return values of f, are only computed once when they are required for the first time. For the rest of the program run they are reused.</p>\n"}], "owner": {"reputation": 670, "user_id": 7781818, "user_type": "registered", "accept_rate": 80, "profile_image": "https://www.gravatar.com/avatar/13f5392f913a0f47fab3e6719bda4b08?s=128&d=identicon&r=PG&f=1", "display_name": "Chris", "link": "https://stackoverflow.com/users/7781818/chris"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 273, "favorite_count": 0, "accepted_answer_id": 43738261, "answer_count": 2, "score": 8, "last_activity_date": 1493740515, "creation_date": 1493727410, "last_edit_date": 1495542859, "question_id": 43737684, "link": "https://stackoverflow.com/questions/43737684/will-the-result-of-let-and-where-expressions-be-stored-in-haskell", "title": "will the result of `let` and `where` expressions be stored in haskell?", "body": "<p>I am rather new to Haskell and after reading <a href=\"https://stackoverflow.com/questions/8478412/is-everything-in-haskell-stored-in-thunks-even-simple-values\">this</a> and <a href=\"https://wiki.haskell.org/Performance/Strictness\" rel=\"nofollow noreferrer\">some performance tips on strictness</a> I am still wondering how this applies to <code>let</code> and <code>where</code> expressions. If I have code like:</p>\n\n<pre><code>f :: Int -&gt; Int -&gt; Int\nf a b\n  |a==b = &lt;simple computation&gt;\n  |otherwise = e1 + 2 * e1 - e1^2\n  where e1 = &lt;lengthy computation&gt;\n</code></pre>\n\n<p>how often will <code>&lt;lengthy computation&gt;</code> be evaluated? I assume that given Haskell's lazy evaluation in <code>e1</code> will not be evaluated at all if <code>a==b</code>. But if not, is <code>e1</code> substituted in the <code>otherwise</code> expression and then evaluated every time it is encountered or is it evaluated once it is first encountered and then stored and reused in all subsequent occurrences? Also:</p>\n\n<ul>\n<li>is there a way to control this process \"manually\"? </li>\n<li>does this depend on weather I run code in ghci or compile it with GHC and within GHC compilation does it depend on flags like <code>-o</code>?</li>\n</ul>\n\n<p>This is quite similar to <a href=\"https://stackoverflow.com/questions/41497289/swift-guard-let-and-where-the-priority\">this question</a> but I could not find answers for Haskell.</p>\n\n<p>Explanations are very appreciated.</p>\n"}, {"tags": ["parsing", "haskell", "monads", "parsec", "megaparsec"], "comments": [{"owner": {"reputation": 100892, "user_id": 745903, "user_type": "registered", "accept_rate": 74, "profile_image": "https://www.gravatar.com/avatar/50933f6638836741e620669b3940410e?s=128&d=identicon&r=PG", "display_name": "leftaroundabout", "link": "https://stackoverflow.com/users/745903/leftaroundabout"}, "edited": false, "score": 0, "creation_date": 1493726724, "post_id": 43737239, "comment_id": 74517808, "body": "Could you clarify what you mean by \u201cwhen parse is called\u201d?"}], "answers": [{"tags": [], "owner": {"reputation": 1735, "user_id": 2892792, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/5DNyi.jpg?s=128&g=1", "display_name": "Lazersmoke", "link": "https://stackoverflow.com/users/2892792/lazersmoke"}, "is_accepted": true, "score": 0, "last_activity_date": 1493726830, "creation_date": 1493726830, "answer_id": 43737483, "question_id": 43737239, "link": "https://stackoverflow.com/questions/43737239/use-parsec-to-write-a-new-function-parse-string-stm/43737483#43737483", "title": "Use Parsec to write a new function &quot;parse :: String -&gt; Stm&quot;", "body": "<p>Do exactly what the instructions say:</p>\n\n<pre><code>import qualified Text.Parsec\n\nparse :: String -&gt; Stm\nparse str =\n  case Text.Parsec.parse procParser \"\" str of\n    Left e  -&gt; error $ show e\n    Right r -&gt; r\n</code></pre>\n"}], "owner": {"reputation": 3, "user_id": 6593616, "user_type": "registered", "profile_image": "https://lh6.googleusercontent.com/-8cxjjOfUTTA/AAAAAAAAAAI/AAAAAAAAAq8/TxA4-HP8kNE/photo.jpg?sz=128", "display_name": "Adey", "link": "https://stackoverflow.com/users/6593616/adey"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 54, "favorite_count": 0, "accepted_answer_id": 43737483, "answer_count": 1, "score": 0, "last_activity_date": 1493726830, "creation_date": 1493726144, "question_id": 43737239, "link": "https://stackoverflow.com/questions/43737239/use-parsec-to-write-a-new-function-parse-string-stm", "title": "Use Parsec to write a new function &quot;parse :: String -&gt; Stm&quot;", "body": "<p>I have a coursework that requires me to write a new function parse:: String -> Stm. Parsec already has a parse function, so I'm supposed to import qualified parsec so that parse returns my wrapper function. \nThe wrapper function needs to parse the input string to Parsec's parse function and unpack the result from the returned monad. This is the code for my wrapper function. \nHow do I ensure that when parse is called, it returns my wrapper function.</p>\n\n<pre><code>parseString :: String -&gt; Stm\nparseString str =\n   case parse procParser \"\" str of\n     Left e  -&gt; error $ show e\n     Right r -&gt; r\n</code></pre>\n"}, {"tags": ["list", "haskell", "types", "overloading"], "comments": [{"owner": {"reputation": 37219, "user_id": 1523776, "user_type": "moderator", "accept_rate": 87, "profile_image": "https://www.gravatar.com/avatar/b3e0b5c8e42a8c38009ef2d969f8dabb?s=128&d=identicon&r=PG", "display_name": "Benjamin Hodgson", "link": "https://stackoverflow.com/users/1523776/benjamin-hodgson"}, "edited": false, "score": 0, "creation_date": 1493743253, "post_id": 43736603, "comment_id": 74529070, "body": "This seems like a strange thing to do"}, {"owner": {"reputation": 121, "user_id": 7588488, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/7z35Q.png?s=128&g=1", "display_name": "Zgarb", "link": "https://stackoverflow.com/users/7588488/zgarb"}, "reply_to_user": {"reputation": 37219, "user_id": 1523776, "user_type": "moderator", "accept_rate": 87, "profile_image": "https://www.gravatar.com/avatar/b3e0b5c8e42a8c38009ef2d969f8dabb?s=128&d=identicon&r=PG", "display_name": "Benjamin Hodgson", "link": "https://stackoverflow.com/users/1523776/benjamin-hodgson"}, "edited": false, "score": 0, "creation_date": 1493743593, "post_id": 43736603, "comment_id": 74529232, "body": "@BenjaminHodgson I&#39;m using it for an esoteric functional programming language that compiles to Haskell; the compiler will produce code that uses this function. If I can implement it the way I describe here, it will save me a partial rewrite of our type inferencer. :P"}, {"owner": {"reputation": 37219, "user_id": 1523776, "user_type": "moderator", "accept_rate": 87, "profile_image": "https://www.gravatar.com/avatar/b3e0b5c8e42a8c38009ef2d969f8dabb?s=128&d=identicon&r=PG", "display_name": "Benjamin Hodgson", "link": "https://stackoverflow.com/users/1523776/benjamin-hodgson"}, "edited": false, "score": 1, "creation_date": 1493743861, "post_id": 43736603, "comment_id": 74529399, "body": "I would suggest instead separating the codegen and type checking phases of your compiler"}], "answers": [{"comments": [{"owner": {"reputation": 44013, "user_id": 1477667, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/trgKM.jpg?s=128&g=1", "display_name": "dfeuer", "link": "https://stackoverflow.com/users/1477667/dfeuer"}, "edited": false, "score": 0, "creation_date": 1493754128, "post_id": 43745475, "comment_id": 74534862, "body": "I&#39;m not exactly an expert, but can&#39;t you recover some inference with fundeps (or equivalent type family-based class constraints)? I&#39;d expect there to be some dependencies among <code>a</code>, <code>b</code>, <code>c</code>, <code>x</code>, <code>y</code>, and <code>z</code>. Are there none?"}, {"owner": {"reputation": 24509, "user_id": 6863749, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/UyoQv.jpg?s=128&g=1", "display_name": "Li-yao Xia", "link": "https://stackoverflow.com/users/6863749/li-yao-xia"}, "reply_to_user": {"reputation": 44013, "user_id": 1477667, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/trgKM.jpg?s=128&g=1", "display_name": "dfeuer", "link": "https://stackoverflow.com/users/1477667/dfeuer"}, "edited": false, "score": 0, "creation_date": 1493758261, "post_id": 43745475, "comment_id": 74537064, "body": "In the final function I don&#39;t think we can infer much because it is simply too polymorphic. Given <code>a,b,x,y</code>, we can infer <code>c</code> from <code>z</code>, and conversely <code>z</code> from <code>c</code>, and that&#39;s it. In the other direction you might relate <code>z</code> to the &quot;deeper&quot; of <code>x</code> and <code>y</code>, but it doesn&#39;t seem possible to make any use of this without knowing both <code>n</code> and <code>m</code>, which require <code>a,x,b,y</code> or an explicit annotation as I suggest."}], "tags": [], "owner": {"reputation": 24509, "user_id": 6863749, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/UyoQv.jpg?s=128&g=1", "display_name": "Li-yao Xia", "link": "https://stackoverflow.com/users/6863749/li-yao-xia"}, "is_accepted": false, "score": 2, "last_activity_date": 1493758363, "last_edit_date": 1493758363, "creation_date": 1493752084, "answer_id": 43745475, "question_id": 43736603, "link": "https://stackoverflow.com/questions/43736603/overloaded-zipwith-supporting-nested-lists/43745475#43745475", "title": "Overloaded &quot;zipWith&quot; supporting nested lists", "body": "<p>(<a href=\"https://gist.github.com/Lysxia/386ccf64fd0de76b9015ccabd6884421\" rel=\"nofollow noreferrer\">As a gist in Literate Haskell</a>)</p>\n\n<pre><code>{-# LANGUAGE DataKinds, FlexibleContexts, FlexibleInstances,\n    TypeFamilies, MultiParamTypeClasses, UndecidableInstances,\n    RankNTypes, ScopedTypeVariables, FunctionalDependencies, TypeOperators #-}\n\nmodule Zip where\n\nimport Data.Proxy\nimport GHC.TypeLits\n</code></pre>\n\n<p>Let's first assume that the two nested lists have the same depth. E.g., depth 2:</p>\n\n<pre><code>zipDeep0 ((+) :: Int -&gt; Int -&gt; Int) [[1,2],[3,4,5]] [[10,20],[30,40]] :: [[Int]]\n[[11,22],[33,44]]\n</code></pre>\n\n<p>Implementation:</p>\n\n<pre><code>zipDeep0\n  :: forall n a b c x y z\n  .  (ZipDeep0 n a b c x y z, n ~ Levels a x, n ~ Levels b y, n ~ Levels c z)\n  =&gt; (a -&gt; b -&gt; c) -&gt; (x -&gt; y -&gt; z)\nzipDeep0 = zipDeep0_ (Proxy :: Proxy n)\n</code></pre>\n\n<p><code>Levels a x</code> computes the depth of a in the nested list type x.\nClosed type families allow us to do some non-linear type-level pattern matching\n(where <code>a</code> occurs twice in a clause).</p>\n\n<pre><code>type family Levels a x :: Nat where\n  Levels a a = 0\n  Levels a [x] = 1 + Levels a x\n</code></pre>\n\n<p>We use that depth to select the <code>ZipDeep0</code> instance implementing the zip,\nThis way is neater than relying only on the six other ordinary type parameters,\nas it avoids a problem with type inference and overlapping instances when some list is empty (so\nwe can't infer its actual type from itself), or when <code>a</code>, <code>b</code>, <code>c</code> are also\nlist types.</p>\n\n<pre><code>class ZipDeep0 (n :: Nat) a b c x y z where\n  zipDeep0_ :: proxy n -&gt; (a -&gt; b -&gt; c) -&gt; x -&gt; y -&gt; z\n\n-- Moving the equality constraints into the context helps type inference.\ninstance {-# OVERLAPPING #-} (a ~ x, b ~ y, c ~ z) =&gt; ZipDeep0 0 a b c x y z where\n  zipDeep0_ _ = id\n\ninstance (ZipDeep0 (n - 1) a b c x y z, xs ~ [x], ys ~ [y], zs ~ [z])\n  =&gt; ZipDeep0 n a b c xs ys zs where\n  zipDeep0_ _ f = zipWith (zipDeep0_ (Proxy :: Proxy (n - 1)) f)\n</code></pre>\n\n<hr>\n\n<p>When the two lists are not of the same depth, let's first assume the second one\nis deeper, so we must distribute over it.\nWe start losing some type inference, we must know at least <code>Levels a x</code> (and\nthus <code>a</code> and <code>x</code>) and either <code>Levels b y</code> or <code>Levels c z</code> before this function\ncan be applied.</p>\n\n<p>Example:</p>\n\n<pre><code>zipDeep1 (+) [10,20 :: Int] [[1,2],[3,4]] :: [[Int]]\n[[11,22],[13,24]]\n</code></pre>\n\n<p>Implementation:</p>\n\n<pre><code>zipDeep1\n :: forall n m a b c x y z\n .  (n ~ Levels a x, m ~ Levels b y, m ~ Levels c z, ZipDeep1 (m - n) a b c x y z)\n =&gt; (a -&gt; b -&gt; c) -&gt; x -&gt; y -&gt; z\nzipDeep1 = zipDeep1_ (Proxy :: Proxy (m - n))\n</code></pre>\n\n<p>The difference between levels <code>(m - n)</code> tells us how many layers we must \"distribute\"\nthrough before falling back to <code>zipDeep0</code>.</p>\n\n<pre><code>class ZipDeep1 (n :: Nat) a b c x y z where\n  zipDeep1_ :: proxy n -&gt; (a -&gt; b -&gt; c) -&gt; x -&gt; y -&gt; z\n\ninstance {-# OVERLAPPING #-} ZipDeep0 (Levels a x) a b c x y z =&gt; ZipDeep1 0 a b c x y z where\n  zipDeep1_ _ = zipDeep0_ (Proxy :: Proxy (Levels a x))\n\ninstance (ZipDeep1 (n - 1) a b c x y z, ys ~ [y], zs ~ [z]) =&gt; ZipDeep1 n a b c x ys zs where\n  zipDeep1_ proxy f xs = fmap (zipDeep1_ (Proxy :: Proxy (n - 1)) f xs)\n</code></pre>\n\n<hr>\n\n<p>Finally, we can do a type-level comparison when either list may be the deeper\none. We lose all type inference though.</p>\n\n<p>Example:</p>\n\n<pre><code>zipDeep ((+) :: Int -&gt; Int -&gt; Int) [[1,2 :: Int],[3,4]] [10 :: Int,20] :: [[Int]]\n[[11,22],[13,24]]\n</code></pre>\n\n<p>Some type inference is recovered by instead specifying the expected depth of\neach list with TypeApplications.</p>\n\n<pre><code>zipDeep @2 @1 ((+) :: Int -&gt; Int -&gt; Int) [[1,2],[3,4]] [10,20]\n[[11,22],[13,24]]\n</code></pre>\n\n<p>Implementation:</p>\n\n<pre><code>zipDeep\n  :: forall n m a b c x y z\n  .  (ZipDeep2 (CmpNat n m) n m a b c x y z, n ~ Levels a x, m ~ Levels b y)\n  =&gt; (a -&gt; b -&gt; c) -&gt; x -&gt; y -&gt; z\nzipDeep = zipDeep2_ (Proxy :: Proxy '(CmpNat n m, n, m))\n\nclass ZipDeep2 (cmp :: Ordering) (n :: Nat) (m :: Nat) a b c x y z where\n  zipDeep2_ :: proxy '(cmp, n, m) -&gt; (a -&gt; b -&gt; c) -&gt; x -&gt; y -&gt; z\n\ninstance {-# OVERLAPPING #-} (n ~ Levels a x, m ~ Levels b y, m ~ Levels c z, ZipDeep1 (m - n) a b c x y z)\n  =&gt; ZipDeep2 'LT n m a b c x y z where\n  zipDeep2_ _ = zipDeep1\n\ninstance (n ~ Levels a x, m ~ Levels b y, n ~ Levels c z, ZipDeep1 (n - m) b a c y x z)\n  =&gt; ZipDeep2 cmp n m a b c x y z where\n  zipDeep2_ _ = flip . zipDeep1 . flip\n</code></pre>\n"}], "owner": {"reputation": 121, "user_id": 7588488, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/7z35Q.png?s=128&g=1", "display_name": "Zgarb", "link": "https://stackoverflow.com/users/7588488/zgarb"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 380, "favorite_count": 0, "answer_count": 1, "score": 2, "last_activity_date": 1493758363, "creation_date": 1493724057, "last_edit_date": 1493726001, "question_id": 43736603, "link": "https://stackoverflow.com/questions/43736603/overloaded-zipwith-supporting-nested-lists", "title": "Overloaded &quot;zipWith&quot; supporting nested lists", "body": "\n\n<p>I'm trying to write a Haskell function that automatically distributes a binary operation over a list, kind of how arithmetic operations work in the <a href=\"https://en.wikipedia.org/wiki/J_%28programming_language%29\" rel=\"nofollow noreferrer\">J language</a>.\nYou can think of it as a \"deep <code>zipWith</code>\" that works on nested lists of any depth, including non-lists and lists of different depths.\nFor example:</p>\n\n<pre><code>distr (+) 1 10 === 11  -- Non-list values are added together\ndistr (+) [1,2] 10 === [11,12]  -- Non-list values distribute over lists\ndistr (+) [1,2] [10,20] === [11,22]  -- Two lists get zipped\ndistr (+) [[1,2],[3,4]] [[10,20],[30,40]] === [[11,22],[33,44]]  -- Nested lists get zipped\n</code></pre>\n\n<p>Lists of different lengths get truncated, like with <code>zipWith</code>, but this is not important.</p>\n\n<p>Now, I have already written this:</p>\n\n<pre><code>{-# LANGUAGE\n    MultiParamTypeClasses,\n    FunctionalDependencies,\n    UndecidableInstances,\n    FlexibleInstances\n#-}\n\nclass Distr a b c x y z | a b c x y -&gt; z\n  where distr :: (a -&gt; b -&gt; c) -&gt; (x -&gt; y -&gt; z)\n\ninstance Distr a b c a b c where distr = id\ninstance {-# OVERLAPPING #-}\n         (Distr a b c x y z) =&gt; Distr a b c [x] [y] [z]\n  where distr = zipWith . distr\ninstance (Distr a b c x y z) =&gt; Distr a b c [x]  y  [z]\n  where distr f xs y = map (\\x -&gt; distr f x y) xs\ninstance (Distr a b c x y z) =&gt; Distr a b c  x  [y] [z]\n  where distr f x ys = map (\\y -&gt; distr f x y) ys\n</code></pre>\n\n<p>This defines a 6-parameter typeclass <code>Distr</code> with a function <code>distr :: (Distr a b c x y z) =&gt; (a -&gt; b -&gt; c) -&gt; (x -&gt; y -&gt; z)</code>, and some instances of <code>Distr</code> on nested lists.\nIt works well on the examples above, but its behavior on lists of unequal nesting depth is not exactly what I want.\nIt does this (which works if you add type annotations to <code>(+)</code> and both lists):</p>\n\n<pre><code>distr (+) [[1,2],[3,4]] [10,20] === [[11,12],[23,24]]  -- Zip and distribute\n</code></pre>\n\n<p><a href=\"https://tio.run/nexus/haskell#lVBfS8MwHHzvp/jBfEiwlW36VGihuDkGcw5x@hDzkKWRBbpYmgzbqp99Jt1/p6CBHOTucvdLVu9BC0bJeDBNBn0P7LpdZkZOWMEWD1UurjOmtdB@I90sFTfyVbGsJ3KhUqG43GpTe@QyZbNMDJU2TPHdrUyU8pD2WsFno3jcpUNPalMAgxlwKKGCGj4OTkEMtXW/zUUhIG2sYQiIOWHmgGOHqHS4tmPPk5uyo/A1HiZFINO91/3F3WP/fpRMJsPxALZzNgudjIkhio/ySUmBVHbX9NvEEdQyf5JmDhdrZl/6x1wr/JD7AqW2SgQLlgN6bv5gp0CFrfyvJkv/8oImT@@aqpOmSq8WTCrryAupDJxtZITOcRgOlQniLWBAhHT8LvXJpX9FaRgSYmlKndBp@922oxyDV18\" rel=\"nofollow noreferrer\">Try it here.</a>\nWhat I want is this:</p>\n\n<pre><code>distr (+) [[1,2],[3,4]] [10,20] === [[11,22],[13,24]]  -- Distribute and zip\n</code></pre>\n\n<p>The current implementation applies <code>zipWith</code> until one of its arguments is a non-list value, which is then distributed over the other list.\nI would prefer it to distribute one argument (the one with fewer list layers) over the other until it reaches equal nesting depth, and then use <code>zipWith</code> to reduce them to non-list values.</p>\n\n<p><strong>My question is: Can I achieve the second kind of behavior?</strong>\nI'm happy with a solution that requires me to explicitly tell Haskell the types of the operator and each argument, as my current solution does.\nI will not call <code>distr</code> on an operator that takes lists as inputs, so that case need not be handled.\nHowever, I don't want to give extra arguments to <code>distr</code> that serve as type hints, or have several different versions of <code>distr</code> for different use cases.\nI know my problem could be solved this way, but I'd prefer a solution where it isn't necessary.</p>\n"}, {"tags": ["haskell"], "answers": [{"comments": [{"owner": {"reputation": 47, "user_id": 7699349, "user_type": "registered", "accept_rate": 0, "profile_image": "https://www.gravatar.com/avatar/366e6c514b0f542fe75e20e7222e115f?s=128&d=identicon&r=PG", "display_name": "Bob", "link": "https://stackoverflow.com/users/7699349/bob"}, "edited": false, "score": 0, "creation_date": 1493722269, "post_id": 43736009, "comment_id": 74514902, "body": "ok, I get it! Thank you very much! I see that I have a lot to learn ..."}], "tags": [], "owner": {"reputation": 100892, "user_id": 745903, "user_type": "registered", "accept_rate": 74, "profile_image": "https://www.gravatar.com/avatar/50933f6638836741e620669b3940410e?s=128&d=identicon&r=PG", "display_name": "leftaroundabout", "link": "https://stackoverflow.com/users/745903/leftaroundabout"}, "is_accepted": false, "score": 0, "last_activity_date": 1493722063, "creation_date": 1493722063, "answer_id": 43736009, "question_id": 43735738, "link": "https://stackoverflow.com/questions/43735738/how-to-read-a-string-using-haskell/43736009#43736009", "title": "how to read a string using haskell", "body": "<p><code>lcms x</code> is just a numerical value. Binding it directly in the <code>do</code> block of an <code>IO</code> action like <code>main</code> is like asking somebody \u201cfetch the mail please, then buy some milk, then launch the missiles, then 36\u201d. Well, that would surely prompt the reply <em>36 \u2013 what?</em></p>\n\n<p>If you want to <em>print</em> the result of <code>lcms x</code>, then say so.</p>\n\n<pre><code>main :: IO ()\nmain = do\n    a &lt;- getLine\n    let x = parseIntList a \n    print x\n    print $ lcms x\n</code></pre>\n"}], "owner": {"reputation": 47, "user_id": 7699349, "user_type": "registered", "accept_rate": 0, "profile_image": "https://www.gravatar.com/avatar/366e6c514b0f542fe75e20e7222e115f?s=128&d=identicon&r=PG", "display_name": "Bob", "link": "https://stackoverflow.com/users/7699349/bob"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 45, "favorite_count": 0, "answer_count": 1, "score": 0, "last_activity_date": 1493722063, "creation_date": 1493721239, "last_edit_date": 1493721672, "question_id": 43735738, "link": "https://stackoverflow.com/questions/43735738/how-to-read-a-string-using-haskell", "title": "how to read a string using haskell", "body": "<p>I don't get it how I can make it work, I tried many methods, but by all this is the only one who worked just a little! Can someone give me an idea ?</p>\n\n<pre><code>lcms :: (Integral a) =&gt; [a] -&gt; a\n\nparseIntList :: String -&gt; [Int]\nparseIntList s = [read x :: Int | x &lt;- words s]\n\nmain = do\n        a &lt;- getLine --1,2,3\n        let x = parseIntList a \n        print x -- [1,2,3]\n        lcms  x --?\n</code></pre>\n"}, {"tags": ["haskell", "newtype"], "comments": [{"owner": {"reputation": 2141, "user_id": 1664572, "user_type": "registered", "accept_rate": 85, "profile_image": "https://www.gravatar.com/avatar/c2bee27fdb72050b60a3c6aae64b474f?s=128&d=identicon&r=PG", "display_name": "wizzup", "link": "https://stackoverflow.com/users/1664572/wizzup"}, "edited": false, "score": 0, "creation_date": 1493712866, "post_id": 43731771, "comment_id": 74509305, "body": "Should you use <code>data</code> instead of <code>newtype</code> ?"}, {"owner": {"reputation": 7030, "user_id": 3032349, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/3cd8d19756aa9bc73d8045ae988ae728?s=128&d=identicon&r=PG&f=1", "display_name": "ThreeFx", "link": "https://stackoverflow.com/users/3032349/threefx"}, "edited": false, "score": 0, "creation_date": 1493713064, "post_id": 43731771, "comment_id": 74509403, "body": "Side note: <code>show grape</code> and <code>show orange</code> are the equivalent to <code>show _</code> and therefore overlapping patterns. The compiler will not match orange with it&#39;s above definition but treat it as a local identifier."}, {"owner": {"reputation": 1247, "user_id": 3485629, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/640b2583577ec470ac273b27f78025d5?s=128&d=identicon&r=PG", "display_name": "basile-henry", "link": "https://stackoverflow.com/users/3485629/basile-henry"}, "edited": false, "score": 0, "creation_date": 1493717881, "post_id": 43731771, "comment_id": 74511979, "body": "If you only use statically defined fruits, you should really use a sum type to represent your data instead of using a wrapper around <code>Int</code>. For example: <code>data Fruit = Apple | Banana | Grape | Orange deriving Eq</code>"}], "answers": [{"comments": [{"owner": {"reputation": 480, "user_id": 4688042, "user_type": "registered", "accept_rate": 78, "profile_image": "https://www.gravatar.com/avatar/07539504725306ff45b0e9c09e3e2699?s=128&d=identicon&r=PG", "display_name": "QuietJoon", "link": "https://stackoverflow.com/users/4688042/quietjoon"}, "edited": false, "score": 0, "creation_date": 1493747537, "post_id": 43733374, "comment_id": 74531299, "body": "Thanks, I really forget about it! However, then why the implement that I used case could not work well?"}, {"owner": {"reputation": 100185, "user_id": 3234959, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/93bb12ca0f93dfddb33880316f7e66c2?s=128&d=identicon&r=PG&f=1", "display_name": "chi", "link": "https://stackoverflow.com/users/3234959/chi"}, "reply_to_user": {"reputation": 480, "user_id": 4688042, "user_type": "registered", "accept_rate": 78, "profile_image": "https://www.gravatar.com/avatar/07539504725306ff45b0e9c09e3e2699?s=128&d=identicon&r=PG", "display_name": "QuietJoon", "link": "https://stackoverflow.com/users/4688042/quietjoon"}, "edited": false, "score": 0, "creation_date": 1493748320, "post_id": 43733374, "comment_id": 74531737, "body": "@QuietJoon <code>case</code> is not different from multiple equations. <code>case</code> also uses patterns, which declare new local variables... same issue."}], "tags": [], "owner": {"reputation": 100185, "user_id": 3234959, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/93bb12ca0f93dfddb33880316f7e66c2?s=128&d=identicon&r=PG&f=1", "display_name": "chi", "link": "https://stackoverflow.com/users/3234959/chi"}, "is_accepted": true, "score": 5, "last_activity_date": 1493713735, "creation_date": 1493713735, "answer_id": 43733374, "question_id": 43731771, "link": "https://stackoverflow.com/questions/43731771/why-newtype-does-not-work-with-this-pattern-matching/43733374#43733374", "title": "Why `newtype` does not work with this pattern matching?", "body": "<p>This code</p>\n\n<pre><code>instance Show Fruit where\n  show apple = \"Apple\"\n  show banana = \"Banana\"\n  show grape = \"Grape\"\n  show orange = \"Orange\"\n  show _ = \"Fruit\"\n</code></pre>\n\n<p>is equivalent to</p>\n\n<pre><code>instance Show Fruit where\n  show x = \"Apple\"\n  show y = \"Banana\"\n  show z = \"Grape\"\n  show w = \"Orange\"\n  show _ = \"Fruit\"\n</code></pre>\n\n<p>since it declares new variables named <code>apple, ...</code> which shadow the globally defined ones, without being related to those in any way.</p>\n\n<p>Try instead</p>\n\n<pre><code>instance Show Fruit where\n  show x | x == apple = \"Apple\"\n         | x == banana = \"Banana\"\n         | x == grape = \"Grape\"\n         | x == orange = \"Orange\"\n         | otherwise = \"Fruit\"\n</code></pre>\n\n<p>The thumb rule to remember is: in a pattern, all the variables are local variables <em>defined</em> by the pattern.</p>\n\n<p>I'd recommend to turn on warnings with <code>-Wall</code>, since that would have pointed out the shadowing of global variables by local ones.</p>\n"}, {"tags": [], "owner": {"reputation": 3849, "user_id": 380816, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/82401038e87257529066b9e6618d470e?s=128&d=identicon&r=PG", "display_name": "ivanm", "link": "https://stackoverflow.com/users/380816/ivanm"}, "is_accepted": false, "score": 0, "last_activity_date": 1493793786, "creation_date": 1493793786, "answer_id": 43752901, "question_id": 43731771, "link": "https://stackoverflow.com/questions/43731771/why-newtype-does-not-work-with-this-pattern-matching/43752901#43752901", "title": "Why `newtype` does not work with this pattern matching?", "body": "<p>An alternative to what you seem to be trying to do is to use <a href=\"https://ocharles.org.uk/blog/posts/2014-12-03-pattern-synonyms.html\" rel=\"nofollow noreferrer\">PatternSynonyms</a>.</p>\n"}], "owner": {"reputation": 480, "user_id": 4688042, "user_type": "registered", "accept_rate": 78, "profile_image": "https://www.gravatar.com/avatar/07539504725306ff45b0e9c09e3e2699?s=128&d=identicon&r=PG", "display_name": "QuietJoon", "link": "https://stackoverflow.com/users/4688042/quietjoon"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 176, "favorite_count": 0, "accepted_answer_id": 43733374, "answer_count": 2, "score": 1, "last_activity_date": 1493793786, "creation_date": 1493707766, "question_id": 43731771, "link": "https://stackoverflow.com/questions/43731771/why-newtype-does-not-work-with-this-pattern-matching", "title": "Why `newtype` does not work with this pattern matching?", "body": "<p>I tried the following code by implementing data as <code>Enum</code>.\nAnd, I have a question just replacing <code>Enum</code> by <code>newtype</code>.</p>\n\n<p>And here is my test code.</p>\n\n<pre class=\"lang-hs prettyprint-override\"><code>newtype Fruit = Fruit Int deriving (Eq)\n\napple = Fruit 0\nbanana = Fruit 1\ngrape = Fruit 2\norange = Fruit 3\n\ninstance Show Fruit where\n  show apple = \"Apple\"\n  show banana = \"Banana\"\n  show grape = \"Grape\"\n  show orange = \"Orange\"\n  show _ = \"Fruit\"\n\ntest =\n  map show [apple, banana, grape, orange, (Fruit 5)]\n</code></pre>\n\n<p>I expected that evaluated <code>test</code> will be <code>[\"Apple\",\"Banana\",\"Grape\",\"Orange\",\"Fruit\"]</code>, but it is <code>[\"Apple\",\"Apple\",\"Apple\",\"Apple\",\"Apple\"]</code></p>\n\n<p>I assume that it variable may not work well with pattern matching, but I tried one more time by <code>case</code>, like:</p>\n\n<pre class=\"lang-hs prettyprint-override\"><code>-- Fails: everything is \"Apple\"\ninstance Show Fruit where\n  show g = case g of\n    apple -&gt; \"Apple\"\n    banana -&gt; \"Banana\"\n    grape -&gt; \"Grape\"\n    orange -&gt; \"Orange\"\n    _ -&gt; \"Fruit\"\n</code></pre>\n\n<p>To confirm my temporary, I tried again with the next code.</p>\n\n<pre class=\"lang-hs prettyprint-override\"><code>-- Fails: Works only for apple/banana. Variable does not work!\ninstance Show Fruit where\n  show (Fruit 0) = \"Apple\"\n  show (Fruit 1) = \"Banana\"\n  show grape = \"Grape\"\n  show orange = \"Orange\"\n  show _ = \"Fruit\"\n</code></pre>\n\n<p>And I could get <code>[\"Apple\",\"Banana\",\"Grape\",\"Grape\",\"Grape\"]</code></p>\n\n<p>Well, I can write code to implement with <code>Enum</code>, but I just want to understand why the codes do not work that I supposed?</p>\n"}, {"tags": ["haskell"], "answers": [{"tags": [], "owner": {"reputation": 1780, "user_id": 4168972, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/fc92e82d2eb21eb030d4c133c70ff554?s=128&d=identicon&r=PG&f=1", "display_name": "David Fletcher", "link": "https://stackoverflow.com/users/4168972/david-fletcher"}, "is_accepted": false, "score": 0, "last_activity_date": 1493722034, "last_edit_date": 1493722034, "creation_date": 1493721350, "answer_id": 43735773, "question_id": 43731567, "link": "https://stackoverflow.com/questions/43731567/find-two-elements-in-a-list-order-them-by-their-occurence/43735773#43735773", "title": "Find two elements in a list, order them by their occurence", "body": "<p>I don't know how much better you will think these are, but you can do some things making more use of list functions.</p>\n\n<p>I initially thought of filtering out the irrelevant\nitems first, and grouping:</p>\n\n<pre><code>f :: Eq a =&gt; [a] -&gt; (a,a) -&gt; (Maybe a, Maybe a)\nf xs (a, b) =\n  case (map head . group . filter (`elem` [a,b])) xs of\n    [] -&gt; (Nothing, Nothing)\n    [c] -&gt; (Just c, Nothing)\n    (c:d:_) -&gt; (Just c, Just d)\n</code></pre>\n\n<p>But this doesn't do the same as your implementation on, for example,\n<code>f [8,9,9] (9,9)</code>, so you'd need to special-case that if it's a case\nyou care about.</p>\n\n<p>Another way is with <code>dropWhile</code>:</p>\n\n<pre><code>f' :: Eq a =&gt; [a] -&gt; (a,a) -&gt; (Maybe a, Maybe a)\nf' xs (a, b) =\n  case dropWhile (`notElem` [a, b]) xs of\n    [] -&gt; (Nothing, Nothing)\n    (y:ys) -&gt; (Just y, next)\n      where\n        next = case dropWhile (/=other) ys of\n                 [] -&gt; Nothing\n                 (z:_) -&gt; Just z\n        other = if y == a then b else a\n</code></pre>\n\n<p>And the inner case is really just a <code>find</code> so it can be simplified a\nlittle more:</p>\n\n<pre><code>f'' :: Eq a =&gt; [a] -&gt; (a,a) -&gt; (Maybe a, Maybe a)\nf'' xs (a, b) =\n  case dropWhile (`notElem` [a, b]) xs of\n    [] -&gt; (Nothing, Nothing)\n    (y:ys) -&gt; (Just y, find (==other) ys)\n      where\n        other = if y == a then b else a\n</code></pre>\n\n<p>Note: these functions never return a result of the form <code>(Nothing, Just _)</code>.  This suggests that a return type of <code>Maybe (a, Maybe a)</code>\nmight be better.  Or a custom type like <code>None | One a | Two a a</code>.</p>\n\n<p>Alternatively, we could generalize to a list version which allows as\nmany target values as you like.  It makes a nice unfold:</p>\n\n<pre><code>f''' :: Eq a =&gt; [a] -&gt; [a] -&gt; [a]\nf''' xs ts = unfoldr g (xs, ts)\n  where\n    g (ys, us) = case dropWhile (`notElem` us) ys of\n                   [] -&gt; Nothing\n                   (z:zs) -&gt; Just (z, (zs, delete z us))\n</code></pre>\n\n<p>Which works like this:</p>\n\n<pre><code>\u03bb&gt; f''' [4,2,5,3,1] [1,2,3]\n[2,3,1]\n\u03bb&gt; f''' [4,2,5,3,1] [1,2,6]\n[2,1]\n\u03bb&gt; f''' [7,9,8,9] [9,9]\n[9,9]\n</code></pre>\n\n<p>I'm almost reinventing <code>intersect</code> here but not quite.  It has the behaviour we want of preserving the order from the first list, but it isn't the same on duplicates - e.g. <code>intersect [4,2,2,5] [1,2]</code> is <code>[2,2]</code>.</p>\n"}, {"tags": [], "owner": {"reputation": 8237, "user_id": 2900502, "user_type": "registered", "accept_rate": 73, "profile_image": "https://i.stack.imgur.com/R1OjD.jpg?s=128&g=1", "display_name": "Shersh", "link": "https://stackoverflow.com/users/2900502/shersh"}, "is_accepted": false, "score": 1, "last_activity_date": 1493724422, "last_edit_date": 1493724422, "creation_date": 1493723069, "answer_id": 43736286, "question_id": 43731567, "link": "https://stackoverflow.com/questions/43731567/find-two-elements-in-a-list-order-them-by-their-occurence/43736286#43736286", "title": "Find two elements in a list, order them by their occurence", "body": "<p>If you want to decrease number of pattern matchings then it's better to never pass pair <code>(Maybe a, Maybe a)</code> recursively and pattern match on it. You can just split your function into two recursive functions where first functions finds first element and calls second function with the other. This can be done like this:</p>\n\n<pre><code>f :: Eq a =&gt; (a, a) -&gt; [a] -&gt; (Maybe a, Maybe a)\nf (a, b) = goFirst\n  where\n    goFirst []    = (Nothing, Nothing)\n    goFirst (x:xs)\n      | x == a    = (Just a, goSecond b xs)\n      | x == b    = (Just b, goSecond a xs)\n      | otherwise = goFirst xs\n\n    goSecond _ [] = Nothing\n    goSecond y (x:xs)\n      | x == y    = Just y\n      | otherwise = goSecond y xs\n</code></pre>\n\n<p>This is not so short and elegant as you may want but it's readable, fast (I want to add that you should never ever use <code>foldl</code> function) and less error-prone.</p>\n\n<p>If you're looking for some abstractions, you may look at <a href=\"http://hackage.haskell.org/package/base-4.9.1.0/docs/Data-Monoid.html#t:First\" rel=\"nofollow noreferrer\"><code>First</code></a> monoid with pair monoid. Using monoid instance for <code>First</code> data type you can start with something like this:</p>\n\n<pre><code>import Data.Bifunctor (bimap)\nimport Data.Monoid    (First (..), mconcat)\n\ng :: Eq a =&gt; (a, a) -&gt; [a] -&gt; (Maybe a, Maybe a)\ng (a, b) = bimap getFirst getFirst . mconcat . map fMapper\n  where\n    fMapper x\n      | x == a    = (First (Just a), mempty)\n      | x == b    = (mempty, First (Just b))\n      | otherwise = mempty\n</code></pre>\n\n<p>Though this function doesn't do exactly what you want:</p>\n\n<pre><code>ghci&gt; let xs = [4,6,3,2,1,8]\nghci&gt; g (3, 1) xs\n(Just 3,Just 1)\nghci&gt; g (1, 3) xs\n(Just 1,Just 3)\n</code></pre>\n\n<p>To achieve initial goal with this approach you can add indices to each element and then sort pairs under <code>First</code> by indices but this solution is scary and ugly. Using <code>First</code> monoid is tempting but I don't know how it can be used here elegantly.</p>\n\n<p>But you can combine ideas from first and second solutions:</p>\n\n<pre><code>import Data.Bool   (bool)\nimport Data.Monoid (First (..))\n\nh :: Eq a =&gt; (a, a) -&gt; [a] -&gt; (Maybe a, Maybe a)\nh (a, b) = goFirst\n  where\n    goFirst []    = (Nothing, Nothing)\n    goFirst (x:xs)\n      | x == a    = (Just a, goSecond b xs)\n      | x == b    = (Just b, goSecond a xs)\n      | otherwise = goFirst xs\n\n    goSecond y = getFirst . foldMap (bool mempty (First (Just y)) . (== y))\n</code></pre>\n"}, {"tags": [], "owner": {"reputation": 48938, "user_id": 246886, "user_type": "registered", "accept_rate": 94, "profile_image": "https://www.gravatar.com/avatar/dd1ebaade6623fc538fb8af3338e730d?s=128&d=identicon&r=PG", "display_name": "Jon Purdy", "link": "https://stackoverflow.com/users/246886/jon-purdy"}, "is_accepted": false, "score": 1, "last_activity_date": 1493724968, "last_edit_date": 1493724968, "creation_date": 1493724533, "answer_id": 43736748, "question_id": 43731567, "link": "https://stackoverflow.com/questions/43731567/find-two-elements-in-a-list-order-them-by-their-occurence/43736748#43736748", "title": "Find two elements in a list, order them by their occurence", "body": "<p>Here\u2019s one possible solution with lists, of the following type:</p>\n\n<pre><code>f :: Eq a =&gt; [a] -&gt; [a] -&gt; [Maybe a]\n</code></pre>\n\n<p>I\u2019ll call the list to be searched the <code>haystack</code> and the elements to search for the <code>needles</code>. First, we can search the <code>haystack</code> for each <code>needle</code> and return a pair of the value and the index where it was found, if any, using <code>findIndex</code>:</p>\n\n<pre><code>findIndices needles haystack =\n  [ (needle, findIndex (== needle) haystack)\n  | needle &lt;- needles\n  ]\n\nfindIndices [1, 3] xs == [(1, Just 4), (3, Just 2)]\n</code></pre>\n\n<p>(Note that this always uses the index of the <em>first</em> occurrence\u2014I\u2019m not sure if that\u2019s what you want. You can extend this into a fold that removes each occurrence as it\u2019s found.)</p>\n\n<p>Then sort this list by the index:</p>\n\n<pre><code>sortBy (comparing snd) [(1, Just 4), (3, Just 2)]\n==\n[(3, Just 2), (1, Just 4)]\n</code></pre>\n\n<p>And finally extract the value for each index that was actually present, using <code>(&lt;$) :: Functor f =&gt; a -&gt; f b -&gt; f a</code>:</p>\n\n<pre><code>[value &lt;$ mIndex | (value, mIndex) &lt;- [(3, Just 2), (1, Just 4)]]\n==\n[Just 3, Just 1]\n</code></pre>\n\n<p>(<code>x &lt;$ f</code> is equivalent to <code>const x &lt;$&gt; f</code>.)</p>\n\n<p>But when we try this on an input where some elements aren\u2019t found, we get the wrong result, where the <code>Nothing</code>s come at the beginning rather than the end:</p>\n\n<pre><code>findIndices [9, 1] xs == [(9, Nothing), (1, Just 4)]\n\nsortBy (comparing snd) [(9, Nothing), (1, Just 4)]\n==\n[(9, Nothing), (1, Just 4)]\n</code></pre>\n\n<p>This is because <code>Nothing</code> is considered less than any <code>Just</code> value. Since we want the opposite, we can reverse the sort order of the <code>Maybe</code> using the <code>Down</code> newtype from <code>Data.Ord</code>, by passing <code>Down . snd</code> instead of <code>snd</code> as the comparator:</p>\n\n<pre><code>sortBy (comparing (Down . snd)) [(9, Nothing), (1, Just 4)]\n==\n[(1, Just 4), (9, Nothing)]\n</code></pre>\n\n<p>But this <em>also</em> reverses the sort order of the indices themselves, which we don\u2019t want:</p>\n\n<pre><code>sortBy (comparing (Down . snd)) [(1, Just 4), (3, Just 2)]\n==\n[(1, Just 4), (3, Just 2)]\n</code></pre>\n\n<p>So we can just add another <code>Down</code> around the indices:</p>\n\n<pre><code>findIndices needles haystack =\n  [ (needle, Down &lt;$&gt; findIndex (== needle) haystack)\n  | needle &lt;- needles\n  ]\n\nsortBy (comparing Down) [Just (Down 2), Nothing, Just (Down 1)]\n==\n[Just (Down 1), Just (Down 2), Nothing]\n\nsortBy (comparing (Down . snd))\n  [(1, Down (Just 4)), (3, Down (Just 2))]\n==\n[(3, Down (Just 2)), (1, Down (Just 4))]\n</code></pre>\n\n<p>And finally put it all together:</p>\n\n<pre><code>f :: (Eq a) =&gt; [a] -&gt; [a] -&gt; [Maybe a]\nf needles haystack =\n  [ value &lt;$ index\n  | (value, index) &lt;- sortBy (comparing (Down . snd))\n    [ (needle, Down &lt;$&gt; findIndex (== needle) haystack)\n    | needle &lt;- needles\n    ]\n  ]\n\nf [1, 3] xs == [Just 3, Just 1]\nf [3, 1] xs == [Just 3, Just 1]\nf [1, 9] xs == [Just 1, Nothing]\nf [9, 9] xs == [Nothing, Nothing]\n</code></pre>\n\n<p>Or, without list comprehensions and with shorter names:</p>\n\n<pre><code>f :: (Eq a) =&gt; [a] -&gt; [a] -&gt; [Maybe a]\nf ns hs\n  = map (\\ (v, i) -&gt; v &lt;$ i)\n  $ sortBy (comparing (Down . snd))\n  $ map (\\ n -&gt; (n, Down &lt;$&gt; findIndex (== n) hs)) ns\n</code></pre>\n\n<p><code>\\ (v, i) -&gt; v &lt;$ i</code> can also be written as <code>uncurry (&lt;$)</code>, but that might be a bit cryptic if you\u2019re not accustomed to point-free style. In addition, if you don\u2019t care about the <code>Nothing</code>s, you can use <code>mapMaybe</code> instead of <code>map</code>, changing the return type from <code>[Maybe a]</code> to just <code>[a]</code>.</p>\n"}], "owner": {"reputation": 5352, "user_id": 4896150, "user_type": "registered", "accept_rate": 43, "profile_image": "https://www.gravatar.com/avatar/74d0c938f3f71d6ee14db4f6b9d222c2?s=128&d=identicon&r=PG&f=1", "display_name": "Anton Harald", "link": "https://stackoverflow.com/users/4896150/anton-harald"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 66, "favorite_count": 0, "answer_count": 3, "score": 3, "last_activity_date": 1493724968, "creation_date": 1493706971, "question_id": 43731567, "link": "https://stackoverflow.com/questions/43731567/find-two-elements-in-a-list-order-them-by-their-occurence", "title": "Find two elements in a list, order them by their occurence", "body": "<p>I'm writing a function that takes a list and two elements that can possibly be contained in the list. The function should return the two elements in a structure that sorts them by their occurrence in the list.</p>\n\n<p>So, for number we'd have something like this:</p>\n\n<pre><code>xs = [4,6,3,2,1,8]\nf (3,1) --&gt; (Just 3, Just 1)\nf (1,3) --&gt; (Just 3, Just 1)\nf (9,1) --&gt; (Just 1, Nothing)\nf (9,9) --&gt; (Nothing, Nothing)\n</code></pre>\n\n<p>and so on..</p>\n\n<p>I used tuples up there since I'm actually only interested in those two values instead of an arbitrary number. But if there are reasons, modeling it as list would be ok as well.</p>\n\n<p>Anyways, here's the function I came up with:</p>\n\n<pre><code>f :: Eq a =&gt; [a] -&gt; (a, a) -&gt; (Maybe a, Maybe a) \nf xs (a, b) = foldl g (Nothing, Nothing) xs  where\n  g (Nothing, Nothing) x | x == a            = (Just a, Nothing)\n  g (Nothing, Nothing) x | x == b            = (Just b, Nothing)\n  g (Just a', Nothing) x | a' == a &amp;&amp; x == b = (Just a, Just b)\n  g (Just b', Nothing) x | b' == b &amp;&amp; x == a = (Just b, Just a)\n  g m x = m\n</code></pre>\n\n<p>Its working, but I think it's quite a lot of pattern matching in there, it's sort of error-prone. So, does anybody have a better abstraction for the problem?</p>\n"}, {"tags": ["haskell", "gadt", "data-kinds"], "comments": [{"owner": {"reputation": 1735, "user_id": 2892792, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/5DNyi.jpg?s=128&g=1", "display_name": "Lazersmoke", "link": "https://stackoverflow.com/users/2892792/lazersmoke"}, "edited": false, "score": 0, "creation_date": 1493692670, "post_id": 43729170, "comment_id": 74502005, "body": "Could you write a use case? It is pretty hard to understand what you are trying to do without concrete code to look at."}, {"owner": {"reputation": 20310, "user_id": 525980, "user_type": "registered", "accept_rate": 48, "profile_image": "https://www.gravatar.com/avatar/8dafe66793ee2f32192e9fcefb389a12?s=128&d=identicon&r=PG", "display_name": "Clinton", "link": "https://stackoverflow.com/users/525980/clinton"}, "reply_to_user": {"reputation": 1735, "user_id": 2892792, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/5DNyi.jpg?s=128&g=1", "display_name": "Lazersmoke", "link": "https://stackoverflow.com/users/2892792/lazersmoke"}, "edited": false, "score": 0, "creation_date": 1493692874, "post_id": 43729170, "comment_id": 74502050, "body": "The use case if it helps (I&#39;m not sure how it does) is dealing with expressions of various similar but slightly different types (there&#39;s a lot of overlap but some differences in behaviour).   The code isn&#39;t concrete yet because I haven&#39;t written it because I&#39;m unsure of the best approach (hence the question)."}, {"owner": {"reputation": 1735, "user_id": 2892792, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/5DNyi.jpg?s=128&g=1", "display_name": "Lazersmoke", "link": "https://stackoverflow.com/users/2892792/lazersmoke"}, "edited": false, "score": 0, "creation_date": 1493694795, "post_id": 43729170, "comment_id": 74502470, "body": "By use case, I mean <i>why</i> are you doing this, not <i>what</i> are you doing. It&#39;s hard to understand what you mean from these abstract types. <i>Why</i> do you need to &quot;pattern-match&quot; on types? Try to create a minimal version of the problem you are actually trying to solve that presents the same design challenges as the full problem so we can see what the true requirements are. That will help us help you :)"}, {"owner": {"reputation": 20310, "user_id": 525980, "user_type": "registered", "accept_rate": 48, "profile_image": "https://www.gravatar.com/avatar/8dafe66793ee2f32192e9fcefb389a12?s=128&d=identicon&r=PG", "display_name": "Clinton", "link": "https://stackoverflow.com/users/525980/clinton"}, "reply_to_user": {"reputation": 1735, "user_id": 2892792, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/5DNyi.jpg?s=128&g=1", "display_name": "Lazersmoke", "link": "https://stackoverflow.com/users/2892792/lazersmoke"}, "edited": false, "score": 0, "creation_date": 1493694893, "post_id": 43729170, "comment_id": 74502494, "body": "Why I&#39;m doing this is because the current code is full of incomplete pattern matches and replication because the types don&#39;t accurately represent the values in question."}, {"owner": {"reputation": 20310, "user_id": 525980, "user_type": "registered", "accept_rate": 48, "profile_image": "https://www.gravatar.com/avatar/8dafe66793ee2f32192e9fcefb389a12?s=128&d=identicon&r=PG", "display_name": "Clinton", "link": "https://stackoverflow.com/users/525980/clinton"}, "reply_to_user": {"reputation": 1735, "user_id": 2892792, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/5DNyi.jpg?s=128&g=1", "display_name": "Lazersmoke", "link": "https://stackoverflow.com/users/2892792/lazersmoke"}, "edited": false, "score": 0, "creation_date": 1493694970, "post_id": 43729170, "comment_id": 74502509, "body": "I&#39;m not sure how I could make it more minimal. The reason why I&#39;ve presented it like this is so it doesn&#39;t contain any extra information not relevant to my question. I could solve it badly and post that but it would be many hundreds of lines of code."}, {"owner": {"reputation": 11001, "user_id": 727667, "user_type": "registered", "accept_rate": 88, "profile_image": "https://www.gravatar.com/avatar/2e2cbd3a202d8d1cfe0cc2a9fff86733?s=128&d=identicon&r=PG", "display_name": "gallais", "link": "https://stackoverflow.com/users/727667/gallais"}, "edited": false, "score": 6, "creation_date": 1493714551, "post_id": 43729170, "comment_id": 74510129, "body": "The library you&#39;re looking for is <a href=\"https://hackage.haskell.org/package/singletons\" rel=\"nofollow noreferrer\">singletons</a> which will allow you to generate <code>TConstructor</code> automatically (it&#39;ll probably be named <code>ST</code> for &quot;singleton of T&quot;)."}, {"owner": {"reputation": 13807, "user_id": 2407038, "user_type": "registered", "accept_rate": 64, "profile_image": "https://www.gravatar.com/avatar/538f6f4a9aa43841841de7d8e8b169fc?s=128&d=identicon&r=PG&f=1", "display_name": "user2407038", "link": "https://stackoverflow.com/users/2407038/user2407038"}, "edited": false, "score": 3, "creation_date": 1493733963, "post_id": 43729170, "comment_id": 74522814, "body": "As other commenters mentioned, <code>singletons</code> is designed to solve precisely this problem. But in modern GHC it is really a very heavy-weight solution; you can make your life much easier by deriving <code>Typeable</code> instances for your types, and then using the type <code>data Sing_D (x :: D t) where MkSing_D :: Typeable x =&gt; Sing_D x</code> - this is essentially like your <code>TConstructor</code> solution, except <code>Typeable</code> is auto-generated by the compiler."}, {"owner": {"reputation": 100185, "user_id": 3234959, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/93bb12ca0f93dfddb33880316f7e66c2?s=128&d=identicon&r=PG&f=1", "display_name": "chi", "link": "https://stackoverflow.com/users/3234959/chi"}, "edited": false, "score": 3, "creation_date": 1493736786, "post_id": 43729170, "comment_id": 74524944, "body": "You have basically re-invented singletons. That&#39;s good! For the moment, we have to use those. Maybe one day GHC will allow non-erased types (&quot;pi types&quot;) and we will be able to do without singletons."}], "owner": {"reputation": 20310, "user_id": 525980, "user_type": "registered", "accept_rate": 48, "profile_image": "https://www.gravatar.com/avatar/8dafe66793ee2f32192e9fcefb389a12?s=128&d=identicon&r=PG", "display_name": "Clinton", "link": "https://stackoverflow.com/users/525980/clinton"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 68, "favorite_count": 0, "answer_count": 0, "score": 2, "last_activity_date": 1493692344, "creation_date": 1493692344, "question_id": 43729170, "link": "https://stackoverflow.com/questions/43729170/matching-against-a-gadts-specific-type", "title": "Matching against a GADTs specific type", "body": "<p>With <code>DataKinds</code> and <code>KindSignatures</code>, I can do the following:</p>\n\n<pre><code>data T = T1 | T2 | ... | TN\n\ndata D (t :: T) where ...\n  D1 :: ... -&gt; D t\n  D2 :: ... -&gt; D t\n  .\n  .\n  .\n  DN :: ... -&gt; D t\n</code></pre>\n\n<p>But of course, Haskell removes this type at runtime. I could keep this information by separating the constructors:</p>\n\n<pre><code>data D' (t :: T) where ...\n  D1T1 :: ... -&gt; D' T1\n  D1T2 :: ... -&gt; D' T2\n  .\n  .\n  .\n  D1TN :: ... -&gt; D' TN\n  D2T1 :: ... -&gt; D' T1\n  D2T2 :: ... -&gt; D' T2\n  .\n  .\n  .\n  D2TN :: ... -&gt; D' TN\n  .\n  .\n  .\n  DNT1 :: ... -&gt; D' T1\n  DNT2 :: ... -&gt; D' T2\n  .\n  .\n  .\n  DNTN :: ... -&gt; D' TN\n</code></pre>\n\n<p>And then when I pattern match, I've got the type also. But now I've blown out the number of constructors needed, and I suspect this will be a maintenance nightmare.</p>\n\n<p>I'd like to do something like this:</p>\n\n<pre><code>data DWrap (t :: T) where\n  DWrap :: t -&gt; D t -&gt; DWrap t\n</code></pre>\n\n<p>And then I can pattern match against <code>DWrap</code> to determine the type:</p>\n\n<pre><code>g :: D T1 -&gt; ...\ng = ...\n\nf (DWrap T1 x) = g x\n</code></pre>\n\n<p>Which should be fine because once we match against <code>T1</code> we know <code>t</code> and then we know we it's the right type to start to pass to <code>g</code>.</p>\n\n<p>Of course, if I just want to ignore the type I can like so:</p>\n\n<pre><code>h :: D t -&gt; ...\nh = ...\n\nf (DWrap _ x) = h x\n</code></pre>\n\n<p>And either way completeness checking should make sure I don't do anything silly.</p>\n\n<p>Except this approach won't work. Firstly, because <code>t</code> is not an ordinary type of kind <code>*</code>, it's of kind <code>T</code>. Secondly <code>T1</code> isn't even of type <code>'T1</code>, it's a member of the type <code>T</code>, just like <code>T2</code>, <code>T3</code> etc, so that's a useless approach to differentiating between types.</p>\n\n<p>To attempt to solve the first problem, I could change <code>t</code> to <code>Proxy t</code>:</p>\n\n<pre><code>data DWrap (t :: T) where\n  DWrap :: Proxy t -&gt; D t -&gt; DWrap t\n</code></pre>\n\n<p>Now this <code>data</code> definition compiles, but this is quite useless for differentiating between types, because <code>Proxy</code> only has one constructor.</p>\n\n<p>I could do this:</p>\n\n<pre><code>data TConstructor (t :: T) where\n  T1Con :: TConstructor T1\n  T2Con :: TConstructor T2\n  .\n  .\n  .\n  TNCon :: TConstructor TN\n</code></pre>\n\n<p>And then this:</p>\n\n<pre><code>data DWrap (t :: T) where\n  DWrap :: TConstructor t -&gt; D t -&gt; DWrap t\n</code></pre>\n\n<p>And then I could match like this:</p>\n\n<pre><code>g :: D T1 -&gt; ...\ng = ...\n\nf (DWrap T1Con x) = g x\n</code></pre>\n\n<p>This should do the job, but I have to write out <code>data TConstructor</code>, which is almost a copy of <code>data T</code>. Is there anyway I could avoid this extra boilerplate and still achieve what I'm trying to do?</p>\n"}, {"tags": ["haskell", "complex-numbers"], "comments": [{"owner": {"reputation": 833, "user_id": 7847896, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/c3e72cb1d5eceb94842bec50894e6943?s=128&d=identicon&r=PG&f=1", "display_name": "zbw", "link": "https://stackoverflow.com/users/7847896/zbw"}, "edited": false, "score": 1, "creation_date": 1493673665, "post_id": 43726658, "comment_id": 74497109, "body": "Why not <code>function :: (Ord a, Eq b) -&gt; a -&gt; a -&gt; b -&gt; b -&gt; Bool</code>?"}, {"owner": {"reputation": 11096, "user_id": 2749717, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/46af1ef54856d737d52b7667afd240ee?s=128&d=identicon&r=PG&f=1", "display_name": "bipll", "link": "https://stackoverflow.com/users/2749717/bipll"}, "edited": false, "score": 2, "creation_date": 1493673721, "post_id": 43726658, "comment_id": 74497128, "body": "How to define an ordering among complex numbers? Technically, any set can be made well-ordered, in fact this seldom makes sense. You may order it lexicographically, first compare real parts and, when equal, imaginary ones; or use polar form and compare radii first, then arguments."}, {"owner": {"reputation": 126897, "user_id": 791604, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/ce991df7a056248d5e4f6fc3659ba733?s=128&d=identicon&r=PG", "display_name": "Daniel Wagner", "link": "https://stackoverflow.com/users/791604/daniel-wagner"}, "edited": false, "score": 2, "creation_date": 1493673781, "post_id": 43726658, "comment_id": 74497156, "body": "This question is basically unanswerable. You&#39;ve said &quot;this function doesn&#39;t do what I want&quot;, but you haven&#39;t gone on to the &quot;and what I want is...&quot; part."}, {"owner": {"reputation": 27, "user_id": 7945715, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/f06dbe79bee2a8ced192e7b4698e3829?s=128&d=identicon&r=PG&f=1", "display_name": "cde33", "link": "https://stackoverflow.com/users/7945715/cde33"}, "reply_to_user": {"reputation": 126897, "user_id": 791604, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/ce991df7a056248d5e4f6fc3659ba733?s=128&d=identicon&r=PG", "display_name": "Daniel Wagner", "link": "https://stackoverflow.com/users/791604/daniel-wagner"}, "edited": false, "score": 0, "creation_date": 1493673929, "post_id": 43726658, "comment_id": 74497223, "body": "@DanielWagner what I want is that the function that I write accept also complex numbers, but in the way I&#39;m defining it, it can&#39;t do that."}, {"owner": {"reputation": 853, "user_id": 3645112, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/QFHGj.jpg?s=128&g=1", "display_name": "Rainbacon", "link": "https://stackoverflow.com/users/3645112/rainbacon"}, "edited": false, "score": 0, "creation_date": 1493673981, "post_id": 43726658, "comment_id": 74497248, "body": "You need to define an implementation of <code>Ord</code> for <code>Complex</code>"}, {"owner": {"reputation": 27, "user_id": 7945715, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/f06dbe79bee2a8ced192e7b4698e3829?s=128&d=identicon&r=PG&f=1", "display_name": "cde33", "link": "https://stackoverflow.com/users/7945715/cde33"}, "reply_to_user": {"reputation": 853, "user_id": 3645112, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/QFHGj.jpg?s=128&g=1", "display_name": "Rainbacon", "link": "https://stackoverflow.com/users/3645112/rainbacon"}, "edited": false, "score": 0, "creation_date": 1493673984, "post_id": 43726658, "comment_id": 74497250, "body": "@Rainbacon I&#39;m asking which is the type that would include ordenable numbers and also complex numbers. So I have to do a special implementation? Doesn&#39;t exist allready one"}, {"owner": {"reputation": 126897, "user_id": 791604, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/ce991df7a056248d5e4f6fc3659ba733?s=128&d=identicon&r=PG", "display_name": "Daniel Wagner", "link": "https://stackoverflow.com/users/791604/daniel-wagner"}, "edited": false, "score": 2, "creation_date": 1493673989, "post_id": 43726658, "comment_id": 74497254, "body": "@cde33 Accept complex numbers and do what with them, exactly? You need to explain what this function is going to be used for, or else my answer is going to be <code>function _ _ _ _ = True</code>."}, {"owner": {"reputation": 100185, "user_id": 3234959, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/93bb12ca0f93dfddb33880316f7e66c2?s=128&d=identicon&r=PG&f=1", "display_name": "chi", "link": "https://stackoverflow.com/users/3234959/chi"}, "edited": false, "score": 2, "creation_date": 1493678154, "post_id": 43726658, "comment_id": 74498763, "body": "There is no standard definition of an ordering for complex numbers since in mathematics they are not ordered (no satisfactory ordering can be defined). You did not specify <i>how</i> the complex should be ordered, not why do you need such ordering."}, {"owner": {"reputation": 45534, "user_id": 106104, "user_type": "registered", "accept_rate": 62, "profile_image": "https://www.gravatar.com/avatar/c88b9310b92a937108ec4336c2832f92?s=128&d=identicon&r=PG", "display_name": "user253751", "link": "https://stackoverflow.com/users/106104/user253751"}, "edited": false, "score": 0, "creation_date": 1493692259, "post_id": 43726658, "comment_id": 74501912, "body": "@cde33 Is 2+3i greater than 3+2i?"}], "answers": [{"comments": [{"owner": {"reputation": 126897, "user_id": 791604, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/ce991df7a056248d5e4f6fc3659ba733?s=128&d=identicon&r=PG", "display_name": "Daniel Wagner", "link": "https://stackoverflow.com/users/791604/daniel-wagner"}, "edited": false, "score": 0, "creation_date": 1493748058, "post_id": 43727320, "comment_id": 74531584, "body": "Your second link directly contradicts you, exhibiting a total order on complex numbers in the first paragraph."}, {"owner": {"reputation": 15757, "user_id": 176841, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/45a168cb9eb8454d66c78f18e29d9342?s=128&d=identicon&r=PG", "display_name": "jberryman", "link": "https://stackoverflow.com/users/176841/jberryman"}, "reply_to_user": {"reputation": 126897, "user_id": 791604, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/ce991df7a056248d5e4f6fc3659ba733?s=128&d=identicon&r=PG", "display_name": "Daniel Wagner", "link": "https://stackoverflow.com/users/791604/daniel-wagner"}, "edited": false, "score": 0, "creation_date": 1493750972, "post_id": 43727320, "comment_id": 74533219, "body": "@DanielWagner ah shoot, I carelessly skimmed that link and thought they want on to imply contradiction on that ordering."}], "tags": [], "owner": {"reputation": 15757, "user_id": 176841, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/45a168cb9eb8454d66c78f18e29d9342?s=128&d=identicon&r=PG", "display_name": "jberryman", "link": "https://stackoverflow.com/users/176841/jberryman"}, "is_accepted": true, "score": 5, "last_activity_date": 1493676986, "creation_date": 1493676986, "answer_id": 43727320, "question_id": 43726658, "link": "https://stackoverflow.com/questions/43726658/ord-and-complex-in-haskell/43727320#43727320", "title": "ord and complex in haskell", "body": "<p>I believe the answer is that you cannot, or should not.  </p>\n\n<p><code>Ord</code> is the axiom of <a href=\"https://en.wikipedia.org/wiki/Trichotomy_%28mathematics%29\" rel=\"noreferrer\">trichotomy</a>, which complex numbers apparently do not satisfy. So I don't think there's a total implementation for <code>compare</code> possible (though I might be misunderstanding):</p>\n\n<pre><code>Prelude&gt; :info Ord\nclass Eq a =&gt; Ord a where\n  compare :: a -&gt; a -&gt; Ordering\n  ...\nPrelude&gt; :info Ordering\ndata Ordering = LT | EQ | GT    -- Defined in \u2018GHC.Types\u2019\n</code></pre>\n\n<p>This explains why no one has defined an <code>Ord</code> instance for you already.</p>\n\n<p>See:</p>\n\n<ul>\n<li><a href=\"https://math.stackexchange.com/a/257208\">https://math.stackexchange.com/a/257208</a></li>\n<li><a href=\"http://www.cut-the-knot.org/do_you_know/complex_compare.shtml\" rel=\"noreferrer\">http://www.cut-the-knot.org/do_you_know/complex_compare.shtml</a></li>\n</ul>\n"}], "owner": {"reputation": 27, "user_id": 7945715, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/f06dbe79bee2a8ced192e7b4698e3829?s=128&d=identicon&r=PG&f=1", "display_name": "cde33", "link": "https://stackoverflow.com/users/7945715/cde33"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 272, "favorite_count": 0, "closed_date": 1493701648, "accepted_answer_id": 43727320, "answer_count": 1, "score": 1, "last_activity_date": 1493676986, "creation_date": 1493673419, "question_id": 43726658, "link": "https://stackoverflow.com/questions/43726658/ord-and-complex-in-haskell", "closed_reason": "Needs details or clarity", "title": "ord and complex in haskell", "body": "<p>I have this function:</p>\n\n<pre><code>function x y z w = x &gt;= y &amp;&amp; z == w\n</code></pre>\n\n<p>For defining the type I thought about this: </p>\n\n<pre><code>function:: Ord a=&gt; a-&gt; a-&gt;a-&gt;a-&gt; Bool\n</code></pre>\n\n<p>The problem is that I'm not taking into account the complex numbers. How I can define it including them?</p>\n"}, {"tags": ["haskell", "svg", "haskell-diagrams"], "answers": [{"tags": [], "owner": {"reputation": 479, "user_id": 5674394, "user_type": "registered", "accept_rate": 43, "profile_image": "https://www.gravatar.com/avatar/9c6d14746bc54c07138037510242d08c?s=128&d=identicon&r=PG", "display_name": "Joshua Meyers", "link": "https://stackoverflow.com/users/5674394/joshua-meyers"}, "is_accepted": false, "score": 0, "last_activity_date": 1493716736, "creation_date": 1493716736, "answer_id": 43734279, "question_id": 43726432, "link": "https://stackoverflow.com/questions/43726432/how-do-i-use-the-same-output-for-multiple-diagrams/43734279#43734279", "title": "How do I use the same output for multiple diagrams?", "body": "<p>I finally managed to figure this out.</p>\n\n<p>I had some arrows: for these I used the arrowOpts:</p>\n\n<pre><code>(with &amp; arrowHead .~ myTri\n      &amp; arrowTail .~ lineTail\n      &amp; lengths .~ output 15\n      &amp; arrowShaft .~ idShaft offset\n      &amp; shaftStyle %~ lwO 1)\n</code></pre>\n\n<p>For SVG rendering I used <code>renderPretty' outFile svgOpt diagram</code> with</p>\n\n<pre><code>svgOpt :: Num n =&gt; Options SVG V2 n\nsvgOpt = SVGOptions {\n  _size = absolute,\n  _idPrefix = empty,\n  _svgDefinitions = Nothing,\n  _svgAttributes = [],\n  _generateDoctype = False\n}\n</code></pre>\n\n<p>The crucial part is setting <code>_size = absolute</code>, which causes the resulting svg to not be scaled at all.</p>\n\n<p>I'm still trying to track down the other measurements that aren't <code>output</code> yet.</p>\n"}], "owner": {"reputation": 479, "user_id": 5674394, "user_type": "registered", "accept_rate": 43, "profile_image": "https://www.gravatar.com/avatar/9c6d14746bc54c07138037510242d08c?s=128&d=identicon&r=PG", "display_name": "Joshua Meyers", "link": "https://stackoverflow.com/users/5674394/joshua-meyers"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 75, "favorite_count": 0, "answer_count": 1, "score": 1, "last_activity_date": 1493716736, "creation_date": 1493672316, "question_id": 43726432, "link": "https://stackoverflow.com/questions/43726432/how-do-i-use-the-same-output-for-multiple-diagrams", "title": "How do I use the same output for multiple diagrams?", "body": "<p>I also posted the following as a <a href=\"https://github.com/diagrams/diagrams-doc/issues/112\" rel=\"nofollow noreferrer\"><code>diagrams-doc</code> issue</a>, but I thought it might be more appropriate here.</p>\n\n<p>The user manual <a href=\"http://projects.haskell.org/diagrams/doc/manual.html#output-units\" rel=\"nofollow noreferrer\">says this</a>: </p>\n\n<blockquote>\n  <p>One situation in which output units can be particularly useful is when preparing a document (paper, blog post, etc.) with multiple embedded diagrams of various physical sizes. Using the same output value for the line width (or arrowhead length, arrow gap, font size, etc.) of every diagram ensures that the diagrams will all look consistent.</p>\n</blockquote>\n\n<p>This is exactly what I'd like to do.  I am making a webpage with multiple <code>diagrams</code>-generated svg files of different sizes inline, and I'd like the line widths, arrowhead sizes, and circle radii to be consistent.  But I'm not sure how.  How would I pass the same output value to all the arrows, arrowheads, circles, etc.?  And when I ultimately render with <code>renderPretty</code>, what would I set <code>size</code> to in the <code>SVGOptions</code> argument so that it just makes the svg whatever size its contents are?</p>\n"}, {"tags": ["haskell", "types"], "comments": [{"owner": {"reputation": 100185, "user_id": 3234959, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/93bb12ca0f93dfddb33880316f7e66c2?s=128&d=identicon&r=PG&f=1", "display_name": "chi", "link": "https://stackoverflow.com/users/3234959/chi"}, "edited": false, "score": 1, "creation_date": 1493670434, "post_id": 43725387, "comment_id": 74495703, "body": "I see no &quot;<code>+ (Expr Expr)</code>&quot; anywhere. What are you referring to? BTW, <code>Expr a</code> is a type, whose constructors are <code>Var, Const, (:+:), (:*:), (:^:), (:&#47;:)</code>, the last ones being used in infix notation."}, {"owner": {"reputation": 1735, "user_id": 2892792, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/5DNyi.jpg?s=128&g=1", "display_name": "Lazersmoke", "link": "https://stackoverflow.com/users/2892792/lazersmoke"}, "edited": false, "score": 0, "creation_date": 1493671941, "post_id": 43725387, "comment_id": 74496382, "body": "A few terms to help you understand: <code>Expr</code> is a <i>type constructor</i> because it constructs a type from the <i>type variable</i> <code>a</code>. <code>Expr</code> has the <i>kind</i> <code>* -&gt; *</code> because it takes one normal data type (of kind <code>*</code>) and gives back another normal data type (of kind <code>*</code>). <code>Var</code>, <code>Const</code>, <code>:+:</code>, et al are <i>data constructor</i>s because they construct <code>Expr a</code>s from whatever their arguments are. Note that <code>Var :: Char -&gt; Expr a</code>, <code>Const :: a -&gt; Expr a</code>, <code>(:+:) :: Expr a -&gt; Expr a -&gt; Expr a</code>, etc."}], "answers": [{"tags": [], "owner": {"reputation": 2313, "user_id": 5318306, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/897fd4f3b92d28c5c1eb28a8024661a1?s=128&d=identicon&r=PG&f=1", "display_name": "Gurkenglas", "link": "https://stackoverflow.com/users/5318306/gurkenglas"}, "is_accepted": false, "score": 1, "last_activity_date": 1493668227, "creation_date": 1493668227, "answer_id": 43725488, "question_id": 43725387, "link": "https://stackoverflow.com/questions/43725387/method-signature-haskell-user-defined-type/43725488#43725488", "title": "Method signature Haskell user defined type", "body": "<p>For each type <code>a</code> that has instances for the typeclasses <code>Num</code>, <code>Eq</code> and <code>Floating</code>, <code>simplify</code> can specialize to <code>Expr a -&gt; Expr a</code>. The namespaces of types and values are separate. <code>Expr</code> is a type constructor. <code>Expr a</code> is a type that has values. Nothing here is restricted to be a <code>Double</code>, <code>(+)</code> admits everything with a <code>Num</code> instance.</p>\n"}, {"tags": [], "owner": {"reputation": 51584, "user_id": 839246, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/9b0573c2b936b12828dd1e4cc04206dc?s=128&d=identicon&r=PG&f=1", "display_name": "bheklilr", "link": "https://stackoverflow.com/users/839246/bheklilr"}, "is_accepted": false, "score": 3, "last_activity_date": 1493668429, "creation_date": 1493668429, "answer_id": 43725527, "question_id": 43725387, "link": "https://stackoverflow.com/questions/43725387/method-signature-haskell-user-defined-type/43725527#43725527", "title": "Method signature Haskell user defined type", "body": "<p>In the data definition</p>\n\n<pre><code>data Expr a = ...\n</code></pre>\n\n<p>The <code>a</code> means that there is a type variable there.  A simple example would be</p>\n\n<pre><code>data Two a = Two a a\n</code></pre>\n\n<p>This is a type with the name <code>Two</code>, which takes a single type parameter.  It has a data constructor also called <code>Two</code> which has two fields, each of type <code>a</code>.  For example, the type <code>Two Int</code> has the specialized constructor <code>Two :: Int -&gt; Int -&gt; Two Int</code></p>\n\n<p>In this case, you're saying that your <code>Expr</code> type has a type parameter, and has a number of constructors, some of which have fields of type <code>a</code>.  You might use this to have a value of type <code>Expr Int</code>, such as <code>Const 1 :+: Const 2</code>.</p>\n\n<p>When you see a type signature like</p>\n\n<pre><code>simplify :: (Num a, Eq a, Floating a) =&gt; Expr a -&gt; Expr a\n</code></pre>\n\n<p>This means that the function takes a value of type <code>Expr a</code> and returns a value of the same type, except here the type variable <code>a</code> has additional constraints.  Namely <code>Num</code>, <code>Eq</code>, and <code>Floating</code>.  These are typeclasses, and a type <code>a</code> must implement those type classes for you to be able to use <code>simplify</code> on <code>Expr a</code>.</p>\n\n<p>The <code>a</code> in the type signature has nothing to do with the <code>a</code> in the first line of the definition of <code>simplify</code>.  It's just a choice by the author to use the same name.  Type names and data names live in completely different namespaces in Haskell, they don't conflict or relate at all.</p>\n"}], "owner": {"reputation": 11, "user_id": 7930221, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/f3ff8ef185057d6ed422650d6f568b20?s=128&d=identicon&r=PG&f=1", "display_name": "E Colnaghi", "link": "https://stackoverflow.com/users/7930221/e-colnaghi"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 98, "favorite_count": 0, "answer_count": 2, "score": 1, "last_activity_date": 1493668429, "creation_date": 1493667697, "question_id": 43725387, "link": "https://stackoverflow.com/questions/43725387/method-signature-haskell-user-defined-type", "title": "Method signature Haskell user defined type", "body": "<p>I'm trying learning Haskell and I ended up reading <a href=\"http://5outh.blogspot.it/2013/05/symbolic-calculus-in-haskell.html\" rel=\"nofollow noreferrer\">this</a>\nand I'm trying to figure out what some parts of the code do.</p>\n\n<p>At first, there's a data type definition:</p>\n\n<pre><code>infixl 4 :+:\ninfixl 5 :*:, :/:\ninfixr 6 :^:\n\ndata Expr a = Var Char\n             | Const a \n             | (Expr a) :+: (Expr a) \n             | (Expr a) :*: (Expr a)\n             | (Expr a) :^: (Expr a)\n             | (Expr a) :/: (Expr a)\n             deriving (Show, Eq)\n</code></pre>\n\n<p>and next there is a function:</p>\n\n<pre><code>simplify :: (Num a, Eq a, Floating a) =&gt; Expr a -&gt; Expr a\nsimplify (Const a :+: Const b) = Const (a + b)\nsimplify (a       :+: Const 0) = simplify a\nsimplify (Const 0 :+: a      ) = simplify a\n</code></pre>\n\n<p>So, what does \"(Num a, Eq a, Floating a) => Expr a\" stand for in this case?</p>\n\n<p>\"Expr\" is not a constructor, and in the first line the type is \"+ (Expr Expr)\", so what does \"a\" mean here, and why is it restricted to be a double?\nAnd is the \"a\" in the type signature related to the \"a\" in the second line of the function, even if here a is clearly an Expr?</p>\n"}, {"tags": ["haskell", "combinations", "permutation"], "comments": [{"owner": {"reputation": 75362, "user_id": 625403, "user_type": "registered", "accept_rate": 82, "profile_image": "https://www.gravatar.com/avatar/786eed7da67079cb5d63a49d469af25b?s=128&d=identicon&r=PG", "display_name": "amalloy", "link": "https://stackoverflow.com/users/625403/amalloy"}, "edited": false, "score": 0, "creation_date": 1493660776, "post_id": 43723609, "comment_id": 74491067, "body": "Thinking of this as a &quot;permutation&quot; of the list is making things harder for you, because you don&#39;t want to permute anything. Instead, try thinking of it as a function that makes a non-deterministic <i>choice</i>, choosing one of N places within the stream of Es to place a block of Fs. Nondeterminism is well-modeled by a list of possible results, so you will do well to write a recursive function consuming the list and producing a list as output."}], "answers": [{"comments": [{"owner": {"reputation": 922, "user_id": 2923589, "user_type": "registered", "accept_rate": 77, "profile_image": "https://www.gravatar.com/avatar/ba91f50d535333744c2d5ddb1ce05412?s=128&d=identicon&r=PG&f=1", "display_name": "Tamas Koos", "link": "https://stackoverflow.com/users/2923589/tamas-koos"}, "edited": false, "score": 0, "creation_date": 1493660927, "post_id": 43723719, "comment_id": 74491145, "body": "But how do I make k range over m-n in haskell?"}, {"owner": {"reputation": 100185, "user_id": 3234959, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/93bb12ca0f93dfddb33880316f7e66c2?s=128&d=identicon&r=PG&f=1", "display_name": "chi", "link": "https://stackoverflow.com/users/3234959/chi"}, "reply_to_user": {"reputation": 922, "user_id": 2923589, "user_type": "registered", "accept_rate": 77, "profile_image": "https://www.gravatar.com/avatar/ba91f50d535333744c2d5ddb1ce05412?s=128&d=identicon&r=PG&f=1", "display_name": "Tamas Koos", "link": "https://stackoverflow.com/users/2923589/tamas-koos"}, "edited": false, "score": 0, "creation_date": 1493661240, "post_id": 43723719, "comment_id": 74491299, "body": "&quot;using a list comprehension&quot;"}], "tags": [], "owner": {"reputation": 100185, "user_id": 3234959, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/93bb12ca0f93dfddb33880316f7e66c2?s=128&d=identicon&r=PG&f=1", "display_name": "chi", "link": "https://stackoverflow.com/users/3234959/chi"}, "is_accepted": true, "score": 2, "last_activity_date": 1493660716, "creation_date": 1493660716, "answer_id": 43723719, "question_id": 43723609, "link": "https://stackoverflow.com/questions/43723609/permutations-of-a-list-containing-the-same-element-several-times/43723719#43723719", "title": "Permutations of a list containing the same element several times", "body": "<p>Here's a hint.</p>\n\n<p>Each possible combination has some E's, some F's, and some E's, in that order. I.e., it is of this form</p>\n\n<pre><code>replicate k 'e' ++ replicate n 'f' ++ replicate (m-n-k) 'e'\n</code></pre>\n\n<p>Now, make <code>k</code> range over the \"right\" interval, using a list comprehension, and you're done.</p>\n"}, {"tags": [], "owner": {"reputation": 75362, "user_id": 625403, "user_type": "registered", "accept_rate": 82, "profile_image": "https://www.gravatar.com/avatar/786eed7da67079cb5d63a49d469af25b?s=128&d=identicon&r=PG", "display_name": "amalloy", "link": "https://stackoverflow.com/users/625403/amalloy"}, "is_accepted": false, "score": 1, "last_activity_date": 1493661784, "creation_date": 1493661784, "answer_id": 43723977, "question_id": 43723609, "link": "https://stackoverflow.com/questions/43723609/permutations-of-a-list-containing-the-same-element-several-times/43723977#43723977", "title": "Permutations of a list containing the same element several times", "body": "<p>As I mentioned in a comment, this is not a permutation problem at all. Rather, you want to walk through the input stream, choosing exactly one place to insert the block of interloping characters. If the input stream is empty, you have no choice, and must insert the block at the end. Otherwise, you may choose to insert the block at the current location, or otherwise to insert it later, in which case you include one more item from the primary stream before the block.</p>\n\n<pre><code>block :: a -&gt; a -&gt; Int -&gt; Int -&gt; [[a]]\nblock stream interloper width = go\n  where go 0 = [replicate width interloper]\n        go n = (replicate width interloper ++ replicate n stream)\n               : ((stream :) &lt;$&gt; go (n - 1))\n\nplaceOneBlock :: Int -&gt; Int -&gt; [String]\nplaceOneBlock = block 'e' 'f'\n</code></pre>\n\n<p>This solution is a bit more complicated than chi's answer, which proposes to write something like <code>replicate x 'e' ++ replicate y 'f' ++ replicate z 'e'</code> for all appropriate choices of x/y/z. An upside of my solution is it is much simpler to modify to handle multiple block objects rather than just one, or some other rule that indicates where a block is legal. But if you don't anticipate any of this changing, chi's solution sounds fine to me.</p>\n"}, {"tags": [], "owner": {"reputation": 18798, "user_id": 4543207, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/8ed6f11c827fa7cef811f141a84cc14b?s=128&d=identicon&r=PG&f=1", "display_name": "Redu", "link": "https://stackoverflow.com/users/4543207/redu"}, "is_accepted": false, "score": 0, "last_activity_date": 1493742098, "creation_date": 1493742098, "answer_id": 43742815, "question_id": 43723609, "link": "https://stackoverflow.com/questions/43723609/permutations-of-a-list-containing-the-same-element-several-times/43742815#43742815", "title": "Permutations of a list containing the same element several times", "body": "<p>I guess this has got nothing to do with permutations. It's a simple split and insert at all positions job. You may implement as follows;</p>\n\n<pre><code>allSplits :: Int -&gt; Int -&gt; [String]\nallSplits 0 m = [replicate m 'e']\nallSplits n m | n &gt;= m    = [fs]\n              | otherwise = (fs ++ replicate (m-n) 'e') : map ('e':) (allSplits n (m-1))\n                where fs  = replicate n 'f'\n</code></pre>\n"}, {"comments": [{"owner": {"reputation": 2171, "user_id": 1190376, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/61970bb1278cba93a6060586f35241b0?s=128&d=identicon&r=PG", "display_name": "Antimony", "link": "https://stackoverflow.com/users/1190376/antimony"}, "edited": false, "score": 0, "creation_date": 1493750454, "post_id": 43743160, "comment_id": 74532876, "body": "Can you please edit your answer to add why this works and explain the changes you made?"}], "tags": [], "owner": {"reputation": 1, "user_id": 7953267, "user_type": "unregistered", "profile_image": "https://www.gravatar.com/avatar/adfb97a1d9c8669ed6e394263a7ff82f?s=128&d=identicon&r=PG", "display_name": "Haskellbeadando", "link": "https://stackoverflow.com/users/7953267/haskellbeadando"}, "is_accepted": false, "score": 0, "last_activity_date": 1493743286, "creation_date": 1493743286, "answer_id": 43743160, "question_id": 43723609, "link": "https://stackoverflow.com/questions/43723609/permutations-of-a-list-containing-the-same-element-several-times/43743160#43743160", "title": "Permutations of a list containing the same element several times", "body": "<p>Here is the working code:</p>\n\n<pre><code>placeOneBlock 0 m = [replicate m 'e']\nplaceOneBlock n m | n == m    = [fs] \n | n &gt; m = []\n | otherwise = (fs ++ replicate (m-n) 'e') : map ('e':) (placeOneBlock n (m-1))\n            where fs  = replicate n 'f'\n</code></pre>\n"}], "owner": {"reputation": 922, "user_id": 2923589, "user_type": "registered", "accept_rate": 77, "profile_image": "https://www.gravatar.com/avatar/ba91f50d535333744c2d5ddb1ce05412?s=128&d=identicon&r=PG&f=1", "display_name": "Tamas Koos", "link": "https://stackoverflow.com/users/2923589/tamas-koos"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 169, "favorite_count": 0, "accepted_answer_id": 43723719, "answer_count": 4, "score": 1, "last_activity_date": 1493743286, "creation_date": 1493660286, "last_edit_date": 1493660590, "question_id": 43723609, "link": "https://stackoverflow.com/questions/43723609/permutations-of-a-list-containing-the-same-element-several-times", "title": "Permutations of a list containing the same element several times", "body": "<p>I have to write a function that takes two numbers and does this:</p>\n\n<pre><code>placeOneBlock 1 5\n[\"feeee\", \"efeee\", \"eefee\", \"eeefe\", \"eeeef\"]\n</code></pre>\n\n<p>So it makes every permutation of an m long list with n * \"f\"-s and m-n * \"e\"-s. If n > 1 than the \"f\"-s should stay in one group like so:</p>\n\n<pre><code>placeOneBlock 3 10\n[\"fffeeeeeee\", \"efffeeeeee\", \"eefffeeeee\", \"eeefffeeee\", \"eeeefffeee\", \"eeeeefffee\", \"eeeeeefffe\", \"eeeeeeefff\"]\n</code></pre>\n\n<p>I wrote this function:</p>\n\n<pre><code>placeOneBlock n m = permutations (replicate n 'f' ++ replicate (m-n) 'e') \n</code></pre>\n\n<p>But this views the \"e\"-s as unique elements so makes much more permutations than I need and also doesn't work if n > 1. How can I do this?</p>\n"}, {"tags": ["haskell", "ghci"], "comments": [{"owner": {"reputation": 62252, "user_id": 1435869, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/TrEd9.jpg?s=128&g=1", "display_name": "karakfa", "link": "https://stackoverflow.com/users/1435869/karakfa"}, "edited": false, "score": 0, "creation_date": 1493656416, "post_id": 43722572, "comment_id": 74488793, "body": "if you want to use the definitions in GHCI, define them outside of the <code>main</code> block, without the <code>let</code> statement."}], "answers": [{"comments": [{"owner": {"reputation": 3, "user_id": 7930555, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/e330ef00f556d172d4ac30bda9307c3e?s=128&d=identicon&r=PG&f=1", "display_name": "BadWolf", "link": "https://stackoverflow.com/users/7930555/badwolf"}, "edited": false, "score": 0, "creation_date": 1493671525, "post_id": 43722914, "comment_id": 74496212, "body": "Thank you very much! I think I understand what you did, ill read up on this ;)"}, {"owner": {"reputation": 1735, "user_id": 2892792, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/5DNyi.jpg?s=128&g=1", "display_name": "Lazersmoke", "link": "https://stackoverflow.com/users/2892792/lazersmoke"}, "reply_to_user": {"reputation": 3, "user_id": 7930555, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/e330ef00f556d172d4ac30bda9307c3e?s=128&d=identicon&r=PG&f=1", "display_name": "BadWolf", "link": "https://stackoverflow.com/users/7930555/badwolf"}, "edited": false, "score": 0, "creation_date": 1493671666, "post_id": 43722914, "comment_id": 74496275, "body": "Just to be clear, the type signatures aren&#39;t mandatory, but you should definitely use them to help the people who read your code, including yourself."}], "tags": [], "owner": {"reputation": 1735, "user_id": 2892792, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/5DNyi.jpg?s=128&g=1", "display_name": "Lazersmoke", "link": "https://stackoverflow.com/users/2892792/lazersmoke"}, "is_accepted": true, "score": 1, "last_activity_date": 1493657386, "creation_date": 1493657386, "answer_id": 43722914, "question_id": 43722572, "link": "https://stackoverflow.com/questions/43722572/load-and-use-code-file-in-haskell/43722914#43722914", "title": "load and use code file in haskell", "body": "<p>GHCi only has the top level definitons from a file in scope. Try this:</p>\n\n<pre><code>main :: IO ()\nmain = print tupel\n\nsubstantive :: [String]\nsubstantive = [\" Student\", \" Professor\", \" Tutor\"]\n\nadjektive :: [String]\nadjektive = [\"fauler\", \"fleissiger\", \"hilfreicher\"]\n\ntupel :: [String]\ntupel = [a ++ s | a &lt;- adjektive, s &lt;- substantive]\n</code></pre>\n"}], "owner": {"reputation": 3, "user_id": 7930555, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/e330ef00f556d172d4ac30bda9307c3e?s=128&d=identicon&r=PG&f=1", "display_name": "BadWolf", "link": "https://stackoverflow.com/users/7930555/badwolf"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 79, "favorite_count": 0, "accepted_answer_id": 43722914, "answer_count": 1, "score": 0, "last_activity_date": 1493671484, "creation_date": 1493655973, "last_edit_date": 1493671484, "question_id": 43722572, "link": "https://stackoverflow.com/questions/43722572/load-and-use-code-file-in-haskell", "title": "load and use code file in haskell", "body": "<p>I'm just starting to learn haskell and i dont really understand how to use files i created with an ordinary editor in the GHCi interpreter...</p>\n\n<p>This is my file list-comprehension.hs</p>\n\n<pre><code>main = do\nlet substantive = [\" Student\", \" Professor\", \" Tutor\"]\nlet adjektive = [\"fauler\", \"fleissiger\", \"hilfreicher\"]\nlet tupel = [a ++ s | a &lt;- adjektive, s &lt;- substantive]\nreturn (tupel)\n</code></pre>\n\n<p>When I load the file in GHCi it works alright, but then I cant actually use it. So when I try to execute tupel, it wont work.</p>\n\n<pre><code>Prelude&gt; :load list-comprehension.hs\n[1 of 1] Compiling Main             ( list-comprehension.hs, interpreted )\nOk, modules loaded: Main.\n\n*Main&gt; tupel   \n&lt;interactive&gt;:3:1: error: Variable not in scope: tupel\n</code></pre>\n\n<p>This also happens when I try to get the other variables.\nI have researched this a lot, but I cant find out whats wrong with my file or how this generally works...\nI'm not at all sure about the \"main = do\" and the \"return\" part, but this is the only beginning and end that doesnt produce a parse error when loading .</p>\n"}, {"tags": ["haskell"], "comments": [{"owner": {"reputation": 8237, "user_id": 2900502, "user_type": "registered", "accept_rate": 73, "profile_image": "https://i.stack.imgur.com/R1OjD.jpg?s=128&g=1", "display_name": "Shersh", "link": "https://stackoverflow.com/users/2900502/shersh"}, "edited": false, "score": 0, "creation_date": 1493655302, "post_id": 43722164, "comment_id": 74488266, "body": "You have wrong type of <code>someFunc&#39;</code>. It should be <code>someFunc&#39; :: Double -&gt; Double -&gt; Double -&gt; F&#39; Double</code>"}, {"owner": {"reputation": 1735, "user_id": 2892792, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/5DNyi.jpg?s=128&g=1", "display_name": "Lazersmoke", "link": "https://stackoverflow.com/users/2892792/lazersmoke"}, "reply_to_user": {"reputation": 8237, "user_id": 2900502, "user_type": "registered", "accept_rate": 73, "profile_image": "https://i.stack.imgur.com/R1OjD.jpg?s=128&g=1", "display_name": "Shersh", "link": "https://stackoverflow.com/users/2900502/shersh"}, "edited": false, "score": 0, "creation_date": 1493656641, "post_id": 43722164, "comment_id": 74488887, "body": "No, that type is correct in OP&#39;s code @Shersh"}, {"owner": {"reputation": 8237, "user_id": 2900502, "user_type": "registered", "accept_rate": 73, "profile_image": "https://i.stack.imgur.com/R1OjD.jpg?s=128&g=1", "display_name": "Shersh", "link": "https://stackoverflow.com/users/2900502/shersh"}, "edited": false, "score": 0, "creation_date": 1493659069, "post_id": 43722164, "comment_id": 74490145, "body": "Or, indeed. Mismatched <code>F</code> with <code>F&#39;</code> because was in hurry :("}], "answers": [{"tags": [], "owner": {"reputation": 1735, "user_id": 2892792, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/5DNyi.jpg?s=128&g=1", "display_name": "Lazersmoke", "link": "https://stackoverflow.com/users/2892792/lazersmoke"}, "is_accepted": true, "score": 1, "last_activity_date": 1493657178, "creation_date": 1493657178, "answer_id": 43722867, "question_id": 43722164, "link": "https://stackoverflow.com/questions/43722164/experimenting-with-and-inspecting-newtypes-in-haskell/43722867#43722867", "title": "Experimenting with and inspecting newtypes in Haskell", "body": "<p>You can clarify this situation by writing it like</p>\n\n<pre><code>newtype F a = MakeF (a -&gt; Double)\n</code></pre>\n\n<p>Pattern matching on MakeF like</p>\n\n<pre><code>func :: F SomeType -&gt; ...\nfunc (MakeF g) = ...\n</code></pre>\n\n<p>Will give <code>g :: SomeType -&gt; Double</code>. A value of type <code>F a</code> is isomorphic to a function of type <code>a -&gt; Double</code>, so the same set of operations is possible on each.</p>\n\n<p>The real answer here is that it is impossible to <code>Show</code> a function in a meaningful way. Since you can't <code>Show</code> <code>a -&gt; Double</code>, you can't <code>Show</code> <code>F a</code>.</p>\n"}], "owner": {"reputation": 48, "user_id": 2864245, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/89036498835438c6e2559b0475c51988?s=128&d=identicon&r=PG", "display_name": "adkelley", "link": "https://stackoverflow.com/users/2864245/adkelley"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 46, "favorite_count": 0, "accepted_answer_id": 43722867, "answer_count": 1, "score": 0, "last_activity_date": 1493666237, "creation_date": 1493654344, "last_edit_date": 1493666237, "question_id": 43722164, "link": "https://stackoverflow.com/questions/43722164/experimenting-with-and-inspecting-newtypes-in-haskell", "title": "Experimenting with and inspecting newtypes in Haskell", "body": "<p>I'm experimenting with <code>newtypes</code> and attempting to expose a <code>newtype F</code> to users of <code>Lib</code>. I've written a simple use case example below where I want to inspect the <code>newtype F</code> after applying <code>someFunc</code>.  </p>\n\n<p>However the compiler is pointing out that what I think is a <code>F Double</code> is actually a <code>F (Double -&gt; Double)</code> and consequently there's no Show instance for it i.e., <em>No instance for (Show (Double -> Double)) arising from a use of \u2018show\u2019 (maybe you haven't applied a function to enough arguments?)</em></p>\n\n<p>I get it but I'm having difficulty thinking of how to construct a show instance for this.  Can anyone think of an approach that would preserve my <code>newtype F</code>, while hiding <code>F'</code> and <code>someFunc'</code> from users of this library?</p>\n\n<pre><code>-- Lib.hs    \nmodule Lib\n  ( someFunc\n  , F(..)\n  ) where\n\nnewtype F a = F (a -&gt; Double)\ntype F' a = a -&gt; Double\n\nsomeFunc :: Double -&gt; Double -&gt; F Double\nsomeFunc a b = F (\\x -&gt; someFunc' a b x)\n\nsomeFunc' :: Double -&gt; Double -&gt; F' Double\nsomeFunc' a b x = a * x + b\n\n-- Main.hs\nmodule Main where\n\nimport Prelude\nimport Data.Monoid ((&lt;&gt;))\nimport Lib\n\nfoo :: Double -&gt; F Double\nfoo x = someFunc 1.0 2.0\n\ninspectFoo :: F Double -&gt; String\ninspectFoo (F x) = \"F(\" &lt;&gt; show x &lt;&gt; \")\"\n\nmain :: IO ()\nmain = print . inspectFoo $ foo 2.0\n</code></pre>\n"}, {"tags": ["list", "haskell", "integer", "boolean", "head"], "comments": [{"owner": {"reputation": 100185, "user_id": 3234959, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/93bb12ca0f93dfddb33880316f7e66c2?s=128&d=identicon&r=PG&f=1", "display_name": "chi", "link": "https://stackoverflow.com/users/3234959/chi"}, "edited": false, "score": 0, "creation_date": 1493649304, "post_id": 43720693, "comment_id": 74485212, "body": "That can&#39;t compile: it defines <code>function</code> twice."}, {"owner": {"reputation": 161, "user_id": 6278149, "user_type": "registered", "accept_rate": 12, "profile_image": "https://www.gravatar.com/avatar/092596c1b1bc647a15058aafd34567b2?s=128&d=identicon&r=PG&f=1", "display_name": "dYTe", "link": "https://stackoverflow.com/users/6278149/dyte"}, "reply_to_user": {"reputation": 100185, "user_id": 3234959, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/93bb12ca0f93dfddb33880316f7e66c2?s=128&d=identicon&r=PG&f=1", "display_name": "chi", "link": "https://stackoverflow.com/users/3234959/chi"}, "edited": false, "score": 0, "creation_date": 1493649720, "post_id": 43720693, "comment_id": 74485441, "body": "right, my bad, fixed"}], "answers": [{"comments": [{"owner": {"reputation": 161, "user_id": 6278149, "user_type": "registered", "accept_rate": 12, "profile_image": "https://www.gravatar.com/avatar/092596c1b1bc647a15058aafd34567b2?s=128&d=identicon&r=PG&f=1", "display_name": "dYTe", "link": "https://stackoverflow.com/users/6278149/dyte"}, "edited": false, "score": 0, "creation_date": 1493649673, "post_id": 43720838, "comment_id": 74485408, "body": "Ah, I see, thank you.  When I remove the brackets and the commas it works just fine. The problem is just, that we&#39;re only supposed to change the same-function. How could I work on a list, given in this syntax?"}, {"owner": {"reputation": 100185, "user_id": 3234959, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/93bb12ca0f93dfddb33880316f7e66c2?s=128&d=identicon&r=PG&f=1", "display_name": "chi", "link": "https://stackoverflow.com/users/3234959/chi"}, "reply_to_user": {"reputation": 161, "user_id": 6278149, "user_type": "registered", "accept_rate": 12, "profile_image": "https://www.gravatar.com/avatar/092596c1b1bc647a15058aafd34567b2?s=128&d=identicon&r=PG&f=1", "display_name": "dYTe", "link": "https://stackoverflow.com/users/6278149/dyte"}, "edited": false, "score": 0, "creation_date": 1493650102, "post_id": 43720838, "comment_id": 74485646, "body": "If you can&#39;t change <code>main</code>, the input must be without extra characters. Double check your exercise text. Maybe the example <code>10 [1, ...]</code> is not meant to be a program invocation from the CLI, but an input to <code>function</code>, directly, e.g. by calling it from GHCi. (And, BTW, I&#39;d suggest to check your program on lists of length 0, 1, 2, 3 to see if it works properly.)"}, {"owner": {"reputation": 161, "user_id": 6278149, "user_type": "registered", "accept_rate": 12, "profile_image": "https://www.gravatar.com/avatar/092596c1b1bc647a15058aafd34567b2?s=128&d=identicon&r=PG&f=1", "display_name": "dYTe", "link": "https://stackoverflow.com/users/6278149/dyte"}, "edited": false, "score": 0, "creation_date": 1493650723, "post_id": 43720838, "comment_id": 74485943, "body": "I think you&#39;re right. In the examples they just input the arguments to the same-function directly. How can I do that in the CLI?"}, {"owner": {"reputation": 100185, "user_id": 3234959, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/93bb12ca0f93dfddb33880316f7e66c2?s=128&d=identicon&r=PG&f=1", "display_name": "chi", "link": "https://stackoverflow.com/users/3234959/chi"}, "reply_to_user": {"reputation": 161, "user_id": 6278149, "user_type": "registered", "accept_rate": 12, "profile_image": "https://www.gravatar.com/avatar/092596c1b1bc647a15058aafd34567b2?s=128&d=identicon&r=PG&f=1", "display_name": "dYTe", "link": "https://stackoverflow.com/users/6278149/dyte"}, "edited": false, "score": 0, "creation_date": 1493651265, "post_id": 43720838, "comment_id": 74486210, "body": "@dYTe You can&#39;t from the CLI in a direct way. Instead, from there, run <code>ghci YourFile.hs</code> and then you&#39;ll get a prompt from which you can evaluate <code>function args</code>."}, {"owner": {"reputation": 161, "user_id": 6278149, "user_type": "registered", "accept_rate": 12, "profile_image": "https://www.gravatar.com/avatar/092596c1b1bc647a15058aafd34567b2?s=128&d=identicon&r=PG&f=1", "display_name": "dYTe", "link": "https://stackoverflow.com/users/6278149/dyte"}, "edited": false, "score": 0, "creation_date": 1493653143, "post_id": 43720838, "comment_id": 74487170, "body": "Thank You very much, you helped a lot :)"}], "tags": [], "owner": {"reputation": 100185, "user_id": 3234959, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/93bb12ca0f93dfddb33880316f7e66c2?s=128&d=identicon&r=PG&f=1", "display_name": "chi", "link": "https://stackoverflow.com/users/3234959/chi"}, "is_accepted": false, "score": 1, "last_activity_date": 1493649638, "last_edit_date": 1493649638, "creation_date": 1493649183, "answer_id": 43720838, "question_id": 43720693, "link": "https://stackoverflow.com/questions/43720693/prelude-read-no-parse-when-working-with-list-in-haskell/43720838#43720838", "title": "&quot;Prelude.read: no parse&quot; when working with list in Haskell", "body": "<p>I guess you are running the program from the CLI as <code>program 10 [7, 3, 5, 4, 4]</code>.</p>\n\n<p>In such case, <code>getArgs</code> returns the list <code>[\"10\", \"[7,\", \"3,\", \"5,\", \"4,\",  \"4]\"]</code>.</p>\n\n<p>Trying to parse each string in the list as an integer simply fails because of the additional characters.</p>\n\n<p>You should choose a better way to pass arguments. I'd suggest either <code>program 10 7 3 5 4 4</code> or <code>program 10 \"[7, 3, 5, 4, 4]\"</code>. The first passes many arguments, the second only two (the second being a string with the whole list). Whatever you choose, you should adapt your code accordingly.</p>\n\n<p>Here's an example.</p>\n\n<pre><code>main :: IO ()\nmain = do\n   [strN, strNs] &lt;- getArgs\n   let n = read strN\n       ns = read strNs\n   putStrLn $ \"Numeric arg: \" ++ show n\n   putStrLn $ \"List arg, incremented: \" ++ show (map succ ns)\n</code></pre>\n\n<p>Invoking this as <code>program 10 \"[1, 4, 7]\"</code> from the CLI should work.</p>\n"}, {"tags": [], "owner": {"reputation": 18798, "user_id": 4543207, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/8ed6f11c827fa7cef811f141a84cc14b?s=128&d=identicon&r=PG&f=1", "display_name": "Redu", "link": "https://stackoverflow.com/users/4543207/redu"}, "is_accepted": false, "score": 0, "last_activity_date": 1493822353, "creation_date": 1493822353, "answer_id": 43763172, "question_id": 43720693, "link": "https://stackoverflow.com/questions/43720693/prelude-read-no-parse-when-working-with-list-in-haskell/43763172#43763172", "title": "&quot;Prelude.read: no parse&quot; when working with list in Haskell", "body": "<p>I guess you can also do as follows;</p>\n\n<pre><code>firstEqualSecond :: [Int] -&gt; Bool\nfirstEqualSecond (f:s:_) = f == s\n\npgm :: IO ()\npgm = getArgs &gt;&gt;= \\(a:b:_) -&gt; (putStrLn.show.firstEqualSecond) (read a:read b)\n</code></pre>\n"}], "owner": {"reputation": 161, "user_id": 6278149, "user_type": "registered", "accept_rate": 12, "profile_image": "https://www.gravatar.com/avatar/092596c1b1bc647a15058aafd34567b2?s=128&d=identicon&r=PG&f=1", "display_name": "dYTe", "link": "https://stackoverflow.com/users/6278149/dyte"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 205, "favorite_count": 0, "answer_count": 2, "score": 0, "last_activity_date": 1493822353, "creation_date": 1493648641, "last_edit_date": 1493649689, "question_id": 43720693, "link": "https://stackoverflow.com/questions/43720693/prelude-read-no-parse-when-working-with-list-in-haskell", "title": "&quot;Prelude.read: no parse&quot; when working with list in Haskell", "body": "<p>I'm very new to Haskell and struggling to see my mistake here:</p>\n\n<pre><code>same :: Integer -&gt; [Integer] -&gt; Bool\nsame n xs = if head xs == n\n                then True\n                else False\n\nfunction :: [Integer] -&gt; Bool\nfunction (n:xs) = same n xs\n\nmain :: IO ()\nmain = getArgs &gt;&gt;= putStrLn . show . function . (map read)\n</code></pre>\n\n<p>It compiles just fine but when I run it with</p>\n\n<pre><code>10 [7, 3, 5, 4, 4]\n</code></pre>\n\n<p>for example as arguments, I get</p>\n\n<pre><code>Prelude.read: no parse\n</code></pre>\n\n<p>I also tried it without the integer-list, where it worked just fine.</p>\n"}, {"tags": ["haskell", "haskell-pipes", "attoparsec"], "comments": [{"owner": {"reputation": 24211, "user_id": 1364288, "user_type": "registered", "accept_rate": 88, "profile_image": "https://i.stack.imgur.com/JVtNl.png?s=128&g=1", "display_name": "danidiaz", "link": "https://stackoverflow.com/users/1364288/danidiaz"}, "edited": false, "score": 0, "creation_date": 1493648953, "post_id": 43720299, "comment_id": 74485021, "body": "From where are you getting your <code>Parser</code> type?"}, {"owner": {"reputation": 23444, "user_id": 414413, "user_type": "registered", "accept_rate": 79, "profile_image": "https://www.gravatar.com/avatar/6de2113f01432aa844dc85070ff33e89?s=128&d=identicon&r=PG", "display_name": "Cirdec", "link": "https://stackoverflow.com/users/414413/cirdec"}, "reply_to_user": {"reputation": 24211, "user_id": 1364288, "user_type": "registered", "accept_rate": 88, "profile_image": "https://i.stack.imgur.com/JVtNl.png?s=128&g=1", "display_name": "danidiaz", "link": "https://stackoverflow.com/users/1364288/danidiaz"}, "edited": false, "score": 0, "creation_date": 1493649235, "post_id": 43720299, "comment_id": 74485167, "body": "@danidiaz For <a href=\"https://hackage.haskell.org/package/pipes-attoparsec-0.5.1.5/docs/Pipes-Attoparsec.html\" rel=\"nofollow noreferrer\"><code>pipes-autoparsec</code></a> it needs to be an autoparsec <code>ByteString</code> <a href=\"https://hackage.haskell.org/package/attoparsec-0.13.1.0/docs/Data-Attoparsec-ByteString.html#t:Parser\" rel=\"nofollow noreferrer\"><code>Parser</code></a>. I figured out which one by the argument to the <code>Producer</code> returned in the error of <code>runParser</code>."}, {"owner": {"reputation": 62282, "user_id": 1652962, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/2cf5a0741f183379686fe0995ffc27ae?s=128&d=identicon&r=PG", "display_name": "cimmanon", "link": "https://stackoverflow.com/users/1652962/cimmanon"}, "reply_to_user": {"reputation": 24211, "user_id": 1364288, "user_type": "registered", "accept_rate": 88, "profile_image": "https://i.stack.imgur.com/JVtNl.png?s=128&g=1", "display_name": "danidiaz", "link": "https://stackoverflow.com/users/1364288/danidiaz"}, "edited": false, "score": 0, "creation_date": 1493654326, "post_id": 43720299, "comment_id": 74487762, "body": "@danidiaz It comes from attoparsec (Data.Attoparsec.ByteString)."}], "answers": [{"comments": [{"owner": {"reputation": 62282, "user_id": 1652962, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/2cf5a0741f183379686fe0995ffc27ae?s=128&d=identicon&r=PG", "display_name": "cimmanon", "link": "https://stackoverflow.com/users/1652962/cimmanon"}, "edited": false, "score": 0, "creation_date": 1493654563, "post_id": 43722057, "comment_id": 74487901, "body": "That does explain the behavior I&#39;m seeing, but is it possible to achieve the behavior I&#39;m looking for?  I&#39;m prepared to rewrite my parsers to work differently if I have to, but I&#39;m hoping to save myself several hours of work."}, {"owner": {"reputation": 23444, "user_id": 414413, "user_type": "registered", "accept_rate": 79, "profile_image": "https://www.gravatar.com/avatar/6de2113f01432aa844dc85070ff33e89?s=128&d=identicon&r=PG", "display_name": "Cirdec", "link": "https://stackoverflow.com/users/414413/cirdec"}, "reply_to_user": {"reputation": 62282, "user_id": 1652962, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/2cf5a0741f183379686fe0995ffc27ae?s=128&d=identicon&r=PG", "display_name": "cimmanon", "link": "https://stackoverflow.com/users/1652962/cimmanon"}, "edited": false, "score": 0, "creation_date": 1493654842, "post_id": 43722057, "comment_id": 74488063, "body": "@cimmanon I&#39;m not sure from your question what the behaviour you&#39;re looking for is. Perhaps it&#39;d be easier to ask as two questions, &quot;why does my code do this&quot;?, focusing on the description of your existing code - like this one does, and &quot;how can I make it do X&quot;? focusing on the description of X that you want to accomplish."}, {"owner": {"reputation": 23444, "user_id": 414413, "user_type": "registered", "accept_rate": 79, "profile_image": "https://www.gravatar.com/avatar/6de2113f01432aa844dc85070ff33e89?s=128&d=identicon&r=PG", "display_name": "Cirdec", "link": "https://stackoverflow.com/users/414413/cirdec"}, "reply_to_user": {"reputation": 62282, "user_id": 1652962, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/2cf5a0741f183379686fe0995ffc27ae?s=128&d=identicon&r=PG", "display_name": "cimmanon", "link": "https://stackoverflow.com/users/1652962/cimmanon"}, "edited": false, "score": 0, "creation_date": 1493655110, "post_id": 43722057, "comment_id": 74488197, "body": "@cimmanon But here&#39;s a hint: if you want to do something else at the end after all of the <code>Command</code>s have been parsed, try adding some lines to the end of <code>runParser</code> (like <code>s&#39; &lt;- lift get; liftIO $ putStrLn &quot;runParser end&quot;;     liftIO $ putStrLn $ show s&#39;</code>) and see if that&#39;s what you want. Or at the end of <code>theStuff</code> or <code>doStuff</code> if that makes more sense."}, {"owner": {"reputation": 62282, "user_id": 1652962, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/2cf5a0741f183379686fe0995ffc27ae?s=128&d=identicon&r=PG", "display_name": "cimmanon", "link": "https://stackoverflow.com/users/1652962/cimmanon"}, "edited": false, "score": 0, "creation_date": 1493657551, "post_id": 43722057, "comment_id": 74489371, "body": "It&#39;s a parser downstream on the Insert branch that needs access to the table definitions parsed so far so that I can run the correct parser for each column type (it&#39;s pretty much guaranteed to be create table, then insert for that table, but other create statements that I&#39;m capturing can appear in between like indexes).  The DB that generates the dumps I&#39;m parsing produces invalid dates and binary types are in the wrong format... and they look indistinguishable from an ordinary quoted string."}, {"owner": {"reputation": 62282, "user_id": 1652962, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/2cf5a0741f183379686fe0995ffc27ae?s=128&d=identicon&r=PG", "display_name": "cimmanon", "link": "https://stackoverflow.com/users/1652962/cimmanon"}, "edited": false, "score": 0, "creation_date": 1493658433, "post_id": 43722057, "comment_id": 74489832, "body": "If you couldn&#39;t tell if I was asking &quot;Why does X do this?&quot; or &quot;How do I do X?&quot;, you should have asked for clarification rather than post an answer.  Because my question was never &quot;Why does X do this?&quot;,  I could already infer the behavior based on the output."}], "tags": [], "owner": {"reputation": 23444, "user_id": 414413, "user_type": "registered", "accept_rate": 79, "profile_image": "https://www.gravatar.com/avatar/6de2113f01432aa844dc85070ff33e89?s=128&d=identicon&r=PG", "display_name": "Cirdec", "link": "https://stackoverflow.com/users/414413/cirdec"}, "is_accepted": false, "score": 0, "last_activity_date": 1493655306, "last_edit_date": 1493655306, "creation_date": 1493653951, "answer_id": 43722057, "question_id": 43720299, "link": "https://stackoverflow.com/questions/43720299/passing-state-from-a-producer-to-a-parser/43722057#43722057", "title": "Passing State from a Producer to a Parser", "body": "<blockquote>\n  <p>I was expecting <code>runParser</code> (which would grab the latest contents from State) to be run every time <code>processCommand</code> runs, but that's clearly not the case.</p>\n</blockquote>\n\n<p>Your main effect is <code>for runParser (liftIO . BS.putStrLn &lt;=&lt; lift . processCommand)</code>. To understand what this effect does you need to understand what <a href=\"https://hackage.haskell.org/package/pipes-4.3.3/docs/Pipes.html#v:for\" rel=\"nofollow noreferrer\"><code>for</code></a> does:</p>\n\n<blockquote>\n  <p><code>(for p body)</code> loops over <code>p</code> replacing each <code>yield</code> with <code>body</code></p>\n</blockquote>\n\n<p>\"Loops <em>over</em> <code>p</code>\" is accurate if a bit confusing. It doesn't run <code>p</code> once for each value produced by <code>p</code>; that would explode! Instead <code>for</code> replaces every <code>yield</code> in <code>p</code> with <code>body</code>. By replacing <code>yield</code> with <code>body</code> it runs <code>body</code> once for every <code>yield</code>ed value. Running the body once for each produced value is similar to how in other languages a for-loop <em>over</em> a list runs the body once for each value in the list.</p>\n\n<p>Your <code>runParser</code> is </p>\n\n<pre><code>runParser = do\n    s &lt;- lift get\n    liftIO $ putStrLn \"runParser\"\n    liftIO $ putStrLn $ show s\n    parsed (evalStateT dump' s) PBS.stdin\n</code></pre>\n\n<p>It reads the state, outputs it, and produces the <code>Command</code>s <code>parsed</code> from <code>stdin</code>. Pipes-autoparsec's <a href=\"https://hackage.haskell.org/package/pipes-attoparsec-0.5.1.5/docs/src/Pipes-Attoparsec.html#parsed\" rel=\"nofollow noreferrer\"><code>parsed</code></a> parses the source and <code>yield</code>s once for each completely successfully parsed value. Your <code>for</code> then replaces each of <code>parsed</code>'s <code>yield</code>s with <code>liftIO . BS.putStrLn &lt;=&lt; lift . processCommand</code>. The complete effect runs <code>runParser</code> <em>once</em> and <code>processCommand</code> <em>once for each <code>yield</code></em>, which is what you're observing in the output.</p>\n"}], "owner": {"reputation": 62282, "user_id": 1652962, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/2cf5a0741f183379686fe0995ffc27ae?s=128&d=identicon&r=PG", "display_name": "cimmanon", "link": "https://stackoverflow.com/users/1652962/cimmanon"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 103, "favorite_count": 1, "answer_count": 1, "score": 1, "last_activity_date": 1493726592, "creation_date": 1493647003, "last_edit_date": 1493726592, "question_id": 43720299, "link": "https://stackoverflow.com/questions/43720299/passing-state-from-a-producer-to-a-parser", "title": "Passing State from a Producer to a Parser", "body": "<p>I'm using pipes, attoparsec, and pipes-attoparsec to write a database dump file converter.  The general format of the file is to have a create table command followed by an optional insert command.  In addition to transforming the statements in place, the table definitions have to be held in memory until the very end for additional processing (indexes, constraints, etc.).</p>\n\n<p>This works fine, but now I need to allow some of my internal parsers to have access to my Producer's State in order to determine which parser needs to be run while processing the values from the insert command.</p>\n\n<p>I tried something like this:</p>\n\n<pre><code>-- IO\nimport qualified Data.ByteString.Char8 as BS (putStrLn)\nimport System.Exit (ExitCode (..), exitSuccess, exitFailure)\nimport System.IO (hPutStrLn, stderr)\n\n-- Pipes\nimport Pipes (runEffect, for, liftIO, Producer, Effect)\nimport Pipes.Attoparsec (parsed, ParsingError)\nimport Pipes.Lift (runStateP)\nimport Pipes.Safe (runSafeT)\nimport qualified Pipes.ByteString as PBS (stdin)\n\n-- State\nimport Control.Monad.Trans.Class (lift)\nimport Control.Monad.Trans.State.Strict\n\ndump' :: StateT ParserState Parser Command\ndump' = fmap Create createStatements' &lt;|&gt; fmap Insert justData'\n\ndoStuff :: MonadIO m =&gt; Effect m (Either (ParsingError, Producer ByteString (StateT ParserState m) ()) (), ParserState)\ndoStuff = runStateP defaultParserState theStuff\n\ntheStuff :: MonadIO m =&gt; Effect (StateT ParserState m) (Either (ParsingError, Producer ByteString (StateT ParserState m) ()) ())\ntheStuff = for runParser (liftIO . BS.putStrLn &lt;=&lt; lift . processCommand)\n\nrunParser :: MonadIO m =&gt; Producer Command (StateT ParserState m) (Either (ParsingError, Producer ByteString (StateT ParserState m) ()) ())\nrunParser = do\n    s &lt;- lift get\n    liftIO $ putStrLn \"runParser\"\n    liftIO $ putStrLn $ show s\n    parsed (evalStateT dump' s) PBS.stdin\n\nprocessCommand :: MonadIO m =&gt; Command -&gt; StateT ParserState m ByteString\nprocessCommand (Create xs) = do\n    currentState &lt;- get\n    liftIO $ putStrLn \"processCommand\"\n    liftIO $ putStrLn $ show currentState\n    _ &lt;- put (currentState { constructs = xs ++ (constructs currentState)})\n    return $ P.firstPass $ P.transformConstructs xs\nprocessCommand (Insert x) = return x\n</code></pre>\n\n<p>Complete source (including parsers): <a href=\"https://github.com/cimmanon/mysqlnothx/blob/parser-state/src/Main.hs\" rel=\"nofollow noreferrer\">https://github.com/cimmanon/mysqlnothx/blob/parser-state/src/Main.hs</a></p>\n\n<p>When I run it, I get a result that looks something like this:</p>\n\n<pre><code>runParser\nParserState {constructs = []}\nprocessCommand\nParserState {constructs = []}\nprocessCommand\nParserState {constructs = [ ... ]}\nprocessCommand\nParserState {constructs = [ ..... ]}\n</code></pre>\n\n<p>I was expecting runParser (which would grab the latest contents from State) to be run every time processCommand runs, but that's clearly not the case based on the output.  When I check the contents of State within the parser, it's always empty no matter how many commands are parsed.</p>\n\n<p>How can I extend State from my Producers to my Parser (dump') so that they share the same State?  If my Producer has 4 values in State, the Parser should also see those same 4 values.</p>\n"}, {"tags": ["haskell"], "comments": [{"owner": {"reputation": 384463, "user_id": 1126841, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/fa05233b2357f8d11c22ef4cfc7bb85c?s=128&d=identicon&r=PG", "display_name": "chepner", "link": "https://stackoverflow.com/users/1126841/chepner"}, "edited": false, "score": 0, "creation_date": 1493642592, "post_id": 43718678, "comment_id": 74481836, "body": "<code>main</code> is required to have type <code>IO ()</code>, but <code>scriePolinom a</code> has type <code>String</code>."}], "answers": [{"comments": [{"owner": {"reputation": 47, "user_id": 7699349, "user_type": "registered", "accept_rate": 0, "profile_image": "https://www.gravatar.com/avatar/366e6c514b0f542fe75e20e7222e115f?s=128&d=identicon&r=PG", "display_name": "Bob", "link": "https://stackoverflow.com/users/7699349/bob"}, "edited": false, "score": 0, "creation_date": 1493641874, "post_id": 43718776, "comment_id": 74481530, "body": "<code>parseIntList :: String -&gt; [Int] parseIntList s = [read x :: Int | x &lt;- words s]  main=do      {         a &lt;- getLine         scriePolinom (parseIntList a)}</code>"}, {"owner": {"reputation": 47, "user_id": 7699349, "user_type": "registered", "accept_rate": 0, "profile_image": "https://www.gravatar.com/avatar/366e6c514b0f542fe75e20e7222e115f?s=128&d=identicon&r=PG", "display_name": "Bob", "link": "https://stackoverflow.com/users/7699349/bob"}, "edited": false, "score": 0, "creation_date": 1493641903, "post_id": 43718776, "comment_id": 74481549, "body": "&quot;The last statement in a &#39;do&#39; block must be an expression       a &lt;- getLine scriePolinom (parseIntList a)&quot; I don&#39;t get it why!"}, {"owner": {"reputation": 23600, "user_id": 1695172, "user_type": "registered", "accept_rate": 91, "profile_image": "https://www.gravatar.com/avatar/6319d7eafca7852cf04c88598ca31e75?s=128&d=identicon&r=PG", "display_name": "Netwave", "link": "https://stackoverflow.com/users/1695172/netwave"}, "reply_to_user": {"reputation": 47, "user_id": 7699349, "user_type": "registered", "accept_rate": 0, "profile_image": "https://www.gravatar.com/avatar/366e6c514b0f542fe75e20e7222e115f?s=128&d=identicon&r=PG", "display_name": "Bob", "link": "https://stackoverflow.com/users/7699349/bob"}, "edited": false, "score": 0, "creation_date": 1493642025, "post_id": 43718776, "comment_id": 74481604, "body": "@Bob, you are on the IO monad, so you have to do something with it, mostly print it, ill add to the answer"}], "tags": [], "owner": {"reputation": 23600, "user_id": 1695172, "user_type": "registered", "accept_rate": 91, "profile_image": "https://www.gravatar.com/avatar/6319d7eafca7852cf04c88598ca31e75?s=128&d=identicon&r=PG", "display_name": "Netwave", "link": "https://stackoverflow.com/users/1695172/netwave"}, "is_accepted": false, "score": 2, "last_activity_date": 1493642044, "last_edit_date": 1493642044, "creation_date": 1493640031, "answer_id": 43718776, "question_id": 43718678, "link": "https://stackoverflow.com/questions/43718678/read-strings-from-keyboard-in-haskell/43718776#43718776", "title": "Read strings from keyboard in haskell", "body": "<p>Parse the line into the corresponding data:</p>\n\n<pre><code>import Data.List\nparseIntList :: String -&gt; [Int]\nparseIntList s = [read x :: Int | x &lt;- words s]\n\ntype Polinom = [Int]    \nscriePolinom :: Polinom -&gt; String\n....\nmain = do  \n    a &lt;- getLine\n    let intlist = parseIntList a\n    putStrLn $ scriePolinom intlist\n</code></pre>\n"}, {"tags": [], "owner": {"reputation": 100892, "user_id": 745903, "user_type": "registered", "accept_rate": 74, "profile_image": "https://www.gravatar.com/avatar/50933f6638836741e620669b3940410e?s=128&d=identicon&r=PG", "display_name": "leftaroundabout", "link": "https://stackoverflow.com/users/745903/leftaroundabout"}, "is_accepted": false, "score": 1, "last_activity_date": 1493643093, "last_edit_date": 1495539194, "creation_date": 1493640335, "answer_id": 43718839, "question_id": 43718678, "link": "https://stackoverflow.com/questions/43718678/read-strings-from-keyboard-in-haskell/43718839#43718839", "title": "Read strings from keyboard in haskell", "body": "<pre><code>GHCi, version 7.10.2: http://www.haskell.org/ghc/  :? for help\nPrelude&gt; :type getLine   -- you can also write :t getLine\ngetLine :: IO String\n</code></pre>\n\n<p>This tells you that <code>getLine</code> always gives you (after doing some kind of impure I/O operations, in this case <em>waiting for the user to enter some stuff on the keyboard, until pressing <kbd>enter</kbd></em>) a value of type <code>String</code>. Which makes sense: a string, also called...</p>\n\n<pre><code>Prelude&gt; :info String   -- you can also write :i String\ntype String = [Char]    -- Defined in \u2018GHC.Base\u2019\n</code></pre>\n\n<p>...<em>list of characters</em>. These are just the exact characters/keys the user typed in. In general, these characters may <em>not</em> properly describe a <code>Polinom</code> \u2013 what, for example, if the user enters <code>34958oiyq4ulbwre</code>?</p>\n\n<p>What you need to do is trying to <em>parse</em> the input string to a more meaningfully-typed value, like <code>Polinom</code>. How to do that depends on what form you actually expect the input to be. If the user should use normal Haskell syntax for the coefficients, e.g. <code>[2, -5, 1]</code>, you can use the standard <a href=\"http://hackage.haskell.org/package/base-4.9.1.0/docs/Prelude.html#v:read\" rel=\"nofollow noreferrer\"><code>read</code></a> parser:</p>\n\n<pre><code>Prelude&gt; scriePolinom (read \"[2, -5, 1]\")\n\"[2,-5,1]\"\n</code></pre>\n\n<p>Or if, as <a href=\"https://stackoverflow.com/a/43718776/745903\">Daniel Sanchez assumes</a>, you expect just a sequence of space-separated numbers in decimal notation, you can first split up these numbers as <em>words</em>, then read each one individually:</p>\n\n<pre><code>Prelude&gt; scriePolinom . map read $ words \"2 -5 1\"\n\"[2,-5,1]\"\n</code></pre>\n\n<p>To use this in an executable program, you can use the ready-build combination of <code>getLine</code> and <code>read</code>:</p>\n\n<pre><code>main :: IO ()\nmain = do  \n    a &lt;- readLn\n    putStrLn $ scriePolinom a\n</code></pre>\n\n<p>Note that <code>read</code>/<code>readLn</code> are not robust with respect to malformed input (they're not <em>total functions</em>) \u2013 this will just crash the program unless you wrap it in explicit exception handling. For serious applications I recommend using a full-featured parsing library, such as <a href=\"http://hackage.haskell.org/package/megaparsec\" rel=\"nofollow noreferrer\">megaparsec</a>.</p>\n"}, {"tags": [], "owner": {"reputation": 311, "user_id": 3990897, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/ed7eaab5f87167928cf27262dd5ac249?s=128&d=identicon&r=PG", "display_name": "MegaTom", "link": "https://stackoverflow.com/users/3990897/megatom"}, "is_accepted": false, "score": 0, "last_activity_date": 1575165943, "creation_date": 1575165943, "answer_id": 59121955, "question_id": 43718678, "link": "https://stackoverflow.com/questions/43718678/read-strings-from-keyboard-in-haskell/59121955#59121955", "title": "Read strings from keyboard in haskell", "body": "<h1><a href=\"https://www.haskell.org/\" rel=\"nofollow noreferrer\">Haskell</a>, 37 bytes</h1>\n\n\n\n<pre class=\"lang-hs prettyprint-override\"><code>f l=[b|(a,b)&lt;-zip[x&lt;'b'|x&lt;-'a':l]l,a]\n</code></pre>\n\n<p><a href=\"https://tio.run/##y0gszk7Nyfn/P00hxzY6qUYjUSdJ00a3KrMgusJGPUm9psJGVz1R3SonNkcnMfZ/bmJmnoKtQko@l4JCcUmRgo2uQnpqiU9mXipQoKC0JBgoppEGktL8n5GelpqSnJQIJnKyszJhAsjs/LxcZK5CeVlpSXFRYQGaOBoXUwEyG4QB\" rel=\"nofollow noreferrer\" title=\"Haskell \u2013 Try It Online\">Try it online!</a></p>\n"}], "owner": {"reputation": 47, "user_id": 7699349, "user_type": "registered", "accept_rate": 0, "profile_image": "https://www.gravatar.com/avatar/366e6c514b0f542fe75e20e7222e115f?s=128&d=identicon&r=PG", "display_name": "Bob", "link": "https://stackoverflow.com/users/7699349/bob"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 1137, "favorite_count": 1, "answer_count": 3, "score": -1, "last_activity_date": 1575165943, "creation_date": 1493639545, "question_id": 43718678, "link": "https://stackoverflow.com/questions/43718678/read-strings-from-keyboard-in-haskell", "title": "Read strings from keyboard in haskell", "body": "<p>I want to read a string from keyboard but i don't know why isn't working, I tried a lot of methods, but nothing worked! Can someone help me or give me an idea?</p>\n\n<pre><code>type Polinom = [Int]    \nscriePolinom :: Polinom -&gt; String\n....\nmain = do  \n    a&lt;-getLine\n    --let a=[2,-5,1] \n    scriePolinom a\n</code></pre>\n"}, {"tags": ["haskell", "function-composition"], "comments": [{"owner": {"reputation": 18798, "user_id": 4543207, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/8ed6f11c827fa7cef811f141a84cc14b?s=128&d=identicon&r=PG&f=1", "display_name": "Redu", "link": "https://stackoverflow.com/users/4543207/redu"}, "edited": false, "score": 1, "creation_date": 1493649961, "post_id": 43718091, "comment_id": 74485574, "body": "In many Haskell books and tutorials some of the basics of Haskell mentioned in between the lines sometimes get skipped or overlooked. <a href=\"https://www.fpcomplete.com/blog/2012/09/ten-things-you-should-know-about-haskell-syntax\" rel=\"nofollow noreferrer\">This</a> article is a great one to have a look at."}], "answers": [{"comments": [{"owner": {"reputation": 4295, "user_id": 1916893, "user_type": "registered", "accept_rate": 92, "profile_image": "https://i.stack.imgur.com/XTlc8.png?s=128&g=1", "display_name": "TobiMcNamobi", "link": "https://stackoverflow.com/users/1916893/tobimcnamobi"}, "edited": false, "score": 0, "creation_date": 1493722658, "post_id": 43718293, "comment_id": 74515139, "body": "Thank you for this <i>extraordinary</i> answer. Not only is it comprehensive and informative but also funny! :-)"}], "tags": [], "owner": {"reputation": 78982, "user_id": 1848654, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/84180c0f3c9c04f8b8f0613fc0129dac?s=128&d=identicon&r=PG", "display_name": "melpomene", "link": "https://stackoverflow.com/users/1848654/melpomene"}, "is_accepted": true, "score": 5, "last_activity_date": 1493637984, "last_edit_date": 1493637984, "creation_date": 1493637671, "answer_id": 43718293, "question_id": 43718091, "link": "https://stackoverflow.com/questions/43718091/composing-functions-length-and-elemindices/43718293#43718293", "title": "Composing functions &#39;length&#39; and &#39;elemIndices&#39;", "body": "<p><code>-&gt;</code> in types is right associative:</p>\n\n<pre><code>elemIndices :: Eq a =&gt; a -&gt; [a] -&gt; [Int]\n</code></pre>\n\n<p>means</p>\n\n<pre><code>elemIndices :: Eq a =&gt; a -&gt; ([a] -&gt; [Int])\n</code></pre>\n\n<p>When you use <code>elemIndices</code> on the right-hand side of <code>(.) :: (b -&gt; c) -&gt; (a' -&gt; b) -&gt; a' -&gt; c</code>, you have</p>\n\n<ul>\n<li><code>a' = a</code></li>\n<li><code>b = [a] -&gt; [Int]</code></li>\n</ul>\n\n<p>And this is where things break down, because <code>length</code> does not take <code>[a] -&gt; [Int]</code> (a function) as input; it wants a list.</p>\n\n<hr>\n\n<p>What you can do instead is:</p>\n\n<pre><code>count x y = length (elemIndices x y)\n</code></pre>\n\n<p>This is the same as (by the definition of <code>(.)</code>):</p>\n\n<pre><code>count x y = (length . elemIndices x) y\n</code></pre>\n\n<p>Eta reduction:</p>\n\n<pre><code>count x = length . elemIndices x\n</code></pre>\n\n<p>You should probably stop here because this is where things get a bit crazy.</p>\n\n<hr>\n\n<p>Prefix notation:</p>\n\n<pre><code>count x = (.) length (elemIndices x)\n</code></pre>\n\n<p>Definition of <code>(.)</code>:</p>\n\n<pre><code>count x = ((.) length . elemIndices) x\n</code></pre>\n\n<p>Eta reduction:</p>\n\n<pre><code>count = (.) length . elemIndices\n</code></pre>\n\n<p>Or using an operator section:</p>\n\n<pre><code>count = (length .) . elemIndices\n</code></pre>\n\n<hr>\n\n<p>But wait, there's more!</p>\n\n<p>Prefix notation:</p>\n\n<pre><code>count = (.) ((.) length) elemIndices\n</code></pre>\n\n<p>Definition of <code>(.)</code>:</p>\n\n<pre><code>count = (((.) . (.)) length) elemIndices\n</code></pre>\n\n<p>Removing redundant parens:</p>\n\n<pre><code>count = ((.) . (.)) length elemIndices\n</code></pre>\n\n<p>Prefix notation:</p>\n\n<pre><code>count = (.) (.) (.) length elemIndices\n</code></pre>\n\n<p>MAXIMUM BEAUTY ACHIEVED.</p>\n"}], "owner": {"reputation": 4295, "user_id": 1916893, "user_type": "registered", "accept_rate": 92, "profile_image": "https://i.stack.imgur.com/XTlc8.png?s=128&g=1", "display_name": "TobiMcNamobi", "link": "https://stackoverflow.com/users/1916893/tobimcnamobi"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 92, "favorite_count": 0, "accepted_answer_id": 43718293, "answer_count": 1, "score": 0, "last_activity_date": 1493637984, "creation_date": 1493636579, "last_edit_date": 1493636929, "question_id": 43718091, "link": "https://stackoverflow.com/questions/43718091/composing-functions-length-and-elemindices", "title": "Composing functions &#39;length&#39; and &#39;elemIndices&#39;", "body": "<p>I wrote a function <code>count :: Char -&gt; String -&gt; Int</code> that counts the number of occurrences of a <code>Char</code> inside a <code>String</code>. Code sample:</p>\n\n<pre><code>module Main where\n\nimport Data.List\n\nmain :: IO ()\nmain = do\n        print $ count 'a' \"abcaaba\"\n\ncount :: Char -&gt; String -&gt; Int\ncount = length . elemIndices\n</code></pre>\n\n<p>The compile error I get is</p>\n\n<pre><code>* Couldn't match type `Int' with `String -&gt; Int'\n  Expected type: Char -&gt; String -&gt; Int\n    Actual type: Char -&gt; Int\n* Possible cause: `(.)' is applied to too many arguments\n  In the expression: length . elemIndices\n  In an equation for `count': count = length . elemIndices\n</code></pre>\n\n<p>OK, I could write <code>count x y = length $ elemIndices x y</code> which works. But I argue we have </p>\n\n<p>(1) <code>(.) :: (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c</code></p>\n\n<p>(2) <code>elemIndices :: Eq a =&gt; a -&gt; [a] -&gt; [Int]</code> and</p>\n\n<p>(3) <code>length :: [a] -&gt; Int</code></p>\n\n<p>If <code>count</code> shall be a composition of (2) and (3) then in (1) we need obviously <code>a = Char -&gt; [Char]</code> and <code>c = Int</code>. And if <code>b = [Int]</code> we get</p>\n\n<p>(1') <code>(.) :: ([Int] -&gt; Int) -&gt; (Char -&gt; [Char] -&gt; [Int]) -&gt; Char -&gt; [Char] -&gt; Int</code></p>\n\n<p>which means I <em>can</em> compose (2) and (3) to get <code>Char -&gt; [Char] -&gt; Int</code>.</p>\n\n<p>Questions:</p>\n\n<ol>\n<li>Why is the composition I wrote failing to compile?</li>\n<li>Where is my reasoning going wrong?</li>\n</ol>\n"}, {"tags": ["list", "sorting", "haskell"], "comments": [{"owner": {"reputation": 23600, "user_id": 1695172, "user_type": "registered", "accept_rate": 91, "profile_image": "https://www.gravatar.com/avatar/6319d7eafca7852cf04c88598ca31e75?s=128&d=identicon&r=PG", "display_name": "Netwave", "link": "https://stackoverflow.com/users/1695172/netwave"}, "edited": false, "score": 0, "creation_date": 1493636387, "post_id": 43718031, "comment_id": 74479203, "body": "You can just implement or derive Ord for your tree structure"}, {"owner": {"reputation": 78982, "user_id": 1848654, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/84180c0f3c9c04f8b8f0613fc0129dac?s=128&d=identicon&r=PG", "display_name": "melpomene", "link": "https://stackoverflow.com/users/1848654/melpomene"}, "edited": false, "score": 0, "creation_date": 1493636630, "post_id": 43718031, "comment_id": 74479312, "body": "Which part are you having trouble with? Sorting a list of trees in general, or getting the highest-to-lowest ordering?"}, {"owner": {"reputation": 315, "user_id": 7940372, "user_type": "registered", "accept_rate": 58, "profile_image": "https://www.gravatar.com/avatar/3e5744471a061ee3bf3a29ce9bb5a4a7?s=128&d=identicon&r=PG&f=1", "display_name": "420fedoras", "link": "https://stackoverflow.com/users/7940372/420fedoras"}, "reply_to_user": {"reputation": 78982, "user_id": 1848654, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/84180c0f3c9c04f8b8f0613fc0129dac?s=128&d=identicon&r=PG", "display_name": "melpomene", "link": "https://stackoverflow.com/users/1848654/melpomene"}, "edited": false, "score": 0, "creation_date": 1493637324, "post_id": 43718031, "comment_id": 74479594, "body": "@melpomene Sorting in general, i don&#39;t understand how the functions work or how to apply them."}, {"owner": {"reputation": 315, "user_id": 7940372, "user_type": "registered", "accept_rate": 58, "profile_image": "https://www.gravatar.com/avatar/3e5744471a061ee3bf3a29ce9bb5a4a7?s=128&d=identicon&r=PG&f=1", "display_name": "420fedoras", "link": "https://stackoverflow.com/users/7940372/420fedoras"}, "reply_to_user": {"reputation": 23600, "user_id": 1695172, "user_type": "registered", "accept_rate": 91, "profile_image": "https://www.gravatar.com/avatar/6319d7eafca7852cf04c88598ca31e75?s=128&d=identicon&r=PG", "display_name": "Netwave", "link": "https://stackoverflow.com/users/1695172/netwave"}, "edited": false, "score": 0, "creation_date": 1493637394, "post_id": 43718031, "comment_id": 74479624, "body": "@DanielSanchez I don&#39;t know how to do that though, or what deriving Ord really means."}], "answers": [{"comments": [{"owner": {"reputation": 78982, "user_id": 1848654, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/84180c0f3c9c04f8b8f0613fc0129dac?s=128&d=identicon&r=PG", "display_name": "melpomene", "link": "https://stackoverflow.com/users/1848654/melpomene"}, "edited": false, "score": 0, "creation_date": 1493636791, "post_id": 43718064, "comment_id": 74479370, "body": "This gives results in ascending, not descending order."}, {"owner": {"reputation": 100185, "user_id": 3234959, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/93bb12ca0f93dfddb33880316f7e66c2?s=128&d=identicon&r=PG&f=1", "display_name": "chi", "link": "https://stackoverflow.com/users/3234959/chi"}, "reply_to_user": {"reputation": 78982, "user_id": 1848654, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/84180c0f3c9c04f8b8f0613fc0129dac?s=128&d=identicon&r=PG", "display_name": "melpomene", "link": "https://stackoverflow.com/users/1848654/melpomene"}, "edited": false, "score": 0, "creation_date": 1493637264, "post_id": 43718064, "comment_id": 74479569, "body": "@melpomene Ah I missed that. Thanks."}, {"owner": {"reputation": 315, "user_id": 7940372, "user_type": "registered", "accept_rate": 58, "profile_image": "https://www.gravatar.com/avatar/3e5744471a061ee3bf3a29ce9bb5a4a7?s=128&d=identicon&r=PG&f=1", "display_name": "420fedoras", "link": "https://stackoverflow.com/users/7940372/420fedoras"}, "edited": false, "score": 0, "creation_date": 1493638496, "post_id": 43718064, "comment_id": 74480070, "body": "This worked! The guarded expression was one of my first thoughts for this problem, but the first option is working perfectly for its purpose. I see that sortBy has type (a -&gt; a -&gt; Ordering) -&gt; [a] -&gt; [a], could you explain the first bracketed argument? especially in relation to the example"}, {"owner": {"reputation": 100185, "user_id": 3234959, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/93bb12ca0f93dfddb33880316f7e66c2?s=128&d=identicon&r=PG&f=1", "display_name": "chi", "link": "https://stackoverflow.com/users/3234959/chi"}, "reply_to_user": {"reputation": 315, "user_id": 7940372, "user_type": "registered", "accept_rate": 58, "profile_image": "https://www.gravatar.com/avatar/3e5744471a061ee3bf3a29ce9bb5a4a7?s=128&d=identicon&r=PG&f=1", "display_name": "420fedoras", "link": "https://stackoverflow.com/users/7940372/420fedoras"}, "edited": false, "score": 0, "creation_date": 1493638634, "post_id": 43718064, "comment_id": 74480121, "body": "@420fedoras The first argument of <code>sortBy</code> must be of type <code>a -&gt; a -&gt; Ordering</code>, i.e. it must be a binary function. In your case, such function takes two trees (the <code>a -&gt; a -&gt; </code> part in the type) and return the result of the comparison (the <code>Ordering</code>). <code>Ordering</code> is just a simple type with exactly tree values <code>LT,EQ,GT</code> for the three possible results of comparison."}, {"owner": {"reputation": 315, "user_id": 7940372, "user_type": "registered", "accept_rate": 58, "profile_image": "https://www.gravatar.com/avatar/3e5744471a061ee3bf3a29ce9bb5a4a7?s=128&d=identicon&r=PG&f=1", "display_name": "420fedoras", "link": "https://stackoverflow.com/users/7940372/420fedoras"}, "edited": false, "score": 0, "creation_date": 1493639930, "post_id": 43718064, "comment_id": 74480651, "body": "@chi okay that makes sense, but what are the two arguments in <code>sortBy (flip $ comparing score)</code> ? or does it just take elements from the provided list as the argument? also when an element is sorted does it get put back into the list or does it get put into a new list? Like does it work similar to selection sort does?"}, {"owner": {"reputation": 100185, "user_id": 3234959, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/93bb12ca0f93dfddb33880316f7e66c2?s=128&d=identicon&r=PG&f=1", "display_name": "chi", "link": "https://stackoverflow.com/users/3234959/chi"}, "reply_to_user": {"reputation": 315, "user_id": 7940372, "user_type": "registered", "accept_rate": 58, "profile_image": "https://www.gravatar.com/avatar/3e5744471a061ee3bf3a29ce9bb5a4a7?s=128&d=identicon&r=PG&f=1", "display_name": "420fedoras", "link": "https://stackoverflow.com/users/7940372/420fedoras"}, "edited": false, "score": 0, "creation_date": 1493641318, "post_id": 43718064, "comment_id": 74481281, "body": "@420fedoras <code>sortBy</code> takes the arguments from the input list, and feeds them (two-by-two) to the comparison function. The resulting sorted elements are put into a new list -- there&#39;s no way to modify or mutate the original list in Haskell."}], "tags": [], "owner": {"reputation": 100185, "user_id": 3234959, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/93bb12ca0f93dfddb33880316f7e66c2?s=128&d=identicon&r=PG&f=1", "display_name": "chi", "link": "https://stackoverflow.com/users/3234959/chi"}, "is_accepted": false, "score": 1, "last_activity_date": 1493637044, "last_edit_date": 1493637044, "creation_date": 1493636469, "answer_id": 43718064, "question_id": 43718031, "link": "https://stackoverflow.com/questions/43718031/haskell-sorting-a-list-of-trees/43718064#43718064", "title": "Haskell: Sorting a List of Trees", "body": "<p>Basically, you can write your function</p>\n\n<pre><code>score :: Tree -&gt; Int\n</code></pre>\n\n<p>providing a score for each of your trees. The score above is an <code>Int</code>, but any other ordered type can do as a score.</p>\n\n<p>Then, you can use</p>\n\n<pre><code>sortBy (flip $ comparing score) myListOfTree\n</code></pre>\n\n<p>to sort according to the score. Remember to import <code>Data.Ord</code> for <code>comparing</code>.</p>\n\n<hr>\n\n<p>Note that this can compute the score more than once. If your score function is expensive, you might want instead to precompute the scores as follows:</p>\n\n<pre><code>map snd . sortBy (flip $ comparing fst) . map (\\t -&gt; (score t, t)) $ myListOfTree\n</code></pre>\n\n<hr>\n\n<p>Another option is to define your own comparison function directly</p>\n\n<pre><code>compareTree :: Tree -&gt; Tree -&gt; Ordering\ncompareTree t1 t2 | someCondition       = LT   -- t1 &lt;  t2\n                  | someOtherCondiction = EQ   -- t1 == t2\n                  | otherwise           = GT   -- t1 &gt;  t2\n</code></pre>\n\n<p>where in the conditions you can use your score function, if you want.</p>\n\n<p>Then use <code>sortBy compareTree</code> to do sort in ascending order, or <code>sortBy (flip compareTree)</code> for the descending sort.</p>\n\n<p>If this ordering it the only \"natural\" ordering for your <code>Tree</code> type, you can even declare it such:</p>\n\n<pre><code>instance Ord Tree where\n   compare = compareTree\n</code></pre>\n\n<p>(Note however that this approach will call <code>compareTree</code> many times, one for every comparison, possibly computing the score over and over. Hence, the <code>map</code> solution shown above might still be preferred.)</p>\n"}], "owner": {"reputation": 315, "user_id": 7940372, "user_type": "registered", "accept_rate": 58, "profile_image": "https://www.gravatar.com/avatar/3e5744471a061ee3bf3a29ce9bb5a4a7?s=128&d=identicon&r=PG&f=1", "display_name": "420fedoras", "link": "https://stackoverflow.com/users/7940372/420fedoras"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 624, "favorite_count": 0, "answer_count": 1, "score": 0, "last_activity_date": 1493637044, "creation_date": 1493636236, "question_id": 43718031, "link": "https://stackoverflow.com/questions/43718031/haskell-sorting-a-list-of-trees", "title": "Haskell: Sorting a List of Trees", "body": "<p>I have a list of trees that have associated numerical values (we can treat it like sorting a list of Ints for this case) and I want to sort the whole list from highest to lowest and return the new sorted list. How do I do this? I have encountered the built in list sorting functions such as sortBy but I don't understand how to implement it.</p>\n\n<p>I'm also new to coding in general if it wasn't obvious ;)</p>\n"}, {"tags": ["haskell"], "answers": [{"comments": [{"owner": {"reputation": 1024, "user_id": 5339728, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/bc87e9ae4adff4d75b1ad9233e04bc54?s=128&d=identicon&r=PG&f=1", "display_name": "Sven Williamson", "link": "https://stackoverflow.com/users/5339728/sven-williamson"}, "edited": false, "score": 0, "creation_date": 1493659297, "post_id": 43720240, "comment_id": 74490271, "body": "Thank you very much Ben!"}], "tags": [], "owner": {"reputation": 37219, "user_id": 1523776, "user_type": "moderator", "accept_rate": 87, "profile_image": "https://www.gravatar.com/avatar/b3e0b5c8e42a8c38009ef2d969f8dabb?s=128&d=identicon&r=PG", "display_name": "Benjamin Hodgson", "link": "https://stackoverflow.com/users/1523776/benjamin-hodgson"}, "is_accepted": true, "score": 1, "last_activity_date": 1493646750, "creation_date": 1493646750, "answer_id": 43720240, "question_id": 43717180, "link": "https://stackoverflow.com/questions/43717180/generic-solution-to-eq-show-overlapping-instances-issue-when-defining-class/43720240#43720240", "title": "Generic solution to (Eq, Show) overlapping instances issue when defining class (* -&gt; *)", "body": "<p>There's no backtracking in instance search. Instances are matched purely based on the syntactic structure of the instance head. That means instance contexts are not accounted for during instance resolution.</p>\n\n<p>So, when you write</p>\n\n<pre><code>instance (M m) =&gt; Show (m v) where\n    show = bar\n</code></pre>\n\n<p>you're saying \"Here is an instance for <code>Show</code>, for any type of the form <code>m v</code>\". Since <code>[x] :: [] (A Int)</code> is indeed a type of the form <code>m v</code> (set <code>m ~ []</code> and <code>v ~ A Int</code>), instance search for <code>Show [A Int]</code> turns up two candidates:</p>\n\n<pre><code>instance Show a =&gt; Show [a]\ninstance M m =&gt; Show (m v)\n</code></pre>\n\n<p>Like I said, the type checker doesn't look at the instances' contexts when selecting an instance, so these two instances are overlapping.</p>\n\n<p>The fix is to not declare instances like <code>Show (m v)</code>. As a general rule, it's a bad idea to declare instances whose head is composed purely of type variables. Every instance you write should start with an honest-to-goodness type constructor, and you should approach instances which don't fit that pattern with suspicion.</p>\n\n<p>Supplying a <code>newtype</code> for your default instances is a fairly standard design (see, for example, <a href=\"https://hackage.haskell.org/package/bifunctors-3.2.0.1/docs/Data-Bifunctor-Wrapped.html\" rel=\"nofollow noreferrer\"><code>WrappedBifunctor</code></a>'s <code>Functor</code> instance),</p>\n\n<pre><code>newtype WrappedM m a = WrappedM { unwrapM :: m a }\n\ninstance M m =&gt; Show (WrappedM m a) where\n    show = bar . unwrapM\n</code></pre>\n\n<p>as is giving a default implementation of the function at the top level (see eg <a href=\"https://hackage.haskell.org/package/base-4.9.1.0/docs/Data-Traversable.html#v:foldMapDefault\" rel=\"nofollow noreferrer\"><code>foldMapDefault</code></a>):</p>\n\n<pre><code>showDefault = bar\n</code></pre>\n"}], "owner": {"reputation": 1024, "user_id": 5339728, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/bc87e9ae4adff4d75b1ad9233e04bc54?s=128&d=identicon&r=PG&f=1", "display_name": "Sven Williamson", "link": "https://stackoverflow.com/users/5339728/sven-williamson"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 100, "favorite_count": 0, "accepted_answer_id": 43720240, "answer_count": 1, "score": 0, "last_activity_date": 1493646750, "creation_date": 1493632021, "question_id": 43717180, "link": "https://stackoverflow.com/questions/43717180/generic-solution-to-eq-show-overlapping-instances-issue-when-defining-class", "title": "Generic solution to (Eq, Show) overlapping instances issue when defining class (* -&gt; *)", "body": "<p>Stack has many threads on overlapping instances, and while these are helpful in explaining the source of the problem, I am still not clear as to how to redesign my code for the problem to go away. While I will certain invest more time and effort in going through the details of existing answers, I will post here the general pattern which I have identified as creating the problem, in the hope that a simple and generic answer exists: I typically find myself defining a class such as:</p>\n\n<pre><code>{-# LANGUAGE FlexibleInstances #-}\nclass M m where\n  foo :: m v -&gt; Int\n  bar :: m v -&gt; String\n</code></pre>\n\n<p>together with the instance declarations:</p>\n\n<pre><code>instance (M m) =&gt; Eq (m v) where\n  (==) x y = (foo x) == (foo y)      -- details unimportant\n\ninstance (M m) =&gt; Show (m v) where\n  show = bar                         -- details unimportant\n</code></pre>\n\n<p>and in the course of my work I will inevitably create some data type:</p>\n\n<pre><code>data A v = A v\n</code></pre>\n\n<p>and declare <code>A</code> as an instance of class <code>M</code>:</p>\n\n<pre><code>instance M A where\n  foo x = 1                           -- details unimportant\n  bar x = \"bar\"\n</code></pre>\n\n<p>Then defining some elements of <code>A Integer</code>:</p>\n\n<pre><code>x = A 2\ny = A 3\n</code></pre>\n\n<p>I have no issue printing <code>x</code> and <code>y</code> or evaluating the Boolean <code>x == y</code>, but if I attempt to print the list <code>[x]</code> or evaluate the Boolean <code>[x] == [y]</code>, then the overlapping instance error occurs:</p>\n\n<pre><code>main = do\n print x                                     -- fine\n print y                                     -- fine\n print (x == y)                              -- fine\n print [x]                                   -- overlapping instance error\n if [x] == [y] then return () else return () -- overlapping instance error\n</code></pre>\n\n<p>The cause of these errors is now very clear I think: they stem from the existing instance declarations <code>instance Show a =&gt; Show [a]</code> and <code>instance Eq a =&gt; Eq [a]</code> and while it is true that <code>[] :: * -&gt; *</code> has not yet been declared as an instance of my class <code>M</code>, there is nothing preventing someone doing so at some point: so the compiler ignores the context of instance declarations.</p>\n\n<p>When faced with the pattern I have described, how can it be re-engineered to avoid the problem? </p>\n"}, {"tags": ["haskell", "web", "service", "frameworks", "scotty"], "comments": [{"owner": {"reputation": 145, "user_id": 457115, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/e5d76471846fdcc576f003eb27a2e44b?s=128&d=identicon&r=PG", "display_name": "sumo", "link": "https://stackoverflow.com/users/457115/sumo"}, "edited": false, "score": 0, "creation_date": 1493805758, "post_id": 43716497, "comment_id": 74555068, "body": "You have /:convert/:amount so you have two captures before the query string. It needs to be <code>&#47;convert&#47;:amount</code>, no <b>:</b> before convert,"}, {"owner": {"reputation": 357, "user_id": 7559069, "user_type": "registered", "accept_rate": 0, "profile_image": "https://www.gravatar.com/avatar/a12d26c0f18887e7bd11431459b0fefd?s=128&d=identicon&r=PG&f=1", "display_name": "Antonio Serrano", "link": "https://stackoverflow.com/users/7559069/antonio-serrano"}, "reply_to_user": {"reputation": 145, "user_id": 457115, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/e5d76471846fdcc576f003eb27a2e44b?s=128&d=identicon&r=PG", "display_name": "sumo", "link": "https://stackoverflow.com/users/457115/sumo"}, "edited": false, "score": 0, "creation_date": 1494001384, "post_id": 43716497, "comment_id": 74658455, "body": "This was definitely the solution, thank you very much!"}], "answers": [{"tags": [], "owner": {"reputation": 145, "user_id": 457115, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/e5d76471846fdcc576f003eb27a2e44b?s=128&d=identicon&r=PG", "display_name": "sumo", "link": "https://stackoverflow.com/users/457115/sumo"}, "is_accepted": false, "score": 1, "last_activity_date": 1493640622, "creation_date": 1493640622, "answer_id": 43718905, "question_id": 43716497, "link": "https://stackoverflow.com/questions/43716497/scotty-web-service/43718905#43718905", "title": "Scotty web service", "body": "<p>Looking at the <a href=\"https://hackage.haskell.org/package/scotty-0.11.0/docs/Web-Scotty.html#v:param\" rel=\"nofollow noreferrer\" title=\"docs\">docs</a> you need to call param to get what you need.</p>\n\n<p>Try this as starting point:</p>\n\n<pre><code>{-# LANGUAGE OverloadedStrings #-}\n\nimport Web.Scotty\nimport Data.Monoid\n\nmain = scotty 3000 $ do\n  get \"/convert/:amt\" $ do\n  amt &lt;- param \"amt\"\n  frm &lt;- param \"from\"\n  to &lt;- param \"to\"\n  html $ \"&lt;h1&gt;\" &lt;&gt; amt &lt;&gt;\" in \" &lt;&gt; frm &lt;&gt; \" is \" &lt;&gt; to &lt;&gt; \"&lt;/h1&gt;\"\n</code></pre>\n\n<p>I'll leave the conversion piece for you to figure out. Using <code>&lt;&gt;</code> instead of mconcat seemed cleaner as well.</p>\n"}], "owner": {"reputation": 357, "user_id": 7559069, "user_type": "registered", "accept_rate": 0, "profile_image": "https://www.gravatar.com/avatar/a12d26c0f18887e7bd11431459b0fefd?s=128&d=identicon&r=PG&f=1", "display_name": "Antonio Serrano", "link": "https://stackoverflow.com/users/7559069/antonio-serrano"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 165, "favorite_count": 0, "answer_count": 1, "score": 0, "last_activity_date": 1495460535, "creation_date": 1493628280, "last_edit_date": 1495460535, "question_id": 43716497, "link": "https://stackoverflow.com/questions/43716497/scotty-web-service", "title": "Scotty web service", "body": "<p>I need to create a web service to convert between different currencies using the <a href=\"http://hackage.haskell.org/package/scotty\" rel=\"nofollow noreferrer\"> scotty web framework </a> in Haskell.</p>\n\n<p>The web service should respond to get requests such as /convert/15?to=usd&amp;from=eur.</p>\n\n<p>I have this code so far:</p>\n\n<pre><code>{-# LANGUAGE OverloadedStrings #-}\n\nimport Web.Scotty\nimport Data.Monoid (mconcat)\n\nfunctionxs :: a -&gt; Int\nfunctionxs a = 5\n\nmain = scotty 3000 $ do\n  get \"/:word\" $ do\n    name &lt;- param \"word\"\n    html $ mconcat [\"&lt;h1&gt;Hi, \", name, \" what's up!&lt;/h1&gt;\"]\n</code></pre>\n\n<p>Thus, when you execute in the browswer: <a href=\"http://localhost:3000/Tony\" rel=\"nofollow noreferrer\">http://localhost:3000/Tony</a>\nthe result is: Hi, Tony, what's up!</p>\n\n<p>The problem is that I don't know how to change the code in order to have '/convert/15?to=usd&amp;from=eur.' as request and get the proper answer.</p>\n\n<p>Hopefully anyone can help me.</p>\n\n<p>Thanks in advance.</p>\n\n<p>Edited with final solution:</p>\n\n<pre><code>{-# LANGUAGE OverloadedStrings #-}\n\nimport Web.Scotty\nimport Data.Monoid (mconcat)\nimport Data.Text.Lazy (Text, pack)\n\nmain = scotty 3000 $ do\n    get \"/convert/:amount\" $ do\n        money &lt;- param \"amount\"\n        to &lt;- param \"to\"\n        frm &lt;- param \"from\"\n        html $ mconcat [\"&lt;h1&gt;The result is: \", pack (show (convert \nmoney to frm)),  \"&lt;/h1&gt;\"]\n\nconvert :: Double -&gt; String -&gt; String -&gt; Double\nconvert a b c = if (b==\"euro\" &amp;&amp; c==\"usd\") \n            then (a*1.091)\n            else if (b==\"usd\" &amp;&amp; c==\"euro\")\n            then (a*0.915)\n            else 0\n</code></pre>\n"}, {"tags": ["haskell", "composition", "partial-application"], "comments": [{"owner": {"reputation": 31243, "user_id": 2751851, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/4ddc0.png?s=128&g=1", "display_name": "duplode", "link": "https://stackoverflow.com/users/2751851/duplode"}, "edited": false, "score": 0, "creation_date": 1493610733, "post_id": 43713963, "comment_id": 74471755, "body": "Hint: <code>m ^ n</code> is the same as <code>(^) m n</code>."}, {"owner": {"reputation": 27, "user_id": 7945715, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/f06dbe79bee2a8ced192e7b4698e3829?s=128&d=identicon&r=PG&f=1", "display_name": "cde33", "link": "https://stackoverflow.com/users/7945715/cde33"}, "reply_to_user": {"reputation": 31243, "user_id": 2751851, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/4ddc0.png?s=128&g=1", "display_name": "duplode", "link": "https://stackoverflow.com/users/2751851/duplode"}, "edited": false, "score": 0, "creation_date": 1493611505, "post_id": 43713963, "comment_id": 74471943, "body": "@duplode      (^) m n  means the same  in prefix notation, but I don&#39;t understand how to use it in this case,  because I need to use partial application"}, {"owner": {"reputation": 31243, "user_id": 2751851, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/4ddc0.png?s=128&g=1", "display_name": "duplode", "link": "https://stackoverflow.com/users/2751851/duplode"}, "edited": false, "score": 1, "creation_date": 1493611801, "post_id": 43713963, "comment_id": 74472004, "body": "I mentioned the prefix syntax because it makes it a bit easier to see how you are supposed to partially apply <code>(^)</code>."}, {"owner": {"reputation": 27, "user_id": 7945715, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/f06dbe79bee2a8ced192e7b4698e3829?s=128&d=identicon&r=PG&f=1", "display_name": "cde33", "link": "https://stackoverflow.com/users/7945715/cde33"}, "reply_to_user": {"reputation": 31243, "user_id": 2751851, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/4ddc0.png?s=128&g=1", "display_name": "duplode", "link": "https://stackoverflow.com/users/2751851/duplode"}, "edited": false, "score": 0, "creation_date": 1493612043, "post_id": 43713963, "comment_id": 74472072, "body": "@duplode   I tried to do :                                                                                                                     ` evenOutcome = even.(^) `    because I thought it as prefix notation."}, {"owner": {"reputation": 31243, "user_id": 2751851, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/4ddc0.png?s=128&g=1", "display_name": "duplode", "link": "https://stackoverflow.com/users/2751851/duplode"}, "edited": false, "score": 0, "creation_date": 1493612146, "post_id": 43713963, "comment_id": 74472106, "body": "In your attempt, you are composing functions (with <code>(.)</code>), but you aren&#39;t doing any partial application."}, {"owner": {"reputation": 57219, "user_id": 33796, "user_type": "registered", "accept_rate": 70, "profile_image": "https://www.gravatar.com/avatar/08727b23ba62e634b32988cdff082663?s=128&d=identicon&r=PG", "display_name": "luqui", "link": "https://stackoverflow.com/users/33796/luqui"}, "edited": false, "score": 0, "creation_date": 1493612605, "post_id": 43713963, "comment_id": 74472216, "body": "There is an <a href=\"http://stackoverflow.com/questions/29596285/point-free-problems-in-haskell/29596461#29596461\">algorithm</a> for making any function normally defined pointfree."}, {"owner": {"reputation": 27, "user_id": 7945715, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/f06dbe79bee2a8ced192e7b4698e3829?s=128&d=identicon&r=PG&f=1", "display_name": "cde33", "link": "https://stackoverflow.com/users/7945715/cde33"}, "reply_to_user": {"reputation": 31243, "user_id": 2751851, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/4ddc0.png?s=128&g=1", "display_name": "duplode", "link": "https://stackoverflow.com/users/2751851/duplode"}, "edited": false, "score": 0, "creation_date": 1493613512, "post_id": 43713963, "comment_id": 74472426, "body": "@duplode       you were right.  New version: evenOutcome n = even.(^n)"}, {"owner": {"reputation": 31243, "user_id": 2751851, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/4ddc0.png?s=128&g=1", "display_name": "duplode", "link": "https://stackoverflow.com/users/2751851/duplode"}, "edited": false, "score": 0, "creation_date": 1493614287, "post_id": 43713963, "comment_id": 74472606, "body": "Yup, that&#39;s the idea. Note that your new version isn&#39;t exactly equivalent to the original one due to the order of the arguments -- for that, you want <code>evenOutcome m = even . (m ^)</code>."}, {"owner": {"reputation": 27, "user_id": 7945715, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/f06dbe79bee2a8ced192e7b4698e3829?s=128&d=identicon&r=PG&f=1", "display_name": "cde33", "link": "https://stackoverflow.com/users/7945715/cde33"}, "reply_to_user": {"reputation": 31243, "user_id": 2751851, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/4ddc0.png?s=128&g=1", "display_name": "duplode", "link": "https://stackoverflow.com/users/2751851/duplode"}, "edited": false, "score": 0, "creation_date": 1493615958, "post_id": 43713963, "comment_id": 74472988, "body": "@duplode Thanks, I understood the problem"}], "owner": {"reputation": 27, "user_id": 7945715, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/f06dbe79bee2a8ced192e7b4698e3829?s=128&d=identicon&r=PG&f=1", "display_name": "cde33", "link": "https://stackoverflow.com/users/7945715/cde33"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 35, "favorite_count": 0, "closed_date": 1493614325, "answer_count": 0, "score": 0, "last_activity_date": 1493610689, "creation_date": 1493610039, "last_edit_date": 1493610689, "question_id": 43713963, "link": "https://stackoverflow.com/questions/43713963/composition-and-partial-application-on-haskell", "closed_reason": "Duplicate", "title": "composition and partial application on haskell", "body": "<p>I'm trying to do this: Define the function <code>evenOutcome</code>, which applying it with an <code>n</code> number and an <code>m</code> number, returns true if the result of raising <code>n</code> to the number <code>m</code> is even.\nNote: Solve it using partial application and composition.</p>\n\n<p>I did this: <code>evenOutcome m n = even (m ^ n)</code>, which works, but does not satisfy the composition and partial application tasks.\nTo satisfy the tasks I did this: <code>evenOutcome = even.(^)</code>,\nwhich is clearly wrong.</p>\n"}, {"tags": ["haskell"], "answers": [{"tags": [], "owner": {"reputation": 1735, "user_id": 2892792, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/5DNyi.jpg?s=128&g=1", "display_name": "Lazersmoke", "link": "https://stackoverflow.com/users/2892792/lazersmoke"}, "is_accepted": false, "score": 1, "last_activity_date": 1493608752, "creation_date": 1493608752, "answer_id": 43713829, "question_id": 43713745, "link": "https://stackoverflow.com/questions/43713745/foldr-in-haskell-confusion/43713829#43713829", "title": "foldr in Haskell: confusion", "body": "<p><code>foldr f startingValue (x:xs)</code> expands to <code>f x (foldr f startingValue xs)</code>, and <code>foldr f startingValue []</code> expands to <code>startingValue</code> so in your case: </p>\n\n<pre><code>foldr (\\x y -&gt; (x + y)/2) 2 [4,5,6]\n(\\x y -&gt; (x + y)/2) 4 (foldr (\\x y -&gt; (x + y)/2) 2 [5,6])\n(\\x y -&gt; (x + y)/2) 4 ((\\x y -&gt; (x + y)/2) 5 (foldr (\\x y -&gt; (x + y)/2) 2 [6]))\n(\\x y -&gt; (x + y)/2) 4 ((\\x y -&gt; (x + y)/2) 5 ((\\x y -&gt; (x + y)/2) 6 (foldr (\\x y -&gt; (x + y)/2) 2 [])))\n(\\x y -&gt; (x + y)/2) 4 ((\\x y -&gt; (x + y)/2) 5 ((\\x y -&gt; (x + y)/2) 6 2))\n(\\x y -&gt; (x + y)/2) 4 ((\\x y -&gt; (x + y)/2) 5 4)\n(\\x y -&gt; (x + y)/2) 4 4.5\n4.25\n</code></pre>\n\n<p>It might be easier to see with <code>f x y = (x + y)/2</code>:</p>\n\n<pre><code>foldr f 2 [4,5,6]\nf 4 (foldr f 2 [5,6])\nf 4 (f 5 (foldr f 2 [6]))\nf 4 (f 5 (f 6 (foldr f 2 [])))\nf 4 (f 5 (f 6 2))\nf 4 (f 5 4)\nf 4 4.5\n4.25\n</code></pre>\n\n<p>If you understand how cons lists are constructed (using <code>:</code>), you can think of <code>foldr</code> as replacing all the <code>:</code> with the function you provide.</p>\n"}, {"tags": [], "owner": {"reputation": 31243, "user_id": 2751851, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/4ddc0.png?s=128&g=1", "display_name": "duplode", "link": "https://stackoverflow.com/users/2751851/duplode"}, "is_accepted": false, "score": 2, "last_activity_date": 1493608998, "last_edit_date": 1592644375, "creation_date": 1493608998, "answer_id": 43713858, "question_id": 43713745, "link": "https://stackoverflow.com/questions/43713745/foldr-in-haskell-confusion/43713858#43713858", "title": "foldr in Haskell: confusion", "body": "<blockquote>\n<p>Say I want to use foldr in this way:</p>\n<pre><code>foldr (\\x y -&gt; (x + y)/2) 2 [4,5,6]\n</code></pre>\n<p>Is <code>y</code> in this case represents each element of the list?</p>\n</blockquote>\n<p>One way of figuring it out is looking at the type of <code>foldr</code>:</p>\n<pre><code>GHCi&gt; :t foldr\nfoldr :: Foldable t =&gt; (a -&gt; b -&gt; b) -&gt; b -&gt; t a -&gt; b\n</code></pre>\n<p>The structure being folded has type <code>t a</code> for some <code>Foldable t</code> (in your case, you have a list, and so <code>t</code> is <code>[]</code>), and its elements have type <code>a</code>. The result accumulated through the fold has type <code>b</code>. The binary function used for folding has type <code>a -&gt; b -&gt; b</code>, so the elements are passed as its first argument, and the accumulated value, as its second.</p>\n<p>Another way of figuring out is by reading <a href=\"https://hackage.haskell.org/package/base-4.9.1.0/docs/src/GHC.Base.html#foldr\" rel=\"nofollow noreferrer\">the actual implementation of <code>foldr</code> for lists</a> (I found this by looking for the <a href=\"https://hackage.haskell.org/package/base-4.9.1.0/docs/Data-Foldable.html#t:Foldable\" rel=\"nofollow noreferrer\"><code>Foldable</code> instance of lists</a> and then following the source links). You might want to try that, to see how one picture corresponds to the other.</p>\n"}], "owner": {"reputation": 751, "user_id": 7092612, "user_type": "registered", "accept_rate": 68, "profile_image": "https://www.gravatar.com/avatar/f2c7e756b5d374d5dc5d9ed2b99dbc07?s=128&d=identicon&r=PG&f=1", "display_name": "wrek", "link": "https://stackoverflow.com/users/7092612/wrek"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 71, "favorite_count": 0, "closed_date": 1493665630, "answer_count": 2, "score": 0, "last_activity_date": 1493609200, "creation_date": 1493608006, "last_edit_date": 1493609200, "question_id": 43713745, "link": "https://stackoverflow.com/questions/43713745/foldr-in-haskell-confusion", "closed_reason": "Duplicate", "title": "foldr in Haskell: confusion", "body": "<p>I just have a question about the usage of foldr. </p>\n\n<p>Say I want to use foldr in this way:</p>\n\n<pre><code>foldr (\\x y -&gt; (x + y)/2) 2 [4,5,6]\n</code></pre>\n\n<p>Is <code>y</code> in this case represents each element of the list?</p>\n\n<hr>\n\n<p>In particular, let's unwrap this function. </p>\n\n<p>we have (x = 2, y= 6) -> (2+6)/2 = 4. </p>\n\n<p><strong>Next, do we have x=4, y = 5?</strong></p>\n\n<p>I am asking a simplify version of what I really want to ask. Here, the content of x and y represents matter a lot because in my application, I have a function that takes 1st argument as type a, and second argument as type b. Thus, I do need to know whats going on under-the hood. </p>\n"}, {"tags": ["haskell"], "comments": [{"owner": {"reputation": 1735, "user_id": 2892792, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/5DNyi.jpg?s=128&g=1", "display_name": "Lazersmoke", "link": "https://stackoverflow.com/users/2892792/lazersmoke"}, "edited": false, "score": 0, "creation_date": 1493646611, "post_id": 43713482, "comment_id": 74483739, "body": "That is correct. You can only do <code>Equals</code> on <code>ChunkyNum</code>s anyway, so that constraint makes good sense. If you are looking for design improvments, I would consider whether you actually need a data family at all. You could use a type family, or get rid of the type class entirely and operate on any <code>Eq</code>uatable or <code>Num</code>ber."}], "answers": [{"tags": [], "owner": {"reputation": 1735, "user_id": 2892792, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/5DNyi.jpg?s=128&g=1", "display_name": "Lazersmoke", "link": "https://stackoverflow.com/users/2892792/lazersmoke"}, "is_accepted": true, "score": 2, "last_activity_date": 1493608024, "creation_date": 1493608024, "answer_id": 43713750, "question_id": 43713482, "link": "https://stackoverflow.com/questions/43713482/am-i-on-the-track-for-my-toy-language-evaluator/43713750#43713750", "title": "Am I on the track for my toy language evaluator?", "body": "<p>GHC is telling you that it can't know that every single <code>Number num</code> will have an instance for <code>ChunkyNum</code>. You can resolve this by changing the <code>Number</code> data family to an associated data family of <code>ChunkyNum</code>:</p>\n\n<pre><code>class ChunkyNum a where\n  data Number a :: *\n  equals :: Number a -&gt; Number a -&gt; Bool\n</code></pre>\n\n<p>with instances like</p>\n\n<pre><code>instance ChunkyNum Integer where\n  data Number Integer = NumInt Integer\n  equals (NumInt a) (NumInt b) = a == b\n</code></pre>\n\n<p>Otherwise, you would have to write an <code>instance ChunkyNum (Number num) where</code>, which is impossible for a standalone (open) data family.</p>\n\n<p>Please let me know if any of this is inapplicable to your use case.</p>\n\n<p><a href=\"https://wiki.haskell.org/GHC/Type_families#Instance_declarations\" rel=\"nofollow noreferrer\">Further Reading</a></p>\n"}], "owner": {"reputation": 3922, "user_id": 1198582, "user_type": "registered", "accept_rate": 99, "profile_image": "https://www.gravatar.com/avatar/02d3e1025aed5f061c481871986c45b1?s=128&d=identicon&r=PG", "display_name": "Michael Litchard", "link": "https://stackoverflow.com/users/1198582/michael-litchard"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 50, "favorite_count": 0, "accepted_answer_id": 43713750, "answer_count": 1, "score": 0, "last_activity_date": 1493610813, "creation_date": 1493605387, "last_edit_date": 1493610813, "question_id": 43713482, "link": "https://stackoverflow.com/questions/43713482/am-i-on-the-track-for-my-toy-language-evaluator", "title": "Am I on the track for my toy language evaluator?", "body": "<p>I'm trying to write an evaluator for my toy language. One thing I would like to include, are both Ints and Doubles. Here is my latest attempt:</p>\n\n<pre><code>{-# LANGUAGE GADTs #-}\n{-# LANGUAGE TypeFamilies #-}\n{-# LANGUAGE FlexibleInstances #-}\nmodule Types where\n\nimport Prelude\n\ndata family Number n\ndata instance Number Integer = NumInt Integer deriving (Eq,Show)\n-- data instance Number Double  = NumDouble Double deriving (Eq,Show)\n\ndata Expr a where\n  BoolConst   :: Bool   -&gt; Expr Bool\n  NumConst    :: Number num -&gt; Expr (Number num)\n\n  Equals      :: Expr (Number num)  -&gt; Expr (Number num) -&gt; Expr Bool\n\nclass ChunkyNum a where\n  equals :: a -&gt; a -&gt; Bool\n\n-- more methods to be added\n\ninstance ChunkyNum (Number Integer) where\n  equals a b = a == b\n</code></pre>\n\n<p>here's my eval function</p>\n\n<pre><code>{-# LANGUAGE GADTs #-}\nmodule Eval where\n\nimport Types\n\neval :: Expr z -&gt; z\neval (BoolConst b)     = b\neval (NumConst b)      = b\n</code></pre>\n\n<p>and in ghci I can do this.</p>\n\n<pre><code>*Main Eval Types&gt; let five = NumConst (NumInt 5 :: Number Integer)\n*Main Eval Types&gt; let ten = NumConst (NumInt 10 :: Number Integer)\n*Main Eval Types&gt; eval five == eval ten\nFalse\n</code></pre>\n\n<p>Now, I try to do similar in my eval function</p>\n\n<pre><code>eval :: Expr z -&gt; z\neval (BoolConst b)     = b\neval (NumConst b)      = b\neval (Equals a b)      = (eval a) `equals` (eval b)\n</code></pre>\n\n<p>and then, trying to compile:</p>\n\n<pre><code>~/projects/git/chunky/src/Eval.hs:12:26: error:\n    \u2022 Could not deduce (ChunkyNum (Number num))\n        arising from a use of \u2018equals\u2019\n      from the context: z ~ Bool\n        bound by a pattern with constructor:\n                   Equals :: forall num.\n                             Expr (Number num) -&gt; Expr (Number num) -&gt;    Expr Bool,\n                 in an equation for \u2018eval\u2019\n        at src/Eval.hs:12:7-16\n\u2022     In the expression: (eval a) `equals` (eval b)\n      In an equation for \u2018eval\u2019:\n           eval (Equals a b) = (eval a) `equals` (eval b)\n</code></pre>\n\n<p>I think I am on the right track, and that I just need to provide more information to ghc. Am I, if so, what's the next step. If not, how do I go about solving this problem?</p>\n\n<p>Lazersmoke, your suggestion worked, but I had to add a constraint to the Equals constructor. This was at the behest of ghc, but I wonder if it's still bad practice.                                                      </p>\n\n<pre><code>Equals      :: (ChunkyNum num) =&gt; Expr (Number num)  -&gt; Expr (Number num) -&gt; Expr Bool\n</code></pre>\n"}, {"tags": ["haskell"], "answers": [{"comments": [{"owner": {"reputation": 57219, "user_id": 33796, "user_type": "registered", "accept_rate": 70, "profile_image": "https://www.gravatar.com/avatar/08727b23ba62e634b32988cdff082663?s=128&d=identicon&r=PG", "display_name": "luqui", "link": "https://stackoverflow.com/users/33796/luqui"}, "edited": false, "score": 1, "creation_date": 1493613315, "post_id": 43713922, "comment_id": 74472385, "body": "TIL that <a href=\"https://downloads.haskell.org/~ghc/6.6/docs/html/users_guide/gadt.html\" rel=\"nofollow noreferrer\">GADT/record syntax</a> is completely valid"}], "tags": [], "owner": {"reputation": 1735, "user_id": 2892792, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/5DNyi.jpg?s=128&g=1", "display_name": "Lazersmoke", "link": "https://stackoverflow.com/users/2892792/lazersmoke"}, "is_accepted": true, "score": 4, "last_activity_date": 1493609705, "last_edit_date": 1495541397, "creation_date": 1493609705, "answer_id": 43713922, "question_id": 43713308, "link": "https://stackoverflow.com/questions/43713308/confusion-over-a-haskell-existential-wrapper/43713922#43713922", "title": "Confusion over a Haskell &quot;Existential Wrapper&quot;", "body": "<p>The strange GADT/record syntax that doesn't look like it should compile aside, we can understand what is going on here by setting <code>f ~ Eq</code>:</p>\n\n<pre><code>Some :: Eq a =&gt; a -&gt; Some Eq\n</code></pre>\n\n<p>So, given an <code>Eq</code>uatable thing, we get <code>Some Eq</code>uatable thing out of it. Let's apply this to <code>'a' :: Char</code> and see what happens:</p>\n\n<pre><code>(Some :: Eq Char =&gt; Char -&gt; Some Eq) ('a' :: Char) :: Some Eq\n</code></pre>\n\n<p>As you can see, we have \"forgotten\" the exact type of the value, but \"remembered\" that it is <code>Eq</code>uatable.</p>\n\n<p>The GADT you provide is simply a generalization of this from <code>Eq</code> to anything with kind <code>* -&gt; Constraint</code>:</p>\n\n<pre><code>(Eq :: * -&gt; Constraint) (Char :: *) :: Constraint\n(f :: * -&gt; Constraint) (a :: *) :: Constraint\n</code></pre>\n\n<p>As for why it is called \"existential\", the GADT hides an implicit <code>forall</code> in the constructor declaration:</p>\n\n<pre><code>Some :: forall a. f a =&gt; { unSome :: a } -&gt; Some f\n</code></pre>\n\n<p>Once you pattern match on <code>Some f</code>, you get a value of type <code>f a =&gt; a</code>, where <code>a</code> can't escape its scope for technical reasons. (Which is called <a href=\"https://stackoverflow.com/questions/12719435/what-are-skolems\">skolem</a>) You can use a CPS combinator like this to work with it:</p>\n\n<pre><code>ambiguously :: (forall s. f s =&gt; s -&gt; r) -&gt; Some f -&gt; r\nambiguously f (Some s) = f s\n</code></pre>\n\n<p>Now you have <code>ambiguously show :: Some Show -&gt; String</code>, which shows <code>Some Show</code>able thing. It is called \"ambiguously\" because it is ambiguous in which actual type it is using (ie it works for <code>ambiguously show $ Some 'a'</code> and <code>ambiguously show $ Some \"asdf\"</code>)</p>\n\n<p>We can't do</p>\n\n<pre><code>disambiguate :: f a =&gt; Some f -&gt; a\ndisambiguate (Some a) = a\n</code></pre>\n\n<p>because of the aforementioned skolem restriction.</p>\n\n<p><a href=\"https://github.com/Lazersmoke/ghost-buster/blob/master/src/Data/SuchThat.hs#L22\" rel=\"nofollow noreferrer\">My (unpublished) library</a> related to this, with an even more general kind.</p>\n"}], "owner": {"reputation": 5821, "user_id": 1770201, "user_type": "registered", "accept_rate": 45, "profile_image": "https://www.gravatar.com/avatar/46bcb5d2018194c9beb884b6797e57e0?s=128&d=identicon&r=PG", "display_name": "George", "link": "https://stackoverflow.com/users/1770201/george"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 144, "favorite_count": 2, "accepted_answer_id": 43713922, "answer_count": 1, "score": 4, "last_activity_date": 1493609705, "creation_date": 1493603796, "question_id": 43713308, "link": "https://stackoverflow.com/questions/43713308/confusion-over-a-haskell-existential-wrapper", "title": "Confusion over a Haskell &quot;Existential Wrapper&quot;", "body": "<p>From a Haskell file:</p>\n\n<pre><code>import GHC.Exts (Constraint)\n\n-- |Existential wrapper \ndata Some :: (* -&gt; Constraint) -&gt; * where\n  Some :: f a =&gt; { unSome :: a } -&gt; Some f\n</code></pre>\n\n<p>I know that <code>Constraint</code> represents a kind distinct from <code>*</code> that can be used to categorize context types that appear to the left of a <code>=&gt;</code>.</p>\n\n<p>But in what sense is <code>Some</code> an existential wrapper? How could it be used as such?</p>\n"}, {"tags": ["list", "haskell", "infinite"], "answers": [{"tags": [], "owner": {"reputation": 45534, "user_id": 106104, "user_type": "registered", "accept_rate": 62, "profile_image": "https://www.gravatar.com/avatar/c88b9310b92a937108ec4336c2832f92?s=128&d=identicon&r=PG", "display_name": "user253751", "link": "https://stackoverflow.com/users/106104/user253751"}, "is_accepted": false, "score": 3, "last_activity_date": 1493601771, "creation_date": 1493601771, "answer_id": 43713083, "question_id": 43713070, "link": "https://stackoverflow.com/questions/43713070/haskell-infinite-list/43713083#43713083", "title": "Haskell - infinite list -", "body": "<p>I'd write it as <code>map soda [1,2..]</code></p>\n\n<p><code>map</code> effectively takes each element in the list (1, 2, 3 and so on) and applies <code>soda</code> to it, resulting in another list with <code>soda 1</code>, <code>soda 2</code>, <code>soda 3</code> and so on.</p>\n"}, {"tags": [], "owner": {"reputation": 7054, "user_id": 1313611, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/9ee895c4ad3fa29cf3aaa4abddda289f?s=128&d=identicon&r=PG", "display_name": "pyrospade", "link": "https://stackoverflow.com/users/1313611/pyrospade"}, "is_accepted": false, "score": 3, "last_activity_date": 1493644379, "last_edit_date": 1493644379, "creation_date": 1493601884, "answer_id": 43713095, "question_id": 43713070, "link": "https://stackoverflow.com/questions/43713070/haskell-infinite-list/43713095#43713095", "title": "Haskell - infinite list -", "body": "<p>The way to do this is via the <code>map</code> function. Infinite lists which step by <code>1</code> can be done with the <code>..</code> syntax.</p>\n\n<pre><code>map soda [1..]\n</code></pre>\n\n<p>This is semantically equivalent to something like</p>\n\n<pre><code>[soda 1, soda 2, soda 3, {- and so on... -}]\n</code></pre>\n\n<p>The reason this works is thanks to Haskell's lazy evaluation.  The calls to <code>soda</code> only occur once you start traversing the infinite list, so no need to fear getting caught in an infinite loop here.</p>\n"}], "owner": {"reputation": 41, "user_id": 7945459, "user_type": "registered", "profile_image": "https://graph.facebook.com/1646250558723163/picture?type=large", "display_name": "Miguel Racedo", "link": "https://stackoverflow.com/users/7945459/miguel-racedo"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 371, "favorite_count": 0, "answer_count": 2, "score": 4, "last_activity_date": 1493644379, "creation_date": 1493601634, "question_id": 43713070, "link": "https://stackoverflow.com/questions/43713070/haskell-infinite-list", "title": "Haskell - infinite list -", "body": "<p>I have this data and types:</p>\n\n<pre><code>data Cliente = Uncliente {nombre::String,resistencia::Int,bebidas::[Bebida],amigos::[Cliente]} deriving (Show) \n\ntype Bebida = Cliente -&gt; Cliente \n\ntype Nombre = String\ntype Duracion = Float\ntype Acciones = [Bebida]\ntype Itinerario = (Nombre,Duracion,Acciones)\n</code></pre>\n\n<p>And I have this slogan:</p>\n\n<p>\"Define chuckNorris, who is a customer who was initially called \"Chuck\", has resistance 1000, is Ana's friend and took all sodas that exist in the universe, starting with a level 1 soda, then a level 2 soda, and So on.\"</p>\n\n<p>and i do:</p>\n\n<pre><code>chuckNorris = Uncliente {\n    nombre = \"Chuck\",\n    resistencia = 1000,\n    bebidas = [soda 1,2..],\n    amigos = [ana]\n</code></pre>\n\n<p>But this does not work because the infinite list of drinks is not like that</p>\n\n<p>How would you write the infinite list?</p>\n\n<p>like soda 1, soda 2, soda 3 ........</p>\n"}, {"tags": ["haskell", "types"], "answers": [{"tags": [], "owner": {"reputation": 1735, "user_id": 2892792, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/5DNyi.jpg?s=128&g=1", "display_name": "Lazersmoke", "link": "https://stackoverflow.com/users/2892792/lazersmoke"}, "is_accepted": true, "score": 9, "last_activity_date": 1493600301, "creation_date": 1493600301, "answer_id": 43712941, "question_id": 43712935, "link": "https://stackoverflow.com/questions/43712935/could-not-deduce-bounded-a1-arising-from-a-use-of-minbound/43712941#43712941", "title": "Could not deduce (Bounded a1) arising from a use of &#39;minBound&#39;", "body": "<p>You must enable <code>ScopedTypeVariables</code> using <code>{-# LANGUAGE ScopedTypeVariables #-}</code>, which allows you to use type variables from the function signature inside the function itself. You will also need to change your example as follows:</p>\n\n<pre><code>{-# LANGUAGE ScopedTypeVariables #-}\n\nmyTest :: forall a. (Bounded a) =&gt; a\nmyTest = minBound :: a\n</code></pre>\n\n<p>The <code>forall</code> tells the compiler to scope the <code>a</code>. Definitions with no explicit <code>forall</code> with have the default (unscoped) behavior.</p>\n\n<p>Otherwise, the <code>a</code> inside the function is a different <code>a</code> (changed to <code>a1</code> by the compiler) than the one in the main type signature. It can't deduce that <code>a1</code> is Bounded from only the context that some other type <code>a</code> is bounded.</p>\n\n<p>The second example works because <code>Int</code> is not a type variable, it is a concrete type, which means that it refers to the same type regardless of what type variables are or are not in scope.</p>\n\n<p><a href=\"https://wiki.haskell.org/Scoped_type_variables\" rel=\"noreferrer\">Further Reading</a></p>\n"}], "owner": {"reputation": 1491, "user_id": 3923882, "user_type": "registered", "accept_rate": 38, "profile_image": "https://www.gravatar.com/avatar/f8d4455db0f00ed542fb86deda730d11?s=128&d=identicon&r=PG&f=1", "display_name": "arcticmatt", "link": "https://stackoverflow.com/users/3923882/arcticmatt"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 525, "favorite_count": 0, "accepted_answer_id": 43712941, "answer_count": 1, "score": 8, "last_activity_date": 1493600301, "creation_date": 1493600253, "question_id": 43712935, "link": "https://stackoverflow.com/questions/43712935/could-not-deduce-bounded-a1-arising-from-a-use-of-minbound", "title": "Could not deduce (Bounded a1) arising from a use of &#39;minBound&#39;", "body": "<p>This is probably a stupid question, but why does this function</p>\n\n<pre><code>myTest :: (Bounded a) =&gt; a\nmyTest = minBound :: a\n</code></pre>\n\n<p>not typecheck? </p>\n\n<p>This works </p>\n\n<pre><code>myTest' :: Int\nmyTest' = minBound :: Int\n</code></pre>\n\n<p>and they seem the same to me, except that one would have to type the former (e.g. myTest :: Int) in order for it to work. </p>\n\n<p>The error I get is </p>\n\n<pre><code>\u2022 Could not deduce (Bounded a1) arising from a use of \u2018minBound\u2019\n  from the context: Bounded a\n    bound by the type signature for:\n               myTest :: Bounded a =&gt; a\n</code></pre>\n"}, {"tags": ["list", "haskell", "types"], "comments": [{"owner": {"reputation": 31243, "user_id": 2751851, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/4ddc0.png?s=128&g=1", "display_name": "duplode", "link": "https://stackoverflow.com/users/2751851/duplode"}, "edited": false, "score": 1, "creation_date": 1493597872, "post_id": 43712517, "comment_id": 74469329, "body": "Please try to give more descriptive titles to your questions -- &quot;Lists and tuples in haskell&quot; could mean pretty much anything. (If you have difficulties with summarising your question into a short yet meaningful title, that might be a sign that your question isn&#39;t clear or specific enough.)"}, {"owner": {"reputation": 62252, "user_id": 1435869, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/TrEd9.jpg?s=128&g=1", "display_name": "karakfa", "link": "https://stackoverflow.com/users/1435869/karakfa"}, "edited": false, "score": 0, "creation_date": 1493600180, "post_id": 43712517, "comment_id": 74469808, "body": "fst . maximumBy (comparing snd) . map (\\x -&gt; (x,conocerIntensidad x))`"}], "answers": [{"comments": [{"owner": {"reputation": 67, "user_id": 7847767, "user_type": "registered", "accept_rate": 0, "profile_image": "https://graph.facebook.com/10208231670339035/picture?type=large", "display_name": "Felipe Otero", "link": "https://stackoverflow.com/users/7847767/felipe-otero"}, "edited": false, "score": 0, "creation_date": 1493601462, "post_id": 43712991, "comment_id": 74470042, "body": "Thank you very much for the explanation. It works excelent"}], "tags": [], "owner": {"reputation": 34158, "user_id": 7203016, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/ybAMw.png?s=128&g=1", "display_name": "K. A. Buhr", "link": "https://stackoverflow.com/users/7203016/k-a-buhr"}, "is_accepted": false, "score": 0, "last_activity_date": 1493601147, "last_edit_date": 1493601147, "creation_date": 1493600837, "answer_id": 43712991, "question_id": 43712517, "link": "https://stackoverflow.com/questions/43712517/getting-the-element-of-a-list-with-maximum-value-as-calculated-by-another-func/43712991#43712991", "title": "Getting the element of a list with maximum &quot;value&quot; as calculated by another function", "body": "<p>I believe you want something like:</p>\n\n<pre><code>import Data.List\nimport Data.Ord\n\napplyHighestIntensityItinerario :: [Itinerario] -&gt; Cliente -&gt; Cliente\napplyHighestIntensityItinerario itinerarios cliente =\n  let itinerario = maximumBy (comparing conocerIntensidad) itinerarios\n  in  realizarItinerario itinerario cliente\n</code></pre>\n\n<p>Here, <code>maximumBy (comparing conocerIntensidad)</code> chooses the element of the list <code>itinerarios</code> whose intensity as computed by <code>conocerIntensidad</code> has maximum value.  <code>maximumBy</code> comes from <code>Data.List</code>, and <code>comparing</code> comes from <code>Data.Ord</code>.</p>\n\n<p>Then, the <code>let</code> clause is used to assign it to a variable <code>itinerario</code> and apply it using the helper function <code>realizarItinerario</code>.</p>\n"}], "owner": {"reputation": 67, "user_id": 7847767, "user_type": "registered", "accept_rate": 0, "profile_image": "https://graph.facebook.com/10208231670339035/picture?type=large", "display_name": "Felipe Otero", "link": "https://stackoverflow.com/users/7847767/felipe-otero"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 127, "favorite_count": 0, "answer_count": 1, "score": 0, "last_activity_date": 1493601147, "creation_date": 1493595806, "last_edit_date": 1493600983, "question_id": 43712517, "link": "https://stackoverflow.com/questions/43712517/getting-the-element-of-a-list-with-maximum-value-as-calculated-by-another-func", "title": "Getting the element of a list with maximum &quot;value&quot; as calculated by another function", "body": "<p>I have this data and types</p>\n\n<pre><code>data Cliente = Uncliente {nombre::String,resistencia::Int,bebidas::[Bebida],amigos::[Cliente]} deriving (Show) \n\ntype Bebida = Cliente -&gt; Cliente \n\ntype Nombre = String\ntype Duracion = Float\ntype Acciones = [Bebida]\ntype Itinerario = (Nombre,Duracion,Acciones)\n</code></pre>\n\n<p>i have this functions:</p>\n\n<p>This function takes an itinerario and a cliente and return a client with values modified.</p>\n\n<pre><code>realizarItinerario :: Itinerario -&gt; Cliente -&gt; Cliente\nrealizarItinerario itinerario cliente = tomarTragos cliente (conseguirAcciones itinerario)\n</code></pre>\n\n<p>I have this function that lets you know the intensity of each itinerario</p>\n\n<pre><code>conocerIntensidad :: Itinerario -&gt; Float\nconocerIntensidad (nombre,duracion,acciones) = ((genericLength acciones)/duracion)\n</code></pre>\n\n<p>This is an auxiliary function :</p>\n\n<pre><code>conseguirAcciones :: Itinerario -&gt; [Bebida]\nconseguirAcciones (_,_,acciones) = acciones\n</code></pre>\n\n<p>And i need to create a function that given a list of Itinerarios and a Client, it return the client with the Highest Intensity itinerario applied to him:</p>\n\n<p>I know how to get the highest itinerario but dont know how to apply it on the same function.</p>\n"}, {"tags": ["haskell", "lazy-evaluation", "state-monad"], "comments": [{"owner": {"reputation": 28376, "user_id": 5743988, "user_type": "registered", "accept_rate": 67, "profile_image": "https://i.stack.imgur.com/IeSSM.jpg?s=128&g=1", "display_name": "4castle", "link": "https://stackoverflow.com/users/5743988/4castle"}, "edited": false, "score": 1, "creation_date": 1493596178, "post_id": 43712476, "comment_id": 74468986, "body": "Your post seems to be a reversal of Stack Overflow&#39;s format. You&#39;ve got an answer, and you&#39;re looking for a question. This site is for real, practical questions, not broad, speculative ones."}, {"owner": {"reputation": 100892, "user_id": 745903, "user_type": "registered", "accept_rate": 74, "profile_image": "https://www.gravatar.com/avatar/50933f6638836741e620669b3940410e?s=128&d=identicon&r=PG", "display_name": "leftaroundabout", "link": "https://stackoverflow.com/users/745903/leftaroundabout"}, "reply_to_user": {"reputation": 28376, "user_id": 5743988, "user_type": "registered", "accept_rate": 67, "profile_image": "https://i.stack.imgur.com/IeSSM.jpg?s=128&g=1", "display_name": "4castle", "link": "https://stackoverflow.com/users/5743988/4castle"}, "edited": false, "score": 10, "creation_date": 1493597652, "post_id": 43712476, "comment_id": 74469284, "body": "@4castle perhaps you&#39;re right, but at least I find this topic sufficiently exciting to say, <i>who cares about Stack Overflow&#39;s format</i> in this case."}, {"owner": {"reputation": 37219, "user_id": 1523776, "user_type": "moderator", "accept_rate": 87, "profile_image": "https://www.gravatar.com/avatar/b3e0b5c8e42a8c38009ef2d969f8dabb?s=128&d=identicon&r=PG", "display_name": "Benjamin Hodgson", "link": "https://stackoverflow.com/users/1523776/benjamin-hodgson"}, "edited": false, "score": 10, "creation_date": 1493598362, "post_id": 43712476, "comment_id": 74469438, "body": "Why does everything have to have a real-world use? Can&#39;t things just be cool, or fun, or beautiful?"}, {"owner": {"reputation": 60057, "user_id": 1333025, "user_type": "registered", "accept_rate": 65, "profile_image": "https://www.gravatar.com/avatar/79ab43010f900324ac5e2de19a2916cb?s=128&d=identicon&r=PG", "display_name": "Petr", "link": "https://stackoverflow.com/users/1333025/petr"}, "reply_to_user": {"reputation": 37219, "user_id": 1523776, "user_type": "moderator", "accept_rate": 87, "profile_image": "https://www.gravatar.com/avatar/b3e0b5c8e42a8c38009ef2d969f8dabb?s=128&d=identicon&r=PG", "display_name": "Benjamin Hodgson", "link": "https://stackoverflow.com/users/1523776/benjamin-hodgson"}, "edited": false, "score": 0, "creation_date": 1493627163, "post_id": 43712476, "comment_id": 74475971, "body": "@BenjaminHodgson Agreed. Moreover such things often become extremely useful at some point, often unexpectedly."}, {"owner": {"reputation": 8237, "user_id": 2900502, "user_type": "registered", "accept_rate": 73, "profile_image": "https://i.stack.imgur.com/R1OjD.jpg?s=128&g=1", "display_name": "Shersh", "link": "https://stackoverflow.com/users/2900502/shersh"}, "reply_to_user": {"reputation": 37219, "user_id": 1523776, "user_type": "moderator", "accept_rate": 87, "profile_image": "https://www.gravatar.com/avatar/b3e0b5c8e42a8c38009ef2d969f8dabb?s=128&d=identicon&r=PG", "display_name": "Benjamin Hodgson", "link": "https://stackoverflow.com/users/1523776/benjamin-hodgson"}, "edited": false, "score": 3, "creation_date": 1493639467, "post_id": 43712476, "comment_id": 74480442, "body": "@BenjaminHodgson Things can be cool and beautiful and fun, sure. Still, there\u2019s that joy of taking a thing that is just beautiful, and apply it somewhere in the real world, and make it work! And you can understand something deeper if you look at it from various angles, real world examples being one of such angles."}, {"owner": {"user_type": "does_not_exist", "display_name": "user933161"}, "edited": false, "score": 0, "creation_date": 1530391793, "post_id": 43712476, "comment_id": 89222820, "body": "Replace past and future with x and  y."}, {"owner": {"reputation": 44013, "user_id": 1477667, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/trgKM.jpg?s=128&g=1", "display_name": "dfeuer", "link": "https://stackoverflow.com/users/1477667/dfeuer"}, "edited": false, "score": 3, "creation_date": 1551398265, "post_id": 43712476, "comment_id": 96636347, "body": "A version of this monad is used to implement <code>Data.Traversable.mapAccumR</code>."}], "answers": [{"comments": [{"owner": {"reputation": 8237, "user_id": 2900502, "user_type": "registered", "accept_rate": 73, "profile_image": "https://i.stack.imgur.com/R1OjD.jpg?s=128&g=1", "display_name": "Shersh", "link": "https://stackoverflow.com/users/2900502/shersh"}, "edited": false, "score": 0, "creation_date": 1553498857, "post_id": 54927866, "comment_id": 97391151, "body": "Awesome example!"}], "tags": [], "owner": {"reputation": 101, "user_id": 11131000, "user_type": "registered", "profile_image": "https://lh3.googleusercontent.com/-WwVbrifzhso/AAAAAAAAAAI/AAAAAAAABo0/f3smAW-he4Q/photo.jpg?sz=128", "display_name": "Cale Gibbard", "link": "https://stackoverflow.com/users/11131000/cale-gibbard"}, "is_accepted": true, "score": 6, "last_activity_date": 1551363873, "creation_date": 1551363873, "answer_id": 54927866, "question_id": 43712476, "link": "https://stackoverflow.com/questions/43712476/real-life-and-useful-examples-of-reverse-state-monad/54927866#54927866", "title": "Real life and useful examples of Reverse State monad", "body": "<p>I have known about these monads for well over a decade now, and have only just recently seen a realistic application of them. It's in a bit of an unusual setting. A coworker and I are using functional reactive programming via the 'reflex' library, and are working on a library to help with building terminal-graphics applications. If you're familiar with 'reflex-dom', it's similar in nature, except that our basic monad, rather than putting subsequent widgets one after the other in the DOM, instead just stacks terminal character-cell-based \"images\" on top of each other, and it's up to the user to carve up the screen sensibly. We wanted to provide something a little nicer than this, which would keep track of remaining screen real-estate to some extent, and let the user place some \"tiles\" in rows and columns, such that a do-block basically corresponds to either a column or row of tiles on the screen.</p>\n\n<p>In addition to handling the problem of layout, we also want the tiles to be able to manage keyboard focus, allowing the user to press tab to cycle through them, or shift-tab to go in reverse. It was here that the forwards-and-backwards-in-time state monad transformer became quite handy: we can have the current state in either direction be an Event (of an empty tuple). Each tile can send an event to the previous and next widgets (and receive an event from them), notifying widgets when they are receiving keyboard focus and so should stop blocking key presses from reaching their child widgets. So schematically, the tile widget looks something like:</p>\n\n<pre><code>do rec focusP &lt;- recvFromPast\n       sendToPast shiftTabPress\n       tabPress &lt;- gate focused $ ... filter input Event for Tab keypresses ...\n       shiftTabPress &lt;- gate focused $ ... filter input Event for Shift-Tab ...\n       focused &lt;- hold False $ leftmost\n         [ True &lt;$ (focusP &lt;&gt; focusF)\n         , False &lt;$ (shiftTabPress &lt;&gt; tabPress) ]\n       v &lt;- ... run the child widget and do layout stuff ...\n       sendToFuture tabPress\n       focusF &lt;- recvFromFuture\n   return v\n</code></pre>\n\n<p>Here, sendToFuture is the ordinary state \"put\", sendToPast is the reverse-time \"put\", recvFromPast is the ordinary state \"get\", and recvFromFuture is reverse-time \"get\". So <code>focusP :: Event t ()</code> is an Event that we get from our predecessor (another tile like this one, probably) telling us that we have the focus now, and <code>focusF</code>, is a similar Event we receive from our successor. We keep track of when we have the focus using a 'hold' to construct <code>focused :: Behavior t Bool</code>, which is then used to gate the keyboard events so that we're sure to tell our neighbours they're receiving focus only if we ourselves are focused, and is also used in the bit I elided where we're running the child widget, in order to filter its input events appropriately.</p>\n\n<p>I'm not certain we're actually going to still be doing it this way by the time the library gets released, but it seems to work well thus far, and I was happy to have finally noticed a case in which this construction could be put to practical use.</p>\n"}], "owner": {"reputation": 8237, "user_id": 2900502, "user_type": "registered", "accept_rate": 73, "profile_image": "https://i.stack.imgur.com/R1OjD.jpg?s=128&g=1", "display_name": "Shersh", "link": "https://stackoverflow.com/users/2900502/shersh"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 1133, "favorite_count": 6, "accepted_answer_id": 54927866, "answer_count": 1, "score": 9, "last_activity_date": 1551363873, "creation_date": 1493595373, "question_id": 43712476, "link": "https://stackoverflow.com/questions/43712476/real-life-and-useful-examples-of-reverse-state-monad", "title": "Real life and useful examples of Reverse State monad", "body": "<p><em>Reverse State monad</em> is really nice and mind blowing example of Haskell language's expressiveness and lazy evaluation. But it's not that easy to understand this monad. Moreover, it's really hard to find some convincing real life example of what you can do with <em>Reverse State monad</em> easier than with any other tool in the language.</p>\n\n<p><em>Reverse State</em> monad is defined in the next way:</p>\n\n<pre><code>newtype RState s a = RState { runRState :: s -&gt; (a,s) }\n\ninstance Monad (RState s) where\n    return x = RState $ (,) x\n    RState sf &gt;&gt;= f = RState $ \\s -&gt;\n        let (a, past)   = sf future\n            (b, future) = runRState (f a) s\n        in (b, past)\n</code></pre>\n\n<p>It already has some examples and usages but I don't find them quite practical.</p>\n\n<ol>\n<li><a href=\"https://www.quora.com/What-are-some-crazy-things-one-can-do-with-monads-in-Haskell\" rel=\"noreferrer\">Quora answer</a>: well-explained and even has real life example of usage but without code and it's not clear whether it's a really good idea to use <code>RState</code>.</li>\n<li><a href=\"https://lukepalmer.wordpress.com/2008/08/10/mindfuck-the-reverse-state-monad/\" rel=\"noreferrer\">Mindfuck</a>: introducing this nice concept but example is not useful. Nobody will write Fibonacci numbers this way.</li>\n<li><a href=\"https://kseo.github.io/posts/2017-01-21-writer-monad.html\" rel=\"noreferrer\">Kwang's Haskell Blog</a>: shows how <code>Writer</code> can be emulated with <code>RState</code> but come on. Not really a real life example :)</li>\n</ol>\n\n<p>I'm also aware of <a href=\"https://hackage.haskell.org/package/tardis-0.3.0.0/docs/Control-Monad-Tardis.html\" rel=\"noreferrer\"><code>tardis</code></a> package but no tutorial of this library, documentation examples are really abstract, not so many people really understand it. The closest to what I want is <a href=\"http://kcsongor.github.io/time-travel-in-haskell-for-dummies/\" rel=\"noreferrer\">this tutorial</a> but it has example of <code>tardis</code>, not just <code>RState</code>. As well as <a href=\"https://books.google.ru/books?id=IZsQAwAAQBAJ&amp;pg=PA391&amp;lpg=PA391&amp;dq=haskell%20tardis%20package&amp;source=bl&amp;ots=Dqte9JG-un&amp;sig=Udct1ZqCjfxz1b8u8D0sSkKrhaM&amp;hl=ru&amp;sa=X&amp;ved=0ahUKEwjh_rLAps3TAhVCP5oKHSCkAEgQ6AEIXTAH#v=onepage&amp;q=haskell%20tardis%20package&amp;f=false\" rel=\"noreferrer\">this book reference</a>.</p>\n\n<p>Thus I'm not looking for <code>tardis</code> real life patterns, I'm interested only in <code>RState</code> illustration if possible. Though I understand that there might be no samples of pure <code>RState</code> usages. In that case minimal example with <code>RStateT</code> transformer or <code>tardis</code> is good enough.</p>\n\n<p>Did someone use this monad in real life or have really nice &amp; useful illustration with code?</p>\n"}, {"tags": ["haskell"], "answers": [{"comments": [{"owner": {"reputation": 49, "user_id": 6473325, "user_type": "registered", "accept_rate": 0, "profile_image": "https://www.gravatar.com/avatar/83a984b18bddba398c7bea7cfc0e3305?s=128&d=identicon&r=PG&f=1", "display_name": "Amateur", "link": "https://stackoverflow.com/users/6473325/amateur"}, "edited": false, "score": 0, "creation_date": 1493582877, "post_id": 43710776, "comment_id": 74465650, "body": "How did you figure out that checkDiff handles lists of length zero and one?"}, {"owner": {"reputation": 339851, "user_id": 149392, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/7a561ec0875fcbbe3066ea8fe288ec77?s=128&d=identicon&r=PG", "display_name": "sepp2k", "link": "https://stackoverflow.com/users/149392/sepp2k"}, "reply_to_user": {"reputation": 49, "user_id": 6473325, "user_type": "registered", "accept_rate": 0, "profile_image": "https://www.gravatar.com/avatar/83a984b18bddba398c7bea7cfc0e3305?s=128&d=identicon&r=PG&f=1", "display_name": "Amateur", "link": "https://stackoverflow.com/users/6473325/amateur"}, "edited": false, "score": 1, "creation_date": 1493583101, "post_id": 43710776, "comment_id": 74465726, "body": "@Amateur <code>[]</code> is a list of length 0, <code>[(0, _)]</code>, <code>[(_, 0)]</code> and <code>[(a, b)]</code> are all lists of length 1 and that&#39;s all the patterns you have."}, {"owner": {"reputation": 49, "user_id": 6473325, "user_type": "registered", "accept_rate": 0, "profile_image": "https://www.gravatar.com/avatar/83a984b18bddba398c7bea7cfc0e3305?s=128&d=identicon&r=PG&f=1", "display_name": "Amateur", "link": "https://stackoverflow.com/users/6473325/amateur"}, "edited": false, "score": 0, "creation_date": 1493583212, "post_id": 43710776, "comment_id": 74465759, "body": "Thanks chi. I&#39;m still new to Haskell. I have a lot to learn. Thank you."}], "tags": [], "owner": {"reputation": 100185, "user_id": 3234959, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/93bb12ca0f93dfddb33880316f7e66c2?s=128&d=identicon&r=PG&f=1", "display_name": "chi", "link": "https://stackoverflow.com/users/3234959/chi"}, "is_accepted": false, "score": 2, "last_activity_date": 1493582569, "creation_date": 1493582569, "answer_id": 43710776, "question_id": 43710736, "link": "https://stackoverflow.com/questions/43710736/non-exhaustive-pattern-matches-on-list-of-tuples/43710776#43710776", "title": "non-exhaustive pattern matches on list of tuples", "body": "<p><code>checkDiff</code> only handles lists of length zero and one. It is probably called with a longer list, triggering the non-exhaustiveness error.</p>\n\n<p>You should turn on warnings with the <code>-Wall</code> flag. If you do, GHC will report such problems at compile time instead.</p>\n"}], "owner": {"reputation": 49, "user_id": 6473325, "user_type": "registered", "accept_rate": 0, "profile_image": "https://www.gravatar.com/avatar/83a984b18bddba398c7bea7cfc0e3305?s=128&d=identicon&r=PG&f=1", "display_name": "Amateur", "link": "https://stackoverflow.com/users/6473325/amateur"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 167, "favorite_count": 0, "closed_date": 1493665593, "answer_count": 1, "score": 0, "last_activity_date": 1493582569, "creation_date": 1493582339, "question_id": 43710736, "link": "https://stackoverflow.com/questions/43710736/non-exhaustive-pattern-matches-on-list-of-tuples", "closed_reason": "Duplicate", "title": "non-exhaustive pattern matches on list of tuples", "body": "<p>I'm not sure what I'm missing here, but I have been unable to get the pattern matching on checkDiff to work in the code below. GHCi report \"non-exhaustive patterns in function checkDiff. The code is:</p>\n\n<pre><code>import Data.Array.Unboxed\n\nprimes :: [Int]\nprimes = 2 : oddprimes ()\n  where \n    oddprimes () = 3 : sieve (oddprimes ()) 3 []\n    sieve (p:ps) x fs = [i*2 + x | (i,True) &lt;- assocs a] \n                        ++ sieve ps (p*p) ((p,0) : \n                             [(s, rem (y-q) s) | (s,y) &lt;- fs])\n     where\n      q = (p*p-x)`div`2\n      a :: UArray Int Bool\n      a = accumArray (\\ b c -&gt; False) True (1,q-1)\n                     [(i,()) | (s,y) &lt;- fs, i &lt;- [y+s, y+s+s..q]]\n\ntakePrimes :: [Int] -&gt; [(Int,Int)]\ntakePrimes [] = []\ntakePrimes [x] = []\ntakePrimes (x:y:zs) = if y - x &gt; 2 then (x,y) : takePrimes (y:zs) else takePrimes (y:zs) \n\ncheckDiff :: [(Int,Int)] -&gt; Int\ncheckDiff [] = 0\ncheckDiff [(0,_)] = 0\ncheckDiff [(_,0)] = 0\ncheckDiff [(a,b)] = sum $ [x | x &lt;- [(a + 1)..(b - 1)], totalFactors a == totalFactors (a + 1)]\n\ntotalFactors :: Int -&gt; Int \ntotalFactors n = length $ [x | x &lt;- [2..(div n 2)], rem n x == 0]\n</code></pre>\n\n<p>Please help.</p>\n"}, {"tags": ["haskell", "backtracking", "monad-transformers"], "comments": [{"owner": {"reputation": 24211, "user_id": 1364288, "user_type": "registered", "accept_rate": 88, "profile_image": "https://i.stack.imgur.com/JVtNl.png?s=128&g=1", "display_name": "danidiaz", "link": "https://stackoverflow.com/users/1364288/danidiaz"}, "edited": false, "score": 1, "creation_date": 1493581050, "post_id": 43710370, "comment_id": 74465021, "body": "Have you tried inverting the monad stack? Working in <code>StateT RState []  String</code>. That way each brach should have its own state. In a <code>ListT (State RState) String</code> stack the state is shared across branches, as you have discovered."}, {"owner": {"reputation": 45534, "user_id": 106104, "user_type": "registered", "accept_rate": 62, "profile_image": "https://www.gravatar.com/avatar/c88b9310b92a937108ec4336c2832f92?s=128&d=identicon&r=PG", "display_name": "user253751", "link": "https://stackoverflow.com/users/106104/user253751"}, "edited": false, "score": 0, "creation_date": 1493601579, "post_id": 43710370, "comment_id": 74470070, "body": "This is impossible. What if the underlying monad was <code>IO</code> and the user executed <code>launchNuclearMissiles china</code>? Would you unlaunch the missiles at China?"}], "answers": [{"comments": [{"owner": {"reputation": 24211, "user_id": 1364288, "user_type": "registered", "accept_rate": 88, "profile_image": "https://i.stack.imgur.com/JVtNl.png?s=128&g=1", "display_name": "danidiaz", "link": "https://stackoverflow.com/users/1364288/danidiaz"}, "edited": false, "score": 0, "creation_date": 1493625694, "post_id": 43714513, "comment_id": 74475536, "body": "The doodle in this post <a href=\"http://blog.sigfpe.com/2006/10/monads-field-guide.html\" rel=\"nofollow noreferrer\">blog.sigfpe.com/2006/10/monads-field-guide.html</a> actually gives a good intuition for the &quot;single-threaded statefulness&quot; of <code>ListT (State s)</code>. The doodle for <code>StateT s []</code> is missing but it should be a state which &quot;forked&quot; with the branches of <code>[]</code>."}, {"owner": {"reputation": 57219, "user_id": 33796, "user_type": "registered", "accept_rate": 70, "profile_image": "https://www.gravatar.com/avatar/08727b23ba62e634b32988cdff082663?s=128&d=identicon&r=PG", "display_name": "luqui", "link": "https://stackoverflow.com/users/33796/luqui"}, "reply_to_user": {"reputation": 24211, "user_id": 1364288, "user_type": "registered", "accept_rate": 88, "profile_image": "https://i.stack.imgur.com/JVtNl.png?s=128&g=1", "display_name": "danidiaz", "link": "https://stackoverflow.com/users/1364288/danidiaz"}, "edited": false, "score": 0, "creation_date": 1493664524, "post_id": 43714513, "comment_id": 74492904, "body": "@danidiaz, thanks!  I remembered that but not enough to find it."}], "tags": [], "owner": {"reputation": 57219, "user_id": 33796, "user_type": "registered", "accept_rate": 70, "profile_image": "https://www.gravatar.com/avatar/08727b23ba62e634b32988cdff082663?s=128&d=identicon&r=PG", "display_name": "luqui", "link": "https://stackoverflow.com/users/33796/luqui"}, "is_accepted": true, "score": 3, "last_activity_date": 1493664719, "last_edit_date": 1495540049, "creation_date": 1493614958, "answer_id": 43714513, "question_id": 43710370, "link": "https://stackoverflow.com/questions/43710370/backtrack-over-underlying-monad-in-monad-transformer/43714513#43714513", "title": "Backtrack over underlying monad in Monad Transformer", "body": "<p>The solution is to invert the stack, as @danidiaz suggests.</p>\n\n<p>I find it helpful to remember that outer monad transformers are at the mercy of inner ones.  So <code>SomeMonadT (State s)</code> will be a \"single-threaded\" in its statefulness, no matter what <code>SomeMonadT</code> does.</p>\n\n<p>An illuminating example is unrolling the <code>StateT</code> monad transformer over some other monad.  Let's say we have:</p>\n\n<pre><code>foo :: StateT S M A\nbar :: StateT S M B\n\ndo a &lt;- foo\n   b &lt;- bar\n   return (a,b)\n</code></pre>\n\n<p>This is just a fancy way of writing:</p>\n\n<pre><code>foo :: S -&gt; M (A, S)\nbar :: S -&gt; M (B, S)\n\n\\s1 -&gt; do \n    (a,s2) &lt;- foo s1\n    (b,s3) &lt;- bar s2\n    return ((a,b),s3)\n</code></pre>\n\n<p>Which is the familiar pattern motivating the <code>State</code> monad, except that the pattern takes place within another monadic context.  That context is king, there is nothing the transformer can do about it.</p>\n\n<p>That means <code>ListT (State s)</code> is a computation that tracks <em>one</em> state <code>s</code>, and then there is some \"sugar\" on top which is defined by <code>ListT</code>.  You could think of it as an implementation of nondeterminism in a stateful machine (that only has the ability to track a single state).</p>\n\n<p>Whereas <code>StateT s []</code> is a computation that is essentially nondeterministic, and then there is some \"sugar\" which emulates a state.  The underlying machine is a nondeterministic backtracking machine, and then the transformer uses a coding pattern to simulate state on that machine.</p>\n\n<p>Here is a <a href=\"http://blog.sigfpe.com/2006/10/monads-field-guide.html\" rel=\"nofollow noreferrer\">diagram</a> by Dan Piponi that helps give some intuition:</p>\n\n<p><a href=\"https://i.stack.imgur.com/uKMpb.jpg\" rel=\"nofollow noreferrer\"><img src=\"https://i.stack.imgur.com/uKMpb.jpg\" alt=\"monad doodles\"></a></p>\n\n<p>This is a bit wishywashy and intuitive feeling territory, so I hope this was helpful.</p>\n\n<p>Further reading: <a href=\"https://stackoverflow.com/questions/16457111/how-to-design-a-monadic-stack\">How to design a monadic stack?</a></p>\n"}], "owner": {"reputation": 1835, "user_id": 3907685, "user_type": "registered", "accept_rate": 87, "profile_image": "https://www.gravatar.com/avatar/4a9d7cdfc525e689e6baefb7d2158fb0?s=128&d=identicon&r=PG", "display_name": "Chris Penner", "link": "https://stackoverflow.com/users/3907685/chris-penner"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 262, "favorite_count": 2, "accepted_answer_id": 43714513, "answer_count": 1, "score": 4, "last_activity_date": 1493664719, "creation_date": 1493579903, "question_id": 43710370, "link": "https://stackoverflow.com/questions/43710370/backtrack-over-underlying-monad-in-monad-transformer", "title": "Backtrack over underlying monad in Monad Transformer", "body": "<p>As a side project I'm working on implementing my own <a href=\"https://github.com/ChrisPenner/simple-regex-parser\" rel=\"nofollow noreferrer\">Regex parser/compiler</a>.</p>\n\n<p>I figured that the actual matching portion would be a great time to learn how some backtracking monads work; like the list monad for example.</p>\n\n<p>I ended up structuring my 'match' algorithm like so:</p>\n\n<pre><code>data Expr\n  = Group Int Expr\n  | Terms [Expr]\n  | OneOf [Expr]\n  | Repetition Expr Int (Maybe Int)\n  | Empty\n  | BackRef Int\n  | Wildcard\n  | Atom Char\n  | Start\n  | End\n  deriving (Show)\n\ndata RState = RState\n  { groups :: Groups\n  , leftover :: String\n  } deriving Show\n\nmatch :: Expr -&gt; ListT (State RState) String\n</code></pre>\n\n<p>where ListT is from Gabriel's <a href=\"https://hackage.haskell.org/package/list-transformer-1.0.1/docs/List-Transformer.html\" rel=\"nofollow noreferrer\">List.Transformer lib</a></p>\n\n<p>The State monad portion tracks the groups which have been captured (so that I can use them when I match on back-references) and the remaining string left to consume. The <code>Expr</code> is a data-structure representing the Regex as an AST of sorts.</p>\n\n<p>Anyways; this works well; I recurse trying to make matches, if the match succeeds I return the matched portion as a result and alter the leftovers and groups in state accordingly, this ends up working in non-determinism because it will keep trying to continue using all possible previous matches when trying to process the next part of the regex. The problem is that it only backtracks on previous results, but NOT to the previous state! As a result my <code>alternative</code> match code for matching chains of optionals in the regex (e.g. a|b*|c; where each part is a 'term') looks like this:</p>\n\n<pre><code>match (OneOf terms) = do\n  st &lt;- get\n  -- Backtrack the state and try again on each alternative\n  let try t = put st &gt;&gt; match t\n  asum (try &lt;$&gt; terms)\n</code></pre>\n\n<p>basically I try to match on each term, but even if the match fails it still alters state! So I need to manually rewind state in between failures. This is due to the ListT implementation of <code>&lt;|&gt;</code>:</p>\n\n<pre><code>ListT m &lt;|&gt; l = ListT (do\n    s &lt;- m\n    case s of\n        Nil       -&gt; next l\n        Cons x l' -&gt; return (Cons x (l' &lt;|&gt; l)) )\n</code></pre>\n\n<p>Where we see it runs the underlying monad and continues in the same context.</p>\n\n<p>I want something similar to this:</p>\n\n<pre><code>ListT m &lt;|&gt; l = ListT (do\n    st &lt;- get\n    s &lt;- m\n    case s of\n        Nil       -&gt; put st &gt;&gt; next l\n        Cons x l' -&gt; return (Cons x (l' &lt;|&gt; l)) )\n</code></pre>\n\n<p>... But for all monad effects in general; I'm not even sure if this is possible.</p>\n\n<p>I looked into the <a href=\"https://hackage.haskell.org/package/logict-0.6.0.2/docs/Control-Monad-Logic.html\" rel=\"nofollow noreferrer\">Logic Monad</a> as a possible solution, but even after reading the paper I can't quite tell whether it can do what I want, maybe it's possible using <code>ifte</code>?</p>\n\n<p>Is there a backtracking monad which not only backtracks the result of the monad, but also the monadic computations? I suppose this is impossible for things like IO, but should in theory be possible for pure monads? I guess that means it's not possible in general, but is there a type-class I could implement to gain this functionality for my case?</p>\n\n<p>Thanks! I know I'm rambling out loud here, thanks for helping me think through this!</p>\n"}, {"tags": ["haskell", "haskell-stack"], "comments": [{"owner": {"reputation": 31243, "user_id": 2751851, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/4ddc0.png?s=128&g=1", "display_name": "duplode", "link": "https://stackoverflow.com/users/2751851/duplode"}, "edited": false, "score": 1, "creation_date": 1493577726, "post_id": 43709893, "comment_id": 74463882, "body": "&quot;I&#39;m currently working with very slow wifi environment. I&#39;m not sure whether stack build fails because of bad connectivity.&quot; -- Sounds plausible, though it is hard to tell for sure. This specific step (updating the package index) shouldn&#39;t be taking so long. Did you get to run <code>stack build</code> successfully in your system in the past?"}, {"owner": {"reputation": 3, "user_id": 7359019, "user_type": "registered", "profile_image": "https://graph.facebook.com/1292295954163982/picture?type=large", "display_name": "Lim Hyuntaek", "link": "https://stackoverflow.com/users/7359019/lim-hyuntaek"}, "reply_to_user": {"reputation": 31243, "user_id": 2751851, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/4ddc0.png?s=128&g=1", "display_name": "duplode", "link": "https://stackoverflow.com/users/2751851/duplode"}, "edited": false, "score": 0, "creation_date": 1493578157, "post_id": 43709893, "comment_id": 74464057, "body": "It&#39;s my first try using <i>stack build</i>. I&#39;ve installed stack 3.1.2 like a 3-4 months back and never have run it. I&#39;m trying to <code>stack upgrade</code> now but slow wifi here make me impatient."}, {"owner": {"reputation": 815, "user_id": 245743, "user_type": "registered", "accept_rate": 89, "profile_image": "https://www.gravatar.com/avatar/11a87619d08da72466e99e16453ea318?s=128&d=identicon&r=PG", "display_name": "ppb", "link": "https://stackoverflow.com/users/245743/ppb"}, "edited": false, "score": 1, "creation_date": 1493579561, "post_id": 43709893, "comment_id": 74464545, "body": "FWIW on my machine <code>.&#47;.stack&#47;indices&#47;Hackage&#47;git-update&#47;all-cabal-hashes</code> is ~ 250 MB so that can take a while to fully clone on a slow connection."}, {"owner": {"reputation": 3, "user_id": 7359019, "user_type": "registered", "profile_image": "https://graph.facebook.com/1292295954163982/picture?type=large", "display_name": "Lim Hyuntaek", "link": "https://stackoverflow.com/users/7359019/lim-hyuntaek"}, "edited": false, "score": 0, "creation_date": 1493662303, "post_id": 43709893, "comment_id": 74491818, "body": "250MB is pretty huge. This cloning need to be done every time running <code>stack build</code>? or only one time at the very first time?"}], "answers": [{"comments": [{"owner": {"reputation": 3, "user_id": 7359019, "user_type": "registered", "profile_image": "https://graph.facebook.com/1292295954163982/picture?type=large", "display_name": "Lim Hyuntaek", "link": "https://stackoverflow.com/users/7359019/lim-hyuntaek"}, "edited": false, "score": 0, "creation_date": 1493662235, "post_id": 43710387, "comment_id": 74491781, "body": "thank you very much Mr. Buhr. It doesn&#39;t solve my problem but at least I know what my problem is. Really thanks."}], "tags": [], "owner": {"reputation": 34158, "user_id": 7203016, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/ybAMw.png?s=128&g=1", "display_name": "K. A. Buhr", "link": "https://stackoverflow.com/users/7203016/k-a-buhr"}, "is_accepted": true, "score": 0, "last_activity_date": 1493580099, "last_edit_date": 1495542360, "creation_date": 1493580099, "answer_id": 43710387, "question_id": 43709893, "link": "https://stackoverflow.com/questions/43709893/stack-build-error-message-exited-with-exitfailure-128/43710387#43710387", "title": "Stack Build error message: exited with ExitFailure 128", "body": "<p>Error code -9806 is a Mac OS X error code for a generic SSL connection failure.  Others have reported this as a problem with older versions of <code>git</code> connecting to certain sites with incompatible SSL configurations.  See <a href=\"https://stackoverflow.com/questions/28927901/sslread-return-error-9806-15958\">this StackOverflow question</a>, for example.  However, it's also been reported as a result of a connection being interrupted on a flaky Internet connection (e.g., <a href=\"https://github.com/cocos2d/cocos2d-x/issues/15969\" rel=\"nofollow noreferrer\">this github issue</a>).</p>\n\n<p>Unfortunately, since you are seeing this after a 10 minute timeout, it's likely your Internet connection rather than an SSL compatibility problem.</p>\n\n<p>You might want to try running:</p>\n\n<pre><code>/usr/bin/git clone https://github.com/commercialhaskell/all-cabal-hashes.git\n    all-cabal-hashes/ -b display\n</code></pre>\n\n<p>manually in a directory somewhere.  It's about a 200 megabyte download.  This will show you if it's making any progress and how fast the download is running.</p>\n"}], "owner": {"reputation": 3, "user_id": 7359019, "user_type": "registered", "profile_image": "https://graph.facebook.com/1292295954163982/picture?type=large", "display_name": "Lim Hyuntaek", "link": "https://stackoverflow.com/users/7359019/lim-hyuntaek"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 225, "favorite_count": 0, "accepted_answer_id": 43710387, "answer_count": 1, "score": 0, "last_activity_date": 1493580099, "creation_date": 1493577036, "last_edit_date": 1493577414, "question_id": 43709893, "link": "https://stackoverflow.com/questions/43709893/stack-build-error-message-exited-with-exitfailure-128", "title": "Stack Build error message: exited with ExitFailure 128", "body": "<p>I'm following chapter 13.3 of <em>\"Haskell Programming from First Principles\"</em> \n and working on <code>stack build</code> but fail with below error message as below. I'm doing on my MBP terminal with <em>current Stack version: 1.3.2</em> installed, . Any solution for a way out? (I'm currently working with very slow wifi environment. I'm not sure whether stack build fails because of bad connectivity.)</p>\n\n<pre><code>$ stack build\nUpdating package index Hackage (mirrored at \nhttps://github.com/commercialhaskell/all-cabal-hashes.git) ...  \n</code></pre>\n\n<p>Long Pause Here... almost 10 minutes.</p>\n\n<pre><code>Running /usr/bin/git clone https://github.com/commercialhaskell/all-cabal-hashes.git all-cabal-hashes/ -b display in directory /Users/Sleepyleo/.stack/indices/Hackage/git-update/ exited with ExitFailure 128\n\nCloning into 'all-cabal-hashes'...  \nerror: RPC failed; curl 56 SSLRead() return error -9806  \nfatal: The remote end hung up unexpectedly\nfatal: early EOF\nfatal: index-pack failed\n</code></pre>\n"}, {"tags": ["haskell"], "comments": [{"owner": {"reputation": 37219, "user_id": 1523776, "user_type": "moderator", "accept_rate": 87, "profile_image": "https://www.gravatar.com/avatar/b3e0b5c8e42a8c38009ef2d969f8dabb?s=128&d=identicon&r=PG", "display_name": "Benjamin Hodgson", "link": "https://stackoverflow.com/users/1523776/benjamin-hodgson"}, "edited": false, "score": 0, "creation_date": 1493555808, "post_id": 43705579, "comment_id": 74457139, "body": "<a href=\"https://hackage.haskell.org/package/hint-0.6.0/docs/Language-Haskell-Interpreter.html#v:typeChecks\" rel=\"nofollow noreferrer\">hackage.haskell.org/package/hint-0.6.0/docs/&hellip;</a>"}, {"owner": {"reputation": 1589, "user_id": 2535671, "user_type": "registered", "accept_rate": 87, "profile_image": "https://www.gravatar.com/avatar/fca1ba52e0c41803e676d449ef242e75?s=128&d=identicon&r=PG&f=1", "display_name": "Julian Leviston", "link": "https://stackoverflow.com/users/2535671/julian-leviston"}, "reply_to_user": {"reputation": 37219, "user_id": 1523776, "user_type": "moderator", "accept_rate": 87, "profile_image": "https://www.gravatar.com/avatar/b3e0b5c8e42a8c38009ef2d969f8dabb?s=128&d=identicon&r=PG", "display_name": "Benjamin Hodgson", "link": "https://stackoverflow.com/users/1523776/benjamin-hodgson"}, "edited": false, "score": 0, "creation_date": 1493560779, "post_id": 43705579, "comment_id": 74458495, "body": "Legendary! Not sure how I missed this. Thank you... I have <code>funs = map unwrapFun . filter isFun $ exports</code> and then <code>typeCheckFuns &lt;- filterM typeChecks (fmap (++ &quot; theList1&quot;) funs)</code> and that works great. Put your answer there, and I&#39;ll accept it."}, {"owner": {"reputation": 1589, "user_id": 2535671, "user_type": "registered", "accept_rate": 87, "profile_image": "https://www.gravatar.com/avatar/fca1ba52e0c41803e676d449ef242e75?s=128&d=identicon&r=PG&f=1", "display_name": "Julian Leviston", "link": "https://stackoverflow.com/users/2535671/julian-leviston"}, "reply_to_user": {"reputation": 37219, "user_id": 1523776, "user_type": "moderator", "accept_rate": 87, "profile_image": "https://www.gravatar.com/avatar/b3e0b5c8e42a8c38009ef2d969f8dabb?s=128&d=identicon&r=PG", "display_name": "Benjamin Hodgson", "link": "https://stackoverflow.com/users/1523776/benjamin-hodgson"}, "edited": false, "score": 0, "creation_date": 1493561093, "post_id": 43705579, "comment_id": 74458601, "body": "I <i>was</i> kind of hoping there might be a better way, but I guess not."}, {"owner": {"reputation": 37219, "user_id": 1523776, "user_type": "moderator", "accept_rate": 87, "profile_image": "https://www.gravatar.com/avatar/b3e0b5c8e42a8c38009ef2d969f8dabb?s=128&d=identicon&r=PG", "display_name": "Benjamin Hodgson", "link": "https://stackoverflow.com/users/1523776/benjamin-hodgson"}, "edited": false, "score": 0, "creation_date": 1493593015, "post_id": 43705579, "comment_id": 74468355, "body": "I wrote it up as an answer. (There&#39;s a handy trick when you want to filter a list for values which match a constructor, which is to put the pattern in a list comprehension&#39;s binder, as I have done with <code>Fun</code> in the second line of the function&#39;s body.)"}, {"owner": {"reputation": 1589, "user_id": 2535671, "user_type": "registered", "accept_rate": 87, "profile_image": "https://www.gravatar.com/avatar/fca1ba52e0c41803e676d449ef242e75?s=128&d=identicon&r=PG&f=1", "display_name": "Julian Leviston", "link": "https://stackoverflow.com/users/2535671/julian-leviston"}, "reply_to_user": {"reputation": 37219, "user_id": 1523776, "user_type": "moderator", "accept_rate": 87, "profile_image": "https://www.gravatar.com/avatar/b3e0b5c8e42a8c38009ef2d969f8dabb?s=128&d=identicon&r=PG", "display_name": "Benjamin Hodgson", "link": "https://stackoverflow.com/users/1523776/benjamin-hodgson"}, "edited": false, "score": 0, "creation_date": 1493645078, "post_id": 43705579, "comment_id": 74482986, "body": "Yeah, the List monad do notation works like that, too. <code>do { Just z &lt;- [Just 1, Just 2, Nothing, Just 5]; return z }</code>"}], "answers": [{"comments": [{"owner": {"reputation": 1589, "user_id": 2535671, "user_type": "registered", "accept_rate": 87, "profile_image": "https://www.gravatar.com/avatar/fca1ba52e0c41803e676d449ef242e75?s=128&d=identicon&r=PG&f=1", "display_name": "Julian Leviston", "link": "https://stackoverflow.com/users/2535671/julian-leviston"}, "edited": false, "score": 0, "creation_date": 1493644849, "post_id": 43712186, "comment_id": 74482871, "body": "I didn&#39;t try this whole example specifically, but <code>typeChecks</code> works for what I was after (at least it&#39;s one way to do it). I was hoping there might be a nicer / better way to do this, but I guess not."}, {"owner": {"reputation": 1589, "user_id": 2535671, "user_type": "registered", "accept_rate": 87, "profile_image": "https://www.gravatar.com/avatar/fca1ba52e0c41803e676d449ef242e75?s=128&d=identicon&r=PG&f=1", "display_name": "Julian Leviston", "link": "https://stackoverflow.com/users/2535671/julian-leviston"}, "edited": false, "score": 0, "creation_date": 1493645399, "post_id": 43712186, "comment_id": 74483158, "body": "I&#39;d prefer a more dynamic style. I&#39;d prefer not to have to typecheck them all if possible. Just like I <i>could</i> typecheck an expression with an Integer against a function that takes Integers to find out its first argument type, or I could check the type explicitly and see if it matches, but Haskell isn&#39;t <i>quite</i> dependently typed yet, and doesn&#39;t seem to offer these kinds of functionalities."}, {"owner": {"reputation": 37219, "user_id": 1523776, "user_type": "moderator", "accept_rate": 87, "profile_image": "https://www.gravatar.com/avatar/b3e0b5c8e42a8c38009ef2d969f8dabb?s=128&d=identicon&r=PG", "display_name": "Benjamin Hodgson", "link": "https://stackoverflow.com/users/1523776/benjamin-hodgson"}, "reply_to_user": {"reputation": 1589, "user_id": 2535671, "user_type": "registered", "accept_rate": 87, "profile_image": "https://www.gravatar.com/avatar/fca1ba52e0c41803e676d449ef242e75?s=128&d=identicon&r=PG&f=1", "display_name": "Julian Leviston", "link": "https://stackoverflow.com/users/2535671/julian-leviston"}, "edited": false, "score": 0, "creation_date": 1493645718, "post_id": 43712186, "comment_id": 74483335, "body": "If I understand you correctly, you want to look at the types of the functions in scope and see if their argument type matches the type of the expression? Rather than type check the whole application as I have done above? But HM systems do their type checking by unification, not by straightforward syntactic equality like most OO systems. If the input expression is, say, <code>&#39;q&#39;</code>, searching only for functions whose argument type is <code>Char</code> will exclude perfectly valid applications like <code>id &#39;q&#39;</code> because <code>id :: a -&gt; a</code>&#39;s parameter type (<code>a</code>) is not <code>Char</code>."}, {"owner": {"reputation": 1589, "user_id": 2535671, "user_type": "registered", "accept_rate": 87, "profile_image": "https://www.gravatar.com/avatar/fca1ba52e0c41803e676d449ef242e75?s=128&d=identicon&r=PG&f=1", "display_name": "Julian Leviston", "link": "https://stackoverflow.com/users/2535671/julian-leviston"}, "edited": false, "score": 0, "creation_date": 1493646150, "post_id": 43712186, "comment_id": 74483529, "body": "Yeah, I realise that. Sorry for the overly simple example \u2014 I was trying to make it easier to understand. What I&#39;m trying to say is that just like I can search a list for something that matches a set of values, if types were values, I would theoretically be able to search a list of string references to top level declarations which get reified and checked without leaving the expression space of the module said code is in. Maybe I&#39;m dreaming. :) But I&#39;ll see how I go with this."}], "tags": [], "owner": {"reputation": 37219, "user_id": 1523776, "user_type": "moderator", "accept_rate": 87, "profile_image": "https://www.gravatar.com/avatar/b3e0b5c8e42a8c38009ef2d969f8dabb?s=128&d=identicon&r=PG", "display_name": "Benjamin Hodgson", "link": "https://stackoverflow.com/users/1523776/benjamin-hodgson"}, "is_accepted": true, "score": 0, "last_activity_date": 1493592871, "creation_date": 1493592871, "answer_id": 43712186, "question_id": 43705579, "link": "https://stackoverflow.com/questions/43705579/how-can-i-find-out-which-functions-can-be-run-on-an-expression/43712186#43712186", "title": "How can I find out which functions can be run on an expression?", "body": "<p><a href=\"https://hackage.haskell.org/package/hint-0.6.0\" rel=\"nofollow noreferrer\">Hint</a> has a function called <a href=\"https://hackage.haskell.org/package/hint-0.6.0/docs/Language-Haskell-Interpreter.html#v:typeChecks\" rel=\"nofollow noreferrer\"><code>typeChecks :: MonadInterpreter m =&gt; String -&gt; m Bool</code></a>, which tells you whether the expression in the string is well typed in the interpreter's context.</p>\n\n<pre><code>fnsAccepting :: MonadInterpreter m =&gt; String -&gt; m [Id]\nfnsAccepting expr = do\n    moduleContents &lt;- getLoadedModules &gt;&gt;= traverse getModuleExports\n    let importedFns = [fn | exports &lt;- moduleContents, Fun fn &lt;- exports]\n    filterM (\\fn -&gt; typeChecks $ fn ++ \" \" ++ parens expr) importedFns\n</code></pre>\n"}], "owner": {"reputation": 1589, "user_id": 2535671, "user_type": "registered", "accept_rate": 87, "profile_image": "https://www.gravatar.com/avatar/fca1ba52e0c41803e676d449ef242e75?s=128&d=identicon&r=PG&f=1", "display_name": "Julian Leviston", "link": "https://stackoverflow.com/users/2535671/julian-leviston"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 101, "favorite_count": 0, "accepted_answer_id": 43712186, "answer_count": 1, "score": 2, "last_activity_date": 1493592871, "creation_date": 1493549422, "last_edit_date": 1493556210, "question_id": 43705579, "link": "https://stackoverflow.com/questions/43705579/how-can-i-find-out-which-functions-can-be-run-on-an-expression", "title": "How can I find out which functions can be run on an expression?", "body": "<p>I'd like to programmatically find out which functions in a module could possibly apply to a particular expression.</p>\n\n<p>Let's make this concrete.</p>\n\n<pre><code>{-# LANGUAGE TemplateHaskell #-}\nmodule Test where\n\n-- we'll import template-haskell from Lens\n-- so we can create prisms automatically for our 'AST'\nimport qualified Control.Lens.TH as LTH\n\n--- some 'AST' in a toy language\n\ndata CExp\n  = CLit Int -- a literal integer\n  | CAdd CExp CExp -- addition\n  | CMul CExp CExp -- multiplication\n  | CSub CExp CExp -- subtraction\n  deriving Show\n\n-- an eval for our AST\n\neval :: CExp -&gt; Int\neval exp =\n  case exp of\n    CLit i -&gt; i\n    CAdd e1 e2 -&gt;\n      eval e1 + eval e2\n    CMul e1 e2 -&gt;\n      eval e1 * eval e2\n    CSub e1 e2 -&gt;\n      eval e1 - eval e2\n\n-- a function to build a sum using add with our AST, from a list of Int values\n\nlistToSums :: [Int] -&gt; CExp\nlistToSums =\n  foldr CAdd (CLit 0) . fmap CLit\n\n-- here we make prisms for looking at particular values\n-- in the CExp AST\n\nLTH.makePrisms ''CExp\n\n-- let's have an expression:\ntheList1 :: CExp\ntheList1 = listToSums [1..38]\n</code></pre>\n\n<p>Now, at this point, I'd like a function that can give me a list of all the top level functions of a particular module (including this one) that are able to be applied to the expression <code>theList1</code>. This will include the prisms that were created with <code>makePrisms</code>.</p>\n\n<p>It would be fine if it uses the hint library's <code>Interpreter</code> monad. I've been experimenting with it a bit, and while I can get a list of all of the definitions at the top level of any module, and I can find the types of them, too (more or less), I'm a bit lost about how to pass an expression in as an argument to these functions then check if those expressions will typecheck.</p>\n\n<p>If I can do that, I can run filter across all of the functions in a module, which lets me find out which ones are applicable.</p>\n\n<p>Many thanks in advance.</p>\n"}, {"tags": ["windows", "haskell", "dll", "static-linking"], "owner": {"reputation": 3542, "user_id": 2984585, "user_type": "registered", "accept_rate": 71, "profile_image": "https://www.gravatar.com/avatar/d8b299670c2e1512831e7d2026a8d350?s=128&d=identicon&r=PG", "display_name": "ditoslav", "link": "https://stackoverflow.com/users/2984585/ditoslav"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 313, "favorite_count": 0, "answer_count": 0, "score": 1, "last_activity_date": 1493548213, "creation_date": 1493547644, "last_edit_date": 1493548213, "question_id": 43705354, "link": "https://stackoverflow.com/questions/43705354/ghc-exe-adddll-icuuc59-dll-win32-error-126-the-specified-module-could-not-b", "title": "ghc.EXE: addDLL: icuuc59.dll (Win32 error 126): The specified module could not be found", "body": "<p>So I've done this a year ago but I forgot what's the trick Googling didn't help.\nAs I understand it, the problem is that I need to statically link my dlls. \nI'm doing this on WINDOWS</p>\n\n<p>I did <code>stack install text-icu --extra-include-dirs=C:\\icu4c-59_1-Win64-MSVC2015\\include --extra-lib-dirs=C:\\icu4c-59_1-Win64-MSVC2015\\lib64</code></p>\n\n<p>and I tried putting the dll into my .stack-work\\install\\28cbf0ed\\bin folder but when I try stack build I get</p>\n\n<pre><code>ghc.EXE: unable to load package `text-icu-0.7.0.1'\nghc.EXE: addDLL: icuuc59.dll (Win32 error 126): The specified module could not be found.\nghc.EXE: Could not load `icuuc59.dll'. Reason: addDLL: could not load DLL\n</code></pre>\n\n<p>I suppose I should be putting the dlls somewhere else or something</p>\n"}, {"tags": ["haskell", "haskell-diagrams"], "answers": [{"tags": [], "owner": {"reputation": 479, "user_id": 5674394, "user_type": "registered", "accept_rate": 43, "profile_image": "https://www.gravatar.com/avatar/9c6d14746bc54c07138037510242d08c?s=128&d=identicon&r=PG", "display_name": "Joshua Meyers", "link": "https://stackoverflow.com/users/5674394/joshua-meyers"}, "is_accepted": false, "score": 1, "last_activity_date": 1493552433, "creation_date": 1493552433, "answer_id": 43705973, "question_id": 43704887, "link": "https://stackoverflow.com/questions/43704887/how-do-i-hide-the-doctype-declaration-for-svg-files-generated-by-diagrams/43705973#43705973", "title": "How do I hide the DOCTYPE declaration for svg files generated by diagrams?", "body": "<p>We can modify code copied from <a href=\"https://github.com/diagrams/diagrams-svg/pull/85\" rel=\"nofollow noreferrer\">here</a> to form a minimal case:</p>\n\n<pre><code>import Data.Text (empty)\nimport Diagrams.Prelude\nimport Diagrams.Backend.SVG\n\nsvgOpt :: Num n =&gt; Options SVG V2 n\nsvgOpt = SVGOptions {\n  _size = mkSizeSpec $ V2 (Just 400) Nothing,\n  _idPrefix = empty,\n  _svgDefinitions = Nothing,\n  _svgAttributes = [],\n  _generateDoctype = False\n}\n\ndiagram :: Diagram B\ndiagram = circle 1 # fc orange # lw ultraThick # lc blue # frame 0.2\n\nmain :: IO ()\nmain = renderPretty' \"opts.svg\" svgOpt diagram\n</code></pre>\n"}], "owner": {"reputation": 479, "user_id": 5674394, "user_type": "registered", "accept_rate": 43, "profile_image": "https://www.gravatar.com/avatar/9c6d14746bc54c07138037510242d08c?s=128&d=identicon&r=PG", "display_name": "Joshua Meyers", "link": "https://stackoverflow.com/users/5674394/joshua-meyers"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 45, "favorite_count": 0, "answer_count": 1, "score": 0, "last_activity_date": 1493552433, "creation_date": 1493544404, "question_id": 43704887, "link": "https://stackoverflow.com/questions/43704887/how-do-i-hide-the-doctype-declaration-for-svg-files-generated-by-diagrams", "title": "How do I hide the DOCTYPE declaration for svg files generated by diagrams?", "body": "<p>I see that <code>generateDoctype</code> exists in the diagrams module: <a href=\"http://projects.haskell.org/diagrams/haddock/diagrams-svg/Diagrams-Backend-SVG.html#v:generateDoctype\" rel=\"nofollow noreferrer\">http://projects.haskell.org/diagrams/haddock/diagrams-svg/Diagrams-Backend-SVG.html#v:generateDoctype</a></p>\n\n<p>How do I set this to <code>false</code>?  Right now I am generating my svg file with <code>mathWith</code>, as recommended in the documentation, and I'm not sure where to put anything about <code>generateDoctype</code>.</p>\n"}, {"tags": ["haskell"], "comments": [{"owner": {"reputation": 16685, "user_id": 2289509, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/F51FU.jpg?s=128&g=1", "display_name": "Elazar", "link": "https://stackoverflow.com/users/2289509/elazar"}, "edited": false, "score": 0, "creation_date": 1493536162, "post_id": 43703889, "comment_id": 74452415, "body": "When you say &quot;delete&quot;, do you mean <code>filter</code>?"}, {"owner": {"reputation": 1, "user_id": 7900854, "user_type": "registered", "profile_image": "https://graph.facebook.com/1893746254170638/picture?type=large", "display_name": "Ada", "link": "https://stackoverflow.com/users/7900854/ada"}, "reply_to_user": {"reputation": 16685, "user_id": 2289509, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/F51FU.jpg?s=128&g=1", "display_name": "Elazar", "link": "https://stackoverflow.com/users/2289509/elazar"}, "edited": false, "score": 0, "creation_date": 1493536302, "post_id": 43703889, "comment_id": 74452442, "body": "It means that if db1 = [&quot;David&quot;,&quot;worksfor.isa&quot;, &quot;IBM&quot; ] db2 =[&quot;David&quot;,&quot;isa&#39;.worksfor&#39;&quot;, &quot;IBM&quot;] ,we only use &quot;worksfor.isa&quot; and concatenate db1 and db2 get together as db =[&quot;David&quot;,&quot;worksfor.isa&quot;, &quot;IBM&quot; ]"}, {"owner": {"reputation": 16685, "user_id": 2289509, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/F51FU.jpg?s=128&g=1", "display_name": "Elazar", "link": "https://stackoverflow.com/users/2289509/elazar"}, "edited": false, "score": 2, "creation_date": 1493536458, "post_id": 43703889, "comment_id": 74452481, "body": "I am sorry, it&#39;s difficult for me to understand your question. Can you add more examples? What are you trying to accomplish?"}, {"owner": {"reputation": 1, "user_id": 7900854, "user_type": "registered", "profile_image": "https://graph.facebook.com/1893746254170638/picture?type=large", "display_name": "Ada", "link": "https://stackoverflow.com/users/7900854/ada"}, "reply_to_user": {"reputation": 16685, "user_id": 2289509, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/F51FU.jpg?s=128&g=1", "display_name": "Elazar", "link": "https://stackoverflow.com/users/2289509/elazar"}, "edited": false, "score": 0, "creation_date": 1493537044, "post_id": 43703889, "comment_id": 74452601, "body": "Thank you so much. I there are two db. ,db1 = [&quot;David&quot;,&quot;worksfor.isa&quot;, &quot;IBM&quot; ]   db2 =[&quot;David&quot;,&quot;isa&#39;.worksfor&#39;&quot;, &quot;IBM&quot;]. the program can be known that  &quot;isa&#39;.worksfor&#39; and &quot;worksfor.isa&quot; is the same function. And then use &quot;Concat&quot; to get the new db  :db =[&quot;David&quot;,&quot;worksfor.isa&quot;, &quot;IBM&quot; ]"}, {"owner": {"reputation": 16685, "user_id": 2289509, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/F51FU.jpg?s=128&g=1", "display_name": "Elazar", "link": "https://stackoverflow.com/users/2289509/elazar"}, "edited": false, "score": 0, "creation_date": 1493537512, "post_id": 43703889, "comment_id": 74452689, "body": "Can you please give a different example?"}, {"owner": {"reputation": 240688, "user_id": 14955, "user_type": "registered", "accept_rate": 55, "profile_image": "https://i.stack.imgur.com/5DblQ.png?s=128&g=1", "display_name": "Thilo", "link": "https://stackoverflow.com/users/14955/thilo"}, "edited": false, "score": 0, "creation_date": 1493537904, "post_id": 43703889, "comment_id": 74452782, "body": "When you say &quot;function&quot; what exactly do you mean? Not a Haskell function, right? Because it looks like a String."}, {"owner": {"reputation": 1, "user_id": 7900854, "user_type": "registered", "profile_image": "https://graph.facebook.com/1893746254170638/picture?type=large", "display_name": "Ada", "link": "https://stackoverflow.com/users/7900854/ada"}, "edited": false, "score": 0, "creation_date": 1493538173, "post_id": 43703889, "comment_id": 74452849, "body": "I there are two db. ,db1 = [&quot;David&quot;,&quot;worksfor.isa&quot;, &quot;IBM&quot; ] db2 =[&quot;David&quot;,&quot;isa&#39;.worksfor&#39;&quot;, &quot;IBM&quot;]. db3 = [&quot;Tom&quot;,&quot;worksfor.isa&quot;, &quot;IBM&quot; ]the program can be known that &quot;isa&#39;.worksfor&#39; and &quot;worksfor.isa&quot; is the same String. And then use &quot;Concat&quot; to get the new db :db1 =[&quot;David&quot;,&quot;worksfor.isa&quot;, &quot;IBM&quot; ] and the others : db3 = [&quot;Tom&quot;,&quot;worksfor.isa&quot;, &quot;IBM&quot; ]."}, {"owner": {"reputation": 28488, "user_id": 402884, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35583fe46c2cde92467710cc7ceff266?s=128&d=identicon&r=PG", "display_name": "Chris Martin", "link": "https://stackoverflow.com/users/402884/chris-martin"}, "edited": false, "score": 0, "creation_date": 1493540023, "post_id": 43703889, "comment_id": 74453240, "body": "It is difficult to read code in comments; please edit the question instead."}, {"owner": {"reputation": 28488, "user_id": 402884, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35583fe46c2cde92467710cc7ceff266?s=128&d=identicon&r=PG", "display_name": "Chris Martin", "link": "https://stackoverflow.com/users/402884/chris-martin"}, "edited": false, "score": 2, "creation_date": 1493540224, "post_id": 43703889, "comment_id": 74453289, "body": "With Haskell it always helps to give us the <i>type</i> of the function you&#39;re trying to write."}, {"owner": {"reputation": 1, "user_id": 7900854, "user_type": "registered", "profile_image": "https://graph.facebook.com/1893746254170638/picture?type=large", "display_name": "Ada", "link": "https://stackoverflow.com/users/7900854/ada"}, "edited": false, "score": 0, "creation_date": 1493540657, "post_id": 43703889, "comment_id": 74453377, "body": "I you can give me a example? TKS"}, {"owner": {"reputation": 94553, "user_id": 775806, "user_type": "registered", "accept_rate": 96, "profile_image": "https://i.stack.imgur.com/XNd2C.png?s=128&g=1", "display_name": "n. &#39;pronouns&#39; m.", "link": "https://stackoverflow.com/users/775806/n-pronouns-m"}, "edited": false, "score": 0, "creation_date": 1493544709, "post_id": 43703889, "comment_id": 74454337, "body": "Please read <a href=\"https://stackoverflow.com/editing-help\">this</a> then use the <a href=\"https://stackoverflow.com/posts/43703889/edit\">edit</a> button to fix your formatting."}], "answers": [{"comments": [{"owner": {"reputation": 1589, "user_id": 2535671, "user_type": "registered", "accept_rate": 87, "profile_image": "https://www.gravatar.com/avatar/fca1ba52e0c41803e676d449ef242e75?s=128&d=identicon&r=PG&f=1", "display_name": "Julian Leviston", "link": "https://stackoverflow.com/users/2535671/julian-leviston"}, "edited": false, "score": 4, "creation_date": 1493549849, "post_id": 43704885, "comment_id": 74455609, "body": "Really nice answer @Elazar"}, {"owner": {"reputation": 1589, "user_id": 2535671, "user_type": "registered", "accept_rate": 87, "profile_image": "https://www.gravatar.com/avatar/fca1ba52e0c41803e676d449ef242e75?s=128&d=identicon&r=PG&f=1", "display_name": "Julian Leviston", "link": "https://stackoverflow.com/users/2535671/julian-leviston"}, "edited": false, "score": 0, "creation_date": 1493550635, "post_id": 43704885, "comment_id": 74455817, "body": "Could you please accept the answer if it is correct, ada?"}, {"owner": {"reputation": 1, "user_id": 7900854, "user_type": "registered", "profile_image": "https://graph.facebook.com/1893746254170638/picture?type=large", "display_name": "Ada", "link": "https://stackoverflow.com/users/7900854/ada"}, "edited": false, "score": 0, "creation_date": 1493556646, "post_id": 43704885, "comment_id": 74457376, "body": "Thank you so much. However,I will continue to think about it."}, {"owner": {"reputation": 1, "user_id": 7900854, "user_type": "registered", "profile_image": "https://graph.facebook.com/1893746254170638/picture?type=large", "display_name": "Ada", "link": "https://stackoverflow.com/users/7900854/ada"}, "edited": false, "score": 0, "creation_date": 1493570626, "post_id": 43704885, "comment_id": 74461580, "body": "I have wanted the same function as you say."}], "tags": [], "owner": {"reputation": 16685, "user_id": 2289509, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/F51FU.jpg?s=128&g=1", "display_name": "Elazar", "link": "https://stackoverflow.com/users/2289509/elazar"}, "is_accepted": false, "score": 6, "last_activity_date": 1493638308, "last_edit_date": 1493638308, "creation_date": 1493544389, "answer_id": 43704885, "question_id": 43703889, "link": "https://stackoverflow.com/questions/43703889/haskell-how-to-delete-the-same-function-and-concatenate-two-lists/43704885#43704885", "title": "Haskell: How to delete the same function and concatenate two lists", "body": "<p>This should be a comment, but it is far too long:</p>\n\n<p>I assume you find it hard to express yourself in English. I can relate to that; I find it hard myself. However, beyond English there are two other ways to communicate here: </p>\n\n<ol>\n<li>Using precise technical terms.</li>\n<li>Using several, diverse examples. A single example will not suffice, and several examples which are too similar give little information.</li>\n</ol>\n\n<p>As for option 1, you are using the wrong terminology. It is not easy for me to see how can a list with 3 items can be considered a database (as hinted by the names <code>db1</code>, <code>db2</code>). Perhaps you wanted to use a list of triples?</p>\n\n<pre><code>[ (\"David\",\"isa'.worksfor'\", \"IBM\") ]\n</code></pre>\n\n<p>You are not specific about what exactly do you want to concatenate, but the term <code>concatenation</code> <em>always</em> refers to an operation that must be \"additive\", i.e. <code>length(x ++ y) == length(x) ++ length(y)</code>. This does not seem to be the case in your question.</p>\n\n<p>Do you want a <em>union</em> of two databases (lists of triples) up to equivalence?</p>\n\n<p>You want the program to understand that </p>\n\n<blockquote>\n  <p>\"isa'.worksfor'\" and \"worksfor.isa\" are the same string</p>\n</blockquote>\n\n<p>But they are not. They might be <em>equivalent</em> strings. You can generally do that using a map operation, like you tried, but you should note that the character <code>'</code> is not an operation over strings. So <code>a b == b' a'</code> does nothing close to what you want - it calls the function <code>a</code> on the variable <code>b</code>, and compares this with calling the <em>function</em> <code>b'</code> over the variable <code>a'</code>. I can only assume you want something like \"split the string, if there are <code>'</code> characters, reverse it, then remove <code>'</code> characters and check for equivalence\" but this is completely a guesswork.</p>\n\n<p>To conclude:</p>\n\n<ol>\n<li>Please explain in detail what is the general problem you are trying to solve. Try to find the precise terms; it is difficult, but this way you can learn.</li>\n<li>Please add different examples of input and output</li>\n<li>Please try to explain what have you tried and where are you stuck</li>\n</ol>\n\n<p>As a last tip, maybe you want to solve this problem in a more forgiving language than Haskell (such as JavaScript, Python, Ruby, etc.)</p>\n"}], "owner": {"reputation": 1, "user_id": 7900854, "user_type": "registered", "profile_image": "https://graph.facebook.com/1893746254170638/picture?type=large", "display_name": "Ada", "link": "https://stackoverflow.com/users/7900854/ada"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 122, "favorite_count": 0, "answer_count": 1, "score": -3, "last_activity_date": 1493638308, "creation_date": 1493535999, "last_edit_date": 1493570601, "question_id": 43703889, "link": "https://stackoverflow.com/questions/43703889/haskell-how-to-delete-the-same-function-and-concatenate-two-lists", "title": "Haskell: How to delete the same function and concatenate two lists", "body": "<p>I am the beginner of haskell. I want to delete some same functions in the same list and concatenate the two list get together.\nFor example:</p>\n\n<pre><code>db1 = [\"David\",\"worksfor.isa\", \"IBM\" ] \ndb2 = [\"David\",\"isa'.worksfor'\", \"IBM\"] \ndb3 = [\"Tom\",\"worksfor.isa\", \"IBM\" ]\n</code></pre>\n\n<p>the program can be known that \"isa'.worksfor' and \"worksfor.isa\" is the same String. And then use \"Concat\" to get the new <code>db</code>: <code>db1 =[\"David\",\"worksfor.isa\", \"IBM\" ]</code> and the others: <code>db3 = [\"Tom\",\"worksfor.isa\", \"IBM\" ]</code> </p>\n\n<pre><code>(map (\\(a,b,c) -&gt; concat (map(\\(a',b',c') -&gt; if ( a b == b' a')  then [] else [(a,b ++ \".\" ++ b',c')]))))  ??????\n</code></pre>\n\n<p>I want to \"split the string, if there are ' characters, reverse it, then remove ' characters and check for equivalence\"</p>\n"}, {"tags": ["haskell"], "comments": [{"owner": {"reputation": 2019, "user_id": 5800895, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/0cab3b0361b7e54267c70c02754f21de?s=128&d=identicon&r=PG&f=1", "display_name": "Derek Elkins left SE", "link": "https://stackoverflow.com/users/5800895/derek-elkins-left-se"}, "edited": false, "score": 0, "creation_date": 1493542950, "post_id": 43702067, "comment_id": 74453966, "body": "To answer one aspect of your question, the most direct analog of symbols would be nullary data constructors of an enumeration type (i.e. an algebraic data type consisting of only nullary data constructors). Obviously, the issue with this is that it is not extensible. You can mix these with something like <code>data Var = A | B | C | ... | Y | Z | Custom String</code> This can sometimes provide nice syntax. I do recommend abstracting away from the issue a la luqui&#39;s answer."}], "answers": [{"tags": [], "owner": {"reputation": 57219, "user_id": 33796, "user_type": "registered", "accept_rate": 70, "profile_image": "https://www.gravatar.com/avatar/08727b23ba62e634b32988cdff082663?s=128&d=identicon&r=PG", "display_name": "luqui", "link": "https://stackoverflow.com/users/33796/luqui"}, "is_accepted": true, "score": 7, "last_activity_date": 1493517268, "last_edit_date": 1493517268, "creation_date": 1493516564, "answer_id": 43702111, "question_id": 43702067, "link": "https://stackoverflow.com/questions/43702067/nearest-equivalent-to-prolog-atom-or-lisp-symbol-in-haskell/43702111#43702111", "title": "Nearest equivalent to Prolog atom or Lisp symbol in Haskell", "body": "<p>Typically the way this is done in Haskell is by parameterizing over the type of symbols.  So your example would become:</p>\n\n<pre><code>data Proposition a = \n    Primitive a |\n    Negated (Proposition a) |\n    Implication (Proposition a) (Proposition a)\n</code></pre>\n\n<p>which then leaves it up to the user to decide the best representation their symbols.  This has advantages over LISP-like symbols: symbols intended for different purposes will not be mixed up, and data structures involving symbols now admit transformations over all the symbols, which are more useful than you realize.  For example, <code>Functor</code> changes between symbol representations, and <code>Monad</code> models substitution.</p>\n\n<pre><code>(=&lt;&lt;) :: (a        -&gt;      Proposition b)      -&gt; Proposition a -&gt; Proposition b\n          ^                ^^^^^^^^^^^^^          ^^^^^^^^^^^^^        \nsubstitute each free var   with an expression   in this expression\n</code></pre>\n\n<p>You can get a form of type-safe openness too:</p>\n\n<pre><code>implyOpen :: Proposition a -&gt; Proposition b -&gt; Proposition (Either a b)\nimplyOpen p q = Implication (Left &lt;$&gt; p) (Right &lt;$&gt; q)\n</code></pre>\n\n<p>Another fun trick is using a non-regular recursive type to model variable bindings in a type-safe way.</p>\n\n<pre><code>data Proposition a = \n    ... |\n    ForAll (Proposition (Maybe a))\n</code></pre>\n\n<p>Here we have added one \"free variable\" to the inner proposition -- <code>Primitive Nothing</code> is the variable being quantified over.  It may seem awkward at first, but when you get to coding it's bomb, because the types make it very hard to get it wrong.</p>\n\n<p><a href=\"http://hackage.haskell.org/package/bound\" rel=\"noreferrer\">bound</a> is an excellent package for modelling expression languages based on this idea (and a few other tricks).</p>\n"}], "owner": {"reputation": 5900, "user_id": 931154, "user_type": "registered", "accept_rate": 97, "profile_image": "https://i.stack.imgur.com/bTrZd.jpg?s=128&g=1", "display_name": "Gregory Nisbet", "link": "https://stackoverflow.com/users/931154/gregory-nisbet"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 154, "favorite_count": 1, "accepted_answer_id": 43702111, "answer_count": 1, "score": 4, "last_activity_date": 1493517268, "creation_date": 1493515921, "question_id": 43702067, "link": "https://stackoverflow.com/questions/43702067/nearest-equivalent-to-prolog-atom-or-lisp-symbol-in-haskell", "title": "Nearest equivalent to Prolog atom or Lisp symbol in Haskell", "body": "<p>I'm trying to write a simple program for manipulating expressions in propositional calculus and would like a nice syntax for proposition variables (e.g. <code>'P</code> or something).</p>\n\n<p>Strings get the job done, but the syntax is misleading in this context and they permit inappropriate operations like <code>++</code>.</p>\n\n<p>Syntactically, I'd like to be able to write down something that does not \"look quoted\" visually (something like <code>'P</code> is okay, though). In terms of the supported operations, I'd like to be able to determine whether two symbols are equal and to convert them into a string matching their name via <code>show</code>. I'd also like these things to be open (ADTs with only nullary constructors are similar in principle to symbols, but require all variants to be declared in advance).</p>\n\n<p>Here's a toy example using strings where something symbol-like would be more appropriate.</p>\n\n<pre><code>type Var = String\n\ndata Proposition =\n    Primitive Var |\n    Negated Proposition |\n    Implication Proposition Proposition\n\ninstance Show Proposition where\n    show (Primitive p) = p\n    show (Negated n) = \"!\" ++ show n\n    show (Implication ant cons) = \n        \"(\" ++ show ant ++ \"-&gt;\" ++ show cons ++ \")\"\n\nmain = putStrLn $ show $ Implication (Primitive \"A\") (Primitive \"B\")\n</code></pre>\n"}, {"tags": ["haskell", "hxt"], "answers": [{"tags": [], "owner": {"reputation": 8861, "user_id": 148260, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/567454e026a83d9ef6218474a720be7e?s=128&d=identicon&r=PG", "display_name": "Steve Trout", "link": "https://stackoverflow.com/users/148260/steve-trout"}, "is_accepted": true, "score": 2, "last_activity_date": 1493671983, "last_edit_date": 1493671983, "creation_date": 1493671433, "answer_id": 43726253, "question_id": 43700865, "link": "https://stackoverflow.com/questions/43700865/haskells-hxt-fails-if-i-add-another-line-a-function/43726253#43726253", "title": "Haskell&#39;s hxt fails if I add another line a function", "body": "<p><strong>TL;DR:</strong> if you're looking for two separate child elements, use separate calls to <code>getChildren</code>.</p>\n\n<p>Your variable <code>sources</code> doesn't represent the list of all source elements. Instead it's a <em>single</em> source. If you check the type of <code>sources</code>, you'll see it's <code>XMLTree</code>. So when you use <code>hasAttrValue</code> on it twice, you're looking for a single source element that matches both cases.</p>\n\n<p>As for why it doesn't matter what you return: each line is executed even if its value isn't used. In fact unless you're using the output, you don't even have to assign it a name: a line of only <code>hasAttrValue \"id\" (isSuffixOf \"-normals\") &lt;- sources</code> (removing <code>normalSource &lt;-</code>) works just the same. So if you return <code>x</code>, it still returns <code>x</code> only when it can find that impossible source element.</p>\n\n<p>You can get your code to find both separate source elements by doing separate two calls to <code>getChildren</code> -- one per separate element you're looking for -- and checking the \"id\" attribute of each one separately.</p>\n\n<hr>\n\n<p>Here's a self-contained example if the above is unclear.</p>\n\n<pre><code>data Tree a = Tree a [Tree a]\n\nexampleTree :: Tree String\nexampleTree = Tree \"root\" [Tree \"childA\" [], Tree \"childB\" []]\n\nnewtype ListArrow a b = ListArrow { runListArrow :: a -&gt; [b] }\n\ninstance Category ListArrow where\n    id = ListArrow (\\x -&gt; [x])\n    (ListArrow g) . (ListArrow f) = ListArrow (\\x -&gt; concatMap g (f x))\n\ninstance Arrow ListArrow where\n    arr f = ListArrow (\\x -&gt; [f x])\n    first (ListArrow f) = ListArrow (\\(a, b) -&gt; [ (a', b) | a' &lt;- f a ])\n\ngetChildren :: ListArrow (Tree a) (Tree a)\ngetChildren = ListArrow gc where\n    gc (Tree _ children) = children\n\nhasContent :: Eq a =&gt; a -&gt; ListArrow (Tree a) (Tree a)\nhasContent content = ListArrow hc where\n    hc cur@(Tree c _) = if content == c then [cur] else []\n\ngetContent :: ListArrow (Tree a) a\ngetContent = ListArrow gc where\n    gc (Tree c _) = [c]\n\n-- this has the same problem as the code in the question\nfindBothChildrenBad :: ListArrow (Tree String) (String, String)\nfindBothChildrenBad = proc root -&gt; do\n    -- child is a (single) child of the root\n    child &lt;- getChildren -&lt; root\n\n    -- childA == child, and filter to only cases where its content is \"childA\"\n    childA &lt;- hasContent \"childA\" -&lt; child\n\n    -- childB == child, and filter to only cases where its content is \"childB\"\n    childB &lt;- hasContent \"childB\" -&lt; child\n    -- now the content has to be both \"childA\" and \"childB\" -- so we're stuck\n\n    childAContent &lt;- getContent -&lt; childA\n    childBContent &lt;- getContent -&lt; childB\n    returnA -&lt; (childAContent, childBContent)\n\n-- this is the fixed version\nfindBothChildren :: ListArrow (Tree String) (String, String)\nfindBothChildren = proc root -&gt; do\n    -- childA is a (single) child of the root\n    childA &lt;- getChildren -&lt; root\n\n    -- filter to only cases where its content is \"childA\"\n    hasContent \"childA\" -&lt; childA\n\n    -- childB is a (potentially different) child of the root\n    childB &lt;- getChildren -&lt; root\n\n    -- filter to only cases where its content is \"childB\"\n    hasContent \"childB\" -&lt; childB\n    -- we're not stuck here\n\n    childAContent &lt;- getContent -&lt; childA\n    childBContent &lt;- getContent -&lt; childB\n    returnA -&lt; (childAContent, childBContent)\n</code></pre>\n"}], "owner": {"reputation": 347, "user_id": 7552087, "user_type": "registered", "accept_rate": 80, "profile_image": "https://www.gravatar.com/avatar/012e376f941c38969adccc532ec3be94?s=128&d=identicon&r=PG&f=1", "display_name": "Andrew P.", "link": "https://stackoverflow.com/users/7552087/andrew-p"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 45, "favorite_count": 0, "accepted_answer_id": 43726253, "answer_count": 1, "score": 1, "last_activity_date": 1493671983, "creation_date": 1493503115, "question_id": 43700865, "link": "https://stackoverflow.com/questions/43700865/haskells-hxt-fails-if-i-add-another-line-a-function", "title": "Haskell&#39;s hxt fails if I add another line a function", "body": "<p>I am trying to parse a COLLADA file with Haskell's hxt package.</p>\n\n<p>I have been doing fine, but I have run into an odd bug (or more likely, an error on my part).</p>\n\n<p>I have an arrow that looks like this:</p>\n\n<pre><code>processGeometry = proc x -&gt; do\n    geometry &lt;- atTag \"geometry\" -&lt; x\n    meshID &lt;- getAttrValue \"id\" -&lt; geometry\n    meshName &lt;- getAttrValue \"name\" -&lt; geometry\n    mesh &lt;- atTag \"mesh\" -&lt; geometry\n    sources &lt;- hasName \"source\" &lt;&lt;&lt; getChildren -&lt; mesh\n    positionSource &lt;- hasAttrValue \"id\" (\"-positions\" `isSuffixOf`) -&lt; sources\n    positionArray  &lt;- processFloatSource -&lt; positionSource\n    returnA -&lt; positionArray\n</code></pre>\n\n<p>Adding the line</p>\n\n<pre><code>normalSource &lt;- hasAttrValue \"id\" (\"-normals\" `isSuffixOf`) -&lt; sources\n</code></pre>\n\n<p>near the bottom, however, makes the entire arrow fail.</p>\n\n<p>This happens no matter what I return, even if I am returning the original <code>x</code>.</p>\n\n<p>Here is my <code>atTag</code> function:</p>\n\n<pre><code>atTag tag = deep (isElem &gt;&gt;&gt; hasName tag)\n</code></pre>\n\n<p>And here is my sample COLLADA file I am trying to parse:\n<a href=\"https://pastebin.com/mDSTH2TW\" rel=\"nofollow noreferrer\">https://pastebin.com/mDSTH2TW</a></p>\n\n<p>Why does adding a line change the outcome of the arrow completely, when it shouldn't do anything at all?</p>\n"}, {"tags": ["haskell", "monads", "quickcheck", "repa"], "answers": [{"comments": [{"owner": {"reputation": 615, "user_id": 4176597, "user_type": "registered", "accept_rate": 50, "profile_image": "https://www.gravatar.com/avatar/4f118d3068ac55ffc44752d308d50ee7?s=128&d=identicon&r=PG&f=1", "display_name": "ethanabrooks", "link": "https://stackoverflow.com/users/4176597/ethanabrooks"}, "edited": false, "score": 0, "creation_date": 1493520524, "post_id": 43700939, "comment_id": 74449660, "body": "Thank you for the response! I would not have figured that out on my own. Is there a way to do this with <code>quickCheckAll</code> i.e.: <code>runTests = $quickCheckAll $ forAll (scale (+1) arbitrary)</code>?"}, {"owner": {"reputation": 24509, "user_id": 6863749, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/UyoQv.jpg?s=128&g=1", "display_name": "Li-yao Xia", "link": "https://stackoverflow.com/users/6863749/li-yao-xia"}, "reply_to_user": {"reputation": 615, "user_id": 4176597, "user_type": "registered", "accept_rate": 50, "profile_image": "https://www.gravatar.com/avatar/4f118d3068ac55ffc44752d308d50ee7?s=128&d=identicon&r=PG&f=1", "display_name": "ethanabrooks", "link": "https://stackoverflow.com/users/4176597/ethanabrooks"}, "edited": false, "score": 0, "creation_date": 1493521519, "post_id": 43700939, "comment_id": 74449826, "body": "Unfortunately not. There isn&#39;t such a fine-grained way to tweak the generators used by QuickCheck. To avoid having to mangle all of your generators, you have to override repa&#39;s <code>Arbitrary</code> instances. Their root module imports the <code>Arbitrary</code> instances and it seems hard to avoid since it&#39;s the one exporting the <code>Array</code> type. However, properties are monomorphic, so you can take advantage of the fact that existing <code>Arbitrary</code> instances are parametric, and implement a <code>Arbitrary (Array U sh Double)</code> for example in your test module with <code>{-# OVERLAPPING #-}</code>, fixing repa&#39;s generic instance."}, {"owner": {"reputation": 615, "user_id": 4176597, "user_type": "registered", "accept_rate": 50, "profile_image": "https://www.gravatar.com/avatar/4f118d3068ac55ffc44752d308d50ee7?s=128&d=identicon&r=PG&f=1", "display_name": "ethanabrooks", "link": "https://stackoverflow.com/users/4176597/ethanabrooks"}, "edited": false, "score": 0, "creation_date": 1493522678, "post_id": 43700939, "comment_id": 74449968, "body": "Will do! Thanks."}, {"owner": {"reputation": 615, "user_id": 4176597, "user_type": "registered", "accept_rate": 50, "profile_image": "https://www.gravatar.com/avatar/4f118d3068ac55ffc44752d308d50ee7?s=128&d=identicon&r=PG&f=1", "display_name": "ethanabrooks", "link": "https://stackoverflow.com/users/4176597/ethanabrooks"}, "edited": false, "score": 0, "creation_date": 1493575365, "post_id": 43700939, "comment_id": 74463085, "body": "First, I should say that your first suggestion worked. However, the following code did not (threw same error as before):      <code>instance {-# OVERLAPPING  #-} T.Arbitrary (Array U DIM1 Double)          where arbitrary = T.scale (+1) $ T.arbitrary &gt;&gt;= A.arbitraryUShaped</code>"}, {"owner": {"reputation": 24509, "user_id": 6863749, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/UyoQv.jpg?s=128&g=1", "display_name": "Li-yao Xia", "link": "https://stackoverflow.com/users/6863749/li-yao-xia"}, "reply_to_user": {"reputation": 615, "user_id": 4176597, "user_type": "registered", "accept_rate": 50, "profile_image": "https://www.gravatar.com/avatar/4f118d3068ac55ffc44752d308d50ee7?s=128&d=identicon&r=PG&f=1", "display_name": "ethanabrooks", "link": "https://stackoverflow.com/users/4176597/ethanabrooks"}, "edited": false, "score": 0, "creation_date": 1493585989, "post_id": 43700939, "comment_id": 74466507, "body": "Your property above is using <code>DIM2</code>, so this instance is not being selected."}], "tags": [], "owner": {"reputation": 24509, "user_id": 6863749, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/UyoQv.jpg?s=128&g=1", "display_name": "Li-yao Xia", "link": "https://stackoverflow.com/users/6863749/li-yao-xia"}, "is_accepted": true, "score": 2, "last_activity_date": 1493504784, "last_edit_date": 1493504784, "creation_date": 1493503799, "answer_id": 43700939, "question_id": 43700391, "link": "https://stackoverflow.com/questions/43700391/monadic-quickcheck-test-not-working-for-arbitrary-repa-array/43700939#43700939", "title": "Monadic QuickCheck test not working for arbitrary Repa array", "body": "<p>This is a bug in repa's <code>Arbitrary</code> instance. <code>arbitrary</code> crashes at size 0. You can fix the generator used by your property in the mean time:</p>\n\n<pre><code>quickCheck $ forAll (scale (+1) arbitrary) prop_id\n</code></pre>\n"}], "owner": {"reputation": 615, "user_id": 4176597, "user_type": "registered", "accept_rate": 50, "profile_image": "https://www.gravatar.com/avatar/4f118d3068ac55ffc44752d308d50ee7?s=128&d=identicon&r=PG&f=1", "display_name": "ethanabrooks", "link": "https://stackoverflow.com/users/4176597/ethanabrooks"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 60, "favorite_count": 0, "accepted_answer_id": 43700939, "answer_count": 1, "score": 2, "last_activity_date": 1493504784, "creation_date": 1493499388, "last_edit_date": 1493499426, "question_id": 43700391, "link": "https://stackoverflow.com/questions/43700391/monadic-quickcheck-test-not-working-for-arbitrary-repa-array", "title": "Monadic QuickCheck test not working for arbitrary Repa array", "body": "<p>I am trying to write tests for arbitrary Repa Arrays in Haskell. For some reason, the following snippet:</p>\n\n<pre><code>import Test.QuickCheck\nimport Test.QuickCheck.Monadic\nimport Data.Array.Repa (Array, DIM2)\n\nprop_id :: Array U DIM2 Double -&gt; Property\nprop_id array = monadicIO $ array `R.equalsP` array &gt;&gt;= assert\n</code></pre>\n\n<p>throws this exception:</p>\n\n<pre><code>*** Failed! (after 1 test): \nException:\nTest.QuickCheck.resize: negative size\nCallStack (from HasCallStack):\n    error, called at ./Test/QuickCheck/Gen.hs:82:22 in QuickCheck-2.9.2-Jyj4gc4JxkEIgGFLAsGhs9:Test.QuickCheck.Gen\nException thrown while printing test case:\nTest.QuickCheck.resize: negative size\nCallStack (from HasCallStack):\n    error, called at ./Test/QuickCheck/Gen.hs:82:22 in QuickCheck-2.9.2-Jyj4gc4JxkEIgGFLAsGhs9:Test.QuickCheck.Gen\n</code></pre>\n\n<p>I'm not sure how to interpret this information. Thanks for your help.</p>\n"}, {"tags": ["haskell"], "comments": [{"owner": {"reputation": 40537, "user_id": 465378, "user_type": "registered", "accept_rate": 85, "profile_image": "https://www.gravatar.com/avatar/c03b8d34978563858020eff0d14cc17b?s=128&d=identicon&r=PG", "display_name": "Alexis King", "link": "https://stackoverflow.com/users/465378/alexis-king"}, "edited": false, "score": 1, "creation_date": 1493491286, "post_id": 43699207, "comment_id": 74443416, "body": "You probably want <code>Eq (m b)</code>, not <code>Eq m</code>. For what it\u2019s worth, though, I think you could just have GHC derive this class for you, and it would figure out the necessary constraints."}, {"owner": {"reputation": 12694, "user_id": 173292, "user_type": "registered", "accept_rate": 91, "profile_image": "https://www.gravatar.com/avatar/a3bf36af18c24c8b6c6922af1064bcfe?s=128&d=identicon&r=PG", "display_name": "Wilduck", "link": "https://stackoverflow.com/users/173292/wilduck"}, "reply_to_user": {"reputation": 40537, "user_id": 465378, "user_type": "registered", "accept_rate": 85, "profile_image": "https://www.gravatar.com/avatar/c03b8d34978563858020eff0d14cc17b?s=128&d=identicon&r=PG", "display_name": "Alexis King", "link": "https://stackoverflow.com/users/465378/alexis-king"}, "edited": false, "score": 0, "creation_date": 1493491483, "post_id": 43699207, "comment_id": 74443483, "body": "@AlexisKing That gives a different error <code>Variable &#39;b&#39; occurs more often in the constraint &#39;Eq (m b)&#39; than in the instance head</code>. Also, ghc will not derive this typeclass for me, I&#39;m not entirely sure why though."}, {"owner": {"reputation": 40537, "user_id": 465378, "user_type": "registered", "accept_rate": 85, "profile_image": "https://www.gravatar.com/avatar/c03b8d34978563858020eff0d14cc17b?s=128&d=identicon&r=PG", "display_name": "Alexis King", "link": "https://stackoverflow.com/users/465378/alexis-king"}, "edited": false, "score": 1, "creation_date": 1493491738, "post_id": 43699207, "comment_id": 74443580, "body": "You can turn on <code>StandaloneDeriving</code> and <code>UndecidableInstances</code> and write <code>deriving instance Eq (m (Either e a)) =&gt; Eq (EitherT e m a)</code>. Alternatively, you can write the instance you currently have, but replace all your constraints with <code>Eq (m (Either e a))</code>."}, {"owner": {"reputation": 12694, "user_id": 173292, "user_type": "registered", "accept_rate": 91, "profile_image": "https://www.gravatar.com/avatar/a3bf36af18c24c8b6c6922af1064bcfe?s=128&d=identicon&r=PG", "display_name": "Wilduck", "link": "https://stackoverflow.com/users/173292/wilduck"}, "reply_to_user": {"reputation": 40537, "user_id": 465378, "user_type": "registered", "accept_rate": 85, "profile_image": "https://www.gravatar.com/avatar/c03b8d34978563858020eff0d14cc17b?s=128&d=identicon&r=PG", "display_name": "Alexis King", "link": "https://stackoverflow.com/users/465378/alexis-king"}, "edited": false, "score": 0, "creation_date": 1493492254, "post_id": 43699207, "comment_id": 74443724, "body": "Thanks for the help @AlexisKing. I&#39;d like to try to write this <code>Eq</code> instance myself, if only to understand what&#39;s going on. However, using <code>Eq (m (Either e a))</code> in the typeclass constraint produces a warning and asks me to turn on <code>UndecidableInstances</code>. Is it really not possible to write this instance without UndecidableInstances? If so, why? I&#39;m going to edit my question to include this."}, {"owner": {"reputation": 23444, "user_id": 414413, "user_type": "registered", "accept_rate": 79, "profile_image": "https://www.gravatar.com/avatar/6de2113f01432aa844dc85070ff33e89?s=128&d=identicon&r=PG", "display_name": "Cirdec", "link": "https://stackoverflow.com/users/414413/cirdec"}, "edited": false, "score": 1, "creation_date": 1493493018, "post_id": 43699207, "comment_id": 74443972, "body": "<code>UndecidableInstances</code> is safe. It allows type class resolution to be recursive in non-total ways. The worst thing that happens is the <i>compiler</i>  gets stuck in a recursive loop. If the compiler terminates the resulting code is still safe. It&#39;s an extension because a compiler is expected to terminate."}], "answers": [{"comments": [{"owner": {"reputation": 40537, "user_id": 465378, "user_type": "registered", "accept_rate": 85, "profile_image": "https://www.gravatar.com/avatar/c03b8d34978563858020eff0d14cc17b?s=128&d=identicon&r=PG", "display_name": "Alexis King", "link": "https://stackoverflow.com/users/465378/alexis-king"}, "edited": false, "score": 2, "creation_date": 1493493152, "post_id": 43699463, "comment_id": 74444011, "body": "<code>Eq1</code> is only ever necessary if you want to write \u201cstandard\u201d Haskell, which I would never recommend. Haskell without extensions is not a very useful language."}, {"owner": {"reputation": 12694, "user_id": 173292, "user_type": "registered", "accept_rate": 91, "profile_image": "https://www.gravatar.com/avatar/a3bf36af18c24c8b6c6922af1064bcfe?s=128&d=identicon&r=PG", "display_name": "Wilduck", "link": "https://stackoverflow.com/users/173292/wilduck"}, "edited": false, "score": 1, "creation_date": 1493497728, "post_id": 43699463, "comment_id": 74445393, "body": "According to <a href=\"https://ghc.haskell.org/trac/ghc/ticket/11135\" rel=\"nofollow noreferrer\">ghc.haskell.org/trac/ghc/ticket/11135</a> , <code>Eq1</code> has been moved to base, and had its definition changed, see: <a href=\"https://hackage.haskell.org/package/base-4.9.1.0/docs/Data-Functor-Classes.html#t:Eq1\" rel=\"nofollow noreferrer\">hackage.haskell.org/package/base-4.9.1.0/docs/&hellip;</a> . The <code>Eq1</code> in <code>base</code> has minimal definition of <code>liftEq :: (a -&gt; b -&gt; Bool) -&gt; f a -&gt; f b -&gt; Bool</code>. I&#39;m finding it significantly harder to write an implementation of <code>liftEq</code> than for than <code>eq1</code>."}, {"owner": {"reputation": 23444, "user_id": 414413, "user_type": "registered", "accept_rate": 79, "profile_image": "https://www.gravatar.com/avatar/6de2113f01432aa844dc85070ff33e89?s=128&d=identicon&r=PG", "display_name": "Cirdec", "link": "https://stackoverflow.com/users/414413/cirdec"}, "reply_to_user": {"reputation": 12694, "user_id": 173292, "user_type": "registered", "accept_rate": 91, "profile_image": "https://www.gravatar.com/avatar/a3bf36af18c24c8b6c6922af1064bcfe?s=128&d=identicon&r=PG", "display_name": "Wilduck", "link": "https://stackoverflow.com/users/173292/wilduck"}, "edited": false, "score": 0, "creation_date": 1493498625, "post_id": 43699463, "comment_id": 74445628, "body": "@Wilduck That&#39;s a much better definition for <code>Eq1</code>, I&#39;ll update the answer."}, {"owner": {"reputation": 12694, "user_id": 173292, "user_type": "registered", "accept_rate": 91, "profile_image": "https://www.gravatar.com/avatar/a3bf36af18c24c8b6c6922af1064bcfe?s=128&d=identicon&r=PG", "display_name": "Wilduck", "link": "https://stackoverflow.com/users/173292/wilduck"}, "reply_to_user": {"reputation": 40537, "user_id": 465378, "user_type": "registered", "accept_rate": 85, "profile_image": "https://www.gravatar.com/avatar/c03b8d34978563858020eff0d14cc17b?s=128&d=identicon&r=PG", "display_name": "Alexis King", "link": "https://stackoverflow.com/users/465378/alexis-king"}, "edited": false, "score": 0, "creation_date": 1493501111, "post_id": 43699463, "comment_id": 74446243, "body": "I&#39;ve learned a lot today Cirdec and @AlexisKing. Thank you both!"}, {"owner": {"reputation": 12694, "user_id": 173292, "user_type": "registered", "accept_rate": 91, "profile_image": "https://www.gravatar.com/avatar/a3bf36af18c24c8b6c6922af1064bcfe?s=128&d=identicon&r=PG", "display_name": "Wilduck", "link": "https://stackoverflow.com/users/173292/wilduck"}, "edited": false, "score": 0, "creation_date": 1493501734, "post_id": 43699463, "comment_id": 74446400, "body": "Of note for the first definition is that <code>Either</code> already has an instance of <code>Eq1</code>: <code>Eq a =&gt; Eq1 (Either a)</code>, which allows the <code>liftEq (liftEq f)</code>."}], "tags": [], "owner": {"reputation": 23444, "user_id": 414413, "user_type": "registered", "accept_rate": 79, "profile_image": "https://www.gravatar.com/avatar/6de2113f01432aa844dc85070ff33e89?s=128&d=identicon&r=PG", "display_name": "Cirdec", "link": "https://stackoverflow.com/users/414413/cirdec"}, "is_accepted": true, "score": 6, "last_activity_date": 1493500048, "last_edit_date": 1493500048, "creation_date": 1493492665, "answer_id": 43699463, "question_id": 43699207, "link": "https://stackoverflow.com/questions/43699207/typeclass-constraints-with-higher-kinded-types/43699463#43699463", "title": "Typeclass constraints with higher kinded types", "body": "<p>You're looking for <code>Eq1</code> which is in <a href=\"https://hackage.haskell.org/package/base-4.9.1.0/docs/Data-Functor-Classes.html\" rel=\"noreferrer\"><code>Data.Functor.Classes</code></a> since base 4.9.0.0. Before that it was in one of the <code>-extras</code> packages or <code>transformers</code>? (it's <a href=\"https://hackage.haskell.org/package/transformers-0.4.0.0/docs/Data-Functor-Classes.html\" rel=\"noreferrer\">in transformers now since 0.4.0.0</a>)</p>\n\n<p><code>Eq1 f</code> says that you can compare <code>f</code>s as long as you have a way to compare their contents</p>\n\n<pre><code>class Eq1 f where\n    liftEq :: (a -&gt; b -&gt; Bool) -&gt; f a -&gt; f b -&gt; Bool\n</code></pre>\n\n<p>In your case you'd use it like</p>\n\n<pre><code>instance (Eq e, Eq1 m) =&gt; Eq1 (EitherT e m) where\n   liftEq f a b = liftEq (liftEq f) (runEitherT a) (runEitherT b)\n</code></pre>\n\n<p>The <code>liftEq f</code> is to use the existing <code>Eq1</code> instance for <code>Either</code>.</p>\n\n<p>And can define an <code>Eq</code> instance as</p>\n\n<pre><code>instance (Eq e, Eq a, Eq1 m) =&gt; Eq (EitherT e m a) where\n   (==) = liftEq (==)\n</code></pre>\n\n<hr>\n\n<p>The old <code>Eq1</code> was</p>\n\n<pre><code>class Eq1 f where\n    eq1 :: (Eq a) =&gt; f a -&gt; f a -&gt; Bool\n</code></pre>\n\n<p>In your case you'd use it like</p>\n\n<pre><code>instance (Eq e, Eq1 m) =&gt; Eq1 (EitherT e m) where\n   eq1 a b = eq1 (runEitherT a) (runEitherT b)\n\ninstance (Eq e, Eq a, Eq1 m) =&gt; Eq1 (EitherT e m) where\n   a == b = eq1 (runEitherT a) (runEitherT b)\n</code></pre>\n"}, {"tags": [], "owner": {"reputation": 34158, "user_id": 7203016, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/ybAMw.png?s=128&g=1", "display_name": "K. A. Buhr", "link": "https://stackoverflow.com/users/7203016/k-a-buhr"}, "is_accepted": false, "score": 2, "last_activity_date": 1493499907, "creation_date": 1493499907, "answer_id": 43700472, "question_id": 43699207, "link": "https://stackoverflow.com/questions/43699207/typeclass-constraints-with-higher-kinded-types/43700472#43700472", "title": "Typeclass constraints with higher kinded types", "body": "<p>It might be worth noting that this instance already exists in current versions of the <code>either</code> package (though not the old <code>EitherT</code> package, which is considered obsolete):</p>\n\n<pre><code>instance Eq (m (Either e a)) =&gt; Eq (EitherT e m a) where\n  (==) = (==) on runEitherT\n</code></pre>\n\n<p>Of course, as @Alexis King has noted, it requires <code>UndecidableInstances</code>, but the <code>either</code> package is authored by Edward Kmett, a notorious dilettante and amateur who can't write proper Haskell98 like us <em>real</em> programmers.  ;)</p>\n"}], "owner": {"reputation": 12694, "user_id": 173292, "user_type": "registered", "accept_rate": 91, "profile_image": "https://www.gravatar.com/avatar/a3bf36af18c24c8b6c6922af1064bcfe?s=128&d=identicon&r=PG", "display_name": "Wilduck", "link": "https://stackoverflow.com/users/173292/wilduck"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 374, "favorite_count": 0, "accepted_answer_id": 43699463, "answer_count": 2, "score": 3, "last_activity_date": 1493500048, "creation_date": 1493490987, "last_edit_date": 1493492432, "question_id": 43699207, "link": "https://stackoverflow.com/questions/43699207/typeclass-constraints-with-higher-kinded-types", "title": "Typeclass constraints with higher kinded types", "body": "<p>I'm trying to write an <code>Eq</code> instance for an <code>EitherT</code> newtype given by:</p>\n\n<pre><code>newtype EitherT e m a = EitherT { runEitherT :: m (Either e a) }\n</code></pre>\n\n<p>I assumed the following <code>Eq</code> instance would work:</p>\n\n<pre><code>instance (Eq e, Eq a, Eq m) =&gt; Eq (EitherT e m a) where\n  a == b = (runEitherT a) == (runEitherT b)\n</code></pre>\n\n<p>However, I'm seeing an error:</p>\n\n<pre><code>Expected kind '* -&gt; *', but 'm' has kind '*'\n</code></pre>\n\n<p>What I'm reading from that error is that my typeclass constraint <code>( ... Eq m) =&gt; ...</code> is confusing the compiler into thinking that I believe <code>m</code> to be of kind <code>*</code>, when my newtype declaration for <code>EitherT</code> expects it to be of kind <code>* -&gt; *</code>.</p>\n\n<p>I'm wondering what I need to do, to declare that I want an <code>Eq</code> instance for some higher kinded type <code>m</code> to implement <code>Eq</code> for my <code>EitherT</code> newtype.</p>\n\n<p><strong>Edit:</strong> As pointed out by @AlexisKing, I can get this to work with:</p>\n\n<pre><code>{-# LANGUAGE UndecideableInstances #-}\ninstance (Eq (m (Either e a))) =&gt; Eq (EitherT e m a) where\n  a == b = (runEitherT a) == (runEitherT b)\n</code></pre>\n\n<p>However, it seems strange to me to that a language extension is required to write this <code>Eq</code> instance. Is there no other way to express such a typeclass constraint in vanilla Haskell? If not, why?</p>\n"}, {"tags": ["haskell", "pattern-matching", "miranda"], "comments": [{"owner": {"reputation": 40537, "user_id": 465378, "user_type": "registered", "accept_rate": 85, "profile_image": "https://www.gravatar.com/avatar/c03b8d34978563858020eff0d14cc17b?s=128&d=identicon&r=PG", "display_name": "Alexis King", "link": "https://stackoverflow.com/users/465378/alexis-king"}, "edited": false, "score": 2, "creation_date": 1493490836, "post_id": 43699156, "comment_id": 74443272, "body": "This question has nothing to do with standard vs user-defined types. The issue is that Haskell functions can only accept a <i>single, consistent type</i> as input. You cannot have one case of a function that uses one type and another case of a function that uses a different type."}, {"owner": {"reputation": 1034, "user_id": 5919010, "user_type": "registered", "accept_rate": 89, "profile_image": "https://www.gravatar.com/avatar/438449fd43704ecbf650a95dd563d37a?s=128&d=identicon&r=PG&f=1", "display_name": "sandboxj", "link": "https://stackoverflow.com/users/5919010/sandboxj"}, "reply_to_user": {"reputation": 40537, "user_id": 465378, "user_type": "registered", "accept_rate": 85, "profile_image": "https://www.gravatar.com/avatar/c03b8d34978563858020eff0d14cc17b?s=128&d=identicon&r=PG", "display_name": "Alexis King", "link": "https://stackoverflow.com/users/465378/alexis-king"}, "edited": false, "score": 0, "creation_date": 1493490968, "post_id": 43699156, "comment_id": 74443321, "body": "Ok thanks, if that is the case. I guess I have to take another approach."}, {"owner": {"reputation": 40537, "user_id": 465378, "user_type": "registered", "accept_rate": 85, "profile_image": "https://www.gravatar.com/avatar/c03b8d34978563858020eff0d14cc17b?s=128&d=identicon&r=PG", "display_name": "Alexis King", "link": "https://stackoverflow.com/users/465378/alexis-king"}, "edited": false, "score": 3, "creation_date": 1493491132, "post_id": 43699156, "comment_id": 74443368, "body": "Generally, if you want a function to accept two types of data, you tag them using a sum type. For example, you could write <code>data IntOrTuple = I Int | T (Int, Int)</code>, then write a function from <code>IntOrTuple -&gt; Int</code>."}, {"owner": {"reputation": 24509, "user_id": 6863749, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/UyoQv.jpg?s=128&g=1", "display_name": "Li-yao Xia", "link": "https://stackoverflow.com/users/6863749/li-yao-xia"}, "edited": false, "score": 0, "creation_date": 1493491654, "post_id": 43699156, "comment_id": 74443546, "body": "Overloading and type classes also seem relevant."}], "answers": [{"tags": [], "owner": {"reputation": 18798, "user_id": 4543207, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/8ed6f11c827fa7cef811f141a84cc14b?s=128&d=identicon&r=PG&f=1", "display_name": "Redu", "link": "https://stackoverflow.com/users/4543207/redu"}, "is_accepted": true, "score": 1, "last_activity_date": 1493491572, "creation_date": 1493491572, "answer_id": 43699304, "question_id": 43699156, "link": "https://stackoverflow.com/questions/43699156/pattern-matching-simple-types/43699304#43699304", "title": "Pattern matching simple types", "body": "<p>I guess you may do as follows;</p>\n\n<pre><code>form :: Either (Int,Int) Int -&gt; Int\n\nform (Left (n,m)) = n + m\nform (Right n)    = n\n\n&gt;&gt; form (Left (2,3))\n&gt;&gt; 5\n&gt;&gt; form (Right 7)\n&gt;&gt; 7 \n</code></pre>\n"}, {"tags": [], "owner": {"reputation": 23444, "user_id": 414413, "user_type": "registered", "accept_rate": 79, "profile_image": "https://www.gravatar.com/avatar/6de2113f01432aa844dc85070ff33e89?s=128&d=identicon&r=PG", "display_name": "Cirdec", "link": "https://stackoverflow.com/users/414413/cirdec"}, "is_accepted": false, "score": 3, "last_activity_date": 1493491683, "creation_date": 1493491683, "answer_id": 43699319, "question_id": 43699156, "link": "https://stackoverflow.com/questions/43699156/pattern-matching-simple-types/43699319#43699319", "title": "Pattern matching simple types", "body": "<p>You can do this with a <a href=\"http://learnyouahaskell.com/types-and-typeclasses\" rel=\"nofollow noreferrer\">type class</a>. We can define the class of <code>Formable</code> types that have a <code>form</code> function:</p>\n\n<pre><code>class Formable a where\n    form :: a -&gt; Int\n</code></pre>\n\n<p>For ints, just use the int</p>\n\n<pre><code>instance Formable Int where\n    form x = x\n</code></pre>\n\n<p>If the argument is a tuple, add its arguments together. I'm going to go one step further, and instead of only working on tuples <code>(Int, Int)</code> its formable instance will work on any tuple <code>(a, b)</code> as long as both <code>a</code> and <code>b</code> are <code>Formable</code></p>\n\n<pre><code>instance (Formable a, Formable b) =&gt; Formable (a, b) where\n    form (a, b) = form a + form b\n</code></pre>\n\n<hr>\n\n<p>We can write <code>Formable</code> instances for other types in a similar vein. Like totaling the elements of a list</p>\n\n<pre><code>instance (Formable a) =&gt; Formable [a] where\n    form = sum . map form\n</code></pre>\n\n<p>or the alternatives of a sum</p>\n\n<pre><code>instance (Formable a, Formable b) =&gt; Formable (Either a b) where\n    form (Left a) = form a\n    form (Right b) = form b\n</code></pre>\n\n<p>or even <code>Maybe</code>, if we know what to do with <code>Nothing</code></p>\n\n<pre><code>instance (Formable a) =&gt; Formable (Maybe a) where\n    form Nothing = 0\n    form (Just a) = form a\n</code></pre>\n"}], "owner": {"reputation": 1034, "user_id": 5919010, "user_type": "registered", "accept_rate": 89, "profile_image": "https://www.gravatar.com/avatar/438449fd43704ecbf650a95dd563d37a?s=128&d=identicon&r=PG&f=1", "display_name": "sandboxj", "link": "https://stackoverflow.com/users/5919010/sandboxj"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 63, "favorite_count": 0, "accepted_answer_id": 43699304, "answer_count": 2, "score": 0, "last_activity_date": 1493491683, "creation_date": 1493490688, "question_id": 43699156, "link": "https://stackoverflow.com/questions/43699156/pattern-matching-simple-types", "title": "Pattern matching simple types", "body": "<p>I am a beginner trying to learn functional programming.</p>\n\n<p>Is there a way to pattern match different standard (not user defined) types?</p>\n\n<p>E.g. if the argument of the function is a tuple, add them, if it is just an int, use int:</p>\n\n<pre><code>form (x, y) = x + y\nform any_num = any_num\n</code></pre>\n\n<p>This obviously won't work, because the program thinks any_num is just any tuple and is therefore unreachable.</p>\n"}, {"tags": ["macos", "haskell"], "comments": [{"owner": {"reputation": 100185, "user_id": 3234959, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/93bb12ca0f93dfddb33880316f7e66c2?s=128&d=identicon&r=PG&f=1", "display_name": "chi", "link": "https://stackoverflow.com/users/3234959/chi"}, "edited": false, "score": 0, "creation_date": 1493489812, "post_id": 43698981, "comment_id": 74442921, "body": "Are you sure you have the permissions? Can you open that file in other programs?"}, {"owner": {"reputation": 623, "user_id": 5910215, "user_type": "registered", "accept_rate": 87, "profile_image": "https://www.gravatar.com/avatar/62487068172a6c63ecc4f2e13d4b2a8f?s=128&d=identicon&r=PG&f=1", "display_name": "khaled omar", "link": "https://stackoverflow.com/users/5910215/khaled-omar"}, "reply_to_user": {"reputation": 100185, "user_id": 3234959, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/93bb12ca0f93dfddb33880316f7e66c2?s=128&d=identicon&r=PG&f=1", "display_name": "chi", "link": "https://stackoverflow.com/users/3234959/chi"}, "edited": false, "score": 0, "creation_date": 1493489979, "post_id": 43698981, "comment_id": 74442978, "body": "I am logged in using the admin user and it have read write access to the file"}, {"owner": {"reputation": 78982, "user_id": 1848654, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/84180c0f3c9c04f8b8f0613fc0129dac?s=128&d=identicon&r=PG", "display_name": "melpomene", "link": "https://stackoverflow.com/users/1848654/melpomene"}, "edited": false, "score": 0, "creation_date": 1493490149, "post_id": 43698981, "comment_id": 74443035, "body": "<code>hClose inh</code> is invalid. <code>hGetContents</code> already closes the file."}, {"owner": {"reputation": 78982, "user_id": 1848654, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/84180c0f3c9c04f8b8f0613fc0129dac?s=128&d=identicon&r=PG", "display_name": "melpomene", "link": "https://stackoverflow.com/users/1848654/melpomene"}, "edited": false, "score": 1, "creation_date": 1493490343, "post_id": 43698981, "comment_id": 74443103, "body": "Possibly related? <a href=\"https://apple.stackexchange.com/questions/101328/file-cant-be-moved-by-root-on-os-x\" title=\"file cant be moved by root on os x\">apple.stackexchange.com/questions/101328/&hellip;</a>"}, {"owner": {"reputation": 623, "user_id": 5910215, "user_type": "registered", "accept_rate": 87, "profile_image": "https://www.gravatar.com/avatar/62487068172a6c63ecc4f2e13d4b2a8f?s=128&d=identicon&r=PG&f=1", "display_name": "khaled omar", "link": "https://stackoverflow.com/users/5910215/khaled-omar"}, "edited": false, "score": 0, "creation_date": 1493491338, "post_id": 43698981, "comment_id": 74443429, "body": "unfortunetly it does not work"}], "owner": {"reputation": 623, "user_id": 5910215, "user_type": "registered", "accept_rate": 87, "profile_image": "https://www.gravatar.com/avatar/62487068172a6c63ecc4f2e13d4b2a8f?s=128&d=identicon&r=PG&f=1", "display_name": "khaled omar", "link": "https://stackoverflow.com/users/5910215/khaled-omar"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 324, "favorite_count": 0, "answer_count": 0, "score": 0, "last_activity_date": 1493495355, "creation_date": 1493489507, "last_edit_date": 1493495355, "question_id": 43698981, "link": "https://stackoverflow.com/questions/43698981/operation-not-permitted-when-trying-to-use-openfile-in-os-x", "title": "Operation not permitted when trying to use openFile in OS X", "body": "<p>While trying to read file on Mac using the below Haskell code, I am getting an error that permission is denied: Operation not permitted.</p>\n\n<pre><code>import System.IO\n\nmain :: IO ()\nmain = do\n  inh &lt;- openFile \"/Users/lambda/Downloads/file.doc\" ReadMode\n  inpStr &lt;- hGetContents inh\n  let [(result,_)] = parse allDigits inpStr\n  putStr result\n  hClose inh\n\nresult : ** Exception: /Users/lambda/Downloads/file.doc: openFile: permission denied (Operation not permitted)\n</code></pre>\n"}, {"tags": ["haskell"], "comments": [{"owner": {"reputation": 100185, "user_id": 3234959, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/93bb12ca0f93dfddb33880316f7e66c2?s=128&d=identicon&r=PG&f=1", "display_name": "chi", "link": "https://stackoverflow.com/users/3234959/chi"}, "edited": false, "score": 2, "creation_date": 1493481140, "post_id": 43697601, "comment_id": 74440011, "body": "Try disabling the monomorphism restriction in the Haskell source file. Or provide a full type signature for the binding <code>x</code>."}, {"owner": {"reputation": 31243, "user_id": 2751851, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/4ddc0.png?s=128&g=1", "display_name": "duplode", "link": "https://stackoverflow.com/users/2751851/duplode"}, "edited": false, "score": 1, "creation_date": 1493481356, "post_id": 43697601, "comment_id": 74440086, "body": "This question is a mirror image of <a href=\"http://stackoverflow.com/q/42233527/2751851\"><i>ghci - defaulting confusion</i></a>, so you will find the discussion there relevant."}, {"owner": {"reputation": 7792, "user_id": 242189, "user_type": "registered", "accept_rate": 74, "profile_image": "https://www.gravatar.com/avatar/48a18a00706b9c7206ef4092b6e68a41?s=128&d=identicon&r=PG", "display_name": "nicolas", "link": "https://stackoverflow.com/users/242189/nicolas"}, "edited": false, "score": 0, "creation_date": 1493484725, "post_id": 43697601, "comment_id": 74441226, "body": "yes it&#39;s a duplicate of the ghci default."}], "owner": {"reputation": 7792, "user_id": 242189, "user_type": "registered", "accept_rate": 74, "profile_image": "https://www.gravatar.com/avatar/48a18a00706b9c7206ef4092b6e68a41?s=128&d=identicon&r=PG", "display_name": "nicolas", "link": "https://stackoverflow.com/users/242189/nicolas"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 38, "favorite_count": 0, "closed_date": 1493483778, "answer_count": 0, "score": 0, "last_activity_date": 1493485205, "creation_date": 1493480941, "last_edit_date": 1493481398, "question_id": 43697601, "link": "https://stackoverflow.com/questions/43697601/instance-resolution-in-code-and-in-ghci", "closed_reason": "Duplicate", "title": "Instance resolution in code and in GHCI", "body": "<p>In a haskell file, I write </p>\n\n<pre><code>x = 2\n</code></pre>\n\n<p>and load it in ghci via spacemacs / intero</p>\n\n<p>I have the following type :</p>\n\n<pre><code>:t x\nx :: integer-gmp-1.0.0.1:GHC.Integer.Type.Integer\n</code></pre>\n\n<p>whereas if I just type in 2 I get the expected </p>\n\n<pre><code> :t 2 \n 2 :: GHC.Num.Num t =&gt; t\n</code></pre>\n\n<p>Is there a way to have the instance resolution be like ghci when editing a file ? of course this bites me when using some other datastucture where it can't find some <code>Eq</code> class</p>\n"}, {"tags": ["haskell"], "comments": [{"owner": {"reputation": 31243, "user_id": 2751851, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/4ddc0.png?s=128&g=1", "display_name": "duplode", "link": "https://stackoverflow.com/users/2751851/duplode"}, "edited": false, "score": 1, "creation_date": 1493480959, "post_id": 43697398, "comment_id": 74439943, "body": "Also relevant: <a href=\"http://stackoverflow.com/q/1064232/2751851\"><i>Haskell: Overlapping instances</i></a>, and <a href=\"http://stackoverflow.com/a/3216937/2751851\">this answer to <i>How do I write, \u201cif typeclass a, then a is also an instance of b by this definition.\u201d</i></a>. By the way, I&#39;m not sure there would be much to gain by having <code>cIncr</code> for e.g. <code>Double</code> returning always <code>Nothing</code> (if you got your instance to work), rather than simply leading to a type error (if you removed the instance)."}, {"owner": {"reputation": 1804, "user_id": 1260229, "user_type": "registered", "accept_rate": 69, "profile_image": "https://www.gravatar.com/avatar/a918b56d3f83f46ced68b33737396b87?s=128&d=identicon&r=PG", "display_name": "sn&#248;reven", "link": "https://stackoverflow.com/users/1260229/sn%c3%b8reven"}, "reply_to_user": {"reputation": 31243, "user_id": 2751851, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/4ddc0.png?s=128&g=1", "display_name": "duplode", "link": "https://stackoverflow.com/users/2751851/duplode"}, "edited": false, "score": 0, "creation_date": 1493481444, "post_id": 43697398, "comment_id": 74440114, "body": "@duplode: Thanks, I&#39;ll read that. I need to know if there is a next value (and what it is) for the type used and handle some things differently if there is not. That&#39;s why I need instances for all integral numbers and ones for all non-integral numbers. The <code>Nothing</code> is used - it&#39;s not some kind of error."}, {"owner": {"reputation": 31243, "user_id": 2751851, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/4ddc0.png?s=128&g=1", "display_name": "duplode", "link": "https://stackoverflow.com/users/2751851/duplode"}, "edited": false, "score": 1, "creation_date": 1493485146, "post_id": 43697398, "comment_id": 74441389, "body": "Note that, if you are okay with giving up on deciding solely on the basis of which instances happen to exist, there is the option of introducing a wrapper type with two constructors that encoding the difference, while using GADTs or plain old &quot;smart constructors&quot; (cf. options 2 and 4 in <a href=\"http://stackoverflow.com/a/19650352/2751851\">this answer</a> to ensure only sensible values can be constructed."}], "owner": {"reputation": 1804, "user_id": 1260229, "user_type": "registered", "accept_rate": 69, "profile_image": "https://www.gravatar.com/avatar/a918b56d3f83f46ced68b33737396b87?s=128&d=identicon&r=PG", "display_name": "sn&#248;reven", "link": "https://stackoverflow.com/users/1260229/sn%c3%b8reven"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 91, "favorite_count": 0, "closed_date": 1493480700, "answer_count": 0, "score": 0, "last_activity_date": 1493479631, "creation_date": 1493479631, "question_id": 43697398, "link": "https://stackoverflow.com/questions/43697398/duplicate-instance-declarations-error-for-integral-and-fractional-instances", "closed_reason": "Duplicate", "title": "Duplicate instance declarations error for Integral and Fractional instances", "body": "<p>I have some typeclass <code>C</code> with a function that is supposed to give me the next bigger number, if there is one.</p>\n\n<p>That means for integral types it just does <code>+1</code>, for types that represent a superset of the whole numbers it is supposed to return <code>Nothing</code> because there is no definite <em>next number</em>.</p>\n\n<pre><code>{-# LANGUAGE FlexibleInstances, UndecidableInstances #-} \nmodule Main where\n\nclass C a where\n    cIncr :: a -&gt; Maybe a\n\ninstance Integral a =&gt; C a where\n    cIncr x = Just $ x + 1\n\ninstance Fractional a =&gt; C a where\n    cIncr _ = Nothing\n</code></pre>\n\n<p>This gives me following error:</p>\n\n<pre><code>Duplicate instance declarations:\n  instance Integral a =&gt; C a\n    -- Defined at src/File.hs:7\n  instance Fractional a =&gt; C a\n    -- Defined at src/File.hs:10\n</code></pre>\n\n<p>I don't understand why I get this error - why/where do they define the same instances?</p>\n"}, {"tags": ["haskell", "cabal", "haskell-stack", "cabal-install"], "comments": [{"owner": {"reputation": 912, "user_id": 925960, "user_type": "registered", "accept_rate": 67, "profile_image": "https://www.gravatar.com/avatar/d1e213d647b3f0986ca900ce6c545159?s=128&d=identicon&r=PG", "display_name": "Aaron Rotenberg", "link": "https://stackoverflow.com/users/925960/aaron-rotenberg"}, "edited": false, "score": 0, "creation_date": 1493509086, "post_id": 43697214, "comment_id": 74447889, "body": "Question to close voters: Is the main reason for voting &quot;too broad&quot; the wording of the question as &quot;How should I...&quot;, which appears subjective? The original intention of the question was to ask for the <i>canonical solution</i> (i.e. the one that is <i>officially preferred and recommended by the Stack/Cabal developers</i>) for this situation, if one exists. Would the &quot;too broad&quot; issue be alleviated if I specified more clearly that this was the intent of the question?"}, {"owner": {"reputation": 912, "user_id": 925960, "user_type": "registered", "accept_rate": 67, "profile_image": "https://www.gravatar.com/avatar/d1e213d647b3f0986ca900ce6c545159?s=128&d=identicon&r=PG", "display_name": "Aaron Rotenberg", "link": "https://stackoverflow.com/users/925960/aaron-rotenberg"}, "edited": false, "score": 0, "creation_date": 1493511450, "post_id": 43697214, "comment_id": 74448320, "body": "Even though the answers so far do not attempt to offer <i>canonical</i> solutions, they have been helpful to me personally, because they suggest options that have fewer drawbacks than the ones I had previously considered. I would appreciate suggestions on how to reword the question to make it less close-worthy without affecting the validity of this type of answer, since the current answers are demonstrably useful (the answer by @Li-yao Xia shows that I am not the only one to run into this problem)."}], "answers": [{"tags": [], "owner": {"reputation": 24509, "user_id": 6863749, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/UyoQv.jpg?s=128&g=1", "display_name": "Li-yao Xia", "link": "https://stackoverflow.com/users/6863749/li-yao-xia"}, "is_accepted": false, "score": 2, "last_activity_date": 1493484114, "creation_date": 1493484114, "answer_id": 43698105, "question_id": 43697214, "link": "https://stackoverflow.com/questions/43697214/what-is-the-preferred-way-to-write-quick-haskell-test-programs-that-depend-on-st/43698105#43698105", "title": "What is the preferred way to write quick Haskell test programs that depend on Stack libraries in local directories?", "body": "<p>If only one local library is involved, I use option 4. You can put your tests outside the directory of your library, and either invoke stack from the directory of your library, or using <code>--stack-yaml path/to/library/stack.yaml</code>.</p>\n\n<p>Otherwise, I use option 3, creating a separate stack project without setting <code>extra-dep</code>.</p>\n\n<pre><code>...\npackages:\n- 'path/to/package1'\n- 'path/to/package2'\n...\n</code></pre>\n\n<p>I can't think of a good workaround for the issue of configuration duplication. There would otherwise be conflicts if multiple packages specified different resolvers/package versions.</p>\n"}, {"comments": [{"owner": {"reputation": 912, "user_id": 925960, "user_type": "registered", "accept_rate": 67, "profile_image": "https://www.gravatar.com/avatar/d1e213d647b3f0986ca900ce6c545159?s=128&d=identicon&r=PG", "display_name": "Aaron Rotenberg", "link": "https://stackoverflow.com/users/925960/aaron-rotenberg"}, "edited": false, "score": 0, "creation_date": 1493510879, "post_id": 43698795, "comment_id": 74448223, "body": "Actually, it looks like with the <code>library</code> option, you can have a totally blank <code>hs-source-dirs</code> line. Just <code>hs-source-dirs:</code> and then a newline. Fancy."}], "tags": [], "owner": {"reputation": 34158, "user_id": 7203016, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/ybAMw.png?s=128&g=1", "display_name": "K. A. Buhr", "link": "https://stackoverflow.com/users/7203016/k-a-buhr"}, "is_accepted": false, "score": 1, "last_activity_date": 1493488840, "last_edit_date": 1493488840, "creation_date": 1493488332, "answer_id": 43698795, "question_id": 43697214, "link": "https://stackoverflow.com/questions/43697214/what-is-the-preferred-way-to-write-quick-haskell-test-programs-that-depend-on-st/43698795#43698795", "title": "What is the preferred way to write quick Haskell test programs that depend on Stack libraries in local directories?", "body": "<p><strong>Edit:</strong>  Actually a stub library works better, so edited to add.</p>\n\n<p>I think the way to get #3 to work is -- under your <code>scratch</code> program directory -- (1) add <code>.</code> under <code>packages</code> in <code>stack.yaml</code> alongside the <code>location</code>/<code>extra-dep: true</code> package:</p>\n\n<pre><code>packages:\n- '.'\n- location: ../mylib\n  extra-dep: true\n</code></pre>\n\n<p>(2) create an <code>executable</code> clause in <code>scratch.cabal</code> that points to a stub main program (i.e., a \"Hello World\" program that compiles but need not do anything) which depends on your library:</p>\n\n<pre><code>executable main\n  hs-source-dirs:      src\n  main-is:             Stub.hs\n  build-depends:       base\n                     , mylib\n  default-language:    Haskell2010\n</code></pre>\n\n<p>or a <code>library</code> clause with no exposed modules, again that depends on your <code>mylib</code> library:</p>\n\n<pre><code>library\n  hs-source-dirs:      src\n  build-depends:       base &gt;= 4.7 &amp;&amp; &lt; 5\n                     , mylib\n  default-language:    Haskell2010\n</code></pre>\n\n<p>and (3) run <code>stack build</code> in the <code>scratch</code> directory.  This should build and register <code>mylib</code>, and now <code>stack runghc Prog1.hs</code> should work fine for running programs that depend on <code>mylib</code> modules.</p>\n\n<p>If you use the <code>executable</code> approach, the stub program is compiled as a side effect but otherwise ignored.  If you use the <code>library</code> approach, it looks like the stub library isn't even built; and you then have the option of actually building a <code>scratch</code> library by adding some exposed modules of shared code for your test programs to use, if it's convenient, so the stub library might be best.</p>\n\n<p>None of this solves the problem of keeping <code>stack.yaml</code> info like the resolver version in sync, but it seems to address all the problems you list in 1, 2, 4, and 5.  In particular, it should work fine for test programs that depend on multiple local libraries you're developing.</p>\n"}], "owner": {"reputation": 912, "user_id": 925960, "user_type": "registered", "accept_rate": 67, "profile_image": "https://www.gravatar.com/avatar/d1e213d647b3f0986ca900ce6c545159?s=128&d=identicon&r=PG", "display_name": "Aaron Rotenberg", "link": "https://stackoverflow.com/users/925960/aaron-rotenberg"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 357, "favorite_count": 0, "answer_count": 2, "score": 2, "last_activity_date": 1493488840, "creation_date": 1493478634, "last_edit_date": 1495540012, "question_id": 43697214, "link": "https://stackoverflow.com/questions/43697214/what-is-the-preferred-way-to-write-quick-haskell-test-programs-that-depend-on-st", "title": "What is the preferred way to write quick Haskell test programs that depend on Stack libraries in local directories?", "body": "<p>I have a Haskell library that I am developing using Stack. As I am developing the library, I like to write small test/experimentation programs that use the library. I keep a collection of these test programs for myself in a directory locally. These test modules are very quick and informal, and not appropriate to include as unit tests in the committed library code. Typically, most of them aren't even maintained and won't compile against the latest version of the library, but I keep them around in case I want to update them later. When I'm working on a test program, I want it to build against my working copy of the library, with any changes that I've made to the library locally.</p>\n\n<p><strong>How should I set up my Stack build environment for this situation?</strong> Here are some options I've tried, and the problems with each options.</p>\n\n<ol>\n<li><p>Two Cabal packages, one Stack configuration. The stack.yaml file lists both packages and defines the build environment for both at once.</p>\n\n<ul>\n<li>Problem: The stack.yaml file needs to be included as part of the committed library source code, so that other developers can build the library from source reproducibly. I don't want the public stack.yaml file for my library to include build information for my local test projects.</li>\n<li>Problem: As far as I know, to make this work I need to have a .cabal file that lists all the executables and modules for my test programs. This is annoying to update whenever I want to throw together a quick experimental script, and will fail to build any of the test programs if I have even a single module that doesn't compile. I can't have a .cabal file with no sections, because Cabal gives \"No executables, libraries,tests, or benchmarks found. Nothing to do.\", and because this offers nowhere to list <code>build-depends</code>.</li>\n</ul></li>\n<li><p>Create a Cabal sandbox for the test programs. Use <code>cabal sandbox add-source</code> to add the local library as a package. See also <a href=\"https://stackoverflow.com/a/19622972/925960\">this answer</a>.</p>\n\n<ul>\n<li>Problem: Using Cabal sandboxes instead of Stack reintroduces a lot of the dependency problems that Stack is supposed to fix, such as using the system-global GHC instead of the GHC defined by the resolver.</li>\n</ul></li>\n<li><p>Have a separate stack.yaml for the test programs. Add the library under <code>packages</code> as <code>location: 'C:\\Path\\To\\Local\\Library'</code> and set <code>extra-dep: true</code> for that dependency. (See <a href=\"https://docs.haskellstack.org/en/stable/yaml_configuration/#local-dependency-packages-extra-dep\" rel=\"nofollow noreferrer\">here</a> for more info on this feature.) Don't put any other Cabal packages under <code>packages</code> in the stack.yaml for the test programs. Use <code>stack runghc</code> to invoke test programs within the scope of their stack.yaml.</p>\n\n<ul>\n<li>Problem: I just can't get this one to work. Running <code>stack build</code> inside the test program directory gives \"Error parsing targets: The project contains no local packages (packages not marked with 'extra-dep')\". Running <code>stack runghc</code> acts as if no dependencies are present at all. I don't want to add a Cabal package for the test programs because this has the same problem as option 1 with needing to construct an explicit .cabal file describing the modules to build.</li>\n<li>Problem: Stack build configuration info that I want to be identical between the library and the test programs has to be copied manually. For example, if I change the resolver in my library's stack.yaml, I also need to change it in the stack.yaml for my test programs separately.</li>\n</ul></li>\n<li><p>Have a directory inside my working copy of the library that contains all of my test programs. Use <code>stack runghc</code> to invoke test programs in the context of the library.</p>\n\n<ul>\n<li>Problem: I'd like the directory with my test programs to be outside of the directory containing my library source code and build configuration, so that I don't have to tell the version control for my library to ignore my test code, and can have my own local version control just for the test programs.</li>\n<li>Problem: Only works with a single local library dependency. If my test programs need to depend on local working copies of two different libraries with their own stack.yaml files, I'm out of luck.</li>\n</ul></li>\n<li><p>Add a symbolic link inside my working copy of the library to a separate directory that contains all of my test programs. Navigate through the symlink and use <code>stack runghc</code> to invoke test programs in the context of the library.</p>\n\n<ul>\n<li>Problem: Super awkward to use, especially since I'm on Windows and Windows has terrible symlink support.</li>\n<li>Problem: Still need to tell my version control system to ignore the symlink.</li>\n<li>Problem: Still only works with a single library dependency.</li>\n</ul></li>\n</ol>\n"}, {"tags": ["list", "haskell", "types"], "answers": [{"tags": [], "owner": {"reputation": 18798, "user_id": 4543207, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/8ed6f11c827fa7cef811f141a84cc14b?s=128&d=identicon&r=PG&f=1", "display_name": "Redu", "link": "https://stackoverflow.com/users/4543207/redu"}, "is_accepted": false, "score": 0, "last_activity_date": 1493478601, "creation_date": 1493478601, "answer_id": 43697205, "question_id": 43696972, "link": "https://stackoverflow.com/questions/43696972/haskell-programming/43697205#43697205", "title": "Haskell Programming", "body": "<p>I guess you may do as follows;</p>\n\n<pre><code>data Ex    = Ex Float Float String String deriving Show \ndata NewSt = NewSt Float Float String deriving Show \ndata Dist  = Dist Float NewSt Ex deriving Show \n\nmyData :: [Dist]\nmyData = [Dist 1 (NewSt 66 100 \"John\") (Ex 55 90 \"John\" \"pass\"),\n          Dist 2 (NewSt 20 45 \"Tom\") (Ex 33 50 \"Tom\" \"fail\"),\n          Dist 3 (NewSt 75 75 \"Mary\") (Ex 90 100 \"Mary\" \"pass\")]\n\nhelper1 [] = []\nhelper1 d@(Dist _ _ (Ex _ _ _ label):ds) | label == \"pass\" = (head d):(helper1 ds)\n                                         | otherwise       = helper1 ds\n</code></pre>\n"}, {"tags": [], "owner": {"reputation": 384463, "user_id": 1126841, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/fa05233b2357f8d11c22ef4cfc7bb85c?s=128&d=identicon&r=PG", "display_name": "chepner", "link": "https://stackoverflow.com/users/1126841/chepner"}, "is_accepted": false, "score": 2, "last_activity_date": 1493482668, "last_edit_date": 1493482668, "creation_date": 1493478616, "answer_id": 43697212, "question_id": 43696972, "link": "https://stackoverflow.com/questions/43696972/haskell-programming/43697212#43697212", "title": "Haskell Programming", "body": "<p>This is a little simpler to write with more pattern matching than with an <code>if</code> expression.</p>\n\n<pre><code>helper1 :: [Dist] -&gt; [Dist]\nhelper1 [] = []\nhelper1 (Dist x newst (Ex midterm quiz name \"pass\") : xs) = Dist x newst (Ex midterm quiz name \"pass\") : (helper1 xs)\nhelper (_:xs) = helper1 xs\n</code></pre>\n\n<p>However, it is even simpler once you recognize that your recursion is already implemented by the <code>filter</code> function.</p>\n\n<pre><code>helper1 :: [Dist] -&gt; [Dist]\nhelper1 = filter passed\n          where passed (Dist _ _ (Ex _ _ _ \"pass\")) = True\n                passed _ = False\n</code></pre>\n"}], "owner": {"reputation": 11, "user_id": 7867450, "user_type": "registered", "profile_image": "https://graph.facebook.com/1729177033775931/picture?type=large", "display_name": "Yasmine Mustafa", "link": "https://stackoverflow.com/users/7867450/yasmine-mustafa"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 69, "favorite_count": 0, "answer_count": 2, "score": 0, "last_activity_date": 1493512849, "creation_date": 1493477194, "last_edit_date": 1493512849, "question_id": 43696972, "link": "https://stackoverflow.com/questions/43696972/haskell-programming", "title": "Haskell Programming", "body": "<p>I need to implement a function that takes a list of <code>Dist</code>s and returns a list of <code>Dist</code>s. I need the function to return only the <code>Dist</code>s with the label <code>\"pass\"</code>, but somehow this does not work. Any help?</p>\n\n<pre><code>data Ex = Ex Float Float String String deriving Show \ndata NewSt = NewSt Float Float String deriving Show \ndata Dist = Dist Float NewSt Ex deriving Show \n\nhelper1 [] = []\nhelper1 (Dist x (NewSt midterm1 quiz1 name1) (Ex midterm quiz name label) : xs) = if (label == \"pass\")\n  then Dist x (NewSt midterm1 quiz1 name1) (Ex midterm quiz name label) : (helper1 xs) \n  else helper1 xs\n</code></pre>\n"}, {"tags": ["haskell"], "comments": [{"owner": {"reputation": 622, "user_id": 525332, "user_type": "registered", "accept_rate": 88, "profile_image": "https://www.gravatar.com/avatar/e1b627d65d47e7ad08d669b0de9c23d2?s=128&d=identicon&r=PG", "display_name": "ironchicken", "link": "https://stackoverflow.com/users/525332/ironchicken"}, "edited": false, "score": 1, "creation_date": 1493472632, "post_id": 43696030, "comment_id": 74437322, "body": "Not sure I completely understand, but <code>let</code> can certainly pattern match a tuple: <code>let (something, function) = functionName ...</code>"}], "answers": [{"comments": [{"owner": {"reputation": 3, "user_id": 7940619, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/971d936ffd817e5ec3e62ca91ea91ef3?s=128&d=identicon&r=PG&f=1", "display_name": "craigr", "link": "https://stackoverflow.com/users/7940619/craigr"}, "edited": false, "score": 0, "creation_date": 1493478681, "post_id": 43696272, "comment_id": 74439144, "body": "Sorry for not being explicit. The idea is that I need to call the function recursively and among the way add the <code>Something par1 par2</code> parameters into the list of <code>Something par1 par2</code>, which is returned by the function. I edited my question."}], "tags": [], "owner": {"reputation": 2313, "user_id": 5318306, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/897fd4f3b92d28c5c1eb28a8024661a1?s=128&d=identicon&r=PG&f=1", "display_name": "Gurkenglas", "link": "https://stackoverflow.com/users/5318306/gurkenglas"}, "is_accepted": true, "score": 1, "last_activity_date": 1493500946, "last_edit_date": 1493500946, "creation_date": 1493472681, "answer_id": 43696272, "question_id": 43696030, "link": "https://stackoverflow.com/questions/43696030/access-return-value/43696272#43696272", "title": "Access return value", "body": "<p>I haven't understood your question. If it becomes more coherent, so may this answer.</p>\n\n<p>The canonical code that applies a function like yours recursively is the following:</p>\n\n<pre><code>data Tree a = Node a [a]\n\nunfold :: (a -&gt; [a]) -&gt; a -&gt; Tree a\nunfold f x = Node x $ map (unfold f) $ f x\n</code></pre>\n\n<p>You talk of tuples. I see no tuple in your type signature.</p>\n"}], "owner": {"reputation": 3, "user_id": 7940619, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/971d936ffd817e5ec3e62ca91ea91ef3?s=128&d=identicon&r=PG&f=1", "display_name": "craigr", "link": "https://stackoverflow.com/users/7940619/craigr"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 68, "favorite_count": 0, "accepted_answer_id": 43696272, "answer_count": 1, "score": 0, "last_activity_date": 1493500946, "creation_date": 1493471034, "last_edit_date": 1493478730, "question_id": 43696030, "link": "https://stackoverflow.com/questions/43696030/access-return-value", "title": "Access return value", "body": "<p>Let's say I have this function:</p>\n\n<pre><code>functionName :: notimportant =&gt; a -&gt; ([a])\n</code></pre>\n\n<p>I would like to recursively call this function and at each call to modify/update the return (the 2 elements from the tuple). The problem is that I do not know how to pattern match the tuple in order to add at each function's call elements in the list(the first parameter of the returned tuple).</p>\n"}, {"tags": ["haskell", "continuations", "delimited-continuations"], "comments": [{"owner": {"reputation": 2313, "user_id": 5318306, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/897fd4f3b92d28c5c1eb28a8024661a1?s=128&d=identicon&r=PG&f=1", "display_name": "Gurkenglas", "link": "https://stackoverflow.com/users/5318306/gurkenglas"}, "edited": false, "score": 2, "creation_date": 1493474806, "post_id": 43695653, "comment_id": 74437925, "body": "All combinators are used to make code more readable. Of course you can build this directly, <code>shiftT</code> must be defined in terms of <code>ContT</code>. You might find uses of it by <a href=\"https://github.com/search?l=Haskell&amp;q=shiftT&amp;type=Code\" rel=\"nofollow noreferrer\">searching github</a>."}, {"owner": {"reputation": 60057, "user_id": 1333025, "user_type": "registered", "accept_rate": 65, "profile_image": "https://www.gravatar.com/avatar/79ab43010f900324ac5e2de19a2916cb?s=128&d=identicon&r=PG", "display_name": "Petr", "link": "https://stackoverflow.com/users/1333025/petr"}, "edited": false, "score": 1, "creation_date": 1493493073, "post_id": 43695653, "comment_id": 74443987, "body": "It seems that your beta-reduction step is wrong. In particular <code>evalContT (\\famr -&gt; ...) famr&#39;</code> doesn&#39;t beta-reduce, as <code>(\\famr -&gt; ...)</code> and <code>famr&#39;</code> are arguments to <code>evalContT</code>, not a function application."}, {"owner": {"reputation": 654, "user_id": 7501619, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/dfb3e55ff104cf8485859d00fc6ecbcb?s=128&d=identicon&r=PG&f=1", "display_name": "Taren", "link": "https://stackoverflow.com/users/7501619/taren"}, "reply_to_user": {"reputation": 60057, "user_id": 1333025, "user_type": "registered", "accept_rate": 65, "profile_image": "https://www.gravatar.com/avatar/79ab43010f900324ac5e2de19a2916cb?s=128&d=identicon&r=PG", "display_name": "Petr", "link": "https://stackoverflow.com/users/1333025/petr"}, "edited": false, "score": 0, "creation_date": 1493497891, "post_id": 43695653, "comment_id": 74445441, "body": "@PetrPudl&#225;k Thanks, I inlined shiftT as <code>ContT (\\f2-&gt; evalContT f1 f2 )</code> instead of <code>ContT (\\f2-&gt; evalContT (f1 f2) )</code>.  Gave up on removing unnecessary brackets so it looks like lisp but I think at least it is correct now."}], "answers": [{"comments": [{"owner": {"reputation": 654, "user_id": 7501619, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/dfb3e55ff104cf8485859d00fc6ecbcb?s=128&d=identicon&r=PG&f=1", "display_name": "Taren", "link": "https://stackoverflow.com/users/7501619/taren"}, "edited": false, "score": 0, "creation_date": 1493481481, "post_id": 43697115, "comment_id": 74440125, "body": "But you could just as well say <code>ContT is like callCC, except that when you activate the function provided by ContT, it will run to the end of the nearest enclosing &#39;resetT&#39;, then jump back to just after the point at which you activated the continuation</code>.   In virtually all cases I managed to find shiftT the code would have been (slightly) simpler by using ContT directly. I did find out that shift and reset are named after implementation details in scheme, though. So maybe its prevalence in other languages with continuations is reason enough too use shift in haskell?"}, {"owner": {"reputation": 8237, "user_id": 2900502, "user_type": "registered", "accept_rate": 73, "profile_image": "https://i.stack.imgur.com/R1OjD.jpg?s=128&g=1", "display_name": "Shersh", "link": "https://stackoverflow.com/users/2900502/shersh"}, "reply_to_user": {"reputation": 654, "user_id": 7501619, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/dfb3e55ff104cf8485859d00fc6ecbcb?s=128&d=identicon&r=PG&f=1", "display_name": "Taren", "link": "https://stackoverflow.com/users/7501619/taren"}, "edited": false, "score": 2, "creation_date": 1493489002, "post_id": 43697115, "comment_id": 74442660, "body": "@Taren It is mostly for code readability. If you&#39;re using <code>ContT</code> constructor directly it means that you&#39;re just creating CPS-like action. It can mean anything. But if you&#39;re using <code>shiftT</code> and <code>resetT</code> functions it gives some hints to code reader about what you&#39;re trying to do with them. Understanding code with <code>Cont</code> monad is really hard. So having some hints even on the level like <i>function names</i> really can help."}, {"owner": {"reputation": 57219, "user_id": 33796, "user_type": "registered", "accept_rate": 70, "profile_image": "https://www.gravatar.com/avatar/08727b23ba62e634b32988cdff082663?s=128&d=identicon&r=PG", "display_name": "luqui", "link": "https://stackoverflow.com/users/33796/luqui"}, "edited": false, "score": 0, "creation_date": 1493496780, "post_id": 43697115, "comment_id": 74445112, "body": "Thanks for finding this, it&#39;s very helpful!"}], "tags": [], "owner": {"reputation": 8237, "user_id": 2900502, "user_type": "registered", "accept_rate": 73, "profile_image": "https://i.stack.imgur.com/R1OjD.jpg?s=128&g=1", "display_name": "Shersh", "link": "https://stackoverflow.com/users/2900502/shersh"}, "is_accepted": true, "score": 7, "last_activity_date": 1493497268, "last_edit_date": 1495540043, "creation_date": 1493477997, "answer_id": 43697115, "question_id": 43695653, "link": "https://stackoverflow.com/questions/43695653/cont-monad-shift/43697115#43697115", "title": "Cont monad shift", "body": "<p>After <a href=\"https://github.com/search?l=Haskell&amp;q=shiftT&amp;type=Code\" rel=\"nofollow noreferrer\">searching github</a> by <a href=\"https://stackoverflow.com/users/5318306/gurkenglas\">Gurkenglas</a>'s advice I've discovered <a href=\"https://github.com/renormalist/pugs/blob/f09558ae9b5ef2cbab75110abc1cb385931329cc/src/Pugs/AST/Eval.hs#L27\" rel=\"nofollow noreferrer\">this very nice explanation</a> of <code>shiftT</code> and <code>resetT</code> with examples of usages, motivation and semantic! </p>\n\n<p>Those functions are very simple. Their definition in <a href=\"http://hackage.haskell.org/package/transformers-0.5.4.0/docs/Control-Monad-Trans-Cont.html#v:shiftT\" rel=\"nofollow noreferrer\"><code>transformers</code></a> library is straightforward:</p>\n\n<pre><code>resetT :: (Monad m) =&gt; ContT r m r -&gt; ContT r' m r\nresetT = lift . evalContT\n\nshiftT :: (Monad m) =&gt; ((a -&gt; m r) -&gt; ContT r m r) -&gt; ContT r m a\nshiftT f = ContT (evalContT . f)\n</code></pre>\n\n<p>But philosophy and meaning far behind some intuitive understanding. So I recommend you to read explanation from the link above. Sometimes it happens that things that are easy to define actually can do something complex.</p>\n\n<p>Adapted documentation from the explanation in pugs linked above:</p>\n\n<blockquote>\n  <h2><code>shiftT</code></h2>\n  \n  <p><code>shiftT</code> is like <code>callCC</code>, except that when you activate the continuation\n  provided by <code>shiftT</code>, it will run to the end of the nearest enclosing <code>resetT</code>,\n  then jump back to just after the point at which you activated the continuation.\n  Note that because control eventually returns to the point after the \n  subcontinuation is activated, you can activate it multiple times in the \n  same block. This is unlike <code>callCC</code>'s continuations, which discard the current\n  execution path when activated.</p>\n  \n  <p>See <code>resetT</code> for an example of how these delimited subcontinuations actually\n  work.</p>\n  \n  <h2><code>resetT</code></h2>\n  \n  <p>Create a scope that <code>shiftT</code>'s subcontinuations are guaranteed to eventually\n  exit out the end of.  Consider this example:</p>\n\n<pre><code>resetT $ do\n    alfa\n    bravo\n    x &lt;- shiftT $ \\esc -&gt; do   -- note: esc :: m Int, not a ContT\n       charlie\n       lift $ esc 1\n       delta\n       lift $ esc 2\n       return 0\n    zulu x\n</code></pre>\n  \n  <p>This will:</p>\n  \n  <ol>\n  <li><p>Perform <code>alfa</code></p></li>\n  <li><p>Perform <code>bravo</code></p></li>\n  <li><p>Perform <code>charlie</code></p></li>\n  <li><p>Bind <code>x</code> to 1, and thus perform <code>zulu 1</code></p></li>\n  <li><p>Fall off the end of <code>resetT</code>, and jump back to just after <code>esc 1</code></p></li>\n  <li><p>Perform <code>delta</code></p></li>\n  <li><p>Bind <code>x</code> to 2, and thus perform <code>zulu 2</code></p></li>\n  <li><p>Fall off the end of <code>resetT</code>, and jump back to just after <code>esc 2</code></p></li>\n  <li><p>Escape from the <code>resetT</code>, causing it to yield 0</p></li>\n  </ol>\n  \n  <p>Thus, unlike <code>callCC</code>'s continuations, these subcontinuations will eventually\n  return to the point after they are activated, after falling off the end of the\n  nearest <code>resetT</code>.</p>\n</blockquote>\n"}, {"tags": [], "owner": {"reputation": 60057, "user_id": 1333025, "user_type": "registered", "accept_rate": 65, "profile_image": "https://www.gravatar.com/avatar/79ab43010f900324ac5e2de19a2916cb?s=128&d=identicon&r=PG", "display_name": "Petr", "link": "https://stackoverflow.com/users/1333025/petr"}, "is_accepted": false, "score": 4, "last_activity_date": 1493583343, "creation_date": 1493583343, "answer_id": 43710915, "question_id": 43695653, "link": "https://stackoverflow.com/questions/43695653/cont-monad-shift/43710915#43710915", "title": "Cont monad shift", "body": "<p>You're right that <a href=\"https://en.wikipedia.org/wiki/Delimited_continuation\" rel=\"nofollow noreferrer\">delimited continuations</a> can be expressed using undelimited continuations. So the definitions of <code>shiftT</code> and <code>resetT</code> can be always described using just <code>ContT</code>. But:</p>\n\n<ul>\n<li>Delimited continuations are <a href=\"http://okmij.org/ftp/continuations/against-callcc.html\" rel=\"nofollow noreferrer\">less powerful</a>. This makes them easier to implement and also reason about for humans. (See also a lot of other interesting <a href=\"http://okmij.org/ftp/continuations/\" rel=\"nofollow noreferrer\">posts about continuations</a> from Oleg Kiselyov).</li>\n<li>Using the familiar notation of <em>shift/reset</em> makes it easier to understand, especially for those familiar with the concept.</li>\n</ul>\n\n<p>Essentially, continuations allow to turn a program inside out: The block delimited by <code>reset</code> is squeezed inside the inner part of the program, when <code>shift</code> calls the passed function. (In the case of undelimited continuations the whole execution context is squeezed inside, which is what makes them so weird.)</p>\n\n<p>Let's make a few examples:</p>\n\n<pre><code>import Data.List\nimport Control.Monad\nimport Control.Monad.Trans\nimport Control.Monad.Trans.Cont\n\ntest0 :: Integer\ntest0 = evalCont . reset $ do\n    return 0\n</code></pre>\n\n<p>If we have <code>reset</code> without <code>shift</code>, it's just a pure computation, nothing fancy. The above function simply returns <code>0</code>.</p>\n\n<p>Now lets use both of them:</p>\n\n<pre><code>test1 :: Integer\ntest1 = evalCont . reset $ do\n    r &lt;- shift $ \\esc -&gt; do\n        let x = esc 2\n            y = esc 3\n        return $ x * y\n    return $ 1 + r\n</code></pre>\n\n<p>This becomes more interesting.\nThe code between <code>shift</code> and <code>reset</code> is actually squeezed into the calls of <code>esc</code>, in this simple example it's just <code>return $ 1 + r</code>. When we invoke <code>esc</code>, the whole computation is performed and its result becomes the result of the <code>esc</code> call. We do this twice, so essentially we invoke everything between <code>shift</code> and <code>reset</code> twice. And the result of the whole computation is <code>result $ x * y</code>, the result of the <code>shift</code> call.</p>\n\n<p>So in a sense, the <code>shift</code> block becomes the outer part of the computation and the block between <code>reset</code> and <code>shift</code> becomes the inner part of the computation.</p>\n\n<p>So far so good. But it becomes even more daunting if we invoke <code>shift</code> twice, like in this code sample:</p>\n\n<pre><code>list2 :: [(Int, String)]\nlist2 = evalCont . reset $ do\n    x &lt;- shift $ \\yieldx -&gt;\n        return $ concatMap yieldx [1, 2, 3]\n    y &lt;- shift $ \\yieldy -&gt;\n        return $ concatMap yieldy [\"a\", \"b\", \"c\"]\n    return [(x, y)]\n</code></pre>\n\n<p>And here is what it produces (hidden for those who want to try to figure it out as an exercise):</p>\n\n<blockquote class=\"spoiler\">\n  <p> <code>[(1,\"a\"),(1,\"b\"),(1,\"c\"),(2,\"a\"),(2,\"b\"),(2,\"c\"),(3,\"a\"),(3,\"b\"),(3,\"c\")]</code></p>\n</blockquote>\n\n<p>Now what happens is that the program is turned inside out <em>twice</em>:</p>\n\n<ol>\n<li>First everything outside the <code>x &lt;- shift ...</code> block is bound to the <code>yieldx</code> call, including the next <code>shift</code>. And the result of the computation is the result of the <code>x &lt;- shift ...</code> block.</li>\n<li>Second, when invoking the second <code>y &lt;- shift ...</code> inside <code>yieldx</code>, again the rest of the computation is bound to the <code>yieldy</code> call. And the result of this inner computation is the result of the <code>y &lt;- shift ...</code> block.</li>\n</ol>\n\n<p>So in <code>x &lt;- shift</code> we run the rest of the computation for each of the three arguments, and during each of them, we do a similar thing for each of the other three arguments. The result is then the Cartesian product of the two lists, as we essentially performed two nested loops.</p>\n\n<p>The same thing applies to <code>shiftT</code> and <code>resetT</code>, just with added side effects. For example, if we want to debug what is actually happening, we can run the above code in the <code>IO</code> monad and print debugging statements:</p>\n\n<pre><code>list2' :: IO [(Int, String)]\nlist2' = evalContT . resetT $ do\n    x &lt;- shiftT $ \\yield -&gt;\n        lift . liftM concat . mapM (\\n -&gt; print n &gt;&gt; yield n) $ [1, 2, 3]\n    y &lt;- shiftT $ \\yield -&gt;\n        lift . liftM concat . mapM (\\n -&gt; print n &gt;&gt; yield n) $ [\"a\", \"b\", \"c\"]\n    return [(x, y)]\n</code></pre>\n"}], "owner": {"reputation": 654, "user_id": 7501619, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/dfb3e55ff104cf8485859d00fc6ecbcb?s=128&d=identicon&r=PG&f=1", "display_name": "Taren", "link": "https://stackoverflow.com/users/7501619/taren"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 410, "favorite_count": 6, "accepted_answer_id": 43697115, "answer_count": 2, "score": 9, "last_activity_date": 1493583343, "creation_date": 1493468443, "last_edit_date": 1493497498, "question_id": 43695653, "link": "https://stackoverflow.com/questions/43695653/cont-monad-shift", "title": "Cont monad shift", "body": "<p>While trying to build some intuition for the ContT monad transformer I (perhaps unsurprisingly) found myself confused. The issue lies with the shiftT operation which doesn't seem to do anything useful.</p>\n\n<p>First a simplistic example of how one might use it</p>\n\n<pre><code>shiftT $ \\famr -&gt; lift $ do\n  a &lt;- calculateAFromEnvironment\n  famr a\n</code></pre>\n\n<p><code>famr a</code> could be some more complex expression as long as it returns some <code>m r</code>. Now an attempt to explain my intuition that shiftT is doesn't add anything:</p>\n\n<pre><code>-- inline shiftT\nContT (\\f2 -&gt; evalContT ((\\f1 -&gt; lift (do\n  a &lt;- calculateAFromEnvironment\n  f1 a)) f2))\n\n-- beta reduction\nContT (\\f2 -&gt; evalContT (lift (do\n  a &lt;- calculateAFromEnvironment\n  f2 a)))\n\n-- inline evalConT\nContT (\\f2 -&gt; runContT (lift (do\n  a &lt;- calculateAFromEnvironment\n  f2 a)) return)\n\n-- inline lift\nContT (\\f2 -&gt; runContT (ContT (\\f3 -&gt; (do\n  a &lt;- calculateAFromEnvironment\n  f2 a) &gt;&gt;= f3)) return)\n\n-- apply runConT\nContT (\\f2 -&gt; (\\f3 -&gt; (do\n  a &lt;- calculateAFromEnvironment\n  f2 a) &gt;&gt;= f3) return)\n\n-- beta reduce\nContT (\\f2 -&gt; (do\n  a &lt;- calculateAFromEnvironment\n  f2 a) &gt;&gt;= return)\n\n-- (&gt;&gt;= return) is identity\nContT $ \\f2 -&gt; do\n  a &lt;- calculateAFromEnvironment\n  f2 a\n</code></pre>\n\n<p>Turns out we could have just build the ContT directly.</p>\n\n<p>Question time: Is there a situation where shift/shiftT add anything over cont/ContT? Or are they just used to make the code more readable?</p>\n"}, {"tags": ["haskell"], "answers": [{"comments": [{"owner": {"reputation": 315, "user_id": 7940372, "user_type": "registered", "accept_rate": 58, "profile_image": "https://www.gravatar.com/avatar/3e5744471a061ee3bf3a29ce9bb5a4a7?s=128&d=identicon&r=PG&f=1", "display_name": "420fedoras", "link": "https://stackoverflow.com/users/7940372/420fedoras"}, "edited": false, "score": 0, "creation_date": 1493467670, "post_id": 43695386, "comment_id": 74435907, "body": "So simple! I guess I just assumed a list with 1 element would pass by that but I didnt consider that restOfString could be empty too."}], "tags": [], "owner": {"reputation": 100185, "user_id": 3234959, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/93bb12ca0f93dfddb33880316f7e66c2?s=128&d=identicon&r=PG&f=1", "display_name": "chi", "link": "https://stackoverflow.com/users/3234959/chi"}, "is_accepted": false, "score": 2, "last_activity_date": 1493466853, "creation_date": 1493466853, "answer_id": 43695386, "question_id": 43695243, "link": "https://stackoverflow.com/questions/43695243/error-message-generating-for-every-input-for-an-empty-list-case/43695386#43695386", "title": "Error message generating for every input for an empty list case", "body": "<p>This is wrong:</p>\n\n<pre><code>create h (head:restOfString) = ...\ncreate h [head]              = ...\n</code></pre>\n\n<p>when passing a list containing only one element, the <em>first</em> branch matches, with <code>restOfString</code> being empty. Hence, the second branch will never be taken.</p>\n\n<p>Put the second line first.</p>\n\n<p>If you turn on warnings with <code>-Wall</code>, GHC warns about many potential problems, including this one. I recommend it.</p>\n"}, {"comments": [{"owner": {"reputation": 315, "user_id": 7940372, "user_type": "registered", "accept_rate": 58, "profile_image": "https://www.gravatar.com/avatar/3e5744471a061ee3bf3a29ce9bb5a4a7?s=128&d=identicon&r=PG&f=1", "display_name": "420fedoras", "link": "https://stackoverflow.com/users/7940372/420fedoras"}, "edited": false, "score": 0, "creation_date": 1493467905, "post_id": 43695397, "comment_id": 74435966, "body": "Thanks, I didn&#39;t understand why it would be &quot;redundant&quot;, but chi&#39;s answer cleared that up for me"}], "tags": [], "owner": {"reputation": 24509, "user_id": 6863749, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/UyoQv.jpg?s=128&g=1", "display_name": "Li-yao Xia", "link": "https://stackoverflow.com/users/6863749/li-yao-xia"}, "is_accepted": false, "score": 0, "last_activity_date": 1493466897, "creation_date": 1493466897, "answer_id": 43695397, "question_id": 43695243, "link": "https://stackoverflow.com/questions/43695243/error-message-generating-for-every-input-for-an-empty-list-case/43695397#43695397", "title": "Error message generating for every input for an empty list case", "body": "<p>Your first two patterns overlap, so the first one always takes precedence over the second one. Swap them.</p>\n\n<p>This triggers a warning by default in GHC, remember to read the compiler's output. For a better coding experience, it is also advisable to enable <code>-Wall</code>.</p>\n"}], "owner": {"reputation": 315, "user_id": 7940372, "user_type": "registered", "accept_rate": 58, "profile_image": "https://www.gravatar.com/avatar/3e5744471a061ee3bf3a29ce9bb5a4a7?s=128&d=identicon&r=PG&f=1", "display_name": "420fedoras", "link": "https://stackoverflow.com/users/7940372/420fedoras"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 43, "favorite_count": 0, "answer_count": 2, "score": 0, "last_activity_date": 1493479594, "creation_date": 1493466007, "last_edit_date": 1493479594, "question_id": 43695243, "link": "https://stackoverflow.com/questions/43695243/error-message-generating-for-every-input-for-an-empty-list-case", "title": "Error message generating for every input for an empty list case", "body": "<p>I'm doing my second assignment in my first semester of learning coding using haskell, so I'm quite new to coding. My problem is that every input I test, empty or not, generates my error message for the empty case, why would this be?</p>\n\n<p>Type classes added for clarity. This is also part of an assignment so please only guide me for this one error :')</p>\n\n<pre><code>type Histogram a = Map a Int\ninc :: Ord a =&gt; Histogram a -&gt; a -&gt; Histogram a\n\ncreate\n  :: Ord a\n  =&gt; Histogram a -&gt; [a] -&gt; Histogram a\ncreate h (head:restOfString) = create (inc h head) restOfString\ncreate h [head]              = inc h head\ncreate h []                  = error \"No elements in string\"\n</code></pre>\n"}, {"tags": ["haskell", "haskell-snap-framework"], "answers": [{"comments": [{"owner": {"reputation": 799, "user_id": 1964881, "user_type": "registered", "accept_rate": 95, "profile_image": "https://i.stack.imgur.com/bVDPU.png?s=128&g=1", "display_name": "Gspia", "link": "https://stackoverflow.com/users/1964881/gspia"}, "edited": false, "score": 0, "creation_date": 1493528626, "post_id": 43698963, "comment_id": 74450892, "body": "Got the sources, which worked (at least it compiles), thank you! Do you have an opinion about the &quot;architecture&quot; (is this the way to combine ws with db)?"}, {"owner": {"reputation": 24509, "user_id": 6863749, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/UyoQv.jpg?s=128&g=1", "display_name": "Li-yao Xia", "link": "https://stackoverflow.com/users/6863749/li-yao-xia"}, "reply_to_user": {"reputation": 799, "user_id": 1964881, "user_type": "registered", "accept_rate": 95, "profile_image": "https://i.stack.imgur.com/bVDPU.png?s=128&g=1", "display_name": "Gspia", "link": "https://stackoverflow.com/users/1964881/gspia"}, "edited": false, "score": 0, "creation_date": 1493550217, "post_id": 43698963, "comment_id": 74455704, "body": "I&#39;m not familiar enough with the framework to tell the right way."}], "tags": [], "owner": {"reputation": 24509, "user_id": 6863749, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/UyoQv.jpg?s=128&g=1", "display_name": "Li-yao Xia", "link": "https://stackoverflow.com/users/6863749/li-yao-xia"}, "is_accepted": true, "score": 3, "last_activity_date": 1493489394, "creation_date": 1493489394, "answer_id": 43698963, "question_id": 43694461, "link": "https://stackoverflow.com/questions/43694461/how-to-combine-postgresql-snaplet-and-websockets/43698963#43698963", "title": "How to combine postgresql snaplet and websockets?", "body": "<p>The overlapping instance issue you ran into is a <a href=\"https://github.com/mightybyte/snaplet-postgresql-simple/issues/42\" rel=\"nofollow noreferrer\">bug in the snaplet-postgresql-simple library</a> that has been fixed but the fix has not yet been released. You might want to ask the maintainer about this.</p>\n\n<p>In the meantime you can either pull the latest version of the library from Github, or redefine a type different but isomorphic to <code>ReaderT (Snaplet Postgres)</code>, copying the <code>HasPostgres</code> instance.</p>\n"}], "owner": {"reputation": 799, "user_id": 1964881, "user_type": "registered", "accept_rate": 95, "profile_image": "https://i.stack.imgur.com/bVDPU.png?s=128&g=1", "display_name": "Gspia", "link": "https://stackoverflow.com/users/1964881/gspia"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 133, "favorite_count": 0, "accepted_answer_id": 43698963, "answer_count": 1, "score": 2, "last_activity_date": 1493489394, "creation_date": 1493461359, "last_edit_date": 1493472685, "question_id": 43694461, "link": "https://stackoverflow.com/questions/43694461/how-to-combine-postgresql-snaplet-and-websockets", "title": "How to combine postgresql snaplet and websockets?", "body": "<p>The following code tries to combine two examples that work separately:</p>\n\n<p><a href=\"https://ocharles.org.uk/blog/posts/2012-12-19-24-days-of-hackage-snap.html\" rel=\"nofollow noreferrer\">day 19 of 24 (2012)</a> and e.g. <a href=\"https://github.com/jaspervdj/websockets-snap/blob/master/example/server.hs\" rel=\"nofollow noreferrer\">ws example</a> but I took almost everything websocket related away to get a small example. </p>\n\n<p>Please, find the code below. The <code>msgHandler</code> is called by <code>helloDb</code>, which will get the the snaplet containing the db-connection and pass it to the <code>msgHandler</code>. The <a href=\"http://hackage.haskell.org/package/snaplet-postgresql-simple-1.0.1.0/docs/Snap-Snaplet-PostgresqlSimple.html\" rel=\"nofollow noreferrer\">snaplet-posgresql-simple docs</a> (at the end) give  convenience instances and an example how to use one of them in the Initializer monad.  </p>\n\n<p>When I take the two commented lines away, ghc say that there are two instances involving out-of-scope types and that instances do overlapp: <code>HasPostgres (ReaderT r m)</code> and <code>HasPostgres (ReaderT (Snaplet Postgres) m)</code>.</p>\n\n<p>So the question is, how to get the program to compile so that I could pass db-connection from the snaplet to the websocket-part. </p>\n\n<p>My goal is to make the websocket listen for messages, query db, and send messages pack. Other things that I already tried:</p>\n\n<ul>\n<li><code>aFun :: (MonadIO m, HasPostgres m) =&gt; ... m (..)</code> having both db-queries and websocket-things (both liftIO'd) compiles until <code>WS.runWebSocketsSnap</code> calls directly or indirectly <code>aFun</code>. </li>\n<li>Tried to tell <code>msgHandler :: (MonadIO m, HasPostgres m)</code> but then ghc says that there is no instance for <code>HasPosgres IO</code>. My feeling is that this should be doable without IO-instance. Or is it?</li>\n<li>The code below is trying to use snaplet in non-snaplet context but I'm not sure if this is the correct way.</li>\n</ul>\n\n<p>Is there a better approach to combining websockets and (db-) snaplets in snapframework? After trying several approaches I'm in serious mental lock state obviously needing help. Any help (even small hints about what kind of things I should start learning/refreshing), will be highly appreciated!</p>\n\n<pre><code>{-# LANGUAGE TemplateHaskell #-}                                                                                                                                                    \n{-# LANGUAGE OverloadedStrings #-}                                                                                                                                                  \n\nmodule Main where                                                                                                                                                                   \n\nimport Data.Maybe                                                                                                                                                                   \nimport Data.Monoid ((&lt;&gt;))                                                                                                                                                           \nimport Control.Lens                                                                                                                                                                 \nimport Control.Monad.Trans                                                                                                                                                          \nimport Control.Monad.Reader \nimport Snap.Snaplet                                                                                                                                                                 \nimport Snap.Snaplet.PostgresqlSimple                                                                                                                                                \nimport Snap.Http.Server                                                                                                                                                             \nimport Snap.Core as SC                                                                                                                                                              \nimport Data.ByteString as BS                                                                                                                                                        \nimport Data.Text (Text)                                                                                                                                                             \nimport qualified Data.Text as T                                                                                                                                                     \nimport qualified Data.Text.IO as T                                                                                                                                                  \nimport qualified Network.WebSockets as WS                                                                                                                                           \nimport qualified Network.WebSockets.Snap as WS                                                                                                                                      \n\nnewtype App = App { _db :: Snaplet Postgres }                                                                                                                                       \n\nmakeLenses ''App                                                                                                                                                                    \n\nmsgHandler :: (MonadIO m) =&gt; App -&gt; BS.ByteString -&gt; WS.PendingConnection -&gt; m ()                                                                                                   \nmsgHandler appSt mUId pending = do                                                                                                                                                  \n  conn &lt;- liftIO $ WS.acceptRequest pending                                                                                                                                         \n  -- res &lt;- liftIO $ runReaderT (query \"SELECT name FROM users WHERE id = ?\" (Only mUId)) dbSnaplet                                                                                 \n  -- liftIO $ print (res :: [Name])                                                                                                                                                 \n  liftIO $ T.putStrLn \"msgHandler ended\"                                                                                                                                            \n    where dbSnaplet = view db appSt                                                                                                                                                 \n\ninitApp :: SnapletInit App App                                                                                                                                                      \ninitApp = makeSnaplet \"myapp\" \"My application\" Nothing $                                                                                                                            \n  App &lt;$&gt; nestSnaplet \"db\" db pgsInit                                                                                                                                               \n      &lt;* addRoutes [(\"/hello/:id\", helloDb)]                                                                                                                                        \n\nnewtype Name = Name { _nm :: Text } deriving (Show, Eq)                                                                                                                             \n\ninstance FromRow Name where fromRow = Name &lt;$&gt; field                                                                                                                                \n\nhelloDb :: Handler App App ()                                                                                                                                                       \nhelloDb = do                                                                                                                                                                        \n  Just mUId &lt;- getParam \"id\"                                                                                                                                                        \n  userName &lt;- with db $ listToMaybe &lt;$&gt; query \"SELECT name FROM users     WHERE id = ?\" (Only mUId)                                                                                     \n  writeText $ maybe \"User not found\" (\\h -&gt; \"Hello, \" &lt;&gt; (T.pack . show) h) (userName :: Maybe Name)                                                                                \n  sStApp &lt;- getSnapletState                                                                                                                                                         \n  WS.runWebSocketsSnap $ msgHandler (view snapletValue sStApp) mUId                                                                                                                 \n\nmain :: IO ()                                                                                                                                                                       \nmain = serveSnaplet defaultConfig initApp                                                                                                                                           \n</code></pre>\n"}, {"tags": ["haskell"], "comments": [{"owner": {"reputation": 20829, "user_id": 1030110, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/bsgx2.png?s=128&g=1", "display_name": "m0nhawk", "link": "https://stackoverflow.com/users/1030110/m0nhawk"}, "edited": false, "score": 3, "creation_date": 1493451661, "post_id": 43693037, "comment_id": 74431888, "body": "Why do to want to avoid <code>import</code>? Then the only way is to write <code>digitToInt</code> by yourself."}, {"owner": {"reputation": 46235, "user_id": 2541573, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/Z1qtP.png?s=128&g=1", "display_name": "jub0bs", "link": "https://stackoverflow.com/users/2541573/jub0bs"}, "reply_to_user": {"reputation": 20829, "user_id": 1030110, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/bsgx2.png?s=128&g=1", "display_name": "m0nhawk", "link": "https://stackoverflow.com/users/1030110/m0nhawk"}, "edited": false, "score": 3, "creation_date": 1493456870, "post_id": 43693037, "comment_id": 74433113, "body": "@m0nhawk You could use <code>digitToInt</code> fully qualified: <code>Data.Char.digitToInt</code>. Technically, that doesn&#39;t require any import :p"}], "answers": [{"comments": [{"owner": {"reputation": 18798, "user_id": 4543207, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/8ed6f11c827fa7cef811f141a84cc14b?s=128&d=identicon&r=PG&f=1", "display_name": "Redu", "link": "https://stackoverflow.com/users/4543207/redu"}, "edited": false, "score": 0, "creation_date": 1493453682, "post_id": 43693157, "comment_id": 74432395, "body": "This should be the way but it would be nicer to return the provided argument itself if not a digit character or an integer instead of Just integer"}, {"owner": {"reputation": 2313, "user_id": 5318306, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/897fd4f3b92d28c5c1eb28a8024661a1?s=128&d=identicon&r=PG&f=1", "display_name": "Gurkenglas", "link": "https://stackoverflow.com/users/5318306/gurkenglas"}, "edited": false, "score": 0, "creation_date": 1493455092, "post_id": 43693157, "comment_id": 74432681, "body": "That&#39;s equivalent, as in the difference between <a href=\"https://hackage.haskell.org/package/lens-4.15.2/docs/Control-Lens-Prism.html#v:prism\" rel=\"nofollow noreferrer\">prism</a> and <a href=\"https://hackage.haskell.org/package/lens-4.15.2/docs/Control-Lens-Prism.html#v:prism-39-\" rel=\"nofollow noreferrer\">prism&#39;</a>."}, {"owner": {"reputation": 94713, "user_id": 1139697, "user_type": "registered", "accept_rate": 86, "profile_image": "https://www.gravatar.com/avatar/5f136ddb684f39aaee1c028ee1950f6f?s=128&d=identicon&r=PG", "display_name": "Zeta", "link": "https://stackoverflow.com/users/1139697/zeta"}, "reply_to_user": {"reputation": 18798, "user_id": 4543207, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/8ed6f11c827fa7cef811f141a84cc14b?s=128&d=identicon&r=PG&f=1", "display_name": "Redu", "link": "https://stackoverflow.com/users/4543207/redu"}, "edited": false, "score": 0, "creation_date": 1493457231, "post_id": 43693157, "comment_id": 74433207, "body": "@Redu I think that&#39;s mostly personal preference. If you want to transform a <code>a -&gt; Maybe b</code> into a <code>a -&gt; Either a b</code>, you can just use <code>liftEither f c = maybe (Left c) Right (f c)</code>."}], "tags": [], "owner": {"reputation": 94713, "user_id": 1139697, "user_type": "registered", "accept_rate": 86, "profile_image": "https://www.gravatar.com/avatar/5f136ddb684f39aaee1c028ee1950f6f?s=128&d=identicon&r=PG", "display_name": "Zeta", "link": "https://stackoverflow.com/users/1139697/zeta"}, "is_accepted": false, "score": 3, "last_activity_date": 1493452051, "creation_date": 1493452051, "answer_id": 43693157, "question_id": 43693037, "link": "https://stackoverflow.com/questions/43693037/how-to-convert-char-to-int-in-haskell-without-import-anything/43693157#43693157", "title": "How to convert Char to Int in Haskell WITHOUT IMPORT anything?", "body": "<p>As there are only ten valid digits in your usual ASCII code, why don't you write the function yourself? You can make it non-partial while you're at it:</p>\n\n<pre><code>digitToInt :: Char -&gt; Maybe Int\ndigitToInt c = lookup c (zip ['0'..'9'] [0..9])\n</code></pre>\n"}, {"tags": [], "owner": {"reputation": 100185, "user_id": 3234959, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/93bb12ca0f93dfddb33880316f7e66c2?s=128&d=identicon&r=PG&f=1", "display_name": "chi", "link": "https://stackoverflow.com/users/3234959/chi"}, "is_accepted": false, "score": 2, "last_activity_date": 1493453534, "creation_date": 1493453534, "answer_id": 43693346, "question_id": 43693037, "link": "https://stackoverflow.com/questions/43693037/how-to-convert-char-to-int-in-haskell-without-import-anything/43693346#43693346", "title": "How to convert Char to Int in Haskell WITHOUT IMPORT anything?", "body": "<p>You could use <code>fromEnum</code>, e.g.</p>\n\n<pre><code>&gt; fromEnum '5' - fromEnum '0'\n5\n</code></pre>\n\n<p>Watch out for non-digit characters.</p>\n\n<p>The best option, though, is to use the library function.</p>\n"}], "owner": {"reputation": 11, "user_id": 7935120, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/505357941102bf94dd41a6c459db4859?s=128&d=identicon&r=PG&f=1", "display_name": "Andrew Han", "link": "https://stackoverflow.com/users/7935120/andrew-han"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 2747, "favorite_count": 0, "answer_count": 2, "score": 1, "last_activity_date": 1493453534, "creation_date": 1493451191, "last_edit_date": 1493451580, "question_id": 43693037, "link": "https://stackoverflow.com/questions/43693037/how-to-convert-char-to-int-in-haskell-without-import-anything", "title": "How to convert Char to Int in Haskell WITHOUT IMPORT anything?", "body": "<p>Following is a part of my code:</p>\n\n<pre><code>expand :: String -&gt; [(Char,Int)]\nexpand \"\" = []\nexpand (a:b:xs) = [(a,digitToInt b)] ++ expand xs\n</code></pre>\n\n<p>The aim of the expand function is just get a string like this form <code>\"a1b2c3d4\"</code> and output<code>[('a',1),('b',2),('c',3),('d',4)]</code>, my code can do this but have to use <code>digitToInt</code>, and need to add <code>import Data.Char</code></p>\n\n<p>So ya, if I don't wanna use any <code>import</code> keywords, how can I convert <code>Char</code> to <code>Int</code>.</p>\n"}, {"tags": ["haskell"], "answers": [{"comments": [{"owner": {"reputation": 25, "user_id": 7935016, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/765b1455958b5ba4e3dccd6912f5caa8?s=128&d=identicon&r=PG&f=1", "display_name": "joeo", "link": "https://stackoverflow.com/users/7935016/joeo"}, "edited": false, "score": 0, "creation_date": 1493450815, "post_id": 43692928, "comment_id": 74431666, "body": "you were right.. the lambda function was unnecessary."}], "tags": [], "owner": {"reputation": 66318, "user_id": 3510736, "user_type": "registered", "accept_rate": 78, "profile_image": "https://i.stack.imgur.com/kVtHP.jpg?s=128&g=1", "display_name": "Ami Tavory", "link": "https://stackoverflow.com/users/3510736/ami-tavory"}, "is_accepted": true, "score": 1, "last_activity_date": 1493450471, "creation_date": 1493450471, "answer_id": 43692928, "question_id": 43692797, "link": "https://stackoverflow.com/questions/43692797/show-recursively-data-type/43692928#43692928", "title": "Show recursively data type", "body": "<p>Since <code>show</code> returns <code>String</code>, you can concatenate multiple invocations of <code>show</code> via `++:</p>\n\n<pre><code>instance (Show boss, Show action) =&gt; Show (Person boss action) where\n    show  p =  \"salary: \" ++ show (salary p) ++ \" act \" ++ show (act p) ++ \" b \" ++ show (b p) ++ \" subordinates \" ++ intercalate \"i \" (map show (subordinates p))\n</code></pre>\n\n<p>For example, this code</p>\n\n<pre><code>import Data.List                                                                                                                                                                                        \n\ndata Person boss action = Person {\nsalary  :: Float,\nsubordinates :: [Person boss action],\nact :: action,\nb :: boss\n}\n\ninstance (Show boss, Show action) =&gt; Show (Person boss action) where\n    show  p =  \"salary: \" ++ show (salary p) ++ \" act \" ++ show (act p) ++ \" b \" ++ show (b p) ++ \" subordinates \" ++ intercalate \"i \" (map show (subordinates p))\n\nmain =\n    let\n        a = Person { salary=1, subordinates=[], act=1, b=1 }\n        aa = Person { salary=2, subordinates=[a], act=2, b=2 }\n    in\n        do\n            putStrLn $ show aa\n</code></pre>\n\n<p>outputs</p>\n\n<pre><code>salary: 2.0 act 2 b 2 subordinates salary: 1.0 act 1 b 1 subordinates\n</code></pre>\n\n<hr>\n\n<p>Incidentally, note that</p>\n\n<pre><code>map (\\x -&gt; show x) ...\n</code></pre>\n\n<p>can be written as</p>\n\n<pre><code>map show ...\n</code></pre>\n"}], "owner": {"reputation": 25, "user_id": 7935016, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/765b1455958b5ba4e3dccd6912f5caa8?s=128&d=identicon&r=PG&f=1", "display_name": "joeo", "link": "https://stackoverflow.com/users/7935016/joeo"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 93, "favorite_count": 0, "accepted_answer_id": 43692928, "answer_count": 1, "score": 1, "last_activity_date": 1493450471, "creation_date": 1493449500, "question_id": 43692797, "link": "https://stackoverflow.com/questions/43692797/show-recursively-data-type", "title": "Show recursively data type", "body": "<p>I have the following recursive data type :</p>\n\n<pre><code>data Person boss action = Person{\n  salary  :: Float,\n  subordinates :: [Person boss action],\n  act :: action\n  b :: boss\n }\n</code></pre>\n\n<p>and I need a function to print all the fields of the current Person and then call the function repeatedly. From what I can see show can only take one argument. I was trying something like:</p>\n\n<pre><code>instance (Show boss, Show action) =&gt; Show (Person boss action) where\n    show  p =  (show (salary p) (act p) (b p)) map (\\x -&gt; show x) (subordinates p)\n</code></pre>\n"}, {"tags": ["haskell", "audio", "wav"], "comments": [{"owner": {"reputation": 3416, "user_id": 2484972, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/ea1c4b2c5aa3c7da2f2740bc1a643ee0?s=128&d=identicon&r=PG", "display_name": "Tatsuyuki Ishi", "link": "https://stackoverflow.com/users/2484972/tatsuyuki-ishi"}, "edited": false, "score": 2, "creation_date": 1493449429, "post_id": 43692774, "comment_id": 74431343, "body": "It looks like the library is incomplete and you tried to play an unimplemented format. Try finding alternatives."}, {"owner": {"reputation": 100892, "user_id": 745903, "user_type": "registered", "accept_rate": 74, "profile_image": "https://www.gravatar.com/avatar/50933f6638836741e620669b3940410e?s=128&d=identicon&r=PG", "display_name": "leftaroundabout", "link": "https://stackoverflow.com/users/745903/leftaroundabout"}, "edited": false, "score": 1, "creation_date": 1493470104, "post_id": 43692774, "comment_id": 74436644, "body": "Right. AFAIK, <a href=\"http://hackage.haskell.org/package/hsndfile-storablevector\" rel=\"nofollow noreferrer\"><code>hsndfile-storablevector</code></a> is the most usable audio-file loader at the moment. There&#39;s <a href=\"https://github.com/acowley/ffmpeg-light/issues/21\" rel=\"nofollow noreferrer\">work on progress</a> on the much more powerful ffmpeg&#39;s bindings. A native Haskell solution like <code>WAVE</code> is may sure be appealing, but it&#39;s somewhat infeasible due to the vast number of different audio formats around."}, {"owner": {"reputation": 622, "user_id": 525332, "user_type": "registered", "accept_rate": 88, "profile_image": "https://www.gravatar.com/avatar/e1b627d65d47e7ad08d669b0de9c23d2?s=128&d=identicon&r=PG", "display_name": "ironchicken", "link": "https://stackoverflow.com/users/525332/ironchicken"}, "edited": false, "score": 0, "creation_date": 1493472443, "post_id": 43692774, "comment_id": 74437265, "body": "The <code>file</code> command will give you some hints on the type of WAV file you have. There&#39;s also a <code>mediainfo</code> command on some systems."}, {"owner": {"reputation": 1247, "user_id": 3485629, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/640b2583577ec470ac273b27f78025d5?s=128&d=identicon&r=PG", "display_name": "basile-henry", "link": "https://stackoverflow.com/users/3485629/basile-henry"}, "edited": false, "score": 1, "creation_date": 1493485488, "post_id": 43692774, "comment_id": 74441504, "body": "Also the WAVE library doesn&#39;t &quot;play&quot; a .wav file as OP intended. It is only meant for parsing and writing .wav files not playing them, you will need another library for that: <a href=\"https://hackage.haskell.org/package/SDL-mixer-0.6.2.0\" rel=\"nofollow noreferrer\">SDL-mixer</a> is one of several libraries that can play a sound file."}], "owner": {"reputation": 4029, "user_id": 3224967, "user_type": "registered", "accept_rate": 72, "profile_image": "https://www.gravatar.com/avatar/963b108f3bcde98ac96d09b04abbf63f?s=128&d=identicon&r=PG&f=1", "display_name": "mherzl", "link": "https://stackoverflow.com/users/3224967/mherzl"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 34, "favorite_count": 0, "answer_count": 0, "score": 0, "last_activity_date": 1493449346, "creation_date": 1493449346, "question_id": 43692774, "link": "https://stackoverflow.com/questions/43692774/pcm-only-for-now-error-called-at-data-wave-hs12711-in-wave-0-1-3", "title": "&quot;PCM only for now&quot; error, called at ./Data/WAVE.hs:127:11 in WAVE-0.1.3", "body": "<p>I am attempting to play a .wav file, and am trying Hackage's <a href=\"https://hackage.haskell.org/package/WAVE\" rel=\"nofollow noreferrer\">WAVE audio file IO library</a> to do so.</p>\n\n<p>I generated a recording <code>myrecording.wav</code> and in the same directory placed this simple program:</p>\n\n<pre><code>module PlayWave where\n\nimport Data.WAVE\n\npath :: String\npath = \"myrecording.wav\"\n\nmain = do\n  getWAVEFile path\n</code></pre>\n\n<p>I try to run it with <code>$ runhaskell PlayWav.hs</code> and get the following error:</p>\n\n<pre><code>$ runhaskell PlayWav.hs \nPlayWav.hs: PCM only for now\nCallStack (from HasCallStack):\n  error, called at ./Data/WAVE.hs:127:11 in WAVE-0.1.3-EDUsomPiULdBJaA1HF9vpg:Data.WAVE\n</code></pre>\n\n<p>The reported error corresponds to line 127 of <a href=\"https://github.com/BartMassey/wave/blob/8a62127ffe684066003feb2fc1a52ae25a93d509/Data/WAVE.hs\" rel=\"nofollow noreferrer\">this</a> file in WAVE's source code.\nI see the error case there but do not understand why my code could be causing that failure.</p>\n\n<p>Am on macOS Sierra 10.12.4</p>\n"}, {"tags": ["haskell", "type-families", "type-variables"], "comments": [{"owner": {"reputation": 24509, "user_id": 6863749, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/UyoQv.jpg?s=128&g=1", "display_name": "Li-yao Xia", "link": "https://stackoverflow.com/users/6863749/li-yao-xia"}, "edited": false, "score": 1, "creation_date": 1493433670, "post_id": 43690990, "comment_id": 74428637, "body": "Can you give more context about why you need this, so we have an idea of what kind of workaround would be acceptable? How about another type family: <code>type family Elem e l :: Bool</code>? Then <code>forall a. (Elem a l ~ False) =&gt; ...</code> would actually quantify over the same types, but it&#39;s not clear whether it works for your purposes."}, {"owner": {"reputation": 57219, "user_id": 33796, "user_type": "registered", "accept_rate": 70, "profile_image": "https://www.gravatar.com/avatar/08727b23ba62e634b32988cdff082663?s=128&d=identicon&r=PG", "display_name": "luqui", "link": "https://stackoverflow.com/users/33796/luqui"}, "edited": false, "score": 1, "creation_date": 1493449368, "post_id": 43690990, "comment_id": 74431332, "body": "If you use a skolem type (e.g. <code>data A</code>) instead of a type variable, this could work, depending on what you need.  That is, just instantiate the type variable(s) with &quot;fresh&quot; concrete types."}, {"owner": {"reputation": 100185, "user_id": 3234959, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/93bb12ca0f93dfddb33880316f7e66c2?s=128&d=identicon&r=PG&f=1", "display_name": "chi", "link": "https://stackoverflow.com/users/3234959/chi"}, "edited": false, "score": 2, "creation_date": 1493453780, "post_id": 43690990, "comment_id": 74432424, "body": "Perhaps you want something like <a href=\"http://hackage.haskell.org/package/constraints-0.9.1/docs/Data-Constraint-Forall.html\" rel=\"nofollow noreferrer\"><code>Data.Constraint.Forall</code></a> ?"}, {"owner": {"reputation": 5328, "user_id": 325809, "user_type": "registered", "accept_rate": 70, "profile_image": "https://www.gravatar.com/avatar/b858606c4daae58cfdb362bf2fc4caa5?s=128&d=identicon&r=PG", "display_name": "fakedrake", "link": "https://stackoverflow.com/users/325809/fakedrake"}, "reply_to_user": {"reputation": 100185, "user_id": 3234959, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/93bb12ca0f93dfddb33880316f7e66c2?s=128&d=identicon&r=PG&f=1", "display_name": "chi", "link": "https://stackoverflow.com/users/3234959/chi"}, "edited": false, "score": 0, "creation_date": 1493491771, "post_id": 43690990, "comment_id": 74443591, "body": "@chi @li-yao-xia That looks promising but it is not clear how I would be able to write a type function that would <code>forall a . Index Int (Either a (Either Int (Either Char Void))</code> evaluate to <code>S Z</code>"}, {"owner": {"reputation": 5328, "user_id": 325809, "user_type": "registered", "accept_rate": 70, "profile_image": "https://www.gravatar.com/avatar/b858606c4daae58cfdb362bf2fc4caa5?s=128&d=identicon&r=PG", "display_name": "fakedrake", "link": "https://stackoverflow.com/users/325809/fakedrake"}, "reply_to_user": {"reputation": 24509, "user_id": 6863749, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/UyoQv.jpg?s=128&g=1", "display_name": "Li-yao Xia", "link": "https://stackoverflow.com/users/6863749/li-yao-xia"}, "edited": false, "score": 1, "creation_date": 1493492293, "post_id": 43690990, "comment_id": 74443736, "body": "@li-yao-xia the question mostly aims at triggering a discussion around the subject. It&#39;s something I have encountered one way or another multiple times and I would like to know what people have to say about it. It&#39;s not anchored to a particular use case."}], "owner": {"reputation": 5328, "user_id": 325809, "user_type": "registered", "accept_rate": 70, "profile_image": "https://www.gravatar.com/avatar/b858606c4daae58cfdb362bf2fc4caa5?s=128&d=identicon&r=PG", "display_name": "fakedrake", "link": "https://stackoverflow.com/users/325809/fakedrake"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 54, "favorite_count": 0, "answer_count": 0, "score": 3, "last_activity_date": 1493430155, "creation_date": 1493430155, "question_id": 43690990, "link": "https://stackoverflow.com/questions/43690990/type-families-to-check-validity-rather-than-satisfiability", "title": "Type families to check validity rather than satisfiability", "body": "<p>Consider the following code</p>\n\n<pre><code>{-# LANGUAGE UndecidableInstances #-}\n{-# LANGUAGE TypeOperators #-}\n{-# LANGUAGE ScopedTypeVariables #-}\n{-# LANGUAGE DataKinds #-}\n{-# LANGUAGE TypeFamilies #-}\nmodule Test () where\n\nimport Data.Proxy\nimport Data.Void\nimport GHC.TypeLits\n\ndata N = S N | Z\ntype family Index e l where\n  Index e (Either e x) = 'Z\n  Index e (Either e' y) = S (Index e y)\n  Index e Void = TypeError ('Text \" not found\")\n</code></pre>\n\n<p>Loading this on GHCi I run the followung</p>\n\n<pre><code>\u03bb&gt; :set -XRankNTypes\n\u03bb&gt; :kind! forall a . Index a (Either a Void)\nforall a . Index a (Either a Void) :: N\n= 'Z\n\u03bb&gt; :kind! forall a . Index a (Either a (Either Int Void))\nforall a . Index a (Either a (Either Int Void)) :: N\n= 'Z\n\u03bb&gt; :kind! forall a . Index a (Either Int (Either a Void))\nforall a . Index a (Either Int (Either a Void)) :: N\n= Index a (Either Int (Either a Void))\n\u03bb&gt; :kind! Index Char (Either Int (Either Char Void))\nIndex Char (Either Int (Either Char Void)) :: N\n= 'S 'Z\n</code></pre>\n\n<p>Now it is obvious that GHC does not evaluate <code>Index e (Either Int y) =\nS (Index e y)</code> because <code>e</code> might be <code>Int</code> so it just stops. Is there a\nway to universally quantify <code>e</code> so that if <code>e ~ Int</code> does not work\nforall <code>e</code>, then go on? Ideally I would like to get:</p>\n\n<pre><code>\u03bb&gt; :kind! forall a . Index a (Either Int (Either Char Void))\nforall a . Index a (Either Int (Either Char Void)) :: N\n= 'S ('S (TypeError ...))\n</code></pre>\n"}, {"tags": ["haskell", "recursion"], "comments": [{"owner": {"reputation": 12194, "user_id": 4474419, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/04ce27f0ebe4713b51911cd8475c3b42?s=128&d=identicon&r=PG", "display_name": "Davislor", "link": "https://stackoverflow.com/users/4474419/davislor"}, "edited": false, "score": 0, "creation_date": 1493397870, "post_id": 43684843, "comment_id": 74416459, "body": "Can you use a helper function?"}, {"owner": {"reputation": 94713, "user_id": 1139697, "user_type": "registered", "accept_rate": 86, "profile_image": "https://www.gravatar.com/avatar/5f136ddb684f39aaee1c028ee1950f6f?s=128&d=identicon&r=PG", "display_name": "Zeta", "link": "https://stackoverflow.com/users/1139697/zeta"}, "edited": false, "score": 2, "creation_date": 1493397911, "post_id": 43684843, "comment_id": 74416484, "body": "Why do you need to recurse? You want to show them only once, right? <code>showRow (x:xs) = &#39;|&#39; : showCell x : xs ++ &quot;|\\n&quot;</code>? It&#39;s uncertain since we don&#39;t know the lists type. And if you need to use <code>showCell</code> on every element, use <code>&quot;|&quot; ++ map showCell xs ++ &quot;|\\n&quot;</code>."}, {"owner": {"reputation": 12194, "user_id": 4474419, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/04ce27f0ebe4713b51911cd8475c3b42?s=128&d=identicon&r=PG", "display_name": "Davislor", "link": "https://stackoverflow.com/users/4474419/davislor"}, "reply_to_user": {"reputation": 94713, "user_id": 1139697, "user_type": "registered", "accept_rate": 86, "profile_image": "https://www.gravatar.com/avatar/5f136ddb684f39aaee1c028ee1950f6f?s=128&d=identicon&r=PG", "display_name": "Zeta", "link": "https://stackoverflow.com/users/1139697/zeta"}, "edited": false, "score": 0, "creation_date": 1493398147, "post_id": 43684843, "comment_id": 74416578, "body": "@Zeta Presumably because it\u2019s homework."}, {"owner": {"reputation": 922, "user_id": 2923589, "user_type": "registered", "accept_rate": 77, "profile_image": "https://www.gravatar.com/avatar/ba91f50d535333744c2d5ddb1ce05412?s=128&d=identicon&r=PG&f=1", "display_name": "Tamas Koos", "link": "https://stackoverflow.com/users/2923589/tamas-koos"}, "edited": false, "score": 0, "creation_date": 1493398351, "post_id": 43684843, "comment_id": 74416682, "body": "Yes, it is homework, but it actually wasn&#39;t a requirement to make it recursive and I didn&#39;t know about map, so thank you for the idea, I could make it work with that."}], "answers": [{"tags": [], "owner": {"reputation": 62252, "user_id": 1435869, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/TrEd9.jpg?s=128&g=1", "display_name": "karakfa", "link": "https://stackoverflow.com/users/1435869/karakfa"}, "is_accepted": true, "score": 0, "last_activity_date": 1493430783, "creation_date": 1493430783, "answer_id": 43691037, "question_id": 43684843, "link": "https://stackoverflow.com/questions/43684843/recursive-function-put-character-in-front-of-list-only-once/43691037#43691037", "title": "Recursive function put character in front of list only once", "body": "<p>This is not the right solution for your problem (follow the recommended <code>map</code> method in the comments), but to show one way of handling recursive function with different first and last behavior</p>\n\n<pre><code>showRow [] = []\nshowRow x = go x True\n    where go x True   = '|': go x False\n          go [] _     = \"\\n\"\n          go (x:xs) _ = (showCell x) ++ ('|': go xs False)\n</code></pre>\n\n<p>a dummy boolean triggers the initial value handling and empty list triggers the final value handing.</p>\n"}], "owner": {"reputation": 922, "user_id": 2923589, "user_type": "registered", "accept_rate": 77, "profile_image": "https://www.gravatar.com/avatar/ba91f50d535333744c2d5ddb1ce05412?s=128&d=identicon&r=PG&f=1", "display_name": "Tamas Koos", "link": "https://stackoverflow.com/users/2923589/tamas-koos"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 154, "favorite_count": 0, "accepted_answer_id": 43691037, "answer_count": 1, "score": 0, "last_activity_date": 1493430783, "creation_date": 1493396679, "last_edit_date": 1493400590, "question_id": 43684843, "link": "https://stackoverflow.com/questions/43684843/recursive-function-put-character-in-front-of-list-only-once", "title": "Recursive function put character in front of list only once", "body": "<p>So I have to write a recursive function which replaces the given word list with letters using a former function. That part works perfectly. But I also have to put a <code>'|'</code> symbol in front of the list and the same symbol and a <code>'\\n'</code> symbol after the list. I have this code right now:</p>\n\n<pre><code>showRow [] = []\nshowRow (x:xs) = '|' : showCell x : showRow xs ++ ['|'] ++ ['\\n']\n</code></pre>\n\n<p>This puts the first symbol before every letter and the two other symbols after the list multiple times. How can I add these symbols to the start and end of the list only once within this function?</p>\n"}, {"tags": ["haskell"], "comments": [{"owner": {"reputation": 1735, "user_id": 2892792, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/5DNyi.jpg?s=128&g=1", "display_name": "Lazersmoke", "link": "https://stackoverflow.com/users/2892792/lazersmoke"}, "edited": false, "score": 0, "creation_date": 1493395417, "post_id": 43684258, "comment_id": 74414949, "body": "Have you tried <code>f x</code>?"}, {"owner": {"reputation": 590, "user_id": 3029543, "user_type": "registered", "accept_rate": 80, "profile_image": "https://graph.facebook.com/100004855955180/picture?type=large", "display_name": "ptkato", "link": "https://stackoverflow.com/users/3029543/ptkato"}, "reply_to_user": {"reputation": 1735, "user_id": 2892792, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/5DNyi.jpg?s=128&g=1", "display_name": "Lazersmoke", "link": "https://stackoverflow.com/users/2892792/lazersmoke"}, "edited": false, "score": 0, "creation_date": 1493395512, "post_id": 43684258, "comment_id": 74415003, "body": "@Lazersmoke, yes, but the problem is, what do I do with the <code>y</code>? Discard it?"}, {"owner": {"reputation": 1735, "user_id": 2892792, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/5DNyi.jpg?s=128&g=1", "display_name": "Lazersmoke", "link": "https://stackoverflow.com/users/2892792/lazersmoke"}, "edited": false, "score": 2, "creation_date": 1493395794, "post_id": 43684258, "comment_id": 74415201, "body": "It depends completely what you want to do. I think the only two sensible and general possibilities are discarding x and discarding y. Why are you making a Monad instance? What is your use case? That should inform your implementation."}, {"owner": {"reputation": 590, "user_id": 3029543, "user_type": "registered", "accept_rate": 80, "profile_image": "https://graph.facebook.com/100004855955180/picture?type=large", "display_name": "ptkato", "link": "https://stackoverflow.com/users/3029543/ptkato"}, "reply_to_user": {"reputation": 1735, "user_id": 2892792, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/5DNyi.jpg?s=128&g=1", "display_name": "Lazersmoke", "link": "https://stackoverflow.com/users/2892792/lazersmoke"}, "edited": false, "score": 0, "creation_date": 1493396359, "post_id": 43684258, "comment_id": 74415528, "body": "That&#39;s clarifying. Is there any reason for something among the lines of <code>m a -&gt; (a -&gt; a -&gt; m b) -&gt; m b</code> not exist?"}, {"owner": {"reputation": 1735, "user_id": 2892792, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/5DNyi.jpg?s=128&g=1", "display_name": "Lazersmoke", "link": "https://stackoverflow.com/users/2892792/lazersmoke"}, "edited": false, "score": 1, "creation_date": 1493396933, "post_id": 43684258, "comment_id": 74415871, "body": "Only that no one has had a good use case for it. If that type signature truly matches your use case, then you should use that instead of Monad. Also, <code>a -&gt; a -&gt; m b</code> is isomorphic to <code>(a,a) -&gt; m b</code> fwiw."}, {"owner": {"reputation": 126897, "user_id": 791604, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/ce991df7a056248d5e4f6fc3659ba733?s=128&d=identicon&r=PG", "display_name": "Daniel Wagner", "link": "https://stackoverflow.com/users/791604/daniel-wagner"}, "reply_to_user": {"reputation": 1735, "user_id": 2892792, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/5DNyi.jpg?s=128&g=1", "display_name": "Lazersmoke", "link": "https://stackoverflow.com/users/2892792/lazersmoke"}, "edited": false, "score": 2, "creation_date": 1493397691, "post_id": 43684258, "comment_id": 74416361, "body": "@Lazersmoke I suspect either discarding <code>x</code> or discarding <code>y</code> will lead to trouble with the <code>m &gt;&gt;= return = m</code> law. See my answer for a proposed instance which discards neither."}, {"owner": {"reputation": 1735, "user_id": 2892792, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/5DNyi.jpg?s=128&g=1", "display_name": "Lazersmoke", "link": "https://stackoverflow.com/users/2892792/lazersmoke"}, "edited": false, "score": 0, "creation_date": 1493442301, "post_id": 43684258, "comment_id": 74429911, "body": "Yeah that is correct, my bad"}], "answers": [{"comments": [{"owner": {"reputation": 37219, "user_id": 1523776, "user_type": "moderator", "accept_rate": 87, "profile_image": "https://www.gravatar.com/avatar/b3e0b5c8e42a8c38009ef2d969f8dabb?s=128&d=identicon&r=PG", "display_name": "Benjamin Hodgson", "link": "https://stackoverflow.com/users/1523776/benjamin-hodgson"}, "edited": false, "score": 0, "creation_date": 1493398303, "post_id": 43685083, "comment_id": 74416656, "body": "I&#39;m not convinced of your associativity proof. I tried it with <code>data Pair a = Pair { one :: a, two :: a }</code> (I suspected the <code>Baz</code>-<code>Baz</code> case, and I didn&#39;t want to have to think about case analysis) and it didn&#39;t work out. Intuitively it makes sense that <code>Pair</code> isn&#39;t a monad, because you have no way of combining <code>a</code>s."}, {"owner": {"reputation": 126897, "user_id": 791604, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/ce991df7a056248d5e4f6fc3659ba733?s=128&d=identicon&r=PG", "display_name": "Daniel Wagner", "link": "https://stackoverflow.com/users/791604/daniel-wagner"}, "reply_to_user": {"reputation": 37219, "user_id": 1523776, "user_type": "moderator", "accept_rate": 87, "profile_image": "https://www.gravatar.com/avatar/b3e0b5c8e42a8c38009ef2d969f8dabb?s=128&d=identicon&r=PG", "display_name": "Benjamin Hodgson", "link": "https://stackoverflow.com/users/1523776/benjamin-hodgson"}, "edited": false, "score": 1, "creation_date": 1493398421, "post_id": 43685083, "comment_id": 74416720, "body": "@BenjaminHodgson For that type, we have <code>return x = Pair x x; Pair x y &gt;&gt;= f = Pair (one (f x)) (two (f y))</code> and this is <i>definitely</i> a Monad because it is completely isomorphic to <code>type Pair a = Bool -&gt; a</code>. What did you try exactly that suggests it &quot;didn&#39;t work out&quot;?"}, {"owner": {"reputation": 37219, "user_id": 1523776, "user_type": "moderator", "accept_rate": 87, "profile_image": "https://www.gravatar.com/avatar/b3e0b5c8e42a8c38009ef2d969f8dabb?s=128&d=identicon&r=PG", "display_name": "Benjamin Hodgson", "link": "https://stackoverflow.com/users/1523776/benjamin-hodgson"}, "edited": false, "score": 0, "creation_date": 1493398548, "post_id": 43685083, "comment_id": 74416781, "body": "Scratch that, I&#39;d made an error in my calculation :)"}, {"owner": {"reputation": 11487, "user_id": 1308058, "user_type": "registered", "accept_rate": 61, "profile_image": "https://www.gravatar.com/avatar/2be2ab74793559ea1c1dbdf55ccdf90b?s=128&d=identicon&r=PG", "display_name": "phadej", "link": "https://stackoverflow.com/users/1308058/phadej"}, "edited": false, "score": 0, "creation_date": 1493500079, "post_id": 43685083, "comment_id": 74445983, "body": "Your <code>Bool -&gt;</code> analogue could mention <code>Representable</code> functors. The <code>Foo</code> isn&#39;t representable however. I use a different logic there, the &quot;representation&quot; forms a <code>Monoid</code>, your example is <code>Max</code>, <code>Product</code> is a <code>Min</code>. I&#39;m not sure whether <code>Max</code> approach would work for <code>Foo = Bar a | Baz a a | Quu a a a</code>"}, {"owner": {"reputation": 31243, "user_id": 2751851, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/4ddc0.png?s=128&g=1", "display_name": "duplode", "link": "https://stackoverflow.com/users/2751851/duplode"}, "edited": false, "score": 0, "creation_date": 1523826952, "post_id": 43685083, "comment_id": 86708641, "body": "<code>Foo</code> is also isomorphic to <code>Either a (Pair a)</code>. That gives rise to the first monad instance, via the <code>Monad m =&gt; Either a (m a)</code> construction winitzki told us about <a href=\"https://stackoverflow.com/a/49703783/2751851\">here</a>."}], "tags": [], "owner": {"reputation": 126897, "user_id": 791604, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/ce991df7a056248d5e4f6fc3659ba733?s=128&d=identicon&r=PG", "display_name": "Daniel Wagner", "link": "https://stackoverflow.com/users/791604/daniel-wagner"}, "is_accepted": true, "score": 14, "last_activity_date": 1493400559, "last_edit_date": 1493400559, "creation_date": 1493397505, "answer_id": 43685083, "question_id": 43684258, "link": "https://stackoverflow.com/questions/43684258/how-to-define-a-monad-instance-to-types-with-multiple-values/43685083#43685083", "title": "How to define a Monad instance to types with multiple values?", "body": "<p>Perhaps:</p>\n\n<pre><code>frst (Bar a) = a\nfrst (Baz a a') = a\n\nscnd (Bar a) = a\nscnd (Baz a a') = a'\n\ninstance Monad Foo where\n    return = Bar\n    Bar x &gt;&gt;= f = f x\n    Baz x y &gt;&gt;= f = Baz (frst (f x)) (scnd (f y))\n</code></pre>\n\n<p>This definition is inspired by the definition of <code>(&gt;&gt;=)</code> for <code>(Bool -&gt;)</code>. Ask me if it's not clear how.</p>\n\n<p>Let's check the laws. The \"<code>return</code> is unit\" laws are pretty straightforward:</p>\n\n<pre><code>  return x &gt;&gt;= f\n= Bar x &gt;&gt;= f\n= f x\n\n  m &gt;&gt;= return\n= case m of\n      Bar x -&gt; return x\n      Baz x y -&gt; Baz (frst (return x)) (scnd (return y))\n= case m of\n      Bar x -&gt; Bar x\n      Baz x y -&gt; Baz x y\n= m\n</code></pre>\n\n<p>I believe I've convinced myself of the \"<code>(&gt;&gt;=)</code> is associative\" law, too, but I'm sure this proof is completely unreadable to anybody else... I encourage you to try proving it yourself, and refer to my calculations as a cheat-sheet if you get stuck.</p>\n\n<pre><code>  m &gt;&gt;= (\\v -&gt; f v &gt;&gt;= g)\n= case m of\n      Bar x -&gt; (\\v -&gt; f v &gt;&gt;= g) x\n      Baz x y -&gt; Baz (frst ((\\v -&gt; f v &gt;&gt;= g) x))\n                     (scnd ((\\v -&gt; f v &gt;&gt;= g) y))\n= case m of\n      Bar x -&gt; f x &gt;&gt;= g\n      Baz x y -&gt; Baz (frst (f x &gt;&gt;= g)) (scnd (f y &gt;&gt;= g))\n= case m of\n      Bar x -&gt; case f x of\n          Bar y -&gt; g y\n          Baz a b -&gt; Baz (frst (g a)) (scnd (g b))\n      Baz x y -&gt; Baz (frst l) (scnd r) where\n          l = case f x of\n                  Bar a -&gt; g a\n                  Baz a b -&gt; Baz (frst (g a)) (scnd (g b))\n          r = case f y of\n                  Bar a -&gt; g a\n                  Baz a b -&gt; Baz (frst (g a)) (scnd (g b))\n= case m of\n      Bar x -&gt; case f x of\n          Bar y -&gt; g y\n          Baz a b -&gt; Baz (frst (g a)) (scnd (g b))\n      Baz x y -&gt; Baz (frst (g (frst (f x))))\n                     (scnd (g (scnd (f y))))\n= case m of\n      Bar a -&gt; case f a of\n          Bar x -&gt; g x\n          Baz x y -&gt; Baz (frst (g x)) (scnd (g y))\n      Baz a b -&gt; case Baz (frst (f a)) (scnd (f b)) of\n          Bar x -&gt; g x\n          Baz x y -&gt; Baz (frst (g x)) (scnd (g y))\n= case v of\n      Bar x -&gt; g x\n      Baz x y -&gt; Baz (frst (g x)) (scnd (g y))\n  where v = case m of\n                Bar a -&gt; f a\n                Baz a b -&gt; Baz (frst (f a)) (scnd (f b))\n= case m &gt;&gt;= f of\n      Bar x -&gt; g x\n      Baz x y -&gt; Baz (frst (g x)) (scnd (g y))\n= (m &gt;&gt;= f) &gt;&gt;= g\n</code></pre>\n\n<p><strong>edit</strong> Okay, I decided to write a short explanation of how this is inspired by <code>(Bool -&gt;)</code> even though nobody asked. So, recall:</p>\n\n<pre><code>instance Monad (e -&gt;) where\n    m &gt;&gt;= f = \\e -&gt; f (m e) e\n</code></pre>\n\n<p>Now we're going to define</p>\n\n<pre><code>data Pair a = Pair a a\n</code></pre>\n\n<p>and observe that <code>Bool -&gt; a</code> and <code>Pair a</code> are very similar:</p>\n\n<pre><code>to :: Pair a -&gt; (Bool -&gt; a)\nto (Pair false true) = \\bool -&gt; case bool of\n    False -&gt; false\n    True  -&gt; true\n\nfrom :: (Bool -&gt; a) -&gt; Pair a\nfrom f = Pair (f False) (f True)\n</code></pre>\n\n<p>It turns out that <code>from</code> and <code>to</code> are an isomorphism. In other words: you can alternately think of <code>Bool -&gt; a</code> as a \"two-element container\". Well, what happens if we try to translate the <code>(e -&gt;)</code> instance for <code>Monad</code> into the <code>Pair</code> type? It certainly ought to be possible, since they're isomorphic. In fact, let's start with the isomorphism:</p>\n\n<pre><code>instance Monad Pair where\n    return x = from (return x)\n    m &gt;&gt;= f = from (to m &gt;&gt;= to . f)\n</code></pre>\n\n<p>Now we can \"just turn the crank\":</p>\n\n<pre><code>  return x\n= from (return x)\n= from (\\e -&gt; x)\n= Pair ((\\e -&gt; x) False) ((\\e -&gt; x) True)\n= Pair x x\n</code></pre>\n\n<p>and:</p>\n\n<pre><code>  m@(Pair false true) &gt;&gt;= f\n= from (to m &gt;&gt;= to . f)\n= from (\\e -&gt; (to . f) (to m e) e)\n= from (\\e -&gt; to (f (to m e)) e)\n= Pair (g False) (g True) where\n      g = \\e -&gt; to (f (to m e)) e\n= Pair (to (f (to m False)) False) (to (f (to m True)) True)\n= Pair (case f (to m False) of Pair false true -&gt; false)\n       (case f (to m True ) of Pair false true -&gt; true )\n= Pair (case f false of Pair false true -&gt; false)\n       (case f true  of Pair false true -&gt; true )\n</code></pre>\n\n<p>So we can now rewrite the instance without relying on <code>(Bool -&gt;)</code> by just copying and pasting the first and last line of the above calculations:</p>\n\n<pre><code>frstPair (Pair false true) = false\nscndPair (Pair false true) = true\n\ninstance Monad Pair where\n    return x = Pair x x\n    Pair false true &gt;&gt;= f = Pair (frstPair (f false)) (scndPair (f true))\n</code></pre>\n\n<p>Hopefully you can recognize how similar this is to the definition of <code>(&gt;&gt;=)</code> I gave above for <code>Foo</code>.</p>\n\n<p><strong>edit 2</strong> Another (different!) monad for this is possible. Check out the behavior of the isomorphic type from base:</p>\n\n<pre><code>type Foo = Product Identity Maybe\n</code></pre>\n\n<p>See <a href=\"https://hackage.haskell.org/package/base-4.9.1.0/docs/Data-Functor-Product.html\" rel=\"noreferrer\">the docs for <code>Product</code></a>. Written without the isomorphism, it would be:</p>\n\n<pre><code>instance Monad Foo where\n    return x = Baz x x\n    Bar x &gt;&gt;= f = Bar (frst (f x))\n    Baz x y &gt;&gt;= f = case f y of\n        Bar a -&gt; Bar (frst (f x))\n        Baz a b -&gt; Baz (frst (f x)) b\n</code></pre>\n\n<p>In a sense, my original proposal \"expands\" the number of results as you add more monadic actions -- starting with a <code>Bar</code> in <code>return</code> and converting <code>Bar</code>s irrevocably to <code>Baz</code>s in the bind -- while this instance \"contracts\" the number of results possible as you add more monadic actions -- starting with a <code>Baz</code> in <code>return</code> and converting <code>Baz</code>s to <code>Bar</code>s irrevocably in the bind. Quite an interesting design choice, if you ask me! It also makes me wonder if another <code>Monad</code> instance for <code>Product</code> is possible (perhaps with different constraints on the functors involved).</p>\n"}], "owner": {"reputation": 590, "user_id": 3029543, "user_type": "registered", "accept_rate": 80, "profile_image": "https://graph.facebook.com/100004855955180/picture?type=large", "display_name": "ptkato", "link": "https://stackoverflow.com/users/3029543/ptkato"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 645, "favorite_count": 2, "accepted_answer_id": 43685083, "answer_count": 1, "score": 8, "last_activity_date": 1555855916, "creation_date": 1493394692, "last_edit_date": 1555855916, "question_id": 43684258, "link": "https://stackoverflow.com/questions/43684258/how-to-define-a-monad-instance-to-types-with-multiple-values", "title": "How to define a Monad instance to types with multiple values?", "body": "<p>By multiple values I mean something like so:</p>\n\n<pre><code>data Foo a = Bar a | Baz a a\n</code></pre>\n\n<p>I can't think of a clear way to define <code>&gt;&gt;=</code> for <code>Baz</code>:</p>\n\n<pre><code>instance Monad Foo where\n    Bar x   &gt;&gt;= f = f x -- Great, that works perfectly!\n    Baz x y &gt;&gt;= f = ??? -- What the heck do I even put here?\n</code></pre>\n"}, {"tags": ["haskell", "constructor", "tree", "binary-tree"], "comments": [{"owner": {"reputation": 94713, "user_id": 1139697, "user_type": "registered", "accept_rate": 86, "profile_image": "https://www.gravatar.com/avatar/5f136ddb684f39aaee1c028ee1950f6f?s=128&d=identicon&r=PG", "display_name": "Zeta", "link": "https://stackoverflow.com/users/1139697/zeta"}, "edited": false, "score": 1, "creation_date": 1493382294, "post_id": 43680065, "comment_id": 74406358, "body": "This <code>Tree</code> does not allow empty <code>Tree</code>, therefore, you cannot generate a <code>Tree</code> that is a list in disguise, aka <code>Branch 1 Leaf (Branch 2 Leaf (Branch 3 Leaf))</code>. That being said, I&#39;m not really sure what you&#39;re asking about."}, {"owner": {"reputation": 61419, "user_id": 849891, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/MbEO3.png?s=128&g=1", "display_name": "Will Ness", "link": "https://stackoverflow.com/users/849891/will-ness"}, "reply_to_user": {"reputation": 94713, "user_id": 1139697, "user_type": "registered", "accept_rate": 86, "profile_image": "https://www.gravatar.com/avatar/5f136ddb684f39aaee1c028ee1950f6f?s=128&d=identicon&r=PG", "display_name": "Zeta", "link": "https://stackoverflow.com/users/1139697/zeta"}, "edited": false, "score": 0, "creation_date": 1493387497, "post_id": 43680065, "comment_id": 74409877, "body": "@Zeta you meant <code>Branch 1 Leaf (Branch 2 Leaf (Branch 3 Leaf Leaf))</code>. this is not to nitpick, of course, but for the benefit of a casual reader."}, {"owner": {"reputation": 61419, "user_id": 849891, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/MbEO3.png?s=128&g=1", "display_name": "Will Ness", "link": "https://stackoverflow.com/users/849891/will-ness"}, "edited": false, "score": 0, "creation_date": 1493412510, "post_id": 43680065, "comment_id": 74423529, "body": "I rolled back to your first version. It is against the rules of SO to make drastic changes to the question, that invalidate existing answers."}], "answers": [{"tags": [], "owner": {"reputation": 37219, "user_id": 1523776, "user_type": "moderator", "accept_rate": 87, "profile_image": "https://www.gravatar.com/avatar/b3e0b5c8e42a8c38009ef2d969f8dabb?s=128&d=identicon&r=PG", "display_name": "Benjamin Hodgson", "link": "https://stackoverflow.com/users/1523776/benjamin-hodgson"}, "is_accepted": false, "score": 2, "last_activity_date": 1493382311, "creation_date": 1493382311, "answer_id": 43680214, "question_id": 43680065, "link": "https://stackoverflow.com/questions/43680065/binary-tree-type-constructor-in-haskell/43680214#43680214", "title": "Binary Tree type constructor in Haskell", "body": "<p>Your <code>Tree a</code> has labels of type <code>a</code> at every <code>Branch</code> and every <code>Leaf</code> constructor. So, for example, <code>Branch 'u' (Branch 'n' (Leaf 'i') (Leaf 'p')) (Leaf 'z')</code> looks like this:</p>\n\n<pre><code>    +-'u'-+\n    |     |\n +-'n'-+ 'z'\n |     |\n'i'   'p'\n</code></pre>\n\n<p>That excludes, say, trees with different labels at the nodes and leaves, or trees that are labelled only internally or only externally. For example, this tree has numbers at the leaves and characters at the nodes.</p>\n\n<pre><code>    +-'o'-+\n    |     |\n +-'h'-+  9\n |     |\n 7     2\n</code></pre>\n\n<p>(You can use <code>Tree (Either n l)</code> but that doesn't encode the invariant that only <code>n</code>s appear internally and only <code>l</code>s appear externally.)</p>\n\n<p>Since this appears to be a homework assignment I won't tell you what a more general type of tree might look like, but I'm sure you can figure it out.</p>\n"}, {"tags": [], "owner": {"reputation": 61419, "user_id": 849891, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/MbEO3.png?s=128&g=1", "display_name": "Will Ness", "link": "https://stackoverflow.com/users/849891/will-ness"}, "is_accepted": false, "score": 1, "last_activity_date": 1497216415, "last_edit_date": 1497216415, "creation_date": 1493390031, "answer_id": 43682726, "question_id": 43680065, "link": "https://stackoverflow.com/questions/43680065/binary-tree-type-constructor-in-haskell/43682726#43682726", "title": "Binary Tree type constructor in Haskell", "body": "<p>Ask yourself, how many  <code>a</code> values can your tree hold? They appear either in leaves or nodes,</p>\n\n\n\n<pre class=\"lang-hs prettyprint-override\"><code>data Tree a = Leaf a | Branch a    (Tree a)    (Tree a)\n</code></pre>\n\n<p>so</p>\n\n<pre class=\"lang-hs prettyprint-override\"><code>num_values  =      1 | (      1 + num_values + num_values  )\n</code></pre>\n\n<p>It doesn't make much sense in this form, so let's write it as</p>\n\n<pre class=\"lang-hs prettyprint-override\"><code>numvals     =      1 : [      1 +            s          | s &lt;- diagonalize\n                                 [ [   n     +     m    | m &lt;- numvals ] \n                                                        | n &lt;- numvals   ] ]\n\ndiagonalize :: [[a]] -&gt; [a]\ndiagonalize ((n:ns):t) = n:go [ns] t\n   where\n   go as (b:bs) = map head as ++ go (b:map tail as) bs\n</code></pre>\n\n<p>so that we get</p>\n\n<blockquote>\n  <p>~> take 100 numvals <br />\n  [1,3,5,5,7,7,7,7,7,9,9,9,9,9,11,9,9,9,11,11,11,11,9,9,11,13,11,13,11,9,9,11,13,1\n  3,13,13,11,9,9,11,13,13,15,13,13,11,11,11,11,13,13,15,15,13,13,11,11,11,13,13,13\n  ,15,15,15,13,13,13,11,11,13,15,13,15,15,15,15,13,15,13,11,11,13,15,15,15,15,15,1\n  5,15,15,15,13,11,11,13,15,15,17,15,15]</p>\n</blockquote>\n\n<p>but you want <em>0, 2, 4, ...</em> to appear there as well.</p>\n\n<p><em>edit:</em> \nIt is easy to fix this, with</p>\n\n<pre class=\"lang-hs prettyprint-override\"><code>data Tree a = Leaf | Branch a (Tree a) (Tree a)\n</code></pre>\n\n<p>Now</p>\n\n<pre class=\"lang-hs prettyprint-override\"><code>numvals2    =    0 : [      1 +       s          | s &lt;- diagonalize\n                          [ [     n   +   m      | m &lt;- numvals2 ] \n                                                 | n &lt;- numvals2   ] ]\n</code></pre>\n\n<p>and</p>\n\n<blockquote>\n  <p>~> take 100 numvals2 <br />\n  [0,1,2,2,3,3,3,3,3,4,4,4,4,4,5,4,4,4,5,5,5,5,4,4,5,6,5,6,5,4,4,5,6,6,6,6,5,4,4,5\n  ,6,6,7,6,6,5,5,5,5,6,6,7,7,6,6,5,5,5,6,6,6,7,7,7,6,6,6,5,5,6,7,6,7,7,7,7,6,7,6,5\n  ,5,6,7,7,7,7,7,7,7,7,7,6,5,5,6,7,7,8,7,7]</p>\n</blockquote>\n"}], "owner": {"reputation": 21, "user_id": 7272137, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/349b77a48901dfb0433d322bf8521342?s=128&d=identicon&r=PG&f=1", "display_name": "psyGhost", "link": "https://stackoverflow.com/users/7272137/psyghost"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 362, "favorite_count": 0, "answer_count": 2, "score": 0, "last_activity_date": 1516191455, "creation_date": 1493381789, "last_edit_date": 1516191455, "question_id": 43680065, "link": "https://stackoverflow.com/questions/43680065/binary-tree-type-constructor-in-haskell", "title": "Binary Tree type constructor in Haskell", "body": "<p>I'm trying binary tree type constructor which is:</p>\n\n<pre><code>data Tree a = Leaf a | Branch a (Tree a) (Tree a)\n</code></pre>\n\n<p>How we prove that not all kinds of binary tree can be represented by this constructor? How we improve this definition to cover all types of binary tree? And how it works?</p>\n"}, {"tags": ["haskell", "typeclass"], "comments": [{"owner": {"reputation": 10230, "user_id": 2427222, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/4h1qN.png?s=128&g=1", "display_name": "ymonad", "link": "https://stackoverflow.com/users/2427222/ymonad"}, "edited": false, "score": 2, "creation_date": 1493370563, "post_id": 43676288, "comment_id": 74398591, "body": "read next row of  <code>Possible fix:</code> in error message, and read this:  <a href=\"http://stackoverflow.com/questions/9824671/haskell-class-num-not-contained-in-ord\" title=\"haskell class num not contained in ord\">stackoverflow.com/questions/9824671/&hellip;</a>"}, {"owner": {"reputation": 822, "user_id": 1281470, "user_type": "registered", "accept_rate": 38, "profile_image": "https://www.gravatar.com/avatar/5bf7fa14eee8258850f67fdb02e05c46?s=128&d=identicon&r=PG", "display_name": "FrankBr", "link": "https://stackoverflow.com/users/1281470/frankbr"}, "reply_to_user": {"reputation": 10230, "user_id": 2427222, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/4h1qN.png?s=128&g=1", "display_name": "ymonad", "link": "https://stackoverflow.com/users/2427222/ymonad"}, "edited": false, "score": 0, "creation_date": 1493371210, "post_id": 43676288, "comment_id": 74399010, "body": "Thanks :D I think I got it working."}], "answers": [{"comments": [{"owner": {"reputation": 100185, "user_id": 3234959, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/93bb12ca0f93dfddb33880316f7e66c2?s=128&d=identicon&r=PG&f=1", "display_name": "chi", "link": "https://stackoverflow.com/users/3234959/chi"}, "edited": false, "score": 1, "creation_date": 1493371601, "post_id": 43676639, "comment_id": 74399283, "body": "Note that you will never return <code>EQ</code> in that way. You might want to use <code>orderFunction (_,a1) (_,a2) = compare (sum a1) (sum a2)</code> instead."}, {"owner": {"reputation": 822, "user_id": 1281470, "user_type": "registered", "accept_rate": 38, "profile_image": "https://www.gravatar.com/avatar/5bf7fa14eee8258850f67fdb02e05c46?s=128&d=identicon&r=PG", "display_name": "FrankBr", "link": "https://stackoverflow.com/users/1281470/frankbr"}, "reply_to_user": {"reputation": 100185, "user_id": 3234959, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/93bb12ca0f93dfddb33880316f7e66c2?s=128&d=identicon&r=PG&f=1", "display_name": "chi", "link": "https://stackoverflow.com/users/3234959/chi"}, "edited": false, "score": 0, "creation_date": 1493371812, "post_id": 43676639, "comment_id": 74399424, "body": "Oh, this is very elegant. Thanks for pointing me out. I&#39;m pretty new at Haskell :)"}, {"owner": {"reputation": 1247, "user_id": 3485629, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/640b2583577ec470ac273b27f78025d5?s=128&d=identicon&r=PG", "display_name": "basile-henry", "link": "https://stackoverflow.com/users/3485629/basile-henry"}, "edited": false, "score": 6, "creation_date": 1493374380, "post_id": 43676639, "comment_id": 74401114, "body": "I&#39;d even suggest using the <a href=\"https://hackage.haskell.org/package/base-4.9.1.0/docs/Data-Ord.html#v:comparing\" rel=\"nofollow noreferrer\">comparing</a> function from Data.Ord: <code>orderFunction = comparing (sum . snd)</code>"}, {"owner": {"reputation": 61419, "user_id": 849891, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/MbEO3.png?s=128&g=1", "display_name": "Will Ness", "link": "https://stackoverflow.com/users/849891/will-ness"}, "edited": false, "score": 0, "creation_date": 1493386602, "post_id": 43676639, "comment_id": 74409239, "body": "also, while developing your code, you can just omit the hard-specified type signature at first (if you&#39;re not sure about it) and see what is inferred."}, {"owner": {"reputation": 75362, "user_id": 625403, "user_type": "registered", "accept_rate": 82, "profile_image": "https://www.gravatar.com/avatar/786eed7da67079cb5d63a49d469af25b?s=128&d=identicon&r=PG", "display_name": "amalloy", "link": "https://stackoverflow.com/users/625403/amalloy"}, "reply_to_user": {"reputation": 61419, "user_id": 849891, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/MbEO3.png?s=128&g=1", "display_name": "Will Ness", "link": "https://stackoverflow.com/users/849891/will-ness"}, "edited": false, "score": 1, "creation_date": 1493403840, "post_id": 43676639, "comment_id": 74419334, "body": "@WillNess That backfires as often as it helps, because when you write your function incorrectly GHC may infer some really bizarre things about it. Better to specify the type you intend when you can, and occasionally try removing the type as a troubleshooting/refinement step, to see if GHC has a better guess than you do."}, {"owner": {"reputation": 61419, "user_id": 849891, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/MbEO3.png?s=128&g=1", "display_name": "Will Ness", "link": "https://stackoverflow.com/users/849891/will-ness"}, "reply_to_user": {"reputation": 75362, "user_id": 625403, "user_type": "registered", "accept_rate": 82, "profile_image": "https://www.gravatar.com/avatar/786eed7da67079cb5d63a49d469af25b?s=128&d=identicon&r=PG", "display_name": "amalloy", "link": "https://stackoverflow.com/users/625403/amalloy"}, "edited": false, "score": 0, "creation_date": 1493410814, "post_id": 43676639, "comment_id": 74422792, "body": "@amalloy sure, so the point is, try it <i>sometimes</i> without the signature and see if GHCi can help you; don&#39;t stand in its way."}, {"owner": {"reputation": 822, "user_id": 1281470, "user_type": "registered", "accept_rate": 38, "profile_image": "https://www.gravatar.com/avatar/5bf7fa14eee8258850f67fdb02e05c46?s=128&d=identicon&r=PG", "display_name": "FrankBr", "link": "https://stackoverflow.com/users/1281470/frankbr"}, "edited": false, "score": 0, "creation_date": 1493447259, "post_id": 43676639, "comment_id": 74430910, "body": "You&#39;re right. For an exeperienced Haskell dev it could not make sense  to write type signatures. Actually, I do this just to practice with Haskell type system to enforce my function definition."}], "tags": [], "owner": {"reputation": 822, "user_id": 1281470, "user_type": "registered", "accept_rate": 38, "profile_image": "https://www.gravatar.com/avatar/5bf7fa14eee8258850f67fdb02e05c46?s=128&d=identicon&r=PG", "display_name": "FrankBr", "link": "https://stackoverflow.com/users/1281470/frankbr"}, "is_accepted": false, "score": 3, "last_activity_date": 1493371408, "creation_date": 1493371408, "answer_id": 43676639, "question_id": 43676288, "link": "https://stackoverflow.com/questions/43676288/haskell-ordering-function/43676639#43676639", "title": "Haskell ordering function", "body": "<p>As pointed by @ymonad, Num typeclass does not imply that ordering feature is supported. So I added another constraint to function definition as follows:</p>\n\n<pre><code>let orderFunction::(Ord b, Num b) =&gt; (a, [b]) -&gt; (a, [b]) -&gt; Ordering; \norderFunction a1 a2 = if sum (snd a1) &gt; sum (snd a2) then GT else LT\n</code></pre>\n"}], "owner": {"reputation": 822, "user_id": 1281470, "user_type": "registered", "accept_rate": 38, "profile_image": "https://www.gravatar.com/avatar/5bf7fa14eee8258850f67fdb02e05c46?s=128&d=identicon&r=PG", "display_name": "FrankBr", "link": "https://stackoverflow.com/users/1281470/frankbr"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 481, "favorite_count": 0, "answer_count": 1, "score": 1, "last_activity_date": 1493371408, "creation_date": 1493370365, "question_id": 43676288, "link": "https://stackoverflow.com/questions/43676288/haskell-ordering-function", "title": "Haskell ordering function", "body": "<p>What's wrong with this?\nI tried to write an ordering function defined as this:</p>\n\n<pre><code>let orderFunction:: Num b =&gt; (a, [b]) -&gt; (a, [b]) -&gt; Ordering; \norderFunction a1 a2 = if sum $ snd a1 &gt; sum $ snd a2 then GT else LT\n</code></pre>\n\n<p>but I get an error:</p>\n\n<pre><code>Could not deduce (Ord b) arising from a use of `&gt;'\n    from the context (Num b)\n      bound by the type signature for\n                 orderFunction :: Num b =&gt; (a, [b]) -&gt; (a, [b]) -&gt; Ordering\n      at &lt;interactive&gt;:110:21-61\n    Possible fix:\n      add (Ord b) to the context of\n        the type signature for\n          orderFunction :: Num b =&gt; (a, [b]) -&gt; (a, [b]) -&gt; Ordering\n    In the expression: sum (snd a1) &gt; sum (snd a2)\n    In the expression: if sum (snd a1) &gt; sum (snd a2) then GT else LT\n    In an equation for `orderFunction':\n        orderFunction a1 a2\n          = if sum (snd a1) &gt; sum (snd a2) then GT else LT\n</code></pre>\n\n<p>Is there a more Haskell oriented way to write the function?</p>\n\n<p>Thanks, \nFB</p>\n"}, {"tags": ["haskell"], "comments": [{"owner": {"reputation": 384463, "user_id": 1126841, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/fa05233b2357f8d11c22ef4cfc7bb85c?s=128&d=identicon&r=PG", "display_name": "chepner", "link": "https://stackoverflow.com/users/1126841/chepner"}, "edited": false, "score": 0, "creation_date": 1493379416, "post_id": 43674103, "comment_id": 74404375, "body": "<code>data Person action = Person { salary :: Float, subordinates :: [Person action], act :: action, b :: Maybe (Person action)}</code>."}, {"owner": {"reputation": 25, "user_id": 7935016, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/765b1455958b5ba4e3dccd6912f5caa8?s=128&d=identicon&r=PG&f=1", "display_name": "joeo", "link": "https://stackoverflow.com/users/7935016/joeo"}, "reply_to_user": {"reputation": 384463, "user_id": 1126841, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/fa05233b2357f8d11c22ef4cfc7bb85c?s=128&d=identicon&r=PG", "display_name": "chepner", "link": "https://stackoverflow.com/users/1126841/chepner"}, "edited": false, "score": 0, "creation_date": 1493387364, "post_id": 43674103, "comment_id": 74409793, "body": "Ok, I changed the code a little bit."}, {"owner": {"reputation": 483, "user_id": 521370, "user_type": "registered", "accept_rate": 80, "profile_image": "https://www.gravatar.com/avatar/a8d69ed3d32273571045f30fc755ff0a?s=128&d=identicon&r=PG", "display_name": "Dmitry Olshansky", "link": "https://stackoverflow.com/users/521370/dmitry-olshansky"}, "edited": false, "score": 0, "creation_date": 1493415868, "post_id": 43674103, "comment_id": 74424765, "body": "Type <code>Person</code> is similar to <code>Tree a</code> from <code>Data.Tree</code>. Your function <code>create</code> is similar to <code>Data.Tree.unfoldTree</code>. I suppose that the best way is reusing these."}], "answers": [{"comments": [{"owner": {"reputation": 25, "user_id": 7935016, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/765b1455958b5ba4e3dccd6912f5caa8?s=128&d=identicon&r=PG&f=1", "display_name": "joeo", "link": "https://stackoverflow.com/users/7935016/joeo"}, "edited": false, "score": 0, "creation_date": 1493387429, "post_id": 43674346, "comment_id": 74409831, "body": "you are right. I used a different approach for the function."}, {"owner": {"reputation": 25, "user_id": 7935016, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/765b1455958b5ba4e3dccd6912f5caa8?s=128&d=identicon&r=PG&f=1", "display_name": "joeo", "link": "https://stackoverflow.com/users/7935016/joeo"}, "edited": false, "score": 0, "creation_date": 1493399411, "post_id": 43674346, "comment_id": 74417203, "body": "I really appreciate the effort you have put in the answer but I still have no clue how to create a function to add the persons that resulted from the generator to the current &#39;boss&#39; &#39;s list of subordinates and do the same thing for each of them."}], "tags": [], "owner": {"reputation": 75362, "user_id": 625403, "user_type": "registered", "accept_rate": 82, "profile_image": "https://www.gravatar.com/avatar/786eed7da67079cb5d63a49d469af25b?s=128&d=identicon&r=PG", "display_name": "amalloy", "link": "https://stackoverflow.com/users/625403/amalloy"}, "is_accepted": false, "score": 5, "last_activity_date": 1493398693, "last_edit_date": 1493398693, "creation_date": 1493364135, "answer_id": 43674346, "question_id": 43674103, "link": "https://stackoverflow.com/questions/43674103/generate-list-of-employees/43674346#43674346", "title": "Generate list of employees", "body": "<p>This is a more difficult problem than it looks. To see why, consider what type you will choose for <code>boss</code> when calling <code>create</code>. You say that each branch in the tree will create subordinates who have the parent node as their boss. So, clearly <code>boss</code> is not a free type variable in that function: it must be fixed as Person.</p>\n\n<p>But how can you provide a Person object as the boss for each new person? There is a circular reference, because each person must know about its superior as well as all its subordinates at construction time. You cannot create the CEO until you have all subordinates already, but those cannot be created until you have their boss.</p>\n\n<p>Now, this is not actually impossible: you can create circular data structures in Haskell without mutation, through the magic of laziness. But here there's no reason to, and the friction points out that the <code>boss</code> field in your Person struct is extraneous. Remove that, and the problem may be simplified to the point you can solve it.</p>\n\n<hr>\n\n<p>It sounds like you are still having trouble getting started, so I'll provide some improved type signatures and a basic sketch of what your function might look like, with blanks for you to fill in.</p>\n\n<pre><code>type Salary = Float\ndata Position job = Position {salary :: Salary,\n                              job :: job\n                             }\n\ndata Person job = Person { position :: Position job,\n                           subordinates :: [Person job]\n                         }\n\n-- the job type our positions will be parameterized by\ndata Management = CEO | Executive | Manager\n\ncreate :: (Position job -&gt; [Position job])\n       -&gt; Position job\n       -&gt; Person job\ncreate f root = Person root (hireSubordinates root)\n  where hireSubordinates boss = _\n\ntestHiringPlan :: Position Management -&gt; [Position Management]\ntestHiringPlan (Position salary job) = case job of\n  CEO -&gt; [Position _ Executive | subordinateNum &lt;- _]\n  Executive -&gt; [Position _ Manager | subordinateNum &lt;- _]\n  Manager -&gt; [Position _ Manager | subordinateNum &lt;- _]\n</code></pre>\n\n<p>As you can see I've separated the concerns of \"what this person does\" (their Position) and \"who this person manages\" (their subordinates). That way we can start from a Position, and from that generate the actual Person by creating a list of subordinates for them, avoiding any circular reference.</p>\n\n<p>I've also provided an example type you might use for your <code>job</code> type variable, so that I could produce an example of what a generator passed to <code>create</code> might look like.</p>\n"}, {"tags": [], "owner": {"reputation": 1369, "user_id": 509928, "user_type": "registered", "accept_rate": 83, "profile_image": "https://www.gravatar.com/avatar/57d816a396798416d079c92adbabdbf3?s=128&d=identicon&r=PG", "display_name": "Dave Compton", "link": "https://stackoverflow.com/users/509928/dave-compton"}, "is_accepted": false, "score": 0, "last_activity_date": 1493460387, "last_edit_date": 1493460387, "creation_date": 1493419648, "answer_id": 43689859, "question_id": 43674103, "link": "https://stackoverflow.com/questions/43674103/generate-list-of-employees/43689859#43689859", "title": "Generate list of employees", "body": "<p>In the code given for the question, the <code>Person</code> data type includes a list of <code>Person</code> <code>subordinates</code> each of which contain a <code>boss</code> field that references the original <code>Person</code>.   A circular reference. Circular references are often unnecessarily complicated.</p>\n\n<p>However, if you need to create a circular reference, it can be done inside a <code>let</code> statement</p>\n\n<p>The example below is a trimmed down version of your example.  It retains the circular reference. In the <code>let</code> statement, the <code>Person</code> being created is defined in terms of <code>subordinates</code>.  The <code>subordinates</code> being generated by the generator function are defined in terms of <code>person</code>.  </p>\n\n<pre><code>data Action = Manager | TeamLeader | Programmer deriving Show\n\ndata Person = Person {   subordinates :: [Person]\n                       , act :: Action\n                       , boss :: Maybe Person\n                     } \n\n-- Generate the list of persons reporting to a boss\ngenerate :: Person -&gt; [Person]\ngenerate boss = \n    case act boss of\n        -- A programmer has no subordinates\n        Programmer -&gt; []  \n\n        -- Team leaders and managers have subordinates\n        TeamLeader -&gt; replicate 2 $ create generate (Just boss)\n        Manager -&gt; replicate 3 $ create generate (Just boss)\n\n-- Create a new person given that person's boss and a generator function\n-- that generates the person's subordinates\ncreate :: (Person -&gt; [Person]) -&gt; Maybe Person -&gt; Person\ncreate generator maybeBoss = \n\n    -- responsibility (action) depends on the boss's responsibility\n    let action = case maybeBoss of\n                     Nothing -&gt; Manager\n                     Just boss -&gt; case act boss of\n                                      Manager -&gt; TeamLeader \n                                      TeamLeader -&gt; Programmer\n\n        -- note the circular reference happening on the next lines\n        subordinates = generator person\n        person = Person subordinates action maybeBoss\n\n    in person\n\ndisplay :: Person -&gt; IO ()\ndisplay (Person subordinates action boss ) = do\n    putStrLn \"\" \n    putStrLn $ \"person: \" ++ show action \n    putStrLn $ \"boss: \" ++ show (fmap act boss)\n    mapM_ display subordinates\n\nmain = display $ create generate Nothing \n</code></pre>\n"}], "owner": {"reputation": 25, "user_id": 7935016, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/765b1455958b5ba4e3dccd6912f5caa8?s=128&d=identicon&r=PG&f=1", "display_name": "joeo", "link": "https://stackoverflow.com/users/7935016/joeo"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 181, "favorite_count": 1, "answer_count": 2, "score": 0, "last_activity_date": 1493460387, "creation_date": 1493363254, "last_edit_date": 1493402441, "question_id": 43674103, "link": "https://stackoverflow.com/questions/43674103/generate-list-of-employees", "title": "Generate list of employees", "body": "<p>Let's say I have a data structure like this : </p>\n\n<pre><code>data Person boss action = Person{\n  salary  :: Float,\n  subordonates :: [Person boss action],\n  act :: action\n  b :: boss\n }\n</code></pre>\n\n<p>And I want to create an organization starting with the president using this function :</p>\n\n<pre><code>create :: (boss -&gt; [(action, boss)]) -- generator\n       -&gt; boss\n       -&gt; action\n       -&gt; Person boss action \n</code></pre>\n\n<p>The generator creates a list of employees. Each employee's boss is the current person who have called the function. I want to create a list of subordinates for each subordinate and so on (to infinity).</p>\n\n<p>The problem is that I do not know how to:</p>\n\n<ul>\n<li>add the elements generated by the generator to the subordinates list of the current node</li>\n<li>do this recursively (an infinite number of times) for each of the subordinates. I thought about some sort of map but I don't get it.</li>\n</ul>\n\n<p>Any advice || reference is highly appreciated !</p>\n"}, {"tags": ["haskell", "types"], "comments": [{"owner": {"reputation": 126897, "user_id": 791604, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/ce991df7a056248d5e4f6fc3659ba733?s=128&d=identicon&r=PG", "display_name": "Daniel Wagner", "link": "https://stackoverflow.com/users/791604/daniel-wagner"}, "edited": false, "score": 2, "creation_date": 1493354976, "post_id": 43672128, "comment_id": 74390573, "body": "In short: use a newer ghci, add <code>let</code> to the beginning of your definition, or put your definition in a file and load it."}], "owner": {"reputation": 131, "user_id": 3358850, "user_type": "registered", "accept_rate": 23, "profile_image": "https://www.gravatar.com/avatar/ae4ac12b59d38f509b9ae01fd08f8407?s=128&d=identicon&r=PG&f=1", "display_name": "user3358850", "link": "https://stackoverflow.com/users/3358850/user3358850"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 38, "favorite_count": 0, "closed_date": 1493354923, "answer_count": 0, "score": 1, "last_activity_date": 1493354751, "creation_date": 1493354751, "question_id": 43672128, "link": "https://stackoverflow.com/questions/43672128/cant-check-type-in-haskell", "closed_reason": "Duplicate", "title": "can&#39;t check type in haskell", "body": "<p>I need to check the type of the following function,</p>\n\n<pre><code> summer p q r x = (p.q)(r x)\n</code></pre>\n\n<p>But the compiler says:\n parse error on input \u2018=\u2019\n    Perhaps you need a 'let' in a 'do' block?\n    e.g. 'let x = 5' instead of 'x = 5'</p>\n"}, {"tags": ["haskell", "haskell-diagrams"], "comments": [{"owner": {"reputation": 14781, "user_id": 630160, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/4445f21326af525a8ad19af7e3ae41a8?s=128&d=identicon&r=PG", "display_name": "epsilonhalbe", "link": "https://stackoverflow.com/users/630160/epsilonhalbe"}, "edited": false, "score": 0, "creation_date": 1493362727, "post_id": 43670049, "comment_id": 74393767, "body": "<a href=\"http://projects.haskell.org/diagrams/doc/arrow.html\" rel=\"nofollow noreferrer\">projects.haskell.org/diagrams/doc/arrow.html</a> there is an example in the section Connecting points on the trace of diagrams"}, {"owner": {"reputation": 479, "user_id": 5674394, "user_type": "registered", "accept_rate": 43, "profile_image": "https://www.gravatar.com/avatar/9c6d14746bc54c07138037510242d08c?s=128&d=identicon&r=PG", "display_name": "Joshua Meyers", "link": "https://stackoverflow.com/users/5674394/joshua-meyers"}, "reply_to_user": {"reputation": 14781, "user_id": 630160, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/4445f21326af525a8ad19af7e3ae41a8?s=128&d=identicon&r=PG", "display_name": "epsilonhalbe", "link": "https://stackoverflow.com/users/630160/epsilonhalbe"}, "edited": false, "score": 0, "creation_date": 1493365028, "post_id": 43670049, "comment_id": 74395224, "body": "Right, but in this example the endpoints are merely close together.  What if they are the same?"}, {"owner": {"reputation": 479, "user_id": 5674394, "user_type": "registered", "accept_rate": 43, "profile_image": "https://www.gravatar.com/avatar/9c6d14746bc54c07138037510242d08c?s=128&d=identicon&r=PG", "display_name": "Joshua Meyers", "link": "https://stackoverflow.com/users/5674394/joshua-meyers"}, "reply_to_user": {"reputation": 14781, "user_id": 630160, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/4445f21326af525a8ad19af7e3ae41a8?s=128&d=identicon&r=PG", "display_name": "epsilonhalbe", "link": "https://stackoverflow.com/users/630160/epsilonhalbe"}, "edited": false, "score": 0, "creation_date": 1493365184, "post_id": 43670049, "comment_id": 74395323, "body": "There is an issue about this currently: <a href=\"https://github.com/diagrams/diagrams-lib/issues/151\" rel=\"nofollow noreferrer\">github.com/diagrams/diagrams-lib/issues/151</a>"}], "owner": {"reputation": 479, "user_id": 5674394, "user_type": "registered", "accept_rate": 43, "profile_image": "https://www.gravatar.com/avatar/9c6d14746bc54c07138037510242d08c?s=128&d=identicon&r=PG", "display_name": "Joshua Meyers", "link": "https://stackoverflow.com/users/5674394/joshua-meyers"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 152, "favorite_count": 2, "answer_count": 0, "score": 4, "last_activity_date": 1493341513, "creation_date": 1493339423, "last_edit_date": 1493341513, "question_id": 43670049, "link": "https://stackoverflow.com/questions/43670049/how-do-you-make-a-self-referential-arrow-with-diagrams", "title": "How do you make a self-referential arrow with diagrams?", "body": "<p>I would like to do something like this:</p>\n\n<pre><code>p = p2 (0,0)\nshaft = arc xDir (-5/6 @@ turn)\nexample = ( arrowBetween' (with &amp; arrowShaft .~ shaft) p p)\n</code></pre>\n\n<p>But, of course, I get an error: \"Scale by zero!  Halp!\"</p>\n\n<p>I understand why this doesn't work with the existing implementation of <code>arrowBetween'</code>, since it calls <code>arrow'</code>, which scales the shaft by the difference between the endpoints.  However, this <em>should</em> be possible.  It's not that uncommon to see an arrow loop back around to where it started in diagrams.</p>\n"}, {"tags": ["multithreading", "haskell", "concurrency", "stm", "tvar"], "answers": [{"comments": [{"owner": {"reputation": 5861, "user_id": 3042117, "user_type": "registered", "accept_rate": 86, "profile_image": "https://www.gravatar.com/avatar/dc6ec10c58136fc12bf83fe45001d672?s=128&d=identicon&r=PG", "display_name": "Iter Ator", "link": "https://stackoverflow.com/users/3042117/iter-ator"}, "edited": false, "score": 0, "creation_date": 1493371068, "post_id": 43670846, "comment_id": 74398921, "body": "Why isn&#39;t <code>writeTVar finished True</code> required in each forM_ function call? Why is it outside <code>forM_</code>?"}, {"owner": {"reputation": 25144, "user_id": 477476, "user_type": "registered", "accept_rate": 85, "profile_image": "https://i.stack.imgur.com/Qf4TT.png?s=128&g=1", "display_name": "Cactus", "link": "https://stackoverflow.com/users/477476/cactus"}, "reply_to_user": {"reputation": 5861, "user_id": 3042117, "user_type": "registered", "accept_rate": 86, "profile_image": "https://www.gravatar.com/avatar/dc6ec10c58136fc12bf83fe45001d672?s=128&d=identicon&r=PG", "display_name": "Iter Ator", "link": "https://stackoverflow.com/users/3042117/iter-ator"}, "edited": false, "score": 0, "creation_date": 1493371388, "post_id": 43670846, "comment_id": 74399131, "body": "The point is that you <code>writeTVar finished True</code> / <code>putTMVar finished </code> when you are fully finished, i.e. after <i>all</i> results have been computed. Note that this would also work if inside <code>forM_</code>, all elements are processed in a separate thread (which is what I assume you will want to do in your real app)"}], "tags": [], "owner": {"reputation": 25144, "user_id": 477476, "user_type": "registered", "accept_rate": 85, "profile_image": "https://i.stack.imgur.com/Qf4TT.png?s=128&g=1", "display_name": "Cactus", "link": "https://stackoverflow.com/users/477476/cactus"}, "is_accepted": true, "score": 3, "last_activity_date": 1493360702, "last_edit_date": 1493360702, "creation_date": 1493345622, "answer_id": 43670846, "question_id": 43669931, "link": "https://stackoverflow.com/questions/43669931/how-to-wait-until-form-finishes-when-using-tvar/43670846#43670846", "title": "How to wait until forM_ finishes, when using TVar?", "body": "<p>The idiomatic solution would be to use <a href=\"https://hackage.haskell.org/package/stm/docs/Control-Concurrent-STM-TMVar.html\" rel=\"nofollow noreferrer\"><code>TMVar</code></a>s:</p>\n\n<pre><code>my_func_c :: (a -&gt; a) -&gt; [a] -&gt; IO [a]\nmy_func_c my_function arr = do\n    res_var &lt;- atomically $ newTVar []\n    finished &lt;- atomically $ newEmptyTMVar\n\n    forkIO $ do\n        forM_ arr $ \\x -&gt; atomically $ do\n            let y = id $! my_function x\n            modifyTVar res_var (insert y)\n        atomically $ putTMVar finished ()\n\n    atomically $ takeTMVar finished &gt;&gt; readTVar res_var\n</code></pre>\n\n<p>but if you are really only allowed to use <code>TVar</code>s, you can simulate a <code>TMVar ()</code> with a <code>TVar Bool</code>:</p>\n\n<pre><code>my_func_c :: (a -&gt; a) -&gt; [a] -&gt; IO [a]\nmy_func_c my_function arr = do\n    res_var &lt;- atomically $ newTVar []\n    finished &lt;- atomically $ newTVar False\n\n    forkIO $ do\n        forM_ arr $ \\x -&gt; atomically $ do\n            let y = id $! my_function x\n            modifyTVar res_var (insert y)\n        atomically $ writeTVar finished True\n\n    atomically $ waitTVar finished &gt;&gt; readTVar res_var\n\nwaitTVar :: TVar Bool -&gt; STM ()\nwaitTVar tv = do\n    finished &lt;- readTVar tv\n    unless finished retry\n</code></pre>\n\n<p>Under the hood, <a href=\"https://hackage.haskell.org/package/stm-2.4.4.1/docs/src/Control.Concurrent.STM.TMVar.html#TMVar\" rel=\"nofollow noreferrer\"><code>TMVar a</code> is just a <code>TVar (Maybe a)</code></a> (so <code>TMVar ()</code> ~ <code>TVar (Maybe ())</code> ~ <code>TVar Bool</code>) with <a href=\"https://hackage.haskell.org/package/stm-2.4.4.1/docs/src/Control.Concurrent.STM.TMVar.html#takeTMVar\" rel=\"nofollow noreferrer\"><code>takeTMVar</code> doing a <code>readTVar</code> and a <code>retry</code></a>, so the above two solutions are operationally completely equivalent.</p>\n"}], "owner": {"reputation": 5861, "user_id": 3042117, "user_type": "registered", "accept_rate": 86, "profile_image": "https://www.gravatar.com/avatar/dc6ec10c58136fc12bf83fe45001d672?s=128&d=identicon&r=PG", "display_name": "Iter Ator", "link": "https://stackoverflow.com/users/3042117/iter-ator"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 183, "favorite_count": 0, "accepted_answer_id": 43670846, "answer_count": 1, "score": 1, "last_activity_date": 1493360702, "creation_date": 1493338498, "last_edit_date": 1493345307, "question_id": 43669931, "link": "https://stackoverflow.com/questions/43669931/how-to-wait-until-form-finishes-when-using-tvar", "title": "How to wait until forM_ finishes, when using TVar?", "body": "<p>I'm writing a function, where I process a list using <code>forM_</code>, and append the result to a <code>TVar</code> list:</p>\n\n<pre><code>import Control.Concurrent.STM\nimport Control.Concurrent.STM.TVar\nimport Control.Concurrent (forkIO)\nimport Control.Monad (forM_)\n\ninsert :: a -&gt; [a] -&gt; [a]\ninsert = (:) -- stub\n\nmy_func_c :: (a -&gt; a) -&gt; [a] -&gt; IO [a]\nmy_func_c my_function arr = do\n\n    res_var &lt;- atomically $ newTVar ([]::[a])\n\n    forkIO $ forM_ arr $ \\x -&gt; atomically $ do\n        let y = id $! my_function x\n        modifyTVar res_var (insert y)\n\n    atomically $ readTVar res_var\n</code></pre>\n\n<p>The result is always empty, if I compile it with <code>-threaded</code>. How is it possible to wait for the threads to finish? I can not use <code>MVar</code> or <code>Async</code>. I have to solve this problem using <code>TVar</code>, or other data structures which are based on <code>TVar</code></p>\n"}, {"tags": ["haskell", "stack", "monads", "state-monad"], "comments": [{"owner": {"reputation": 40537, "user_id": 465378, "user_type": "registered", "accept_rate": 85, "profile_image": "https://www.gravatar.com/avatar/c03b8d34978563858020eff0d14cc17b?s=128&d=identicon&r=PG", "display_name": "Alexis King", "link": "https://stackoverflow.com/users/465378/alexis-king"}, "edited": false, "score": 5, "creation_date": 1493329229, "post_id": 43668326, "comment_id": 74383602, "body": "There are a couple problems here. First of all, you can\u2019t really define instances on type aliases (you can with GHC extensions, but it\u2019s the same as defining an instance on the underlying type). You should change <code>type Route a = ...</code> to <code>data Route a = Route ...</code> to create a fresh type to define instances on. Additionally, while <code>instance Applicative Route ...</code> is correct in this case, it\u2019s worth pointing out that you probably wanted to try <code>instance Applicative (Route a)</code>, <i>not</i> <code>instance Applicative Route a</code>. The latter is syntax for a multi-parameter typeclass."}, {"owner": {"reputation": 4071, "user_id": 3806046, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/5fedf50ce7cd2659bca902e9a2969158?s=128&d=identicon&r=PG&f=1", "display_name": "jkeuhlen", "link": "https://stackoverflow.com/users/3806046/jkeuhlen"}, "reply_to_user": {"reputation": 40537, "user_id": 465378, "user_type": "registered", "accept_rate": 85, "profile_image": "https://www.gravatar.com/avatar/c03b8d34978563858020eff0d14cc17b?s=128&d=identicon&r=PG", "display_name": "Alexis King", "link": "https://stackoverflow.com/users/465378/alexis-king"}, "edited": false, "score": 1, "creation_date": 1493330062, "post_id": 43668326, "comment_id": 74383946, "body": "@AlexisKing That should probably be turned into an answer!"}], "answers": [{"tags": [], "owner": {"reputation": 1, "user_id": 4957132, "user_type": "registered", "profile_image": "https://lh6.googleusercontent.com/-Uf-5TxbPgFA/AAAAAAAAAAI/AAAAAAAAAKA/UVkUgcUXIso/photo.jpg?sz=128", "display_name": "Chris Upshaw", "link": "https://stackoverflow.com/users/4957132/chris-upshaw"}, "is_accepted": false, "score": 0, "last_activity_date": 1493415622, "last_edit_date": 1493415622, "creation_date": 1493405443, "answer_id": 43687059, "question_id": 43668326, "link": "https://stackoverflow.com/questions/43668326/applicative-instance-requires-1-and-0-arguments/43687059#43687059", "title": "Applicative instance requires 1 AND 0 arguments", "body": "<p>I am not sure your Route type /is/ an applicative, or why it should be.</p>\n\n<p>What would <code>Route path (f,g) &lt;*&gt; Route path' (x,y)</code> mean?</p>\n\n<p>You are missing info you need here. (Namely the cost on the Up/Down street.)</p>\n\n<p>Your Route/RouteM type doesn't compose the way an applicative should.</p>\n\n<p>Also I would define <code>type Block a = {getUp::a,getDown:a,getCross:a)</code>\nand <code>type Street a = [Block]</code>. Then define a <code>Route a -&gt; Block a -&gt; Route a</code>.</p>\n"}], "owner": {"reputation": 930, "user_id": 4387539, "user_type": "registered", "accept_rate": 77, "profile_image": "https://i.stack.imgur.com/xN2AM.png?s=128&g=1", "display_name": "hyiltiz", "link": "https://stackoverflow.com/users/4387539/hyiltiz"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 109, "favorite_count": 0, "answer_count": 1, "score": 0, "last_activity_date": 1493415622, "creation_date": 1493328987, "last_edit_date": 1493333316, "question_id": 43668326, "link": "https://stackoverflow.com/questions/43668326/applicative-instance-requires-1-and-0-arguments", "title": "Applicative instance requires 1 AND 0 arguments", "body": "<p>I was going through \"Learn Yourself a Haskell\" and am trying to implement the \"Heathrow to London\" problem [1] in a Monadic way (instead of folds or explicit recursions). \n[1] <a href=\"http://learnyouahaskell.com/functionally-solving-problems#heathrow-to-london\" rel=\"nofollow noreferrer\">http://learnyouahaskell.com/functionally-solving-problems#heathrow-to-london</a></p>\n\n<p>My question is this: both <code>instance Applicative Route where</code> and <code>instance Applicative Route a where</code> makes GHC complain as below. So including a type parameter is wrong, but not including is also wrong. How do I overcome this by minimal change to the code (its implementation idea)? See implementation below the GHC error.</p>\n\n<pre><code>Prelude&gt; :r\n[1 of 1] Compiling Main             ( heathrowToLondon.hs, interpreted )\n\nheathrowToLondon.hs:70:10: error:\n    \u2022 Expecting one fewer argument to \u2018Applicative Route\u2019\n      Expected kind \u2018k0 -&gt; Constraint\u2019,\n        but \u2018Applicative Route\u2019 has kind \u2018Constraint\u2019\n    \u2022 In the instance declaration for \u2018Applicative Route a\u2019\nFailed, modules loaded: none.\nPrelude&gt; :r\n[1 of 1] Compiling Main             ( heathrowToLondon.hs, interpreted )\n\nheathrowToLondon.hs:70:10: error:\n    \u2022 The type synonym \u2018Route\u2019 should have 1 argument, but has been given none\n    \u2022 In the instance declaration for \u2018Applicative Route\u2019\nFailed, modules loaded: none.\n</code></pre>\n\n<p>My implementation was this: think of each street (one street above, one street below and the crossing avenue) costs as a <code>Street</code>, then think of <code>Route</code> as all the route until now as well as the cumulative costs of going <code>Up</code> or <code>Down</code> next. Then, <code>mempty</code> or <code>pure</code> for <code>Route</code> would be something like <code>([], (0,0))</code>. We define a binary operation <code>join</code> to <code>Route</code>, then we can get <code>&gt;=</code> by using <code>fmap</code> and <code>join</code>.  Partial code below:</p>\n\n<pre><code>{-# LANGUAGE TypeSynonymInstances #-} \n\nimport Data.List\nimport Data.List.Extra (chunksOf)\nimport Control.Monad\n\n-- Try this:\n-- solvePath [50, 10, 30, 5, 90, 20, 40, 2, 25, 10, 8]\n\ndata Path = Up | Down deriving (Show, Eq, Read)\ntype Costs a = (a, a)\ntype Street a = [a]\ntype Route a = ([Path], Costs a)\n\n-- Monadic!?\ntoRoute :: (Num a, Ord a) =&gt; Street a -&gt; Route a\ntoRoute [x,y,z] = ([], (min x (y+z), min y (x+z)))\ntoRoute _ = ([], (0,0))\n\ninstance Applicative Route where -- putting or not putting this `a` here doesn't work\n  pure x = toRoute x -- turns [1,2,5] Street value \n  f &lt;*&gt; g = undefined\n\n\n-- Irrelevant to this question but does the job\n-- Using explicit recursion\nsolvePath :: (Num a, Ord a) =&gt; Street a -&gt; [Path]\nsolvePath xs = reverse . crossStreet (0,0) [] $ 0:xs\n\ncrossStreet :: (Num a, Ord a) =&gt; Costs a -&gt; [Path] -&gt; Street a -&gt; [Path]\ncrossStreet (a,b) rd street\n  | null street        = rd\n  | a &gt; b             = crossStreet (a',b') (Down:rd) street'\n  | a == b &amp;&amp; a' &gt;= b' = crossStreet (a',b') (Down:rd) street'\n  | otherwise          = crossStreet (a',b') (Up:rd) street'\n  where (a',b') = (a + min x (y+z), b + min y (x+z))\n        (x:y:z:street') = street\n\n\n\n-- Using folds\nsolvePath' = reverse . fst . foldl' crossStreet' ([], (0,0)) . chunksOf 3 . (0:)\n\ncrossStreet' :: (Num a, Ord a) =&gt; Route a -&gt; Street a -&gt; Route a\ncrossStreet' (ps, (a,b)) [] = (ps, (a,b))\ncrossStreet' (ps, (a,b)) [x,y,z] = (ps', (a', b'))\n  where (a',b') = (a + min x (y+z), b + min y (x+z))\n        ps' = p:ps\n        p | a &gt; b || ((a==b) &amp;&amp; a' &gt;= b') = Down\n          | otherwise                     = Up\n</code></pre>\n\n<h2>Edit #1</h2>\n\n<p>Based on comments, I changed the definition for route into <code>RouteM</code> using <code>data</code>, and now the original complaint is solved. However, I still need to figure out how to implement the <code>&lt;*&gt;</code> though.</p>\n\n<pre><code>data RouteM a = RouteM {getPath :: [Path], getCost :: Costs a} deriving (Show, Eq, Read)\n\n-- Monadic!?\ntoRouteM :: (Num a, Ord a) =&gt; Street a -&gt; RouteM a\ntoRouteM [x,y,z] = RouteM [] (min x (y+z), min y (x+z))\ntoRouteM _ = RouteM [] (0, 0)\n\ninstance Functor RouteM where -- putting or not putting this `a` here doesn't work\n  fmap f r = RouteM (getPath r) (f . fst $ getCost r, f . snd $ getCost r)\n\ninstance Applicative RouteM where -- putting or not putting this `a` here doesn't work\n  pure x = RouteM [] (x, x)\n  f &lt;*&gt; r = undefined\n</code></pre>\n"}, {"tags": ["haskell", "ghci"], "answers": [{"tags": [], "owner": {"reputation": 990, "user_id": 3019990, "user_type": "registered", "accept_rate": 83, "profile_image": "https://i.stack.imgur.com/3rUcM.png?s=128&g=1", "display_name": "CAD97", "link": "https://stackoverflow.com/users/3019990/cad97"}, "is_accepted": false, "score": 1, "last_activity_date": 1493408401, "last_edit_date": 1493408401, "creation_date": 1493342357, "answer_id": 43670413, "question_id": 43667706, "link": "https://stackoverflow.com/questions/43667706/terminate-infinite-io-loop-in-ghci/43670413#43670413", "title": "Terminate infinite IO loop in GHCi", "body": "<p>It looks like this is <a href=\"https://ghc.haskell.org/trac/ghc/ticket/13359\" rel=\"nofollow noreferrer\">a known issue in GHCi</a>.</p>\n\n<blockquote>\n  <p>Thanks for the report, this seems to be an issue with the mingw-w64\n  runtime. I haven't narrowed it down yet, but essentially something\n  seems to be eating the events and it never reaches ghci.</p>\n  \n  <p><code>CtrlHandler</code> is never called.</p>\n  \n  <p>The following example shows the issue. It works when compiled using\n  the Microsoft compiler but doesn't with mingw-w64's GHC.</p>\n\n<pre><code>#include &lt;windows.h&gt;\n#include &lt;stdio.h&gt;\n\nBOOL CtrlHandler( DWORD fdwCtrlType ) {   switch( fdwCtrlType )   {\n    // Handle the CTRL-C signal.\n    case CTRL_C_EVENT:\n      printf( \"Ctrl-C event\\n\\n\" );\n      Beep( 750, 300 );\n      return( TRUE );\n\n    // CTRL-CLOSE: confirm that the user wants to exit.\n    case CTRL_CLOSE_EVENT:\n      Beep( 600, 200 );\n      printf( \"Ctrl-Close event\\n\\n\" );\n      return( TRUE );\n\n    // Pass other signals to the next handler.\n    case CTRL_BREAK_EVENT:\n      Beep( 900, 200 );\n      printf( \"Ctrl-Break event\\n\\n\" );\n      return FALSE;\n\n    case CTRL_LOGOFF_EVENT:\n      Beep( 1000, 200 );\n      printf( \"Ctrl-Logoff event\\n\\n\" );\n      return FALSE;\n\n    case CTRL_SHUTDOWN_EVENT:\n      Beep( 750, 500 );\n      printf( \"Ctrl-Shutdown event\\n\\n\" );\n      return FALSE;\n\n    default:\n      return FALSE;   } }\n\nint main( void ) {   if( SetConsoleCtrlHandler( (PHANDLER_ROUTINE) CtrlHandler, TRUE ) )   {\n    printf( \"\\nThe Control Handler is installed.\\n\" );\n    printf( \"\\n -- Now try pressing Ctrl+C or Ctrl+Break, or\" );\n    printf( \"\\n    try logging off or closing the console...\\n\" );\n    printf( \"\\n(...waiting in a loop for events...)\\n\\n\" );\n\n    while( 1 ){ }   }   else   {\n    printf( \"\\nERROR: Could not set control handler\");\n    return 1;   } return 0; }\n</code></pre>\n  \n  <p>This also doesn't work in an msys2 console, even though it appears to.\n  In the case of msys2 bash is disabling <code>ENABLE_PROCESSED_INPUT</code> so that\n  <code>CTRL+C</code> is not processed by the system and is reported as a input\n  stream. Bash is then just terminating the process by force.</p>\n  \n  <p>In the case of GHCi, something does clearly happen with the runtime\n  since it suddenly starts allocating a large amount of memory and\n  enters some kind of deadlock. So there are two separate issues here.</p>\n</blockquote>\n\n<p>(Note: I did not create this issue. It appears to have been first reported 2017-03-01. The issue is currently labeled as not an x86 issue but as effecting unknown/multiple architectures.)</p>\n"}], "owner": {"reputation": 990, "user_id": 3019990, "user_type": "registered", "accept_rate": 83, "profile_image": "https://i.stack.imgur.com/3rUcM.png?s=128&g=1", "display_name": "CAD97", "link": "https://stackoverflow.com/users/3019990/cad97"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 971, "favorite_count": 0, "answer_count": 1, "score": 1, "last_activity_date": 1493408401, "creation_date": 1493326378, "last_edit_date": 1493329414, "question_id": 43667706, "link": "https://stackoverflow.com/questions/43667706/terminate-infinite-io-loop-in-ghci", "title": "Terminate infinite IO loop in GHCi", "body": "<p>In order to facilitate reading a user-specified file while handling bad input, I've written this function:</p>\n\n<pre><code>readGetFile :: IO FilePath -&gt; IO String\nreadGetFile getName =\n    catch (getName &gt;&gt;= readFile) (\\e-&gt;do\n        let err = show (e :: IOException)\n        printf \"Couldn't open file %v. Please enter a valid filename.\\n\" err\n        readGetFile getName &gt;&gt;= return)\n</code></pre>\n\n<p><em>This question is not about this function, and it is just used to illustrate a point.</em></p>\n\n<p>If I call this function from GHCi, and eventually enter a good filename, it works as expected. However, if I try to terminate it early by hitting <kbd><kbd>CTRL</kbd>-<kbd>C</kbd></kbd>, strange things happen.</p>\n\n<pre><code>*Input&gt; readGetFile getLine\n{BadFile.jpeg\n}Couldn't open file BadFile.jpeg: openFile: does not exist (No such file or directory). Please enter a valid filename.\n{^C}Couldn't open file &lt;stdin&gt;: hGetLine: end of file. Please enter a valid filename.\n{^C}CouInterrupted.\nldn't p*Input&gt; e file &lt;stdin&gt;: hGetLine: end of file. Please enter a valid filename.\n{^C}Couldn't open file &lt;stdin&gt;: hGetLine: end of file. Please enter a valid filename.\n\n*Input&gt; {\n}Couldn't open file : openFile: does not exist (No such file or directory). Please enter a valid filename.\n</code></pre>\n\n<p>Note that text in <code>{}</code> is entered by me (and I did not type <code>{}</code>). <code>{^C}</code> is me just hitting <kbd><kbd>CTRL</kbd>-<kbd>C</kbd></kbd>.</p>\n\n<p>Obviously, the recursion is continuing to run and read from stdin, even as GHCi tries to resume running.</p>\n\n<p><strong>How can I terminate this loop from within GHCi?</strong></p>\n\n<p><em>Note: I have done <code>hSetBuffering stdout NoBuffering</code>. This question is not about the implementation of <code>readGetFile</code> and an answer <strong>must</strong> answer the bolded question above. An answer <strong>may</strong> provide a better way of implementing <code>readGetFile</code> in addition if the answer provides reasoning for why it is nicer in respect to keyboard interrupts while still achieving the desired goal.</em></p>\n\n<p>This apparently only occurs on Windows. I am on Windows running a default installation of Haskell Platform Core.</p>\n"}, {"tags": ["haskell", "set", "containers", "strictness"], "answers": [{"tags": [], "owner": {"reputation": 11487, "user_id": 1308058, "user_type": "registered", "accept_rate": 61, "profile_image": "https://www.gravatar.com/avatar/2be2ab74793559ea1c1dbdf55ccdf90b?s=128&d=identicon&r=PG", "display_name": "phadej", "link": "https://stackoverflow.com/users/1308058/phadej"}, "is_accepted": true, "score": 11, "last_activity_date": 1493327162, "creation_date": 1493327162, "answer_id": 43667890, "question_id": 43667691, "link": "https://stackoverflow.com/questions/43667691/does-haskell-have-a-strict-set-container/43667890#43667890", "title": "Does Haskell have a strict Set container?", "body": "<p><code>Set</code> is strict. In a same way as both <code>Map.Lazy</code> and <code>Map.Strict</code> are strict in the <em>key</em>. E.g from the <code>Data.Map.Lazy</code> module:</p>\n\n<blockquote>\n  <p>This module satisfies the following strictness property:</p>\n  \n  <ul>\n  <li>Key arguments are evaluated to WHNF</li>\n  </ul>\n</blockquote>\n\n<p>The reason is quite obvious: to make any decisions (i.e. something else than always return <code>EQ</code>) the <code>compare</code> have to evaluate the arguments to at least a WHNF (to separate different constructors in a sum type, e.g.)</p>\n"}], "owner": {"reputation": 8998, "user_id": 621449, "user_type": "registered", "accept_rate": 83, "profile_image": "https://i.stack.imgur.com/TJ6rv.jpg?s=128&g=1", "display_name": "Tarrasch", "link": "https://stackoverflow.com/users/621449/tarrasch"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 258, "favorite_count": 0, "accepted_answer_id": 43667890, "answer_count": 1, "score": 8, "last_activity_date": 1493327162, "creation_date": 1493326328, "question_id": 43667691, "link": "https://stackoverflow.com/questions/43667691/does-haskell-have-a-strict-set-container", "title": "Does Haskell have a strict Set container?", "body": "<p>If we look at the <a href=\"http://hackage.haskell.org/package/containers\" rel=\"noreferrer\"><code>containers</code></a> package. They have <a href=\"http://hackage.haskell.org/package/containers-0.5.10.2/docs/Data-Map-Strict.html\" rel=\"noreferrer\"><code>Data.Map.Strict</code></a>, but there is no equivalent <code>Data.Set.Strict</code>. Would it make sense for it to exist?</p>\n"}, {"tags": ["parsing", "haskell", "input", "indentation"], "answers": [{"comments": [{"owner": {"reputation": 67, "user_id": 7847767, "user_type": "registered", "accept_rate": 0, "profile_image": "https://graph.facebook.com/10208231670339035/picture?type=large", "display_name": "Felipe Otero", "link": "https://stackoverflow.com/users/7847767/felipe-otero"}, "edited": false, "score": 0, "creation_date": 1493328079, "post_id": 43668045, "comment_id": 74383125, "body": "Thanks for the quick answer:  data Cliente = Uncliente {nombre::String,resistencia::Int,bebidas::[Bebida],amigos::[&zwnj;&#8203;Cliente]} deriving (Show)   type Bebida = Cliente -&gt; Cliente  This are my data and types. i modified the &quot;Amigos&quot; field but i keep getting that Parse error on &#39;|&#39;"}], "tags": [], "owner": {"reputation": 75362, "user_id": 625403, "user_type": "registered", "accept_rate": 82, "profile_image": "https://www.gravatar.com/avatar/786eed7da67079cb5d63a49d469af25b?s=128&d=identicon&r=PG", "display_name": "amalloy", "link": "https://stackoverflow.com/users/625403/amalloy"}, "is_accepted": false, "score": 0, "last_activity_date": 1493327778, "creation_date": 1493327778, "answer_id": 43668045, "question_id": 43667607, "link": "https://stackoverflow.com/questions/43667607/parse-error-on-guards-haskell/43668045#43668045", "title": "Parse error on Guards (Haskell)", "body": "<p>The code you have pasted has no syntactical errors: it works fine when I paste it into a .hs file, with an appropriate definition for <code>Cliente</code>.</p>\n\n<p>The one mistake that you do have wouldn't cause the error message you're getting:</p>\n\n<pre><code>cliente {amigos = otroCliente : amigos}\n</code></pre>\n\n<p>The second occurrence of <code>amigos</code> has the wrong type here: recall that <code>amigos</code> is a <em>function</em> defined by your record. It is not implicitly pattern-matched against <code>cliente</code>. Instead, you could write something like:</p>\n\n<pre><code>cliente {amigos = otroCliente : amigos cliente}\n</code></pre>\n"}], "owner": {"reputation": 67, "user_id": 7847767, "user_type": "registered", "accept_rate": 0, "profile_image": "https://graph.facebook.com/10208231670339035/picture?type=large", "display_name": "Felipe Otero", "link": "https://stackoverflow.com/users/7847767/felipe-otero"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 148, "favorite_count": 0, "answer_count": 1, "score": 0, "last_activity_date": 1493327778, "creation_date": 1493325951, "question_id": 43667607, "link": "https://stackoverflow.com/questions/43667607/parse-error-on-guards-haskell", "title": "Parse error on Guards (Haskell)", "body": "<p>I have the following code</p>\n\n<pre><code>reconocerCliente :: Cliente -&gt; Cliente -&gt; Cliente\nreconocerCliente cliente otroCliente\n       | verificarCliente cliente otroCliente = cliente {amigos = otroCliente : amigos}\n       | otherwise = id cliente\n</code></pre>\n\n<p>This are the used functions:</p>\n\n<pre><code>verificarCliente :: Cliente -&gt; Cliente -&gt; Bool\nverificarCliente cliente otroCliente = (esElMismo cliente otroCliente) &amp;&amp; not(any(== otroCliente) amigos)\n\nesElMismo :: Cliente -&gt; Cliente -&gt; Bool\nesElMismo (Uncliente nombre _ _ _) (Uncliente otroNombre _ _ _) = nombre /= otroNombre\n</code></pre>\n\n<p>Each time i compile i get \"error: parse error on input \u2018|\u2019\"</p>\n\n<p>Exactly in this line:</p>\n\n<pre><code>   | verificarCliente cliente otroCliente = cliente {amigos = otroCliente : amigos}\n</code></pre>\n\n<p>I dont know if my problem is with the indentation (Its done with spaces and not with Tabs) or my guards</p>\n"}, {"tags": ["haskell", "monads", "applicative", "monoids"], "comments": [{"owner": {"reputation": 51584, "user_id": 839246, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/9b0573c2b936b12828dd1e4cc04206dc?s=128&d=identicon&r=PG&f=1", "display_name": "bheklilr", "link": "https://stackoverflow.com/users/839246/bheklilr"}, "edited": false, "score": 0, "creation_date": 1493325241, "post_id": 43667374, "comment_id": 74381775, "body": "You can use the <code>Sum</code> newtype that encodes a <code>Monoid</code> instance for numbers for this.  Numbers can often belong to multiple <code>Monoid</code> instances, hence why there isn&#39;t one defined for them by default.  You have to choose which one you want to use.  I might also suggest you look into the <code>Control.Arrow</code> module, as what you want to do can be described fairly easily with those combinators."}], "answers": [{"comments": [{"owner": {"reputation": 930, "user_id": 4387539, "user_type": "registered", "accept_rate": 77, "profile_image": "https://i.stack.imgur.com/xN2AM.png?s=128&g=1", "display_name": "hyiltiz", "link": "https://stackoverflow.com/users/4387539/hyiltiz"}, "edited": false, "score": 0, "creation_date": 1493328123, "post_id": 43667656, "comment_id": 74383144, "body": "Looks like my answer, but I feel like it is a bit complicated than simply just using the lambda :/"}, {"owner": {"reputation": 48938, "user_id": 246886, "user_type": "registered", "accept_rate": 94, "profile_image": "https://www.gravatar.com/avatar/dd1ebaade6623fc538fb8af3338e730d?s=128&d=identicon&r=PG", "display_name": "Jon Purdy", "link": "https://stackoverflow.com/users/246886/jon-purdy"}, "edited": false, "score": 0, "creation_date": 1493429673, "post_id": 43667656, "comment_id": 74428064, "body": "You also don\u2019t need to repeat <code>Sum</code> everywhere, because there\u2019s an <code>instance (Num a) =&gt; Num (Sum a)</code>, so inference can get it as long as it\u2019s not ambiguous. For example, <code>case (1, 2) &lt;&gt; (3, 4) of (Sum x, Sum y) -&gt; (x, y)</code>."}, {"owner": {"reputation": 100892, "user_id": 745903, "user_type": "registered", "accept_rate": 74, "profile_image": "https://www.gravatar.com/avatar/50933f6638836741e620669b3940410e?s=128&d=identicon&r=PG", "display_name": "leftaroundabout", "link": "https://stackoverflow.com/users/745903/leftaroundabout"}, "reply_to_user": {"reputation": 48938, "user_id": 246886, "user_type": "registered", "accept_rate": 94, "profile_image": "https://www.gravatar.com/avatar/dd1ebaade6623fc538fb8af3338e730d?s=128&d=identicon&r=PG", "display_name": "Jon Purdy", "link": "https://stackoverflow.com/users/246886/jon-purdy"}, "edited": false, "score": 0, "creation_date": 1493460140, "post_id": 43667656, "comment_id": 74433926, "body": "@JonPurdy right, but that <code>Num</code> instance won&#39;t help if the tuples contain not just number literals (which is almost certainly not the actual use case) but variables whose type is already rigid."}], "tags": [], "owner": {"reputation": 100892, "user_id": 745903, "user_type": "registered", "accept_rate": 74, "profile_image": "https://www.gravatar.com/avatar/50933f6638836741e620669b3940410e?s=128&d=identicon&r=PG", "display_name": "leftaroundabout", "link": "https://stackoverflow.com/users/745903/leftaroundabout"}, "is_accepted": true, "score": 6, "last_activity_date": 1493465097, "last_edit_date": 1493465097, "creation_date": 1493326176, "answer_id": 43667656, "question_id": 43667374, "link": "https://stackoverflow.com/questions/43667374/mappend-a1-b1-and-a2-b2-into-a1a2-b1b2/43667656#43667656", "title": "Mappend (a1,b1) and (a2,b2) into (a1+a2, b1+b2)", "body": "<p>Numbers are monoids, that's not the problem. The problem is that there are <em>two different, equally good ways</em> in which they are monoids \u2013 addition is only one, the other is multiplication. The standard library thus decided to not give a monoid instance at all, which I think is a good decision.</p>\n\n<p>Haskell allows packing types in <em>newtype wrappers</em> to select an instance without affecting the underlying type. The two different monoid instances are available in base:</p>\n\n<pre><code>Prelude Data.Monoid&gt; case (Sum 1, Sum 2)&lt;&gt;(Sum 3, Sum 4) of (Sum a, Sum b) -&gt; (a,b)\n(4,6)\n</code></pre>\n\n<p>A bit awkward. There are a couple of ways in which you can make this more concise (I don't really <em>recommend</em> any of them; see bottom for a better solution). First, as Jon remarks in the comments, if the tuples contain just plain number literals like in your example, there's no need to explicitly wrap them in the <code>Sum</code> constructor, since there is an instance <code>Num a =&gt; Num (Sum a)</code> an number literals are polymorphic, i.e. the following will do:</p>\n\n<pre><code>Prelude Data.Monoid&gt; case (1,2) &lt;&gt; (3,4) of (Sum x, Sum y) -&gt; (x,y)\n(4,6)\n</code></pre>\n\n<p>however, if the types of the tuple elements are already fixed...</p>\n\n<pre><code>Prelude Data.Monoid&gt; let [a,b,c,d] = [1,2,3,4] :: [Int]\nPrelude Data.Monoid&gt; case (a,b) &lt;&gt; (c,d) of (Sum x, Sum y) -&gt; (x,y) :: (Int,Int) \n&lt;interactive&gt;:6:25:\n    Couldn't match expected type \u2018Int\u2019 with actual type \u2018Sum Int\u2019\n    In the pattern: Sum x\n    In the pattern: (Sum x, Sum y)\n    In a case alternative: (Sum x, Sum y) -&gt; (x, y) :: (Int, Int)\n</code></pre>\n\n<p>Here you need to be explicit where the wrapping should happen. You can still briefen it a bit by using <a href=\"http://hackage.haskell.org/package/base-4.9.1.0/docs/Data-Coerce.html\" rel=\"nofollow noreferrer\">type-safe coercions</a>, which allow you to wrap all the elements of an entire container (tuples, lists, maps, arrays...) in a newtype such as <code>Sum</code> in one go (and in <em>O</em> (1) time&amp;space, which can also be quite a bonus).</p>\n\n<pre><code>Prelude Data.Monoid Data.Coerce&gt; case coerce (a,b) &lt;&gt; coerce (c,d) of (Sum x, Sum y) -&gt; (x,y) :: (Int,Int)\n(4,6)\n</code></pre>\n\n<p>Even briefer, and less reliant on local signatures, could be an approach using the <a href=\"http://hackage.haskell.org/package/newtype-0.2/docs/Control-Newtype.html\" rel=\"nofollow noreferrer\"><code>Newtype</code> class</a>:</p>\n\n<pre><code>Prelude Data.Monoid&gt; :m +Control.Newtype\nPrelude Data.Monoid Control.Newtype&gt; :m +Control.Arrow\nPrelude Data.Monoid Control.Newtype Control.Arrow&gt; :simpleprompt \n&gt; ala (Sum***Sum) foldMap [(1,2), (3,4)]\n(4,6)\n</code></pre>\n\n<p>...however, as I was rather surprised to find out now, the <code>newtype</code> library doesn't come with the tuple instance that's necessary for this. You can define it yourself though:</p>\n\n<pre><code>&gt; :set -XFunctionalDependencies -XUndecidableInstances\n&gt; instance (Newtype a \u03b1, Newtype b \u03b2) =&gt; Newtype (a,b) (\u03b1,\u03b2) where {pack=pack***pack; unpack=unpack***unpack}\n</code></pre>\n\n<hr>\n\n<p>If you really only need the additive monoid, I recommend you instead use a dedicated <em>class</em> for addition: <a href=\"http://hackage.haskell.org/package/vector-space-0.10.4/docs/Data-AdditiveGroup.html\" rel=\"nofollow noreferrer\"><code>AdditiveGroup</code></a></p>\n\n<pre><code>Prelude Data.AdditiveGroup&gt; (1,2)^+^(3,4)\n(4,6)\n</code></pre>\n"}, {"comments": [{"owner": {"reputation": 100892, "user_id": 745903, "user_type": "registered", "accept_rate": 74, "profile_image": "https://www.gravatar.com/avatar/50933f6638836741e620669b3940410e?s=128&d=identicon&r=PG", "display_name": "leftaroundabout", "link": "https://stackoverflow.com/users/745903/leftaroundabout"}, "edited": false, "score": 0, "creation_date": 1493371390, "post_id": 43669277, "comment_id": 74399132, "body": "This would work with far fewer parenthesis if you called the functions e.g. <code>bisum</code> and <code>getBisum</code> instead of using postfix syntax."}], "tags": [], "owner": {"reputation": 8237, "user_id": 2900502, "user_type": "registered", "accept_rate": 73, "profile_image": "https://i.stack.imgur.com/R1OjD.jpg?s=128&g=1", "display_name": "Shersh", "link": "https://stackoverflow.com/users/2900502/shersh"}, "is_accepted": false, "score": 1, "last_activity_date": 1493334216, "creation_date": 1493334216, "answer_id": 43669277, "question_id": 43667374, "link": "https://stackoverflow.com/questions/43667374/mappend-a1-b1-and-a2-b2-into-a1a2-b1b2/43669277#43669277", "title": "Mappend (a1,b1) and (a2,b2) into (a1+a2, b1+b2)", "body": "<p>This also can be done in some simple and stupid but fancy way (though this approach requires turning your <em>Haskell</em> into <em>Lisp</em>).</p>\n\n<pre><code>{-# LANGUAGE PostfixOperators #-}\n\nimport Data.Bifunctor (bimap)\nimport Data.Semigroup (Sum (..), (&lt;&gt;))\n\n(+?) :: (a, b) -&gt; (Sum a, Sum b)\n(+?) = bimap Sum Sum\n\n(+!) :: (Sum a, Sum b) -&gt; (a, b)\n(+!) = bimap getSum getSum\n</code></pre>\n\n<p>And then in <code>ghci</code>:</p>\n\n<pre><code>ghci&gt; (( ((1,2) +?) &lt;&gt; ((3,4) +?)) +!)\n(4,6)\n</code></pre>\n"}, {"tags": [], "owner": {"reputation": 31243, "user_id": 2751851, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/4ddc0.png?s=128&g=1", "display_name": "duplode", "link": "https://stackoverflow.com/users/2751851/duplode"}, "is_accepted": false, "score": 3, "last_activity_date": 1493335502, "creation_date": 1493335502, "answer_id": 43669474, "question_id": 43667374, "link": "https://stackoverflow.com/questions/43667374/mappend-a1-b1-and-a2-b2-into-a1a2-b1b2/43669474#43669474", "title": "Mappend (a1,b1) and (a2,b2) into (a1+a2, b1+b2)", "body": "<p>If you allow me to overlook the role of <code>Monoid</code> in your question, here are a couple ways to express it in terms of <a href=\"https://hackage.haskell.org/package/bifunctors-5.4.1/docs/Data-Biapplicative.html\" rel=\"nofollow noreferrer\"><code>Biapplicative</code> from <em>bifunctors</em></a>, which is a pretty straightforward generalisation of <code>Applicative</code> to <code>Bifunctor</code>s:</p>\n\n<pre><code>GHCi&gt; import Data.Biapplicative\nGHCi&gt; :t bimap\nbimap :: Bifunctor p =&gt; (a -&gt; b) -&gt; (c -&gt; d) -&gt; p a c -&gt; p b d\nGHCi&gt; :t (&lt;&lt;*&gt;&gt;)\n(&lt;&lt;*&gt;&gt;) :: Biapplicative p =&gt; p (a -&gt; b) (c -&gt; d) -&gt; p a c -&gt; p b d\nGHCi&gt; bimap (+) (+) (1,2) &lt;&lt;*&gt;&gt; (3,4)\n(4,6)\nGHCi&gt; :t biliftA2\nbiliftA2\n  :: Biapplicative w =&gt;\n     (a -&gt; b -&gt; c) -&gt; (d -&gt; e -&gt; f) -&gt; w a d -&gt; w b e -&gt; w c f\nGHCi&gt; biliftA2 (+) (+) (1,2) (3,4)\n(4,6)\n</code></pre>\n"}], "owner": {"reputation": 930, "user_id": 4387539, "user_type": "registered", "accept_rate": 77, "profile_image": "https://i.stack.imgur.com/xN2AM.png?s=128&g=1", "display_name": "hyiltiz", "link": "https://stackoverflow.com/users/4387539/hyiltiz"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 108, "favorite_count": 0, "accepted_answer_id": 43667656, "answer_count": 3, "score": 2, "last_activity_date": 1493465097, "creation_date": 1493325009, "question_id": 43667374, "link": "https://stackoverflow.com/questions/43667374/mappend-a1-b1-and-a2-b2-into-a1a2-b1b2", "title": "Mappend (a1,b1) and (a2,b2) into (a1+a2, b1+b2)", "body": "<p>I recall this is very basic, and could simply be done with pattern matching even through a lambda like <code>(\\a b -&gt; (fst a + fst b, snd a + snd b) )  (1,2) (3,4)</code>. However, I think there should be ways provided by the Haskell standard library to do things like this. The definition of <code>mappend</code> for <code>(a,b)</code> type as Monoids looks quite similar. But doing the following didn't work:</p>\n\n<pre><code>(1,2) `mappend` (3,4)\n</code></pre>\n\n<p>Any Haskell way of adding two 2-tuples?</p>\n"}, {"tags": ["haskell", "boolean-logic"], "comments": [{"owner": {"reputation": 45741, "user_id": 744178, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/a3193139ea494c45e63752504f5ff1f2?s=128&d=identicon&r=PG", "display_name": "jwodder", "link": "https://stackoverflow.com/users/744178/jwodder"}, "edited": false, "score": 1, "creation_date": 1493319098, "post_id": 43665638, "comment_id": 74378517, "body": "&quot;Literal&quot; is misspelled."}, {"owner": {"reputation": 75362, "user_id": 625403, "user_type": "registered", "accept_rate": 82, "profile_image": "https://www.gravatar.com/avatar/786eed7da67079cb5d63a49d469af25b?s=128&d=identicon&r=PG", "display_name": "amalloy", "link": "https://stackoverflow.com/users/625403/amalloy"}, "edited": false, "score": 1, "creation_date": 1493321080, "post_id": 43665638, "comment_id": 74379574, "body": "So are unitClause and Formula, but who cares? I would object if this were a code review for a codebase I work in, but perfect English variable names isn&#39;t a necessary bar for getting help on Stack Overflow."}, {"owner": {"reputation": 75362, "user_id": 625403, "user_type": "registered", "accept_rate": 82, "profile_image": "https://www.gravatar.com/avatar/786eed7da67079cb5d63a49d469af25b?s=128&d=identicon&r=PG", "display_name": "amalloy", "link": "https://stackoverflow.com/users/625403/amalloy"}, "edited": false, "score": 1, "creation_date": 1493321292, "post_id": 43665638, "comment_id": 74379695, "body": "I think this question would be clearer if you were explicit about the meaning of your types: you have a list of list of propositions, but don&#39;t explain what the two levels of nesting mean. By reading the functions you&#39;ve implemented I can conclude that your representation is what&#39;s known as <a href=\"https://en.wikipedia.org/wiki/Conjunctive_normal_form\" rel=\"nofollow noreferrer\">conjunctive normal form</a>, but it would be easier to help if you said so up front instead of readers having to puzzle that out by reverse engineering your functions."}, {"owner": {"reputation": 57219, "user_id": 33796, "user_type": "registered", "accept_rate": 70, "profile_image": "https://www.gravatar.com/avatar/08727b23ba62e634b32988cdff082663?s=128&d=identicon&r=PG", "display_name": "luqui", "link": "https://stackoverflow.com/users/33796/luqui"}, "reply_to_user": {"reputation": 75362, "user_id": 625403, "user_type": "registered", "accept_rate": 82, "profile_image": "https://www.gravatar.com/avatar/786eed7da67079cb5d63a49d469af25b?s=128&d=identicon&r=PG", "display_name": "amalloy", "link": "https://stackoverflow.com/users/625403/amalloy"}, "edited": false, "score": 0, "creation_date": 1493339833, "post_id": 43665638, "comment_id": 74386994, "body": "@amalloy, I don&#39;t read jwodder&#39;s comment as a criticism of the question&#39;s value.  Just feedback.  Spelling common CS words correctly is useful for being part of a community."}], "answers": [{"tags": [], "owner": {"reputation": 3627, "user_id": 3695939, "user_type": "registered", "accept_rate": 69, "profile_image": "https://www.gravatar.com/avatar/d75f41bcfc1d3f20c084ec7e87d82012?s=128&d=identicon&r=PG&f=1", "display_name": "moondaisy", "link": "https://stackoverflow.com/users/3695939/moondaisy"}, "is_accepted": true, "score": 1, "last_activity_date": 1493340944, "last_edit_date": 1493340944, "creation_date": 1493339415, "answer_id": 43670047, "question_id": 43665638, "link": "https://stackoverflow.com/questions/43665638/haskell-working-with-math-logic/43670047#43670047", "title": "Haskell working with Math Logic", "body": "<p>Using the functions you have already defined:</p>\n\n<p>A function <code>hasAlone</code> if an expression contains a clause that contains only one literal ex: <code>[[a], [a, b, - c]]</code>. </p>\n\n<p>So basically, it checks item by item to see if it is an unit clause in which case it returns <code>True</code>.</p>\n\n<pre><code>hasAlone :: Formule -&gt; Bool\nhasAlone [] = False\nhasAlone (x:xs)\n    | unitClaus x = True\n    | otherwise = hasAlone xs\n</code></pre>\n\n<p>A function <code>findAlone</code> that checks if an expression verifies <code>hasAlone</code> and also returns the alone literal; ex: <code>[[- a][b, c, e]] =&gt; [- a]</code>. </p>\n\n<p>In this case, I'm assuming you only want the literal for the first unit clause that shows up. It is the same idea that in <code>hasAlone</code> but instead of returning a <code>Bool</code> it returns the literal.</p>\n\n<pre><code>findAlone :: Formule -&gt; Litteral\nfindAlone [] = error \"No alone litteral\"\nfindAlone (x:xs)\n    | unitClaus x = head x\n    | otherwise = findAlone xs\n</code></pre>\n\n<p>A function <code>removeAlone</code> that removes clause containing the alone literal from the expression. </p>\n\n<p>In this case, I include two version, one that removes all the unit clauses and another that removes just the first one. See that if it isn't an unit clause I keep it by adding it at the top of the list that results from the recursion.</p>\n\n<pre><code>-- Removes all the unit clauses\nremoveAlone :: Formule -&gt; Formule\nremoveAlone [] = []\nremoveAlone (x:xs)\n    | unitClaus x = removeAlone xs\n    | otherwise = x:(removeAlone xs)\n\n-- Removes the first unit clauses\nremoveAlone1 :: Formule -&gt; Formule\nremoveAlone1 [] = []\nremoveAlone1 (x:xs)\n    | unitClaus x = xs\n    | otherwise = x:(removeAlone xs)\n</code></pre>\n\n<p>A function <code>isEvidentContradictory</code> that returns <code>True</code> if an expression (logical expression) contains at least two unit clauses, one of which contains a literal while the other contains the opposite literal; ex: <code>[[a], [b], [- b]]</code>. </p>\n\n<p>In this case I started by assuming that expression means <code>Formule</code> (I hope that's okay). After that, the function checks item by item to see if it is a unit clause (same thing I have been doing in all the functions so far), in which case it looks for a unit clause containing the oposite literal in the rest of the list.</p>\n\n<p>You could define an auxiliar function that does this part <code>elem ((Main.negate (head x)):[]) xs</code>, which is looking for the a unit clause containing the negative literal, just so that it looks neater.</p>\n\n<pre><code>isEvidentContradictory :: Formule -&gt; Bool\nisEvidentContradictory [] = False;\nisEvidentContradictory (x:xs) \n    | unitClaus x = elem ((Main.negate (head x)):[]) xs || isEvidentContradictory xs\n    | otherwise = isEvidentContradictory xs\n</code></pre>\n"}], "owner": {"reputation": 315, "user_id": 5655174, "user_type": "registered", "accept_rate": 10, "profile_image": "https://i.stack.imgur.com/fGEyb.png?s=128&g=1", "display_name": "Chihab", "link": "https://stackoverflow.com/users/5655174/chihab"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 176, "favorite_count": 1, "accepted_answer_id": 43670047, "answer_count": 1, "score": 0, "last_activity_date": 1493340944, "creation_date": 1493318428, "last_edit_date": 1493319214, "question_id": 43665638, "link": "https://stackoverflow.com/questions/43665638/haskell-working-with-math-logic", "title": "Haskell working with Math Logic", "body": "<p>I'm working on this practice problem in which I have to write a bunch of functions in Haskell functional programming language. I manage to write some of them but not all, and I need those that I couldn't finish to proceed in the practice sheet. Can somebody suggest some ideas?</p>\n\n<p>Here are the types I'm working with:</p>\n\n<pre><code>data Litteral = Pos Char | Neg Char\n      deriving (Show, Eq)\n\ntype Clause = [Litteral]\n\ntype Formule = [Clause]\n\ntype Distribution = [(Char, Bool)]\n</code></pre>\n\n<p>Here are the functions I was able to write:</p>\n\n<pre><code>negate :: Litteral -&gt; Litteral\nnegate (Pos v) = Neg v\nnegate (Neg v) = Pos v\n\nunitClaus :: Clause -&gt; Bool\nunitClaus [_] = True\nunitClaus _  = False\n\nassociate :: Litteral -&gt; (Char, Bool)\nassociate (Pos c) = (c, True)\nassociate (Neg c) = (c, False)\n\n\nisTautology:: Clause -&gt; Bool\nisTautology [] = False\nisTautology [_] = False\nisTautology (x:xs)\n    | elem (negation x) xs = True\n    | otherwise = isTautology (xs)\n</code></pre>\n\n<p>I still need:</p>\n\n<ul>\n<li><p>a function <code>isEvidentContradictory</code> that returns True if an expression (logical expression) contains at least two unit clauses, one of which contains a literal while the other contains the opposite literal; ex: <code>[[a], [b], [- b]]</code></p></li>\n<li><p>a function <code>hasAlone</code> if an expression contains a clause that contains only one literal ex: <code>[[a], [a, b, - c]]</code></p></li>\n<li><p>a function <code>findAlone</code> that checks if an expression verifies <code>hasAlone</code> and also returns the alone literal; ex: <code>[[- a][b, c, e]] =&gt; [- a]</code></p></li>\n<li><p>a function <code>removeAlone</code> that removes clause containing the alone literal from the expression</p></li>\n</ul>\n"}, {"tags": ["haskell", "indexing", "traversal", "haskell-lens"], "answers": [{"comments": [{"owner": {"reputation": 3128, "user_id": 3040129, "user_type": "registered", "accept_rate": 86, "profile_image": "https://i.stack.imgur.com/TcwLC.png?s=128&g=1", "display_name": "illabout", "link": "https://stackoverflow.com/users/3040129/illabout"}, "edited": false, "score": 0, "creation_date": 1493349011, "post_id": 43668115, "comment_id": 74389074, "body": "Okay, I think this makes sense.  So if we weren&#39;t using <code>Indexable</code> (and we didn&#39;t have <code>Index</code>), we wouldn&#39;t be able to compose regular optics with indexed optics, right?  For instance, we&#39;re not able to compose <code>itraverse</code> with <code>traverse</code> and get a regular non-indexed traversal, right?  Is there any time I would want to use <code>itraverse</code> instead of <code>itraversed</code> if I am working with the operations like <code>set</code>, <code>over</code>, etc?"}, {"owner": {"reputation": 11487, "user_id": 1308058, "user_type": "registered", "accept_rate": 61, "profile_image": "https://www.gravatar.com/avatar/2be2ab74793559ea1c1dbdf55ccdf90b?s=128&d=identicon&r=PG", "display_name": "phadej", "link": "https://stackoverflow.com/users/1308058/phadej"}, "reply_to_user": {"reputation": 3128, "user_id": 3040129, "user_type": "registered", "accept_rate": 86, "profile_image": "https://i.stack.imgur.com/TcwLC.png?s=128&g=1", "display_name": "illabout", "link": "https://stackoverflow.com/users/3040129/illabout"}, "edited": false, "score": 1, "creation_date": 1493374066, "post_id": 43668115, "comment_id": 74400901, "body": "@illabout i you use everything thru lens combinators, then you probably won&#39;t need <code>itraverse</code>. Though sometimes it reads better than <code>itraverseOf itraversed</code> (subjectively)"}, {"owner": {"reputation": 11487, "user_id": 1308058, "user_type": "registered", "accept_rate": 61, "profile_image": "https://www.gravatar.com/avatar/2be2ab74793559ea1c1dbdf55ccdf90b?s=128&d=identicon&r=PG", "display_name": "phadej", "link": "https://stackoverflow.com/users/1308058/phadej"}, "reply_to_user": {"reputation": 3128, "user_id": 3040129, "user_type": "registered", "accept_rate": 86, "profile_image": "https://i.stack.imgur.com/TcwLC.png?s=128&g=1", "display_name": "illabout", "link": "https://stackoverflow.com/users/3040129/illabout"}, "edited": false, "score": 1, "creation_date": 1493374223, "post_id": 43668115, "comment_id": 74401020, "body": "anecdotally, <code>traverse . itraverse</code> &quot;works&quot;, but <code>traverse . traverse</code> doesn&#39;t, so it just better to not use those. It&#39;s the same as that you can do <code>(traverse . traverse) f xss</code> without any <code>lens</code> stuff (<code>traverseOf = id</code>)."}], "tags": [], "owner": {"reputation": 11487, "user_id": 1308058, "user_type": "registered", "accept_rate": 61, "profile_image": "https://www.gravatar.com/avatar/2be2ab74793559ea1c1dbdf55ccdf90b?s=128&d=identicon&r=PG", "display_name": "phadej", "link": "https://stackoverflow.com/users/1308058/phadej"}, "is_accepted": true, "score": 4, "last_activity_date": 1493328086, "creation_date": 1493328086, "answer_id": 43668115, "question_id": 43663596, "link": "https://stackoverflow.com/questions/43663596/why-have-both-itraverse-and-itraversed-functions-in-haskells-lens-library/43668115#43668115", "title": "Why have both itraverse and itraversed functions in Haskell&#39;s lens library?", "body": "<p>Indexed optics aren't as simple as regular ones. Regular <code>Traversal</code> is simple:</p>\n\n<pre><code>type Traversal s t a b = forall f. Applicative f =&gt; (a -&gt; f b) -&gt; s -&gt; f t\n</code></pre>\n\n<p>That is exactly the type of <code>traverse</code> with <code>s = c a</code> and <code>t = c b</code>, where <code>c</code> is a <code>Traversable</code>.</p>\n\n<p>You could imagine that <code>IndexedTraversal i</code> is something similar with <code>(i -&gt; a -&gt; f b)</code>; but it isn't!</p>\n\n<pre><code>type IndexedTraversal i s t a b =\n    forall p f. (Indexable i p, Applicative f) =&gt; p a (f b) -&gt; s -&gt; f t\n</code></pre>\n\n<p>The <code>Indexable i p</code> constraint is satisfied by <code>(-&gt;)</code> and <code>Indexed</code>, so:</p>\n\n<pre><code>itraverse  :: Applicative f =&gt; (i -&gt; a -&gt; f b) -&gt; s -&gt; f t\nitraversed :: Applicative f =&gt;      (a -&gt; f b) -&gt; s -&gt; f t  -- (-&gt;)\nitraversed :: Applicativef  =&gt;   Indexed i a b -&gt; s -&gt; f t\n</code></pre>\n\n<p>where</p>\n\n<pre><code>newtype Indexed i a b = Indexed { runIndexed :: i -&gt; a -&gt; b } \n</code></pre>\n\n<hr>\n\n<p>Why both are needed? <code>itraverse</code> is way more easy to implement. Usually\nit's already there (e.g. <code>traverseWithKey</code> in <code>containers</code>).</p>\n\n<hr>\n\n<p>The operations require concrete instantiations of the optics\n(e.g. <code>set</code> requires <code>ASetter</code>). Shortly: it's easier for compiler to figure\nout stuff, as we don't use <code>Rank2Types</code>.</p>\n\n<p><code>Indexed</code> i.e. separate <code>newtype</code> is needed so we can talk\nabout <code>a -&gt; b</code> and <code>i -&gt; a -&gt; b</code> as instances of <code>Indexable</code>;\nthat let's us degrade indexed optics into regular ones:</p>\n\n<pre><code>Prelude Control.Lens&gt; over itraversed (+1) [1,2,3]\n[2,3,4]\n</code></pre>\n\n<p>and having <code>p a (f b) -&gt; q s (f t)</code> (where <code>p</code> can be <code>(-&gt;)</code> or <code>Indexable</code>)\nlet us compose indexed and regular optics:</p>\n\n<pre><code>Prelude Control.Lens&gt; over (itraversed . traversed)  (+1) [[1,2],[3]]\n[[2,3],[4]]\n</code></pre>\n\n<p>or</p>\n\n<pre><code>Prelude Control.Lens&gt; iover (itraversed . traversed) (,) [[1,2],[3]]\n[[(0,1),(1,2)],[(0,3)]]\n</code></pre>\n"}], "owner": {"reputation": 3128, "user_id": 3040129, "user_type": "registered", "accept_rate": 86, "profile_image": "https://i.stack.imgur.com/TcwLC.png?s=128&g=1", "display_name": "illabout", "link": "https://stackoverflow.com/users/3040129/illabout"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 202, "favorite_count": 0, "accepted_answer_id": 43668115, "answer_count": 1, "score": 3, "last_activity_date": 1493328086, "creation_date": 1493311537, "question_id": 43663596, "link": "https://stackoverflow.com/questions/43663596/why-have-both-itraverse-and-itraversed-functions-in-haskells-lens-library", "title": "Why have both itraverse and itraversed functions in Haskell&#39;s lens library?", "body": "<p>The Haskell library <a href=\"https://hackage.haskell.org/package/lens\" rel=\"nofollow noreferrer\">lens</a> contains a type class <a href=\"https://hackage.haskell.org/package/lens-4.15.2/docs/Control-Lens-Indexed.html#t:TraversableWithIndex\" rel=\"nofollow noreferrer\">TraversableWithIndex</a> that defines both the functions <a href=\"https://hackage.haskell.org/package/lens-4.15.2/docs/Control-Lens-Indexed.html#v:itraverse\" rel=\"nofollow noreferrer\">itraverse</a> and <a href=\"https://hackage.haskell.org/package/lens-4.15.2/docs/Control-Lens-Indexed.html#v:itraversed\" rel=\"nofollow noreferrer\">itraversed</a>:</p>\n\n<pre><code>class\n    (FunctorWithIndex i t, FoldableWithIndex i t, Traversable t)\n    =&gt; TraversableWithIndex i t | t -&gt; i where\n  itraverse :: Applicative f =&gt; (i -&gt; a -&gt; f b) -&gt; t a -&gt; f (t b)\n  itraversed :: IndexedTraversal i (t a) (t b) a b\n</code></pre>\n\n<p><code>IndexedTraversal</code> expands like this:</p>\n\n<pre><code>type IndexedTraversal i s t a b =\n  forall p f. (Indexable i p, Applicative f) =&gt; p a (f b) -&gt; s -&gt; f t\n</code></pre>\n\n<p><code>itraverse</code> and <code>itraversed</code> seem very similar.  <em>Why are both needed?</em></p>\n\n<hr>\n\n<p>From playing around with <code>itraverse</code> and <code>itraversed</code>, it appears that <code>itraversed</code> is the only one of the two that can be used with <a href=\"https://hackage.haskell.org/package/lens-4.15.2/docs/Control-Lens-Setter.html#v:-37--64--126-\" rel=\"nofollow noreferrer\"><code>%@~</code></a> as an <a href=\"https://hackage.haskell.org/package/lens-4.15.2/docs/Control-Lens-Setter.html#t:AnIndexedSetter\" rel=\"nofollow noreferrer\"><code>AnIndexedSetter</code></a>.</p>\n\n<p>Here are the types of <code>%@~</code>, <code>AnIndexedSetter</code>, and <code>Indexed</code> for completeness:</p>\n\n<pre><code>(%@~) :: AnIndexedSetter i s t a b -&gt; (i -&gt; a -&gt; b) -&gt; s -&gt; t \n\ntype AnIndexedSetter i s t a b =\n  Indexed i a (Identity b) -&gt; s -&gt; Identity t \n\nnewtype Indexed i a b = Indexed { runIndexed :: i -&gt; a -&gt; b }\n</code></pre>\n\n<p>Why does <code>%@~</code> require <code>AnIndexedSetter</code>?  Why does <code>Indexed</code> have to be used anyway?</p>\n\n<p>Using <code>Indexed</code> seems like it would make composition more difficult, since it is not a normal function.  <em>What am I missing here?</em></p>\n"}, {"tags": ["macos", "haskell"], "comments": [{"owner": {"reputation": 100892, "user_id": 745903, "user_type": "registered", "accept_rate": 74, "profile_image": "https://www.gravatar.com/avatar/50933f6638836741e620669b3940410e?s=128&d=identicon&r=PG", "display_name": "leftaroundabout", "link": "https://stackoverflow.com/users/745903/leftaroundabout"}, "edited": false, "score": 1, "creation_date": 1493309792, "post_id": 43662949, "comment_id": 74372888, "body": "<code>:load YourHaskellFile.hs</code>?"}, {"owner": {"reputation": 2763, "user_id": 5389995, "user_type": "registered", "accept_rate": 50, "profile_image": "https://www.gravatar.com/avatar/2f1834650bc2e5d4d73d25e6010cae10?s=128&d=identicon&r=PG&f=1", "display_name": "Brandon Zamudio", "link": "https://stackoverflow.com/users/5389995/brandon-zamudio"}, "reply_to_user": {"reputation": 100892, "user_id": 745903, "user_type": "registered", "accept_rate": 74, "profile_image": "https://www.gravatar.com/avatar/50933f6638836741e620669b3940410e?s=128&d=identicon&r=PG", "display_name": "leftaroundabout", "link": "https://stackoverflow.com/users/745903/leftaroundabout"}, "edited": false, "score": 0, "creation_date": 1493310655, "post_id": 43662949, "comment_id": 74373532, "body": "Thats the answer, should I close?"}], "answers": [{"comments": [{"owner": {"reputation": 2763, "user_id": 5389995, "user_type": "registered", "accept_rate": 50, "profile_image": "https://www.gravatar.com/avatar/2f1834650bc2e5d4d73d25e6010cae10?s=128&d=identicon&r=PG&f=1", "display_name": "Brandon Zamudio", "link": "https://stackoverflow.com/users/5389995/brandon-zamudio"}, "edited": false, "score": 0, "creation_date": 1493309827, "post_id": 43663019, "comment_id": 74372912, "body": "Yeah I can do that but I want to open these archives with the Haskell compiler"}, {"owner": {"reputation": 1735, "user_id": 2892792, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/5DNyi.jpg?s=128&g=1", "display_name": "Lazersmoke", "link": "https://stackoverflow.com/users/2892792/lazersmoke"}, "reply_to_user": {"reputation": 2763, "user_id": 5389995, "user_type": "registered", "accept_rate": 50, "profile_image": "https://www.gravatar.com/avatar/2f1834650bc2e5d4d73d25e6010cae10?s=128&d=identicon&r=PG&f=1", "display_name": "Brandon Zamudio", "link": "https://stackoverflow.com/users/5389995/brandon-zamudio"}, "edited": false, "score": 2, "creation_date": 1493309911, "post_id": 43663019, "comment_id": 74372976, "body": "If you want to compile your program, you must use <code>ghc</code> from the command line. They are normal text files, not archives. For loading into ghci, see @leftroundabout&#39;s comment"}, {"owner": {"reputation": 62421, "user_id": 216164, "user_type": "registered", "accept_rate": 89, "profile_image": "https://www.gravatar.com/avatar/786f224adbe0784cdf7d0f15476061fe?s=128&d=identicon&r=PG", "display_name": "Thomas M. DuBuisson", "link": "https://stackoverflow.com/users/216164/thomas-m-dubuisson"}, "edited": false, "score": 1, "creation_date": 1493310070, "post_id": 43663019, "comment_id": 74373085, "body": "To be clear: I don&#39;t believe there is a single compiler that has any concept of &quot;opening&quot; a file for a user.  The compiler can compile the source file (.hs) into an object file."}, {"owner": {"reputation": 2763, "user_id": 5389995, "user_type": "registered", "accept_rate": 50, "profile_image": "https://www.gravatar.com/avatar/2f1834650bc2e5d4d73d25e6010cae10?s=128&d=identicon&r=PG&f=1", "display_name": "Brandon Zamudio", "link": "https://stackoverflow.com/users/5389995/brandon-zamudio"}, "edited": false, "score": 1, "creation_date": 1493310701, "post_id": 43663019, "comment_id": 74373563, "body": "I got it, so should I close this question?"}, {"owner": {"reputation": 2763, "user_id": 5389995, "user_type": "registered", "accept_rate": 50, "profile_image": "https://www.gravatar.com/avatar/2f1834650bc2e5d4d73d25e6010cae10?s=128&d=identicon&r=PG&f=1", "display_name": "Brandon Zamudio", "link": "https://stackoverflow.com/users/5389995/brandon-zamudio"}, "edited": false, "score": 0, "creation_date": 1493311204, "post_id": 43663019, "comment_id": 74373884, "body": "Hope it helps future new haskell users on Mac"}], "tags": [], "owner": {"reputation": 1735, "user_id": 2892792, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/5DNyi.jpg?s=128&g=1", "display_name": "Lazersmoke", "link": "https://stackoverflow.com/users/2892792/lazersmoke"}, "is_accepted": true, "score": 1, "last_activity_date": 1493310937, "last_edit_date": 1493310937, "creation_date": 1493309788, "answer_id": 43663019, "question_id": 43662949, "link": "https://stackoverflow.com/questions/43662949/how-can-i-open-a-haskell-file-hs-in-mac/43663019#43663019", "title": "How can I open a haskell file (.hs) in Mac?", "body": "<p>They are just normal text files; use whichever text editor you use for other languages.</p>\n\n<p>If you want to load it into <code>ghci</code>, use <code>:l file.hs</code> or <code>:load file.hs</code></p>\n"}], "owner": {"reputation": 2763, "user_id": 5389995, "user_type": "registered", "accept_rate": 50, "profile_image": "https://www.gravatar.com/avatar/2f1834650bc2e5d4d73d25e6010cae10?s=128&d=identicon&r=PG&f=1", "display_name": "Brandon Zamudio", "link": "https://stackoverflow.com/users/5389995/brandon-zamudio"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 1252, "favorite_count": 0, "accepted_answer_id": 43663019, "answer_count": 1, "score": 0, "last_activity_date": 1549552122, "creation_date": 1493309622, "question_id": 43662949, "link": "https://stackoverflow.com/questions/43662949/how-can-i-open-a-haskell-file-hs-in-mac", "title": "How can I open a haskell file (.hs) in Mac?", "body": "<p>I already installed haskell from <a href=\"https://www.haskell.org/platform/mac.html\" rel=\"nofollow noreferrer\">here</a>.\nI can use haskell from my terminal by typing <code>ghci</code> but I don't know how to open my .hs files.</p>\n"}, {"tags": ["haskell"], "comments": [{"owner": {"reputation": 1735, "user_id": 2892792, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/5DNyi.jpg?s=128&g=1", "display_name": "Lazersmoke", "link": "https://stackoverflow.com/users/2892792/lazersmoke"}, "edited": false, "score": 0, "creation_date": 1493311449, "post_id": 43662767, "comment_id": 74374037, "body": "Please give us the error message or unexpected vs expected input. Is this code in a file or are you in ghci?"}, {"owner": {"reputation": 62252, "user_id": 1435869, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/TrEd9.jpg?s=128&g=1", "display_name": "karakfa", "link": "https://stackoverflow.com/users/1435869/karakfa"}, "edited": false, "score": 0, "creation_date": 1493314667, "post_id": 43662767, "comment_id": 74375985, "body": "did you notice that <code>db</code> is not <code>[String]</code>?"}, {"owner": {"reputation": 1, "user_id": 7900854, "user_type": "registered", "profile_image": "https://graph.facebook.com/1893746254170638/picture?type=large", "display_name": "Ada", "link": "https://stackoverflow.com/users/7900854/ada"}, "edited": false, "score": 0, "creation_date": 1493316025, "post_id": 43662767, "comment_id": 74376751, "body": "I am the beginner,if you can give me some suggestions?TKS"}, {"owner": {"reputation": 100185, "user_id": 3234959, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/93bb12ca0f93dfddb33880316f7e66c2?s=128&d=identicon&r=PG&f=1", "display_name": "chi", "link": "https://stackoverflow.com/users/3234959/chi"}, "edited": false, "score": 2, "creation_date": 1493324804, "post_id": 43662767, "comment_id": 74381545, "body": "Aside: please avoid the anti-pattern <code>if condition then True else False</code>. This is equivalent to <code>condition</code>, only longer. E.g. <code>positive x = (x &gt; 0)</code> is simpler than <code>positive x = if x &gt; 0 then True else False</code>."}], "answers": [{"comments": [{"owner": {"reputation": 1589, "user_id": 2535671, "user_type": "registered", "accept_rate": 87, "profile_image": "https://www.gravatar.com/avatar/fca1ba52e0c41803e676d449ef242e75?s=128&d=identicon&r=PG&f=1", "display_name": "Julian Leviston", "link": "https://stackoverflow.com/users/2535671/julian-leviston"}, "edited": false, "score": 0, "creation_date": 1493550612, "post_id": 43664964, "comment_id": 74455811, "body": "Could you please accept the answer if it was correct, ada?"}], "tags": [], "owner": {"reputation": 13432, "user_id": 331473, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/a887c3de7f5051c9d0d88a5f7c04287d?s=128&d=identicon&r=PG", "display_name": "Adam Wagner", "link": "https://stackoverflow.com/users/331473/adam-wagner"}, "is_accepted": false, "score": 2, "last_activity_date": 1493316194, "creation_date": 1493316194, "answer_id": 43664964, "question_id": 43662767, "link": "https://stackoverflow.com/questions/43662767/haskell-check-if-the-name-in-a-list/43664964#43664964", "title": "Haskell: Check if the name in a list", "body": "<p>You are getting an error because your function <code>checkIfElem</code> expected <code>db</code> to be a <code>String</code>, but is instead receiving a list of tuples (or triples).</p>\n\n<p>Here's your code reformatted a bit:</p>\n\n<pre><code>db = [ (\"David\",\"worksfor\", \"IBM\")\n     , (\"Alan\",\"takeinterhipin\", \"Microsoft\")\n     ]\ncheckIfElem :: String -&gt; [String] -&gt; Bool\ncheckIfElem \"David\" db =\n    if \"David\" `elem` db then True else False\n</code></pre>\n\n<p>Since <code>(\"David\", \"worksfor\", \"IBM\")</code> has the type of <code>(String, String, String)</code>, your code does not type-check.  You can fix this by introducing a function to extract the name portion of this type, which is just a string.  Here's the code with this function in use:</p>\n\n<pre><code>db = [ (\"David\",\"worksfor\", \"IBM\")\n     , (\"Alan\",\"takeinterhipin\", \"Microsoft\")\n     ]\ncheckIfElem :: String -&gt; [(String, String, String)] -&gt; Bool\ncheckIfElem \"David\" db =\n    if \"David\" `elem` (map getName db) then True else False\n\ngetName :: (String, String, String) -&gt; String\ngetName (name, _, _) = name\n</code></pre>\n\n<p>Notice the <code>getName</code> function, takes a tuple and returns a <code>String</code>.  To use this, we also had to update the type of <code>checkIfElem</code>. to take a list of tuples for the type of <code>db</code> (the second argument to your function).</p>\n\n<p>Running your function with \"David\" now works as you can see here:</p>\n\n<pre><code>*Main&gt; checkIfElem \"David\" db\nTrue\n</code></pre>\n\n<p>This still isn't right though, since any other name will cause a runtime error:</p>\n\n<pre><code>*Main&gt; checkIfElem \"Jim\" db\n*** Exception: foo.hs:(7,1)-(8,59): Non-exhaustive patterns in function checkIfElem\n</code></pre>\n\n<p>This is because you are pattern-matching on \"David\" as the first argument.  You haven't defined your function for any other value.  The name is passed when you call the function, after all, so you don't really need to include \"David\" in the definition of the function itself.</p>\n\n<p>Replacing the string <code>\"David\"</code> to some lower-cased variable name in your function definition, like <code>name</code> will fix that problem for you, and your function should work as you expect from there.</p>\n"}], "owner": {"reputation": 1, "user_id": 7900854, "user_type": "registered", "profile_image": "https://graph.facebook.com/1893746254170638/picture?type=large", "display_name": "Ada", "link": "https://stackoverflow.com/users/7900854/ada"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 1043, "favorite_count": 0, "answer_count": 1, "score": -3, "last_activity_date": 1493316194, "creation_date": 1493309166, "last_edit_date": 1493314222, "question_id": 43662767, "link": "https://stackoverflow.com/questions/43662767/haskell-check-if-the-name-in-a-list", "title": "Haskell: Check if the name in a list", "body": "<p>I have the question for checking if there is this name in a list haskell.I have written this program,but when I check it work,butwhen I Check there is not any answer.If someone can help me?</p>\n\n<pre><code>db = [(\"David\",\"worksfor\", \"IBM\")\n ,(\"Alan\",\"takeinterhipin\", \"Microsoft\")\ncheckIfElem :: String -&gt; [String] -&gt; Bool\ncheckIfElem \"David\" db = if \"David\" `elem` db \n                         then True\n                       else False \n</code></pre>\n\n<p>The error is in the image below:\n<a href=\"https://i.stack.imgur.com/7QKpf.png\" rel=\"nofollow noreferrer\">enter image description here</a></p>\n"}, {"tags": ["haskell"], "comments": [{"owner": {"reputation": 29444, "user_id": 3072788, "user_type": "registered", "accept_rate": 82, "profile_image": "https://www.gravatar.com/avatar/220a45c2fcff7e7358d144551b116205?s=128&d=identicon&r=PG&f=1", "display_name": "Alec", "link": "https://stackoverflow.com/users/3072788/alec"}, "edited": false, "score": 3, "creation_date": 1493303108, "post_id": 43660546, "comment_id": 74368237, "body": "<code>&quot;?&quot;</code>, <code>&quot; &quot;</code>, and <code>&quot;#&quot;</code> are one character strings. You probably meant <code>&#39;?&#39;</code>, <code>&#39; &#39;</code>, and <code>&#39;#&#39;</code>."}, {"owner": {"reputation": 14781, "user_id": 630160, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/4445f21326af525a8ad19af7e3ae41a8?s=128&d=identicon&r=PG", "display_name": "epsilonhalbe", "link": "https://stackoverflow.com/users/630160/epsilonhalbe"}, "reply_to_user": {"reputation": 29444, "user_id": 3072788, "user_type": "registered", "accept_rate": 82, "profile_image": "https://www.gravatar.com/avatar/220a45c2fcff7e7358d144551b116205?s=128&d=identicon&r=PG&f=1", "display_name": "Alec", "link": "https://stackoverflow.com/users/3072788/alec"}, "edited": false, "score": 0, "creation_date": 1493303646, "post_id": 43660546, "comment_id": 74368618, "body": "@Alec I think that is an answer"}], "answers": [{"tags": [], "owner": {"reputation": 100892, "user_id": 745903, "user_type": "registered", "accept_rate": 74, "profile_image": "https://www.gravatar.com/avatar/50933f6638836741e620669b3940410e?s=128&d=identicon&r=PG", "display_name": "leftaroundabout", "link": "https://stackoverflow.com/users/745903/leftaroundabout"}, "is_accepted": true, "score": 3, "last_activity_date": 1493304103, "creation_date": 1493304103, "answer_id": 43660971, "question_id": 43660546, "link": "https://stackoverflow.com/questions/43660546/haskell-couldnt-match-type-char-with-char/43660971#43660971", "title": "Haskell - Couldn&#39;t match type \u2018[Char]\u2019 with \u2018Char\u2019", "body": "<pre><code>GHCi, version 7.10.2: http://www.haskell.org/ghc/  :? for help\nPrelude&gt; :t \"#\"\n\"#\" :: [Char]\n</code></pre>\n\n<p><code>\"#\"</code> is a <em>character string</em>. The standard Haskell type for such strings is just <em>list of characters</em>:</p>\n\n<pre><code>Prelude&gt; :i String\ntype String = [Char]    -- Defined in \u2018GHC.Base\u2019\n</code></pre>\n\n<p>A <em>list</em> of things has a different type from the things themselves. Sure, there are lists which happen to contain exactly one element, but clearly it's not always appropriate to also allow any other number of elements (perhaps zero) when you <em>require</em> exactly one! Therefore Haskell always makes a type distinction between <code>a</code> and <code>[a]</code>.</p>\n\n<p>So in this case you need <code>Char</code>, not <code>[Char]</code>. That's the difference between single-quote and double-quote literals:</p>\n\n<pre><code>Prelude&gt; :t \"#\"\n\"#\" :: [Char]\nPrelude&gt; :t '#'\n'#' :: Char\n</code></pre>\n\n<p>Of course, this means that you can't put multiple characters in a single-quote literal, it's an error</p>\n\n<pre><code>Prelude&gt; '#?*!^&amp;&amp;'\n\n&lt;interactive&gt;:6:2: parse error on input \u2018#?*!^&amp;&amp;\u2019\n</code></pre>\n\n<p>...which is exactly what should happen, because it would violate the type signature if a function <code>-&gt; Char</code> would sometimes give <em>multiple</em> characters as the result.</p>\n\n<p>This also means that you can not possibly have <code>type Cell = Char</code>, because <code>\"unknown\"</code> is not a single character. I think what you really want is this:</p>\n\n<pre><code>data Cell = Unknown\n          | Empty\n          | Full\n\nshowCell :: Cell -&gt; Char\nshowCell Unknown = '?'\nshowCell Empty = ' '\nshowCell Full = '#'\n</code></pre>\n"}], "owner": {"reputation": 922, "user_id": 2923589, "user_type": "registered", "accept_rate": 77, "profile_image": "https://www.gravatar.com/avatar/ba91f50d535333744c2d5ddb1ce05412?s=128&d=identicon&r=PG&f=1", "display_name": "Tamas Koos", "link": "https://stackoverflow.com/users/2923589/tamas-koos"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 974, "favorite_count": 0, "closed_date": 1493308571, "accepted_answer_id": 43660971, "answer_count": 1, "score": 0, "last_activity_date": 1493304103, "creation_date": 1493302959, "question_id": 43660546, "link": "https://stackoverflow.com/questions/43660546/haskell-couldnt-match-type-char-with-char", "closed_reason": "Duplicate", "title": "Haskell - Couldn&#39;t match type \u2018[Char]\u2019 with \u2018Char\u2019", "body": "<p>I just started learning Haskell. I have to write a function that does the following:</p>\n\n<p>The definition of the function: <code>showCell :: Cell -&gt; Char</code> (this was given)</p>\n\n<p>If you call <code>showCell unknown</code> it should give back <code>'?'</code>, if you call <code>showCell empty</code> it should give back <code>' '</code> and if you call <code>showCell full</code> it should give back <code>'#'</code>.\nI wrote this code:</p>\n\n<pre><code>showCell \"unknown\" = \"?\"\nshowCell \"empty\" = \" \"\nshowCell \"full\" = \"#\"\n</code></pre>\n\n<p>But I get a <code>Couldn't match type \u2018[Char]\u2019 with \u2018Char\u2019</code> error. What is the problem, and could you explain to me why?</p>\n\n<p>Btw, the Cell type (in the definition of showCell) was also defined as: <code>type Cell = Char</code></p>\n"}, {"tags": ["haskell"], "answers": [{"comments": [{"owner": {"reputation": 315, "user_id": 5367513, "user_type": "registered", "accept_rate": 89, "profile_image": "https://www.gravatar.com/avatar/7bc3967ca71ebcd3dbb20b5b7552a904?s=128&d=identicon&r=PG&f=1", "display_name": "Jan Syn&#225;\u010dek", "link": "https://stackoverflow.com/users/5367513/jan-syn%c3%a1%c4%8dek"}, "edited": false, "score": 0, "creation_date": 1493322287, "post_id": 43665512, "comment_id": 74380213, "body": "Well, that was easy:) I feel a bit stupid now. You&#39;re right, that seems to work well. Thank you!"}, {"owner": {"reputation": 30377, "user_id": 369198, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/71596bb1ca3ba3aa4400c3f407baec9f?s=128&d=identicon&r=PG", "display_name": "Michael Snoyman", "link": "https://stackoverflow.com/users/369198/michael-snoyman"}, "reply_to_user": {"reputation": 315, "user_id": 5367513, "user_type": "registered", "accept_rate": 89, "profile_image": "https://www.gravatar.com/avatar/7bc3967ca71ebcd3dbb20b5b7552a904?s=128&d=identicon&r=PG&f=1", "display_name": "Jan Syn&#225;\u010dek", "link": "https://stackoverflow.com/users/5367513/jan-syn%c3%a1%c4%8dek"}, "edited": false, "score": 0, "creation_date": 1493349981, "post_id": 43665512, "comment_id": 74389280, "body": "Sure, no problem, really easy mistake to make. Second set of eyes can catch such things much more easily :)"}], "tags": [], "owner": {"reputation": 30377, "user_id": 369198, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/71596bb1ca3ba3aa4400c3f407baec9f?s=128&d=identicon&r=PG", "display_name": "Michael Snoyman", "link": "https://stackoverflow.com/users/369198/michael-snoyman"}, "is_accepted": true, "score": 5, "last_activity_date": 1493318018, "creation_date": 1493318018, "answer_id": 43665512, "question_id": 43659559, "link": "https://stackoverflow.com/questions/43659559/how-can-i-exit-the-program-from-a-sigterm-handler/43665512#43665512", "title": "How can I exit the program from a sigTERM handler?", "body": "<p>Sorry for short answer, but on mobile.</p>\n\n<p>You want to run myThreadId from outside of the handler itself to get the main thread's ID. You're currently getting the ID of the signal handler itself.</p>\n"}], "owner": {"reputation": 315, "user_id": 5367513, "user_type": "registered", "accept_rate": 89, "profile_image": "https://www.gravatar.com/avatar/7bc3967ca71ebcd3dbb20b5b7552a904?s=128&d=identicon&r=PG&f=1", "display_name": "Jan Syn&#225;\u010dek", "link": "https://stackoverflow.com/users/5367513/jan-syn%c3%a1%c4%8dek"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 483, "favorite_count": 2, "accepted_answer_id": 43665512, "answer_count": 1, "score": 5, "last_activity_date": 1493322449, "creation_date": 1493300315, "last_edit_date": 1493322449, "question_id": 43659559, "link": "https://stackoverflow.com/questions/43659559/how-can-i-exit-the-program-from-a-sigterm-handler", "title": "How can I exit the program from a sigTERM handler?", "body": "<p>Consider something like this:</p>\n\n<pre><code>...\n\nhandleShutdown :: ThreadId -&gt; IO ()\nhandleShutdown tid = doSomethingFunny &gt;&gt; throwTo tid ExitSuccess\n\nmain = do\n    ...\n    installHandler sigTERM (Catch $ myThreadId &gt;&gt;= handleShutdown) Nothing\n    forever $ do\n        stuff\n    ...\n</code></pre>\n\n<p>If <code>sigINT</code> (Ctrl+C) is handled in this manner, the process finishes nicely. However, it seems like <code>sigTERM</code> is being used by Haskell internally and the code above doesn't exit from the main process at all. Is there a way to exit the process from a <code>sigTERM</code> handler without using an <code>MVar</code> and a custom loop? I couldn't find any information on the <code>sigTERM</code> handling anywhere (didn't read ghc sources, that's just too much for me to handle).</p>\n\n<p>Update:</p>\n\n<p>The following works:</p>\n\n<pre><code>main = do\n    ...\n    tid &lt;- myThreadId -- This moved out of the Catch handler below.\n    installHandler sigTERM (Catch $ handleShutdown tid) Nothing\n    forever $ do\n        stuff\n    ...\n</code></pre>\n"}, {"tags": ["haskell"], "comments": [{"owner": {"reputation": 100185, "user_id": 3234959, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/93bb12ca0f93dfddb33880316f7e66c2?s=128&d=identicon&r=PG&f=1", "display_name": "chi", "link": "https://stackoverflow.com/users/3234959/chi"}, "edited": false, "score": 4, "creation_date": 1493298834, "post_id": 43658634, "comment_id": 74365001, "body": "Indeed, there is no advantage in such case: those functions are equal. You need something like type families or GADTs to see some useful stuff, I think. Or perhaps $Data.Typeable.eqT$ can help as a nice example."}, {"owner": {"reputation": 8237, "user_id": 2900502, "user_type": "registered", "accept_rate": 73, "profile_image": "https://i.stack.imgur.com/R1OjD.jpg?s=128&g=1", "display_name": "Shersh", "link": "https://stackoverflow.com/users/2900502/shersh"}, "edited": false, "score": 3, "creation_date": 1493299713, "post_id": 43658634, "comment_id": 74365664, "body": "If you wonder, how <code>~</code> can be used in one very helpful way, read this great blog post from Chris Done: <a href=\"http://chrisdone.com/posts/haskell-constraint-trick\" rel=\"nofollow noreferrer\">chrisdone.com/posts/haskell-constraint-trick</a>"}], "answers": [{"tags": [], "owner": {"reputation": 100892, "user_id": 745903, "user_type": "registered", "accept_rate": 74, "profile_image": "https://www.gravatar.com/avatar/50933f6638836741e620669b3940410e?s=128&d=identicon&r=PG", "display_name": "leftaroundabout", "link": "https://stackoverflow.com/users/745903/leftaroundabout"}, "is_accepted": true, "score": 10, "last_activity_date": 1493304849, "last_edit_date": 1493304849, "creation_date": 1493300436, "answer_id": 43659607, "question_id": 43658634, "link": "https://stackoverflow.com/questions/43658634/understanding-with-2-functions/43659607#43659607", "title": "Understanding `~` with 2 Functions", "body": "<pre><code>{-# LANGUAGE TypeFamilies #-}\n\nimport GHC.Exts (IsList(..))\n\nfizzbuzz :: (IsList l, Item l ~ Int) =&gt; l -&gt; IO ()\nfizzbuzz = go . toList\n where go [] = return ()\n       go (n:m)\n        | n`mod`3==0  = putStrLn \"fizz\" &gt;&gt; go m\n        | n`mod`5==0  = putStrLn \"buzz\" &gt;&gt; go m\n        | otherwise   = print n &gt;&gt; go m\n</code></pre>\n\n<p>Then</p>\n\n<pre><code>Prelude&gt; fizzbuzz [1..7]\n1\n2\nfizz\n4\nbuzz\nfizz\n7\nPrelude&gt; import Data.Vector.Unboxed as UA\nPrelude UA&gt; fizzbuzz (UA.fromList[1..7] :: UA.Vector Int)\n1\n2\nfizz\n4\nbuzz\nfizz\n7\n</code></pre>\n\n<p>You may now object that this should better have been done with a <code>Foldable</code> constraint, instead of the ugly conversion to a list. Actually this couldn't be done, because unboxed vectors do not have a foldable instance due to the <a href=\"http://hackage.haskell.org/package/vector-0.12.0.1/docs/Data-Vector-Unboxed.html#t:Unbox\" rel=\"noreferrer\"><code>Unbox</code></a> constraint!</p>\n\n<p>It could, however, just as well have been done with a non-equational constraint, namely</p>\n\n<pre><code>fizzbuzz :: (IsList l, Num (Item l), Eq (Item l), Show (Item l))\n     =&gt; l -&gt; IO ()\n</code></pre>\n\n<p>That is more general, but arguably also more awkward. When you need, in practice, only one contained-type anyway, an equational constraint may be a good choice.</p>\n\n<p>Indeed, I sometimes find it convenient to toss in an equational constraint just to make a type signature more concise, if it's a bit repetitive: the signature</p>\n\n<pre><code>complicatedFunction :: Long (Awkward (Type a) (Maybe String))\n                 -&gt; [Long (Awkward (Type a) (Maybe String))]\n                 -&gt; Either String (Long (Awkward (Type a) (Maybe String)))\n</code></pre>\n\n<p>can be replaced with</p>\n\n<pre><code>complicatedFunction :: r ~ Long (Awkward (Type a) (Maybe String))\n             =&gt; r -&gt; [r] -&gt; Either String r\n</code></pre>\n\n<p>which may be better than the other DRY-possibility of</p>\n\n<pre><code>type LAwkTS a = Long (Awkward (Type a) (Maybe String))\n\ncomplicatedFunction :: LAwkTS a -&gt; [LAwkTS a] -&gt; Either String (LAwkTS a)\n</code></pre>\n"}], "owner": {"reputation": 37991, "user_id": 409976, "user_type": "registered", "accept_rate": 68, "profile_image": "https://www.gravatar.com/avatar/9ccda0b49cc974197399eae01ebd6850?s=128&d=identicon&r=PG", "display_name": "Kevin Meredith", "link": "https://stackoverflow.com/users/409976/kevin-meredith"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 140, "favorite_count": 0, "accepted_answer_id": 43659607, "answer_count": 1, "score": 6, "last_activity_date": 1493304849, "creation_date": 1493298033, "last_edit_date": 1495541437, "question_id": 43658634, "link": "https://stackoverflow.com/questions/43658634/understanding-with-2-functions", "title": "Understanding `~` with 2 Functions", "body": "<p>Background: I don't understand <a href=\"https://stackoverflow.com/questions/27667628/the-meaning-of-tilde-in-haskell-types-type-equality\">~</a> and am requesting a use case.</p>\n\n<p>Given:</p>\n\n<pre><code>{-# LANGUAGE GADTs #-}\n\nf :: a ~ b =&gt; a -&gt; b -&gt; b\nf a b = a\n\ng :: a -&gt; a -&gt; a\ng a b = a\n</code></pre>\n\n<p>It seems to me that both functions are equal:</p>\n\n<pre><code>Prelude&gt; :r\n[1 of 1] Compiling Main             ( TypeEq.hs, interpreted )\nOk, modules loaded: Main.\n*Main&gt; f 10 20\n10\n*Main&gt; g 10 20\n10\n</code></pre>\n\n<p>Under what circumstances would it be useful to use <code>f</code> over <code>g</code>? </p>\n"}, {"tags": ["haskell", "type-conversion"], "comments": [{"owner": {"reputation": 94553, "user_id": 775806, "user_type": "registered", "accept_rate": 96, "profile_image": "https://i.stack.imgur.com/XNd2C.png?s=128&g=1", "display_name": "n. &#39;pronouns&#39; m.", "link": "https://stackoverflow.com/users/775806/n-pronouns-m"}, "edited": false, "score": 3, "creation_date": 1493292658, "post_id": 43656453, "comment_id": 74360205, "body": "&quot;but that gets problematic&quot; What exactly is problematic? Can you show code that should be valid but isn&#39;t because of these definitions?"}, {"owner": {"reputation": 554, "user_id": 1382487, "user_type": "registered", "accept_rate": 38, "profile_image": "https://i.stack.imgur.com/JdQcl.jpg?s=128&g=1", "display_name": "wsaleem", "link": "https://stackoverflow.com/users/1382487/wsaleem"}, "reply_to_user": {"reputation": 94553, "user_id": 775806, "user_type": "registered", "accept_rate": 96, "profile_image": "https://i.stack.imgur.com/XNd2C.png?s=128&g=1", "display_name": "n. &#39;pronouns&#39; m.", "link": "https://stackoverflow.com/users/775806/n-pronouns-m"}, "edited": false, "score": 0, "creation_date": 1493293495, "post_id": 43656453, "comment_id": 74360800, "body": "The problem is illustrated in the code just below the quoted line (the code contained a typo earlier which may have led to your confusion and which I just corrected). There will need to be 2 functions called <code>convert</code> both of which take an <code>AdjMatrix</code> as argument but each has a different return type. As fas as I know, Haskell does not differentiate between functions based on return type only.This gets compounded when trying to <code>convert</code> other representations."}, {"owner": {"reputation": 24509, "user_id": 6863749, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/UyoQv.jpg?s=128&g=1", "display_name": "Li-yao Xia", "link": "https://stackoverflow.com/users/6863749/li-yao-xia"}, "edited": false, "score": 3, "creation_date": 1493294228, "post_id": 43656453, "comment_id": 74361382, "body": "&quot;Haskell does not differentiate between functions based on return type only&quot;.  What do you mean by that? Haskell can overload a function only on its return type, that&#39;s how <code>read</code> works for example. What error are you getting?"}, {"owner": {"reputation": 94553, "user_id": 775806, "user_type": "registered", "accept_rate": 96, "profile_image": "https://i.stack.imgur.com/XNd2C.png?s=128&g=1", "display_name": "n. &#39;pronouns&#39; m.", "link": "https://stackoverflow.com/users/775806/n-pronouns-m"}, "edited": false, "score": 3, "creation_date": 1493294925, "post_id": 43656453, "comment_id": 74361919, "body": "<a href=\"http://ideone.com/mAaJHW\" rel=\"nofollow noreferrer\">I don&#39;t see any error</a>. Can you show a <a href=\"https://stackoverflow.com/help/minimal-reproducible-example\">minimal reproducible example</a>?"}, {"owner": {"reputation": 554, "user_id": 1382487, "user_type": "registered", "accept_rate": 38, "profile_image": "https://i.stack.imgur.com/JdQcl.jpg?s=128&g=1", "display_name": "wsaleem", "link": "https://stackoverflow.com/users/1382487/wsaleem"}, "edited": false, "score": 0, "creation_date": 1493295031, "post_id": 43656453, "comment_id": 74362009, "body": "Indeed. I tried the code given in the OP just now and there is no error. The OP seems silly now. I shall remove it - is that against SO protocol?"}, {"owner": {"reputation": 100892, "user_id": 745903, "user_type": "registered", "accept_rate": 74, "profile_image": "https://www.gravatar.com/avatar/50933f6638836741e620669b3940410e?s=128&d=identicon&r=PG", "display_name": "leftaroundabout", "link": "https://stackoverflow.com/users/745903/leftaroundabout"}, "edited": false, "score": 1, "creation_date": 1493295154, "post_id": 43656453, "comment_id": 74362085, "body": "@wsaleem it&#39;s considered impolite to delete a question when somebody may already have spent effort answering it, but in this case I don&#39;t see any problem. Still better would be if you <i>added an own answer</i> showing a complete example of how this does in fact work."}, {"owner": {"reputation": 554, "user_id": 1382487, "user_type": "registered", "accept_rate": 38, "profile_image": "https://i.stack.imgur.com/JdQcl.jpg?s=128&g=1", "display_name": "wsaleem", "link": "https://stackoverflow.com/users/1382487/wsaleem"}, "reply_to_user": {"reputation": 94553, "user_id": 775806, "user_type": "registered", "accept_rate": 96, "profile_image": "https://i.stack.imgur.com/XNd2C.png?s=128&g=1", "display_name": "n. &#39;pronouns&#39; m.", "link": "https://stackoverflow.com/users/775806/n-pronouns-m"}, "edited": false, "score": 0, "creation_date": 1493295355, "post_id": 43656453, "comment_id": 74362263, "body": "@n.m. If you paste your code from ideone as an answer, I will accept it. That will put an end to this."}, {"owner": {"reputation": 1735, "user_id": 2892792, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/5DNyi.jpg?s=128&g=1", "display_name": "Lazersmoke", "link": "https://stackoverflow.com/users/2892792/lazersmoke"}, "edited": false, "score": 0, "creation_date": 1493297983, "post_id": 43656453, "comment_id": 74364395, "body": "You could use <code>fromGraph :: forall q. Graph q =&gt; q -&gt; a</code> in your first typeclass to provide the stronger garuntee that you can convert like this for <i>any</i> Graph, which is what your question says, but not what you want."}, {"owner": {"reputation": 4234, "user_id": 4942760, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/f322d06b4f3e34278f29a954e0f38cb1?s=128&d=identicon&r=PG&f=1", "display_name": "Dan Robertson", "link": "https://stackoverflow.com/users/4942760/dan-robertson"}, "edited": false, "score": 0, "creation_date": 1493398361, "post_id": 43656453, "comment_id": 74416687, "body": "You could define some interchange format (I.e. Some representation of a graph which is easy to quickly generate from most types and to produce from most types) and add functions to convert from/to it. E.g. You might have <code>fromVE :: ([Int],[(Int,Int)]) -&gt; a</code> and a similar function to reverse it. Then you can write <code>convertGraph = fromVE . toVE</code>"}], "owner": {"reputation": 554, "user_id": 1382487, "user_type": "registered", "accept_rate": 38, "profile_image": "https://i.stack.imgur.com/JdQcl.jpg?s=128&g=1", "display_name": "wsaleem", "link": "https://stackoverflow.com/users/1382487/wsaleem"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 376, "favorite_count": 0, "answer_count": 0, "score": 1, "last_activity_date": 1507900979, "creation_date": 1493292407, "last_edit_date": 1507900979, "question_id": 43656453, "link": "https://stackoverflow.com/questions/43656453/a-generic-way-to-convert-between-types-in-haskell", "title": "A generic way to convert between types in Haskell", "body": "<p>To start off, this question is not like the many other SO questions with similar topics, e.g. <a href=\"https://stackoverflow.com/q/40316051/1382487\">here</a>, <a href=\"https://stackoverflow.com/q/1894365/1382487\">here</a>, <a href=\"https://stackoverflow.com/questions/9511832/convert-one-data-type-to-another\">here</a>, or even <a href=\"https://wiki.haskell.org/Converting_numbers\" rel=\"nofollow noreferrer\">here</a>. There are many others - I am not listing all of them as they are mostly about automatic conversion. My question is different. I am writing my own conversion and am looking for a generic way to implement that.</p>\n\n<p>I have a type class <code>Graph</code> from which I derive different graph representations: <code>GraphSet</code> (set representation), <code>AdjMatrix</code>, <code>AdjList</code>.</p>\n\n<pre><code>class Graph a where\n  newGraph      :: a\n  hasVertex     :: a -&gt; Int -&gt; Bool\n  hasEdge       :: a -&gt; (Int,Int) -&gt; Bool\n  addEdge       :: a -&gt; (Int,Int) -&gt; a\n  addVertex     :: a -&gt; a\n  removeEdge    :: a -&gt; (Int,Int) -&gt; a\n  removeVertex  :: a -&gt; Int -&gt; a\n  inDegree      :: a -&gt; Int -&gt; Int\n  outDegree     :: a -&gt; Int -&gt; Int\n</code></pre>\n\n<p>I want some way to formally capture that any representation is convertible to any other. Correspondingly, I want to write 2 <code>convert</code> functions for each of the above 3 representations. I am unable to find a way to do this in a generic manner.</p>\n\n<p>My initial attempt was to write a <a href=\"https://wiki.haskell.org/Multi-parameter_type_class\" rel=\"nofollow noreferrer\">multi-parameter type class</a></p>\n\n<pre><code>class Equivalent a b where\n  convert :: b -&gt; a\n</code></pre>\n\n<p>but that gets problematic as there are 2 <code>a</code>s for every <code>b</code>, e.g.</p>\n\n<pre><code>instance Equivalent GraphSet AdjMatrix where\n  convert g@(AdjMatrix mat) = newGraph :: GraphSet -- stub\ninstance Equivalent AdjList AdjMatrix where\n  convert g@(AdjMatrix mat) = newGraph :: AdjList -- stub, error\n</code></pre>\n\n<p>I could of course write differently named functions but there must be a generic way to do this.</p>\n\n<p>Before anyone points out, I am aware of the option of using <code>show</code> and then reading the resulting String into the other type. That does not solve the above problem.</p>\n\n<hr>\n\n<p>UPDATE: As pointed out in the comments, the code above works just fine. Due to some reasons (experience with other languages, other errors) I was wrongly under the impression that Haskell will not differentiate between functions based on return type only. As Li-yao mentions below, <code>read</code> does exactly that.</p>\n"}, {"tags": ["haskell", "functor", "applicative"], "comments": [{"owner": {"reputation": 28376, "user_id": 5743988, "user_type": "registered", "accept_rate": 67, "profile_image": "https://i.stack.imgur.com/IeSSM.jpg?s=128&g=1", "display_name": "4castle", "link": "https://stackoverflow.com/users/5743988/4castle"}, "edited": false, "score": 3, "creation_date": 1493279094, "post_id": 43651164, "comment_id": 74350679, "body": "Do you want your applicative to work with <code>fmap</code>? There&#39;s no reason for it <i>not</i> to inherit <code>Functor</code>, because of the trivial implementation you&#39;ve described."}, {"owner": {"reputation": 100892, "user_id": 745903, "user_type": "registered", "accept_rate": 74, "profile_image": "https://www.gravatar.com/avatar/50933f6638836741e620669b3940410e?s=128&d=identicon&r=PG", "display_name": "leftaroundabout", "link": "https://stackoverflow.com/users/745903/leftaroundabout"}, "edited": false, "score": 0, "creation_date": 1493301754, "post_id": 43651164, "comment_id": 74367251, "body": "Yeah, defining <code>fmap</code> is about the least tedious thing you can do with any type where it&#39;s at all possible."}], "answers": [{"comments": [{"owner": {"reputation": 100892, "user_id": 745903, "user_type": "registered", "accept_rate": 74, "profile_image": "https://www.gravatar.com/avatar/50933f6638836741e620669b3940410e?s=128&d=identicon&r=PG", "display_name": "leftaroundabout", "link": "https://stackoverflow.com/users/745903/leftaroundabout"}, "edited": false, "score": 0, "creation_date": 1493301981, "post_id": 43651993, "comment_id": 74367428, "body": "In most of the cases where <code>data Boring a = Boring a deriving Functor</code>, a standalone <code>deriving instance Functor Boring</code> will still work. It&#39;s really rare to have a functor where GHC won&#39;t be able to derive the functor instance in some way, and even in those cases it will be peanuts do write it by hand, compared to the <code>Applicative</code> instance."}, {"owner": {"reputation": 37219, "user_id": 1523776, "user_type": "moderator", "accept_rate": 87, "profile_image": "https://www.gravatar.com/avatar/b3e0b5c8e42a8c38009ef2d969f8dabb?s=128&d=identicon&r=PG", "display_name": "Benjamin Hodgson", "link": "https://stackoverflow.com/users/1523776/benjamin-hodgson"}, "edited": false, "score": 0, "creation_date": 1493318757, "post_id": 43651993, "comment_id": 74378319, "body": "I would expect GHC, with <code>-O</code>, to simplify the nested case, cos <code>case (Just f) of ...</code> will always pick the <code>Just</code> branch. Indeed SPJ implies that it does in fact do this optimisation in this talk <a href=\"https://youtu.be/uR_VzYxvbxg?t=43m59s\" rel=\"nofollow noreferrer\">youtu.be/uR_VzYxvbxg?t=43m59s</a> . Of course it won&#39;t necessarily be able to do that rewrite for all applicatives."}], "tags": [], "owner": {"reputation": 75362, "user_id": 625403, "user_type": "registered", "accept_rate": 82, "profile_image": "https://www.gravatar.com/avatar/786eed7da67079cb5d63a49d469af25b?s=128&d=identicon&r=PG", "display_name": "amalloy", "link": "https://stackoverflow.com/users/625403/amalloy"}, "is_accepted": false, "score": 8, "last_activity_date": 1493282956, "last_edit_date": 1493282956, "creation_date": 1493280180, "answer_id": 43651993, "question_id": 43651164, "link": "https://stackoverflow.com/questions/43651164/why-should-applicative-inherit-from-functor/43651993#43651993", "title": "Why should Applicative inherit from Functor?", "body": "<p>While <code>fmap</code> can be derived from <code>pure</code> and <code>&lt;*&gt;</code>, it is generally not the most efficient approach. Compare:</p>\n\n<pre><code>fmap :: (a -&gt; b) -&gt; Maybe a -&gt; Maybe b\nfmap f Nothing = Nothing\nfmap f (Just x) = Just (f x)\n</code></pre>\n\n<p>with the work done using Applicative tools:</p>\n\n<pre><code>fmap :: (a -&gt; b) -&gt; Maybe a -&gt; Maybe b\n-- inlining pure and &lt;*&gt; in: fmap f x = pure f &lt;*&gt; x\nfmap f x = case (Just f) of\n  Nothing -&gt; Nothing\n  Just f' -&gt; case x of\n    Nothing -&gt; Nothing\n    Just x' -&gt; Just (f' x')\n</code></pre>\n\n<p>Pointlessly wrapping something up in a constructor just to do a pattern-match against it.</p>\n\n<p>So, clearly it is useful to be able to define <code>fmap</code> independently of the Applicative functions. That <em>could</em> be done by making a single typeclass with all three functions, using a default implementation for <code>fmap</code> that you could override. However, there are types that make good Functor instances but not good Applicative instances, so you may need to implement just one. Thus, two typeclasses. </p>\n\n<p>And since there are no types with Applicative instances but without Functor instances, you should be able to treat an Applicative as though it were a Functor, if you like; hence the extension relationship between the two.</p>\n\n<p>However, if you tire of implementing Functor, you can (in most cases) ask GHC to derive the only possible implementation of Functor for you, with</p>\n\n<pre><code>{-# LANGUAGE DeriveFunctor #-}\ndata Boring a = Boring a deriving Functor\n</code></pre>\n"}, {"comments": [{"owner": {"reputation": 75362, "user_id": 625403, "user_type": "registered", "accept_rate": 82, "profile_image": "https://www.gravatar.com/avatar/786eed7da67079cb5d63a49d469af25b?s=128&d=identicon&r=PG", "display_name": "amalloy", "link": "https://stackoverflow.com/users/625403/amalloy"}, "edited": false, "score": 1, "creation_date": 1518154670, "post_id": 43668267, "comment_id": 84397258, "body": "<code>fmap f x = x &gt;&gt;= (return . f)</code>"}], "tags": [], "owner": {"reputation": 11487, "user_id": 1308058, "user_type": "registered", "accept_rate": 61, "profile_image": "https://www.gravatar.com/avatar/2be2ab74793559ea1c1dbdf55ccdf90b?s=128&d=identicon&r=PG", "display_name": "phadej", "link": "https://stackoverflow.com/users/1308058/phadej"}, "is_accepted": true, "score": 2, "last_activity_date": 1518650587, "last_edit_date": 1518650587, "creation_date": 1493328762, "answer_id": 43668267, "question_id": 43651164, "link": "https://stackoverflow.com/questions/43651164/why-should-applicative-inherit-from-functor/43668267#43668267", "title": "Why should Applicative inherit from Functor?", "body": "<p>While there are proposals to make it's easier <a href=\"https://ghc.haskell.org/trac/ghc/wiki/IntrinsicSuperclasses\" rel=\"nofollow noreferrer\">https://ghc.haskell.org/trac/ghc/wiki/IntrinsicSuperclasses</a> the \"default instances\" problem itself is very difficult.</p>\n\n<p>One challenge is how to deal with common superclasses:</p>\n\n<pre><code>fmap f x = pure f &lt;*&gt; x                            -- using Applicative\nfmap f x = runIdentity (traverse (Identity . f) x) -- using Traversable\nfmap f x = x &gt;&gt;= (return . f)               -- using Monad\n</code></pre>\n\n<p>Which one to pick?</p>\n\n<p>So the best we can do now is to provide <code>fmapDefault</code> (as <code>Data.Traversable</code>) does; or use <code>pure f &lt;*&gt; x</code>; or <code>fmapRep</code> from <a href=\"http://hackage.haskell.org/package/adjunctions-4.3/docs/Data-Functor-Rep.html\" rel=\"nofollow noreferrer\"><code>Data.Functor.Rep</code></a> when applicable.</p>\n"}], "owner": {"reputation": 4416, "user_id": 2108477, "user_type": "registered", "accept_rate": 48, "profile_image": "https://www.gravatar.com/avatar/f30268b2a1d0a8a18012e602cd3cb783?s=128&d=identicon&r=PG", "display_name": "Ignat Insarov", "link": "https://stackoverflow.com/users/2108477/ignat-insarov"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 171, "favorite_count": 0, "accepted_answer_id": 43668267, "answer_count": 2, "score": 3, "last_activity_date": 1518650587, "creation_date": 1493277797, "last_edit_date": 1493299583, "question_id": 43651164, "link": "https://stackoverflow.com/questions/43651164/why-should-applicative-inherit-from-functor", "title": "Why should Applicative inherit from Functor?", "body": "<p>Indeed it does:</p>\n\n<pre><code>\u03bb :i Applicative \nclass Functor f =&gt; Applicative (f :: * -&gt; *) where\n</code></pre>\n\n<p>At the same time:</p>\n\n<pre><code>fmap f x = pure f &lt;*&gt; x\n</code></pre>\n\n<p>\u2014 by the laws of <code>Applicative</code> we can define <code>fmap</code> from <code>pure</code> &amp; <code>&lt;*&gt;</code>.</p>\n\n<p>I don't get why I should tediously define <code>fmap</code> every time I want an <code>Applicative</code> if, really, <code>fmap</code> can be automatically set up in terms of <code>pure</code> and <code>&lt;*&gt;</code>.</p>\n\n<p>I gather it would be necessary if <code>pure</code> or <code>&lt;*&gt;</code> were somehow dependent on the definition of <code>fmap</code> but I fail to see why they have to.</p>\n"}, {"tags": ["haskell", "ghc", "dsl"], "comments": [{"owner": {"reputation": 24509, "user_id": 6863749, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/UyoQv.jpg?s=128&g=1", "display_name": "Li-yao Xia", "link": "https://stackoverflow.com/users/6863749/li-yao-xia"}, "edited": false, "score": 1, "creation_date": 1493297792, "post_id": 43648182, "comment_id": 74364258, "body": "That seems unlikely. You can&#39;t get from <code>(r1, r2) -&gt; (r1, r2)</code> to <code>(r1 -&gt; r1, r2 -&gt; r2)</code>, which would be required to implement <code>Lam (Dup r1 r2)</code> using <code>(Lam r1, Lam r2)</code>."}, {"owner": {"reputation": 21417, "user_id": 925978, "user_type": "registered", "accept_rate": 84, "profile_image": "https://www.gravatar.com/avatar/06e4467a5bd1538a92cefb20db07897a?s=128&d=identicon&r=PG&f=1", "display_name": "crockeea", "link": "https://stackoverflow.com/users/925978/crockeea"}, "reply_to_user": {"reputation": 24509, "user_id": 6863749, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/UyoQv.jpg?s=128&g=1", "display_name": "Li-yao Xia", "link": "https://stackoverflow.com/users/6863749/li-yao-xia"}, "edited": false, "score": 0, "creation_date": 1493299890, "post_id": 43648182, "comment_id": 74365813, "body": "@Li-yaoXia I thought the same thing about going from a <code>(a -&gt; m b) -&gt; m (a -&gt; b)</code> for an arbitrary <code>Monad m</code>, until I read the second linked paper. I&#39;m holding out for another similarly amazing solution."}, {"owner": {"reputation": 15757, "user_id": 176841, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/45a168cb9eb8454d66c78f18e29d9342?s=128&d=identicon&r=PG", "display_name": "jberryman", "link": "https://stackoverflow.com/users/176841/jberryman"}, "edited": false, "score": 1, "creation_date": 1493307288, "post_id": 43648182, "comment_id": 74371169, "body": "@crockeea is that a &quot;trick&quot; that can be described outside of the context of the paper, or can I jump to a certain page to get a quick sense of what how that would work?"}, {"owner": {"reputation": 21417, "user_id": 925978, "user_type": "registered", "accept_rate": 84, "profile_image": "https://www.gravatar.com/avatar/06e4467a5bd1538a92cefb20db07897a?s=128&d=identicon&r=PG&f=1", "display_name": "crockeea", "link": "https://stackoverflow.com/users/925978/crockeea"}, "edited": false, "score": 0, "creation_date": 1493307911, "post_id": 43648182, "comment_id": 74371614, "body": "Section 3 of &quot;Combinators for Impure yet Hygenic Code&quot; has a good description, particularly page 28, where they get to the point."}, {"owner": {"reputation": 13807, "user_id": 2407038, "user_type": "registered", "accept_rate": 64, "profile_image": "https://www.gravatar.com/avatar/538f6f4a9aa43841841de7d8e8b169fc?s=128&d=identicon&r=PG&f=1", "display_name": "user2407038", "link": "https://stackoverflow.com/users/2407038/user2407038"}, "edited": false, "score": 0, "creation_date": 1494095650, "post_id": 43648182, "comment_id": 74686212, "body": "One solution is to switch from HOAS to PHOAS, but I don&#39;t know if that would make your life easier or harder for whatever other purposes you need this code for. But this change would fix the three points in the bounty comment. The change is pretty straightforward - change the type of <code>lam</code> to <code>(v a -&gt; repr v b) -&gt; repr v (a -&gt; b)</code>; for types which do not bind a variable, <code>repr</code> becomes <code>repr v</code>; and you will need <code>var :: v a -&gt; repr v a</code>."}], "answers": [{"tags": [], "owner": {"reputation": 833, "user_id": 7847896, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/c3e72cb1d5eceb94842bec50894e6943?s=128&d=identicon&r=PG&f=1", "display_name": "zbw", "link": "https://stackoverflow.com/users/7847896/zbw"}, "is_accepted": false, "score": 3, "last_activity_date": 1493678220, "creation_date": 1493678220, "answer_id": 43727492, "question_id": 43648182, "link": "https://stackoverflow.com/questions/43648182/duplicator-interpreter-with-hoas/43727492#43727492", "title": "Duplicator Interpreter with HOAS", "body": "<p>This is impossible.</p>\n\n<p>To show an example, I'll first make a very simple instance of <code>Lam</code>:</p>\n\n<pre><code>newtype Id a = Id a\n\ninstance Lam Id where\n    lam (Id f) = Id (\\x -&gt; let Id r = f x in r)\n    app (Id f) (Id x) = Id (f x)\n</code></pre>\n\n<p>Now I'll make a function that operates on <code>Dup</code>s:</p>\n\n<pre><code>f :: Dup Id Id Int -&gt; Dup Id Id Int\nf (Dup (Id x) (Id y)) = Dup (Id x*y) (Id y)\n</code></pre>\n\n<p>I would, from a <code>Lam</code> instance, be able to do <code>lam f :: Dup Id Id (Int -&gt; Int)</code>.\nThis might look like</p>\n\n<pre><code>Dup (Id (\\x -&gt; x*y)) (Id (\\y -&gt; y))\n</code></pre>\n\n<p>which couldn't be made, because <code>y</code> is not available from the <code>x</code>-lambda.  (Using <code>undefined</code>s replaces the <code>y</code> with <code>undefined</code> here, throwing run-time errors whenever it doesn't work nicely.)\nThis is not a rare occurrence: it happens any time you use one of the variables in the other's result.</p>\n\n<p>I'm not sure quite what you're asking with the stronger <code>Monad</code>-generalized one, but this happens with other <code>Monad</code>s, too: for example, with <code>Maybe</code>, you couldn't turn the following into a <code>Maybe (Int -&gt; Int)</code> because it depends on the value given:</p>\n\n<pre><code>f :: Maybe Int -&gt; Maybe Int\nf m = m &gt;&gt;= \\x -&gt; if x &gt; 5 then Just x else Nothing\n</code></pre>\n\n<p>(You could use <code>fromJust</code> on it and hope no one does this, but it's the same as the <code>undefined</code> solution.)</p>\n\n<p>The <code>undefined</code>s only throw an error if the function needs to look at the other variables, though.  If you're absolutely certain that it will never be run on anything like this, (e.g. you restrict unwrapping/creation to an extensively-tested hidden-away module,) then the <code>undefined</code> way would work.</p>\n\n<p>Just one more recommendation for it: use a more verbose <code>error</code> message instead of <code>undefined</code>, in case something <em>does</em> go wrong.</p>\n"}, {"tags": [], "owner": {"reputation": 833, "user_id": 7847896, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/c3e72cb1d5eceb94842bec50894e6943?s=128&d=identicon&r=PG&f=1", "display_name": "zbw", "link": "https://stackoverflow.com/users/7847896/zbw"}, "is_accepted": false, "score": 0, "last_activity_date": 1503855063, "creation_date": 1503855063, "answer_id": 45907551, "question_id": 43648182, "link": "https://stackoverflow.com/questions/43648182/duplicator-interpreter-with-hoas/45907551#45907551", "title": "Duplicator Interpreter with HOAS", "body": "<p>After doing some work with Template Haskell, I had an idea that is applicable here. Another option would be to do it the way TH does:</p>\n\n<pre><code>class Fail.MonadFail m =&gt; Quasi m where\n    -- All the things here, like inspecting types, generating names, etc.\n    ...\n\n-- Many instances, including\ninstance Quasi IO where ... -- So you can debug your TH\ninstance TH.Quasi GHCiQ where ... -- see https://github.com/ghc/ghc/blob/master/libraries/ghci/GHCi/TH.hs#L167\ninstance TH.Quasi TcM where ... -- see https://github.com/ghc/ghc/blob/master/compiler/typecheck/TcSplice.hs#L835\n\ndata Q a = { unQ :: forall m. Quasi m =&gt; m a }\ninstance Quasi Q where ...\n</code></pre>\n\n<p>You can find the <code>Q</code> monad's definition <a href=\"https://hackage.haskell.org/package/template-haskell-2.12.0.0/docs/src/Language.Haskell.TH.Syntax.html#Q\" rel=\"nofollow noreferrer\">here</a>.</p>\n\n<p>An end user works within the <code>Q</code> monad, and it can be interpreted by any internal compiler interpreter, or the <code>IO</code> monad for debugging, etc.  Any duplication is handled by the <code>forall</code>.  You could, similarly, do something like</p>\n\n<pre><code>data L a = { unL :: forall repr. Lam repr =&gt; repr a }\ninstance Lam L where ...\n\nmyEndUserThing :: L ((a -&gt; b) -&gt; a -&gt; b)\nmyEndUserThing = lam $ \\f -&gt; lam $ \\x -&gt; app f x\n</code></pre>\n\n<p><code>L a</code> is easily convertible to any other <code>repr</code> you want, and if you need more functionality, just add it to the <code>Lam</code> class or create a deriving class with the extra functionality.</p>\n"}], "owner": {"reputation": 21417, "user_id": 925978, "user_type": "registered", "accept_rate": 84, "profile_image": "https://www.gravatar.com/avatar/06e4467a5bd1538a92cefb20db07897a?s=128&d=identicon&r=PG&f=1", "display_name": "crockeea", "link": "https://stackoverflow.com/users/925978/crockeea"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 348, "favorite_count": 2, "answer_count": 2, "score": 20, "last_activity_date": 1503855063, "creation_date": 1493263831, "last_edit_date": 1493270361, "question_id": 43648182, "link": "https://stackoverflow.com/questions/43648182/duplicator-interpreter-with-hoas", "title": "Duplicator Interpreter with HOAS", "body": "<p>In section 2.3 of <a href=\"http://okmij.org/ftp/tagless-final/course/lecture.pdf\" rel=\"noreferrer\">these</a> really cool notes on tagless final interpreters for DSLs, Oleg Kiselyov shows how to solve the problem of <em>parsing</em> a serialized DSL expression once, and <em>interpreting</em> it multiple times. </p>\n\n<p>Briefly, he shows that \"fake first-class polymorphism\" with the types</p>\n\n<pre><code>newtype Wrapped = Wrapped (\u2200 repr. ExpSYM repr \u21d2 repr)\nfromTree :: String \u2192 Either ErrMsg Wrapped\n</code></pre>\n\n<p>is not satisfactory because it is not extensible: we have to have a different <code>Wrapper</code>/<code>fromTree</code> for every <em>set</em> of constraints on <code>repr</code>. Thus I'm inclined to use his solution of a <em>duplicator interpreter</em>. This question is about how to use that interpreter with HOAS.</p>\n\n<p>Specifically, consider the following language for target language bindings:</p>\n\n<pre><code>class Lam repr where\n  lam :: (repr a -&gt; repr b) -&gt; repr (a -&gt; b)\n  app :: repr (a -&gt; b) -&gt; repr a -&gt; repr b\n</code></pre>\n\n<p>I'm having trouble giving a <em>sound</em> instance of the <code>Lam</code> class for my duplicator interpreter. Here's what I have:</p>\n\n<pre><code>data Dup repr1 repr2 a = Dup {unDupA :: repr1 a, unDupB :: repr2 a}\n\ninstance (Lam repr1, Lam repr2) =&gt; Lam (Dup repr1 repr2) where\n  lam f = Dup (lam $ unDupA . f . flip Dup undefined) (lam $ unDupB . f . Dup undefined)\n  app (Dup fa fb) (Dup a b) = Dup (app fa a) (app fb b)\n</code></pre>\n\n<p>Is there some way to give a <em>recursive</em> instance of <code>Lambda</code> for something like my <code>Dup</code> type that doesn't involve <code>undefined</code>?</p>\n\n<p>I've also tried using the more powerful version of <code>lam</code> from <a href=\"http://okmij.org/ftp/tagless-final/TaglessStaged/beyond.pdf\" rel=\"noreferrer\">this paper</a>, which permits <em>monadic</em> interpreters with HOAS, though I didn't see how it would help me with my instance for <code>Dup</code>. A solution using either version of <code>lam</code> with HOAS would be great!</p>\n\n<hr>\n\n<p><sub>*: Oleg showed how to define a sound instance using de Bruijn indices, but I'm really interested in a solution for HOAS. </sub></p>\n\n<pre><code><sub>\n    class Lam repr where\n      lam :: repr (a,g) b -> repr g (a -> b)\n      app :: repr g (a->b) -> repr g a -> repr g b\n\n    data Dup repr1 repr2 g a = Dup{d1:: repr1 g a, d2:: repr2 g a}\n\n    instance (Lam repr1, Lam repr2) => Lam (Dup repr1 repr2) where\n      lam (Dup e1 e2) = Dup (lam e1) (lam e2)\n      app (Dup f1 f2) (Dup x1 x2) = Dup (app f1 x1) (app f2 x2)\n</sub></code></pre>\n"}, {"tags": ["haskell", "matrix", "types", "typeclass", "dependent-type"], "comments": [{"owner": {"reputation": 126897, "user_id": 791604, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/ce991df7a056248d5e4f6fc3659ba733?s=128&d=identicon&r=PG", "display_name": "Daniel Wagner", "link": "https://stackoverflow.com/users/791604/daniel-wagner"}, "edited": false, "score": 1, "creation_date": 1493288887, "post_id": 43647175, "comment_id": 74357553, "body": "The simplest solution is not to implement <code>Applicative</code>; invent new function names that take your extra size parameters. (Whether you stuff those functions in a class or not depends on your needs.) But depending on what library operations are already available for things that support <code>Applicative</code> this may be painful... you&#39;ll know more than we will about whether that&#39;s a non-starter or not. What do you think?"}, {"owner": {"reputation": 83, "user_id": 5440214, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/469ab9579220e66421a1af3bf0b69e6d?s=128&d=identicon&r=PG", "display_name": "Pete", "link": "https://stackoverflow.com/users/5440214/pete"}, "reply_to_user": {"reputation": 126897, "user_id": 791604, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/ce991df7a056248d5e4f6fc3659ba733?s=128&d=identicon&r=PG", "display_name": "Daniel Wagner", "link": "https://stackoverflow.com/users/791604/daniel-wagner"}, "edited": false, "score": 0, "creation_date": 1493291366, "post_id": 43647175, "comment_id": 74359199, "body": "Good point! Yes, splitting out variant methods from <code>Applicative</code>, <code>Semiring</code>, and <code>StarSemiring</code> is certainly an option, though I think a moderately painful and inelegant one. I&#39;ll keep this as a backup option depending on the other answers."}, {"owner": {"reputation": 100892, "user_id": 745903, "user_type": "registered", "accept_rate": 74, "profile_image": "https://www.gravatar.com/avatar/50933f6638836741e620669b3940410e?s=128&d=identicon&r=PG", "display_name": "leftaroundabout", "link": "https://stackoverflow.com/users/745903/leftaroundabout"}, "edited": false, "score": 1, "creation_date": 1493292742, "post_id": 43647175, "comment_id": 74360259, "body": "<a href=\"https://personal.cis.strath.ac.uk/conor.mcbride/pub/hasochism.pdf\" rel=\"nofollow noreferrer\">personal.cis.strath.ac.uk/conor.mcbride/pub/hasochism.pdf</a>"}, {"owner": {"reputation": 37219, "user_id": 1523776, "user_type": "moderator", "accept_rate": 87, "profile_image": "https://www.gravatar.com/avatar/b3e0b5c8e42a8c38009ef2d969f8dabb?s=128&d=identicon&r=PG", "display_name": "Benjamin Hodgson", "link": "https://stackoverflow.com/users/1523776/benjamin-hodgson"}, "reply_to_user": {"reputation": 100892, "user_id": 745903, "user_type": "registered", "accept_rate": 74, "profile_image": "https://www.gravatar.com/avatar/50933f6638836741e620669b3940410e?s=128&d=identicon&r=PG", "display_name": "leftaroundabout", "link": "https://stackoverflow.com/users/745903/leftaroundabout"}, "edited": false, "score": 1, "creation_date": 1493318326, "post_id": 43647175, "comment_id": 74378123, "body": "I&#39;m unclear on what you&#39;re trying to do. Do you want static bounds checking? (If so see <i>Hasochism</i> as linked by @leftaroundabout.) Or do you want a way to dynamically build type class dictionaries? (If so I&#39;ll happily write you an answer about <code>reflection</code>.) They&#39;re very different requirements!"}, {"owner": {"reputation": 83, "user_id": 5440214, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/469ab9579220e66421a1af3bf0b69e6d?s=128&d=identicon&r=PG", "display_name": "Pete", "link": "https://stackoverflow.com/users/5440214/pete"}, "edited": false, "score": 0, "creation_date": 1493335888, "post_id": 43647175, "comment_id": 74385856, "body": "I think the ideas in <i>Hasochism</i> are probably sufficient, but I still need a bit of hand-holding, I&#39;m afraid \u2014 I can&#39;t quite get the right combination of Nattys and constraints and datatype declarations. Using @pigworker&#39;s <code>data Matrix :: (Nat,Nat) -&gt; * -&gt; * where Mat :: {unMat :: Vec h (Vec w a)} -&gt; Matrix &#39;(w,h) a</code>:  What does the <code>Applicative</code> instance look like, for example? If I want to define a type synonym like <code>type AdjMat = Matrix Int (Tropical Double)</code> from O&#39;Connor, can I? What&#39;s the equivalent <code>toMatrix :: NATTY n =&gt; [[a]] -&gt; Matrix (Pair n n) a</code>? Thanks!"}, {"owner": {"reputation": 126897, "user_id": 791604, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/ce991df7a056248d5e4f6fc3659ba733?s=128&d=identicon&r=PG", "display_name": "Daniel Wagner", "link": "https://stackoverflow.com/users/791604/daniel-wagner"}, "edited": false, "score": 0, "creation_date": 1493343731, "post_id": 43647175, "comment_id": 74387883, "body": "Another thought: can you get away with <code>data Matrix i e = Pure e | Matrix (Array (i,i) e)</code>?"}, {"owner": {"reputation": 83, "user_id": 5440214, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/469ab9579220e66421a1af3bf0b69e6d?s=128&d=identicon&r=PG", "display_name": "Pete", "link": "https://stackoverflow.com/users/5440214/pete"}, "reply_to_user": {"reputation": 126897, "user_id": 791604, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/ce991df7a056248d5e4f6fc3659ba733?s=128&d=identicon&r=PG", "display_name": "Daniel Wagner", "link": "https://stackoverflow.com/users/791604/daniel-wagner"}, "edited": false, "score": 0, "creation_date": 1493369786, "post_id": 43647175, "comment_id": 74398080, "body": "@DanielWagner No, that&#39;s not enough because of <code>Semiring</code>&#39;s <code>one ::  Matrix i e</code>, which in the <code>Bounded</code> version is implemented <code>one = buildMatrix (\\(i,j) -&gt; if i == j then one else zero)</code>. (If I used your idea from above, <code>buildMatrix</code> would be parameterized by size, so <code>oneM :: (A.Ix i, Enum i, Num i, Semiring e) =&gt; i -&gt; Matrix i e</code> instead.)"}], "answers": [{"comments": [{"owner": {"reputation": 83, "user_id": 5440214, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/469ab9579220e66421a1af3bf0b69e6d?s=128&d=identicon&r=PG", "display_name": "Pete", "link": "https://stackoverflow.com/users/5440214/pete"}, "edited": false, "score": 0, "creation_date": 1493715209, "post_id": 43684733, "comment_id": 74510494, "body": "Thanks for a very detailed answer. I think it&#39;s clear how to progress for now, and what I can read to understand this stuff better latter\u2026"}], "tags": [], "owner": {"reputation": 37219, "user_id": 1523776, "user_type": "moderator", "accept_rate": 87, "profile_image": "https://www.gravatar.com/avatar/b3e0b5c8e42a8c38009ef2d969f8dabb?s=128&d=identicon&r=PG", "display_name": "Benjamin Hodgson", "link": "https://stackoverflow.com/users/1523776/benjamin-hodgson"}, "is_accepted": true, "score": 4, "last_activity_date": 1493418022, "last_edit_date": 1493418022, "creation_date": 1493396322, "answer_id": 43684733, "question_id": 43647175, "link": "https://stackoverflow.com/questions/43647175/how-to-create-bounded-instance-based-on-runtime-values/43684733#43684733", "title": "How to create Bounded instance based on runtime values?", "body": "<p>I wrote a long answer about <em><a href=\"https://personal.cis.strath.ac.uk/conor.mcbride/pub/hasochism.pdf\" rel=\"nofollow noreferrer\">Hasochism</a></em>'s <code>Matrix</code>'s <code>Applicative</code> instance, using finite sets as index types, but it's probably overkill for what you wanted, not to mention less efficient than the <code>Array</code>-based code in the blog post.</p>\n\n<p>Your problem stems from the fact that various operations in the blog post's code assume that the <code>Bounded</code> instance for the matrix's index type is <em>covering</em>, in the sense that every value within the bounds will have a corresponding element in the matrix. The core assumption seems to be that the size of the matrix is known statically.</p>\n\n<p>The simplest way to fix this would be to make an adjustment to the <code>Matrix</code> type, so that it carries its size around with it. You still have to do all your bounds checking dynamically, but I think that's a fairly good trade-off compared to the weightiness of the Hasochism approach.</p>\n\n<pre><code>-- Bounded as an explicit (minBound, maxBound) tuple\ntype Bounds i = (i, i)\ndata Matrix i e = Matrix { getBounds :: Bounds i, getMatrix :: Array (Edge i) e }\n\nentireRange :: Ix i =&gt; Bounds i -&gt; [i]\nentireRange b = range b\n\nmatrix :: Ix i =&gt; Bounds i -&gt; (Edge i -&gt; e) -&gt; Matrix i e\nmatrix bounds f = Matrix bounds $ listArray bounds $ map f $ entireRange bounds\n</code></pre>\n\n<p>This gets stuck, however, when you need to construct a matrix in a type class instance. You can't abstract instances over runtime values: the only thing valid to the left of the <code>=&gt;</code> in an instance declaration is another type class constraint. In a declaration like</p>\n\n<pre><code>instance Bounded i =&gt; Applicative (Matrix i) where\n    pure x = matrix (const x)\n    (&lt;*&gt;) = -- ...\n</code></pre>\n\n<p>we have no choice than to pass the bounds statically in an instance dictionary because the type of <code>pure</code> doesn't allow us to pass explicit configuration data. <a href=\"https://www.youtube.com/watch?v=hIZxTQP1ifo\" rel=\"nofollow noreferrer\">This restriction has its ups and downs</a>, but right now it's a definite downer: the fix is to rip all of the classiness out of your code altogether.</p>\n\n<hr>\n\n<p>Good news, though: you can emulate this explicit dictionary-passing style using the crazy <a href=\"https://hackage.haskell.org/package/reflection\" rel=\"nofollow noreferrer\"><code>reflection</code></a> library, which does evil, magical things to push runtime values into typeclass dictionaries. It's scary stuff, but it does work, and it's safe.</p>\n\n<p>It all happens in the <a href=\"https://hackage.haskell.org/package/reflection-2.1.2/docs/Data-Reflection.html#v:reify\" rel=\"nofollow noreferrer\"><code>reify</code></a> and <a href=\"https://hackage.haskell.org/package/reflection-2.1.2/docs/Data-Reflection.html#v:reflect\" rel=\"nofollow noreferrer\"><code>reflect</code></a> combinators. <code>reify</code> takes a runtime value and a block of code with a constraint depending on the availability of that value and plugs them in to one another. Calls to <code>reflect</code> inside the block return the value that was passed to <code>reify</code> outside it.</p>\n\n<pre><code>needsAnInt :: Reifies s Int =&gt; Proxy s -&gt; IO ()\nneedsAnInt p = print (reflect p + 1)\n\nexample1 :: IO ()\nexample1 = reify 3 (\\p -&gt; needsAnInt p)  -- prints 4\nexample2 :: IO ()\nexample2 = reify 5 (\\p -&gt; needsAnInt p)  -- prints 6\n</code></pre>\n\n<p>Take a moment to reflect (ha ha) on how weird this is. Usually there's only one class dictionary in scope for each type (overlapping instances notwithstanding). <code>Proxy</code> has only one value (<code>data Proxy a = Proxy</code>), so how can <code>reflect</code> tell two proxies apart, to return different values each time?</p>\n\n<p>Anyway, what's the point of this? Instances can't depend on runtime values, but they can depend on other instances. <code>reflection</code> gives us the tools to turn a runtime value into an instance dictionary, so this allows us to build instances which depend dynamically on runtime values!</p>\n\n<p>In this case, we're building an instance of <code>Bounded</code>. We need a <code>newtype</code>, to make an instance which doesn't overlap with any others:</p>\n\n<pre><code>-- in this case it's fine to just lift the Ix instance from the underlying type\nnewtype B s i = B i deriving (Eq, Ord, Ix)\n</code></pre>\n\n<p>Clearly <code>B</code> can be an instance of <code>Bounded</code> if <code>i</code> is - it can get <code>minBound</code> and <code>maxBound</code> from <code>i</code>'s instance - but we want to get them from a <code>Reifies</code> context. In other words, the runtime value we'll be stuffing into the <code>Reifies</code> dictionary will be a pair of <code>i</code>s.</p>\n\n<pre><code>instance Reifies s (i, i) =&gt; Bounded (B s i) where\n    minBound = B $ fst $ reflect (Proxy :: Proxy s)\n    maxBound = B $ snd $ reflect (Proxy :: Proxy s)\n</code></pre>\n\n<p>I'm using <code>ScopedTypeVariables</code> crucially to come up with <code>Proxy</code> values of the correct type.</p>\n\n<p>Now you can write perfectly ordinary code which uses a <code>Bounded</code> context (even if that context arises due to some other instance), and invoke it with a dynamically built <code>Bounded</code> dictionary using <code>reify</code>.</p>\n\n<pre><code>entireRange :: (Ix i, Bounded i) =&gt; [i]\nentireRange = range (minBound, maxBound)\n\nexample3 :: IO ()\nexample3 = reify (3, 6) myComputation\n    where myComputation :: forall s. Bounded (B s Int) =&gt; Proxy s -&gt; IO ()\n          myComputation p = print $ map unB (entireRange :: [B s Int])\n\nghci&gt; example3\n[3,4,5,6]\n</code></pre>\n\n<p>Um, yeah. <code>reflection</code> can be tricky to use. At the end of the day, it's probably simpler just to not bother with classes.</p>\n"}, {"tags": [], "owner": {"reputation": 37219, "user_id": 1523776, "user_type": "moderator", "accept_rate": 87, "profile_image": "https://www.gravatar.com/avatar/b3e0b5c8e42a8c38009ef2d969f8dabb?s=128&d=identicon&r=PG", "display_name": "Benjamin Hodgson", "link": "https://stackoverflow.com/users/1523776/benjamin-hodgson"}, "is_accepted": false, "score": 2, "last_activity_date": 1493772920, "last_edit_date": 1495535486, "creation_date": 1493667886, "answer_id": 43725428, "question_id": 43647175, "link": "https://stackoverflow.com/questions/43647175/how-to-create-bounded-instance-based-on-runtime-values/43725428#43725428", "title": "How to create Bounded instance based on runtime values?", "body": "<p>Today's a bank holiday here in the UK, so I had time to finish that answer about statically sized matrices. I wouldn't necessarily recommend doing this in production - even leaving aside how silly the code is, this is a <em>terrible</em> representation of matrices if you want to do efficient linear algebra on real hardware - but it's kinda fun to mess around with.</p>\n\n<p>From <a href=\"https://personal.cis.strath.ac.uk/conor.mcbride/pub/hasochism.pdf\" rel=\"nofollow noreferrer\"><em>Hasochism</em></a>:</p>\n\n<pre><code>-- Natural numbers and their singletons in explicit and implicit varieties\ndata Nat = Z | S Nat  -- page 2 of the paper\nintToNat :: Int -&gt; Maybe Nat  -- paraphrased from page 10\nintToNat n\n    | n &lt; 0     = Nothing\n    | n == 0    = Just Z\n    | otherwise = S &lt;$&gt; intToNat (n-1)\ndata Natty n where  -- page 2\n    Zy :: Natty Z\n    Sy :: Natty n -&gt; Natty (S n)\n-- page 3\nclass NATTY n where\n    natty :: Natty n\ninstance NATTY Z where\n    natty = Zy\ninstance NATTY n =&gt; NATTY (S n) where\n    natty = Sy natty\n\n-- turn an explicit Natty into an implicit one\nnatter :: Natty n -&gt; (NATTY n =&gt; r) -&gt; r  -- page 4\nnatter Zy r = r\nnatter (Sy n) r = natter n r\n\n-- vectors, matrices in row-major order\ndata Vec n a where  -- page 2\n    V0 :: Vec Z a\n    (:&gt;) :: a -&gt; Vec n a -&gt; Vec (S n) a\nnewtype Mat w h a = Mat { unMat :: Vec h (Vec w a) }  -- page 4\n\n-- vector addition, in the form of an Applicative instance\nvcopies :: Natty n -&gt; a -&gt; Vec n a  -- page 4\nvcopies Zy x = V0\nvcopies (Sy n) x =  :&gt; vcopies n x\nvapp :: Vec n (a -&gt; b) -&gt; Vec n a -&gt; Vec n b  -- page 4\nvapp V0 V0 = V0\nvapp (f :&gt; fs) (x :&gt; xs) = f x :&gt; vapp fs xs\ninstance NATTY n =&gt; Applicative (Vec n) where  -- page 4\n    pure = vcopies natty\n    (&lt;*&gt;) = vapp\n\n-- iterating vectors\ninstance Traversable (Vec n) where  -- page 4\n    traverse f V0 = pure V0\n    traverse f (x :&gt; xs) = liftA2 (:&gt;) (f x) (traverse f xs)\ninstance Foldable (Vec n) where  -- page 4\n    foldMap = foldMapDefault\ninstance Functor (Vec n) where  -- page 4\n    fmap = fmapDefault\n\ntranspose :: NATTY w =&gt; Mat w h a -&gt; Mat h w a  -- page 4\ntranspose = Mat . sequenceA . unMat\n</code></pre>\n\n<p>I've taken the liberty of renaming the authors' <code>Matrix</code> type to <code>Mat</code>, rearranging its type arguments, and changing it from a GADT to a newtype. Forgive me for skipping over the explanation of the above - the paper does a better job than I could, and I want to get to the part where I answer your question.</p>\n\n<hr>\n\n<p><code>Mat w h</code> is an <code>h</code>-vector of <code>w</code>-vectors. It's the <a href=\"https://hackage.haskell.org/package/base-4.9.1.0/docs/Data-Functor-Compose.html#t:Compose\" rel=\"nofollow noreferrer\">type-level composition</a> of two <code>Vec</code> functors. Its <code>Applicative</code> instance, which implements matrix addition, reflects that structure,</p>\n\n<pre><code>instance (NATTY w, NATTY h) =&gt; Applicative (Mat w h) where\n    pure = Mat . pure . pure\n    Mat fss &lt;*&gt; Mat xss = Mat $ liftA2 (&lt;*&gt;) fss xss\n</code></pre>\n\n<p>as does its <code>Traversable</code> instance.</p>\n\n<pre><code>instance Traversable (Mat w h) where\n    traverse f = fmap Mat . traverse (traverse f) . unMat\ninstance Foldable (Mat w h) where\n    foldMap = foldMapDefault\ninstance Functor (Mat w h) where\n    fmap = fmapDefault\n</code></pre>\n\n<p>We also need a bit of equipment to work with indexes of vectors. To identify a particular element in an <code>n</code>-vector, you have to give a number less than <code>n</code>.</p>\n\n<pre><code>data Fin n where\n    FZ :: Fin (S n)\n    FS :: Fin n -&gt; Fin (S n)\n</code></pre>\n\n<p>The type <code>Fin n</code> has exactly <code>n</code> elements, so <code>Fin</code> is the family of <em>finite sets</em>. A value of type <code>Fin n</code> is structurally a natural number less then <code>n</code> (compare <code>FS FZ</code> with <code>S Z</code>), so <code>FS FZ :: Fin (S (S Z))</code>, or <code>FS FZ :: Fin (S (S (S Z)))</code>, but <code>FS FZ :: Fin (S Z)</code> will fail to type check.</p>\n\n<p>Here's a higher order function which builds a vector containing all the possible results of its argument.</p>\n\n<pre><code>tabulate :: Natty n -&gt; (Fin n -&gt; a) -&gt; Vec n a\ntabulate Zy f = V0\ntabulate (Sy n) f = f FZ :&gt; tabulate n (f . FS)\n</code></pre>\n\n<hr>\n\n<p>Now we can start working with semirings. Taking the dot product of two vectors involves multiplying their elements and then summing the result.</p>\n\n<pre><code>dot :: Semiring a =&gt; Vec n a -&gt; Vec n a -&gt; a\ndot xs ys = foldr (&lt;+&gt;) zero $ vapp (fmap (&lt;.&gt;) xs) ys\n</code></pre>\n\n<p>Here's a vector which is <code>zero</code> everywhere except the specified index.</p>\n\n<pre><code>oneAt :: Semiring a =&gt; Natty n -&gt; Fin n -&gt; Vec n a\noneAt (Sy n) FZ = one :&gt; vcopies n zero\noneAt (Sy n) (FS f) = zero :&gt; oneAt n f\n</code></pre>\n\n<p>We'll use <code>oneAt</code> and <code>tabulate</code> to make an identity matrix.</p>\n\n<pre><code>type Square n = Mat n n\n\nidentity :: Semiring a =&gt; Natty n -&gt; Square n a\nidentity n = Mat $ tabulate n (oneAt n)\n\nghci&gt; identity (Sy (Sy Zy)) :: Square (S (S Z)) Int\nMat {unMat = (1 :&gt; (0 :&gt; V0)) :&gt; ((0 :&gt; (1 :&gt; V0)) :&gt; V0)}\n-- \u250c      \u2510\n-- \u2502 1, 0 \u2502\n-- \u2502 0, 1 \u2502\n-- \u2514      \u2518\n</code></pre>\n\n<p>And <code>transpose</code> comes in useful for matrix multiplication.</p>\n\n<pre><code>mul :: (NATTY w, Semiring a) =&gt; Mat r h a -&gt; Mat w r a -&gt; Mat w h a\nmul m n =\n    let mRows = unMat m\n        nCols = unMat $ transpose n\n    in Mat $ fmap (\\r -&gt; dot r &lt;$&gt; nCols) mRows\n\nghci&gt; let m = Mat $ (1 :&gt; 2 :&gt; V0) :&gt; (3 :&gt; 4 :&gt; V0) :&gt; V0 :: Square (S (S Z)) Int in mul m m\nMat {unMat = (7 :&gt; (10 :&gt; V0)) :&gt; ((15 :&gt; (22 :&gt; V0)) :&gt; V0)}\n-- \u250c      \u25102   \u250c        \u2510\n-- \u2502 1, 2 \u2502  = \u2502  7, 10 \u2502\n-- \u2502 3, 4 \u2502    \u2502 15, 22 \u2502\n-- \u2514      \u2518    \u2514        \u2518\n</code></pre>\n\n<p>So that's the <code>Semiring</code> instance for square matrices sorted. Phew!</p>\n\n<pre><code>instance (NATTY n, Semiring a) =&gt; Semiring (Square n a) where\n    zero = pure zero\n    (&lt;+&gt;) = liftA2 (&lt;+&gt;)\n    one = identity natty\n    (&lt;.&gt;) = mul\n</code></pre>\n\n<p>The thing to notice about this implementation is that <code>zero</code> and <code>one</code> dynamically build matrices of a statically known size, typically based on contextual type information at the call site. They get the runtime representation of that size (a <code>Natty</code>) from the <code>NATTY</code> dictionary, which the elaborator builds based on the matrix's inferred type.</p>\n\n<p>This is a totally different approach than that of the <code>reflection</code> library (which I outlined in <a href=\"https://stackoverflow.com/a/43684733/1523776\">my other answer</a>). <code>reflection</code> is about stuffing explicit runtime values into implicit instance dictionaries, whereas this style takes information that would otherwise only be known at runtime - the size of the matrix - and makes it static, using singletons to make the type information available in the world of values. Of course a real dependently typed language would dispense with the <code>Natty</code> ceremony: <code>n</code> would be a plain old value and we could use it directly, rather than having to go via a singleton hidden in an instance dictionary.</p>\n\n<p>I'll leave the Kleene algebra stuff to you because I'm lazy and I want to get on to the question of synthesising type information based on runtime input.</p>\n\n<hr>\n\n<p>How can we use these statically sized matrices when we don't know the size statically? You mentioned that your program asks the user how big their graph is (and thus how big the adjacency matrix used to represent the graph is). So the user types a number (a <code>Nat</code>-the-value, not <code>Nat</code>-the-type) and we're somehow expected to know statically what the user was going to type?</p>\n\n<p>The trick is to write blocks of code which are agnostic to the value of the matrix's size. Then, no matter what the input was, as long as it was a natural number, we know that that block of code will work. We can force a function to be polymorphic using higher-rank types.</p>\n\n<pre><code>withNatty :: Nat -&gt; (forall n. Natty n -&gt; r) -&gt; r\nwithNatty Z r = r Zy\nwithNatty (S n) r = withNatty n (r . Sy)\n</code></pre>\n\n<p><code>withNatty n r</code> applies the function <code>r</code> to the singleton representation of the natural number <code>n</code>. <code>r</code> has the <code>Natty n</code> available at runtime, so it can recover static knowledge of <code>n</code> by pattern matching the <code>Natty</code>, but <code>n</code> can't leak to the outside of the block. (You can also use existential quantification, which is covered briefly in <em>Hasochism</em>, to wrap a <code>Natty</code> and pass it around. It amounts to the same thing.)</p>\n\n<p>So, for example, supposing we want to print an identity matrix of a dynamically-determined size:</p>\n\n<pre><code>main = do\n    Just size &lt;- fmap intToNat readLn\n    withNatty size (print . mkIdentity)\n        where mkIdentity :: Natty n -&gt; Square n Int\n              mkIdentity n = natter n one\n\nghci&gt; main\n4\nMat {unMat = (1 :&gt; (0 :&gt; (0 :&gt; (0 :&gt; V0)))) :&gt; ((0 :&gt; (1 :&gt; (0 :&gt; (0 :&gt; V0)))) :&gt; ((0 :&gt; (0 :&gt; (1 :&gt; (0 :&gt; V0)))) :&gt; ((0 :&gt; (0 :&gt; (0 :&gt; (1 :&gt; V0)))) :&gt; V0)))}\n</code></pre>\n\n<p>The same technique applies if you want to, say, build a matrix from a list of lists. This time it's a bit trickier because you have to prove to GHC that all of the lists have the same length, by measuring them.</p>\n\n<pre><code>withVec :: [a] -&gt; (forall n. NATTY n =&gt; Vec n a -&gt; r) -&gt; r\nwithVec [] r = r V0\nwithVec (x:xs) r = withVec xs (r . (x :&gt;))\n\n\n-- this operation can fail because the input lists may not all be the same length\nwithMat :: [[a]] -&gt; (forall w h. (NATTY w, NATTY h) =&gt; Mat w h a -&gt; r) -&gt; Maybe r\nwithMat xss r = assertEqualLengths xss (\\vs -&gt; withVec vs (r . Mat))\n    where assertEqualLengths :: [[a]] -&gt; (forall n. NATTY n =&gt; [Vec n a] -&gt; r) -&gt; Maybe r\n          assertEqualLengths [] r = Just (r noVecs)\n          assertEqualLengths xss@(xs:_) r = withLen xs (\\n -&gt; natter n $ r &lt;$&gt; traverse (assertLength n) xss)\n\n          noVecs :: [Vec Z a]\n          noVecs = []\n\n          assertLength :: Natty n -&gt; [a] -&gt; Maybe (Vec n a)\n          assertLength Zy [] = Just V0\n          assertLength (Sy n) (x:xs) = fmap (x :&gt;) (assertLength n xs)\n          assertLength _ _ = Nothing\n\n          withLen :: [a] -&gt; (forall n. Natty n -&gt; r) -&gt; r\n          withLen [] r = r Zy\n          withLen (x:xs) r = withLen xs (r . Sy)\n\nghci&gt; withMat [[1,2], [3,4]] show\nJust \"Mat {unMat = (1 :&gt; (2 :&gt; V0)) :&gt; ((3 :&gt; (4 :&gt; V0)) :&gt; V0)}\"\nghci&gt; withMat [[1,2], [3]] show  -- a ragged input list\nNothing\n</code></pre>\n\n<p>And if you want to work with square matrices, you have to prove to GHC that the matrix's height is equal to its width.</p>\n\n<pre><code>withEqual :: Natty n -&gt; Natty m -&gt; (n ~ m =&gt; r) -&gt; Maybe r\nwithEqual Zy Zy r = Just r\nwithEqual (Sy n) (Sy m) r = withEqual n m r\nwithEqual _ _ _ = Nothing\n\nsquare :: Natty w -&gt; Natty h -&gt; Mat w h a -&gt; Maybe (Square w a)\nsquare = withEqual\n</code></pre>\n"}], "owner": {"reputation": 83, "user_id": 5440214, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/469ab9579220e66421a1af3bf0b69e6d?s=128&d=identicon&r=PG", "display_name": "Pete", "link": "https://stackoverflow.com/users/5440214/pete"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 331, "favorite_count": 0, "accepted_answer_id": 43684733, "answer_count": 2, "score": 8, "last_activity_date": 1493772920, "creation_date": 1493256720, "last_edit_date": 1495540484, "question_id": 43647175, "link": "https://stackoverflow.com/questions/43647175/how-to-create-bounded-instance-based-on-runtime-values", "title": "How to create Bounded instance based on runtime values?", "body": "<p>I've been playing with O'Connor's <a href=\"http://r6.ca/blog/20110808T035622Z.html\" rel=\"nofollow noreferrer\">matrix</a> implementation based on *-semirings, allowing very neat solutions for graph algorithms:</p>\n\n<pre><code>import Data.Array\nnewtype Matrix i e = Matrix (Array (i,i) e)\n\nmatrix :: (Ix i, Bounded i) =&gt; ((i,i) -&gt; e) -&gt; Matrix i e\nmatrix f = Matrix . listArray (minBound, maxBound) . map f $ entireRange\n</code></pre>\n\n<p>However, I'd like to read in adjacency matrices of arbitrary sizes from files in the outside world, so  having an enumerated type that the matrix is indexed on (like <code>Matrix Node :: Matrix Node2 (Maybe Integer)</code> from the same paper) doesn't really work for me.</p>\n\n<p>My first thought was something like</p>\n\n<pre><code>toMatrix :: [[a]] -&gt; Matrix Int a\ntoMatrix list = Matrix (listArray ((0,0),(l-1,l-1)) $ concat list)\n  where l = length list\n</code></pre>\n\n<p>but of course this doesn't work either: trying to actually use this matrix blows up when various typeclass instances try to access index <code>(minBound :: Int, minBound :: Int)</code>.</p>\n\n<p>Parameterizing the matrix type with a size like</p>\n\n<pre><code>newtype Matrix i e = Matrix i (Array (i,i) e)\n</code></pre>\n\n<p>doesn't quite work either: although I can change the <code>matrix</code> function to build matrices this way, now I have trouble writing <code>pure</code> for the <code>Applicative (Matrix i e)</code> instance or <code>one</code> for the <code>Semiring (Matrix i e)</code> instance, as the correct <code>one :: Matrix i e</code> depends on the size of the matrices in context.</p>\n\n<p>Conceptually, I can think of two ways out of this:</p>\n\n<ol>\n<li>Define a new <code>BoundedInt</code> type with a  <code>Bounded</code> instance that can be set at runtime when we know the size of the array, or</li>\n<li>Find a way to declare instances of <code>Applicative (Matrix i e)</code> parameterized on the size of the matrix.</li>\n</ol>\n\n<p>But I don't know how to implement either of these, and searches around the subject seem to turn up gnarly complicated things. <a href=\"https://stackoverflow.com/questions/26723035/how-to-create-many-bounded-types-without-duplicating-code-in-haskell\">This</a> question also looks relevant, but I don't think it solves the problem (though it would let me use the <code>Bounded i</code> constructor on matrices of fixed <code>Int</code> size).</p>\n\n<p>What's the simplest solution here? Is there one without having to learn how to use the singleton library/some kind of dependent typing?</p>\n"}]