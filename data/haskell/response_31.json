[{"tags": ["haskell", "persistent"], "comments": [{"owner": {"reputation": 4938, "user_id": 1465011, "user_type": "registered", "accept_rate": 98, "profile_image": "https://www.gravatar.com/avatar/5c11daff0c870a2b41ae9b907a136adf?s=128&d=identicon&r=PG", "display_name": "recursion.ninja", "link": "https://stackoverflow.com/users/1465011/recursion-ninja"}, "edited": false, "score": 0, "creation_date": 1439416437, "post_id": 31975492, "comment_id": 51858683, "body": "Pragmatically speaking, you can write a <a href=\"https://hackage.haskell.org/package/QuickCheck-2.8.1/docs/Test-QuickCheck.html\" rel=\"nofollow noreferrer\"><b><code>QuickCheck</code></b></a> property to determine if the <code>persistent</code> boolean expression is equivalent to the normalized boolean expression."}, {"owner": {"reputation": 1954, "user_id": 110844, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/a4afd458cb202c0a2e566e569f753765?s=128&d=identicon&r=PG", "display_name": "Ecognium", "link": "https://stackoverflow.com/users/110844/ecognium"}, "reply_to_user": {"reputation": 4938, "user_id": 1465011, "user_type": "registered", "accept_rate": 98, "profile_image": "https://www.gravatar.com/avatar/5c11daff0c870a2b41ae9b907a136adf?s=128&d=identicon&r=PG", "display_name": "recursion.ninja", "link": "https://stackoverflow.com/users/1465011/recursion-ninja"}, "edited": false, "score": 0, "creation_date": 1439417438, "post_id": 31975492, "comment_id": 51859036, "body": "@recursion.ninja. Good point. I have not used QuickCheck with DB-oriented functions before. That said, I can probably manually setup a table with all boolean combinations of <code>A-E</code> and see if my <code>selectList</code> works correctly."}], "answers": [{"comments": [{"owner": {"reputation": 1954, "user_id": 110844, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/a4afd458cb202c0a2e566e569f753765?s=128&d=identicon&r=PG", "display_name": "Ecognium", "link": "https://stackoverflow.com/users/110844/ecognium"}, "edited": false, "score": 0, "creation_date": 1439508794, "post_id": 31976774, "comment_id": 51903501, "body": "Thanks Cirdec. I have not had a chance to test it but it seems like this is the  way to combine ANDing OR groups. I think it will be cleaner if <code>&amp;&amp;.</code> was provided as a convenience function so people have to figure out if the order of parens will matter or not. I will add this as a feature request."}], "tags": [], "owner": {"reputation": 23444, "user_id": 414413, "user_type": "registered", "accept_rate": 79, "profile_image": "https://www.gravatar.com/avatar/6de2113f01432aa844dc85070ff33e89?s=128&d=identicon&r=PG", "display_name": "Cirdec", "link": "https://stackoverflow.com/users/414413/cirdec"}, "is_accepted": true, "score": 3, "last_activity_date": 1439420189, "creation_date": 1439420189, "answer_id": 31976774, "question_id": 31975492, "link": "https://stackoverflow.com/questions/31975492/persistent-filters-and-operation-in-filters-when-using-or/31976774#31976774", "title": "Persistent Filters: And operation in filters when using Or", "body": "<p>You can use <a href=\"http://hackage.haskell.org/packages/archive/base/latest/doc/html/Prelude.html#v:-43--43-\" rel=\"nofollow\"><code>++</code></a> or <a href=\"http://hackage.haskell.org/package/base-4.8.1.0/docs/Data-Monoid.html#v:-60--62-\" rel=\"nofollow\"><code>&lt;&gt;</code></a> to and lists of filters together.</p>\n\n<p>From the <a href=\"http://www.yesodweb.com/book/persistent\" rel=\"nofollow\">Persistent manual</a>:</p>\n\n<blockquote>\n<pre><code>people &lt;- selectList [PersonAge &gt;. 25, PersonAge &lt;=. 30] []\nliftIO $ print people\n</code></pre>\n  \n  <p>The list of filters is <code>AND</code>ed together, so that our constraint means \"age is greater than 25 AND age is less than or equal to 30\". We\u2019ll describe ORing later.</p>\n</blockquote>\n"}], "owner": {"reputation": 1954, "user_id": 110844, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/a4afd458cb202c0a2e566e569f753765?s=128&d=identicon&r=PG", "display_name": "Ecognium", "link": "https://stackoverflow.com/users/110844/ecognium"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 107, "favorite_count": 1, "accepted_answer_id": 31976774, "answer_count": 1, "score": 3, "last_activity_date": 1439420189, "creation_date": 1439413870, "last_edit_date": 1439414470, "question_id": 31975492, "link": "https://stackoverflow.com/questions/31975492/persistent-filters-and-operation-in-filters-when-using-or", "title": "Persistent Filters: And operation in filters when using Or", "body": "<p>Persistent has an OR filter <code>||.</code> but it does not seem to have a corresponding <code>&amp;&amp;.</code>  I would like to do something like <code>A &amp;&amp; (B || C) &amp;&amp; (D || E)</code> and I am not sure the cleanest way to do it. </p>\n\n<p>I guess I can create all combinations like <code>(A &amp;&amp; B &amp;&amp; D) || (A &amp;&amp; C &amp;&amp; D) || (A &amp;&amp; B &amp;&amp; E) || (A &amp;&amp; C &amp;&amp; E)</code>.  It gets quite unwieldy even for this simple example. Not sure if there is a better way to do this with <code>persistent</code>. </p>\n\n<p>The code compiles when I do (inside <code>selectList</code>) <code>[A] ++ ([B] ||. [C]), etc.</code> but not sure if it is equivalent to what I want. </p>\n\n<p>Thanks!</p>\n"}, {"tags": ["haskell", "fizzbuzz"], "comments": [{"owner": {"reputation": 75362, "user_id": 625403, "user_type": "registered", "accept_rate": 82, "profile_image": "https://www.gravatar.com/avatar/786eed7da67079cb5d63a49d469af25b?s=128&d=identicon&r=PG", "display_name": "amalloy", "link": "https://stackoverflow.com/users/625403/amalloy"}, "edited": false, "score": 0, "creation_date": 1439431524, "post_id": 31974442, "comment_id": 51862519, "body": "Please don&#39;t edit a question to replace it with a totally different one (or add a substantial followup question). If the posted answer solved your original problem, mark it as accepted and then ask a new question."}, {"owner": {"reputation": 49959, "user_id": 866915, "user_type": "registered", "accept_rate": 70, "profile_image": "https://www.gravatar.com/avatar/09242131d6e17cbbe31e8547514da6e5?s=128&d=identicon&r=PG", "display_name": "ErikR", "link": "https://stackoverflow.com/users/866915/erikr"}, "edited": false, "score": 0, "creation_date": 1439436571, "post_id": 31974442, "comment_id": 51863741, "body": "I see what you were trying to do in your edited question. Post it as a separate question and I&#39;ll answer."}], "answers": [{"comments": [{"owner": {"reputation": 353, "user_id": 5220880, "user_type": "registered", "accept_rate": 80, "profile_image": "https://i.stack.imgur.com/DS5F0.png?s=128&g=1", "display_name": "Rocket Risa", "link": "https://stackoverflow.com/users/5220880/rocket-risa"}, "edited": false, "score": 0, "creation_date": 1439427052, "post_id": 31975343, "comment_id": 51861552, "body": "Thank you for the response! It definitely helps me understand the difference. See the code section I added above please. I&#39;m confused on how you implement an input variable and what the difference between &#39;IO ( )&#39;. I appreciate any help!"}], "tags": [], "owner": {"reputation": 49959, "user_id": 866915, "user_type": "registered", "accept_rate": 70, "profile_image": "https://www.gravatar.com/avatar/09242131d6e17cbbe31e8547514da6e5?s=128&d=identicon&r=PG", "display_name": "ErikR", "link": "https://stackoverflow.com/users/866915/erikr"}, "is_accepted": true, "score": 4, "last_activity_date": 1439413807, "last_edit_date": 1439413807, "creation_date": 1439413352, "answer_id": 31975343, "question_id": 31974442, "link": "https://stackoverflow.com/questions/31974442/multiple-input-values-with-upper-range/31975343#31975343", "title": "Multiple input values with upper range", "body": "<p>In PHP you define a function like this:</p>\n\n<pre><code>function abc($x, $y) { ... }\n</code></pre>\n\n<p>In Haskell you would do it this way:</p>\n\n<pre><code>abc x y = ...\n</code></pre>\n\n<p>and if you wanted to add a type signature:</p>\n\n<pre><code>abc :: Int -&gt; String -&gt; Whatever\nabc x y = ...\n</code></pre>\n\n<p>A Haskell version of your generalized fizz-buzz might be defined like this:</p>\n\n<pre><code>myFizzBuzz :: Int -&gt; Int -&gt; Int -&gt; [String]\nmyFizzBuzz    div1   div2   upperBound =\n  -- here `div1` is the first divisor, `div2` the second\n  -- and `upperBound` is the upper bound of the range\n  ...\n  -- return a list of strings, e.g. [\"Fizz\", \"Fizz\", \"Buzz\", ... ]\n</code></pre>\n\n<p>Note that <code>myFizzBuzz</code> returns a list of Strings - it doesn't print them out. To print them out just join the resulting words with <code>lines</code> and call <code>putStrLn</code>:</p>\n\n<pre><code>printMyFizzBuzz div1 div2 upperBound = \n  putStrLn $ lines (myFizzBuzz div1 div2 upperBound)\n</code></pre>\n\n<p>This also illustrates the separation of IO from computation which is prevalent in Haskell programs: you structure your program as mainly a pure computation surrounded by a thin IO-layer. In this case <code>myFizzBuzz</code> is your pure function. A complete program which takes it's parameters from the console might look like this:</p>\n\n<pre><code>main = do\n  (arg1 : arg2 : arg3 : _) &lt;- fmap words getLine  -- IO layer\n  let div1 = read arg1                            -- pure core\n      div2 = read arg2                            --  |\n      upperBound = read arg3                      --  |\n  let results = myFizzBuzz div1 div2 upperBound   -- pure core\n  putStrLn $ lines results                        -- IO layer\n</code></pre>\n\n<p>One reason to write pure functions is that they tend to be more reusable.</p>\n\n<p>Instead of specifying an upper bound in <code>myFizzBuzz</code> what about writing it to generate an infinite series of \"Fizz\" and \"Buzz\" strings:</p>\n\n<pre><code>allFizzBuzz :: Int -&gt; Int -&gt; [String]\nallFizzBuzz div1 div2 = ...\n  -- the infinite Fizz-Buzz sequence for divisors div1, div2 starting with 1\n</code></pre>\n\n<p>Then the <code>myFizzBuzz</code> is simply the <code>take</code> function composed with <code>allFizzBuzz</code>:</p>\n\n<pre><code>myFizzBuzz div1 div2 upperBound = take upperBound (allFizzBuzz div1 div2)\n</code></pre>\n"}], "owner": {"reputation": 353, "user_id": 5220880, "user_type": "registered", "accept_rate": 80, "profile_image": "https://i.stack.imgur.com/DS5F0.png?s=128&g=1", "display_name": "Rocket Risa", "link": "https://stackoverflow.com/users/5220880/rocket-risa"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 676, "favorite_count": 0, "accepted_answer_id": 31975343, "answer_count": 1, "score": 0, "last_activity_date": 1439449792, "creation_date": 1439410131, "last_edit_date": 1439449792, "question_id": 31974442, "link": "https://stackoverflow.com/questions/31974442/multiple-input-values-with-upper-range", "title": "Multiple input values with upper range", "body": "<p>So I'm in need of a little assistance or at least a point in the right direction! I'm new to Haskell but I'm familiar with C# and PHP.</p>\n\n<p>I'm trying to create a FizzBuzz function that allows 3 parameters to be entered. I understand the general concept of FizzBuzz but I'm trying to be able to create a function that allows you to put the first divisor, second divisor and the last parameter as an upper range. The part where I'm struggling to understand is how you assign input values to variables in a function.</p>\n\n<p>I found different tutorials showing how to do the regular FizzBuzz in Haskell.</p>\n\n<p>So my main questions would be this:</p>\n\n<ol>\n<li><p>How do you assign input values to variables? I know how to assign the type, which would be something like this but I don't know how you would reference it in a function.</p>\n\n<pre><code>fz' :: [Integer, Integer, Integer] -&gt; Integer -&gt; Integer -&gt; Integer\n</code></pre></li>\n<li><p>From what I've read online, it's better to separate the functions instead of having one large function to perform everything. With that being said, would it be best to have:</p>\n\n<p>a. One function receive the input values and assign them variables, then call separate functions?</p>\n\n<p>b. In the separate functions, set the range and then do <code>divideBy</code> or <code>mod</code> to check if value <code>x</code> is divisible by <code>[1..z]</code> print fizz, if <code>x</code> and <code>y</code> are divisble by <code>[1..z]</code> print fizzbuzz, if <code>y</code> is divisible by <code>[1..z]</code> print buzz? Is it better to use a <code>where</code> clause or <code>case</code>?</p>\n\n<p>c. Separate function that implements the values for the range and <code>(x,y,z)</code>?..</p></li>\n</ol>\n\n<p>Any ideas, tips, help?</p>\n"}, {"tags": ["multithreading", "haskell", "lazy-evaluation", "ghc", "thunk"], "comments": [{"owner": {"reputation": 12426, "user_id": 570682, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/f9d9bb1af07214310ce8bd601760492a?s=128&d=identicon&r=PG", "display_name": "Lambdageek", "link": "https://stackoverflow.com/users/570682/lambdageek"}, "edited": false, "score": 6, "creation_date": 1439405372, "post_id": 31972800, "comment_id": 51853135, "body": "I don&#39;t have time to write up an answer, but here&#39;s a blog post (that I found by googling) that discusses this in some detail and points at a paper that goes into more detail.  (Though the paper is about ghc 6.10, so perhaps newer GHCs do something different now). <a href=\"http://mainisusuallyafunction.blogspot.com/2011/10/thunks-and-lazy-blackholes-introduction.html\" rel=\"nofollow noreferrer\">mainisusuallyafunction.blogspot.com/2011/10/&hellip;</a>"}, {"owner": {"reputation": 100185, "user_id": 3234959, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/93bb12ca0f93dfddb33880316f7e66c2?s=128&d=identicon&r=PG&f=1", "display_name": "chi", "link": "https://stackoverflow.com/users/3234959/chi"}, "edited": false, "score": 2, "creation_date": 1439405587, "post_id": 31972800, "comment_id": 51853243, "body": "IIRC, they are not atomic, and might be evaluated twice, but the probability of having a duplication due to a race condition is very low. Even if they are evaluated twice, purity makes that safe. I read about this a long time ago but I forgot where... :-/"}, {"owner": {"reputation": 17809, "user_id": 1088108, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/63781cd38e91aa346a3849bc3ef3e550?s=128&d=identicon&r=PG&f=1", "display_name": "&#216;rjan Johansen", "link": "https://stackoverflow.com/users/1088108/%c3%98rjan-johansen"}, "reply_to_user": {"reputation": 12426, "user_id": 570682, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/f9d9bb1af07214310ce8bd601760492a?s=128&d=identicon&r=PG", "display_name": "Lambdageek", "link": "https://stackoverflow.com/users/570682/lambdageek"}, "edited": false, "score": 1, "creation_date": 1439407162, "post_id": 31972800, "comment_id": 51854089, "body": "@Lambdageek That blog post is pretty nice, although confusingly, I think its one use of the word &quot;eager&quot; is almost the exact opposite of GHC terminology."}], "answers": [{"tags": [], "owner": {"reputation": 75362, "user_id": 625403, "user_type": "registered", "accept_rate": 82, "profile_image": "https://www.gravatar.com/avatar/786eed7da67079cb5d63a49d469af25b?s=128&d=identicon&r=PG", "display_name": "amalloy", "link": "https://stackoverflow.com/users/625403/amalloy"}, "is_accepted": false, "score": 22, "last_activity_date": 1439493714, "last_edit_date": 1439493714, "creation_date": 1439408416, "answer_id": 31973991, "question_id": 31972800, "link": "https://stackoverflow.com/questions/31972800/how-atomic-are-ghcs-thunks/31973991#31973991", "title": "How atomic are GHC&#39;s thunks?", "body": "<p>To summarize the article linked to in the comments: the thunks in GHC are not strictly atomic between multiple threads: it is possible in a race condition for multiple threads to evaluate the same thunk, duplicating work. But, this is not a big deal in practice because:</p>\n\n<ol>\n<li>Guaranteed purity means it never matters whether a thunk is evaluated twice, in terms of program semantics. <code>unsafePerformIO</code> is a case where that might be an issue, but it turns out that <code>unsafePerformIO</code> is careful to avoid re-running the same IO action.</li>\n<li><p>Because all values are thunks, most thunks turn out to be quite small, so occasionally duplicating the work to force one is not a big deal in terms of program speed. You might imagine that it's expensive to duplicate, for example, <code>last [1,2..10000000]</code> because that whole computation is expensive. But of course really the outermost thunk just resolves to another thunk, something like:</p>\n\n<pre><code>case [1,2..10000000] of \n  [x] -&gt; x\n  (_:xs) -&gt; last xs\n  [] -&gt; error \"empty list\"\n</code></pre>\n\n<p>and if two threads duplicate the work to turn the call to <code>last</code> into a use of <code>case</code>, that's pretty cheap in the grand scheme of things.</p></li>\n</ol>\n"}, {"tags": [], "owner": {"reputation": 13626, "user_id": 492865, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/5c69a2080e68c8606961a18aba3a08ec?s=128&d=identicon&r=PG", "display_name": "Yuras", "link": "https://stackoverflow.com/users/492865/yuras"}, "is_accepted": false, "score": 13, "last_activity_date": 1439408634, "creation_date": 1439408634, "answer_id": 31974054, "question_id": 31972800, "link": "https://stackoverflow.com/questions/31972800/how-atomic-are-ghcs-thunks/31974054#31974054", "title": "How atomic are GHC&#39;s thunks?", "body": "<p>Yes, sometimes the same thunk can be evaluated by multiple threads. GHC runtime tries to minimize the probability of duplicated work, so in practice it is rare. Please see <a href=\"http://research.microsoft.com/pubs/67424/2005-haskell.pdf\" rel=\"noreferrer\">\"Haskell on a Shared-Memory Multiprocessor\"</a> paper for low level details, mostly the \"Lock-free thunk evaluation\" section. (I'd recommend the paper for every professional haskell developer btw.)</p>\n"}, {"tags": [], "owner": {"reputation": 17809, "user_id": 1088108, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/63781cd38e91aa346a3849bc3ef3e550?s=128&d=identicon&r=PG&f=1", "display_name": "&#216;rjan Johansen", "link": "https://stackoverflow.com/users/1088108/%c3%98rjan-johansen"}, "is_accepted": true, "score": 44, "last_activity_date": 1439450887, "last_edit_date": 1439450887, "creation_date": 1439408922, "answer_id": 31974133, "question_id": 31972800, "link": "https://stackoverflow.com/questions/31972800/how-atomic-are-ghcs-thunks/31974133#31974133", "title": "How atomic are GHC&#39;s thunks?", "body": "<p>From <a href=\"http://mainisusuallyafunction.blogspot.com/2011/10/thunks-and-lazy-blackholes-introduction.html\" rel=\"noreferrer\">the blog post</a> @Lambdageek linked, the <a href=\"https://ghc.haskell.org/trac/ghc/wiki/Commentary/Rts/Storage/HeapObjects#Blackholes\" rel=\"noreferrer\">GHC Commentary</a> and the <a href=\"https://downloads.haskell.org/~ghc/7.10.2/docs/html/users_guide/using-smp.html#parallel-compile-options\" rel=\"noreferrer\">GHC User's Guide</a> I piece together the following:</p>\n\n<p>GHC tries to prevent reevaluating thunks, but because true locking between threads is expensive, and thunks are usually pure and so harmless to reevaluate, it normally does so in a sloppy manner, with a <em>small</em> chance of duplicating work anyhow.</p>\n\n<p>The method it uses for avoiding work is to replace thunks by a <em>blackhole</em>, a special marker that tells other threads (or sometimes, the thread itself; that's how <code>&lt;&lt;loop&gt;&gt;</code> detection happens) that the thunk is being evaluated.</p>\n\n<p>Given this, there are at least three options:</p>\n\n<ul>\n<li><p>By default, it uses \"lazy blackholing\", where this is only done before the thread is about to pause.  It then \"walks\" its stack and creates \"true\" blackholes for new thunks, using locking to ensure each thunk only gets one thread blackholing it, and aborting its own evaluation if it discovers another thread has already blackholed a thunk.  This is cheaper as it doesn't need to consider thunks whose evaluation time is so short that it fits completely between two pauses.</p></li>\n<li><p>With the <a href=\"https://downloads.haskell.org/~ghc/latest/docs/html/users_guide/using-smp.html#parallel-compile-options\" rel=\"noreferrer\"><code>-feager-blackholing-flag</code></a>, blackholes are instead created as soon as a thunk starts evaluating, and the User's Guide recommends this if you are doing a lot of parallelism. However, because locking on every thunk would be too expensive, these blackholes are cheaper \"eager\" ones, which are not synchronized with other threads (although other threads can still see them if there's not a race condition). Only when the thread pauses do these get turned into \"true\" blackholes.</p></li>\n<li><p>A third case, which the blog post was particularly about, is used for special functions like <code>unsafePerformIO</code>, for which it's <em>harmful</em> to evaluate a thunk more than once. In this case, the thread uses a \"true\" blackhole with real locking, but creates it immediately, by inserting an artificial thread pause before the real evaluation.</p></li>\n</ul>\n"}], "owner": {"reputation": 60057, "user_id": 1333025, "user_type": "registered", "accept_rate": 65, "profile_image": "https://www.gravatar.com/avatar/79ab43010f900324ac5e2de19a2916cb?s=128&d=identicon&r=PG", "display_name": "Petr", "link": "https://stackoverflow.com/users/1333025/petr"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 2778, "favorite_count": 15, "accepted_answer_id": 31974133, "answer_count": 3, "score": 48, "last_activity_date": 1439580955, "creation_date": 1439404201, "last_edit_date": 1439405033, "question_id": 31972800, "link": "https://stackoverflow.com/questions/31972800/how-atomic-are-ghcs-thunks", "title": "How atomic are GHC&#39;s thunks?", "body": "<p>How does GHC handle thunks that are accessed by multiple threads (either explicit threads, or the internal ones that evaluate sparks)? Can it happen that multiple threads evaluate the same thunk, duplicating work? Or, if thunks are synchronized, how, so that performance doesn't suffer?</p>\n"}, {"tags": ["haskell", "cabal", "ghci"], "comments": [{"owner": {"reputation": 6262, "user_id": 691032, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/04fa8b0cca5a7dfef2d281be67a2b7a2?s=128&d=identicon&r=PG", "display_name": "sinan", "link": "https://stackoverflow.com/users/691032/sinan"}, "edited": false, "score": 2, "creation_date": 1439401679, "post_id": 31967292, "comment_id": 51851100, "body": "This behavior isn&#39;t changed with 7.10, are you sure you&#39;re not having any errors while loading? In that case you may not have imports available."}, {"owner": {"reputation": 17809, "user_id": 1088108, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/63781cd38e91aa346a3849bc3ef3e550?s=128&d=identicon&r=PG&f=1", "display_name": "&#216;rjan Johansen", "link": "https://stackoverflow.com/users/1088108/%c3%98rjan-johansen"}, "edited": false, "score": 1, "creation_date": 1439410091, "post_id": 31967292, "comment_id": 51855600, "body": "The behavior you want only happens for <i>interpreted</i> modules. If a loaded module is compiled, you only get access to what it exports. To quote <a href=\"https://downloads.haskell.org/~ghc/7.10.2/docs/html/users_guide/interactive-evaluation.html#ghci-load-scope\" rel=\"nofollow noreferrer\">the User&#39;s Guide</a>: &quot;To ensure that GHCi loads the interpreted version of a module, add the <code>*</code> when loading the module, e.g. <code>:load *M</code>.&quot;"}, {"owner": {"reputation": 17809, "user_id": 1088108, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/63781cd38e91aa346a3849bc3ef3e550?s=128&d=identicon&r=PG&f=1", "display_name": "&#216;rjan Johansen", "link": "https://stackoverflow.com/users/1088108/%c3%98rjan-johansen"}, "edited": false, "score": 0, "creation_date": 1439410251, "post_id": 31967292, "comment_id": 51855658, "body": "If it was errors, then to reduce the annoyingness of (at least type) errors while loading, I recommend the <code>-fdefer-type-errors</code> option."}, {"owner": {"reputation": 6568, "user_id": 383508, "user_type": "registered", "accept_rate": 82, "profile_image": "https://www.gravatar.com/avatar/d9d61149baeb9e5c9d1432b220e49cd0?s=128&d=identicon&r=PG", "display_name": "fho", "link": "https://stackoverflow.com/users/383508/fho"}, "reply_to_user": {"reputation": 17809, "user_id": 1088108, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/63781cd38e91aa346a3849bc3ef3e550?s=128&d=identicon&r=PG&f=1", "display_name": "&#216;rjan Johansen", "link": "https://stackoverflow.com/users/1088108/%c3%98rjan-johansen"}, "edited": false, "score": 0, "creation_date": 1439411601, "post_id": 31967292, "comment_id": 51856366, "body": "@&#216;rjanJohansen I actually have compiled the modules. Loading with the <code>*</code> solves this problem. If you just write that down as an answer I&#39;ll accept it."}], "answers": [{"tags": [], "owner": {"reputation": 17809, "user_id": 1088108, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/63781cd38e91aa346a3849bc3ef3e550?s=128&d=identicon&r=PG&f=1", "display_name": "&#216;rjan Johansen", "link": "https://stackoverflow.com/users/1088108/%c3%98rjan-johansen"}, "is_accepted": true, "score": 2, "last_activity_date": 1439414472, "last_edit_date": 1592644375, "creation_date": 1439414472, "answer_id": 31975633, "question_id": 31967292, "link": "https://stackoverflow.com/questions/31967292/how-to-load-imports-automatically-in-cabal-repl/31975633#31975633", "title": "How to load imports automatically in cabal repl?", "body": "<p>From the <a href=\"https://downloads.haskell.org/%7Eghc/7.10.2/docs/html/users_guide/interactive-evaluation.html#ghci-load-scope\" rel=\"nofollow noreferrer\">GHC User's Guide</a>:</p>\n<blockquote>\n<p>The syntax in the prompt <code>*module</code> indicates that it is the full top-level scope of module that is contributing to the scope for expressions typed at the prompt. Without the <code>*</code>, just the exports of the module are visible.</p>\n<p>NOTE: for technical reasons, GHCi can only support the <code>*</code>-form for modules that are interpreted. Compiled modules and package modules can only contribute their exports to the current scope. To ensure that GHCi loads the interpreted version of a module, add the <code>*</code> when loading the module, e.g. <code>:load *M</code>.</p>\n</blockquote>\n<p>In other words, add a <code>*</code> before the module name when loading.</p>\n"}], "owner": {"reputation": 6568, "user_id": 383508, "user_type": "registered", "accept_rate": 82, "profile_image": "https://www.gravatar.com/avatar/d9d61149baeb9e5c9d1432b220e49cd0?s=128&d=identicon&r=PG", "display_name": "fho", "link": "https://stackoverflow.com/users/383508/fho"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 694, "favorite_count": 1, "accepted_answer_id": 31975633, "answer_count": 1, "score": 2, "last_activity_date": 1439414472, "creation_date": 1439387687, "last_edit_date": 1439411668, "question_id": 31967292, "link": "https://stackoverflow.com/questions/31967292/how-to-load-imports-automatically-in-cabal-repl", "title": "How to load imports automatically in cabal repl?", "body": "<p>I am under the impression that until recently <code>cabal repl</code> automatically imported all the imports from the currently loaded file. That is if I had a file <code>src/Main.hs</code>:</p>\n\n<pre><code>module Main where\n\nimport qualified Data.Vector as V\n\nmain = putStrLn \"foo\"\n</code></pre>\n\n<p>And I would load it in <code>cabal repl</code> with <code>:l src/Main.hs</code>, <code>V</code> would be available without any further work.</p>\n\n<p>I believe this behavior changed during the change to ghc/ghci <code>7.10</code>, but I am not sure. Is there any option that would let me change that back to the way it was before?</p>\n\n<p><strong>edit:</strong> As it happens I have actually compiled the modules, which was part of the problem. See <em>\u00d8rjan Johansens</em> comment below.</p>\n"}, {"tags": ["haskell", "record"], "answers": [{"comments": [{"owner": {"reputation": 51584, "user_id": 839246, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/9b0573c2b936b12828dd1e4cc04206dc?s=128&d=identicon&r=PG&f=1", "display_name": "bheklilr", "link": "https://stackoverflow.com/users/839246/bheklilr"}, "edited": false, "score": 3, "creation_date": 1439384626, "post_id": 31965959, "comment_id": 51839171, "body": "To add on to this, <a href=\"https://wiki.haskell.org/Smart_constructors\" rel=\"nofollow noreferrer\">&quot;smart constructors&quot;</a> (this style of construction) are always the best way to go here.  You can have as many as you like with whatever arguments you like, have some exported from the module and some not, and if your type is polymorphic you have the option to have a different constructor for each more specific type you want to handle."}, {"owner": {"reputation": 11693, "user_id": 858962, "user_type": "registered", "accept_rate": 57, "profile_image": "https://www.gravatar.com/avatar/5f16ec0395b1710fd529b01602de66ca?s=128&d=identicon&r=PG", "display_name": "dopatraman", "link": "https://stackoverflow.com/users/858962/dopatraman"}, "edited": false, "score": 0, "creation_date": 1439391278, "post_id": 31965959, "comment_id": 51844601, "body": "Very nice. But what do you mean &quot;rather than use the <code>Default</code> class&quot;? To define <code>defaultCar</code> I&#39;d need to use this <code>Default</code> construct right?"}, {"owner": {"reputation": 1521, "user_id": 365807, "user_type": "registered", "accept_rate": 56, "profile_image": "https://www.gravatar.com/avatar/8c9db2824164d60fe55d2b0c1c361f20?s=128&d=identicon&r=PG", "display_name": "Fraser", "link": "https://stackoverflow.com/users/365807/fraser"}, "edited": false, "score": 0, "creation_date": 1439393445, "post_id": 31965959, "comment_id": 51846111, "body": "no, you can just define a normal value <code>defaultCar</code> and then modify that when you need a non-standard car.  also, if you want to use <code>Default</code>, then you should just use the <code>data-default-class</code> package, since its a little more lightweight"}, {"owner": {"reputation": 11693, "user_id": 858962, "user_type": "registered", "accept_rate": 57, "profile_image": "https://www.gravatar.com/avatar/5f16ec0395b1710fd529b01602de66ca?s=128&d=identicon&r=PG", "display_name": "dopatraman", "link": "https://stackoverflow.com/users/858962/dopatraman"}, "edited": false, "score": 0, "creation_date": 1439399331, "post_id": 31965959, "comment_id": 51849755, "body": "I understand this <code>defaultCar</code> to be something like <code>let defaultCar c y = Car {company = Just c, year = Just y}</code> but this produces the same problems i outlines above."}, {"owner": {"reputation": 126897, "user_id": 791604, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/ce991df7a056248d5e4f6fc3659ba733?s=128&d=identicon&r=PG", "display_name": "Daniel Wagner", "link": "https://stackoverflow.com/users/791604/daniel-wagner"}, "reply_to_user": {"reputation": 11693, "user_id": 858962, "user_type": "registered", "accept_rate": 57, "profile_image": "https://www.gravatar.com/avatar/5f16ec0395b1710fd529b01602de66ca?s=128&d=identicon&r=PG", "display_name": "dopatraman", "link": "https://stackoverflow.com/users/858962/dopatraman"}, "edited": false, "score": 3, "creation_date": 1439409421, "post_id": 31965959, "comment_id": 51855266, "body": "@dopatraman Nah, just write <code>defaultCar = Car Nothing Nothing</code>. Then <code>ford = defaultCar { company = Just &quot;Ford&quot; }</code> works just as in the answer, but with the name <code>defaultCar</code> instead of <code>def</code>."}, {"owner": {"reputation": 11693, "user_id": 858962, "user_type": "registered", "accept_rate": 57, "profile_image": "https://www.gravatar.com/avatar/5f16ec0395b1710fd529b01602de66ca?s=128&d=identicon&r=PG", "display_name": "dopatraman", "link": "https://stackoverflow.com/users/858962/dopatraman"}, "edited": false, "score": 0, "creation_date": 1439414310, "post_id": 31965959, "comment_id": 51857802, "body": "So if i understand right, <code>def = Car Nothing Nothing</code> is still accepting arguments in a particular order right? what if i wanted to make a <code>car1988</code> function, that outputs the year as 1988 for all inputs?"}, {"owner": {"reputation": 14485, "user_id": 190376, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/cd8280c5e1491b8cf55760750ed97dec?s=128&d=identicon&r=PG", "display_name": "Reid Barton", "link": "https://stackoverflow.com/users/190376/reid-barton"}, "reply_to_user": {"reputation": 11693, "user_id": 858962, "user_type": "registered", "accept_rate": 57, "profile_image": "https://www.gravatar.com/avatar/5f16ec0395b1710fd529b01602de66ca?s=128&d=identicon&r=PG", "display_name": "dopatraman", "link": "https://stackoverflow.com/users/858962/dopatraman"}, "edited": false, "score": 0, "creation_date": 1439414790, "post_id": 31965959, "comment_id": 51858045, "body": "@dopatraman, you should probably start by reading up on Haskell record update syntax."}, {"owner": {"reputation": 11693, "user_id": 858962, "user_type": "registered", "accept_rate": 57, "profile_image": "https://www.gravatar.com/avatar/5f16ec0395b1710fd529b01602de66ca?s=128&d=identicon&r=PG", "display_name": "dopatraman", "link": "https://stackoverflow.com/users/858962/dopatraman"}, "reply_to_user": {"reputation": 14485, "user_id": 190376, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/cd8280c5e1491b8cf55760750ed97dec?s=128&d=identicon&r=PG", "display_name": "Reid Barton", "link": "https://stackoverflow.com/users/190376/reid-barton"}, "edited": false, "score": 0, "creation_date": 1439478483, "post_id": 31965959, "comment_id": 51888344, "body": "@ReidBarton do you have a link apart from the Haskell wiki?"}], "tags": [], "owner": {"reputation": 100892, "user_id": 745903, "user_type": "registered", "accept_rate": 74, "profile_image": "https://www.gravatar.com/avatar/50933f6638836741e620669b3940410e?s=128&d=identicon&r=PG", "display_name": "leftaroundabout", "link": "https://stackoverflow.com/users/745903/leftaroundabout"}, "is_accepted": true, "score": 15, "last_activity_date": 1439385193, "last_edit_date": 1439385193, "creation_date": 1439384292, "answer_id": 31965959, "question_id": 31965666, "link": "https://stackoverflow.com/questions/31965666/how-do-i-set-default-values-in-a-record/31965959#31965959", "title": "How do I set default values in a record", "body": "<p>That's the kind of thing Haskell <a href=\"http://hackage.haskell.org/package/data-default-0.5.3/docs/Data-Default.html\">prefers to handle in a library</a>, rather than hacking up some hard-wired language support (which would probably cause all kinds of problems, just like it does in C++).</p>\n\n<pre><code>import Data.Default\n\ninstance Default Car where\n  def = Car Nothing Nothing\n          -- or whatever you want as the defaults\n\nford :: Car\nford = def { company = Just \"Ford\" }\n</code></pre>\n\n<blockquote>\n  <p>GHCi> ford<br>\n  Car {company = Just \"Ford\", year = Nothing}</p>\n</blockquote>\n\n<p>Rather than using the <code>Default</code> class you can also just define a <code>defaultCar</code>.</p>\n\n<p>You may need to use cabal to install <code>data-default</code>, if it's not installed in your system already.</p>\n"}, {"tags": [], "owner": {"reputation": 33, "user_id": 9282443, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/ec27afd669197cacddfe1852f7684bd5?s=128&d=identicon&r=PG&f=1", "display_name": "MyLifeisPi", "link": "https://stackoverflow.com/users/9282443/mylifeispi"}, "is_accepted": false, "score": 0, "last_activity_date": 1553281927, "creation_date": 1553281927, "answer_id": 55306382, "question_id": 31965666, "link": "https://stackoverflow.com/questions/31965666/how-do-i-set-default-values-in-a-record/55306382#55306382", "title": "How do I set default values in a record", "body": "<p>I would use a slightly verbose method while utilising Data.Text.</p>\n\n<pre><code>{-#Language OverloadedString#-}\n\nimport Data.Text as T\n\ndata Car c y = Car {\n    company :: Text \n    year :: Double\n    }\n\ntoCar :: [T.Text] -&gt; Car\ntoCar inp = case inp of \n              [] -&gt; fail \"Give me an input\"\n              [v:h] -&gt; Car { company = justifyRight 1 \"Ford\" h \n                           , year = read $ T.unpack $ last inp\n                           }\n\n</code></pre>\n\n<p>This will take in inputs such as <code>inp [\"8\"]</code> and <code>inp [\"Ashburn\", \"8\"]</code> </p>\n"}], "owner": {"reputation": 11693, "user_id": 858962, "user_type": "registered", "accept_rate": 57, "profile_image": "https://www.gravatar.com/avatar/5f16ec0395b1710fd529b01602de66ca?s=128&d=identicon&r=PG", "display_name": "dopatraman", "link": "https://stackoverflow.com/users/858962/dopatraman"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 2427, "favorite_count": 0, "accepted_answer_id": 31965959, "answer_count": 2, "score": 10, "last_activity_date": 1553281927, "creation_date": 1439383579, "question_id": 31965666, "link": "https://stackoverflow.com/questions/31965666/how-do-i-set-default-values-in-a-record", "title": "How do I set default values in a record", "body": "<p>I'm trying to set default values in a record object that can be overwritten.</p>\n\n<pre><code>data Car c y = Car {\n    company :: c,\n    year :: y\n    }\n</code></pre>\n\n<p>What I'd like to do is set a default:</p>\n\n<pre><code>data Car c y = Car {\n    company :: c -- OR \"Ford\"\n    year :: y\n    }\n</code></pre>\n\n<p>So far I've tried doing this by setting the type of c to a <code>Maybe</code> type:</p>\n\n<pre><code>data Car = Car {\n    company:: Maybe String\n    year :: Maybe Int\n    }\n</code></pre>\n\n<p>However I get this predictable error:</p>\n\n<pre><code>Fields of `Car' not initialised: year\n</code></pre>\n\n<p>Ironically, this is exactly the thing I'm trying to get around. I want to produce a new record that has the values I'm not setting already initialized. One way I've found is to partially apply the <code>Car</code> type:</p>\n\n<pre><code>data Car c y = {\n    company :: c,\n    year :: y\n    }\n\nlet ford = Car \"Ford\" \n\n-- This produces a function (y -&gt; Car [Char] y)\n</code></pre>\n\n<p>However this produces 2 new problems:</p>\n\n<ol>\n<li><p>In the event my data type has 100+ field types, I'll end up with 100 factorial curried functions</p></li>\n<li><p>The partially applied functions I can create are dependent on the order of variables in the declaration. You'll notice that I cant produce a <code>car1988</code> function, for example.</p></li>\n</ol>\n\n<p>How can I write a function that allows me to create records with default values? Please help.</p>\n"}, {"tags": ["haskell", "twitter", "ghc"], "comments": [{"owner": {"reputation": 18999, "user_id": 825637, "user_type": "registered", "accept_rate": 85, "profile_image": "https://www.gravatar.com/avatar/825a58fde1ef99db42c5354dab6cd472?s=128&d=identicon&r=PG", "display_name": "MasterMastic", "link": "https://stackoverflow.com/users/825637/mastermastic"}, "edited": false, "score": 1, "creation_date": 1439383205, "post_id": 31965349, "comment_id": 51837959, "body": "I don&#39;t know if you care that much but you could make a preprocessor. Afaik GHC has a flag to run a custom preprocessor of your choosing."}, {"owner": {"reputation": 58792, "user_id": 1006010, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/f683d229f3673c9dcc3f3f2796d75c09?s=128&d=identicon&r=PG", "display_name": "MathematicalOrchid", "link": "https://stackoverflow.com/users/1006010/mathematicalorchid"}, "edited": false, "score": 1, "creation_date": 1439453954, "post_id": 31965349, "comment_id": 51871174, "body": "AFAIK, Unicode Syntax allows you to replace <code>-&gt;</code> with <code>\u2192</code>, and so on. It is <i>not</i> required just to use Unicode characters in your source code. <a href=\"https://downloads.haskell.org/~ghc/latest/docs/html/users_guide/syntax-extns.html#unicode-syntax\" rel=\"nofollow noreferrer\">downloads.haskell.org/~ghc/latest/docs/html/users_guide/&hellip;</a>"}], "answers": [{"comments": [{"owner": {"reputation": 11986, "user_id": 3237465, "user_type": "registered", "accept_rate": 76, "profile_image": "https://i.stack.imgur.com/vOArX.png?s=128&g=1", "display_name": "user3237465", "link": "https://stackoverflow.com/users/3237465/user3237465"}, "edited": false, "score": 1, "creation_date": 1439431423, "post_id": 31966283, "comment_id": 51862494, "body": "Operators don&#39;t have to be infix, so this is legal: <code>(\ud83d\ude4f) [] = Nothing; (\ud83d\ude4f) ((\ud83d\udc7d):as) = Just (\ud83d\udc7d); main = print $ (\ud83d\ude4f) &quot;a&quot;</code>."}, {"owner": {"reputation": 24266, "user_id": 946226, "user_type": "registered", "accept_rate": 59, "profile_image": "https://www.gravatar.com/avatar/5823d09208b1e4b63bbfcd189492032c?s=128&d=identicon&r=PG", "display_name": "Joachim Breitner", "link": "https://stackoverflow.com/users/946226/joachim-breitner"}, "reply_to_user": {"reputation": 11986, "user_id": 3237465, "user_type": "registered", "accept_rate": 76, "profile_image": "https://i.stack.imgur.com/vOArX.png?s=128&g=1", "display_name": "user3237465", "link": "https://stackoverflow.com/users/3237465/user3237465"}, "edited": false, "score": 0, "creation_date": 1439451131, "post_id": 31966283, "comment_id": 51869552, "body": "Thanks. I wrongly assumed that <code>(\ud83d\ude4f)</code> would force it to have a function type accepting two arguments, but that is only the case for operator sections, it seems. Bug <a href=\"https://ghc.haskell.org/trac/ghc/ticket/10772\" rel=\"nofollow noreferrer\">#10772</a> filed about the it not working on the type level."}, {"owner": {"reputation": 2221, "user_id": 448591, "user_type": "registered", "accept_rate": 93, "profile_image": "https://www.gravatar.com/avatar/5520f21f2e367d78c29d08d3b30b954f?s=128&d=identicon&r=PG", "display_name": "Jakob Runge", "link": "https://stackoverflow.com/users/448591/jakob-runge"}, "edited": false, "score": 0, "creation_date": 1439455811, "post_id": 31966283, "comment_id": 51872331, "body": "Ah, very cool to see the update after the hint from user3237465 :)"}], "tags": [], "owner": {"reputation": 24266, "user_id": 946226, "user_type": "registered", "accept_rate": 59, "profile_image": "https://www.gravatar.com/avatar/5823d09208b1e4b63bbfcd189492032c?s=128&d=identicon&r=PG", "display_name": "Joachim Breitner", "link": "https://stackoverflow.com/users/946226/joachim-breitner"}, "is_accepted": true, "score": 40, "last_activity_date": 1491579215, "last_edit_date": 1491579215, "creation_date": 1439385075, "answer_id": 31966283, "question_id": 31965349, "link": "https://stackoverflow.com/questions/31965349/using-emoji-in-haskell/31966283#31966283", "title": "Using Emoji in Haskell", "body": "<p>That code is not valid haskell. The reason is that \ud83d\ude4f (like, probably, all Emojis) is a symbol character:</p>\n\n<pre><code>Prelude&gt; import Data.Char\nPrelude Data.Char&gt; generalCategory '\ud83d\ude4f'\nOtherSymbol\n</code></pre>\n\n<p>But you can still use them like any other symbol, namely as an operator:</p>\n\n<pre><code>Prelude Data.Char&gt; let (\ud83d\ude4f) = (+)\nPrelude Data.Char&gt; 32 \ud83d\ude4f 42\n74\n</code></pre>\n\n<p>Furthermore, as user3237465 pointed out, if you use the prefix syntax for operators, i.e. put it in parentheses, you can even use it like any other symbol:</p>\n\n<pre><code>(\ud83d\ude4f) :: [a] -&gt; Maybe a\n(\ud83d\ude4f) [] = Nothing\n(\ud83d\ude4f) ((\ud83d\udc7d):as) = Just (\ud83d\udc7d)\n\nmain = print $ (\ud83d\ude4f) \"\u2665\"\n</code></pre>\n\n<p>This is almost the example in the original post. Unfortunately, this trick does not work for the type variable. The <a href=\"https://downloads.haskell.org/~ghc/7.8.4/docs/html/users_guide/data-type-extensions.html#infix-tycons\" rel=\"noreferrer\">the documentation</a> is worded a bit unfortunately, but <a href=\"http://ghc.haskell.org/trac/ghc/ticket/10772#comment:2\" rel=\"noreferrer\">in fact</a> symbols are never type variables and always type constructors</p>\n"}], "owner": {"reputation": 2221, "user_id": 448591, "user_type": "registered", "accept_rate": 93, "profile_image": "https://www.gravatar.com/avatar/5520f21f2e367d78c29d08d3b30b954f?s=128&d=identicon&r=PG", "display_name": "Jakob Runge", "link": "https://stackoverflow.com/users/448591/jakob-runge"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 2512, "favorite_count": 4, "accepted_answer_id": 31966283, "answer_count": 1, "score": 29, "last_activity_date": 1491579215, "creation_date": 1439382744, "question_id": 31965349, "link": "https://stackoverflow.com/questions/31965349/using-emoji-in-haskell", "title": "Using Emoji in Haskell", "body": "<p>I've recently come across a bot on Twitter named <a href=\"https://twitter.com/EmojiHaskell\">EmojiHaskell</a>, that claims to tweet 'interpretable Haskell code with emoji variable names'. A particular <a href=\"https://twitter.com/EmojiHaskell/status/631416105307869184\">Tweet</a> caught my attention, as it looked like malformed syntax to me, so I decided to take a closer look. So far I've produced the following code:</p>\n\n<pre><code>module Main where\n\n\ud83d\ude4f :: [\ud83c\udf73] -&gt; Maybe \ud83c\udf73\n\ud83d\ude4f [] = Nothing\n\ud83d\ude4f (\ud83d\udc7d:as) = Just \ud83d\udc7d\n\nmain = print $ \ud83d\ude4f \"\u2665\"\n</code></pre>\n\n<p>Since I've used <code>\u03bb</code> on occasion in my Haskell code, I expected this code to work, but it appears that GHC doesn't like the emoji at all.</p>\n\n<p>With <code>$ runhaskell Main.hs</code> I get:</p>\n\n<blockquote>\n  <p>Main.hs:4:1: parse error on input \u2018\ud83d\ude4f\u2019</p>\n</blockquote>\n\n<p>I've already had a look at the <a href=\"https://wiki.haskell.org/Unicode-symbols\">UnicodeSyntax</a> extension,\nand tried to only use some or single emoji instead of all of them to see if a certain one provokes the problem.</p>\n\n<p>Now my question is this:\nIs there currently a Haskell compiler that would accept the code?\nCan I get GHC to work with this code somehow?</p>\n"}, {"tags": ["rest", "haskell", "monads", "state-monad", "haskell-spock"], "comments": [{"owner": {"reputation": 25144, "user_id": 477476, "user_type": "registered", "accept_rate": 85, "profile_image": "https://i.stack.imgur.com/Qf4TT.png?s=128&g=1", "display_name": "Cactus", "link": "https://stackoverflow.com/users/477476/cactus"}, "edited": false, "score": 1, "creation_date": 1439350962, "post_id": 31952792, "comment_id": 51820129, "body": "The key to this puzzle is the first argument of <code>spockT</code>, which you will need to provide for <code>m ~ State String</code>. However, you will run into the exact same issue as explained <a href=\"http://stackoverflow.com/a/27496393/477476\">in this answer</a>: the <code>State String</code> will not be automagically persisted between handler invocations."}], "answers": [{"comments": [{"owner": {"reputation": 970, "user_id": 4218, "user_type": "registered", "accept_rate": 88, "profile_image": "https://www.gravatar.com/avatar/c57a8beddd9caf96bea57786f151928a?s=128&d=identicon&r=PG", "display_name": "ReaperUnreal", "link": "https://stackoverflow.com/users/4218/reaperunreal"}, "edited": false, "score": 0, "creation_date": 1439386633, "post_id": 31958855, "comment_id": 51840805, "body": "Normally I would just use a DB, but this was just to try out. Thank you for the information, now I&#39;ve got a bunch of things to learn."}], "tags": [], "owner": {"reputation": 25144, "user_id": 477476, "user_type": "registered", "accept_rate": 85, "profile_image": "https://i.stack.imgur.com/Qf4TT.png?s=128&g=1", "display_name": "Cactus", "link": "https://stackoverflow.com/users/477476/cactus"}, "is_accepted": true, "score": 2, "last_activity_date": 1439364986, "last_edit_date": 1495542583, "creation_date": 1439364986, "answer_id": 31958855, "question_id": 31952792, "link": "https://stackoverflow.com/questions/31952792/how-do-i-use-a-persistent-state-monad-with-spock/31958855#31958855", "title": "How do I use a persistent State monad with Spock?", "body": "<p>OK so here's a version of the <a href=\"https://stackoverflow.com/a/27496393/477476\"><code>restartableStateT</code></a> hack for your example:</p>\n\n<pre><code>{-# LANGUAGE OverloadedStrings #-}\n{-# LANGUAGE Rank2Types #-}\nmodule Main where\n\nimport Data.Monoid\nimport Data.String (fromString)\nimport Web.Spock.Safe\nimport qualified Control.Monad.State as S\nimport Data.IORef\n\nstoreData :: (Monad m) =&gt; String -&gt; S.StateT String m String\nstoreData val = do S.put val\n                   return val\n\ngetData :: (Monad m) =&gt; S.StateT String m String\ngetData = do val &lt;- S.get\n             return val\n\nnewtype RunStateT s m = RunStateT{ runStateT :: forall a. S.StateT s m a -&gt; m a }\n\nrestartableStateT :: s -&gt; IO (RunStateT s IO)\nrestartableStateT s0 = do\n    r &lt;- newIORef s0\n    return $ RunStateT $ \\act -&gt; do\n        s &lt;- readIORef r\n        (x, s') &lt;- S.runStateT act s\n        atomicModifyIORef' r $ const (s', x)\n\nmain :: IO ()\nmain = do\n    runner &lt;- restartableStateT \"initial state\"\n    runSpock 11350 $ spockT (runStateT runner) $ do\n        get \"store\" $ do\n            cmd &lt;- param \"value\"\n            case cmd of\n                Nothing -&gt; do\n                    old &lt;- S.lift getData\n                    text $ fromString old\n                Just new -&gt; do\n                    S.lift $ storeData new\n                    text \"Stored.\"\n</code></pre>\n\n<p>Like the other answer, this one creates a single global <code>IORef</code> to store \"the state\". The <code>runner</code> passed to <code>spockT</code> is then able to run any <code>StateT String IO</code> computation by getting the state from this <code>IORef</code>, running the computation, and putting the resulting state back into the <code>IORef</code>. </p>\n\n<p>I would like to reiterate from the other answer that this is not necessarily a good idea, because it has no story for concurrency. I guess that could be papered over by using STM for example, but... I think you should just use a database for this kind of thing.</p>\n"}], "owner": {"reputation": 970, "user_id": 4218, "user_type": "registered", "accept_rate": 88, "profile_image": "https://www.gravatar.com/avatar/c57a8beddd9caf96bea57786f151928a?s=128&d=identicon&r=PG", "display_name": "ReaperUnreal", "link": "https://stackoverflow.com/users/4218/reaperunreal"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 464, "favorite_count": 0, "accepted_answer_id": 31958855, "answer_count": 1, "score": 1, "last_activity_date": 1439692546, "creation_date": 1439330797, "last_edit_date": 1439692546, "question_id": 31952792, "link": "https://stackoverflow.com/questions/31952792/how-do-i-use-a-persistent-state-monad-with-spock", "title": "How do I use a persistent State monad with Spock?", "body": "<p>I'm just starting out with haskell and I'm having issues with a basic \"echo\" REST server.</p>\n\n<p>Spock looked like a nice starting place for a REST server, and I though I got the basics of the State monad, but I'm having issues understanding how to put a <code>runState</code> around the spock code.</p>\n\n<p>Here's the code I've got so far.</p>\n\n<pre class=\"lang-hs prettyprint-override\"><code>{-# LANGUAGE OverloadedStrings #-}\nmodule Main where\n\nimport Data.Monoid\nimport Web.Spock.Safe\nimport qualified Control.Monad.State as S\n\nstoreData :: String -&gt; S.State String String\nstoreData val = do S.put val\n                   return val\n\ngetData :: S.State String String\ngetData = do val &lt;- S.get\n             return val\n\nmain :: IO ()\nmain =\n    runSpock 11350 $ spockT id $\n    do get \"store\" $\n           text \"Would be a call to getData\"\n</code></pre>\n"}, {"tags": ["haskell"], "comments": [{"owner": {"reputation": 27723, "user_id": 627005, "user_type": "registered", "accept_rate": 87, "profile_image": "https://www.gravatar.com/avatar/016a165f7d0d5d24bb38331502b912ed?s=128&d=identicon&r=PG&f=1", "display_name": "Paul Manta", "link": "https://stackoverflow.com/users/627005/paul-manta"}, "edited": false, "score": 3, "creation_date": 1439317731, "post_id": 31949282, "comment_id": 51808122, "body": "Look into <a href=\"http://hackage.haskell.org/package/process-1.1.0.1/docs/System-Process.html\" rel=\"nofollow noreferrer\"><code>System.Process</code></a>."}, {"owner": {"reputation": 78982, "user_id": 1848654, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/84180c0f3c9c04f8b8f0613fc0129dac?s=128&d=identicon&r=PG", "display_name": "melpomene", "link": "https://stackoverflow.com/users/1848654/melpomene"}, "edited": false, "score": 0, "creation_date": 1439327412, "post_id": 31949282, "comment_id": 51813340, "body": "No, <code>file</code> has type <code>String</code>, not <code>IO String</code>."}], "answers": [{"tags": [], "owner": {"reputation": 2513, "user_id": 4725625, "user_type": "registered", "accept_rate": 70, "profile_image": "https://i.stack.imgur.com/YwH49.png?s=128&g=1", "display_name": "Kwarrtz", "link": "https://stackoverflow.com/users/4725625/kwarrtz"}, "is_accepted": true, "score": 4, "last_activity_date": 1439597848, "last_edit_date": 1439597848, "creation_date": 1439327751, "answer_id": 31952085, "question_id": 31949282, "link": "https://stackoverflow.com/questions/31949282/how-do-you-run-an-unix-executable-file-in-main/31952085#31952085", "title": "How do you run an unix executable file in main", "body": "<p>I believe you are looking for <a href=\"http://hackage.haskell.org/package/process-1.2.3.0/docs/System-Process.html#v:proc\" rel=\"nofollow\"><code>proc</code></a> from <a href=\"http://hackage.haskell.org/package/process-1.1.0.1/docs/System-Process.html\" rel=\"nofollow\"><code>System.Process</code></a>. To run the script with no arguments, try</p>\n\n<pre><code>main = do\n    let path = \"...\"\n    (Just stdin, Just stdout, Just stderr, p) \n      &lt;- createProcess $ proc path []\n    putStrLn $ hgetContents stdout\n</code></pre>\n\n<p>This will print the output of your script (assuming there is any). Here, <code>stdin</code>, <code>stdout</code>, and <code>stderr</code> are all <code>Handle</code>s representing the various channels, which can then be used to pipe output between processes. For more information on manipulating the processes, take a look at the <a href=\"http://hackage.haskell.org/package/process-1.1.0.1/docs/System-Process.html\" rel=\"nofollow\"><code>System.Process</code></a> documentation. For more information on manipulating the <code>Handle</code>s, jump on over to <a href=\"http://hackage.haskell.org/package/base-4.5.0.0/docs/GHC-IO-Handle.html\" rel=\"nofollow\"><code>GHC.IO.Handle</code></a>.</p>\n\n<p>The above is a somewhat primitive method, but it is very generic and should work for most purposes. However, the <a href=\"http://hackage.haskell.org/package/process-1.1.0.1/docs/System-Process.html\" rel=\"nofollow\"><code>System.Process</code></a> library contains many shortcuts for common problems. As melpomene pointed out in his answer, the simpler <a href=\"http://hackage.haskell.org/package/process-1.2.3.0/docs/System-Process.html#v:readProcess\" rel=\"nofollow\"><code>readProcess</code></a> function should be sufficient for what you wanted to do in your question.</p>\n"}, {"tags": [], "owner": {"reputation": 78982, "user_id": 1848654, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/84180c0f3c9c04f8b8f0613fc0129dac?s=128&d=identicon&r=PG", "display_name": "melpomene", "link": "https://stackoverflow.com/users/1848654/melpomene"}, "is_accepted": false, "score": 4, "last_activity_date": 1439327751, "creation_date": 1439327751, "answer_id": 31952086, "question_id": 31949282, "link": "https://stackoverflow.com/questions/31949282/how-do-you-run-an-unix-executable-file-in-main/31952086#31952086", "title": "How do you run an unix executable file in main", "body": "<p>Probably the easiest way to run a program and get its output is to use <a href=\"http://hackage.haskell.org/package/process-1.2.3.0/docs/System-Process.html#v:readProcess\" rel=\"nofollow\"><code>readProcess</code> from <code>System.Process</code></a>:</p>\n\n<pre><code>import System.Process (readProcess)\n\nmain :: IO ()\nmain = do\n    let prog = \"pathToFile/myExecutable\"\n    output &lt;- readProcess prog [] \"\"\n    putStrLn (\"The output was: \" ++ show output)\n</code></pre>\n"}, {"tags": [], "owner": {"reputation": 136, "user_id": 1553834, "user_type": "registered", "accept_rate": 17, "profile_image": "https://i.stack.imgur.com/Rk6Gb.jpg?s=128&g=1", "display_name": "urbanslug", "link": "https://stackoverflow.com/users/1553834/urbanslug"}, "is_accepted": false, "score": 1, "last_activity_date": 1439381157, "creation_date": 1439381157, "answer_id": 31964736, "question_id": 31949282, "link": "https://stackoverflow.com/questions/31949282/how-do-you-run-an-unix-executable-file-in-main/31964736#31964736", "title": "How do you run an unix executable file in main", "body": "<p>I personally use <code>rawSystem</code> <a href=\"https://hackage.haskell.org/package/process-1.2.3.0/docs/System-Process.html#v:rawSystem\" rel=\"nofollow\">https://hackage.haskell.org/package/process-1.2.3.0/docs/System-Process.html#v:rawSystem</a> from System.Process.</p>\n\n<p>Here is it's example use in code of my own <a href=\"https://github.com/urbanslug/wai-devel/blob/master/src/Main.hs#L23\" rel=\"nofollow\">https://github.com/urbanslug/wai-devel/blob/master/src/Main.hs#L23</a></p>\n\n<p>It takes the command and a list of arguments.</p>\n\n<p>Here is it's description from hackage</p>\n\n<p>rawSystem :: String -> [String] -> IO ExitCode Source</p>\n\n<p><em>The computation rawSystem cmd args runs the operating system command cmd in such a way that it receives as arguments the args strings exactly as given, with no funny escaping or shell meta-syntax expansion. It will therefore behave more portably between operating systems than system.\nThe return codes and possible failures are the same as for system.</em></p>\n"}], "owner": {"reputation": 4310, "user_id": 1128571, "user_type": "registered", "accept_rate": 83, "profile_image": "https://www.gravatar.com/avatar/e743815e7a4a5f8c1d66277d6397624f?s=128&d=identicon&r=PG", "display_name": "xiaolingxiao", "link": "https://stackoverflow.com/users/1128571/xiaolingxiao"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 194, "favorite_count": 1, "accepted_answer_id": 31952085, "answer_count": 3, "score": 0, "last_activity_date": 1439597848, "creation_date": 1439317490, "last_edit_date": 1439504700, "question_id": 31949282, "link": "https://stackoverflow.com/questions/31949282/how-do-you-run-an-unix-executable-file-in-main", "title": "How do you run an unix executable file in main", "body": "<p>I am familiar with the basic concepts of haskell but have scant experience doing \"real\" stuff with it. So now I have a unix executable file and I would like to play with it in ghci and eventually run it in main. The file outputs a bunch of stuff in CSV format, so I would like to run it and do stuff with the output. So far I can open the file:</p>\n\n<pre><code>main :: IO ()\nmain = do\n    let path = \"pathToFile/myFile\"\n    yes      &lt;- doesFileExist path\n    file     &lt;- if yes then readFile path else return \"\"\n    print \"ok!\"\n</code></pre>\n\n<p>But file is <code>String</code> typed, which is not really what I want. So I am not very familiar with what libraries I should use next. Please point me in a direction (documentation, blogs, etc) that deals with this kind of stuff. Thanks!</p>\n"}, {"tags": ["haskell", "haskell-snap-framework", "digestive-functors"], "answers": [{"comments": [{"owner": {"reputation": 255, "user_id": 681337, "user_type": "registered", "accept_rate": 92, "profile_image": "https://www.gravatar.com/avatar/be5e0ffb42be5e3337208ae8c9679bb4?s=128&d=identicon&r=PG", "display_name": "Neil", "link": "https://stackoverflow.com/users/681337/neil"}, "edited": false, "score": 0, "creation_date": 1439500783, "post_id": 31995666, "comment_id": 51900775, "body": "Awesome, thanks... the approach on expanding the expected types was very helpful."}], "tags": [], "owner": {"reputation": 2719, "user_id": 566890, "user_type": "registered", "accept_rate": 86, "profile_image": "https://i.stack.imgur.com/T0Csa.png?s=128&g=1", "display_name": "Markus1189", "link": "https://stackoverflow.com/users/566890/markus1189"}, "is_accepted": true, "score": 2, "last_activity_date": 1439490029, "creation_date": 1439490029, "answer_id": 31995666, "question_id": 31948366, "link": "https://stackoverflow.com/questions/31948366/digestive-functors-and-listof/31995666#31995666", "title": "Digestive-functors and listOf", "body": "<p>Okay <strong>disclaimer</strong>: I have never used <code>digestive-functors</code>, but here is how I approach this kind of problem:</p>\n\n<p>1) Your error message says <code>Expected type: Formlet T.Text m Recipient</code> and <code>Actual type: Text.Digestive.Form.Internal.FormTree m0 v0 m0 Recipient</code></p>\n\n<p>2) Look at the documentation and see that:</p>\n\n<pre><code>type Formlet v m a = Maybe a -&gt; Form v m a \ntype Form v m a = FormTree m v m a\n</code></pre>\n\n<p>so we expand the <strong>expected</strong> from above to get:</p>\n\n<pre><code>Formlet T.Text m Recipient \n-- v ~ T.Text, a ~ Recipient\nMaybe Recipient -&gt; Form T.Text m Recipient\n--\nMaybe Recipient -&gt; FormTree m T.Text m Recipient\n</code></pre>\n\n<p>now look again:</p>\n\n<ul>\n<li>Expected type: <code>Maybe Recipient -&gt; FormTree m T.Text m Recipient</code></li>\n<li>Actual type: <code>FormTree m0 v0 m0 Recipient</code></li>\n</ul>\n\n<p>We are missing a <code>Maybe Recipient</code>! From what I see above I guess you want to just ignore that argument and therefore we have:</p>\n\n<pre><code>recipientForm' :: (Monad m) =&gt; Formlet T.Text m Recipient\nrecipientForm' _ = Recipient &lt;$&gt; \"email\" .: text Nothing\n</code></pre>\n\n<p>which compiles just fine, yay :)</p>\n"}], "owner": {"reputation": 255, "user_id": 681337, "user_type": "registered", "accept_rate": 92, "profile_image": "https://www.gravatar.com/avatar/be5e0ffb42be5e3337208ae8c9679bb4?s=128&d=identicon&r=PG", "display_name": "Neil", "link": "https://stackoverflow.com/users/681337/neil"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 175, "favorite_count": 1, "accepted_answer_id": 31995666, "answer_count": 1, "score": 2, "last_activity_date": 1439493660, "creation_date": 1439314511, "last_edit_date": 1439493660, "question_id": 31948366, "link": "https://stackoverflow.com/questions/31948366/digestive-functors-and-listof", "title": "Digestive-functors and listOf", "body": "<p>I've been able to use <a href=\"https://hackage.haskell.org/package/digestive-functors-0.8.0.0\" rel=\"nofollow\">digestive-functors</a> with simple forms successfully in a snap application; however, I'm getting stuck when trying to handle a list of hidden inputs. There is something I'm not quite getting on how to use <code>listOf</code>. Can anyone point me in the right direction? Thanks.</p>\n\n<p>The rendered html from a previous page includes the following hidden fields:</p>\n\n<pre><code>&lt;div id='messageForm.recipients' class='inputList'&gt;\n  &lt;input type='hidden' name='messageForm.recipients.indices' value='0' /&gt;\n  &lt;input type='hidden' id='messageForm.recipients.-1.email' name='messageForm.recipients.-1.email' value /&gt;\n  &lt;input type='hidden' id='messageForm.recipients.0.email' name='messageForm.recipients.0.email' value='emai1l@email.com' /&gt; \n  &lt;input type='hidden' id='messageForm.recipients.1.email' name='messageForm.recipients.1.email' value='email2@email.com' /&gt; \n&lt;/div&gt;\n</code></pre>\n\n<p>The data types are:</p>\n\n<pre><code>data ConfirmMessage = ConfirmMessage {\n  isoDate :: T.Text,\n  subject :: T.Text,\n  body    :: T.Text,\n  action  :: T.Text,\n  recipients :: [Recipient]\n} deriving (Show) \n\ndata Recipient = Recipient {\n  email :: T.Text \n} deriving (Show)\n</code></pre>\n\n<p>The forms are:</p>\n\n<pre><code>messageForm :: (Monad m) =&gt; Form T.Text m ConfirmMessage\nmessageForm = ConfirmMessage\n  &lt;$&gt; \"isoDate\"    .: stringRead \"Missing ISOdate\" Nothing\n  &lt;*&gt; \"subject\"    .: stringRead \"Subject required\" Nothing\n  &lt;*&gt; \"body\"       .: stringRead \"Body required\" Nothing\n  &lt;*&gt; \"action\"     .: stringRead \"Missing action\" Nothing\n  &lt;*&gt; \"recipients\" .: listOf recipientForm' Nothing\n\nrecipientForm' :: (Monad m) =&gt; Formlet T.Text m Recipient\nrecipientForm'= Recipient\n  &lt;$&gt; \"email\"      .: text Nothing\n</code></pre>\n\n<p>The error message I am getting is:</p>\n\n<pre><code>Couldn't match type `Text.Digestive.Form.Internal.FormTree\n                       m0 v0 m0 Recipient'\n              with `Maybe Recipient -&gt; Form T.Text m Recipient'\nExpected type: Formlet T.Text m Recipient\n  Actual type: Text.Digestive.Form.Internal.FormTree\n                 m0 v0 m0 Recipient\nRelevant bindings include\n  recipientForm' :: Formlet T.Text m Recipient\n    (bound at src/Handler/TradeNotifyConfirm.hs:191:1)\nIn the expression: Recipient &lt;$&gt; \"email\" .: text Nothing\nIn an equation for `recipientForm'':\n    recipientForm' = Recipient &lt;$&gt; \"email\" .: text Nothing\n</code></pre>\n"}, {"tags": ["haskell", "tacit-programming"], "comments": [{"owner": {"reputation": 57219, "user_id": 33796, "user_type": "registered", "accept_rate": 70, "profile_image": "https://www.gravatar.com/avatar/08727b23ba62e634b32988cdff082663?s=128&d=identicon&r=PG", "display_name": "luqui", "link": "https://stackoverflow.com/users/33796/luqui"}, "edited": false, "score": 11, "creation_date": 1439313016, "post_id": 31947777, "comment_id": 51805438, "body": "FYI <code>liftA2 (&amp;&amp;) (&gt;= &#39;0&#39;) (&lt;= &#39;7&#39;)</code> is one way to do your example."}, {"owner": {"reputation": 24266, "user_id": 946226, "user_type": "registered", "accept_rate": 59, "profile_image": "https://www.gravatar.com/avatar/5823d09208b1e4b63bbfcd189492032c?s=128&d=identicon&r=PG", "display_name": "Joachim Breitner", "link": "https://stackoverflow.com/users/946226/joachim-breitner"}, "edited": false, "score": 8, "creation_date": 1439313259, "post_id": 31947777, "comment_id": 51805576, "body": "That\u2019s quite a few question to be put in, well, one question."}, {"owner": {"reputation": 126897, "user_id": 791604, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/ce991df7a056248d5e4f6fc3659ba733?s=128&d=identicon&r=PG", "display_name": "Daniel Wagner", "link": "https://stackoverflow.com/users/791604/daniel-wagner"}, "edited": false, "score": 5, "creation_date": 1439313664, "post_id": 31947777, "comment_id": 51805787, "body": "This is not really a complete answer, but... I have worked on a few codebases that were meticulous about using the simplest, most obvious looking code everywhere. I found myself pleasantly nimble in modifying them."}, {"owner": {"reputation": 7872, "user_id": 440302, "user_type": "registered", "accept_rate": 92, "profile_image": "https://www.gravatar.com/avatar/e785baf6d4a2626b8649d5b538c51858?s=128&d=identicon&r=PG", "display_name": "Rufflewind", "link": "https://stackoverflow.com/users/440302/rufflewind"}, "edited": false, "score": 1, "creation_date": 1439336714, "post_id": 31947777, "comment_id": 51816786, "body": "The first two questions are more on-topic on <a href=\"https://programmers.stackexchange.com\">Programmers Stack Exchange</a>. It&#39;s largely a stylistic issue: just pick whatever expresses your particular problem the clearest."}, {"owner": {"reputation": 33184, "user_id": 247623, "user_type": "registered", "accept_rate": 72, "profile_image": "https://www.gravatar.com/avatar/bb9e67348d3e0e93ef12dd97c41a6c22?s=128&d=identicon&r=PG&f=1", "display_name": "Erik Kaplun", "link": "https://stackoverflow.com/users/247623/erik-kaplun"}, "edited": false, "score": 2, "creation_date": 1439338119, "post_id": 31947777, "comment_id": 51817115, "body": "Tacit programming is not a goal per se; it&#39;s only a useful tool... when it&#39;s useful \u2014 there are some cases in which a tacit (point-free) definition is significantly more human readable; there are, however, cases where it&#39;s immensely less readable than non-tacit."}, {"owner": {"user_type": "does_not_exist", "display_name": "user1345223"}, "reply_to_user": {"reputation": 7872, "user_id": 440302, "user_type": "registered", "accept_rate": 92, "profile_image": "https://www.gravatar.com/avatar/e785baf6d4a2626b8649d5b538c51858?s=128&d=identicon&r=PG", "display_name": "Rufflewind", "link": "https://stackoverflow.com/users/440302/rufflewind"}, "edited": false, "score": 1, "creation_date": 1439344879, "post_id": 31947777, "comment_id": 51818711, "body": "@Rufflewind - The first question posed is off-topic at Programmers.  Ultimately, it boils down to a poll-by-example which is a poor fit for the StackExchange Q&amp;A format.  The second question is marginally on-topic but would certainly need some backing research to make it a more interesting and constructive question.  And to round out the trifecta, the third question is obviously off-topic for Programmers as it&#39;s focused upon implementation only."}], "owner": {"reputation": 2041, "user_id": 3825483, "user_type": "registered", "accept_rate": 91, "profile_image": "https://i.stack.imgur.com/jqg7b.jpg?s=128&g=1", "display_name": "Marcelo Camargo", "link": "https://stackoverflow.com/users/3825483/marcelo-camargo"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 293, "favorite_count": 5, "closed_date": 1439338048, "answer_count": 0, "score": 5, "last_activity_date": 1439316567, "creation_date": 1439312542, "last_edit_date": 1439316567, "question_id": 31947777, "link": "https://stackoverflow.com/questions/31947777/why-ghc-avoids-tacit-programming", "closed_reason": "Needs more focus", "title": "Why GHC avoids tacit programming?", "body": "<p>I was looking at <a href=\"https://hackage.haskell.org/package/base-4.5.1.0/docs/src/GHC-Unicode.html\" rel=\"nofollow\"><code>GHC.Unicode</code></a> library source and realized that almost all the Haskell internal libraries avoid tacit programming (aka point-free style) most of the time. Simple functions can be easily converted, such as:</p>\n\n<pre><code>isLatin1 :: Char -&gt; Bool\nisLatin1 c = c &lt;= '\\xff'\n</code></pre>\n\n<p>Resulting in:</p>\n\n<pre><code>isLatin1 :: Char -&gt; Bool\nisLatin1 = (&lt;= '\\xff')\n</code></pre>\n\n<p>But there are cases where I can't apply it, such as when I have more complex functions, like:</p>\n\n<pre><code>isOctDigit c =  c &gt;= '0' &amp;&amp; c &lt;= '7'\n</code></pre>\n\n<p>Is hard to deduct a way to compose the operations. I don't mean to get in the range, I mean to do multiple operations just by composing functions. The following:</p>\n\n<pre><code>isOctDigit = (&gt;= '0') &amp;&amp; (&lt;= '7')\n</code></pre>\n\n<p>Is not valid, and also <code>(&gt;= '0') . (&lt;= '7')</code> <strong>clearly</strong> cannot happen because of the different return types.</p>\n\n<p>Taking account these observations, I have the following questions:</p>\n\n<ul>\n<li><strong>When should I use point-free programming instead of explicit it all?</strong></li>\n<li><strong>Why GHC prefer to explicit instead of use partial functions?</strong></li>\n<li><strong>How can I compose two functions of different types without being explicit, such as in the example?</strong></li>\n</ul>\n"}, {"tags": ["haskell", "persistence", "yesod"], "comments": [{"owner": {"reputation": 13734, "user_id": 938694, "user_type": "registered", "accept_rate": 59, "profile_image": "https://www.gravatar.com/avatar/b6678a430a805dd78366d6e135b49f2d?s=128&d=identicon&r=PG", "display_name": "Cubic", "link": "https://stackoverflow.com/users/938694/cubic"}, "edited": false, "score": 0, "creation_date": 1439307850, "post_id": 31945744, "comment_id": 51802353, "body": "Your problem seems to be that you expect <code>userToText something</code> to be <code>Text</code>, whereas if you use runDB it can only be <code>HandlerT someSite IO Text</code>."}, {"owner": {"reputation": 716, "user_id": 4118267, "user_type": "registered", "accept_rate": 73, "profile_image": "https://i.stack.imgur.com/xIgkR.jpg?s=128&g=1", "display_name": "oriaj", "link": "https://stackoverflow.com/users/4118267/oriaj"}, "reply_to_user": {"reputation": 13734, "user_id": 938694, "user_type": "registered", "accept_rate": 59, "profile_image": "https://www.gravatar.com/avatar/b6678a430a805dd78366d6e135b49f2d?s=128&d=identicon&r=PG", "display_name": "Cubic", "link": "https://stackoverflow.com/users/938694/cubic"}, "edited": false, "score": 0, "creation_date": 1439326335, "post_id": 31945744, "comment_id": 51812749, "body": "I want generate a CSV file from a table, how can get a Text if only have the Id?"}], "answers": [{"tags": [], "owner": {"reputation": 7297, "user_id": 1176156, "user_type": "registered", "accept_rate": 80, "profile_image": "https://www.gravatar.com/avatar/89604545aa57aa3d14306af60126e193?s=128&d=identicon&r=PG", "display_name": "MaxGabriel", "link": "https://stackoverflow.com/users/1176156/maxgabriel"}, "is_accepted": true, "score": 0, "last_activity_date": 1439565673, "creation_date": 1439565673, "answer_id": 32013455, "question_id": 31945744, "link": "https://stackoverflow.com/questions/31945744/convert-persistvalue-to-text-in-yesod/32013455#32013455", "title": "convert PersistValue to Text in Yesod", "body": "<p>Your code is in the <code>Handler</code> monad, so your function needs to return something of the type <code>Handler Text</code> rather than just <code>Text</code>:</p>\n\n<pre><code>userToText :: UserId -&gt; Handler Text\nuserToText userId = do\n    user &lt;- runDB $ get404 userId\n    return $ userName user -- Note the `return` here\n</code></pre>\n\n<p>(This is similar to how functions like <code>getLine</code> have type <code>IO String</code> rather than <code>String</code>).</p>\n"}], "owner": {"reputation": 716, "user_id": 4118267, "user_type": "registered", "accept_rate": 73, "profile_image": "https://i.stack.imgur.com/xIgkR.jpg?s=128&g=1", "display_name": "oriaj", "link": "https://stackoverflow.com/users/4118267/oriaj"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 94, "favorite_count": 0, "accepted_answer_id": 32013455, "answer_count": 1, "score": 0, "last_activity_date": 1439565673, "creation_date": 1439306293, "question_id": 31945744, "link": "https://stackoverflow.com/questions/31945744/convert-persistvalue-to-text-in-yesod", "title": "convert PersistValue to Text in Yesod", "body": "<p>I want get the attribute value from Persist Entity; so i have the following code</p>\n\n<pre><code>userToText userId = do\n    user &lt;- runDB $ get404 userId\n    userName user\n</code></pre>\n\n<p>This code doesn't compile, so I wrote those alternative version </p>\n\n<pre><code>userToText userId = do\n    user &lt;- runDB $ get404 userId\n    listToJSON [user]\n\n\nuserToText userId = do\n    (_,_,_,_,_,name,_,_) &lt;- runDB $ get404 userId\n    show name\n</code></pre>\n\n<p>All generate the same error</p>\n\n<pre><code>Handler/Report.hs:105:9:\nCouldn't match expected type \u2018HandlerT site IO b\u2019\n            with actual type \u2018Text\u2019\nRelevant bindings include\n  userToText :: Key PersistValue -&gt; HandlerT site IO b\n    (bound at Handler/Report.hs:102:1)\nIn a stmt of a 'do' block: listToJSON [user]\nIn the expression:\n  do { user &lt;- runDB $ get404 userId;\n       listToJSON [user] }\n</code></pre>\n\n<p>thanks for the help</p>\n"}, {"tags": ["json", "haskell", "dictionary"], "answers": [{"tags": [], "owner": {"reputation": 116, "user_id": 3122214, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/42e1b1296155d5bb98540c712385281b?s=128&d=identicon&r=PG", "display_name": "Mikael Brockman", "link": "https://stackoverflow.com/users/3122214/mikael-brockman"}, "is_accepted": true, "score": 10, "last_activity_date": 1439295069, "last_edit_date": 1439295069, "creation_date": 1439294667, "answer_id": 31941314, "question_id": 31938589, "link": "https://stackoverflow.com/questions/31938589/violating-mapkeysmonotonic-precondition/31941314#31941314", "title": "violating mapKeysMonotonic precondition", "body": "<p>You can use <code>Map.showTree</code> to inspect the binary tree structure of the maps. The <code>mapKeysMonotonic</code> function keeps the same tree order and just replaces the nodes, and so any accessor that involves searching the tree will give wrong results.</p>\n\n<p>Traversals that don't search will quite possibly work, but using maps like this violates the logic of the data structure which is a recipe for confusion and bugs.</p>\n\n<p>To define your <code>ToJSON</code> instance, you don't need to build an intermediate map; you can use <code>foldrWithKey</code> to construct a <code>Value</code> directly. Note that the <code>Object</code> constructor in Aeson is just <code>HashMap Text Value</code>. The fold itself is O(n) and inserting into a <code>HashMap</code> is (practically) constant time. Something like this:</p>\n\n<pre><code>instance ToJSON v =&gt; ToJSON (Map (Key a) v) where\n  toJSON = Object . Map.foldrWithKey f mempty\n    where f = HashMap.insert . Text.pack . show\n</code></pre>\n"}, {"tags": [], "owner": {"reputation": 100185, "user_id": 3234959, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/93bb12ca0f93dfddb33880316f7e66c2?s=128&d=identicon&r=PG&f=1", "display_name": "chi", "link": "https://stackoverflow.com/users/3234959/chi"}, "is_accepted": false, "score": 0, "last_activity_date": 1439300690, "creation_date": 1439300690, "answer_id": 31943520, "question_id": 31938589, "link": "https://stackoverflow.com/questions/31938589/violating-mapkeysmonotonic-precondition/31943520#31943520", "title": "violating mapKeysMonotonic precondition", "body": "<p>If you can not guarantee that the function is monotonic, you can use</p>\n\n<pre><code>mapKeys :: Ord k2 =&gt; (k1 -&gt; k2) -&gt; Map k1 a -&gt; Map k2 a\n</code></pre>\n\n<p>This is <code>O(n*log n)</code>, so it's a bit slower than <code>mapKeysMonotonic</code> which is <code>O(n)</code>. Still, it's only a <code>log n</code> factor slower, so it might be good enough.</p>\n\n<p>In any case, I would not violate the <code>Map</code> invariant: you might cause elements to disappear from the map, or be duplicated.</p>\n"}], "owner": {"reputation": 1733, "user_id": 293735, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/6fe5bc171f84a440181f7274c5065443?s=128&d=identicon&r=PG", "display_name": "berdario", "link": "https://stackoverflow.com/users/293735/berdario"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 82, "favorite_count": 1, "accepted_answer_id": 31941314, "answer_count": 2, "score": 5, "last_activity_date": 1439300690, "creation_date": 1439286760, "question_id": 31938589, "link": "https://stackoverflow.com/questions/31938589/violating-mapkeysmonotonic-precondition", "title": "violating mapKeysMonotonic precondition", "body": "<p>I want to send some JSON that will contain a mapping from (Database.Persist.Sql) Keys to values. The obvious solution would be to use a <code>Map (Key x) v</code>, but this is not an instance of <code>ToJSON</code>.</p>\n\n<p>Some alternatives are:</p>\n\n<ul>\n<li>don't use JSON, use something better (like <a href=\"https://github.com/edn-format/edn\">edn</a>)</li>\n<li>don't return a <code>Map k v</code>, return a <code>Map Text v</code> (but here I'd lose some type information)</li>\n<li><code>type JsonKey = Text</code>, and <code>Map JsonKey v</code>, but this is not really any better</li>\n<li>define my own <code>ToJSON</code> instance.</li>\n</ul>\n\n<p>The latter seems to be the one that will require less changes, and the cleaner one.</p>\n\n<p>Also, be aware that I only need the <code>ToJSON</code> instance, not the <code>FromJSON</code>, so I don't need the whole roundtripping.</p>\n\n<p>So, this is what I want to write:</p>\n\n<pre><code>import Database.Persist.Sql (Key)\ninstance ToJSON (ToJSON v =&gt; (Map (Key a) v))\n</code></pre>\n\n<p>Assuming that <code>Key</code> has a friendly <code>Show</code> instance (it doesn't, but this is just a detail)... I was about to write:</p>\n\n<pre><code>instance ToJSON (ToJSON v =&gt; (Map (Key a) v)) where\n  toJSON m = toJSON $ mapKeysMonotonic show m\n</code></pre>\n\n<p>but I immeditately realized that this is bad (Keys are just like integers):</p>\n\n<pre><code>&gt; 9 &lt; 10\nTrue\n&gt; \"9\" &lt; \"10\"\nFalse\n</code></pre>\n\n<p>This violates the <code>mapKeysMonotonic</code> precondition.</p>\n\n<p>Now, in the meanwhile, I can just use <code>mapKeys</code>... but I tried to think, what's the risk in violating this? <code>mapKeys</code> is obviously less efficient. And I understand how this might be premature optimization.</p>\n\n<p>But I'd still like to understand in which way this could break down... or if it's indeed safe for my limited use case. The only thing I care about is if no values are lost. I don't care about their order.</p>\n\n<p>Now, <a href=\"https://github.com/bos/aeson/blob/1c25679039513c3ff/Data/Aeson/Types/Instances.hs#L630\">this is <code>instance (ToJSON v) =&gt; ToJSON (M.Map String v)</code></a>. It converts a <code>Data.Map</code> to a <code>Data.HashMap</code></p>\n\n<p>Which relies on <a href=\"https://github.com/bos/aeson/blob/1c25679039513c/Data/Aeson/Functions.hs#L22\"><code>mapHashKeyVals</code></a>... which uses <code>Data.Map.foldrWithKey</code></p>\n\n<p>I also thought of using an <code>HashMap (Key x) v</code>, to avoid either a <code>N*log(N)</code> computation or <code>mapKeysMonotonic</code>. But I'd have the define the ToJSON instance nonetheless, and apparently there's no <code>mapKeys</code> for <code>HashMap</code> (understandably, since this would require to recompute all the hashes, but I'm not sure if this would actually be more expensive than a <code>mapKeys</code>)</p>\n\n<p>Now, I tried this simple example:</p>\n\n<pre><code>&gt; mapKeysMonotonic show $ fromList [(10,\"a\"), (9, \"b\"), (99, \"c\"), (100, \"d\")]\nfromList [(\"9\",\"b\"),(\"10\",\"a\"),(\"99\",\"c\"),(\"100\",\"d\")]\n</code></pre>\n\n<p>and since <code>show</code> returns a distinct <code>String</code> for each distinct <code>Int</code>, obviously no values are lost. The Map now is probably unbalanced... but what are the consequences? I guess that <code>union</code>, <code>difference</code>, <code>intersection</code> might misbehave... but what about traversal and folds? Would these still retain all the elements in all cases?</p>\n\n<p>PS: I just realized that another possible solution maybe could be to define <code>instance ToJSON (ToJSON v =&gt; [(Key x, v)])</code> and convert it to <code>Map</code> on the inside... but I guess this would be an overlapping instance</p>\n"}, {"tags": ["haskell", "pattern-matching", "non-exhaustive-patterns"], "comments": [{"owner": {"reputation": 48129, "user_id": 76051, "user_type": "registered", "accept_rate": 91, "profile_image": "https://i.stack.imgur.com/AGDxz.jpg?s=128&g=1", "display_name": "Carsten", "link": "https://stackoverflow.com/users/76051/carsten"}, "edited": false, "score": 4, "creation_date": 1439285985, "post_id": 31938214, "comment_id": 51786881, "body": "well <code>(x:xs)</code> will not match the empty list obviously ... so your first example just is not exhaustive - the <b>guards</b> only kick in <i>after</i> the pattern matched (as an additional ... well guard - think of it like <code>disjoint l@(x:xs) ... = if null l then ... </code>)"}], "answers": [{"comments": [{"owner": {"reputation": 915, "user_id": 4883095, "user_type": "registered", "accept_rate": 91, "profile_image": "https://www.gravatar.com/avatar/186dca84cf6c850ddeedf8318061e58d?s=128&d=identicon&r=PG&f=1", "display_name": "Nicholas Monta&#241;o", "link": "https://stackoverflow.com/users/4883095/nicholas-monta%c3%b1o"}, "edited": false, "score": 0, "creation_date": 1439286198, "post_id": 31938363, "comment_id": 51787000, "body": "Perfect answer. Thank you very much. I didn&#39;t realize you could add disjoint _____ = clauses after guards."}, {"owner": {"reputation": 17809, "user_id": 1088108, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/63781cd38e91aa346a3849bc3ef3e550?s=128&d=identicon&r=PG&f=1", "display_name": "&#216;rjan Johansen", "link": "https://stackoverflow.com/users/1088108/%c3%98rjan-johansen"}, "edited": false, "score": 0, "creation_date": 1439314288, "post_id": 31938363, "comment_id": 51806149, "body": "For your second solution, you need a space between <code>@</code> and <code>~</code>, otherwise it thinks it&#39;s a different operator."}, {"owner": {"reputation": 11593, "user_id": 2494803, "user_type": "registered", "accept_rate": 88, "profile_image": "https://www.gravatar.com/avatar/58b4b1d0d8887426a51330a990936ac1?s=128&d=identicon&r=PG", "display_name": "bennofs", "link": "https://stackoverflow.com/users/2494803/bennofs"}, "reply_to_user": {"reputation": 17809, "user_id": 1088108, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/63781cd38e91aa346a3849bc3ef3e550?s=128&d=identicon&r=PG&f=1", "display_name": "&#216;rjan Johansen", "link": "https://stackoverflow.com/users/1088108/%c3%98rjan-johansen"}, "edited": false, "score": 0, "creation_date": 1439314544, "post_id": 31938363, "comment_id": 51806308, "body": "@&#216;rjanJohansen thanks, I was not aware of that, I&#39;ll edit the post"}, {"owner": {"reputation": 17809, "user_id": 1088108, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/63781cd38e91aa346a3849bc3ef3e550?s=128&d=identicon&r=PG&f=1", "display_name": "&#216;rjan Johansen", "link": "https://stackoverflow.com/users/1088108/%c3%98rjan-johansen"}, "edited": false, "score": 1, "creation_date": 1439315356, "post_id": 31938363, "comment_id": 51806752, "body": "That <i>defines</i> the <code>@~</code> operator."}, {"owner": {"reputation": 11593, "user_id": 2494803, "user_type": "registered", "accept_rate": 88, "profile_image": "https://www.gravatar.com/avatar/58b4b1d0d8887426a51330a990936ac1?s=128&d=identicon&r=PG", "display_name": "bennofs", "link": "https://stackoverflow.com/users/2494803/bennofs"}, "reply_to_user": {"reputation": 17809, "user_id": 1088108, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/63781cd38e91aa346a3849bc3ef3e550?s=128&d=identicon&r=PG&f=1", "display_name": "&#216;rjan Johansen", "link": "https://stackoverflow.com/users/1088108/%c3%98rjan-johansen"}, "edited": false, "score": 0, "creation_date": 1439315472, "post_id": 31938363, "comment_id": 51806809, "body": "@&#216;rjanJohansen oh, right. I thought I tried actually using <code>xs</code> after that, but it seems I didn&#39;t. Thanks again!"}], "tags": [], "owner": {"reputation": 11593, "user_id": 2494803, "user_type": "registered", "accept_rate": 88, "profile_image": "https://www.gravatar.com/avatar/58b4b1d0d8887426a51330a990936ac1?s=128&d=identicon&r=PG", "display_name": "bennofs", "link": "https://stackoverflow.com/users/2494803/bennofs"}, "is_accepted": true, "score": 12, "last_activity_date": 1439314577, "last_edit_date": 1439314577, "creation_date": 1439286107, "answer_id": 31938363, "question_id": 31938214, "link": "https://stackoverflow.com/questions/31938214/pattern-match-fail-when-function-function-syntax-is-omi/31938363#31938363", "title": "Pattern Match Fail when `function [] _ = ...; function _ [] = ...` syntax is omitted", "body": "<p>Your explaination for why this gives a pattern match failure is correct. You can write the code the following way to avoid redundant lines:</p>\n\n<pre><code>disjoint :: (Ord a) =&gt; [a] -&gt; [a] -&gt; Bool\ndisjoint l@(x:xs) r@(y:ys)\n    | x == y             = False\n    | x &gt; y              = disjoint l ys -- reduce right list\n    | otherwise          = disjoint xs r -- reduce left list\ndisjoint _ _ = True -- catch all pattern, executed if either l or r is []\n</code></pre>\n\n<p>This is the solution I recommend. There is another solution, to make the pattern match more lazy (the pattern is then only checked if <code>x</code>/<code>xs</code> or <code>y</code>/<code>ys</code> is actually required):</p>\n\n<pre><code>disjoint :: (Ord a) =&gt; [a] -&gt; [a] -&gt; Bool\ndisjoint l@ ~(x:xs) r@ ~(y:ys) -- the ~ here says that this is an irrefutable pattern, which makes the match more lazy\n    | null l || null r   = True -- x/y is not required, so pattern not checked\n    | x == y             = False\n    | x &gt; y              = disjoint l ys -- reduce right list\n    | otherwise          = disjoint xs r -- reduce left list\n</code></pre>\n\n<p>I don't recommend doing this though, since checking for <code>null</code> explicitly does not feel like idiomatic Haskell (also, irrefutable patterns are rarely used). The problem with the second approach is that you have to take care that you don't access <code>y/ys</code> / <code>x/xs</code> in the null cases, and the compiler won't help you. The first approach guarrantes that you can't access them in the null cases.</p>\n"}, {"tags": [], "owner": {"reputation": 10378, "user_id": 2476735, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/39e9447bbc32246fcd23b76b5e946618?s=128&d=identicon&r=PG&f=1", "display_name": "David Young", "link": "https://stackoverflow.com/users/2476735/david-young"}, "is_accepted": false, "score": 3, "last_activity_date": 1439307701, "last_edit_date": 1439307701, "creation_date": 1439306900, "answer_id": 31945945, "question_id": 31938214, "link": "https://stackoverflow.com/questions/31938214/pattern-match-fail-when-function-function-syntax-is-omi/31945945#31945945", "title": "Pattern Match Fail when `function [] _ = ...; function _ [] = ...` syntax is omitted", "body": "<p>Another way to avoid the duplication is to take advantage of pattern match/guard fall through:</p>\n\n<pre><code>disjoint :: (Ord a) =&gt; [a] -&gt; [a] -&gt; Bool\ndisjoint l r\n    | null l || null r   = True\n       -- If the guard above fails, then this pattern match is attempted:\ndisjoint l@(x:xs) r@(y:ys)\n    | x == y             = False\n    | x &gt; y              = disjoint l ys -- reduce right list\n    | otherwise          = disjoint xs r -- reduce left list\n</code></pre>\n\n<p>This is overkill here and personally I prefer the explicit pattern matching over <code>null</code> (the style of the first code block in bennofs answer is what I would go for), but this general technique can be handy in some situations.</p>\n"}], "owner": {"reputation": 915, "user_id": 4883095, "user_type": "registered", "accept_rate": 91, "profile_image": "https://www.gravatar.com/avatar/186dca84cf6c850ddeedf8318061e58d?s=128&d=identicon&r=PG&f=1", "display_name": "Nicholas Monta&#241;o", "link": "https://stackoverflow.com/users/4883095/nicholas-monta%c3%b1o"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 186, "favorite_count": 1, "accepted_answer_id": 31938363, "answer_count": 2, "score": 3, "last_activity_date": 1439314577, "creation_date": 1439285677, "last_edit_date": 1439286096, "question_id": 31938214, "link": "https://stackoverflow.com/questions/31938214/pattern-match-fail-when-function-function-syntax-is-omi", "title": "Pattern Match Fail when `function [] _ = ...; function _ [] = ...` syntax is omitted", "body": "<p>Though <code>disjoint</code> exhausts all possible patterns in its guard conditions, Haskell gives me a <code>PatternMatchFail</code> error when running it.</p>\n\n<pre><code>disjoint :: (Ord a) =&gt; [a] -&gt; [a] -&gt; Bool\ndisjoint l@(x:xs) r@(y:ys)\n    | null l || null r   = True\n    | x == y             = False\n    | x &gt; y              = disjoint l ys -- reduce right list\n    | otherwise          = disjoint xs r -- reduce left list\n-- | Terminates when either list has been reduced to null, or when their head\n-- elements are equal. Since lists are ordered, it only needs to compare head elements.\n</code></pre>\n\n<p>However, it has no problem if I write:</p>\n\n<pre><code>disjoint :: (Ord a) =&gt; [a] -&gt; [a] -&gt; Bool\ndisjoint [] _ = True\ndisjoint _ [] = True\ndisjoint l@(x:xs) r@(y:ys)\n--  | null l || null r   = True -- now redundant, but included for sake of continuity\n    | x == y             = False\n    | x &gt; y              = disjoint l ys -- reduce right list\n    | otherwise          = disjoint xs r -- reduce left list\n</code></pre>\n\n<p>Without those additional lines, I get a <code>PatternMatchFail</code>. If I am to infer what the issue for Haskell is in the first case, it is that if given a null list for an input argument, its expected arguments <code>l@(x:xs) r@(y:ys)</code> are already invoking a pattern-match, one that is non-exhaustive in the case of a null list, resulting in a <code>PatternMatchFail</code>, despite having a guard condition that checks for exactly the same condition. It just can't ever reach the guard condition, because it first needs to match on the \"argument condition\".</p>\n\n<p>However, those additional two lines are a tad off-putting to me in their repetitiveness, and I was just wondering if there was a more succinct way of fixing this. More generally: if I were to be using three or more lists as arguments, I definitely wouldn't want to write out disjoint 3+ more times just to check for null conditions, so what might I do in cases like that? Thank you for your time. </p>\n"}, {"tags": ["haskell", "ghc", "cabal"], "comments": [{"owner": {"reputation": 11593, "user_id": 2494803, "user_type": "registered", "accept_rate": 88, "profile_image": "https://www.gravatar.com/avatar/58b4b1d0d8887426a51330a990936ac1?s=128&d=identicon&r=PG", "display_name": "bennofs", "link": "https://stackoverflow.com/users/2494803/bennofs"}, "edited": false, "score": 4, "creation_date": 1439284832, "post_id": 31937302, "comment_id": 51786168, "body": "This looks like some weirdness related to <code>HPC</code> (haskell program coverage). Have you tried disabling HPC (running <code>cabal clean</code> and then configuring again, making sure <code>HPC</code> is not enabled?)"}, {"owner": {"reputation": 7134, "user_id": 3687048, "user_type": "registered", "accept_rate": 96, "profile_image": "https://i.stack.imgur.com/i0GDr.jpg?s=128&g=1", "display_name": "Mark Karpov", "link": "https://stackoverflow.com/users/3687048/mark-karpov"}, "reply_to_user": {"reputation": 11593, "user_id": 2494803, "user_type": "registered", "accept_rate": 88, "profile_image": "https://www.gravatar.com/avatar/58b4b1d0d8887426a51330a990936ac1?s=128&d=identicon&r=PG", "display_name": "bennofs", "link": "https://stackoverflow.com/users/2494803/bennofs"}, "edited": false, "score": 0, "creation_date": 1439285114, "post_id": 31937302, "comment_id": 51786340, "body": "@bennofs, indeed, without <code>--enable-coverage</code> option this doesn&#39;t happen! How did you know that this is <code>HPC</code>-related? Also add this as an answer, this may be useful for future readers :-D Should I report bug to HPC maintainers or something?"}], "answers": [{"comments": [{"owner": {"reputation": 7134, "user_id": 3687048, "user_type": "registered", "accept_rate": 96, "profile_image": "https://i.stack.imgur.com/i0GDr.jpg?s=128&g=1", "display_name": "Mark Karpov", "link": "https://stackoverflow.com/users/3687048/mark-karpov"}, "edited": false, "score": 0, "creation_date": 1439285691, "post_id": 31938090, "comment_id": 51786707, "body": "I&#39;ll try Cabal first, since it&#39;s on GitHub and it&#39;s easier for me to interact with, also I think it&#39;s rather either Cabal or HPC bug than that in GHC. Thank you, when I first saw this I thought I need to sleep sometimes because this must be a hallucination, it cannot be for real ! :-D"}, {"owner": {"reputation": 11593, "user_id": 2494803, "user_type": "registered", "accept_rate": 88, "profile_image": "https://www.gravatar.com/avatar/58b4b1d0d8887426a51330a990936ac1?s=128&d=identicon&r=PG", "display_name": "bennofs", "link": "https://stackoverflow.com/users/2494803/bennofs"}, "reply_to_user": {"reputation": 7134, "user_id": 3687048, "user_type": "registered", "accept_rate": 96, "profile_image": "https://i.stack.imgur.com/i0GDr.jpg?s=128&g=1", "display_name": "Mark Karpov", "link": "https://stackoverflow.com/users/3687048/mark-karpov"}, "edited": false, "score": 0, "creation_date": 1439285748, "post_id": 31938090, "comment_id": 51786748, "body": "Well, HPC is part of GHC"}, {"owner": {"reputation": 7134, "user_id": 3687048, "user_type": "registered", "accept_rate": 96, "profile_image": "https://i.stack.imgur.com/i0GDr.jpg?s=128&g=1", "display_name": "Mark Karpov", "link": "https://stackoverflow.com/users/3687048/mark-karpov"}, "edited": false, "score": 0, "creation_date": 1439285781, "post_id": 31938090, "comment_id": 51786762, "body": "Oh, I see. I thought it&#39;s a separate package."}], "tags": [], "owner": {"reputation": 11593, "user_id": 2494803, "user_type": "registered", "accept_rate": 88, "profile_image": "https://www.gravatar.com/avatar/58b4b1d0d8887426a51330a990936ac1?s=128&d=identicon&r=PG", "display_name": "bennofs", "link": "https://stackoverflow.com/users/2494803/bennofs"}, "is_accepted": true, "score": 7, "last_activity_date": 1439285362, "creation_date": 1439285362, "answer_id": 31938090, "question_id": 31937302, "link": "https://stackoverflow.com/questions/31937302/ghc-panic-loading-temp-shared-object-failed/31938090#31938090", "title": "GHC Panic: Loading temp shared object failed", "body": "<p>If you read the error carefully, you'll notice that the function that is missing is related to hpc:</p>\n\n<pre>\nundefined symbol: <b>_hpc_</b>tickboxes_megapzuEw3SHAmfXgNLpm5a31oXO6_TextziMegaparsecziError_hpc\n</pre>\n\n<p>My guess is that the instrumentation that HPC (haskell program coverage) does is not compatible with the interactive loading of haskell code that GHCi does. Disabling HPC (<code>cabal clean</code> followed by <code>cabal configure</code>, making sure coverage is disabled when configuring) should fix the issue.</p>\n\n<p>I suggest reporting a bug on the GHC bug tracker (although this could also be a cabal bug, not sure who is at fault here). </p>\n"}], "owner": {"reputation": 7134, "user_id": 3687048, "user_type": "registered", "accept_rate": 96, "profile_image": "https://i.stack.imgur.com/i0GDr.jpg?s=128&g=1", "display_name": "Mark Karpov", "link": "https://stackoverflow.com/users/3687048/mark-karpov"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 303, "favorite_count": 0, "accepted_answer_id": 31938090, "answer_count": 1, "score": 7, "last_activity_date": 1439287754, "creation_date": 1439283192, "last_edit_date": 1439287754, "question_id": 31937302, "link": "https://stackoverflow.com/questions/31937302/ghc-panic-loading-temp-shared-object-failed", "title": "GHC Panic: Loading temp shared object failed", "body": "<p>We're working on a fork of Parsec (with complete QuickCheck test-suite, better error messages and other improvements) and some progress has been done. Most of the time I worked with REPL from Emacs, specifying build target <code>tests</code> (that is, obviously name of the test suite). This has been working fine.</p>\n\n<p>Now our thing passes the tests, everything seems to be OK, but if I start REPL with library target (or omitting it, i.e. <code>cabal repl</code> or <code>cabal repl lib:megaparsec</code>) and do something, I get GHC panic:</p>\n\n<pre><code>\u03bb&gt; parseTest (string \"rere\" &lt;* eof) \"reri\"\nghc: panic! (the 'impossible' happened)\n  (GHC version 7.10.1 for x86_64-unknown-linux):\n    Loading temp shared object failed: /tmp/ghc9380_0/libghc9380_93.so: undefined symbol: _hpc_tickboxes_megapzuEw3SHAmfXgNLpm5a31oXO6_TextziMegaparsecziError_hpc\n\nPlease report this as a GHC bug:  http://www.haskell.org/ghc/reportabug\n</code></pre>\n\n<p>Since the code compiles and works fine via <code>cabal repl tests</code>, I conclude this is not my programming fault at any rate, but may be it is a bug.</p>\n\n<p>I've found this ticket: <a href=\"https://ghc.haskell.org/trac/ghc/ticket/10761\" rel=\"noreferrer\">https://ghc.haskell.org/trac/ghc/ticket/10761</a>, but our library doesn't use Template Haskell.</p>\n\n<p>Actual question is: what should I do and how can this be fixed? I cannot even tell if it's Cabal or GHC, I have no idea how to build minimal example that could reproduce the problem.</p>\n\n<hr>\n\n<p>I've reported it:</p>\n\n<p><a href=\"https://ghc.haskell.org/trac/ghc/ticket/10765#ticket\" rel=\"noreferrer\">https://ghc.haskell.org/trac/ghc/ticket/10765#ticket</a></p>\n"}, {"tags": ["multithreading", "sockets", "haskell", "conduit", "network-conduit"], "comments": [{"owner": {"reputation": 23444, "user_id": 414413, "user_type": "registered", "accept_rate": 79, "profile_image": "https://www.gravatar.com/avatar/6de2113f01432aa844dc85070ff33e89?s=128&d=identicon&r=PG", "display_name": "Cirdec", "link": "https://stackoverflow.com/users/414413/cirdec"}, "edited": false, "score": 0, "creation_date": 1439281014, "post_id": 31932931, "comment_id": 51783940, "body": "Take a look at <a href=\"https://hackage.haskell.org/package/stm-conduit-2.6.1/docs/Data-Conduit-TMChan.html\" rel=\"nofollow noreferrer\">stm-conduit</a> or in the pipes land <a href=\"https://hackage.haskell.org/package/pipes-concurrency-2.0.3/docs/Pipes-Concurrent-Tutorial.html\" rel=\"nofollow noreferrer\">pipes-concurrent</a>."}], "answers": [{"tags": [], "owner": {"reputation": 23444, "user_id": 414413, "user_type": "registered", "accept_rate": 79, "profile_image": "https://www.gravatar.com/avatar/6de2113f01432aa844dc85070ff33e89?s=128&d=identicon&r=PG", "display_name": "Cirdec", "link": "https://stackoverflow.com/users/414413/cirdec"}, "is_accepted": true, "score": 1, "last_activity_date": 1439306177, "creation_date": 1439306177, "answer_id": 31945691, "question_id": 31932931, "link": "https://stackoverflow.com/questions/31932931/is-there-a-way-to-have-a-conduit-take-data-from-multiple-sources-without-blockin/31945691#31945691", "title": "Is there a way to have a conduit take data from multiple sources without blocking any of them?", "body": "<p>Michael Snoyman's <a href=\"http://www.yesodweb.com/blog/2014/03/network-conduit-async\" rel=\"nofollow\">conduit network examples use concurrency</a>. The telnet client example runs one thread for sending input and another for displaying what's recieved. I've adapted it to send and recieve entire lines</p>\n\n<pre><code>{-# LANGUAGE OverloadedStrings #-}\nimport Conduit\nimport Control.Concurrent.Async (concurrently)\nimport Control.Monad            (liftM, void)\nimport Data.ByteString          (ByteString)\nimport Data.ByteString.Char8    (unpack)\nimport Data.Conduit.Network\nimport Data.String              (IsString, fromString)\nimport Network                  (withSocketsDo)\n\ngetLines :: (IsString a, MonadIO m) =&gt; Producer m a\ngetLines = repeatMC . liftM fromString $ liftIO getLine\n\nputLines :: (MonadIO m) =&gt; Consumer ByteString m ()\nputLines = mapM_C $ liftIO . putStrLn . unpack\n\nmain :: IO ()\nmain = withSocketsDo $\n    runTCPClient (clientSettings 4000 \"localhost\") $ \\server -&gt;\n        void $ concurrently\n            (getLines $$ appSink server)\n            (appSource server $$ putLines)\n</code></pre>\n\n<p>We can do the same thing on the server. Create an STM channel, write recieved data into the channel, and send data from the channel  to the clients. This uses the <a href=\"https://hackage.haskell.org/package/stm-conduit\" rel=\"nofollow\">stm-conduit</a> package's simple wrappers around an STM channel, <code>sourceTBMChan</code> and <code>sinkTBMChan</code>.</p>\n\n<pre><code>{-# LANGUAGE OverloadedStrings #-}\nimport Conduit\nimport Control.Concurrent.Async       (concurrently)\nimport Control.Concurrent.STM.TBMChan (newTBMChan)\nimport Control.Monad                  (void)\nimport Control.Monad.STM              (atomically)\nimport Data.Conduit.Network\nimport Data.Conduit.TMChan            (sourceTBMChan, sinkTBMChan)\nimport Network                        (withSocketsDo)\n\nmain :: IO ()\nmain = withSocketsDo $ do\n    channel &lt;- atomically $ newTBMChan 10\n    runTCPServer (serverSettings 4000 \"*\") $ \\server -&gt;\n        void $ concurrently\n            (appSource server $$ sinkTBMChan channel False)\n            (sourceTBMChan channel $$ appSink server)\n</code></pre>\n\n<p>If we run the server with only a single client connected, it echos back what the client sent.</p>\n\n<pre><code>----------\n| a      | (sent)\n| a      | (received)\n| b      | (sent)\n| b      | (received)\n| c      | (sent)\n| c      | (received) \n----------\n</code></pre>\n\n<p>If we run the server with multiple clients connected, the messages are distributed among the clients with one client getting each message.</p>\n\n<pre><code>----------             ----------\n| 1      | (sent)      | 1      | (received)\n| 2      | (sent)      | 3      | (received)\n| 2      | (received)  |        |\n| 3      | (sent)      |        |\n|        |             |        |\n|        |             |        |\n----------             ----------\n</code></pre>\n\n<p>This example doesn't handle what to do when the client closes the connection.</p>\n"}], "owner": {"reputation": 507, "user_id": 467526, "user_type": "registered", "accept_rate": 68, "profile_image": "https://www.gravatar.com/avatar/336abdba9ba141d3fef8e439b820a624?s=128&d=identicon&r=PG", "display_name": "user467526", "link": "https://stackoverflow.com/users/467526/user467526"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 309, "favorite_count": 1, "accepted_answer_id": 31945691, "answer_count": 1, "score": 3, "last_activity_date": 1439306177, "creation_date": 1439265287, "question_id": 31932931, "link": "https://stackoverflow.com/questions/31932931/is-there-a-way-to-have-a-conduit-take-data-from-multiple-sources-without-blockin", "title": "Is there a way to have a conduit take data from multiple sources without blocking any of them?", "body": "<p>I'm writing a server and one of the requirements is that it needs to be able to push data to clients without having the data directly requested by the client. I'm using conduits but it feels like this is beyond the capabilities of conduits. The problem that I run into is that there doesn't appear to be a way to tell if the socket has data available or not and await will block execution until there is data available. Let's say I have the following functions</p>\n\n<pre><code>getPacket :: Conduit ByteString IO ClientPacket --take a bytestring and yield a ClientPacket i.e. the ByteString deserialized into a sensible form\nprocessPacket :: Conduit ClientPacket IO ServerPacket --take a ClientPacket and yield a ServerPacket i.e. a response to the client's request\nputPacket :: Conduit ServerPacket IO ByteString --serialize the ServerPacket\n</code></pre>\n\n<p>then I connect the conduits together with the source and sink from the Conduit.Network library</p>\n\n<pre><code>appSource appData $$ getPacket =$= processPacket =$= putPacket $= appSink appData\n</code></pre>\n\n<p>Now, I introduce a source of data from outside the conduit and I want to incorporate that data into the conduit. For example, if this were a chat server the outside data would be messages sent by other clients. The problem is that no matter where I try to introduce this outside data, it'll get blocked by calls to await. Essentially, I'll end up with code that looks like this.</p>\n\n<pre><code>yield processOutsideData --deal with the outside data\ndata &lt;- await            --await data from upstream\n</code></pre>\n\n<p>The only way that more outside data will get processed is if an upstream component yields something, but upstream will only yield if it gets data from a client, which is exactly what I'm trying to avoid. I've tried using multiple threads and TChan to solve this, but it appears that the appSource and appSink must be used in the same thread otherwise I get invalid file descriptors exceptions from recv (which makes sense).</p>\n\n<p>However, if the socket source and sink are running in the same thread I once again run into the problem that await is blocking and I have no way of checking if data is available from the socket. At this point it seems like I have hit a wall with conduits.</p>\n\n<p>But I really do enjoy using conduits and would prefer to continue using them. So my questions is: is there a way to do what I'm trying to achieve with conduits?</p>\n"}, {"tags": ["html", "css", "haskell"], "answers": [{"comments": [{"owner": {"reputation": 4029, "user_id": 3224967, "user_type": "registered", "accept_rate": 72, "profile_image": "https://www.gravatar.com/avatar/963b108f3bcde98ac96d09b04abbf63f?s=128&d=identicon&r=PG&f=1", "display_name": "mherzl", "link": "https://stackoverflow.com/users/3224967/mherzl"}, "edited": false, "score": 0, "creation_date": 1439265546, "post_id": 31932694, "comment_id": 51777361, "body": "links &lt;- runX $ doc &gt;&gt;&gt; Text.HandsomeSoup.css &quot;a&quot; &gt;&gt;&gt; getChildren &gt;&gt;&gt; isText &gt;&gt;&gt; getText; That worked! Thank you!"}], "tags": [], "owner": {"reputation": 31243, "user_id": 2751851, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/4ddc0.png?s=128&g=1", "display_name": "duplode", "link": "https://stackoverflow.com/users/2751851/duplode"}, "is_accepted": true, "score": 2, "last_activity_date": 1439263534, "creation_date": 1439263534, "answer_id": 31932694, "question_id": 31932186, "link": "https://stackoverflow.com/questions/31932186/in-handsomesoup-how-do-i-select-the-inner-html-of-an-element/31932694#31932694", "title": "In HandsomeSoup, how do I select the inner html of an element?", "body": "<p>HandsomeSoup builds on top of hxt, and so you can use the (<em>vast</em>) API of hxt as well. More specifically, I believe that...</p>\n\n<pre><code>getChildren &gt;&gt;&gt; isText &gt;&gt;&gt; getText\n</code></pre>\n\n<p>... will extract the text contents from the elements. Here are the documentation entries for\n<a href=\"http://hackage.haskell.org/package/hxt-9.3.1.15/docs/Control-Arrow-ArrowTree.html#v:getChildren\" rel=\"nofollow\"><code>getChildren</code></a>, <a href=\"https://hackage.haskell.org/package/hxt-9.3.1.15/docs/Text-XML-HXT-Arrow-XmlArrow.html#v:isText\" rel=\"nofollow\"><code>isText</code></a> and <a href=\"https://hackage.haskell.org/package/hxt-9.3.1.15/docs/Text-XML-HXT-Arrow-XmlArrow.html#v:getText\" rel=\"nofollow\"><code>getText</code></a>. I suspect you'll also want something like <a href=\"https://hackage.haskell.org/package/hxt-9.3.1.15/docs/Text-XML-HXT-Arrow-XmlArrow.html#v:hasAttr\" rel=\"nofollow\"><code>hasAttrValue</code></a> to better specify which anchors you are interested in.</p>\n"}], "owner": {"reputation": 4029, "user_id": 3224967, "user_type": "registered", "accept_rate": 72, "profile_image": "https://www.gravatar.com/avatar/963b108f3bcde98ac96d09b04abbf63f?s=128&d=identicon&r=PG&f=1", "display_name": "mherzl", "link": "https://stackoverflow.com/users/3224967/mherzl"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 136, "favorite_count": 1, "accepted_answer_id": 31932694, "answer_count": 1, "score": 3, "last_activity_date": 1439263534, "creation_date": 1439259778, "last_edit_date": 1439262233, "question_id": 31932186, "link": "https://stackoverflow.com/questions/31932186/in-handsomesoup-how-do-i-select-the-inner-html-of-an-element", "title": "In HandsomeSoup, how do I select the inner html of an element?", "body": "<p>Say the html I'm parsing consists of the anchor tag:</p>\n\n<pre><code>&lt;a href=\"/here\"&gt;this is what I want&lt;/a&gt;\n</code></pre>\n\n<p>Using the example in the package documentation I can get the href string \"/here\" by:</p>\n\n<pre><code>links &lt;- runX $ doc &gt;&gt;&gt; Text.HandsomeSoup.css \"a\" ! \"href\"\n</code></pre>\n\n<p>But how do I get the inner html? The following is in the spirit of what I'm looking for but does not work:</p>\n\n<pre><code>links &lt;- runX $ doc &gt;&gt;&gt; Text.HandsomeSoup.css \"a\" ! \"value\"\n</code></pre>\n\n<p>I have looked through the HandsomeSoup documentation thoroughly and at this point am wondering if this is even possible. Any help would be much appreciated.</p>\n"}, {"tags": ["list", "haskell", "church-encoding", "equational-reasoning"], "comments": [{"owner": {"reputation": 126897, "user_id": 791604, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/ce991df7a056248d5e4f6fc3659ba733?s=128&d=identicon&r=PG", "display_name": "Daniel Wagner", "link": "https://stackoverflow.com/users/791604/daniel-wagner"}, "edited": false, "score": 6, "creation_date": 1439254165, "post_id": 31931432, "comment_id": 51774550, "body": "Yes, but it will involve hacking on a compiler... rank-2 type inference is decidable, but nobody&#39;s implemented it. Rank-3 type inference is undecidable (hence the existence of both <code>Rank2Types</code> and <code>RankNTypes</code>, even though they currently do the same thing)."}, {"owner": {"reputation": 44013, "user_id": 1477667, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/trgKM.jpg?s=128&g=1", "display_name": "dfeuer", "link": "https://stackoverflow.com/users/1477667/dfeuer"}, "edited": false, "score": 1, "creation_date": 1439254527, "post_id": 31931432, "comment_id": 51774634, "body": "It&#39;s very hard for me to understand what you mean by &quot;equational reasoning&quot; here. You&#39;re working with an isomorphism that is quite clearly not the usual equality."}, {"owner": {"reputation": 44680, "user_id": 1031791, "user_type": "registered", "accept_rate": 54, "profile_image": "https://www.gravatar.com/avatar/fb710534fda446d2286074bb7692e65a?s=128&d=identicon&r=PG", "display_name": "MaiaVictor", "link": "https://stackoverflow.com/users/1031791/maiavictor"}, "reply_to_user": {"reputation": 44013, "user_id": 1477667, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/trgKM.jpg?s=128&g=1", "display_name": "dfeuer", "link": "https://stackoverflow.com/users/1477667/dfeuer"}, "edited": false, "score": 1, "creation_date": 1439254586, "post_id": 31931432, "comment_id": 51774654, "body": "@dfeuer I&#39;m not sure I know what equational reasoning means, then. I assumed it meant you are free to always inline definitions / beta reduce functions."}, {"owner": {"reputation": 44013, "user_id": 1477667, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/trgKM.jpg?s=128&g=1", "display_name": "dfeuer", "link": "https://stackoverflow.com/users/1477667/dfeuer"}, "edited": false, "score": 1, "creation_date": 1439254683, "post_id": 31931432, "comment_id": 51774678, "body": "Ah, I think I misunderstood what you were doing. Sorry."}, {"owner": {"reputation": 44680, "user_id": 1031791, "user_type": "registered", "accept_rate": 54, "profile_image": "https://www.gravatar.com/avatar/fb710534fda446d2286074bb7692e65a?s=128&d=identicon&r=PG", "display_name": "MaiaVictor", "link": "https://stackoverflow.com/users/1031791/maiavictor"}, "edited": false, "score": 4, "creation_date": 1439254970, "post_id": 31931432, "comment_id": 51774743, "body": "It is okay, I don&#39;t know too."}, {"owner": {"reputation": 44680, "user_id": 1031791, "user_type": "registered", "accept_rate": 54, "profile_image": "https://www.gravatar.com/avatar/fb710534fda446d2286074bb7692e65a?s=128&d=identicon&r=PG", "display_name": "MaiaVictor", "link": "https://stackoverflow.com/users/1031791/maiavictor"}, "reply_to_user": {"reputation": 126897, "user_id": 791604, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/ce991df7a056248d5e4f6fc3659ba733?s=128&d=identicon&r=PG", "display_name": "Daniel Wagner", "link": "https://stackoverflow.com/users/791604/daniel-wagner"}, "edited": false, "score": 0, "creation_date": 1439255108, "post_id": 31931432, "comment_id": 51774786, "body": "@DanielWagner okay then, I guess. :("}, {"owner": {"reputation": 126897, "user_id": 791604, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/ce991df7a056248d5e4f6fc3659ba733?s=128&d=identicon&r=PG", "display_name": "Daniel Wagner", "link": "https://stackoverflow.com/users/791604/daniel-wagner"}, "edited": false, "score": 1, "creation_date": 1439255678, "post_id": 31931432, "comment_id": 51774932, "body": "@Viclib You could of course also use the rank-1 version of the Church encoding, <code>type List r a = (a -&gt; r -&gt; r) -&gt; r -&gt; r</code>, and be careful that you never provide something monomorphic as the first argument of <code>List</code>. It is sad that you can&#39;t get the compiler to help you check that, but is also a <i>lot</i> less work."}, {"owner": {"reputation": 44680, "user_id": 1031791, "user_type": "registered", "accept_rate": 54, "profile_image": "https://www.gravatar.com/avatar/fb710534fda446d2286074bb7692e65a?s=128&d=identicon&r=PG", "display_name": "MaiaVictor", "link": "https://stackoverflow.com/users/1031791/maiavictor"}, "edited": false, "score": 0, "creation_date": 1439256275, "post_id": 31931432, "comment_id": 51775093, "body": "Well, that is what I was using before, but then how you write <code>head</code>? I tried and it couldn&#39;t typecheck for good."}, {"owner": {"reputation": 126897, "user_id": 791604, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/ce991df7a056248d5e4f6fc3659ba733?s=128&d=identicon&r=PG", "display_name": "Daniel Wagner", "link": "https://stackoverflow.com/users/791604/daniel-wagner"}, "edited": false, "score": 1, "creation_date": 1439256416, "post_id": 31931432, "comment_id": 51775126, "body": "@Viclib Remember that it&#39;s okay to specialize to the left of arrows. So I would guess <code>head :: List (Maybe a) a -&gt; Maybe a; head f = f Just Nothing</code> or <code>unsafeHead :: List a a -&gt; a; unsafeHead f = f id undefined</code>."}, {"owner": {"reputation": 28873, "user_id": 1068232, "user_type": "registered", "accept_rate": 79, "profile_image": "https://www.gravatar.com/avatar/2a0a145ce58c20013969fe3f203531da?s=128&d=identicon&r=PG", "display_name": "Andr&#225;s Kov&#225;cs", "link": "https://stackoverflow.com/users/1068232/andr%c3%a1s-kov%c3%a1cs"}, "edited": false, "score": 4, "creation_date": 1439281763, "post_id": 31931432, "comment_id": 51784367, "body": "Note that <code>[a] -&gt; List a</code> is a type that <a href=\"http://stackoverflow.com/questions/31627124/rankntypes-and-the-dot-operator/31629197#31629197\">doesn&#39;t actually exist</a> in GHC, which makes <code>sum_ . toList</code> just plain ill-typed."}], "answers": [{"comments": [{"owner": {"reputation": 44680, "user_id": 1031791, "user_type": "registered", "accept_rate": 54, "profile_image": "https://www.gravatar.com/avatar/fb710534fda446d2286074bb7692e65a?s=128&d=identicon&r=PG", "display_name": "MaiaVictor", "link": "https://stackoverflow.com/users/1031791/maiavictor"}, "edited": false, "score": 2, "creation_date": 1439259317, "post_id": 31931792, "comment_id": 51775849, "body": "That again... I think I&#39;ll just lose the fear and start adopting unsafeCoerce on my vocabulary. You&#39;re creating a monster, sir."}, {"owner": {"reputation": 126897, "user_id": 791604, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/ce991df7a056248d5e4f6fc3659ba733?s=128&d=identicon&r=PG", "display_name": "Daniel Wagner", "link": "https://stackoverflow.com/users/791604/daniel-wagner"}, "reply_to_user": {"reputation": 44013, "user_id": 1477667, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/trgKM.jpg?s=128&g=1", "display_name": "dfeuer", "link": "https://stackoverflow.com/users/1477667/dfeuer"}, "edited": false, "score": 0, "creation_date": 1439261568, "post_id": 31931792, "comment_id": 51776407, "body": "@dfeuer What do you propose instead?"}, {"owner": {"reputation": 44013, "user_id": 1477667, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/trgKM.jpg?s=128&g=1", "display_name": "dfeuer", "link": "https://stackoverflow.com/users/1477667/dfeuer"}, "edited": false, "score": 9, "creation_date": 1439261870, "post_id": 31931792, "comment_id": 51776483, "body": "Dunno. Not that. Sometimes the cure is worse than the disease. I don&#39;t really see the problem that needs to be solved here."}, {"owner": {"reputation": 44680, "user_id": 1031791, "user_type": "registered", "accept_rate": 54, "profile_image": "https://www.gravatar.com/avatar/fb710534fda446d2286074bb7692e65a?s=128&d=identicon&r=PG", "display_name": "MaiaVictor", "link": "https://stackoverflow.com/users/1031791/maiavictor"}, "edited": false, "score": 2, "creation_date": 1439262379, "post_id": 31931792, "comment_id": 51776614, "body": "This isn&#39;t really constructive but I love dfeuer&#39;s reaction, no less than I expected heh"}, {"owner": {"reputation": 44680, "user_id": 1031791, "user_type": "registered", "accept_rate": 54, "profile_image": "https://www.gravatar.com/avatar/fb710534fda446d2286074bb7692e65a?s=128&d=identicon&r=PG", "display_name": "MaiaVictor", "link": "https://stackoverflow.com/users/1031791/maiavictor"}, "edited": false, "score": 0, "creation_date": 1439262512, "post_id": 31931792, "comment_id": 51776654, "body": "(I still don&#39;t understand why Haskellers love the type system so much more than they love equational reasoning... I just tend to think nothing in the world comes before it, not even types.)"}, {"owner": {"reputation": 126897, "user_id": 791604, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/ce991df7a056248d5e4f6fc3659ba733?s=128&d=identicon&r=PG", "display_name": "Daniel Wagner", "link": "https://stackoverflow.com/users/791604/daniel-wagner"}, "reply_to_user": {"reputation": 44680, "user_id": 1031791, "user_type": "registered", "accept_rate": 54, "profile_image": "https://www.gravatar.com/avatar/fb710534fda446d2286074bb7692e65a?s=128&d=identicon&r=PG", "display_name": "MaiaVictor", "link": "https://stackoverflow.com/users/1031791/maiavictor"}, "edited": false, "score": 1, "creation_date": 1439265420, "post_id": 31931792, "comment_id": 51777330, "body": "@Viclib I think you should keep your fear. It might be a good idea to try to prove that <code>unsafeCoerce</code> is actually safe -- perhaps the free theorem for <code>List a</code> (or maybe <code>Void</code>?) will tell you what you need to know."}, {"owner": {"reputation": 22266, "user_id": 649287, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/7c0ea0055b84020bf860c05f53ba53d5?s=128&d=identicon&r=PG", "display_name": "augustss", "link": "https://stackoverflow.com/users/649287/augustss"}, "edited": false, "score": 4, "creation_date": 1439268001, "post_id": 31931792, "comment_id": 51778023, "body": "That&#39;s horrible. There are no guarantees about unsafeCoerce in general. Any use outside implementation specific modules should be punished in the harshest possible way."}, {"owner": {"reputation": 44680, "user_id": 1031791, "user_type": "registered", "accept_rate": 54, "profile_image": "https://www.gravatar.com/avatar/fb710534fda446d2286074bb7692e65a?s=128&d=identicon&r=PG", "display_name": "MaiaVictor", "link": "https://stackoverflow.com/users/1031791/maiavictor"}, "reply_to_user": {"reputation": 22266, "user_id": 649287, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/7c0ea0055b84020bf860c05f53ba53d5?s=128&d=identicon&r=PG", "display_name": "augustss", "link": "https://stackoverflow.com/users/649287/augustss"}, "edited": false, "score": 1, "creation_date": 1439268587, "post_id": 31931792, "comment_id": 51778180, "body": "@augustss I think &quot;the compiler doesn&#39;t have inference for Rank2Types yet&quot; is one of the perfectly valid excuses. After all, it means the term <i>is</i> correct. Using unsafeCoerce and providing a separated proof looks as acceptable as it gets. Why not?"}, {"owner": {"reputation": 126897, "user_id": 791604, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/ce991df7a056248d5e4f6fc3659ba733?s=128&d=identicon&r=PG", "display_name": "Daniel Wagner", "link": "https://stackoverflow.com/users/791604/daniel-wagner"}, "reply_to_user": {"reputation": 22266, "user_id": 649287, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/7c0ea0055b84020bf860c05f53ba53d5?s=128&d=identicon&r=PG", "display_name": "augustss", "link": "https://stackoverflow.com/users/649287/augustss"}, "edited": false, "score": 0, "creation_date": 1439271945, "post_id": 31931792, "comment_id": 51779248, "body": "@augustss I look forward to your proposal for an improved alternative."}, {"owner": {"reputation": 100185, "user_id": 3234959, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/93bb12ca0f93dfddb33880316f7e66c2?s=128&d=identicon&r=PG&f=1", "display_name": "chi", "link": "https://stackoverflow.com/users/3234959/chi"}, "edited": false, "score": 4, "creation_date": 1439282293, "post_id": 31931792, "comment_id": 51784659, "body": "After type checking, my ideal compiler would optimize <code>f :: T -&gt; Void</code> as roughly <code>\\_ -&gt; undefined</code>, and <code>g :: T -&gt; ()</code> as <code>\\_ -&gt; ()</code> when a termination checker succeeds (similarly for other single-value types, e.g. <code>a:~:b</code>). Since GHC is not (yet) that smart, I guess <code>unsafeCoerce</code> should work, for now. It looks quite dangerous, though."}, {"owner": {"reputation": 9455, "user_id": 1172541, "user_type": "registered", "accept_rate": 30, "profile_image": "https://i.stack.imgur.com/LROoN.png?s=128&g=1", "display_name": "PyRulez", "link": "https://stackoverflow.com/users/1172541/pyrulez"}, "edited": false, "score": 0, "creation_date": 1453768252, "post_id": 31931792, "comment_id": 57737954, "body": "How does this enable equational reasoning?"}, {"owner": {"reputation": 126897, "user_id": 791604, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/ce991df7a056248d5e4f6fc3659ba733?s=128&d=identicon&r=PG", "display_name": "Daniel Wagner", "link": "https://stackoverflow.com/users/791604/daniel-wagner"}, "reply_to_user": {"reputation": 9455, "user_id": 1172541, "user_type": "registered", "accept_rate": 30, "profile_image": "https://i.stack.imgur.com/LROoN.png?s=128&g=1", "display_name": "PyRulez", "link": "https://stackoverflow.com/users/1172541/pyrulez"}, "edited": false, "score": 0, "creation_date": 1453769760, "post_id": 31931792, "comment_id": 57738435, "body": "@PyRulez The complaint in the question is that <code>sum_ . toList</code> and <code>\\a -&gt; sum_ (toList a)</code> do not have the same type (one does not even type-check using the code in the question). With my setup, these two terms do indeed both typecheck and produce the same type."}], "tags": [], "owner": {"reputation": 126897, "user_id": 791604, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/ce991df7a056248d5e4f6fc3659ba733?s=128&d=identicon&r=PG", "display_name": "Daniel Wagner", "link": "https://stackoverflow.com/users/791604/daniel-wagner"}, "is_accepted": false, "score": 9, "last_activity_date": 1439256625, "creation_date": 1439256625, "answer_id": 31931792, "question_id": 31931432, "link": "https://stackoverflow.com/questions/31931432/is-it-possible-to-use-church-encodings-without-breaking-equational-reasoning/31931792#31931792", "title": "Is it possible to use church encodings without breaking equational reasoning?", "body": "<p>Here is a somewhat frightening trick you could try. Everywhere you would have a rank-2 type variable, use an empty type instead; and everywhere you would pick an instantiation of the type variable, use <code>unsafeCoerce</code>. Using an empty type ensures (so much as it's possible) that you don't do anything that can observe what should be an unobservable value. Hence:</p>\n\n<pre><code>import Data.Void\nimport Unsafe.Coerce\n\ntype List a = (a -&gt; Void -&gt; Void) -&gt; Void -&gt; Void\n\ntoList :: [a] -&gt; List a\ntoList xs = \\cons nil -&gt; foldr cons nil xs\n\nsum_ :: Num a =&gt; List a -&gt; a\nsum_ xs = unsafeCoerce xs (+) 0\n\nmain :: IO ()\nmain = print (sum_ . toList $ [1,2,3])\n</code></pre>\n\n<p>You might like to write a slightly safer version of <code>unsafeCoerce</code>, like:</p>\n\n<pre><code>instantiate :: List a -&gt; (a -&gt; r -&gt; r) -&gt; r -&gt; r\ninstantiate = unsafeCoerce\n</code></pre>\n\n<p>Then <code>sum_ xs = instantiate xs (+) 0</code> works just fine as an alternative definition, and you don't run the risk of turning your <code>List a</code> into something TRULY arbitrary.</p>\n"}, {"comments": [{"owner": {"reputation": 22266, "user_id": 649287, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/7c0ea0055b84020bf860c05f53ba53d5?s=128&d=identicon&r=PG", "display_name": "augustss", "link": "https://stackoverflow.com/users/649287/augustss"}, "edited": false, "score": 4, "creation_date": 1439304925, "post_id": 31942453, "comment_id": 51800292, "body": "This is indeed how you should define <code>List</code>.  GHC has a rather second class treatment of rank-n types, and using them without a newtype wrapper is going to hurt."}, {"owner": {"reputation": 126897, "user_id": 791604, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/ce991df7a056248d5e4f6fc3659ba733?s=128&d=identicon&r=PG", "display_name": "Daniel Wagner", "link": "https://stackoverflow.com/users/791604/daniel-wagner"}, "edited": false, "score": 0, "creation_date": 1439313036, "post_id": 31942453, "comment_id": 51805442, "body": "Great answer, I hope yours gets accepted over mine. =D"}, {"owner": {"reputation": 9455, "user_id": 1172541, "user_type": "registered", "accept_rate": 30, "profile_image": "https://i.stack.imgur.com/LROoN.png?s=128&g=1", "display_name": "PyRulez", "link": "https://stackoverflow.com/users/1172541/pyrulez"}, "edited": false, "score": 0, "creation_date": 1440958181, "post_id": 31942453, "comment_id": 52475637, "body": "It should also be noted that <code>newtypes</code> add no overhead."}], "tags": [], "owner": {"reputation": 11001, "user_id": 727667, "user_type": "registered", "accept_rate": 88, "profile_image": "https://www.gravatar.com/avatar/2e2cbd3a202d8d1cfe0cc2a9fff86733?s=128&d=identicon&r=PG", "display_name": "gallais", "link": "https://stackoverflow.com/users/727667/gallais"}, "is_accepted": true, "score": 13, "last_activity_date": 1439297816, "creation_date": 1439297816, "answer_id": 31942453, "question_id": 31931432, "link": "https://stackoverflow.com/questions/31931432/is-it-possible-to-use-church-encodings-without-breaking-equational-reasoning/31942453#31942453", "title": "Is it possible to use church encodings without breaking equational reasoning?", "body": "<p>I have the impression that ghc percolates all for-alls as left as possible:</p>\n\n<pre><code>forall a t. [a] -&gt; (a -&gt; t -&gt; t) -&gt; t -&gt; t)\n</code></pre>\n\n<p>and</p>\n\n<pre><code>forall a. [a] -&gt; forall t . (h -&gt; t -&gt; t) -&gt; t -&gt; t\n</code></pre>\n\n<p>can be used interchangeably as witnessed by:</p>\n\n<pre><code>toList' :: forall a t. [a] -&gt; (a -&gt; t -&gt; t) -&gt; t -&gt; t\ntoList' = toList\n\ntoList :: [a] -&gt; List a\ntoList = toList'\n</code></pre>\n\n<p>Which could explain why <code>sum</code>'s type cannot be checked. You can avoid this sort of issues by packaging your polymorphic definition in a <code>newtype</code> wrapper to avoid such <a href=\"https://downloads.haskell.org/~ghc/6.4-latest/docs/html/users_guide/type-extensions.html#hoist\">hoisting</a> (that paragraph does not appear in newer versions of the doc hence my using the conditional earlier).</p>\n\n<pre><code>{-# LANGUAGE RankNTypes #-}\nimport Prelude hiding (sum)\n\nnewtype List h = List { runList :: forall t . (h -&gt; t -&gt; t) -&gt; t -&gt; t }\n\nsum_ :: (Num a) =&gt; List a -&gt; a\nsum_ xs = runList xs (+) 0\n\ntoList :: [a] -&gt; List a\ntoList xs = List $ \\ c n -&gt; foldr c n xs\n\nsum :: (Num a) =&gt; [a] -&gt; a\nsum = sum_ . toList\n\nmain = print (sum [1,2,3])\n</code></pre>\n"}, {"tags": [], "owner": {"reputation": 64094, "user_id": 476408, "user_type": "registered", "accept_rate": 70, "profile_image": "https://www.gravatar.com/avatar/2bc1bffafe7aa29ef900b98d1fd1e94e?s=128&d=identicon&r=PG", "display_name": "J. Abrahamson", "link": "https://stackoverflow.com/users/476408/j-abrahamson"}, "is_accepted": false, "score": 6, "last_activity_date": 1439308409, "creation_date": 1439308409, "answer_id": 31946483, "question_id": 31931432, "link": "https://stackoverflow.com/questions/31931432/is-it-possible-to-use-church-encodings-without-breaking-equational-reasoning/31946483#31946483", "title": "Is it possible to use church encodings without breaking equational reasoning?", "body": "<p>Generally equational reasoning only holds in the \"underlying System F\" that Haskell represents. In this case, as others have noted, you're getting tripped up because Haskell moves <code>forall</code>s leftward <em>and</em> automatically applies the proper types at various points. You can fix it by providing cues as to where type application should occur via <code>newtype</code> wrappers. As you've seen you can also manipulate when type application occurs by eta expansion since the Hindley-Milner typing rules are different for <code>let</code> and for lambda: <code>forall</code>s are introduced via the \"generalization\" rule, by default, at <code>let</code>s (and other, equivalent named bindings) alone.</p>\n"}], "owner": {"reputation": 44680, "user_id": 1031791, "user_type": "registered", "accept_rate": 54, "profile_image": "https://www.gravatar.com/avatar/fb710534fda446d2286074bb7692e65a?s=128&d=identicon&r=PG", "display_name": "MaiaVictor", "link": "https://stackoverflow.com/users/1031791/maiavictor"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 296, "favorite_count": 3, "accepted_answer_id": 31942453, "answer_count": 3, "score": 14, "last_activity_date": 1439308409, "creation_date": 1439253929, "question_id": 31931432, "link": "https://stackoverflow.com/questions/31931432/is-it-possible-to-use-church-encodings-without-breaking-equational-reasoning", "title": "Is it possible to use church encodings without breaking equational reasoning?", "body": "<p>Mind this program:</p>\n\n<pre><code>{-# LANGUAGE RankNTypes #-}\n\nimport Prelude hiding (sum)\n\ntype List h = forall t . (h -&gt; t -&gt; t) -&gt; t -&gt; t\n\nsum_ :: (Num a) =&gt; List a -&gt; a\nsum_ = \\ list -&gt; list (+) 0\n\ntoList :: [a] -&gt; List a\ntoList = \\ list cons nil -&gt; foldr cons nil list\n\nsum :: (Num a) =&gt; [a] -&gt; a\n-- sum = sum_ . toList        -- does not work\nsum = \\ a -&gt; sum_ (toList a)  -- works\n\nmain = print (sum [1,2,3])\n</code></pre>\n\n<p>Both definitions of sum are identical up to equational reasoning. Yet, compiling the second definition of works, but the first one doesn't, with this error:</p>\n\n<pre><code>tmpdel.hs:17:14:\n    Couldn't match type \u2018(a -&gt; t0 -&gt; t0) -&gt; t0 -&gt; t0\u2019\n                  with \u2018forall t. (a -&gt; t -&gt; t) -&gt; t -&gt; t\u2019\n    Expected type: [a] -&gt; List a\n      Actual type: [a] -&gt; (a -&gt; t0 -&gt; t0) -&gt; t0 -&gt; t0\n    Relevant bindings include sum :: [a] -&gt; a (bound at tmpdel.hs:17:1)\n    In the second argument of \u2018(.)\u2019, namely \u2018toList\u2019\n    In the expression: sum_ . toList\n</code></pre>\n\n<p>It seems that <code>RankNTypes</code> breaks equational reasoning. Is there any way to have church-encoded lists in Haskell without breaking it??</p>\n"}, {"tags": ["haskell"], "answers": [{"tags": [], "owner": {"reputation": 75362, "user_id": 625403, "user_type": "registered", "accept_rate": 82, "profile_image": "https://www.gravatar.com/avatar/786eed7da67079cb5d63a49d469af25b?s=128&d=identicon&r=PG", "display_name": "amalloy", "link": "https://stackoverflow.com/users/625403/amalloy"}, "is_accepted": false, "score": 2, "last_activity_date": 1439251000, "creation_date": 1439251000, "answer_id": 31931019, "question_id": 31930861, "link": "https://stackoverflow.com/questions/31930861/overlapping-sum-types/31931019#31931019", "title": "Overlapping sum types", "body": "<p>You can perfectly well do this with just ordinary ADTs - the only reason you're having trouble is because of the name conflict between the two data constructors:</p>\n\n<pre><code>Set :: Text -&gt; Text -&gt; GlobalDirective\nSet :: Text -&gt; Text -&gt; LocalDirective\n</code></pre>\n\n<p>The simplest solution would be to just give them different names:</p>\n\n<pre><code>data GlobalDirective = Listen Text | VirtualHost Text | GSet Text Text\ndata LocalDirective = Path Text | LSet Text Text\n</code></pre>\n\n<p>That might even make the most semantic sense, if global sets are different from local sets in some way. Of course, you can't pass a generic <code>Set</code> to any function, because it has to know whether it's getting a global or local set. So you can clean this up a bit by defining a reusable <code>Set</code> that holds two <code>Text</code>s, and pass that around instead:</p>\n\n<pre><code>data Set = Set Text Text\ndata GlobalDirective = Listen Text | VirtualHost Text | GSet Set\ndata LocalDirective = Path Text | LSet Set\n\nwhatever :: Set -&gt; Bool\nwhatever (Set name value) = True\n\nhandle :: LocalDirective -&gt; Bool\nhandle (Path _) = False\nhandle (LSet s) = whatever s\n</code></pre>\n\n<p>Given how simple this is to do with ordinary ADTs, I don't think there is any need to bring in fancier stuff like existential types or typeclasses.</p>\n"}, {"tags": [], "owner": {"reputation": 126897, "user_id": 791604, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/ce991df7a056248d5e4f6fc3659ba733?s=128&d=identicon&r=PG", "display_name": "Daniel Wagner", "link": "https://stackoverflow.com/users/791604/daniel-wagner"}, "is_accepted": true, "score": 5, "last_activity_date": 1439281024, "last_edit_date": 1439281024, "creation_date": 1439258263, "answer_id": 31932001, "question_id": 31930861, "link": "https://stackoverflow.com/questions/31930861/overlapping-sum-types/31932001#31932001", "title": "Overlapping sum types", "body": "<p>One possibility would be to have a GADT with a phantom parameter:</p>\n\n<pre><code>{-# LANGUAGE GADTs, DataKinds #-}\nimport Data.Text\ndata Scope = Local | Global\ndata Directive a where\n    Set         :: Text -&gt; Text -&gt; Directive a\n    Path        :: Text -&gt; Directive Local\n    Listen      :: Text -&gt; Directive Global\n    VirtualHost :: Text -&gt; Directive Global\n</code></pre>\n\n<p>You can see in ghci that this gives some pretty nice inference:</p>\n\n<pre><code>&gt; :set -XOverloadedStrings\n&gt; :t [Set \"error_page\" \"oops.html\", Path \"/var/www\"]\n[Set \"error_page\" \"oops.html\", Path \"/var/www\"] :: [Directive 'Local]\n</code></pre>\n"}], "owner": {"reputation": 3, "user_id": 5212926, "user_type": "registered", "profile_image": "https://graph.facebook.com/1007166375983223/picture?type=large", "display_name": "Alexander Polakov", "link": "https://stackoverflow.com/users/5212926/alexander-polakov"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 99, "favorite_count": 0, "accepted_answer_id": 31932001, "answer_count": 2, "score": 0, "last_activity_date": 1439281024, "creation_date": 1439249737, "question_id": 31930861, "link": "https://stackoverflow.com/questions/31930861/overlapping-sum-types", "title": "Overlapping sum types", "body": "<p>Imagine I'm writing a webserver, and I want my config to look like this (took some inspiration from nginx):</p>\n\n<pre><code>listen = \"localhost\"\nset error_page = \"fail.html\"\n\nvhost \"hello\" {\n  set error_page = \"oops.html\"\n  path = \"/var/www/hello/public_html\"\n}\n</code></pre>\n\n<p>Some directives, like <code>Listen</code>, can only be used in global scope, others are only available in vhost scope (<code>Path</code>), and some, like <code>Set</code>, are universal, which means I can't use regular ADTs like this:</p>\n\n<pre><code>data GlobalDirective = Listen Text | VirtualHost Text | Set Text Text\ndata LocalDirective = Path Text | Set Text Text\n</code></pre>\n\n<p>So I write this code which seems to reflect my mental model:</p>\n\n<pre><code>class Show a =&gt; Directive a \nclass Directive a =&gt; GlobalDirective a\nclass Directive a =&gt; LocalDirective a\n\ndata GlobalConfig where\n    GlobalDirectives :: forall a. GlobalDirective a =&gt; [a] -&gt; GlobalConfig \ninstance Show GlobalConfig where\n    show (GlobalDirectives xs) = \"Config\" ++ show xs\n\ndata VirtualHost where  \n    VirtualHostDirectives :: forall a. LocalDirective a =&gt; Text -&gt; [a] -&gt; VirtualHost \ninstance Directive VirtualHost\ninstance GlobalDirective VirtualHost\ninstance Show VirtualHost where\n    show (VirtualHostDirectives name xs) = \"VirtualHost[\" ++ show name ++ \"]\" ++ show xs\n\ndata Listen = Listen Text deriving (Show) \ninstance Directive Listen\ninstance GlobalDirective Listen\n\ndata Set = Set Text Text deriving (Show)\ninstance Directive Set\ninstance GlobalDirective Set\ninstance LocalDirective Set\n\ndata Path = Path Text deriving (Show)\ninstance Directive Path\ninstance LocalDirective Path\n</code></pre>\n\n<p>The problem is that I can't actually construct the config:</p>\n\n<pre><code>&gt; VirtualHostDirectives (Text.pack \"hello\") [Set (Text.pack \"error_page\") (Text.pack \"oops.html\"), Path (Text.pack \"/var/www\") ]\n\n&lt;interactive&gt;:139:98:\n    Couldn't match expected type \u2018Set\u2019 with actual type \u2018Path\u2019\n    In the expression: Path (Text.pack \"/var/www\")\n    In the second argument of \u2018VirtualHostDirectives\u2019, namely\n      \u2018[Set (Text.pack \"error_page\") (Text.pack \"oops.html\"),\n        Path (Text.pack \"/var/www\")]\u2019\n</code></pre>\n\n<p>This looks like a case for an existential quantification hack:</p>\n\n<pre><code>data AnyDirective a = forall a. Directive a =&gt; AnyDirective a\ninstance Directive (AnyDirective a)\ninstance Show (AnyDirective a) where\n    show (AnyDirective a) = show a\ninstance GlobalDirective a =&gt; GlobalDirective (AnyDirective a)\ninstance LocalDirective a =&gt; LocalDirective (AnyDirective a)\n</code></pre>\n\n<p>...but it doesn't work either:</p>\n\n<pre><code>*Main&gt; VirtualHostDirectives (Text.pack \"hello\") [AnyDirective $ Set (Text.pack \"error_page\") (Text.pack \"oops.html\"), AnyDirective $ Path (Text.pack \"/var/www\") ]\n\n&lt;interactive&gt;:134:1:\n    No instance for (LocalDirective a0)\n      arising from a use of \u2018VirtualHostDirectives\u2019\n    The type variable \u2018a0\u2019 is ambiguous\n    Note: there are several potential instances:\n      instance LocalDirective Path -- Defined at src/Main.hs:167:10\n      instance LocalDirective Set -- Defined at src/Main.hs:163:10\n      instance LocalDirective a =&gt; LocalDirective (AnyDirective a)\n        -- Defined at src/Main.hs:142:10\n    In the expression:\n      VirtualHostDirectives\n        (Text.pack \"hello\")\n        [AnyDirective\n         $ Set (Text.pack \"error_page\") (Text.pack \"oops.html\"),\n         AnyDirective $ Path (Text.pack \"/var/www\")]\n    In an equation for \u2018it\u2019:\n        it\n          = VirtualHostDirectives\n              (Text.pack \"hello\")\n              [AnyDirective\n               $ Set (Text.pack \"error_page\") (Text.pack \"oops.html\"),\n               AnyDirective $ Path (Text.pack \"/var/www\")]\n</code></pre>\n\n<p>So, what are my options here? </p>\n"}, {"tags": ["haskell", "module", "typeclass"], "comments": [{"owner": {"reputation": 48129, "user_id": 76051, "user_type": "registered", "accept_rate": 91, "profile_image": "https://i.stack.imgur.com/AGDxz.jpg?s=128&g=1", "display_name": "Carsten", "link": "https://stackoverflow.com/users/76051/carsten"}, "edited": false, "score": 0, "creation_date": 1439240368, "post_id": 31928840, "comment_id": 51770157, "body": "I think in this case you&#39;ll want to use an explicit export section on your <code>module</code> definition: <a href=\"https://www.haskell.org/onlinereport/modules.html\" rel=\"nofollow noreferrer\">haskell.org/onlinereport/modules.html</a>"}, {"owner": {"reputation": 13734, "user_id": 938694, "user_type": "registered", "accept_rate": 59, "profile_image": "https://www.gravatar.com/avatar/b6678a430a805dd78366d6e135b49f2d?s=128&d=identicon&r=PG", "display_name": "Cubic", "link": "https://stackoverflow.com/users/938694/cubic"}, "edited": false, "score": 3, "creation_date": 1439242495, "post_id": 31928840, "comment_id": 51771119, "body": "You may be interested in <a href=\"https://hackage.haskell.org/package/classy-prelude\" rel=\"nofollow noreferrer\">classy-prelude</a> which does many of these things. Also, starting with 7.10 many of the prelude functions are now re-exports of Foldable/Traversable instead of the list-specialized versions."}], "answers": [{"comments": [{"owner": {"reputation": 48129, "user_id": 76051, "user_type": "registered", "accept_rate": 91, "profile_image": "https://i.stack.imgur.com/AGDxz.jpg?s=128&g=1", "display_name": "Carsten", "link": "https://stackoverflow.com/users/76051/carsten"}, "edited": false, "score": 4, "creation_date": 1439240492, "post_id": 31929060, "comment_id": 51770215, "body": "as you can export a complete <code>module</code> as well you could split your <code>Common</code> into two parts (one with your methods where you export everything and then one <i>wrapped</i> around this that will export your desired classes and the complete <i>inner</i> module as well"}, {"owner": {"reputation": 44680, "user_id": 1031791, "user_type": "registered", "accept_rate": 54, "profile_image": "https://www.gravatar.com/avatar/fb710534fda446d2286074bb7692e65a?s=128&d=identicon&r=PG", "display_name": "MaiaVictor", "link": "https://stackoverflow.com/users/1031791/maiavictor"}, "reply_to_user": {"reputation": 48129, "user_id": 76051, "user_type": "registered", "accept_rate": 91, "profile_image": "https://i.stack.imgur.com/AGDxz.jpg?s=128&g=1", "display_name": "Carsten", "link": "https://stackoverflow.com/users/76051/carsten"}, "edited": false, "score": 0, "creation_date": 1439240577, "post_id": 31929060, "comment_id": 51770264, "body": "That is a great idea @Carsten. Thank you both!"}, {"owner": {"reputation": 13734, "user_id": 938694, "user_type": "registered", "accept_rate": 59, "profile_image": "https://www.gravatar.com/avatar/b6678a430a805dd78366d6e135b49f2d?s=128&d=identicon&r=PG", "display_name": "Cubic", "link": "https://stackoverflow.com/users/938694/cubic"}, "reply_to_user": {"reputation": 48129, "user_id": 76051, "user_type": "registered", "accept_rate": 91, "profile_image": "https://i.stack.imgur.com/AGDxz.jpg?s=128&g=1", "display_name": "Carsten", "link": "https://stackoverflow.com/users/76051/carsten"}, "edited": false, "score": 3, "creation_date": 1439240647, "post_id": 31929060, "comment_id": 51770302, "body": "@Carsten I am currently writing an edit to that effect."}, {"owner": {"reputation": 126897, "user_id": 791604, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/ce991df7a056248d5e4f6fc3659ba733?s=128&d=identicon&r=PG", "display_name": "Daniel Wagner", "link": "https://stackoverflow.com/users/791604/daniel-wagner"}, "edited": false, "score": 3, "creation_date": 1439242775, "post_id": 31929060, "comment_id": 51771225, "body": "Note that <code>module Common (module Common) where ...</code> is perfectly valid, and means the same as <code>module Common where ...</code>. So it would be pretty easy to export everything + <code>Show</code> by writing <code>module Common (module Common, Show(..)) where ...</code>."}], "tags": [], "owner": {"reputation": 13734, "user_id": 938694, "user_type": "registered", "accept_rate": 59, "profile_image": "https://www.gravatar.com/avatar/b6678a430a805dd78366d6e135b49f2d?s=128&d=identicon&r=PG", "display_name": "Cubic", "link": "https://stackoverflow.com/users/938694/cubic"}, "is_accepted": true, "score": 10, "last_activity_date": 1439242060, "last_edit_date": 1439242060, "creation_date": 1439240365, "answer_id": 31929060, "question_id": 31928840, "link": "https://stackoverflow.com/questions/31928840/how-do-i-export-typeclasses/31929060#31929060", "title": "How do I export typeclasses?", "body": "<p>You have to explicitly re-export type classes (meaning you'll also have to explicitly export everything else), i.e.</p>\n\n<p>Your Prelude:</p>\n\n<pre><code>module CustomPrelude (\n  sum,\n  product,\n  Prelude.IO,\n  Prelude.String,\n  Prelude.print,\n  Prelude.Show,\n  Prelude.show,\n  (Prelude.$),\n  Prelude.Int,\n  (++)\n  )\nwhere\n\nimport qualified Prelude\nimport Data.Foldable\nimport Data.Monoid\n\n(++) :: Monoid m =&gt; m -&gt; m -&gt; m\n(++) = mappend\n</code></pre>\n\n<p>Usage:</p>\n\n<pre><code>{-# LANGUAGE NoImplicitPrelude #-}\nmodule PreludeTest where\n\nimport CustomPrelude\n\ndata A x = A x x\n\ninstance Show x =&gt; Show (A x) where\n    show (A x y) = \"A \" ++ show x ++ \" \" ++ show y\n\nmain :: IO ()\nmain = print $ A (1::Int) 2\n</code></pre>\n\n<hr>\n\n<p>To save yourself some typing (and to keep your sanity while editing), you'd probably want to do:\nA) Split your new prelude into several specialized files\nB) Do module exports so you don't have to explicitly repeat everything</p>\n\n<p>E.g.:</p>\n\n<pre><code>module CustomPrelude.Classes (Show,show,Functor,fmap, Monoid,mempty,mappend, Monad,return,(&gt;&gt;=))\nwhere\n\nimport Data.Monoid\n</code></pre>\n\n<hr>\n\n<pre><code>module CustomPrelude.Functions (\n  module ReExport,\n  Prelude.print,\n  Prelude.IO, -- ok these technically aren't functions, but I didn't want to make yet another module just for demonstration purposes\n  Prelude.String,\n  Prelude.Int,\n  (Prelude.$),\n  (++)\n)\nwhere\n\nimport qualified Prelude\nimport Data.Foldable as ReExport\nimport Data.Traversable as ReExport\nimport Data.Monoid as ReExport\n\n\n(++) :: Monoid m =&gt; m -&gt; m -&gt; m\n(++) = mappend\n</code></pre>\n\n<hr>\n\n<pre><code>module CustomPrelude (\n  module P\n  )\nwhere\n\nimport CustomPrelude.Classes as P\nimport CustomPrelude.Functions as P\n</code></pre>\n\n<p>Note that you can save yourself quite a bit of typing work by renaming your reexported modules all to the same name when importing them.</p>\n"}], "owner": {"reputation": 44680, "user_id": 1031791, "user_type": "registered", "accept_rate": 54, "profile_image": "https://www.gravatar.com/avatar/fb710534fda446d2286074bb7692e65a?s=128&d=identicon&r=PG", "display_name": "MaiaVictor", "link": "https://stackoverflow.com/users/1031791/maiavictor"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 1442, "favorite_count": 1, "accepted_answer_id": 31929060, "answer_count": 1, "score": 6, "last_activity_date": 1439242060, "creation_date": 1439239609, "last_edit_date": 1439240193, "question_id": 31928840, "link": "https://stackoverflow.com/questions/31928840/how-do-i-export-typeclasses", "title": "How do I export typeclasses?", "body": "<p>I am creating a file, <code>Common.hs</code>, which exports functions I commonly use. It also replaces some of Prelude's functions with versions I prefer:</p>\n\n<pre><code>-- Common.hs\nmodule Common \nimport qualified Prelude as Prelude\nimport qualified Data.Foldable as Foldable\n\nsum      = Foldable.sum  -- I want to replace Prelude's sum\nprint    = Prelude.print -- I want to export Prelude's print\ntype Int = Prelude.Int   -- I want to export Prelude's Int\n... etc (huge list) ...\n</code></pre>\n\n<p>This way, whenever I create a new Haskell file, I just have to import <code>Common</code> and compile it with <code>-XNoImplicitPrelude</code>:</p>\n\n<pre><code>-- Test.hs\nimport Common\nmain = print (sum [1,2,3]) -- will be the `sum` version I want\n</code></pre>\n\n<p>This approach seems to work, but I couldn't figure how to export typeclasses:</p>\n\n<pre><code>-- Test.hs\nimport Common\nimport Prelude (Show)\n\ndata Foo = Foo Int Int deriving Show\n\nmain = print (Foo 1 2)\n</code></pre>\n\n<p>Notice I had to manually import Prelude's Show. Is it possible to make <code>Common.hs</code> export it?</p>\n"}, {"tags": ["haskell", "cabal"], "comments": [{"owner": {"reputation": 94713, "user_id": 1139697, "user_type": "registered", "accept_rate": 86, "profile_image": "https://www.gravatar.com/avatar/5f136ddb684f39aaee1c028ee1950f6f?s=128&d=identicon&r=PG", "display_name": "Zeta", "link": "https://stackoverflow.com/users/1139697/zeta"}, "edited": false, "score": 3, "creation_date": 1439239208, "post_id": 31928560, "comment_id": 51769588, "body": "You probably have several targets, e.g. <code>executable</code> and <code>benchmark</code>. IIRC, cabal will build both by default. A quick look into your <code>.cabal</code> file reveals that this is most likely the culprit. You could create a library from your non-<code>Main.hs</code> files instead and have both the benchmark and the executable depend on it."}, {"owner": {"reputation": 126897, "user_id": 791604, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/ce991df7a056248d5e4f6fc3659ba733?s=128&d=identicon&r=PG", "display_name": "Daniel Wagner", "link": "https://stackoverflow.com/users/791604/daniel-wagner"}, "edited": false, "score": 0, "creation_date": 1439260193, "post_id": 31928560, "comment_id": 51776073, "body": "Why would you prefer your proposed solution, &quot;build only one of them&quot;, to Zeta&#39;s proposed solution, &quot;create a library and have both executables depend on it&quot;?"}, {"owner": {"reputation": 94713, "user_id": 1139697, "user_type": "registered", "accept_rate": 86, "profile_image": "https://www.gravatar.com/avatar/5f136ddb684f39aaee1c028ee1950f6f?s=128&d=identicon&r=PG", "display_name": "Zeta", "link": "https://stackoverflow.com/users/1139697/zeta"}, "edited": false, "score": 1, "creation_date": 1439267761, "post_id": 31928560, "comment_id": 51777949, "body": "IIRC, it&#39;s something along <code>cabal build exe:ray-tracer</code>. I can&#39;t check, still stuck at GHC 7.8.4."}, {"owner": {"reputation": 94713, "user_id": 1139697, "user_type": "registered", "accept_rate": 86, "profile_image": "https://www.gravatar.com/avatar/5f136ddb684f39aaee1c028ee1950f6f?s=128&d=identicon&r=PG", "display_name": "Zeta", "link": "https://stackoverflow.com/users/1139697/zeta"}, "edited": false, "score": 1, "creation_date": 1439284255, "post_id": 31928560, "comment_id": 51785813, "body": "Ok, now that I&#39;ve tested it in GHC 7.10: this behaviour occurs <b>only</b> if I use <code>-fno-code</code>, otherwise it gets compiled exactly once (both benchmark and executable). I suspect that <code>-fno-code</code> and <code>TemplateHaskell</code> aren&#39;t working completely hand in hand."}, {"owner": {"reputation": 3023, "user_id": 1691145, "user_type": "registered", "accept_rate": 87, "profile_image": "https://www.gravatar.com/avatar/4b6744a17b41f3b0e5c7554a43a04094?s=128&d=identicon&r=PG", "display_name": "Justin Raymond", "link": "https://stackoverflow.com/users/1691145/justin-raymond"}, "reply_to_user": {"reputation": 94713, "user_id": 1139697, "user_type": "registered", "accept_rate": 86, "profile_image": "https://www.gravatar.com/avatar/5f136ddb684f39aaee1c028ee1950f6f?s=128&d=identicon&r=PG", "display_name": "Zeta", "link": "https://stackoverflow.com/users/1139697/zeta"}, "edited": false, "score": 0, "creation_date": 1439298741, "post_id": 31928560, "comment_id": 51795442, "body": "Well, with -fno-code it compiles fast enough that double compilation doesn&#39;t really matter too much. If @Zeta makes a answer with both of his solutions to the problem I will accept it."}, {"owner": {"reputation": 3023, "user_id": 1691145, "user_type": "registered", "accept_rate": 87, "profile_image": "https://www.gravatar.com/avatar/4b6744a17b41f3b0e5c7554a43a04094?s=128&d=identicon&r=PG", "display_name": "Justin Raymond", "link": "https://stackoverflow.com/users/1691145/justin-raymond"}, "reply_to_user": {"reputation": 126897, "user_id": 791604, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/ce991df7a056248d5e4f6fc3659ba733?s=128&d=identicon&r=PG", "display_name": "Daniel Wagner", "link": "https://stackoverflow.com/users/791604/daniel-wagner"}, "edited": false, "score": 0, "creation_date": 1439299027, "post_id": 31928560, "comment_id": 51795655, "body": "@DanielWagner I guess because I would&#39;ve thought that cabal should be able to do it."}, {"owner": {"reputation": 126897, "user_id": 791604, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/ce991df7a056248d5e4f6fc3659ba733?s=128&d=identicon&r=PG", "display_name": "Daniel Wagner", "link": "https://stackoverflow.com/users/791604/daniel-wagner"}, "edited": false, "score": 0, "creation_date": 1439312900, "post_id": 31928560, "comment_id": 51805378, "body": "@JustinRaymond That&#39;s not really an answer, though; even if cabal were able to do both (which it is), it seems like &quot;build only one of them&quot; is strictly inferior to &quot;build the shared code once even when you build both artifacts&quot; to me."}], "answers": [{"tags": [], "owner": {"reputation": 37486, "user_id": 371753, "user_type": "registered", "accept_rate": 83, "profile_image": "https://i.stack.imgur.com/znFEK.jpg?s=128&g=1", "display_name": "sclv", "link": "https://stackoverflow.com/users/371753/sclv"}, "is_accepted": true, "score": 1, "last_activity_date": 1517908504, "creation_date": 1517908504, "answer_id": 48639315, "question_id": 31928560, "link": "https://stackoverflow.com/questions/31928560/cabal-compiles-code-twice/48639315#48639315", "title": "Cabal compiles code twice", "body": "<p>Posting the answer from comments as community-wiki:</p>\n\n<p>The syntax to build a single component is (for example) <code>cabal build exe:ray-tracer</code></p>\n"}], "owner": {"reputation": 3023, "user_id": 1691145, "user_type": "registered", "accept_rate": 87, "profile_image": "https://www.gravatar.com/avatar/4b6744a17b41f3b0e5c7554a43a04094?s=128&d=identicon&r=PG", "display_name": "Justin Raymond", "link": "https://stackoverflow.com/users/1691145/justin-raymond"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 255, "favorite_count": 0, "accepted_answer_id": 48639315, "answer_count": 1, "score": 4, "last_activity_date": 1517908504, "creation_date": 1439238573, "last_edit_date": 1439241016, "question_id": 31928560, "link": "https://stackoverflow.com/questions/31928560/cabal-compiles-code-twice", "title": "Cabal compiles code twice", "body": "<p>When I run <code>cabal build</code>, cabal goes through the process of compiling twice. Since compiling takes relatively long time already (~60 seconds), this is starting to impede my workflow.</p>\n\n<p>Here is the ghc options in my cabal file:</p>\n\n<pre><code>GHC-Options: -O3 -rtsopts -funbox-strict-fields -threaded -Wall -feager-blackholing -fllvm -optlo-O3\nif flag(Eventlog)\n  GHC-Options: -O3 -rtsopts -funbox-strict-fields -threaded -eventlog -Wall\nif flag(Profiling)\n  ghc-prof-options: -O3 -auto-all\n  GHC-Options: -O3 -rtsopts -funbox-strict-fields -threaded -fprof-auto -Wall\nif flag(Dump)\n  GHC-options: -O3 -funbox-strict-fields -Wall -ddump-simpl -dsuppress-module-prefixes -dsuppress-uniques -ddump-to-file\n</code></pre>\n\n<p>The output from <code>cabal build</code> looks completely normal except the compilation restarts as soon as the last module finishes compiling the first time.</p>\n\n<pre><code>[ 1 of 13] Compiling HaObj            ( src/HaObj.hs, nothing )\n[ 2 of 13] Compiling Surfaces         ( src/Surfaces.hs, nothing )\n[ 3 of 13] Compiling Materials        ( src/Materials.hs, nothing )\n[ 4 of 13] Compiling Geometry3        ( src/Geometry3.hs, nothing )\n[ 5 of 13] Compiling Triangles        ( src/Triangles.hs, nothing )\n[ 6 of 13] Compiling BoundingVolumeHierarchy ( src/BoundingVolumeHierarchy.hs, nothing )\n[ 7 of 13] Compiling RayTracer        ( src/RayTracer.hs, nothing )\n[ 8 of 13] Compiling BenchmarkScene5  ( src/BenchmarkScene5.hs, nothing )\n[ 9 of 13] Compiling BenchmarkScene4  ( src/BenchmarkScene4.hs, nothing )\n[10 of 13] Compiling BenchmarkScene3  ( src/BenchmarkScene3.hs, nothing )\n[11 of 13] Compiling BenchmarkScene2  ( src/BenchmarkScene2.hs, nothing )\n[12 of 13] Compiling BenchmarkScene   ( src/BenchmarkScene.hs, nothing )\n[13 of 13] Compiling Main             ( src/Main.hs, nothing )\n[ 1 of 13] Compiling HaObj            ( src/HaObj.hs, nothing )\n[ 2 of 13] Compiling Surfaces         ( src/Surfaces.hs, nothing )\n[ 3 of 13] Compiling Materials        ( src/Materials.hs, nothing )\n[ 4 of 13] Compiling Geometry3        ( src/Geometry3.hs, nothing )\n[ 5 of 13] Compiling Triangles        ( src/Triangles.hs, nothing )\n[ 6 of 13] Compiling BoundingVolumeHierarchy ( src/BoundingVolumeHierarchy.hs, nothing )\n[ 7 of 13] Compiling RayTracer        ( src/RayTracer.hs, nothing )\n[ 8 of 13] Compiling BenchmarkScene5  ( src/BenchmarkScene5.hs, nothing )\n[ 9 of 13] Compiling BenchmarkScene4  ( src/BenchmarkScene4.hs, nothing )\n[10 of 13] Compiling BenchmarkScene3  ( src/BenchmarkScene3.hs, nothing )\n[11 of 13] Compiling BenchmarkScene2  ( src/BenchmarkScene2.hs, nothing )\n[12 of 13] Compiling BenchmarkScene   ( src/BenchmarkScene.hs, nothing )\n[13 of 13] Compiling Main             ( src/Main.hs, nothing )\n</code></pre>\n\n<p>I'm using Ubuntu 14.04, GHC 7.10.1, cabal-install 1.22.4, cabal library 1.22.3. Here is a <a href=\"https://github.com/jrraymond/ray-tracer\" rel=\"nofollow\">link</a> to the repo if you are interested in trying to reproduce. I would recommend running <code>cabal build --ghc-options=\"-fno-code\"</code> to decrease build time to a couple of seconds.</p>\n\n<p>EDIT: Zeta pointed out that is was because I have both an executable <code>ray-tracer</code> and a benchmark <code>bench</code> in my cabal file. Is there a way to build only one of them? I tried <code>cabal build ray-tracer</code> but this also built both targets. I also tried <code>cabal configure --disable-benchmarks</code>. Is there a way to selectively build only one of the targets without reorganizing the structure of the cabal file?</p>\n"}, {"tags": ["haskell", "module"], "comments": [{"owner": {"reputation": 94713, "user_id": 1139697, "user_type": "registered", "accept_rate": 86, "profile_image": "https://www.gravatar.com/avatar/5f136ddb684f39aaee1c028ee1950f6f?s=128&d=identicon&r=PG", "display_name": "Zeta", "link": "https://stackoverflow.com/users/1139697/zeta"}, "edited": false, "score": 2, "creation_date": 1439238373, "post_id": 31928461, "comment_id": 51769138, "body": "I don&#39;t recall any flag beside <code>-XNoImplicitPrelude</code>. It&#39;s either not using the <code>Prelude</code> at all (beside a qualified import) or <code>hiding</code> the ambiguous functions."}, {"owner": {"reputation": 44680, "user_id": 1031791, "user_type": "registered", "accept_rate": 54, "profile_image": "https://www.gravatar.com/avatar/fb710534fda446d2286074bb7692e65a?s=128&d=identicon&r=PG", "display_name": "MaiaVictor", "link": "https://stackoverflow.com/users/1031791/maiavictor"}, "reply_to_user": {"reputation": 94713, "user_id": 1139697, "user_type": "registered", "accept_rate": 86, "profile_image": "https://www.gravatar.com/avatar/5f136ddb684f39aaee1c028ee1950f6f?s=128&d=identicon&r=PG", "display_name": "Zeta", "link": "https://stackoverflow.com/users/1139697/zeta"}, "edited": false, "score": 0, "creation_date": 1439238480, "post_id": 31928461, "comment_id": 51769196, "body": "Isn&#39;t there then a way to make Common.hs itself export everything from Prelude (except the functions it redefines)? So I can use <code>-XNoImplicitPrelude</code> and just import Common (since it will export Prelude&#39;s Float, Show, etc etc). Otherwise every Haskell file will have the same huge &quot;import Prelude hiding (.........................)&quot; header copypasted, which looks bad. I just need a way to move that logic to &quot;Common&quot;."}, {"owner": {"reputation": 94713, "user_id": 1139697, "user_type": "registered", "accept_rate": 86, "profile_image": "https://www.gravatar.com/avatar/5f136ddb684f39aaee1c028ee1950f6f?s=128&d=identicon&r=PG", "display_name": "Zeta", "link": "https://stackoverflow.com/users/1139697/zeta"}, "edited": false, "score": 0, "creation_date": 1439238586, "post_id": 31928461, "comment_id": 51769261, "body": "So you want to re-export specific functions from an imported module in <code>Common</code>? That&#39;s possible. Have a look at <a href=\"https://hackage.haskell.org/package/base-compat-0.8.2/docs/src/Prelude-Compat.html\" rel=\"nofollow noreferrer\">base-compat</a>&#39;s <code>Prelude.Compat</code>, which either exports the whole <code>Prelude</code> (as <code>Base</code>) if <code>base&gt;=4.8.x</code> or specific exports (which is basically the whole <code>Prelude</code> again)."}, {"owner": {"reputation": 44680, "user_id": 1031791, "user_type": "registered", "accept_rate": 54, "profile_image": "https://www.gravatar.com/avatar/fb710534fda446d2286074bb7692e65a?s=128&d=identicon&r=PG", "display_name": "MaiaVictor", "link": "https://stackoverflow.com/users/1031791/maiavictor"}, "reply_to_user": {"reputation": 94713, "user_id": 1139697, "user_type": "registered", "accept_rate": 86, "profile_image": "https://www.gravatar.com/avatar/5f136ddb684f39aaee1c028ee1950f6f?s=128&d=identicon&r=PG", "display_name": "Zeta", "link": "https://stackoverflow.com/users/1139697/zeta"}, "edited": false, "score": 0, "creation_date": 1439238746, "post_id": 31928461, "comment_id": 51769344, "body": "Okay, thank you! If prelude was small I could just do it for each function manually (like <code>length = Prelude.length</code>) but Prelude is huge (and I don&#39;t know how I&#39;d export classes anyway). So, basically, <code>export everything from Prelude except (length, sum, etc)</code> (Edit: Actually, I&#39;m not sure if that approach would be so bad, so I posted another question regarding the Class problem of that approach in particular.)"}], "answers": [{"tags": [], "owner": {"reputation": 126897, "user_id": 791604, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/ce991df7a056248d5e4f6fc3659ba733?s=128&d=identicon&r=PG", "display_name": "Daniel Wagner", "link": "https://stackoverflow.com/users/791604/daniel-wagner"}, "is_accepted": true, "score": 1, "last_activity_date": 1439259441, "creation_date": 1439259441, "answer_id": 31932143, "question_id": 31928461, "link": "https://stackoverflow.com/questions/31928461/is-it-possible-to-import-a-library-with-name-solving-priority/31932143#31932143", "title": "Is it possible to import a library with name-solving priority?", "body": "<p>There's no way to give priority, but one can easily override individual names. For example, to override <code>length</code>:</p>\n\n<pre><code>module Common where\n\nimport Prelude hiding (length)\nimport qualified Data.List\n\nlength :: Num n =&gt; [a] -&gt; n\nlength = Data.List.genericLength\n</code></pre>\n\n<p>You can check that things are going well in ghci:</p>\n\n<pre><code>% ghci -XNoImplicitPrelude test.hs\nGHCi, version 7.10.1: http://www.haskell.org/ghc/  :? for help\n[1 of 1] Compiling Common           ( test.hs, interpreted )\nOk, modules loaded: Common.\n*Common&gt; :t length\nlength :: Num n =&gt; [a] -&gt; n\n*Common&gt; :t (+)\n(+) :: Num a =&gt; a -&gt; a -&gt; a\n</code></pre>\n"}], "owner": {"reputation": 44680, "user_id": 1031791, "user_type": "registered", "accept_rate": 54, "profile_image": "https://www.gravatar.com/avatar/fb710534fda446d2286074bb7692e65a?s=128&d=identicon&r=PG", "display_name": "MaiaVictor", "link": "https://stackoverflow.com/users/1031791/maiavictor"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 65, "favorite_count": 1, "accepted_answer_id": 31932143, "answer_count": 1, "score": 3, "last_activity_date": 1439259441, "creation_date": 1439238208, "question_id": 31928461, "link": "https://stackoverflow.com/questions/31928461/is-it-possible-to-import-a-library-with-name-solving-priority", "title": "Is it possible to import a library with name-solving priority?", "body": "<p>Mind the following file:</p>\n\n<pre><code>import Common\nmain = print (length [1,2,3])\n</code></pre>\n\n<p>Common is a library that reorganizes functions from Prelude in order to export my favored versions (i.e., fold-based functions instead of list-based functions). This is giving name conflicts:</p>\n\n<pre><code>test.hs:3:15:\n    Ambiguous occurrence \u2018length\u2019\n    It could refer to either \u2018Prelude.length\u2019,\n                             imported from \u2018Prelude\u2019 at test.hs:1:1\n                             (and originally defined in \u2018GHC.List\u2019)\n                          or \u2018Common.length\u2019, imported from \u2018Common\u2019 at test.hs:1:1-11\n</code></pre>\n\n<p>Since the idea is avoiding bureaucracy when creating new files, just using <code>Import Prelude hiding ...</code> wouldn't help here. Is there any way to tell GHC to favor <code>Common.hs</code>'s definitions over Prelude's? </p>\n"}, {"tags": ["haskell"], "comments": [{"owner": {"reputation": 64805, "user_id": 286871, "user_type": "registered", "accept_rate": 77, "profile_image": "https://i.stack.imgur.com/xNBpr.png?s=128&g=1", "display_name": "Tikhon Jelvis", "link": "https://stackoverflow.com/users/286871/tikhon-jelvis"}, "edited": false, "score": 0, "creation_date": 1439237901, "post_id": 31928356, "comment_id": 51768893, "body": "You can see all the names exposed by a module with <code>:browse Module</code> in <code>ghci</code>. To see what&#39;s in the prelude (ie that you don&#39;t need to import), you can do <code>:browse Prelude</code>."}, {"owner": {"reputation": 126897, "user_id": 791604, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/ce991df7a056248d5e4f6fc3659ba733?s=128&d=identicon&r=PG", "display_name": "Daniel Wagner", "link": "https://stackoverflow.com/users/791604/daniel-wagner"}, "edited": false, "score": 0, "creation_date": 1439259751, "post_id": 31928356, "comment_id": 51775958, "body": "A slight misconception here: <code>genericDrop</code> and <code>genericTake</code> are not in the prelude, which is why you need to import them."}, {"owner": {"reputation": 479, "user_id": 3589318, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/db6d45e9ee6d8f320981d034c269d99e?s=128&d=identicon&r=PG&f=1", "display_name": "McDuffin", "link": "https://stackoverflow.com/users/3589318/mcduffin"}, "edited": false, "score": 0, "creation_date": 1439273976, "post_id": 31928356, "comment_id": 51780113, "body": "Yeah I guess I thought since the Prelude includes some of Data.List and the like, it would include all of it"}], "answers": [{"comments": [{"owner": {"reputation": 479, "user_id": 3589318, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/db6d45e9ee6d8f320981d034c269d99e?s=128&d=identicon&r=PG&f=1", "display_name": "McDuffin", "link": "https://stackoverflow.com/users/3589318/mcduffin"}, "edited": false, "score": 0, "creation_date": 1439238141, "post_id": 31928376, "comment_id": 51769016, "body": "So some of the functions in Data.List can be used without importing it, but others need an import?"}, {"owner": {"reputation": 3669, "user_id": 4876946, "user_type": "registered", "accept_rate": 87, "profile_image": "https://www.gravatar.com/avatar/5dc4839a7e9466d54f3791122f8f5d75?s=128&d=identicon&r=PG&f=1", "display_name": "Matt", "link": "https://stackoverflow.com/users/4876946/matt"}, "reply_to_user": {"reputation": 479, "user_id": 3589318, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/db6d45e9ee6d8f320981d034c269d99e?s=128&d=identicon&r=PG&f=1", "display_name": "McDuffin", "link": "https://stackoverflow.com/users/3589318/mcduffin"}, "edited": false, "score": 0, "creation_date": 1439238403, "post_id": 31928376, "comment_id": 51769154, "body": "Yeah, some of the list functions are imported though the prelude.  In general, if you need list functions, I would import them through Data.List.  I also prefer when you explicitly specify which functions you are importing.  So for example, I would do <code>import Data.List(genericDrop)</code>, which will only import the one function.  This way it is easy to tell where things are coming from."}, {"owner": {"reputation": 479, "user_id": 3589318, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/db6d45e9ee6d8f320981d034c269d99e?s=128&d=identicon&r=PG&f=1", "display_name": "McDuffin", "link": "https://stackoverflow.com/users/3589318/mcduffin"}, "edited": false, "score": 1, "creation_date": 1439238800, "post_id": 31928376, "comment_id": 51769373, "body": "Ok yeah and you can tell from <a href=\"https://hackage.haskell.org/package/base-4.8.1.0/docs/Prelude.html\" rel=\"nofollow noreferrer\">here</a> which are imported through the prelude.. cheers"}], "tags": [], "owner": {"reputation": 3669, "user_id": 4876946, "user_type": "registered", "accept_rate": 87, "profile_image": "https://www.gravatar.com/avatar/5dc4839a7e9466d54f3791122f8f5d75?s=128&d=identicon&r=PG&f=1", "display_name": "Matt", "link": "https://stackoverflow.com/users/4876946/matt"}, "is_accepted": true, "score": 5, "last_activity_date": 1439238510, "last_edit_date": 1439238510, "creation_date": 1439237833, "answer_id": 31928376, "question_id": 31928356, "link": "https://stackoverflow.com/questions/31928356/haskell-prelude-generic-functions-out-of-scope/31928376#31928376", "title": "Haskell prelude generic functions out of scope", "body": "<p>Yes, I believe you need:</p>\n\n<pre><code>import Data.List\n</code></pre>\n\n<p>In general, when I need to figure out which module to import, I find that <a href=\"https://www.haskell.org/hoogle/\" rel=\"nofollow\">hoogle</a> is very useful.  You can search for a particular function, and it will take you to hackage, which then will have the module the function belongs to at the top of the page.  For example, here is the result of searching for <a href=\"https://www.haskell.org/hoogle/?hoogle=genericDrop\" rel=\"nofollow\"><code>genericDrop</code></a> and the <a href=\"http://hackage.haskell.org/packages/archive/base/latest/doc/html/Data-List.html#v:genericDrop\" rel=\"nofollow\">associated hackage page</a>.  </p>\n"}], "owner": {"reputation": 479, "user_id": 3589318, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/db6d45e9ee6d8f320981d034c269d99e?s=128&d=identicon&r=PG&f=1", "display_name": "McDuffin", "link": "https://stackoverflow.com/users/3589318/mcduffin"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 242, "favorite_count": 0, "accepted_answer_id": 31928376, "answer_count": 1, "score": 3, "last_activity_date": 1439238510, "creation_date": 1439237735, "question_id": 31928356, "link": "https://stackoverflow.com/questions/31928356/haskell-prelude-generic-functions-out-of-scope", "title": "Haskell prelude generic functions out of scope", "body": "<p>When trying to use what are called \"generic\" list functions in the Haskell prelude, I get an out of scope error - for instance when trying to use genericDrop, genericTake and so on.</p>\n\n<p>Perhaps I need to import a module or something (but I can see no mention of that in the <a href=\"https://downloads.haskell.org/~ghc/7.8.3/docs/html/libraries/base-4.7.0.1/Data-List.html#v:drop\" rel=\"nofollow\">prelude docs</a> or by googling)</p>\n"}, {"tags": ["haskell", "math"], "comments": [{"owner": {"reputation": 60057, "user_id": 1333025, "user_type": "registered", "accept_rate": 65, "profile_image": "https://www.gravatar.com/avatar/79ab43010f900324ac5e2de19a2916cb?s=128&d=identicon&r=PG", "display_name": "Petr", "link": "https://stackoverflow.com/users/1333025/petr"}, "edited": false, "score": 1, "creation_date": 1439233163, "post_id": 31926497, "comment_id": 51766497, "body": "I&#39;m not sure if I understand the problem. Are you looking for a way how to compute positions of circles for <a href=\"https://en.wikipedia.org/wiki/Circle_packing_in_a_circle\" rel=\"nofollow noreferrer\">optimal packing of <i>n</i> circles of the same radii</a>?"}, {"owner": {"reputation": 2041, "user_id": 3825483, "user_type": "registered", "accept_rate": 91, "profile_image": "https://i.stack.imgur.com/jqg7b.jpg?s=128&g=1", "display_name": "Marcelo Camargo", "link": "https://stackoverflow.com/users/3825483/marcelo-camargo"}, "reply_to_user": {"reputation": 60057, "user_id": 1333025, "user_type": "registered", "accept_rate": 65, "profile_image": "https://www.gravatar.com/avatar/79ab43010f900324ac5e2de19a2916cb?s=128&d=identicon&r=PG", "display_name": "Petr", "link": "https://stackoverflow.com/users/1333025/petr"}, "edited": false, "score": 0, "creation_date": 1439234992, "post_id": 31926497, "comment_id": 51767458, "body": "Yes, I already can calculate the density, but I&#39;m having troubles with gettint the absolute position for each sub-circle."}, {"owner": {"reputation": 62252, "user_id": 1435869, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/TrEd9.jpg?s=128&g=1", "display_name": "karakfa", "link": "https://stackoverflow.com/users/1435869/karakfa"}, "edited": false, "score": 1, "creation_date": 1439241083, "post_id": 31926497, "comment_id": 51770491, "body": "At least in your example, there is no deterministic position for the two inner circles, you can set the center of one of the the inner circles on a circle to concentric to the center of the larger circle with half radius.  You have one degree of freedom without any other constraints."}], "owner": {"reputation": 2041, "user_id": 3825483, "user_type": "registered", "accept_rate": 91, "profile_image": "https://i.stack.imgur.com/jqg7b.jpg?s=128&g=1", "display_name": "Marcelo Camargo", "link": "https://stackoverflow.com/users/3825483/marcelo-camargo"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 454, "favorite_count": 2, "answer_count": 0, "score": 0, "last_activity_date": 1439230897, "creation_date": 1439230897, "question_id": 31926497, "link": "https://stackoverflow.com/questions/31926497/calculate-circle-packing", "title": "Calculate circle packing", "body": "<p>I need to mathematically calculate the <strong>position <code>[x, y]</code></strong> and the <strong>radius</strong> where <code>C \u2208 N</code> and <strong>C</strong> is a circle that can be positioned inside another circle with scalable radius and being traversed until reaching a leaf.</p>\n\n<p><a href=\"https://i.stack.imgur.com/x6qv6.png\" rel=\"nofollow noreferrer\"><img src=\"https://i.stack.imgur.com/x6qv6.png\" alt=\"enter image description here\"></a></p>\n\n<p>Being <code>x</code> the horizontal scale, <code>y</code> the vertical scale and <code>r</code> the radius, I need to infinetely position subcircles inside it, in a perfect geometric form. I've made some math proofs to calculate the density, but I'm not having good results: <a href=\"https://gist.github.com/haskellcamargo/89384ac17ba0131115c7\" rel=\"nofollow noreferrer\">https://gist.github.com/haskellcamargo/89384ac17ba0131115c7</a></p>\n\n<p>I define <code>Circle</code> as:</p>\n\n<pre><code>data Shape = Circle Double Double Double deriving (Show)\n</code></pre>\n\n<p>But I cannot find a <strong>deterministic</strong> way to prove the <code>x</code> and <code>y</code> position when a circle is inserted inside, with a perfect geometric form.</p>\n\n<p><a href=\"https://i.stack.imgur.com/JbOKy.png\" rel=\"nofollow noreferrer\"><img src=\"https://i.stack.imgur.com/JbOKy.png\" alt=\"enter image description here\"></a></p>\n\n<p>I found ways to calculate the density of a subcircle, but with special calcs according to the amount of subcircles, but the <code>x</code> and <code>y</code> are variant, with the unique warranty that the composed form where <code>n &gt; 3</code> will be composed by triangles. I know that I must work on angle, but I'm stuck on this in the last 2 weeks.</p>\n\n<p>The question is: Can I use deterministic calculations to have the position <code>x</code>, <code>y</code> and the <code>radius</code> giving <code>n</code>, being <code>n</code> the number of elements? The final result would be like <a href=\"http://bl.ocks.org/mbostock/7607535\" rel=\"nofollow noreferrer\">http://bl.ocks.org/mbostock/7607535</a>, but with the absolute position, as calculated by D3.</p>\n"}, {"tags": ["haskell", "io"], "comments": [{"owner": {"reputation": 4685, "user_id": 5180989, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/Gxpck.jpg?s=128&g=1", "display_name": "Helder Pereira", "link": "https://stackoverflow.com/users/5180989/helder-pereira"}, "edited": false, "score": 2, "creation_date": 1439233022, "post_id": 31924774, "comment_id": 51766442, "body": "<code>x &gt;&gt;= print</code> will print it"}], "answers": [{"tags": [], "owner": {"reputation": 339851, "user_id": 149392, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/7a561ec0875fcbbe3066ea8fe288ec77?s=128&d=identicon&r=PG", "display_name": "sepp2k", "link": "https://stackoverflow.com/users/149392/sepp2k"}, "is_accepted": true, "score": 8, "last_activity_date": 1439224765, "creation_date": 1439224765, "answer_id": 31924840, "question_id": 31924774, "link": "https://stackoverflow.com/questions/31924774/getting-result-of-io-monad-in-ghci/31924840#31924840", "title": "Getting Result of IO Monad in ghci", "body": "<p>If you enter an expression of type <code>IO t</code> into GHCi, it unwraps it and prints the resulting value. That is if you enter <code>ioExp</code>, GHCi executes <code>val &lt;- ioExp; print val</code> (whereas if you enter a non-IO expression <code>exp</code>, GHCi executes <code>print exp</code>).</p>\n"}, {"tags": [], "owner": {"reputation": 100185, "user_id": 3234959, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/93bb12ca0f93dfddb33880316f7e66c2?s=128&d=identicon&r=PG&f=1", "display_name": "chi", "link": "https://stackoverflow.com/users/3234959/chi"}, "is_accepted": false, "score": 4, "last_activity_date": 1439239134, "last_edit_date": 1439239134, "creation_date": 1439225414, "answer_id": 31925036, "question_id": 31924774, "link": "https://stackoverflow.com/questions/31924774/getting-result-of-io-monad-in-ghci/31925036#31925036", "title": "Getting Result of IO Monad in ghci", "body": "<p>You can't <code>show</code> an <code>IO Int</code> action. The action may require to perform side effects to produce the <code>Int</code>, such as asking the user for such number. Instead, the type of <code>show</code> promises to return a <code>String</code>, i.e. a plain, pure string without any side effect.</p>\n\n<p>You can define your own effectful variant of <code>show</code>, if you want:</p>\n\n<pre><code>showIO :: Show a =&gt; IO a -&gt; IO String\nshowIO = fmap show \n</code></pre>\n\n<p>Note how the result above is not a plain string, but is wrapped inside the <code>IO</code> monad, as it should be.</p>\n"}], "owner": {"reputation": 37991, "user_id": 409976, "user_type": "registered", "accept_rate": 68, "profile_image": "https://www.gravatar.com/avatar/9ccda0b49cc974197399eae01ebd6850?s=128&d=identicon&r=PG", "display_name": "Kevin Meredith", "link": "https://stackoverflow.com/users/409976/kevin-meredith"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 484, "favorite_count": 1, "accepted_answer_id": 31924840, "answer_count": 2, "score": 3, "last_activity_date": 1439239134, "creation_date": 1439224510, "question_id": 31924774, "link": "https://stackoverflow.com/questions/31924774/getting-result-of-io-monad-in-ghci", "title": "Getting Result of IO Monad in ghci", "body": "<p>Given:</p>\n\n<pre><code>Prelude&gt; let x = return 100 :: IO Int\n</code></pre>\n\n<p>Trying to evaluate <code>x</code> returns its wrapped value.</p>\n\n<pre><code>Prelude&gt; x\n100\n</code></pre>\n\n<p>But, I can't get its value via <code>show</code>.</p>\n\n<pre><code>Prelude&gt; show x\n\n&lt;interactive&gt;:4:1:\n    No instance for (Show (IO Int)) arising from a use of \u2018show\u2019\n    In the expression: show x\n    In an equation for \u2018it\u2019: it = show x\n</code></pre>\n\n<p>What's going on when I type <code>x</code> in ghci?</p>\n"}, {"tags": ["haskell", "cabal", "ghcjs"], "comments": [{"owner": {"reputation": 126897, "user_id": 791604, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/ce991df7a056248d5e4f6fc3659ba733?s=128&d=identicon&r=PG", "display_name": "Daniel Wagner", "link": "https://stackoverflow.com/users/791604/daniel-wagner"}, "edited": false, "score": 0, "creation_date": 1439260854, "post_id": 31924571, "comment_id": 51776231, "body": "Is it a cabal sandbox? If so, perhaps you need to run the package manager from the sandbox environment, e.g. <code>cabal exec ghcjs-pkg list lens</code> instead of just <code>ghcjs-pkg list lens</code>. I am not a <code>ghcjs</code> expert, though, so I&#39;m not sure the exact right invocation."}], "answers": [{"tags": [], "owner": {"reputation": 3016, "user_id": 3190654, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/c321c5241605255cae9ecf3fb2dffc0b?s=128&d=identicon&r=PG", "display_name": "bergey", "link": "https://stackoverflow.com/users/3190654/bergey"}, "is_accepted": false, "score": 2, "last_activity_date": 1440076263, "creation_date": 1440076263, "answer_id": 32119190, "question_id": 31924571, "link": "https://stackoverflow.com/questions/31924571/lens-not-found-when-compiling-sample-program-with-ghcjs/32119190#32119190", "title": "Lens not found when compiling sample program with GHCJS", "body": "<p>I do this:</p>\n\n<p>Edit <code>cabal.sandbox.config</code> to make the <code>package-db:</code> line point to the ghcjs subdir of the sandbox.  It should look something like <code>package-db: /path-to-project/.cabal-sandbox/x86_64-linux-ghcjs-0.1.0-ghc7_8_4-packages.conf.d</code></p>\n\n<p>Then run <code>cabal sandbox hc-pkg list</code>.</p>\n"}], "owner": {"reputation": 44680, "user_id": 1031791, "user_type": "registered", "accept_rate": 54, "profile_image": "https://www.gravatar.com/avatar/fb710534fda446d2286074bb7692e65a?s=128&d=identicon&r=PG", "display_name": "MaiaVictor", "link": "https://stackoverflow.com/users/1031791/maiavictor"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 305, "favorite_count": 0, "answer_count": 1, "score": 4, "last_activity_date": 1440076263, "creation_date": 1439223774, "question_id": 31924571, "link": "https://stackoverflow.com/questions/31924571/lens-not-found-when-compiling-sample-program-with-ghcjs", "title": "Lens not found when compiling sample program with GHCJS", "body": "<p>I get this error: </p>\n\n<pre><code>aff.hs:3:8:\n    Could not find module \u2018Control.Lens\u2019\n    Perhaps you haven't installed the \"js\" libraries for package \u2018lens-4.7\u2019?\n    Use -v to see a list of the files searched for.\n</code></pre>\n\n<p>When compiling this file with <code>ghcjs aff.hs</code>:</p>\n\n<pre><code>{-# LANGUAGE TemplateHaskell #-}\n\nimport Control.Lens\n\ndata Foo = Foo { _x :: Int, _y :: Int } deriving Show\nmakeLenses ''Foo\n\nmain = do\n    let foo = Foo 1 2\n    print (foo &amp; x .~ 7)\n</code></pre>\n\n<p>Error with <code>ghcjs aff.hs -v</code>:</p>\n\n<pre><code>vh:hs apple1$ ghcjs aff.hs -v\nGlasgow Haskell Compiler for JavaScript, Version 7.8.4, stage 2 booted by GHC version 7.8.3\nUsing binary package database: /Users/apple1/.ghcjs/x86_64-darwin-0.1.0-7.8.4/ghcjs/package.conf.d/package.cache\nUsing binary package database: /Users/apple1/.ghcjs/x86_64-darwin-0.1.0-7.8.4/package.conf.d/package.cache\nhiding package GLUT-2.5.1.1 to avoid conflict with later version GLUT-2.6.0.0\nhiding package OpenGL-2.9.2.0 to avoid conflict with later version OpenGL-2.10.0.0\nwired-in package ghc-prim mapped to ghc-prim-0.3.1.0-6e5df05b8d31294b1553cc2e7f7972db\nwired-in package integer-gmp mapped to integer-gmp-0.5.1.0-c643540c959b8d4136c733c4ecf986b3\nwired-in package base mapped to base-4.7.0.2-a962de1f083bee8a0176a548387263c2\nwired-in package rts mapped to builtin_rts\nwired-in package template-haskell mapped to template-haskell-2.9.0.0-3231d71f33d4fa4ea3f0278ff8020078\nwired-in package dph-seq not found.\nwired-in package dph-par not found.\nHsc static flags: \nhiding package GLUT-2.5.1.1 to avoid conflict with later version GLUT-2.6.0.0\nhiding package OpenGL-2.9.2.0 to avoid conflict with later version OpenGL-2.10.0.0\nwired-in package ghc-prim mapped to ghc-prim-0.3.1.0-6e5df05b8d31294b1553cc2e7f7972db\nwired-in package integer-gmp mapped to integer-gmp-0.5.1.0-c643540c959b8d4136c733c4ecf986b3\nwired-in package base mapped to base-4.7.0.2-a962de1f083bee8a0176a548387263c2\nwired-in package rts mapped to builtin_rts\nwired-in package template-haskell mapped to template-haskell-2.9.0.0-3231d71f33d4fa4ea3f0278ff8020078\nwired-in package dph-seq not found.\nwired-in package dph-par not found.\n*** Chasing dependencies:\nChasing modules from: *aff.hs\n\naff.hs:3:8:\n    Could not find module \u2018Control.Lens\u2019\n    Perhaps you haven't installed the \"js\" libraries for package \u2018lens-4.7\u2019?\n    Locations searched:\n    Control/Lens.hs\n    Control/Lens.lhs\n    /Users/apple1/.cabal/lib/x86_64-osx-ghcjs-0.1.0-ghc7_8_4/lens-4.7/Control/Lens.js_hi\n*** Deleting temp files:\nDeleting: \n*** Deleting temp dirs:\nDeleting: \n</code></pre>\n\n<p>The file is in a sandboxed directory. I installed lens with <code>cabal install --ghcjs lens</code>. It seems like it was installed properly:</p>\n\n<pre><code>vh:hs apple1$ ghcjs-pkg list\n/Users/apple1/.ghcjs/x86_64-darwin-0.1.0-7.8.4/ghcjs/package.conf.d\nCabal-1.22.0.0\naeson-0.8.0.2\narray-0.5.0.0\nasync-2.0.1.6\nattoparsec-0.12.1.2\nbase-4.7.0.2\nbinary-0.7.2.3\nbytestring-0.10.6.0\ncase-insensitive-1.2.0.3\ncontainers-0.5.6.2\ndeepseq-1.3.0.2\ndirectory-1.2.1.0\ndlist-0.7.1\nextensible-exceptions-0.1.1.3\nfilepath-1.3.0.2\nghc-prim-0.3.1.0\nghcjs-base-0.1.0.0\nghcjs-prim-0.1.0.0\nhashable-1.2.3.1\ninteger-gmp-0.5.1.0\nmtl-2.2.1\nold-locale-1.0.0.6\nold-time-1.1.0.2\nparallel-3.2.0.4\npretty-1.1.2.0\nprimitive-0.5.4.0\nprocess-1.2.0.0\nrts-1.0\nscientific-0.3.3.3\nstm-2.4.3\nsyb-0.4.4\ntemplate-haskell-2.9.0.0\ntext-1.2.0.3\ntime-1.4.2\ntransformers-0.4.2.0\nunix-2.7.0.1\nunordered-containers-0.2.5.1\nvector-0.10.12.2\n/Users/apple1/.ghcjs/x86_64-darwin-0.1.0-7.8.4/package.conf.d\nGLURaw-1.4.0.2\nGLUT-2.5.1.1\nGLUT-2.6.0.0\nOpenGL-2.9.2.0\nOpenGL-2.10.0.0\nOpenGLRaw-1.5.0.1\nQuickCheck-2.7.6\nadjunctions-4.2\nbifunctors-4.2\nbmp-1.2.5.2\ncomonad-4.2.2\ncontravariant-1.2.0.1\ndistributive-0.4.4\nexceptions-0.6.1\nfree-4.10.0.1\nghcjs-dom-0.1.1.3\ngloss-1.9.2.1\ngloss-raster-1.9.2.1\ngloss-rendering-1.9.2.1\nhashmap-1.3.0.1\nlens-4.7\nlinear-1.16\nnats-1\nprelude-extras-0.4\nprofunctors-4.3.2\nrandom-1.1\nreflection-1.5.1\nrepa-3.3.1.2\nsemigroupoids-4.2\nsemigroups-0.16.0.1\nsodium-0.11.0.3\nsplit-0.2.2\ntagged-0.7.3\ntf-random-0.5\ntransformers-compat-0.3.3.4\nvoid-0.7\n</code></pre>\n"}, {"tags": ["haskell"], "comments": [{"owner": {"reputation": 23444, "user_id": 414413, "user_type": "registered", "accept_rate": 79, "profile_image": "https://www.gravatar.com/avatar/6de2113f01432aa844dc85070ff33e89?s=128&d=identicon&r=PG", "display_name": "Cirdec", "link": "https://stackoverflow.com/users/414413/cirdec"}, "edited": false, "score": 6, "creation_date": 1439218379, "post_id": 31922645, "comment_id": 51758055, "body": "<a href=\"http://hackage.haskell.org/package/base-4.8.1.0/docs/Data-Bits.html#v:popCount\" rel=\"nofollow noreferrer\">popCount</a>"}, {"owner": {"reputation": 36985, "user_id": 749284, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/9939c97c2ccc2f1f6b829e9afbc32e5b?s=128&d=identicon&r=PG", "display_name": "mah", "link": "https://stackoverflow.com/users/749284/mah"}, "edited": false, "score": 0, "creation_date": 1439218452, "post_id": 31922645, "comment_id": 51758103, "body": "What has square root got to do with anything? Just examine each of the bits. I don&#39;t know about haskell, but in C you would AND the value with 0x01 to examine bit 0, AND it with 0x02 to examine bit 1, etc. Or you could shift through it a bit at a time always looking at the new bit 0."}, {"owner": {"reputation": 866, "user_id": 2872507, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/49ebde219395d677c399d8e950f5a48c?s=128&d=identicon&r=PG&f=1", "display_name": "Alexander Vieth", "link": "https://stackoverflow.com/users/2872507/alexander-vieth"}, "edited": false, "score": 1, "creation_date": 1439218891, "post_id": 31922645, "comment_id": 51758415, "body": "How would you determine whether the least-significant bit were 1 or 0? How can you achieve a bit-shift without using a shift operator like <code>&gt;&gt;</code> from C?"}, {"owner": {"reputation": 48129, "user_id": 76051, "user_type": "registered", "accept_rate": 91, "profile_image": "https://i.stack.imgur.com/AGDxz.jpg?s=128&g=1", "display_name": "Carsten", "link": "https://stackoverflow.com/users/76051/carsten"}, "edited": false, "score": 0, "creation_date": 1439219116, "post_id": 31922645, "comment_id": 51758568, "body": "<b>hint</b>: <a href=\"https://hackage.haskell.org/package/base-4.8.1.0/docs/Prelude.html#v:divMod\" rel=\"nofollow noreferrer\"><code>divMod</code></a> probably with <code>2</code> somewhere ;) - aside from this you should tell us a bit about what you tried so far, where did you hit a wall? Do you know how to do it with pen and paper let&#39;s say for <code>119</code>?"}, {"owner": {"reputation": 413, "user_id": 4933880, "user_type": "registered", "accept_rate": 50, "profile_image": "https://www.gravatar.com/avatar/74d0b0f8bbf5e6fad9d8399d9d60ceb9?s=128&d=identicon&r=PG&f=1", "display_name": "Richard", "link": "https://stackoverflow.com/users/4933880/richard"}, "edited": false, "score": 0, "creation_date": 1439219406, "post_id": 31922645, "comment_id": 51758757, "body": "i know the logic behind it, i mean, i don&#39;t know how to do it, but i know there must be a way to do it correctly without using the shift operator. that&#39;s how i&#39;d like to do it..."}, {"owner": {"reputation": 48129, "user_id": 76051, "user_type": "registered", "accept_rate": 91, "profile_image": "https://i.stack.imgur.com/AGDxz.jpg?s=128&g=1", "display_name": "Carsten", "link": "https://stackoverflow.com/users/76051/carsten"}, "edited": false, "score": 0, "creation_date": 1439219579, "post_id": 31922645, "comment_id": 51758882, "body": "ok: another hint: <code>119 = 2*59+1</code> so you have one <code>1</code> bit in there - <code>59 = 29*2+1</code> so another one, <code>29=2*14+1</code> yep one more, <code>14=2*7+0</code> well this time no luck, ..."}, {"owner": {"reputation": 36985, "user_id": 749284, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/9939c97c2ccc2f1f6b829e9afbc32e5b?s=128&d=identicon&r=PG", "display_name": "mah", "link": "https://stackoverflow.com/users/749284/mah"}, "reply_to_user": {"reputation": 866, "user_id": 2872507, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/49ebde219395d677c399d8e950f5a48c?s=128&d=identicon&r=PG&f=1", "display_name": "Alexander Vieth", "link": "https://stackoverflow.com/users/2872507/alexander-vieth"}, "edited": false, "score": 0, "creation_date": 1439229398, "post_id": 31922645, "comment_id": 51764631, "body": "@AlexanderVieth assuming that was directed at me - as I said, I don&#39;t know haskell. I&#39;m assuming from your context that the bit shift operator doesn&#39;t exist however you said nothing addressing an AND operator so I assume it exists. To test the LSB, test if value AND 1 == 0 (off) or 1 (on). To schieve bit shifting, multiply or divide by 2 (for left / right shift respectively)."}, {"owner": {"reputation": 866, "user_id": 2872507, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/49ebde219395d677c399d8e950f5a48c?s=128&d=identicon&r=PG&f=1", "display_name": "Alexander Vieth", "link": "https://stackoverflow.com/users/2872507/alexander-vieth"}, "reply_to_user": {"reputation": 36985, "user_id": 749284, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/9939c97c2ccc2f1f6b829e9afbc32e5b?s=128&d=identicon&r=PG", "display_name": "mah", "link": "https://stackoverflow.com/users/749284/mah"}, "edited": false, "score": 0, "creation_date": 1439241322, "post_id": 31922645, "comment_id": 51770634, "body": "@mah Nope, that was directed at Ricz S :) Was trying to nudge him in the right direction."}], "answers": [{"tags": [], "owner": {"reputation": 9721, "user_id": 131057, "user_type": "registered", "accept_rate": 91, "profile_image": "https://www.gravatar.com/avatar/4d84023d355c712ca3a393881e862679?s=128&d=identicon&r=PG", "display_name": "Luka Rahne", "link": "https://stackoverflow.com/users/131057/luka-rahne"}, "is_accepted": false, "score": 3, "last_activity_date": 1439219722, "creation_date": 1439219722, "answer_id": 31923246, "question_id": 31922645, "link": "https://stackoverflow.com/questions/31922645/number-of-1-bits-in-a-decimal-number/31923246#31923246", "title": "Number of 1 bits in a decimal number", "body": "<pre><code>sum . map (`mod` 2) . takeWhile ( /= 0) . iterate (`quot` 2)\n</code></pre>\n"}, {"tags": [], "owner": {"reputation": 48129, "user_id": 76051, "user_type": "registered", "accept_rate": 91, "profile_image": "https://i.stack.imgur.com/AGDxz.jpg?s=128&g=1", "display_name": "Carsten", "link": "https://stackoverflow.com/users/76051/carsten"}, "is_accepted": false, "score": 3, "last_activity_date": 1439219848, "creation_date": 1439219848, "answer_id": 31923290, "question_id": 31922645, "link": "https://stackoverflow.com/questions/31922645/number-of-1-bits-in-a-decimal-number/31923290#31923290", "title": "Number of 1 bits in a decimal number", "body": "<p>I guess Luka has the better version but maybe you struggle a bit with understanding it, so here is what I hinted at (which is the same Luka did only with naive recursion):</p>\n\n<pre><code>bits :: Int -&gt; Int\nbits 0 = 0\nbits n = let (d,r) = n `divMod` 2\n         in r + bits d\n</code></pre>\n\n<p>The idea is to get continous divide by 2 and look at the remainder - if it's 1 then you found a set bit, if not (it has to be 0 then) then there was none.</p>\n"}, {"tags": [], "owner": {"reputation": 49959, "user_id": 866915, "user_type": "registered", "accept_rate": 70, "profile_image": "https://www.gravatar.com/avatar/09242131d6e17cbbe31e8547514da6e5?s=128&d=identicon&r=PG", "display_name": "ErikR", "link": "https://stackoverflow.com/users/866915/erikr"}, "is_accepted": false, "score": 7, "last_activity_date": 1439222581, "creation_date": 1439222581, "answer_id": 31924185, "question_id": 31922645, "link": "https://stackoverflow.com/questions/31922645/number-of-1-bits-in-a-decimal-number/31924185#31924185", "title": "Number of 1 bits in a decimal number", "body": "<p>What about this old trick?</p>\n\n<pre><code>import Data.Bits\n\ncountOnes 0 = 0\ncountOnes x = 1 + countOnes (x .&amp;. (x-1))\n</code></pre>\n\n<p>It only recurses <em>n</em> times where <em>n</em> is the number of one bits in <em>x</em>.</p>\n\n<p>Of course, if you are going to import <code>Data.Bits</code>, then you might as well use <code>popCount</code> as @Cirdec suggested.</p>\n"}, {"tags": [], "owner": {"reputation": 4773, "user_id": 4148211, "user_type": "registered", "accept_rate": 55, "profile_image": "https://i.stack.imgur.com/DiKJf.jpg?s=128&g=1", "display_name": "frasertweedale", "link": "https://stackoverflow.com/users/4148211/frasertweedale"}, "is_accepted": false, "score": 4, "last_activity_date": 1439252988, "creation_date": 1439252988, "answer_id": 31931299, "question_id": 31922645, "link": "https://stackoverflow.com/questions/31922645/number-of-1-bits-in-a-decimal-number/31931299#31931299", "title": "Number of 1 bits in a decimal number", "body": "<p>Use <code>popCount</code> from <code>Data.Bits</code>, also known as the <em>Hamming weight</em> of a number.  The advantage is that some CPUs have instructions specifically for calculating this, resulting in high performance.</p>\n\n<pre><code>\u03bb&gt; import Data.Bits\n\u03bb&gt; :t popCount\npopCount :: Bits a =&gt; a -&gt; Int\n\u03bb&gt; popCount 255\n8\n\u03bb&gt; popCount 0xa5\n4\n</code></pre>\n"}], "owner": {"reputation": 413, "user_id": 4933880, "user_type": "registered", "accept_rate": 50, "profile_image": "https://www.gravatar.com/avatar/74d0b0f8bbf5e6fad9d8399d9d60ceb9?s=128&d=identicon&r=PG&f=1", "display_name": "Richard", "link": "https://stackoverflow.com/users/4933880/richard"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 448, "favorite_count": 1, "answer_count": 4, "score": 2, "last_activity_date": 1439252988, "creation_date": 1439218059, "last_edit_date": 1439221843, "question_id": 31922645, "link": "https://stackoverflow.com/questions/31922645/number-of-1-bits-in-a-decimal-number", "title": "Number of 1 bits in a decimal number", "body": "<p>How can I write a function to return the number of 1 bits corresponding a decimal number? Maybe a square root function? The type should be this:</p>\n\n<pre><code>bits :: Int -&gt; Int\n</code></pre>\n\n<p>EDIT: SOlved</p>\n\n<pre><code>uns :: Int -&gt; Int\nuns  0 = 0\nuns 1 = 1\nuns x | mod x 2 == 1 = 1 + uns (div x 2)\n      | otherwise = uns (div x 2)\n</code></pre>\n"}, {"tags": ["haskell"], "comments": [{"owner": {"reputation": 69792, "user_id": 493122, "user_type": "registered", "accept_rate": 96, "profile_image": "https://www.gravatar.com/avatar/1f90ae01c2e24801c2df9189179b0ccd?s=128&d=identicon&r=PG", "display_name": "Shoe", "link": "https://stackoverflow.com/users/493122/shoe"}, "edited": false, "score": 1, "creation_date": 1439213493, "post_id": 31920892, "comment_id": 51754378, "body": "What are <code>foo</code>, <code>bar</code> and <code>baz</code>? What is the relation between these three?"}, {"owner": {"reputation": 9139, "user_id": 773228, "user_type": "registered", "accept_rate": 62, "profile_image": "https://www.gravatar.com/avatar/baaecdda322cf4462a0dd018d7959b1e?s=128&d=identicon&r=PG&f=1", "display_name": "Justin Wood", "link": "https://stackoverflow.com/users/773228/justin-wood"}, "reply_to_user": {"reputation": 69792, "user_id": 493122, "user_type": "registered", "accept_rate": 96, "profile_image": "https://www.gravatar.com/avatar/1f90ae01c2e24801c2df9189179b0ccd?s=128&d=identicon&r=PG", "display_name": "Shoe", "link": "https://stackoverflow.com/users/493122/shoe"}, "edited": false, "score": 0, "creation_date": 1439215851, "post_id": 31920892, "comment_id": 51756145, "body": "They are different types of &#39;impressions&#39; that can come into the service. <code>Banner</code>, <code>Video</code>, <code>Native</code>. They each describe a different kind of impression that can be bid on. I&#39;m trying to implement the OpenRTB spec in Haskell."}, {"owner": {"reputation": 15757, "user_id": 176841, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/45a168cb9eb8454d66c78f18e29d9342?s=128&d=identicon&r=PG", "display_name": "jberryman", "link": "https://stackoverflow.com/users/176841/jberryman"}, "edited": false, "score": 1, "creation_date": 1439233803, "post_id": 31920892, "comment_id": 51766823, "body": "possible duplicate of <a href=\"http://stackoverflow.com/questions/19413438/is-there-a-canonical-haskell-type-for-one-or-both\">Is there a canonical haskell type for &quot;One or Both&quot;?</a>"}], "answers": [{"tags": [], "owner": {"reputation": 69792, "user_id": 493122, "user_type": "registered", "accept_rate": 96, "profile_image": "https://www.gravatar.com/avatar/1f90ae01c2e24801c2df9189179b0ccd?s=128&d=identicon&r=PG", "display_name": "Shoe", "link": "https://stackoverflow.com/users/493122/shoe"}, "is_accepted": false, "score": 4, "last_activity_date": 1439230482, "last_edit_date": 1439230482, "creation_date": 1439213690, "answer_id": 31921000, "question_id": 31920892, "link": "https://stackoverflow.com/questions/31920892/mandatory-maybes-in-the-type-system/31921000#31921000", "title": "Mandatory Maybes in the type system", "body": "<p>I would use a <code>Map Field String</code> with <code>data Field = Foo | Bar | Baz</code> (this can easily be replaced with <code>String</code> if needed, and then have:</p>\n\n<pre><code>data A = A\n    { id :: Integer\n    , fields :: Map Field String\n    }\n</code></pre>\n\n<p>Now checking for the validity condition is as simple as:</p>\n\n<pre><code>isValid :: A -&gt; Bool\nisValid = not . Map.null . fields\n</code></pre>\n"}, {"comments": [{"owner": {"reputation": 22377, "user_id": 2288659, "user_type": "registered", "accept_rate": 90, "profile_image": "https://i.stack.imgur.com/bBg8v.png?s=128&g=1", "display_name": "Silvio Mayolo", "link": "https://stackoverflow.com/users/2288659/silvio-mayolo"}, "edited": false, "score": 9, "creation_date": 1439213984, "post_id": 31921033, "comment_id": 51754735, "body": "Perhaps include a brief explanation instead of just code and a reference link."}, {"owner": {"reputation": 1679, "user_id": 1722752, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/ef35ad86b627ba3176b6aea8a184f51c?s=128&d=identicon&r=PG", "display_name": "MigMit", "link": "https://stackoverflow.com/users/1722752/migmit"}, "edited": false, "score": 2, "creation_date": 1439230171, "post_id": 31921033, "comment_id": 51764984, "body": "No, it&#39;s exactly how it should be."}, {"owner": {"reputation": 31243, "user_id": 2751851, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/4ddc0.png?s=128&g=1", "display_name": "duplode", "link": "https://stackoverflow.com/users/2751851/duplode"}, "edited": false, "score": 1, "creation_date": 1439237133, "post_id": 31921033, "comment_id": 51768511, "body": "There is also a minimalist version of <code>These</code> in <a href=\"https://hackage.haskell.org/package/data-or\" rel=\"nofollow noreferrer\"><code>data-or</code></a>."}, {"owner": {"reputation": 9139, "user_id": 773228, "user_type": "registered", "accept_rate": 62, "profile_image": "https://www.gravatar.com/avatar/baaecdda322cf4462a0dd018d7959b1e?s=128&d=identicon&r=PG&f=1", "display_name": "Justin Wood", "link": "https://stackoverflow.com/users/773228/justin-wood"}, "edited": false, "score": 0, "creation_date": 1439251817, "post_id": 31921033, "comment_id": 51773963, "body": "This would probably work for my case, but is there another solution that would work better for the case of have 4,5,...,N number of fields that could be in the value?"}], "tags": [], "owner": {"reputation": 100892, "user_id": 745903, "user_type": "registered", "accept_rate": 74, "profile_image": "https://www.gravatar.com/avatar/50933f6638836741e620669b3940410e?s=128&d=identicon&r=PG", "display_name": "leftaroundabout", "link": "https://stackoverflow.com/users/745903/leftaroundabout"}, "is_accepted": true, "score": 11, "last_activity_date": 1439213782, "creation_date": 1439213782, "answer_id": 31921033, "question_id": 31920892, "link": "https://stackoverflow.com/questions/31920892/mandatory-maybes-in-the-type-system/31921033#31921033", "title": "Mandatory Maybes in the type system", "body": "<p><a href=\"http://hackage.haskell.org/package/these-0.4.2/docs/Data-These.html\">http://hackage.haskell.org/package/these-0.4.2/docs/Data-These.html</a></p>\n\n<pre><code>import Data.These\ndata A = A\n  { id :: Integer\n  , fooBarBaz :: These Foo (These Bar Baz)\n  }\n\ntype Foo = String\ntype Bar = String\ntype Baz = String\n</code></pre>\n"}, {"tags": [], "owner": {"reputation": 2719, "user_id": 566890, "user_type": "registered", "accept_rate": 86, "profile_image": "https://i.stack.imgur.com/T0Csa.png?s=128&g=1", "display_name": "Markus1189", "link": "https://stackoverflow.com/users/566890/markus1189"}, "is_accepted": false, "score": 4, "last_activity_date": 1439218466, "creation_date": 1439218466, "answer_id": 31922793, "question_id": 31920892, "link": "https://stackoverflow.com/questions/31920892/mandatory-maybes-in-the-type-system/31922793#31922793", "title": "Mandatory Maybes in the type system", "body": "<p>If it is not mandatory to have three separate fields with foo,bar and baz, I'd go with this, <a href=\"https://hackage.haskell.org/package/NonEmptyList-0.0.9/docs/Data-List-NonEmpty.html\" rel=\"nofollow\">NonEmpty</a> guarantees that there is at least one element, though there can of course be more.</p>\n\n<pre><code>import Data.List.NonEmpty\n\ndata Impression = Banner String | Video String | Native String\n\ndata A = A\n  { id :: Integer\n  , fooBarBaz :: NonEmpty Impression\n  }\n</code></pre>\n"}, {"tags": [], "owner": {"reputation": 100892, "user_id": 745903, "user_type": "registered", "accept_rate": 74, "profile_image": "https://www.gravatar.com/avatar/50933f6638836741e620669b3940410e?s=128&d=identicon&r=PG", "display_name": "leftaroundabout", "link": "https://stackoverflow.com/users/745903/leftaroundabout"}, "is_accepted": false, "score": 2, "last_activity_date": 1439235276, "creation_date": 1439235276, "answer_id": 31927677, "question_id": 31920892, "link": "https://stackoverflow.com/questions/31920892/mandatory-maybes-in-the-type-system/31927677#31927677", "title": "Mandatory Maybes in the type system", "body": "<p>Expanding on \u028e\u01dd\u0279\u025f\u025f\u025f\u01dd\u017f's suggestion to use a map: <a href=\"http://hackage.haskell.org/package/non-empty-0.2.1/docs/Data-NonEmpty-Map.html\" rel=\"nofollow\">there's also a type specifically for non-empty maps</a>. (Note however that this sort of clashes with the more popular nonempty-list type <a href=\"http://hackage.haskell.org/package/semigroups-0.16.2.2/docs/Data-List-NonEmpty.html\" rel=\"nofollow\">from the <code>semigroups</code> library</a>.)</p>\n\n<pre><code>import qualified Data.NonEmpty.Map as NEM\n\ndata Field = Foo | Bar | Baz\ndata A = A { id :: Integer\n           , fields :: NEM.T Field String\n           }\n</code></pre>\n"}, {"tags": [], "owner": {"reputation": 126897, "user_id": 791604, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/ce991df7a056248d5e4f6fc3659ba733?s=128&d=identicon&r=PG", "display_name": "Daniel Wagner", "link": "https://stackoverflow.com/users/791604/daniel-wagner"}, "is_accepted": false, "score": 2, "last_activity_date": 1439279739, "creation_date": 1439279739, "answer_id": 31936179, "question_id": 31920892, "link": "https://stackoverflow.com/questions/31920892/mandatory-maybes-in-the-type-system/31936179#31936179", "title": "Mandatory Maybes in the type system", "body": "<p>Consider giving one branch for each possible required field:</p>\n\n<pre><code>data A\n    = Foo\n        { foo :: String\n        , barM, bazM :: Maybe String\n        }\n    | Bar\n        { bar :: String\n        , fooM, barM :: Maybe String\n        }\n    | Baz\n        { baz :: String\n        , fooM, barM :: Maybe String\n        }\n</code></pre>\n\n<p>It's a fair bit of boilerplate, but it's very direct and quite clear about what's required.</p>\n"}], "owner": {"reputation": 9139, "user_id": 773228, "user_type": "registered", "accept_rate": 62, "profile_image": "https://www.gravatar.com/avatar/baaecdda322cf4462a0dd018d7959b1e?s=128&d=identicon&r=PG&f=1", "display_name": "Justin Wood", "link": "https://stackoverflow.com/users/773228/justin-wood"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 158, "favorite_count": 0, "accepted_answer_id": 31921033, "answer_count": 5, "score": 7, "last_activity_date": 1439279739, "creation_date": 1439213383, "question_id": 31920892, "link": "https://stackoverflow.com/questions/31920892/mandatory-maybes-in-the-type-system", "title": "Mandatory Maybes in the type system", "body": "<p>I have something similar to the following</p>\n\n<pre><code>data A = A\n  { id :: Integer\n  , foo :: Maybe String\n  , bar :: Maybe String\n  , baz :: Maybe String\n  }\n</code></pre>\n\n<p>This data is coming in to my service as JSON. This request is only considered valid when one or more of <code>foo</code>, <code>bar</code>, or <code>baz</code> are given. Is there a better way to express this within Haskell's type system?</p>\n\n<p><strong>Note</strong>: Unfortunately I am unable to make this separate requests. I'm just following a defined protocol.</p>\n"}, {"tags": ["haskell", "dependent-type"], "comments": [{"owner": {"reputation": 100892, "user_id": 745903, "user_type": "registered", "accept_rate": 74, "profile_image": "https://www.gravatar.com/avatar/50933f6638836741e620669b3940410e?s=128&d=identicon&r=PG", "display_name": "leftaroundabout", "link": "https://stackoverflow.com/users/745903/leftaroundabout"}, "edited": false, "score": 3, "creation_date": 1439207152, "post_id": 31918427, "comment_id": 51749884, "body": "I think this <i>is</i> sheduled to finally work in GHC-7.12... but in 7.10, you can at least <a href=\"https://hackage.haskell.org/package/ghc-typelits-natnormalise-0.3\" rel=\"nofollow noreferrer\">load a plugin</a> that should do the trick."}, {"owner": {"reputation": 1284, "user_id": 5209349, "user_type": "registered", "accept_rate": 80, "profile_image": "https://www.gravatar.com/avatar/0f5341e747308691d40f30d79ffd75f9?s=128&d=identicon&r=PG", "display_name": "Michael Benfield", "link": "https://stackoverflow.com/users/5209349/michael-benfield"}, "reply_to_user": {"reputation": 100892, "user_id": 745903, "user_type": "registered", "accept_rate": 74, "profile_image": "https://www.gravatar.com/avatar/50933f6638836741e620669b3940410e?s=128&d=identicon&r=PG", "display_name": "leftaroundabout", "link": "https://stackoverflow.com/users/745903/leftaroundabout"}, "edited": false, "score": 0, "creation_date": 1439211151, "post_id": 31918427, "comment_id": 51752603, "body": "Thanks for pointing that out. But I see that even with that plugin, you apparently still can&#39;t do much without circumventing the type system. See the use of unsafeCoerce in the definition of UNat <a href=\"https://github.com/clash-lang/ghc-typelits-natnormalise/blob/master/tests/Tests.hs\" rel=\"nofollow noreferrer\">here</a>."}, {"owner": {"reputation": 100892, "user_id": 745903, "user_type": "registered", "accept_rate": 74, "profile_image": "https://www.gravatar.com/avatar/50933f6638836741e620669b3940410e?s=128&d=identicon&r=PG", "display_name": "leftaroundabout", "link": "https://stackoverflow.com/users/745903/leftaroundabout"}, "edited": false, "score": 3, "creation_date": 1439211464, "post_id": 31918427, "comment_id": 51752827, "body": "Yes, it&#39;s a bit embarrassing. What I&#39;ve done so far instead of using <code>GHC.TypeLits</code> is, sticked <a href=\"https://github.com/leftaroundabout/manifolds/blob/08c5ffd4dd8b9a6053036a6bd4c0864cf23bffa6/manifolds/Data/CoNat.hs#L60\" rel=\"nofollow noreferrer\">to a manually-defined Peano type</a>, with a codata-style type class to take recursion schemes etc. to a <code>Nat</code>-qualified level, instead of explicitly solving any number equalities."}, {"owner": {"reputation": 2422, "user_id": 1276441, "user_type": "registered", "accept_rate": 88, "profile_image": "https://www.gravatar.com/avatar/a1ed120c8ab66ed191f289cafa0b58ee?s=128&d=identicon&r=PG", "display_name": "chamini2", "link": "https://stackoverflow.com/users/1276441/chamini2"}, "edited": false, "score": 1, "creation_date": 1439228509, "post_id": 31918427, "comment_id": 51764091, "body": "Check <a href=\"http://www.idris-lang.org\" rel=\"nofollow noreferrer\">Idris</a> out"}], "answers": [{"comments": [{"owner": {"reputation": 44013, "user_id": 1477667, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/trgKM.jpg?s=128&g=1", "display_name": "dfeuer", "link": "https://stackoverflow.com/users/1477667/dfeuer"}, "edited": false, "score": 2, "creation_date": 1446067767, "post_id": 33401838, "comment_id": 54595096, "body": "Richard Eisenberg has been doing a lot of work on adding dependent types to GHC."}, {"owner": {"reputation": 9772, "user_id": 3963, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/9pDQ8.png?s=128&g=1", "display_name": "hao", "link": "https://stackoverflow.com/users/3963/hao"}, "reply_to_user": {"reputation": 44013, "user_id": 1477667, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/trgKM.jpg?s=128&g=1", "display_name": "dfeuer", "link": "https://stackoverflow.com/users/1477667/dfeuer"}, "edited": false, "score": 0, "creation_date": 1446145975, "post_id": 33401838, "comment_id": 54634726, "body": "Agreed! At Future of Haskell 2015 this year he gave a great presentation on the roadmap (for GHC 8.0 and 9.0) for dependent types: <a href=\"https://www.youtube.com/watch?v=W6a36RoFeNw\" rel=\"nofollow noreferrer\">youtube.com/watch?v=W6a36RoFeNw</a>"}], "tags": [], "owner": {"reputation": 9772, "user_id": 3963, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/9pDQ8.png?s=128&g=1", "display_name": "hao", "link": "https://stackoverflow.com/users/3963/hao"}, "is_accepted": true, "score": 4, "last_activity_date": 1446067380, "creation_date": 1446067380, "answer_id": 33401838, "question_id": 31918427, "link": "https://stackoverflow.com/questions/31918427/haskell-type-level-literal-nat-status/33401838#33401838", "title": "Haskell type level literal Nat: status?", "body": "<p>As commenters have mentioned, the typechecker is currently unable to discharge this equality because they require algebra. Whereas you and I know that <code>n + m = n1 + m + 1</code> given <code>n = n1 + 1</code>, nobody has taught the GHC typechecker how to perform that kind of arithmetic. In languages like Ada, Idris, or Coq you'd be able to teach the compiler these rules or perhaps the rules of arithmetic would be provided to you in a library, but in Haskell the typechecker is a bit more rigid (but a lot friendlier to real-world programming, in my opinion) and you have to unfortunately resort to a typechecker plugin.</p>\n\n<p>The person that I know of who is most actively on this problem is one <a href=\"http://dl.acm.org/citation.cfm?id=2804307&amp;CFID=725317436&amp;CFTOKEN=11483840\" rel=\"nofollow\">Iavor Diatchki</a>. That paper is behind the dumb ACM paywall, but you can find his <a href=\"https://www.youtube.com/watch?v=UoPoBQRGuZM\" rel=\"nofollow\">Haskell Symposium 2015 talk here on YouTube</a> \u2014 it's very well-explained!. His talk uses the same example as yours, the ever-popular vector. <a href=\"https://ghc.haskell.org/trac/ghc/wiki/ActiveBranches\" rel=\"nofollow\">His branch in the GHC repository</a> works on merging it into mainline GHC, but as far as I know there are no dates set. For now you have to use the typechecker plugin, which is not so bad. After all, the original <a href=\"https://ghc.haskell.org/trac/ghc/wiki/Plugins/TypeChecker\" rel=\"nofollow\">goal of Plugins/Typechecker</a> was to enable interesting work like this without having to merge everything into the source code. There's something to be said for modularity!</p>\n"}], "owner": {"reputation": 1284, "user_id": 5209349, "user_type": "registered", "accept_rate": 80, "profile_image": "https://www.gravatar.com/avatar/0f5341e747308691d40f30d79ffd75f9?s=128&d=identicon&r=PG", "display_name": "Michael Benfield", "link": "https://stackoverflow.com/users/5209349/michael-benfield"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 939, "favorite_count": 2, "accepted_answer_id": 33401838, "answer_count": 1, "score": 17, "last_activity_date": 1446067380, "creation_date": 1439206313, "question_id": 31918427, "link": "https://stackoverflow.com/questions/31918427/haskell-type-level-literal-nat-status", "title": "Haskell type level literal Nat: status?", "body": "<p>GHC has type level literal Nats. I can read a few things about them, for instance, here:</p>\n\n<p><a href=\"https://ghc.haskell.org/trac/ghc/wiki/TypeNats\">https://ghc.haskell.org/trac/ghc/wiki/TypeNats</a></p>\n\n<p>Unfortunately, there seems to be little documentation about them, and almost nothing I try to do with them actually works. </p>\n\n<p>Comment 18 from <a href=\"https://ghc.haskell.org/trac/ghc/ticket/4385\">this page</a> mentions this simple example of size parametrized Vecs (I've added LANGUAGE pragmas and an import statement):</p>\n\n<pre><code>{-# LANGUAGE DataKinds #-}\n{-# LANGUAGE GADTs #-}\n{-# LANGUAGE KindSignatures #-}\n{-# LANGUAGE TypeOperators #-}\n\nimport GHC.TypeLits\n\ndata Vec :: Nat -&gt; * -&gt; * where\n  Nil  :: Vec 0 a\n  (:&gt;) :: a -&gt; Vec n a -&gt; Vec (n+1) a\n\n(+++) :: Vec n a -&gt; Vec m a -&gt; Vec (n+m) a\nNil       +++ bs = bs\n(a :&gt; as) +++ bs = a :&gt; (as +++ bs)\n</code></pre>\n\n<p>It wasn't working at the time, but then the implementation was supposedly modified so that this worked. That was 5 years ago... but it doesn't work on my GHC 7.10.1:</p>\n\n<pre><code>trash.hs:15:20:\n    Could not deduce ((n + m) ~ ((n1 + m) + 1))\n    from the context (n ~ (n1 + 1))\n      bound by a pattern with constructor\n                 :&gt; :: forall a (n :: Nat). a -&gt; Vec n a -&gt; Vec (n + 1) a,\n               in an equation for \u2018+++\u2019\n      at trash.hs:15:2-8\n    NB: \u2018+\u2019 is a type function, and may not be injective\n    Expected type: Vec (n + m) a\n      Actual type: Vec ((n1 + m) + 1) a\n    Relevant bindings include\n      bs :: Vec m a (bound at trash.hs:15:15)\n      as :: Vec n1 a (bound at trash.hs:15:7)\n      (+++) :: Vec n a -&gt; Vec m a -&gt; Vec (n + m) a\n        (bound at trash.hs:14:1)\n    In the expression: a :&gt; (as +++ bs)\n    In an equation for \u2018+++\u2019: (a :&gt; as) +++ bs = a :&gt; (as +++ bs)\n</code></pre>\n\n<p>What's the deal here? Are type level literal Nats supposed to be usable for this kind of thing? If so, how do I implement the (+++) function? If not, what is their use case?</p>\n"}, {"tags": ["haskell"], "answers": [{"tags": [], "owner": {"reputation": 785, "user_id": 3087558, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/a43d21bfa85dc7dc360cafa7f69ba3b1?s=128&d=identicon&r=PG&f=1", "display_name": "fgv", "link": "https://stackoverflow.com/users/3087558/fgv"}, "is_accepted": false, "score": 2, "last_activity_date": 1439208854, "creation_date": 1439208854, "answer_id": 31919275, "question_id": 31917659, "link": "https://stackoverflow.com/questions/31917659/is-literal-a-special-form-value-constructor/31919275#31919275", "title": "Is literal a special form value constructor?", "body": "<p>I don't know what you mean by \"literal\", but the <em>List</em> data type that you defined above is actually not a conventional Haskell list. For one, your \"List\" has a fixed number of elements (3), while a Haskell list can contain from zero to an infinite number of elements. Your type is also specialized to the type Int, while Haskell lists can contain any type of elements, as long as all elements are of the same type. And, besides, Haskell lists are instances of a number of typeclasses (Functors, Monoids, Monads, etc.).</p>\n\n<p>Haskell lists are a recursive data type and a possible constructor for them  would be:</p>\n\n<pre><code>data List a = Empty | Cons a (List a) deriving Show\n</code></pre>\n\n<p>You could use this constructor as:</p>\n\n<pre><code>Cons 1 (Cons 2 (Cons 3 Empty))\n</code></pre>\n\n<p>Of course, it would be far more practical to use the built-in data type and build your list as:</p>\n\n<pre><code>[1,2,3]\n</code></pre>\n\n<p>Also, what do you really mean by \"limits in Haskell\"?</p>\n"}, {"tags": [], "owner": {"reputation": 100185, "user_id": 3234959, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/93bb12ca0f93dfddb33880316f7e66c2?s=128&d=identicon&r=PG&f=1", "display_name": "chi", "link": "https://stackoverflow.com/users/3234959/chi"}, "is_accepted": false, "score": 2, "last_activity_date": 1439209266, "creation_date": 1439209266, "answer_id": 31919423, "question_id": 31917659, "link": "https://stackoverflow.com/questions/31917659/is-literal-a-special-form-value-constructor/31919423#31919423", "title": "Is literal a special form value constructor?", "body": "<p>Haskell allows a custom syntax for lists, such as</p>\n\n<pre><code>[1,2,3]\n</code></pre>\n\n<p>this is just a syntactic shortcut for</p>\n\n<pre><code>1 : 2 : 3 : []\n</code></pre>\n\n<p>which is another syntactic shortcut for</p>\n\n<pre><code>(:) 1 ((:) 2 ((:) 3 []))\n</code></pre>\n\n<p>Above, <code>(:)</code> and <code>[]</code> are data constructors.</p>\n\n<pre><code>(:) :: a -&gt; [a] -&gt; [a]\n[]  :: [a]\n</code></pre>\n\n<p>Keep in mind that the special syntax applies only to standard lists, not to user defined types. You can get something vaguely similar with e.g.</p>\n\n<pre><code>data MyList a = Nil | a :+ MyList a\n</code></pre>\n\n<p>and then using the <code>:+</code> value constructor in an infix way:</p>\n\n<pre><code>1 :+ 2 :+ 3 :+ Nil\n</code></pre>\n\n<p>Still, no <code>[1,2,3]</code> syntax for this type.</p>\n"}, {"tags": [], "owner": {"reputation": 31243, "user_id": 2751851, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/4ddc0.png?s=128&g=1", "display_name": "duplode", "link": "https://stackoverflow.com/users/2751851/duplode"}, "is_accepted": true, "score": 2, "last_activity_date": 1439228138, "last_edit_date": 1439228138, "creation_date": 1439209716, "answer_id": 31919579, "question_id": 31917659, "link": "https://stackoverflow.com/questions/31917659/is-literal-a-special-form-value-constructor/31919579#31919579", "title": "Is literal a special form value constructor?", "body": "<blockquote>\n  <p>can I regard literal as a special form of value constructor?</p>\n</blockquote>\n\n<p>Basically, yes. Do note, however, that your <code>ListType</code> is not a list; it is (equivalent to) a tuple. Values of a list type may hold any number of elements, while <code>ListType</code> values can hold only three. Back to your question, though: <code>[1, 2, 3]</code> is indeed syntax sugar for <code>1 : 2 : 3 : []</code>, in which the <code>(:)</code> and <code>[]</code> constructors appear explicitly. Weren't it for the sugar and other syntactical details, a definition for the list type might be:</p>\n\n<pre><code>data [] a = [] | (:) a ([] a)\n</code></pre>\n"}], "owner": {"reputation": 599, "user_id": 2394303, "user_type": "registered", "accept_rate": 79, "profile_image": "https://i.stack.imgur.com/pAJ4E.jpg?s=128&g=1", "display_name": "speedcell4", "link": "https://stackoverflow.com/users/2394303/speedcell4"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 84, "favorite_count": 0, "accepted_answer_id": 31919579, "answer_count": 3, "score": 0, "last_activity_date": 1439228138, "creation_date": 1439203958, "question_id": 31917659, "link": "https://stackoverflow.com/questions/31917659/is-literal-a-special-form-value-constructor", "title": "Is literal a special form value constructor?", "body": "<p>with </p>\n\n<pre><code>data ListType = List Int Int Int deriving(Show)\n</code></pre>\n\n<p><code>[1, 2, 3]</code> and <code>List 1 2 3</code>, can both get a list which contains one to three, can I regard literal as a special form of value constructor?</p>\n\n<p>Not just limits in Haskell.</p>\n"}, {"tags": ["haskell", "parametric-polymorphism"], "comments": [{"owner": {"reputation": 27723, "user_id": 627005, "user_type": "registered", "accept_rate": 87, "profile_image": "https://www.gravatar.com/avatar/016a165f7d0d5d24bb38331502b912ed?s=128&d=identicon&r=PG&f=1", "display_name": "Paul Manta", "link": "https://stackoverflow.com/users/627005/paul-manta"}, "edited": false, "score": 3, "creation_date": 1439196561, "post_id": 31915177, "comment_id": 51743473, "body": "<code>Num</code> isn&#39;t the correct class for vectors, though. It declares the <a href=\"http://hackage.haskell.org/package/base-4.8.1.0/docs/Prelude.html#v:signum\" rel=\"nofollow noreferrer\"><code>signum</code></a> function, for example, and there is no standard definition of this function for vectors."}], "answers": [{"comments": [{"owner": {"user_type": "does_not_exist", "display_name": "user4861515"}, "edited": false, "score": 0, "creation_date": 1439198743, "post_id": 31915841, "comment_id": 51744769, "body": "Thanks for the reference. Seems very odd that I could derive Ord, which is meaningless in R^2, but there is no way to define addition through polymorphism for a cartesian product of primitives, literally the simplest case I could imagine. I guess I&#39;m missing the point of how this is better than dumb old subtype polymorphism."}], "tags": [], "owner": {"reputation": 153048, "user_id": 9204, "user_type": "registered", "accept_rate": 82, "profile_image": "https://www.gravatar.com/avatar/c79937a093ff9e963c563e22cd385f30?s=128&d=identicon&r=PG", "display_name": "Alexey Romanov", "link": "https://stackoverflow.com/users/9204/alexey-romanov"}, "is_accepted": false, "score": 5, "last_activity_date": 1439198309, "creation_date": 1439198309, "answer_id": 31915841, "question_id": 31915177, "link": "https://stackoverflow.com/questions/31915177/what-should-be-my-expectations-for-haskells-deriving/31915841#31915841", "title": "What should be my expectations for Haskell&#39;s &quot;deriving&quot;?", "body": "<p>See <a href=\"https://downloads.haskell.org/~ghc/7.10.2/docs/html/users_guide/deriving.html\" rel=\"noreferrer\">https://downloads.haskell.org/~ghc/7.10.2/docs/html/users_guide/deriving.html</a>:</p>\n\n<blockquote>\n  <p>In Haskell 98, the only classes that may appear in the deriving clause are the standard classes Eq, Ord, Enum, Ix, Bounded, Read, and Show.</p>\n</blockquote>\n\n<p>GHC also allows deriving <code>Generic</code>, <code>Functor</code>, <code>Data</code>, <code>Typeable</code>, <code>Foldable</code> and <code>Traversable</code> for <code>data</code> declarations, and any classes for <code>newtype</code> declarations (after enabling the relevant extensions, as listed in the linked page).</p>\n"}, {"tags": [], "owner": {"reputation": 11593, "user_id": 2494803, "user_type": "registered", "accept_rate": 88, "profile_image": "https://www.gravatar.com/avatar/58b4b1d0d8887426a51330a990936ac1?s=128&d=identicon&r=PG", "display_name": "bennofs", "link": "https://stackoverflow.com/users/2494803/bennofs"}, "is_accepted": false, "score": 4, "last_activity_date": 1439198495, "creation_date": 1439198495, "answer_id": 31915901, "question_id": 31915177, "link": "https://stackoverflow.com/questions/31915177/what-should-be-my-expectations-for-haskells-deriving/31915901#31915901", "title": "What should be my expectations for Haskell&#39;s &quot;deriving&quot;?", "body": "<p>The <a href=\"https://www.haskell.org/onlinereport/haskell2010/haskellch11.html#x18-18200011\" rel=\"nofollow\">Haskell Report 2010</a> (the document that describes the Haskell language and which all implementions should follow) defines the conditions for deriving a class <code>C</code> as follows:</p>\n\n<blockquote>\n  <ol>\n  <li>C is one of <code>Eq</code>, <code>Ord</code>, <code>Enum</code>, <code>Bounded</code>, <code>Show</code>, or <code>Read</code>.</li>\n  <li>There is a context <code>cx\u2032</code> such that <code>cx\u2032 \u21d2 C t<sub>ij</sub></code> holds for each of the constituent types <code>t<sub>ij</sub></code>. </li>\n  <li>If <code>C</code> is <code>Bounded</code>, the type must be either an enumeration (all constructors must be nullary) or have only one constructor. </li>\n  <li>If <code>C</code> is <code>Enum</code>, the type must be an enumeration. </li>\n  <li>There must be no explicit instance declaration elsewhere in the program that makes <code>T u<sub>1</sub> \u2026 u<sub>k</sub></code> an instance of <code>C</code>. </li>\n  <li>If the data declaration has no constructors (i.e. when n = 0), then no classes are derivable.</li>\n  </ol>\n</blockquote>\n\n<p>Also, later in the report, it is said that it's also possible to <a href=\"https://www.haskell.org/onlinereport/haskell2010/haskellch19.html#x27-22700019.2\" rel=\"nofollow\">derive <code>Data.Ix</code> instances</a>.</p>\n\n<p>To find out how a particular instance is derived exactly (for example, what does the derived <code>Show</code> instance output?), read the <a href=\"https://www.haskell.org/onlinereport/haskell2010/haskellch11.html#x18-18200011\" rel=\"nofollow\">section about it</a> in the report. That section only gives implementations for the cases where the above conditions are met. That's why it's impossible to derive <code>Num</code> instances: it's not specified what that instance should do!</p>\n\n<hr>\n\n<p>GHC also provides a few extensions that make allow for deriving more classes.\nThose extensions are not part of standard Haskell, so they have to enabled explicitly. For example, if <code>GenericNewtypeDeriving</code> is enabled, you can write the following:</p>\n\n<pre><code>newtype MyInt = MyInt Int deriving (Num)\n-- By GenericNewtypeDeriving, GHC will just \"copy\" the instance \n-- for the base type of the newtype, in this case, it'll use the `Num Int` instance. \n</code></pre>\n\n<p>You can read about these extensions in the <a href=\"http://downloads.haskell.org/~ghc/latest/docs/html/users_guide/deriving.html#deriving-extra\" rel=\"nofollow\">GHC user guide</a></p>\n"}, {"comments": [{"owner": {"user_type": "does_not_exist", "display_name": "user4861515"}, "edited": false, "score": 0, "creation_date": 1439199336, "post_id": 31916001, "comment_id": 51745120, "body": "I&#39;ve never seen anyone multiply vectors like that...? By your argument, I might like to show the R2 vectors in the struct I wrote differently than the default, but the compiler did something sensible I assume could be overridden."}, {"owner": {"reputation": 44721, "user_id": 546084, "user_type": "registered", "accept_rate": 95, "profile_image": "https://i.stack.imgur.com/wMoWk.jpg?s=128&g=1", "display_name": "Chris Taylor", "link": "https://stackoverflow.com/users/546084/chris-taylor"}, "edited": false, "score": 0, "creation_date": 1439199447, "post_id": 31916001, "comment_id": 51745185, "body": "@flagrant2 It&#39;s the <a href=\"https://en.wikipedia.org/wiki/Hadamard_product_(matrices)\" rel=\"nofollow noreferrer\">Hadamard product</a>."}, {"owner": {"reputation": 44721, "user_id": 546084, "user_type": "registered", "accept_rate": 95, "profile_image": "https://i.stack.imgur.com/wMoWk.jpg?s=128&g=1", "display_name": "Chris Taylor", "link": "https://stackoverflow.com/users/546084/chris-taylor"}, "edited": false, "score": 4, "creation_date": 1439200041, "post_id": 31916001, "comment_id": 51745518, "body": "@flagrant2 How would you define the <code>signum</code> method of the <code>Num</code> class, e.g. what is the sign of the vector (1, -1)? There are so many arbitrary choices to make in implementing a derived <code>Num</code> instance that it would cause more trouble than it is worth. I think the extra 5-6 lines required to write your own <code>Num</code> instance isn&#39;t too much to ask.  It&#39;s acknowledged that the <code>Num</code> type class is a bit of a wart in Haskell, and I believe that there are some efforts to reform it, but they will be slow going, since people will already have written code that depends on the current implementation."}], "tags": [], "owner": {"reputation": 44721, "user_id": 546084, "user_type": "registered", "accept_rate": 95, "profile_image": "https://i.stack.imgur.com/wMoWk.jpg?s=128&g=1", "display_name": "Chris Taylor", "link": "https://stackoverflow.com/users/546084/chris-taylor"}, "is_accepted": false, "score": 5, "last_activity_date": 1439198786, "creation_date": 1439198786, "answer_id": 31916001, "question_id": 31915177, "link": "https://stackoverflow.com/questions/31915177/what-should-be-my-expectations-for-haskells-deriving/31916001#31916001", "title": "What should be my expectations for Haskell&#39;s &quot;deriving&quot;?", "body": "<p>Here's one reason that you can't derive the Num class</p>\n\n<pre><code>data Vector = Vector Int Int\n\ninstance Num Vector where\n    Vector a b + Vector c d = Vector (a + c) (b + d)\n    Vector a b * Vector c d = Vector (a * c) (b * d)\n\ndata Complex = Complex Int Int\n\ninstance Num Complex where\n    Complex a b + Complex c d = Complex (a + c) (b + d)\n    Complex a b * Complex c d = Complex (a * c - b * d) (a * d + b * c)\n</code></pre>\n\n<p>Both are sensible instances that a real programmer might want to define. For a given data definition with two <code>Int</code> fields, which instance should the <code>deriving</code> clause pick?</p>\n"}, {"tags": [], "owner": {"reputation": 31243, "user_id": 2751851, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/4ddc0.png?s=128&g=1", "display_name": "duplode", "link": "https://stackoverflow.com/users/2751851/duplode"}, "is_accepted": false, "score": 6, "last_activity_date": 1439209962, "last_edit_date": 1495539926, "creation_date": 1439199129, "answer_id": 31916114, "question_id": 31915177, "link": "https://stackoverflow.com/questions/31915177/what-should-be-my-expectations-for-haskells-deriving/31916114#31916114", "title": "What should be my expectations for Haskell&#39;s &quot;deriving&quot;?", "body": "<blockquote>\n  <p>trying to understand the deriving keyword, which seems like Java's implements but supposedly with cool automatic code generation</p>\n</blockquote>\n\n<p><code>instance</code> is a bit more like <code>implements</code>, in that you state that a type is an instance of a type class and then write the implementations. <code>deriving</code> is all about the cool automatic generation of those implementations (though it does subsume <code>instance</code>).</p>\n\n<blockquote>\n  <p>How often can one expect to derive a type class and get working code without additional work, like how I didn't have to write my own show function?</p>\n</blockquote>\n\n<p>Alexey Romanov's answer covers for which classes <code>deriving</code> works. There is also another way to auto-generate instances: using <em>generics</em>. From a bird's eye view, it works like this: you describe what an instance should look like for a generic type and then, for any type you want to have an instance, derive <code>Generic</code> and add an empty (i.e. with no implementations, as they will be generated automatically) <code>instance</code> declaration. Some libraries like <code>aeson</code> and <code>binary</code> <a href=\"https://stackoverflow.com/q/17502603/2751851\">offer generic instances ready to use</a>, and you can of course <a href=\"https://stackoverflow.com/q/17416575/2751851\">roll your own</a> for your classes.</p>\n"}, {"tags": [], "owner": {"reputation": 58792, "user_id": 1006010, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/f683d229f3673c9dcc3f3f2796d75c09?s=128&d=identicon&r=PG", "display_name": "MathematicalOrchid", "link": "https://stackoverflow.com/users/1006010/mathematicalorchid"}, "is_accepted": false, "score": 0, "last_activity_date": 1439209061, "creation_date": 1439209061, "answer_id": 31919353, "question_id": 31915177, "link": "https://stackoverflow.com/questions/31915177/what-should-be-my-expectations-for-haskells-deriving/31919353#31919353", "title": "What should be my expectations for Haskell&#39;s &quot;deriving&quot;?", "body": "<p>Sadly, deriving only works for a small handful of classes, where the necessary code is hard-wired into the compiler. You can write instances yourself for <em>any</em> class, but only this small handful can be derived <em>automatically</em>.</p>\n"}], "owner": {"user_type": "does_not_exist", "display_name": "user4861515"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 286, "favorite_count": 1, "answer_count": 5, "score": 8, "last_activity_date": 1439209962, "creation_date": 1439196176, "question_id": 31915177, "link": "https://stackoverflow.com/questions/31915177/what-should-be-my-expectations-for-haskells-deriving", "title": "What should be my expectations for Haskell&#39;s &quot;deriving&quot;?", "body": "<p>Apologies in advance for a beginner question, but I have struggled to find useful info on this. I was working through \"Learn You Haskell for Great Good\" and am trying to understand the deriving keyword, which seems like Java's implements but supposedly with cool automatic code generation because of the category theory stuff or something. I declare a data structure for 2-vectors like</p>\n\n<pre><code>data R2 = R2 {x :: Double, y :: Double} deriving (Show)\n</code></pre>\n\n<p>Then I can use it for things like</p>\n\n<pre><code>show (R2 1.0 2.0)\n</code></pre>\n\n<p>Now what I'd like to do is vector addition and scalar multiplication, like</p>\n\n<pre><code>(2.0 * (R2 1.0 2.0)) + (R2 3.0 4.0)\n</code></pre>\n\n<p>but when I try</p>\n\n<pre><code>Prelude&gt; data R2 = R2 { x :: Double, y :: Double} deriving (Num,Show)\n     &lt;interactive&gt;:3:52:\n     Can't make a derived instance of `Num R2':\n         `Num' is not a derivable class\n     In the data declaration for `R2'\n</code></pre>\n\n<p>So the compiler figured out how to show the cartesian product of primitive types, but addition is too hard? Maybe Num isn't the right type class to derive? How often can one expect to derive a type class and get working code without additional work, like how I didn't have to write my own show function?</p>\n\n<p>Thanks very much,</p>\n\n<p>John</p>\n"}, {"tags": ["haskell", "pattern-matching", "logic"], "answers": [{"tags": [], "owner": {"reputation": 31243, "user_id": 2751851, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/4ddc0.png?s=128&g=1", "display_name": "duplode", "link": "https://stackoverflow.com/users/2751851/duplode"}, "is_accepted": true, "score": 8, "last_activity_date": 1439181911, "last_edit_date": 1495542583, "creation_date": 1439181118, "answer_id": 31911669, "question_id": 31911335, "link": "https://stackoverflow.com/questions/31911335/how-can-i-simplify-this-pattern-matching/31911669#31911669", "title": "How can I simplify this pattern matching?", "body": "<p>At the moment I can't recall any fancy tricks for doing that. One thing you might want to do, however, is factoring out the common structure in your <code>LogicExp</code> constructors:</p>\n\n<pre><code>data LogicExp a\n    = P a\n    | True'\n    | False'\n    | Not' (LogicExp a) \n    | Bin' BinaryOp (LogicExp a) (LogicExp a)\n    deriving Show\n\ndata BinaryOp = And' | Or' | Impl' | Equiv'\n    deriving Show\n</code></pre>\n\n\n\n<pre><code>apply :: [Position] -&gt; (LExp -&gt; LExp) -&gt; LExp -&gt; LExp\napply [] f e = f e\napply (L:xs) f (Bin' op e1 e2) = Bin' op (apply xs f e1) e2\napply (R:xs) f (Bin' op e1 e2) = Bin' op e1 (apply xs f e2)\napply (x:xs) f (Not' e) = apply xs f e\n-- ... and the P, True' and False' cases.\n</code></pre>\n\n<p>By doing that you lose the cute infix constructors. If you really want them back, however, there is a fancy trick: <a href=\"https://downloads.haskell.org/~ghc/latest/docs/html/users_guide/syntax-extns.html#view-patterns\" rel=\"nofollow noreferrer\">view patterns</a> (see also <a href=\"https://stackoverflow.com/q/8172548/2751851\">this question</a> for more examples and discussion).</p>\n"}, {"tags": [], "owner": {"reputation": 49959, "user_id": 866915, "user_type": "registered", "accept_rate": 70, "profile_image": "https://www.gravatar.com/avatar/09242131d6e17cbbe31e8547514da6e5?s=128&d=identicon&r=PG", "display_name": "ErikR", "link": "https://stackoverflow.com/users/866915/erikr"}, "is_accepted": false, "score": 5, "last_activity_date": 1439182154, "creation_date": 1439182154, "answer_id": 31911805, "question_id": 31911335, "link": "https://stackoverflow.com/questions/31911335/how-can-i-simplify-this-pattern-matching/31911805#31911805", "title": "How can I simplify this pattern matching?", "body": "<p>This is a classic case for using one of the Generics packages, either <a href=\"https://hackage.haskell.org/package/syb\" rel=\"noreferrer\">syb</a> or <a href=\"https://hackage.haskell.org/package/uniplate\" rel=\"noreferrer\">uniplate</a>.</p>\n\n<p>Generally <code>uniplate</code> is faster but not as capable as <code>syb</code>. Fortunately in this case you can get away with using <code>uniplate</code>.</p>\n\n<p>Steps to make use of <code>uniplate</code>:</p>\n\n<ol>\n<li>use the <code>DeriveDataTypeable</code> pragma.</li>\n<li>auto derive <code>Data</code> and <code>Typeable</code></li>\n<li>import <code>Data.Data</code> and a uniplate module like <code>Data.Generics.Uniplate.Data</code></li>\n</ol>\n\n<p>The transformation function you want is simply <code>transform</code> with the appropriate type signature:</p>\n\n<pre><code>doit :: LExp -&gt; LExp\ndoit = transform deMorgan\n</code></pre>\n\n<p>where <code>deMorgan</code> is exactly as you have written it.</p>\n\n<p>Complete example:</p>\n\n<pre><code>{-# LANGUAGE DeriveDataTypeable #-}\nmodule Lib6 where\n\nimport Data.Data\nimport Data.Generics.Uniplate.Data\nimport Text.Show.Pretty (ppShow)\n\ndata LogicExp  a = P a                              |\n                     True'                      |\n                     False'                                 |\n                     Not' (LogicExp a)                  |\n                     (LogicExp a) :&amp;  (LogicExp a)  |\n                     (LogicExp a) :|  (LogicExp a)  |\n                     (LogicExp a) :=&gt; (LogicExp a)    |\n                     (LogicExp a) :=  (LogicExp a)\n    deriving (Show, Data, Typeable)\n\ntype LExp = LogicExp String\n\ndata Position = L | R\n\ndeMorgan :: LExp -&gt; LExp\ndeMorgan (e1 :&amp; e2) = Not' ((Not' e1) :| (Not' e2))\ndeMorgan (e1 :| e2) = Not' ((Not' e1) :&amp; (Not' e2))\ndeMorgan x = x\n\ndoit :: LExp -&gt; LExp\ndoit = transform deMorgan\n\nexample = (P \"a\" :&amp; P \"b\") :| (P \"c\")\n\ntest = putStrLn $ ppShow (doit example)\n</code></pre>\n\n<p>Running <code>test</code> produces:</p>\n\n<pre><code>Not' (Not' (Not' (Not' (P \"a\") :| Not' (P \"b\"))) :&amp; Not' (P \"c\"))\n</code></pre>\n\n<p>An intro tutorial on uniplate:</p>\n\n<p><a href=\"http://community.haskell.org/~ndm/darcs/uniplate/uniplate.htm\" rel=\"noreferrer\">http://community.haskell.org/~ndm/darcs/uniplate/uniplate.htm</a></p>\n"}], "owner": {"reputation": 307, "user_id": 5209590, "user_type": "registered", "accept_rate": 62, "profile_image": "https://www.gravatar.com/avatar/f5753a00d8737617369d76800f11b06c?s=128&d=identicon&r=PG&f=1", "display_name": "Gutimore", "link": "https://stackoverflow.com/users/5209590/gutimore"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 183, "favorite_count": 1, "accepted_answer_id": 31911669, "answer_count": 2, "score": 4, "last_activity_date": 1439182154, "creation_date": 1439178318, "last_edit_date": 1439180295, "question_id": 31911335, "link": "https://stackoverflow.com/questions/31911335/how-can-i-simplify-this-pattern-matching", "title": "How can I simplify this pattern matching?", "body": "<p>Im trying to create a model of a propositional logic in Haskell, and i need a function to apply some logic rules to specific subexpressions. The function \"apply\" takes a list which indicate the position of the subexpression in the tree (in terms of right and left sequences), a logic rule and a logic expression and returns a new logic expression.</p>\n\n<pre><code>data LogicExp  a = P a                              | \n                     True'                      | \n                     False'                                 | \n                     Not' (LogicExp a)                  |  \n                     (LogicExp a) :&amp;  (LogicExp a)  | \n                     (LogicExp a) :|  (LogicExp a)  | \n                     (LogicExp a) :=&gt; (LogicExp a)    |\n                     (LogicExp a) :=  (LogicExp a)\n    deriving Show\n\n\ntype LExp = LogicExp String\n\ndata Position = L | R\n\ndeMorgan :: LExp -&gt; LExp\ndeMorgan (e1 :&amp; e2) = Not' ((Not e1) :| (Not e2))\ndeMorgan (e1 :| e2) = Not' ((Not e1) :&amp; (Not e2))\ndeMorgan x = x\n\napply :: [Position] -&gt; (LExp -&gt; LExp) -&gt; LExp -&gt; LExp\napply [] f e = f e\napply (L:xs) f (e1 :&amp; e2) = (apply xs f e1) :&amp; e2\napply (R:xs) f (e1 :&amp; e2) = e1 :&amp; (apply xs f e2)\napply (L:xs) f (e1 :| e2) = (apply xs f e1) :| e2\napply (R:xs) f (e1 :| e2) = e1 :| (apply xs f e2)\napply (L:xs) f (e1 :=&gt; e2) = (apply xs f e1) :=&gt; e2\napply (R:xs) f (e1 :=&gt; e2) = e1 :=&gt; (apply xs f e2)\napply (L:xs) f (e1 := e2) = (apply xs f e1) := e2\napply (R:xs) f (e1 := e2) = e1 := (apply xs f e2)\napply (x:xs) f (Not' e) = apply xs f e\n</code></pre>\n\n<p>The function works fine. But can I use some data constructor \"wildcard\" to have a more simple function like this?</p>\n\n<pre><code>apply :: [Position] -&gt; (LExp -&gt; LExp) -&gt; LExp -&gt; LExp\napply [] f e = f e\napply (L:xs) f (e1 ?? e2) = (apply xs f e1) ?? e2\napply (R:xs) f (e1 ?? e2) = e1 ?? (apply xs f e2)\napply (x:xs) f (Not' e) = apply xs f e\n</code></pre>\n"}, {"tags": ["haskell"], "comments": [{"owner": {"reputation": 94553, "user_id": 775806, "user_type": "registered", "accept_rate": 96, "profile_image": "https://i.stack.imgur.com/XNd2C.png?s=128&g=1", "display_name": "n. &#39;pronouns&#39; m.", "link": "https://stackoverflow.com/users/775806/n-pronouns-m"}, "edited": false, "score": 4, "creation_date": 1439175551, "post_id": 31910777, "comment_id": 51735689, "body": "<code>Integral</code> is not a type, it&#39;s a type class."}, {"owner": {"reputation": 4685, "user_id": 5180989, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/Gxpck.jpg?s=128&g=1", "display_name": "Helder Pereira", "link": "https://stackoverflow.com/users/5180989/helder-pereira"}, "edited": false, "score": 0, "creation_date": 1439200084, "post_id": 31910777, "comment_id": 51745537, "body": "You may want to have a look here: <a href=\"http://stackoverflow.com/questions/31841767/explanation-of-numbers-in-haskell\" title=\"explanation of numbers in haskell\">stackoverflow.com/questions/31841767/&hellip;</a>"}, {"owner": {"reputation": 21, "user_id": 5209463, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/632d0f82fe6d39076fd59323ac0c2f58?s=128&d=identicon&r=PG&f=1", "display_name": "hiroyuki", "link": "https://stackoverflow.com/users/5209463/hiroyuki"}, "edited": false, "score": 0, "creation_date": 1439208407, "post_id": 31910777, "comment_id": 51750695, "body": "Thanks. I read it. Haskell has various types about number. I&#39;m still confused."}], "answers": [{"comments": [{"owner": {"reputation": 21, "user_id": 5209463, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/632d0f82fe6d39076fd59323ac0c2f58?s=128&d=identicon&r=PG&f=1", "display_name": "hiroyuki", "link": "https://stackoverflow.com/users/5209463/hiroyuki"}, "edited": false, "score": 1, "creation_date": 1439180683, "post_id": 31911457, "comment_id": 51736666, "body": "Thanks. To be honest, I didn&#39;t tell a type from a type class. I&#39;ll use Integral to bind a type variable. I have not known <code>let x = 1::Integral a =&gt; a</code>  works."}], "tags": [], "owner": {"reputation": 339851, "user_id": 149392, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/7a561ec0875fcbbe3066ea8fe288ec77?s=128&d=identicon&r=PG", "display_name": "sepp2k", "link": "https://stackoverflow.com/users/149392/sepp2k"}, "is_accepted": false, "score": 6, "last_activity_date": 1439179448, "creation_date": 1439179448, "answer_id": 31911457, "question_id": 31910777, "link": "https://stackoverflow.com/questions/31910777/why-this-code-is-an-error-1-integral/31911457#31911457", "title": "why this code is an error? &gt; 1 :: Integral", "body": "<p><code>Int</code> is a type, <code>Integral</code> is a type class. Type classes are used as bounds for type variables, they can't be used as types directly. Perhaps you meant to use <code>1 :: Integer</code>, which is the other standard type that implements the <code>Integral</code> type class.</p>\n\n<p>If you want a polymorphic <code>Integral</code>, i.e. one that can be used as either <code>Int</code> or <code>Integer</code> (or any user-defined type that implements <code>Integral</code>), you can do something like <code>let x = 1 :: Integral a =&gt; a</code>. Note that here <code>Integral</code> is only used on the left side of the <code>=&gt;</code> to provide a bound for the type variable <code>a</code> and <code>a</code> is used as the type on the right side. Also note that you can't actually print the value of <code>x</code> without giving it a concrete type as you need a concrete type to select which <code>show</code> method to call.</p>\n"}], "owner": {"reputation": 21, "user_id": 5209463, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/632d0f82fe6d39076fd59323ac0c2f58?s=128&d=identicon&r=PG&f=1", "display_name": "hiroyuki", "link": "https://stackoverflow.com/users/5209463/hiroyuki"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 103, "favorite_count": 0, "answer_count": 1, "score": 1, "last_activity_date": 1439179448, "creation_date": 1439173010, "last_edit_date": 1439176370, "question_id": 31910777, "link": "https://stackoverflow.com/questions/31910777/why-this-code-is-an-error-1-integral", "title": "why this code is an error? &gt; 1 :: Integral", "body": "<p>I know this works.</p>\n\n<pre><code>Preulde&gt; 1::Int\n1\n</code></pre>\n\n<p>But this doesn't work.</p>\n\n<pre><code>Preude&gt; 1::Integral\n</code></pre>\n\n<p>I want to know the difference between Int and Integral.</p>\n"}, {"tags": ["haskell", "pattern-synonyms"], "comments": [{"owner": {"reputation": 1220, "user_id": 2124732, "user_type": "registered", "accept_rate": 86, "profile_image": "https://www.gravatar.com/avatar/cf9d2998c0d9cb26334028f72185fe38?s=128&d=identicon&r=PG", "display_name": "Christopher Dumas", "link": "https://stackoverflow.com/users/2124732/christopher-dumas"}, "edited": false, "score": 0, "creation_date": 1441149392, "post_id": 31910536, "comment_id": 52559076, "body": "This is probably not what you want, but what about: <code>pattern Barz a b c &lt;- Foo { a b c }</code>?"}, {"owner": {"reputation": 131, "user_id": 3198498, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/93a59a961e9ce801078d8457207c1967?s=128&d=identicon&r=PG&f=1", "display_name": "wrl", "link": "https://stackoverflow.com/users/3198498/wrl"}, "reply_to_user": {"reputation": 1220, "user_id": 2124732, "user_type": "registered", "accept_rate": 86, "profile_image": "https://www.gravatar.com/avatar/cf9d2998c0d9cb26334028f72185fe38?s=128&d=identicon&r=PG", "display_name": "Christopher Dumas", "link": "https://stackoverflow.com/users/2124732/christopher-dumas"}, "edited": false, "score": 0, "creation_date": 1441682373, "post_id": 31910536, "comment_id": 52760499, "body": "@ChristopherDumas - I&#39;m hoping to find a solution with either a single pattern per field, or a pattern with a record-like syntax using names since Foo may have 10 or more fields. The good news is that ticket 8582 is slated for inclusion in the next version of GHC, so we should get pattern synonyms with record syntax then."}], "answers": [{"tags": [], "owner": {"reputation": 405, "user_id": 3581753, "user_type": "registered", "accept_rate": 33, "profile_image": "https://www.gravatar.com/avatar/4cfe62cc75a67f573e9f638c348f5004?s=128&d=identicon&r=PG&f=1", "display_name": "archaephyrryx", "link": "https://stackoverflow.com/users/3581753/archaephyrryx"}, "is_accepted": false, "score": 1, "last_activity_date": 1470972324, "creation_date": 1470972324, "answer_id": 38909405, "question_id": 31910536, "link": "https://stackoverflow.com/questions/31910536/combining-patterns/38909405#38909405", "title": "Combining patterns", "body": "<p>Not sure if this is at all helpful, but I will give it a shot. Would either of these solutions be acceptable?</p>\n\n<pre class=\"lang-hs prettyprint-override\"><code>showit :: Foo -&gt; String\nshowit x@(Bar a b) = show a ++ b ++ show (c x)\n\nshowit' :: Foo -&gt; String\nshowit' x@(Bar a b) = show a ++ b ++ showthat x\n  where\n    showthat (Baz c) = show c\n</code></pre>\n"}], "owner": {"reputation": 131, "user_id": 3198498, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/93a59a961e9ce801078d8457207c1967?s=128&d=identicon&r=PG&f=1", "display_name": "wrl", "link": "https://stackoverflow.com/users/3198498/wrl"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 225, "favorite_count": 2, "answer_count": 1, "score": 10, "last_activity_date": 1470972324, "creation_date": 1439170711, "last_edit_date": 1495542770, "question_id": 31910536, "link": "https://stackoverflow.com/questions/31910536/combining-patterns", "title": "Combining patterns", "body": "<p>Consider the following data type and pattern synonyms:</p>\n\n<pre><code>{-# LANGUAGE PatternSynonyms, NamedFieldPuns #-}\n\ndata Foo = Foo {\n      a :: Int\n    , b :: String\n    , c :: Maybe Bool\n}\n\npattern Bar a b &lt;- Foo { a, b }\npattern Baz c &lt;- Foo { c }\n</code></pre>\n\n<p>I'd like to match a <code>Foo</code> but get all of <code>a</code>, <code>b</code>, and <code>c</code>. Something like this (invalid Haskell):</p>\n\n<pre><code>showit :: Foo -&gt; String\nshowit (Bar a b &amp; Baz c) = show a ++ b ++ show c\n</code></pre>\n\n<p>One option is to use a <code>ViewPattern</code>:</p>\n\n<pre><code>dup :: a -&gt; (a, a)\ndup a = (a, a)\n\nshowall' :: Foo -&gt; String\nshowall' (dup -&gt; (Bar a b, Baz c)) = show a ++ b ++ show c\n</code></pre>\n\n<p>But this results in a non-exhaustive match warning. But we know that <code>Bar</code> and <code>Baz</code> are irrefutable so matching each is also irrefutable.</p>\n\n<p>How can this be expressed without a compiler warning?</p>\n\n<p>The motivation for this is to have fine-grained pattern synonyms against fields of a large data type and allow callers to extract just the desired fields similar to records with <code>NamedFieldPuns</code>. Pattern synonyms don't yet support record syntax, but it's in the works : <a href=\"https://ghc.haskell.org/trac/ghc/ticket/8582\" rel=\"nofollow noreferrer\">https://ghc.haskell.org/trac/ghc/ticket/8582</a></p>\n\n<p>In my case I cannot expose the constructor from the module since I'm using the \"smart-constructor\" pattern, and hence cannot give callers the benefit of record pattern matching with <code>NamedFieldPuns</code>.</p>\n\n<p>See <a href=\"https://stackoverflow.com/a/25161749/3198498\">https://stackoverflow.com/a/25161749/3198498</a> as the inspiration. I'm trying to expand the idea in that answer to allow callers to arbitrarily extract <em>n</em> of <em>m</em> fields, for a largish <em>m</em>.</p>\n\n<p>Edit: It turns out there is a rather broad problem with <code>PatternSynonyms</code> and exhaustiveness checks : <a href=\"https://ghc.haskell.org/trac/ghc/ticket/10339\" rel=\"nofollow noreferrer\">https://ghc.haskell.org/trac/ghc/ticket/10339</a>\nThis seems to make pattern synonyms used as field extractors very unpleasant when compiling with warnings enabled.</p>\n"}, {"tags": ["haskell", "memoization"], "answers": [{"tags": [], "owner": {"reputation": 49959, "user_id": 866915, "user_type": "registered", "accept_rate": 70, "profile_image": "https://www.gravatar.com/avatar/09242131d6e17cbbe31e8547514da6e5?s=128&d=identicon&r=PG", "display_name": "ErikR", "link": "https://stackoverflow.com/users/866915/erikr"}, "is_accepted": false, "score": 2, "last_activity_date": 1439162838, "creation_date": 1439162838, "answer_id": 31909804, "question_id": 31908724, "link": "https://stackoverflow.com/questions/31908724/memoizing-a-function-that-takes-a-set-as-parameter/31909804#31909804", "title": "memoizing a function that takes a set as parameter", "body": "<p>What you have for <code>test</code> is fine, although normally you would define <code>test</code> as a function on sets using Set operations. Here is an example of what I'm talking about:</p>\n\n<pre><code>-- memoize a function on Set Int\nfoo = set M.integral foo'\n  where foo' s | Set.null s = 0\n        foo' s = let a = Set.findMin s\n                     b = Set.findMax s\n                     m = (a+b) `div` 2\n                     (lo,found,hi) = Set.splitMember m s\n                 in if a &gt;= b\n                      then 1\n                      else (if found then 1 else 0) + foo lo + foo hi\n</code></pre>\n\n<p>This is a very inefficient way of counting the number of elements in a set, but note how <code>foo'</code> is defined in terms of Set operations.</p>\n\n<p>Re your other questions:</p>\n\n<blockquote>\n  <ol>\n  <li>what is the second parameter to the Memo.list function? Is it a memoizer for the elements of the list?</li>\n  </ol>\n</blockquote>\n\n<p><code>Memo.list</code> has signature <code>Memo a -&gt; Memo [a]</code>, so in the expression <code>Memo.list m f</code> we have:</p>\n\n<pre><code>m :: Memo a\nf :: [a] -&gt; r    -- some type r\nMemo.list m f :: [a] -&gt; r\n</code></pre>\n\n<p>So <code>f</code> is the function on <code>[a]</code> that you are memoizing, and <code>m</code> is a memoizer for functions taking a parameter of type <code>a</code>.</p>\n\n<blockquote>\n  <ol start=\"2\">\n  <li>how to implement a table for a set directly?</li>\n  </ol>\n</blockquote>\n\n<p>It depends on what you mean by \"directly\". Memoizing in this fashion is going to involving creating an (possibly infinite) lazy data structure. The <code>string</code>, <code>integral</code> and <code>list</code> memoizers all use some form a lazy trie. This is very different from memoization in imperative languages where you explicitly check a hash map to see if you've already computed something and update that hash map with the function's value, etc. (Btw - you can do that sort of memoization in the ST or IO monads and it might work even better than the Data.Memocombinators approach - something to consider.)</p>\n\n<p>Your idea of memoizing a <code>Set a -&gt; r</code> function by passing to a list is a fine idea, but I would use to/from AscList:</p>\n\n<pre><code>set m f = Memo.list m (f . Set.fromAscList) . Set.toAscList\n</code></pre>\n\n<p>That way the set <code>Set.fromList [3,4,5]</code> will re-use the same part of the trie that was created to memoize the value for <code>Set.fromList [3,4]</code>.</p>\n"}, {"comments": [{"owner": {"reputation": 49959, "user_id": 866915, "user_type": "registered", "accept_rate": 70, "profile_image": "https://www.gravatar.com/avatar/09242131d6e17cbbe31e8547514da6e5?s=128&d=identicon&r=PG", "display_name": "ErikR", "link": "https://stackoverflow.com/users/866915/erikr"}, "edited": false, "score": 0, "creation_date": 1439170030, "post_id": 31910190, "comment_id": 51734663, "body": "Your <code>fib</code> example is fine, but note that the map created is not kept around between invocations of <code>fib2</code>. Also, you should try using <code>Data.IntMap</code>  to see if it performs any better than <code>Data.Map</code>."}], "tags": [], "owner": {"reputation": 4685, "user_id": 5180989, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/Gxpck.jpg?s=128&g=1", "display_name": "Helder Pereira", "link": "https://stackoverflow.com/users/5180989/helder-pereira"}, "is_accepted": true, "score": 2, "last_activity_date": 1439195447, "last_edit_date": 1439195447, "creation_date": 1439167099, "answer_id": 31910190, "question_id": 31908724, "link": "https://stackoverflow.com/questions/31908724/memoizing-a-function-that-takes-a-set-as-parameter/31910190#31910190", "title": "memoizing a function that takes a set as parameter", "body": "<blockquote>\n  <ol>\n  <li>what is the second parameter to the Memo.list function? Is it a memoizer for the elements of the list?</li>\n  </ol>\n</blockquote>\n\n<p>The first parameter <code>m</code> is the memoizer for the elements of the list. The second parameter <code>f</code> is the function that you want to apply to the list (and that will be memoized too).</p>\n\n<blockquote>\n  <ol start=\"2\">\n  <li>how to implement a table for a set directly, without using Memo.list? Here is would like to figure out how to implement\n  memoization manually without using someone's library. For example,\n  using a Map. I have seen examples that memoize integers using an\n  infinite list but in case of a map I cannot figure out how to\n  initialize the map and how to insert into it.</li>\n  </ol>\n</blockquote>\n\n<p>Using the same strategy of <code>Data.MemoCombinators</code>, you can do something similar to want they do for lists. This approach does not use an explicit data structure for that, but explores the way Haskell keep things in memory and lazy evaluation.</p>\n\n<pre><code>set :: Ord a =&gt; Memo a -&gt; Memo (Set a)\nset m f = table (f Set.empty) (m (\\x -&gt; set m (f . (x `Set.insert`))))\n  where\n  table nil cons set | Set.null set = nil\n                     | otherwise    = uncurry cons (Set.deleteFindMin set)\n</code></pre>\n\n<p>You can also use memoization in Haskell using an explicit data structure (like a <code>Map</code>). I will use the Fibonacci example to demonstrate that, because it easier to benchmark, but it would be similar for other functions.</p>\n\n<p>Let's start with the naive implementation:</p>\n\n<pre><code>fib0 :: Integer -&gt; Integer\nfib0 0 = 0\nfib0 1 = 1\nfib0 x = fib0 (x-1) + fib0 (x-2)\n</code></pre>\n\n<p>Then <a href=\"https://hackage.haskell.org/package/data-memocombinators-0.3/docs/Data-MemoCombinators.html\" rel=\"nofollow\"><code>Data.MemoCombinators</code></a> proposes this implementation:</p>\n\n<pre><code>import qualified Data.MemoCombinators as Memo\n\nfib1 :: Integer -&gt; Integer\nfib1 = Memo.integral fib'\n  where\n  fib' 0 = 0\n  fib' 1 = 1\n  fib' x = fib1 (x-1) + fib1 (x-2)\n</code></pre>\n\n<p>And finally, my version using <code>Map</code>:</p>\n\n<pre><code>import Data.Map (Map)\nimport qualified Data.Map as Map\n\nfib2 :: Integer -&gt; Integer\nfib2 = fst . fib' (Map.fromList [(0, 0),(1, 1)])\n  where\n  fib' m0 x | x `Map.member` m0 = (Map.findWithDefault 0 x m0, m0)\n            | otherwise         = let (v1, m1) = fib' m0 (x-1)\n                                      (v2, m2) = fib' m1 (x-2)\n                                      y = v1 + v2\n                                  in (y, Map.insert x y m2)\n</code></pre>\n\n<p>Now, let's see how they perform:</p>\n\n<pre><code>fib0 40: 13.529371s\nfib1 40: 0.000121s\nfib2 40: 0.000048s\n</code></pre>\n\n<p>The <code>fib0</code> was already too slow. Let's do a proper test with the other two:</p>\n\n<pre><code>fib1 400000: 6.234243s\nfib2 400000: 4.022798s\n\nfib1 500000: 8.683649s\nfib2 500000: 5.781104s\n</code></pre>\n\n<p>The <code>Map</code> solution seem actually to outperform the <code>Memo</code> solution for all tests I performed. But I think the greatest advantage of <code>Data.MemoCombinators</code> is actually having this great performance without having to write much more code than the naive solution.</p>\n\n<hr>\n\n<p><strong>Updated:</strong> I changed the conclusions, because I was not doing the benchmark properly. I was doing several calls in the same execution, and in the case of 500000, whatever was the second call (either <code>fib1</code> or <code>fib2</code>), that was taking too long.</p>\n"}], "owner": {"reputation": 26022, "user_id": 410102, "user_type": "registered", "accept_rate": 93, "profile_image": "https://www.gravatar.com/avatar/a70b7da5a3a712e800100e61ef8d8917?s=128&d=identicon&r=PG", "display_name": "akonsu", "link": "https://stackoverflow.com/users/410102/akonsu"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 233, "favorite_count": 0, "accepted_answer_id": 31910190, "answer_count": 2, "score": 2, "last_activity_date": 1439195447, "creation_date": 1439153492, "last_edit_date": 1439154279, "question_id": 31908724, "link": "https://stackoverflow.com/questions/31908724/memoizing-a-function-that-takes-a-set-as-parameter", "title": "memoizing a function that takes a set as parameter", "body": "<p>I am using <code>Data.MemoCombinators</code> (<a href=\"https://hackage.haskell.org/package/data-memocombinators-0.3/docs/Data-MemoCombinators.html\" rel=\"nofollow\">https://hackage.haskell.org/package/data-memocombinators-0.3/docs/Data-MemoCombinators.html</a>) to memoize a function that takes a set as its parameter and returns a set (this is a contrived example that does nothing but takes a long time to finish):</p>\n\n<pre><code>test s = case Set.toList s of\n         []     -&gt; Set.singleton 0\n         [x]    -&gt; Set.singleton 1\n         (x:xs) -&gt; test (Set.singleton x) `Set.union` test (Set.fromList xs)\n</code></pre>\n\n<p>Since <code>Data.MemoCombinators</code> does not implement a table for sets, I wanted to write my own:</p>\n\n<pre><code>{-# LANGUAGE RankNTypes #-}\n\nimport Data.MemoCombinators (Memo)\nimport qualified Data.MemoCombinators as Memo\nimport Data.Set (Set)\nimport qualified Data.Set as Set\n\nset :: Ord a =&gt; Memo a -&gt; ((Set a) -&gt; r) -&gt; (Set a) -&gt; r\nset m f = Memo.list m (f . Set.fromList) . Set.toList\n</code></pre>\n\n<p>and here is my <code>test</code> that was supposed to be memoized:</p>\n\n<pre><code>test s = set Memo.integral test' s\n    where\n      test' s = case Set.toList s of\n                []     -&gt; Set.singleton 0\n                [x]    -&gt; Set.singleton 1\n                (x:xs) -&gt; test (Set.singleton x) `Set.union` test (Set.fromList xs)\n</code></pre>\n\n<p>There is no documentation for <code>Data.MemoCombinators</code> that is clear to me, so basically I do not know exactly what I am doing.</p>\n\n<p>My questions are:</p>\n\n<ol>\n<li><p>what is the second parameter to the <code>Memo.list</code> function? Is it a memoizer for the elements of the list?</p></li>\n<li><p>how to implement a table for a set directly, without using <code>Memo.list</code>? Here is would like to figure out how to implement memoization manually without using someone's library. For example, using a <code>Map</code>. I have seen examples that memoize integers using an infinite list but in case of a map I cannot figure out how to initialize the map and how to insert into it.</p></li>\n</ol>\n\n<p>Thanks for any help.</p>\n"}, {"tags": ["xml", "haskell"], "answers": [{"comments": [{"owner": {"reputation": 11606, "user_id": 1002430, "user_type": "registered", "accept_rate": 53, "profile_image": "https://i.stack.imgur.com/ufy7U.png?s=128&g=1", "display_name": "Ana", "link": "https://stackoverflow.com/users/1002430/ana"}, "edited": false, "score": 0, "creation_date": 1439143861, "post_id": 31907260, "comment_id": 51728530, "body": "Thanks, it worked. This cursor/axis terminology is confusing me still. Have to work on it."}, {"owner": {"reputation": 11593, "user_id": 2494803, "user_type": "registered", "accept_rate": 88, "profile_image": "https://www.gravatar.com/avatar/58b4b1d0d8887426a51330a990936ac1?s=128&d=identicon&r=PG", "display_name": "bennofs", "link": "https://stackoverflow.com/users/2494803/bennofs"}, "reply_to_user": {"reputation": 11606, "user_id": 1002430, "user_type": "registered", "accept_rate": 53, "profile_image": "https://i.stack.imgur.com/ufy7U.png?s=128&g=1", "display_name": "Ana", "link": "https://stackoverflow.com/users/1002430/ana"}, "edited": false, "score": 0, "creation_date": 1439144010, "post_id": 31907260, "comment_id": 51728574, "body": "@Ana A <code>Cursor</code> just refers to a single Node (and allows efficient navigating, like getting children/parent/siblings). An &#39;Axis&#39; is just something which given a <code>Cursor</code> to a <code>Node</code>, returns a list of <code>Cursor</code>s (so <code>Cursor -&gt; [Cursor]</code>). So an &#39;Axis&#39; is just a kind of query: given a Node, it returns a list of Nodes that match the query."}], "tags": [], "owner": {"reputation": 11593, "user_id": 2494803, "user_type": "registered", "accept_rate": 88, "profile_image": "https://www.gravatar.com/avatar/58b4b1d0d8887426a51330a990936ac1?s=128&d=identicon&r=PG", "display_name": "bennofs", "link": "https://stackoverflow.com/users/2494803/bennofs"}, "is_accepted": true, "score": 1, "last_activity_date": 1439143474, "creation_date": 1439143474, "answer_id": 31907260, "question_id": 31907121, "link": "https://stackoverflow.com/questions/31907121/in-xml-conduit-what-is-the-proper-way-to-pass-a-cursor-to-a-function/31907260#31907260", "title": "In xml-conduit, what is the &quot;proper&quot; way to pass a cursor to a function?", "body": "<p>You can use <code>&gt;=&gt;</code> instead of <code>&gt;&gt;=</code> to avoid the parentheses:</p>\n\n<pre><code>(&gt;=&gt;) :: Monad m =&gt; (a -&gt; m b) -&gt; (b -&gt; m c) -&gt; (a -&gt; m c)\n\n-- Specializing for m ~ [] and a ~ Cursor Node and b ~ Cursor Node\n(&gt;=&gt;) :: Axis Node -&gt; (Cursor Node -&gt; [c]) -&gt; Cursor Node -&gt; [c]\n\ncur $/ elm \"trk\" &amp;/ elm \"trkseg\" &amp;/ elm \"trkpt\" &gt;=&gt; extract\n</code></pre>\n\n<p>So <code>(&gt;=&gt;)</code> works like <code>(&amp;/)</code>, but without retrieving the children of the current node first. </p>\n\n<p><em>Disclaimer: I haven't actually tried this</em></p>\n"}], "owner": {"reputation": 11606, "user_id": 1002430, "user_type": "registered", "accept_rate": 53, "profile_image": "https://i.stack.imgur.com/ufy7U.png?s=128&g=1", "display_name": "Ana", "link": "https://stackoverflow.com/users/1002430/ana"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 107, "favorite_count": 0, "accepted_answer_id": 31907260, "answer_count": 1, "score": 1, "last_activity_date": 1439143474, "creation_date": 1439142510, "last_edit_date": 1495540679, "question_id": 31907121, "link": "https://stackoverflow.com/questions/31907121/in-xml-conduit-what-is-the-proper-way-to-pass-a-cursor-to-a-function", "title": "In xml-conduit, what is the &quot;proper&quot; way to pass a cursor to a function?", "body": "<p>From a <a href=\"https://stackoverflow.com/questions/31897737/how-to-parse-gpx-file-using-haskells-xml-conduit\">previous question</a> I asked, I learned how to use <code>xml-conduit</code> to do some basic XML parsing of GPX files.</p>\n\n<p>After some fidgeting, I now have a function that processes GPX files as follows:</p>\n\n<pre><code>{-# LANGUAGE OverloadedStrings #-}\n\nimport Control.Applicative\nimport Data.Text           as T\nimport Text.XML\nimport Text.XML.Cursor\n\ndata Trkpt = Trkpt {\n  trkptTime :: Text,\n  trkptLat  :: Text,\n  trkptLon  :: Text\n  } deriving (Show)\n\ntrkptsFromFile path =\n  trkpts . fromDocument &lt;$&gt; Text.XML.readFile def path\n\ntrkpts cur =\n  (cur $/ elm \"trk\" &amp;/ elm \"trkseg\" &amp;/ elm \"trkpt\") &gt;&gt;= extract\n  where\n    elm n = element $ Name n (Just \"http://www.topografix.com/GPX/1/1\") Nothing\n    extract cur = do\n      let time = T.concat $ cur $/ elm \"time\" &amp;// content\n      let lat  = T.concat $ attribute \"lat\" cur\n      let lon  = T.concat $ attribute \"lon\" cur\n      return $ Trkpt time lat lon\n</code></pre>\n\n<p>In particular, I have the line:</p>\n\n<pre><code>  (cur $/ elm \"trk\" &amp;/ elm \"trkseg\" &amp;/ elm \"trkpt\") &gt;&gt;= extract\n</code></pre>\n\n<p>and I noticed I have to wrap the first part in parentheses in order to <code>&gt;&gt;=</code> it to my <code>extract</code> function. Is this the proper way to do this or is there some idiomatic way using the operators provided in the <code>xml-conduit</code> package?</p>\n"}, {"tags": ["parsing", "haskell", "parsec"], "comments": [{"owner": {"reputation": 11593, "user_id": 2494803, "user_type": "registered", "accept_rate": 88, "profile_image": "https://www.gravatar.com/avatar/58b4b1d0d8887426a51330a990936ac1?s=128&d=identicon&r=PG", "display_name": "bennofs", "link": "https://stackoverflow.com/users/2494803/bennofs"}, "edited": false, "score": 0, "creation_date": 1439142342, "post_id": 31906934, "comment_id": 51728060, "body": "Does your file end with a newline?"}, {"owner": {"reputation": 2337, "user_id": 3595992, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/a8fc8a00391b1282338f66de57e3fea0?s=128&d=identicon&r=PG&f=1", "display_name": "JeanJouX", "link": "https://stackoverflow.com/users/3595992/jeanjoux"}, "reply_to_user": {"reputation": 11593, "user_id": 2494803, "user_type": "registered", "accept_rate": 88, "profile_image": "https://www.gravatar.com/avatar/58b4b1d0d8887426a51330a990936ac1?s=128&d=identicon&r=PG", "display_name": "bennofs", "link": "https://stackoverflow.com/users/2494803/bennofs"}, "edited": false, "score": 0, "creation_date": 1439142498, "post_id": 31906934, "comment_id": 51728106, "body": "Yes and there are blank lines before and after the array of data."}], "answers": [{"comments": [{"owner": {"reputation": 11593, "user_id": 2494803, "user_type": "registered", "accept_rate": 88, "profile_image": "https://www.gravatar.com/avatar/58b4b1d0d8887426a51330a990936ac1?s=128&d=identicon&r=PG", "display_name": "bennofs", "link": "https://stackoverflow.com/users/2494803/bennofs"}, "edited": false, "score": 0, "creation_date": 1439144296, "post_id": 31907227, "comment_id": 51728645, "body": "Can you explain what exactly is wrong with the approach in the question? Is it just &quot;digits <code>sepBy</code> spaces&quot; vs <code>spaces *&gt; digits</code> ?"}, {"owner": {"reputation": 2337, "user_id": 3595992, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/a8fc8a00391b1282338f66de57e3fea0?s=128&d=identicon&r=PG&f=1", "display_name": "JeanJouX", "link": "https://stackoverflow.com/users/3595992/jeanjoux"}, "edited": false, "score": 0, "creation_date": 1439147704, "post_id": 31907227, "comment_id": 51729629, "body": "What is the function <code>*&gt;</code> where does it come from ?"}, {"owner": {"reputation": 11593, "user_id": 2494803, "user_type": "registered", "accept_rate": 88, "profile_image": "https://www.gravatar.com/avatar/58b4b1d0d8887426a51330a990936ac1?s=128&d=identicon&r=PG", "display_name": "bennofs", "link": "https://stackoverflow.com/users/2494803/bennofs"}, "edited": false, "score": 1, "creation_date": 1439153305, "post_id": 31907227, "comment_id": 51731206, "body": "It&#39;s the same as <code>&gt;&gt;</code> (but with a more general type signature) and it comes from <code>Control.Applicative</code>"}], "tags": [], "owner": {"reputation": 34015, "user_id": 1026598, "user_type": "registered", "accept_rate": 85, "profile_image": "https://www.gravatar.com/avatar/e4cf2da845e7862bd0b0e4edd405f77d?s=128&d=identicon&r=PG", "display_name": "Gabriel Gonzalez", "link": "https://stackoverflow.com/users/1026598/gabriel-gonzalez"}, "is_accepted": true, "score": 1, "last_activity_date": 1439143257, "creation_date": 1439143257, "answer_id": 31907227, "question_id": 31906934, "link": "https://stackoverflow.com/questions/31906934/parsing-columns-of-data-with-parsec/31907227#31907227", "title": "Parsing columns of data with parsec", "body": "<p>Your program is doing something different than what you expect.  The key part is right here:</p>\n\n<pre><code>parseSeries = do \n    spaces\n    titles &lt;- title `sepBy` spaces\n    let nb = length titles\n\n    -- The following is the incorrect part\n    dat &lt;- endBy (count (nb-1) (digits `sepBy` spaces)) endOfLine\n    spaces\n    return (titles,concat dat)\n</code></pre>\n\n<p>I believe what you actually wanted was:</p>\n\n<pre><code>parseSeries = do \n    spaces\n    titles &lt;- title `sepBy` spaces\n    let nb = length titles\n\n    let parseRow = do\n            column  &lt;- digits\n            columns &lt;- count (nb - 1) (spaces *&gt; digits)\n            newline\n            return (column:columns)\n    dat &lt;- many parseRow\n    return (titles, dat)\n</code></pre>\n"}], "owner": {"reputation": 2337, "user_id": 3595992, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/a8fc8a00391b1282338f66de57e3fea0?s=128&d=identicon&r=PG&f=1", "display_name": "JeanJouX", "link": "https://stackoverflow.com/users/3595992/jeanjoux"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 115, "favorite_count": 0, "accepted_answer_id": 31907227, "answer_count": 1, "score": 0, "last_activity_date": 1439143257, "creation_date": 1439141484, "question_id": 31906934, "link": "https://stackoverflow.com/questions/31906934/parsing-columns-of-data-with-parsec", "title": "Parsing columns of data with parsec", "body": "<p>I'm writing a parser to scan columns of numbers. like this : </p>\n\n<pre><code>T   LIST2   LIST3   LIST4\n1   235 623 684\n2   871 699 557\n3   918 686 49\n4   53  564 906\n5   246 344 501\n6   929 138 474\n</code></pre>\n\n<p>The first line contain the name of the lists and I would like my program to parse exactly the same number of data as in the title (to exclude arrays with incoherent number of titles or columns).</p>\n\n<p>I wrote this program : </p>\n\n<pre><code>title = do\n  tit &lt;- many1 alphaNum\n  return tit\n\ndigits = do\n  dig &lt;- many1 digit\n  return dig\n\nparseSeries = do \n    spaces\n    titles &lt;- title `sepBy` spaces\n    let nb = length titles\n    dat &lt;- endBy (count (nb-1) (digits `sepBy` spaces)) endOfLine\n    spaces\n    return (titles,concat dat)\n\nmain = do\n    fichier &lt;- readFile (\"test_list3.txt\")\n    putStrLn $ fichier\n    case parse parseSeries \"(stdin)\" fichier of\n            Left error -&gt; do putStrLn \"!!! Error !!!\"\n                             print error\n            Right (tit,resu) -&gt; do  \n                                mapM_ putStrLn  tit\n                                mapM_ putStrLn  (concat  resu)\n</code></pre>\n\n<p>but when I try to parse a file with this kind of data, I have the following error : </p>\n\n<pre><code>!!! Error !!!\n\"(stdin)\" (line 26, column 1):\nunexpected end of input\nexpecting space or letter or digit\n</code></pre>\n\n<p>I'm a newbie with parsing and I don't understand why it fail?  </p>\n\n<p><strong>Do you have an idea of what is wrong with my parser ?</strong></p>\n"}, {"tags": ["haskell", "typeclass", "functional-dependencies"], "comments": [{"owner": {"reputation": 23444, "user_id": 414413, "user_type": "registered", "accept_rate": 79, "profile_image": "https://www.gravatar.com/avatar/6de2113f01432aa844dc85070ff33e89?s=128&d=identicon&r=PG", "display_name": "Cirdec", "link": "https://stackoverflow.com/users/414413/cirdec"}, "edited": false, "score": 0, "creation_date": 1439137346, "post_id": 31905606, "comment_id": 51726471, "body": "Did you perhaps mean <code>expr :: (forall proc. (ProcSYM proc) =&gt; proc Int) -&gt; repr</code>?"}, {"owner": {"reputation": 1324, "user_id": 3882308, "user_type": "registered", "accept_rate": 69, "profile_image": "https://www.gravatar.com/avatar/6c8a96b960efdca5a76900447e295b30?s=128&d=identicon&r=PG", "display_name": "Michael Thomas", "link": "https://stackoverflow.com/users/3882308/michael-thomas"}, "reply_to_user": {"reputation": 23444, "user_id": 414413, "user_type": "registered", "accept_rate": 79, "profile_image": "https://www.gravatar.com/avatar/6de2113f01432aa844dc85070ff33e89?s=128&d=identicon&r=PG", "display_name": "Cirdec", "link": "https://stackoverflow.com/users/414413/cirdec"}, "edited": false, "score": 0, "creation_date": 1439139711, "post_id": 31905606, "comment_id": 51727263, "body": "This works (with RankNTypes) but I&#39;m not sure why?"}, {"owner": {"reputation": 1324, "user_id": 3882308, "user_type": "registered", "accept_rate": 69, "profile_image": "https://www.gravatar.com/avatar/6c8a96b960efdca5a76900447e295b30?s=128&d=identicon&r=PG", "display_name": "Michael Thomas", "link": "https://stackoverflow.com/users/3882308/michael-thomas"}, "edited": false, "score": 0, "creation_date": 1439140666, "post_id": 31905606, "comment_id": 51727563, "body": "David Young: that&#39;s a typo; I&#39;ll edit."}, {"owner": {"reputation": 44013, "user_id": 1477667, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/trgKM.jpg?s=128&g=1", "display_name": "dfeuer", "link": "https://stackoverflow.com/users/1477667/dfeuer"}, "edited": false, "score": 2, "creation_date": 1439170329, "post_id": 31905606, "comment_id": 51734723, "body": "Unrelated: I highly recommend avoiding <code>ExplicitForAll</code> and instead using <code>ScopedTypeVariables</code> in all modules that use type system extensions. This will prevent you from accidentally writing anything that will break when you decide to use scoped type variables somewhere. It also tends to make type errors and typed holes more useful."}, {"owner": {"reputation": 1324, "user_id": 3882308, "user_type": "registered", "accept_rate": 69, "profile_image": "https://www.gravatar.com/avatar/6c8a96b960efdca5a76900447e295b30?s=128&d=identicon&r=PG", "display_name": "Michael Thomas", "link": "https://stackoverflow.com/users/3882308/michael-thomas"}, "edited": false, "score": 0, "creation_date": 1439199035, "post_id": 31905606, "comment_id": 51744941, "body": "dfeuer: Thanks for that. I had included the explicit <code>forall</code>s as I originally tried to write this in Purescript where they are mandatory."}], "answers": [{"comments": [{"owner": {"reputation": 1324, "user_id": 3882308, "user_type": "registered", "accept_rate": 69, "profile_image": "https://www.gravatar.com/avatar/6c8a96b960efdca5a76900447e295b30?s=128&d=identicon&r=PG", "display_name": "Michael Thomas", "link": "https://stackoverflow.com/users/3882308/michael-thomas"}, "edited": false, "score": 0, "creation_date": 1439199317, "post_id": 31911628, "comment_id": 51745106, "body": "Thank you for this very clear explanation. Am I correct in thinking that this is an example of an existential type?"}], "tags": [], "owner": {"reputation": 23444, "user_id": 414413, "user_type": "registered", "accept_rate": 79, "profile_image": "https://www.gravatar.com/avatar/6de2113f01432aa844dc85070ff33e89?s=128&d=identicon&r=PG", "display_name": "Cirdec", "link": "https://stackoverflow.com/users/414413/cirdec"}, "is_accepted": true, "score": 4, "last_activity_date": 1439180823, "creation_date": 1439180823, "answer_id": 31911628, "question_id": 31905606, "link": "https://stackoverflow.com/questions/31905606/final-tagless-encoding-of-mutually-recursive-types/31911628#31911628", "title": "Final-tagless encoding of mutually recursive types", "body": "<p>Let's start by looking at the type of <code>myProc</code></p>\n\n<pre><code>myProc :: ProcSYM repr =&gt; repr Int\nmyProc = intProc \"proc A.\"\n</code></pre>\n\n<p>This says, <code>forall</code> types <code>repr</code> where <code>ProcSYM repr</code>, I'm a value of type <code>repr Int</code>. If we had multiple implementations of <code>ProcSYM</code>, this is a value that's polymorphic in all of them. For example, if we had a corresponding tagged <code>GADT</code> <code>ProcSYM'</code> with a <code>ProcSYM</code> instance, <code>myProc</code> could be used as a value of <code>ProcSYM'</code>.</p>\n\n<pre><code>{-# LANGUAGE GADTs #-}\n\ndata ProcSYM' a where\n    VarProc :: String -&gt; ProcSYM' a\n    IntProc :: String -&gt; ProcSYM' a\n\ninstance ProcSYM ProcSYM' where\n    varProc = VarProc\n    intProc = IntProc\n\nmyProc' :: ProcSYM' Int\nmyProc' = myProc\n</code></pre>\n\n<p>The <code>ProcSym repr</code> constraint in <code>myProc :: ProcSYM repr =&gt; repr Int</code> is providing a way to <em>construct</em> <code>repr</code>s, which is exactly what <code>myProc</code> does. No matter which <code>ProcSym repr</code> you want, it can construct a <code>repr Int</code>.</p>\n\n<p>The <code>ProcSYM proc</code> constraint in the type of <code>expr :: forall proc. (ProcSYM proc) =&gt; proc Int -&gt; repr</code> is kind of meaningless. The constraint <code>ProcSYM proc</code> is once again providing a means to construct <code>proc</code>s. It can't help us look inside or <em>deconstruct</em> a <code>proc Int</code>. Without a way to look inside <code>proc Int</code>s, we might as well not have the <code>proc Int</code> argument and instead read <code>expr :: repr</code>.</p>\n\n<p>The type <code>forall proc. ProcSYM proc =&gt; proc Int</code> (the type of <code>myProc</code>) on the other hand, promises, no matter how you construct <code>proc</code>s, I can provide a value of that type. You want to pass <code>myProc</code> as the first argument to <code>expr</code>, as evidenced by</p>\n\n<pre><code>myExpr = expr myProc\n</code></pre>\n\n<p>Passing in a polymorphic value of this type without choosing a concrete <code>proc</code> requires <code>RankNTypes</code>.</p>\n\n<pre><code>class ExprSYM repr where\n    expr :: (forall proc. ProcSYM proc =&gt; proc Int) -&gt; repr\n</code></pre>\n\n<p>The instance for <code>ExprSYM</code> can choose the <code>ProcSYM</code> dictionary to pass into the first argument. This allows the implementation of <code>expr</code> to deconstruct the <code>proc Int</code>. We'll demonstrate this by completing an example with <code>GADTs</code> to see what this is doing. We will also make the same change to the type of <code>subjectOf</code>.</p>\n\n<pre><code>{-# LANGUAGE StandaloneDeriving #-}\n{-# LANGUAGE RankNTypes #-}\n{-# LANGUAGE GADTs #-}\nmodule Test where\n\nclass ExprSYM repr where\n    expr :: (forall proc. ProcSYM proc =&gt; proc Int) -&gt; repr\n\nclass ProcSYM repr where\n    varProc :: forall a. String -&gt; repr a\n    intProc :: String -&gt; repr Int\n    subjectOf :: (forall expr. ExprSYM expr =&gt; expr) -&gt; repr Int\n\n-- Tagged representation for ExprSYM\ndata ExprSYM' where\n    Expr :: ProcSYM' Int -&gt; ExprSYM'\nderiving instance Show ExprSYM'\n\ninstance ExprSYM ExprSYM' where\n    expr x = Expr x  -- chooses that the ProcSYM proc =&gt; proc Int must be ProcSYM' Int\n\n-- Tagged representation for ProcSYM\ndata ProcSYM' a where\n    VarProc :: String -&gt; ProcSYM' a\n    IntProc :: String -&gt; ProcSYM' a\n    SubjectOf :: ExprSYM' -&gt; ProcSYM' Int\n\nderiving instance Show (ProcSYM' a)\n\ninstance ProcSYM ProcSYM' where\n    varProc = VarProc\n    intProc = IntProc\n    subjectOf x = SubjectOf x  -- chooses that the ExprSYM repr =&gt; repr must be ExprSYM'\n\n-- myProc and myExpr with explicit type signatures\nmyProc :: ProcSYM repr =&gt; repr Int\nmyProc = intProc \"proc A.\"\n\nmyExpr :: ExprSYM repr =&gt; repr\nmyExpr = expr myProc\n\nmain = print (myExpr :: ExprSYM')\n</code></pre>\n\n<p>This outputs an abstract syntax tree for <code>myExpr</code>. We can see that if the implementation of <code>expr</code> wanted to deconstruct the <code>ProcSYM proc =&gt; proc Int</code> value it could (and in this case did) provide a <code>ProcSYM</code> dictionary that builds values it knows how to deconstruct. We can see this in the <code>IntProc</code> constructor in the shown value.</p>\n\n<pre><code>Expr (IntProc \"proc A.\")\n</code></pre>\n"}], "owner": {"reputation": 1324, "user_id": 3882308, "user_type": "registered", "accept_rate": 69, "profile_image": "https://www.gravatar.com/avatar/6c8a96b960efdca5a76900447e295b30?s=128&d=identicon&r=PG", "display_name": "Michael Thomas", "link": "https://stackoverflow.com/users/3882308/michael-thomas"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 253, "favorite_count": 1, "accepted_answer_id": 31911628, "answer_count": 1, "score": 7, "last_activity_date": 1439180823, "creation_date": 1439132699, "last_edit_date": 1439140686, "question_id": 31905606, "link": "https://stackoverflow.com/questions/31905606/final-tagless-encoding-of-mutually-recursive-types", "title": "Final-tagless encoding of mutually recursive types", "body": "<p>I am trying to express a pair of mutually recursive data types in the <code>final-tagless</code> encoding.</p>\n\n<p>I am able to write:</p>\n\n<pre><code>{-# LANGUAGE NoMonomorphismRestriction #-}\n{-# LANGUAGE ExplicitForAll #-}\nmodule Test where\n\n  class ExprSYM repr where\n    expr :: forall proc. (ProcSYM proc) =&gt; proc Int -&gt; repr\n\n  class ProcSYM repr where\n    varProc :: forall a. String -&gt; repr a\n    intProc :: String -&gt; repr Int\n    subjectOf :: forall expr. (ExprSYM expr) =&gt; expr -&gt; repr Int\n\n  myProc = intProc \"proc A.\"\n</code></pre>\n\n<p>However, when I write:</p>\n\n<pre><code>myExpr = expr myProc\n</code></pre>\n\n<p>I receive the following error:</p>\n\n<pre><code>Could not deduce (Test.ProcSYM proc0)\n  arising from a use of \u2018Test.expr\u2019\nfrom the context (Test.ExprSYM repr)\n  bound by the inferred type of\n           Test.myExpr :: Test.ExprSYM repr =&gt; repr\n  at src/Test.hs:16:3-22\nThe type variable \u2018proc0\u2019 is ambiguous\nIn the expression: Test.expr Test.myProc\nIn an equation for \u2018Test.myExpr\u2019:\n    Test.myExpr = Test.expr Test.myProc\n</code></pre>\n\n<p>Does any such encoding require the use of functional dependencies (or equivalent) to expess the constraint between the two <code>representation</code> types? </p>\n\n<p>If so, how would I write this?</p>\n"}, {"tags": ["haskell"], "answers": [{"tags": [], "owner": {"reputation": 11593, "user_id": 2494803, "user_type": "registered", "accept_rate": 88, "profile_image": "https://www.gravatar.com/avatar/58b4b1d0d8887426a51330a990936ac1?s=128&d=identicon&r=PG", "display_name": "bennofs", "link": "https://stackoverflow.com/users/2494803/bennofs"}, "is_accepted": true, "score": 7, "last_activity_date": 1439138445, "creation_date": 1439138445, "answer_id": 31906450, "question_id": 31904974, "link": "https://stackoverflow.com/questions/31904974/looking-for-a-dual-of-readert-which-abstracts-over-the-environment-instead-of-m/31906450#31906450", "title": "Looking for a dual of ReaderT, which abstracts over the environment instead of monadic result", "body": "<p>You can build this type as a composition of <a href=\"http://hackage.haskell.org/package/contravariant-1.3.2/docs/Data-Functor-Contravariant.html#t:Op\"><code>Op</code></a> from <code>contravariant</code> and <a href=\"http://hackage.haskell.org/package/reducers-3.10.3.2/docs/Data-Semigroup-Applicative.html#v:Ap\"><code>Ap</code></a> from <code>reducers</code>. <code>Op a b</code> is just <code>b -&gt; a</code>, and has a <code>Divisible</code> instance for any <code>Monoid a</code>. </p>\n\n<p>To get the behavior of your instance, we can use <code>Ap m a</code>, which provides a <code>Monoid</code> with <code>mappend = liftA2 (&lt;&gt;)</code> and <code>mempty = pure mempty</code> for any <code>Applicative m</code> and <code>Monoid a</code>. </p>\n\n<pre><code>type ReaderDual a m b = Op (Ap m a) b\n</code></pre>\n"}], "owner": {"reputation": 41209, "user_id": 485115, "user_type": "registered", "accept_rate": 87, "profile_image": "https://www.gravatar.com/avatar/59693d66b96ca17ca9d2fdb2393e2be3?s=128&d=identicon&r=PG", "display_name": "Nikita Volkov", "link": "https://stackoverflow.com/users/485115/nikita-volkov"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 96, "favorite_count": 1, "accepted_answer_id": 31906450, "answer_count": 1, "score": 8, "last_activity_date": 1439138445, "creation_date": 1439128353, "last_edit_date": 1439131118, "question_id": 31904974, "link": "https://stackoverflow.com/questions/31904974/looking-for-a-dual-of-readert-which-abstracts-over-the-environment-instead-of-m", "title": "Looking for a dual of ReaderT, which abstracts over the environment instead of monadic result", "body": "<p>Is the following abstraction with instances of <code>Contravariant</code>, <code>Divisible</code> and etc. already implemented in some package? I imply something in the spirit of the following compilable code:</p>\n\n<pre><code>newtype ReaderDual a m b =\n  ReaderDual (b -&gt; m a)\n\ninstance Contravariant (ReaderDual a m) where\n  contramap ba (ReaderDual a') =\n    ReaderDual $ a' . ba\n\ninstance (Applicative m, Monoid a) =&gt; Divisible (ReaderDual a m) where\n  divide aToBC (ReaderDual b') (ReaderDual c') =\n    ReaderDual $ \\a -&gt; aToBC a &amp; \\(b, c) -&gt; (&lt;&gt;) &lt;$&gt; b' b &lt;*&gt; c' c\n  conquer =\n    ReaderDual $ \\_ -&gt; pure mempty\n\nrun :: ReaderDual a m b -&gt; b -&gt; m a\nrun (ReaderDual a') b =\n  a' b\n</code></pre>\n"}, {"tags": ["mysql", "haskell", "mariadb", "yesod"], "comments": [{"owner": {"reputation": 8574, "user_id": 798684, "user_type": "registered", "accept_rate": 92, "profile_image": "https://www.gravatar.com/avatar/94202977db4bbe63aa42d0f7d3f1b67d?s=128&d=identicon&r=PG", "display_name": "machine yearning", "link": "https://stackoverflow.com/users/798684/machine-yearning"}, "edited": false, "score": 0, "creation_date": 1439106924, "post_id": 31902061, "comment_id": 51718875, "body": "<code>PersistText</code> is a constructor of the <a href=\"https://hackage.haskell.org/package/persistent-0.5.1/docs/Database-Persist-Base.html#t:PersistValue\" rel=\"nofollow noreferrer\"><code>PersistValue</code> data type</a>"}, {"owner": {"reputation": 43759, "user_id": 1651941, "user_type": "registered", "accept_rate": 97, "profile_image": "https://www.gravatar.com/avatar/a513bc1fa519d2fcf5e4e0d9b5500101?s=128&d=identicon&r=PG", "display_name": "Sibi", "link": "https://stackoverflow.com/users/1651941/sibi"}, "edited": false, "score": 0, "creation_date": 1439107454, "post_id": 31902061, "comment_id": 51718974, "body": "You should add the appropriate code to the question. It is hard for others to see a video for helping you out."}, {"owner": {"reputation": 478, "user_id": 4079111, "user_type": "registered", "accept_rate": 72, "profile_image": "https://www.gravatar.com/avatar/e4775c2984de42fca587c03065107de1?s=128&d=identicon&r=PG&f=1", "display_name": "doofin", "link": "https://stackoverflow.com/users/4079111/doofin"}, "edited": false, "score": 0, "creation_date": 1439110439, "post_id": 31902061, "comment_id": 51719612, "body": "can u add the code database entity definition and database-relevant code?BTW,sqlite needs zero configuation and is easier to use"}, {"owner": {"reputation": 7297, "user_id": 1176156, "user_type": "registered", "accept_rate": 80, "profile_image": "https://www.gravatar.com/avatar/89604545aa57aa3d14306af60126e193?s=128&d=identicon&r=PG", "display_name": "MaxGabriel", "link": "https://stackoverflow.com/users/1176156/maxgabriel"}, "edited": false, "score": 0, "creation_date": 1439565953, "post_id": 31902061, "comment_id": 51929505, "body": "Hi @gesuwall, I made the screencast you&#39;re watching. Your code looks correct to me; would you mind putting your code on Github so I can try to reproduce? It might be a MariaDB-related thing; I&#39;ll try that out."}, {"owner": {"reputation": 7297, "user_id": 1176156, "user_type": "registered", "accept_rate": 80, "profile_image": "https://www.gravatar.com/avatar/89604545aa57aa3d14306af60126e193?s=128&d=identicon&r=PG", "display_name": "MaxGabriel", "link": "https://stackoverflow.com/users/1176156/maxgabriel"}, "edited": false, "score": 0, "creation_date": 1439566406, "post_id": 31902061, "comment_id": 51929774, "body": "This question seems related: <a href=\"http://stackoverflow.com/questions/31898691/storing-markdown-in-a-yesod-persist-model\" title=\"storing markdown in a yesod persist model\">stackoverflow.com/questions/31898691/&hellip;</a>"}, {"owner": {"reputation": 7297, "user_id": 1176156, "user_type": "registered", "accept_rate": 80, "profile_image": "https://www.gravatar.com/avatar/89604545aa57aa3d14306af60126e193?s=128&d=identicon&r=PG", "display_name": "MaxGabriel", "link": "https://stackoverflow.com/users/1176156/maxgabriel"}, "edited": false, "score": 0, "creation_date": 1439567723, "post_id": 31902061, "comment_id": 51930582, "body": "This looks to be a real issue with either yesod-text-markdown or persistent. The error message stems from here: <a href=\"https://github.com/Tarrasch/yesod-text-markdown/blob/7d7e35b97d50360197a6139df8354d9926ede8a8/Yesod/Text/Markdown.hs#L22-L25\" rel=\"nofollow noreferrer\">github.com/Tarrasch/yesod-text-markdown/blob/&hellip;</a>"}, {"owner": {"reputation": 537, "user_id": 5207721, "user_type": "registered", "accept_rate": 91, "profile_image": "https://www.gravatar.com/avatar/686783f7f5ad8284b8c1491775db498c?s=128&d=identicon&r=PG&f=1", "display_name": "gesuwall", "link": "https://stackoverflow.com/users/5207721/gesuwall"}, "edited": false, "score": 0, "creation_date": 1439600499, "post_id": 31902061, "comment_id": 51943299, "body": "I made a repo with the full source code. Since I didn&#39;t understand what was going on I removed markdown. so First commit has no Markdown and works great. Second commit has markdown again, and every Blog post shows this PersistText Value error. <a href=\"https://github.com/GAumala/MyBlog\" rel=\"nofollow noreferrer\">github.com/GAumala/MyBlog</a>"}], "answers": [{"tags": [], "owner": {"reputation": 7297, "user_id": 1176156, "user_type": "registered", "accept_rate": 80, "profile_image": "https://www.gravatar.com/avatar/89604545aa57aa3d14306af60126e193?s=128&d=identicon&r=PG", "display_name": "MaxGabriel", "link": "https://stackoverflow.com/users/1176156/maxgabriel"}, "is_accepted": true, "score": 0, "last_activity_date": 1441164907, "creation_date": 1441164907, "answer_id": 32344245, "question_id": 31902061, "link": "https://stackoverflow.com/questions/31902061/what-does-not-a-persisttext-value-mean/32344245#32344245", "title": "what does &quot;Not a PersistText value&quot; mean?", "body": "<p>This turned out to be caused by a bug in the <code>persistent-mysql</code> package that's now fixed in <code>persistent-mysql-2.3</code>.</p>\n\n<p>Here's the root cause for those interested:</p>\n\n<p>The MySQL C library (and by extension the Haskell <code>mysql</code> package, which <code>persistent-mysql</code> depends on) doesn't distinguish between binary and textual data at the type level. So if you saved a <code>TEXT</code> value to the database, when it was looked it up by persistent it appeared to be binary data (a <code>PersistByteString</code>).</p>\n\n<p>This was fixed in <a href=\"https://github.com/yesodweb/persistent/pull/451\" rel=\"nofollow\">#451</a> by checking the character set of the column, which the MySQL API docs recommend as the appropriate solution.</p>\n\n<p>For more details, see that pull request or <a href=\"https://github.com/yesodweb/persistent/issues/448\" rel=\"nofollow\">this issue</a>.</p>\n\n<p>Thanks for asking this question; I wouldn't have realized there was a bug otherwise.</p>\n"}], "owner": {"reputation": 537, "user_id": 5207721, "user_type": "registered", "accept_rate": 91, "profile_image": "https://www.gravatar.com/avatar/686783f7f5ad8284b8c1491775db498c?s=128&d=identicon&r=PG&f=1", "display_name": "gesuwall", "link": "https://stackoverflow.com/users/5207721/gesuwall"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 107, "favorite_count": 0, "accepted_answer_id": 32344245, "answer_count": 1, "score": 1, "last_activity_date": 1441164907, "creation_date": 1439106506, "last_edit_date": 1439134033, "question_id": 31902061, "link": "https://stackoverflow.com/questions/31902061/what-does-not-a-persisttext-value-mean", "title": "what does &quot;Not a PersistText value&quot; mean?", "body": "<p>I'm new to yesod and I'm trying to make the same blog project from this screencast: <a href=\"https://www.youtube.com/watch?v=SadfV-qbVg8\" rel=\"nofollow\">https://www.youtube.com/watch?v=SadfV-qbVg8</a> with the only difference being that I'm using MariaDB instead of PostgreSQL. Every time I add a new blog post and redirect to the page that shows it I see this error:</p>\n\n<pre><code>[Error#yesod-core] get BlogPostKey {unBlogPostKey = SqlBackendKey {unSqlBackendKey = 5}}: field article: Not a PersistText value @(yesod-core-1.4.12:Yesod.Core.Class.Yesod ./Yesod/Core/Class/Yesod.hs:577:5)\n</code></pre>\n\n<p>What exactly does that mean? If I look into the database, it has all the posts stored correctly. Why does it fail to load the posts from the database?</p>\n\n<p>Here's the code</p>\n\n<p>model</p>\n\n<pre><code>User\n    ident Text\n    password Text Maybe\n    UniqueUser ident\n    deriving Typeable\nEmail\n    email Text\n    user UserId Maybe\n    verkey Text Maybe\n    UniqueEmail email\n\nBlogPost\n    title Text\n    article Markdown\n</code></pre>\n\n<p>PostDetails.hs (Gets the post from DB and shows it)</p>\n\n<pre><code>module Handler.PostDetails where\n\nimport Import\n\ngetPostDetailsR :: BlogPostId -&gt; Handler Html\ngetPostDetailsR blogPostId = do     \n    blogPost &lt;- runDB $ get404 blogPostId \n    defaultLayout $ do\n    $(widgetFile \"postDetails/post\")\n</code></pre>\n\n<p>PostNew.hs (Creates a new post and stores it in the DB, after insertion, it redirects to PostDetails.hs with the new post)</p>\n\n<pre><code>module Handler.PostNew where\n\nimport Import\nimport Yesod.Form.Bootstrap3\nimport Yesod.Text.Markdown\n\nblogPostForm :: AForm Handler BlogPost\nblogPostForm = BlogPost \n            &lt;$&gt; areq textField (bfs (\"Title\" :: Text)) Nothing\n            &lt;*&gt; areq markdownField (bfs (\"Article\" :: Text)) Nothing\n\ngetPostNewR :: Handler Html\ngetPostNewR = do\n    (widget, enctype) &lt;- generateFormPost $ renderBootstrap3 BootstrapBasicForm blogPostForm\n    defaultLayout $ do\n        $(widgetFile \"posts/new\")\n\npostPostNewR :: Handler Html\npostPostNewR = do\n    ((res, widget), enctype) &lt;- runFormPost $ renderBootstrap3 BootstrapBasicForm blogPostForm\n    case res of\n     FormSuccess blogPost -&gt; do\n        blogPostId &lt;- runDB $ insert blogPost\n        redirect $ PostDetailsR blogPostId\n     _ -&gt; defaultLayout $(widgetFile \"posts/new\")\n</code></pre>\n\n<p>I don't understand why the compiler doesn't catch this error. When I create a post, instead of the title I se \"Internal Server Error\"</p>\n"}, {"tags": ["haskell", "yesod"], "comments": [{"owner": {"reputation": 30377, "user_id": 369198, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/71596bb1ca3ba3aa4400c3f407baec9f?s=128&d=identicon&r=PG", "display_name": "Michael Snoyman", "link": "https://stackoverflow.com/users/369198/michael-snoyman"}, "edited": false, "score": 1, "creation_date": 1439114774, "post_id": 31901839, "comment_id": 51720501, "body": "You need to set the enctype on the form itself to multipart/form-data"}, {"owner": {"reputation": 478, "user_id": 4079111, "user_type": "registered", "accept_rate": 72, "profile_image": "https://www.gravatar.com/avatar/e4775c2984de42fca587c03065107de1?s=128&d=identicon&r=PG&f=1", "display_name": "doofin", "link": "https://stackoverflow.com/users/4079111/doofin"}, "reply_to_user": {"reputation": 30377, "user_id": 369198, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/71596bb1ca3ba3aa4400c3f407baec9f?s=128&d=identicon&r=PG", "display_name": "Michael Snoyman", "link": "https://stackoverflow.com/users/369198/michael-snoyman"}, "edited": false, "score": 0, "creation_date": 1439128490, "post_id": 31901839, "comment_id": 51723999, "body": "bingo!i just find out that myself! please answer that formally so i can make it the right one"}], "answers": [{"tags": [], "owner": {"reputation": 30377, "user_id": 369198, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/71596bb1ca3ba3aa4400c3f407baec9f?s=128&d=identicon&r=PG", "display_name": "Michael Snoyman", "link": "https://stackoverflow.com/users/369198/michael-snoyman"}, "is_accepted": true, "score": 3, "last_activity_date": 1439178407, "creation_date": 1439178407, "answer_id": 31911346, "question_id": 31901839, "link": "https://stackoverflow.com/questions/31901839/haskell-yesod-file-upload-input-file-not-found/31911346#31911346", "title": "haskell yesod file upload input file not found", "body": "<p>You need to set the enctype on the form itself to multipart/form-data</p>\n"}], "owner": {"reputation": 478, "user_id": 4079111, "user_type": "registered", "accept_rate": 72, "profile_image": "https://www.gravatar.com/avatar/e4775c2984de42fca587c03065107de1?s=128&d=identicon&r=PG&f=1", "display_name": "doofin", "link": "https://stackoverflow.com/users/4079111/doofin"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 139, "favorite_count": 0, "accepted_answer_id": 31911346, "answer_count": 1, "score": 3, "last_activity_date": 1439178407, "creation_date": 1439104695, "question_id": 31901839, "link": "https://stackoverflow.com/questions/31901839/haskell-yesod-file-upload-input-file-not-found", "title": "haskell yesod file upload input file not found", "body": "<p>handlers:</p>\n\n<pre><code>getFuploadR=defaultLayout $ do\n    [whamlet|\n     &lt;form method=post&gt;\n        &lt;input type=file name=file&gt;\n        &lt;button type=\"submit\" class=\"btn btn-primary\"&gt;Submit\n    |]\npostFuploadR=do\n  imgnfo&lt;-runInputPost $ ireq fileField \"file\"\n  bytes &lt;- runResourceT $ fileSource imgnfo $$ sinkLbs\n  liftIO $ write2server bytes \"1.jpg\"\n</code></pre>\n\n<p>it compiles ok.after select sth to upload and submit,i just get:</p>\n\n<p>Invalid Arguments</p>\n\n<p>Input not found: file</p>\n"}, {"tags": ["haskell", "memory-leaks", "haskell-snap-framework"], "comments": [{"owner": {"reputation": 49959, "user_id": 866915, "user_type": "registered", "accept_rate": 70, "profile_image": "https://www.gravatar.com/avatar/09242131d6e17cbbe31e8547514da6e5?s=128&d=identicon&r=PG", "display_name": "ErikR", "link": "https://stackoverflow.com/users/866915/erikr"}, "edited": false, "score": 0, "creation_date": 1439110124, "post_id": 31901811, "comment_id": 51719536, "body": "How are you measuring memory usage?"}, {"owner": {"reputation": 455, "user_id": 2703165, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/2fe9e454e869a4e038b5feb52e1edb5f?s=128&d=identicon&r=PG&f=1", "display_name": "Simon Bourne", "link": "https://stackoverflow.com/users/2703165/simon-bourne"}, "reply_to_user": {"reputation": 49959, "user_id": 866915, "user_type": "registered", "accept_rate": 70, "profile_image": "https://www.gravatar.com/avatar/09242131d6e17cbbe31e8547514da6e5?s=128&d=identicon&r=PG", "display_name": "ErikR", "link": "https://stackoverflow.com/users/866915/erikr"}, "edited": false, "score": 0, "creation_date": 1439111600, "post_id": 31901811, "comment_id": 51719825, "body": "Just using &quot;top&quot; on linux. It uses all the memory (16gb) on my machine and starts swapping."}, {"owner": {"reputation": 14485, "user_id": 190376, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/cd8280c5e1491b8cf55760750ed97dec?s=128&d=identicon&r=PG", "display_name": "Reid Barton", "link": "https://stackoverflow.com/users/190376/reid-barton"}, "edited": false, "score": 0, "creation_date": 1439132248, "post_id": 31901811, "comment_id": 51724914, "body": "The value <code>ss</code> is shared between requests, so its memory representation will grow as it is computed for the first request so that it can be reused for later requests. <code>test3</code> doesn&#39;t have this behavior since it uses <code>ss</code> only once, so chunks that have been consumed can be discarded. (But try <code>test4 = print ss &gt;&gt; print ss</code>.) You should define <code>ss</code> inside the handler and make it depend on the request somehow to stop GHC from floating it out."}, {"owner": {"reputation": 455, "user_id": 2703165, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/2fe9e454e869a4e038b5feb52e1edb5f?s=128&d=identicon&r=PG&f=1", "display_name": "Simon Bourne", "link": "https://stackoverflow.com/users/2703165/simon-bourne"}, "edited": false, "score": 0, "creation_date": 1439135284, "post_id": 31901811, "comment_id": 51725859, "body": "Thanks Reid, that makes sense. I&#39;ll update the question as the problem still happens if I parameterize ss on the length of the request."}, {"owner": {"reputation": 455, "user_id": 2703165, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/2fe9e454e869a4e038b5feb52e1edb5f?s=128&d=identicon&r=PG&f=1", "display_name": "Simon Bourne", "link": "https://stackoverflow.com/users/2703165/simon-bourne"}, "reply_to_user": {"reputation": 14485, "user_id": 190376, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/cd8280c5e1491b8cf55760750ed97dec?s=128&d=identicon&r=PG", "display_name": "Reid Barton", "link": "https://stackoverflow.com/users/190376/reid-barton"}, "edited": false, "score": 0, "creation_date": 1439140254, "post_id": 31901811, "comment_id": 51727435, "body": "@ReidBarton, I&#39;ve updated the code as per your suggestion."}, {"owner": {"reputation": 455, "user_id": 2703165, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/2fe9e454e869a4e038b5feb52e1edb5f?s=128&d=identicon&r=PG&f=1", "display_name": "Simon Bourne", "link": "https://stackoverflow.com/users/2703165/simon-bourne"}, "reply_to_user": {"reputation": 49959, "user_id": 866915, "user_type": "registered", "accept_rate": 70, "profile_image": "https://www.gravatar.com/avatar/09242131d6e17cbbe31e8547514da6e5?s=128&d=identicon&r=PG", "display_name": "ErikR", "link": "https://stackoverflow.com/users/866915/erikr"}, "edited": false, "score": 0, "creation_date": 1439140364, "post_id": 31901811, "comment_id": 51727461, "body": "@user5402, I&#39;ve added some more detail on the memory usage. I&#39;m starting to think this might be something related to the garbage collector."}, {"owner": {"reputation": 49959, "user_id": 866915, "user_type": "registered", "accept_rate": 70, "profile_image": "https://www.gravatar.com/avatar/09242131d6e17cbbe31e8547514da6e5?s=128&d=identicon&r=PG", "display_name": "ErikR", "link": "https://stackoverflow.com/users/866915/erikr"}, "edited": false, "score": 0, "creation_date": 1439144656, "post_id": 31901811, "comment_id": 51728744, "body": "Yeah - I&#39;ve seen that behavior too. I would bring this to the attention of the <a href=\"https://groups.google.com/forum/#!forum/snap_framework\" rel=\"nofollow noreferrer\">snap mailing list</a>"}], "owner": {"reputation": 455, "user_id": 2703165, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/2fe9e454e869a4e038b5feb52e1edb5f?s=128&d=identicon&r=PG&f=1", "display_name": "Simon Bourne", "link": "https://stackoverflow.com/users/2703165/simon-bourne"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 143, "favorite_count": 0, "answer_count": 0, "score": 4, "last_activity_date": 1439139902, "creation_date": 1439104322, "last_edit_date": 1439139902, "question_id": 31901811, "link": "https://stackoverflow.com/questions/31901811/haskell-snap-memory-usage-for-large-http-response-bodies", "title": "Haskell Snap memory usage for large HTTP response bodies", "body": "<p>I'm trying to deliver a large HTTP response using the Haskell Snap framework, but memory usage grows in proportion to the size of the response. Here's a couple of cut down test cases that use a large lazy ByteString:</p>\n\n<pre><code>import Snap.Core (Snap, writeLBS, readRequestBody)\nimport Snap.Http.Server (quickHttpServe)\nimport Control.Monad.IO.Class (MonadIO(liftIO))\nimport qualified Data.ByteString.Lazy.Char8 as LBS (ByteString, length, replicate)\n\nmain :: IO ()\nmain = quickHttpServe $ site test1 where\n    test1, test2 :: LBS.ByteString -&gt; Snap ()\n\n    -- Send ss to client\n    test1 = writeLBS\n\n    -- Print ss to stdout upon receiving request\n    test2 = liftIO . print\n\n    site write = do\n        body &lt;- readRequestBody 1000\n        -- Making ss dependant on the request stops GHC from keeping a\n        -- reference to ss as pointed out by Reid Barton.\n        let bodyLength = fromIntegral $ LBS.length body\n        write $ ss bodyLength\n\n    ss c = LBS.replicate (1000000000000 * (c + 1)) 'S'\n</code></pre>\n\n<ul>\n<li>test1 delivers ss to the client. Memory usage grows in proportion to the ByteString's size.</li>\n<li>test2 prints ss to stdout within the Snap monad stack upon receiving a request. This runs in a small constant amount of memory.</li>\n</ul>\n\n<p>The responses are delivered using chunked encoding, so I thought Snap should also be able to deliver the response in constant memory. Is there any way to achieve this? It's also worth noting that the response starts being delivered immediately. I've tried using transformRequestBody, but ran into the same problem.</p>\n\n<p>Memory was measured using \"top\" on linux and was observed to steadily grow to 15GB resident at which point it was just starting to swap. The request did complete, so the memory usage is a couple of orders of magnitude less than the size of the ByteString. Once the request had completed, it sat at 15Gb resident. When I fired another request at it, it still remained steady at 15Gb and completed the request as before. The virtual size stayed within 5% of the resident size.</p>\n\n<p>Firing 2 concurrent requests at it resulted at first in a drop in virtual and resident memory to about 5Gb, followed by an increase to about 17Gb at which point the machine was getting unusable so I killed the process.</p>\n\n<p>GHC version 7.8.3</p>\n\n<p>Snap version 0.14.0.5</p>\n"}, {"tags": ["haskell", "concurrency"], "answers": [{"comments": [{"owner": {"reputation": 49959, "user_id": 866915, "user_type": "registered", "accept_rate": 70, "profile_image": "https://www.gravatar.com/avatar/09242131d6e17cbbe31e8547514da6e5?s=128&d=identicon&r=PG", "display_name": "ErikR", "link": "https://stackoverflow.com/users/866915/erikr"}, "edited": false, "score": 1, "creation_date": 1439093296, "post_id": 31900788, "comment_id": 51716516, "body": "But note the warning: <i>Warning: This function has several shortcomings ...</i> It&#39;s better to use <code>threadDelay</code> from Control.Concurrent."}, {"owner": {"reputation": 11366, "user_id": 3922954, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/76ba47d2fdd24ab56b0b273cce2075e5?s=128&d=identicon&r=PG&f=1", "display_name": "AJF", "link": "https://stackoverflow.com/users/3922954/ajf"}, "reply_to_user": {"reputation": 49959, "user_id": 866915, "user_type": "registered", "accept_rate": 70, "profile_image": "https://www.gravatar.com/avatar/09242131d6e17cbbe31e8547514da6e5?s=128&d=identicon&r=PG", "display_name": "ErikR", "link": "https://stackoverflow.com/users/866915/erikr"}, "edited": false, "score": 0, "creation_date": 1439096857, "post_id": 31900788, "comment_id": 51717034, "body": "@user5402 care to expand?"}, {"owner": {"reputation": 451, "user_id": 5054978, "user_type": "registered", "accept_rate": 77, "profile_image": "https://www.gravatar.com/avatar/45ed5356158e964d788ae628378fa9dc?s=128&d=identicon&r=PG&f=1", "display_name": "coder guy", "link": "https://stackoverflow.com/users/5054978/coder-guy"}, "reply_to_user": {"reputation": 49959, "user_id": 866915, "user_type": "registered", "accept_rate": 70, "profile_image": "https://www.gravatar.com/avatar/09242131d6e17cbbe31e8547514da6e5?s=128&d=identicon&r=PG", "display_name": "ErikR", "link": "https://stackoverflow.com/users/866915/erikr"}, "edited": false, "score": 0, "creation_date": 1439589570, "post_id": 31900788, "comment_id": 51940965, "body": "Sorry for the late reply. Good observation, I didn&#39;t think of this, although I am not any expert with Haskell @user5402"}], "tags": [], "owner": {"reputation": 451, "user_id": 5054978, "user_type": "registered", "accept_rate": 77, "profile_image": "https://www.gravatar.com/avatar/45ed5356158e964d788ae628378fa9dc?s=128&d=identicon&r=PG&f=1", "display_name": "coder guy", "link": "https://stackoverflow.com/users/5054978/coder-guy"}, "is_accepted": false, "score": 1, "last_activity_date": 1439093031, "creation_date": 1439093031, "answer_id": 31900788, "question_id": 31900768, "link": "https://stackoverflow.com/questions/31900768/specify-millisecond-speed-of-an-infinite-loop/31900788#31900788", "title": "Specify millisecond-speed of an infinite loop", "body": "<p>You could use sleep to pause the loop at the end of every iteration for 100 milliseconds. <a href=\"https://www.haskell.org/hoogle/?q=sleep\" rel=\"nofollow\">https://www.haskell.org/hoogle/?q=sleep</a></p>\n"}, {"comments": [{"owner": {"reputation": 1764, "user_id": 2478883, "user_type": "registered", "accept_rate": 92, "profile_image": "https://i.stack.imgur.com/ys9QL.png?s=128&g=1", "display_name": "Ryoichiro Oka", "link": "https://stackoverflow.com/users/2478883/ryoichiro-oka"}, "edited": false, "score": 0, "creation_date": 1439094304, "post_id": 31900859, "comment_id": 51716670, "body": "Thank you for answering, but the loop body takes different time. One could take 80 milliseconds, and another might take 0 at all. I&#39;d like to match up all their time length equally."}], "tags": [], "owner": {"reputation": 49959, "user_id": 866915, "user_type": "registered", "accept_rate": 70, "profile_image": "https://www.gravatar.com/avatar/09242131d6e17cbbe31e8547514da6e5?s=128&d=identicon&r=PG", "display_name": "ErikR", "link": "https://stackoverflow.com/users/866915/erikr"}, "is_accepted": true, "score": 9, "last_activity_date": 1439095803, "last_edit_date": 1439095803, "creation_date": 1439093827, "answer_id": 31900859, "question_id": 31900768, "link": "https://stackoverflow.com/questions/31900768/specify-millisecond-speed-of-an-infinite-loop/31900859#31900859", "title": "Specify millisecond-speed of an infinite loop", "body": "<p>Assuming your loop body takes negligible time, just use <code>threadDelay</code> from <code>Control.Concurrent</code>:</p>\n\n<pre><code>import Control.Concurrent\n\nmain = forever $ do\n  mainBody\n  threadDelay (100*1000) -- value in microseconds\n</code></pre>\n\n<p>Update: To account for the time of your loop body, use this:</p>\n\n<pre><code>import Data.Time.Clock\nimport Control.Concurrent\nimport Control.Monad\n\nmainBody :: IO ()\nmainBody = putStrLn \"hi\"\n\nmain = forever $ do\n  start &lt;- getCurrentTime\n  mainBody\n  end &lt;- getCurrentTime\n  let diff = diffUTCTime end start\n      usecs = floor (toRational diff * 1000000) :: Int\n      delay = 100*1000 - usecs\n  if delay &gt; 0\n    then threadDelay delay\n    else return ()\n</code></pre>\n"}, {"comments": [{"owner": {"reputation": 1764, "user_id": 2478883, "user_type": "registered", "accept_rate": 92, "profile_image": "https://i.stack.imgur.com/ys9QL.png?s=128&g=1", "display_name": "Ryoichiro Oka", "link": "https://stackoverflow.com/users/2478883/ryoichiro-oka"}, "edited": false, "score": 0, "creation_date": 1439103507, "post_id": 31901038, "comment_id": 51718182, "body": "I will check out the library. Thank you for your idea!"}, {"owner": {"reputation": 61419, "user_id": 849891, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/MbEO3.png?s=128&g=1", "display_name": "Will Ness", "link": "https://stackoverflow.com/users/849891/will-ness"}, "edited": false, "score": 0, "creation_date": 1439110404, "post_id": 31901038, "comment_id": 51719602, "body": "&quot;implement a strategy in the manager thread, which will ensure that the number of active workers is limited&quot; how? using which functions? some  pointers would be helpful..."}], "tags": [], "owner": {"reputation": 41209, "user_id": 485115, "user_type": "registered", "accept_rate": 87, "profile_image": "https://www.gravatar.com/avatar/59693d66b96ca17ca9d2fdb2393e2be3?s=128&d=identicon&r=PG", "display_name": "Nikita Volkov", "link": "https://stackoverflow.com/users/485115/nikita-volkov"}, "is_accepted": false, "score": 3, "last_activity_date": 1439129097, "last_edit_date": 1439129097, "creation_date": 1439096254, "answer_id": 31901038, "question_id": 31900768, "link": "https://stackoverflow.com/questions/31900768/specify-millisecond-speed-of-an-infinite-loop/31901038#31901038", "title": "Specify millisecond-speed of an infinite loop", "body": "<p>Haskell's threads are light-weight, so a quick solution would be to fork on each cycle. Thus you'll end up using the main thread as a manager of worker threads, which ensures that a worker gets spawned every 100 micros.</p>\n\n<pre><code>import Control.Concurrent\n\nmain = \n  forever $ do\n    forkIO $ loopCycle\n    threadDelay $ 100 * 10^3\n</code></pre>\n\n<p>In case you care about exceptions not getting lost and getting reraised in the main thread instead, I recommend taking a look at <a href=\"http://hackage.haskell.org/package/slave-thread\" rel=\"nofollow\">the \"slave-thread\" package</a>. Actually, I'd recommend to use that package instead of <code>forkIO</code> and brothers by default, but then I'm the author so I might be subjective.</p>\n\n<p>Also note that the above solution might cause an accumulation of worker threads in case the <code>loopCycle</code> will take longer than 100 micros to execute too often. To protect against such a scenario, you can implement a strategy in the manager thread, which will ensure that the number of active workers is limited. Following is how such a strategy could be implemented:</p>\n\n<pre><code>-- From the \"SafeSemaphore\" package\nimport qualified Control.Concurrent.SSem as Sem\n\nmain =\n  manager 12 (100 * 10^3) $ putStrLn \"Implement me!\"\n\nmanager :: Int -&gt; Int -&gt; IO () -&gt; IO ()\nmanager limit delay worker =\n  do\n    sem &lt;- Sem.new limit\n    forever $ do\n      forkIO $ Sem.withSem sem $ worker\n      threadDelay delay\n</code></pre>\n"}], "owner": {"reputation": 1764, "user_id": 2478883, "user_type": "registered", "accept_rate": 92, "profile_image": "https://i.stack.imgur.com/ys9QL.png?s=128&g=1", "display_name": "Ryoichiro Oka", "link": "https://stackoverflow.com/users/2478883/ryoichiro-oka"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 600, "favorite_count": 0, "accepted_answer_id": 31900859, "answer_count": 3, "score": 2, "last_activity_date": 1439129097, "creation_date": 1439092764, "question_id": 31900768, "link": "https://stackoverflow.com/questions/31900768/specify-millisecond-speed-of-an-infinite-loop", "title": "Specify millisecond-speed of an infinite loop", "body": "<p>My main function has one infinite loop and I'd like to execute each loop of it every 100 millisecond. I know it's done by some concurrent or parallel method, but I've never done such things before and have no idea even where to start from. How would you implement such function?</p>\n"}, {"tags": ["c++", "node.js", "haskell", "command-line", "terminal"], "comments": [{"owner": {"reputation": 8441, "user_id": 1783614, "user_type": "registered", "accept_rate": 83, "profile_image": "https://i.stack.imgur.com/tK6o5.jpg?s=128&g=1", "display_name": "yizzlez", "link": "https://stackoverflow.com/users/1783614/yizzlez"}, "edited": false, "score": 0, "creation_date": 1439090578, "post_id": 31900566, "comment_id": 51716069, "body": "I&#39;m guessing they use native apis"}, {"owner": {"reputation": 196207, "user_id": 434551, "user_type": "registered", "accept_rate": 81, "profile_image": "https://i.stack.imgur.com/8Wzl8.png?s=128&g=1", "display_name": "R Sahu", "link": "https://stackoverflow.com/users/434551/r-sahu"}, "edited": false, "score": 5, "creation_date": 1439090730, "post_id": 31900566, "comment_id": 51716095, "body": "They probably use <a href=\"http://invisible-island.net/ncurses/\" rel=\"nofollow noreferrer\">ncurses</a>"}, {"owner": {"reputation": 44013, "user_id": 1477667, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/trgKM.jpg?s=128&g=1", "display_name": "dfeuer", "link": "https://stackoverflow.com/users/1477667/dfeuer"}, "edited": false, "score": 2, "creation_date": 1439091660, "post_id": 31900566, "comment_id": 51716264, "body": "Haskell has a nice, simple <code>ncurses</code> API: <a href=\"https://hackage.haskell.org/package/ncurses\" rel=\"nofollow noreferrer\">hackage.haskell.org/package/ncurses</a>"}, {"owner": {"reputation": 126897, "user_id": 791604, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/ce991df7a056248d5e4f6fc3659ba733?s=128&d=identicon&r=PG", "display_name": "Daniel Wagner", "link": "https://stackoverflow.com/users/791604/daniel-wagner"}, "edited": false, "score": 9, "creation_date": 1439091834, "post_id": 31900566, "comment_id": 51716289, "body": "Poor man&#39;s one-line ncurses: output <code>\\r</code> to go to the beginning of a line and draw it again."}], "answers": [{"tags": [], "owner": {"reputation": 49959, "user_id": 866915, "user_type": "registered", "accept_rate": 70, "profile_image": "https://www.gravatar.com/avatar/09242131d6e17cbbe31e8547514da6e5?s=128&d=identicon&r=PG", "display_name": "ErikR", "link": "https://stackoverflow.com/users/866915/erikr"}, "is_accepted": false, "score": 12, "last_activity_date": 1439091849, "creation_date": 1439091849, "answer_id": 31900680, "question_id": 31900566, "link": "https://stackoverflow.com/questions/31900566/how-do-command-line-tools-change-their-output-after-outputting-it/31900680#31900680", "title": "How do command line tools change their output after outputting it?", "body": "<p>Just print a CR (without a newline) to overwrite a line. Here is an example program in perl:</p>\n\n<pre><code>#!/usr/bin/env perl\n\n$| = 1;\n\nfor (1..10) {\n  print \"the count is: $_\\r\";\n  sleep(1)\n}\n</code></pre>\n\n<p>I've also disabled output buffering (<code>$| = 1</code>) so that the print command sends its output to the console immediately instead of buffering it.</p>\n\n<p>Haskell example:</p>\n\n<pre><code>import System.IO\nimport Control.Monad\nimport Control.Concurrent\n\nmain = do\n  hSetBuffering stdout NoBuffering\n  forM_ [1..10] $ \\i -&gt; do\n    putStr $ \"the count is: \" ++ show i ++ \"\\r\"\n    threadDelay 1000000\n</code></pre>\n"}, {"tags": [], "owner": {"reputation": 92373, "user_id": 2050455, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/6b1255d2cb06adc4d0b48adf1d90e847?s=128&d=identicon&r=PG", "display_name": "mscdex", "link": "https://stackoverflow.com/users/2050455/mscdex"}, "is_accepted": false, "score": 3, "last_activity_date": 1439092324, "creation_date": 1439092324, "answer_id": 31900719, "question_id": 31900566, "link": "https://stackoverflow.com/questions/31900566/how-do-command-line-tools-change-their-output-after-outputting-it/31900719#31900719", "title": "How do command line tools change their output after outputting it?", "body": "<p>I can only speak about node.js, but the built-in <a href=\"https://nodejs.org/docs/latest/api/readline.html\" rel=\"nofollow\"><code>readline</code></a> module has some very basic screen handling functionality built-in. For example:</p>\n\n<pre><code>var readline = require('readline');\nvar c = 0;\nvar intvl = setInterval(function() {\n  // Clear entirety of current line\n  readline.clearLine(process.stdout, 0);\n  readline.cursorTo(process.stdout, 0);\n  process.stdout.write('Progress: ' + (++c) + '%');\n  if (c === 100)\n    clearInterval(intvl);\n}, 500);\n</code></pre>\n\n<p>There are also third party modules if you want to get fancier, such as <a href=\"https://www.npmjs.com/package/multimeter\" rel=\"nofollow\"><code>multimeter</code></a>/<a href=\"https://www.npmjs.com/package/meterbox\" rel=\"nofollow\"><code>meterbox</code></a> and <a href=\"https://github.com/chjj/blessed\" rel=\"nofollow\"><code>blessed</code></a>/<a href=\"https://github.com/yaronn/blessed-contrib\" rel=\"nofollow\"><code>blessed-contrib</code></a>.</p>\n\n<p>Generally speaking though, some programs use ncurses, while others simply just manually output the ANSI escape codes to clear and redraw the current line.</p>\n"}, {"tags": [], "owner": {"reputation": 42006, "user_id": 3807729, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/UEUbF.jpg?s=128&g=1", "display_name": "Galik", "link": "https://stackoverflow.com/users/3807729/galik"}, "is_accepted": false, "score": 1, "last_activity_date": 1439092472, "creation_date": 1439092472, "answer_id": 31900732, "question_id": 31900566, "link": "https://stackoverflow.com/questions/31900566/how-do-command-line-tools-change-their-output-after-outputting-it/31900732#31900732", "title": "How do command line tools change their output after outputting it?", "body": "<p>They probably use the fancy <a href=\"http://invisible-island.net/ncurses/\" rel=\"nofollow\">ncurses</a> library but on my <code>Linux</code> for my personal command-line tools I simply send <code>'\\r'</code> to move the cursor back to the start of the line to overwrite it with new progress information.</p>\n\n<pre><code>#include &lt;thread&gt;\n#include &lt;chrono&gt;\n#include &lt;iostream&gt;\n\nint main()\n{\n    for(auto i = 0; i &lt; 100; ++i)\n    {\n        std::cout &lt;&lt; \"\\rprogress: \" &lt;&lt; i &lt;&lt; \"%        \" &lt;&lt; std::flush;\n        std::this_thread::sleep_for(std::chrono::milliseconds(100));\n    }\n\n    std::cout &lt;&lt; \"\\rprogress: DONE             \" &lt;&lt; std::flush;\n}\n</code></pre>\n"}, {"tags": [], "owner": {"reputation": 2396, "user_id": 3669252, "user_type": "registered", "accept_rate": 73, "profile_image": "https://i.stack.imgur.com/tPykj.jpg?s=128&g=1", "display_name": "aa333", "link": "https://stackoverflow.com/users/3669252/aa333"}, "is_accepted": false, "score": 5, "last_activity_date": 1439094532, "last_edit_date": 1439094532, "creation_date": 1439092896, "answer_id": 31900776, "question_id": 31900566, "link": "https://stackoverflow.com/questions/31900566/how-do-command-line-tools-change-their-output-after-outputting-it/31900776#31900776", "title": "How do command line tools change their output after outputting it?", "body": "<p>Looking at GNU wget repo on GitHub -- <a href=\"https://github.com/jay/wget/blob/master/src/progress.c#L1066\" rel=\"nofollow\">progress.c</a></p>\n\n<p>It seems they do it the same way i.e. print a <code>\\r</code> and then overwrite.</p>\n\n<pre><code>/* Print the contents of the buffer as a one-line ASCII \"image\" so\n   that it can be overwritten next time.  */\n\nstatic void\ndisplay_image (char *buf)\n{\n  bool old = log_set_save_context (false);\n  logputs (LOG_VERBOSE, \"\\r\");\n  logputs (LOG_VERBOSE, buf);\n  log_set_save_context (old);\n}\n</code></pre>\n"}], "owner": {"reputation": 2192, "user_id": 2480092, "user_type": "registered", "accept_rate": 9, "profile_image": "https://www.gravatar.com/avatar/97f4cd231024913afd99cbe69655a963?s=128&d=identicon&r=PG", "display_name": "TheEnvironmentalist", "link": "https://stackoverflow.com/users/2480092/theenvironmentalist"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 672, "favorite_count": 3, "answer_count": 4, "score": 12, "last_activity_date": 1439094532, "creation_date": 1439090514, "question_id": 31900566, "link": "https://stackoverflow.com/questions/31900566/how-do-command-line-tools-change-their-output-after-outputting-it", "title": "How do command line tools change their output after outputting it?", "body": "<p>I've noticed that a lot of command line tools, wget for example, will show progress as a number or progress bar that advances as a process is completed. While the question isn't really language-specific, out of the languages I use most often for command line tools (C++, Node.js, Haskell) I haven't seen a way to do this.</p>\n\n<p>Here's an example, three snapshots of a <strong>single line</strong> of Terminal as wget downloads a file:<a href=\"https://i.stack.imgur.com/4UEau.png\" rel=\"nofollow noreferrer\"><img src=\"https://i.stack.imgur.com/4UEau.png\" alt=\"Beginning process\"></a><a href=\"https://i.stack.imgur.com/5HOwl.png\" rel=\"nofollow noreferrer\"><img src=\"https://i.stack.imgur.com/5HOwl.png\" alt=\"Middle of process\"></a><a href=\"https://i.stack.imgur.com/K2AwR.png\" rel=\"nofollow noreferrer\"><img src=\"https://i.stack.imgur.com/K2AwR.png\" alt=\"Process nearly complete\"></a></p>\n\n<p>Along with other information, wget shows a progress bar (&lt;=>) that advances as it downloads a file. The amount of data downloaded so far (6363, 179561, 316053) and the current download speed (10.7KB/s, 65.8KB/s, 63.0KB/s) update as well. How is this done?</p>\n\n<p>Ideally, please include a code sample from one or more of the three languages mentioned above.</p>\n"}, {"tags": ["haskell", "persistent", "haskell-snap-framework"], "answers": [{"comments": [{"owner": {"reputation": 2097, "user_id": 1646823, "user_type": "registered", "accept_rate": 81, "profile_image": "https://www.gravatar.com/avatar/8471ef6adbd84694d3c37e445768a75f?s=128&d=identicon&r=PG", "display_name": "jvans", "link": "https://stackoverflow.com/users/1646823/jvans"}, "edited": false, "score": 0, "creation_date": 1439116429, "post_id": 31900417, "comment_id": 51720883, "body": "The data type is private to the class and not exposed so I can&#39;t actually import this."}, {"owner": {"reputation": 25144, "user_id": 477476, "user_type": "registered", "accept_rate": 85, "profile_image": "https://i.stack.imgur.com/Qf4TT.png?s=128&g=1", "display_name": "Cactus", "link": "https://stackoverflow.com/users/477476/cactus"}, "reply_to_user": {"reputation": 2097, "user_id": 1646823, "user_type": "registered", "accept_rate": 81, "profile_image": "https://www.gravatar.com/avatar/8471ef6adbd84694d3c37e445768a75f?s=128&d=identicon&r=PG", "display_name": "jvans", "link": "https://stackoverflow.com/users/1646823/jvans"}, "edited": false, "score": 0, "creation_date": 1439137651, "post_id": 31900417, "comment_id": 51726567, "body": "@jvans: no, why would you think that? I&#39;ve added a small example to my answer."}, {"owner": {"reputation": 2097, "user_id": 1646823, "user_type": "registered", "accept_rate": 81, "profile_image": "https://www.gravatar.com/avatar/8471ef6adbd84694d3c37e445768a75f?s=128&d=identicon&r=PG", "display_name": "jvans", "link": "https://stackoverflow.com/users/1646823/jvans"}, "edited": false, "score": 0, "creation_date": 1439169854, "post_id": 31900417, "comment_id": 51734634, "body": "Ah not sure why I thought that. Must have misread an error message. Thanks for your help!"}], "tags": [], "owner": {"reputation": 25144, "user_id": 477476, "user_type": "registered", "accept_rate": 85, "profile_image": "https://i.stack.imgur.com/Qf4TT.png?s=128&g=1", "display_name": "Cactus", "link": "https://stackoverflow.com/users/477476/cactus"}, "is_accepted": true, "score": 1, "last_activity_date": 1451307318, "last_edit_date": 1451307318, "creation_date": 1439088469, "answer_id": 31900417, "question_id": 31899265, "link": "https://stackoverflow.com/questions/31899265/using-type-safe-routes-with-persistent-datatypes-in-snap/31900417#31900417", "title": "Using type safe routes with persistent datatypes in snap", "body": "<p><a href=\"https://hackage.haskell.org/package/persistent-2.2/docs/Database-Persist-Sql.html#t:SqlBackend\" rel=\"nofollow\">The documentation for <code>SqlBackend</code></a> shows that the associated datatype  <code>BackendKey</code> is instanciated for <code>SqlBackend</code> as</p>\n\n<pre><code>data BackendKey SqlBackend = SqlBackendKey {\n    unSqlBackendKey :: Int64\n}\n</code></pre>\n\n<p>Which should be enough information to write your own <code>PathInfo</code> instance, along the lines of the following example:</p>\n\n<pre><code>{-# LANGUAGE TypeFamilies #-}\n\nimport Database.Persist.Sql\nimport Data.Int (Int64)\n\nfoo :: BackendKey SqlBackend -&gt; Int64\nfoo (SqlBackendKey key) = key\n\nbar :: Int64 -&gt; BackendKey SqlBackend\nbar = SqlBackendKey\n</code></pre>\n"}], "owner": {"reputation": 2097, "user_id": 1646823, "user_type": "registered", "accept_rate": 81, "profile_image": "https://www.gravatar.com/avatar/8471ef6adbd84694d3c37e445768a75f?s=128&d=identicon&r=PG", "display_name": "jvans", "link": "https://stackoverflow.com/users/1646823/jvans"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 118, "favorite_count": 0, "accepted_answer_id": 31900417, "answer_count": 1, "score": 2, "last_activity_date": 1451307318, "creation_date": 1439073375, "last_edit_date": 1451280860, "question_id": 31899265, "link": "https://stackoverflow.com/questions/31899265/using-type-safe-routes-with-persistent-datatypes-in-snap", "title": "Using type safe routes with persistent datatypes in snap", "body": "<p>I have a Snap application using Persistent for storage and I'm trying to generate type safe routes for data types defined in Persistent. I'm using the <a href=\"https://github.com/lukerandall/snap-web-routes\" rel=\"nofollow\">snap-web-routes package</a>:. </p>\n\n<p>I have the following Template Haskell function that creates the data type of <code>Group</code> and <code>GroupId</code>: </p>\n\n<pre><code>share [mkPersist sqlSettings, mkMigrate \"migrateAll\"] [persistLowerCase|\n  Group\n    name T.Text\n    deriving Show\n|]\n</code></pre>\n\n<p>In my <code>Application.hs</code> I have: </p>\n\n<pre><code>data AppUrl = AddLink GroupId deriving (Eq, Show, Read, Generic)\n</code></pre>\n\n<p>The doc's suggest that:</p>\n\n<pre><code>instance PathInfo AppUrl\n</code></pre>\n\n<p>is all i need to do given the <code>Generic</code> derivation above however this blows up with </p>\n\n<pre><code>No instance for (PathInfo (KeyBackend SqlBackend Group))\n      arising from a use of \u2018Web.Routes.PathInfo.$gdmtoPathSegments\u2019\n</code></pre>\n\n<p>My assumption is that this error indicates that Haskell does not know how to auto create the instance definition with Persistent's data types.</p>\n\n<p>My next attempt was to manually define the instance:</p>\n\n<pre><code>instance PathInfo AppUrl where\n  toPathSegments   (AddLink groupId) = \"add-link\" : toPathPiece groupId : []\n  fromPathSegments (x:y:[]) = ????\n</code></pre>\n\n<p>I can't seem to figure out how to construct the <code>GroupId</code> data type.</p>\n\n<p>From Yesod's excellent <a href=\"http://www.yesodweb.com/book/persistent\" rel=\"nofollow\" title=\"persistent tutorial\">Persistent tutorial</a> I know that the datatype is defined as: </p>\n\n<pre><code>type GroupId = Key Group\nnewtype Key Group = GroupKey (BackendKey SqlBackend)\n</code></pre>\n\n<p>But then I run into a problem because <code>BackendKey</code> is not exposed so I can't import it and create my own instance. I can't seem to find a public API to create this data type in Persistent.</p>\n"}, {"tags": ["haskell", "openshift", "yesod", "haskell-snap-framework", "scotty"], "comments": [{"owner": {"user_type": "does_not_exist", "display_name": "user2879327"}, "edited": false, "score": 0, "creation_date": 1439305951, "post_id": 31899193, "comment_id": 51801053, "body": "Since those are community cartridges ( and not really supported by openshift) you should try visiting the github repo for one (or all) of them and log an issue (if that feature is available)"}, {"owner": {"reputation": 1442, "user_id": 562970, "user_type": "registered", "accept_rate": 80, "profile_image": "https://www.gravatar.com/avatar/68f7e7b66b24dced485f06444a7841bd?s=128&d=identicon&r=PG", "display_name": "Igor Deruga", "link": "https://stackoverflow.com/users/562970/igor-deruga"}, "edited": false, "score": 0, "creation_date": 1442069194, "post_id": 31899193, "comment_id": 52937395, "body": "Found this in the internets: <a href=\"https://forums.openshift.com/jenkins-build-failing-with-error-137\" rel=\"nofollow noreferrer\">error 137</a>. Seems like the process takes too much memory when creating the server. The answer suggests using medium gear as a workaround, but that kills all the fun and ease of deployment in openshift :("}], "answers": [{"tags": [], "owner": {"reputation": 21, "user_id": 1270931, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/8c82489a77ef6a03a407fef2af31daa6?s=128&d=identicon&r=PG", "display_name": "gidyn", "link": "https://stackoverflow.com/users/1270931/gidyn"}, "is_accepted": false, "score": 1, "last_activity_date": 1442136874, "creation_date": 1442136874, "answer_id": 32548269, "question_id": 31899193, "link": "https://stackoverflow.com/questions/31899193/deploying-haskell-standalone-yesod-snap-in-openshift-fails/32548269#32548269", "title": "Deploying Haskell (standalone, yesod, snap...) in Openshift fails", "body": "<p>This is caused by <a href=\"https://github.com/haskell/cabal/issues/2396\" rel=\"nofollow\">https://github.com/haskell/cabal/issues/2396</a>, see <a href=\"https://wiki.haskell.org/Web/Cloud#OpenShift\" rel=\"nofollow\">https://wiki.haskell.org/Web/Cloud#OpenShift</a>. May be fixed in cabal-install 1.24.</p>\n"}], "owner": {"reputation": 127, "user_id": 2890248, "user_type": "registered", "accept_rate": 67, "profile_image": "https://www.gravatar.com/avatar/f870ee1d4e629ee64678731f4582932a?s=128&d=identicon&r=PG&f=1", "display_name": "user2890248", "link": "https://stackoverflow.com/users/2890248/user2890248"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 205, "favorite_count": 2, "answer_count": 1, "score": 3, "last_activity_date": 1442136874, "creation_date": 1439072828, "question_id": 31899193, "link": "https://stackoverflow.com/questions/31899193/deploying-haskell-standalone-yesod-snap-in-openshift-fails", "title": "Deploying Haskell (standalone, yesod, snap...) in Openshift fails", "body": "<p>Whenever I try to create an application based on the Haskell cartridge, it results in the a variant of the following error:</p>\n\n<p><code>The initial build for the application failed: Shell command '/sbin/runuser -s /bin/sh 55c67c940c1e6694ac000017 -c \"exec /usr/bin/runcon 'unconfined_u:system_r:openshift_t:s0:c5,c753' /bin/sh -c \\\"gear postreceive --init &gt;&gt; /tmp/initial-build.log 2&gt;&amp;1\\\"\"' returned an error. rc=137 .Last 10 kB of build output: The server is not running, nothing to stop. Repairing links for 1 deployments Building git ref 'master', commit 6b8beb4 Downloading the latest package list from hackage.haskell.org</code></p>\n\n<p>This happens for predefined cartridges in the Openshift hub, such as Snap, Yesod, Scotty, and for the cartridges defined in the wiki (<a href=\"https://wiki.haskell.org/Web/Cloud\" rel=\"nofollow\">https://wiki.haskell.org/Web/Cloud</a>). </p>\n\n<p>I'm requesting help because he application never gets created thus I can't check the logs, and I can't make much from the error message. I tried other cartridge types than Haskell, and they get created just fine.</p>\n"}, {"tags": ["haskell", "markdown", "yesod", "persist"], "comments": [{"owner": {"reputation": 478, "user_id": 4079111, "user_type": "registered", "accept_rate": 72, "profile_image": "https://www.gravatar.com/avatar/e4775c2984de42fca587c03065107de1?s=128&d=identicon&r=PG&f=1", "display_name": "doofin", "link": "https://stackoverflow.com/users/4079111/doofin"}, "edited": false, "score": 0, "creation_date": 1439110821, "post_id": 31898691, "comment_id": 51719681, "body": "why not store markdown simply as Text ? then u can use a library to convert markdown Text to html, that works for me"}, {"owner": {"reputation": 31, "user_id": 4846845, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/70a0020eca02f1b7f66a9be330377e50?s=128&d=identicon&r=PG&f=1", "display_name": "Lenny", "link": "https://stackoverflow.com/users/4846845/lenny"}, "reply_to_user": {"reputation": 478, "user_id": 4079111, "user_type": "registered", "accept_rate": 72, "profile_image": "https://www.gravatar.com/avatar/e4775c2984de42fca587c03065107de1?s=128&d=identicon&r=PG&f=1", "display_name": "doofin", "link": "https://stackoverflow.com/users/4079111/doofin"}, "edited": false, "score": 0, "creation_date": 1439129699, "post_id": 31898691, "comment_id": 51724312, "body": "I think I&#39;ll try that approach, but if the field is type <code>Text</code>, how would I be able to validate input for that field against the <code>Markdown</code> type? I can use <code>markdownField</code> from <code>Yesod.Text.Markdown</code> but that doesn&#39;t seem to work when the field is type <code>Text</code>."}, {"owner": {"reputation": 7297, "user_id": 1176156, "user_type": "registered", "accept_rate": 80, "profile_image": "https://www.gravatar.com/avatar/89604545aa57aa3d14306af60126e193?s=128&d=identicon&r=PG", "display_name": "MaxGabriel", "link": "https://stackoverflow.com/users/1176156/maxgabriel"}, "edited": false, "score": 0, "creation_date": 1439566393, "post_id": 31898691, "comment_id": 51929767, "body": "This question seems related: <a href=\"http://stackoverflow.com/questions/31902061/what-does-not-a-persisttext-value-mean\" title=\"what does not a persisttext value mean\">stackoverflow.com/questions/31902061/&hellip;</a>"}, {"owner": {"reputation": 7297, "user_id": 1176156, "user_type": "registered", "accept_rate": 80, "profile_image": "https://www.gravatar.com/avatar/89604545aa57aa3d14306af60126e193?s=128&d=identicon&r=PG", "display_name": "MaxGabriel", "link": "https://stackoverflow.com/users/1176156/maxgabriel"}, "edited": false, "score": 0, "creation_date": 1439567741, "post_id": 31898691, "comment_id": 51930593, "body": "This looks to be a real issue with either yesod-text-markdown or persistent (I can reproduce it). The error message stems from here: <a href=\"https://github.com/Tarrasch/yesod-text-markdown/blob/7d7e35b97d50360197a6139df8354d9926ede8a8/Yesod/Text/Markdown.hs#L22-L25\" rel=\"nofollow noreferrer\">github.com/Tarrasch/yesod-text-markdown/blob/&hellip;</a>"}, {"owner": {"reputation": 7297, "user_id": 1176156, "user_type": "registered", "accept_rate": 80, "profile_image": "https://www.gravatar.com/avatar/89604545aa57aa3d14306af60126e193?s=128&d=identicon&r=PG", "display_name": "MaxGabriel", "link": "https://stackoverflow.com/users/1176156/maxgabriel"}, "edited": false, "score": 0, "creation_date": 1439569074, "post_id": 31898691, "comment_id": 51931289, "body": "Ok, persist-text-markdown is expecting <code>PersistText</code> but it&#39;s getting <code>PersistByteString</code>. Perhaps it should support deserializing from both of those? I&#39;ll investigate."}, {"owner": {"reputation": 7297, "user_id": 1176156, "user_type": "registered", "accept_rate": 80, "profile_image": "https://www.gravatar.com/avatar/89604545aa57aa3d14306af60126e193?s=128&d=identicon&r=PG", "display_name": "MaxGabriel", "link": "https://stackoverflow.com/users/1176156/maxgabriel"}, "edited": false, "score": 0, "creation_date": 1439577627, "post_id": 31898691, "comment_id": 51935814, "body": "I started an issue about this: <a href=\"https://github.com/Tarrasch/yesod-text-markdown/issues/12\" rel=\"nofollow noreferrer\">github.com/Tarrasch/yesod-text-markdown/issues/12</a>"}], "answers": [{"tags": [], "owner": {"reputation": 7297, "user_id": 1176156, "user_type": "registered", "accept_rate": 80, "profile_image": "https://www.gravatar.com/avatar/89604545aa57aa3d14306af60126e193?s=128&d=identicon&r=PG", "display_name": "MaxGabriel", "link": "https://stackoverflow.com/users/1176156/maxgabriel"}, "is_accepted": false, "score": 1, "last_activity_date": 1441165363, "creation_date": 1441165363, "answer_id": 32344306, "question_id": 31898691, "link": "https://stackoverflow.com/questions/31898691/storing-markdown-in-a-yesod-persist-model/32344306#32344306", "title": "Storing Markdown in a Yesod Persist Model", "body": "<p>This turned out to be caused by a bug in the <code>persistent-mysql</code> package that's now fixed in <code>persistent-mysql-2.3</code>.</p>\n\n<p>Here's the root cause for those interested:</p>\n\n<p>The MySQL C library (and by extension the Haskell <code>mysql</code> package, which <code>persistent-mysql</code> depends on) doesn't distinguish between binary and textual data at the type level. So if you saved a <code>TEXT</code> value to the database, when it was looked it up by persistent it appeared to be binary data (a <code>PersistByteString</code>).</p>\n\n<p>I fixed this in <a href=\"https://github.com/yesodweb/persistent/pull/451\" rel=\"nofollow\">#451</a> by checking the character set of the column, which the MySQL API docs recommend as the appropriate solution.</p>\n\n<p>For more details, see that pull request or <a href=\"https://github.com/yesodweb/persistent/issues/448\" rel=\"nofollow\">this issue</a>.</p>\n\n<p>Thanks for asking this question; I wouldn't have realized there was a bug otherwise.</p>\n"}], "owner": {"reputation": 31, "user_id": 4846845, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/70a0020eca02f1b7f66a9be330377e50?s=128&d=identicon&r=PG&f=1", "display_name": "Lenny", "link": "https://stackoverflow.com/users/4846845/lenny"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 167, "favorite_count": 0, "answer_count": 1, "score": 3, "last_activity_date": 1441165363, "creation_date": 1439068640, "question_id": 31898691, "link": "https://stackoverflow.com/questions/31898691/storing-markdown-in-a-yesod-persist-model", "title": "Storing Markdown in a Yesod Persist Model", "body": "<p>I am trying to store markdown in a field on a Persistent model with a MySQL backend. I've broken the use case down to:</p>\n\n<p>models:</p>\n\n<pre><code>TestModel\n    content Markdown\n</code></pre>\n\n<p>Model.hs:</p>\n\n<pre><code>import Text.Markdown (Markdown)\nimport Yesod.Text.Markdown ()\n....\n</code></pre>\n\n<p>This seems to create the correct migrations:</p>\n\n<pre><code>mysql&gt; show columns in test_model;\n+---------+------------+------+-----+---------+----------------+\n| Field   | Type       | Null | Key | Default | Extra          |\n+---------+------------+------+-----+---------+----------------+\n| id      | bigint(20) | NO   | PRI | NULL    | auto_increment |\n| content | text       | NO   |     | NULL    |                |\n+---------+------------+------+-----+---------+----------------+\n</code></pre>\n\n<p>However when I try to retrieve data from this table, I'm presented with an exception. The example below is from a <code>cabal repl</code> but the same happens when the application is running:</p>\n\n<pre><code>repl&gt; testid &lt;- db $ insert $ TestModel $ Markdown \"# Hello world\"\n[Debug#SQL] INSERT INTO `test_model`(`content`) VALUES(?); [PersistText \"# Hello world\"]\nrepl&gt; testmodel &lt;- db $ get testid\n[Debug#SQL] SELECT `content` FROM `test_model` WHERE `id`=?; [PersistInt64 2]\n*** Exception: runFakeHandler issue: InternalError \"get TestModelKey {unTestModelKey = SqlBackendKey {unSqlBackendKey = 2}}: field content: Not a PersistText value\"\n</code></pre>\n\n<p>My first guess was that the value for the TestModel constructor was wrong, but the same error occurs even when creating the object using a <code>markdownField</code> in a form:</p>\n\n<pre><code>testModelForm :: AForm Handler TestModel\ntestModelForm = TestModel\n        &lt;$&gt; areq markdownField \"Content\" Nothing\n\ngetTestModelR :: TestModelId -&gt; Handler Html\ngetTestModelR testModelId = do\n    testmodel &lt;- runDB $ get404 testModelId\n....\n08/Aug/2015:12:44:33 -0700 [Error#yesod-core] get TestModelKey {unTestModelKey = SqlBackendKey {unSqlBackendKey = 2}}: field content: Not a PersistText value @(yesod-core-1.4.12:Yesod.Core.Class.Yesod ./Yesod/Core/Class/Yesod.hs:577:5)\n</code></pre>\n\n<p>Has anybody seen this exception before and know how to handle it? The only documentation of this error I could seem to find was the <a href=\"http://hackage.haskell.org/package/yesod-text-markdown-0.1.8/docs/src/Yesod-Text-Markdown.html\" rel=\"nofollow\">source code</a> for <code>yesod-text-markdown</code>.</p>\n"}, {"tags": ["haskell", "dictionary", "monads", "monad-transformers", "maybe"], "comments": [{"owner": {"reputation": 17809, "user_id": 1088108, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/63781cd38e91aa346a3849bc3ef3e550?s=128&d=identicon&r=PG&f=1", "display_name": "&#216;rjan Johansen", "link": "https://stackoverflow.com/users/1088108/%c3%98rjan-johansen"}, "edited": false, "score": 4, "creation_date": 1439069690, "post_id": 31898658, "comment_id": 51712668, "body": "It&#39;s out of date (since <code>containers</code> version 0.2.0.0, from 2008). This method was briefly popular but then went out of style again. See <a href=\"http://stackoverflow.com/questions/3030767/haskell-maps-returning-a-monad\">this question</a>, in particular Don Stewart&#39;s answer."}, {"owner": {"reputation": 44013, "user_id": 1477667, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/trgKM.jpg?s=128&g=1", "display_name": "dfeuer", "link": "https://stackoverflow.com/users/1477667/dfeuer"}, "edited": false, "score": 4, "creation_date": 1439080233, "post_id": 31898658, "comment_id": 51714728, "body": "The next time you wonder if an interface has changed, you can usually get the answer by looking at old and new versions on Hackage."}], "answers": [{"tags": [], "owner": {"reputation": 31243, "user_id": 2751851, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/4ddc0.png?s=128&g=1", "display_name": "duplode", "link": "https://stackoverflow.com/users/2751851/duplode"}, "is_accepted": true, "score": 14, "last_activity_date": 1555799982, "last_edit_date": 1555799982, "creation_date": 1439070025, "answer_id": 31898864, "question_id": 31898658, "link": "https://stackoverflow.com/questions/31898658/the-maybe-result-from-map-lookup-is-not-type-checking-with-my-monad-transformer/31898864#31898864", "title": "The Maybe result from Map.lookup is not type checking with my Monad Transformer stack", "body": "<p>Your tutorial is from 2006. It uses <a href=\"https://hackage.haskell.org/package/containers-0.1.0.0/docs/Data-Map.html#v:lookup\" rel=\"nofollow noreferrer\">a very old version of <code>Data.Map</code></a> in which <code>lookup</code>'s type indeed was:</p>\n\n<pre><code>lookup :: (Monad m, Ord k) =&gt; k -&gt; Map k a -&gt; m a\n</code></pre>\n\n<p>I reckon the change happened because <code>fail</code> is widely considered to be a wart in the <code>Monad</code> class. Returning a <code>Maybe a</code> makes a lookup failure explicit and manageable. Making it implicit by hiding it behind <code>fail</code> just to have a slightly more convenient type is quite dirty IMO. (See also <a href=\"http://stackoverflow.com/questions/3030767/haskell-maps-returning-a-monad\">the question linked to by \u00d8rjan</a>.)</p>\n\n<p>You can use this adapted version of <code>lookup</code> to follow along the tutorial:</p>\n\n<pre><code>fallibleLookup :: (Ord k, Monad m) =&gt; k -&gt; Map.Map k a -&gt; m a\nfallibleLookup k = maybe (fail \"fallibleLookup: Key not found\") pure . Map.lookup k\n</code></pre>\n\n<p>Note that <a href=\"https://gitlab.haskell.org/ghc/ghc/wikis/migration/8.8#base-41300\" rel=\"nofollow noreferrer\">with the upcoming release of GHC 8.8</a> the proper constraint to use on <code>m</code> will be <code>MonadFail</code> rather than <code>Monad</code>.</p>\n"}], "owner": {"reputation": 1891, "user_id": 45160, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/9fe6d04c7c6a357a92a2b05efd0d09bc?s=128&d=identicon&r=PG", "display_name": "Vanson Samuel", "link": "https://stackoverflow.com/users/45160/vanson-samuel"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 565, "favorite_count": 1, "accepted_answer_id": 31898864, "answer_count": 1, "score": 11, "last_activity_date": 1555800254, "creation_date": 1439068430, "last_edit_date": 1555800254, "question_id": 31898658, "link": "https://stackoverflow.com/questions/31898658/the-maybe-result-from-map-lookup-is-not-type-checking-with-my-monad-transformer", "title": "The Maybe result from Map.lookup is not type checking with my Monad Transformer stack", "body": "<p>I am going though the following paper: <a href=\"https://page.mi.fu-berlin.de/scravy/realworldhaskell/materialien/monad-transformers-step-by-step.pdf\" rel=\"nofollow noreferrer\">Monad Transformers Step by Step</a>. In section 2.1 \"Converting to Monadic Style\", a function is converted to return <code>Value</code> in the <code>Eval1</code> monad. This part of the function doesn't make sense to me:</p>\n\n<pre><code>eval1 env (Var n) = Map.lookup n env\n</code></pre>\n\n<p>The result of that will be <code>Maybe Value</code> however the function's type signature is:</p>\n\n<pre><code>eval1 :: Env \u2192 Exp \u2192 Eval1 Value\n</code></pre>\n\n<p>The function is failing to type check, and the error seems obvious to me.  Yet the author specifically states that this will work:</p>\n\n<blockquote>\n  <p>... the Var case does not need a fromJust call anymore: The reason is that Map.lookup is defined to work within any monad by simply calling the monad\u2019s fail function \u2013 this fits nicely with our monadic formulation here.</p>\n</blockquote>\n\n<p>The signature for Map.lookup does not look like it is designed to work with any monad:</p>\n\n<pre><code>lookup :: Ord k =&gt; k -&gt; Map k a -&gt; Maybe a\n</code></pre>\n\n<p>Is this paper out of date or am I missing something?  If the paper is in fact out of date, why was <code>lookup</code> changed to only work with <code>Maybe</code>.</p>\n\n<p>Thanks!</p>\n"}, {"tags": ["xml", "haskell", "gpx"], "answers": [{"tags": [], "owner": {"reputation": 31243, "user_id": 2751851, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/4ddc0.png?s=128&g=1", "display_name": "duplode", "link": "https://stackoverflow.com/users/2751851/duplode"}, "is_accepted": true, "score": 2, "last_activity_date": 1439067507, "creation_date": 1439067507, "answer_id": 31898515, "question_id": 31897737, "link": "https://stackoverflow.com/questions/31897737/how-to-parse-gpx-file-using-haskells-xml-conduit/31898515#31898515", "title": "How to parse GPX file using Haskell&#39;s xml-conduit?", "body": "<p>Two issues. Firstly, there is a typo in the namespace; it should be <code>http://www.topografix.com/GPX/1/1</code>. Secondly, your final Kleisli arrow (<code>\\e -&gt; do -- etc.</code>) is acting on the children of the <code>trkpt</code> elements, rather than on the <code>trkpt</code> themselves. Here is a <code>gpxTrkpts</code> which should do what you want:</p>\n\n<pre><code>gpxTrkpts =\n  child &gt;=&gt; element \"{http://www.topografix.com/GPX/1/1}trk\" &gt;=&gt;\n  child &gt;=&gt; element \"{http://www.topografix.com/GPX/1/1}trkseg\" &gt;=&gt;\n  child &gt;=&gt; element \"{http://www.topografix.com/GPX/1/1}trkpt\" &gt;=&gt;\n  \\e -&gt; do\n    let cs = child e\n        ele  = T.concat $ cs &gt;&gt;= element \"{http://www.topografix.com/GPX/1/1}ele\" &gt;&gt;= descendant &gt;&gt;= content\n        time = T.concat $ cs &gt;&gt;= element \"{http://www.topografix.com/GPX/1/1}time\" &gt;&gt;= descendant &gt;&gt;= content\n        lat  = T.concat $ attribute \"lat\" e\n        lon  = T.concat $ attribute \"lon\" e\n    return $ Trkpt lat lon ele time\n</code></pre>\n"}, {"tags": [], "owner": {"reputation": 49959, "user_id": 866915, "user_type": "registered", "accept_rate": 70, "profile_image": "https://www.gravatar.com/avatar/09242131d6e17cbbe31e8547514da6e5?s=128&d=identicon&r=PG", "display_name": "ErikR", "link": "https://stackoverflow.com/users/866915/erikr"}, "is_accepted": false, "score": 2, "last_activity_date": 1439070270, "creation_date": 1439070270, "answer_id": 31898895, "question_id": 31897737, "link": "https://stackoverflow.com/questions/31897737/how-to-parse-gpx-file-using-haskells-xml-conduit/31898895#31898895", "title": "How to parse GPX file using Haskell&#39;s xml-conduit?", "body": "<p>@duplode has pointed out the problem. Here are some more comments.</p>\n\n<ol>\n<li><p>How about using the <a href=\"https://hackage.haskell.org/package/gpx-conduit\" rel=\"nofollow\">gpx-conduit package</a></p></li>\n<li><p>Here is some code which can help debug parsing problems:</p></li>\n</ol>\n\n<p>Code:</p>\n\n<pre><code>{-# LANGUAGE OverloadedStrings #-}\nmodule Lib2 where\n\nimport qualified Data.Text           as T\nimport Data.Text (Text)\nimport Text.XML\nimport Text.XML.Cursor\nimport qualified Filesystem.Path.CurrentOS as Path\nimport Control.Monad\n\nshowNode (NodeElement e)     = \"NodeEement \" ++ T.unpack (nameLocalName $ elementName e)\nshowNode (NodeInstruction _) = \"NodeInstruction ...\"\nshowNode (NodeContent t)     = \"NodeContent \" ++ show t\nshowNode (NodeComment _)     = \"NodeComment\"\n\ntestParser parser =  do\n  content &lt;- Text.XML.readFile def (Path.decodeString \"sample.xml\")\n  let nodes = map node $ parser (fromDocument content)\n  forM_ nodes $ \\n -&gt; putStrLn (showNode n)\n</code></pre>\n\n<p>Use it in ghci like this:</p>\n\n<pre><code>ghci&gt; :set -XOverloadedStrings\nghci&gt; :l Lib2\nLib2&gt; testParser child\nNodeContent \"\\n  \"\nNodeEement metadata\nNodeContent \"\\n  \"\nNodeEement trk\nNodeContent \"\\n  \"\nNodeEement extensions\nNodeContent \"\\n\"\n\nLib2&gt; testParser $ child &gt;=&gt; element \"trk\"\nLib2&gt; testParser $ child &gt;=&gt; laxElement \"trk\"\nNodeEement trk\n\nLib2&gt; testParser $ child &gt;=&gt; laxElement \"trk\" &gt;=&gt; child &gt;=&gt; laxElement \"trkseg\"\nNodeElement trkseg\nLib2&gt; testParser $ child &gt;=&gt; laxElement \"trk\" &gt;=&gt; child &gt;=&gt; laxElement \"trkseg\" &gt;=&gt; child &gt;=&gt; laxElement \"trkpt\"\nNodeEement trkpt\nNodeEement trkpt\nNodeEement trkpt\nNodeEement trkpt\nLib2&gt;\n</code></pre>\n"}], "owner": {"reputation": 11606, "user_id": 1002430, "user_type": "registered", "accept_rate": 53, "profile_image": "https://i.stack.imgur.com/ufy7U.png?s=128&g=1", "display_name": "Ana", "link": "https://stackoverflow.com/users/1002430/ana"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 195, "favorite_count": 0, "accepted_answer_id": 31898515, "answer_count": 2, "score": 3, "last_activity_date": 1439070270, "creation_date": 1439062194, "last_edit_date": 1439064514, "question_id": 31897737, "link": "https://stackoverflow.com/questions/31897737/how-to-parse-gpx-file-using-haskells-xml-conduit", "title": "How to parse GPX file using Haskell&#39;s xml-conduit?", "body": "<p>I'd like to use <code>xml-conduit</code> to parse GPX files. So far I've got the following:</p>\n\n<pre><code>{-# LANGUAGE OverloadedStrings #-}\n\nimport Control.Applicative\nimport Data.Text           as T\nimport Text.XML\nimport Text.XML.Cursor\n\ndata Trkpt = Trkpt {\n  trkptLat :: Text,\n  trkptLon :: Text,\n  trkptEle :: Text,\n  trkptTime :: Text\n  } deriving (Show)\n\ntrkptsFromFile path =\n  gpxTrkpts . fromDocument &lt;$&gt; Text.XML.readFile def path\n\ngpxTrkpts =\n  child &gt;=&gt; element \"{http://www.topografix.com/GPX/1/0}trk\" &gt;=&gt;\n  child &gt;=&gt; element \"{http://www.topografix.com/GPX/1/0}trkseg\" &gt;=&gt;\n  child &gt;=&gt; element \"{http://www.topografix.com/GPX/1/0}trkpt\" &gt;=&gt;\n  child &gt;=&gt; \\e -&gt; do\n    let ele  = T.concat $ element \"{http://www.topografix.com/GPX/1/0}ele\" e &gt;&gt;= descendant &gt;&gt;= content\n    let time = T.concat $ element \"{http://www.topografix.com/GPX/1/0}time\" e &gt;&gt;= descendant &gt;&gt;= content\n    let lat  = T.concat $ attribute \"lat\" e\n    let lon  = T.concat $ attribute \"lon\" e\n    return $ Trkpt lat lon ele time\n</code></pre>\n\n<p>A sample GPX file is <a href=\"https://github.com/pytrainer/pytrainer/wiki/Sample-GPX-\" rel=\"nofollow\">here</a>. </p>\n\n<p>I'm getting strange results where the parsed text is mostly empty, with some sporadic actual values, although the original GPX file data is all valid. When there is an actual value, it is only in one of the fields of the record.</p>\n\n<p>I'm quite certain I'm not using the <code>xml-conduit</code> API properly. What am I doing wrong?</p>\n"}, {"tags": ["haskell", "ghc", "compiler-warnings", "generated-code"], "comments": [{"owner": {"reputation": 49959, "user_id": 866915, "user_type": "registered", "accept_rate": 70, "profile_image": "https://www.gravatar.com/avatar/09242131d6e17cbbe31e8547514da6e5?s=128&d=identicon&r=PG", "display_name": "ErikR", "link": "https://stackoverflow.com/users/866915/erikr"}, "edited": false, "score": 0, "creation_date": 1439061243, "post_id": 31897014, "comment_id": 51710524, "body": "How about organizing your cabal file so that the alex and happy modules are in their own library component, and use <code>ghc-options: -w</code> for that component?"}], "answers": [{"tags": [], "owner": {"reputation": 49959, "user_id": 866915, "user_type": "registered", "accept_rate": 70, "profile_image": "https://www.gravatar.com/avatar/09242131d6e17cbbe31e8547514da6e5?s=128&d=identicon&r=PG", "display_name": "ErikR", "link": "https://stackoverflow.com/users/866915/erikr"}, "is_accepted": true, "score": 5, "last_activity_date": 1439066174, "creation_date": 1439066174, "answer_id": 31898319, "question_id": 31897014, "link": "https://stackoverflow.com/questions/31897014/how-can-i-suppress-warnings-in-generated-code/31898319#31898319", "title": "How can I suppress warnings in generated code?", "body": "<p>A typical alex file begins with some stuff at the top - usually a module declaration which will get copied verbatim into the generated file:</p>\n\n<pre><code>{\nmodule Main where\n}\n%wrapper \"basic\"\n...\n</code></pre>\n\n<p>So just add the GHC_OPTIONS pragma before the <code>module Main ...</code> line, e.g.:</p>\n\n<pre><code>{\n{-# GHC_OPTIONS -w #-}\nmodule Main where\n}\n%wrapper \"basic\"\n</code></pre>\n\n<p>and it will be present in your generated file. The same can be done with happy files.</p>\n"}], "owner": {"reputation": 9267, "user_id": 2284221, "user_type": "registered", "accept_rate": 81, "profile_image": "https://www.gravatar.com/avatar/120d229a55c7a6ce3037e6932c190616?s=128&d=identicon&r=PG", "display_name": "Patrick Collins", "link": "https://stackoverflow.com/users/2284221/patrick-collins"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 531, "favorite_count": 0, "accepted_answer_id": 31898319, "answer_count": 1, "score": 3, "last_activity_date": 1439066174, "creation_date": 1439057316, "last_edit_date": 1439058120, "question_id": 31897014, "link": "https://stackoverflow.com/questions/31897014/how-can-i-suppress-warnings-in-generated-code", "title": "How can I suppress warnings in generated code?", "body": "<p>I'm building a lexer and parser with Alex and Happy. The code they generate throws a huge number of warnings with <code>ghc-options: -Wall</code> turned on in my project's .cabal file. </p>\n\n<p>This makes it difficult to catch real warnings. How can I turn off the warnings only inside the generated files? I know it can be done with a pragma:</p>\n\n<pre><code>{#- GHC_OPTIONS -w -#}\n</code></pre>\n\n<p>But I can't think of an easy way to stick this pragma at the top of every generated file, every time they're rebuilt.</p>\n\n<p>What's the right way to do this?</p>\n"}, {"tags": ["haskell"], "comments": [{"owner": {"reputation": 57219, "user_id": 33796, "user_type": "registered", "accept_rate": 70, "profile_image": "https://www.gravatar.com/avatar/08727b23ba62e634b32988cdff082663?s=128&d=identicon&r=PG", "display_name": "luqui", "link": "https://stackoverflow.com/users/33796/luqui"}, "edited": false, "score": 5, "creation_date": 1439056538, "post_id": 31896816, "comment_id": 51709139, "body": "Random guess by <a href=\"https://scholar.google.com/scholar?hl=en&amp;q=haskell+stm+improvements\" rel=\"nofollow noreferrer\">google scholaring</a> around a bit: <a href=\"http://citeseerx.ist.psu.edu/viewdoc/download?doi=10.1.1.90.7784&amp;rep=rep1&amp;type=pdf\" rel=\"nofollow noreferrer\">the <code>unreadTVar</code> paper</a>."}, {"owner": {"reputation": 3278, "user_id": 1054808, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/efba8ca1758acda2032c79b9ff4cd60b?s=128&d=identicon&r=PG", "display_name": "J Fritsch", "link": "https://stackoverflow.com/users/1054808/j-fritsch"}, "reply_to_user": {"reputation": 57219, "user_id": 33796, "user_type": "registered", "accept_rate": 70, "profile_image": "https://www.gravatar.com/avatar/08727b23ba62e634b32988cdff082663?s=128&d=identicon&r=PG", "display_name": "luqui", "link": "https://stackoverflow.com/users/33796/luqui"}, "edited": false, "score": 0, "creation_date": 1439115387, "post_id": 31896816, "comment_id": 51720651, "body": "Thanks @luqui that is it! I did google scholar as well, but it did not show up for me. Google may use profiles when you are logged in."}, {"owner": {"reputation": 60057, "user_id": 1333025, "user_type": "registered", "accept_rate": 65, "profile_image": "https://www.gravatar.com/avatar/79ab43010f900324ac5e2de19a2916cb?s=128&d=identicon&r=PG", "display_name": "Petr", "link": "https://stackoverflow.com/users/1333025/petr"}, "reply_to_user": {"reputation": 57219, "user_id": 33796, "user_type": "registered", "accept_rate": 70, "profile_image": "https://www.gravatar.com/avatar/08727b23ba62e634b32988cdff082663?s=128&d=identicon&r=PG", "display_name": "luqui", "link": "https://stackoverflow.com/users/33796/luqui"}, "edited": false, "score": 0, "creation_date": 1439118487, "post_id": 31896816, "comment_id": 51721380, "body": "@luqui Perhaps make it an answer so that the question can be closed the answer voted for?"}], "owner": {"reputation": 3278, "user_id": 1054808, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/efba8ca1758acda2032c79b9ff4cd60b?s=128&d=identicon&r=PG", "display_name": "J Fritsch", "link": "https://stackoverflow.com/users/1054808/j-fritsch"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 97, "favorite_count": 2, "answer_count": 0, "score": 5, "last_activity_date": 1439055980, "creation_date": 1439055980, "question_id": 31896816, "link": "https://stackoverflow.com/questions/31896816/haskell-stm-extension", "title": "Haskell STM extension", "body": "<p>I am looking for a Haskell STM extension that I read about in a paper some years ago. I still remember that on the one hand the authors claimed to have significantly improved Haskell STM, on the other hand they ran into inconsistencies in their measurements that they could not explain. I also remember that the authors were quite well know. Would anyone know what paper that was? I cannot find t back.</p>\n"}, {"tags": ["haskell"], "comments": [{"owner": {"reputation": 31243, "user_id": 2751851, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/4ddc0.png?s=128&g=1", "display_name": "duplode", "link": "https://stackoverflow.com/users/2751851/duplode"}, "edited": false, "score": 1, "creation_date": 1439052241, "post_id": 31896155, "comment_id": 51707815, "body": "Probably not a duplicate, but <a href=\"http://stackoverflow.com/a/23319967/2751851\">I wrote an answer on getting <code>foldr</code> from <code>foldMap</code> a while ago</a>. The answer presumes basic familiarity with <code>Monoid</code>, so please tell us if it takes too many things for granted."}], "answers": [{"tags": [], "owner": {"reputation": 17809, "user_id": 1088108, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/63781cd38e91aa346a3849bc3ef3e550?s=128&d=identicon&r=PG&f=1", "display_name": "&#216;rjan Johansen", "link": "https://stackoverflow.com/users/1088108/%c3%98rjan-johansen"}, "is_accepted": false, "score": 11, "last_activity_date": 1439054702, "last_edit_date": 1495541173, "creation_date": 1439054702, "answer_id": 31896633, "question_id": 31896155, "link": "https://stackoverflow.com/questions/31896155/explain-how-does-new-foldr-work-in-haskell/31896633#31896633", "title": "Explain how does new foldr work in Haskell", "body": "<p>I'll just mention the parts that are <em>not</em> in <a href=\"https://stackoverflow.com/questions/23319683/foldr-foldl-for-free-when-tree-is-implementing-foldable-foldmap/23319967#23319967\">the answer @duplode linked</a>.</p>\n\n<p>First, those implementations you list are <em>default</em> methods. Every <code>Foldable</code> type needs to provide its own specific version of at least <em>one</em> of them, and lists (<code>[]</code>) provide <code>foldr</code>, <a href=\"https://raw.githubusercontent.com/ghc/ghc/master/libraries/base/GHC/Base.hs\" rel=\"nofollow noreferrer\">which is implemented</a> pretty much as it always has been:</p>\n\n<pre><code>foldr k z = go\n          where\n            go []     = z\n            go (y:ys) = y `k` go ys\n</code></pre>\n\n<p>(Which is, for efficiency, a bit different from the Haskell report version.)</p>\n\n<p>Also, a slight change in the <code>Foldable</code> default since duplode's answer is that strange <code>#.</code> operator, used internally in GHC's <a href=\"https://downloads.haskell.org/~ghc/7.10.2/docs/html/libraries/base-4.8.1.0/src/Data-Foldable.html#line-447\" rel=\"nofollow noreferrer\"><code>Data.Foldable</code></a> code.  It's basically a more efficient version of <code>.</code> that works <em>only</em> when the left function is a newtype wrapper/unwrapper function.  It's defined using the new newtype coercion mechanism, and gets optimized into essentially nothing:</p>\n\n<pre><code>(#.) :: Coercible b c =&gt; (b -&gt; c) -&gt; (a -&gt; b) -&gt; (a -&gt; c)\n(#.) _f = coerce\n{-# INLINE (#.) #-}\n</code></pre>\n"}, {"tags": [], "owner": {"reputation": 37, "user_id": 9964503, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/HGukF.jpg?s=128&g=1", "display_name": "John C", "link": "https://stackoverflow.com/users/9964503/john-c"}, "is_accepted": false, "score": 0, "last_activity_date": 1571763465, "last_edit_date": 1571763465, "creation_date": 1571762384, "answer_id": 58508803, "question_id": 31896155, "link": "https://stackoverflow.com/questions/31896155/explain-how-does-new-foldr-work-in-haskell/58508803#58508803", "title": "Explain how does new foldr work in Haskell", "body": "<p>The mental model I have for foldr follows this structure:</p>\n\n<blockquote>\n  <p>Given a list in it's a:(b:(c:[])) form, replace all \":\" with the given\n  op (1st parameter), and then replace the \"[]\" with the given initial\n  value (2nd parameter).</p>\n</blockquote>\n\n<p>A pseudo-codey example:</p>\n\n<pre><code>foldr (+) 0 [1,2,3,4] = 1 + 2 + 3 + 4 + 0\n</code></pre>\n\n<p>And remember, <code>[1,2,3,4]</code> is equivalent to <code>1:(2:(3:(4:[])))</code></p>\n"}], "owner": {"reputation": 4471, "user_id": 3858142, "user_type": "registered", "accept_rate": 46, "profile_image": "https://www.gravatar.com/avatar/4c27dead2edf0b6dc28833a694c42ba1?s=128&d=identicon&r=PG&f=1", "display_name": "sevo", "link": "https://stackoverflow.com/users/3858142/sevo"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 303, "favorite_count": 0, "answer_count": 2, "score": 9, "last_activity_date": 1571763465, "creation_date": 1439051588, "question_id": 31896155, "link": "https://stackoverflow.com/questions/31896155/explain-how-does-new-foldr-work-in-haskell", "title": "Explain how does new foldr work in Haskell", "body": "<p>New Haskell programmer will soon enough go to sources to see how <code>foldr</code> is implemented. Well, the code used to be simple (don't expect newcomers to know about <code>OldList</code> or <code>FTP</code>).</p>\n\n<p>How does the new code work?</p>\n\n<pre><code>-- | Map each element of the structure to a monoid,\n-- and combine the results.\nfoldMap :: Monoid m =&gt; (a -&gt; m) -&gt; t a -&gt; m\nfoldMap f = foldr (mappend . f) mempty\n\n-- | Right-associative fold of a structure.\n--\n-- @'foldr' f z = 'Prelude.foldr' f z . 'toList'@\nfoldr :: (a -&gt; b -&gt; b) -&gt; b -&gt; t a -&gt; b\nfoldr f z t = appEndo (foldMap (Endo #. f) t) z\n</code></pre>\n"}, {"tags": ["css", "haskell", "pandoc", "css-tables"], "comments": [{"owner": {"reputation": 31243, "user_id": 2751851, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/4ddc0.png?s=128&g=1", "display_name": "duplode", "link": "https://stackoverflow.com/users/2751851/duplode"}, "edited": false, "score": 1, "creation_date": 1439052574, "post_id": 31896140, "comment_id": 51707928, "body": "Blunderbuss suggestion: I often use <a href=\"https://hackage.haskell.org/package/tagsoup\" rel=\"nofollow noreferrer\">tagsoup</a> to post-process HTML output from Pandoc."}, {"owner": {"reputation": 6604, "user_id": 880772, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/uu3qs.png?s=128&g=1", "display_name": "approxiblue", "link": "https://stackoverflow.com/users/880772/approxiblue"}, "edited": false, "score": 2, "creation_date": 1439059560, "post_id": 31896140, "comment_id": 51710060, "body": "I don&#39;t think it&#39;s possible at this point. There&#39;s an ongoing discussion <a href=\"https://github.com/jgm/pandoc/issues/684\" rel=\"nofollow noreferrer\">here</a>."}], "owner": {"reputation": 3644, "user_id": 1465116, "user_type": "registered", "accept_rate": 80, "profile_image": "https://www.gravatar.com/avatar/1987d0ba73cb23a47a25dbfe0b36106e?s=128&d=identicon&r=PG", "display_name": "Athan Clark", "link": "https://stackoverflow.com/users/1465116/athan-clark"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 384, "favorite_count": 0, "answer_count": 0, "score": 1, "last_activity_date": 1439051498, "creation_date": 1439051498, "question_id": 31896140, "link": "https://stackoverflow.com/questions/31896140/change-the-classes-of-table-nodes-generated-from-pandoc", "title": "Change the classes of &lt;table&gt; nodes generated from Pandoc", "body": "<p>I see there's a syntax for <a href=\"http://pandoc.org/demo/example9/pandocs-markdown.html\" rel=\"nofollow\">adding different attributes</a> (under \"Header Identifiers in HTML...\") to various markdown constructs, like headers and blockquotes. Could the same be accomplished for tables?</p>\n\n<p>I looked through <a href=\"http://hackage.haskell.org/package/pandoc-1.15.0.6/docs/Text-Pandoc-Options.html#t:Extension\" rel=\"nofollow\">the extensions</a> and <a href=\"http://hackage.haskell.org/package/pandoc-1.15.0.6/docs/Text-Pandoc-Options.html#t:WriterOptions\" rel=\"nofollow\">other options</a> for configuring Pandoc, but couldn't find something suitable to change how Pandoc adds classes to its nodes.</p>\n"}, {"tags": ["haskell", "msgpack"], "answers": [{"comments": [{"owner": {"reputation": 965, "user_id": 1380313, "user_type": "registered", "accept_rate": 60, "profile_image": "https://www.gravatar.com/avatar/52f94da0fff6451c17a6199ef511f985?s=128&d=identicon&r=PG", "display_name": "ManzMoody", "link": "https://stackoverflow.com/users/1380313/manzmoody"}, "edited": false, "score": 0, "creation_date": 1467560813, "post_id": 31894075, "comment_id": 63770301, "body": "Could you please provide some sample code how to do this exactly?"}], "tags": [], "owner": {"reputation": 49959, "user_id": 866915, "user_type": "registered", "accept_rate": 70, "profile_image": "https://www.gravatar.com/avatar/09242131d6e17cbbe31e8547514da6e5?s=128&d=identicon&r=PG", "display_name": "ErikR", "link": "https://stackoverflow.com/users/866915/erikr"}, "is_accepted": true, "score": 3, "last_activity_date": 1467562489, "last_edit_date": 1467562489, "creation_date": 1439043973, "answer_id": 31894075, "question_id": 31892857, "link": "https://stackoverflow.com/questions/31892857/how-to-derive-instances-of-data-messagepack-1-0-0/31894075#31894075", "title": "How to derive instances of Data.Messagepack 1.0.0", "body": "<p>As a stop-gap measure, have a look at the <code>msgpack-aeson</code> directory of the <code>message-pack</code> github repo:</p>\n\n<p><a href=\"https://github.com/msgpack/msgpack-haskell/tree/master/msgpack-aeson\" rel=\"nofollow\">https://github.com/msgpack/msgpack-haskell/tree/master/msgpack-aeson</a></p>\n\n<p>You could go from your data values &lt;-> aeson &lt;-> message-pack. Not necessarily efficient, but convenient since you can auto derive ToJSON and FromJSON with <code>DeriveGeneric</code>.</p>\n\n<p>Example code:</p>\n\n<pre><code>{-# LANGUAGE DeriveGeneric, OverloadedStrings #-}\n\nimport Data.MessagePack.Aeson\nimport qualified Data.MessagePack as MP\nimport GHC.Generics\nimport Data.Aeson\n\ndata Foo = Foo { _a :: Int, _b :: String }\n  deriving (Generic)\n\ninstance ToJSON Foo\ninstance FromJSON Foo\n\ntoMsgPack :: Foo  -&gt; Maybe MP.Object\ntoMsgPack =   decode . encode\n\ntest = toMsgPack (Foo 3 \"asd\")\n</code></pre>\n"}, {"comments": [{"owner": {"reputation": 3832, "user_id": 2553416, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/3cb1756924bd03cc01d107852dd81acf?s=128&d=identicon&r=PG", "display_name": "LogicChains", "link": "https://stackoverflow.com/users/2553416/logicchains"}, "edited": false, "score": 0, "creation_date": 1439054976, "post_id": 31896139, "comment_id": 51708650, "body": "Unfortunately it&#39;s for operation with a program written in another language that doesn&#39;t even support sum types, so their lack isn&#39;t a significant concern in this case."}, {"owner": {"reputation": 23444, "user_id": 414413, "user_type": "registered", "accept_rate": 79, "profile_image": "https://www.gravatar.com/avatar/6de2113f01432aa844dc85070ff33e89?s=128&d=identicon&r=PG", "display_name": "Cirdec", "link": "https://stackoverflow.com/users/414413/cirdec"}, "reply_to_user": {"reputation": 3832, "user_id": 2553416, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/3cb1756924bd03cc01d107852dd81acf?s=128&d=identicon&r=PG", "display_name": "LogicChains", "link": "https://stackoverflow.com/users/2553416/logicchains"}, "edited": false, "score": 0, "creation_date": 1440050173, "post_id": 31896139, "comment_id": 52114588, "body": "The generic classes I didn&#39;t write for this will be the answer to <a href=\"http://stackoverflow.com/q/32107706/414413\">stackoverflow.com/q/32107706/414413</a>"}], "tags": [], "owner": {"reputation": 23444, "user_id": 414413, "user_type": "registered", "accept_rate": 79, "profile_image": "https://www.gravatar.com/avatar/6de2113f01432aa844dc85070ff33e89?s=128&d=identicon&r=PG", "display_name": "Cirdec", "link": "https://stackoverflow.com/users/414413/cirdec"}, "is_accepted": false, "score": 2, "last_activity_date": 1439051496, "creation_date": 1439051496, "answer_id": 31896139, "question_id": 31892857, "link": "https://stackoverflow.com/questions/31892857/how-to-derive-instances-of-data-messagepack-1-0-0/31896139#31896139", "title": "How to derive instances of Data.Messagepack 1.0.0", "body": "<p>You could write your own <code>GMessagePack</code> class and get instances by deriving <code>Generic</code>. I tried doing so to answer this question, but I can't recommend it.  msgpack has no support for sums, and the <a href=\"https://hackage.haskell.org/package/msgpack-1.0.0/docs/src/Data-MessagePack-Object.html#instance%20MessagePack%20(Maybe%20a)\" rel=\"nofollow\">one sum type supported by the Haskell msgpack library, <code>Maybe</code></a>, has a very poor encoding.</p>\n\n<pre><code>instance MessagePack a =&gt; MessagePack (Maybe a) where\n  toObject = \\case\n    Just a  -&gt; toObject a\n    Nothing -&gt; ObjectNil\n\n  fromObject = \\case\n    ObjectNil -&gt; Just Nothing\n    obj -&gt; fromObject obj\n</code></pre>\n\n<p>The encoding for <code>Maybe</code>s can't tell the difference between <code>Nothing :: Maybe (Maybe a)</code> and <code>Just Nothing :: Maybe (Maybe a)</code>, both will be encoded as <code>ObjectNil</code> and decoded as <code>Nothing</code>. If we were to impose on <code>MessagePack</code> instances the obvious law <code>fromObject . toObject == pure</code>, this instance for <code>MessagePack</code> would violate it.</p>\n"}], "owner": {"reputation": 3832, "user_id": 2553416, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/3cb1756924bd03cc01d107852dd81acf?s=128&d=identicon&r=PG", "display_name": "LogicChains", "link": "https://stackoverflow.com/users/2553416/logicchains"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 130, "favorite_count": 0, "accepted_answer_id": 31894075, "answer_count": 2, "score": 1, "last_activity_date": 1467562489, "creation_date": 1439034930, "question_id": 31892857, "link": "https://stackoverflow.com/questions/31892857/how-to-derive-instances-of-data-messagepack-1-0-0", "title": "How to derive instances of Data.Messagepack 1.0.0", "body": "<p>The previous version of <code>Data.Messagepack</code>, <a href=\"https://hackage.haskell.org/package/msgpack-0.7.2.5\" rel=\"nofollow\">0.7.2.5</a> supports <a href=\"https://hackage.haskell.org/package/msgpack-0.7.2.5/docs/Data-MessagePack-Derive.html\" rel=\"nofollow\">deriving instances via Template Haskell</a>. The current version (1.0.0), however, <a href=\"https://hackage.haskell.org/package/msgpack-1.0.0\" rel=\"nofollow\">doesn't</a>.</p>\n\n<p>I was hence wondering if there is an alternative way to automatically derive MessagePack 1.0.0 instances, possibly using <code>XDeriveGeneric</code>?</p>\n"}, {"tags": ["haskell", "random", "state-monad"], "comments": [{"owner": {"reputation": 60057, "user_id": 1333025, "user_type": "registered", "accept_rate": 65, "profile_image": "https://www.gravatar.com/avatar/79ab43010f900324ac5e2de19a2916cb?s=128&d=identicon&r=PG", "display_name": "Petr", "link": "https://stackoverflow.com/users/1333025/petr"}, "edited": false, "score": 0, "creation_date": 1439035650, "post_id": 31892418, "comment_id": 51702471, "body": "See also <a href=\"http://stackoverflow.com/q/31892418/1333025\">Why the Haskell sequence function can&#39;t be lazy or why recursive monadic functions can&#39;t be lazy</a>.."}], "answers": [{"comments": [{"owner": {"reputation": 100185, "user_id": 3234959, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/93bb12ca0f93dfddb33880316f7e66c2?s=128&d=identicon&r=PG&f=1", "display_name": "chi", "link": "https://stackoverflow.com/users/3234959/chi"}, "edited": false, "score": 1, "creation_date": 1439035775, "post_id": 31892518, "comment_id": 51702506, "body": "Or even <code>replicateM n rand</code>"}, {"owner": {"reputation": 513, "user_id": 3402332, "user_type": "registered", "accept_rate": 73, "profile_image": "https://graph.facebook.com/1497014347/picture?type=large", "display_name": "overlii", "link": "https://stackoverflow.com/users/3402332/overlii"}, "edited": false, "score": 0, "creation_date": 1439036625, "post_id": 31892518, "comment_id": 51702744, "body": "Great, thanks for the explanation and the correct solution!"}, {"owner": {"reputation": 513, "user_id": 3402332, "user_type": "registered", "accept_rate": 73, "profile_image": "https://graph.facebook.com/1497014347/picture?type=large", "display_name": "overlii", "link": "https://stackoverflow.com/users/3402332/overlii"}, "edited": false, "score": 0, "creation_date": 1439037843, "post_id": 31892518, "comment_id": 51703055, "body": "Now I can do antialiazing :) Next question is, can I use this State Monad in parallel? Or would it be better to have on state per thread? Might be for another week end :)"}, {"owner": {"reputation": 17809, "user_id": 1088108, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/63781cd38e91aa346a3849bc3ef3e550?s=128&d=identicon&r=PG&f=1", "display_name": "&#216;rjan Johansen", "link": "https://stackoverflow.com/users/1088108/%c3%98rjan-johansen"}, "reply_to_user": {"reputation": 513, "user_id": 3402332, "user_type": "registered", "accept_rate": 73, "profile_image": "https://graph.facebook.com/1497014347/picture?type=large", "display_name": "overlii", "link": "https://stackoverflow.com/users/3402332/overlii"}, "edited": false, "score": 0, "creation_date": 1439038624, "post_id": 31892518, "comment_id": 51703301, "body": "@olivelarouille If you want to do random numbers in parallel, you can look at the <code>split</code> function, which lets you turn one generator into several. (Which BTW could have given an alternative solution to your original problem.)"}], "tags": [], "owner": {"reputation": 17809, "user_id": 1088108, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/63781cd38e91aa346a3849bc3ef3e550?s=128&d=identicon&r=PG&f=1", "display_name": "&#216;rjan Johansen", "link": "https://stackoverflow.com/users/1088108/%c3%98rjan-johansen"}, "is_accepted": true, "score": 5, "last_activity_date": 1439032915, "last_edit_date": 1439032915, "creation_date": 1439032549, "answer_id": 31892518, "question_id": 31892418, "link": "https://stackoverflow.com/questions/31892418/random-number-sequence-un-haskell-and-state-monad-what-am-i-doing-wrong/31892518#31892518", "title": "Random number sequence un Haskell and State Monad, what am I doing wrong?", "body": "<p><code>uniform01</code> threads your state through an <em>infinite</em> number of computations, which means that although it produces its <em>result</em> lazily, there is no hope of retrieving a final <em>state</em> at the end to use for the next sampling. <code>liftM (take n)</code> only affects the final value, not the state effects used to compute it.  Therefore as written, you can only use <code>uniform01</code>/<code>sampleUniform</code> once.</p>\n\n<p>Instead you can thread the state through only as many <code>rand</code> actions as you use, e.g. with</p>\n\n<pre><code>sampleUniform n = mapM (\\_ -&gt; rand) $ replicate n ()\n</code></pre>\n\n<p>or simpler</p>\n\n<pre><code>sampleUniform n = sequence $ replicate n rand\n</code></pre>\n"}], "owner": {"reputation": 513, "user_id": 3402332, "user_type": "registered", "accept_rate": 73, "profile_image": "https://graph.facebook.com/1497014347/picture?type=large", "display_name": "overlii", "link": "https://stackoverflow.com/users/3402332/overlii"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 230, "favorite_count": 0, "accepted_answer_id": 31892518, "answer_count": 1, "score": 5, "last_activity_date": 1439032915, "creation_date": 1439031764, "last_edit_date": 1495542583, "question_id": 31892418, "link": "https://stackoverflow.com/questions/31892418/random-number-sequence-un-haskell-and-state-monad-what-am-i-doing-wrong", "title": "Random number sequence un Haskell and State Monad, what am I doing wrong?", "body": "<p>As part of my Haskell journey, I am implementing a raytracer and I need to be able to draw sequences of random numbers at several places in the code. Typically I would like to be able to get say 64 samples for each pixels and pixels are computed in parallel.</p>\n\n<p>I was looking at the state monad to achieve that and I was guided by this answer <a href=\"https://stackoverflow.com/questions/2110535/sampling-sequences-of-random-numbers-in-haskell?answertab=votes#tab-top\">Sampling sequences of random numbers in Haskell</a> but the code I wrote does not terminate and it's memory consumption explodes.</p>\n\n<p>Here is the abstracted part of the code:\nI was hopping to be able to call <code>sampleUniform</code> several time in the code to get new lists of random numbers but if I do <code>runhaskell test.hs</code>, it outputs the first character of the lis <code>[</code> and then it is stuck in an apparently infinite loop.</p>\n\n<pre><code>module Main (main\n            , computeArray) where\n\nimport Control.Monad\nimport Control.Monad.State (State, evalState, get, put)\nimport System.Random (StdGen, mkStdGen, random)\nimport Control.Applicative ((&lt;$&gt;))\n\ntype Rnd a = State StdGen a\n\nrunRandom :: Rnd a -&gt; Int -&gt; a\nrunRandom action seed = evalState action $ mkStdGen seed\n\nrand :: Rnd Double\nrand = do\n  gen &lt;- get\n  let (r, gen') = random gen\n  put gen'\n  return r\n\n{- Uniform distributions -}\nuniform01 :: Rnd [Double]\nuniform01 = mapM (\\_ -&gt; rand) $ repeat ()\n\n{- Get n samples uniformly distributed between 0 and 1 -}\nsampleUniform :: Int -&gt; Rnd [Double]\nsampleUniform n = liftM (take n) uniform01\n\ncomputeArray :: Rnd [Bool]\ncomputeArray = do\n  samples1 &lt;- sampleUniform 10\n  samples2 &lt;- sampleUniform 10\n  let dat = zip samples1 samples2\n  return $ uncurry (&lt;) &lt;$&gt; dat\n\nmain :: IO ()\nmain = do\n  let seed = 48\n  let res = runRandom computeArray seed\n  putStrLn $ show res\n</code></pre>\n"}, {"tags": ["haskell", "streaming", "haskell-snap-framework"], "comments": [{"owner": {"reputation": 60057, "user_id": 1333025, "user_type": "registered", "accept_rate": 65, "profile_image": "https://www.gravatar.com/avatar/79ab43010f900324ac5e2de19a2916cb?s=128&d=identicon&r=PG", "display_name": "Petr", "link": "https://stackoverflow.com/users/1333025/petr"}, "edited": false, "score": 0, "creation_date": 1439030940, "post_id": 31891826, "comment_id": 51701180, "body": "That sounds strange. In a standard setup the underlying transport layer for HTTP is TCP, which ensures reliable delivery. To quote <a href=\"https://en.wikipedia.org/w/index.php?title=Transmission_Control_Protocol&amp;oldid=674796728#Flow_control\" rel=\"nofollow noreferrer\">the Wikipedia article</a> <i>&quot;TCP uses an end-to-end flow control protocol to avoid having the sender send data too fast for the TCP receiver to receive and process it reliably.&quot;</i>"}, {"owner": {"reputation": 464, "user_id": 3825556, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/7ajzp.png?s=128&g=1", "display_name": "Cirquit", "link": "https://stackoverflow.com/users/3825556/cirquit"}, "reply_to_user": {"reputation": 60057, "user_id": 1333025, "user_type": "registered", "accept_rate": 65, "profile_image": "https://www.gravatar.com/avatar/79ab43010f900324ac5e2de19a2916cb?s=128&d=identicon&r=PG", "display_name": "Petr", "link": "https://stackoverflow.com/users/1333025/petr"}, "edited": false, "score": 0, "creation_date": 1439034776, "post_id": 31891826, "comment_id": 51702241, "body": "I thought so too, but the only thing I see is the loss of data and I just can get behind why this comes up. Could it be that the driver for the WiFi shield doesn&#39;t implement TCP the way you described?"}, {"owner": {"reputation": 49959, "user_id": 866915, "user_type": "registered", "accept_rate": 70, "profile_image": "https://www.gravatar.com/avatar/09242131d6e17cbbe31e8547514da6e5?s=128&d=identicon&r=PG", "display_name": "ErikR", "link": "https://stackoverflow.com/users/866915/erikr"}, "edited": false, "score": 0, "creation_date": 1439044061, "post_id": 31891826, "comment_id": 51704786, "body": "You could rewrite the Arduino code to make multiple GET calls with a <code>Range:</code> header."}, {"owner": {"reputation": 60057, "user_id": 1333025, "user_type": "registered", "accept_rate": 65, "profile_image": "https://www.gravatar.com/avatar/79ab43010f900324ac5e2de19a2916cb?s=128&d=identicon&r=PG", "display_name": "Petr", "link": "https://stackoverflow.com/users/1333025/petr"}, "edited": false, "score": 0, "creation_date": 1439053712, "post_id": 31891826, "comment_id": 51708275, "body": "@Cirquit Before trying to implement some throttling solution, I&#39;d advise to try to get deeper in the source of the problem. In particular, to use a tool like <a href=\"https://en.wikipedia.org/wiki/Wireshark\" rel=\"nofollow noreferrer\">Wireshark</a> or <a href=\"https://en.wikipedia.org/wiki/Tcpdump\" rel=\"nofollow noreferrer\">tcpdump</a> and observe what is happening, what the network traffic look like, if all data is delivered etc. Otherwise your workaround can just mask another issue that will come back to bite you later."}, {"owner": {"reputation": 464, "user_id": 3825556, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/7ajzp.png?s=128&g=1", "display_name": "Cirquit", "link": "https://stackoverflow.com/users/3825556/cirquit"}, "edited": false, "score": 0, "creation_date": 1439056260, "post_id": 31891826, "comment_id": 51709058, "body": "I found the error in my code. Unfortunately it opened up another problem where a possible solution would be to limit the fragement-size from the tcp. The problem lies in the Arduino Mega which has only 2KB Ram - but the fragments I get are almost always between 4KB. Even if I could sometimes save the incoming data, if i want to search or split it, the Arduino just stops everything."}], "answers": [{"comments": [{"owner": {"reputation": 464, "user_id": 3825556, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/7ajzp.png?s=128&g=1", "display_name": "Cirquit", "link": "https://stackoverflow.com/users/3825556/cirquit"}, "edited": false, "score": 0, "creation_date": 1439052804, "post_id": 31895306, "comment_id": 51707998, "body": "I don&#39;t know any python, but I will try my best to get this running. Going to report / accept it as soon I get some results!"}, {"owner": {"reputation": 464, "user_id": 3825556, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/7ajzp.png?s=128&g=1", "display_name": "Cirquit", "link": "https://stackoverflow.com/users/3825556/cirquit"}, "edited": false, "score": 0, "creation_date": 1439058455, "post_id": 31895306, "comment_id": 51709732, "body": "Unfortunately I didn&#39;t see any change, even when I manipulated delay / packetsize. I modified the <code>on_recv</code> so it would split the incoming data in chunks via my delimiter <code>*</code> and then while iterating the list I used <code>time.sleep(1)</code> after every send. It should&#39;ve waited 1 second after every chunk, but it didn&#39;t :( <a href=\"http://lpaste.net/138291\" rel=\"nofollow noreferrer\">lpaste.net/138291</a>"}, {"owner": {"reputation": 464, "user_id": 3825556, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/7ajzp.png?s=128&g=1", "display_name": "Cirquit", "link": "https://stackoverflow.com/users/3825556/cirquit"}, "edited": false, "score": 0, "creation_date": 1439065302, "post_id": 31895306, "comment_id": 51711510, "body": "Ok I got it! I added a custom delimiter so the &quot;GET&quot; request doesn&#39;t get splitted with my data. <a href=\"http://lpaste.net/138292\" rel=\"nofollow noreferrer\">lpaste.net/138292</a>"}], "tags": [], "owner": {"reputation": 49959, "user_id": 866915, "user_type": "registered", "accept_rate": 70, "profile_image": "https://www.gravatar.com/avatar/09242131d6e17cbbe31e8547514da6e5?s=128&d=identicon&r=PG", "display_name": "ErikR", "link": "https://stackoverflow.com/users/866915/erikr"}, "is_accepted": true, "score": 0, "last_activity_date": 1439046112, "creation_date": 1439046112, "answer_id": 31895306, "question_id": 31891826, "link": "https://stackoverflow.com/questions/31891826/how-to-delay-the-outcoming-data-stream-in-snap/31895306#31895306", "title": "How to delay the outcoming data stream in Snap", "body": "<p>I would insert a proxy server to throttle the data.</p>\n\n<p>Here is a simple proxy written in 100 lines of Python which would be easy to modify to add output delays:</p>\n\n<p><a href=\"http://voorloopnul.com/blog/a-python-proxy-in-less-than-100-lines-of-code/\" rel=\"nofollow\">http://voorloopnul.com/blog/a-python-proxy-in-less-than-100-lines-of-code/</a></p>\n"}], "owner": {"reputation": 464, "user_id": 3825556, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/7ajzp.png?s=128&g=1", "display_name": "Cirquit", "link": "https://stackoverflow.com/users/3825556/cirquit"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 89, "favorite_count": 0, "accepted_answer_id": 31895306, "answer_count": 1, "score": 0, "last_activity_date": 1439046112, "creation_date": 1439027335, "question_id": 31891826, "link": "https://stackoverflow.com/questions/31891826/how-to-delay-the-outcoming-data-stream-in-snap", "title": "How to delay the outcoming data stream in Snap", "body": "<p>I can send GET requests via a WiFi shield (ESP8266) on an Arduino Mega and I have a Snap-Webserver running, that serves a static directory with large .txt-Files (~ 1 MB).</p>\n\n<p>Unfortunately, I can't parse the incoming data with an Arduino as fast as it gets send. I lose around ~ 50% of the incoming data.</p>\n\n<p>Is there a possibility to configure Snap that it would delay the outcoming stream of data? It would be perfect if I could tell Snap to wait ~ 10 ms after a delimiter in the .txt-file ('\\n' for example).</p>\n"}, {"tags": ["haskell", "ghc"], "comments": [{"owner": {"reputation": 31243, "user_id": 2751851, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/4ddc0.png?s=128&g=1", "display_name": "duplode", "link": "https://stackoverflow.com/users/2751851/duplode"}, "edited": false, "score": 9, "creation_date": 1439004242, "post_id": 31889048, "comment_id": 51696008, "body": "<a href=\"https://git.haskell.org/ghc.git/commitdiff/c32bb5d0c09a7e55197191f152c6875b398717cf\" rel=\"nofollow noreferrer\">&quot;Remember to zonk the skolems of an implication&quot;</a> is so euphonic!"}, {"owner": {"reputation": 34864, "user_id": 237428, "user_type": "registered", "accept_rate": 78, "profile_image": "https://i.stack.imgur.com/ThNhZ.jpg?s=128&g=1", "display_name": "Antal Spector-Zabusky", "link": "https://stackoverflow.com/users/237428/antal-spector-zabusky"}, "edited": false, "score": 6, "creation_date": 1439008698, "post_id": 31889048, "comment_id": 51696697, "body": "&quot;Zonking walks over a type, returning a new type in which unification variables are replaced by the types they unified to.&quot; \u2014<a href=\"https://mail.haskell.org/pipermail/glasgow-haskell-users/2013-August/024209.html\" rel=\"nofollow noreferrer\">an email written Simon Peyton-Jones</a>.  I don&#39;t remember enough about it to leave a more helpful answer than that, though."}], "answers": [{"tags": [], "owner": {"reputation": 25144, "user_id": 477476, "user_type": "registered", "accept_rate": 85, "profile_image": "https://i.stack.imgur.com/Qf4TT.png?s=128&g=1", "display_name": "Cactus", "link": "https://stackoverflow.com/users/477476/cactus"}, "is_accepted": true, "score": 32, "last_activity_date": 1449026387, "last_edit_date": 1449026387, "creation_date": 1439018628, "answer_id": 31890743, "question_id": 31889048, "link": "https://stackoverflow.com/questions/31889048/what-does-the-ghc-source-mean-by-zonk/31890743#31890743", "title": "What does the GHC source mean by &quot;zonk&quot;?", "body": "<p>An un-zonked type can have type variables which are mutable references filled in during unification (and this mutability is heavily used by the type checker to increase performance). Zonking traverses a type and replaces all mutable references with the type that they dereference to; thus, the resulting structure is immutable and requires no dereferencing to interpret.</p>\n\n<p>Note that these type variables are <em>meta</em>-variables, i.e. they don't correspond to the type variables introduced by polymorphism; rather, they are unification variables to be replaced by real types. The choice of replacement is decided by the type checking/type inference process, and then the actual replacement is done during zonking.</p>\n\n<p>This notion of zonking extends naturally to other intermediate representations of the typechecker that contain types.</p>\n"}], "owner": {"reputation": 13699, "user_id": 11173, "user_type": "registered", "accept_rate": 77, "profile_image": "https://www.gravatar.com/avatar/6b5276e65cb7a7417188c9a035953cee?s=128&d=identicon&r=PG", "display_name": "Doug McClean", "link": "https://stackoverflow.com/users/11173/doug-mcclean"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 1135, "favorite_count": 8, "accepted_answer_id": 31890743, "answer_count": 1, "score": 41, "last_activity_date": 1449026387, "creation_date": 1439001117, "question_id": 31889048, "link": "https://stackoverflow.com/questions/31889048/what-does-the-ghc-source-mean-by-zonk", "title": "What does the GHC source mean by &quot;zonk&quot;?", "body": "<p>I'm working on a plugin for GHC, so I'm reading the documentation for some of its implementation.</p>\n\n<p>The verb \"to zonk\" is all over the place, but I can't track down an explanation of what it means to zonk something or (in broad terms) when one might want to. I can find plenty of notes about complicated circumstances under which it is necessary to zonk or not to zonk something, but without a clue as to what the big picture is I am having a lot of trouble following.</p>\n"}, {"tags": ["haskell"], "comments": [{"owner": {"reputation": 1953, "user_id": 899723, "user_type": "registered", "accept_rate": 86, "profile_image": "https://www.gravatar.com/avatar/f68bcc2d6f5196fa090d578eb8356b9c?s=128&d=identicon&r=PG", "display_name": "mac10688", "link": "https://stackoverflow.com/users/899723/mac10688"}, "reply_to_user": {"reputation": 14485, "user_id": 190376, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/cd8280c5e1491b8cf55760750ed97dec?s=128&d=identicon&r=PG", "display_name": "Reid Barton", "link": "https://stackoverflow.com/users/190376/reid-barton"}, "edited": false, "score": 0, "creation_date": 1438998906, "post_id": 31888795, "comment_id": 51695206, "body": "I wish you would have made that the answer so I could give the an answer and a vote up. Thanks though! That did the trick"}, {"owner": {"reputation": 44013, "user_id": 1477667, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/trgKM.jpg?s=128&g=1", "display_name": "dfeuer", "link": "https://stackoverflow.com/users/1477667/dfeuer"}, "edited": false, "score": 0, "creation_date": 1441325087, "post_id": 31888795, "comment_id": 52644825, "body": "You should seriously consider setting up Haskell mode and related bits in emacs. It&#39;s a bit annoying to get it all working, but once you do, you can get really quick feedback on syntax errors, type errors, style problems caught by HLint, and of course GHCi (preferably cabal repl) on the side."}, {"owner": {"reputation": 1953, "user_id": 899723, "user_type": "registered", "accept_rate": 86, "profile_image": "https://www.gravatar.com/avatar/f68bcc2d6f5196fa090d578eb8356b9c?s=128&d=identicon&r=PG", "display_name": "mac10688", "link": "https://stackoverflow.com/users/899723/mac10688"}, "edited": false, "score": 0, "creation_date": 1441331624, "post_id": 31888795, "comment_id": 52646994, "body": "I get that with VIM right now. Using Tmux + Vim. I&#39;m sure emacs is great, I see a lot of good devs using it. But I can&#39;t afford the time right now to switch editors again. Thanks for the suggestion though."}], "answers": [{"tags": [], "owner": {"reputation": 75362, "user_id": 625403, "user_type": "registered", "accept_rate": 82, "profile_image": "https://www.gravatar.com/avatar/786eed7da67079cb5d63a49d469af25b?s=128&d=identicon&r=PG", "display_name": "amalloy", "link": "https://stackoverflow.com/users/625403/amalloy"}, "is_accepted": true, "score": 5, "last_activity_date": 1439023635, "last_edit_date": 1439023635, "creation_date": 1439000227, "answer_id": 31888975, "question_id": 31888795, "link": "https://stackoverflow.com/questions/31888795/haskell-top-level-functions/31888975#31888975", "title": "Haskell Top Level Functions", "body": "<p>You don't need more boilerplate, but less! Just don't put the <code>let</code> in - that's used for GHCI, not for .hs files. It's also nice to add type annotations in source files, even though those are usually omitted in GHCI.</p>\n\n<pre><code>f1 :: a -&gt; a\nf1 x = x\n</code></pre>\n"}], "owner": {"reputation": 1953, "user_id": 899723, "user_type": "registered", "accept_rate": 86, "profile_image": "https://www.gravatar.com/avatar/f68bcc2d6f5196fa090d578eb8356b9c?s=128&d=identicon&r=PG", "display_name": "mac10688", "link": "https://stackoverflow.com/users/899723/mac10688"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 573, "favorite_count": 0, "accepted_answer_id": 31888975, "answer_count": 1, "score": 1, "last_activity_date": 1441311887, "creation_date": 1438998129, "last_edit_date": 1441311887, "question_id": 31888795, "link": "https://stackoverflow.com/questions/31888795/haskell-top-level-functions", "title": "Haskell Top Level Functions", "body": "<p>I have a Haskell file open on the left side of my screen and ghci on the other half. I want to add functions to the file, save, and experiment with them in ghci. The problem is that I'm not totally sure how to declare top level functions. I'm not even sure I know what top level functions are. I figure they are just functions at the highest level of scope. So my question is what is the minimalist way to do this? For example...</p>\n\n<pre><code>let f1 x = x\n</code></pre>\n\n<p>What boilerplate code do I need to surround this with to make it compile so I can load it in ghci?</p>\n"}, {"tags": ["haskell", "type-inference", "typeclass"], "answers": [{"comments": [{"owner": {"reputation": 31243, "user_id": 2751851, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/4ddc0.png?s=128&g=1", "display_name": "duplode", "link": "https://stackoverflow.com/users/2751851/duplode"}, "edited": false, "score": 2, "creation_date": 1438998128, "post_id": 31888761, "comment_id": 51695057, "body": "Detail: you have to specify the type as long as nothing else does it for you (cf. the first example in the question, which works fine)."}, {"owner": {"reputation": 44013, "user_id": 1477667, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/trgKM.jpg?s=128&g=1", "display_name": "dfeuer", "link": "https://stackoverflow.com/users/1477667/dfeuer"}, "edited": false, "score": 0, "creation_date": 1455221786, "post_id": 31888761, "comment_id": 58405536, "body": "The first example only works because of numeric defaulting."}], "tags": [], "owner": {"reputation": 2875, "user_id": 2299477, "user_type": "registered", "accept_rate": 31, "profile_image": "https://i.stack.imgur.com/xppB7.jpg?s=128&g=1", "display_name": "Alaya", "link": "https://stackoverflow.com/users/2299477/alaya"}, "is_accepted": true, "score": 3, "last_activity_date": 1439004720, "last_edit_date": 1439004720, "creation_date": 1438997692, "answer_id": 31888761, "question_id": 31888700, "link": "https://stackoverflow.com/questions/31888700/why-cant-read-deduce-the-correct-type/31888761#31888761", "title": "Why can&#39;t read deduce the correct type?", "body": "<p>As <code>read</code> is a polymorphic function, the <code>read \"3\" + 4</code> works because the compiler know you want a <code>Num</code> because you applied <code>+</code> to <code>read \"3\"</code>, If the compiler can't figure out what you want, you have to specify type of <code>read</code>, like this:</p>\n\n<pre><code>Prelude&gt; let rd = read :: String-&gt;(Int,Int)\nPrelude&gt; rd \"(1,2)\"\n</code></pre>\n"}, {"comments": [{"owner": {"reputation": 31243, "user_id": 2751851, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/4ddc0.png?s=128&g=1", "display_name": "duplode", "link": "https://stackoverflow.com/users/2751851/duplode"}, "edited": false, "score": 0, "creation_date": 1439000450, "post_id": 31888873, "comment_id": 51695469, "body": "By &quot;Only after computing, Haskell can know its type&quot;, do you mean that you need to use the value so that the compiler can figure out the type?"}], "tags": [], "owner": {"reputation": 4406, "user_id": 3741571, "user_type": "registered", "accept_rate": 2, "profile_image": "https://i.stack.imgur.com/0WXuV.jpg?s=128&g=1", "display_name": "chenzhongpu", "link": "https://stackoverflow.com/users/3741571/chenzhongpu"}, "is_accepted": false, "score": 1, "last_activity_date": 1439000104, "last_edit_date": 1439000104, "creation_date": 1438999123, "answer_id": 31888873, "question_id": 31888700, "link": "https://stackoverflow.com/questions/31888700/why-cant-read-deduce-the-correct-type/31888873#31888873", "title": "Why can&#39;t read deduce the correct type?", "body": "<p>First, let's see the type signature of <code>read</code>:</p>\n\n<pre><code>Prelude&gt; :t read\nread :: Read a =&gt; String -&gt; a\n</code></pre>\n\n<p>As you can see, its return value must have a type of the <code>Read</code> typeclass. However, if we don't use the value the complier won't know what type it is.</p>\n\n<p>In such cases, we can add <code>::</code> to specify its type.</p>\n\n<pre><code>Prelude&gt; read \"5\"\n*** Exception: Prelude.read: no parse\nPrelude&gt; read \"5\" :: Int\n5\n</code></pre>\n\n<p>Similarly, </p>\n\n<pre><code>Prelude&gt; read \"(1, 2)\"\n*** Exception: Prelude.read: no parse\nPrelude&gt; read \"(1, 2)\" :: (Int, Int)\n(1,2)\nPrelude&gt; fst (read \"(1,2)\" :: (Int, Int))\n1\n</code></pre>\n\n<p>The compiler can deduce the types most of the time, but when it meets <code>read \"5\"</code>, it may get confused about whether the type should be <code>Int</code> or <code>Float</code> or anything else. Only after computing, Haskell can know its type. On the other hand, Haskell has static types, so <strong>it has to know all type before compiling</strong>.</p>\n"}], "owner": {"reputation": 154069, "user_id": 260127, "user_type": "registered", "accept_rate": 93, "profile_image": "https://www.gravatar.com/avatar/74758c702067a3490094451e475e28c5?s=128&d=identicon&r=PG", "display_name": "prosseek", "link": "https://stackoverflow.com/users/260127/prosseek"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 207, "favorite_count": 1, "accepted_answer_id": 31888761, "answer_count": 2, "score": 2, "last_activity_date": 1455175097, "creation_date": 1438997010, "last_edit_date": 1455175097, "question_id": 31888700, "link": "https://stackoverflow.com/questions/31888700/why-cant-read-deduce-the-correct-type", "title": "Why can&#39;t read deduce the correct type?", "body": "<p>In Haskell, I can make Haskell value from a string with <code>read</code>.</p>\n\n<pre><code>Prelude&gt; read \"1\" + 3\n4\n</code></pre>\n\n<p>I can use <code>fst</code> to get the first element</p>\n\n<pre><code>Prelude&gt; fst (1,2)\n1\n</code></pre>\n\n<p>However, I get an error when I combine <code>read</code> and <code>fst</code> to get the first element:</p>\n\n<pre><code>Prelude&gt; fst (read \"(1,2)\")\n\n&lt;interactive&gt;:20:6:\n    Could not deduce (Read b0) arising from a use of \u2018read\u2019\n    from the context (Read a)\n      bound by the inferred type of it :: Read a =&gt; a\n      at &lt;interactive&gt;:20:1-18\n    The type variable \u2018b0\u2019 is ambiguous\n</code></pre>\n\n<p>What's the problem?</p>\n"}, {"tags": ["haskell", "robustness"], "comments": [{"owner": {"reputation": 31243, "user_id": 2751851, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/4ddc0.png?s=128&g=1", "display_name": "duplode", "link": "https://stackoverflow.com/users/2751851/duplode"}, "edited": false, "score": 1, "creation_date": 1438993560, "post_id": 31888246, "comment_id": 51694336, "body": "(1) I believe <a href=\"http://research.microsoft.com/~simonpj/papers/verify/index.htm\" rel=\"nofollow noreferrer\">these are the papers you are looking for</a>. (2) Note that <code>printFruit</code> is unnecessary. If an user wants to display a <code>Maybe Fruit</code> she can use <code>fmap showFruit</code> and then unwrap the <code>Maybe</code> in a sensible way. That of course does not answer your question (it would be good to keep users away from <code>fromJust</code> as well!), so carry on :)"}, {"owner": {"reputation": 100185, "user_id": 3234959, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/93bb12ca0f93dfddb33880316f7e66c2?s=128&d=identicon&r=PG&f=1", "display_name": "chi", "link": "https://stackoverflow.com/users/3234959/chi"}, "edited": false, "score": 3, "creation_date": 1439020771, "post_id": 31888246, "comment_id": 51698982, "body": "I&#39;d love Haskell to have a sort of totality checker. I&#39;d even be satisfied with a no-exception checker checking for non exhaustiveness and use of partial functions, but not checking for infinite loops. I&#39;d also like to raise these kind of warnings into errors, so that I can not easily overlook them. This probably would not require a large amount of effort to implement in GHC."}, {"owner": {"reputation": 11986, "user_id": 3237465, "user_type": "registered", "accept_rate": 76, "profile_image": "https://i.stack.imgur.com/vOArX.png?s=128&g=1", "display_name": "user3237465", "link": "https://stackoverflow.com/users/3237465/user3237465"}, "edited": false, "score": 2, "creation_date": 1439022350, "post_id": 31888246, "comment_id": 51699319, "body": "Have you looked at Idris? It might be the language you want."}, {"owner": {"reputation": 57219, "user_id": 33796, "user_type": "registered", "accept_rate": 70, "profile_image": "https://www.gravatar.com/avatar/08727b23ba62e634b32988cdff082663?s=128&d=identicon&r=PG", "display_name": "luqui", "link": "https://stackoverflow.com/users/33796/luqui"}, "edited": false, "score": 1, "creation_date": 1439063104, "post_id": 31888246, "comment_id": 51711012, "body": "See also <a href=\"http://community.haskell.org/~ndm/hlint/\" rel=\"nofollow noreferrer\"><code>hlint</code></a>"}], "answers": [{"comments": [{"owner": {"reputation": 1345, "user_id": 29442, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/11f07822e8b5a23d3c58e3fb4cb57cd6?s=128&d=identicon&r=PG", "display_name": "Hannes Landeholm", "link": "https://stackoverflow.com/users/29442/hannes-landeholm"}, "edited": false, "score": 2, "creation_date": 1438996945, "post_id": 31888332, "comment_id": 51694878, "body": "You&#39;re approaching my question from the wrong angle. The example is contrived to highlight how a programmer can introduce an error path by mistake. The mistake can also be more subtle like allowing a branch where divide by zero is possible. The &quot;well, just don&#39;t make mistakes&quot; assumption makes the type system itself largely pointless. Also you&#39;re admitting yourself that the function is more dangerous, wouldn&#39;t it be useful if calls to such dangerous functions could somehow be prevented by the compiler?"}, {"owner": {"reputation": 17641, "user_id": 16800, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/ea1de76c4c343fc844135e18da8a80f1?s=128&d=identicon&r=PG", "display_name": "Guvante", "link": "https://stackoverflow.com/users/16800/guvante"}, "reply_to_user": {"reputation": 1345, "user_id": 29442, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/11f07822e8b5a23d3c58e3fb4cb57cd6?s=128&d=identicon&r=PG", "display_name": "Hannes Landeholm", "link": "https://stackoverflow.com/users/29442/hannes-landeholm"}, "edited": false, "score": 0, "creation_date": 1439022748, "post_id": 31888332, "comment_id": 51699405, "body": "@HannesLandeholm: I will expand my answer, but this isn&#39;t a case of &quot;don&#39;t make mistakes&quot; it is &quot;don&#39;t use tools that don&#39;t agree with your paradigm&quot;. If <code>fromJust</code> and its ilk could break guarentees then your argument would have merit, but <code>_|_</code> is always something that can creep up."}, {"owner": {"reputation": 57219, "user_id": 33796, "user_type": "registered", "accept_rate": 70, "profile_image": "https://www.gravatar.com/avatar/08727b23ba62e634b32988cdff082663?s=128&d=identicon&r=PG", "display_name": "luqui", "link": "https://stackoverflow.com/users/33796/luqui"}, "edited": false, "score": 2, "creation_date": 1439063082, "post_id": 31888332, "comment_id": 51711003, "body": "I recently started working on a 7 million line codebase (not in Haskell), so I put on that lens when reading OP&#39;s question.  &quot;Don&#39;t use X&quot; isn&#39;t really an acceptable solution in such a huge place.  It would be essential to have a tool check for such cases.  FWIW <a href=\"http://community.haskell.org/~ndm/hlint/\" rel=\"nofollow noreferrer\"><code>hlint</code></a> will do this if I remember right."}, {"owner": {"reputation": 17641, "user_id": 16800, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/ea1de76c4c343fc844135e18da8a80f1?s=128&d=identicon&r=PG", "display_name": "Guvante", "link": "https://stackoverflow.com/users/16800/guvante"}, "reply_to_user": {"reputation": 57219, "user_id": 33796, "user_type": "registered", "accept_rate": 70, "profile_image": "https://www.gravatar.com/avatar/08727b23ba62e634b32988cdff082663?s=128&d=identicon&r=PG", "display_name": "luqui", "link": "https://stackoverflow.com/users/33796/luqui"}, "edited": false, "score": 0, "creation_date": 1439226129, "post_id": 31888332, "comment_id": 51762884, "body": "@luqui: hlint is what I am trying to say <i>should</i> be the solution. The compiler need not and likely should not be the solution for every engineering problem."}], "tags": [], "owner": {"reputation": 17641, "user_id": 16800, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/ea1de76c4c343fc844135e18da8a80f1?s=128&d=identicon&r=PG", "display_name": "Guvante", "link": "https://stackoverflow.com/users/16800/guvante"}, "is_accepted": false, "score": 1, "last_activity_date": 1439023422, "last_edit_date": 1439023422, "creation_date": 1438993053, "answer_id": 31888332, "question_id": 31888246, "link": "https://stackoverflow.com/questions/31888246/robust-haskell-without-errors/31888332#31888332", "title": "Robust haskell without errors", "body": "<p>Your main complaint is about <code>fromJust</code>, but given it is fundamentally against what your goals are, why are you using it?</p>\n\n<p>Remember that the biggest reason for <code>error</code> is that not everything can be defined in a way that the type system can guarantee, so having a \"This can't happen, trust me\" makes sense. <code>fromJust</code> comes from this mindset of \"sometimes I know better than the compiler\". If you don't agree with that mindset don't use it. Alternatively don't abuse it like this example does.</p>\n\n<p>EDIT:</p>\n\n<p>To expand on my point, think of how you would implement what you are asking for (warnings on using partial functions). Where would the warning apply in the following code?</p>\n\n<pre><code>a = fromJust $ Just 1\nb = Just 2\nc = fromJust $ c\nd = fromJust\ne = d $ Just 3\nf = d b\n</code></pre>\n\n<p>All of these are statically not partial after all. (Sorry if this next one's syntax is off, it is late)</p>\n\n<pre><code>g x = fromJust x + 1\nh x = g x + 1\ni = h $ Just 3\nj = h $ Nothing\nk x y = if x &gt; 0 then fromJust y else x\nl = k 1 $ Just 2\nm = k (-1) $ Just 3\nn = k (-1) $ Nothing\n</code></pre>\n\n<p><code>i</code> here is again safe, but <code>j</code> is not. Which method should return the warning? What do we do when some or all of these methods are defined outside of our function. What do you do in the case of <code>k</code> where it is conditionally partial? Should some or all of these functions fail?</p>\n\n<p>By making the compiler make this call you are conflating a lot of complicated problems. Especially when you consider that careful library selection avoids it.</p>\n\n<p>In either case the solution IMO to these kinds of problems is to use a tool after or during compilation to look for problems rather than modifying the compiler. Such a tool can more easily understand \"your code\" vs \"their code\" and better determine where best to warn you upon inappropriate use. You could also tune it without having to add a bunch of annotations to your source file to avoid false positives. I don't know a tool offhand or I would suggest one.</p>\n"}, {"comments": [{"owner": {"reputation": 1345, "user_id": 29442, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/11f07822e8b5a23d3c58e3fb4cb57cd6?s=128&d=identicon&r=PG", "display_name": "Hannes Landeholm", "link": "https://stackoverflow.com/users/29442/hannes-landeholm"}, "edited": false, "score": 0, "creation_date": 1438999626, "post_id": 31888763, "comment_id": 51695346, "body": "I would not say that the terminology &quot;assertion&quot; is obvious in this case as this is usually associated with a documentation/debug construct that can safely be removed for performance reasons in other languages and has no implication on the functional logic itself of the program. Rather, an error in Haskell is more similar to a dynamic cast error in other languages. When arbitrary functions can throw them you&#39;re walking a minefield if you&#39;re writing robust software and not even the compiler can help you. One wrong API call and you&#39;re doomed."}, {"owner": {"reputation": 44013, "user_id": 1477667, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/trgKM.jpg?s=128&g=1", "display_name": "dfeuer", "link": "https://stackoverflow.com/users/1477667/dfeuer"}, "reply_to_user": {"reputation": 1345, "user_id": 29442, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/11f07822e8b5a23d3c58e3fb4cb57cd6?s=128&d=identicon&r=PG", "display_name": "Hannes Landeholm", "link": "https://stackoverflow.com/users/29442/hannes-landeholm"}, "edited": false, "score": 2, "creation_date": 1439049166, "post_id": 31888763, "comment_id": 51706981, "body": "@hanneslandeholm, you should consider languages like Coq and Agda. Haskell is not designed for what you want, although it offers some good tools for writing safe and correct code. No one has managed, thus far, to write a dependently typed, strongly normalizing language that is also suitable for most practical programming. Haskell is a compromise."}, {"owner": {"reputation": 11986, "user_id": 3237465, "user_type": "registered", "accept_rate": 76, "profile_image": "https://i.stack.imgur.com/vOArX.png?s=128&g=1", "display_name": "user3237465", "link": "https://stackoverflow.com/users/3237465/user3237465"}, "reply_to_user": {"reputation": 44013, "user_id": 1477667, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/trgKM.jpg?s=128&g=1", "display_name": "dfeuer", "link": "https://stackoverflow.com/users/1477667/dfeuer"}, "edited": false, "score": 1, "creation_date": 1439130610, "post_id": 31888763, "comment_id": 51724538, "body": "@dfeuer, why is Idris not suitable for practical programming? It has proper effects system, compiles to C, performs various optimizations, has a lof of syntactic sugar, proper type holes (well, Agda&#39;s are better), tactics and other quite practical stuff. Compare this to super ugly monad transformers and the institute of <a href=\"https://personal.cis.strath.ac.uk/conor.mcbride/pub/hasochism.pdf\" rel=\"nofollow noreferrer\">hasochism</a>. A practical dependently typed programming language already exists, it just has pure ecosystem."}, {"owner": {"reputation": 44013, "user_id": 1477667, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/trgKM.jpg?s=128&g=1", "display_name": "dfeuer", "link": "https://stackoverflow.com/users/1477667/dfeuer"}, "reply_to_user": {"reputation": 11986, "user_id": 3237465, "user_type": "registered", "accept_rate": 76, "profile_image": "https://i.stack.imgur.com/vOArX.png?s=128&g=1", "display_name": "user3237465", "link": "https://stackoverflow.com/users/3237465/user3237465"}, "edited": false, "score": 1, "creation_date": 1439138531, "post_id": 31888763, "comment_id": 51726899, "body": "@user3237465, to my mind, Idris feels a bit more like a bucket of bolts than a tool kit. Trying to prove non-trivial theorems in it is extremely hard, and the lead developer doesn&#39;t seem to care too much about that application. Laziness is pretty much critical when trying to write formally verified, efficient data structures without going batty. But Idris&#39;s automatic delay/force insertions play very badly with proofs. Maybe Idris will be good some day, but it&#39;s not yet."}, {"owner": {"reputation": 11986, "user_id": 3237465, "user_type": "registered", "accept_rate": 76, "profile_image": "https://i.stack.imgur.com/vOArX.png?s=128&g=1", "display_name": "user3237465", "link": "https://stackoverflow.com/users/3237465/user3237465"}, "reply_to_user": {"reputation": 44013, "user_id": 1477667, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/trgKM.jpg?s=128&g=1", "display_name": "dfeuer", "link": "https://stackoverflow.com/users/1477667/dfeuer"}, "edited": false, "score": 1, "creation_date": 1439140081, "post_id": 31888763, "comment_id": 51727377, "body": "@dfeuer, I agree, that Idris is not very good proof assistant (the underlying theory doesn&#39;t contain metavariables, emacs mode is very clunky, no unicode and mixfix operators and so on), but it&#39;s still a great <i>programming</i> language."}, {"owner": {"reputation": 44013, "user_id": 1477667, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/trgKM.jpg?s=128&g=1", "display_name": "dfeuer", "link": "https://stackoverflow.com/users/1477667/dfeuer"}, "reply_to_user": {"reputation": 11986, "user_id": 3237465, "user_type": "registered", "accept_rate": 76, "profile_image": "https://i.stack.imgur.com/vOArX.png?s=128&g=1", "display_name": "user3237465", "link": "https://stackoverflow.com/users/3237465/user3237465"}, "edited": false, "score": 0, "creation_date": 1439143522, "post_id": 31888763, "comment_id": 51728434, "body": "@user3237465, it also has about four features each of which is almost, but not quite, a module system. And for practical programming, it has nothing to match Haskell&#39;s classes."}, {"owner": {"reputation": 11986, "user_id": 3237465, "user_type": "registered", "accept_rate": 76, "profile_image": "https://i.stack.imgur.com/vOArX.png?s=128&g=1", "display_name": "user3237465", "link": "https://stackoverflow.com/users/3237465/user3237465"}, "reply_to_user": {"reputation": 44013, "user_id": 1477667, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/trgKM.jpg?s=128&g=1", "display_name": "dfeuer", "link": "https://stackoverflow.com/users/1477667/dfeuer"}, "edited": false, "score": 0, "creation_date": 1439145440, "post_id": 31888763, "comment_id": 51728986, "body": "@dfeuer, in tutorials (mostly about effects), that I read, Idris&#39; type classes were pretty good both in theory (because they are first-class) and in practice (because they work). But I&#39;ve never used them, so I don&#39;t know much (I guess they have the same problems as Agda&#39;s instance arguments). I would ask for some elaborations on your statement, but this discussion is irrelevant, so I shouldn&#39;t."}, {"owner": {"reputation": 44013, "user_id": 1477667, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/trgKM.jpg?s=128&g=1", "display_name": "dfeuer", "link": "https://stackoverflow.com/users/1477667/dfeuer"}, "reply_to_user": {"reputation": 11986, "user_id": 3237465, "user_type": "registered", "accept_rate": 76, "profile_image": "https://i.stack.imgur.com/vOArX.png?s=128&g=1", "display_name": "user3237465", "link": "https://stackoverflow.com/users/3237465/user3237465"}, "edited": false, "score": 1, "creation_date": 1439172150, "post_id": 31888763, "comment_id": 51735102, "body": "@user3237465, once you&#39;ve written Van Laarhoven lenses in Idris, you will find them fairly hard to use. Once you&#39;ve defined <code>VerifiedMonoid</code> in terms of <code>VerifiedSemigroup</code> and <code>Monoid</code>, you will find it very hard to use it. It&#39;s easy to pooh-pooh Haskell&#39;s global instance coherence until you see how hard life gets without it and the resolution approach it enables. May I ask why it&#39;s good to have metavariables in the underlying theory?"}, {"owner": {"reputation": 11986, "user_id": 3237465, "user_type": "registered", "accept_rate": 76, "profile_image": "https://i.stack.imgur.com/vOArX.png?s=128&g=1", "display_name": "user3237465", "link": "https://stackoverflow.com/users/3237465/user3237465"}, "reply_to_user": {"reputation": 44013, "user_id": 1477667, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/trgKM.jpg?s=128&g=1", "display_name": "dfeuer", "link": "https://stackoverflow.com/users/1477667/dfeuer"}, "edited": false, "score": 0, "creation_date": 1439186516, "post_id": 31888763, "comment_id": 51738293, "body": "Let us <a href=\"http://chat.stackoverflow.com/rooms/86574/discussion-between-user3237465-and-dfeuer\">continue this discussion in chat</a>."}], "tags": [], "owner": {"reputation": 14485, "user_id": 190376, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/cd8280c5e1491b8cf55760750ed97dec?s=128&d=identicon&r=PG", "display_name": "Reid Barton", "link": "https://stackoverflow.com/users/190376/reid-barton"}, "is_accepted": false, "score": 4, "last_activity_date": 1438997736, "creation_date": 1438997736, "answer_id": 31888763, "question_id": 31888246, "link": "https://stackoverflow.com/questions/31888246/robust-haskell-without-errors/31888763#31888763", "title": "Robust haskell without errors", "body": "<p>Haskell allows arbitrary general recursion, so it's not as though all Haskell programs would necessarily be total, if only <code>error</code> in its various forms were removed. That is, you could just define <code>error a = error a</code> to take care of any case you don't want to handle anyways. A runtime error is just more helpful than an infinite loop.</p>\n\n<p>You should not think of <code>error</code> as similar to a garden-variety Java exception. <code>error</code> is an assertion failure representing a programming error, and a function like <code>fromJust</code> which can call <code>error</code> is an assertion. You should not attempt to catch the exception produced by <code>error</code> except in special cases like a server that must continue to run even when the handler for a request encounters a programming error.</p>\n"}, {"tags": [], "owner": {"reputation": 1345, "user_id": 29442, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/11f07822e8b5a23d3c58e3fb4cb57cd6?s=128&d=identicon&r=PG", "display_name": "Hannes Landeholm", "link": "https://stackoverflow.com/users/29442/hannes-landeholm"}, "is_accepted": true, "score": 1, "last_activity_date": 1439133968, "creation_date": 1439133968, "answer_id": 31905806, "question_id": 31888246, "link": "https://stackoverflow.com/questions/31888246/robust-haskell-without-errors/31905806#31905806", "title": "Robust haskell without errors", "body": "<p>The answer was that I wanted was a level of totality checking that Haskell unfortunately does not provide (yet?).</p>\n\n<p>Alternatively I want dependent types (e.g. <a href=\"http://www.idris-lang.org/\" rel=\"nofollow\">Idris</a>), or a static verifier (e.g. <a href=\"https://github.com/ucsd-progsys/liquidhaskell\" rel=\"nofollow\">Liquid Haskell</a>) or syntax lint detection (e.g. <a href=\"http://community.haskell.org/~ndm/hlint/\" rel=\"nofollow\">hlint</a>). </p>\n\n<p>I'm really looking into Idris now, it seems like an amazing language. Here's a <a href=\"https://www.youtube.com/watch?v=vkIlW797JN8\" rel=\"nofollow\">talk by the founder of Idris</a> that I can recommend watching.</p>\n\n<p>Credits for these answers goes to @duplode, @chi, @user3237465 and @luqui. </p>\n"}], "owner": {"reputation": 1345, "user_id": 29442, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/11f07822e8b5a23d3c58e3fb4cb57cd6?s=128&d=identicon&r=PG", "display_name": "Hannes Landeholm", "link": "https://stackoverflow.com/users/29442/hannes-landeholm"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 387, "favorite_count": 0, "accepted_answer_id": 31905806, "answer_count": 3, "score": 8, "last_activity_date": 1439133968, "creation_date": 1438992370, "last_edit_date": 1495540825, "question_id": 31888246, "link": "https://stackoverflow.com/questions/31888246/robust-haskell-without-errors", "title": "Robust haskell without errors", "body": "<p>I'm currently learning Haskell. One of the motivations why I picked this language was to write software with a very high degree of robustness, i.e. functions that is fully defined, mathematically deterministic and never crash or produce errors. I don't mean failure caused by predicates of the system (\"system out of memory\", \"computer on fire\" etc), those are not interesting and can simply crash the entire process. I also don't mean errornous behaviour caused by invalid declarations (<code>pi = 4</code>).</p>\n\n<p>Instead I refer to errors caused by erroneous states which I want to remove by making those states unrepresentable and non-compilable (in some functions) via strict static typing. In my mind I called these functions \"pure\" and figured that the strong type system would allow me to accomplish this. However Haskell does not define \"pure\" in this way and allow programs to crash via <code>error</code> in any context.</p>\n\n<p><a href=\"https://stackoverflow.com/questions/12335245/why-is-catching-an-exception-non-pure-but-throwing-an-exception-is-pure\">Why is catching an exception non-pure, but throwing an exception is pure?</a></p>\n\n<p>This is completely acceptable and not strange at all. The disappointing thing however is that Haskell does not appear to provide some functionality to forbid function definitions that could lead to branches using <code>error</code>.</p>\n\n<p>Here's a contrived example why I find this disappointing:</p>\n\n<pre><code>module Main where\nimport Data.Maybe\n\ndata Fruit = Apple | Banana | Orange Int | Peach\n    deriving(Show)\n\nreadFruit :: String -&gt; Maybe Fruit\nreadFruit x =\n    case x of\n         \"apple\" -&gt; Just Apple\n         \"banana\" -&gt; Just Banana\n         \"orange\" -&gt; Just (Orange 4)\n         \"peach\" -&gt; Just Peach\n         _ -&gt; Nothing\n\nshowFruit :: Fruit -&gt; String\nshowFruit Apple = \"An apple\"\nshowFruit Banana = \"A Banana\"\nshowFruit (Orange x) = show x ++ \" oranges\"\n\nprintFruit :: Maybe Fruit -&gt; String\nprintFruit x = showFruit $ fromJust x\n\nmain :: IO ()\nmain = do\n    line &lt;- getLine\n    let fruit = readFruit line\n    putStrLn $ printFruit fruit\n    main\n</code></pre>\n\n<p>Let's say that I'm paranoid that the pure functions <code>readFruit</code> and <code>printFruit</code> really doesn't fail due to unhanded states. You could imagine that the code is for launching a rocket full of astronauts which in an absolutely critical routine needs to serialize and unserialize fruit values.</p>\n\n<p>The first danger is naturally that we made a mistake in our pattern matching as this gives us the dreaded erroneous states that can't be handled. Thankfully Haskell provides built in ways to prevent those, we simply compile our program with  <code>-Wall</code> which includes <code>-fwarn-incomplete-patterns</code> and AHA:</p>\n\n<pre><code>src/Main.hs:17:1: Warning:\n    Pattern match(es) are non-exhaustive\n    In an equation for \u2018showFruit\u2019: Patterns not matched: Peach\n</code></pre>\n\n<p>We forgot to serialize Peach fruits and <code>showFruit</code> would have thrown an error. That's an easy fix, we simply add:</p>\n\n<pre><code>showFruit Peach = \"A peach\"\n</code></pre>\n\n<p>The program now compiles without warnings, danger averted! We launch the rocket but suddenly the program crashes with:</p>\n\n<pre><code>Maybe.fromJust: Nothing\n</code></pre>\n\n<p>The rocket is doomed and hits the ocean caused by the following faulty line:</p>\n\n<pre><code>printFruit x = showFruit $ fromJust x\n</code></pre>\n\n<p>Essentially <code>fromJust</code> has a branch where it raises an <code>Error</code> so we didn't even want the program to compile if we tried to use it since <code>printFruit</code> absolutely had to be \"super\" pure. We could have fixed that for example by replacing the line with:</p>\n\n<pre><code>printFruit x = maybe \"Unknown fruit!\" (\\y -&gt; showFruit y) x\n</code></pre>\n\n<p>I find it strange that Haskell decides to implement strict typing and incomplete pattern detection, all in the nobel pursuit of preventing invalid states from being representable but falls just in front of the finish line by not giving programmers a way to detect branches to <code>error</code> when they are not allowed. In a sense this makes Haskell less robust then Java which forces you to declare the exceptions your functions are allowed to raise.</p>\n\n<p>The most trivial way to implement this would be to simply undefined <code>error</code> in some way, locally for a function and any function used by its equation via some form of associated declaration. However this does not appear to be possible.</p>\n\n<p><a href=\"https://wiki.haskell.org/Extended_Static_Checking\" rel=\"nofollow noreferrer\">The wiki page about errors vs exceptions</a> mentions an extension called \"Extended Static Checking\" for this purpose via contracts but it just leads to a broken link.</p>\n\n<p>It basically boils down to: How do I get the program above to not compile because it uses <code>fromJust</code>? All ideas, suggestions and solutions are welcome.</p>\n"}, {"tags": ["haskell"], "answers": [{"comments": [{"owner": {"reputation": 5681, "user_id": 3040064, "user_type": "registered", "accept_rate": 59, "profile_image": "https://www.gravatar.com/avatar/02e7081757e69605a91b7f7aea47f4ae?s=128&d=identicon&r=PG&f=1", "display_name": "Jason Hu", "link": "https://stackoverflow.com/users/3040064/jason-hu"}, "edited": false, "score": 1, "creation_date": 1438985615, "post_id": 31887334, "comment_id": 51692301, "body": "does that imply no syntax help or proper solution for that? what should i do if i define instance for another class without such variation sibling?"}, {"owner": {"reputation": 23444, "user_id": 414413, "user_type": "registered", "accept_rate": 79, "profile_image": "https://www.gravatar.com/avatar/6de2113f01432aa844dc85070ff33e89?s=128&d=identicon&r=PG", "display_name": "Cirdec", "link": "https://stackoverflow.com/users/414413/cirdec"}, "reply_to_user": {"reputation": 5681, "user_id": 3040064, "user_type": "registered", "accept_rate": 59, "profile_image": "https://www.gravatar.com/avatar/02e7081757e69605a91b7f7aea47f4ae?s=128&d=identicon&r=PG&f=1", "display_name": "Jason Hu", "link": "https://stackoverflow.com/users/3040064/jason-hu"}, "edited": false, "score": 2, "creation_date": 1438988688, "post_id": 31887334, "comment_id": 51693196, "body": "There&#39;s nothing I know of. There&#39;s a <code>Data.Constraint.Forall</code> module in the <a href=\"https://hackage.haskell.org/package/constraints\" rel=\"nofollow noreferrer\">constraints</a> package. There isn&#39;t much documentation to go with it; the only person I&#39;m sure would be able to answer whether it can replace classes like <code>Show1</code> is <a href=\"http://stackoverflow.com/users/34707/edward-kmett\">Edward Kmett</a>. He left a tantalizing hint that it might be possible in <a href=\"http://stackoverflow.com/a/8082478/414413\">this answer to a related question</a>."}, {"owner": {"reputation": 44013, "user_id": 1477667, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/trgKM.jpg?s=128&g=1", "display_name": "dfeuer", "link": "https://stackoverflow.com/users/1477667/dfeuer"}, "edited": false, "score": 0, "creation_date": 1503295409, "post_id": 31887334, "comment_id": 78538062, "body": "This could use an update; <code>Show1</code> has been redefined."}], "tags": [], "owner": {"reputation": 23444, "user_id": 414413, "user_type": "registered", "accept_rate": 79, "profile_image": "https://www.gravatar.com/avatar/6de2113f01432aa844dc85070ff33e89?s=128&d=identicon&r=PG", "display_name": "Cirdec", "link": "https://stackoverflow.com/users/414413/cirdec"}, "is_accepted": true, "score": 10, "last_activity_date": 1438985747, "last_edit_date": 1438985747, "creation_date": 1438985336, "answer_id": 31887334, "question_id": 31887204, "link": "https://stackoverflow.com/questions/31887204/how-to-apply-wildcard-in-constraint-in-haskell/31887334#31887334", "title": "How to apply wildcard in constraint in Haskell?", "body": "<p>There's a class <a href=\"https://hackage.haskell.org/package/prelude-extras-0.4/docs/Prelude-Extras.html#t:Show1\"><code>Show1</code></a> in <code>Prelude.Extras</code> to represent \"for all type <code>v</code>, <code>(q v)</code> can be shown\".</p>\n\n<pre><code>class Show1 f where\n  showsPrec1 :: Show a =&gt; Int -&gt; f a -&gt; ShowS\n  default showsPrec1 :: (Show (f a), Show a) =&gt; Int -&gt; f a -&gt; ShowS\n  showsPrec1 = showsPrec\n  ...\n</code></pre>\n\n<p>You can use this to write a show instance for <code>CDeq q a</code>.</p>\n\n<pre><code>instance (Show a, Show1 q) =&gt; Show (CDeq q a) where\n    ....\n</code></pre>\n\n<p>Where you would use <code>show</code> or <code>showsPrec</code> on a <code>q x</code> you'll instead use <a href=\"https://hackage.haskell.org/package/prelude-extras-0.4/docs/Prelude-Extras.html#v:show1\"><code>show1</code></a> or <a href=\"https://hackage.haskell.org/package/prelude-extras-0.4/docs/Prelude-Extras.html#v:showsPrec1\"><code>showsPrec1</code></a>.</p>\n\n<p>If you use these, you should also provide instances for <code>CDeq q</code>.</p>\n\n<pre><code>instance (Show1 q) =&gt; Show1 (CDeq q) where\n    showsPrec1 = showsPrec\n</code></pre>\n"}, {"comments": [{"owner": {"reputation": 44013, "user_id": 1477667, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/trgKM.jpg?s=128&g=1", "display_name": "dfeuer", "link": "https://stackoverflow.com/users/1477667/dfeuer"}, "edited": false, "score": 1, "creation_date": 1503294612, "post_id": 45788798, "comment_id": 78537758, "body": "Some of the type families in <code>Data.Constraint.Forall</code> serve only to defeat superclass cycle detection in certain versions of GHC (before <code>UndecidableSuperClasses</code>). The complicated ways <code>ForallF</code> and <code>ForallT</code> are defined serve to confine the trusted code base to the <code>inst</code> function; in older versions they were simple applications of <code>unsafeCoerce</code>. I recommend that you attempt to write them yourself rather than attempting to understand them as artifacts. I wrote them, and I don&#39;t understand them either; they&#39;re just puzzle solutions to me."}, {"owner": {"reputation": 5681, "user_id": 3040064, "user_type": "registered", "accept_rate": 59, "profile_image": "https://www.gravatar.com/avatar/02e7081757e69605a91b7f7aea47f4ae?s=128&d=identicon&r=PG&f=1", "display_name": "Jason Hu", "link": "https://stackoverflow.com/users/3040064/jason-hu"}, "edited": false, "score": 0, "creation_date": 1503461886, "post_id": 45788798, "comment_id": 78618552, "body": "great discussion."}], "tags": [], "owner": {"reputation": 56659, "user_id": 450128, "user_type": "registered", "accept_rate": 62, "profile_image": "https://www.gravatar.com/avatar/2f72b3fdc99fe9fd1bbeb2f9da1d2c0a?s=128&d=identicon&r=PG", "display_name": "Ben", "link": "https://stackoverflow.com/users/450128/ben"}, "is_accepted": false, "score": 3, "last_activity_date": 1503284794, "creation_date": 1503284794, "answer_id": 45788798, "question_id": 31887204, "link": "https://stackoverflow.com/questions/31887204/how-to-apply-wildcard-in-constraint-in-haskell/45788798#45788798", "title": "How to apply wildcard in constraint in Haskell?", "body": "<p>@Cirdec's already accepted answer is a great pragmatic answer for this use case. I wanted to write a bit about more general techniques (especially the <code>Data.Constraint.Forall</code> mentioned in a comment, since that <em>almost</em> works for this use case but doesn't quite, and there's another thing from <code>constraints</code> that <em>does</em> work), but I wanted to also try to explain a bit about <em>why</em> this isn't directly possible first and what <code>Show1</code>, <code>Forall</code>, and <code>Lifting</code> do to work around that (they're each different trade offs). So it got a little long, apologies.</p>\n\n<hr>\n\n<p>By standard Haskell mechanisms you <em>can't</em> have such a \"wildcard\" constraint. The reason is that <code>Show</code> makes a constraint from a type, with potentially a different instance (with different method definitions) for each type you could apply it to.</p>\n\n<p>When your code requires a <code>Show (CDeq q a)</code> instance and finds <code>instance (Show a, Show ????) =&gt; Show (CDeq q a)</code>, that means it now also needs to find an instance for <code>Show a</code> and <code>Show ????</code>.</p>\n\n<p><code>Show a</code> is easy; either <code>a</code> has already been chosen as some concrete type like <code>Int</code>, and it can use the <code>Show</code> instance for that type (or error if there isn't one in scope). Or your code was in a function that was polymorphic in <code>a</code>; in that case there must have been a <code>Show a</code> constraint on the function you wrote, so the compiler will just rely on the <em>caller</em> having chosen some particular <code>a</code> and passed in the <code>Show a</code> instance definition.</p>\n\n<p>But the wildcard constraint <code>Show ????</code> is different. We're not talking about a concrete type here, so that path to resolution isn't going to work. And we're not even talking about a polymorphic constraint in the sense that there's a type variable the caller would choose (in that case we could punt the problem of choosing a single instance dictionary to the caller).</p>\n\n<p>What you need is to be able to show <code>q a</code>, and <code>q (q a)</code>, and <code>q (q (q a)</code>, etc. But each of those could have its own instance! The types are gone at runtime, so the compiler can't even attempt to round up all of those instances (or require the caller to pass in an unbounded number of instances) and emit code that switches between which <code>show</code> it calls. It needs to emit code that only calls one version of <code>show</code>; either a specific one from a specific instance it's been able to choose, or one that is passed in by the caller to the function.</p>\n\n<p>One way to workaround this is with an alternative type class like <code>Show1</code>. Here the \"unit of overloading\" is on the <code>* -&gt; *</code> type constructor. It's impossible to make a <code>Show1</code> instance for types like <code>Int</code> (they're not the right shape), but a single <code>Show1 q</code> instance is applicable to <em>all</em> types of the form <code>q a</code>, so you don't need an unbounded number of instances to support <code>q a</code>, <code>q (q a)</code>, <code>q (q (q a))</code>, etc anymore.</p>\n\n<p>But there also are <code>Show</code> instances that <em>are</em> polymorphic in some type variables. For example the list instance is <code>Show a =&gt; Show [a]</code>; knowing that this instance exists (and there aren't any overlapping instances), we know we'll be using the same instance for <code>[a]</code>, <code>[[a]]</code>, <code>[[[a]]]</code>, etc. If we could somehow write a constraint that required a polymorphic instance like that.</p>\n\n<p>There's no <em>direct</em> way to say we want a polymorphic instance - the constraint language only allows us to ask for instances for particular types, or particular types that the caller chooses. But the <code>Data.Forall</code> module in the constraints package (<a href=\"https://hackage.haskell.org/package/constraints\" rel=\"nofollow noreferrer\">https://hackage.haskell.org/package/constraints</a>), which @Cirdec suggested in a comment, uses clever tricks internally to provide a few ways of doing this.<sup>1</sup> Here's an example of how that would look:</p>\n\n<pre><code>{-# LANGUAGE FlexibleContexts\n           , ScopedTypeVariables\n           , TypeApplications\n           , TypeOperators\n  #-}\n\nmodule Foo where\n\nimport Data.Constraint ( (:-), (\\\\) )\nimport Data.Constraint.Forall (ForallF, instF)\n\ndata Nested q a = Stop | Deeper a (Nested q (q a))\n\ndata None a = None\n\ninstance Show (None a)\n  where show None = \"None\"\n\ninstance (Show a, ForallF Show q) =&gt; Show (Nested q a)\n  where show Stop = \"Stop\"\n        show (Deeper a r) = show a ++ \" \" ++ show r\n                              \\\\ (instF @Show @q @a)\n</code></pre>\n\n<p>The constraint <code>ForallF Show q</code> represents <code>forall a. Show (q a)</code>.<sup>2</sup> But it's not that constraint directly, so we can't just derive <code>Show</code> using this; we need to write an instance manually so we can do some massaging.</p>\n\n<p>A <code>ForallF</code> constraint gives us access to <code>instF</code> which is of type <code>forall p f a. ForallF p f :- p (f a)</code>. The <code>:-</code> is a type of the constraints package; values of type <code>c :- d</code> represent a proof that when the constraint <code>c</code> holds the constraint <code>d</code> also holds (or in terms of instance dictionaries: it contains a dictionary for <code>d</code> that's parameterised on a dictionary for <code>c</code>). So <code>ForallF p f :- p (f a)</code> is a proof that when we have <code>ForallF p f</code> we can get <code>p (f a)</code>. Type application syntax is a less verbose way of pinning down the types at which we're using <code>instF</code>, we want the left side of <code>:-</code> to tie back to the <code>ForallF Show q</code> that we know we have from the instance constraint. That means the right hand side will give us a <code>Show (q a)</code>, as we needed! The <code>\\\\</code> operator just takes an expression on the left and an <code>c :- d</code> on the right, and basically connects <code>c</code> and <code>d</code> instances for us; the expression will be evaluated with access to a dictionary for <code>d</code>, but the overall expression only needs <code>c</code>.</p>\n\n<p>Here's an example of use:</p>\n\n<pre><code>\u03bb Deeper 'a' (Deeper None (Deeper None Stop))\n'a' None None Stop\nit :: Nested None Char\n</code></pre>\n\n<p>Hurrah! But why did I use <code>None</code>? What happens when we try it with nested lists?</p>\n\n<pre><code>\u03bb :t Deeper [] (Deeper [] Stop)\nDeeper [] (Deeper [] Stop) :: Nested [] [t]\n\n\u03bb Deeper [] (Deeper [] Stop)\n\n&lt;interactive&gt;:65:1: error:\n    \u2022 No instance for (Show\n                         (Data.Constraint.Forall.Skolem\n                            (Data.Constraint.Forall.ComposeC Show [])))\n        arising from a use of \u2018print\u2019\n    \u2022 In a stmt of an interactive GHCi command: print it\n</code></pre>\n\n<p>Drat. What went wrong? Well, our polymorphic <code>Show</code> instance for lists is actually <code>Show a =&gt; Show [a]</code>. The instance head is polymorphic, so it <em>applies</em> to all types of forms <code>[a]</code>. But it also needs the extra constraint that <code>Show a</code> holds, so it's not truly polymorphic. Basically what happens is the internal unexported thing in <code>Data.Constraint</code> doesn't have an instance for <code>Show</code> (it can't have any instances for the technique to work), so we get the error above. And that's actually a good thing; dictionaries for <code>[a]</code> contain a nested dictionary for <code>a</code>, so the trick of getting an instance we know is polymorphic and then unsafeCoercing it to the right type wouldn't be applicable here. <code>ForallF</code> only works to find instances that are <em>completely</em> polymorphic, with no restrictions at all.</p>\n\n<p>But there <em>is</em> one more thing the constraints package has to offer here! <code>Data.Constraint.Lifting</code> gives us a class <code>Lifting p f</code>, that represents the idea \"<code>p (f a)</code> holds whenever <code>p a</code> holds\". The idea that the constraint <code>p</code> \"lifts through\" the type constructor <code>f</code>. This is actually <em>exactly</em> the notion you needed, since you can just apply it recursively to nest arbitrarily many depths of <code>q</code>.</p>\n\n<pre><code>{-# LANGUAGE FlexibleContexts\n           , ScopedTypeVariables\n           , TypeApplications\n           , TypeOperators\n  #-}\n\nmodule Foo where\n\nimport Data.Constraint ( (:-), (\\\\) )\nimport Data.Constraint.Lifting ( Lifting (lifting) )\n\ndata Nested q a = Stop | Deeper a (Nested q (q a))\n\ninstance (Show a, Lifting Show q) =&gt; Show (Nested q a)\n  where show Stop = \"Stop\"\n        show (Deeper a r) = show a ++ \" \" ++ show r\n                              \\\\ (lifting @Show @q @a)\n</code></pre>\n\n<p>Here the <code>lifting</code> method of the class <code>Lifting</code> is doing basically what <code>instF</code> was doing before. <code>lifting :: Lifting p f =&gt; p a :- p (f a)</code>, so when we have <code>Lifting Show q</code> and we have <code>Show a</code>, then we can use <code>\\\\</code> and <code>lifting</code> (used at the right type) to get the <code>Show (q a)</code> dictionary we need to recursively invoke <code>show</code>.</p>\n\n<p>Now we can show <code>Nested</code> applied to list types:</p>\n\n<pre><code>\u03bb Deeper [] (Deeper [[True]] Stop)\n[] [[True]] Stop\nit :: Nested [] [Bool]\n</code></pre>\n\n<p><code>Data.Constraint.Lifting</code> does have a lot of predefined instances for things in the prelude, but you'll likely to have to write your own instances. Fortunately this pretty much is generally a matter of writing:</p>\n\n<pre><code>instance Lifting SomeClass MyType\n  where lifting = Sub Dict\n</code></pre>\n\n<p>The instance resolver does all the actual work for you, provided your type really <em>does</em> allow that class to be \"lifted through\" it.</p>\n\n<hr>\n\n<p><sup>1</sup> My understanding of the code in that module is not 100% complete (and the full details are a bit involved to make it as safe as possible), but basically the technique is to apply a class to a hidden unexported thing and capture the dictionary. Since no third-party instance could have actually referenced our unexported thing, the only way an instance could be resolved is if it was actually polymorphic and would work for anything. So then the captured dictionary can just be <code>unsafeCoerced</code> to apply to any type you like.</p>\n\n<p><sup>2</sup> There are a few other variants of <code>Forall*</code> for representing different \"shapes\" of polymorphism in the constraint. I believe you can't make a one-size-fits-all version because you have to not mention the variable you're being polymorphic over, which means you can't actually use the constraint applied, you have to have something that takes the class as a parameter as well as all of the non-polymorphic parameters and applies them together in a particular fashion.</p>\n"}], "owner": {"reputation": 5681, "user_id": 3040064, "user_type": "registered", "accept_rate": 59, "profile_image": "https://www.gravatar.com/avatar/02e7081757e69605a91b7f7aea47f4ae?s=128&d=identicon&r=PG&f=1", "display_name": "Jason Hu", "link": "https://stackoverflow.com/users/3040064/jason-hu"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 415, "favorite_count": 0, "accepted_answer_id": 31887334, "answer_count": 2, "score": 6, "last_activity_date": 1503284794, "creation_date": 1438984522, "last_edit_date": 1503185568, "question_id": 31887204, "link": "https://stackoverflow.com/questions/31887204/how-to-apply-wildcard-in-constraint-in-haskell", "title": "How to apply wildcard in constraint in Haskell?", "body": "<p>It sounds trivial but I can't find out what I'm supposed to do.</p>\n\n<p>The following is my type definition:</p>\n\n<pre><code>data CDeq q a = Shallow (q a)\n              | Deep{ hq   \u2982 q a\n                    , susp \u2982 CDeq q (q a)\n                    , tq   \u2982 q a }\n</code></pre>\n\n<p>and I want it to have an instance of <code>Show</code>.</p>\n\n<p>Since GHC doesn't allow <code>deriving</code> here, I just tried to write one myself:</p>\n\n<pre><code>instance (Show a, Show ????) =&gt; Show (CDeq q a) where\n    ....\n</code></pre>\n\n<p>but I got stuck.</p>\n\n<p>I don't know how to represent that <code>for all type v, (q v) can be shown</code> in Haskell.</p>\n\n<p>I can't simply do the following:</p>\n\n<pre><code>instance (Show a, Show (q a)) =&gt; Show (CDeq q a) where\n    ....\n</code></pre>\n\n<p>since to show <code>CDeq q (q a)</code>, <code>Show (q (q a))</code> is required, then <code>Show (q (q (q a)))</code> is required, then on and on.</p>\n\n<p>So I am wondering is there a syntax such that I can express the meaning I stated up there?</p>\n\n<p>I once thought <code>forall</code> could be the solution to this, but it doesn't work:</p>\n\n<pre><code>instance (Show a, forall v. Show (q v)) =&gt; Show (CDeq q a)\n</code></pre>\n"}, {"tags": ["haskell"], "comments": [{"owner": {"reputation": 2582, "user_id": 2940627, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/5df0a513a91a3825f51045c23e71e99d?s=128&d=identicon&r=PG&f=1", "display_name": "Madness", "link": "https://stackoverflow.com/users/2940627/madness"}, "edited": false, "score": 0, "creation_date": 1438972428, "post_id": 31884452, "comment_id": 51686513, "body": "Welcome to SO! You need to attempt this, post the code you try, and any problems you are having so that we may help you with said issues. See the <a href=\"http://stackoverflow.com/help/how-to-ask\">How to ask page</a> for help in improving your question."}, {"owner": {"reputation": 62421, "user_id": 216164, "user_type": "registered", "accept_rate": 89, "profile_image": "https://www.gravatar.com/avatar/786f224adbe0784cdf7d0f15476061fe?s=128&d=identicon&r=PG", "display_name": "Thomas M. DuBuisson", "link": "https://stackoverflow.com/users/216164/thomas-m-dubuisson"}, "edited": false, "score": 4, "creation_date": 1438972497, "post_id": 31884452, "comment_id": 51686546, "body": "I&#39;m voting to close this question as off-topic because there is no prior attempt at a solution or specific, re-producible problem."}], "answers": [{"tags": [], "owner": {"reputation": 261, "user_id": 5165551, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/NBdFX.jpg?s=128&g=1", "display_name": "Thomas", "link": "https://stackoverflow.com/users/5165551/thomas"}, "is_accepted": false, "score": 1, "last_activity_date": 1438973742, "creation_date": 1438973742, "answer_id": 31884794, "question_id": 31884452, "link": "https://stackoverflow.com/questions/31884452/how-to-create-a-random-pair-in-haskell/31884794#31884794", "title": "How to create a random pair in haskell", "body": "<p><a href=\"https://www.fpcomplete.com/school/starting-with-haskell/libraries-and-frameworks/randoms\" rel=\"nofollow\">https://www.fpcomplete.com/school/starting-with-haskell/libraries-and-frameworks/randoms</a></p>\n\n<p>This should help. Basically just use the <code>System.Random</code> module (<a href=\"https://hackage.haskell.org/package/random-1.1/docs/System-Random.html\" rel=\"nofollow\">https://hackage.haskell.org/package/random-1.1/docs/System-Random.html</a>)</p>\n"}], "owner": {"reputation": 31, "user_id": 3006595, "user_type": "registered", "accept_rate": 50, "profile_image": "https://graph.facebook.com/100003918288601/picture?type=large", "display_name": "user3006595", "link": "https://stackoverflow.com/users/3006595/user3006595"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 134, "favorite_count": 0, "closed_date": 1438982131, "answer_count": 1, "score": 0, "last_activity_date": 1438973742, "creation_date": 1438972264, "question_id": 31884452, "link": "https://stackoverflow.com/questions/31884452/how-to-create-a-random-pair-in-haskell", "closed_reason": "Not suitable for this site", "title": "How to create a random pair in haskell", "body": "<p>Hi all I am trying to create a random pairs of the specific number of mines in my minessweeper game.</p>\n\n<p>so I need to make method that takes a mines number, (width,hight) and returns a list of random positions [(x,y)]</p>\n"}, {"tags": ["haskell", "bmp", "juicy-pixels"], "answers": [{"comments": [{"owner": {"reputation": 464, "user_id": 3825556, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/7ajzp.png?s=128&g=1", "display_name": "Cirquit", "link": "https://stackoverflow.com/users/3825556/cirquit"}, "edited": false, "score": 0, "creation_date": 1438970057, "post_id": 31883792, "comment_id": 51685298, "body": "Well this is embarrasing. You are totally right! I&#39;ll accept your answer as soon as I can. (Maybe at least somebody can use this codesnippet in the future)"}, {"owner": {"reputation": 1003, "user_id": 218307, "user_type": "registered", "accept_rate": 91, "profile_image": "https://www.gravatar.com/avatar/71349c1b606c549215197f7ec55e2276?s=128&d=identicon&r=PG", "display_name": "jhickner", "link": "https://stackoverflow.com/users/218307/jhickner"}, "edited": false, "score": 2, "creation_date": 1438980584, "post_id": 31883792, "comment_id": 51690497, "body": "The <a href=\"https://hackage.haskell.org/package/JuicyPixels-3.2.5.3/docs/Codec-Picture-Types.html#v:pixelFold\" rel=\"nofollow noreferrer\">pixelFold</a> helper function would let you avoid explicit indexing entirely here."}], "tags": [], "owner": {"reputation": 21417, "user_id": 925978, "user_type": "registered", "accept_rate": 84, "profile_image": "https://www.gravatar.com/avatar/06e4467a5bd1538a92cefb20db07897a?s=128&d=identicon&r=PG&f=1", "display_name": "crockeea", "link": "https://stackoverflow.com/users/925978/crockeea"}, "is_accepted": true, "score": 4, "last_activity_date": 1438969692, "creation_date": 1438969692, "answer_id": 31883792, "question_id": 31883755, "link": "https://stackoverflow.com/questions/31883755/how-to-extract-rgb-values-from-most-pictures/31883792#31883792", "title": "How to extract RGB values from (most) pictures?", "body": "<p>Your list comprehension in <code>accumPixels</code> is 0-indexed, but also includes the boundaries. This is likely the issue. In Haskell, <code>[0..3]</code> is the list <code>[0,1,2,3]</code>, so you probably mean <code>[0..(w-1)]</code> and <code>[0..(h-1)]</code>.</p>\n"}], "owner": {"reputation": 464, "user_id": 3825556, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/7ajzp.png?s=128&g=1", "display_name": "Cirquit", "link": "https://stackoverflow.com/users/3825556/cirquit"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 514, "favorite_count": 0, "accepted_answer_id": 31883792, "answer_count": 1, "score": 3, "last_activity_date": 1438970581, "creation_date": 1438969558, "last_edit_date": 1438970581, "question_id": 31883755, "link": "https://stackoverflow.com/questions/31883755/how-to-extract-rgb-values-from-most-pictures", "title": "How to extract RGB values from (most) pictures?", "body": "<p>I want to extract every RGB value from possible pictures in Haskell. </p>\n\n<p>What would be the easiest way to get the raw values (0-255)?</p>\n\n<p>I already got some results with the Juicy Pixels library, but somehow I always get the exception:</p>\n\n<pre><code>*** Exception: ./Data/Vector/Generic.hs:249 ((!)): index out of bounds (660000,660000)\n</code></pre>\n\n<p>This is the corresponding code.</p>\n\n<pre><code>{-# LANGUAGE TypeSynonymInstances #-}\n\nmodule Main where\n\nimport Codec.Picture         (readImage, pixelAt, PixelRGB8(..))\nimport Codec.Picture.Types\nimport System.FilePath.Posix (splitExtension)\n\ntoRGBRaw :: FilePath -&gt; IO ()\ntoRGBRaw fp = do\n    image &lt;- readImage fp\n    case image of\n      Left _ -&gt; putStrLn $ \"Sorry, not a supported codec for \" ++ fp\n      Right dynimg -&gt; do\n        let imgrgba8 = fromDynamicImage dynimg\n        let (name, _) = splitExtension fp\n        writeFile (name ++ \".txt\") (concat $ accumPixels imgrgba8)\n\naccumPixels :: Image PixelRGBA8 -&gt; [String]\naccumPixels img@(Image w h _) = [ format (pixelAt img x y) x y | x &lt;- [0..w], y &lt;- [0..h]]\n  where format (PixelRGBA8 r g b _) j k = \"#\" ++ show r ++ \"$\"\n                                              ++ show g ++ \"$\"\n                                              ++ show b ++ \"$\"\n                                              ++ show j ++ \"$\"\n                                              ++ show k ++ \"*\\n\"\n\n\n-- Copied from\n-- See http://hackage.haskell.org/package/JuicyPixels-util-0.2/docs/Codec-Picture-RGBA8.html\n\nclass ToPixelRGBA8 a where\n    toRGBA8 :: a -&gt; PixelRGBA8\n\ninstance ToPixelRGBA8 Pixel8 where\n    toRGBA8 b = PixelRGBA8 b b b 255\n\ninstance ToPixelRGBA8 PixelYA8 where\n    toRGBA8 (PixelYA8 l a) = PixelRGBA8 l l l a\n\ninstance ToPixelRGBA8 PixelRGB8 where\n    toRGBA8 (PixelRGB8 r g b) = PixelRGBA8 r g b 255\n\ninstance ToPixelRGBA8 PixelRGBA8 where\n    toRGBA8 = id\n\nfromDynamicImage :: DynamicImage -&gt; Image PixelRGBA8\nfromDynamicImage (ImageY8 img) = pixelMap toRGBA8 img\nfromDynamicImage (ImageYA8 img) = pixelMap toRGBA8 img\nfromDynamicImage (ImageRGB8 img) = pixelMap toRGBA8 img\nfromDynamicImage (ImageRGBA8 img) = img\n\n-- end of Codec.Picture.RGBA8\n</code></pre>\n\n<p>This is an example image: <a href=\"http://www.oocities.org/tinobya/senior/cat.bmp\" rel=\"nofollow\">Link</a></p>\n\n<p>The code is currently a little bit unordered because I had to copy some definitions from <code>Codec.Picture.RGBA8</code> which is not available through LTS. Don't mind the string representation, I'm parsing those via an Arduino with a WiFi shield.</p>\n"}, {"tags": ["haskell", "fold"], "answers": [{"comments": [{"owner": {"reputation": 261, "user_id": 5165551, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/NBdFX.jpg?s=128&g=1", "display_name": "Thomas", "link": "https://stackoverflow.com/users/5165551/thomas"}, "edited": false, "score": 0, "creation_date": 1438962194, "post_id": 31881655, "comment_id": 51680923, "body": "Thanks a lot! I didn&#39;t consider where :)"}, {"owner": {"reputation": 34864, "user_id": 237428, "user_type": "registered", "accept_rate": 78, "profile_image": "https://i.stack.imgur.com/ThNhZ.jpg?s=128&g=1", "display_name": "Antal Spector-Zabusky", "link": "https://stackoverflow.com/users/237428/antal-spector-zabusky"}, "reply_to_user": {"reputation": 261, "user_id": 5165551, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/NBdFX.jpg?s=128&g=1", "display_name": "Thomas", "link": "https://stackoverflow.com/users/5165551/thomas"}, "edited": false, "score": 1, "creation_date": 1438972831, "post_id": 31881655, "comment_id": 51686702, "body": "@Thomas: Note that <code>go</code> in the where block is just defined to be a (non-recursive) function, so you can use a lambda: <code>printLine = foldr (\\x b -&gt; (&#39;+&#39; : replicate x &#39;-&#39;) ++ b) &quot;+&quot;</code>.  It&#39;s not necessarily clearer or less clear, but just wanted to make the point that you <i>could</i> still do it with a lambda."}], "tags": [], "owner": {"reputation": 49959, "user_id": 866915, "user_type": "registered", "accept_rate": 70, "profile_image": "https://www.gravatar.com/avatar/09242131d6e17cbbe31e8547514da6e5?s=128&d=identicon&r=PG", "display_name": "ErikR", "link": "https://stackoverflow.com/users/866915/erikr"}, "is_accepted": true, "score": 3, "last_activity_date": 1438962402, "last_edit_date": 1438962402, "creation_date": 1438961956, "answer_id": 31881655, "question_id": 31881268, "link": "https://stackoverflow.com/questions/31881268/haskell-combine-foldr-and-replicate/31881655#31881655", "title": "Haskell - combine foldr and replicate?", "body": "<p>Try this:</p>\n\n<pre><code>withFoldr :: [Int] -&gt; String\nwithFoldr xs = foldr go \"+\" xs\n  where go x b = ('+' : replicate x '-') ++ b\n</code></pre>\n\n<p>In general, when you have an expression</p>\n\n<pre><code>f as = foldr go a bs\n</code></pre>\n\n<p>then <code>a</code> equals <code>f []</code>. The <code>go</code> function has signature <code>go :: a -&gt; b -&gt; b</code>\nand corresponds to the recursive case of <code>printLine</code>:</p>\n\n<pre><code>-- match up with go :: a -&gt; b -&gt; b\nprintLine (x:xs) = '+' : replicate x '-' ++ printLine xs\n</code></pre>\n\n<p>Here we identify <code>a</code> with <code>x</code> and <code>b</code> with <code>printLine xs</code>, so <code>go</code> becomes:</p>\n\n<pre><code>go a b = ('+' : replicate a '-') ++ b\n</code></pre>\n"}, {"tags": [], "owner": {"reputation": 3113, "user_id": 1193741, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/be1d97fc244eaa2bfd3d7d64c1717f9f?s=128&d=identicon&r=PG", "display_name": "jtobin", "link": "https://stackoverflow.com/users/1193741/jtobin"}, "is_accepted": false, "score": 2, "last_activity_date": 1438962082, "creation_date": 1438962082, "answer_id": 31881706, "question_id": 31881268, "link": "https://stackoverflow.com/questions/31881268/haskell-combine-foldr-and-replicate/31881706#31881706", "title": "Haskell - combine foldr and replicate?", "body": "<p>You can write a version of it with very little change:</p>\n\n<pre><code>printL = foldr alg \"+\" where\n  alg x xs = '+' : replicate x '-' ++ xs\n</code></pre>\n\n<p>It might help to think of <code>xs</code> as the component that has already been handled appropriately; you handle <code>x</code> (by prepending <code>'+'</code> to <code>-</code> replicated <code>x</code> times), and then append the 'already-handled' <code>xs</code> to that.</p>\n"}, {"comments": [{"owner": {"reputation": 261, "user_id": 5165551, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/NBdFX.jpg?s=128&g=1", "display_name": "Thomas", "link": "https://stackoverflow.com/users/5165551/thomas"}, "edited": false, "score": 0, "creation_date": 1438962463, "post_id": 31881755, "comment_id": 51681114, "body": "Oh that&#39;s really clever! I love it!"}], "tags": [], "owner": {"reputation": 2177, "user_id": 684133, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/28e34bba8a34fc266d15ab1cebafd0a2?s=128&d=identicon&r=PG", "display_name": "Martin Vidner", "link": "https://stackoverflow.com/users/684133/martin-vidner"}, "is_accepted": false, "score": 3, "last_activity_date": 1438962252, "creation_date": 1438962252, "answer_id": 31881755, "question_id": 31881268, "link": "https://stackoverflow.com/questions/31881268/haskell-combine-foldr-and-replicate/31881755#31881755", "title": "Haskell - combine foldr and replicate?", "body": "<p>Another possibility:</p>\n\n<pre><code>ghci&gt; let printLine ns = foldr (++) \"+\" $ map (\\n -&gt; '+' : replicate n '-') ns\nghci&gt; printLine [5,2,33]\n\"+-----+--+---------------------------------+\"\n</code></pre>\n"}, {"comments": [{"owner": {"reputation": 261, "user_id": 5165551, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/NBdFX.jpg?s=128&g=1", "display_name": "Thomas", "link": "https://stackoverflow.com/users/5165551/thomas"}, "edited": false, "score": 0, "creation_date": 1438962809, "post_id": 31881819, "comment_id": 51681341, "body": "I thought there&#39;d be a way with flip! That&#39;s quite interesting, thanks :)"}, {"owner": {"reputation": 33202, "user_id": 987185, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/e4c92f75eac948cee7e7e8913f9aa379?s=128&d=identicon&r=PG", "display_name": "musically_ut", "link": "https://stackoverflow.com/users/987185/musically-ut"}, "reply_to_user": {"reputation": 261, "user_id": 5165551, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/NBdFX.jpg?s=128&g=1", "display_name": "Thomas", "link": "https://stackoverflow.com/users/5165551/thomas"}, "edited": false, "score": 0, "creation_date": 1438962895, "post_id": 31881819, "comment_id": 51681393, "body": "@Thomas But I reiterate, this should only be an academic exercise, and not something I would want to find in real code. The other solutions provide how to solve the problem in a more canonical way."}, {"owner": {"reputation": 261, "user_id": 5165551, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/NBdFX.jpg?s=128&g=1", "display_name": "Thomas", "link": "https://stackoverflow.com/users/5165551/thomas"}, "edited": false, "score": 0, "creation_date": 1438963828, "post_id": 31881819, "comment_id": 51681971, "body": "Oh that&#39;s quite alright, it&#39;s in fact an academic exercise :p"}, {"owner": {"reputation": 61419, "user_id": 849891, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/MbEO3.png?s=128&g=1", "display_name": "Will Ness", "link": "https://stackoverflow.com/users/849891/will-ness"}, "edited": false, "score": 1, "creation_date": 1438964744, "post_id": 31881819, "comment_id": 51682495, "body": "<code>flip</code>s might be easier on the eyes with operator sections: <code>foldr (flip (++) . (++ &quot;+&quot;) . (`replicate` &#39;-&#39;)) &quot;+&quot;</code>. but why in reverse?"}, {"owner": {"reputation": 33202, "user_id": 987185, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/e4c92f75eac948cee7e7e8913f9aa379?s=128&d=identicon&r=PG", "display_name": "musically_ut", "link": "https://stackoverflow.com/users/987185/musically-ut"}, "reply_to_user": {"reputation": 261, "user_id": 5165551, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/NBdFX.jpg?s=128&g=1", "display_name": "Thomas", "link": "https://stackoverflow.com/users/5165551/thomas"}, "edited": false, "score": 0, "creation_date": 1438965293, "post_id": 31881819, "comment_id": 51682791, "body": "@Thomas Updated the answer with a more visually pleasing solution."}], "tags": [], "owner": {"reputation": 33202, "user_id": 987185, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/e4c92f75eac948cee7e7e8913f9aa379?s=128&d=identicon&r=PG", "display_name": "musically_ut", "link": "https://stackoverflow.com/users/987185/musically-ut"}, "is_accepted": false, "score": 2, "last_activity_date": 1438965179, "last_edit_date": 1438965179, "creation_date": 1438962467, "answer_id": 31881819, "question_id": 31881268, "link": "https://stackoverflow.com/questions/31881268/haskell-combine-foldr-and-replicate/31881819#31881819", "title": "Haskell - combine foldr and replicate?", "body": "<p>I am guessing you want a point free representation to pass to <code>foldr</code> as an academic exercise. Here is how I would approach the problem.</p>\n\n<p>First, I would write the expression using lambdas:</p>\n\n<pre><code>Prelude&gt; let pp = foldr (\\x -&gt; \\s -&gt; s ++ (replicate x '-') ++ \"+\") \"+\"\nPrelude&gt; pp [4,5]\n\"+-----+----+\"\n</code></pre>\n\n<p>Now, I would work towards making the expression point free one argument at a time. First, eliminating <code>s</code>:</p>\n\n<pre><code>Prelude&gt; let pp = foldr (\\x -&gt; flip (++) ((replicate x '-') ++ \"+\")) \"+\"\nPrelude&gt; pp [4,5]\n\"+-----+----+\"\n</code></pre>\n\n<p>And now, <code>x</code>, first by moving it as the last argument of the internal function:</p>\n\n<pre><code>Prelude&gt; let pp = foldr (\\x -&gt; flip (++) ((flip replicate '-' x) ++ \"+\")) \"+\"\nPrelude&gt; pp [4,5]\n\"+-----+-\n</code></pre>\n\n<p>Then yet another step:</p>\n\n<pre><code>Prelude&gt; let pp = foldr (\\x -&gt; flip (++) (flip (++) \"+\" (flip replicate '-' x))) \"+\"\nPrelude&gt; pp [4,5]\n\"+-----+----+\"\n</code></pre>\n\n<p>Now this is getting slightly out of hand so this is a shorthand to see the next step:</p>\n\n<pre><code>Prelude&gt; let f = flip (++)\nPrelude&gt; let g = f \"+\"\nPrelude&gt; let h = flip replicate '-'\nPrelude&gt; let pp = foldr (\\x -&gt; f (g (h x))) \"+\"\n</code></pre>\n\n<p>Making the last point-free is easy!</p>\n\n<pre><code>Prelude&gt; let pp = foldr (f . g . h) \"+\"\nPrelude&gt; pp [4,5]\n\"+-----+----+\"\n</code></pre>\n\n<p>Now replacing the <code>f</code>, <code>g</code> and <code>h</code>, you'll get your answer. However, this should merely be an academic exercise and I wouldn't imagine using something like this in real production code.</p>\n\n<hr>\n\n<p>@WillNess suggested using <a href=\"https://wiki.haskell.org/Section_of_an_infix_operator\" rel=\"nofollow\">operator sections (see right section)</a>, which I had completely forgotten about. They allow one to omit the flip at two places, resulting in something more eyesome:</p>\n\n<p>Original:</p>\n\n<pre><code>Prelude&gt; let pp = foldr ((flip (++)) . (flip (++) \"+\") . (flip replicate '-')) \"+\"\n</code></pre>\n\n<p>Changes to:</p>\n\n<pre><code>Prelude&gt; let pp = foldr ((flip (++)) . (++ \"+\") . (`replicate` '-')) \"+\"\nPrelude&gt; pp [4,5]\n\"+-----+----+\"\n</code></pre>\n"}], "owner": {"reputation": 261, "user_id": 5165551, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/NBdFX.jpg?s=128&g=1", "display_name": "Thomas", "link": "https://stackoverflow.com/users/5165551/thomas"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 764, "favorite_count": 0, "accepted_answer_id": 31881655, "answer_count": 4, "score": 2, "last_activity_date": 1438965179, "creation_date": 1438960792, "question_id": 31881268, "link": "https://stackoverflow.com/questions/31881268/haskell-combine-foldr-and-replicate", "title": "Haskell - combine foldr and replicate?", "body": "<p>Now I know in general how to use foldr, I usually write with a recursive function in mind, eg for me when I see:</p>\n\n<pre><code>   sum xs = foldr (+) 0 xs\n</code></pre>\n\n<p>What I think is:</p>\n\n<pre><code>   sum [] = 0\n   sum (x:xs) = x + sum xs\n</code></pre>\n\n<p>Which as far as I know is basically what foldr means.</p>\n\n<p>Now, I have this code:</p>\n\n<pre><code>   printLine :: [Int] -&gt; String\n   printLine [] = \"+\"\n   printLine (x:xs) = '+' : replicate x '-' ++ printLine xs\n</code></pre>\n\n<p>What it does, is it takes for example  [5,4] and then it prints \"+-----+----+\". Now, I really want to know how to write this using foldr. It follows the general idea of the recursive function so I think it should be doable. I've tried with lambda function and flip replicate shenanigans but nothing seems to work. Any tips?</p>\n"}, {"tags": ["haskell", "recursion"], "comments": [{"owner": {"reputation": 4328, "user_id": 1473927, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/AO6Ui.jpg?s=128&g=1", "display_name": "Jonathan Cast", "link": "https://stackoverflow.com/users/1473927/jonathan-cast"}, "edited": false, "score": 0, "creation_date": 1438959946, "post_id": 31880896, "comment_id": 51679421, "body": "Not relevant to your question, but I think your <code>demode</code> is broken: what is <code>demode 9 9</code>?  (Corner cases like that make good test cases, btw.)."}, {"owner": {"reputation": 14781, "user_id": 630160, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/4445f21326af525a8ad19af7e3ae41a8?s=128&d=identicon&r=PG", "display_name": "epsilonhalbe", "link": "https://stackoverflow.com/users/630160/epsilonhalbe"}, "edited": false, "score": 0, "creation_date": 1438960242, "post_id": 31880896, "comment_id": 51679642, "body": "what about using an outer function that calls <code>demode</code> and returns the reversed result?"}, {"owner": {"reputation": 27, "user_id": 3869303, "user_type": "registered", "profile_image": "https://graph.facebook.com/1599977816/picture?type=large", "display_name": "As&#237; Maull&#243; Josetustra", "link": "https://stackoverflow.com/users/3869303/as%c3%ad-maull%c3%b3-josetustra"}, "edited": false, "score": 0, "creation_date": 1438960563, "post_id": 31880896, "comment_id": 51679832, "body": "demode 9 9 = [0 , 1] -&gt; 10, isn&#39;t it fine?   About the outer function: that I thought of and I mentioned it above. Sure it is easy and good enough for this case, but in some other cases it would have been useful. Also, it&#39;s never bad to improve your haskell grammar."}], "answers": [{"comments": [{"owner": {"reputation": 27, "user_id": 3869303, "user_type": "registered", "profile_image": "https://graph.facebook.com/1599977816/picture?type=large", "display_name": "As&#237; Maull&#243; Josetustra", "link": "https://stackoverflow.com/users/3869303/as%c3%ad-maull%c3%b3-josetustra"}, "edited": false, "score": 0, "creation_date": 1438961648, "post_id": 31881134, "comment_id": 51680538, "body": "Thanks! But what do you mean &quot;Haskell does allow you to define functions in where clauses (at least for now)&quot;, are there plans to forbid them in the future or something?  That scares me, I love the flexibility of where clauses, it makes everything much cleaner and easier."}, {"owner": {"reputation": 4328, "user_id": 1473927, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/AO6Ui.jpg?s=128&g=1", "display_name": "Jonathan Cast", "link": "https://stackoverflow.com/users/1473927/jonathan-cast"}, "reply_to_user": {"reputation": 27, "user_id": 3869303, "user_type": "registered", "profile_image": "https://graph.facebook.com/1599977816/picture?type=large", "display_name": "As&#237; Maull&#243; Josetustra", "link": "https://stackoverflow.com/users/3869303/as%c3%ad-maull%c3%b3-josetustra"}, "edited": false, "score": 0, "creation_date": 1438962021, "post_id": 31881134, "comment_id": 51680790, "body": "@As&#237;Maull&#243;Josetustra - Snarking about this: <a href=\"http://research.microsoft.com/en-us/um/people/simonpj/papers/constraints/let-gen.pdf\" rel=\"nofollow noreferrer\">research.microsoft.com/en-us/um/people/simonpj/papers/&hellip;</a> , mostly.  Presumably if few enough people use helper functions in <code>where</code> clauses it will eventually be removed as well."}, {"owner": {"reputation": 44013, "user_id": 1477667, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/trgKM.jpg?s=128&g=1", "display_name": "dfeuer", "link": "https://stackoverflow.com/users/1477667/dfeuer"}, "edited": false, "score": 0, "creation_date": 1439051292, "post_id": 31881134, "comment_id": 51707562, "body": "@jcast, when someone as skilled and experienced as Simon Peyton Jones says the type system is too complex to debug, it probably is. Let generalization is a freebie in HM, but in Glasgow Haskell, it&#39;s expensive and (since scoped type variables are available) not worth the price. As&#237;, you needn&#39;t worry about functions in <code>where</code> clauses--they&#39;re here to stay."}], "tags": [], "owner": {"reputation": 4328, "user_id": 1473927, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/AO6Ui.jpg?s=128&g=1", "display_name": "Jonathan Cast", "link": "https://stackoverflow.com/users/1473927/jonathan-cast"}, "is_accepted": true, "score": 1, "last_activity_date": 1438960326, "creation_date": 1438960326, "answer_id": 31881134, "question_id": 31880896, "link": "https://stackoverflow.com/questions/31880896/doing-something-on-the-final-result-of-a-recursive-function-whithin-the-same-fu/31881134#31881134", "title": "Doing something on the final result of a recursive function, whithin the same function", "body": "<p>Nope.  Your only hope is to use a helper function.  Note that Haskell <em>does</em> allow you to define functions in <code>where</code> clauses (at least for now), so that doesn't have to be a 'separate function' in the sense of a separate top-level definition.  You have basically two choices:</p>\n\n<p>Add an accumulator and do whatever work you want to do in the end:</p>\n\n<pre><code>demode n b = w n [] where\n    w 0 xn = reverse xn\n    w n xn = w d (xn ++ [m]) where\n        (d, m) = divMod n b\n</code></pre>\n\n<p>Hopefully you can follow how that would work, but note that, in this case, you are far better off saying</p>\n\n<pre><code>demode n b = w n [] where\n    w 0 xn = xn\n    w n xn = w d (m : xn) where\n        (d, m) = divMod n b\n</code></pre>\n\n<p>which builds the list in reversed order and returns that.</p>\n\n<p>Push the regular definition down to a helper function, and wrap that function in whatever work you want:</p>\n\n<pre><code>demode n b = reverse (w n) where\n    w 0 = []\n    w n = m : w d where\n        (d, m) = divMod n b\n</code></pre>\n\n<p>(I've used the term <code>w</code> as a short-hand for 'worker' in all three examples).</p>\n\n<p>Either case can generally benefit from learning to do your recursions using higher-order functions, instead.</p>\n\n<p>In general, it's somewhat bad style in Haskell to try to do 'everything in one function'; Haskell style is built around dividing a problem into multiple parts, solving those with separate functions, and composing the resulting functions together; <em>especially</em> if those functions will be useful elsewhere as well (which happens more often than you might naively expect).</p>\n"}], "owner": {"reputation": 27, "user_id": 3869303, "user_type": "registered", "profile_image": "https://graph.facebook.com/1599977816/picture?type=large", "display_name": "As&#237; Maull&#243; Josetustra", "link": "https://stackoverflow.com/users/3869303/as%c3%ad-maull%c3%b3-josetustra"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 83, "favorite_count": 0, "accepted_answer_id": 31881134, "answer_count": 1, "score": 1, "last_activity_date": 1438960326, "creation_date": 1438959613, "question_id": 31880896, "link": "https://stackoverflow.com/questions/31880896/doing-something-on-the-final-result-of-a-recursive-function-whithin-the-same-fu", "title": "Doing something on the final result of a recursive function, whithin the same function", "body": "<p>Easier to show than to explain. I have this tiny function to do base conversion from base 10:</p>\n\n<pre><code>demode 0 _ = [] \ndemode n b = m:(demode d b)\n where (d, m) = divMod n b\n</code></pre>\n\n<p>So, if we want to see how we would write 28 in base 9, demode 28 9 = [1,3].\nBut, of course, we have then to invert the list so it looks like a 31. \nThis could be easily made by making a function that calls 'demode' and then reverses it result, but with Haskell being so cool and all that there's probably a more elegant way of saying \"in the end case (demode 0 _), append everything to a list and then reverse the list\". </p>\n\n<p>Note that base conversion is just an example I'm using to illustrate the question, the real question is how to apply a final transformation to the last result of a recursive function. </p>\n"}, {"tags": ["performance", "haskell", "verlet-integration"], "comments": [{"owner": {"reputation": 1765, "user_id": 2181660, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/bda83eedd4ccbae9799c1fab98aed7ff?s=128&d=identicon&r=PG", "display_name": "viorior", "link": "https://stackoverflow.com/users/2181660/viorior"}, "edited": false, "score": 0, "creation_date": 1438944093, "post_id": 31875005, "comment_id": 51669125, "body": "try to write it tail-recursive"}, {"owner": {"reputation": 31243, "user_id": 2751851, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/4ddc0.png?s=128&g=1", "display_name": "duplode", "link": "https://stackoverflow.com/users/2751851/duplode"}, "reply_to_user": {"reputation": 1765, "user_id": 2181660, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/bda83eedd4ccbae9799c1fab98aed7ff?s=128&d=identicon&r=PG", "display_name": "viorior", "link": "https://stackoverflow.com/users/2181660/viorior"}, "edited": false, "score": 0, "creation_date": 1438944195, "post_id": 31875005, "comment_id": 51669181, "body": "@viorior That won&#39;t help..."}], "answers": [{"tags": [], "owner": {"reputation": 31243, "user_id": 2751851, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/4ddc0.png?s=128&g=1", "display_name": "duplode", "link": "https://stackoverflow.com/users/2751851/duplode"}, "is_accepted": true, "score": 5, "last_activity_date": 1438945970, "last_edit_date": 1438945970, "creation_date": 1438945046, "answer_id": 31876050, "question_id": 31875005, "link": "https://stackoverflow.com/questions/31875005/haskell-slow-infinite-list-for-verlet-integration/31876050#31876050", "title": "Haskell: Slow infinite list for Verlet Integration", "body": "<p>This definition...</p>\n\n<pre><code>verlet dt acc x0 x1 = x0 : x1 : next (verlet dt acc x0 x1)\n  where\n    next (xn : xs@(xn1:_)) = (verletStep dt acc xn xn1) : next xs\n</code></pre>\n\n<p>... leads to  <code>verlet dt acc x0 x1</code> being calculated many times unnecessarily, thus building a lot of unneeded lists. That can be seen by working out a time step by hand:</p>\n\n<pre><code>verlet dt acc x0 x1\nx0 : x1 : next (verlet dt acc x0 x1)\nx0 : x1 : next (x0 : x1 : next (verlet dt acc x0 x1))\nx0 : x1 : (verletStep dt acc x0 x1) : next (x1 : next (verlet dt acc x0 x1))\n</code></pre>\n\n<p>The solution is to eliminate the unnecessary list-building:</p>\n\n<pre><code>verlet dt acc x0 x1 = x0 : x1 : x2 : drop 2 (verlet dt acc x1 x2)\n  where\n     x2 = verletStep dt acc x0 x1\n</code></pre>\n\n<p><code>drop 2</code> removes the first two elements of a list (in this case, <code>x1</code> and <code>x2</code>, which we have already prepended). <code>verlet</code> is called recursively with the second position, <code>x1</code>, and the newly calculated third one, <code>x2</code>. (Compare with the original definition, in which <code>verlet</code> is called recursively with the same arguments. That should raise suspicion.)</p>\n"}], "owner": {"reputation": 1029, "user_id": 668074, "user_type": "registered", "accept_rate": 59, "profile_image": "https://www.gravatar.com/avatar/f82d3dd033cd691ad5340b9620bdcf38?s=128&d=identicon&r=PG", "display_name": "user668074", "link": "https://stackoverflow.com/users/668074/user668074"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 131, "favorite_count": 0, "accepted_answer_id": 31876050, "answer_count": 1, "score": 2, "last_activity_date": 1438945970, "creation_date": 1438941685, "question_id": 31875005, "link": "https://stackoverflow.com/questions/31875005/haskell-slow-infinite-list-for-verlet-integration", "title": "Haskell: Slow infinite list for Verlet Integration", "body": "<p>I am using Haskell to make a Verlet integrator to model gravity. The integrator uses the first two positions of the object as seeds and generates the rest after this.</p>\n\n<p>I thought a nice way of making this in Haskell would be to use an infinite list. However, when implemented I find that it runs very slowly for large times (Haskell 1700 time steps: 12 seconds, Python 1700 time steps: &lt; 1 second)</p>\n\n<p>Here is the relevant code for a 1d integrator that has similar performance:</p>\n\n<pre><code>verletStep dt acc xn xn1 = 2*xn1 - xn + (acc xn1)*dt*dt\n\nverlet dt acc x0 x1 = x0 : x1 : next (verlet dt acc x0 x1)\n  where\n    next (xn : xs@(xn1:_)) = (verletStep dt acc xn xn1) : next xs\n</code></pre>\n\n<p>I also tried using <code>zipWith</code> to generate the infinite list but it has similar performance.</p>\n\n<p>Why does this take so long? The garbage collection itself is around 5 seconds. Is there a nice way to make this run faster?</p>\n"}, {"tags": ["haskell", "hamlet", "shakespeare-text"], "answers": [{"tags": [], "owner": {"reputation": 49959, "user_id": 866915, "user_type": "registered", "accept_rate": 70, "profile_image": "https://www.gravatar.com/avatar/09242131d6e17cbbe31e8547514da6e5?s=128&d=identicon&r=PG", "display_name": "ErikR", "link": "https://stackoverflow.com/users/866915/erikr"}, "is_accepted": false, "score": 2, "last_activity_date": 1438932792, "creation_date": 1438932792, "answer_id": 31872035, "question_id": 31871425, "link": "https://stackoverflow.com/questions/31871425/separate-output-list-elements-by-delimiter-in-hamlet/31872035#31872035", "title": "separate output list elements by delimiter in hamlet", "body": "<p>I think you have to implement this kind of logic on the Haskell side, e.g.:</p>\n\n<pre><code>import Data.List (intercalate)\n\nmain = do\n  let xs = [1 :: Int, 2, 3 ]\n      str = intercalate \",\" $ map fmt xs\n      fmt 1 = \"ONE\"\n      fmt x = show x\n\n  ... [hamlet| #{str}] ...\n</code></pre>\n\n<p>Some visual effects which treat the first or last element of a sequence in a special way may also be implemented using CSS, i.e. using a <code>&lt;ul&gt;</code> and <code>&lt;li&gt;</code> tags.</p>\n"}, {"tags": [], "owner": {"reputation": 43759, "user_id": 1651941, "user_type": "registered", "accept_rate": 97, "profile_image": "https://www.gravatar.com/avatar/a513bc1fa519d2fcf5e4e0d9b5500101?s=128&d=identicon&r=PG", "display_name": "Sibi", "link": "https://stackoverflow.com/users/1651941/sibi"}, "is_accepted": true, "score": 1, "last_activity_date": 1438934545, "last_edit_date": 1438934545, "creation_date": 1438932815, "answer_id": 31872047, "question_id": 31871425, "link": "https://stackoverflow.com/questions/31871425/separate-output-list-elements-by-delimiter-in-hamlet/31872047#31872047", "title": "separate output list elements by delimiter in hamlet", "body": "<p>You can use <code>intersperse</code> function:</p>\n\n<pre><code>{-# LANGUAGE QuasiQuotes #-}\n\nimport Text.Blaze.Html.Renderer.String (renderHtml)\nimport Text.Hamlet (hamlet)\nimport Data.List (intersperse)\n\nmain = do\n  let xs = intersperse \",\" $ map show [1 :: Int, 2, 3]\n  putStrLn $ renderHtml $ [hamlet|\n                              $forall x &lt;- xs\n                                $if x == \"1\"\n                                  ONE\n                                $else\n                                  #{x}\n                              |] ()\n</code></pre>\n\n<p>That will produce this:</p>\n\n<pre><code>ONE,2,3\n</code></pre>\n\n<p>Note that <code>intersperse</code> will insert intermediate <code>,</code> between your list. So, in the hamlet quasiquoter, you just display the list:</p>\n\n<pre><code>\u03bb&gt; intersperse \",\" $ map show [1,2,3]\n[\"1\",\",\",\"2\",\",\",\"3\"]\n</code></pre>\n"}], "owner": {"reputation": 26022, "user_id": 410102, "user_type": "registered", "accept_rate": 93, "profile_image": "https://www.gravatar.com/avatar/a70b7da5a3a712e800100e61ef8d8917?s=128&d=identicon&r=PG", "display_name": "akonsu", "link": "https://stackoverflow.com/users/410102/akonsu"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 68, "favorite_count": 0, "accepted_answer_id": 31872047, "answer_count": 2, "score": 1, "last_activity_date": 1438934545, "creation_date": 1438930524, "question_id": 31871425, "link": "https://stackoverflow.com/questions/31871425/separate-output-list-elements-by-delimiter-in-hamlet", "title": "separate output list elements by delimiter in hamlet", "body": "<p>If I have the code below, how do I get rid of the last comma in the output? Is there a way to see where in the loop I am and whether I am at the end?</p>\n\n<pre><code>{-# LANGUAGE QuasiQuotes #-}\n\nimport Text.Blaze.Html.Renderer.String (renderHtml)\nimport Text.Hamlet (hamlet)\n\nmain = do\n  let xs = [1 :: Int, 2, 3]\n  putStrLn $ renderHtml $ [hamlet|\n                              $forall x &lt;- xs\n                                $if x == 1\n                                  ONE,\n                                $else\n                                  #{x},\n                              |] ()\n</code></pre>\n\n<p>This produces <code>ONE,2,3,</code>, I need <code>ONE,2,3</code>. For any arbitrary list of course. Please help.</p>\n"}, {"tags": ["haskell"], "comments": [{"owner": {"reputation": 23444, "user_id": 414413, "user_type": "registered", "accept_rate": 79, "profile_image": "https://www.gravatar.com/avatar/6de2113f01432aa844dc85070ff33e89?s=128&d=identicon&r=PG", "display_name": "Cirdec", "link": "https://stackoverflow.com/users/414413/cirdec"}, "edited": false, "score": 1, "creation_date": 1438932062, "post_id": 31871349, "comment_id": 51661789, "body": "Have you tried a closed type family that&#39;s unit/void/something absurd for every non-<code>Int</code> type?"}, {"owner": {"reputation": 1765, "user_id": 2181660, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/bda83eedd4ccbae9799c1fab98aed7ff?s=128&d=identicon&r=PG", "display_name": "viorior", "link": "https://stackoverflow.com/users/2181660/viorior"}, "edited": false, "score": 0, "creation_date": 1438934387, "post_id": 31871349, "comment_id": 51663066, "body": "Generally speaking, you could do even more: <code>&gt; :t FGen (2 :: Int) ; FGen (2 :: Int) :: F Int</code>"}, {"owner": {"reputation": 100185, "user_id": 3234959, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/93bb12ca0f93dfddb33880316f7e66c2?s=128&d=identicon&r=PG&f=1", "display_name": "chi", "link": "https://stackoverflow.com/users/3234959/chi"}, "edited": false, "score": 0, "creation_date": 1438938484, "post_id": 31871349, "comment_id": 51665668, "body": "GHC handling of unsatisfiable contexts is rather peculiar in cases like this. One would expect it to follow &quot;ex falso quod libet&quot;."}, {"owner": {"reputation": 27942, "user_id": 96982, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/rX1ss.png?s=128&g=1", "display_name": "GS - Apologise to Monica", "link": "https://stackoverflow.com/users/96982/gs-apologise-to-monica"}, "reply_to_user": {"reputation": 23444, "user_id": 414413, "user_type": "registered", "accept_rate": 79, "profile_image": "https://www.gravatar.com/avatar/6de2113f01432aa844dc85070ff33e89?s=128&d=identicon&r=PG", "display_name": "Cirdec", "link": "https://stackoverflow.com/users/414413/cirdec"}, "edited": false, "score": 0, "creation_date": 1438970440, "post_id": 31871349, "comment_id": 51685496, "body": "@Cirdec - interesting idea, what would I do with the type family?"}], "answers": [{"comments": [{"owner": {"reputation": 100185, "user_id": 3234959, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/93bb12ca0f93dfddb33880316f7e66c2?s=128&d=identicon&r=PG&f=1", "display_name": "chi", "link": "https://stackoverflow.com/users/3234959/chi"}, "edited": false, "score": 0, "creation_date": 1438938771, "post_id": 31872038, "comment_id": 51665827, "body": "Nice. This a case where I really wish GHC exhaustiveness checker was better: it correctly generates no warning for the empty case (good!), but it also does the same if I move to <code>F Int -&gt; Int</code> (bad!). (GHC 7.8 here -- I don&#39;t know whether GHC 7.10 fixed this)"}, {"owner": {"reputation": 27942, "user_id": 96982, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/rX1ss.png?s=128&g=1", "display_name": "GS - Apologise to Monica", "link": "https://stackoverflow.com/users/96982/gs-apologise-to-monica"}, "edited": false, "score": 2, "creation_date": 1438970231, "post_id": 31872038, "comment_id": 51685393, "body": "Thanks! The key points as I see them are to turn the impossible class context into an impossible value with the <code>:~:</code> GADT (the one in the library isn&#39;t special though normally it&#39;s the most logical one to use - I could define my own if I want) and also to use empty case expressions to implement <code>absurd</code>."}], "tags": [], "owner": {"reputation": 28873, "user_id": 1068232, "user_type": "registered", "accept_rate": 79, "profile_image": "https://www.gravatar.com/avatar/2a0a145ce58c20013969fe3f203531da?s=128&d=identicon&r=PG", "display_name": "Andr&#225;s Kov&#225;cs", "link": "https://stackoverflow.com/users/1068232/andr%c3%a1s-kov%c3%a1cs"}, "is_accepted": true, "score": 6, "last_activity_date": 1438940859, "last_edit_date": 1438940859, "creation_date": 1438932795, "answer_id": 31872038, "question_id": 31871349, "link": "https://stackoverflow.com/questions/31871349/can-i-have-a-polymorphic-function-argument-that-may-not-need-to-be-supplied-for/31872038#31872038", "title": "Can I have a polymorphic function argument that may not need to be supplied for some types?", "body": "<p>We can use the propositional equality type in <a href=\"https://downloads.haskell.org/~ghc/latest/docs/html/libraries/base-4.8.1.0/Data-Type-Equality.html\" rel=\"nofollow\"><code>Data.Type.Equality</code></a> and we can also express inaccessibility of code from GHC 7.8, using empty case expressions:</p>\n\n<pre><code>{-# LANGUAGE GADTs, RankNTypes, EmptyCase, TypeOperators #-}\n\nimport Data.Type.Equality   \n\ndata F a where\n   FGen :: a -&gt; F a\n   FInt :: F Int\n\ntransform :: (a -&gt; b) -&gt; ((a :~: Int) -&gt; b) -&gt; F a -&gt; b\ntransform f i (FGen v) = f v\ntransform f i FInt = i Refl\n\ntransformChar :: F Char -&gt; Char\ntransformChar = transform id (\\p -&gt; case p of {})\n-- or (\\case {}) with LambdaCase\n\ntransformInt :: F Int -&gt; Int\ntransformInt = transform (+1) (const 5)\n</code></pre>\n"}, {"comments": [{"owner": {"reputation": 28873, "user_id": 1068232, "user_type": "registered", "accept_rate": 79, "profile_image": "https://www.gravatar.com/avatar/2a0a145ce58c20013969fe3f203531da?s=128&d=identicon&r=PG", "display_name": "Andr&#225;s Kov&#225;cs", "link": "https://stackoverflow.com/users/1068232/andr%c3%a1s-kov%c3%a1cs"}, "edited": false, "score": 1, "creation_date": 1438979295, "post_id": 31886000, "comment_id": 51689895, "body": "Tip: this would be more reusable with a distinct <code>(==)</code> type family that returns lifted <code>Bool</code>-s and an <code>IsTrue b</code> type family that converts the lifted bools into <code>()</code> or <code>Void</code>."}], "tags": [], "owner": {"reputation": 23444, "user_id": 414413, "user_type": "registered", "accept_rate": 79, "profile_image": "https://www.gravatar.com/avatar/6de2113f01432aa844dc85070ff33e89?s=128&d=identicon&r=PG", "display_name": "Cirdec", "link": "https://stackoverflow.com/users/414413/cirdec"}, "is_accepted": false, "score": 4, "last_activity_date": 1438980409, "last_edit_date": 1495539843, "creation_date": 1438978789, "answer_id": 31886000, "question_id": 31871349, "link": "https://stackoverflow.com/questions/31871349/can-i-have-a-polymorphic-function-argument-that-may-not-need-to-be-supplied-for/31886000#31886000", "title": "Can I have a polymorphic function argument that may not need to be supplied for some types?", "body": "<p>I like the answer with a <a href=\"https://stackoverflow.com/a/31872038/414413\">GADT for the type equality proof</a> better. This answer explains how to do the same thing with <code>TypeFamilies</code>. With closed type families we can write functions from types to the unit <code>()</code> and zero <code>Void</code> of the type system to represent prepositional truth and false.</p>\n\n<pre><code>{-# LANGUAGE TypeFamilies #-}\n\nimport Data.Void\n\ntype family IsInt a where\n    IsInt Int = ()\n    IsInt a   = Void\n</code></pre>\n\n<p>The second argument to <code>transform</code> is <code>() -&gt; b</code> when <code>IsInt a</code> and <code>Void -&gt; b</code> (the type of <code>absurd</code>) when <code>a</code> isn't an integer.</p>\n\n<pre><code>transform :: (a -&gt; b) -&gt; (IsInt a -&gt; b) -&gt; F a -&gt; b\ntransform f i (FGen v) = f v\ntransform f i FInt = i ()\n</code></pre>\n\n<p><code>transformChar</code> can be written in terms of <code>absurd</code> and <code>transformInt</code> must pass in <code>b</code> as a constant function.</p>\n\n<pre><code>transformChar :: F Char -&gt; Char\ntransformChar = transform id absurd\n\ntransformInt :: F Int -&gt; Int\ntransformInt = transform (+1) (const 5)\n</code></pre>\n\n<h3>More Reusable</h3>\n\n<p>At <a href=\"https://stackoverflow.com/users/1068232/andr%c3%a1s-kov%c3%a1cs\">Andr\u00e1s Kov\u00e1cs</a> suggestion, we can make this more reusable with a type family for type equality <code>(==)</code> that returns lifted <code>Bool</code>s.</p>\n\n<pre><code>{-# LANGUAGE TypeFamilies #-}\n{-# LANGUAGE TypeOperators #-}\n{-# LANGUAGE DataKinds #-}\n\ntype family (==) a b :: Bool where\n    (==) a a = True\n    (==) a b = False\n</code></pre>\n\n<p>We could provide another type family to convert <code>True</code> to <code>()</code> and <code>False</code> to <code>Void</code>. For this specific problem it reads better to go all the way from <code>True</code> or <code>False</code> and some type <code>b</code> to <code>() -&gt; b</code> or <code>Void -&gt; b</code>.</p>\n\n<pre><code>type family When p b where\n    When True  b = ()   -&gt; b\n    When False b = Void -&gt; b\n</code></pre>\n\n<p>The type of <code>transform</code> then reads.</p>\n\n<pre><code>transform :: (a -&gt; b) -&gt; When (a == Int) b -&gt; F a -&gt; b\n</code></pre>\n"}], "owner": {"reputation": 27942, "user_id": 96982, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/rX1ss.png?s=128&g=1", "display_name": "GS - Apologise to Monica", "link": "https://stackoverflow.com/users/96982/gs-apologise-to-monica"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 158, "favorite_count": 1, "accepted_answer_id": 31872038, "answer_count": 2, "score": 10, "last_activity_date": 1438980409, "creation_date": 1438930160, "last_edit_date": 1438938899, "question_id": 31871349, "link": "https://stackoverflow.com/questions/31871349/can-i-have-a-polymorphic-function-argument-that-may-not-need-to-be-supplied-for", "title": "Can I have a polymorphic function argument that may not need to be supplied for some types?", "body": "<p>I have a datatype <code>F</code> with a special-case for <code>Int</code>:</p>\n\n<pre><code>{-# LANGUAGE GADTs, RankNTypes #-}\ndata F a where\n   FGen :: a -&gt; F a\n   FInt :: F Int\n</code></pre>\n\n<p>Without exposing the details of this datatype to callers - the real datatype is more complicated containing internal implementation details - I want to provide an API for using it:</p>\n\n<pre><code>transform :: (a -&gt; b) -&gt; b -&gt; F a -&gt; b\ntransform f i (FGen v) = f v\ntransform f i FInt = i\n</code></pre>\n\n<p>If I'm going to call <code>transform</code> on a <code>F Int</code>, clearly both of the first two arguments are important:</p>\n\n<pre><code>transformInt :: F Int -&gt; Int\ntransformInt = transform (+1) 5\n</code></pre>\n\n<p>But if I'm going to call it on a <code>F Char</code>, the second argument is unnecessary as the value can't be a <code>FInt</code>:</p>\n\n<pre><code>transformChar :: F Char -&gt; Char\ntransformChar = transform id (error \"unreachable code\")\n</code></pre>\n\n<p>Is there a way I can express this in the type of <code>transform</code>?</p>\n\n<p>I tried</p>\n\n<pre><code>transform :: (a -&gt; b) -&gt; (a ~ Int =&gt; b) -&gt; F a -&gt; b\ntransform f i (FGen v) = f v\ntransform f i FInt = i\n</code></pre>\n\n<p>but then <code>transformChar</code> doesn't compile with</p>\n\n<pre><code>    Couldn't match type \u2018Char\u2019 with \u2018Int\u2019\n    Inaccessible code in\n      a type expected by the context: (Char ~ Int) =&gt; Char\n    In the second argument of \u2018transform\u2019, namely\n      \u2018(error \"unreachable code\")\u2019\n    In the expression: transform id (error \"unreachable code\")\n    In an equation for \u2018transformChar\u2019:\n        transformChar = transform id (error \"unreachable code\")\n</code></pre>\n\n<p>and anyway I'd still want <code>absurd</code> value I could use instead of the error to  properly express that the compiler should be able to prove the code will never be used.</p>\n"}, {"tags": ["haskell", "indentation"], "answers": [{"comments": [{"owner": {"reputation": 1376, "user_id": 5200466, "user_type": "registered", "accept_rate": 81, "profile_image": "https://www.gravatar.com/avatar/abb1362cec6e1f0a2416a6d98a93cd6c?s=128&d=identicon&r=PG&f=1", "display_name": "matt", "link": "https://stackoverflow.com/users/5200466/matt"}, "edited": false, "score": 0, "creation_date": 1438938865, "post_id": 31869357, "comment_id": 51665896, "body": "Thank you for your reply. I thought I was aligning stuff properly but clearly not."}], "tags": [], "owner": {"reputation": 31243, "user_id": 2751851, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/4ddc0.png?s=128&g=1", "display_name": "duplode", "link": "https://stackoverflow.com/users/2751851/duplode"}, "is_accepted": true, "score": 4, "last_activity_date": 1438919423, "last_edit_date": 1495539835, "creation_date": 1438919109, "answer_id": 31869357, "question_id": 31869122, "link": "https://stackoverflow.com/questions/31869122/parse-error-on-input-if/31869357#31869357", "title": "Parse error on input &#39;if&#39;", "body": "<p>Because whitespace is significant in Haskell. You need to either follow the indentation rules or use explicit braces and semicolons (as in your second code block). Here are two ways (there are others) to fix the first block:</p>\n\n<pre><code>sgetLine  =  do  x &lt;- getChar\n                 if x == '\\n' \n                   then do \n                     putChar x\n                     return []\n                   else do \n                     putChar '_'\n                     xs &lt;- sgetLine\n                     return (x:xs)\n\n-- I prefer this one. In any case, it's just a matter of style, so YMMV.\nsgetLine  =  do  \n  x &lt;- getChar\n  if x == '\\n' \n    then do \n      putChar x\n      return []\n    else do \n      putChar '_'\n      xs &lt;- sgetLine\n      return (x:xs)\n</code></pre>\n\n<p>The lines in within a <code>do</code> block must be indented by the same amount, and also be indented to the right of the line with <code>do</code>. That way, the compiler can figure out where your <code>do</code> block begins and ends without you having to write explicit braces.</p>\n\n<p>See also: <a href=\"https://stackoverflow.com/q/2223468/2751851\">Haskell \u201cwhere\u201d indentation: why must it be indented past identifier?</a> The question is about <code>where</code> rather than <code>do</code>, but the general principle is the same, and the answers there cover it well.</p>\n"}, {"comments": [{"owner": {"reputation": 1376, "user_id": 5200466, "user_type": "registered", "accept_rate": 81, "profile_image": "https://www.gravatar.com/avatar/abb1362cec6e1f0a2416a6d98a93cd6c?s=128&d=identicon&r=PG&f=1", "display_name": "matt", "link": "https://stackoverflow.com/users/5200466/matt"}, "edited": false, "score": 0, "creation_date": 1438938921, "post_id": 31869607, "comment_id": 51665925, "body": "I think this was exactly my problem. Things looked aligned in my editor (but then when I cut and paste here .. it wasn&#39;t). The link is helpful. Thanks for your help."}], "tags": [], "owner": {"reputation": 126897, "user_id": 791604, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/ce991df7a056248d5e4f6fc3659ba733?s=128&d=identicon&r=PG", "display_name": "Daniel Wagner", "link": "https://stackoverflow.com/users/791604/daniel-wagner"}, "is_accepted": false, "score": 1, "last_activity_date": 1438920846, "creation_date": 1438920846, "answer_id": 31869607, "question_id": 31869122, "link": "https://stackoverflow.com/questions/31869122/parse-error-on-input-if/31869607#31869607", "title": "Parse error on input &#39;if&#39;", "body": "<p>I suspect you have set a five-space tabstop, which makes the <code>x &lt;- getChar</code> and <code>if x == '\\n'</code> lines appear lined up on your screen. However, the compiler uses eight-space tabstops, so the <code>if x == '\\n'</code> line appears much more indented to the compiler.</p>\n\n<p>You should use spaces for alignment, reserving tabs for indentation. (Many people will suggest using only spaces, <a href=\"http://dmwit.com/tabs\" rel=\"nofollow\">but I won't</a>.)</p>\n"}], "owner": {"reputation": 1376, "user_id": 5200466, "user_type": "registered", "accept_rate": 81, "profile_image": "https://www.gravatar.com/avatar/abb1362cec6e1f0a2416a6d98a93cd6c?s=128&d=identicon&r=PG&f=1", "display_name": "matt", "link": "https://stackoverflow.com/users/5200466/matt"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 1574, "favorite_count": 0, "accepted_answer_id": 31869357, "answer_count": 2, "score": 2, "last_activity_date": 1438920846, "creation_date": 1438917296, "last_edit_date": 1438919277, "question_id": 31869122, "link": "https://stackoverflow.com/questions/31869122/parse-error-on-input-if", "title": "Parse error on input &#39;if&#39;", "body": "<p>I can't seem to figure out why this code does not work:</p>\n\n<pre><code>sgetLine  =  do  x &lt;- getChar\n              if x == '\\n' \n                 then do \n                  putChar x\n                  return []\n                 else do \n                  putChar '_'\n                  xs &lt;- sgetLine\n                  return (x:xs) \n</code></pre>\n\n<p>and strangely enough, the code works when i do this</p>\n\n<pre><code>sgetLine  =  do { x &lt;- getChar\n            ; if  x == '\\n' \n                then do \n                 putChar x\n                 return []\n                else do \n                 putChar '_'\n                 xs &lt;- sgetLine\n                 return (x:xs)}\n</code></pre>\n\n<p>Thank you for your help!</p>\n"}, {"tags": ["haskell", "haskell-snap-framework"], "comments": [{"owner": {"reputation": 126897, "user_id": 791604, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/ce991df7a056248d5e4f6fc3659ba733?s=128&d=identicon&r=PG", "display_name": "Daniel Wagner", "link": "https://stackoverflow.com/users/791604/daniel-wagner"}, "edited": false, "score": 0, "creation_date": 1438899555, "post_id": 31866627, "comment_id": 51652627, "body": "Just to double-check: does <code>cabal install -fdevelopment</code>, as suggested in <a href=\"http://snapframework.com/docs/quickstart\" rel=\"nofollow noreferrer\">the quick-start guide</a>, work for you?"}, {"owner": {"reputation": 14781, "user_id": 630160, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/4445f21326af525a8ad19af7e3ae41a8?s=128&d=identicon&r=PG", "display_name": "epsilonhalbe", "link": "https://stackoverflow.com/users/630160/epsilonhalbe"}, "reply_to_user": {"reputation": 126897, "user_id": 791604, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/ce991df7a056248d5e4f6fc3659ba733?s=128&d=identicon&r=PG", "display_name": "Daniel Wagner", "link": "https://stackoverflow.com/users/791604/daniel-wagner"}, "edited": false, "score": 0, "creation_date": 1438899804, "post_id": 31866627, "comment_id": 51652708, "body": "one moment I&#39;ll have to try"}, {"owner": {"reputation": 14781, "user_id": 630160, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/4445f21326af525a8ad19af7e3ae41a8?s=128&d=identicon&r=PG", "display_name": "epsilonhalbe", "link": "https://stackoverflow.com/users/630160/epsilonhalbe"}, "reply_to_user": {"reputation": 126897, "user_id": 791604, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/ce991df7a056248d5e4f6fc3659ba733?s=128&d=identicon&r=PG", "display_name": "Daniel Wagner", "link": "https://stackoverflow.com/users/791604/daniel-wagner"}, "edited": false, "score": 0, "creation_date": 1438901144, "post_id": 31866627, "comment_id": 51653153, "body": "I do not know why it is building -but as I wrote I tried using the snap-loader-dynamic, nevertheless I tried modifying the Site.hs from the freshly built app, and I also modified the login.tpl (just added a word) but it did not recompile. - To not make sure I&#39;ll be a fool - i opened the site in chrome - and then it recompiled - lazyness - bit me (again) the recompilation only happens when the site is requested! - thanks!"}, {"owner": {"reputation": 14781, "user_id": 630160, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/4445f21326af525a8ad19af7e3ae41a8?s=128&d=identicon&r=PG", "display_name": "epsilonhalbe", "link": "https://stackoverflow.com/users/630160/epsilonhalbe"}, "reply_to_user": {"reputation": 126897, "user_id": 791604, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/ce991df7a056248d5e4f6fc3659ba733?s=128&d=identicon&r=PG", "display_name": "Daniel Wagner", "link": "https://stackoverflow.com/users/791604/daniel-wagner"}, "edited": false, "score": 0, "creation_date": 1438901189, "post_id": 31866627, "comment_id": 51653167, "body": "could you make your comment an answer - I would like to accept it!"}], "answers": [{"comments": [{"owner": {"reputation": 7154, "user_id": 527460, "user_type": "registered", "accept_rate": 88, "profile_image": "https://www.gravatar.com/avatar/0cece5abd2f9ad9056f5ac3830ac0bfe?s=128&d=identicon&r=PG", "display_name": "mightybyte", "link": "https://stackoverflow.com/users/527460/mightybyte"}, "edited": false, "score": 0, "creation_date": 1438948947, "post_id": 31867304, "comment_id": 51672098, "body": "Also see this <a href=\"http://snapframework.com/faq#how-do-i-run-my-app-in-development-mode\" rel=\"nofollow noreferrer\">faq entry</a>."}], "tags": [], "owner": {"reputation": 126897, "user_id": 791604, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/ce991df7a056248d5e4f6fc3659ba733?s=128&d=identicon&r=PG", "display_name": "Daniel Wagner", "link": "https://stackoverflow.com/users/791604/daniel-wagner"}, "is_accepted": true, "score": 4, "last_activity_date": 1438902989, "creation_date": 1438902989, "answer_id": 31867304, "question_id": 31866627, "link": "https://stackoverflow.com/questions/31866627/automatically-restart-snap-server-after-changing-a-file/31867304#31867304", "title": "Automatically restart Snap server after changing a file", "body": "<p>Snap itself comes with this capability built-in. Assuming you initialized your project with <code>snap init</code>, just build your project by</p>\n\n<pre><code>cabal install -fdevelopment\n</code></pre>\n\n<p>and it will reload itself on the fly as necessary.</p>\n"}, {"comments": [{"owner": {"reputation": 14781, "user_id": 630160, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/4445f21326af525a8ad19af7e3ae41a8?s=128&d=identicon&r=PG", "display_name": "epsilonhalbe", "link": "https://stackoverflow.com/users/630160/epsilonhalbe"}, "edited": false, "score": 0, "creation_date": 1438951876, "post_id": 31877314, "comment_id": 51673905, "body": "Thanks - I will give this blogpost definitely some attention!"}], "tags": [], "owner": {"reputation": 7154, "user_id": 527460, "user_type": "registered", "accept_rate": 88, "profile_image": "https://www.gravatar.com/avatar/0cece5abd2f9ad9056f5ac3830ac0bfe?s=128&d=identicon&r=PG", "display_name": "mightybyte", "link": "https://stackoverflow.com/users/527460/mightybyte"}, "is_accepted": false, "score": 1, "last_activity_date": 1438949086, "creation_date": 1438949086, "answer_id": 31877314, "question_id": 31866627, "link": "https://stackoverflow.com/questions/31866627/automatically-restart-snap-server-after-changing-a-file/31877314#31877314", "title": "Automatically restart Snap server after changing a file", "body": "<p>Daniel's answer is definitely the right one.  However, if you want reloading that doesn't involve code changes, that is also possible too.  See <a href=\"http://devblog.soostone.com/posts/2013-06-17-snap-template-reloading.html\" rel=\"nofollow\">this blog post</a> for an example.</p>\n"}], "owner": {"reputation": 14781, "user_id": 630160, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/4445f21326af525a8ad19af7e3ae41a8?s=128&d=identicon&r=PG", "display_name": "epsilonhalbe", "link": "https://stackoverflow.com/users/630160/epsilonhalbe"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 205, "favorite_count": 0, "accepted_answer_id": 31867304, "answer_count": 2, "score": 0, "last_activity_date": 1438949086, "creation_date": 1438898892, "question_id": 31866627, "link": "https://stackoverflow.com/questions/31866627/automatically-restart-snap-server-after-changing-a-file", "title": "Automatically restart Snap server after changing a file", "body": "<p>I have started learning a bit about the snap framework, I found some tutorial on blaze snap and want to build a little web-app.</p>\n\n<p><strong>The tedious thing when changing code in the html section is that I have to\n<code>Ctrl+C</code> the existing Snap server, then <code>cabal run</code> to restart it again is there an easier way to do that.</strong></p>\n\n<p>I found the following util <a href=\"http://github.com/owainlewis/watchr\" rel=\"nofollow\">watchr</a> which allows for running a command after a certain file is being changed - which is definitely useful but I don't quite know how to apply it in this situation.</p>\n\n<p>Get a minimal working example - use the <code>snap init barebone</code> command and substitute the <code>src/Main.hs</code> with</p>\n\n<pre><code>{-# LANGUAGE OverloadedStrings #-}\nmodule Main where\n\nimport           Control.Monad (forM_)\nimport           Control.Applicative ((&lt;|&gt;))\nimport           Snap.Core\nimport           Snap.Util.FileServe\nimport           Snap.Http.Server\nimport           Snap.Blaze (blaze)\nimport qualified Data.Text as T\nimport qualified Text.Blaze.Html5 as H\n\nmain :: IO ()\nmain = quickHttpServe site\n\nsite :: Snap ()\nsite =\n    ifTop testHandler &lt;|&gt;\n    dir \"static\" (serveDirectory \".\")\n\ntestHandler :: Snap ()\ntestHandler = blaze $ H.docTypeHtml $\n    do H.head $ H.title \"SnaptestBlaze\"\n       H.body $ do H.p \"Blaze makes Html\"\n                   H.ul $ forM_ [1..10::Int] (H.li . H.toHtml)\n</code></pre>\n\n<p>and make sure to have <code>snap-blaze</code> and <code>blaze-html</code> in the corresponding <code>*.cabal</code> file.</p>\n\n<p>I also saw that there is a package <code>snap-loader-dynamic</code> which sounds promising, but I could not build the application for the dependencies required and the dependencies in the cabal sandbox had different hash values.</p>\n\n<p>I saw that there exists <code>stack</code> to eventually replace <code>cabal</code> in the long run, but I have not had enough time to check wether <code>stack</code> could do automatic rebuild &amp; restart.</p>\n\n<p>If the environment where I am developing is relevant: Linux (Mint) + cabal-sandbox.</p>\n"}, {"tags": ["haskell"], "comments": [{"owner": {"reputation": 4938, "user_id": 1465011, "user_type": "registered", "accept_rate": 98, "profile_image": "https://www.gravatar.com/avatar/5c11daff0c870a2b41ae9b907a136adf?s=128&d=identicon&r=PG", "display_name": "recursion.ninja", "link": "https://stackoverflow.com/users/1465011/recursion-ninja"}, "edited": false, "score": 3, "creation_date": 1438897811, "post_id": 31866379, "comment_id": 51652009, "body": "<code>ghc -fwarn-incomplete-patterns</code> seems appropriate..."}, {"owner": {"reputation": 22377, "user_id": 2288659, "user_type": "registered", "accept_rate": 90, "profile_image": "https://i.stack.imgur.com/bBg8v.png?s=128&g=1", "display_name": "Silvio Mayolo", "link": "https://stackoverflow.com/users/2288659/silvio-mayolo"}, "edited": false, "score": 5, "creation_date": 1438897852, "post_id": 31866379, "comment_id": 51652026, "body": "It should give a warning if compiled with -Wall. Specifically, the flag -fwarn-incomplete-patterns checks for this"}], "answers": [{"comments": [{"owner": {"reputation": 552, "user_id": 4352736, "user_type": "registered", "accept_rate": 67, "profile_image": "https://i.stack.imgur.com/zj7vK.jpg?s=128&g=1", "display_name": "Crazy Psychild", "link": "https://stackoverflow.com/users/4352736/crazy-psychild"}, "edited": false, "score": 0, "creation_date": 1438897867, "post_id": 31866408, "comment_id": 51652032, "body": "OK and can you tell which patterns I missed in above code?"}, {"owner": {"reputation": 22377, "user_id": 2288659, "user_type": "registered", "accept_rate": 90, "profile_image": "https://i.stack.imgur.com/bBg8v.png?s=128&g=1", "display_name": "Silvio Mayolo", "link": "https://stackoverflow.com/users/2288659/silvio-mayolo"}, "edited": false, "score": 1, "creation_date": 1438897905, "post_id": 31866408, "comment_id": 51652052, "body": "&quot; &quot; is a string containing one space. [] is the empty list, which is also the empty string. You could also have written &quot;&quot;, without the space."}, {"owner": {"reputation": 64805, "user_id": 286871, "user_type": "registered", "accept_rate": 77, "profile_image": "https://i.stack.imgur.com/xNBpr.png?s=128&g=1", "display_name": "Tikhon Jelvis", "link": "https://stackoverflow.com/users/286871/tikhon-jelvis"}, "reply_to_user": {"reputation": 552, "user_id": 4352736, "user_type": "registered", "accept_rate": 67, "profile_image": "https://i.stack.imgur.com/zj7vK.jpg?s=128&g=1", "display_name": "Crazy Psychild", "link": "https://stackoverflow.com/users/4352736/crazy-psychild"}, "edited": false, "score": 1, "creation_date": 1438897907, "post_id": 31866408, "comment_id": 51652054, "body": "@AbhinavJain: You missed the empty string. (<code>&quot; &quot;</code> is the string with a single space character.)"}, {"owner": {"reputation": 64805, "user_id": 286871, "user_type": "registered", "accept_rate": 77, "profile_image": "https://i.stack.imgur.com/xNBpr.png?s=128&g=1", "display_name": "Tikhon Jelvis", "link": "https://stackoverflow.com/users/286871/tikhon-jelvis"}, "reply_to_user": {"reputation": 552, "user_id": 4352736, "user_type": "registered", "accept_rate": 67, "profile_image": "https://i.stack.imgur.com/zj7vK.jpg?s=128&g=1", "display_name": "Crazy Psychild", "link": "https://stackoverflow.com/users/4352736/crazy-psychild"}, "edited": false, "score": 0, "creation_date": 1438897937, "post_id": 31866408, "comment_id": 51652076, "body": "@AbhinavJain: The compiler will tell you if you turn this warning on and compile your code."}, {"owner": {"reputation": 552, "user_id": 4352736, "user_type": "registered", "accept_rate": 67, "profile_image": "https://i.stack.imgur.com/zj7vK.jpg?s=128&g=1", "display_name": "Crazy Psychild", "link": "https://stackoverflow.com/users/4352736/crazy-psychild"}, "edited": false, "score": 0, "creation_date": 1438898320, "post_id": 31866408, "comment_id": 51652210, "body": "@TikhonJelvis yes i just saw it."}], "tags": [], "owner": {"reputation": 64805, "user_id": 286871, "user_type": "registered", "accept_rate": 77, "profile_image": "https://i.stack.imgur.com/xNBpr.png?s=128&g=1", "display_name": "Tikhon Jelvis", "link": "https://stackoverflow.com/users/286871/tikhon-jelvis"}, "is_accepted": true, "score": 20, "last_activity_date": 1438898177, "last_edit_date": 1438898177, "creation_date": 1438897813, "answer_id": 31866408, "question_id": 31866379, "link": "https://stackoverflow.com/questions/31866379/non-exhaustive-pattern-matching-in-haskell/31866408#31866408", "title": "Non-exhaustive pattern matching in Haskell", "body": "<p>The pattern match warning is turned off by default. You can turn it on with the <code>-fwarn-incomplete-patterns</code> or as part of a larger bundle of warnings with <code>-W</code> and <code>-Wall</code>.</p>\n\n<p>You can do this from <code>ghci</code>:</p>\n\n<pre><code>Prelude&gt; :set -W\n</code></pre>\n\n<p>You can also pass the flag to <code>ghc</code> when you compile or include it as a pragma on top of your module:</p>\n\n<pre><code>{-# OPTIONS_GHC -fwarn-incomplete-patterns #-}\n</code></pre>\n\n<p>For your specific program, it should give the following warning:</p>\n\n<pre><code>/home/tjelvis/Documents/so/incomplete-patterns.hs:2:1: Warning:\n    Pattern match(es) are non-exhaustive\n    In an equation for \u2018repl\u2019: Patterns not matched: []\n</code></pre>\n"}], "owner": {"reputation": 552, "user_id": 4352736, "user_type": "registered", "accept_rate": 67, "profile_image": "https://i.stack.imgur.com/zj7vK.jpg?s=128&g=1", "display_name": "Crazy Psychild", "link": "https://stackoverflow.com/users/4352736/crazy-psychild"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 3451, "favorite_count": 3, "accepted_answer_id": 31866408, "answer_count": 1, "score": 19, "last_activity_date": 1576928279, "creation_date": 1438897683, "last_edit_date": 1576928279, "question_id": 31866379, "link": "https://stackoverflow.com/questions/31866379/non-exhaustive-pattern-matching-in-haskell", "title": "Non-exhaustive pattern matching in Haskell", "body": "<p>I am learning Haskell and wanted to write a simple program which just repeats each letter in a string twice.</p>\n\n<p>I came up with this:</p>\n\n<pre><code>repl :: String -&gt; String\nrepl \" \" = \" \"\nrepl (x:xs) = x:x:repl xs\n</code></pre>\n\n<p>When compiling, I didnt get any warning but a run-time error occurred when I did <code>repl \"abcd\"</code>:</p>\n\n<blockquote>\n  <p>\"abcd*** Exception: repl.hs:(2,1)-(3,23): Non-exhaustive patterns in function repl</p>\n</blockquote>\n\n<p>Why did the compiler never report this and why is it ignored in Haskell when there are many languages like OCaml which clearly report this at compile time?</p>\n"}, {"tags": ["haskell", "recursion"], "comments": [{"owner": {"reputation": 4938, "user_id": 1465011, "user_type": "registered", "accept_rate": 98, "profile_image": "https://www.gravatar.com/avatar/5c11daff0c870a2b41ae9b907a136adf?s=128&d=identicon&r=PG", "display_name": "recursion.ninja", "link": "https://stackoverflow.com/users/1465011/recursion-ninja"}, "edited": false, "score": 4, "creation_date": 1438897647, "post_id": 31866344, "comment_id": 51651938, "body": "What are the type level errors? You should include them in your post!"}], "answers": [{"tags": [], "owner": {"reputation": 171740, "user_id": 869736, "user_type": "registered", "accept_rate": 82, "profile_image": "https://www.gravatar.com/avatar/671f732e3c68c387c702112a30e5ebd8?s=128&d=identicon&r=PG&f=1", "display_name": "Louis Wasserman", "link": "https://stackoverflow.com/users/869736/louis-wasserman"}, "is_accepted": true, "score": 3, "last_activity_date": 1438898848, "creation_date": 1438898848, "answer_id": 31866621, "question_id": 31866344, "link": "https://stackoverflow.com/questions/31866344/haskell-writing-foldr-recursively/31866621#31866621", "title": "Haskell - Writing foldr recursively", "body": "<p>That is not the type of the <code>foldr</code> function.  That is the type of the <code>map</code> function.</p>\n\n<p>But that said, <code>:</code> concatenates <em>one</em> element to the <em>front</em> of a list.  The way you are using it attempts to concatenate one element to the <em>end</em> of a list, which does not work.</p>\n\n<p>The closest thing to what you mean -- which is still O(n^2) and deeply inefficient -- is to replace the last line with </p>\n\n<pre><code>foldr f xs = foldr f (init xs) ++ [f (last xs)]\n</code></pre>\n"}], "owner": {"reputation": 55, "user_id": 5198967, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/17c94cbf5b76d82d66d0515918927fc8?s=128&d=identicon&r=PG&f=1", "display_name": "keepitreal", "link": "https://stackoverflow.com/users/5198967/keepitreal"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 156, "favorite_count": 0, "accepted_answer_id": 31866621, "answer_count": 1, "score": 0, "last_activity_date": 1438898848, "creation_date": 1438897498, "question_id": 31866344, "link": "https://stackoverflow.com/questions/31866344/haskell-writing-foldr-recursively", "title": "Haskell - Writing foldr recursively", "body": "<p>I am trying to write the library function foldr using recursion. However, I am getting syntax errors and not sure about the functional correctness. This is my code:</p>\n\n<pre><code>foldr :: (a -&gt; b) -&gt; [a] -&gt; [b]\nfoldr f [] = []\nfoldr f xs = foldr f (init xs) : f (last xs)      \n</code></pre>\n\n<p>I would appreciate it if I can get some help on this</p>\n"}, {"tags": ["haskell"], "answers": [{"comments": [{"owner": {"reputation": 23444, "user_id": 414413, "user_type": "registered", "accept_rate": 79, "profile_image": "https://www.gravatar.com/avatar/6de2113f01432aa844dc85070ff33e89?s=128&d=identicon&r=PG", "display_name": "Cirdec", "link": "https://stackoverflow.com/users/414413/cirdec"}, "edited": false, "score": 1, "creation_date": 1438900599, "post_id": 31865402, "comment_id": 51652954, "body": "There&#39;s no pattern to cover <code>filterLast p []</code>. This removes &quot;the last element in the list <i>if it</i> does not satisfy a property&quot; instead of removing &quot;the last element in the list <i>that</i> does not satisfy a property&quot;."}, {"owner": {"reputation": 75362, "user_id": 625403, "user_type": "registered", "accept_rate": 82, "profile_image": "https://www.gravatar.com/avatar/786eed7da67079cb5d63a49d469af25b?s=128&d=identicon&r=PG", "display_name": "amalloy", "link": "https://stackoverflow.com/users/625403/amalloy"}, "edited": false, "score": 2, "creation_date": 1438907099, "post_id": 31865402, "comment_id": 51654730, "body": "Agreed, this produces a different result from the function OP asked for on inputs like <code>[1,-2,3,-4]</code>: the function OP was evidently trying to write in the question would return <code>[1,-2,-4]</code>, whereas this answer returns <code>[1,-2,3,-4]</code>."}, {"owner": {"reputation": 51, "user_id": 5143743, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/011070436f964842c56a93b1e9990422?s=128&d=identicon&r=PG&f=1", "display_name": "flore77", "link": "https://stackoverflow.com/users/5143743/flore77"}, "edited": false, "score": 0, "creation_date": 1438974696, "post_id": 31865402, "comment_id": 51687629, "body": "yes, I understand your point of view, but from the example and from the question it&#39;s not very clear. yes, maybe I should have asked for more explanation, but my answer has been checked as the right one, so maybe this is what he was looking for. I don&#39;t understand the negative votes...haters :))"}], "tags": [], "owner": {"reputation": 51, "user_id": 5143743, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/011070436f964842c56a93b1e9990422?s=128&d=identicon&r=PG&f=1", "display_name": "flore77", "link": "https://stackoverflow.com/users/5143743/flore77"}, "is_accepted": true, "score": -4, "last_activity_date": 1438894001, "last_edit_date": 1438894001, "creation_date": 1438893671, "answer_id": 31865402, "question_id": 31864951, "link": "https://stackoverflow.com/questions/31864951/haskell-filter-last-element/31865402#31865402", "title": "Haskell - Filter Last Element", "body": "<pre><code>smallerOne :: (Ord a, Num a) =&gt; a -&gt; Bool \nsmallerOne x = x &lt; 1 \n\nfilterLast :: (a -&gt; Bool) -&gt; [a] -&gt; [a]\nfilterLast p (x:[]) = if (p x) then x:[] else []\nfilterLast p (x:xs) = x : filterLast p xs\n</code></pre>\n\n<p>This is the solution to your problem. Now, also some explanation:</p>\n\n<blockquote>\n  <p>smallerOne :: (Ord a, Num a) => a -> Bool</p>\n</blockquote>\n\n<p>you must include the class constraint <code>Ord</code> and <code>Num</code>, because your are trying to ordonate numbers through this <code>&lt;</code> comparison operator. You can read more here: <a href=\"http://learnyouahaskell.com/types-and-typeclasses#typeclasses-101\" rel=\"nofollow\">http://learnyouahaskell.com/types-and-typeclasses#typeclasses-101</a></p>\n\n<p><code>filterLast</code> is implemented through <code>pattern matching</code>, Haskell is pretty smart and will enter the branch that will match the given list, so he will enter this branch:</p>\n\n<blockquote>\n  <p>filterLast p (x:[]) = if (p x) then x:[] else []</p>\n</blockquote>\n\n<p>only when there is one element left, i.e your <code>last element</code>.</p>\n\n<p>You said you are a beginner, I really recommend you this tutorial, <a href=\"http://learnyouahaskell.com/chapters\" rel=\"nofollow\">http://learnyouahaskell.com/chapters</a>, it is pretty cool.</p>\n"}, {"tags": [], "owner": {"reputation": 126897, "user_id": 791604, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/ce991df7a056248d5e4f6fc3659ba733?s=128&d=identicon&r=PG", "display_name": "Daniel Wagner", "link": "https://stackoverflow.com/users/791604/daniel-wagner"}, "is_accepted": false, "score": 6, "last_activity_date": 1438895398, "last_edit_date": 1438895398, "creation_date": 1438894440, "answer_id": 31865638, "question_id": 31864951, "link": "https://stackoverflow.com/questions/31864951/haskell-filter-last-element/31865638#31865638", "title": "Haskell - Filter Last Element", "body": "<p>The minimal change that will cause <code>filterLast</code> to compile is to use <code>(++)</code> instead of <code>(:)</code>, as in:</p>\n\n<pre><code>filterLast p xs \n    | p (last xs) = filterLast p (init xs) ++ [last xs]\n</code></pre>\n\n<p>(Other lines remain the same.) The <code>(:)</code> function is specifically for putting a single extra element at the beginning of a list, which is not what you wanted to do here. For <code>smallerOne</code>, you may simply change the type signature in the way suggested by the error message, thus:</p>\n\n<pre><code>smallerOne :: (Num a, Ord a) =&gt; a-&gt;Bool\n</code></pre>\n"}, {"comments": [{"owner": {"reputation": 23444, "user_id": 414413, "user_type": "registered", "accept_rate": 79, "profile_image": "https://www.gravatar.com/avatar/6de2113f01432aa844dc85070ff33e89?s=128&d=identicon&r=PG", "display_name": "Cirdec", "link": "https://stackoverflow.com/users/414413/cirdec"}, "edited": false, "score": 1, "creation_date": 1438900430, "post_id": 31866367, "comment_id": 51652891, "body": "The example <code>f</code> reverses the sense of <code>p</code>. It could also be more productive so that the remainder of an infinite list need not be checked to yield the first of two items that fail to pass the filter."}, {"owner": {"reputation": 100185, "user_id": 3234959, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/93bb12ca0f93dfddb33880316f7e66c2?s=128&d=identicon&r=PG&f=1", "display_name": "chi", "link": "https://stackoverflow.com/users/3234959/chi"}, "edited": false, "score": 0, "creation_date": 1438900868, "post_id": 31866367, "comment_id": 51653049, "body": "<code>tail&#39; = drop 1</code>. Also, <code>dropHeadSnd = fmap (drop 1)</code> (a bit cryptic, though)."}, {"owner": {"reputation": 37, "user_id": 5199947, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/c478d77060616ab6948fa009c0f9dc37?s=128&d=identicon&r=PG", "display_name": "user5199947", "link": "https://stackoverflow.com/users/5199947/user5199947"}, "reply_to_user": {"reputation": 23444, "user_id": 414413, "user_type": "registered", "accept_rate": 79, "profile_image": "https://www.gravatar.com/avatar/6de2113f01432aa844dc85070ff33e89?s=128&d=identicon&r=PG", "display_name": "Cirdec", "link": "https://stackoverflow.com/users/414413/cirdec"}, "edited": false, "score": 0, "creation_date": 1438906562, "post_id": 31866367, "comment_id": 51654609, "body": "@Cirdec Reverses the sense of p? What? Your second point makes no sense at all either."}, {"owner": {"reputation": 75362, "user_id": 625403, "user_type": "registered", "accept_rate": 82, "profile_image": "https://www.gravatar.com/avatar/786eed7da67079cb5d63a49d469af25b?s=128&d=identicon&r=PG", "display_name": "amalloy", "link": "https://stackoverflow.com/users/625403/amalloy"}, "edited": false, "score": 0, "creation_date": 1438906938, "post_id": 31866367, "comment_id": 51654696, "body": "@user5199947 It is prohibitively expensive to reverse an infinite list. Consider <code>take 2 . filterLast (&lt; 1) $ repeat 1</code>: this should surely yield <code>[1,1]</code>, but you will try to reverse <code>repeat 1</code> and never succeed."}, {"owner": {"reputation": 23444, "user_id": 414413, "user_type": "registered", "accept_rate": 79, "profile_image": "https://www.gravatar.com/avatar/6de2113f01432aa844dc85070ff33e89?s=128&d=identicon&r=PG", "display_name": "Cirdec", "link": "https://stackoverflow.com/users/414413/cirdec"}, "edited": false, "score": 0, "creation_date": 1438907047, "post_id": 31866367, "comment_id": 51654719, "body": "Reverses the sense of <code>p</code> in that <code>f</code> removes the last item <code>x</code> for which <code>p x == True</code> instead of removing the last item for which <code>p x == False</code>. <code>filterLast p = f (not . p)</code>."}, {"owner": {"reputation": 23444, "user_id": 414413, "user_type": "registered", "accept_rate": 79, "profile_image": "https://www.gravatar.com/avatar/6de2113f01432aa844dc85070ff33e89?s=128&d=identicon&r=PG", "display_name": "Cirdec", "link": "https://stackoverflow.com/users/414413/cirdec"}, "edited": false, "score": 0, "creation_date": 1438907361, "post_id": 31866367, "comment_id": 51654792, "body": "In <code>f</code>, if you return the tuple regardless of the decisions you make and short-cut the flag calculation and whether to include the current item in the list you can produce values by evaluating as little of the list as possible. That&#39;s what we mean when we say &quot;more productive&quot;. <a href=\"https://gist.github.com/Cedev/c0cbd1ff7e70d0b7e53d\" rel=\"nofollow noreferrer\">gist.github.com/Cedev/c0cbd1ff7e70d0b7e53d</a>"}], "tags": [], "owner": {"reputation": 37, "user_id": 5199947, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/c478d77060616ab6948fa009c0f9dc37?s=128&d=identicon&r=PG", "display_name": "user5199947", "link": "https://stackoverflow.com/users/5199947/user5199947"}, "is_accepted": false, "score": -1, "last_activity_date": 1438900304, "last_edit_date": 1438900304, "creation_date": 1438897632, "answer_id": 31866367, "question_id": 31864951, "link": "https://stackoverflow.com/questions/31864951/haskell-filter-last-element/31866367#31866367", "title": "Haskell - Filter Last Element", "body": "<p>What you want to do is reverse the list and take elements while they dont satisfy the property. The moment an element satisfies a property, you drop it and take the rest of the list. This translates pretty naturally into haskell code.</p>\n\n<pre><code>filterLast :: (a -&gt; Bool) -&gt; [a] -&gt; [a]\nfilterLast p = reverse . uncurry (++) . dropHeadSnd . span p . reverse\n  where\n    dropHeadSnd (x, y) = (x, tail' y)\n    tail' [] = []\n    tail' (x:xs) = xs\n</code></pre>\n\n<p>The (++) reduces the efficiency of your code and while its not the asymptotic efficiency, eliminating the (++) will improve your performance.</p>\n\n<pre><code>filterLast :: (a -&gt; Bool) -&gt; [a] -&gt; [a]\nfilterLast p = reverse . helper . reverse\n  where\n    helper [] = [] \n    helper (x:xs) | p x = xs\n                  | otherwise = x:helper xs\n</code></pre>\n\n<p>Both of the above functions use two iterations over the list. However remember with recursion you can get information from both behind and ahead. We use the recursive call to figure out if there are any subsequent elements for which 'p' is satisfied.</p>\n\n<pre><code>f :: (a -&gt; Bool) -&gt; [a] -&gt; [a]\nf p = snd . helper \n where\n   helper [] = (False, [])\n   helper (a:as) | p a &amp;&amp; flag = (flag, a:as')\n                 | p a = (True, as')\n                 | otherwise = (flag, a:as')\n          where\n           (flag, as') = helper as\n</code></pre>\n"}, {"comments": [{"owner": {"reputation": 100185, "user_id": 3234959, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/93bb12ca0f93dfddb33880316f7e66c2?s=128&d=identicon&r=PG&f=1", "display_name": "chi", "link": "https://stackoverflow.com/users/3234959/chi"}, "edited": false, "score": 0, "creation_date": 1438937281, "post_id": 31867785, "comment_id": 51664874, "body": "On a finite list, how this compares to the <code>reverse</code> solution? Does the concatenation yields worse performance? Should we pass to difference lists instead?"}, {"owner": {"reputation": 11986, "user_id": 3237465, "user_type": "registered", "accept_rate": 76, "profile_image": "https://i.stack.imgur.com/vOArX.png?s=128&g=1", "display_name": "user3237465", "link": "https://stackoverflow.com/users/3237465/user3237465"}, "edited": false, "score": 0, "creation_date": 1438937590, "post_id": 31867785, "comment_id": 51665075, "body": "Your version doesn&#39;t work for <code>take 5 $ filterLast (&lt; 1) [-1, -2..]</code>. It&#39;s easy to fix that: <code>filterLast&#39; p xs = case span p xs of { (xs1 , xs2) -&gt; xs1 ++ filterLast p xs2 }</code>. There is probably a nicer solution, which incorporates this idea into <code>filterLast</code>, but I haven&#39;t found it."}, {"owner": {"reputation": 75362, "user_id": 625403, "user_type": "registered", "accept_rate": 82, "profile_image": "https://www.gravatar.com/avatar/786eed7da67079cb5d63a49d469af25b?s=128&d=identicon&r=PG", "display_name": "amalloy", "link": "https://stackoverflow.com/users/625403/amalloy"}, "edited": false, "score": 0, "creation_date": 1438981115, "post_id": 31867785, "comment_id": 51690707, "body": "Hm, good catch. I don&#39;t think <code>filterLast&#39;</code> is enough to fix it though, right, because then it just breaks for <code>10:[-1, -2..]</code>, doesn&#39;t it? On the other hand I guess it&#39;s impossible for anything to ever work on that input, since you can&#39;t ever find out whether to include 10."}], "tags": [], "owner": {"reputation": 75362, "user_id": 625403, "user_type": "registered", "accept_rate": 82, "profile_image": "https://www.gravatar.com/avatar/786eed7da67079cb5d63a49d469af25b?s=128&d=identicon&r=PG", "display_name": "amalloy", "link": "https://stackoverflow.com/users/625403/amalloy"}, "is_accepted": false, "score": 4, "last_activity_date": 1439571947, "last_edit_date": 1439571947, "creation_date": 1438906721, "answer_id": 31867785, "question_id": 31864951, "link": "https://stackoverflow.com/questions/31864951/haskell-filter-last-element/31867785#31867785", "title": "Haskell - Filter Last Element", "body": "<p>Here is one possible implementation of <code>filterLast</code>:</p>\n\n<pre><code>filterLast :: (a -&gt; Bool) -&gt; [a] -&gt; [a]\nfilterLast p = go []\n  where go chunk xs = case span p xs of\n          (left, []) -&gt; left\n          (left, (r:right)) -&gt; chunk ++ left ++ go [r] right\n</code></pre>\n\n<p>The idea is to repeatedly use <code>span</code> to split the sequence into two parts: a left half that all satisfy the predicate, and then a right half starting with the first element that doesn't satisfy it. If there is no right half, then we can just return the left half untouched. Otherwise, we have to:</p>\n\n<ol>\n<li>Save off the first element of the right half as a \"candidate\" item that will only be included if we can find a later element that doesn't satisfy the predicate</li>\n<li>Include the previous candidate element, if any, in the result.</li>\n</ol>\n\n<p>This is substantially more efficient for large lists (and especially infinite lists!) than the approach used in your question, with repeated calls to <code>last</code> and <code>init</code>. But if this is not an important concern for you, then simply applying the fixes suggested in Daniel Wagner's answer will get you a function that you will find easier to understand.</p>\n\n<p><strong>Edit</strong>: As suggested in the comments, you can fix one corner case (an infinite list of items that all satisfy the predicate) by renaming this function to <code>filterLast'</code> and then defining a new <code>filterLast</code> that delegates to it:</p>\n\n<pre><code>filterLast :: (a -&gt; Bool) -&gt; [a] -&gt; [a]\nfilterLast p xs = left ++ filterLast' p right\n  where (left, right) = span p xs\n</code></pre>\n\n<p>Note that there are still some sequences where this diverges without ever producing output, such as <code>filterLast (&lt; 1) $ 10 : repeat -1</code>. But I think it's impossible for any implementation to address that, because you never find out whether or not to include the <code>10</code> in the output list, since you never find another element greater than 1.</p>\n"}], "owner": {"reputation": 55, "user_id": 5198967, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/17c94cbf5b76d82d66d0515918927fc8?s=128&d=identicon&r=PG&f=1", "display_name": "keepitreal", "link": "https://stackoverflow.com/users/5198967/keepitreal"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 836, "favorite_count": 0, "accepted_answer_id": 31865402, "answer_count": 4, "score": 5, "last_activity_date": 1439571947, "creation_date": 1438892036, "question_id": 31864951, "link": "https://stackoverflow.com/questions/31864951/haskell-filter-last-element", "title": "Haskell - Filter Last Element", "body": "<p>I want to filter the last element of a list that does not satisfy a property. An example would be </p>\n\n<pre><code>smallerOne :: a-&gt;Bool \nsmallerOne x = x &lt; 1 \n</code></pre>\n\n<p>The function filterLast should give </p>\n\n<pre><code>filterLast smallerOne [1, -2, -3, -4, 5] \n[1, -2, -3, -4] //Filters the last element that is not smaller than 1 \n</code></pre>\n\n<p>Here is my code (I am a beginner so sorry for the bad attempt) </p>\n\n<pre><code>filterLast :: (a -&gt; Bool) -&gt; [a] -&gt; [a] \nfilterLast p [] = [] \nfilterLast p xs \n    | p (last xs) = filterLast p (init xs) : last xs \n    | otherwise = init xs \n</code></pre>\n\n<p>Thank you for your help</p>\n"}, {"tags": ["haskell"], "comments": [{"owner": {"reputation": 126897, "user_id": 791604, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/ce991df7a056248d5e4f6fc3659ba733?s=128&d=identicon&r=PG", "display_name": "Daniel Wagner", "link": "https://stackoverflow.com/users/791604/daniel-wagner"}, "edited": false, "score": 2, "creation_date": 1438893609, "post_id": 31864667, "comment_id": 51649899, "body": "I&#39;m not sure I understand everything yet. For example, you say &quot;container <code>y</code> shall contain another set of instances <code>X y z</code>&quot;, but how do you plan to ensure that? Why do you want to restrict <code>Prop2 (X y z) z</code> instances in the way you suggest? (It looks nonsensical to me -- in fact, <code>instance Prop1 y (X y z)</code> already looks nonsensical.) In short: what are you actually trying to do? I appreciate a good abstract question as much as the next guy; but this one smells a lot like an X/Y problem, so I encourage you to include as many practical/motivational details as you feel comfortable including."}, {"owner": {"reputation": 5681, "user_id": 3040064, "user_type": "registered", "accept_rate": 59, "profile_image": "https://www.gravatar.com/avatar/02e7081757e69605a91b7f7aea47f4ae?s=128&d=identicon&r=PG&f=1", "display_name": "Jason Hu", "link": "https://stackoverflow.com/users/3040064/jason-hu"}, "reply_to_user": {"reputation": 126897, "user_id": 791604, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/ce991df7a056248d5e4f6fc3659ba733?s=128&d=identicon&r=PG", "display_name": "Daniel Wagner", "link": "https://stackoverflow.com/users/791604/daniel-wagner"}, "edited": false, "score": 0, "creation_date": 1438894111, "post_id": 31864667, "comment_id": 51650207, "body": "@DanielWagner i am exploring data structure bootstrapping in haskell. that&#39;s how the type should be defined in theory. i am pretty much sure it&#39;s not an xy problem, since that&#39;s the problem i encountered during implementation."}, {"owner": {"reputation": 126897, "user_id": 791604, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/ce991df7a056248d5e4f6fc3659ba733?s=128&d=identicon&r=PG", "display_name": "Daniel Wagner", "link": "https://stackoverflow.com/users/791604/daniel-wagner"}, "edited": false, "score": 2, "creation_date": 1438894821, "post_id": 31864667, "comment_id": 51650600, "body": "&quot;Y is the problem I encountered during implementation of X&quot; is pretty much the definition of how an X/Y problem arises -- all that&#39;s needed to fit the bill is to avoid talking about X entirely, as you did in this question. Do include details about what data structure bootstrapping is, what it&#39;s for, and what you&#39;re trying to do with it."}], "answers": [{"comments": [{"owner": {"reputation": 5681, "user_id": 3040064, "user_type": "registered", "accept_rate": 59, "profile_image": "https://www.gravatar.com/avatar/02e7081757e69605a91b7f7aea47f4ae?s=128&d=identicon&r=PG&f=1", "display_name": "Jason Hu", "link": "https://stackoverflow.com/users/3040064/jason-hu"}, "edited": false, "score": 0, "creation_date": 1438892142, "post_id": 31864929, "comment_id": 51649114, "body": "it&#39;s not i don&#39;t want to use. i just don&#39;t have clear idea about what that is. specifically, whether it&#39;s safe or not."}, {"owner": {"reputation": 5681, "user_id": 3040064, "user_type": "registered", "accept_rate": 59, "profile_image": "https://www.gravatar.com/avatar/02e7081757e69605a91b7f7aea47f4ae?s=128&d=identicon&r=PG&f=1", "display_name": "Jason Hu", "link": "https://stackoverflow.com/users/3040064/jason-hu"}, "edited": false, "score": 0, "creation_date": 1438892204, "post_id": 31864929, "comment_id": 51649144, "body": "and could you explain a little bit more? i don&#39;t know how your code works too"}, {"owner": {"reputation": 23444, "user_id": 414413, "user_type": "registered", "accept_rate": 79, "profile_image": "https://www.gravatar.com/avatar/6de2113f01432aa844dc85070ff33e89?s=128&d=identicon&r=PG", "display_name": "Cirdec", "link": "https://stackoverflow.com/users/414413/cirdec"}, "reply_to_user": {"reputation": 5681, "user_id": 3040064, "user_type": "registered", "accept_rate": 59, "profile_image": "https://www.gravatar.com/avatar/02e7081757e69605a91b7f7aea47f4ae?s=128&d=identicon&r=PG&f=1", "display_name": "Jason Hu", "link": "https://stackoverflow.com/users/3040064/jason-hu"}, "edited": false, "score": 1, "creation_date": 1438892207, "post_id": 31864929, "comment_id": 51649145, "body": "<code>UndecidableInstances</code> is safe, it just means the compiler doesn&#39;t know that it will be able to terminate type-checking/resolving constraints. The worst possible outcome of <code>UndecidableInstances</code> is that the compiler fails to terminate."}, {"owner": {"reputation": 5681, "user_id": 3040064, "user_type": "registered", "accept_rate": 59, "profile_image": "https://www.gravatar.com/avatar/02e7081757e69605a91b7f7aea47f4ae?s=128&d=identicon&r=PG&f=1", "display_name": "Jason Hu", "link": "https://stackoverflow.com/users/3040064/jason-hu"}, "edited": false, "score": 0, "creation_date": 1438892336, "post_id": 31864929, "comment_id": 51649215, "body": "sounds nice. has been added to my list of ok-to-use."}, {"owner": {"reputation": 100892, "user_id": 745903, "user_type": "registered", "accept_rate": 74, "profile_image": "https://www.gravatar.com/avatar/50933f6638836741e620669b3940410e?s=128&d=identicon&r=PG", "display_name": "leftaroundabout", "link": "https://stackoverflow.com/users/745903/leftaroundabout"}, "reply_to_user": {"reputation": 5681, "user_id": 3040064, "user_type": "registered", "accept_rate": 59, "profile_image": "https://www.gravatar.com/avatar/02e7081757e69605a91b7f7aea47f4ae?s=128&d=identicon&r=PG&f=1", "display_name": "Jason Hu", "link": "https://stackoverflow.com/users/3040064/jason-hu"}, "edited": false, "score": 0, "creation_date": 1438901388, "post_id": 31864929, "comment_id": 51653240, "body": "@HuStmpHrrr: I approve, though <a href=\"https://lukepalmer.wordpress.com/2008/04/08/stop-using-undecidable-instances/\" rel=\"nofollow noreferrer\">not everybody soes</a>."}], "tags": [], "owner": {"reputation": 23444, "user_id": 414413, "user_type": "registered", "accept_rate": 79, "profile_image": "https://www.gravatar.com/avatar/6de2113f01432aa844dc85070ff33e89?s=128&d=identicon&r=PG", "display_name": "Cirdec", "link": "https://stackoverflow.com/users/414413/cirdec"}, "is_accepted": true, "score": 5, "last_activity_date": 1438892839, "last_edit_date": 1438892839, "creation_date": 1438891963, "answer_id": 31864929, "question_id": 31864667, "link": "https://stackoverflow.com/questions/31864667/how-should-i-express-a-mutually-recursive-data-type-with-constrant-in-haskell/31864929#31864929", "title": "How should I express a mutually recursive data type with constrant in haskell?", "body": "<p><code>UndecidableInstances</code> is safe to use, it just means the compiler doesn't know that it will be able to terminate type-checking/resolving constraints. The worst possible outcome of <code>UndecidableInstances</code> is that the compiler fails to terminate. We can see that the compiler terminates by completing an example program.</p>\n\n<pre><code>{-# LANGUAGE MultiParamTypeClasses #-}\n{-# LANGUAGE FunctionalDependencies #-}\n{-# LANGUAGE FlexibleInstances #-}\n{-# LANGUAGE FlexibleContexts #-}\n{-# LANGUAGE UndecidableInstances #-}\n\nclass Prop1 a b | a -&gt; b\nclass Prop2 c d | c -&gt; d\n\ndata X y z = X\n\ninstance Prop1 y (X y z) =&gt; Prop2 (X y z) z\n\n-- An example Y and checking Prop2\ndata Y = Y\n\ninstance Prop1 Y (X Y ())\n\nmain :: Prop2 (X Y ()) () =&gt; IO ()\nmain = print \"checked\"\n</code></pre>\n\n<p>We have to choose a concrete type for <code>z</code> for <code>Prop1 Y x</code> instances; essentially <code>y</code> is determining <code>z</code>. I chose <code>()</code> for <code>Y</code>; there could be another <code>Y'</code> with a different <code>z</code>.</p>\n\n<h3>Type Families</h3>\n\n<p>If you don't want to use <code>UndecidableInstances</code> you can use <code>TypeFamilies</code> instead of <code>FunctionalDependencies</code>.</p>\n\n<pre><code>{-# LANGUAGE TypeFamilies #-}\n{-# LANGUAGE FlexibleContexts #-}\n\nclass Prop1 a where\n    type B a :: *\n\nclass Prop2 c where\n    type D c :: *\n\ndata X y z = X\n\ninstance (Prop1 y, B y ~ (X y z)) =&gt; Prop2 (X y z) where\n    type D (X y z) = z\n\n-- An example Y and get the compiler to run all the way to requiring FlexibleContexts \ndata Y = Y\n\ninstance Prop1 Y where\n    type B Y = X Y ()\n\nmain :: Prop2 (X Y ()) =&gt; IO ()\nmain = print \"checked\"\n</code></pre>\n"}], "owner": {"reputation": 5681, "user_id": 3040064, "user_type": "registered", "accept_rate": 59, "profile_image": "https://www.gravatar.com/avatar/02e7081757e69605a91b7f7aea47f4ae?s=128&d=identicon&r=PG&f=1", "display_name": "Jason Hu", "link": "https://stackoverflow.com/users/3040064/jason-hu"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 212, "favorite_count": 0, "accepted_answer_id": 31864929, "answer_count": 1, "score": 1, "last_activity_date": 1438892839, "creation_date": 1438891016, "question_id": 31864667, "link": "https://stackoverflow.com/questions/31864667/how-should-i-express-a-mutually-recursive-data-type-with-constrant-in-haskell", "title": "How should I express a mutually recursive data type with constrant in haskell?", "body": "<p>I am not quite clear myself, so if my description is also not clear enough, please let me know.</p>\n\n<p>So, I have two classes:</p>\n\n<pre><code>class Prop1 a b | a -&gt; b\nclass Prop2 c d | c -&gt; d\n</code></pre>\n\n<p>and a data type:</p>\n\n<pre><code>data X y z\n</code></pre>\n\n<p>the relations between them are:</p>\n\n<ol>\n<li><code>X</code> is a container of <code>z</code>, with <code>y</code> as an auxiliary container.</li>\n<li>container <code>y</code> shall contain another set of instances <code>X y z</code>.</li>\n<li><p><code>y</code> satisfies <code>Prop1</code>, that is, following holds:</p>\n\n<p><code>instance Prop1 y (X y z)</code></p></li>\n<li><p><code>X</code> itself satisfies <code>Prop2</code>, therefore:</p>\n\n<p><code>instance Prop2 (X y z) z</code></p></li>\n</ol>\n\n<p>so when I define the instance of <code>X</code>, I feel myself in a mess, I wrote something like:</p>\n\n<pre><code>instance Prop1 y (X y z) =&gt; Prop2 (X y z) z\n</code></pre>\n\n<p>but GHC doesn't seem to be happy with that and asks me to add <code>FlexibleContexts</code> and <code>UndecidableInstances</code>, which don't make me feel safe.</p>\n\n<p>and I read that it's not good to put constraint on <code>data</code>, but i tried and it didn't help:</p>\n\n<pre><code>data Prop1 y (X y z) =&gt; X y z\n</code></pre>\n\n<p>How should I deal with it in Haskell?</p>\n"}, {"tags": ["haskell", "typeclass", "existential-type"], "comments": [{"owner": {"reputation": 94553, "user_id": 775806, "user_type": "registered", "accept_rate": 96, "profile_image": "https://i.stack.imgur.com/XNd2C.png?s=128&g=1", "display_name": "n. &#39;pronouns&#39; m.", "link": "https://stackoverflow.com/users/775806/n-pronouns-m"}, "edited": false, "score": 0, "creation_date": 1438888129, "post_id": 31863773, "comment_id": 51646909, "body": "Are you trying to give names to types or to values? In any case, <code>name (Wrap named)</code> cannot depend on anything and must be a constant."}, {"owner": {"reputation": 13626, "user_id": 492865, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/5c69a2080e68c8606961a18aba3a08ec?s=128&d=identicon&r=PG", "display_name": "Yuras", "link": "https://stackoverflow.com/users/492865/yuras"}, "reply_to_user": {"reputation": 94553, "user_id": 775806, "user_type": "registered", "accept_rate": 96, "profile_image": "https://i.stack.imgur.com/XNd2C.png?s=128&g=1", "display_name": "n. &#39;pronouns&#39; m.", "link": "https://stackoverflow.com/users/775806/n-pronouns-m"}, "edited": false, "score": 0, "creation_date": 1438888305, "post_id": 31863773, "comment_id": 51647000, "body": "@n.m. Yes, it is constant, so <code>undefined</code> is fine for me. The example is pretty silly, the real use case if more useful."}], "answers": [{"tags": [], "owner": {"reputation": 126897, "user_id": 791604, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/ce991df7a056248d5e4f6fc3659ba733?s=128&d=identicon&r=PG", "display_name": "Daniel Wagner", "link": "https://stackoverflow.com/users/791604/daniel-wagner"}, "is_accepted": true, "score": 6, "last_activity_date": 1438888850, "last_edit_date": 1438888850, "creation_date": 1438888278, "answer_id": 31863974, "question_id": 31863773, "link": "https://stackoverflow.com/questions/31863773/instance-for-existential-wrapper-with-a-variable-in-contravariant-position/31863974#31863974", "title": "Instance for existential wrapper with a variable in contravariant position", "body": "<p>The first instance doesn't work because it doesn't trigger the monomorphism restriction, so <code>a</code> gets a polymorphic type which is instantiated <em>differently</em> in <code>named a</code> and <code>name a</code>. On the other hand, when writing <code>a = read undefined</code>, we find that <code>a</code> has a typeclass-restricted type, so the monomorphism restriction kicks in and we must choose a specific type for <code>a</code>; since <code>named a</code> uniquely identifies this type, that type is chosen and it is not instantiated at a different type in <code>name a</code>.</p>\n\n<p>You can cause the <code>read</code> version to fail by turning on <code>NoMonomorphismRestriction</code> to verify that this is the correct explanation.</p>\n\n<p>You can fix the problem by using a lambda instead of a let, as in:</p>\n\n<pre><code>instance Named Wrap where\n    name (Wrap named) = (\\a -&gt; (\\_ -&gt; name a) (named a)) undefined\n</code></pre>\n\n<p>(Generally, <code>let x = e in e'</code> is the same as <code>(\\x -&gt; e') e</code>, provided <code>x</code> is monomorphic and not recursive, and I have performed this rewrite twice here.)</p>\n\n<p>However, I would suggest a more serious reworking of your approach to avoid <code>undefined</code> entirely, if possible. The standard trick for this is:</p>\n\n<pre><code>class Named a where\n    name :: proxy a -&gt; String\n\nproxyForFun :: (a -&gt; IO ()) -&gt; Proxy a\nproxyForFun _ = Proxy\n\ninstance Named Wrap where\n    name (Wrap named) = name (proxyForFun named)\n</code></pre>\n\n<p>However, the type of <code>name</code> is quite restrictive: it is no longer possible to write instances in which <code>name</code> inspects its argument, so if that was a feature you needed this approach will not work.</p>\n"}], "owner": {"reputation": 13626, "user_id": 492865, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/5c69a2080e68c8606961a18aba3a08ec?s=128&d=identicon&r=PG", "display_name": "Yuras", "link": "https://stackoverflow.com/users/492865/yuras"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 93, "favorite_count": 1, "accepted_answer_id": 31863974, "answer_count": 1, "score": 2, "last_activity_date": 1522219975, "creation_date": 1438887468, "last_edit_date": 1522219975, "question_id": 31863773, "link": "https://stackoverflow.com/questions/31863773/instance-for-existential-wrapper-with-a-variable-in-contravariant-position", "title": "Instance for existential wrapper with a variable in contravariant position", "body": "<p>I have the following definition:</p>\n\n<pre><code>{-# LANGUAGE ExistentialQuantification #-}\n\nmodule Test\nwhere\n\nclass Named a where\n  name :: a -&gt; String\n\ndata Wrap = forall a . (Named a, Read a) =&gt; Wrap (a -&gt; IO ())\n</code></pre>\n\n<p>I want to write <code>Named</code> instance for <code>Wrap</code>. The next doesn't work:</p>\n\n<pre><code>instance Named Wrap where\n  name (Wrap named) =\n    let a = undefined\n        _ = named a\n    in name a\n</code></pre>\n\n<p>The error:</p>\n\n<pre><code>Could not deduce (Named a0) arising from a use of \u2018name\u2019\nfrom the context (Named a, Read a)\n</code></pre>\n\n<p>But the following works:</p>\n\n<pre><code>instance Named Wrap where\n  name (Wrap named) =\n    let a = read undefined\n        _ = named a\n    in name a\n</code></pre>\n\n<p>The only difference I see is that <code>a</code> is in covariant position in <code>read</code>, but in contravariant possition in <code>name</code>. Why doesn't the first instance declaration work?</p>\n"}, {"tags": ["sorting", "haskell"], "comments": [{"owner": {"reputation": 20862, "user_id": 376113, "user_type": "registered", "accept_rate": 72, "profile_image": "https://www.gravatar.com/avatar/d3a5bd12fe6d876527a3cf4ac0de5fc6?s=128&d=identicon&r=PG", "display_name": "mb14", "link": "https://stackoverflow.com/users/376113/mb14"}, "edited": false, "score": 1, "creation_date": 1438886348, "post_id": 31863223, "comment_id": 51645934, "body": "Do you want to sort using the first element in the tuple or use the exact same order as in the initial list , e.g. <code>sortM [2,3,1] [(1,&#39;a&#39;),(2,&#39;b&#39;),(3,&#39;c&#39;)]</code> =&gt; <code>[(2,&#39;b&#39;), (3,&#39;c&#39;), (1,&#39;a&#39;)]</code>?"}, {"owner": {"reputation": 46235, "user_id": 2541573, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/Z1qtP.png?s=128&g=1", "display_name": "jub0bs", "link": "https://stackoverflow.com/users/2541573/jub0bs"}, "edited": false, "score": 1, "creation_date": 1438886516, "post_id": 31863223, "comment_id": 51646032, "body": "See <a href=\"http://stackoverflow.com/q/31298466/2541573\">stackoverflow.com/q/31298466/2541573</a> for a very similar question."}], "answers": [{"comments": [{"owner": {"reputation": 4938, "user_id": 1465011, "user_type": "registered", "accept_rate": 98, "profile_image": "https://www.gravatar.com/avatar/5c11daff0c870a2b41ae9b907a136adf?s=128&d=identicon&r=PG", "display_name": "recursion.ninja", "link": "https://stackoverflow.com/users/1465011/recursion-ninja"}, "edited": false, "score": 1, "creation_date": 1438886980, "post_id": 31863459, "comment_id": 51646275, "body": "You should use <code>Data.Map</code> and <code>loopup</code> for better access times"}], "tags": [], "owner": {"reputation": 49959, "user_id": 866915, "user_type": "registered", "accept_rate": 70, "profile_image": "https://www.gravatar.com/avatar/09242131d6e17cbbe31e8547514da6e5?s=128&d=identicon&r=PG", "display_name": "ErikR", "link": "https://stackoverflow.com/users/866915/erikr"}, "is_accepted": false, "score": 0, "last_activity_date": 1438886799, "last_edit_date": 1438886799, "creation_date": 1438886483, "answer_id": 31863459, "question_id": 31863223, "link": "https://stackoverflow.com/questions/31863223/sort-list-according-to-a-template/31863459#31863459", "title": "Sort list according to a template", "body": "<p>Try this:</p>\n\n<pre><code>import Data.List (sortBy, elemIndex)\nimport Data.Ord (comparing)\n\nmySort :: [Int] -&gt; [(Int,a)] -&gt; [(Int,a)]\nmySort as bs = sortBy (comparing go) bs\n  where go (a,b) = maybe 0 id (elemIndex a as)\n</code></pre>\n\n<p>Example:</p>\n\n<pre><code>ghci&gt; mySort [3,2,1] [(1,'a'), (2,'b'), (3,'c')]\n[(3,'c'),(2,'b'),(1,'a')]\n</code></pre>\n\n<p>Basically <code>go (a,b)</code> computes the index of <code>a</code> in the first list and <code>sortBy (comparing go) ...</code> sorts by comparing <code>go</code> on each pair.</p>\n\n<p>Note: It's not very efficient since <code>elemIndex</code> scans from the front of the list every time it is called.</p>\n"}, {"comments": [{"owner": {"reputation": 126897, "user_id": 791604, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/ce991df7a056248d5e4f6fc3659ba733?s=128&d=identicon&r=PG", "display_name": "Daniel Wagner", "link": "https://stackoverflow.com/users/791604/daniel-wagner"}, "edited": false, "score": 1, "creation_date": 1438889503, "post_id": 31863817, "comment_id": 51647655, "body": "I like the idea given here, but it seems to require that <code>map fst xs</code> and <code>guide</code> be equal (as bags), which may not be a reasonable assumption."}], "tags": [], "owner": {"reputation": 28873, "user_id": 1068232, "user_type": "registered", "accept_rate": 79, "profile_image": "https://www.gravatar.com/avatar/2a0a145ce58c20013969fe3f203531da?s=128&d=identicon&r=PG", "display_name": "Andr&#225;s Kov&#225;cs", "link": "https://stackoverflow.com/users/1068232/andr%c3%a1s-kov%c3%a1cs"}, "is_accepted": false, "score": 2, "last_activity_date": 1438887665, "creation_date": 1438887665, "answer_id": 31863817, "question_id": 31863223, "link": "https://stackoverflow.com/questions/31863223/sort-list-according-to-a-template/31863817#31863817", "title": "Sort list according to a template", "body": "<p>If you allow <code>Ord a</code>, you can do an <code>O(n log n)</code> solution instead of the quadratic solution with the linear element lookups. The idea is to remember the original positions of the elements of the template list (by zipping with <code>[0..]</code>), then sort multiple times to align the elements and then recover the right order.</p>\n\n<pre><code>import Data.List\nimport Data.Ord\n\nsortMimicking :: Ord a =&gt; [a] -&gt; [(a, b)] -&gt; [(a, b)]\nsortMimicking guide xs = map snd $ sortBy (comparing (snd . fst)) $ zip guide' xs'\n  where\n    guide' = sortBy (comparing fst) $ zip guide [0..]\n    xs'    = sortBy (comparing fst) xs\n</code></pre>\n"}], "owner": {"reputation": 15620, "user_id": 596361, "user_type": "registered", "accept_rate": 82, "profile_image": "https://www.gravatar.com/avatar/b7219254970581e53d3b2b162f7f50f8?s=128&d=identicon&r=PG", "display_name": "Mirzhan Irkegulov", "link": "https://stackoverflow.com/users/596361/mirzhan-irkegulov"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 127, "favorite_count": 0, "answer_count": 2, "score": 0, "last_activity_date": 1438887735, "creation_date": 1438885715, "last_edit_date": 1495542609, "question_id": 31863223, "link": "https://stackoverflow.com/questions/31863223/sort-list-according-to-a-template", "title": "Sort list according to a template", "body": "<p>How to sort a list (reposition its elements) in Haskell according to another list (the template)? For example I have 2 lists:</p>\n\n<pre><code>[1,2,3]\n[(2,'b'),(1,'a'),(3,'c')]\n</code></pre>\n\n<p>I want to sort the 2nd list, so that firsts of each its element would correspond to the elements of the 1st list. I.e. I want it to be <code>[(1,'a'),(2,'b'),(3,'c')]</code>.</p>\n\n<p>I wrote a horribly inelegant implementation:</p>\n\n<pre><code>sortMimicking :: (Eq a) =&gt; [a] -&gt; [(a, b)] -&gt; [(a, b)]\nsortMimicking template xs = filterJust $ r (reverse template) xs []\n  where filterJust [] = []\n        filterJust (x:xs) = case x of\n          Nothing -&gt; filterJust xs\n          Just element -&gt; element:filterJust xs\n        deleteWith comparison xs = [ x | x &lt;- xs, not $ comparison x ]\n        r _ [] acc = acc\n        r (t:ts) xs acc = r ts\n                          (deleteWith ((==t) . fst) xs)\n                          (find ((==t) . fst) xs : acc)\n</code></pre>\n\n<p>It works only with lists of pairs, so I wrote this generalization:</p>\n\n<pre><code>sortMimickingBy :: (Eq a) =&gt; (b -&gt; a) -&gt; [a] -&gt; [b] -&gt; [b]\nsortMimickingBy c template xs = filterJust $ r (reverse template) xs []\n  where filterJust [] = []\n        filterJust (x:xs) = case x of\n          Nothing -&gt; filterJust xs\n          Just element -&gt; element:filterJust xs\n        deleteWith comparison xs = [ x | x &lt;- xs, not $ comparison x ]\n        r _ [] acc = acc\n        r (t:ts) xs acc = r ts\n                          (deleteWith ((==t) . c) xs)\n                          (find ((==t) . c) xs : acc)\n</code></pre>\n\n<p>I tried to come up with a more elegant function using <a href=\"http://hackage.haskell.org/package/base-4.8.1.0/docs/GHC-Exts.html#v:sortWith\" rel=\"nofollow noreferrer\"><code>sortWith</code></a> from <a href=\"http://hackage.haskell.org/package/base-4.8.1.0/docs/GHC-Exts.html\" rel=\"nofollow noreferrer\"><code>GHC.Exts</code></a> module, but to no avail. There's <a href=\"https://stackoverflow.com/q/12814667/596361\">a similar Python question</a>.</p>\n"}, {"tags": ["haskell", "concurrency", "monads", "stm"], "comments": [{"owner": {"reputation": 13734, "user_id": 938694, "user_type": "registered", "accept_rate": 59, "profile_image": "https://www.gravatar.com/avatar/b6678a430a805dd78366d6e135b49f2d?s=128&d=identicon&r=PG", "display_name": "Cubic", "link": "https://stackoverflow.com/users/938694/cubic"}, "edited": false, "score": 1, "creation_date": 1438888747, "post_id": 31861580, "comment_id": 51647256, "body": "Before looking at concurrency, you might wanna look for your bottlenecks first. If you&#39;re just doing game of life, you should easily be able to get a few hundred updates per second even on modest hardware."}, {"owner": {"reputation": 486, "user_id": 3807103, "user_type": "registered", "accept_rate": 58, "profile_image": "https://lh3.googleusercontent.com/-YNIokoSHQ8U/AAAAAAAAAAI/AAAAAAAAAFs/hUUwaGWJ4IQ/photo.jpg?sz=128", "display_name": "qleguennec", "link": "https://stackoverflow.com/users/3807103/qleguennec"}, "reply_to_user": {"reputation": 13734, "user_id": 938694, "user_type": "registered", "accept_rate": 59, "profile_image": "https://www.gravatar.com/avatar/b6678a430a805dd78366d6e135b49f2d?s=128&d=identicon&r=PG", "display_name": "Cubic", "link": "https://stackoverflow.com/users/938694/cubic"}, "edited": false, "score": 0, "creation_date": 1438892032, "post_id": 31861580, "comment_id": 51649050, "body": "@Cubic the game of life is currently only for testing the engine. This is no optimization problem, but being able to process inputs in the same time than computing game mechanics."}, {"owner": {"reputation": 486, "user_id": 3807103, "user_type": "registered", "accept_rate": 58, "profile_image": "https://lh3.googleusercontent.com/-YNIokoSHQ8U/AAAAAAAAAAI/AAAAAAAAAFs/hUUwaGWJ4IQ/photo.jpg?sz=128", "display_name": "qleguennec", "link": "https://stackoverflow.com/users/3807103/qleguennec"}, "reply_to_user": {"reputation": 13734, "user_id": 938694, "user_type": "registered", "accept_rate": 59, "profile_image": "https://www.gravatar.com/avatar/b6678a430a805dd78366d6e135b49f2d?s=128&d=identicon&r=PG", "display_name": "Cubic", "link": "https://stackoverflow.com/users/938694/cubic"}, "edited": false, "score": 0, "creation_date": 1438892618, "post_id": 31861580, "comment_id": 51649360, "body": "@Cubic the frequency also depends on the size of the board."}], "answers": [{"comments": [{"owner": {"reputation": 486, "user_id": 3807103, "user_type": "registered", "accept_rate": 58, "profile_image": "https://lh3.googleusercontent.com/-YNIokoSHQ8U/AAAAAAAAAAI/AAAAAAAAAFs/hUUwaGWJ4IQ/photo.jpg?sz=128", "display_name": "qleguennec", "link": "https://stackoverflow.com/users/3807103/qleguennec"}, "edited": false, "score": 0, "creation_date": 1438891821, "post_id": 31864378, "comment_id": 51648928, "body": "I was aware of that, and I thought I could somehow get around by using <a href=\"https://hackage.haskell.org/package/fclabels-2.0.2.2/docs/Data-Label-Point.html\" rel=\"nofollow noreferrer\">Data.Label.Point</a>. It uses Arrows, which are (somewhat?) related to Monads. Should I give it a try, or am I just talking nonsense? I don&#39;t quite understand Points yet, but they surely seems extensible."}, {"owner": {"reputation": 49959, "user_id": 866915, "user_type": "registered", "accept_rate": 70, "profile_image": "https://www.gravatar.com/avatar/09242131d6e17cbbe31e8547514da6e5?s=128&d=identicon&r=PG", "display_name": "ErikR", "link": "https://stackoverflow.com/users/866915/erikr"}, "reply_to_user": {"reputation": 486, "user_id": 3807103, "user_type": "registered", "accept_rate": 58, "profile_image": "https://lh3.googleusercontent.com/-YNIokoSHQ8U/AAAAAAAAAAI/AAAAAAAAAFs/hUUwaGWJ4IQ/photo.jpg?sz=128", "display_name": "qleguennec", "link": "https://stackoverflow.com/users/3807103/qleguennec"}, "edited": false, "score": 1, "creation_date": 1438894179, "post_id": 31864378, "comment_id": 51650244, "body": "Have a look at this answer: <a href=\"http://stackoverflow.com/questions/18794745/can-i-make-a-lens-with-a-monad-constraint\" title=\"can i make a lens with a monad constraint\">stackoverflow.com/questions/18794745/&hellip;</a> - it even has an STM example."}], "tags": [], "owner": {"reputation": 49959, "user_id": 866915, "user_type": "registered", "accept_rate": 70, "profile_image": "https://www.gravatar.com/avatar/09242131d6e17cbbe31e8547514da6e5?s=128&d=identicon&r=PG", "display_name": "ErikR", "link": "https://stackoverflow.com/users/866915/erikr"}, "is_accepted": true, "score": 3, "last_activity_date": 1438889888, "creation_date": 1438889888, "answer_id": 31864378, "question_id": 31861580, "link": "https://stackoverflow.com/questions/31861580/stm-with-fclabels/31864378#31864378", "title": "STM with fclabels", "body": "<p>If I understand you correctly, you want to define a lens <code>tlens</code> s.t.:</p>\n\n<pre><code>gets tlens\n</code></pre>\n\n<p>is the same as:</p>\n\n<pre><code>do tvar &lt;- gets squares\n   sqs &lt;- liftIO $ atomically $ readTVar tvar\n   return sqs\n</code></pre>\n\n<p>and where <code>puts tlens sqs</code> is the same as:</p>\n\n<pre><code>do tvar &lt;- gets squares\n   liftIO $ atomically $ writeTVar tvar sqs \n</code></pre>\n\n<p>I think this can be answered by looking at the type of <code>gets</code>:</p>\n\n<pre><code>gets :: MonadState f m =&gt; Lens (-&gt;) f o -&gt; m o\n</code></pre>\n\n<p>The lens parameter is pure and not monadic. To get at the contents of the TVar you'll need to run code in the IO-monad.</p>\n\n<p>Moreover, the definition of <code>gets</code> in Data.Label.Monadic is <a href=\"https://hackage.haskell.org/package/fclabels-2.0.2.2/docs/src/Data-Label-Monadic.html#gets\" rel=\"nofollow\">(link)</a> is:</p>\n\n<pre><code>gets lens = State.gets (Total.get lens)\n</code></pre>\n\n<p>where State is Control.Monad.State and Total is Data.Label.Total.</p>\n\n<p>But <code>State.gets</code> takes a pure function, so again you're not going to be able to create a lens which will work with <code>gets</code>.</p>\n"}], "owner": {"reputation": 486, "user_id": 3807103, "user_type": "registered", "accept_rate": 58, "profile_image": "https://lh3.googleusercontent.com/-YNIokoSHQ8U/AAAAAAAAAAI/AAAAAAAAAFs/hUUwaGWJ4IQ/photo.jpg?sz=128", "display_name": "qleguennec", "link": "https://stackoverflow.com/users/3807103/qleguennec"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 90, "favorite_count": 0, "accepted_answer_id": 31864378, "answer_count": 1, "score": 2, "last_activity_date": 1438889888, "creation_date": 1438880135, "last_edit_date": 1438880478, "question_id": 31861580, "link": "https://stackoverflow.com/questions/31861580/stm-with-fclabels", "title": "STM with fclabels", "body": "<p>I built a small game engine to manage a board of squares (currently used for playing a Conway's game of life). All the data is accessed throught lenses from <a href=\"https://hackage.haskell.org/package/fclabels-2.0.2.2\" rel=\"nofollow\">fclabels</a> and State. The engine couples user input and graphic rendering (usual game loop).</p>\n\n<p>The computations between frames can sometimes be slow and long to execute. So I would like to use concurrency to manage the squares, using <a href=\"https://hackage.haskell.org/package/stm-2.4.4\" rel=\"nofollow\">STM</a>'s <a href=\"https://hackage.haskell.org/package/stm-2.4.4/docs/Control-Concurrent-STM-TVar.html\" rel=\"nofollow\">TVar</a>.</p>\n\n<p>My data is currently represented like this:</p>\n\n<pre><code>data World = World {\n    \u2026 -- window configuration, not important\n    , _squares :: TVar [Square]\n}\n\nmkLabels [''World] -- creates labels, similar to mkLenses\n</code></pre>\n\n<p>My functions run in the Game Monad, which is defined as follow:</p>\n\n<pre><code>type Game a = StateT World IO a\n</code></pre>\n\n<p>Using the <a href=\"https://hackage.haskell.org/package/fclabels-2.0.2.2/docs/Data-Label-Monadic.html\" rel=\"nofollow\">monadic versions of labels</a>. I use Getters &amp; Setters inside my monad.</p>\n\n<p>I would like to know if there is a way to somehow write new labels that behave like these:</p>\n\n<pre><code>gets :: MonadState f m =&gt; Lens (-&gt;) f o -&gt; m o \n\u2026\nputs :: MonadState f m =&gt; Lens (-&gt;) f o -&gt; o -&gt; m () \n</code></pre>\n\n<p>But that takes care of STM (gets would involve readTVar, puts would involve writeTvar, etc.).</p>\n"}, {"tags": ["haskell"], "comments": [{"owner": {"reputation": 14781, "user_id": 630160, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/4445f21326af525a8ad19af7e3ae41a8?s=128&d=identicon&r=PG", "display_name": "epsilonhalbe", "link": "https://stackoverflow.com/users/630160/epsilonhalbe"}, "edited": false, "score": 0, "creation_date": 1438877645, "post_id": 31860471, "comment_id": 51641111, "body": "side note: <code>present x xs == True</code> is equivalent to <code>present x xs</code>"}, {"owner": {"reputation": 1657, "user_id": 4183787, "user_type": "registered", "accept_rate": 62, "profile_image": "https://i.stack.imgur.com/XedpJ.png?s=128&g=1", "display_name": "zigazou", "link": "https://stackoverflow.com/users/4183787/zigazou"}, "edited": false, "score": 2, "creation_date": 1438878101, "post_id": 31860471, "comment_id": 51641401, "body": "Why <code>reverse . nub . reverse</code> ? <code>nub</code> does exactly what Abhinav Jain is trying to write."}, {"owner": {"reputation": 552, "user_id": 4352736, "user_type": "registered", "accept_rate": 67, "profile_image": "https://i.stack.imgur.com/zj7vK.jpg?s=128&g=1", "display_name": "Crazy Psychild", "link": "https://stackoverflow.com/users/4352736/crazy-psychild"}, "edited": false, "score": 0, "creation_date": 1438880785, "post_id": 31860471, "comment_id": 51642960, "body": "Cannot use built in functions as per the instructions of assignment that is why trying to implement it through simple functions and recursion."}, {"owner": {"reputation": 126897, "user_id": 791604, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/ce991df7a056248d5e4f6fc3659ba733?s=128&d=identicon&r=PG", "display_name": "Daniel Wagner", "link": "https://stackoverflow.com/users/791604/daniel-wagner"}, "reply_to_user": {"reputation": 4938, "user_id": 1465011, "user_type": "registered", "accept_rate": 98, "profile_image": "https://www.gravatar.com/avatar/5c11daff0c870a2b41ae9b907a136adf?s=128&d=identicon&r=PG", "display_name": "recursion.ninja", "link": "https://stackoverflow.com/users/1465011/recursion-ninja"}, "edited": false, "score": 0, "creation_date": 1438881628, "post_id": 31860471, "comment_id": 51643374, "body": "@recursion.ninja But he <i>wants</i> <code>[1,2,3]</code> -- in other words, he wants <code>nub</code>. I agree that <code>reverse . nub . reverse</code> matches the function he has written, but he explicitly doesn&#39;t like the behavior of the function he has written."}, {"owner": {"reputation": 4938, "user_id": 1465011, "user_type": "registered", "accept_rate": 98, "profile_image": "https://www.gravatar.com/avatar/5c11daff0c870a2b41ae9b907a136adf?s=128&d=identicon&r=PG", "display_name": "recursion.ninja", "link": "https://stackoverflow.com/users/1465011/recursion-ninja"}, "reply_to_user": {"reputation": 126897, "user_id": 791604, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/ce991df7a056248d5e4f6fc3659ba733?s=128&d=identicon&r=PG", "display_name": "Daniel Wagner", "link": "https://stackoverflow.com/users/791604/daniel-wagner"}, "edited": false, "score": 0, "creation_date": 1438881952, "post_id": 31860471, "comment_id": 51643536, "body": "@DanielWagner oh I misread his question, I thought the problem wasn&#39;t just straightforward recursion..."}, {"owner": {"reputation": 552, "user_id": 4352736, "user_type": "registered", "accept_rate": 67, "profile_image": "https://i.stack.imgur.com/zj7vK.jpg?s=128&g=1", "display_name": "Crazy Psychild", "link": "https://stackoverflow.com/users/4352736/crazy-psychild"}, "reply_to_user": {"reputation": 4938, "user_id": 1465011, "user_type": "registered", "accept_rate": 98, "profile_image": "https://www.gravatar.com/avatar/5c11daff0c870a2b41ae9b907a136adf?s=128&d=identicon&r=PG", "display_name": "recursion.ninja", "link": "https://stackoverflow.com/users/1465011/recursion-ninja"}, "edited": false, "score": 0, "creation_date": 1438882447, "post_id": 31860471, "comment_id": 51643758, "body": "@recursion.ninja Yes what i actually want to do is exactly the same what <code>nub </code>does."}], "answers": [{"comments": [{"owner": {"reputation": 552, "user_id": 4352736, "user_type": "registered", "accept_rate": 67, "profile_image": "https://i.stack.imgur.com/zj7vK.jpg?s=128&g=1", "display_name": "Crazy Psychild", "link": "https://stackoverflow.com/users/4352736/crazy-psychild"}, "edited": false, "score": 0, "creation_date": 1438882935, "post_id": 31860680, "comment_id": 51643996, "body": "That would work i know but still there must be a more efficient way to do it right."}], "tags": [], "owner": {"reputation": 44000, "user_id": 535275, "user_type": "registered", "accept_rate": 91, "profile_image": "https://i.stack.imgur.com/Ft2Mw.jpg?s=128&g=1", "display_name": "Scott Hunter", "link": "https://stackoverflow.com/users/535275/scott-hunter"}, "is_accepted": false, "score": 1, "last_activity_date": 1438877231, "creation_date": 1438877231, "answer_id": 31860680, "question_id": 31860471, "link": "https://stackoverflow.com/questions/31860471/how-to-go-backwards-in-a-list-in-haskell/31860680#31860680", "title": "How to go backwards in a list in Haskell?", "body": "<p>You could reverse it, run your current duplicate remover, and then reverse the result.</p>\n"}, {"comments": [{"owner": {"reputation": 1308, "user_id": 1203558, "user_type": "registered", "accept_rate": 86, "profile_image": "https://i.stack.imgur.com/kb4nh.jpg?s=128&g=1", "display_name": "aemxdp", "link": "https://stackoverflow.com/users/1203558/aemxdp"}, "edited": false, "score": 1, "creation_date": 1438892530, "post_id": 31860753, "comment_id": 51649309, "body": "I&#39;ve checked Data.List.nub and surprisingly it&#39;s O(n^2) too. Here&#39;s an interesting article: <a href=\"http://neilmitchell.blogspot.com/2015/02/nub-considered-harmful.html\" rel=\"nofollow noreferrer\">nub considered harmful</a>."}], "tags": [], "owner": {"reputation": 49959, "user_id": 866915, "user_type": "registered", "accept_rate": 70, "profile_image": "https://www.gravatar.com/avatar/09242131d6e17cbbe31e8547514da6e5?s=128&d=identicon&r=PG", "display_name": "ErikR", "link": "https://stackoverflow.com/users/866915/erikr"}, "is_accepted": true, "score": 10, "last_activity_date": 1438878948, "last_edit_date": 1438878948, "creation_date": 1438877452, "answer_id": 31860753, "question_id": 31860471, "link": "https://stackoverflow.com/questions/31860471/how-to-go-backwards-in-a-list-in-haskell/31860753#31860753", "title": "How to go backwards in a list in Haskell?", "body": "<p>How about this idea:</p>\n\n<pre><code>remDup [] = []\nremDup (x:xs) = x :  remDup ( remove x xs )\n</code></pre>\n\n<p>where <code>remove x xs</code> removes all occurrences of x from the list xs (implementation left as an exercise.)</p>\n"}, {"comments": [{"owner": {"reputation": 1308, "user_id": 1203558, "user_type": "registered", "accept_rate": 86, "profile_image": "https://i.stack.imgur.com/kb4nh.jpg?s=128&g=1", "display_name": "aemxdp", "link": "https://stackoverflow.com/users/1203558/aemxdp"}, "edited": false, "score": 0, "creation_date": 1438885749, "post_id": 31862810, "comment_id": 51645612, "body": "Also, in case of Int a specialized highly efficient <a href=\"https://hackage.haskell.org/package/containers-0.5.6.3/docs/Data-IntSet.html\" rel=\"nofollow noreferrer\">IntSet</a> could be used."}], "tags": [], "owner": {"reputation": 21, "user_id": 5199339, "user_type": "unregistered", "profile_image": "https://www.gravatar.com/avatar/c478d77060616ab6948fa009c0f9dc37?s=128&d=identicon&r=PG", "display_name": "user5199339", "link": "https://stackoverflow.com/users/5199339/user5199339"}, "is_accepted": false, "score": 2, "last_activity_date": 1438884319, "creation_date": 1438884319, "answer_id": 31862810, "question_id": 31860471, "link": "https://stackoverflow.com/questions/31860471/how-to-go-backwards-in-a-list-in-haskell/31862810#31862810", "title": "How to go backwards in a list in Haskell?", "body": "<p>For every element you encounter, you simply want to check if you have encountered it before; build up a Set of encountered elements and use that to check if an element should be deleted.</p>\n\n<pre><code>remDup :: [Int] -&gt; [Int]\nremDup xs = helper S.empty xs\n  where\n    helper s [] = []\n    helper s (x:xs) | S.elem x s = helper xs\n                    | otherwise = x:helper (S.insert x s) xs\n</code></pre>\n"}, {"comments": [{"owner": {"reputation": 44013, "user_id": 1477667, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/trgKM.jpg?s=128&g=1", "display_name": "dfeuer", "link": "https://stackoverflow.com/users/1477667/dfeuer"}, "edited": false, "score": 0, "creation_date": 1438903368, "post_id": 31864812, "comment_id": 51653809, "body": "Your last guard should always be trivial, to make it clear that you haven&#39;t missed any cases. This is usually done with <code>otherwise</code>, which is just defined as <code>True</code>."}], "tags": [], "owner": {"reputation": 552, "user_id": 4352736, "user_type": "registered", "accept_rate": 67, "profile_image": "https://i.stack.imgur.com/zj7vK.jpg?s=128&g=1", "display_name": "Crazy Psychild", "link": "https://stackoverflow.com/users/4352736/crazy-psychild"}, "is_accepted": false, "score": 0, "last_activity_date": 1438891494, "creation_date": 1438891494, "answer_id": 31864812, "question_id": 31860471, "link": "https://stackoverflow.com/questions/31860471/how-to-go-backwards-in-a-list-in-haskell/31864812#31864812", "title": "How to go backwards in a list in Haskell?", "body": "<p>So this is what I finally came up with after following user5402's advice.</p>\n\n<pre><code>remDup1 [] = []\nremDup1 (x:xs) = x:remDup1(remove x xs)\n\nremove x []=[]\nremove x (y:ys) \n   | x==y = remove x ys\n   | x/=y = y:(remove x ys)\n</code></pre>\n"}, {"comments": [{"owner": {"reputation": 44013, "user_id": 1477667, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/trgKM.jpg?s=128&g=1", "display_name": "dfeuer", "link": "https://stackoverflow.com/users/1477667/dfeuer"}, "edited": false, "score": 0, "creation_date": 1438902968, "post_id": 31867235, "comment_id": 51653695, "body": "Unfortunately, <code>Hashable</code> is evil and wrong. Notably, it is very stupid about hashing <code>Int</code> (very, very, very stupid), but it also makes hashes of different sizes on different architectures."}, {"owner": {"reputation": 4685, "user_id": 5180989, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/Gxpck.jpg?s=128&g=1", "display_name": "Helder Pereira", "link": "https://stackoverflow.com/users/5180989/helder-pereira"}, "reply_to_user": {"reputation": 44013, "user_id": 1477667, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/trgKM.jpg?s=128&g=1", "display_name": "dfeuer", "link": "https://stackoverflow.com/users/1477667/dfeuer"}, "edited": false, "score": 0, "creation_date": 1438903844, "post_id": 31867235, "comment_id": 51653932, "body": "Why do you say that? What I see in the source code is <code>instance Hashable Int where hash = id</code>, which is no different from Java for example. Do you have any reference worth of reading about why &quot;<code>Hashable</code> is evil and wrong&quot;?"}, {"owner": {"reputation": 44013, "user_id": 1477667, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/trgKM.jpg?s=128&g=1", "display_name": "dfeuer", "link": "https://stackoverflow.com/users/1477667/dfeuer"}, "edited": false, "score": 0, "creation_date": 1438904123, "post_id": 31867235, "comment_id": 51654019, "body": "The problem is that hash tables, hash maps, and hash sets depend for their efficiency on keys being distributed as evenly as possible. Using the identity function for &quot;hashing&quot; does a pretty bad job of this."}, {"owner": {"reputation": 4685, "user_id": 5180989, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/Gxpck.jpg?s=128&g=1", "display_name": "Helder Pereira", "link": "https://stackoverflow.com/users/5180989/helder-pereira"}, "reply_to_user": {"reputation": 44013, "user_id": 1477667, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/trgKM.jpg?s=128&g=1", "display_name": "dfeuer", "link": "https://stackoverflow.com/users/1477667/dfeuer"}, "edited": false, "score": 0, "creation_date": 1438905892, "post_id": 31867235, "comment_id": 51654474, "body": "Well, it&#39;s true you depend on the key distribution caused by the hashing function, but they are usually faster than their tree counterparts. Even, in this example, I started by using <code>Set</code> which is implemented with a tree, but than I changed, because <code>HashSet</code> was faster. And also because it looks better to say O(n) than O(n log n) :-)"}, {"owner": {"reputation": 44013, "user_id": 1477667, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/trgKM.jpg?s=128&g=1", "display_name": "dfeuer", "link": "https://stackoverflow.com/users/1477667/dfeuer"}, "edited": false, "score": 0, "creation_date": 1438910810, "post_id": 31867235, "comment_id": 51655555, "body": "You can&#39;t really get O(1) ever. Hash maps are based on trees. I believe the branching factor is large, so the trees are typically shallow."}, {"owner": {"reputation": 44013, "user_id": 1477667, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/trgKM.jpg?s=128&g=1", "display_name": "dfeuer", "link": "https://stackoverflow.com/users/1477667/dfeuer"}, "edited": false, "score": 0, "creation_date": 1566362353, "post_id": 31867235, "comment_id": 101627314, "body": "Why <code>Ord</code> and not <code>Eq</code> for the <code>HashSet</code> version? Pretty sure you only need <code>Hashable</code> and <code>Eq</code>."}, {"owner": {"reputation": 4685, "user_id": 5180989, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/Gxpck.jpg?s=128&g=1", "display_name": "Helder Pereira", "link": "https://stackoverflow.com/users/5180989/helder-pereira"}, "reply_to_user": {"reputation": 44013, "user_id": 1477667, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/trgKM.jpg?s=128&g=1", "display_name": "dfeuer", "link": "https://stackoverflow.com/users/1477667/dfeuer"}, "edited": false, "score": 0, "creation_date": 1566372949, "post_id": 31867235, "comment_id": 101630970, "body": "@dfeuer You&#39;re right. I must have mixed it with the <code>HashSet</code> from the <code>hashmap</code> package."}], "tags": [], "owner": {"reputation": 4685, "user_id": 5180989, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/Gxpck.jpg?s=128&g=1", "display_name": "Helder Pereira", "link": "https://stackoverflow.com/users/5180989/helder-pereira"}, "is_accepted": false, "score": 0, "last_activity_date": 1566372680, "last_edit_date": 1566372680, "creation_date": 1438902544, "answer_id": 31867235, "question_id": 31860471, "link": "https://stackoverflow.com/questions/31860471/how-to-go-backwards-in-a-list-in-haskell/31867235#31867235", "title": "How to go backwards in a list in Haskell?", "body": "<p>If you care about efficiency, you should think about using <code>HashSet</code> as an auxiliary data structure. Doing that, we can get an average-case complexity of O(n log n) and actually O(n) in practice (<a href=\"https://hackage.haskell.org/package/unordered-containers-0.2.10.0/docs/Data-HashSet.html\" rel=\"nofollow noreferrer\">source</a>).</p>\n\n<pre><code>import Data.Hashable\nimport Data.HashSet (HashSet)\nimport qualified Data.HashSet as HashSet\n\nremDupSet :: (Hashable a, Eq a) =&gt; [a] -&gt; [a]\nremDupSet l = remDupSetAux HashSet.empty l\n  where remDupSetAux :: (Hashable a, Eq a) =&gt; HashSet a -&gt; [a] -&gt; [a]\n        remDupSetAux _ [] = []\n        remDupSetAux s (x:xs) = if x `HashSet.member` s\n                                  then remDupSetAux s xs\n                                  else x : remDupSetAux (HashSet.insert x s) xs\n</code></pre>\n\n<p>I just quickly wrote a program to compare the performance of this solution with the top-voted one:</p>\n\n<pre><code>import Data.List\nimport Data.Hashable\nimport Data.HashSet (HashSet)\nimport qualified Data.HashSet as HashSet\n\nimport Data.Time.Clock\nimport Control.DeepSeq\n\nmain :: IO ()\nmain = do\n  let a = [1..20000] :: [Int]\n  putStrLn \"Test1: 20000 different values\"\n  test \"remDup\"    $ remDup a\n  test \"remDupSet\" $ remDupSet a\n  putStrLn \"\"\n  let b = replicate 20000 1 :: [Int]\n  putStrLn \"Test2: one value repeted 20000 times\"\n  test \"remDup\"    $ remDup b\n  test \"remDupSet\" $ remDupSet b\n\ntest :: (NFData a) =&gt; String -&gt; a -&gt; IO ()\ntest s a = do time1 &lt;- getCurrentTime\n              time2 &lt;- a `deepseq` getCurrentTime\n              putStrLn $ s ++ \": \" ++ show (diffUTCTime time2 time1)\n\nremDup :: (Eq a) =&gt; [a] -&gt; [a]\nremDup [] = []\nremDup (x:xs) = x : remDup (delete x xs)\n\nremDupSet :: (Hashable a, Eq a) =&gt; [a] -&gt; [a]\nremDupSet l = remDupSetAux HashSet.empty l\n  where remDupSetAux :: (Hashable a, Eq a) =&gt; HashSet a -&gt; [a] -&gt; [a]\n        remDupSetAux _ [] = []\n        remDupSetAux s (x:xs) = if x `HashSet.member` s\n                                  then remDupSetAux s xs\n                                  else x : remDupSetAux (HashSet.insert x s) xs\n</code></pre>\n\n<p>As expected, there is a huge difference mainly when there are many distinct values:</p>\n\n<pre><code>Test1: 20000 different values\nremDup: 15.79859s\nremDupSet: 0.007725s\n\nTest2: one value repeted 20000 times\nremDup: 0.001084s\nremDupSet: 0.00064s\n</code></pre>\n"}], "owner": {"reputation": 552, "user_id": 4352736, "user_type": "registered", "accept_rate": 67, "profile_image": "https://i.stack.imgur.com/zj7vK.jpg?s=128&g=1", "display_name": "Crazy Psychild", "link": "https://stackoverflow.com/users/4352736/crazy-psychild"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 399, "favorite_count": 0, "accepted_answer_id": 31860753, "answer_count": 5, "score": 2, "last_activity_date": 1566372680, "creation_date": 1438876667, "last_edit_date": 1566337306, "question_id": 31860471, "link": "https://stackoverflow.com/questions/31860471/how-to-go-backwards-in-a-list-in-haskell", "title": "How to go backwards in a list in Haskell?", "body": "<p>I need to write a simple function for one of my assignments that should remove all the duplicates from a given list except for the first occurrence of the element in the list.\nHere is what I wrote:</p>\n\n<pre><code>remDup :: [Int]-&gt;[Int]\nremDup []=[]\nremDup (x:xs)\n   | present x xs==True = remDup xs\n   | otherwise = x:remDup xs\n   where\n   present :: Int-&gt;[Int]-&gt;Bool\n   present x [] = False\n   present x (y:ys)\n       | x==y =True\n       | otherwise = present x ys \n</code></pre>\n\n<p>But this code removes the duplicates except for the last occurrence of the element.\nThat is, if the given list is <code>[1,2,3,3,2]</code>, it produces <code>[1,3,2]</code> instead of <code>[1,2,3]</code>.\nHow to do it the other way around?</p>\n"}, {"tags": ["haskell", "cabal"], "comments": [{"owner": {"reputation": 4938, "user_id": 1465011, "user_type": "registered", "accept_rate": 98, "profile_image": "https://www.gravatar.com/avatar/5c11daff0c870a2b41ae9b907a136adf?s=128&d=identicon&r=PG", "display_name": "recursion.ninja", "link": "https://stackoverflow.com/users/1465011/recursion-ninja"}, "edited": false, "score": 0, "creation_date": 1438873354, "post_id": 31859182, "comment_id": 51637967, "body": "I assume <code>cabal update</code> does more than just download the tar ball. It likely also unpacks it, compares it&#39;s contents to your current contents, cleans up nicely after itself..."}, {"owner": {"reputation": 2875, "user_id": 2299477, "user_type": "registered", "accept_rate": 31, "profile_image": "https://i.stack.imgur.com/xppB7.jpg?s=128&g=1", "display_name": "Alaya", "link": "https://stackoverflow.com/users/2299477/alaya"}, "reply_to_user": {"reputation": 4938, "user_id": 1465011, "user_type": "registered", "accept_rate": 98, "profile_image": "https://www.gravatar.com/avatar/5c11daff0c870a2b41ae9b907a136adf?s=128&d=identicon&r=PG", "display_name": "recursion.ninja", "link": "https://stackoverflow.com/users/1465011/recursion-ninja"}, "edited": false, "score": 0, "creation_date": 1438873843, "post_id": 31859182, "comment_id": 51638352, "body": "well, it just get stuck at the downloading stage...it just donloaded 100K after tens of miniutes."}, {"owner": {"reputation": 11001, "user_id": 727667, "user_type": "registered", "accept_rate": 88, "profile_image": "https://www.gravatar.com/avatar/2e2cbd3a202d8d1cfe0cc2a9fff86733?s=128&d=identicon&r=PG", "display_name": "gallais", "link": "https://stackoverflow.com/users/727667/gallais"}, "edited": false, "score": 5, "creation_date": 1438874653, "post_id": 31859182, "comment_id": 51638964, "body": "If you&#39;re using an old version of cabal, you might be <a href=\"https://mail.haskell.org/pipermail/libraries/2013-December/021771.html\" rel=\"nofollow noreferrer\">hitting this bug</a>."}, {"owner": {"reputation": 4938, "user_id": 1465011, "user_type": "registered", "accept_rate": 98, "profile_image": "https://www.gravatar.com/avatar/5c11daff0c870a2b41ae9b907a136adf?s=128&d=identicon&r=PG", "display_name": "recursion.ninja", "link": "https://stackoverflow.com/users/1465011/recursion-ninja"}, "edited": false, "score": 0, "creation_date": 1438880552, "post_id": 31859182, "comment_id": 51642832, "body": "Post your version of <code>cabal</code>. Run <code>cabal --version</code>"}, {"owner": {"reputation": 75, "user_id": 2903534, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/78a5a4cdd8f3143f32017f10f309cddf?s=128&d=identicon&r=PG", "display_name": "Yuriy Yakovenko", "link": "https://stackoverflow.com/users/2903534/yuriy-yakovenko"}, "edited": false, "score": 0, "creation_date": 1576664307, "post_id": 31859182, "comment_id": 104969885, "body": "cabal --version  ``` cabal-install version 2.2.0.0 compiled using version 2.2.0.1 of the Cabal library  ```"}], "answers": [{"tags": [], "owner": {"reputation": 37486, "user_id": 371753, "user_type": "registered", "accept_rate": 83, "profile_image": "https://i.stack.imgur.com/znFEK.jpg?s=128&g=1", "display_name": "sclv", "link": "https://stackoverflow.com/users/371753/sclv"}, "is_accepted": false, "score": 2, "last_activity_date": 1517907428, "creation_date": 1517907428, "answer_id": 48638990, "question_id": 31859182, "link": "https://stackoverflow.com/questions/31859182/why-is-cabal-update-so-slow-and-could-i-do-it-manually/48638990#48638990", "title": "Why is &quot;cabal update&quot; so slow and could I do it manually?", "body": "<p>As a comment points out -- there was a bug in old versions of <code>cabal-install</code> that slowed things down considerably. Furthermore, modern versions try to not use the native <code>HTTP</code> library, but instead use external <code>curl</code> or <code>wget</code> binaries which are very efficient and more full-featured in terms of support for proxies, etc. </p>\n"}], "owner": {"reputation": 2875, "user_id": 2299477, "user_type": "registered", "accept_rate": 31, "profile_image": "https://i.stack.imgur.com/xppB7.jpg?s=128&g=1", "display_name": "Alaya", "link": "https://stackoverflow.com/users/2299477/alaya"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 4924, "favorite_count": 0, "answer_count": 1, "score": 11, "last_activity_date": 1517907428, "creation_date": 1438873163, "last_edit_date": 1438908594, "question_id": 31859182, "link": "https://stackoverflow.com/questions/31859182/why-is-cabal-update-so-slow-and-could-i-do-it-manually", "title": "Why is &quot;cabal update&quot; so slow and could I do it manually?", "body": "<p>When running <code>cabal update</code>, it takes so long time to download <code>00-index.tar.gz</code> from <a href=\"http://hackage.haskell.org/packages/index.tar.gz\">hackage</a>, howver, when I download it from chrome, it is just a 9M file and the downloading finishes soon.</p>\n\n<p>so, why is <code>cabal update</code> so slow, and could I improve the performance by, for example manually download the files?</p>\n\n<p>as for the version of cabal I am using, it is:</p>\n\n<blockquote>\n  <p>cabal-install version 1.22.6.0 using version 1.22.4.0 of the Cabal\n  library</p>\n</blockquote>\n"}, {"tags": ["haskell", "types"], "comments": [{"owner": {"reputation": 94713, "user_id": 1139697, "user_type": "registered", "accept_rate": 86, "profile_image": "https://www.gravatar.com/avatar/5f136ddb684f39aaee1c028ee1950f6f?s=128&d=identicon&r=PG", "display_name": "Zeta", "link": "https://stackoverflow.com/users/1139697/zeta"}, "edited": false, "score": 0, "creation_date": 1438872886, "post_id": 31858316, "comment_id": 51637575, "body": "Reminds me of <a href=\"https://lukepalmer.wordpress.com/2010/01/24/haskell-antipattern-existential-typeclass/\" rel=\"nofollow noreferrer\">lukepalmer.wordpress.com/2010/01/24/&hellip;</a>."}, {"owner": {"reputation": 48129, "user_id": 76051, "user_type": "registered", "accept_rate": 91, "profile_image": "https://i.stack.imgur.com/AGDxz.jpg?s=128&g=1", "display_name": "Carsten", "link": "https://stackoverflow.com/users/76051/carsten"}, "edited": false, "score": 1, "creation_date": 1438872991, "post_id": 31858316, "comment_id": 51637676, "body": "I kindof think of <a href=\"https://www.fpcomplete.com/school/to-infinity-and-beyond/pick-of-the-week/type-families-and-pokemon\" rel=\"nofollow noreferrer\">fpcomplete.com/school/to-infinity-and-beyond/pick-of-the-wee&zwnj;&#8203;k/&hellip;</a> ;)"}, {"owner": {"reputation": 3922, "user_id": 1198582, "user_type": "registered", "accept_rate": 99, "profile_image": "https://www.gravatar.com/avatar/02d3e1025aed5f061c481871986c45b1?s=128&d=identicon&r=PG", "display_name": "Michael Litchard", "link": "https://stackoverflow.com/users/1198582/michael-litchard"}, "edited": false, "score": 0, "creation_date": 1438875388, "post_id": 31858316, "comment_id": 51639547, "body": "Zeta: I suspected I was over-engineering. Do you think I could get farther just using records and functions?"}, {"owner": {"reputation": 3922, "user_id": 1198582, "user_type": "registered", "accept_rate": 99, "profile_image": "https://www.gravatar.com/avatar/02d3e1025aed5f061c481871986c45b1?s=128&d=identicon&r=PG", "display_name": "Michael Litchard", "link": "https://stackoverflow.com/users/1198582/michael-litchard"}, "edited": false, "score": 0, "creation_date": 1438884907, "post_id": 31858316, "comment_id": 51645128, "body": "Carsten: I was inspired by that article. But I will build this out with functions and records. If at that point I have a solid case for encoding rules at the type-level I will present it."}], "answers": [{"comments": [{"owner": {"reputation": 3922, "user_id": 1198582, "user_type": "registered", "accept_rate": 99, "profile_image": "https://www.gravatar.com/avatar/02d3e1025aed5f061c481871986c45b1?s=128&d=identicon&r=PG", "display_name": "Michael Litchard", "link": "https://stackoverflow.com/users/1198582/michael-litchard"}, "edited": false, "score": 0, "creation_date": 1438878552, "post_id": 31860195, "comment_id": 51641689, "body": "Okay, I&#39;ll do it this way. I was hoping I had a use case to learn type-level programming with."}], "tags": [], "owner": {"reputation": 23444, "user_id": 414413, "user_type": "registered", "accept_rate": 79, "profile_image": "https://www.gravatar.com/avatar/6de2113f01432aa844dc85070ff33e89?s=128&d=identicon&r=PG", "display_name": "Cirdec", "link": "https://stackoverflow.com/users/414413/cirdec"}, "is_accepted": true, "score": 2, "last_activity_date": 1438875883, "creation_date": 1438875883, "answer_id": 31860195, "question_id": 31858316, "link": "https://stackoverflow.com/questions/31858316/functional-banana-traveller-ship-system/31860195#31860195", "title": "Functional Banana Traveller - Ship System", "body": "<p>Don't enforce the constraint on \"ships one may have according to class and level\" at the type level. It may be OP, but there's (probably) no reason the game shouldn't work with a level 1 space ninja captaining a large 19th century ship of the line. Instead of resorting to type-level programming, the rules of the game can be written as ordinary functions, or even encoded as data. </p>\n\n<p>If you want to pick which ship someone is using from their class and ship size, you can just write a function.</p>\n\n<pre><code>data Ship = Ship {\n    _hull_junk              :: Hull,\n    _bridge_junk            :: Bridge,\n    _cargo_compartment_junk :: CargoCompartment,\n    _fuel_tank_junk         :: Tank\n}\n\ndata Hull = Raft | Sloop | Brig | Schooner | Starfighter | ...\n\nplayerShip :: PlayerClass -&gt; ShipClass -&gt; Ship\nplayerShip Pirate Tiny = Ship {\n    _hull_junk = Sloop,\n    _bridge_junk = ...\n}\nplayerShip SpaceNinja Tiny = Ship {\n    _hull_junk = Starfighter,\n    _bridge_junk = ...\n}\n...\n</code></pre>\n\n<p>We've moved the rules about which ship goes with a player and ship class from the type level to the level of ordinary Haskell code.</p>\n\n<p>You specified that there are multiple ships one might have by class and level. To handle that we'd return a list of ships based on the player's class and the ship size</p>\n\n<pre><code>allowedShips :: PlayerClass -&gt; ShipClass -&gt; [Ship]\n</code></pre>\n\n<p>To implement this easily, we might make a game data file that includes a list of ships, and for each ship, a list of which player classes  and ship classes it can be used for. By doing so, we move the rules about which ships can go with a player and ship class from the level of ordinary Haskell code to the level of data.</p>\n\n<pre><code>[\n    ([(Pirate, Tiny)], Ship {\n        _hull_junk = Sloop,\n        _bridge_junk = ...\n    }),\n    ([(SpaceNinja, Tiny)], Ship {\n        _hull_junk = Sloop,\n        _bridge_junk = ...\n    }),\n    ([(Pirate, Tiny),(Merchant, Tiny),(SpaceNinja,Tiny)], Ship {\n        _hull_junk = Raft,\n        _bridge_junk = ...\n    }),\n    ...\n]\n</code></pre>\n\n<p>To start with, you can list data like this in a <code>.hs</code> file <code>shipData :: [([(PirateClass, ShipClass)],Ship); shipData = ...</code> and implement <code>allowedShips</code> by filtering the <code>shipData</code> by pirate class and ship class.</p>\n\n<p>If all of the <code>_junk</code> is data, we can go further and treat this data as data, storing it in a file and reading it with derived <code>Read</code> instances.</p>\n"}], "owner": {"reputation": 3922, "user_id": 1198582, "user_type": "registered", "accept_rate": 99, "profile_image": "https://www.gravatar.com/avatar/02d3e1025aed5f061c481871986c45b1?s=128&d=identicon&r=PG", "display_name": "Michael Litchard", "link": "https://stackoverflow.com/users/1198582/michael-litchard"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 85, "favorite_count": 1, "accepted_answer_id": 31860195, "answer_count": 1, "score": 2, "last_activity_date": 1438875883, "creation_date": 1438870983, "question_id": 31858316, "link": "https://stackoverflow.com/questions/31858316/functional-banana-traveller-ship-system", "title": "Functional Banana Traveller - Ship System", "body": "<p>In this game, I want to have Player Classes, Player Levels, and ships one may have according to class and level. You can only have one ship at a time.\nI have come to the conclusion that what I need are datakinds and data families.</p>\n\n<p>Here's a snippet of what I have, followed by my questions.</p>\n\n<pre><code>{-# LANGUAGE DataKinds #-}\n{-# LANGUAGE TypeFamilies #-}\n{-# LANGUAGE KindSignatures #-}\n{-# LANGUAGE MultiParamTypeClasses}\n{-# LANGUAGE ConstraintKinds #-}\n\ndata PlayerClass = Pirate | Merchant | SpaceNinja deriving Show\ndata ShipClass = Tiny | Medium | Large deriving Show\ndata Merchant = Rookie | Swindler | IndustryCaptain deriving Show\ndata Pirate   = Lubber | Matey | Captain deriving Show\n\ndata family PShip (a :: PlayerClass) (b :: ShipClass)\ndata instance PShip Pirate Tiny = Junk\n  { _hull_junk              :: Hull\n  , _bridge_junk            :: Bridge\n  , _cargo_compartment_junk :: CargoCompartment\n  , _fuel_tank_junk         :: Tank\n} deriving Show\n</code></pre>\n\n<p>My understanding is that with DataKinds, I can promote Terms to Types, but still use them as Terms. I want a class to abstract the implementation of operations for PShips. I would like to constrain at the kind level (PlayerClass), and then create instances for types with that kind. Here's a snippet of what I am trying to do, but can't.</p>\n\n<pre><code> class (PShip a) =&gt; Ship a (b :: PlayerClass) where\n  ...\n instance Ship (Pirate Tiny) Lubber ...\n</code></pre>\n\n<p>Does this make sense? Am I on the right track, or should I back up and re-think this problem? Have I articulated the problem clearly?</p>\n"}, {"tags": ["list", "haskell", "set", "list-comprehension"], "comments": [{"owner": {"reputation": 94553, "user_id": 775806, "user_type": "registered", "accept_rate": 96, "profile_image": "https://i.stack.imgur.com/XNd2C.png?s=128&g=1", "display_name": "n. &#39;pronouns&#39; m.", "link": "https://stackoverflow.com/users/775806/n-pronouns-m"}, "edited": false, "score": 2, "creation_date": 1438871182, "post_id": 31858021, "comment_id": 51636164, "body": "<code>sets are the mathematical structure that inspired list comprehensions</code> But Data.Set is not that structure <code>because of the Ord constraint</code>."}], "answers": [{"comments": [{"owner": {"reputation": 13734, "user_id": 938694, "user_type": "registered", "accept_rate": 59, "profile_image": "https://www.gravatar.com/avatar/b6678a430a805dd78366d6e135b49f2d?s=128&d=identicon&r=PG", "display_name": "Cubic", "link": "https://stackoverflow.com/users/938694/cubic"}, "edited": false, "score": 1, "creation_date": 1438871159, "post_id": 31858174, "comment_id": 51636150, "body": "Err... how would lazy evaluation make set generation efficient? You have to evaluate all of the list to create the set. Lazy evaluation doesn&#39;t seem to do anything at all here."}, {"owner": {"reputation": 4938, "user_id": 1465011, "user_type": "registered", "accept_rate": 98, "profile_image": "https://www.gravatar.com/avatar/5c11daff0c870a2b41ae9b907a136adf?s=128&d=identicon&r=PG", "display_name": "recursion.ninja", "link": "https://stackoverflow.com/users/1465011/recursion-ninja"}, "reply_to_user": {"reputation": 13734, "user_id": 938694, "user_type": "registered", "accept_rate": 59, "profile_image": "https://www.gravatar.com/avatar/b6678a430a805dd78366d6e135b49f2d?s=128&d=identicon&r=PG", "display_name": "Cubic", "link": "https://stackoverflow.com/users/938694/cubic"}, "edited": false, "score": 1, "creation_date": 1438871357, "post_id": 31858174, "comment_id": 51636300, "body": "@Cubic You&#39;ll won&#39;t generate the entire list and then generate the entire set. The operation will fuse due to lazy evaluation, so if I generate a large list of  duplicates of a single element, I won&#39;t incur the memory overhead, as the set will lazily draw from the list and create the singleton set."}, {"owner": {"reputation": 3006, "user_id": 920130, "user_type": "registered", "accept_rate": 83, "profile_image": "https://i.stack.imgur.com/eF81F.jpg?s=128&g=1", "display_name": "Mathias Dolidon", "link": "https://stackoverflow.com/users/920130/mathias-dolidon"}, "edited": false, "score": 1, "creation_date": 1438871363, "post_id": 31858174, "comment_id": 51636312, "body": "Depending on fromList&#39;s implementation, in the best of worlds and with a lot of luck and a bit of optimism, if the list is large laziness can give the GC a chance to sweep the head of the list while the tail is being fed to the set builder. But in the real world I doubt there&#39;d be any effect indeed."}, {"owner": {"reputation": 94713, "user_id": 1139697, "user_type": "registered", "accept_rate": 86, "profile_image": "https://www.gravatar.com/avatar/5f136ddb684f39aaee1c028ee1950f6f?s=128&d=identicon&r=PG", "display_name": "Zeta", "link": "https://stackoverflow.com/users/1139697/zeta"}, "edited": false, "score": 1, "creation_date": 1438871538, "post_id": 31858174, "comment_id": 51636495, "body": "I&#39;m pretty sure that both <code>xs</code> and <code>ys</code> in OP&#39;s example are sets, not ordinary lists."}, {"owner": {"reputation": 4938, "user_id": 1465011, "user_type": "registered", "accept_rate": 98, "profile_image": "https://www.gravatar.com/avatar/5c11daff0c870a2b41ae9b907a136adf?s=128&d=identicon&r=PG", "display_name": "recursion.ninja", "link": "https://stackoverflow.com/users/1465011/recursion-ninja"}, "reply_to_user": {"reputation": 94713, "user_id": 1139697, "user_type": "registered", "accept_rate": 86, "profile_image": "https://www.gravatar.com/avatar/5f136ddb684f39aaee1c028ee1950f6f?s=128&d=identicon&r=PG", "display_name": "Zeta", "link": "https://stackoverflow.com/users/1139697/zeta"}, "edited": false, "score": 0, "creation_date": 1438871892, "post_id": 31858174, "comment_id": 51636789, "body": "@Zeta He should add type annotations then to be explicit. It appeared to be a list comprehension from the syntax."}, {"owner": {"reputation": 339851, "user_id": 149392, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/7a561ec0875fcbbe3066ea8fe288ec77?s=128&d=identicon&r=PG", "display_name": "sepp2k", "link": "https://stackoverflow.com/users/149392/sepp2k"}, "reply_to_user": {"reputation": 3006, "user_id": 920130, "user_type": "registered", "accept_rate": 83, "profile_image": "https://i.stack.imgur.com/eF81F.jpg?s=128&g=1", "display_name": "Mathias Dolidon", "link": "https://stackoverflow.com/users/920130/mathias-dolidon"}, "edited": false, "score": 1, "creation_date": 1438872299, "post_id": 31858174, "comment_id": 51637141, "body": "@MathiasDolidon I see nothing in <a href=\"https://downloads.haskell.org/~ghc/6.12.3/docs/html/libraries/containers-0.3.0.0/src/Data-Set.html#fromList\" rel=\"nofollow noreferrer\"><code>fromList</code>&#39;s implementation</a> that would keep the entire list in memory, so I see no reason why this wouldn&#39;t happen in the real world. Your doubts seem a bit too pessimistic to me."}, {"owner": {"reputation": 94553, "user_id": 775806, "user_type": "registered", "accept_rate": 96, "profile_image": "https://i.stack.imgur.com/XNd2C.png?s=128&g=1", "display_name": "n. &#39;pronouns&#39; m.", "link": "https://stackoverflow.com/users/775806/n-pronouns-m"}, "edited": false, "score": 3, "creation_date": 1438872690, "post_id": 31858174, "comment_id": 51637406, "body": "A function that diverges on infinite inputs isn&#39;t called lazy by most people."}, {"owner": {"reputation": 3006, "user_id": 920130, "user_type": "registered", "accept_rate": 83, "profile_image": "https://i.stack.imgur.com/eF81F.jpg?s=128&g=1", "display_name": "Mathias Dolidon", "link": "https://stackoverflow.com/users/920130/mathias-dolidon"}, "reply_to_user": {"reputation": 339851, "user_id": 149392, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/7a561ec0875fcbbe3066ea8fe288ec77?s=128&d=identicon&r=PG", "display_name": "sepp2k", "link": "https://stackoverflow.com/users/149392/sepp2k"}, "edited": false, "score": 0, "creation_date": 1438872702, "post_id": 31858174, "comment_id": 51637417, "body": "@sepp2k The GC&#39;s mood. :)  n.m. the lazy one would be the list provider, not the set builder."}, {"owner": {"reputation": 94713, "user_id": 1139697, "user_type": "registered", "accept_rate": 86, "profile_image": "https://www.gravatar.com/avatar/5f136ddb684f39aaee1c028ee1950f6f?s=128&d=identicon&r=PG", "display_name": "Zeta", "link": "https://stackoverflow.com/users/1139697/zeta"}, "edited": false, "score": 0, "creation_date": 1438872717, "post_id": 31858174, "comment_id": 51637428, "body": "<i>&quot;There are no language extensions which allow for &quot;set comprehensions.&quot;&quot;</i> One could probably use QuasiQuotations like <code>[sc|\u2026]</code>. But TemplateHaskell doesn&#39;t count."}, {"owner": {"reputation": 3006, "user_id": 920130, "user_type": "registered", "accept_rate": 83, "profile_image": "https://i.stack.imgur.com/eF81F.jpg?s=128&g=1", "display_name": "Mathias Dolidon", "link": "https://stackoverflow.com/users/920130/mathias-dolidon"}, "reply_to_user": {"reputation": 94713, "user_id": 1139697, "user_type": "registered", "accept_rate": 86, "profile_image": "https://www.gravatar.com/avatar/5f136ddb684f39aaee1c028ee1950f6f?s=128&d=identicon&r=PG", "display_name": "Zeta", "link": "https://stackoverflow.com/users/1139697/zeta"}, "edited": false, "score": 0, "creation_date": 1438873281, "post_id": 31858174, "comment_id": 51637905, "body": "@Zeta&#39;s first remark makes me wonder, sidetracking though : in something like Clojure, one wouldn&#39;t care whether the source data be a list, a set, or anything else. It would just comply with the <code>ISeq</code> interface, be lazy and let anybody do whatever they want. Would there be a typeclass that&#39;d be an equivalent to Clojure&#39;s ISeq ?"}, {"owner": {"reputation": 4938, "user_id": 1465011, "user_type": "registered", "accept_rate": 98, "profile_image": "https://www.gravatar.com/avatar/5c11daff0c870a2b41ae9b907a136adf?s=128&d=identicon&r=PG", "display_name": "recursion.ninja", "link": "https://stackoverflow.com/users/1465011/recursion-ninja"}, "reply_to_user": {"reputation": 3006, "user_id": 920130, "user_type": "registered", "accept_rate": 83, "profile_image": "https://i.stack.imgur.com/eF81F.jpg?s=128&g=1", "display_name": "Mathias Dolidon", "link": "https://stackoverflow.com/users/920130/mathias-dolidon"}, "edited": false, "score": 2, "creation_date": 1438873461, "post_id": 31858174, "comment_id": 51638060, "body": "@MathiasDolidon perhaps <code>Foldable</code> or <code>ListLike</code>. It would be interesting if instances of <code>Foldable</code> could be generalize to allow for arbitrary &quot;list comprehension&quot; syntax."}, {"owner": {"reputation": 44013, "user_id": 1477667, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/trgKM.jpg?s=128&g=1", "display_name": "dfeuer", "link": "https://stackoverflow.com/users/1477667/dfeuer"}, "reply_to_user": {"reputation": 94553, "user_id": 775806, "user_type": "registered", "accept_rate": 96, "profile_image": "https://i.stack.imgur.com/XNd2C.png?s=128&g=1", "display_name": "n. &#39;pronouns&#39; m.", "link": "https://stackoverflow.com/users/775806/n-pronouns-m"}, "edited": false, "score": 1, "creation_date": 1439059317, "post_id": 31858174, "comment_id": 51709984, "body": "@n.m., that&#39;s because most people conflate &quot;strict&quot; with &quot;eager&quot; and &quot;non-strict&quot; with &quot;lazy&quot;. But these are distinct ideas, and it&#39;s possible for one thing to be lazier than another even if they are equally strict (under appropriate assumptions). Notably, if a data structure is implemented as an abstract data type, it can be &quot;effectively strict&quot; in its structure while actually having a lazy spine. Functions that operate on the structure can be considered &quot;strict&quot; even if they don&#39;t always force the whole structure, or even most of it. This can make semantic reasoning simpler."}], "tags": [], "owner": {"reputation": 4938, "user_id": 1465011, "user_type": "registered", "accept_rate": 98, "profile_image": "https://www.gravatar.com/avatar/5c11daff0c870a2b41ae9b907a136adf?s=128&d=identicon&r=PG", "display_name": "recursion.ninja", "link": "https://stackoverflow.com/users/1465011/recursion-ninja"}, "is_accepted": false, "score": 8, "last_activity_date": 1438921181, "last_edit_date": 1438921181, "creation_date": 1438870636, "answer_id": 31858174, "question_id": 31858021, "link": "https://stackoverflow.com/questions/31858021/haskell-set-comprehensions/31858174#31858174", "title": "Haskell Set Comprehensions", "body": "<h1>In Theory, No</h1>\n\n<p>There are no language extensions which allow for \"set comprehensions.\" </p>\n\n<p>The differences between a <code>Set</code> and a <code>List</code> are:</p>\n\n<ol>\n<li>The <code>Set</code> is unordered while the <code>List</code> is ordered</li>\n<li>The elements of the <code>Set</code>are unique while the <code>List</code> may have duplicate elements</li>\n<li>The type of the <code>Set</code> is an instance of <code>Ord</code> while the <code>List</code> has no type restrictions.</li>\n</ol>\n\n<p>You can see that all possible <code>Set</code>s are a strict subset of all possible <code>List</code>s. This means that we can achieve \"set comprehension\" simply be using a list comprehension and converting it to a <code>Set</code>. Lazy evaluation will <em>often</em> make the \"set generation\" efficient deriving from most <em>finite</em> list comprehensions. However, list comprehensions resulting in <em>infinite</em> lists are unlikely to result in efficient \"set comprehension.\"</p>\n\n<p><strong>Example:</strong></p>\n\n<pre><code>import Data.Set\n\nset :: Ord a =&gt; Set a\nset = fromList [x * y | x &lt;- [1..10], y &lt;- [1..10]]\n</code></pre>\n\n<h1>In Practice, Yes</h1>\n\n<p>Using the <a href=\"https://hackage.haskell.org/package/set-monad-0.2.0.0/docs/Data-Set-Monad.html\" rel=\"noreferrer\"><strong><code>set-monad</code></strong></a> package, you can define a <code>Set</code> as an instance of  <code>Monad</code> and using the language extension <code>MonadComprehensions</code> you can achieve a \"set comprehension\".</p>\n\n<p><strong>Example:</strong></p>\n\n<pre><code>{-# LANGUAGE MonadComprehensions #-}\nimport Data.Set.Monad\n\nset1 :: Set (Int,Int)\nset1 = do \n         a &lt;- fromList [1 .. 4]\n         b &lt;- fromList [1 .. 4]\n         return (a,b)\n\n-- Look a \"set comprehension\"\nset2 :: Set (Int,Int)\nset2 = [ (a,b) | (a,b) &lt;- set1, even a, even b ]\n</code></pre>\n\n<p><em>Use whichever method makes the most sense for your project. Profile both before making a decision!</em> </p>\n"}], "owner": {"user_type": "does_not_exist", "display_name": "user2649442"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 2751, "favorite_count": 2, "answer_count": 1, "score": 6, "last_activity_date": 1438921181, "creation_date": 1438870265, "last_edit_date": 1438873727, "question_id": 31858021, "link": "https://stackoverflow.com/questions/31858021/haskell-set-comprehensions", "title": "Haskell Set Comprehensions", "body": "<p>Is there any possibility, such as a language extension, to use the syntax of list comprehensions syntax for <code>Data.Set</code> sets?</p>\n\n<p><strong>Example:</strong></p>\n\n<pre><code>f :: Set a -&gt; Set b -&gt; Set (a,b)\nf xs ys = [(x,y) | x &lt;- xs , y &lt;- ys] -- this is the set comprehension\n</code></pre>\n\n<p>Since sets are the mathematical structure that inspired list comprehensions it would be kind of strange not to have any possibility of using them on sets.</p>\n\n<p>And yes, I am aware of <code>MonadComprehensions</code> for using the list-comp syntax with any <code>Monad</code>/<code>MonadPlus</code> type but AFAIK sets can't even be monads because of the <code>Ord</code> constraint in most functions.</p>\n"}, {"tags": ["haskell", "type-conversion"], "comments": [{"owner": {"reputation": 49959, "user_id": 866915, "user_type": "registered", "accept_rate": 70, "profile_image": "https://www.gravatar.com/avatar/09242131d6e17cbbe31e8547514da6e5?s=128&d=identicon&r=PG", "display_name": "ErikR", "link": "https://stackoverflow.com/users/866915/erikr"}, "edited": false, "score": 0, "creation_date": 1438865341, "post_id": 31855909, "comment_id": 51631747, "body": "What is your <code>mySum</code> and <code>myLength</code>? Ok - I see them now."}, {"owner": {"reputation": 938, "user_id": 4163506, "user_type": "registered", "accept_rate": 92, "profile_image": "https://www.gravatar.com/avatar/57e96b2432b47a690aecb5f532739f8c?s=128&d=identicon&r=PG&f=1", "display_name": "Lazarus535", "link": "https://stackoverflow.com/users/4163506/lazarus535"}, "reply_to_user": {"reputation": 49959, "user_id": 866915, "user_type": "registered", "accept_rate": 70, "profile_image": "https://www.gravatar.com/avatar/09242131d6e17cbbe31e8547514da6e5?s=128&d=identicon&r=PG", "display_name": "ErikR", "link": "https://stackoverflow.com/users/866915/erikr"}, "edited": false, "score": 0, "creation_date": 1438865600, "post_id": 31855909, "comment_id": 51631952, "body": "<code>mySum</code> just adds up all the numbers in a list. <code>myLength</code> counts the elements in a list."}], "answers": [{"comments": [{"owner": {"reputation": 938, "user_id": 4163506, "user_type": "registered", "accept_rate": 92, "profile_image": "https://www.gravatar.com/avatar/57e96b2432b47a690aecb5f532739f8c?s=128&d=identicon&r=PG&f=1", "display_name": "Lazarus535", "link": "https://stackoverflow.com/users/4163506/lazarus535"}, "edited": false, "score": 0, "creation_date": 1438866222, "post_id": 31856208, "comment_id": 51632426, "body": "Nice thanks. Also the analogy with Java very nice. Being more of a C++ guy myself i would implement such a function with template specialization. So there is one generic version and a specialisation for each concrete type, which actually does the correct conversion. Does haskell implement this? Do you know by any chance?"}, {"owner": {"reputation": 339851, "user_id": 149392, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/7a561ec0875fcbbe3066ea8fe288ec77?s=128&d=identicon&r=PG", "display_name": "sepp2k", "link": "https://stackoverflow.com/users/149392/sepp2k"}, "reply_to_user": {"reputation": 938, "user_id": 4163506, "user_type": "registered", "accept_rate": 92, "profile_image": "https://www.gravatar.com/avatar/57e96b2432b47a690aecb5f532739f8c?s=128&d=identicon&r=PG&f=1", "display_name": "Lazarus535", "link": "https://stackoverflow.com/users/4163506/lazarus535"}, "edited": false, "score": 0, "creation_date": 1438866521, "post_id": 31856208, "comment_id": 51632665, "body": "@Lazarus535 <code>fromIntegral</code> has exactly one definition, which is <code>fromIntegral = fromInteger . toInteger</code>. <code>fromInteger</code> is part of the <code>Num</code> typeclass, so it&#39;s defined separately for each <code>Num</code> type, and <code>toInteger</code> is part of the <code>Integral</code> typeclass, so again it&#39;s defined separately for each integral type."}, {"owner": {"reputation": 938, "user_id": 4163506, "user_type": "registered", "accept_rate": 92, "profile_image": "https://www.gravatar.com/avatar/57e96b2432b47a690aecb5f532739f8c?s=128&d=identicon&r=PG&f=1", "display_name": "Lazarus535", "link": "https://stackoverflow.com/users/4163506/lazarus535"}, "edited": false, "score": 0, "creation_date": 1438868440, "post_id": 31856208, "comment_id": 51634197, "body": "Yeah. Thats it. If the functions that the <code>fromIntegral</code> is composed of are all part of their respective typeclasses than it is basically like template specialisation in C++. THX."}, {"owner": {"reputation": 339851, "user_id": 149392, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/7a561ec0875fcbbe3066ea8fe288ec77?s=128&d=identicon&r=PG", "display_name": "sepp2k", "link": "https://stackoverflow.com/users/149392/sepp2k"}, "reply_to_user": {"reputation": 938, "user_id": 4163506, "user_type": "registered", "accept_rate": 92, "profile_image": "https://www.gravatar.com/avatar/57e96b2432b47a690aecb5f532739f8c?s=128&d=identicon&r=PG&f=1", "display_name": "Lazarus535", "link": "https://stackoverflow.com/users/4163506/lazarus535"}, "edited": false, "score": 0, "creation_date": 1438869360, "post_id": 31856208, "comment_id": 51634855, "body": "@Lazarus535 Not quite. <code>fromIntegral</code> is just a plain non-specialized template function, whereas <code>fromInteger</code> and <code>toInteger</code> aren&#39;t templates at all. They&#39;re just overloaded for each instance of <code>Num</code> and <code>Integral</code> respectively. Here&#39;s a sketch of how you&#39;d implement similar behavior in C++: <a href=\"http://codepad.org/qCt0tte8\" rel=\"nofollow noreferrer\">codepad.org/qCt0tte8</a>"}, {"owner": {"reputation": 938, "user_id": 4163506, "user_type": "registered", "accept_rate": 92, "profile_image": "https://www.gravatar.com/avatar/57e96b2432b47a690aecb5f532739f8c?s=128&d=identicon&r=PG&f=1", "display_name": "Lazarus535", "link": "https://stackoverflow.com/users/4163506/lazarus535"}, "edited": false, "score": 0, "creation_date": 1438876973, "post_id": 31856208, "comment_id": 51640660, "body": "Thanks for putting together this nice sample :-). Template specialisations would be a bit of an overkill here...and would not provide more type safety. You still could pass a Double instead of an intended Int (for example) to the fromIntegral function and the C++ compiler would (almost) silently eat it."}, {"owner": {"reputation": 339851, "user_id": 149392, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/7a561ec0875fcbbe3066ea8fe288ec77?s=128&d=identicon&r=PG", "display_name": "sepp2k", "link": "https://stackoverflow.com/users/149392/sepp2k"}, "reply_to_user": {"reputation": 938, "user_id": 4163506, "user_type": "registered", "accept_rate": 92, "profile_image": "https://www.gravatar.com/avatar/57e96b2432b47a690aecb5f532739f8c?s=128&d=identicon&r=PG&f=1", "display_name": "Lazarus535", "link": "https://stackoverflow.com/users/4163506/lazarus535"}, "edited": false, "score": 0, "creation_date": 1438877475, "post_id": 31856208, "comment_id": 51640986, "body": "@Lazarus535 Yes, because there&#39;s an implicit conversion from double to int. If we replace the typedefs at the beginning with wrapper classes (and don&#39;t define any implicit conversions for them), we do get the same type safety as in Haskell. Except that in Haskell the type signature explicitly states which typeclasses the given types need to instance, whereas in C++ the required overloads are not visible in the signature. You can only tell by going through the code or reading the documentation (if it existed)  - something which concepts would have fixed, had they made it into the language."}, {"owner": {"reputation": 938, "user_id": 4163506, "user_type": "registered", "accept_rate": 92, "profile_image": "https://www.gravatar.com/avatar/57e96b2432b47a690aecb5f532739f8c?s=128&d=identicon&r=PG&f=1", "display_name": "Lazarus535", "link": "https://stackoverflow.com/users/4163506/lazarus535"}, "edited": false, "score": 0, "creation_date": 1438887061, "post_id": 31856208, "comment_id": 51646318, "body": "Additionally one could add explicit constructors in the wrapper classes that create objects just from the indented values. Together with just one type cast operator, one could even call the <code>fromIntegral</code> with the original types and still be type-safe (wrapper classes as template argumens still). And then you have finally hit the 10x code size difference between Haskell and C++ ;-)"}], "tags": [], "owner": {"reputation": 339851, "user_id": 149392, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/7a561ec0875fcbbe3066ea8fe288ec77?s=128&d=identicon&r=PG", "display_name": "sepp2k", "link": "https://stackoverflow.com/users/149392/sepp2k"}, "is_accepted": true, "score": 10, "last_activity_date": 1438865201, "creation_date": 1438865201, "answer_id": 31856208, "question_id": 31855909, "link": "https://stackoverflow.com/questions/31855909/haskell-fromintegral-type-confusion/31856208#31856208", "title": "Haskell fromIntegral -- type confusion", "body": "<p><code>fromIntegral</code> doesn't produce some unknown type of which we only know that it's an instance of <code>Num</code>. <code>fromIntegral</code> produces whichever type we (usually implicitly) ask it to, as long as its an instance of <code>Num</code>.</p>\n\n<p>In terms of OO languages, you need to think of it as generics/templates, not virtual inheritance/subtype polymorphism. That is the equivalent Java signature for <code>fromIntegral</code> would look like <code>&lt;A extends Integral, B extends Num&gt; B fromIntegral(A i)</code>, not <code>Num fromIntegral(Integral i)</code>.</p>\n\n<p>so if we want an <code>Int</code>, we get an <code>Int</code>. If we want an <code>Integer</code>, we get an <code>Integer</code>. And if we want a <code>Double</code>, we get a <code>Double</code>. But if we want a <code>String</code>, we're out of luck as <code>String</code> is not an instance of <code>Num</code>.</p>\n\n<p>In this case we want an <code>a</code> where <code>a</code> is the element type of the given list. So if we pass in a list of <code>Double</code>s, <code>fromIntegral</code> gives us a <code>Double</code> and if we pass in a list of <code>Rational</code>s, <code>fromIntegral</code> gives us a <code>Rational</code>.</p>\n"}, {"comments": [{"owner": {"reputation": 938, "user_id": 4163506, "user_type": "registered", "accept_rate": 92, "profile_image": "https://www.gravatar.com/avatar/57e96b2432b47a690aecb5f532739f8c?s=128&d=identicon&r=PG&f=1", "display_name": "Lazarus535", "link": "https://stackoverflow.com/users/4163506/lazarus535"}, "edited": false, "score": 0, "creation_date": 1438868687, "post_id": 31856784, "comment_id": 51634367, "body": "Thanks for answering. The thing that had me confused was that in Haskell type deduction works in &quot;both directions&quot;."}], "tags": [], "owner": {"reputation": 49959, "user_id": 866915, "user_type": "registered", "accept_rate": 70, "profile_image": "https://www.gravatar.com/avatar/09242131d6e17cbbe31e8547514da6e5?s=128&d=identicon&r=PG", "display_name": "ErikR", "link": "https://stackoverflow.com/users/866915/erikr"}, "is_accepted": false, "score": 6, "last_activity_date": 1438866741, "creation_date": 1438866741, "answer_id": 31856784, "question_id": 31855909, "link": "https://stackoverflow.com/questions/31855909/haskell-fromintegral-type-confusion/31856784#31856784", "title": "Haskell fromIntegral -- type confusion", "body": "<p>You ask:</p>\n\n<blockquote>\n  <p>But fromIntegral only garantees that the returned value will be an instance of Num.</p>\n</blockquote>\n\n<p>That's true, but consider the type of <code>fromIntegral</code>:</p>\n\n<pre><code>fromIntegral :: (Integral a, Num b) =&gt; a -&gt; b\n</code></pre>\n\n<p>So <code>fromIntegral</code> allows us to convert an <code>Int</code>, for example, to <em>any</em> other Num instance.</p>\n\n<p>For the time being, let's deal with concrete types instead of type classes. Suppose you had defined <code>myAverage</code> like this:</p>\n\n<pre><code>myAverage :: [Double] -&gt; Maybe Double\nmyAverage [] = Nothing\nmyAverage xs = Just $ mySum xs / (fromIntegral (myLength xs))\n</code></pre>\n\n<p><code>Double</code> supports division, and <code>fromIntegral</code> is able to convert the <code>Int</code> returned from <code>myLength</code> to a <code>Double</code>.</p>\n\n<p>The same definition would work if you used <code>Rational</code> instead of <code>Double</code>, e.g.:</p>\n\n<pre><code>myAverage :: [Rational] -&gt; Maybe Rational\n</code></pre>\n\n<p>Back to type classes and how it type checks:</p>\n\n<pre><code>myAverage :: Fractional a =&gt; [a] -&gt; Maybe a\n...\nmyAverage xs = Just $ mySum xs / (fromIntegral (myLength xs))\n</code></pre>\n\n<p>Here's how it goes:</p>\n\n<ol>\n<li><code>a</code> is Fractional, and Fractional is a subclass of Num, so <code>a</code> is also a Num.</li>\n<li><code>xs</code> has type <code>[a]</code>, so <code>mySum xs</code> has type <code>a</code></li>\n<li><code>myLength xs</code> has type <code>Int</code></li>\n<li><code>fromIntegral</code> can convert <code>Int</code> into any other Num instance, so it can convert an <code>Int</code> into an <code>a</code></li>\n<li><code>mySum xs</code> and the fromIntegral expression both have type <code>a</code> which is a Fractional, so we can perform the division.</li>\n</ol>\n"}], "owner": {"reputation": 938, "user_id": 4163506, "user_type": "registered", "accept_rate": 92, "profile_image": "https://www.gravatar.com/avatar/57e96b2432b47a690aecb5f532739f8c?s=128&d=identicon&r=PG&f=1", "display_name": "Lazarus535", "link": "https://stackoverflow.com/users/4163506/lazarus535"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 1181, "favorite_count": 2, "accepted_answer_id": 31856208, "answer_count": 2, "score": 3, "last_activity_date": 1438866741, "creation_date": 1438864429, "question_id": 31855909, "link": "https://stackoverflow.com/questions/31855909/haskell-fromintegral-type-confusion", "title": "Haskell fromIntegral -- type confusion", "body": "<p>I am just going through \"Real World Haskell\" and I am doing the excercises that come along with it.</p>\n\n<p>And i noticed something that i think is odd.</p>\n\n<p>Take this function for example:</p>\n\n<p><code>myAverage :: (Fractional a) =&gt; [a] -&gt; Maybe a\nmyAverage [] = Nothing\nmyAverage xs = Just $ (mySum xs) / (fromIntegral $  myLength xs)</code></p>\n\n<p>The <code>(/)</code> function wants two arguments that are instances of <code>Fractional</code>.\n<code>myLength</code> returns an <code>Int</code> so i use <code>the fromIntegral</code> function as i have been told.</p>\n\n<p>But <code>fromIntegral</code> only garantees that the returned value will be an instance of <code>Num</code>.</p>\n\n<p>Why does <code>Num</code> also \"include\" an instance of <code>Fractional</code> in this case. Isn't <code>Fractional</code> more specific?</p>\n\n<p>Why doesn't the compiler complain that i have just a <code>Num</code> from the return type and not a \"proper\" <code>Fractional</code>.</p>\n\n<p>Why can't i use the <code>Int</code> directly, it is also an instance of <code>Num</code>, is it not?</p>\n\n<p>In the case of calling <code>mySum</code> i get it. It takes a list of <code>Num</code>s but i feed it with a list of <code>Fractional</code>s (which are also <code>Num</code>s, because they are derived from it). The return type has the same type, which is evident from the type annotation (see below): a single element of <code>Fractional</code></p>\n\n<p>But in case of <code>fromIntegral</code> i cannot infer myself (the compiler obviously can :-)) that the returned value is also an instance of <code>Fractional</code>. Why?\nThe type it takes is clearly no <code>Fractional</code>. </p>\n\n<p>The whole function works as expected.</p>\n\n<p>Just for clarification:</p>\n\n<p><code>mySum :: (Num a) =&gt; [a] -&gt; a\nmyLength :: [a] -&gt; Int</code></p>\n\n<p>Thank you,</p>\n\n<p>Lazarus</p>\n"}, {"tags": ["haskell"], "comments": [{"owner": {"reputation": 4938, "user_id": 1465011, "user_type": "registered", "accept_rate": 98, "profile_image": "https://www.gravatar.com/avatar/5c11daff0c870a2b41ae9b907a136adf?s=128&d=identicon&r=PG", "display_name": "recursion.ninja", "link": "https://stackoverflow.com/users/1465011/recursion-ninja"}, "edited": false, "score": 0, "creation_date": 1438869699, "post_id": 31852435, "comment_id": 51635087, "body": "import <a href=\"https://hackage.haskell.org/package/base-4.8.1.0/docs/Control-Applicative.html\" rel=\"nofollow noreferrer\"><b><code>Control.Applicative</code></b></a>"}], "answers": [{"tags": [], "owner": {"reputation": 133611, "user_id": 152602, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/7f370b4bd787fc68f9f62d9c6781cb79?s=128&d=identicon&r=PG", "display_name": "Lee", "link": "https://stackoverflow.com/users/152602/lee"}, "is_accepted": false, "score": 9, "last_activity_date": 1438855306, "last_edit_date": 1438855306, "creation_date": 1438855178, "answer_id": 31852694, "question_id": 31852435, "link": "https://stackoverflow.com/questions/31852435/how-to-use-applicative-operators-for-the-maybe-and-list-monads-in-haskell/31852694#31852694", "title": "How to use Applicative operators for the Maybe and List Monads in Haskell?", "body": "<p><code>&lt;$&gt;</code> and <code>&lt;*&gt;</code> are defined in <code>Control.Applicative</code>, so you need to import them:</p>\n\n<pre><code>import Control.Applicative ((&lt;$&gt;), (&lt;*&gt;))\n</code></pre>\n\n<p><code>&lt;$&gt;</code> is an infix version of <code>fmap</code>, so, for your example, you need to use <code>&lt;*&gt;</code> which lifts function application over an applicative:</p>\n\n<pre><code>(Just succ) &lt;*&gt; (Just 0)\n</code></pre>\n"}, {"comments": [{"owner": {"reputation": 10378, "user_id": 2476735, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/39e9447bbc32246fcd23b76b5e946618?s=128&d=identicon&r=PG&f=1", "display_name": "David Young", "link": "https://stackoverflow.com/users/2476735/david-young"}, "edited": false, "score": 1, "creation_date": 1438867043, "post_id": 31852857, "comment_id": 51633067, "body": "You might want to use <code>:m +Control.Applicative</code>. Without the + it &quot;unimports&quot; all other imported modules. You can also use a - to unimport a single, specific module."}], "tags": [], "owner": {"reputation": 1066, "user_id": 2081046, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/04a2d3a5da814dd0e29b233d40e37b5d?s=128&d=identicon&r=PG&f=1", "display_name": "zudov", "link": "https://stackoverflow.com/users/2081046/zudov"}, "is_accepted": true, "score": 12, "last_activity_date": 1438855585, "creation_date": 1438855585, "answer_id": 31852857, "question_id": 31852435, "link": "https://stackoverflow.com/questions/31852435/how-to-use-applicative-operators-for-the-maybe-and-list-monads-in-haskell/31852857#31852857", "title": "How to use Applicative operators for the Maybe and List Monads in Haskell?", "body": "<p>You error arises because you didn't <code>&lt;$&gt;</code> is not is scope (just as compiler said). The <code>&lt;$&gt;</code> operator is provided by module <code>Data.Functor</code> and <code>Control.Applicative</code>. So just load the module into ghci:</p>\n\n<pre><code>:m Control.Applicative\n</code></pre>\n\n<p>or if you are not in ghci</p>\n\n<pre><code>import Control.Applicative\n</code></pre>\n\n<p>note that starting with <code>base-4.8</code> (ghc 7.10), <code>&lt;$&gt;</code> is included in Prelude and thus imported by default.</p>\n\n<p>However that's not your only problem. <code>&lt;$&gt;</code> (<code>fmap</code>) allow you to apply the function to some value inside the Functor/Monad/Applicative. For example</p>\n\n<pre><code>succ &lt;$&gt; Just 0\n-- =&gt; Just 1\nsucc &lt;$&gt; Nothing\n-- =&gt; Nothing\nfmap succ (Just 0)\n-- =&gt; Just 1\n</code></pre>\n\n<p>But if you want to apply a function which is itself inside the Functor/Monad/Applicative you need <code>&lt;*&gt;</code></p>\n\n<pre><code>Just succ &lt;*&gt; Just 1\n-- =&gt; Just 2\nNothing &lt;*&gt; Just 1\n-- =&gt; Nothing\nJust succ &lt;*&gt; Nothing\n-- =&gt; Nothing\n</code></pre>\n\n<p>This operator is extremely useful for functions with several arguments:</p>\n\n<pre><code>(+) &lt;$&gt; Just 1 &lt;*&gt; Just 2\n-- Just (+1) &lt;*&gt; Just 2        (intermediate step)\n-- =&gt; Just 3\n</code></pre>\n"}], "owner": {"reputation": 160, "user_id": 4037117, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/EnIoB.jpg?s=128&g=1", "display_name": "The Show that never ends", "link": "https://stackoverflow.com/users/4037117/the-show-that-never-ends"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 120, "favorite_count": 2, "accepted_answer_id": 31852857, "answer_count": 2, "score": 2, "last_activity_date": 1438855585, "creation_date": 1438854519, "question_id": 31852435, "link": "https://stackoverflow.com/questions/31852435/how-to-use-applicative-operators-for-the-maybe-and-list-monads-in-haskell", "title": "How to use Applicative operators for the Maybe and List Monads in Haskell?", "body": "<p><code>Maybe</code> and <code>List</code> are monads and I can use the bind operator <code>&gt;&gt;=</code> as expected, as in:</p>\n\n<pre><code>Prelude&gt; (Just 0) &gt;&gt;= (\\x -&gt; Just(succ x))\nJust 1\n</code></pre>\n\n<p>However if try to use the <code>&lt;$&gt;</code> applicative operator, I get an error:</p>\n\n<pre><code>Prelude&gt; (Just succ) &lt;$&gt; (Just 0)\n\n&lt;interactive&gt;:16:6: Not in scope: \u2018&lt;$&gt;\u2019\n</code></pre>\n\n<p>How to correct my input so that this last expression evaluates to <code>Just 1</code>.</p>\n"}, {"tags": ["haskell", "pattern-matching"], "comments": [{"owner": {"reputation": 14781, "user_id": 630160, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/4445f21326af525a8ad19af7e3ae41a8?s=128&d=identicon&r=PG", "display_name": "epsilonhalbe", "link": "https://stackoverflow.com/users/630160/epsilonhalbe"}, "edited": false, "score": 0, "creation_date": 1438847803, "post_id": 31848212, "comment_id": 51620225, "body": "btw. the <code>MyList</code> you are defining is not equivalent to the usual list, in this case you are defining a non-empty list! if you are interested and want to compare your solutions to something quite similar <a href=\"https://hackage.haskell.org/package/semigroups-0.8.5/docs/Data-List-NonEmpty.html\" rel=\"nofollow noreferrer\">hackage.haskell.org/package/semigroups-0.8.5/docs/&hellip;</a>"}], "answers": [{"tags": [], "owner": {"reputation": 1657, "user_id": 4183787, "user_type": "registered", "accept_rate": 62, "profile_image": "https://i.stack.imgur.com/XedpJ.png?s=128&g=1", "display_name": "zigazou", "link": "https://stackoverflow.com/users/4183787/zigazou"}, "is_accepted": true, "score": 7, "last_activity_date": 1438843748, "creation_date": 1438843748, "answer_id": 31848653, "question_id": 31848212, "link": "https://stackoverflow.com/questions/31848212/how-do-i-write-the-pattern-matching-correctly-here/31848653#31848653", "title": "How do I write the pattern matching correctly here?", "body": "<p>It is not different, it\u2019s because there is an error:</p>\n\n<pre><code>myFindMax (Atom x) = getAtom x\n</code></pre>\n\n<p>will try to call <code>getAtom</code> to a value that is not (generally) an <code>Atom</code> value. The pattern is already doing the job of the <code>getAtom</code> function. You should write:</p>\n\n<pre><code>myFindMax (Atom x) = x\n</code></pre>\n"}], "owner": {"reputation": 1555, "user_id": 901883, "user_type": "registered", "accept_rate": 58, "profile_image": "https://www.gravatar.com/avatar/e052e211d757479676da909bbc472440?s=128&d=identicon&r=PG", "display_name": "manasij7479", "link": "https://stackoverflow.com/users/901883/manasij7479"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 52, "favorite_count": 0, "accepted_answer_id": 31848653, "answer_count": 1, "score": 0, "last_activity_date": 1438843748, "creation_date": 1438842233, "question_id": 31848212, "link": "https://stackoverflow.com/questions/31848212/how-do-i-write-the-pattern-matching-correctly-here", "title": "How do I write the pattern matching correctly here?", "body": "<p>The following code works:</p>\n\n<pre><code>data MyList a = Atom a | Cons a (MyList a) deriving (Show)\n\ngetAtom (Atom a) = a\n\nmyFindMax :: (Ord a) =&gt; MyList a -&gt; a \nmyFindMax (Cons x xs) = let restMax = myFindMax xs in\n                          if x &gt; restMax then x else restMax\nmyFindMax x = getAtom x\n</code></pre>\n\n<p>But when I write </p>\n\n<pre><code>myFindMax (Atom x) = getAtom x\n</code></pre>\n\n<p>Before the other pattern, I get the error</p>\n\n<pre><code>Couldn't match expected type \u2018MyList a\u2019 with actual type \u2018a\u2019\n      \u2018a\u2019 is a rigid type variable bound by\n          the type signature for myFindMax :: Ord a =&gt; MyList a -&gt; a\n          at myList.hs:5:14\n</code></pre>\n\n<p>Why is the Atom case different from the Cons case?</p>\n"}, {"tags": ["list", "haskell", "monads"], "answers": [{"comments": [{"owner": {"reputation": 315, "user_id": 3355020, "user_type": "registered", "accept_rate": 70, "profile_image": "https://www.gravatar.com/avatar/f362ac17823145e0a4ab0c154b65ba23?s=128&d=identicon&r=PG&f=1", "display_name": "user3355020", "link": "https://stackoverflow.com/users/3355020/user3355020"}, "edited": false, "score": 0, "creation_date": 1438844069, "post_id": 31848514, "comment_id": 51618170, "body": "So I am inadvertently using the list monad, not a list?  I guess a true list wouldn&#39;t even be accepted by the interpreter in that line of code?"}, {"owner": {"reputation": 100892, "user_id": 745903, "user_type": "registered", "accept_rate": 74, "profile_image": "https://www.gravatar.com/avatar/50933f6638836741e620669b3940410e?s=128&d=identicon&r=PG", "display_name": "leftaroundabout", "link": "https://stackoverflow.com/users/745903/leftaroundabout"}, "reply_to_user": {"reputation": 315, "user_id": 3355020, "user_type": "registered", "accept_rate": 70, "profile_image": "https://www.gravatar.com/avatar/f362ac17823145e0a4ab0c154b65ba23?s=128&d=identicon&r=PG&f=1", "display_name": "user3355020", "link": "https://stackoverflow.com/users/3355020/user3355020"}, "edited": false, "score": 4, "creation_date": 1438844519, "post_id": 31848514, "comment_id": 51618391, "body": "@user3355020: sure it&#39;s a list, as true as any. Talking of the <i>list monad</i> just means we&#39;re focusing on one particular feature/property of lists."}], "tags": [], "owner": {"reputation": 100892, "user_id": 745903, "user_type": "registered", "accept_rate": 74, "profile_image": "https://www.gravatar.com/avatar/50933f6638836741e620669b3940410e?s=128&d=identicon&r=PG", "display_name": "leftaroundabout", "link": "https://stackoverflow.com/users/745903/leftaroundabout"}, "is_accepted": true, "score": 12, "last_activity_date": 1438843314, "creation_date": 1438843314, "answer_id": 31848514, "question_id": 31848124, "link": "https://stackoverflow.com/questions/31848124/operator-poor-mans-loop-in-haskell/31848514#31848514", "title": "&gt;&gt; operator - poor man&#39;s loop in Haskell?", "body": "<p>First note that this has nothing whatsoever to do with <code>IO</code>. It has to do with monads, but with a very specific one: the list monad.</p>\n\n<pre><code>instance Monad [] where\n  return x = [x]\n  f &gt;&gt;= xs = concat $ map f xs   -- aka `(&gt;&gt;=) = concatMap`.\n</code></pre>\n\n<p>It is best know for <em>list comprehensions</em>, which are basically syntactic sugar<sup>&dagger;</sup>:</p>\n\n<pre><code>[ result x y z | x &lt;- bla, y &lt;- foo x, z &lt;- bar ]\n</code></pre>\n\n<p>translates to</p>\n\n<pre><code>bla &gt;&gt;=\n   \\x -&gt; foo x &gt;&gt;=\n            \\y -&gt; bar &gt;&gt;=\n                     \\z -&gt; return (result x y z)\n</code></pre>\n\n<p>Now, <code>a&gt;&gt;b</code> is only a short-cut to <code>a &gt;&gt;= \\_ -&gt; b</code>, i.e. it ignores the values contained in the LHS monadic action, but &ldquo;pretends&rdquo; to use them in the RHS nonetheless. So, <code>[1,1,1] &gt;&gt; \"ok\"</code> is the same as</p>\n\n<pre><code>[ \"ok\" | _ &lt;- [1,1,1] ]\n</code></pre>\n\n<p>at least almost...actually that's the same as <code>[1,1,1] &gt;&gt; return \"ok\"</code>, i.e. <code>&gt;&gt; [\"ok\"]</code>, which will give</p>\n\n<pre><code>[\"ok\", \"ok\", \"ok\"]\n</code></pre>\n\n<p>If you omit the singleton <code>return</code>, each <code>\"ok\"</code> will not be wrapped in a list and those concatenated, rather the strings themselves are all concatenated by the monadic bind. And that's how you get <code>\"okokok\"</code>.</p>\n\n<hr>\n\n<p><sup>&dagger;</sup><sub>The equivalent default implementation is actually a bit different, but with the <code>-XMonadComprehensions</code> extension, list comprehensions really work this way.</sub></p>\n"}], "owner": {"reputation": 315, "user_id": 3355020, "user_type": "registered", "accept_rate": 70, "profile_image": "https://www.gravatar.com/avatar/f362ac17823145e0a4ab0c154b65ba23?s=128&d=identicon&r=PG&f=1", "display_name": "user3355020", "link": "https://stackoverflow.com/users/3355020/user3355020"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 119, "favorite_count": 0, "accepted_answer_id": 31848514, "answer_count": 1, "score": 2, "last_activity_date": 1438843470, "creation_date": 1438841867, "last_edit_date": 1438843470, "question_id": 31848124, "link": "https://stackoverflow.com/questions/31848124/operator-poor-mans-loop-in-haskell", "title": "&gt;&gt; operator - poor man&#39;s loop in Haskell?", "body": "<p>I don't know Haskell, I just wanted to play around with it in order to learn it.  I was trying to understand io, monads, etc. and wrote this in the interpreter (GHCi, version 7.10.2, WinGHCI):</p>\n\n<pre><code>Prelude&gt; [1,1] &gt;&gt; \"ok\"\n\"okok\"\nPrelude&gt; [1,1,1] &gt;&gt; \"ok\"\n\"okokok\"\nPrelude&gt; [1..10] &gt;&gt; \"ok\"\n\"okokokokokokokokokok\"\nPrelude&gt; [1] &gt;&gt; \"ok\" &gt;&gt; [1] &gt;&gt; \"ok\"\n\"okok\"\nPrelude&gt; [1,2] &gt;&gt; \"ok\" &gt;&gt; [1,2] &gt;&gt; \"ok\"\n\"okokokokokokokok\"\nPrelude&gt; [1..10] &gt;&gt; [1..10]\n[1,2,3,4,5,6,7,8,9,10,1,2,3,4,5,6,7,8,9,10,1,2,3,4,5,6,7,8,9,10,1,2,3,4,5,6,7,8,9,10,1,2,3,4,5,6,7,8,9,10,1,2,3,4,5,6,7,8,9,10,1,2,3,4,5,6,7,8,9,10,1,2,3,4,5,6,7,8,9,10,1,2,3,4,5,6,7,8,9,10,1,2,3,4,5,6,7,8,9,10]\n</code></pre>\n\n<p>Care to explain?  Why does the number of elements in the list affect how many times \"ok\" is written (or in the last case, the number of times an array is written)?  The >> operator isn't supposed to do this, is it?</p>\n"}, {"tags": ["haskell", "yesod", "yesod-julius"], "answers": [{"tags": [], "owner": {"reputation": 49959, "user_id": 866915, "user_type": "registered", "accept_rate": 70, "profile_image": "https://www.gravatar.com/avatar/09242131d6e17cbbe31e8547514da6e5?s=128&d=identicon&r=PG", "display_name": "ErikR", "link": "https://stackoverflow.com/users/866915/erikr"}, "is_accepted": true, "score": 3, "last_activity_date": 1438834413, "creation_date": 1438834413, "answer_id": 31846729, "question_id": 31846518, "link": "https://stackoverflow.com/questions/31846518/using-julius-outside-yesod/31846729#31846729", "title": "using Julius outside Yesod", "body": "<p>Try this:</p>\n\n<pre><code>import qualified Data.Text.Lazy.IO as LazyIO\nimport Text.Julius\nimport Data.Aeson\n\nmain = do\n    let delta = toJSON (1 :: Int)\n    LazyIO.putStrLn $ renderJavascript $ [julius|\n        function f(x) {\n          return x + #{delta};\n        }\n    |] undefined\n</code></pre>\n\n<p>Explanation:</p>\n\n<p>The error message is saying that <code>delta</code> needs to have a <code>ToJavascript</code> instance. Looking up the <code>ToJavascript</code> class shows that these instances are defined by default:</p>\n\n<pre><code>ToJavascript Bool    \nToJavascript Value   \nToJavascript RawJavascript   \n</code></pre>\n\n<p>The lack of an <code>Int</code> (or <code>Integer</code>) instance explains the error message.</p>\n\n<p>However, there is a <code>Value</code> instance, and by using <code>toJSON</code> from the Aeson library we can turn an <code>Int</code> into a <code>Value</code>.</p>\n"}, {"tags": [], "owner": {"reputation": 43759, "user_id": 1651941, "user_type": "registered", "accept_rate": 97, "profile_image": "https://www.gravatar.com/avatar/a513bc1fa519d2fcf5e4e0d9b5500101?s=128&d=identicon&r=PG", "display_name": "Sibi", "link": "https://stackoverflow.com/users/1651941/sibi"}, "is_accepted": false, "score": 2, "last_activity_date": 1438835109, "last_edit_date": 1438835109, "creation_date": 1438834628, "answer_id": 31846757, "question_id": 31846518, "link": "https://stackoverflow.com/questions/31846518/using-julius-outside-yesod/31846757#31846757", "title": "using Julius outside Yesod", "body": "<p>Using <code>rawJS</code> should make it work:</p>\n\n<pre><code>{-# LANGUAGE QuasiQuotes #-}\n\nimport qualified Data.Text.Lazy.IO as LazyIO\nimport Text.Julius\n\nmain = do\n    let delta = rawJS $ show (1 :: Int)\n    LazyIO.putStrLn $ renderJavascript $ [julius|\n        function f(x) {\n          return x + #{delta};\n        }\n    |] undefined\n</code></pre>\n\n<p>Will produce:</p>\n\n<pre><code>function f(x) {\n  return x + 1       \n}\n</code></pre>\n"}], "owner": {"reputation": 26022, "user_id": 410102, "user_type": "registered", "accept_rate": 93, "profile_image": "https://www.gravatar.com/avatar/a70b7da5a3a712e800100e61ef8d8917?s=128&d=identicon&r=PG", "display_name": "akonsu", "link": "https://stackoverflow.com/users/410102/akonsu"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 210, "favorite_count": 0, "accepted_answer_id": 31846729, "answer_count": 2, "score": 3, "last_activity_date": 1438835109, "creation_date": 1438833061, "question_id": 31846518, "link": "https://stackoverflow.com/questions/31846518/using-julius-outside-yesod", "title": "using Julius outside Yesod", "body": "<p>I am trying to figure out how to emit Javascript code using standalone Julius outside yesod:</p>\n\n<pre><code>{-# LANGUAGE QuasiQuotes #-}\n\nimport qualified Data.Text.Lazy.IO as LazyIO\nimport Text.Julius\n\nmain = do\n    let delta = 1 :: Int\n    LazyIO.putStrLn $ renderJavascript $ [julius|\n        function f(x) {\n          return x + #{delta};\n        }\n    |] undefined\n</code></pre>\n\n<p>But I am getting this error:</p>\n\n<pre><code>t2.hs:8:48:\n    No instance for (ToJavascript Integer)\n      arising from a use of \u2018toJavascript\u2019\n    In the expression: toJavascript delta\n    ...\n</code></pre>\n\n<p>Please help. I have no idea what it needs, I have just started looking at Julius. If I remove the interpolation then it renders the text successfully.</p>\n"}, {"tags": ["haskell", "ghc"], "comments": [{"owner": {"reputation": 25144, "user_id": 477476, "user_type": "registered", "accept_rate": 85, "profile_image": "https://i.stack.imgur.com/Qf4TT.png?s=128&g=1", "display_name": "Cactus", "link": "https://stackoverflow.com/users/477476/cactus"}, "edited": false, "score": 1, "creation_date": 1438824250, "post_id": 31845305, "comment_id": 51612009, "body": "Is this on 32 or 64 bits?"}], "answers": [{"comments": [{"owner": {"reputation": 3462, "user_id": 914859, "user_type": "registered", "accept_rate": 33, "profile_image": "https://www.gravatar.com/avatar/52bf147a3e31747586f594049359d3d1?s=128&d=identicon&r=PG", "display_name": "Michael Fox", "link": "https://stackoverflow.com/users/914859/michael-fox"}, "edited": false, "score": 0, "creation_date": 1438866584, "post_id": 31845385, "comment_id": 51632713, "body": "Thanks. <code>forever (threadDelay maxBound)</code> from that bug report is a better idea than mine."}, {"owner": {"reputation": 126897, "user_id": 791604, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/ce991df7a056248d5e4f6fc3659ba733?s=128&d=identicon&r=PG", "display_name": "Daniel Wagner", "link": "https://stackoverflow.com/users/791604/daniel-wagner"}, "reply_to_user": {"reputation": 3462, "user_id": 914859, "user_type": "registered", "accept_rate": 33, "profile_image": "https://www.gravatar.com/avatar/52bf147a3e31747586f594049359d3d1?s=128&d=identicon&r=PG", "display_name": "Michael Fox", "link": "https://stackoverflow.com/users/914859/michael-fox"}, "edited": false, "score": 1, "creation_date": 1438881465, "post_id": 31845385, "comment_id": 51643292, "body": "@MichaelFox I&#39;ve updated the answer with a proposed workaround."}, {"owner": {"reputation": 3462, "user_id": 914859, "user_type": "registered", "accept_rate": 33, "profile_image": "https://www.gravatar.com/avatar/52bf147a3e31747586f594049359d3d1?s=128&d=identicon&r=PG", "display_name": "Michael Fox", "link": "https://stackoverflow.com/users/914859/michael-fox"}, "edited": false, "score": 0, "creation_date": 1438907953, "post_id": 31845385, "comment_id": 51654921, "body": "Thanks. I will do exactly that."}], "tags": [], "owner": {"reputation": 126897, "user_id": 791604, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/ce991df7a056248d5e4f6fc3659ba733?s=128&d=identicon&r=PG", "display_name": "Daniel Wagner", "link": "https://stackoverflow.com/users/791604/daniel-wagner"}, "is_accepted": true, "score": 8, "last_activity_date": 1438881433, "last_edit_date": 1438881433, "creation_date": 1438824578, "answer_id": 31845385, "question_id": 31845305, "link": "https://stackoverflow.com/questions/31845305/does-threaddelay-maxbound-int-trip-a-ghc-bug-or-what/31845385#31845385", "title": "Does `threadDelay (maxBound :: Int)` trip a GHC bug or what?", "body": "<p>This seems to be a <a href=\"https://ghc.haskell.org/trac/ghc/ticket/7325\" rel=\"nofollow noreferrer\">known GHC bug</a>, with some progress made (though not all configurations appear to be fixed yet).</p>\n\n<p>In the meantime, you could use <code>forever (threadDelay (2^20))</code> or similar as a workaround; <code>2^20</code> ought to be far enough away from <code>maxBound</code> to avoid this bug, and waking up once a second for a few cycles should be quite easy on your system.</p>\n"}], "owner": {"reputation": 3462, "user_id": 914859, "user_type": "registered", "accept_rate": 33, "profile_image": "https://www.gravatar.com/avatar/52bf147a3e31747586f594049359d3d1?s=128&d=identicon&r=PG", "display_name": "Michael Fox", "link": "https://stackoverflow.com/users/914859/michael-fox"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 159, "favorite_count": 0, "accepted_answer_id": 31845385, "answer_count": 1, "score": 8, "last_activity_date": 1438881433, "creation_date": 1438823972, "question_id": 31845305, "link": "https://stackoverflow.com/questions/31845305/does-threaddelay-maxbound-int-trip-a-ghc-bug-or-what", "title": "Does `threadDelay (maxBound :: Int)` trip a GHC bug or what?", "body": "<p>I want my program to basically lockup forever and the first idea I had was:</p>\n\n<pre><code>threadDelay (maxBound :: Int)\n</code></pre>\n\n<p>This gave some spurious warnings:</p>\n\n<pre><code>Prelude&gt; import Control.Concurrent\nPrelude Control.Concurrent&gt; threadDelay 10\nPrelude Control.Concurrent&gt; threadDelay (maxBound :: Int)\n&lt;interactive&gt;: c_poll: invalid argument (Invalid argument)\n&lt;interactive&gt;: ioManagerWakeup: write: Bad file descriptor\n</code></pre>\n\n<p>Did I do wrong or did GHC?</p>\n"}]