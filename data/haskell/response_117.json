[{"tags": ["haskell", "linker", "gold-linker"], "comments": [{"owner": {"reputation": 351, "user_id": 1657201, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/a9a9f61e7f1c8e52cf05c4d230b4de57?s=128&d=identicon&r=PG", "display_name": "vshabanov", "link": "https://stackoverflow.com/users/1657201/vshabanov"}, "edited": false, "score": 0, "creation_date": 1491515536, "post_id": 43243322, "comment_id": 73601286, "body": "Besides switching linker you could use <code>-dynamic</code> flag. It could easily speedup linking tenfold."}, {"owner": {"reputation": 21995, "user_id": 263061, "user_type": "registered", "accept_rate": 69, "profile_image": "https://www.gravatar.com/avatar/7c724c96f7ec19f73245499b6169e329?s=128&d=identicon&r=PG", "display_name": "nh2", "link": "https://stackoverflow.com/users/263061/nh2"}, "reply_to_user": {"reputation": 351, "user_id": 1657201, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/a9a9f61e7f1c8e52cf05c4d230b4de57?s=128&d=identicon&r=PG", "display_name": "vshabanov", "link": "https://stackoverflow.com/users/1657201/vshabanov"}, "edited": false, "score": 0, "creation_date": 1491524019, "post_id": 43243322, "comment_id": 73604077, "body": "@vshabanov Is this actually the case? I have tried in the past to use dynamic linking and it did not make things faster for my entire cabal project. But I may have done something wrong so that it used <code>-dynamic-too</code>, giving me both static and dynamic libraries. It would be great to have a minimal example project that shows if it really makes it faster."}, {"owner": {"reputation": 351, "user_id": 1657201, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/a9a9f61e7f1c8e52cf05c4d230b4de57?s=128&d=identicon&r=PG", "display_name": "vshabanov", "link": "https://stackoverflow.com/users/1657201/vshabanov"}, "edited": false, "score": 0, "creation_date": 1491578292, "post_id": 43243322, "comment_id": 73631488, "body": "you should use only <code>-dynamic</code> GHC option. <code>-dynamic-too</code> links <b>both</b> statically (slow, large executables) and dynamically (smaller executables, faster link times), so you don&#39;t get any speedup."}, {"owner": {"reputation": 21995, "user_id": 263061, "user_type": "registered", "accept_rate": 69, "profile_image": "https://www.gravatar.com/avatar/7c724c96f7ec19f73245499b6169e329?s=128&d=identicon&r=PG", "display_name": "nh2", "link": "https://stackoverflow.com/users/263061/nh2"}, "reply_to_user": {"reputation": 351, "user_id": 1657201, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/a9a9f61e7f1c8e52cf05c4d230b4de57?s=128&d=identicon&r=PG", "display_name": "vshabanov", "link": "https://stackoverflow.com/users/1657201/vshabanov"}, "edited": false, "score": 0, "creation_date": 1491670302, "post_id": 43243322, "comment_id": 73661146, "body": "@vshabanov I&#39;ve tried dynamically linked executables now, they are not a good choice for me, because the startup time of my executable (just for the <code>--help</code> text) increased from <code>160 ms</code> (static) to <code>4.5 seconds</code> due to run-time linking. I will stick with static linking for now."}, {"owner": {"reputation": 351, "user_id": 1657201, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/a9a9f61e7f1c8e52cf05c4d230b4de57?s=128&d=identicon&r=PG", "display_name": "vshabanov", "link": "https://stackoverflow.com/users/1657201/vshabanov"}, "edited": false, "score": 0, "creation_date": 1491697705, "post_id": 43243322, "comment_id": 73668893, "body": "That&#39;s quite strange (both 0.16s and 4.5s for app start). What platform you&#39;re on? And do you have enough free RAM? Perhaps long linking you have is a cache issue. And interesting what was linking speedup on your projects when you tried dynamic linking?"}, {"owner": {"reputation": 21995, "user_id": 263061, "user_type": "registered", "accept_rate": 69, "profile_image": "https://www.gravatar.com/avatar/7c724c96f7ec19f73245499b6169e329?s=128&d=identicon&r=PG", "display_name": "nh2", "link": "https://stackoverflow.com/users/263061/nh2"}, "reply_to_user": {"reputation": 351, "user_id": 1657201, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/a9a9f61e7f1c8e52cf05c4d230b4de57?s=128&d=identicon&r=PG", "display_name": "vshabanov", "link": "https://stackoverflow.com/users/1657201/vshabanov"}, "edited": false, "score": 1, "creation_date": 1491789644, "post_id": 43243322, "comment_id": 73692693, "body": "@vshabanov On Linux. I have about 30 GB free RAM. It&#39;s not a cache issue, it happens on subsequent starts; the time it takes is 100% user CPU time spent in the ld-linux dynamic linker/loader. <a href=\"https://www.iecc.com/linker/linker10.html\" rel=\"nofollow noreferrer\">This page</a> agrees with the phenomenon: <code>The runtime performance costs of dynamic linking are substantial compared to those of static linking</code>. Note I have 100s of entries in <code>lld</code>. Regarding speedup, link time seems to have gone down from 2.5 s per executable to 1.5, but that&#39;s not worth the increased startup time for me."}, {"owner": {"reputation": 21995, "user_id": 263061, "user_type": "registered", "accept_rate": 69, "profile_image": "https://www.gravatar.com/avatar/7c724c96f7ec19f73245499b6169e329?s=128&d=identicon&r=PG", "display_name": "nh2", "link": "https://stackoverflow.com/users/263061/nh2"}, "reply_to_user": {"reputation": 351, "user_id": 1657201, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/a9a9f61e7f1c8e52cf05c4d230b4de57?s=128&d=identicon&r=PG", "display_name": "vshabanov", "link": "https://stackoverflow.com/users/1657201/vshabanov"}, "edited": false, "score": 1, "creation_date": 1491789666, "post_id": 43243322, "comment_id": 73692700, "body": "I found <a href=\"http://stackoverflow.com/a/1607954/263061\">this useful comment</a> that suggests that dynamic linking speed can be drastically improved by setting <code>-fvisibility=hidden</code> and manually exporting all exported symbols. Maybe the dynamic loading startup time could be improved by using that."}], "answers": [{"comments": [{"owner": {"reputation": 15757, "user_id": 176841, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/45a168cb9eb8454d66c78f18e29d9342?s=128&d=identicon&r=PG", "display_name": "jberryman", "link": "https://stackoverflow.com/users/176841/jberryman"}, "edited": false, "score": 2, "creation_date": 1491444282, "post_id": 43243323, "comment_id": 73558895, "body": "How big is your project, if you don&#39;t mind me asking?"}, {"owner": {"reputation": 21995, "user_id": 263061, "user_type": "registered", "accept_rate": 69, "profile_image": "https://www.gravatar.com/avatar/7c724c96f7ec19f73245499b6169e329?s=128&d=identicon&r=PG", "display_name": "nh2", "link": "https://stackoverflow.com/users/263061/nh2"}, "reply_to_user": {"reputation": 15757, "user_id": 176841, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/45a168cb9eb8454d66c78f18e29d9342?s=128&d=identicon&r=PG", "display_name": "jberryman", "link": "https://stackoverflow.com/users/176841/jberryman"}, "edited": false, "score": 2, "creation_date": 1491480120, "post_id": 43243323, "comment_id": 73577796, "body": "@jberryman Not very big, 150 Haskell modules and 8 executables built from them. But it depends on (and links) a couple native libraries like opencv. With <code>ld</code>, each library link takes almost 20 seconds."}, {"owner": {"reputation": 8237, "user_id": 2900502, "user_type": "registered", "accept_rate": 73, "profile_image": "https://i.stack.imgur.com/R1OjD.jpg?s=128&g=1", "display_name": "Shersh", "link": "https://stackoverflow.com/users/2900502/shersh"}, "edited": false, "score": 2, "creation_date": 1491486098, "post_id": 43243323, "comment_id": 73582473, "body": "Confirming build speed up by reducing time by <code>40</code> seconds on 489 modules and 13 executables project (tests and benchmakrs included)."}, {"owner": {"reputation": 21995, "user_id": 263061, "user_type": "registered", "accept_rate": 69, "profile_image": "https://www.gravatar.com/avatar/7c724c96f7ec19f73245499b6169e329?s=128&d=identicon&r=PG", "display_name": "nh2", "link": "https://stackoverflow.com/users/263061/nh2"}, "reply_to_user": {"reputation": 3295, "user_id": 388010, "user_type": "registered", "accept_rate": 98, "profile_image": "https://www.gravatar.com/avatar/f6c6f0feb5cb53e7023d5d9ecc443767?s=128&d=identicon&r=PG", "display_name": "Sebastian Graf", "link": "https://stackoverflow.com/users/388010/sebastian-graf"}, "edited": false, "score": 0, "creation_date": 1491490243, "post_id": 43243323, "comment_id": 73585903, "body": "@SebastianGraf It does not work out of the box with <code>lld</code>, at least not with the options I provided, because (at least on my system) ghc links by calling <code>gcc</code>, and gcc is <a href=\"https://gcc.gnu.org/ml/gcc-patches/2016-07/msg00155.html\" rel=\"nofollow noreferrer\">not (yet) compatible with <code>lld</code></a>. You would have to tell ghc to use the clang toolchain instead of gcc; I haven&#39;t tried that yet. Would be very interested to know what the flags are for that though."}, {"owner": {"reputation": 3295, "user_id": 388010, "user_type": "registered", "accept_rate": 98, "profile_image": "https://www.gravatar.com/avatar/f6c6f0feb5cb53e7023d5d9ecc443767?s=128&d=identicon&r=PG", "display_name": "Sebastian Graf", "link": "https://stackoverflow.com/users/388010/sebastian-graf"}, "edited": false, "score": 0, "creation_date": 1491578212, "post_id": 43243323, "comment_id": 73631438, "body": "Wow, that&#39;s awesome! Let&#39;s start a GHC proposal to use <code>lld</code> by default!"}, {"owner": {"reputation": 3411, "user_id": 69663, "user_type": "registered", "accept_rate": 33, "profile_image": "https://i.stack.imgur.com/aiMZN.png?s=128&g=1", "display_name": "unhammer", "link": "https://stackoverflow.com/users/69663/unhammer"}, "edited": false, "score": 0, "creation_date": 1492598409, "post_id": 43243323, "comment_id": 74041015, "body": "Will it work without changes to the .cabal if you simply overwrite the /usr/bin/ld symlink to ldd?"}, {"owner": {"reputation": 21995, "user_id": 263061, "user_type": "registered", "accept_rate": 69, "profile_image": "https://www.gravatar.com/avatar/7c724c96f7ec19f73245499b6169e329?s=128&d=identicon&r=PG", "display_name": "nh2", "link": "https://stackoverflow.com/users/263061/nh2"}, "reply_to_user": {"reputation": 3411, "user_id": 69663, "user_type": "registered", "accept_rate": 33, "profile_image": "https://i.stack.imgur.com/aiMZN.png?s=128&g=1", "display_name": "unhammer", "link": "https://stackoverflow.com/users/69663/unhammer"}, "edited": false, "score": 1, "creation_date": 1492617906, "post_id": 43243323, "comment_id": 74055781, "body": "@unhammer It will not necessarily work; <code>lld</code> doesn&#39;t accept all flags that <code>ld</code> accepts, and officially <code>gcc</code> (which GHC invokes by default for linking) doesn&#39;t support linking with <code>lld</code>. (Also you mean <code>lld</code>, not <code>ldd</code> -- just saying because this typo can actually get confusing, as both are linking related programs)."}, {"owner": {"reputation": 3411, "user_id": 69663, "user_type": "registered", "accept_rate": 33, "profile_image": "https://i.stack.imgur.com/aiMZN.png?s=128&g=1", "display_name": "unhammer", "link": "https://stackoverflow.com/users/69663/unhammer"}, "edited": false, "score": 0, "creation_date": 1492672403, "post_id": 43243323, "comment_id": 74079053, "body": "Thanks for the clarification @nh2 \u2013 and yes, I&#39;ve already confused myself with the typo many times :)"}], "tags": [], "owner": {"reputation": 21995, "user_id": 263061, "user_type": "registered", "accept_rate": 69, "profile_image": "https://www.gravatar.com/avatar/7c724c96f7ec19f73245499b6169e329?s=128&d=identicon&r=PG", "display_name": "nh2", "link": "https://stackoverflow.com/users/263061/nh2"}, "is_accepted": true, "score": 45, "last_activity_date": 1491537715, "last_edit_date": 1491537715, "creation_date": 1491435492, "answer_id": 43243323, "question_id": 43243322, "link": "https://stackoverflow.com/questions/43243322/how-to-link-with-the-gnu-gold-linker-instead-of-ld-in-haskell/43243323#43243323", "title": "How to link with the GNU gold linker instead of ld in Haskell", "body": "<h1>Link 3x faster with <code>gold</code></h1>\n\n<p><a href=\"https://ghc.haskell.org/trac/ghc/ticket/6063\" rel=\"noreferrer\">Since GHC 7.8</a>, you can tell GHC and cabal (at run time without having to recompile GHC) to link with GNU gold.</p>\n\n<p>You need in your <code>.cabal</code> file:</p>\n\n<pre><code>library:\n  ghc-options: -optl-fuse-ld=gold\n  ld-options:  -fuse-ld=gold\n\nexecutable myExecutable\n  ghc-options: -optl-fuse-ld=gold\n  ld-options:  -fuse-ld=gold\n</code></pre>\n\n<p>(Note you might want to pass these flags to <code>stack</code>/<code>cabal</code>/<code>Setup.hs</code> on the command line instead of hardcoding them in the .cabal file in order to not reduce the portability of the package.)</p>\n\n<p>For me it's <code>3.5x</code> faster, bringing down the total link time of a project from 150 seconds to 40 seconds.</p>\n\n<hr>\n\n<h1>Update: Link 10x faster with <code>lld</code></h1>\n\n<p>See <a href=\"https://github.com/nh2/link-with-lld-example\" rel=\"noreferrer\">https://github.com/nh2/link-with-lld-example</a> for a full example; key parts:</p>\n\n<pre><code>library\n  ghc-options: \"-pgmP clang\" \"-pgmc clang\" \"-pgma clang\" \"-pgml clang\" \"-optl-fuse-ld=lld\"\n  ld-options:  -fuse-ld=lld\n\nexecutable myExecutable\n  ghc-options: \"-pgmP clang\" \"-pgmc clang\" \"-pgma clang\" \"-pgml clang\"\n  ld-options:  -fuse-ld=lld\n</code></pre>\n\n<p>Comparison of link time for the final executable link times my project:</p>\n\n<pre><code>ld   124 seconds\ngold  36 seconds\nlld   11 seconds\n</code></pre>\n"}], "owner": {"reputation": 21995, "user_id": 263061, "user_type": "registered", "accept_rate": 69, "profile_image": "https://www.gravatar.com/avatar/7c724c96f7ec19f73245499b6169e329?s=128&d=identicon&r=PG", "display_name": "nh2", "link": "https://stackoverflow.com/users/263061/nh2"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 3715, "favorite_count": 10, "accepted_answer_id": 43243323, "answer_count": 1, "score": 35, "last_activity_date": 1491537715, "creation_date": 1491435492, "question_id": 43243322, "link": "https://stackoverflow.com/questions/43243322/how-to-link-with-the-gnu-gold-linker-instead-of-ld-in-haskell", "title": "How to link with the GNU gold linker instead of ld in Haskell", "body": "<p>My Haskell project spends lots of time in <code>Linking dist/build/myapp/myapp ...</code> and also in loading shared libraries when executing <code>TemplateHaskell</code> code.</p>\n\n<p>I suspect this is because <code>ld</code> is slow.</p>\n\n<p>How can I improve link times by switching to the <code>gold</code> linker?</p>\n"}, {"tags": ["haskell", "functional-programming", "records"], "comments": [{"owner": {"reputation": 14781, "user_id": 630160, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/4445f21326af525a8ad19af7e3ae41a8?s=128&d=identicon&r=PG", "display_name": "epsilonhalbe", "link": "https://stackoverflow.com/users/630160/epsilonhalbe"}, "edited": false, "score": 2, "creation_date": 1491425067, "post_id": 43241259, "comment_id": 73552709, "body": "I think you should look into some of the <code>lens</code> tutorials <a href=\"https://hackage.haskell.org/package/lens\" rel=\"nofollow noreferrer\">hackage.haskell.org/package/lens</a>"}, {"owner": {"reputation": 100185, "user_id": 3234959, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/93bb12ca0f93dfddb33880316f7e66c2?s=128&d=identicon&r=PG&f=1", "display_name": "chi", "link": "https://stackoverflow.com/users/3234959/chi"}, "edited": false, "score": 0, "creation_date": 1491474494, "post_id": 43241259, "comment_id": 73573724, "body": "Just for the record, without lenses, I think the best you can do is <code>mapGas f = (\\car -&gt; car {gas = f (gas car)})</code>. This at least avoids mentioning the other fields."}, {"owner": {"reputation": 29444, "user_id": 3072788, "user_type": "registered", "accept_rate": 82, "profile_image": "https://www.gravatar.com/avatar/220a45c2fcff7e7358d144551b116205?s=128&d=identicon&r=PG&f=1", "display_name": "Alec", "link": "https://stackoverflow.com/users/3072788/alec"}, "reply_to_user": {"reputation": 100185, "user_id": 3234959, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/93bb12ca0f93dfddb33880316f7e66c2?s=128&d=identicon&r=PG&f=1", "display_name": "chi", "link": "https://stackoverflow.com/users/3234959/chi"}, "edited": false, "score": 0, "creation_date": 1491498369, "post_id": 43241259, "comment_id": 73591763, "body": "@chi What I usually do in those cases is try to preserve the symmetry: <code>mapGas f = (\\car@Car{ gas = g } -&gt; car {gas = f g })</code>. Longer, but you can see the <code>gas</code> field on both sides of <code>-&gt;</code>."}], "answers": [{"comments": [{"owner": {"reputation": 75362, "user_id": 625403, "user_type": "registered", "accept_rate": 82, "profile_image": "https://www.gravatar.com/avatar/786eed7da67079cb5d63a49d469af25b?s=128&d=identicon&r=PG", "display_name": "amalloy", "link": "https://stackoverflow.com/users/625403/amalloy"}, "edited": false, "score": 5, "creation_date": 1491427585, "post_id": 43241438, "comment_id": 73554026, "body": "I don&#39;t know if I&#39;d say that lens&#39;s existence is evidence that the core language is powerful enough. lens creation is explicitly done outside of the core language, using template haskell to generate a bunch of code because the core language is not powerful enough to let that code be written once in a general way and then reused."}, {"owner": {"reputation": 8268, "user_id": 7602518, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/9ddcddc4afafdfc5603b2473b191c74f?s=128&d=identicon&r=PG", "display_name": "Pedro Castilho", "link": "https://stackoverflow.com/users/7602518/pedro-castilho"}, "reply_to_user": {"reputation": 75362, "user_id": 625403, "user_type": "registered", "accept_rate": 82, "profile_image": "https://www.gravatar.com/avatar/786eed7da67079cb5d63a49d469af25b?s=128&d=identicon&r=PG", "display_name": "amalloy", "link": "https://stackoverflow.com/users/625403/amalloy"}, "edited": false, "score": 1, "creation_date": 1491435955, "post_id": 43241438, "comment_id": 73556787, "body": "You can actually create lenses without using templates, it just tends to be a bit tedious to do so people use templates to streamline it. As for being powerful, I meant that in the sense that a lot of stuff that needs to be hard-coded into other programming languages can be defined in Haskell."}, {"owner": {"reputation": 31108, "user_id": 350351, "user_type": "registered", "accept_rate": 85, "profile_image": "https://www.gravatar.com/avatar/b1a41bbf4677c8961237c4d147e764d6?s=128&d=identicon&r=PG", "display_name": "Daenyth", "link": "https://stackoverflow.com/users/350351/daenyth"}, "reply_to_user": {"reputation": 75362, "user_id": 625403, "user_type": "registered", "accept_rate": 82, "profile_image": "https://www.gravatar.com/avatar/786eed7da67079cb5d63a49d469af25b?s=128&d=identicon&r=PG", "display_name": "amalloy", "link": "https://stackoverflow.com/users/625403/amalloy"}, "edited": false, "score": 0, "creation_date": 1491440143, "post_id": 43241438, "comment_id": 73557851, "body": "@amalloy lens creation is only done with templating to reduce boilerplate. You could write all the lens functions by hand, it would just suck."}, {"owner": {"reputation": 29444, "user_id": 3072788, "user_type": "registered", "accept_rate": 82, "profile_image": "https://www.gravatar.com/avatar/220a45c2fcff7e7358d144551b116205?s=128&d=identicon&r=PG&f=1", "display_name": "Alec", "link": "https://stackoverflow.com/users/3072788/alec"}, "reply_to_user": {"reputation": 31108, "user_id": 350351, "user_type": "registered", "accept_rate": 85, "profile_image": "https://www.gravatar.com/avatar/b1a41bbf4677c8961237c4d147e764d6?s=128&d=identicon&r=PG", "display_name": "Daenyth", "link": "https://stackoverflow.com/users/350351/daenyth"}, "edited": false, "score": 5, "creation_date": 1491443159, "post_id": 43241438, "comment_id": 73558604, "body": "@PedroCastilho @Daenyth You are missing @amalloy&#39;s point. He is aware of how lens works, he is just saying that the core language isn&#39;t powerful enough to do the same work that TH does. One could imagine having lenses automagically work (the same way getters are generated when you define a record) - but they don&#39;t. Hopefully this will change once <code>OverloadedLabels</code> supports setters."}], "tags": [], "owner": {"reputation": 8268, "user_id": 7602518, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/9ddcddc4afafdfc5603b2473b191c74f?s=128&d=identicon&r=PG", "display_name": "Pedro Castilho", "link": "https://stackoverflow.com/users/7602518/pedro-castilho"}, "is_accepted": false, "score": 4, "last_activity_date": 1491425629, "creation_date": 1491425629, "answer_id": 43241438, "question_id": 43241259, "link": "https://stackoverflow.com/questions/43241259/does-haskell-provide-a-way-to-map-a-function-to-a-data-member/43241438#43241438", "title": "Does Haskell provide a way to map a function to a data member?", "body": "<p>There is no <em>language feature</em> which does this, but, as with many things in Haskell, the core language is powerful enough that this can be implemented in a simple and elegant way.</p>\n\n<p>The solution for what you are looking for is a kind of value called a <em>lens</em>. A lens does exactly what you want: It allows you to take any kind of abstract data and apply a function on a part of it, getting the entire data value with the modified part included as a result.</p>\n\n<p>There's an introduction to lenses I quite like <a href=\"https://www.schoolofhaskell.com/school/to-infinity-and-beyond/pick-of-the-week/basic-lensing\" rel=\"nofollow noreferrer\">here</a>. To use the examples included, you'll need the <a href=\"http://hackage.haskell.org/package/lens\" rel=\"nofollow noreferrer\"><code>lens</code></a> package. (<a href=\"https://www.stackage.org/package/lens\" rel=\"nofollow noreferrer\">Or this one if you're using Stack</a>)</p>\n"}, {"comments": [{"owner": {"reputation": 309, "user_id": 5154287, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/6b0b8de1b682a310368e2c8f2967194a?s=128&d=identicon&r=PG&f=1", "display_name": "Michael Klein", "link": "https://stackoverflow.com/users/5154287/michael-klein"}, "edited": false, "score": 0, "creation_date": 1491452850, "post_id": 43241473, "comment_id": 73560990, "body": "<code>Data.Data</code> and <code>GHC.Generics</code> are in <code>basic</code> and can be used for this, but I agree that <code>lens</code> is usually the natural choice"}, {"owner": {"reputation": 8237, "user_id": 2900502, "user_type": "registered", "accept_rate": 73, "profile_image": "https://i.stack.imgur.com/R1OjD.jpg?s=128&g=1", "display_name": "Shersh", "link": "https://stackoverflow.com/users/2900502/shersh"}, "edited": false, "score": 0, "creation_date": 1491472709, "post_id": 43241473, "comment_id": 73572457, "body": "I would also recommend this <code>lens</code> tutorial (if you want to understand <code>lens</code> better): <a href=\"https://artyom.me/lens-over-tea-1\" rel=\"nofollow noreferrer\">artyom.me/lens-over-tea-1</a>"}, {"owner": {"reputation": 100185, "user_id": 3234959, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/93bb12ca0f93dfddb33880316f7e66c2?s=128&d=identicon&r=PG&f=1", "display_name": "chi", "link": "https://stackoverflow.com/users/3234959/chi"}, "edited": false, "score": 0, "creation_date": 1491474679, "post_id": 43241473, "comment_id": 73573853, "body": "I totally agree with the &quot;pretty daunting&quot;. Sometimes I think it was a bit overgeneralized beyond practical common cases."}], "tags": [], "owner": {"reputation": 29444, "user_id": 3072788, "user_type": "registered", "accept_rate": 82, "profile_image": "https://www.gravatar.com/avatar/220a45c2fcff7e7358d144551b116205?s=128&d=identicon&r=PG&f=1", "display_name": "Alec", "link": "https://stackoverflow.com/users/3072788/alec"}, "is_accepted": true, "score": 13, "last_activity_date": 1491426688, "last_edit_date": 1491426688, "creation_date": 1491425789, "answer_id": 43241473, "question_id": 43241259, "link": "https://stackoverflow.com/questions/43241259/does-haskell-provide-a-way-to-map-a-function-to-a-data-member/43241473#43241473", "title": "Does Haskell provide a way to map a function to a data member?", "body": "<p>Using just the core libraries? No. But with the widely used <a href=\"https://hackage.haskell.org/package/lens\" rel=\"noreferrer\"><code>lens</code></a> package, yes. Here is what that looks like in your case:</p>\n\n<pre><code>{-# LANGUAGE TemplateHaskell #-}\n\nimport Control.Lens.TH\nimport Control.Lens\n\ndata Car = Car { _gas :: Int, _licensePlate :: String }\n\nmakeLenses ''Car\n</code></pre>\n\n<p>Now, you can easily get/set/modify fields that are nested in data structures. </p>\n\n<pre><code>runOutOfFuel:: Car -&gt; Car\nrunOutOfFuel = gas .~ 0\n\ndrive:: Car -&gt; Car\ndrive = gas %~ (`div` 2)\n\nrefuel:: Int -&gt; Car -&gt; Car\nrefuel c = gas +~ c\n</code></pre>\n\n<p>The magic here is that <code>makeLenses ''Car</code> generates <code>gas</code> and <code>licensePlate</code> functions that are similar (but more powerful) to your <code>mapGas</code> (in fact, <code>mapGas = (gas %~)</code>). Getting started with <code>lens</code> is pretty daunting, but I recommend just reading the <a href=\"https://github.com/ekmett/lens#examples\" rel=\"noreferrer\">examples</a> section.</p>\n"}], "owner": {"reputation": 133, "user_id": 7822727, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/510091c56773142bd51a7528d8b3bdd0?s=128&d=identicon&r=PG&f=1", "display_name": "o1968673", "link": "https://stackoverflow.com/users/7822727/o1968673"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 744, "favorite_count": 0, "accepted_answer_id": 43241473, "answer_count": 2, "score": 12, "last_activity_date": 1491435504, "creation_date": 1491424974, "last_edit_date": 1491435504, "question_id": 43241259, "link": "https://stackoverflow.com/questions/43241259/does-haskell-provide-a-way-to-map-a-function-to-a-data-member", "title": "Does Haskell provide a way to map a function to a data member?", "body": "<p>I am a Haskell rookie and I often find myself having to decompose a data with pattern matching only to apply a function to one of its member and then reassemble it.</p>\n\n<p>Say I have:</p>\n\n<pre><code>data Car = Car { gas :: Int, licensePlate :: String }\n</code></pre>\n\n<p>and I want it to halve its gas when it drives, and refuel it, I'm doing:</p>\n\n<pre><code>mapGas:: (Int -&gt; Int) -&gt; Car -&gt; Car\nmapGas f (Car aGas aLicensePlate) = Car (f aGas) aLicensePlate\n\ndrive:: Car -&gt; Car\ndrive = mapGas (flip div 2)\n\nrefuel:: Int -&gt; Car -&gt; Car\nrefuel = mapGas . (+)\n</code></pre>\n\n<p>Is there a way to do just that without having to define the auxiliary function mapGas? Since it can become rather bothersome having to write a map function for every member of the data when it's made of many fields. I know it is possible to assign a value to one of the members with accessors:</p>\n\n<pre><code>runOutOfFuel:: Car -&gt; Car\nrunOutOfFuel aCar = aCar { gas = 0 }\n</code></pre>\n\n<p>Is it possible to map a function with accessors too? if so, how?</p>\n"}, {"tags": ["database", "haskell", "yesod"], "answers": [{"comments": [{"owner": {"reputation": 14781, "user_id": 630160, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/4445f21326af525a8ad19af7e3ae41a8?s=128&d=identicon&r=PG", "display_name": "epsilonhalbe", "link": "https://stackoverflow.com/users/630160/epsilonhalbe"}, "edited": false, "score": 1, "creation_date": 1491433760, "post_id": 43241405, "comment_id": 73556212, "body": "depending on what &quot;sql&quot; you are using - there is also <a href=\"https://hackage.haskell.org/package/opaleye\" rel=\"nofollow noreferrer\">opaleye</a>"}], "tags": [], "owner": {"reputation": 43759, "user_id": 1651941, "user_type": "registered", "accept_rate": 97, "profile_image": "https://www.gravatar.com/avatar/a513bc1fa519d2fcf5e4e0d9b5500101?s=128&d=identicon&r=PG", "display_name": "Sibi", "link": "https://stackoverflow.com/users/1651941/sibi"}, "is_accepted": true, "score": 2, "last_activity_date": 1491425483, "creation_date": 1491425483, "answer_id": 43241405, "question_id": 43241161, "link": "https://stackoverflow.com/questions/43241161/yesod-database-query/43241405#43241405", "title": "Yesod Database Query", "body": "<blockquote>\n  <p>Is this common practice?</p>\n</blockquote>\n\n<p>No. The closest you can get to this is use something like <a href=\"https://www.stackage.org/haddock/lts-8.8/persistent-2.6.1/Database-Persist-Sql.html#v:rawSql\" rel=\"nofollow noreferrer\">rawSql</a> in persistent or use some other low level library. I would recommend you to avoid writing raw sql query unless you have a valid reason to.</p>\n\n<blockquote>\n  <p>I assume that writing queries in SQL itself is more suitable than writing them in Haskell.</p>\n</blockquote>\n\n<p>No, the whole point of using <a href=\"http://www.yesodweb.com/book/persistent\" rel=\"nofollow noreferrer\">persistent</a> is to bring type safety to database queries. If you are gonna write them in SQL itself you lose that benefit.</p>\n"}], "owner": {"reputation": 5139, "user_id": 705510, "user_type": "registered", "accept_rate": 89, "profile_image": "https://i.stack.imgur.com/7xrNQ.png?s=128&g=1", "display_name": "McBear Holden", "link": "https://stackoverflow.com/users/705510/mcbear-holden"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 153, "favorite_count": 0, "accepted_answer_id": 43241405, "answer_count": 1, "score": 0, "last_activity_date": 1491425483, "creation_date": 1491424640, "question_id": 43241161, "link": "https://stackoverflow.com/questions/43241161/yesod-database-query", "title": "Yesod Database Query", "body": "<p>I'm new to both Yesod and Databases so please bear with me this basic question:</p>\n\n<p>I plan to write SQL procedures and store them in .sql files and the Yesod web application just calls these sql file instead of writing queries directly in Haskell.</p>\n\n<p>Is this common practice?</p>\n\n<p>I assume that writing queries in SQL itself is more suitable than writing them in Haskell.</p>\n\n<p>Any comments are welcome.</p>\n"}, {"tags": ["haskell", "types", "algebraic-data-types"], "comments": [{"owner": {"reputation": 13379, "user_id": 1033027, "user_type": "registered", "accept_rate": 91, "profile_image": "https://www.gravatar.com/avatar/b56ea1c43a4ecb1060ec8bcb8d2bce78?s=128&d=identicon&r=PG", "display_name": "Jules", "link": "https://stackoverflow.com/users/1033027/jules"}, "edited": false, "score": 0, "creation_date": 1491408881, "post_id": 43236259, "comment_id": 73543115, "body": "It sounds like the code you&#39;re writing includes some antipatterns (in this case, possibly side-effectful code). You should generally care about <i>either</i> value of an <code>Either</code> value (no pun or confusion intended) -- that is to say that in both the <code>Left</code> and <code>Right</code> cases should be handled appropriately."}, {"owner": {"reputation": 2044, "user_id": 6733371, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/5a4c02ed1ce17fd1f60579e73384d310?s=128&d=identicon&r=PG&f=1", "display_name": "qfwfq", "link": "https://stackoverflow.com/users/6733371/qfwfq"}, "reply_to_user": {"reputation": 13379, "user_id": 1033027, "user_type": "registered", "accept_rate": 91, "profile_image": "https://www.gravatar.com/avatar/b56ea1c43a4ecb1060ec8bcb8d2bce78?s=128&d=identicon&r=PG", "display_name": "Jules", "link": "https://stackoverflow.com/users/1033027/jules"}, "edited": false, "score": 0, "creation_date": 1491409376, "post_id": 43236259, "comment_id": 73543445, "body": "@Jules I agree that I should care about either side of the <code>Either</code>, which is why I was thinking that using <code>Maybe</code> was the way to go. Are you saying that user input is the antipattern?"}, {"owner": {"reputation": 36902, "user_id": 223424, "user_type": "registered", "accept_rate": 74, "profile_image": "https://www.gravatar.com/avatar/e97c628a88337b15e76a4690e916a2cd?s=128&d=identicon&r=PG", "display_name": "9000", "link": "https://stackoverflow.com/users/223424/9000"}, "edited": false, "score": 3, "creation_date": 1491409399, "post_id": 43236259, "comment_id": 73543455, "body": "Semantically your validation function may return an error message, or return no error message, so it looks totally reasonable to to use <code>Maybe</code> for its return type. It&#39;s not the &quot;error message&quot; vs &quot;correct result&quot; pattern which <code>Either</code> usually implies."}], "answers": [{"tags": [], "owner": {"reputation": 100892, "user_id": 745903, "user_type": "registered", "accept_rate": 74, "profile_image": "https://www.gravatar.com/avatar/50933f6638836741e620669b3940410e?s=128&d=identicon&r=PG", "display_name": "leftaroundabout", "link": "https://stackoverflow.com/users/745903/leftaroundabout"}, "is_accepted": false, "score": 4, "last_activity_date": 1491408980, "creation_date": 1491408980, "answer_id": 43236534, "question_id": 43236259, "link": "https://stackoverflow.com/questions/43236259/should-maybes-be-used-to-hold-error-messages/43236534#43236534", "title": "Should Maybe&#39;s be used to hold error messages?", "body": "<p>What's an error message and what's an expected value is just a matter of you point of view. If you don't care about the <code>a</code> result value but do care about a possible error message, then that message is, as far as you're concerned, the value of interest. So, sure you can store it as a <code>Maybe String</code>.</p>\n\n<p>In fact it's little different with <code>Either</code>. What I find backwards is that <code>Either</code> is usually perceived as \u201cthe possible-failure type\u201d. Yes, its monad instance happens to work in the way that makes <code>Left</code> error-ish and <code>Right</code> success-ish, but ab initio <code>Either</code> is just a simple bifunctor expressing the sum of two types. Indeed, if Haskell had always had type operators, <code>Either a b</code> would probably be written <code>a + b</code> or <code>a || b</code>.</p>\n\n<p>If you had an <code>Either String a</code> and want to \u201cconfiscate\u201d the possible <code>a</code> value, the easiest way is to just <code>fmap (const ())</code> over it, resulting in an <code>Either String ()</code>, which is isomorphic to <code>Maybe String</code> but \u201clooks more like the <code>String</code> has error character\u201d, though as I said this is a bit silly.</p>\n\n<p>To make it clear from the types that you're talking about error messages, I would use neither <code>Either</code> nor <code>Maybe</code> but <a href=\"http://hackage.haskell.org/package/transformers-0.5.4.0/docs/Control-Monad-Trans-Except.html#g:1\" rel=\"nofollow noreferrer\"><code>Except String ()</code></a>. Often, error values are caught over some other monad anyway, so you'd have e.g. <code>ExceptT String IO ()</code>.</p>\n"}, {"comments": [{"owner": {"reputation": 36902, "user_id": 223424, "user_type": "registered", "accept_rate": 74, "profile_image": "https://www.gravatar.com/avatar/e97c628a88337b15e76a4690e916a2cd?s=128&d=identicon&r=PG", "display_name": "9000", "link": "https://stackoverflow.com/users/223424/9000"}, "edited": false, "score": 0, "creation_date": 1491409510, "post_id": 43236650, "comment_id": 73543530, "body": "With <code>Maybe</code>, validators can be trivially chained with <code>&lt;|&gt;</code>; with this custom type, it&#39;s not the case."}, {"owner": {"reputation": 2044, "user_id": 6733371, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/5a4c02ed1ce17fd1f60579e73384d310?s=128&d=identicon&r=PG&f=1", "display_name": "qfwfq", "link": "https://stackoverflow.com/users/6733371/qfwfq"}, "edited": false, "score": 0, "creation_date": 1491410124, "post_id": 43236650, "comment_id": 73543900, "body": "I just learned about a new type class, thanks for making the note about <code>&lt;|&gt;</code>. Would it be reasonable to make Result an instance of Alternative to get this behavior? Or is this the sort of thing where if I am implementing it myself, I am probably doing it wrong?"}, {"owner": {"reputation": 100185, "user_id": 3234959, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/93bb12ca0f93dfddb33880316f7e66c2?s=128&d=identicon&r=PG&f=1", "display_name": "chi", "link": "https://stackoverflow.com/users/3234959/chi"}, "reply_to_user": {"reputation": 2044, "user_id": 6733371, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/5a4c02ed1ce17fd1f60579e73384d310?s=128&d=identicon&r=PG&f=1", "display_name": "qfwfq", "link": "https://stackoverflow.com/users/6733371/qfwfq"}, "edited": false, "score": 0, "creation_date": 1491410807, "post_id": 43236650, "comment_id": 73544313, "body": "@jcolemang Yes, it would be reasonable. It is a bit unfortunate to have to duplicate already-present code. I will update with another alternative."}, {"owner": {"reputation": 14485, "user_id": 190376, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/cd8280c5e1491b8cf55760750ed97dec?s=128&d=identicon&r=PG", "display_name": "Reid Barton", "link": "https://stackoverflow.com/users/190376/reid-barton"}, "edited": false, "score": 0, "creation_date": 1491411819, "post_id": 43236650, "comment_id": 73544893, "body": "Combining validators with <code>&lt;|&gt;</code> is a perfect example of why you should define a new type <code>OK | Error a</code>, unless you want to think of a validator &quot;succeeding&quot; when it &quot;successfully&quot; finds something invalid about the input."}, {"owner": {"reputation": 2044, "user_id": 6733371, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/5a4c02ed1ce17fd1f60579e73384d310?s=128&d=identicon&r=PG&f=1", "display_name": "qfwfq", "link": "https://stackoverflow.com/users/6733371/qfwfq"}, "reply_to_user": {"reputation": 14485, "user_id": 190376, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/cd8280c5e1491b8cf55760750ed97dec?s=128&d=identicon&r=PG", "display_name": "Reid Barton", "link": "https://stackoverflow.com/users/190376/reid-barton"}, "edited": false, "score": 0, "creation_date": 1491412309, "post_id": 43236650, "comment_id": 73545167, "body": "@ReidBarton If you considered a validator succeeding when it failed to find something invalid, wouldn&#39;t using <code>&lt;|&gt;</code> result in a valid result if only of the validators failed? Or am I misunderstanding?"}, {"owner": {"reputation": 14485, "user_id": 190376, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/cd8280c5e1491b8cf55760750ed97dec?s=128&d=identicon&r=PG", "display_name": "Reid Barton", "link": "https://stackoverflow.com/users/190376/reid-barton"}, "edited": false, "score": 1, "creation_date": 1491412896, "post_id": 43236650, "comment_id": 73545532, "body": "The point is the whole premise of using <code>&lt;|&gt;</code> to chain validators (assuming this means you want to check whether they all accept the input as valid) is backwards and confusing, since <code>a &lt;|&gt; b</code> is all about succeeding when either <code>a</code> or <code>b</code> does. Hence the name Alternative. The right way to chain validators is with <code>&gt;&gt;</code> (or whatever the trendy name for that operator is nowadays). That works for example with <code>Either String ()</code>."}, {"owner": {"reputation": 40537, "user_id": 465378, "user_type": "registered", "accept_rate": 85, "profile_image": "https://www.gravatar.com/avatar/c03b8d34978563858020eff0d14cc17b?s=128&d=identicon&r=PG", "display_name": "Alexis King", "link": "https://stackoverflow.com/users/465378/alexis-king"}, "edited": false, "score": 1, "creation_date": 1491422060, "post_id": 43236650, "comment_id": 73551028, "body": "This type cannot be a <code>Functor</code>, <code>Alternative</code>, <code>Applicative</code>, or <code>Monad</code>, as it has the wrong kind, so your example with GND is incorrect. That\u2019s not so bad, though, since the instances wouldn\u2019t really make sense\u2014given that <code>Error</code> should short-circuit, there would be no place to hold the \u201csuccess\u201d value, and none of the usual typeclasses would be useful."}, {"owner": {"reputation": 100185, "user_id": 3234959, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/93bb12ca0f93dfddb33880316f7e66c2?s=128&d=identicon&r=PG&f=1", "display_name": "chi", "link": "https://stackoverflow.com/users/3234959/chi"}, "reply_to_user": {"reputation": 40537, "user_id": 465378, "user_type": "registered", "accept_rate": 85, "profile_image": "https://www.gravatar.com/avatar/c03b8d34978563858020eff0d14cc17b?s=128&d=identicon&r=PG", "display_name": "Alexis King", "link": "https://stackoverflow.com/users/465378/alexis-king"}, "edited": false, "score": 0, "creation_date": 1491422411, "post_id": 43236650, "comment_id": 73551213, "body": "@AlexisKing Oh, right! Thanks. Now I do no longer believe the second approach is that useful."}], "tags": [], "owner": {"reputation": 100185, "user_id": 3234959, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/93bb12ca0f93dfddb33880316f7e66c2?s=128&d=identicon&r=PG&f=1", "display_name": "chi", "link": "https://stackoverflow.com/users/3234959/chi"}, "is_accepted": false, "score": 4, "last_activity_date": 1491422641, "last_edit_date": 1491422641, "creation_date": 1491409317, "answer_id": 43236650, "question_id": 43236259, "link": "https://stackoverflow.com/questions/43236259/should-maybes-be-used-to-hold-error-messages/43236650#43236650", "title": "Should Maybe&#39;s be used to hold error messages?", "body": "<p>I would suggest using a custom type, isomorphic to <code>Maybe String</code>.</p>\n\n<pre><code>data Result = OK | Error String\n</code></pre>\n\n<p>or even</p>\n\n<pre><code>newtype Result = Result (Maybe String)\n</code></pre>\n\n<p>The latter makes it possible to avoid duplicating <code>Maybe</code> instances, since we can exploit <a href=\"https://downloads.haskell.org/~ghc/latest/docs/html/users_guide/glasgow_exts.html?highlight=generalized#ghc-flag--XGeneralizedNewtypeDeriving\" rel=\"nofollow noreferrer\"><code>GeneralizedNewtypeDeriving</code></a> to obtain the same effect</p>\n\n<pre><code>newtype Result = Result (Maybe String)\n   deriving (Eq, Show) -- etc.\n</code></pre>\n\n<p>(Update: this might not be that useful, since most of such classes are standard ones, which can be automatically derived anyway. As Alexis King points out below, one can not make this into an applicative / alternative / monad, for instance, since the kinds do not match.)</p>\n\n<p>The major downside now is having to use two constructors:</p>\n\n<pre><code>foo :: Result -&gt; ...\nfoo (Result (Just x)) = ...\nfoo (Result (Nothing)) = ...\n</code></pre>\n\n<p>which is boring. One can go further and define <a href=\"https://downloads.haskell.org/~ghc/latest/docs/html/users_guide/glasgow_exts.html?highlight=generalized#pattern-synonyms\" rel=\"nofollow noreferrer\">pattern synonyms</a></p>\n\n<pre><code>pattern OK      = Result Nothing\npattern Error x = Result (Just x)\n</code></pre>\n\n<p>so that we can then pretend we are using the first <code>data</code> definition shown above instead of the <code>newtype</code>.</p>\n\n<pre><code>foo :: Result -&gt; ...\nfoo (Error x) = ...\nfoo OK        = ...\n</code></pre>\n\n<p>This might be reasonable or a bit overkill depending on whether you need those instances on the <code>Result</code> type. Even if you don't, it's not a very long approach to write, and I think many (most?) Haskellers would also be comfortable with the two required extensions.</p>\n\n<p>For what it is worth, after reading the comments below, at the moment I believe that the first <code>data Result</code> approach is the best. It is simple, makes the point quite clearly, and if some class instances are needed, you probably want to define them manually (or automatically derive them, for standard <code>Prelude</code> classes).</p>\n"}, {"tags": [], "owner": {"reputation": 15757, "user_id": 176841, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/45a168cb9eb8454d66c78f18e29d9342?s=128&d=identicon&r=PG", "display_name": "jberryman", "link": "https://stackoverflow.com/users/176841/jberryman"}, "is_accepted": false, "score": 3, "last_activity_date": 1491416739, "creation_date": 1491416739, "answer_id": 43238903, "question_id": 43236259, "link": "https://stackoverflow.com/questions/43236259/should-maybes-be-used-to-hold-error-messages/43238903#43238903", "title": "Should Maybe&#39;s be used to hold error messages?", "body": "<p>Yes, <code>Maybe String</code> is okay (its shape maps precisely onto the range of your function), but it won't compose nicely since all the useful instances take the opposite semantics for <code>Maybe</code>. <code>Either String ()</code> would be more useful (in terms of its monad/Applicative instances), and would also be clearer.</p>\n\n<p>But there is a more appropriate \"validation applicative\" abstraction that would be worth exploring, which allows you to chain validations and accumulate errors (i.e. without short-circuiting on the first error). SOme flavors of implementation are in the <a href=\"https://hackage.haskell.org/package/validation\" rel=\"nofollow noreferrer\"><code>validation</code> package</a>. From the docs:</p>\n\n<pre><code>&gt;&gt;&gt; _Success # (+1) &lt;*&gt; _Success # 7 :: AccValidation String Int\nAccSuccess 8\n\n&gt;&gt;&gt; _Failure # [\"f1\"] &lt;*&gt; _Success # 7 :: AccValidation [String] Int\nAccFailure [\"f1\"]\n\n&gt;&gt;&gt; _Success # (+1) &lt;*&gt; _Failure # [\"f2\"] :: AccValidation [String] Int\nAccFailure [\"f2\"]\n\n&gt;&gt;&gt; _Failure # [\"f1\"] &lt;*&gt; _Failure # [\"f2\"] :: AccValidation [String] Int\nAccFailure [\"f1\",\"f2\"]\n</code></pre>\n\n<p>Note that <code>AccValidation m</code> isn't a valid <code>Monad</code>. I experienced some minor pain when a composed parser / validation applicative suddenly needed to use bind.</p>\n"}, {"comments": [{"owner": {"reputation": 2044, "user_id": 6733371, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/5a4c02ed1ce17fd1f60579e73384d310?s=128&d=identicon&r=PG&f=1", "display_name": "qfwfq", "link": "https://stackoverflow.com/users/6733371/qfwfq"}, "edited": false, "score": 0, "creation_date": 1502071505, "post_id": 43239349, "comment_id": 78036959, "body": "After using haskell for a few months I would like to say that I very strongly agree that this is the way to go."}, {"owner": {"reputation": 20862, "user_id": 376113, "user_type": "registered", "accept_rate": 72, "profile_image": "https://www.gravatar.com/avatar/d3a5bd12fe6d876527a3cf4ac0de5fc6?s=128&d=identicon&r=PG", "display_name": "mb14", "link": "https://stackoverflow.com/users/376113/mb14"}, "edited": false, "score": 0, "creation_date": 1524909762, "post_id": 43239349, "comment_id": 87166770, "body": "Wouldn&#39;t <code>Either String User</code> be a better option?"}, {"owner": {"reputation": 126897, "user_id": 791604, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/ce991df7a056248d5e4f6fc3659ba733?s=128&d=identicon&r=PG", "display_name": "Daniel Wagner", "link": "https://stackoverflow.com/users/791604/daniel-wagner"}, "reply_to_user": {"reputation": 20862, "user_id": 376113, "user_type": "registered", "accept_rate": 72, "profile_image": "https://www.gravatar.com/avatar/d3a5bd12fe6d876527a3cf4ac0de5fc6?s=128&d=identicon&r=PG", "display_name": "mb14", "link": "https://stackoverflow.com/users/376113/mb14"}, "edited": false, "score": 0, "creation_date": 1524920684, "post_id": 43239349, "comment_id": 87169806, "body": "@mb14 What is <code>User</code>, and why do you think it would be a better option than <code>()</code>?"}, {"owner": {"reputation": 20862, "user_id": 376113, "user_type": "registered", "accept_rate": 72, "profile_image": "https://www.gravatar.com/avatar/d3a5bd12fe6d876527a3cf4ac0de5fc6?s=128&d=identicon&r=PG", "display_name": "mb14", "link": "https://stackoverflow.com/users/376113/mb14"}, "edited": false, "score": 0, "creation_date": 1524935610, "post_id": 43239349, "comment_id": 87174197, "body": "I missed and thought the OP wanted to validate a User thus a function <code>validateUser :: User -&gt; Error String User</code>. Is has the advantage of being to chain. However it doesn&#39;t enforce the validation function to not modify the input."}], "tags": [], "owner": {"reputation": 126897, "user_id": 791604, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/ce991df7a056248d5e4f6fc3659ba733?s=128&d=identicon&r=PG", "display_name": "Daniel Wagner", "link": "https://stackoverflow.com/users/791604/daniel-wagner"}, "is_accepted": true, "score": 10, "last_activity_date": 1491418261, "creation_date": 1491418261, "answer_id": 43239349, "question_id": 43236259, "link": "https://stackoverflow.com/questions/43236259/should-maybes-be-used-to-hold-error-messages/43239349#43239349", "title": "Should Maybe&#39;s be used to hold error messages?", "body": "<p>I encourage the use of <code>Except String ()</code> (or <code>Either String ()</code>) over <code>Maybe String</code>, for a few reasons:</p>\n\n<ul>\n<li>You will probably find later that your it is convenient for your validation function to return some parts of the data structure. For example, while validating that a <code>String</code> is a phone number, you might want to return the area code, first, and second parts of the number, giving a validation type like <code>String -&gt; Except String (Int, Int, Int)</code> or similar. Making validators that don't return anything interesting have type <code>Foo -&gt; Except String ()</code> makes them just a special case of this pattern -- and therefore easier to fit together.</li>\n<li><p>Continuing the \"fit together\" part, you may later find that you want to construct one big validator out of smaller ones. Perhaps you have a validator that checks that a person has specified a valid age and birth date, and want to build a validator out of this that also checks that the age is about right for the birth date. The <code>Monad</code> instance for <code>Either</code> will help here; for example:</p>\n\n<pre><code>validatePerson p now = do\n    age &lt;- validateAge p\n    date &lt;- validateBirthdate p\n    validateMatchingAgeAndDate age date now\n</code></pre>\n\n<p>Or perhaps there are two ways for some value to validate properly and you want to allow either. Then <code>bigValidator v = option1 v &lt;|&gt; option2 v</code> is a cheap and cheerful way to combine the two ways of validating.</p>\n\n<p>As a side benefit, these methods of combining existing validators to make bigger ones will be instantly recognizable to other Haskellers.</p></li>\n<li><p>There is a very strong convention that <code>Nothing</code> is a failure. Using the opposite convention is not a <em>problem</em>, necessarily, but could be confusing to other contributors and potentially to yourself far in the future.</p></li>\n</ul>\n"}, {"tags": [], "owner": {"reputation": 2044, "user_id": 6733371, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/5a4c02ed1ce17fd1f60579e73384d310?s=128&d=identicon&r=PG&f=1", "display_name": "qfwfq", "link": "https://stackoverflow.com/users/6733371/qfwfq"}, "is_accepted": false, "score": 1, "last_activity_date": 1491493603, "creation_date": 1491493603, "answer_id": 43259924, "question_id": 43236259, "link": "https://stackoverflow.com/questions/43236259/should-maybes-be-used-to-hold-error-messages/43259924#43259924", "title": "Should Maybe&#39;s be used to hold error messages?", "body": "<p><strong>NOTE:</strong> I do not believe that this is the best solution in general, but considering that this is for an assignment which only I will be working on and which does not include any requirements for good Haskell practices (or Haskell at all), this is the easiest solution for me. I borrowed some ideas from chi's answer. </p>\n\n<hr>\n\n<p>I wanted the exact functionality of <code>Maybe</code>, but still wanted to avoid returning <code>Nothing</code> to indicate success and <code>Just msg</code> to indicate failure. To get around this I created what are really aliases to <code>Maybe</code> and its data constructors:</p>\n\n<pre><code>{-# LANGUAGE PatternSynonyms #-}\n\ntype Result = Maybe\npattern AllGood = Nothing\npattern Fail x = Just x\n\n-- example usage\nisValidBorrower :: [String] -&gt; Result String\nisValidBorrower args\n  | length args /= 3 = Fail \"Wrong number of arguments\"\n  | otherwise = AllGood\n</code></pre>\n\n<p>This allows for the complete functionality of <code>Maybe</code> but the type checker will still show <code>MaybeFailure</code> if your types are incorrect and you don't see <code>Maybe String</code> in the type signature, which would be misleading.</p>\n\n<p>The downside is that both of these functions still work:</p>\n\n<pre><code>foo :: Maybe String\nfoo = AllGood\n\nbar :: Result String\nbar = Nothing\n</code></pre>\n"}], "owner": {"reputation": 2044, "user_id": 6733371, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/5a4c02ed1ce17fd1f60579e73384d310?s=128&d=identicon&r=PG&f=1", "display_name": "qfwfq", "link": "https://stackoverflow.com/users/6733371/qfwfq"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 433, "favorite_count": 0, "accepted_answer_id": 43239349, "answer_count": 5, "score": 8, "last_activity_date": 1499547446, "creation_date": 1491408174, "last_edit_date": 1499547446, "question_id": 43236259, "link": "https://stackoverflow.com/questions/43236259/should-maybes-be-used-to-hold-error-messages", "title": "Should Maybe&#39;s be used to hold error messages?", "body": "<p>I have a Haskell function which takes user input and another function which validates this input. Of course, the validation could fail, in which case I would like to return an error message giving some feedback on what was done incorrectly.</p>\n\n<p>I know that there are many ways that I could do this. After the little experience I have, it seems like the best way is to use <code>Either String a</code>. What is throwing me off is that I don't care about the <code>a</code>. Either it fails and I would like to store more information, or it succeeds. The <code>a</code> is wasted.</p>\n\n<p><strong>Is using <code>Maybe String</code> an acceptable way to store an error message?</strong> It feels backwards to me, but completely ignoring the value in the right of an <code>Either</code> feels pretty bad too. What is canonical here?</p>\n"}, {"tags": ["haskell"], "comments": [{"owner": {"reputation": 8984, "user_id": 2485966, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/dZj6A.jpg?s=128&g=1", "display_name": "Ruud Helderman", "link": "https://stackoverflow.com/users/2485966/ruud-helderman"}, "edited": false, "score": 3, "creation_date": 1491401779, "post_id": 43233599, "comment_id": 73537634, "body": "Maybe try replacing <code>.</code> by <code>$</code> (both occurrences)?"}, {"owner": {"reputation": 2106, "user_id": 588959, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/3a95696a0bc1b7e3c9e7c0fc6778dcaf?s=128&d=identicon&r=PG", "display_name": "Jack H", "link": "https://stackoverflow.com/users/588959/jack-h"}, "reply_to_user": {"reputation": 8984, "user_id": 2485966, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/dZj6A.jpg?s=128&g=1", "display_name": "Ruud Helderman", "link": "https://stackoverflow.com/users/2485966/ruud-helderman"}, "edited": false, "score": 0, "creation_date": 1491401879, "post_id": 43233599, "comment_id": 73537718, "body": "This seems to work. Thank you. If you don&#39;t mind, what was wrong with the function composition I was doing?"}, {"owner": {"reputation": 24028, "user_id": 383200, "user_type": "registered", "accept_rate": 60, "profile_image": "https://www.gravatar.com/avatar/a9dc722f936cb1059adaae4fe39c07f0?s=128&d=identicon&r=PG", "display_name": "Carl", "link": "https://stackoverflow.com/users/383200/carl"}, "edited": false, "score": 0, "creation_date": 1491402068, "post_id": 43233599, "comment_id": 73537872, "body": "Haskell grammar says function application always has higher precedence than operators.  So your code said the equivalent of <code>\\y -&gt; fst (fst x) y</code> if you inline the definition of <code>(.)</code>.  If you wanted to use function composition there, it could be done with something like <code>(fst . fst) x</code>, but at that point it&#39;s getting pretty verbose."}, {"owner": {"reputation": 936, "user_id": 4884579, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/b0fca1fac3b94fed8f0291116e9b4ef6?s=128&d=identicon&r=PG&f=1", "display_name": "Erik", "link": "https://stackoverflow.com/users/4884579/erik"}, "edited": false, "score": 0, "creation_date": 1491402092, "post_id": 43233599, "comment_id": 73537895, "body": "alternatively, <code>makePGM (x:xs) = (VariableNode (fst . fst $ x) (snd . fst $ x) (snd x)) : makePGM xs</code>. In haskell, function application happens before composition, so you need to be explicit so that it happens in the intended order here."}, {"owner": {"reputation": 2106, "user_id": 588959, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/3a95696a0bc1b7e3c9e7c0fc6778dcaf?s=128&d=identicon&r=PG", "display_name": "Jack H", "link": "https://stackoverflow.com/users/588959/jack-h"}, "edited": false, "score": 0, "creation_date": 1491406551, "post_id": 43233599, "comment_id": 73541457, "body": "Thank you, this has cleared things up for me."}], "answers": [{"tags": [], "owner": {"reputation": 94713, "user_id": 1139697, "user_type": "registered", "accept_rate": 86, "profile_image": "https://www.gravatar.com/avatar/5f136ddb684f39aaee1c028ee1950f6f?s=128&d=identicon&r=PG", "display_name": "Zeta", "link": "https://stackoverflow.com/users/1139697/zeta"}, "is_accepted": true, "score": 2, "last_activity_date": 1491407936, "creation_date": 1491407936, "answer_id": 43236156, "question_id": 43233599, "link": "https://stackoverflow.com/questions/43233599/haskell-type-matching-error/43236156#43236156", "title": "Haskell type matching error", "body": "<p>The problem is that <code>f . g x</code> is <code>f . (g x)</code>. Therefore, the types don't match:</p>\n\n<pre><code>fst . fst ((1,2),3)\n  == fst . (fst ((1,2),3))\n  == fst . (1,2)\n  == ???? (.) expects a function, not a value\n</code></pre>\n\n<p>You either have to use parentheses around <code>fst . fst</code> or <code>$</code>:</p>\n\n<pre><code>-- reminder:\n(.) :: (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c\n(.) f g x = f (g x)\n\n($) :: (a -&gt; b) -&gt; a -&gt; b\n($) f x = f x \n\n(fst . fst) x\n == fst (fst  x)\n\nfst $ fst x\n == fst (fst x)\n</code></pre>\n\n<p>You can also combine both, e.g. <code>fst . fst $ x</code>, since the precedence of <code>$</code> is low.</p>\n"}, {"comments": [{"owner": {"reputation": 2106, "user_id": 588959, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/3a95696a0bc1b7e3c9e7c0fc6778dcaf?s=128&d=identicon&r=PG", "display_name": "Jack H", "link": "https://stackoverflow.com/users/588959/jack-h"}, "edited": false, "score": 0, "creation_date": 1491491321, "post_id": 43239738, "comment_id": 73586715, "body": "Thank you, this is an insighful answer."}], "tags": [], "owner": {"reputation": 75362, "user_id": 625403, "user_type": "registered", "accept_rate": 82, "profile_image": "https://www.gravatar.com/avatar/786eed7da67079cb5d63a49d469af25b?s=128&d=identicon&r=PG", "display_name": "amalloy", "link": "https://stackoverflow.com/users/625403/amalloy"}, "is_accepted": false, "score": 0, "last_activity_date": 1491419502, "creation_date": 1491419502, "answer_id": 43239738, "question_id": 43233599, "link": "https://stackoverflow.com/questions/43233599/haskell-type-matching-error/43239738#43239738", "title": "Haskell type matching error", "body": "<p>Of course, this is a useful exercise to do, and as a result of making this mistake you've learned to better understand operator precedence and parsing in Haskell. However, once you have more experience you'll realize you could have avoided the problem, and wound up with simpler code as a result, by using pattern matching instead of composing calls to <code>fst</code> and <code>snd</code>:</p>\n\n<pre><code>makePGM :: [((Label, Potential), LabelSet)] -&gt; PGM\nmakePGM (((label, potential), set):xs) = VariableNode label potential set : makePGM xs\nmakePGM [] = []\n</code></pre>\n\n<p>Now the code is shaped like the data it consumes, and you get to give descriptive names to the values you work with.</p>\n\n<p>Another improvement comes from observing that this recursive pattern is very common: you do something to each item in the list, independent of each other, and construct a list of the results. In fact, that is exactly what <code>map</code> does. So you could write a function that deals with only one of these PGM items at a time, and then use <code>map</code> to extend it to a function that works on a list of them:</p>\n\n<pre><code>makePGM :: [((Label, Potential), LabelSet)] -&gt; PGM\nmakePGM = map go\n  where go ((label, potential), set) = VariableNode label potential set\n</code></pre>\n"}], "owner": {"reputation": 2106, "user_id": 588959, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/3a95696a0bc1b7e3c9e7c0fc6778dcaf?s=128&d=identicon&r=PG", "display_name": "Jack H", "link": "https://stackoverflow.com/users/588959/jack-h"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 99, "favorite_count": 0, "accepted_answer_id": 43236156, "answer_count": 2, "score": 0, "last_activity_date": 1491419502, "creation_date": 1491401230, "question_id": 43233599, "link": "https://stackoverflow.com/questions/43233599/haskell-type-matching-error", "title": "Haskell type matching error", "body": "<p>I have defined a couple of type synonyms as follows:</p>\n\n<pre><code>type Potential = Float\ntype Label = String\ntype LabelSet = [String]\n</code></pre>\n\n<p>In addition I have defined the following type and type synonym:</p>\n\n<pre><code>data VariableNode = VariableNode Label Potential LabelSet\ntype PGM = [VariableNode]\n</code></pre>\n\n<p>Finally, the following function to construct a graph:</p>\n\n<pre><code>makePGM :: [((Label, Potential), LabelSet)] -&gt; PGM\nmakePGM (x:xs) = (VariableNode (fst . fst x) (snd . fst x) (snd x)) : makePGM xs\nmakePGM [] = []\n</code></pre>\n\n<p>In the above function, a list of tuples is provided where the first element of the tuple is another tuple and the second a list, as per the functions type signature.</p>\n\n<p>I am new to Haskell so am having some difficulty in deciphering the following error messages:</p>\n\n<pre><code>Prelude&gt; :l Graph.hs\n[1 of 1] Compiling Graph            ( Graph.hs, interpreted )\n\nGraph.hs:14:33: error:\n    \u2022 Couldn't match type \u2018a0 -&gt; c0\u2019 with \u2018[Char]\u2019\n      Expected type: Label\n        Actual type: a0 -&gt; c0\n    \u2022 Probable cause: \u2018(.)\u2019 is applied to too few arguments\n      In the first argument of \u2018VariableNode\u2019, namely \u2018(fst . fst x)\u2019\n      In the first argument of \u2018(:)\u2019, namely\n        \u2018(VariableNode (fst . fst x) (snd . fst x) (snd x))\u2019\n      In the expression:\n        (VariableNode (fst . fst x) (snd . fst x) (snd x)) : makePGM xs\n\nGraph.hs:14:39: error:\n    \u2022 Couldn't match expected type \u2018a0 -&gt; (c0, b0)\u2019\n                  with actual type \u2018(Label, Potential)\u2019\n    \u2022 Possible cause: \u2018fst\u2019 is applied to too many arguments\n      In the second argument of \u2018(.)\u2019, namely \u2018fst x\u2019\n      In the first argument of \u2018VariableNode\u2019, namely \u2018(fst . fst x)\u2019\n      In the first argument of \u2018(:)\u2019, namely\n        \u2018(VariableNode (fst . fst x) (snd . fst x) (snd x))\u2019\n\nGraph.hs:14:47: error:\n    \u2022 Couldn't match type \u2018a1 -&gt; c1\u2019 with \u2018Float\u2019\n      Expected type: Potential\n        Actual type: a1 -&gt; c1\n    \u2022 Probable cause: \u2018(.)\u2019 is applied to too few arguments\n      In the second argument of \u2018VariableNode\u2019, namely \u2018(snd . fst x)\u2019\n      In the first argument of \u2018(:)\u2019, namely\n        \u2018(VariableNode (fst . fst x) (snd . fst x) (snd x))\u2019\n      In the expression:\n        (VariableNode (fst . fst x) (snd . fst x) (snd x)) : makePGM xs\n\nGraph.hs:14:53: error:\n    \u2022 Couldn't match expected type \u2018a1 -&gt; (a2, c1)\u2019\n                  with actual type \u2018(Label, Potential)\u2019\n    \u2022 Possible cause: \u2018fst\u2019 is applied to too many arguments\n      In the second argument of \u2018(.)\u2019, namely \u2018fst x\u2019\n      In the second argument of \u2018VariableNode\u2019, namely \u2018(snd . fst x)\u2019\n      In the first argument of \u2018(:)\u2019, namely\n        \u2018(VariableNode (fst . fst x) (snd . fst x) (snd x))\u2019\nFailed, modules loaded: none.\n</code></pre>\n\n<p>I have concluded that there are type mismatches but am not clear how so, given the types I have defined and the functions type signature.</p>\n"}, {"tags": ["scala", "haskell", "state-monad"], "comments": [{"owner": {"reputation": 2863, "user_id": 2297560, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/948d4a17494b3c616a0873453b74670c?s=128&d=identicon&r=PG", "display_name": "user2297560", "link": "https://stackoverflow.com/users/2297560/user2297560"}, "edited": false, "score": 4, "creation_date": 1491394803, "post_id": 43230520, "comment_id": 73531859, "body": "This is probably a matter of opinion. But some food for thought: Haskell can do mutable references (IORef, STRef, etc.), so any reason you give for not using State in Scala is just as valid for Haskell. So why do Haskellers use State?"}, {"owner": {"reputation": 100185, "user_id": 3234959, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/93bb12ca0f93dfddb33880316f7e66c2?s=128&d=identicon&r=PG&f=1", "display_name": "chi", "link": "https://stackoverflow.com/users/3234959/chi"}, "edited": false, "score": 0, "creation_date": 1491396629, "post_id": 43230520, "comment_id": 73533261, "body": "I&#39;d also guess it&#39;s not so useful in a language with mutability. Maybe one could use a state monad to document that a specific subroutine mutates only the state of a few variables, but leaves the rest of the state untouched. Perhaps it is not worth the effort, especially if the state monad is implemented as a function, hence is less efficient than plain mutable variables (at least without optimization)."}, {"owner": {"reputation": 18456, "user_id": 1198559, "user_type": "registered", "accept_rate": 70, "profile_image": "https://i.stack.imgur.com/bOjLe.png?s=128&g=1", "display_name": "jhegedus", "link": "https://stackoverflow.com/users/1198559/jhegedus"}, "reply_to_user": {"reputation": 2863, "user_id": 2297560, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/948d4a17494b3c616a0873453b74670c?s=128&d=identicon&r=PG", "display_name": "user2297560", "link": "https://stackoverflow.com/users/2297560/user2297560"}, "edited": false, "score": 2, "creation_date": 1491398813, "post_id": 43230520, "comment_id": 73535087, "body": "@user2297560 maybe they don&#39;t wanna be in the IO monad, for some reason  ?"}, {"owner": {"reputation": 2831, "user_id": 183792, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/9ddcfbc6c31012fd25384f6301363347?s=128&d=identicon&r=PG&f=1", "display_name": "Michael", "link": "https://stackoverflow.com/users/183792/michael"}, "edited": false, "score": 3, "creation_date": 1491402688, "post_id": 43230520, "comment_id": 73538391, "body": "It don&#39;t think it&#39;s true that state monad is more widely used than the zillion mutable ref and array types e.g. <code>Data.IORef</code>, <code>Data.STRef</code> <code>Control.Concurrent.STM.TVar</code>, <code>Data.Vector.Unboxed.Mutable</code> and so on."}, {"owner": {"reputation": 48938, "user_id": 246886, "user_type": "registered", "accept_rate": 94, "profile_image": "https://www.gravatar.com/avatar/dd1ebaade6623fc538fb8af3338e730d?s=128&d=identicon&r=PG", "display_name": "Jon Purdy", "link": "https://stackoverflow.com/users/246886/jon-purdy"}, "edited": false, "score": 1, "creation_date": 1491428273, "post_id": 43230520, "comment_id": 73554292, "body": "One reason I sometimes use <code>State</code> instead of <code>IORef</code> is that the state is persistent, making it easier to speculatively execute an action and roll back any changes if it fails."}], "answers": [{"comments": [{"owner": {"reputation": 18456, "user_id": 1198559, "user_type": "registered", "accept_rate": 70, "profile_image": "https://i.stack.imgur.com/bOjLe.png?s=128&g=1", "display_name": "jhegedus", "link": "https://stackoverflow.com/users/1198559/jhegedus"}, "edited": false, "score": 1, "creation_date": 1491398251, "post_id": 43231991, "comment_id": 73534614, "body": "Right but if the <code>vars</code> are used <b>locally</b> (is in the State Monad)? Inside a function ? Like in the example above ? You can inject the state and extract the state from a function (that uses local variables) just as well, just like from a State monad, so it is just as testable/maintainable/etc as the local solution. A function where the state is hidden is just as referentially transparent as a State Monad because you cannot pass around a function &quot;half evaluated&quot;."}, {"owner": {"reputation": 5100, "user_id": 4482064, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/c70f18b6bae1fff9ad75dea670ecd73d?s=128&d=identicon&r=PG", "display_name": "Cyrille Corpet", "link": "https://stackoverflow.com/users/4482064/cyrille-corpet"}, "reply_to_user": {"reputation": 18456, "user_id": 1198559, "user_type": "registered", "accept_rate": 70, "profile_image": "https://i.stack.imgur.com/bOjLe.png?s=128&g=1", "display_name": "jhegedus", "link": "https://stackoverflow.com/users/1198559/jhegedus"}, "edited": false, "score": 0, "creation_date": 1491398589, "post_id": 43231991, "comment_id": 73534904, "body": "That&#39;s becoming a more opinionated issue, much like this one <a href=\"http://stackoverflow.com/questions/42995875/where-should-one-draw-the-line-between-functional-programming-and-imperative-pro\" title=\"where should one draw the line between functional programming and imperative pro\">stackoverflow.com/questions/42995875/&hellip;</a>"}, {"owner": {"reputation": 100185, "user_id": 3234959, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/93bb12ca0f93dfddb33880316f7e66c2?s=128&d=identicon&r=PG&f=1", "display_name": "chi", "link": "https://stackoverflow.com/users/3234959/chi"}, "edited": false, "score": 1, "creation_date": 1491398664, "post_id": 43231991, "comment_id": 73534954, "body": "On the &quot;always less efficient&quot;, I&#39;m unsure. I think one could implement a Scala State monad using mutability, recovering most of the performance."}, {"owner": {"reputation": 18456, "user_id": 1198559, "user_type": "registered", "accept_rate": 70, "profile_image": "https://i.stack.imgur.com/bOjLe.png?s=128&g=1", "display_name": "jhegedus", "link": "https://stackoverflow.com/users/1198559/jhegedus"}, "edited": false, "score": 0, "creation_date": 1491398784, "post_id": 43231991, "comment_id": 73535058, "body": "Back to square one."}, {"owner": {"reputation": 5100, "user_id": 4482064, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/c70f18b6bae1fff9ad75dea670ecd73d?s=128&d=identicon&r=PG", "display_name": "Cyrille Corpet", "link": "https://stackoverflow.com/users/4482064/cyrille-corpet"}, "reply_to_user": {"reputation": 100185, "user_id": 3234959, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/93bb12ca0f93dfddb33880316f7e66c2?s=128&d=identicon&r=PG&f=1", "display_name": "chi", "link": "https://stackoverflow.com/users/3234959/chi"}, "edited": false, "score": 0, "creation_date": 1491399014, "post_id": 43231991, "comment_id": 73535263, "body": "@chi, I meant &quot;at most only as efficient as&quot;."}, {"owner": {"reputation": 5100, "user_id": 4482064, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/c70f18b6bae1fff9ad75dea670ecd73d?s=128&d=identicon&r=PG", "display_name": "Cyrille Corpet", "link": "https://stackoverflow.com/users/4482064/cyrille-corpet"}, "reply_to_user": {"reputation": 18456, "user_id": 1198559, "user_type": "registered", "accept_rate": 70, "profile_image": "https://i.stack.imgur.com/bOjLe.png?s=128&g=1", "display_name": "jhegedus", "link": "https://stackoverflow.com/users/1198559/jhegedus"}, "edited": false, "score": 0, "creation_date": 1491399250, "post_id": 43231991, "comment_id": 73535470, "body": "@jhegedus referential transparency is lost inside the implementation of the function where you use your <code>var</code>. If it is a small straightforward function, it will probably be useful and increase performances, but if you start doing more complicated stuff, you might need help from the compiler (with types) or from tests, to ensure that everything goes as planned. The (opinionated) question that remains is &quot;Where do you draw the line?&quot;"}, {"owner": {"reputation": 18456, "user_id": 1198559, "user_type": "registered", "accept_rate": 70, "profile_image": "https://i.stack.imgur.com/bOjLe.png?s=128&g=1", "display_name": "jhegedus", "link": "https://stackoverflow.com/users/1198559/jhegedus"}, "edited": false, "score": 0, "creation_date": 1491422221, "post_id": 43231991, "comment_id": 73551114, "body": "Yeah, but what should the type system remind me of ? That a function is using a local <code>var</code> on the inside (which is not visible on the outside) ? <code>mlabel :: Tr anytype -&gt; Lt anytype</code> is a pure function. Who wants to know how a pure function is implemented on the inside ?"}, {"owner": {"reputation": 18456, "user_id": 1198559, "user_type": "registered", "accept_rate": 70, "profile_image": "https://i.stack.imgur.com/bOjLe.png?s=128&g=1", "display_name": "jhegedus", "link": "https://stackoverflow.com/users/1198559/jhegedus"}, "edited": false, "score": 0, "creation_date": 1491422936, "post_id": 43231991, "comment_id": 73551535, "body": "It would be nice to see an example where the State Monad is clearly more suitable/shorter/composable/in any way &quot;better&quot; than a local <code>var</code>."}, {"owner": {"reputation": 2831, "user_id": 183792, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/9ddcfbc6c31012fd25384f6301363347?s=128&d=identicon&r=PG&f=1", "display_name": "Michael", "link": "https://stackoverflow.com/users/183792/michael"}, "reply_to_user": {"reputation": 18456, "user_id": 1198559, "user_type": "registered", "accept_rate": 70, "profile_image": "https://i.stack.imgur.com/bOjLe.png?s=128&g=1", "display_name": "jhegedus", "link": "https://stackoverflow.com/users/1198559/jhegedus"}, "edited": false, "score": 2, "creation_date": 1491475463, "post_id": 43231991, "comment_id": 73574390, "body": "@jhegedus a state monad program is often shorter and simpler than one using a var. A var/ref program must either take the pregiven var as an argument, or else contain initialization of the var. If the latter it does not compose. It is also more complex by referring explicitly to the var throughout. A <code>State</code> program just starts getting and putting and modifying implicit state. Later when you run it, after composing it with other like programs, you runState with an initial state.It also permits composability by use of <code>zoom</code> as @danidiaz points out."}, {"owner": {"reputation": 18456, "user_id": 1198559, "user_type": "registered", "accept_rate": 70, "profile_image": "https://i.stack.imgur.com/bOjLe.png?s=128&g=1", "display_name": "jhegedus", "link": "https://stackoverflow.com/users/1198559/jhegedus"}, "edited": false, "score": 0, "creation_date": 1491489335, "post_id": 43231991, "comment_id": 73585189, "body": "Yeah, I can see how composability is simpler with a <code>State</code> program, you can use monadic combinators and whatnot, such as sequence and so on. Composability is indeed a valid argument in favor of a <code>State</code> program"}], "tags": [], "owner": {"reputation": 5100, "user_id": 4482064, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/c70f18b6bae1fff9ad75dea670ecd73d?s=128&d=identicon&r=PG", "display_name": "Cyrille Corpet", "link": "https://stackoverflow.com/users/4482064/cyrille-corpet"}, "is_accepted": false, "score": 3, "last_activity_date": 1491398254, "last_edit_date": 1491398254, "creation_date": 1491397192, "answer_id": 43231991, "question_id": 43230520, "link": "https://stackoverflow.com/questions/43230520/is-state-monad-needed-useful-in-a-language-with-mutable-local-variables-such/43231991#43231991", "title": "Is State monad needed/useful in a language with mutable (local) variables (such as Scala)?", "body": "<p>The great advantage of State monad on mutable variables (that is, in a functional programming mindset) is reference transparency.</p>\n\n<p>A chunk of code using the State monad is more easily unit-testable, more maintainable, and less error prone than the equivalent using <code>var</code>s, because the logic of the code will not depend on where and when this code is run.</p>\n\n<p>Another viewpoint of the same issue is that the State monad encodes in the type system the fact that a value is mutable, while a <code>var</code> gives no such information.</p>\n\n<p><strong>EDIT</strong></p>\n\n<p>However, the state monad is probably always less efficient than mutable variables, because it adds another level of abstraction between the written code and the compiled output. But this can be said for most of functional constructs, so this is not a real argument for the use of <code>var</code>s in functional scala code. </p>\n"}, {"comments": [{"owner": {"reputation": 24211, "user_id": 1364288, "user_type": "registered", "accept_rate": 88, "profile_image": "https://i.stack.imgur.com/JVtNl.png?s=128&g=1", "display_name": "danidiaz", "link": "https://stackoverflow.com/users/1364288/danidiaz"}, "edited": false, "score": 0, "creation_date": 1491427015, "post_id": 43241679, "comment_id": 73553750, "body": "That said, the  &quot;monad-unlift-ref&quot; package provides a reference-based state monad in Haskell <a href=\"http://hackage.haskell.org/package/monad-unlift-ref\" rel=\"nofollow noreferrer\">hackage.haskell.org/package/monad-unlift-ref</a>"}, {"owner": {"reputation": 18456, "user_id": 1198559, "user_type": "registered", "accept_rate": 70, "profile_image": "https://i.stack.imgur.com/bOjLe.png?s=128&g=1", "display_name": "jhegedus", "link": "https://stackoverflow.com/users/1198559/jhegedus"}, "edited": false, "score": 0, "creation_date": 1491489480, "post_id": 43241679, "comment_id": 73585319, "body": "Thanks for the answer, this is nice stuff."}], "tags": [], "owner": {"reputation": 24211, "user_id": 1364288, "user_type": "registered", "accept_rate": 88, "profile_image": "https://i.stack.imgur.com/JVtNl.png?s=128&g=1", "display_name": "danidiaz", "link": "https://stackoverflow.com/users/1364288/danidiaz"}, "is_accepted": false, "score": 5, "last_activity_date": 1491427062, "last_edit_date": 1491427062, "creation_date": 1491426600, "answer_id": 43241679, "question_id": 43230520, "link": "https://stackoverflow.com/questions/43230520/is-state-monad-needed-useful-in-a-language-with-mutable-local-variables-such/43241679#43241679", "title": "Is State monad needed/useful in a language with mutable (local) variables (such as Scala)?", "body": "<p>When composing stateful actions in Haskell, there is an idiom in which actions only demand to know the bare minimum of state needed to accomplish their tasks, and then each action is <a href=\"http://hackage.haskell.org/package/lens-4.15.1/docs/Control-Lens-Zoom.html#t:Zoom\" rel=\"noreferrer\">zoomed</a> into a composite \"global state\". For example:</p>\n\n<pre><code>import Control.Lens\nimport Control.Monad.Trans.State\n\nsuccInt :: StateT Int IO String\nsuccInt = do\n    modify succ\n    return \"Incr an Int!\"\n\nsuccChar :: StateT Char IO String\nsuccChar = do\n    modify succ\n    return \"Incr a Char!\"\n\ntype GlobalState = (Char,[Int])\n\ncomposite :: StateT GlobalState IO (String,String)\ncomposite = do\n    r1 &lt;- zoom _1 succChar\n    r2 &lt;- zoom (_2.traversed) succInt\n    return (r1,r2)\n</code></pre>\n\n<p>If we execute the example like this:</p>\n\n<pre><code>ghci&gt; runStateT composite ('a',[1,5,7])\n</code></pre>\n\n<p>The result is</p>\n\n<pre><code>((\"Incr a Char!\",\"Incr an Int!Incr an Int!Incr an Int!\"),('b',[2,6,8]))\n</code></pre>\n\n<p>I think the \"zooming\" of the states into bigger states would be more difficult to accomplish with mutable variables.</p>\n"}], "owner": {"reputation": 18456, "user_id": 1198559, "user_type": "registered", "accept_rate": 70, "profile_image": "https://i.stack.imgur.com/bOjLe.png?s=128&g=1", "display_name": "jhegedus", "link": "https://stackoverflow.com/users/1198559/jhegedus"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 652, "favorite_count": 2, "answer_count": 2, "score": 3, "last_activity_date": 1491427062, "creation_date": 1491393457, "last_edit_date": 1491398274, "question_id": 43230520, "link": "https://stackoverflow.com/questions/43230520/is-state-monad-needed-useful-in-a-language-with-mutable-local-variables-such", "title": "Is State monad needed/useful in a language with mutable (local) variables (such as Scala)?", "body": "<p>I understand that in Haskell the State monad is useful because there are no mutable variables (unless we are in the IO monad).</p>\n\n<p>However, what is the deal with Scala ? Is State Monad useful in a language where there are mutable variables ?</p>\n\n<p>In some sense all the State Monad allows is to <a href=\"https://channel9.msdn.com/Shows/Going+Deep/Brian-Beckman-The-Zen-of-Expressing-State-The-State-Monad\" rel=\"nofollow noreferrer\">use some local mutable variables within the Monad context</a>. For example here:</p>\n\n<pre><code> newtype Labeled anytype = Labeled (S -&gt; (S, anytype))\n\n instance Monad Labeled where\n\n   return contents = Labeled (\\st -&gt; (st, contents))\n\n   Labeled fst0 &gt;&gt;= fany1 = \n     Labeled $ \\st0 -&gt; \n       let (st1, any1) = fst0 st0 \n           Labeled fst1 = fany1 any1\n       in fst1 st1 \n\n mlabel :: Tr anytype -&gt; Lt anytype\n mlabel tr = let Labeled mt = mkm tr\n             in snd (mt 0) \n\n mkm :: Tr anytype -&gt; Labeled (Lt anytype)\n\n mkm (Lf x)\n   = updateState &gt;&gt;= \\n -&gt; return $ Lf (n,x)\n\n mkm (Br l r)\n   = mkm l &gt;&gt;= \\l' -&gt;\n     mkm r &gt;&gt;= \\r' -&gt;\n     return $ (Br l' r')\n\n updateState :: Labeled S\n updateState =  Labeled (\\n -&gt; ((n+1),n))\n\n main = print $ mlabel tr1\n</code></pre>\n\n<p>This code would be much simpler (3-4 lines) using mutable variables in Scala. Something like:\n<code>case class Tr (...)</code></p>\n\n<p><code>case class LTr (...)</code></p>\n\n<p><code>def labelTree = (... recursive call ... )</code></p>\n\n<p>where <code>labelTree</code> is using local mutable variables to store the current state of the label.</p>\n\n<p>I don't really see the usefulness of State Monads in Scala. Why would anyone use State Monad in Scala ? Are there any good use cases for it ? </p>\n\n<p>The only use case I can imagine if the stateful computation is complex and is composed from several State Monads, but at that point I am not sure how useful it is to use State Monad in contrast to plain old functional programming and explicit argument passing (instead of implicit argument passing which is what the State Monad is).</p>\n"}, {"tags": ["haskell"], "comments": [{"owner": {"reputation": 100185, "user_id": 3234959, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/93bb12ca0f93dfddb33880316f7e66c2?s=128&d=identicon&r=PG&f=1", "display_name": "chi", "link": "https://stackoverflow.com/users/3234959/chi"}, "edited": false, "score": 4, "creation_date": 1491392864, "post_id": 43230210, "comment_id": 73530353, "body": "You can&#39;t turn <code>IO a</code> into <code>a</code>. You need to use something like <code>fmap validFunction</code> to obtain <code>IO [(Int,Int)] -&gt; IO Bool</code> and use that instead. Once you perform IO, you can never have a type which does not show IO is being performed -- by design."}, {"owner": {"reputation": 161, "user_id": 3476740, "user_type": "registered", "accept_rate": 57, "profile_image": "https://www.gravatar.com/avatar/14a5d37197d6231c545fa5d8c81f3b2f?s=128&d=identicon&r=PG&f=1", "display_name": "Tony Chamberlain", "link": "https://stackoverflow.com/users/3476740/tony-chamberlain"}, "reply_to_user": {"reputation": 100185, "user_id": 3234959, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/93bb12ca0f93dfddb33880316f7e66c2?s=128&d=identicon&r=PG&f=1", "display_name": "chi", "link": "https://stackoverflow.com/users/3234959/chi"}, "edited": false, "score": 0, "creation_date": 1491393447, "post_id": 43230210, "comment_id": 73530773, "body": "Yes I understand that from all the answers I&#39;ve read.  what I can&#39;t seem to find is any clear cut example showing the syntax for what I need.  It all seems to involve code that stays inside the main.  I can&#39;t find any code that calls a &quot;pure function&quot; from a do block with the syntax you suggested."}, {"owner": {"reputation": 133611, "user_id": 152602, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/7f370b4bd787fc68f9f62d9c6781cb79?s=128&d=identicon&r=PG", "display_name": "Lee", "link": "https://stackoverflow.com/users/152602/lee"}, "edited": false, "score": 0, "creation_date": 1491393746, "post_id": 43230210, "comment_id": 73531008, "body": "What&#39;s the type of <code>rs</code>? If it&#39;s <code>IO [(Int, Int)]</code> then you need <code>fmap validFunction rs</code> which has type <code>IO Bool</code>."}, {"owner": {"reputation": 384463, "user_id": 1126841, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/fa05233b2357f8d11c22ef4cfc7bb85c?s=128&d=identicon&r=PG", "display_name": "chepner", "link": "https://stackoverflow.com/users/1126841/chepner"}, "edited": false, "score": 1, "creation_date": 1491394300, "post_id": 43230210, "comment_id": 73531468, "body": "Where are you trying to call <code>validFunction</code>? <code>rs</code> is only bound inside the definition of <code>doTest</code>, so you probably want somthin like <code>fmap validFunction doTest</code>. If calling it <i>inside</i> <code>doTest</code>, then replace <code>return rs</code> with <code>fmap validFunction rs</code>."}, {"owner": {"reputation": 161, "user_id": 3476740, "user_type": "registered", "accept_rate": 57, "profile_image": "https://www.gravatar.com/avatar/14a5d37197d6231c545fa5d8c81f3b2f?s=128&d=identicon&r=PG&f=1", "display_name": "Tony Chamberlain", "link": "https://stackoverflow.com/users/3476740/tony-chamberlain"}, "edited": false, "score": 0, "creation_date": 1491395290, "post_id": 43230210, "comment_id": 73532217, "body": "fmap validFunction rs  won&#39;t work since fmap changes the [(Int,Int)] i&#39;m expecting into (Int,Int).  However fmap validFunction [rs] :: IO [Bool]  complains that Couldn&#39;t match type [] with IO.  Expected type : IO [Bool]  actual type [Bool]"}, {"owner": {"reputation": 94713, "user_id": 1139697, "user_type": "registered", "accept_rate": 86, "profile_image": "https://www.gravatar.com/avatar/5f136ddb684f39aaee1c028ee1950f6f?s=128&d=identicon&r=PG", "display_name": "Zeta", "link": "https://stackoverflow.com/users/1139697/zeta"}, "reply_to_user": {"reputation": 384463, "user_id": 1126841, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/fa05233b2357f8d11c22ef4cfc7bb85c?s=128&d=identicon&r=PG", "display_name": "chepner", "link": "https://stackoverflow.com/users/1126841/chepner"}, "edited": false, "score": 1, "creation_date": 1491395304, "post_id": 43230210, "comment_id": 73532229, "body": "@chepner: <code>rs</code> is already an <code>[(Int, Int)]</code>. You mean <code>return (validFunction rs)</code>."}, {"owner": {"reputation": 1247, "user_id": 3485629, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/640b2583577ec470ac273b27f78025d5?s=128&d=identicon&r=PG", "display_name": "basile-henry", "link": "https://stackoverflow.com/users/3485629/basile-henry"}, "edited": false, "score": 0, "creation_date": 1491398109, "post_id": 43230210, "comment_id": 73534481, "body": "@TonyChamberlain For most HackerRank problems you can solve them with just one built-in <code>IO</code> function: <code>interact :: (String -&gt; String) -&gt; IO ()</code>. A typical problem can be solved with: <code>main = interact solveProblem</code> where you have <code>solveProblem :: String -&gt; String</code>. The <code>interact</code> function will handle getting all the input from stdin and outputting to stdout."}, {"owner": {"reputation": 45534, "user_id": 106104, "user_type": "registered", "accept_rate": 62, "profile_image": "https://www.gravatar.com/avatar/c88b9310b92a937108ec4336c2832f92?s=128&d=identicon&r=PG", "display_name": "user253751", "link": "https://stackoverflow.com/users/106104/user253751"}, "edited": false, "score": 1, "creation_date": 1491456530, "post_id": 43230210, "comment_id": 73562233, "body": "When people talk about &quot;processing values inside the IO monad&quot; they <i>don&#39;t</i> mean that all your functions have to use the IO monad. They mean you put together a bunch of functions, and the <i>final result</i> (which is usually called <code>main</code>) is in the IO monad."}], "answers": [{"comments": [{"owner": {"reputation": 161, "user_id": 3476740, "user_type": "registered", "accept_rate": 57, "profile_image": "https://www.gravatar.com/avatar/14a5d37197d6231c545fa5d8c81f3b2f?s=128&d=identicon&r=PG&f=1", "display_name": "Tony Chamberlain", "link": "https://stackoverflow.com/users/3476740/tony-chamberlain"}, "edited": false, "score": 0, "creation_date": 1491395721, "post_id": 43231153, "comment_id": 73532556, "body": "Great explanation.  Sadly in all the flailing about I did I actually did return validFunction rs,  but lack of () or $ got me.  I keep forgetting its right associative."}, {"owner": {"reputation": 94713, "user_id": 1139697, "user_type": "registered", "accept_rate": 86, "profile_image": "https://www.gravatar.com/avatar/5f136ddb684f39aaee1c028ee1950f6f?s=128&d=identicon&r=PG", "display_name": "Zeta", "link": "https://stackoverflow.com/users/1139697/zeta"}, "reply_to_user": {"reputation": 161, "user_id": 3476740, "user_type": "registered", "accept_rate": 57, "profile_image": "https://www.gravatar.com/avatar/14a5d37197d6231c545fa5d8c81f3b2f?s=128&d=identicon&r=PG&f=1", "display_name": "Tony Chamberlain", "link": "https://stackoverflow.com/users/3476740/tony-chamberlain"}, "edited": false, "score": 3, "creation_date": 1491395846, "post_id": 43231153, "comment_id": 73532667, "body": "@TonyChamberlain <code>return</code> is a function, not a keyword. That&#39;s the key  (heh) one has to keep in mind."}], "tags": [], "owner": {"reputation": 94713, "user_id": 1139697, "user_type": "registered", "accept_rate": 86, "profile_image": "https://www.gravatar.com/avatar/5f136ddb684f39aaee1c028ee1950f6f?s=128&d=identicon&r=PG", "display_name": "Zeta", "link": "https://stackoverflow.com/users/1139697/zeta"}, "is_accepted": false, "score": 7, "last_activity_date": 1491395131, "creation_date": 1491395131, "answer_id": 43231153, "question_id": 43230210, "link": "https://stackoverflow.com/questions/43230210/unwrapping-a-from-io-a/43231153#43231153", "title": "Unwrapping a from IO (a)", "body": "<p>First of all, if you use <code>x &lt;- act</code> in <code>do</code>, you essentially have a value. Unless you did something <em>very</em> suspicious, <code>x</code> isn't a <code>IO something</code>, but a <code>something</code>: So it's perfectly fine to use</p>\n\n<pre><code>foo :: Int -&gt; Char\nfoo = \u2026\n\nbar :: IO Int\nbar = \u2026\n\nfooDo :: IO Char\nfooDo = do\n   number &lt;- bar\n   return (foo number) -- apply foo directly on number\n</code></pre>\n\n<p>However, <code>IO</code> is an instance of <code>Functor</code>, so we can use <code>fmap</code> to <em>lift</em> <code>foo</code>:</p>\n\n<pre><code>liftedFoo :: IO Int -&gt; IO Char\nliftedFoo = fmap foo\n</code></pre>\n\n<p>So we could have written <code>fooDo</code> like this:</p>\n\n<pre><code>fooDo = fmap foo readLn\n</code></pre>\n\n<p>Although it's name is now misleading, it still does the same as before. But let's leave this naming voodoo aside, how would you tackle this? Well, your <code>doTest</code> has the correct type:</p>\n\n<pre><code>doTest :: IO [(Int, Int)]\ndoTest = do\n    query  &lt;- getLine\n    rs     &lt;- replicateM (read query) readPair\n    return rs\n</code></pre>\n\n<p>So all that's missing is calling <code>validFunction</code>. We can do that like in <code>fooDo</code>:</p>\n\n<pre><code>doTest :: IO Bool\ndoTest = do\n    query  &lt;- getLine\n    rs     &lt;- replicateM (read query) readPair\n    return (validFunction rs)\n--         ^^^^^^^^^^^^^^^^^^\n--         no IO  inside here\n--  ^^^^^^ \n--   back \n--  to  IO\n</code></pre>\n\n<p>Or we can <code>fmap</code> over another <code>IO</code> value, like <code>replicateM (read query) readPair</code>:</p>\n\n<pre><code>doTest :: IO Bool\ndoTest = do\n    query  &lt;- getLine\n    fmap validFunction (replicateM (read query) readPair)\n</code></pre>\n\n<p>The latter is harder to read, though. But you write your <del><code>fooDo</code></del> <code>doTest</code> as you want to <code>do</code>.</p>\n"}], "owner": {"reputation": 161, "user_id": 3476740, "user_type": "registered", "accept_rate": 57, "profile_image": "https://www.gravatar.com/avatar/14a5d37197d6231c545fa5d8c81f3b2f?s=128&d=identicon&r=PG&f=1", "display_name": "Tony Chamberlain", "link": "https://stackoverflow.com/users/3476740/tony-chamberlain"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 369, "favorite_count": 0, "answer_count": 1, "score": 1, "last_activity_date": 1491395131, "creation_date": 1491392597, "last_edit_date": 1491395031, "question_id": 43230210, "link": "https://stackoverflow.com/questions/43230210/unwrapping-a-from-io-a", "title": "Unwrapping a from IO (a)", "body": "<p>I've been learning Haksell the last 2 weeks and decided to try challenges at places such as Hackerrank.  This has required learning IO.  I have read many answers on stackExchange and the general gist is you don't unwrap IO a.. you just manipulate that data inside the IO function.  That being the case what is the point of all the pure functions, if I'm not allowed to send data from main out to them?  Here is some code that reads how many test cases, then for each test case reads N ordered pairs.  </p>\n\n<pre><code>main = do\n     test &lt;- getLine\n     replicateM (read test) doTest\n\ndoTest = do\n    query&lt;-getLine\n    rs&lt;-replicateM (read query) readPair\n    return rs  -- just here to make the file compile\n\nreadPair :: IO (Int, Int)\nreadPair = do\n   input &lt;- getLine\n   let a = words input in return (read (a!!0) :: Int, read (a!!1) ::Int)\n</code></pre>\n\n<p>At this point I have a IO [(Int,Int)] inside of rs.  I would like to send that data to this function:</p>\n\n<pre><code>validFunction :: [(Int,Int)]-&gt;Bool\nvalidFuntion [] = True\nvalidFunction (x:[]) = True\nvalidFunction (x:xs) = (not $ elem (snd x) (fmap snd xs))  &amp;&amp; validFunction xs\n</code></pre>\n\n<p>But I can't seem to figure out how to do that.  Any help or suggestions about how to call this function with the data I've read from the user would be appreciated.  Or if I'm going about it from the wrong angle, and pointers on what I should be doing would also work.</p>\n\n<p>Edit:   From reading lots of other questions on here I've gotten the general Idea that once your in IO your stuck there.  But what I can't seem to find is the syntax to call a pure function with IO data and get back IO data.  I've tried some of the following :</p>\n\n<pre><code>fmap validFunction [rs] :: IO Bool  -- tried it with just rs without [] as well \nmapM validFunction [rs] :: IO Bool\nvalidFunction rs :: IO Bool\n</code></pre>\n\n<p>I was able to get this to work:</p>\n\n<pre><code> putStrLn . f . validFunction $ rs\n</code></pre>\n\n<p>Though I'm still not clear on why this lets you pass the IO [(Int,Int)] to validFunction.</p>\n"}, {"tags": ["list", "haskell", "combinations"], "answers": [{"tags": [], "owner": {"reputation": 314794, "user_id": 67579, "user_type": "registered", "accept_rate": 81, "profile_image": "https://i.stack.imgur.com/BJXub.png?s=128&g=1", "display_name": "Willem Van Onsem", "link": "https://stackoverflow.com/users/67579/willem-van-onsem"}, "is_accepted": false, "score": 3, "last_activity_date": 1491419869, "last_edit_date": 1491419869, "creation_date": 1491391240, "answer_id": 43229702, "question_id": 43229580, "link": "https://stackoverflow.com/questions/43229580/combinations-of-k-elements-from-set-n-haskell/43229702#43229702", "title": "Combinations of k elements from set N haskell", "body": "<p>You could write your function for <strong>three</strong> elements like using <code>tails :: [a] -&gt; [[a]]</code>:</p>\n\n<pre><code>[x++y++z | (x:xs) &lt;- tails list, (y:ys) &lt;- tails xs, (z:_) &lt;- tails ys]\n</code></pre>\n\n<p>This generates:</p>\n\n<pre><code>Prelude&gt; :m Data.List\nPrelude Data.List&gt; (\\list -&gt; [x++y++z | (x:xs) &lt;- tails list, (y:ys) &lt;- tails xs, (z:_) &lt;- tails ys]) [\"A\",\"B\",\"C\",\"D\"]\n[\"ABC\",\"ABD\",\"ACD\",\"BCD\"]\n</code></pre>\n\n<p>But usually you want a more <strong>scalable solution</strong> (one where you can generate combinations of <em>k</em> elements). You could for instance define a function <code>combinations :: Int -&gt; [a] -&gt; [[a]]</code> like:</p>\n\n<pre><code>combinations 0 _ = [[]]\ncombinations n ls = [ (x:ys) | (x:xs) &lt;- tails ls, ys &lt;- combinations (n-1) xs ]\n</code></pre>\n\n<p>and then you have to <code>concat</code> all the elements (for instance using a <code>map</code>).</p>\n"}, {"tags": [], "owner": {"reputation": 29966, "user_id": 637669, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/0227e5d5eaceb8ae2f751df38d421764?s=128&d=identicon&r=PG", "display_name": "arrowd", "link": "https://stackoverflow.com/users/637669/arrowd"}, "is_accepted": false, "score": 0, "last_activity_date": 1491391336, "creation_date": 1491391336, "answer_id": 43229754, "question_id": 43229580, "link": "https://stackoverflow.com/questions/43229580/combinations-of-k-elements-from-set-n-haskell/43229754#43229754", "title": "Combinations of k elements from set N haskell", "body": "<p>There you go:</p>\n\n<pre><code>combinations 0 lst = [[]]\ncombinations k lst = do\n    (x:xs) &lt;- tails lst\n    rest   &lt;- combinations (n-1) xs\n    return $ x : rest\n</code></pre>\n\n<p>Now, to get the result you want, use <code>map concat (combinations 3 [\"A\",\"B\",\"C\",\"D\"])</code>.</p>\n"}], "owner": {"reputation": 11, "user_id": 5731286, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/dc8fd57103abe0ef9a77245ddb17b0c7?s=128&d=identicon&r=PG&f=1", "display_name": "user5731286", "link": "https://stackoverflow.com/users/5731286/user5731286"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 1064, "favorite_count": 0, "answer_count": 2, "score": -1, "last_activity_date": 1491419869, "creation_date": 1491390912, "last_edit_date": 1491391471, "question_id": 43229580, "link": "https://stackoverflow.com/questions/43229580/combinations-of-k-elements-from-set-n-haskell", "title": "Combinations of k elements from set N haskell", "body": "<p>I am trying to get all ordered combinations of 3 elements from a set of <code>N</code>:\nelements,that is : <code>[\"A\",\"B\",\"C\",\"D\"]</code> --> <code>[\"ABC\",\"ABD\",\"ACD\",\"BCD\"]</code>.</p>\n\n<p>I thought about writing something like <code>[ x++y++z | pos(x)in list &lt; pos(y) in list &lt; pos(z) in list ]</code></p>\n\n<p>How would i do that ?</p>\n"}, {"tags": ["haskell"], "answers": [{"tags": [], "owner": {"reputation": 23600, "user_id": 1695172, "user_type": "registered", "accept_rate": 91, "profile_image": "https://www.gravatar.com/avatar/6319d7eafca7852cf04c88598ca31e75?s=128&d=identicon&r=PG", "display_name": "Netwave", "link": "https://stackoverflow.com/users/1695172/netwave"}, "is_accepted": false, "score": 1, "last_activity_date": 1491417712, "last_edit_date": 1491417712, "creation_date": 1491386854, "answer_id": 43228067, "question_id": 43227969, "link": "https://stackoverflow.com/questions/43227969/counting-lower-and-uppercase-characters-in-haskell/43228067#43228067", "title": "counting lower and uppercase characters in haskell", "body": "<p>Just transform all to lowercase:</p>\n\n<pre><code>import Data.Char\ncountList :: [Char] -&gt; Char -&gt; Int\ncountList str c = length $ filter (== toLower c) $ map toLower str\n</code></pre>\n\n<p>You can also use just use <code>fold</code>, here a ghci example:</p>\n\n<pre><code>Prelude Data.Char&gt; let countList = \\str c -&gt; foldl (\\x y -&gt; x + if ((toLower y) == (toLower c)) then 1 else 0) 0 str\nPrelude Data.Char&gt; countList \"AAaabCC\" 'a'\n4\n</code></pre>\n"}, {"tags": [], "owner": {"reputation": 893, "user_id": 6248287, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/tPegr.jpg?s=128&g=1", "display_name": "\u019b\u019b\u019b", "link": "https://stackoverflow.com/users/6248287/%c6%9b%c6%9b%c6%9b"}, "is_accepted": true, "score": 1, "last_activity_date": 1491405386, "creation_date": 1491405386, "answer_id": 43235272, "question_id": 43227969, "link": "https://stackoverflow.com/questions/43227969/counting-lower-and-uppercase-characters-in-haskell/43235272#43235272", "title": "counting lower and uppercase characters in haskell", "body": "<pre><code>import Data.Char (toUpper)\n\ncountChar :: Char -&gt; [Char] -&gt; Int\ncountChar char  = length . filter (\\c -&gt; toUpper c == toUpper char)\n\n\ncountChar 's' \"Stdudents\" =&gt; 2\ncountChar 'S' \"Sstudents\" =&gt; 3\ncountChar 'S' \"$tudent$$\" =&gt; 0\n</code></pre>\n\n<p>Given a character 'char', filter the entire string for any character whose uppercase matches the uppercase of 'char'. Feed the new filtered string to the 'length' function to get the total count.</p>\n"}, {"comments": [{"owner": {"reputation": 893, "user_id": 6248287, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/tPegr.jpg?s=128&g=1", "display_name": "\u019b\u019b\u019b", "link": "https://stackoverflow.com/users/6248287/%c6%9b%c6%9b%c6%9b"}, "edited": false, "score": 0, "creation_date": 1491414496, "post_id": 43235756, "comment_id": 73546580, "body": "love the use of &quot;on&quot;."}], "tags": [], "owner": {"reputation": 100892, "user_id": 745903, "user_type": "registered", "accept_rate": 74, "profile_image": "https://www.gravatar.com/avatar/50933f6638836741e620669b3940410e?s=128&d=identicon&r=PG", "display_name": "leftaroundabout", "link": "https://stackoverflow.com/users/745903/leftaroundabout"}, "is_accepted": false, "score": 1, "last_activity_date": 1491406654, "creation_date": 1491406654, "answer_id": 43235756, "question_id": 43227969, "link": "https://stackoverflow.com/questions/43227969/counting-lower-and-uppercase-characters-in-haskell/43235756#43235756", "title": "counting lower and uppercase characters in haskell", "body": "<p>A neat way to obtain the <code>toUpper c == toUpper char</code> comparison is to use the <code>on</code> combinator:</p>\n\n<pre><code>import Data.Function\n\ncountChar char = length . filter (on (==) toUpper char)\n</code></pre>\n"}], "owner": {"reputation": 5, "user_id": 7819680, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/d468281fa3da9559276ca6700baf7e8a?s=128&d=identicon&r=PG&f=1", "display_name": "toasttoast", "link": "https://stackoverflow.com/users/7819680/toasttoast"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 1316, "favorite_count": 0, "accepted_answer_id": 43235272, "answer_count": 3, "score": 0, "last_activity_date": 1491417712, "creation_date": 1491386616, "question_id": 43227969, "link": "https://stackoverflow.com/questions/43227969/counting-lower-and-uppercase-characters-in-haskell", "title": "counting lower and uppercase characters in haskell", "body": "<p>Im a beginner to haskell and I've tried to create a function which counts the numbers of a character in a string. The problem I have is that I am only able to count either the number of occurences of a uppercase or a lowercase character. I want to count both of them. E.g. For the string Mum the result for counting m should be 2.</p>\n\n<p>My function right now looks like this:</p>\n\n<pre><code>import Data.Char\ncountList :: [Char] -&gt; Char -&gt; Int\ncountList str c = length $ filter (== c) str\n</code></pre>\n\n<p>What would your suggestions on solving this be?</p>\n"}, {"tags": ["haskell", "functor", "category-theory", "lifting"], "answers": [{"comments": [{"owner": {"user_type": "does_not_exist", "display_name": "user235273"}, "edited": false, "score": 0, "creation_date": 1491376058, "post_id": 43224037, "comment_id": 73518492, "body": "So to generalize, an endofunctor always return a lifted type?"}], "tags": [], "owner": {"reputation": 2313, "user_id": 5318306, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/897fd4f3b92d28c5c1eb28a8024661a1?s=128&d=identicon&r=PG&f=1", "display_name": "Gurkenglas", "link": "https://stackoverflow.com/users/5318306/gurkenglas"}, "is_accepted": false, "score": 1, "last_activity_date": 1491375690, "creation_date": 1491375690, "answer_id": 43224037, "question_id": 43223842, "link": "https://stackoverflow.com/questions/43223842/does-a-functor-always-return-a-lifted-type-in-haskell-when-the-fmap-transformati/43224037#43224037", "title": "Does a functor always return a lifted type in haskell when the fmap transformation is applied?", "body": "<p>What you can call lifting is what the type constructor <code>Maybe</code> does to the type <code>Int</code> in order to construct the type <code>Maybe Int</code>, and what <code>fmap</code> does to some function of type <code>Int -&gt; Int</code> in order to construct a function of type <code>Maybe Int -&gt; Maybe Int</code>.</p>\n"}, {"comments": [{"owner": {"user_type": "does_not_exist", "display_name": "user235273"}, "edited": false, "score": 0, "creation_date": 1491379882, "post_id": 43224561, "comment_id": 73520917, "body": "Thanks. Nice explanation."}], "tags": [], "owner": {"reputation": 56659, "user_id": 450128, "user_type": "registered", "accept_rate": 62, "profile_image": "https://www.gravatar.com/avatar/2f72b3fdc99fe9fd1bbeb2f9da1d2c0a?s=128&d=identicon&r=PG", "display_name": "Ben", "link": "https://stackoverflow.com/users/450128/ben"}, "is_accepted": true, "score": 1, "last_activity_date": 1491377203, "creation_date": 1491377203, "answer_id": 43224561, "question_id": 43223842, "link": "https://stackoverflow.com/questions/43223842/does-a-functor-always-return-a-lifted-type-in-haskell-when-the-fmap-transformati/43224561#43224561", "title": "Does a functor always return a lifted type in haskell when the fmap transformation is applied?", "body": "<p><code>fmap</code> always takes a function of type <code>a -&gt; b</code>, and gives you a function of type <code>f a -&gt; f b</code>, for some type constructor <code>f</code>. So if you call the application of the type constructor <code>f</code> to the type <code>a</code> \"lifting\", then yes, <code>fmap</code> always gives you a function that works on \"lifted types\".<sup>1</sup></p>\n\n<p>The builtin Haskell type class <code>Functor</code> has as members type constructors of kind <code>* -&gt; *</code>: things that can be applied to any type you like, to produce a new type (like <code>Maybe</code> in your example). In category theory terms, the type constructor itself (e.g. <code>Maybe</code>) represents the mapping from objects of the source category to the target category, and <code>fmap</code> provides the mapping of morphisms (remembering that the <strong>Hask</strong> catogory has Haskell types as objects and Haskell functions as morphisms).</p>\n\n<p>So Haskell <code>Functor</code> can only represent endofunctors on the category <strong>Hask</strong>, since maps Haskell types &amp; functions to Haskell types &amp; functions. But it can't even represent any possible endofunctor, since we can't use it to map objects (types) arbitrarily. My Haskell functor can't map <code>Int</code> to <code>Maybe String</code> and <code>Char</code> to <code>Bool</code>, it <em>must</em> map each type to \"the same type\" under a type constructor (as <code>Maybe</code> maps <code>Int</code> to <code>Maybe Int</code>, <code>Char</code> to <code>Maybe Char</code>, <code>Maybe (Maybe (Maybe Bool))</code> to <code>Maybe (Maybe (Maybe (Maybe Bool)))</code>, etc). Each Haskell Functor's destination category is an entire mirror image of <strong>Hask</strong> nested under the functor's type constructor.</p>\n\n<p>So Haskell's <code>Functor</code> class is quite a restricted version of the general notion of a category theory functor, and even quite restricted compared to the notion of \"an endofunctor on <strong>Hask</strong>\". But if we are talking specifically about Haskell Functors, then yes, a function that is the result of <code>fmap</code> will always return (and take) values in a \"lifted\" type.</p>\n\n<hr>\n\n<p><sup>1</sup> Be aware that \"lifting\" and \"lifted\" as applied to things in Haskell have a number of established meanings in different contexts, so don't automatically assume anything else you see talking about \"lifted types\" means the same thing as in this discussion.</p>\n"}], "owner": {"user_type": "does_not_exist", "display_name": "user235273"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 88, "favorite_count": 1, "accepted_answer_id": 43224561, "answer_count": 2, "score": 1, "last_activity_date": 1491377203, "creation_date": 1491375130, "question_id": 43223842, "link": "https://stackoverflow.com/questions/43223842/does-a-functor-always-return-a-lifted-type-in-haskell-when-the-fmap-transformati", "title": "Does a functor always return a lifted type in haskell when the fmap transformation is applied?", "body": "<p>Let's say I have an <code>Int</code> and I apply <code>fmap</code> transformation using the <code>Maybe</code> as a functor, I get a wrapped type, i.e., <code>Maybe Int</code>. So can I consider this as lifting? If so does a functor always return a lifted type?</p>\n"}, {"tags": ["haskell"], "comments": [{"owner": {"reputation": 1735, "user_id": 2892792, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/5DNyi.jpg?s=128&g=1", "display_name": "Lazersmoke", "link": "https://stackoverflow.com/users/2892792/lazersmoke"}, "edited": false, "score": 2, "creation_date": 1491360414, "post_id": 43220263, "comment_id": 73512582, "body": "What have you tried so far? As it stands, you are just asking for someone to write this for you."}, {"owner": {"reputation": 75362, "user_id": 625403, "user_type": "registered", "accept_rate": 82, "profile_image": "https://www.gravatar.com/avatar/786eed7da67079cb5d63a49d469af25b?s=128&d=identicon&r=PG", "display_name": "amalloy", "link": "https://stackoverflow.com/users/625403/amalloy"}, "edited": false, "score": 0, "creation_date": 1491369397, "post_id": 43220263, "comment_id": 73515165, "body": "In fairness, for a newcomer often writing the types is a hard enough step that this question already includes &quot;what has been tried so far&quot;. We don&#39;t know whether the type was provided as part of the assignment, or is part of the solution."}], "answers": [{"comments": [{"owner": {"reputation": 558, "user_id": 1457136, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/8e1f8148bbb8ea15c4b7c02893c99cab?s=128&d=identicon&r=PG", "display_name": "Jean-Baptiste Potonnier", "link": "https://stackoverflow.com/users/1457136/jean-baptiste-potonnier"}, "edited": false, "score": 0, "creation_date": 1491384221, "post_id": 43226569, "comment_id": 73523922, "body": "Maybe it helps to visualize the list in extension. So <code>foldl g z</code> is a function that takes something with the form <code>[x1, x2, ... , xn]</code> and produces <code>(((z `g` x1) `g` x2) ... `g` xn)</code>"}], "tags": [], "owner": {"reputation": 670, "user_id": 7781818, "user_type": "registered", "accept_rate": 80, "profile_image": "https://www.gravatar.com/avatar/13f5392f913a0f47fab3e6719bda4b08?s=128&d=identicon&r=PG&f=1", "display_name": "Chris", "link": "https://stackoverflow.com/users/7781818/chris"}, "is_accepted": false, "score": 1, "last_activity_date": 1491383014, "creation_date": 1491383014, "answer_id": 43226569, "question_id": 43220263, "link": "https://stackoverflow.com/questions/43220263/implement-any-using-foldl/43226569#43226569", "title": "Implement any using foldl", "body": "<p><code>foldl</code> is usually applied like <code>foldl (\\acc x -&gt; &lt;newAcc&gt;) &lt;startingValue&gt; &lt;list&gt;</code>, where <code>&lt;starting value&gt;</code> is the initial value of <code>acc</code> so in your case <code>False</code> may be suitable, and <code>&lt;newAcc&gt;</code> is computed based on the evaluation of <code>x</code> (a list element) and <code>acc</code> (the current value of your accumulator). In the end the accumulator is returned. For calculating the new accumulator you want it to be <code>True</code> if the condition is met, and the old accumulator, if it is not met. Your function then could look something like this:</p>\n\n<pre><code>myAny predicate list = foldl (\\acc x -&gt; if predicate x then True else acc) False list\n</code></pre>\n\n<p>hope that helps... but don't just echo it, check out <a href=\"http://learnyouahaskell.com/higher-order-functions\" rel=\"nofollow noreferrer\">learn you a Haskell for great good's chapter on this</a></p>\n"}], "owner": {"reputation": 1, "user_id": 7817488, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/153ab7dff7b1d2fbd2faa04364953560?s=128&d=identicon&r=PG&f=1", "display_name": "Takimiro", "link": "https://stackoverflow.com/users/7817488/takimiro"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 124, "favorite_count": 0, "answer_count": 1, "score": -3, "last_activity_date": 1491383014, "creation_date": 1491355255, "last_edit_date": 1491369314, "question_id": 43220263, "link": "https://stackoverflow.com/questions/43220263/implement-any-using-foldl", "title": "Implement any using foldl", "body": "<p>I'm new to Haskell, and I need to implement a function that works like <code>any</code>, but it needs to be implemented with <code>foldl</code>.  This is what I have now:</p>\n\n<pre><code>myAny :: (a -&gt; Bool) -&gt; [a] -&gt; Bool\nmyAny = undefined\n</code></pre>\n"}, {"tags": ["haskell", "monads", "state-monad"], "comments": [{"owner": {"reputation": 29444, "user_id": 3072788, "user_type": "registered", "accept_rate": 82, "profile_image": "https://www.gravatar.com/avatar/220a45c2fcff7e7358d144551b116205?s=128&d=identicon&r=PG&f=1", "display_name": "Alec", "link": "https://stackoverflow.com/users/3072788/alec"}, "edited": false, "score": 0, "creation_date": 1491347570, "post_id": 43219093, "comment_id": 73509577, "body": "I fixed some code alignment issues to make your example compile - feel free to revert them if they are not to your liking!"}, {"owner": {"reputation": 29444, "user_id": 3072788, "user_type": "registered", "accept_rate": 82, "profile_image": "https://www.gravatar.com/avatar/220a45c2fcff7e7358d144551b116205?s=128&d=identicon&r=PG&f=1", "display_name": "Alec", "link": "https://stackoverflow.com/users/3072788/alec"}, "edited": false, "score": 0, "creation_date": 1491347794, "post_id": 43219093, "comment_id": 73509647, "body": "Your base case is the problem. Also, your function doesn&#39;t return <code>([value],[state])</code> it returns <code>State [a] [a]</code>. However, should you want to change that, that would <i>also</i> be in the base case."}], "answers": [{"comments": [{"owner": {"reputation": 44013, "user_id": 1477667, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/trgKM.jpg?s=128&g=1", "display_name": "dfeuer", "link": "https://stackoverflow.com/users/1477667/dfeuer"}, "edited": false, "score": 5, "creation_date": 1491353594, "post_id": 43219388, "comment_id": 73511118, "body": "I know it doesn&#39;t matter, but I recommend importing <code>first</code> from <code>Data.Bifunctor</code> instead of <code>Control.Arrow</code>. A relatively new Haskell user is more likely to understand what a <code>Bifunctor</code> is than what an <code>Arrow</code> is."}, {"owner": {"reputation": 198293, "user_id": 707111, "user_type": "moderator", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/oXZkh.jpg?s=128&g=1", "display_name": "Ry-", "link": "https://stackoverflow.com/users/707111/ry"}, "reply_to_user": {"reputation": 44013, "user_id": 1477667, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/trgKM.jpg?s=128&g=1", "display_name": "dfeuer", "link": "https://stackoverflow.com/users/1477667/dfeuer"}, "edited": false, "score": 0, "creation_date": 1491354079, "post_id": 43219388, "comment_id": 73511240, "body": "@dfeuer Good call."}], "tags": [], "owner": {"reputation": 198293, "user_id": 707111, "user_type": "moderator", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/oXZkh.jpg?s=128&g=1", "display_name": "Ry-", "link": "https://stackoverflow.com/users/707111/ry"}, "is_accepted": true, "score": 2, "last_activity_date": 1491354090, "last_edit_date": 1491354090, "creation_date": 1491348336, "answer_id": 43219388, "question_id": 43219093, "link": "https://stackoverflow.com/questions/43219093/state-monad-modifying-state-without-modifying-value/43219388#43219388", "title": "State Monad: Modifying state without modifying value", "body": "<p>Your <code>myFunc _ []</code> definition is indeed putting the state into the value. You actually just want it to be an empty list of passes:</p>\n\n<pre><code>myFunc _ [] = return []\n</code></pre>\n\n<p>and then you probably want to return the results in order:</p>\n\n<pre><code>myFunc :: (a -&gt; Bool) -&gt; [a] -&gt; State [a] [a]\nmyFunc _ [] = return []\nmyFunc p (x:xs) = do\n    passes &lt;- myFunc p xs\n\n    if p x then\n        return (x:passes)\n    else do\n        modify (x:)\n        return passes\n</code></pre>\n\n<p>side cool way to write it even though it\u2019s probably an exercise in state and <a href=\"https://hackage.haskell.org/package/base-4.9.1.0/docs/Data-List.html#v:partition\" rel=\"nofollow noreferrer\"><code>partition</code></a> already exists,</p>\n\n<pre><code>import Data.Bifunctor\n\npartition f = foldr m ([], [])\n    where m x = (if f x then first else second) (x:)\n</code></pre>\n"}], "owner": {"reputation": 63, "user_id": 7817065, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/3857f4980e19b45dae3ebf6c2e4071f1?s=128&d=identicon&r=PG&f=1", "display_name": "78t66", "link": "https://stackoverflow.com/users/7817065/78t66"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 353, "favorite_count": 0, "accepted_answer_id": 43219388, "answer_count": 1, "score": 3, "last_activity_date": 1491354090, "creation_date": 1491346690, "last_edit_date": 1491347512, "question_id": 43219093, "link": "https://stackoverflow.com/questions/43219093/state-monad-modifying-state-without-modifying-value", "title": "State Monad: Modifying state without modifying value", "body": "<p>I am writing a function that takes a predicate <code>p</code> and a list. It \nreturns <code>([value],[state])</code> where the first list contains elements that pass <code>p</code> and the second contains the elements that do not. However, when I run </p>\n\n<pre><code>runState (myFunc even [1,2,3,4,5]) [] \n</code></pre>\n\n<p>I get <code>([2,4,5,3,1],[5,3,1])</code> where the failed elements are incorrectly being stored in <code>[value]</code>. I believe this is due to <code>get</code> updating both state and value, but I haven't been able to find a way to update just the state and leave the value alone so I was wondering how I would do that. </p>\n\n<pre><code>myFunc :: (a-&gt;Bool) -&gt; [a] -&gt; State [a] [a]\nmyFunc _ [] = do\n  a &lt;- get\n  return a\nmyFunc p (x:xs) = do\n    if (p x) then do\n      s &lt;- myFunc p xs\n      let ret = (x:s)\n      return ret\n    else do\n      s &lt;- get\n      put(x:s)\n      myFunc p xs\n</code></pre>\n"}, {"tags": ["haskell", "compiler-errors", "parse-error"], "answers": [{"comments": [{"owner": {"reputation": 25, "user_id": 7817067, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/175b27755fc7fbb74ba83d90573d80ad?s=128&d=identicon&r=PG&f=1", "display_name": "Moe Chong", "link": "https://stackoverflow.com/users/7817067/moe-chong"}, "edited": false, "score": 0, "creation_date": 1491513304, "post_id": 43218955, "comment_id": 73600340, "body": "I fixed numerous errors due to the pointers you provided me. I am still stuck at about 10 unique errors which I can not resolve. I am edited the code I have now above in the original question. Could you please give me more pointers or help me out further, I will be grateful!!!!!"}, {"owner": {"reputation": 1735, "user_id": 2892792, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/5DNyi.jpg?s=128&g=1", "display_name": "Lazersmoke", "link": "https://stackoverflow.com/users/2892792/lazersmoke"}, "reply_to_user": {"reputation": 25, "user_id": 7817067, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/175b27755fc7fbb74ba83d90573d80ad?s=128&d=identicon&r=PG&f=1", "display_name": "Moe Chong", "link": "https://stackoverflow.com/users/7817067/moe-chong"}, "edited": false, "score": 0, "creation_date": 1491518369, "post_id": 43218955, "comment_id": 73602320, "body": "@MoeChong post your errors. Use pastebin if they are very long"}], "tags": [], "owner": {"reputation": 1735, "user_id": 2892792, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/5DNyi.jpg?s=128&g=1", "display_name": "Lazersmoke", "link": "https://stackoverflow.com/users/2892792/lazersmoke"}, "is_accepted": true, "score": 1, "last_activity_date": 1491345936, "creation_date": 1491345936, "answer_id": 43218955, "question_id": 43218769, "link": "https://stackoverflow.com/questions/43218769/haskell-getting-multiple-parse-errors/43218955#43218955", "title": "Haskell - Getting Multiple Parse Errors", "body": "<ul>\n<li><code>module</code> line must be above imports</li>\n<li>Don't need to indent everything after the <code>where</code> on the module line</li>\n<li>Put a blank line between every function/data decl/instance for readability</li>\n<li>Provide a type signature on every function</li>\n<li>Do not wait to compile until you are done writing, you should compile and test incrementally so you can fix design flaws with minimal effort</li>\n<li>Compile with the <code>-Wall</code> flag to give you reasonable suggestions on changes that would improve readability</li>\n</ul>\n\n<p>Once you clean it up into a workable state, you can see what type errors you get and work on fixing those.</p>\n"}], "owner": {"reputation": 25, "user_id": 7817067, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/175b27755fc7fbb74ba83d90573d80ad?s=128&d=identicon&r=PG&f=1", "display_name": "Moe Chong", "link": "https://stackoverflow.com/users/7817067/moe-chong"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 66, "favorite_count": 0, "accepted_answer_id": 43218955, "answer_count": 1, "score": 0, "last_activity_date": 1491513389, "creation_date": 1491345026, "last_edit_date": 1491513389, "question_id": 43218769, "link": "https://stackoverflow.com/questions/43218769/haskell-getting-multiple-parse-errors", "title": "Haskell - Getting Multiple Parse Errors", "body": "<p>I recently completed a snakes and ladder game required for my school but my peer can perfectly compile this code while I get same error over and over again. I have tried many different approaches but I am not quite sure what else to do. </p>\n\n<p>I tried downloading prior versions of Haskell and that did not help. I also installed lens package using \"cabal install lens\" and imported the Control.Lens package using ghci -> import Control.Lens before compiling the program.</p>\n\n<p>When I try compiling the code, I get the following error. File name is Main.hs</p>\n\n<pre><code>ghc -o main Main.hs\n[1 of 1] Compiling Main               ( Main.hs, Main.o )\n\nMain.hs:6:1: parse error on input module\n</code></pre>\n\n<p>I am also attaching my code below. Thank you for anybody willing to help. </p>\n\n<pre><code>module Main where\n\nimport Data.List\nimport Data.Sequence\nimport Data.Foldable\nimport Control.Lens\n\ndata Game = G Int Int Int [Int] [Bool] [Bool] [Bool] [Int] [Property] Int\ndata Property = Int | E | A | D\ndisplayRow game@(G rows cols nplayers pos e a d drolls props turn) n = unlines [ '+' : concat (replicate n \"---+\") , '|' : concat (replicate n \"   |\")]\ndisplay game@(G 0 cols nplayers pos e a d drolls props turn) = \"\"\ndisplay game@(G rows cols nplayers pos e a d drolls props turn) = (displayRow game cols) ++ display (G (rows - 1) cols nplayers pos e a d drolls props turn)\ngo game@(G rows cols nplayers pos e a d drolls props 0) _ = display game\ngo game@(G rows cols nplayers pos e a d drolls props turn) i\n  | elem (rows*cols) pos = display game \n  | nplayers == i = go (G rows cols nplayers pos e a d drolls props (turn - 1)) 0 \n  | otherwise = go (move (G rows cols nplayers pos' e a d (tail drolls) props turn) i roll) (i + 1) where\n    roll = if d!!i then 2*(head drolls) else (head drolls)\nmove (G rows cols nplayers pos e a d drolls props turn) i j = case (elemIndex posij pos) of\n  Just k -&gt; (move (G rows cols nplayers pos' e' a' d' drolls props turn) k 1) \n  Nothing -&gt; (G rows cols nplayers pos' e' a' d' drolls props turn) \n  where\n    posij = if (pos!!i + j) &gt; rows*cols then rows*cols else pos!!i + j \n    pos'\n      | props!!posij &gt; posij = if e!!i then pos &amp; ix i .~ (2*(props!!posij) - posij) else pos &amp; ix i .~ (props!!posij)\n      | props!!posij &lt; posij = if a!!i then pos &amp; ix i .~ posij else pos &amp; ix i .~ (props!!posij)\n      | otherwise = pos &amp; ix i .~ posij\n    e'\n      | props!!posij &gt; posij = if e!!i then e &amp; ix i .~ False else e\n      | props!!posij == E = e &amp; ix i .~ True\n      | otherwise = e\n    a'\n      | props!!posij &lt; posij = if a!!i then a &amp; ix i .~ False else a\n      | props!!posij == A = a &amp; ix i .~ True\n      | otherwise = a\n    d' = if (props!!posij) == D then (d &amp; ix i .~ True) else (d &amp; ix i .~ False)\ninstance Show Game where\n  show game@(G rows cols nplayers pos e a d drolls props turn) = go game 0 \nbuild (l:ls) = build' (G 0 0 0 [] [] [] [] [] [] 0) (l:ls) where\n  build' game (l:ls) = build' (update game l) ls\n  build' game [] = game\n  update (G rows cols nplayers pos e a d drolls props turn) s = case (words s) of\n                    \"board\":l -&gt; G (nums!!0) (nums!!1) nplayers pos e a d drolls [i | i &lt;- [0..(nums!!0)*(nums!!1)]] turn\n                    \"players\":l -&gt; G rows cols (nums!!0) [0 | _ &lt;- [1..(nums!!0)]] [False | _ &lt;- [1..(nums!!0)]] [False | _ &lt;- [1..(nums!!0)]] [False | _ &lt;- [1..(nums!!0)]] drolls props turn\n                    \"dice\":l -&gt; G rows cols nplayers pos e a d (cycle nums) props turn\n                    \"ladder\":l -&gt; G rows cols nplayers pos e a d drolls (props &amp; ix (nums!!0) .~ (nums!!1)) turn\n                    \"snake\":l -&gt; G rows cols nplayers pos e a d drolls (props &amp; ix (nums!!0) .~ (nums!!1)) turn\n                    \"powerup\":\"escalator\":l -&gt; G rows cols nplayers pos e a d drolls (over (elements (flip elem nums)) (const E) props) turn\n                    \"powerup\":\"antivenom\":l -&gt; G rows cols nplayers pos e a d drolls (over (elements (flip elem nums)) (const A) props) turn\n                    \"powerup\":\"double\":l -&gt; G rows cols nplayers pos e a d drolls (over (elements (flip elem nums)) (const D) props) turn\n                    \"turns\":l -&gt; G rows cols nplayers pos e a d nums props (turn + (nums!!0)) where\n                      nums = map read l :: [Int]\nreadFrom input = build (lines input)\nmain = do\n  input &lt;- getContents\n  putStr $ show $ readFrom input\n</code></pre>\n"}, {"tags": ["haskell"], "comments": [{"owner": {"reputation": 100892, "user_id": 745903, "user_type": "registered", "accept_rate": 74, "profile_image": "https://www.gravatar.com/avatar/50933f6638836741e620669b3940410e?s=128&d=identicon&r=PG", "display_name": "leftaroundabout", "link": "https://stackoverflow.com/users/745903/leftaroundabout"}, "edited": false, "score": 1, "creation_date": 1491339732, "post_id": 43217494, "comment_id": 73506482, "body": "Could you give some C++ code illustrating what exactly you mean by \u201cshared variable\u201d here, how you intend to use it?"}], "answers": [{"comments": [{"owner": {"reputation": 1735, "user_id": 2892792, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/5DNyi.jpg?s=128&g=1", "display_name": "Lazersmoke", "link": "https://stackoverflow.com/users/2892792/lazersmoke"}, "edited": false, "score": 0, "creation_date": 1491344542, "post_id": 43218356, "comment_id": 73508611, "body": "This works, and will give you the shared state you are looking for, but it is definitely an anti-pattern if you don&#39;t actually need multiple threads. I think OP should adapt to FP patterns because they will produce cleaner and more idiomatic code. It&#39;s <i>much</i> better to use a <code>StateT GameState</code> or similar than to pass around MVars and pollute your entire codebase with <code>IO</code>. <a href=\"http://stackoverflow.com/questions/43215607/why-this-haskell-code-cannot-be-compiled\">Extremely relevant previous question</a>"}], "tags": [], "owner": {"reputation": 100185, "user_id": 3234959, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/93bb12ca0f93dfddb33880316f7e66c2?s=128&d=identicon&r=PG&f=1", "display_name": "chi", "link": "https://stackoverflow.com/users/3234959/chi"}, "is_accepted": false, "score": 1, "last_activity_date": 1491343258, "last_edit_date": 1491343258, "creation_date": 1491342829, "answer_id": 43218356, "question_id": 43217494, "link": "https://stackoverflow.com/questions/43217494/how-to-create-a-share-variables-in-haskell/43218356#43218356", "title": "How to create a share variables in Haskell?", "body": "<p>Usually, such variables are created in <code>main</code>, or another IO action.</p>\n\n<pre><code>main = do\n   chan &lt;- newEmptyMVar\n   startTimer &lt;- newEmptyMVar\n   ...\n   forkIO $ userThread chan\n   forkIO $ processThread startTimer\n   ...\n</code></pre>\n\n<p>There are some ways to declare \"global variables\" (mostly <code>IORef</code>s and <code>MVar</code>s), but they involve unsafe functions, and are best to be avoided, especially by beginners. Such globals are mostly unnecessary, and it's often better to pass a few arguments around, even if it requires more typing.</p>\n\n<p>In more advanced code, one might use a <code>ReaderT r IO</code> monad to reduce the verbosity of the code which simply passes the <code>MVar</code>s around. But at the beginning, passing variables around is fine.</p>\n"}], "owner": {"reputation": 13, "user_id": 7816375, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/45539f0a6dea1751db198c6cd6dd2eca?s=128&d=identicon&r=PG&f=1", "display_name": "Thucsgsu", "link": "https://stackoverflow.com/users/7816375/thucsgsu"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 120, "favorite_count": 0, "answer_count": 1, "score": 1, "last_activity_date": 1491343258, "creation_date": 1491339147, "question_id": 43217494, "link": "https://stackoverflow.com/questions/43217494/how-to-create-a-share-variables-in-haskell", "title": "How to create a share variables in Haskell?", "body": "<p>I'm new for Haskell. Recently, I was trying to create a game by Haskell. In that game, I use Concurrent to create multiple threads. </p>\n\n<pre><code>data Msg = C Char | Time\n\nforkIO $ userThread chan\nforkIO $ processThread startTimer\n\nuserThread :: MVar Msg -&gt; IO ()\nuserThread chan = forever $ do\n  c &lt;- getChar\n  putMVar chan (C c)\n  showStr(show c)\n\nprocessThread :: MVar Msg -&gt; IO ()\nprocessThread chan = forever $ do\n  threadDelay (startTimer)\n  putMVar chan (Time)\n</code></pre>\n\n<p>I don't know how to define any other data shared between threads. Can I define a variable like C++ (static double xxx) and be visited by any function?</p>\n"}, {"tags": ["haskell", "yesod"], "answers": [{"tags": [], "owner": {"reputation": 43759, "user_id": 1651941, "user_type": "registered", "accept_rate": 97, "profile_image": "https://www.gravatar.com/avatar/a513bc1fa519d2fcf5e4e0d9b5500101?s=128&d=identicon&r=PG", "display_name": "Sibi", "link": "https://stackoverflow.com/users/1651941/sibi"}, "is_accepted": true, "score": 2, "last_activity_date": 1491342546, "creation_date": 1491342546, "answer_id": 43218293, "question_id": 43217467, "link": "https://stackoverflow.com/questions/43217467/yesod-button-click-handler/43218293#43218293", "title": "Yesod button click Handler", "body": "<blockquote>\n  <p>I don't want to have a route /deletetable just for this purpose.</p>\n</blockquote>\n\n<p>At the end of the day, you do have to create a yesod handler to drop your table from the database. How are you gonna do that without having a route for that ?</p>\n\n<p>One way of doing this generically would be to have some route like this:</p>\n\n<pre><code>/table/#Text TableR DELETE\n</code></pre>\n\n<p>where the <code>Text</code> corresponds to the table name. Now you can create a generic handler named <code>deleteTableR</code> to delete different tables using different buttons.</p>\n"}], "owner": {"reputation": 5139, "user_id": 705510, "user_type": "registered", "accept_rate": 89, "profile_image": "https://i.stack.imgur.com/7xrNQ.png?s=128&g=1", "display_name": "McBear Holden", "link": "https://stackoverflow.com/users/705510/mcbear-holden"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 142, "favorite_count": 0, "accepted_answer_id": 43218293, "answer_count": 1, "score": 0, "last_activity_date": 1491342546, "creation_date": 1491339049, "question_id": 43217467, "link": "https://stackoverflow.com/questions/43217467/yesod-button-click-handler", "title": "Yesod button click Handler", "body": "<p>I want to create a button to delete a database table.\nIn Yesod, do I need to first create a </p>\n\n<pre><code>&lt;form action=@{DeleteTableR}&gt;\n &lt;button method=post&gt;\n</code></pre>\n\n<p>and use <code>yesod add-handler</code> to create a handler?\nIs this the common pratice?</p>\n\n<p>I don't want to have a route <code>/deletetable</code> just for this purpose.</p>\n"}, {"tags": ["haskell", "intero"], "comments": [{"owner": {"reputation": 1735, "user_id": 2892792, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/5DNyi.jpg?s=128&g=1", "display_name": "Lazersmoke", "link": "https://stackoverflow.com/users/2892792/lazersmoke"}, "edited": false, "score": 0, "creation_date": 1491337295, "post_id": 43216219, "comment_id": 73505184, "body": "Please post your <code>project.cabal</code> file and <code>stack.yaml</code>. You probably need to rename the <code>project</code> section to <code>intero</code> or something like that. The error seems to indicate that whichever section <code>intero</code> is in your cabal file doesn&#39;t list <code>Lib</code>."}], "answers": [{"tags": [], "owner": {"reputation": 34158, "user_id": 7203016, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/ybAMw.png?s=128&g=1", "display_name": "K. A. Buhr", "link": "https://stackoverflow.com/users/7203016/k-a-buhr"}, "is_accepted": true, "score": 1, "last_activity_date": 1491362755, "creation_date": 1491362755, "answer_id": 43221269, "question_id": 43216219, "link": "https://stackoverflow.com/questions/43216219/intero-failed-to-load-interface-for-lib/43221269#43221269", "title": "Intero : Failed to load interface for Lib", "body": "<p>I don't have experience with Haskero but can duplicate the problem with a plain old Intero installation on a Linux machine.</p>\n\n<p>The issue is that you're invoking the Intero backend via <code>stack exec</code> instead of <code>stack ghci</code>.  You would observe the same problem if you tried using <code>stack exec ghci</code> instead of <code>stack ghci</code> to invoke a usual GHC interactive session (see the <a href=\"https://docs.haskellstack.org/en/stable/ghci/\" rel=\"nofollow noreferrer\">documentation for <code>stack ghci</code></a> for more information).</p>\n\n<p>Instead of <code>stack exec intero</code>, try:</p>\n\n<pre><code>stack ghci --with-ghc intero --no-build --no-load\n</code></pre>\n\n<p>and it should work okay.</p>\n\n<p>(Note that <code>stack exec intero</code> actually works okay if you <code>stack build</code> your project first, but the interactive session is still supposed to be invoked via <code>stack ghci</code>.)</p>\n"}, {"tags": [], "owner": {"reputation": 71, "user_id": 3874542, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/KW1st.jpg?s=128&g=1", "display_name": "Adam Szlachta", "link": "https://stackoverflow.com/users/3874542/adam-szlachta"}, "is_accepted": false, "score": 2, "last_activity_date": 1504482218, "creation_date": 1504482218, "answer_id": 46028737, "question_id": 43216219, "link": "https://stackoverflow.com/questions/43216219/intero-failed-to-load-interface-for-lib/46028737#46028737", "title": "Intero : Failed to load interface for Lib", "body": "<p>I had similar issue occuring in Visual Studio Code.</p>\n\n<p>Under the hood Haskero properly uses:</p>\n\n<p><code>stack ghci --with-ghc intero --no-build --no-load</code> </p>\n\n<p>However Haskero assumes that the stack project is the working directory loaded to VSCode. If instead the stack project is one of the subdirectories then the same error appears in IDE, because stack command is run from that main directory. At least it's what happens currently with Haskero 1.3.1.</p>\n\n<p>The solution is to always make sure that stack project is equal to working directory in VSCode.</p>\n"}], "owner": {"reputation": 1069, "user_id": 5923374, "user_type": "registered", "accept_rate": 67, "profile_image": "https://www.gravatar.com/avatar/bd4f47d4ba513ba8ed316520a12f94a9?s=128&d=identicon&r=PG&f=1", "display_name": "Ford O.", "link": "https://stackoverflow.com/users/5923374/ford-o"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 1198, "favorite_count": 1, "accepted_answer_id": 43221269, "answer_count": 2, "score": 4, "last_activity_date": 1504482218, "creation_date": 1491334691, "last_edit_date": 1491448388, "question_id": 43216219, "link": "https://stackoverflow.com/questions/43216219/intero-failed-to-load-interface-for-lib", "title": "Intero : Failed to load interface for Lib", "body": "<p>I am trying to setup my Haskero (Visual Studio Code extension that uses Intero) for my Haskell project, yet I get the following error : </p>\n\n<pre><code>app\\Main.hs:3:1: error:\n   Failed to load interface for `Lib'\n   Use -v to see a list of the files searched for.\n</code></pre>\n\n<p>Steps to reproduce:</p>\n\n<pre><code>stack new project\ncd project\nstack build intero\nstack exec intero\n&gt; :l app/Main.hs\n</code></pre>\n\n<p>app/Main.hs :</p>\n\n<pre><code>module Main where\n\nimport Lib\n\nmain :: IO ()\nmain = someFunc\n</code></pre>\n\n<p>src/Lib.hs :</p>\n\n<pre><code>module Lib\n   ( someFunc\n   ) where\n\nsomeFunc :: IO ()\nsomeFunc = putStrLn \"someFunc\"\n</code></pre>\n"}, {"tags": ["haskell"], "comments": [{"owner": {"reputation": 45741, "user_id": 744178, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/a3193139ea494c45e63752504f5ff1f2?s=128&d=identicon&r=PG", "display_name": "jwodder", "link": "https://stackoverflow.com/users/744178/jwodder"}, "edited": false, "score": 2, "creation_date": 1491332954, "post_id": 43215607, "comment_id": 73502828, "body": "What error message do you get when you try to compile the code?"}, {"owner": {"reputation": 8268, "user_id": 7602518, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/9ddcddc4afafdfc5603b2473b191c74f?s=128&d=identicon&r=PG", "display_name": "Pedro Castilho", "link": "https://stackoverflow.com/users/7602518/pedro-castilho"}, "edited": false, "score": 4, "creation_date": 1491333040, "post_id": 43215607, "comment_id": 73502870, "body": "Hi, Jason, and welcome to Stack Overflow.  Although you&#39;ve explained well what your problem is, it&#39;ll probably be difficult for you to get a good answer because your code is relatively large, and it will take a while for anyone who could answer to even go through it and find the parts that could be causing the problem.  You should do some tests yourself, find which parts of the code are more likely to be causing issues, and then update your question with a <a href=\"https://stackoverflow.com/help/mcve\">Minimal, Complete and Verifiable Example</a>. That will help ensure you get quality answers."}, {"owner": {"reputation": 21, "user_id": 7816315, "user_type": "registered", "profile_image": "https://graph.facebook.com/199831907178448/picture?type=large", "display_name": "Jason", "link": "https://stackoverflow.com/users/7816315/jason"}, "edited": false, "score": 0, "creation_date": 1491333156, "post_id": 43215607, "comment_id": 73502923, "body": "Thanks, the error is &quot;test.hs:36:3: error: parse error on input \u2018Event\u2019&quot;."}, {"owner": {"reputation": 936, "user_id": 4884579, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/b0fca1fac3b94fed8f0291116e9b4ef6?s=128&d=identicon&r=PG&f=1", "display_name": "Erik", "link": "https://stackoverflow.com/users/4884579/erik"}, "edited": false, "score": 2, "creation_date": 1491333603, "post_id": 43215607, "comment_id": 73503188, "body": "In the future, please include enough code (including imports) to allow others to try compiling your code themselves. That said, I suspect the issue may be due to improper use of if-statements. Every if-statement must be structured like <code>if &lt;condition&gt; then &lt;value&gt; else &lt;value&gt;</code>. I see 2 if-statements in the <code>mainloop</code> function that are not set up this way."}], "answers": [{"comments": [{"owner": {"reputation": 1735, "user_id": 2892792, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/5DNyi.jpg?s=128&g=1", "display_name": "Lazersmoke", "link": "https://stackoverflow.com/users/2892792/lazersmoke"}, "edited": false, "score": 0, "creation_date": 1491337396, "post_id": 43216169, "comment_id": 73505240, "body": "While correct, this is not the problem. You could match against the data constructor <code>Event</code> in a do-notation bind."}], "tags": [], "owner": {"reputation": 62421, "user_id": 216164, "user_type": "registered", "accept_rate": 89, "profile_image": "https://www.gravatar.com/avatar/786f224adbe0784cdf7d0f15476061fe?s=128&d=identicon&r=PG", "display_name": "Thomas M. DuBuisson", "link": "https://stackoverflow.com/users/216164/thomas-m-dubuisson"}, "is_accepted": false, "score": 1, "last_activity_date": 1491334535, "creation_date": 1491334535, "answer_id": 43216169, "question_id": 43215607, "link": "https://stackoverflow.com/questions/43215607/why-this-haskell-code-cannot-be-compiled/43216169#43216169", "title": "Why this haskell code cannot be compiled", "body": "<p>Variable  names can not begin with uppercase letters, such as <code>Event</code>.  Try renaming the variable to something like <code>event</code>.</p>\n"}, {"tags": [], "owner": {"reputation": 1735, "user_id": 2892792, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/5DNyi.jpg?s=128&g=1", "display_name": "Lazersmoke", "link": "https://stackoverflow.com/users/2892792/lazersmoke"}, "is_accepted": false, "score": 0, "last_activity_date": 1491338397, "last_edit_date": 1491338397, "creation_date": 1491337879, "answer_id": 43217148, "question_id": 43215607, "link": "https://stackoverflow.com/questions/43215607/why-this-haskell-code-cannot-be-compiled/43217148#43217148", "title": "Why this haskell code cannot be compiled", "body": "<p>In Haskell, all <code>if ... then ... else</code> blocks must have all their components; what would the result be otherwise?</p>\n\n<p>The problem is that the compiler was expecting an <code>else</code>, but it actually got <code>Event</code>. That said, you have more problems than a simple parse error. <code>return</code> does not do what you think it does. For example, this code will print <code>hi</code>.</p>\n\n<pre><code>main = do\n  return ()\n  putStrLn \"hi\"\n</code></pre>\n\n<p>The <code>return</code> function simply lifts a value into a monad, it doesn't stop the computation or anything like that. Here is what your probably want to have:</p>\n\n<pre><code>...\nif length unmatchedDigits &gt;= 10 \n  then return False\n  else do\n    Event &lt;- readChan c\n    if Event == \"timer\"\n      then ...\n      else ...\n</code></pre>\n\n<p>This way, nothing happens after the if block, so the function just ends there, with the last value as <code>False</code> (if <code>length unmatchedDigits &gt;= 10</code>) or continues on properly (if <code>length unmatchedDigits &lt; 10</code>).</p>\n\n<p>You also almost certainly don't want to use <code>Event</code> (uppercase E), because that would mean it is a data constructor. You probably meant <code>event</code> (lowercase e), which is just an ordinary variable name.</p>\n\n<p>Additionally: This is very, very non-idiomatic Haskell. You <em>definitely</em> don't need MVars in this situation, and <em>certainly</em> not four of them. <code>Chan</code>s are not the same thing as <code>MVar</code>s, and you don't need either one unless you are doing heavy-duty multi-threading. I <em>highly</em> recommend you completely rewrite this and try to minimize the amount of code that uses <code>IO</code> (it should be maybe 10-15 lines of <code>IO</code> code in this example, probably less).</p>\n\n<p>This is not Java; you don't need to name your variables in your type signature (<code>Chan msgChan -&gt; Int delay ()</code>), nor do you need to write wrapper functions for standard library functions to monomorphize their type. <code>testGuessedNumber</code> is <em>literally the same function as</em> <code>(==)</code>.</p>\n\n<p>You will have much more success if you revisit basic, pure function syntax and understand how problems are solved in Haskell than with trying to emulate another language. Read some <a href=\"http://learnyouahaskell.com/chapters\" rel=\"nofollow noreferrer\">LYAH</a> or <a href=\"http://book.realworldhaskell.org/read/\" rel=\"nofollow noreferrer\">Real World Haskell</a>.</p>\n"}], "owner": {"reputation": 21, "user_id": 7816315, "user_type": "registered", "profile_image": "https://graph.facebook.com/199831907178448/picture?type=large", "display_name": "Jason", "link": "https://stackoverflow.com/users/7816315/jason"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 177, "favorite_count": 0, "answer_count": 2, "score": 0, "last_activity_date": 1491338397, "creation_date": 1491332694, "last_edit_date": 1491333772, "question_id": 43215607, "link": "https://stackoverflow.com/questions/43215607/why-this-haskell-code-cannot-be-compiled", "title": "Why this haskell code cannot be compiled", "body": "<p>I was trying to compile a haskell game code, this code generates three thread, one for infinite loop, one for collecting user's interaction, one for triggering the events. However, the code cannot be compiled and I don't know why.</p>\n\n<p>Here's the code:</p>\n\n<pre><code>module Main where\n\nimport Control.Concurrent\nimport Control.Monad\nimport System.IO\nimport System.Random\nimport Text.Printf\n\ndata Msg = C Char | Time\ndata Event = C Char | Time Char\n\nmain :: IO ()\nmain = do\n  hSetBuffering stdout NoBuffering\n  hSetBuffering stdin NoBuffering\n  hSetEcho stdin False\n\n  -- shared resources\n  chan &lt;- newEmptyMVar\n  removedDigits &lt;- newEmptyMVar\n  unmatchedDigits &lt;- newEmptyMVar\n  numberOfGuesses &lt;- newEmptyMVar\n\n  --starting the generating thread and the user thread\n  forkIO $ generatingThread chan\n  forkIO $ userThread chan\n\n  --the main loop\n  if mainloop chan == True then \"Congratulations! You won!\" else \"Better luck next time!\"\n  return()\n\n  mainloop :: Chan c -&gt; Bool\n  let mainloop = do\n  if length unmatchedDigits &gt;= 10 \n    then return False\n  Event &lt;- readChan c\n  if Event == \"timer\"\n    then unmatchedDigits ++ param\n    else if testGuessedNumber param unmatchedDigits == True \n      then \n        removeMatchedDigit \n        if length unmatchedDigits == 0\n        then return True\n  mainloop c\n\n-- Generating Thread aka event thread generating the random numbers \ngeneratingThread :: Chan msgChan -&gt; IO ()\ngeneratingThread msgChan = forever $ do\n  publishTimerEvent msgChan 1000000\n\npublishTimerEvent :: Chan msgChan -&gt; Int delay ()\npublishTimerEvent msgChan = do\n  c &lt;- getRandomChar\n  putMVar msgChan (\"timer\" c)\n  threadDelay newDelay\n  velocity &lt;- 0.9\n  if delay * velocity &lt; 100\n    then newDelay &lt;- 100\n    else newDelay &lt;- delay * velocity\n  publishTimerEvent msgChan newDelay\n\ngetRandomChar :: Char c ()\ngetRandomChar = do\n  i &lt;- randomRIO (0,9)\n  let c = \"0123456789\" !! i\n  return c\n\n-- User Thread\nuserThread :: MVar Msg -&gt; IO ()\nuserThread chan = forever $ do\n  c &lt;- getChar\n  putMVar chan (C c)\n  showStr(show c)\n\ntestGuessedNumber :: Int -&gt; Int -&gt; Bool\ntestGuessedNumber a b\n    | a == b    = True\n    | otherwise = False\n\n-- Shows the given string at the left edge of the current terminal line after\n-- having blanked out the first 20 characters on that line.\nshowStr :: String -&gt; IO ()\nshowStr s = putStr (\"\\r\" ++ replicate 20 ' ' ++ \"\\r\" ++ s)\n</code></pre>\n\n<p>The error is \"test.hs:36:3: error: parse error on input \u2018Event\u2019\"</p>\n"}, {"tags": ["haskell", "ghc"], "comments": [{"owner": {"reputation": 29444, "user_id": 3072788, "user_type": "registered", "accept_rate": 82, "profile_image": "https://www.gravatar.com/avatar/220a45c2fcff7e7358d144551b116205?s=128&d=identicon&r=PG&f=1", "display_name": "Alec", "link": "https://stackoverflow.com/users/3072788/alec"}, "edited": false, "score": 0, "creation_date": 1491333683, "post_id": 43215476, "comment_id": 73503232, "body": "Just curious: why not just use singletons?"}, {"owner": {"reputation": 21417, "user_id": 925978, "user_type": "registered", "accept_rate": 84, "profile_image": "https://www.gravatar.com/avatar/06e4467a5bd1538a92cefb20db07897a?s=128&d=identicon&r=PG&f=1", "display_name": "crockeea", "link": "https://stackoverflow.com/users/925978/crockeea"}, "reply_to_user": {"reputation": 29444, "user_id": 3072788, "user_type": "registered", "accept_rate": 82, "profile_image": "https://www.gravatar.com/avatar/220a45c2fcff7e7358d144551b116205?s=128&d=identicon&r=PG&f=1", "display_name": "Alec", "link": "https://stackoverflow.com/users/3072788/alec"}, "edited": false, "score": 0, "creation_date": 1491334713, "post_id": 43215476, "comment_id": 73503836, "body": "I&#39;m already using singletons in a wrapper around my <code>Nat</code> value, so it&#39;d be no trouble at all, if you want to suggest an approach."}, {"owner": {"reputation": 13807, "user_id": 2407038, "user_type": "registered", "accept_rate": 64, "profile_image": "https://www.gravatar.com/avatar/538f6f4a9aa43841841de7d8e8b169fc?s=128&d=identicon&r=PG&f=1", "display_name": "user2407038", "link": "https://stackoverflow.com/users/2407038/user2407038"}, "edited": false, "score": 0, "creation_date": 1491349325, "post_id": 43215476, "comment_id": 73510071, "body": "The problem is <code>Proxy :: Proxy t</code>, but you want <code>_Z :: Proxy &#39;Z</code> - so just define such a constant yourself. If you really must move this work to <code>getValue</code>, then you can use instance overlap to instantiate &quot;free&quot; type variables to <code>&#39;Z</code>, but it really isn&#39;t worth it."}, {"owner": {"reputation": 21417, "user_id": 925978, "user_type": "registered", "accept_rate": 84, "profile_image": "https://www.gravatar.com/avatar/06e4467a5bd1538a92cefb20db07897a?s=128&d=identicon&r=PG&f=1", "display_name": "crockeea", "link": "https://stackoverflow.com/users/925978/crockeea"}, "reply_to_user": {"reputation": 13807, "user_id": 2407038, "user_type": "registered", "accept_rate": 64, "profile_image": "https://www.gravatar.com/avatar/538f6f4a9aa43841841de7d8e8b169fc?s=128&d=identicon&r=PG&f=1", "display_name": "user2407038", "link": "https://stackoverflow.com/users/2407038/user2407038"}, "edited": false, "score": 0, "creation_date": 1491359415, "post_id": 43215476, "comment_id": 73512358, "body": "@user2407038 Not sure what you mean by &quot;the problem is <code>Proxy::Proxy t</code>&quot;. There&#39;s no need to define any values if I use type applications."}, {"owner": {"reputation": 13807, "user_id": 2407038, "user_type": "registered", "accept_rate": 64, "profile_image": "https://www.gravatar.com/avatar/538f6f4a9aa43841841de7d8e8b169fc?s=128&d=identicon&r=PG&f=1", "display_name": "user2407038", "link": "https://stackoverflow.com/users/2407038/user2407038"}, "edited": false, "score": 0, "creation_date": 1491490796, "post_id": 43215476, "comment_id": 73586326, "body": "@crockeea If the type of <code>foo</code> was <code>Proxy (S (S Z))</code> you would have no problem. So give it this type, by defining it as <code>op (op (Proxy :: Proxy &#39;Z))</code> instead of <code>op (op (Proxy :: Proxy t))</code>. Then, presumably, you do not want to have to specify the type everywhere, so you define a constant <code>_Z :: Proxy &#39;Z</code> to save yourself some typing."}, {"owner": {"reputation": 21417, "user_id": 925978, "user_type": "registered", "accept_rate": 84, "profile_image": "https://www.gravatar.com/avatar/06e4467a5bd1538a92cefb20db07897a?s=128&d=identicon&r=PG&f=1", "display_name": "crockeea", "link": "https://stackoverflow.com/users/925978/crockeea"}, "reply_to_user": {"reputation": 13807, "user_id": 2407038, "user_type": "registered", "accept_rate": 64, "profile_image": "https://www.gravatar.com/avatar/538f6f4a9aa43841841de7d8e8b169fc?s=128&d=identicon&r=PG&f=1", "display_name": "user2407038", "link": "https://stackoverflow.com/users/2407038/user2407038"}, "edited": false, "score": 0, "creation_date": 1491507185, "post_id": 43215476, "comment_id": 73596857, "body": "@user2407038 Point taken. An even easier way is to just put the <code>&#39;Z</code> in the types signature. The point, however, (possibly not obvious in my simplified example) is to keep <code>foo</code> polymorphic so that it can continue to be composed with other subexpressions."}], "answers": [{"comments": [{"owner": {"reputation": 21417, "user_id": 925978, "user_type": "registered", "accept_rate": 84, "profile_image": "https://www.gravatar.com/avatar/06e4467a5bd1538a92cefb20db07897a?s=128&d=identicon&r=PG&f=1", "display_name": "crockeea", "link": "https://stackoverflow.com/users/925978/crockeea"}, "edited": false, "score": 0, "creation_date": 1491340041, "post_id": 43216939, "comment_id": 73506639, "body": "I figure your first line couldn&#39;t possible work, could it? We&#39;d have to tell the compiler that <code>getValue</code>s argument can take a type application. What is the type of your <code>getValue</code>?"}, {"owner": {"reputation": 21417, "user_id": 925978, "user_type": "registered", "accept_rate": 84, "profile_image": "https://www.gravatar.com/avatar/06e4467a5bd1538a92cefb20db07897a?s=128&d=identicon&r=PG&f=1", "display_name": "crockeea", "link": "https://stackoverflow.com/users/925978/crockeea"}, "edited": false, "score": 2, "creation_date": 1491340161, "post_id": 43216939, "comment_id": 73506700, "body": "The point here is not to reflect the value of a <code>Nat</code> (that&#39;s just an example). The point is to provide an input to a type function automatically when calling <code>getValue</code>. Your first approach would do the trick, if it indeed compiles."}, {"owner": {"reputation": 1735, "user_id": 2892792, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/5DNyi.jpg?s=128&g=1", "display_name": "Lazersmoke", "link": "https://stackoverflow.com/users/2892792/lazersmoke"}, "reply_to_user": {"reputation": 21417, "user_id": 925978, "user_type": "registered", "accept_rate": 84, "profile_image": "https://www.gravatar.com/avatar/06e4467a5bd1538a92cefb20db07897a?s=128&d=identicon&r=PG&f=1", "display_name": "crockeea", "link": "https://stackoverflow.com/users/925978/crockeea"}, "edited": false, "score": 0, "creation_date": 1491343611, "post_id": 43216939, "comment_id": 73508208, "body": "@crockeea Your problem appears to be the specific case of the more general &quot;How to make <code>f x y</code> always use some specific <code>y</code> instead of taking it as an argument?&quot; The answer is to make a function <code>f&#39; x = f x someFixedY</code>. You might have to add an explicit <code>forall</code>: <code>getValue&#39; :: forall (n :: Nat). Int</code>. You just move the type argument from a value level proxy lambda to a type level uppercase lambda."}, {"owner": {"reputation": 29444, "user_id": 3072788, "user_type": "registered", "accept_rate": 82, "profile_image": "https://www.gravatar.com/avatar/220a45c2fcff7e7358d144551b116205?s=128&d=identicon&r=PG&f=1", "display_name": "Alec", "link": "https://stackoverflow.com/users/3072788/alec"}, "edited": false, "score": 0, "creation_date": 1491346661, "post_id": 43216939, "comment_id": 73509327, "body": "@Lazersmoke Note that <code>getValue foo</code> won&#39;t compile. I think this answer is missing the point of the question - the signature of <code>getValue</code> you propose won&#39;t help. <code>forall p. Proxy p</code> obliterates any hope of recovering the &quot;at least two&quot; nature of <code>foo</code>. I reckon the real answer to this question is &quot;this isn&#39;t possible&quot;."}], "tags": [], "owner": {"reputation": 1735, "user_id": 2892792, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/5DNyi.jpg?s=128&g=1", "display_name": "Lazersmoke", "link": "https://stackoverflow.com/users/2892792/lazersmoke"}, "is_accepted": false, "score": -2, "last_activity_date": 1491343950, "last_edit_date": 1491343950, "creation_date": 1491337140, "answer_id": 43216939, "question_id": 43215476, "link": "https://stackoverflow.com/questions/43215476/how-to-provide-input-to-an-injective-type-function/43216939#43216939", "title": "How to provide input to an injective type function", "body": "<p>Rename your <code>getValue</code> to <code>getValue'</code> and write <code>getValue foo = getValue' $ foo @'Z</code>. </p>\n\n<pre><code>getValue :: (forall (d :: Nat). Proxy d) -&gt; Int\ngetValue foo = getValue' $ foo @'Z\n\ngetValue' :: Proxy (d :: Nat) -&gt; Int\ngetValue' Proxy = ...\n</code></pre>\n\n<p>Here's a better way to reify natural numbers if that is your end goal:</p>\n\n<pre><code>class ReifyNat (n :: Nat) where\n  reifyNat :: Integer\n\ninstance ReifyNat 'Z where\n  reifyNat = 0\n\ninstance ReifyNat n =&gt; ReifyNat ('S n) where\n  reifyNat = succ (reifyNat @n)\n\ngetValue :: forall n. ReifyNat n =&gt; Proxy n -&gt; Integer\ngetValue _ = reifyNat @n\n</code></pre>\n\n<p>Or just use:</p>\n\n<pre><code>getValue :: forall n. ReifyNat n =&gt; Integer\ngetValue = reifyNat\n</code></pre>\n\n<p>You can probably get rid of <em>all</em> your uses of <code>Proxy</code> in this way if you wish.</p>\n"}], "owner": {"reputation": 21417, "user_id": 925978, "user_type": "registered", "accept_rate": 84, "profile_image": "https://www.gravatar.com/avatar/06e4467a5bd1538a92cefb20db07897a?s=128&d=identicon&r=PG&f=1", "display_name": "crockeea", "link": "https://stackoverflow.com/users/925978/crockeea"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 84, "favorite_count": 0, "answer_count": 1, "score": 1, "last_activity_date": 1491343950, "creation_date": 1491332231, "question_id": 43215476, "link": "https://stackoverflow.com/questions/43215476/how-to-provide-input-to-an-injective-type-function", "title": "How to provide input to an injective type function", "body": "<p>In my application, I'm building up an expression whose type is an (injective) function of some parameter <code>d</code>. For example:</p>\n\n<pre><code>op :: Proxy d -&gt; Proxy ('S d)\nop _ = Proxy\n\nfoo :: forall d . Proxy ('S ('S d))\nfoo = op $ op Proxy\n</code></pre>\n\n<p>After I've built up an expression like <code>foo</code>, I'd like to interpret it:</p>\n\n<pre><code>getValue :: Proxy (d :: Nat) -&gt; Int\ngetValue _ = ...\n</code></pre>\n\n<p>To interpret <code>foo</code>, I could call <code>getValue $ foo @'Z</code>, using type-applications syntax. That's just fine, except my intent is to always call <code>getValue</code> with this pattern. Thus rather than making the <em>user</em> always have to specify that their expression is relative to <code>'Z</code>, I'd prefer it if this property were instead inherent in <code>getValue</code>, so that I can write <code>getValue foo</code> and would presumably get back <code>2</code>. </p>\n\n<p>NB: One solution is to make the input to the function input explicit with a <code>Proxy</code>: <code>foo :: Proxy d -&gt; Proxy ('S ('S d))</code> and <code>getValue :: (Proxy d1 -&gt; Proxy d2) -&gt; Int</code>, and then have <code>getValue</code> apply the function to <code>'Z</code>. This achieves what I want, but the extra <code>Proxy</code> is annoying. Is there a way that does not require this extra <code>Proxy</code>?</p>\n"}, {"tags": ["haskell", "binary-tree", "fold"], "comments": [{"owner": {"reputation": 133611, "user_id": 152602, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/7f370b4bd787fc68f9f62d9c6781cb79?s=128&d=identicon&r=PG", "display_name": "Lee", "link": "https://stackoverflow.com/users/152602/lee"}, "edited": false, "score": 1, "creation_date": 1491330960, "post_id": 43215033, "comment_id": 73501753, "body": "The function you need to pass to <code>foldB</code> takes 3 parameters, while <code>(+)</code> only takes two."}], "answers": [{"comments": [{"owner": {"reputation": 327, "user_id": 5110438, "user_type": "registered", "accept_rate": 46, "profile_image": "https://www.gravatar.com/avatar/0cbba6c8f6f196e3e367e378ca1f418a?s=128&d=identicon&r=PG&f=1", "display_name": "Stinkidog", "link": "https://stackoverflow.com/users/5110438/stinkidog"}, "edited": false, "score": 0, "creation_date": 1491332231, "post_id": 43215269, "comment_id": 73502460, "body": "Thank you for the clarity of your answer. I&#39;m still new to functional programming and it&#39;s easy to get thrown off by the types"}], "tags": [], "owner": {"reputation": 179940, "user_id": 20713, "user_type": "registered", "accept_rate": 80, "profile_image": "https://www.gravatar.com/avatar/09b9758a4a83cc25547eb93891f19df7?s=128&d=identicon&r=PG", "display_name": "ephemient", "link": "https://stackoverflow.com/users/20713/ephemient"}, "is_accepted": true, "score": 1, "last_activity_date": 1491331978, "last_edit_date": 1491331978, "creation_date": 1491331627, "answer_id": 43215269, "question_id": 43215033, "link": "https://stackoverflow.com/questions/43215033/binary-tree-fold-functions/43215269#43215269", "title": "Binary Tree Fold Functions", "body": "<p>The error comes about from trying to use</p>\n\n<pre><code>(+) :: (Num a) =&gt; a -&gt; a -&gt; a\n</code></pre>\n\n<p>as a parameter with type</p>\n\n<pre><code>(x -&gt; u -&gt; u -&gt; u)\n</code></pre>\n\n<p>If you start trying to fit it in, remembering that <code>(x -&gt; u -&gt; u -&gt; u)</code> is the same as <code>(x -&gt; (u -&gt; (u -&gt; u)))</code>,</p>\n\n<pre><code>x == a\nu == a\nu -&gt; u == a -&gt; a == a\n</code></pre>\n\n<p>which is impossible, and where the error comes from.</p>\n\n<p>Consider any of the following.</p>\n\n<pre><code>sumBFold :: (Num a) =&gt; BTree a -&gt; a\nsumBFold = foldB add3 where add3 x y z = x + y + z\nsumBFold = foldB $ \\x y z -&gt; x + y + z\nsumBFold = foldB ((.) (+) . (+))\n</code></pre>\n"}], "owner": {"reputation": 327, "user_id": 5110438, "user_type": "registered", "accept_rate": 46, "profile_image": "https://www.gravatar.com/avatar/0cbba6c8f6f196e3e367e378ca1f418a?s=128&d=identicon&r=PG&f=1", "display_name": "Stinkidog", "link": "https://stackoverflow.com/users/5110438/stinkidog"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 191, "favorite_count": 0, "accepted_answer_id": 43215269, "answer_count": 1, "score": 0, "last_activity_date": 1491448314, "creation_date": 1491330850, "last_edit_date": 1491448314, "question_id": 43215033, "link": "https://stackoverflow.com/questions/43215033/binary-tree-fold-functions", "title": "Binary Tree Fold Functions", "body": "<p>I have the definition of a Binary tree in Haskell as the following:</p>\n\n<pre><code>data BTree x = Nil | BNode x (BTree x) (BTree x)\n</code></pre>\n\n<p>I then have a fold definition for this data type:</p>\n\n<pre><code>foldB :: (x -&gt; u -&gt; u -&gt; u) -&gt; u -&gt; BTree x -&gt; u\nfoldB f a Nil = a\nfoldB f a (BNode x l r) = f x (foldB f a l)(foldB f a r)\n</code></pre>\n\n<p>So I hoped that I could simply make this function to sum all the values:</p>\n\n<pre><code>sumBFold :: (Num a) =&gt; BTree a -&gt; a\nsumBFold x = foldB (+) 0 x\n</code></pre>\n\n<p>But this does not work, and I cannot for the life of me figure out why.\nThe useful part of the error message I'm getting is:</p>\n\n<pre><code>Couldn't match type `a` with `a -&gt; a'\n`a' is a rigid type variable bound by the type signature for:\nsumBFold :: forall a. Num a =&gt; BTree a -&gt; a\nExpected type: (a -&gt; a) -&gt; a -&gt; a -&gt; a\nActual type: (a -&gt; a) -&gt; (a -&gt; a) -&gt; a -&gt; a\nIn the first argument of folB namely `(+)`\n</code></pre>\n"}, {"tags": ["haskell"], "comments": [{"owner": {"reputation": 4071, "user_id": 3806046, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/5fedf50ce7cd2659bca902e9a2969158?s=128&d=identicon&r=PG&f=1", "display_name": "jkeuhlen", "link": "https://stackoverflow.com/users/3806046/jkeuhlen"}, "edited": false, "score": 1, "creation_date": 1491321583, "post_id": 43211745, "comment_id": 73496012, "body": "I updated my answer to reflect your edit, in the future, please don&#39;t move the goalposts on questions! If an answer solves your original problem, but exposes a new one, it is better practice to accept an answer to the first one and ask a new question for your new problem."}, {"owner": {"reputation": 1735, "user_id": 2892792, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/5DNyi.jpg?s=128&g=1", "display_name": "Lazersmoke", "link": "https://stackoverflow.com/users/2892792/lazersmoke"}, "edited": false, "score": 0, "creation_date": 1491321731, "post_id": 43211745, "comment_id": 73496119, "body": "Side note: that book looks a little outdated (it says to use Hugs). I would look into a more up to date resource that will give you a better idea of what to do and will have a more linear learning curve. I learned using &quot;Learn you a Haskell&quot;, and I&#39;ve heard good things about &quot;Real World Haskell&quot;. They are both free online."}, {"owner": {"reputation": 133, "user_id": 7122314, "user_type": "registered", "accept_rate": 67, "profile_image": "https://www.gravatar.com/avatar/4f690d41d4687cba4052df317f819c09?s=128&d=identicon&r=PG&f=1", "display_name": "Kai D", "link": "https://stackoverflow.com/users/7122314/kai-d"}, "edited": false, "score": 0, "creation_date": 1491321954, "post_id": 43211745, "comment_id": 73496291, "body": "I also use a futurelearn course but I found the initial learning curve to be too steep. This book was recommended to me by the person running the course as a more gradual intro before tackling futurelearn in more depth."}], "answers": [{"comments": [{"owner": {"reputation": 133, "user_id": 7122314, "user_type": "registered", "accept_rate": 67, "profile_image": "https://www.gravatar.com/avatar/4f690d41d4687cba4052df317f819c09?s=128&d=identicon&r=PG&f=1", "display_name": "Kai D", "link": "https://stackoverflow.com/users/7122314/kai-d"}, "edited": false, "score": 0, "creation_date": 1491320944, "post_id": 43211822, "comment_id": 73495595, "body": "Okay I copy pasted your response and it gave me a new error, question has been updated with the error trace.  Also I don&#39;t understand what was wrong with my indentation, the where was exactly 4 spaces in and the_three was exactly 4 as well. I acknowledge there was obviously something since your solution fixed it I just don&#39;t understand."}, {"owner": {"reputation": 4071, "user_id": 3806046, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/5fedf50ce7cd2659bca902e9a2969158?s=128&d=identicon&r=PG&f=1", "display_name": "jkeuhlen", "link": "https://stackoverflow.com/users/3806046/jkeuhlen"}, "reply_to_user": {"reputation": 133, "user_id": 7122314, "user_type": "registered", "accept_rate": 67, "profile_image": "https://www.gravatar.com/avatar/4f690d41d4687cba4052df317f819c09?s=128&d=identicon&r=PG&f=1", "display_name": "Kai D", "link": "https://stackoverflow.com/users/7122314/kai-d"}, "edited": false, "score": 0, "creation_date": 1491321163, "post_id": 43211822, "comment_id": 73495707, "body": "@KaiD Mixing tabs and spaces can typically cause issues that make things look like they line up, but aren&#39;t actually."}, {"owner": {"reputation": 126897, "user_id": 791604, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/ce991df7a056248d5e4f6fc3659ba733?s=128&d=identicon&r=PG", "display_name": "Daniel Wagner", "link": "https://stackoverflow.com/users/791604/daniel-wagner"}, "reply_to_user": {"reputation": 133, "user_id": 7122314, "user_type": "registered", "accept_rate": 67, "profile_image": "https://www.gravatar.com/avatar/4f690d41d4687cba4052df317f819c09?s=128&d=identicon&r=PG&f=1", "display_name": "Kai D", "link": "https://stackoverflow.com/users/7122314/kai-d"}, "edited": false, "score": 0, "creation_date": 1491321753, "post_id": 43211822, "comment_id": 73496135, "body": "@KaiD <code>where</code> just starts the block; it&#39;s the next token that sets the required indentation level for the block. So lining up <code>the_three</code> with <code>where</code> (as you say you did: both indented four spaces) is incorrect, as you should be lining up <code>the_three</code> with <code>avg</code> instead (so indent <code>the_three</code> by four spaces to come to the beginning of the <code>where</code>, plus six more spaces to account for <code>where\u2423</code>)."}, {"owner": {"reputation": 133, "user_id": 7122314, "user_type": "registered", "accept_rate": 67, "profile_image": "https://www.gravatar.com/avatar/4f690d41d4687cba4052df317f819c09?s=128&d=identicon&r=PG&f=1", "display_name": "Kai D", "link": "https://stackoverflow.com/users/7122314/kai-d"}, "edited": false, "score": 0, "creation_date": 1491321765, "post_id": 43211822, "comment_id": 73496148, "body": "I&#39;ll be more careful with indenting in the future then, thank you Daniel I didn&#39;t know that i&#39;ll bear it in my for future coding. Your solution above gave me a different error again, question updated."}, {"owner": {"reputation": 126897, "user_id": 791604, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/ce991df7a056248d5e4f6fc3659ba733?s=128&d=identicon&r=PG", "display_name": "Daniel Wagner", "link": "https://stackoverflow.com/users/791604/daniel-wagner"}, "edited": false, "score": 0, "creation_date": 1491321775, "post_id": 43211822, "comment_id": 73496159, "body": "@jkeuhlen This isn&#39;t related to tabs, I don&#39;t think. None of his edits include code with a tab in it, and his description of his code explicitly refers to spaces."}, {"owner": {"reputation": 4071, "user_id": 3806046, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/5fedf50ce7cd2659bca902e9a2969158?s=128&d=identicon&r=PG&f=1", "display_name": "jkeuhlen", "link": "https://stackoverflow.com/users/3806046/jkeuhlen"}, "reply_to_user": {"reputation": 126897, "user_id": 791604, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/ce991df7a056248d5e4f6fc3659ba733?s=128&d=identicon&r=PG", "display_name": "Daniel Wagner", "link": "https://stackoverflow.com/users/791604/daniel-wagner"}, "edited": false, "score": 0, "creation_date": 1491321993, "post_id": 43211822, "comment_id": 73496315, "body": "@DanielWagner You&#39;re definitely right. I just misunderstood what he meant in &quot;exactly 4 spaces&quot;."}, {"owner": {"reputation": 4071, "user_id": 3806046, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/5fedf50ce7cd2659bca902e9a2969158?s=128&d=identicon&r=PG&f=1", "display_name": "jkeuhlen", "link": "https://stackoverflow.com/users/3806046/jkeuhlen"}, "reply_to_user": {"reputation": 133, "user_id": 7122314, "user_type": "registered", "accept_rate": 67, "profile_image": "https://www.gravatar.com/avatar/4f690d41d4687cba4052df317f819c09?s=128&d=identicon&r=PG&f=1", "display_name": "Kai D", "link": "https://stackoverflow.com/users/7122314/kai-d"}, "edited": false, "score": 0, "creation_date": 1491322037, "post_id": 43211822, "comment_id": 73496351, "body": "@KaiD import Control.Applicative"}], "tags": [], "owner": {"reputation": 4071, "user_id": 3806046, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/5fedf50ce7cd2659bca902e9a2969158?s=128&d=identicon&r=PG&f=1", "display_name": "jkeuhlen", "link": "https://stackoverflow.com/users/3806046/jkeuhlen"}, "is_accepted": true, "score": 1, "last_activity_date": 1491322222, "last_edit_date": 1491322222, "creation_date": 1491320491, "answer_id": 43211822, "question_id": 43211745, "link": "https://stackoverflow.com/questions/43211745/haskell-howmanyaboveaverage-couldnt-match-type-error/43211822#43211822", "title": "Haskell howManyAboveAverage Couldn&#39;t Match Type Error", "body": "<p>In Haskell, <a href=\"https://en.wikibooks.org/wiki/Haskell/Indentation\" rel=\"nofollow noreferrer\">indentation does matter</a>. You need to match the indentation in your <code>where</code> clause:</p>\n\n<pre><code>howManyAverageThree :: Int -&gt; Int -&gt; Int -&gt; Int\nhowManyAverageThree a b c = length $ filter (&gt; avg) the_three\n    where avg = averageThree a b c\n          the_three = fromIntegral[a b c]\n</code></pre>\n\n<p>EDIT: \nFollowing your edit to the question, you need to look more closely at the definition of <code>the_three</code>:</p>\n\n<pre><code>the_three = fromIntegral[a b c]\n</code></pre>\n\n<p><code>fromIntegral</code> has type <code>:: (Integral a, Num b) =&gt; a -&gt; b</code></p>\n\n<p>If you want to <code>the_three</code> to be a list of numbers, you need to do a few things. \nFirst, your list constructions needs <code>,</code>'s inside it. Second, you need to map <code>fromIntegral</code> over each element of that list. </p>\n\n<pre><code>import Control.Applicative((&lt;$&gt;))\n....\n\nthe_three = fromIntegral &lt;$&gt; [a,b,c]\n</code></pre>\n"}], "owner": {"reputation": 133, "user_id": 7122314, "user_type": "registered", "accept_rate": 67, "profile_image": "https://www.gravatar.com/avatar/4f690d41d4687cba4052df317f819c09?s=128&d=identicon&r=PG&f=1", "display_name": "Kai D", "link": "https://stackoverflow.com/users/7122314/kai-d"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 157, "favorite_count": 0, "accepted_answer_id": 43211822, "answer_count": 1, "score": 0, "last_activity_date": 1491322222, "creation_date": 1491320280, "last_edit_date": 1495535449, "question_id": 43211745, "link": "https://stackoverflow.com/questions/43211745/haskell-howmanyaboveaverage-couldnt-match-type-error", "title": "Haskell howManyAboveAverage Couldn&#39;t Match Type Error", "body": "<p>I am a Haskell beginner currently working through The Craft of Functional Programming 2nd Edition. One of the exercises in the book asks me to write an averageThree function, which I have did, and then a howManyAboveAverage function using the averageThree function.</p>\n\n<p>I was a bit stuck on how to do this but I found a similar problem <a href=\"https://stackoverflow.com/questions/7793281/haskell-returns-how-many-inputs-are-larger-than-their-average-value\">here</a>. I used the solution given in my code however I am getting a parse error [FIXED].   </p>\n\n<p>Here is my new code:</p>\n\n<pre><code>averageThree :: Int -&gt; Int -&gt; Int -&gt; Float\naverageThree a b c = fromIntegral (a + b + c) / 3\n\nhowManyAverageThree :: Int -&gt; Int -&gt; Int -&gt; Int\nhowManyAverageThree a b c = length $ filter (&gt; avg) the_three\n    where avg = averageThree a b c\n          the_three = fromIntegral &lt;$&gt; [a,b,c]\n</code></pre>\n\n<p>EDIT: New Error<br>\nError trace:</p>\n\n<pre><code>[1 of 1] Compiling Main             ( average.hs, interpreted )\n\naverage.hs:7:36: Not in scope: `&lt;$&gt;'\nFailed, modules loaded: none.\n</code></pre>\n\n<p>I use ghci version 7.6.3 for compilation. Since I'm following a textbook example I need to preserve the function signatures. How can I modify this code such that I no longer get the above error?</p>\n"}, {"tags": ["haskell", "ghc"], "comments": [{"owner": {"reputation": 100892, "user_id": 745903, "user_type": "registered", "accept_rate": 74, "profile_image": "https://www.gravatar.com/avatar/50933f6638836741e620669b3940410e?s=128&d=identicon&r=PG", "display_name": "leftaroundabout", "link": "https://stackoverflow.com/users/745903/leftaroundabout"}, "edited": false, "score": 0, "creation_date": 1491316728, "post_id": 43210246, "comment_id": 73492256, "body": "Are you really sure this <code>AllowAmbiguousTypes</code> funk is a good idea?"}, {"owner": {"reputation": 20310, "user_id": 525980, "user_type": "registered", "accept_rate": 48, "profile_image": "https://www.gravatar.com/avatar/8dafe66793ee2f32192e9fcefb389a12?s=128&d=identicon&r=PG", "display_name": "Clinton", "link": "https://stackoverflow.com/users/525980/clinton"}, "reply_to_user": {"reputation": 100892, "user_id": 745903, "user_type": "registered", "accept_rate": 74, "profile_image": "https://www.gravatar.com/avatar/50933f6638836741e620669b3940410e?s=128&d=identicon&r=PG", "display_name": "leftaroundabout", "link": "https://stackoverflow.com/users/745903/leftaroundabout"}, "edited": false, "score": 0, "creation_date": 1491316890, "post_id": 43210246, "comment_id": 73492388, "body": "Not particularly, but I&#39;d appreciate a suggestion of how to get this to compile without it"}, {"owner": {"reputation": 4185, "user_id": 1424121, "user_type": "registered", "accept_rate": 62, "profile_image": "https://www.gravatar.com/avatar/c6f5c5cd761b9ce4493fd875cc041ac3?s=128&d=identicon&r=PG", "display_name": "ryachza", "link": "https://stackoverflow.com/users/1424121/ryachza"}, "edited": false, "score": 0, "creation_date": 1491317060, "post_id": 43210246, "comment_id": 73492521, "body": "@Clinton I&#39;m not sure why it works in GHCi, but I think the GHC errors make sense. In order to pick an implementation of <code>toRational</code> it needs to know what type the result should be but there&#39;s nothing to indicate that. I&#39;m thinking maybe you would need a <code>Proxy</code> argument or type application?"}, {"owner": {"reputation": 20310, "user_id": 525980, "user_type": "registered", "accept_rate": 48, "profile_image": "https://www.gravatar.com/avatar/8dafe66793ee2f32192e9fcefb389a12?s=128&d=identicon&r=PG", "display_name": "Clinton", "link": "https://stackoverflow.com/users/525980/clinton"}, "edited": false, "score": 0, "creation_date": 1491317121, "post_id": 43210246, "comment_id": 73492578, "body": "GHC compiled happily compiles and runs the code correctly without the signature also"}, {"owner": {"reputation": 4185, "user_id": 1424121, "user_type": "registered", "accept_rate": 62, "profile_image": "https://www.gravatar.com/avatar/c6f5c5cd761b9ce4493fd875cc041ac3?s=128&d=identicon&r=PG", "display_name": "ryachza", "link": "https://stackoverflow.com/users/1424121/ryachza"}, "edited": false, "score": 0, "creation_date": 1491317224, "post_id": 43210246, "comment_id": 73492674, "body": "@Clinton Perhaps without the type signature it is defaulting to some concrete <code>Real a</code>. I&#39;m not sure how/why then GHCi reports the more general type, though."}, {"owner": {"reputation": 20310, "user_id": 525980, "user_type": "registered", "accept_rate": 48, "profile_image": "https://www.gravatar.com/avatar/8dafe66793ee2f32192e9fcefb389a12?s=128&d=identicon&r=PG", "display_name": "Clinton", "link": "https://stackoverflow.com/users/525980/clinton"}, "edited": false, "score": 0, "creation_date": 1491317287, "post_id": 43210246, "comment_id": 73492739, "body": "I&#39;m explicitly giving the types as Float and Double"}, {"owner": {"reputation": 4185, "user_id": 1424121, "user_type": "registered", "accept_rate": 62, "profile_image": "https://www.gravatar.com/avatar/c6f5c5cd761b9ce4493fd875cc041ac3?s=128&d=identicon&r=PG", "display_name": "ryachza", "link": "https://stackoverflow.com/users/1424121/ryachza"}, "edited": false, "score": 0, "creation_date": 1491317391, "post_id": 43210246, "comment_id": 73492811, "body": "@Clinton Are you? It seems like you are providing the types of <code>x</code> and <code>y</code>, but then calling <code>toRational</code> which is polymorphic in it&#39;s result. I don&#39;t think an implementation of <code>toRational</code> can be chosen with only that information?"}, {"owner": {"reputation": 20310, "user_id": 525980, "user_type": "registered", "accept_rate": 48, "profile_image": "https://www.gravatar.com/avatar/8dafe66793ee2f32192e9fcefb389a12?s=128&d=identicon&r=PG", "display_name": "Clinton", "link": "https://stackoverflow.com/users/525980/clinton"}, "edited": false, "score": 0, "creation_date": 1491317466, "post_id": 43210246, "comment_id": 73492892, "body": "&#39;toRational&#39; is polymorphic in its input but not in its result"}, {"owner": {"reputation": 4185, "user_id": 1424121, "user_type": "registered", "accept_rate": 62, "profile_image": "https://www.gravatar.com/avatar/c6f5c5cd761b9ce4493fd875cc041ac3?s=128&d=identicon&r=PG", "display_name": "ryachza", "link": "https://stackoverflow.com/users/1424121/ryachza"}, "edited": false, "score": 0, "creation_date": 1491317598, "post_id": 43210246, "comment_id": 73493011, "body": "@Clinton Ah yes my mistake; sorry. I think the issue then is that <code>Poly</code>/<code>getPoly</code> specifically throws away the <code>Float</code>/<code>Double</code> type information. Isn&#39;t that what it&#39;s designed to do?"}, {"owner": {"reputation": 20310, "user_id": 525980, "user_type": "registered", "accept_rate": 48, "profile_image": "https://www.gravatar.com/avatar/8dafe66793ee2f32192e9fcefb389a12?s=128&d=identicon&r=PG", "display_name": "Clinton", "link": "https://stackoverflow.com/users/525980/clinton"}, "edited": false, "score": 0, "creation_date": 1491317722, "post_id": 43210246, "comment_id": 73493111, "body": "Poly is just intended to hold a polymorphic value. If you want to know how it&#39;s intended to work, just run it without the type signature. It works perfectly then."}], "answers": [{"tags": [], "owner": {"reputation": 126897, "user_id": 791604, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/ce991df7a056248d5e4f6fc3659ba733?s=128&d=identicon&r=PG", "display_name": "Daniel Wagner", "link": "https://stackoverflow.com/users/791604/daniel-wagner"}, "is_accepted": true, "score": 2, "last_activity_date": 1491318170, "creation_date": 1491318170, "answer_id": 43210921, "question_id": 43210246, "link": "https://stackoverflow.com/questions/43210246/ghci-derived-type-causes-compile-error-when-written-manually/43210921#43210921", "title": "GHCi derived type causes compile error when written manually", "body": "<p>Yes, you can give it that type signature, but you need to give it a few hints about how the types in the signature correspond with the expressions in the code. Turn on <code>ScopedTypeVariables</code>; then the following compiles:</p>\n\n<pre><code>testOp\n  :: forall a1 a t1 t c.\n     (Real a1, Real a, c (t1 -&gt; a1), c (t -&gt; a)) =&gt;\n     Poly c -&gt; t1 -&gt; t -&gt; Bool\ntestOp f x y = toRational (getPoly f x :: a1) == toRational (getPoly f y :: a)\n</code></pre>\n\n<p><code>toRational . getPoly f</code> is ambiguous for basically the same reason <code>show . read</code> is, and the solution here is analogous. For <code>show . read</code> you give a type signature somewhere that fixes <code>read</code>'s return type, and for your example I've given a type signature that fixes <code>getPoly f</code>'s return type.</p>\n"}], "owner": {"reputation": 20310, "user_id": 525980, "user_type": "registered", "accept_rate": 48, "profile_image": "https://www.gravatar.com/avatar/8dafe66793ee2f32192e9fcefb389a12?s=128&d=identicon&r=PG", "display_name": "Clinton", "link": "https://stackoverflow.com/users/525980/clinton"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 47, "favorite_count": 0, "accepted_answer_id": 43210921, "answer_count": 1, "score": 0, "last_activity_date": 1491318170, "creation_date": 1491316444, "question_id": 43210246, "link": "https://stackoverflow.com/questions/43210246/ghci-derived-type-causes-compile-error-when-written-manually", "title": "GHCi derived type causes compile error when written manually", "body": "<p>Consider the following code below:</p>\n\n<pre><code>{-# LANGUAGE RankNTypes #-}\n{-# LANGUAGE GADTs #-}\n{-# LANGUAGE ConstraintKinds #-}\n{-# LANGUAGE AllowAmbiguousTypes #-}\n{-# LANGUAGE TypeFamilies #-}\n{-# LANGUAGE FlexibleInstances #-}\n{-# LANGUAGE UndecidableInstances #-}\n{-# LANGUAGE FlexibleContexts #-}\n\nimport GHC.Exts (Constraint)\n\ndata Poly (c :: * -&gt; Constraint) where\n  Poly :: { getPoly :: (forall a. c a =&gt; a) } -&gt; Poly c\n\ntype family Arg1 a where\n  Arg1 (a -&gt; _) = a\n\ntype family Result a where\n  Result (_ -&gt; a) = a\n\ntype IsOneArgFunc a = a ~ (Arg1 a -&gt; Result a)\n\ntype NegateConstraint a = (IsOneArgFunc a, Real (Result a), Arg1 a ~ Result a)\n\nclass NegateConstraint a =&gt; NegateConstraintC a\ninstance NegateConstraint a =&gt; NegateConstraintC a\n\npolyNegate :: Poly NegateConstraintC\npolyNegate = Poly negate\n\ntestOp f x y = toRational (getPoly f x) == toRational (getPoly f y)\n\nmain = do\n  print $ testOp polyNegate (2 :: Float) (2 :: Double)\n</code></pre>\n\n<p>(Note: parts are extracted from my <a href=\"https://hackage.haskell.org/package/polydata\" rel=\"nofollow noreferrer\">polydata</a> and <a href=\"https://hackage.haskell.org/package/indextype\" rel=\"nofollow noreferrer\">indextype</a> packages, but I've extracted the code below to avoid dependencies):</p>\n\n<p>This compiles and runs perfectly fine.</p>\n\n<p>Note that there is no type signature for <code>testOp</code>.</p>\n\n<p>Loading this into <code>ghci</code> and asking <code>:t testOp</code> I get the following:</p>\n\n<pre><code>testOp\n  :: (Real a1, Real a, c (t1 -&gt; a1), c (t -&gt; a)) =&gt;\n     Poly c -&gt; t1 -&gt; t -&gt; Bool\n</code></pre>\n\n<p>Which seems like a reasonable type to derive. However, when I copy that into the code, like so:</p>\n\n<pre><code>testOp\n  :: (Real a1, Real a, c (t1 -&gt; a1), c (t -&gt; a)) =&gt;\n     Poly c -&gt; t1 -&gt; t -&gt; Bool\ntestOp f x y = toRational (getPoly f x) == toRational (getPoly f y)\n</code></pre>\n\n<p>I get a bunch of errors:</p>\n\n<pre><code>\u2022 Could not deduce (Real a0) arising from a use of \u2018toRational\u2019\n  from the context: (Real a2, Real a, c (t1 -&gt; a2), c (t -&gt; a))\n    bound by the type signature for:\n               testOp :: (Real a2, Real a, c (t1 -&gt; a2), c (t -&gt; a)) =&gt;\n                         Poly c -&gt; t1 -&gt; t -&gt; Bool\n    at polyerror.hs:(31,1)-(33,30)\n  The type variable \u2018a0\u2019 is ambiguous\n  These potential instances exist:\n    instance Real Integer -- Defined in \u2018GHC.Real\u2019\n    instance Real Double -- Defined in \u2018GHC.Float\u2019\n    instance Real Float -- Defined in \u2018GHC.Float\u2019\n    ...plus two others\n    ...plus two instances involving out-of-scope types\n    (use -fprint-potential-instances to see them all)\n\u2022 In the first argument of \u2018(==)\u2019, namely\n    \u2018toRational (getPoly f x)\u2019\n  In the expression:\n    toRational (getPoly f x) == toRational (getPoly f y)\n  In an equation for \u2018testOp\u2019:\n      testOp f x y = toRational (getPoly f x) == toRational (getPoly f y)\n\n\u2022 Could not deduce: c (t1 -&gt; a0) arising from a use of \u2018getPoly\u2019\n  from the context: (Real a2, Real a, c (t1 -&gt; a2), c (t -&gt; a))\n    bound by the type signature for:\n               testOp :: (Real a2, Real a, c (t1 -&gt; a2), c (t -&gt; a)) =&gt;\n                         Poly c -&gt; t1 -&gt; t -&gt; Bool\n    at polyerror.hs:(31,1)-(33,30)\n\u2022 In the first argument of \u2018toRational\u2019, namely \u2018(getPoly f x)\u2019\n  In the first argument of \u2018(==)\u2019, namely \u2018toRational (getPoly f x)\u2019\n  In the expression:\n    toRational (getPoly f x) == toRational (getPoly f y)\n\u2022 Relevant bindings include\n    x :: t1 (bound at polyerror.hs:34:10)\n    f :: Poly c (bound at polyerror.hs:34:8)\n    testOp :: Poly c -&gt; t1 -&gt; t -&gt; Bool (bound at polyerror.hs:34:1)\n\n\u2022 Could not deduce (Real a1) arising from a use of \u2018toRational\u2019\n  from the context: (Real a2, Real a, c (t1 -&gt; a2), c (t -&gt; a))\n    bound by the type signature for:\n               testOp :: (Real a2, Real a, c (t1 -&gt; a2), c (t -&gt; a)) =&gt;\n                         Poly c -&gt; t1 -&gt; t -&gt; Bool\n    at polyerror.hs:(31,1)-(33,30)\n  The type variable \u2018a1\u2019 is ambiguous\n  These potential instances exist:\n    instance Real Integer -- Defined in \u2018GHC.Real\u2019\n    instance Real Double -- Defined in \u2018GHC.Float\u2019\n    instance Real Float -- Defined in \u2018GHC.Float\u2019\n    ...plus two others\n    ...plus two instances involving out-of-scope types\n    (use -fprint-potential-instances to see them all)\n\u2022 In the second argument of \u2018(==)\u2019, namely\n    \u2018toRational (getPoly f y)\u2019\n  In the expression:\n    toRational (getPoly f x) == toRational (getPoly f y)\n  In an equation for \u2018testOp\u2019:\n      testOp f x y = toRational (getPoly f x) == toRational (getPoly f y)\n\n\u2022 Could not deduce: c (t -&gt; a1) arising from a use of \u2018getPoly\u2019\n  from the context: (Real a2, Real a, c (t1 -&gt; a2), c (t -&gt; a))\n    bound by the type signature for:\n               testOp :: (Real a2, Real a, c (t1 -&gt; a2), c (t -&gt; a)) =&gt;\n                         Poly c -&gt; t1 -&gt; t -&gt; Bool\n    at polyerror.hs:(31,1)-(33,30)\n\u2022 In the first argument of \u2018toRational\u2019, namely \u2018(getPoly f y)\u2019\n  In the second argument of \u2018(==)\u2019, namely \u2018toRational (getPoly f y)\u2019\n  In the expression:\n    toRational (getPoly f x) == toRational (getPoly f y)\n\u2022 Relevant bindings include\n    y :: t (bound at polyerror.hs:34:12)\n    f :: Poly c (bound at polyerror.hs:34:8)\n    testOp :: Poly c -&gt; t1 -&gt; t -&gt; Bool (bound at polyerror.hs:34:1)\n</code></pre>\n\n<p>Is there a type signature I can manually write for <code>testOp</code> that's generic as the inferred one, and if so, what is it? If not, is it by design that some functions you can not write a manual type signature for without losing generality, or is this a GHC bug (I'm currently using 8.0.2)?</p>\n"}, {"tags": ["haskell", "template-haskell", "haskell-frames"], "comments": [{"owner": {"reputation": 29444, "user_id": 3072788, "user_type": "registered", "accept_rate": 82, "profile_image": "https://www.gravatar.com/avatar/220a45c2fcff7e7358d144551b116205?s=128&d=identicon&r=PG&f=1", "display_name": "Alec", "link": "https://stackoverflow.com/users/3072788/alec"}, "edited": false, "score": 5, "creation_date": 1491295289, "post_id": 43201525, "comment_id": 73476266, "body": "It is possible. <code>[d| foreign import ccall unsafe &quot;malloc&quot; c_malloc :: Int -&gt; IO () |]</code>, for example, works. There are some examples of template Haskell with FFI <a href=\"https://wiki.haskell.org/Foreign_Function_Interface#Inline_FFI_calls\" rel=\"nofollow noreferrer\">here</a>. Note also that this is exactly what <a href=\"https://hackage.haskell.org/package/inline-c\" rel=\"nofollow noreferrer\">inline-c</a> and <a href=\"https://hackage.haskell.org/package/inline-java\" rel=\"nofollow noreferrer\">inline-java</a> rely on."}, {"owner": {"reputation": 533, "user_id": 3847023, "user_type": "registered", "accept_rate": 89, "profile_image": "https://i.stack.imgur.com/mUqNl.jpg?s=128&g=1", "display_name": "Nick Tchayka", "link": "https://stackoverflow.com/users/3847023/nick-tchayka"}, "reply_to_user": {"reputation": 29444, "user_id": 3072788, "user_type": "registered", "accept_rate": 82, "profile_image": "https://www.gravatar.com/avatar/220a45c2fcff7e7358d144551b116205?s=128&d=identicon&r=PG&f=1", "display_name": "Alec", "link": "https://stackoverflow.com/users/3072788/alec"}, "edited": false, "score": 0, "creation_date": 1491381616, "post_id": 43201525, "comment_id": 73522130, "body": "@Alec could you make this an answer so I can accept it? :)"}], "answers": [{"comments": [{"owner": {"reputation": 533, "user_id": 3847023, "user_type": "registered", "accept_rate": 89, "profile_image": "https://i.stack.imgur.com/mUqNl.jpg?s=128&g=1", "display_name": "Nick Tchayka", "link": "https://stackoverflow.com/users/3847023/nick-tchayka"}, "edited": false, "score": 0, "creation_date": 1491410542, "post_id": 43226794, "comment_id": 73544148, "body": "&quot;// c code&quot; was just a place holder I wrote here, anyways, thanks for the answer it really helped me :)"}], "tags": [], "owner": {"reputation": 29444, "user_id": 3072788, "user_type": "registered", "accept_rate": 82, "profile_image": "https://www.gravatar.com/avatar/220a45c2fcff7e7358d144551b116205?s=128&d=identicon&r=PG&f=1", "display_name": "Alec", "link": "https://stackoverflow.com/users/3072788/alec"}, "is_accepted": true, "score": 1, "last_activity_date": 1491383640, "creation_date": 1491383640, "answer_id": 43226794, "question_id": 43201525, "link": "https://stackoverflow.com/questions/43201525/generate-ffi-call-using-template-haskell/43226794#43226794", "title": "Generate FFI call using Template Haskell", "body": "<p>Yes it is possible. The error message you are seeing is due to <code>\"// c code\"</code> being a \"Malformed entity string\". Anything more sane, and you are off to the races:</p>\n\n<pre><code>ghci&gt; :set -XTemplateHaskell\nghci&gt; ffi = [d| foreign import ccall unsafe \"foo\" c_foo :: Int -&gt; IO () |]\n</code></pre>\n\n<p><a href=\"https://wiki.haskell.org/Foreign_Function_Interface#Inline_FFI_calls\" rel=\"nofollow noreferrer\">Here</a> is an example which does pretty much exactly what you are asking about. Note that both the packages <a href=\"https://hackage.haskell.org/package/inline-c\" rel=\"nofollow noreferrer\">inline-c</a> and <a href=\"https://hackage.haskell.org/package/inline-java\" rel=\"nofollow noreferrer\">inline-java</a> rely on this sort of thing.</p>\n"}], "owner": {"reputation": 533, "user_id": 3847023, "user_type": "registered", "accept_rate": 89, "profile_image": "https://i.stack.imgur.com/mUqNl.jpg?s=128&g=1", "display_name": "Nick Tchayka", "link": "https://stackoverflow.com/users/3847023/nick-tchayka"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 115, "favorite_count": 1, "accepted_answer_id": 43226794, "answer_count": 1, "score": 0, "last_activity_date": 1528907939, "creation_date": 1491292900, "last_edit_date": 1528907939, "question_id": 43201525, "link": "https://stackoverflow.com/questions/43201525/generate-ffi-call-using-template-haskell", "title": "Generate FFI call using Template Haskell", "body": "<p>In the <a href=\"https://hackage.haskell.org/package/Frames\" rel=\"nofollow noreferrer\" title=\"Frames library\">Frames library</a>, one has a <code>readTable</code> function, that generates a record type based on a CSV file.</p>\n\n<p>Is it possible to generate a call like <code>foreign import ccall unsafe \"// c code\" c_foo :: Int -&gt; IO ()</code>?</p>\n\n<p>I've tried to accomplish so using a <code>[d| ... |]</code> and a <code>[t| ... |]</code> quasiquoters, but in both I get a parser error.</p>\n"}, {"tags": ["string", "list", "haskell", "merge", "tuples"], "answers": [{"comments": [{"owner": {"reputation": 11, "user_id": 7812004, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/ad83G.jpg?s=128&g=1", "display_name": "Ezatara", "link": "https://stackoverflow.com/users/7812004/ezatara"}, "edited": false, "score": 0, "creation_date": 1491370183, "post_id": 43198970, "comment_id": 73515458, "body": "How can I put it in a function or call it? It can&#39;t be with predetermined values"}, {"owner": {"reputation": 5008, "user_id": 5762796, "user_type": "registered", "accept_rate": 78, "profile_image": "https://www.gravatar.com/avatar/b3acb5c2021f4c279f29d61481b28e15?s=128&d=identicon&r=PG&f=1", "display_name": "Aleph0", "link": "https://stackoverflow.com/users/5762796/aleph0"}, "reply_to_user": {"reputation": 11, "user_id": 7812004, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/ad83G.jpg?s=128&g=1", "display_name": "Ezatara", "link": "https://stackoverflow.com/users/7812004/ezatara"}, "edited": false, "score": 0, "creation_date": 1491371517, "post_id": 43198970, "comment_id": 73516029, "body": "I don&#39;t got the question. <code>h</code> is the function you have to call."}], "tags": [], "owner": {"reputation": 5008, "user_id": 5762796, "user_type": "registered", "accept_rate": 78, "profile_image": "https://www.gravatar.com/avatar/b3acb5c2021f4c279f29d61481b28e15?s=128&d=identicon&r=PG&f=1", "display_name": "Aleph0", "link": "https://stackoverflow.com/users/5762796/aleph0"}, "is_accepted": false, "score": 1, "last_activity_date": 1491283929, "creation_date": 1491283929, "answer_id": 43198970, "question_id": 43198426, "link": "https://stackoverflow.com/questions/43198426/merge-list-of-strings-into-list-of-tuple-of-those-strings/43198970#43198970", "title": "Merge list of strings into list of tuple of those strings", "body": "<p>You might try this, as a first solution:</p>\n\n<pre><code>a=[\"12\",\"34\",\"56\", \"78\"]\ng n x= (concat $ fst y, concat $ snd y) where y=splitAt n x\nh a = [g i a|i&lt;-[1..(length a)-1]]\n</code></pre>\n"}, {"tags": [], "owner": {"reputation": 94713, "user_id": 1139697, "user_type": "registered", "accept_rate": 86, "profile_image": "https://www.gravatar.com/avatar/5f136ddb684f39aaee1c028ee1950f6f?s=128&d=identicon&r=PG", "display_name": "Zeta", "link": "https://stackoverflow.com/users/1139697/zeta"}, "is_accepted": false, "score": 1, "last_activity_date": 1491286215, "creation_date": 1491286215, "answer_id": 43199507, "question_id": 43198426, "link": "https://stackoverflow.com/questions/43198426/merge-list-of-strings-into-list-of-tuple-of-those-strings/43199507#43199507", "title": "Merge list of strings into list of tuple of those strings", "body": "<pre><code>import Data.List (inits, tails)\n\nmergers :: [[a]] -&gt; [([a], [a])]\nmergers xs = init $ tail $ zip (map concat $ inits xs) (map concat $ tails xs)\n</code></pre>\n\n<p><code>inits xs</code> returns all prefixes of <code>xs</code> (including <code>[]</code> and the original list), and <code>tails xs</code> returns all suffixes of <code>xs</code> (including <code>[]</code> and the original list). Since the original list and <code>[]</code> are included, we have to use <code>init</code> and <code>tail</code> afterwards.</p>\n\n<p>Here are some intermediate results:</p>\n\n<pre><code>ghci&gt; inits [\"co\",\"nt\",\"ro\",\"la\"]\n[[],[\"co\"],[\"co\",\"nt\"],[\"co\",\"nt\",\"ro\"],[\"co\",\"nt\",\"ro\",\"la\"]]\n\nghci&gt; tails [\"co\",\"nt\",\"ro\",\"la\"]\n[[\"co\",\"nt\",\"ro\",\"la\"],[\"nt\",\"ro\",\"la\"],[\"ro\",\"la\"],[\"la\"],[]]\n\nghci&gt; map concat $ inits [\"co\",\"nt\",\"ro\",\"la\"]\n[\"\",\"co\",\"cont\",\"contro\",\"controla\"]\n\nghci&gt; map concat $ tails [\"co\",\"nt\",\"ro\",\"la\"]\n[\"controla\",\"ntrola\",\"rola\",\"la\",\"\"]\n\nghci&gt; let xs = [\"co\",\"nt\",\"ro\",\"la\"] in zip (map concat $ inits xs) (map concat $ tails xs)\n[(\"\",\"controla\"),(\"co\",\"ntrola\"),(\"cont\",\"rola\"),(\"contro\",\"la\"),(\"controla\",\"\")]\n</code></pre>\n\n<p>The last line shows why <code>init . tail</code> after <code>zip</code> is necessary.</p>\n"}], "owner": {"reputation": 11, "user_id": 7812004, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/ad83G.jpg?s=128&g=1", "display_name": "Ezatara", "link": "https://stackoverflow.com/users/7812004/ezatara"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 94, "favorite_count": 0, "answer_count": 2, "score": 0, "last_activity_date": 1491321135, "creation_date": 1491280945, "last_edit_date": 1491283969, "question_id": 43198426, "link": "https://stackoverflow.com/questions/43198426/merge-list-of-strings-into-list-of-tuple-of-those-strings", "title": "Merge list of strings into list of tuple of those strings", "body": "<p>I need to do this: </p>\n\n<pre><code>mergers [\"co\",\"nt\",\"ro\",\"la\"] \u21d2 [(\"co\",\"ntrola\"),(\"cont\",\"rola\")(\"contro\",\"la\")]\nmergers [\"co\",\"nt\"] \u21d2 [(\"co\",\"nt\")]\nmergers [\"co\"] \u21d2 []\n</code></pre>\n\n<p>But I don't know how. I recently started programming in Haskell and I'm stuck trying to resolve this problem.</p>\n"}, {"tags": ["haskell", "cabal", "ghci", "haskell-stack"], "answers": [{"tags": [], "owner": {"reputation": 4538, "user_id": 499478, "user_type": "registered", "accept_rate": 63, "profile_image": "https://www.gravatar.com/avatar/791526e67831fbd70e3d179a6c585b44?s=128&d=identicon&r=PG", "display_name": "Wizek", "link": "https://stackoverflow.com/users/499478/wizek"}, "is_accepted": false, "score": 1, "last_activity_date": 1491259038, "creation_date": 1491259038, "answer_id": 43195452, "question_id": 43195451, "link": "https://stackoverflow.com/questions/43195451/what-does-no-location-info-error-module-module-path-is-a-package-module/43195452#43195452", "title": "What does `&lt;no location info&gt;: error: module \u2018Module.Path\u2019 is a package module` mean when using `stack ghci`?", "body": "<p>I'm actually quite unsure what it means and what might cause them but I've found a fix that has worked for me so far.</p>\n\n<p>I've had a <code>hs-source-dirs</code> entry of <code>./.</code>, which I've changed to be <code>.</code>. And put it at the end of the list too. Not sure of the significance of this, but maybe others find it helpful when they stumble into this while googling for the error. (My searches turned up nothing related.)</p>\n"}], "owner": {"reputation": 4538, "user_id": 499478, "user_type": "registered", "accept_rate": 63, "profile_image": "https://www.gravatar.com/avatar/791526e67831fbd70e3d179a6c585b44?s=128&d=identicon&r=PG", "display_name": "Wizek", "link": "https://stackoverflow.com/users/499478/wizek"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 959, "favorite_count": 0, "answer_count": 1, "score": 0, "last_activity_date": 1491259038, "creation_date": 1491259038, "question_id": 43195451, "link": "https://stackoverflow.com/questions/43195451/what-does-no-location-info-error-module-module-path-is-a-package-module", "title": "What does `&lt;no location info&gt;: error: module \u2018Module.Path\u2019 is a package module` mean when using `stack ghci`?", "body": "<p>What may be the reason behind the following kind of errors?</p>\n\n<pre><code>Loaded GHCi configuration from /home/user/.ghci\n\n&lt;no location info&gt;: error:\n    module \u2018Settings.StaticFiles\u2019 is a package module\n\n&lt;no location info&gt;: error:\n    module \u2018Import.NoFoundation\u2019 is a package module\n\n&lt;no location info&gt;: error:\n    module \u2018Handler.Home\u2019 is a package module\n</code></pre>\n\n<p>I've been reorganizing my <code>.cabal</code> file (<code>package.yaml</code>, really) when it started showing up when trying to invoke <code>stack ghci</code>.</p>\n\n<p>And what can be done to fix them?</p>\n"}, {"tags": ["haskell"], "comments": [{"owner": {"reputation": 31243, "user_id": 2751851, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/4ddc0.png?s=128&g=1", "display_name": "duplode", "link": "https://stackoverflow.com/users/2751851/duplode"}, "edited": false, "score": 1, "creation_date": 1491254037, "post_id": 43194203, "comment_id": 73461630, "body": "Terminology nitpicking: your function is not a fold but an <i>un</i>fold (or an anamorphism, if you like fancy synonyms)."}, {"owner": {"reputation": 247, "user_id": 3746816, "user_type": "registered", "accept_rate": 89, "profile_image": "https://www.gravatar.com/avatar/30722dac9f0fb2f4d3c743c0dc6d1d5d?s=128&d=identicon&r=PG&f=1", "display_name": "Liably", "link": "https://stackoverflow.com/users/3746816/liably"}, "reply_to_user": {"reputation": 31243, "user_id": 2751851, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/4ddc0.png?s=128&g=1", "display_name": "duplode", "link": "https://stackoverflow.com/users/2751851/duplode"}, "edited": false, "score": 0, "creation_date": 1491254280, "post_id": 43194203, "comment_id": 73461741, "body": "Yes my mistake, thank you I&#39;ve updated the title."}, {"owner": {"reputation": 3627, "user_id": 3695939, "user_type": "registered", "accept_rate": 69, "profile_image": "https://www.gravatar.com/avatar/d75f41bcfc1d3f20c084ec7e87d82012?s=128&d=identicon&r=PG&f=1", "display_name": "moondaisy", "link": "https://stackoverflow.com/users/3695939/moondaisy"}, "edited": false, "score": 0, "creation_date": 1491254745, "post_id": 43194203, "comment_id": 73461946, "body": "To create an  <code>Either</code> you need to use the constructor <code>Right</code> like this <code>ys -&gt; Right (firstHalf ys, secondHalf ys)</code>. But I&#39;m not sure how it works for your  <code>(a, a)</code> type."}, {"owner": {"reputation": 45534, "user_id": 106104, "user_type": "registered", "accept_rate": 62, "profile_image": "https://www.gravatar.com/avatar/c88b9310b92a937108ec4336c2832f92?s=128&d=identicon&r=PG", "display_name": "user253751", "link": "https://stackoverflow.com/users/106104/user253751"}, "edited": false, "score": 0, "creation_date": 1491275455, "post_id": 43194203, "comment_id": 73467388, "body": "The official name of <code>Either</code> is <code>Either</code>..."}], "answers": [{"tags": [], "owner": {"reputation": 75362, "user_id": 625403, "user_type": "registered", "accept_rate": 82, "profile_image": "https://www.gravatar.com/avatar/786eed7da67079cb5d63a49d469af25b?s=128&d=identicon&r=PG", "display_name": "amalloy", "link": "https://stackoverflow.com/users/625403/amalloy"}, "is_accepted": true, "score": 1, "last_activity_date": 1491294804, "last_edit_date": 1491294804, "creation_date": 1491255982, "answer_id": 43194864, "question_id": 43194203, "link": "https://stackoverflow.com/questions/43194203/how-do-i-use-this-unfold-function/43194864#43194864", "title": "How do I use this unfold function?", "body": "<p>There are a few problems with these types that need addressing before you can even get started on writing the function. The first thing to note is that there's no way you could write a function with type <code>[a] -&gt; Tree x</code> using this unfold: where are the values of type <code>x</code> coming from? You could try writing a function with type <code>[a] -&gt; Tree a</code>, though, by moving values from the input list into the output tree.</p>\n\n<p>The second problem is that it is impossible to represent an empty tree using this <code>Tree a</code> type: a <code>Tip</code> has at least one <code>a</code>, and a <code>Node</code> has at least two, since each of the two branches eventually leads to at least one <code>Tip</code>. Therefore, there is no possible way to handle the case of an empty input list: <code>createSimpleTree []</code> cannot complete successfully, regardless of your implementation of <code>createSimpleTree</code>.</p>\n\n<p>If this were an assignment where the types and the implementation of <code>unfoldTree</code> were given to me up-front, I would double-check that I had read them right; if so, I'd give up on solving it at this point, and say \"hey, these types you gave me are no good, what am I supposed to do now?\". There are a few possible answers to this complaint: first, surely the signature of <code>createSimpleTree</code> will be fixed; second, either the Tree type will be amended (with a corresponding change to <code>unfoldTree</code>), or you will be given some sort of guarantee that <code>createSimpleTree</code> will never be called with an empty list. At that point you can get back to solving the problem.</p>\n\n<p>If you're instead doing this on your own, I would say to fix the tree type and the signature of <code>unfoldTree</code> yourself. For example, I would start with</p>\n\n<pre><code>data Tree a = Leaf | Node a (Tree a) (Tree a)\n\nunfoldTree :: (a -&gt; Maybe (n, a, a)) -&gt; a -&gt; Tree n\nunfoldTree = undefined -- exercise for the reader\n\ncreateSimpleTree :: [a] -&gt; Tree a\ncreateSimpleTree = unfoldTree f\n  where f = undefined -- exercise for the reader\n</code></pre>\n"}, {"comments": [{"owner": {"reputation": 1247, "user_id": 3485629, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/640b2583577ec470ac273b27f78025d5?s=128&d=identicon&r=PG", "display_name": "basile-henry", "link": "https://stackoverflow.com/users/3485629/basile-henry"}, "edited": false, "score": 0, "creation_date": 1491256741, "post_id": 43195006, "comment_id": 73462806, "body": "If you&#39;re feeling more advanced you can use the <code>splitAt</code> function, and you can apply <i>eta</i> reduction to the definition of <code>createSimpleTree</code>"}], "tags": [], "owner": {"reputation": 1247, "user_id": 3485629, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/640b2583577ec470ac273b27f78025d5?s=128&d=identicon&r=PG", "display_name": "basile-henry", "link": "https://stackoverflow.com/users/3485629/basile-henry"}, "is_accepted": false, "score": 1, "last_activity_date": 1491262425, "last_edit_date": 1495539999, "creation_date": 1491256682, "answer_id": 43195006, "question_id": 43194203, "link": "https://stackoverflow.com/questions/43194203/how-do-i-use-this-unfold-function/43195006#43195006", "title": "How do I use this unfold function?", "body": "<p><a href=\"https://stackoverflow.com/a/43194864/625403\">amalloy's answer</a> makes perfect sense in explaining the type that is required from <code>createSimpleTree</code> and the problem that appears when passing an empty list.</p>\n\n<p>If you have to solve <code>createSimpleTree</code> as is and don't care about creating a partial function (function that is not defined for all its inputs), here is how you could go about it:</p>\n\n\n\n<pre><code>createSimpleTree :: [a] -&gt; Tree a\ncreateSimpleTree xs = unfoldTree go xs\n  where\n    go :: [a] -&gt; Either a ([a], [a])\n    go []  = error \"Empty list in createSimpleTree\"\n    go [x] = Left x\n    go xs  =\n      let n = length xs `div` 2\n      in Right (take n xs, drop n xs)\n</code></pre>\n"}], "owner": {"reputation": 247, "user_id": 3746816, "user_type": "registered", "accept_rate": 89, "profile_image": "https://www.gravatar.com/avatar/30722dac9f0fb2f4d3c743c0dc6d1d5d?s=128&d=identicon&r=PG&f=1", "display_name": "Liably", "link": "https://stackoverflow.com/users/3746816/liably"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 1527, "favorite_count": 0, "accepted_answer_id": 43194864, "answer_count": 2, "score": 0, "last_activity_date": 1491294804, "creation_date": 1491253356, "last_edit_date": 1491254267, "question_id": 43194203, "link": "https://stackoverflow.com/questions/43194203/how-do-i-use-this-unfold-function", "title": "How do I use this unfold function?", "body": "<p>I've been tasked with using this fold function which \"takes a list and returns a tree\".</p>\n\n<pre><code>data Tree a = Tip a | Node (Tree a) (Tree a)\n\n\nunfoldTree :: (a -&gt; Either n (a, a)) -&gt; a -&gt; Tree n\nunfoldTree g h  =\n   case g h of\n     Right (l, r) -&gt; Node (unfoldTree g l) (unfoldTree g r)\n     Left c       -&gt; Tip c\n</code></pre>\n\n<p><code>a = [Int] n = Int</code></p>\n\n<p>I believe I understand the concept here and I've tried to use the following helper method to test <code>unfoldTree</code></p>\n\n<pre><code>createSimpleTree :: [a] -&gt; Tree x\ncreateSimpleTree xs = unfoldTree (\\ys -&gt; ys (firstHalf ys, secondHalf ys) ) xs\n</code></pre>\n\n<p>Although this does not work I believe it is due to the central line <code>ys -&gt; ys (firstHalf ys, secondHalf ys)</code> as I am unsure how to use the <code>Either</code> (I am unaware of its official name sorry still learning!)</p>\n\n<p>I've tried using lambda here but I'm not sure how to say if it's the LEFT do this if it's the RIGHT do that? Or I could be on the wrong track with that completely.</p>\n\n<p><strong>Question:</strong> How can I use <code>createSimpleTree [1,2,3,4]</code> as to produce a tree with the values?</p>\n"}, {"tags": ["haskell", "haskell-stack"], "comments": [{"owner": {"reputation": 3075, "user_id": 1164871, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/4d6a54a3752ab47170d790085935988f?s=128&d=identicon&r=PG", "display_name": "mgsloan", "link": "https://stackoverflow.com/users/1164871/mgsloan"}, "edited": false, "score": 0, "creation_date": 1491256754, "post_id": 43194175, "comment_id": 73462814, "body": "That&#39;s strange!  libz is used by the zlib package, which is a dependency of the streaming-commons package.  So I would have expected this issue to crop up while compiling the zlib package, rather than when compiling store.  If you do &quot;stack exec -- ghc-pkg unregister zlib&quot; and try building again, what happens?"}, {"owner": {"reputation": 14781, "user_id": 630160, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/4445f21326af525a8ad19af7e3ae41a8?s=128&d=identicon&r=PG", "display_name": "epsilonhalbe", "link": "https://stackoverflow.com/users/630160/epsilonhalbe"}, "edited": false, "score": 1, "creation_date": 1491293142, "post_id": 43194175, "comment_id": 73474878, "body": "Do you have the systems libz-dev package installed?"}], "answers": [{"tags": [], "owner": {"reputation": 163, "user_id": 1726808, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/8jisB.jpg?s=128&g=1", "display_name": "lordqwerty", "link": "https://stackoverflow.com/users/1726808/lordqwerty"}, "is_accepted": false, "score": 2, "last_activity_date": 1491303356, "creation_date": 1491303356, "answer_id": 43205226, "question_id": 43194175, "link": "https://stackoverflow.com/questions/43194175/haskell-stack-store-0-3-libz-so/43205226#43205226", "title": "haskell-stack store-0.3: libz.so", "body": "<p>Turns out I needed to add the two flags to specify zlib include and lib:</p>\n\n<pre><code>--extra-include-dirs\n--extra-lib-dirs\n</code></pre>\n"}, {"tags": [], "owner": {"reputation": 275, "user_id": 6028958, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/WILL9.png?s=128&g=1", "display_name": "krk", "link": "https://stackoverflow.com/users/6028958/krk"}, "is_accepted": false, "score": 1, "last_activity_date": 1558960409, "creation_date": 1558960409, "answer_id": 56326181, "question_id": 43194175, "link": "https://stackoverflow.com/questions/43194175/haskell-stack-store-0-3-libz-so/56326181#56326181", "title": "haskell-stack store-0.3: libz.so", "body": "<p>In my case, <code>libz-dev</code> package installation solved it.</p>\n\n<pre><code>sudo apt install libz-dev\n</code></pre>\n"}], "owner": {"reputation": 163, "user_id": 1726808, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/8jisB.jpg?s=128&g=1", "display_name": "lordqwerty", "link": "https://stackoverflow.com/users/1726808/lordqwerty"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 133, "favorite_count": 0, "answer_count": 2, "score": 3, "last_activity_date": 1558960409, "creation_date": 1491253213, "last_edit_date": 1500235305, "question_id": 43194175, "link": "https://stackoverflow.com/questions/43194175/haskell-stack-store-0-3-libz-so", "title": "haskell-stack store-0.3: libz.so", "body": "<p>When building <code>haskell-stack</code> from I get the following error:</p>\n\n<pre><code>store-0.3: download\nstore-0.3: configure\nstore-0.3: build\n\n--  While building package store-0.3 using:\n      /tmp/haskell-stack-20170403-52407-1rpyzwy/stack-1.4.0/.stack/setup-exe-cache/x86_64-linux/Cabal-simple_mPHDZzAJ_1.22.5.0_ghc-7.10.3 --builddir=.stack-work/dist/x86_64-linux/Cabal-1.22.5.0 build --ghc-options \" -ddump-hi -ddump-to-file\"\n    Process exited with code: ExitFailure 1\n    Logs have been written to: /tmp/haskell-stack-20170403-52407-1rpyzwy/stack-1.4.0/.stack-work/logs/store-0.3.log\n\n    Configuring store-0.3...\n    Building store-0.3...\n    Preprocessing library store-0.3...\n    [ 1 of 11] Compiling Data.Store.Streaming.Internal ( src/Data/Store/Streaming/Internal.hs, .stack-work/dist/x86_64-linux/Cabal-1.22.5.0/build/Data/Store/Streaming/Internal.o )\n    [ 2 of 11] Compiling System.IO.ByteBuffer ( src/System/IO/ByteBuffer.hs, .stack-work/dist/x86_64-linux/Cabal-1.22.5.0/build/System/IO/ByteBuffer.o )\n    [ 3 of 11] Compiling Data.Store.Impl  ( src/Data/Store/Impl.hs, .stack-work/dist/x86_64-linux/Cabal-1.22.5.0/build/Data/Store/Impl.o )\n    [ 4 of 11] Compiling Data.Store.TH    ( src/Data/Store/TH.hs, .stack-work/dist/x86_64-linux/Cabal-1.22.5.0/build/Data/Store/TH.o )\n    [ 5 of 11] Compiling Data.Store.TH.Internal ( src/Data/Store/TH/Internal.hs, .stack-work/dist/x86_64-linux/Cabal-1.22.5.0/build/Data/Store/TH/Internal.o )\n    [ 6 of 11] Compiling Data.Store.Internal ( src/Data/Store/Internal.hs, .stack-work/dist/x86_64-linux/Cabal-1.22.5.0/build/Data/Store/Internal.o )\n    &lt;command line&gt;: can't load .so/.DLL for: libz.so (libz.so: cannot open shared object file: No such file or directory)\n</code></pre>\n\n<p>Does anyone know what might be causing this? I have <code>zlib</code> development installed on my machine.</p>\n"}, {"tags": ["scala", "haskell", "typeclass", "implicit"], "answers": [{"comments": [{"owner": {"reputation": 18456, "user_id": 1198559, "user_type": "registered", "accept_rate": 70, "profile_image": "https://i.stack.imgur.com/bOjLe.png?s=128&g=1", "display_name": "jhegedus", "link": "https://stackoverflow.com/users/1198559/jhegedus"}, "edited": false, "score": 0, "creation_date": 1491253750, "post_id": 43193847, "comment_id": 73461503, "body": "Nice, thanks, is this approach widely known ? Somehow I have not seen it yet."}, {"owner": {"reputation": 29444, "user_id": 3072788, "user_type": "registered", "accept_rate": 82, "profile_image": "https://www.gravatar.com/avatar/220a45c2fcff7e7358d144551b116205?s=128&d=identicon&r=PG&f=1", "display_name": "Alec", "link": "https://stackoverflow.com/users/3072788/alec"}, "reply_to_user": {"reputation": 18456, "user_id": 1198559, "user_type": "registered", "accept_rate": 70, "profile_image": "https://i.stack.imgur.com/bOjLe.png?s=128&g=1", "display_name": "jhegedus", "link": "https://stackoverflow.com/users/1198559/jhegedus"}, "edited": false, "score": 0, "creation_date": 1491254112, "post_id": 43193847, "comment_id": 73461660, "body": "@jhegedus I think this is a standard approach. I can&#39;t recall having seen it documented anywhere, but I&#39;m certain it is. There is only one nasty gotcha with regards to superclasses - in some cases, Scala gives up trying to satisfy the superclass because it thinks it might be looping (check out <code>Lazy</code> in Shapeless)."}, {"owner": {"reputation": 29444, "user_id": 3072788, "user_type": "registered", "accept_rate": 82, "profile_image": "https://www.gravatar.com/avatar/220a45c2fcff7e7358d144551b116205?s=128&d=identicon&r=PG&f=1", "display_name": "Alec", "link": "https://stackoverflow.com/users/3072788/alec"}, "reply_to_user": {"reputation": 18456, "user_id": 1198559, "user_type": "registered", "accept_rate": 70, "profile_image": "https://i.stack.imgur.com/bOjLe.png?s=128&g=1", "display_name": "jhegedus", "link": "https://stackoverflow.com/users/1198559/jhegedus"}, "edited": false, "score": 0, "creation_date": 1491254144, "post_id": 43193847, "comment_id": 73461674, "body": "@jhegedus Actually, Shapeless is a great place to read more about this sort of thing!"}, {"owner": {"reputation": 18456, "user_id": 1198559, "user_type": "registered", "accept_rate": 70, "profile_image": "https://i.stack.imgur.com/bOjLe.png?s=128&g=1", "display_name": "jhegedus", "link": "https://stackoverflow.com/users/1198559/jhegedus"}, "edited": false, "score": 0, "creation_date": 1491254268, "post_id": 43193847, "comment_id": 73461733, "body": "Yeah, I really should start to read about Shapeless before going to sleep in the evenings."}, {"owner": {"reputation": 11826, "user_id": 480674, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/fad9d486ce723011505e86c2136937ca?s=128&d=identicon&r=PG", "display_name": "pedrofurla", "link": "https://stackoverflow.com/users/480674/pedrofurla"}, "reply_to_user": {"reputation": 18456, "user_id": 1198559, "user_type": "registered", "accept_rate": 70, "profile_image": "https://i.stack.imgur.com/bOjLe.png?s=128&g=1", "display_name": "jhegedus", "link": "https://stackoverflow.com/users/1198559/jhegedus"}, "edited": false, "score": 0, "creation_date": 1491254585, "post_id": 43193847, "comment_id": 73461870, "body": "An answer I gave the other day that might help you understand what you were doing wrong, @jhegedus: <a href=\"http://stackoverflow.com/questions/43108537/how-to-define-typeclass-instance-for-higher-kinded-types-in-scala/\" title=\"how to define typeclass instance for higher kinded types in scala\">stackoverflow.com/questions/43108537/&hellip;</a>"}, {"owner": {"reputation": 18456, "user_id": 1198559, "user_type": "registered", "accept_rate": 70, "profile_image": "https://i.stack.imgur.com/bOjLe.png?s=128&g=1", "display_name": "jhegedus", "link": "https://stackoverflow.com/users/1198559/jhegedus"}, "reply_to_user": {"reputation": 11826, "user_id": 480674, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/fad9d486ce723011505e86c2136937ca?s=128&d=identicon&r=PG", "display_name": "pedrofurla", "link": "https://stackoverflow.com/users/480674/pedrofurla"}, "edited": false, "score": 0, "creation_date": 1491280797, "post_id": 43193847, "comment_id": 73468729, "body": "@pedrofurla as far as I can see your answer is also about using implicit defs instead of implicit objects, right ?"}, {"owner": {"reputation": 11826, "user_id": 480674, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/fad9d486ce723011505e86c2136937ca?s=128&d=identicon&r=PG", "display_name": "pedrofurla", "link": "https://stackoverflow.com/users/480674/pedrofurla"}, "reply_to_user": {"reputation": 18456, "user_id": 1198559, "user_type": "registered", "accept_rate": 70, "profile_image": "https://i.stack.imgur.com/bOjLe.png?s=128&g=1", "display_name": "jhegedus", "link": "https://stackoverflow.com/users/1198559/jhegedus"}, "edited": false, "score": 0, "creation_date": 1491318884, "post_id": 43193847, "comment_id": 73494067, "body": "@jhegedus, that&#39;s accidental. It&#39;s about existentials vs universal quantifiers."}], "tags": [], "owner": {"reputation": 29444, "user_id": 3072788, "user_type": "registered", "accept_rate": 82, "profile_image": "https://www.gravatar.com/avatar/220a45c2fcff7e7358d144551b116205?s=128&d=identicon&r=PG&f=1", "display_name": "Alec", "link": "https://stackoverflow.com/users/3072788/alec"}, "is_accepted": true, "score": 5, "last_activity_date": 1491252974, "last_edit_date": 1491252974, "creation_date": 1491251988, "answer_id": 43193847, "question_id": 43193602, "link": "https://stackoverflow.com/questions/43193602/two-parameter-functions-in-type-class-instances-of-higher-kinded-types-in-scala/43193847#43193847", "title": "Two parameter functions in type class instances of higher kinded types in Scala, how to translate this simple Haskell code to Scala?", "body": "<p>Trying to make instances as <code>object</code>s is not the right approach. It almost always is better to just make anonymous <code>def</code>s that implement the typeclass.</p>\n\n<pre><code>object Instance { \n  // Corresponds to `instance C (A a)`\n  implicit def instance[T]: C[A[T]] = new C[A[T]] {\n    override def toStr: A[T] =&gt; A[T] =&gt; String = x =&gt; y =&gt; \"AA\"\n  }\n}\n\nobject Main{\n  println(Instance.instance.toStr(A(1))(A(2)))\n  println(Instance.instance.toStr(A(1))(A(\"bla\"))) // doesn't compile\n}\n</code></pre>\n\n<p>So what was wrong with your approach? The root of the problem is that the wildcards <code>_</code> do not need to be equal - they can individually match different types (recall that <code>_</code> is just sugar for <code>x forSome { type x }</code>). To get around that, we need to introduce a generic parameter (which is quantified over the <em>whole</em> instance). The natural place to put that is on the <code>object</code>, but this is the second problem: objects don't accept generic parameters.</p>\n\n<h3>Why use <code>implicit def</code></h3>\n\n<p><code>implicit def</code> (with no arguments) is perfect for making type class instances. You can:</p>\n\n<ul>\n<li>introduce type variables as generic parameters on the method (as I did above with <code>B</code>)</li>\n<li><p>introduce superclass constraints as bounds on those generics. For example, </p>\n\n<pre><code>// Corresponds to `instance C a =&gt; C (A a)`\nimplicit def instance[T: C]: C[A[T]] = new C[A[T]] {\n  override def toStr: A[T] =&gt; A[T] =&gt; String = x =&gt; y =&gt; (x,y) match {\n    case (A(bx),A(by)) =&gt; \"[\" + implicitly[C[T]].toStr(bx)(by) + \"]\"\n  }\n}\n\n// Corresponds to `instance C String`\nimplicit val strInstance: C[String] = new C[String] {\n  override def toStr: String =&gt; String =&gt; String = x =&gt; y =&gt; x + y\n}\n</code></pre>\n\n<p>And with that, <code>implicitly[C[A[A[String]]]].toStr(A(A(\"hi\")))(A(A(\"world\")))</code> returns <code>[[hiworld]]</code>.</p></li>\n</ul>\n"}], "owner": {"reputation": 18456, "user_id": 1198559, "user_type": "registered", "accept_rate": 70, "profile_image": "https://i.stack.imgur.com/bOjLe.png?s=128&g=1", "display_name": "jhegedus", "link": "https://stackoverflow.com/users/1198559/jhegedus"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 81, "favorite_count": 0, "accepted_answer_id": 43193847, "answer_count": 1, "score": 2, "last_activity_date": 1491253306, "creation_date": 1491251040, "last_edit_date": 1491253306, "question_id": 43193602, "link": "https://stackoverflow.com/questions/43193602/two-parameter-functions-in-type-class-instances-of-higher-kinded-types-in-scala", "title": "Two parameter functions in type class instances of higher kinded types in Scala, how to translate this simple Haskell code to Scala?", "body": "<p>The following Haskell code:</p>\n\n<pre class=\"lang-hs prettyprint-override\"><code>main = putStrLn $ \"bla \" ++ (toStr (A 1) (A 2))\n--main2 = putStrLn $ \"bla \" ++ (toStr (A 1) (A \"String\")) -- does not compile, as it should\nmain3 = putStrLn $ \"bla \" ++ (toStr (A \"String\") (A \"String\"))\n\ndata A a = A a deriving Show -- (1) data type declaration \n\nclass C a where -- (2) type class declaration\n   toStr :: a-&gt; a-&gt;String\n\ninstance C (A a) where -- (3) instance declaration\n   toStr (A x) (A y) = \"AA\"\n</code></pre>\n\n<p>corresponds (roughly) to the following Scala code: </p>\n\n<pre><code>case class A[B](b:B) // (1) data type declaration\n\ntrait C[A] { // (2) type class declaration\n  def toStr: A =&gt;A=&gt; String\n  // this would correspond to \"instance C (A a) where\"\n}\n\n\nobject Instance { \n  implicit object Instance extends C[A[_]] { // (3) instance declaration\n    override def toStr: A[_] =&gt;A[_] =&gt; String = x =&gt; x=&gt; \"AA\"\n//    override def toStr[T]: A[T] =&gt;A[T] =&gt; String = x =&gt; x=&gt; \"AA\" // this does not override anything, does not compile\n  }\n}\n\nobject Main{\n  println(Instance.Instance.toStr(A(1))(A(2)))\n  println(Instance.Instance.toStr(A(1))(A(\"bla\"))) // this compiles, but it should not\n}\n</code></pre>\n\n<p>How can I define <code>override def toStr: A[_] =&gt;A[_] =&gt; String = x =&gt; x=&gt; \"AA\"</code> such that <code>println(Instance.Instance.toStr(A(1))(A(\"bla\")))</code> does not compile ?</p>\n\n<p>As it (<code>putStrLn $ \"bla \" ++ (toStr (A 1) (A \"String\"))</code>) does not compile in the Haskell code ?</p>\n\n<p>My attempt was <code>override def toStr[T]: A[T] =&gt;A[T] =&gt; String = x =&gt; x=&gt; \"bla\"</code> but that does not compile because that does not override <code>def toStr: A =&gt;A=&gt; String\n</code> in <code>C</code>.</p>\n\n<p>In summary, how can I translate the above Haskell code to Scala ? </p>\n"}, {"tags": ["haskell"], "comments": [{"owner": {"reputation": 1247, "user_id": 3485629, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/640b2583577ec470ac273b27f78025d5?s=128&d=identicon&r=PG", "display_name": "basile-henry", "link": "https://stackoverflow.com/users/3485629/basile-henry"}, "edited": false, "score": 0, "creation_date": 1491271774, "post_id": 43190443, "comment_id": 73466667, "body": "I think you most likely have the wrong version of GHC installed. The page you linked to says you need GHC 7.4. Instead of installing this particular version manually, I would recommend using <a href=\"https://docs.haskellstack.org/en/stable/README/\" rel=\"nofollow noreferrer\">stack</a> to install <code>dph-examples</code> which will manage the version of GHC along with dependencies better than cabal by itself."}, {"owner": {"reputation": 389, "user_id": 4509491, "user_type": "registered", "accept_rate": 47, "profile_image": "https://www.gravatar.com/avatar/0859ed4716e7342be98b7792250caa78?s=128&d=identicon&r=PG&f=1", "display_name": "monolith937", "link": "https://stackoverflow.com/users/4509491/monolith937"}, "reply_to_user": {"reputation": 1247, "user_id": 3485629, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/640b2583577ec470ac273b27f78025d5?s=128&d=identicon&r=PG", "display_name": "basile-henry", "link": "https://stackoverflow.com/users/3485629/basile-henry"}, "edited": false, "score": 0, "creation_date": 1491496047, "post_id": 43190443, "comment_id": 73590264, "body": "Alright, how would I go about installing DPH with stack or does it come with the installation of stack? Forgive me, but I&#39;m new to installing packages using the terminal"}], "owner": {"reputation": 389, "user_id": 4509491, "user_type": "registered", "accept_rate": 47, "profile_image": "https://www.gravatar.com/avatar/0859ed4716e7342be98b7792250caa78?s=128&d=identicon&r=PG&f=1", "display_name": "monolith937", "link": "https://stackoverflow.com/users/4509491/monolith937"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 237, "favorite_count": 0, "answer_count": 0, "score": 0, "last_activity_date": 1491239219, "creation_date": 1491239219, "question_id": 43190443, "link": "https://stackoverflow.com/questions/43190443/haskell-installing-dph-package", "title": "Haskell installing DPH package", "body": "<p>Newbie here, I need to install the DPH library for my course, but I'm not really sure how. I follow this link: <a href=\"https://wiki.haskell.org/GHC/Data_Parallel_Haskell#Where_to_get_it\" rel=\"nofollow noreferrer\">https://wiki.haskell.org/GHC/Data_Parallel_Haskell#Where_to_get_it</a> , but when I run <code>cabal install dph-examples</code> this is the result:</p>\n\n<pre><code>Resolving dependencies...\ncabal: Could not resolve dependencies:\ntrying: dph-examples-0.7.0.5 (user goal)\nnext goal: base (dependency of dph-examples-0.7.0.5)\nrejecting: base-4.8.2.0/installed-0d6... (conflict: dph-examples =&gt;\nbase==4.6.*)\nrejecting: base-4.9.1.0, 4.9.0.0, 4.8.2.0, 4.8.1.0, 4.8.0.0, 4.7.0.2, 4.7.0.1,\n4.7.0.0, 4.6.0.1, 4.6.0.0, 4.5.1.0, 4.5.0.0, 4.4.1.0, 4.4.0.0, 4.3.1.0,\n4.3.0.0, 4.2.0.2, 4.2.0.1, 4.2.0.0, 4.1.0.0, 4.0.0.0, 3.0.3.2, 3.0.3.1 (global\nconstraint requires installed instance)\nDependency tree exhaustively searched.\n</code></pre>\n\n<p>Something tells me this didn't go as planned, I am unsure of what to do now.</p>\n"}, {"tags": ["haskell"], "comments": [{"owner": {"reputation": 14609, "user_id": 667648, "user_type": "registered", "accept_rate": 84, "profile_image": "https://i.stack.imgur.com/mTpbt.jpg?s=128&g=1", "display_name": "Dair", "link": "https://stackoverflow.com/users/667648/dair"}, "edited": false, "score": 2, "creation_date": 1491235499, "post_id": 43189284, "comment_id": 73451743, "body": "Can you write out the base case?"}, {"owner": {"reputation": 62421, "user_id": 216164, "user_type": "registered", "accept_rate": 89, "profile_image": "https://www.gravatar.com/avatar/786f224adbe0784cdf7d0f15476061fe?s=128&d=identicon&r=PG", "display_name": "Thomas M. DuBuisson", "link": "https://stackoverflow.com/users/216164/thomas-m-dubuisson"}, "edited": false, "score": 3, "creation_date": 1491237393, "post_id": 43189284, "comment_id": 73452837, "body": "I&#39;m not clear on what you want and what you&#39;ve tried.  I think you want <code>update = (++[n]) . filter (&#47;= n)</code>, right?  You should show some code.  Showing what you tried helps you learn instead of using the internet as a write-me-a-code-snippet service."}, {"owner": {"reputation": 1735, "user_id": 2892792, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/5DNyi.jpg?s=128&g=1", "display_name": "Lazersmoke", "link": "https://stackoverflow.com/users/2892792/lazersmoke"}, "edited": false, "score": 3, "creation_date": 1491238286, "post_id": 43189284, "comment_id": 73453329, "body": "If you are trying to implement sets, you should probably look at <code>Data.Set</code> instead of using linked lists."}, {"owner": {"reputation": 75362, "user_id": 625403, "user_type": "registered", "accept_rate": 82, "profile_image": "https://www.gravatar.com/avatar/786eed7da67079cb5d63a49d469af25b?s=128&d=identicon&r=PG", "display_name": "amalloy", "link": "https://stackoverflow.com/users/625403/amalloy"}, "reply_to_user": {"reputation": 1735, "user_id": 2892792, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/5DNyi.jpg?s=128&g=1", "display_name": "Lazersmoke", "link": "https://stackoverflow.com/users/2892792/lazersmoke"}, "edited": false, "score": 1, "creation_date": 1491241142, "post_id": 43189284, "comment_id": 73454843, "body": "@Lazersmoke If one is trying to <i>use</i> sets, that is good advice. If one is trying to <i>implement</i> sets, then using an existing implementation defeats the purpose."}], "answers": [{"tags": [], "owner": {"reputation": 893, "user_id": 6248287, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/tPegr.jpg?s=128&g=1", "display_name": "\u019b\u019b\u019b", "link": "https://stackoverflow.com/users/6248287/%c6%9b%c6%9b%c6%9b"}, "is_accepted": true, "score": 1, "last_activity_date": 1491241871, "creation_date": 1491241871, "answer_id": 43191190, "question_id": 43189284, "link": "https://stackoverflow.com/questions/43189284/writing-update-function-haskell/43191190#43191190", "title": "Writing update function haskell", "body": "<p>This is what I would write the update function based on my understanding of your question.</p>\n\n<pre><code>update :: Int -&gt; [Int] -&gt; [Int]\nupdate n ns = [ x | x &lt;- ns, x /= n] ++ [n]\n</code></pre>\n"}, {"tags": [], "owner": {"user_type": "does_not_exist", "display_name": "user6428287"}, "is_accepted": false, "score": 1, "last_activity_date": 1491250331, "last_edit_date": 1491250331, "creation_date": 1491247397, "answer_id": 43192705, "question_id": 43189284, "link": "https://stackoverflow.com/questions/43189284/writing-update-function-haskell/43192705#43192705", "title": "Writing update function haskell", "body": "<p>Just in case \"n\" refers to the number of occurrences, and your examples misspecify:</p>\n\n<pre><code>import Data.List (foldl')\n\ncount y  =  foldl' (n x -&gt; if x == y then n + 1 else n) 0\nupdate y xs = filter (/= y) xs ++ replicate (count y xs) y\n</code></pre>\n\n<p>Or, using the single-traversal <code>partition</code>:</p>\n\n<pre><code>update y xs = let (ys, other) = partition (== y) xs in other ++ ys\n</code></pre>\n"}], "owner": {"user_type": "does_not_exist", "display_name": "user7649927"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 470, "favorite_count": 0, "accepted_answer_id": 43191190, "answer_count": 2, "score": 0, "last_activity_date": 1491250331, "creation_date": 1491235334, "question_id": 43189284, "link": "https://stackoverflow.com/questions/43189284/writing-update-function-haskell", "title": "Writing update function haskell", "body": "<p>I want to create an update function of the following type of 2 inputs. All it does is that it finds n same integers in a list of given integers, deletes them and gives back a new list with all the previous elements plus the n deleted integer in the tail.</p>\n\n<pre><code>Int-&gt;[Int]-&gt;[Int]\n</code></pre>\n\n<p>Example:</p>\n\n<pre><code>&gt;update 1 []\n[1]\n&gt;update 2 [2]\n[2]\n&gt;update 3 [3,4,3,5,3,6]\n[4,5,6,3]\n</code></pre>\n"}, {"tags": ["haskell"], "answers": [{"tags": [], "owner": {"reputation": 51584, "user_id": 839246, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/9b0573c2b936b12828dd1e4cc04206dc?s=128&d=identicon&r=PG&f=1", "display_name": "bheklilr", "link": "https://stackoverflow.com/users/839246/bheklilr"}, "is_accepted": true, "score": 1, "last_activity_date": 1491233793, "creation_date": 1491233793, "answer_id": 43188742, "question_id": 43188452, "link": "https://stackoverflow.com/questions/43188452/simple-haskell-average-function-gives-couldnt-match-type-error/43188742#43188742", "title": "Simple Haskell Average Function Gives Couldn&#39;t Match Type Error", "body": "<p>The expression <code>a + b + c</code> will have type <code>Int</code>, and <code>/</code> is not even defined for <code>Int</code>.  GHC will probably infer that <code>3</code> has type <code>Float</code> though.  You have to explicitly cast the type in this situation, so you'd need to do</p>\n\n<pre><code>fromIntegral (a + b + c) / 3\n</code></pre>\n\n<p>The <code>fromIntegral</code> function takes an <code>Integral a =&gt; a</code> type like <code>Int</code> or <code>Integer</code> and converts it to a <code>Num b =&gt; b</code> type, which could also be <code>Int</code> or <code>Integral</code>, or <code>Float</code>, <code>Double</code>, <code>Complex Double</code>, and even custom numeric types.</p>\n"}, {"tags": [], "owner": {"reputation": 1735, "user_id": 2892792, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/5DNyi.jpg?s=128&g=1", "display_name": "Lazersmoke", "link": "https://stackoverflow.com/users/2892792/lazersmoke"}, "is_accepted": false, "score": 0, "last_activity_date": 1491233813, "creation_date": 1491233813, "answer_id": 43188748, "question_id": 43188452, "link": "https://stackoverflow.com/questions/43188452/simple-haskell-average-function-gives-couldnt-match-type-error/43188748#43188748", "title": "Simple Haskell Average Function Gives Couldn&#39;t Match Type Error", "body": "<p><code>(/) :: Fractional a =&gt; a -&gt; a -&gt; a</code>, which means <code>/</code> takes two fractional numbers of the same type and returns a fractional number of the same type. You are giving it an <code>Int</code> as an argument, which is not fractional, and asking for a <code>Float</code> as output. You must convert your <code>Int</code> to a <code>Float</code> before giving it to <code>/</code>. Use <code>fromIntegral :: Int -&gt; Float</code>. <code>fromIntegral (a + b + c) / 3</code>. You could also leave off the type signature and ask ghci for the inferred type.</p>\n"}, {"tags": [], "owner": {"reputation": 123, "user_id": 1715792, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/312311702558c5c9c878ee5fe6056e45?s=128&d=identicon&r=PG", "display_name": "Miguel A. Baldi H&#246;rlle", "link": "https://stackoverflow.com/users/1715792/miguel-a-baldi-h%c3%b6rlle"}, "is_accepted": false, "score": 1, "last_activity_date": 1491234373, "creation_date": 1491234373, "answer_id": 43188952, "question_id": 43188452, "link": "https://stackoverflow.com/questions/43188452/simple-haskell-average-function-gives-couldnt-match-type-error/43188952#43188952", "title": "Simple Haskell Average Function Gives Couldn&#39;t Match Type Error", "body": "<p>You should use <a href=\"http://hackage.haskell.org/package/base-4.9.1.0/docs/Prelude.html#t:Fractional\" rel=\"nofollow noreferrer\">Fractional</a>, to support Real division:</p>\n\n<pre><code>averageThree :: Fractional a =&gt; a -&gt; a -&gt; a -&gt; a\naverageThree a b c = (a + b + c) / 3\n</code></pre>\n"}], "owner": {"reputation": 133, "user_id": 7122314, "user_type": "registered", "accept_rate": 67, "profile_image": "https://www.gravatar.com/avatar/4f690d41d4687cba4052df317f819c09?s=128&d=identicon&r=PG&f=1", "display_name": "Kai D", "link": "https://stackoverflow.com/users/7122314/kai-d"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 303, "favorite_count": 0, "accepted_answer_id": 43188742, "answer_count": 3, "score": 0, "last_activity_date": 1491234373, "creation_date": 1491232890, "question_id": 43188452, "link": "https://stackoverflow.com/questions/43188452/simple-haskell-average-function-gives-couldnt-match-type-error", "title": "Simple Haskell Average Function Gives Couldn&#39;t Match Type Error", "body": "<p>All the other average questions I've seen are much more complicated than what I need. I am very new to Haskell and I'm currently working through The Craft of Functional Programming 2nd Edition. </p>\n\n<p>In chapter 3 there is an exercise to write a simple function to average 3 integers. The function type signature is provided and I used it in my solution. I wrote:</p>\n\n<pre><code>averageThree :: Int -&gt; Int -&gt; Int -&gt; Float\naverageThree a b c = (a + b + c) / 3\n</code></pre>\n\n<p>I use ghci for compilation and when I try and load my file I get \"Couldn't match expected type <code>Float' with actual type</code>Int'\". How do I fix this error?</p>\n"}, {"tags": ["haskell", "cabal", "haskell-stack"], "comments": [{"owner": {"reputation": 3075, "user_id": 1164871, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/4d6a54a3752ab47170d790085935988f?s=128&d=identicon&r=PG", "display_name": "mgsloan", "link": "https://stackoverflow.com/users/1164871/mgsloan"}, "edited": false, "score": 1, "creation_date": 1491257133, "post_id": 43188272, "comment_id": 73462954, "body": "Which version of stack are you using?  Since version 1.3.0, the --no-build flag shouldn&#39;t be as necessary - it will skip a full build and instead only run the &quot;initial build steps&quot; necessary."}, {"owner": {"reputation": 4538, "user_id": 499478, "user_type": "registered", "accept_rate": 63, "profile_image": "https://www.gravatar.com/avatar/791526e67831fbd70e3d179a6c585b44?s=128&d=identicon&r=PG", "display_name": "Wizek", "link": "https://stackoverflow.com/users/499478/wizek"}, "reply_to_user": {"reputation": 3075, "user_id": 1164871, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/4d6a54a3752ab47170d790085935988f?s=128&d=identicon&r=PG", "display_name": "mgsloan", "link": "https://stackoverflow.com/users/1164871/mgsloan"}, "edited": false, "score": 0, "creation_date": 1491258330, "post_id": 43188272, "comment_id": 73463379, "body": "I have been using 1.1.2 mostly as of now. I&#39;ve installed and tried 1.3.0 alongside, but an issue has kept me from using it -- it eludes what exactly right now. I&#39;m glad to read what you write, that gives me more of a motivation to switch over."}], "answers": [{"comments": [{"owner": {"reputation": 4538, "user_id": 499478, "user_type": "registered", "accept_rate": 63, "profile_image": "https://www.gravatar.com/avatar/791526e67831fbd70e3d179a6c585b44?s=128&d=identicon&r=PG", "display_name": "Wizek", "link": "https://stackoverflow.com/users/499478/wizek"}, "edited": false, "score": 0, "creation_date": 1491254158, "post_id": 43192574, "comment_id": 73461683, "body": "Thanks! The <code>--no-build</code> flag may be what I&#39;ve been looking for! Giving it a try now."}], "tags": [], "owner": {"reputation": 4071, "user_id": 3806046, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/5fedf50ce7cd2659bca902e9a2969158?s=128&d=identicon&r=PG&f=1", "display_name": "jkeuhlen", "link": "https://stackoverflow.com/users/3806046/jkeuhlen"}, "is_accepted": true, "score": 4, "last_activity_date": 1491246927, "last_edit_date": 1592644375, "creation_date": 1491246927, "answer_id": 43192574, "question_id": 43188272, "link": "https://stackoverflow.com/questions/43188272/how-to-load-stack-ghci-without-compiling-linking-the-whole-project/43192574#43192574", "title": "How to load `stack ghci` without compiling &amp; linking the whole project?", "body": "<p>From the <a href=\"https://docs.haskellstack.org/en/stable/ghci/\" rel=\"nofollow noreferrer\">Haskell Tool Stack Documentation</a>:</p>\n<blockquote>\n<p><strong>Speeding up initial load</strong></p>\n<p>There are two ways to speed up the initial startup of ghci:</p>\n<ul>\n<li><code>--no-build</code>, to skip an initial build step. This only works if the dependencies have already been built.</li>\n</ul>\n</blockquote>\n<p>You can also have <code>stack ghci</code> skip loading sources (if you know you only want one file loaded in, and can do it by hand) by using:</p>\n<blockquote>\n<ul>\n<li><code>--no-load</code>, to skip loading all defined modules into ghci. You can then directly use <code>:load MyModule</code> to load a specific module in your project.</li>\n</ul>\n</blockquote>\n"}, {"tags": [], "owner": {"reputation": 4538, "user_id": 499478, "user_type": "registered", "accept_rate": 63, "profile_image": "https://www.gravatar.com/avatar/791526e67831fbd70e3d179a6c585b44?s=128&d=identicon&r=PG", "display_name": "Wizek", "link": "https://stackoverflow.com/users/499478/wizek"}, "is_accepted": false, "score": 1, "last_activity_date": 1491255421, "creation_date": 1491255421, "answer_id": 43194737, "question_id": 43188272, "link": "https://stackoverflow.com/questions/43188272/how-to-load-stack-ghci-without-compiling-linking-the-whole-project/43194737#43194737", "title": "How to load `stack ghci` without compiling &amp; linking the whole project?", "body": "<p>I've just realized that <code>-fobject-code</code> may also play a part in this. I'm unsure where it is being set (not on the command line, not in the <code>.cabal</code>/<code>package.yaml</code> file and not in <code>~/.ghci</code> either).</p>\n\n<p>Nevertheless when I negate it with <code>--ghci-options=-fbyte-code</code> the recompilation doesn't seem to be taking place.</p>\n\n<p>I still hope to hear others' responses as I'd like to understand more thoroughly why the <code>-fobject-code</code> may require minutes for full recompilation on initial load, since <code>:reload</code>ing only takes about a second after a file has changed. (E.g. with <code>ghcid</code> too.)</p>\n"}], "owner": {"reputation": 4538, "user_id": 499478, "user_type": "registered", "accept_rate": 63, "profile_image": "https://www.gravatar.com/avatar/791526e67831fbd70e3d179a6c585b44?s=128&d=identicon&r=PG", "display_name": "Wizek", "link": "https://stackoverflow.com/users/499478/wizek"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 349, "favorite_count": 1, "accepted_answer_id": 43192574, "answer_count": 2, "score": 2, "last_activity_date": 1491255421, "creation_date": 1491232376, "question_id": 43188272, "link": "https://stackoverflow.com/questions/43188272/how-to-load-stack-ghci-without-compiling-linking-the-whole-project", "title": "How to load `stack ghci` without compiling &amp; linking the whole project?", "body": "<p>Does for anyone else <code>stack</code> compile &amp; link the whole project when only <code>stack ghci</code> is asked for?</p>\n\n<p>Shouldn't it skip the former and jump into <code>ghci</code> right away to load sources? I've observed it to do both for me on most of my projects and therefore it's doing seemingly superfluous work. Is this by design, or might have I misconfigured some of my stack projects?</p>\n\n<p>Perhaps is this done by <code>cabal</code> underneath without <code>stack</code> asking for it?</p>\n\n<p>And at any rate, is there something I could do to skip the compilation + linking when I just want to enter <code>stack ghci</code>?</p>\n"}, {"tags": ["haskell", "ghc"], "comments": [{"owner": {"reputation": 24266, "user_id": 946226, "user_type": "registered", "accept_rate": 59, "profile_image": "https://www.gravatar.com/avatar/5823d09208b1e4b63bbfcd189492032c?s=128&d=identicon&r=PG", "display_name": "Joachim Breitner", "link": "https://stackoverflow.com/users/946226/joachim-breitner"}, "edited": false, "score": 1, "creation_date": 1491231206, "post_id": 43187004, "comment_id": 73448809, "body": "If there is no way, and you can think of one that work well, you should propose it to GHC, either on <a href=\"https://ghc.haskell.org/trac/ghc/\" rel=\"nofollow noreferrer\">ghc.haskell.org/trac/ghc</a> or maybe via a GHC proposal at <a href=\"https://github.com/ghc-proposals/ghc-proposals/\" rel=\"nofollow noreferrer\">github.com/ghc-proposals/ghc-proposals</a>"}, {"owner": {"reputation": 100185, "user_id": 3234959, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/93bb12ca0f93dfddb33880316f7e66c2?s=128&d=identicon&r=PG&f=1", "display_name": "chi", "link": "https://stackoverflow.com/users/3234959/chi"}, "edited": false, "score": 2, "creation_date": 1491231391, "post_id": 43187004, "comment_id": 73448933, "body": "The best I can do: <code>ghc -e &quot;import System.Environment&quot; -e &quot;:set args a b c&quot; -e &quot;getArgs&quot;</code>"}, {"owner": {"reputation": 4538, "user_id": 499478, "user_type": "registered", "accept_rate": 63, "profile_image": "https://www.gravatar.com/avatar/791526e67831fbd70e3d179a6c585b44?s=128&d=identicon&r=PG", "display_name": "Wizek", "link": "https://stackoverflow.com/users/499478/wizek"}, "reply_to_user": {"reputation": 100185, "user_id": 3234959, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/93bb12ca0f93dfddb33880316f7e66c2?s=128&d=identicon&r=PG&f=1", "display_name": "chi", "link": "https://stackoverflow.com/users/3234959/chi"}, "edited": false, "score": 0, "creation_date": 1491233090, "post_id": 43187004, "comment_id": 73450158, "body": "@chi I like your comment&#39;s direction. Maybe a shell function could be defined along those lines. I&#39;ve started to fiddle with putting one together."}, {"owner": {"reputation": 4538, "user_id": 499478, "user_type": "registered", "accept_rate": 63, "profile_image": "https://www.gravatar.com/avatar/791526e67831fbd70e3d179a6c585b44?s=128&d=identicon&r=PG", "display_name": "Wizek", "link": "https://stackoverflow.com/users/499478/wizek"}, "edited": false, "score": 1, "creation_date": 1491234076, "post_id": 43187004, "comment_id": 73450796, "body": "This is as far as I got so far: <code>function ghce () { echo &quot;$1&quot; | xargs ghc -e &quot;:set args ${@:2}&quot; }; ghce &#39;-e &quot;import System.Environment&quot; -e &quot;getArgs&quot;&#39; &quot;1 2 3&quot;</code> <code>[&quot;1&quot;,&quot;2&quot;,&quot;3&quot;]</code>. Which is incorrect, since its output should be <code>[&quot;1 2 3&quot;]</code>, and not need quotes: <code>&quot;1 2 3&quot;</code> -&gt; <code>1 2 3</code>. And I would like if it also handled <code>1 &#39;2 3&#39; 4</code> as <code>[&quot;1&quot;,&quot;2 3&quot;,&quot;4&quot;]</code>, but at this point I get <code>target \u20182 3\u2019 is not a module name or a source file</code> error. Not sure why."}, {"owner": {"reputation": 100185, "user_id": 3234959, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/93bb12ca0f93dfddb33880316f7e66c2?s=128&d=identicon&r=PG&f=1", "display_name": "chi", "link": "https://stackoverflow.com/users/3234959/chi"}, "edited": false, "score": 0, "creation_date": 1491244861, "post_id": 43187004, "comment_id": 73456930, "body": "I guess the issue here is the missing escaping. One would need <code>ghc -e &quot;:set args \\&quot;1 2 3\\&quot;&quot; -e &quot;getArgs&quot; </code> which might be tricky to obtain in the shell (?). I&#39;m pretty sure there is a way, but my bash-fu is not so advanced. Superuser.SE surely knows."}], "answers": [{"tags": [], "owner": {"reputation": 24266, "user_id": 946226, "user_type": "registered", "accept_rate": 59, "profile_image": "https://www.gravatar.com/avatar/5823d09208b1e4b63bbfcd189492032c?s=128&d=identicon&r=PG", "display_name": "Joachim Breitner", "link": "https://stackoverflow.com/users/946226/joachim-breitner"}, "is_accepted": false, "score": 1, "last_activity_date": 1491231153, "creation_date": 1491231153, "answer_id": 43187827, "question_id": 43187004, "link": "https://stackoverflow.com/questions/43187004/is-it-possible-to-pass-command-line-arguments-when-running-haskell-code-with-gh/43187827#43187827", "title": "Is it possible to pass command line arguments when running Haskell code with `ghc -e`?", "body": "<p>To answer the second part of the question:</p>\n\n<pre><code>Prelude&gt; :help :main\n Commands available from the prompt: \n   \u2026\n   :main [&lt;arguments&gt; ...]     run the main function with the given arguments\n   \u2026\nPrelude&gt; let main = System.Environment.getArgs &gt;&gt;= print\nPrelude&gt; :main foo bar\n[\"foo\",\"bar\"]\n</code></pre>\n"}], "owner": {"reputation": 4538, "user_id": 499478, "user_type": "registered", "accept_rate": 63, "profile_image": "https://www.gravatar.com/avatar/791526e67831fbd70e3d179a6c585b44?s=128&d=identicon&r=PG", "display_name": "Wizek", "link": "https://stackoverflow.com/users/499478/wizek"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 222, "favorite_count": 1, "answer_count": 1, "score": 3, "last_activity_date": 1491231153, "creation_date": 1491228872, "last_edit_date": 1491229524, "question_id": 43187004, "link": "https://stackoverflow.com/questions/43187004/is-it-possible-to-pass-command-line-arguments-when-running-haskell-code-with-gh", "title": "Is it possible to pass command line arguments when running Haskell code with `ghc -e`?", "body": "<p>Intuitively, I've tried </p>\n\n<pre><code>$ ghc -e \"import System.Environment\" -e \"getArgs\" -- a b c\nghc: unrecognised flag: --\ndid you mean one of:\n  -n\n  -F\n  -v\n\nUsage: For basic information, try the `--help' option.\n$\n</code></pre>\n\n<p>...without success.</p>\n\n<p>I was expecting the output to be along the lines of <code>[\"a\",\"b\",\"c\"]</code>.</p>\n\n<p><a href=\"https://downloads.haskell.org/~ghc/8.0.2/docs/html/users_guide/using.html#expression-evaluation-mode\" rel=\"nofollow noreferrer\">The docs here</a> don't seem to mention any way to pass cli arguments through. </p>\n\n<p>AFAIK piping in stdio works as expected.</p>\n\n<p>And perhaps if it is not possible to pass in arguments with <code>ghc -e</code>, maybe it's still possible with <code>ghci</code> to supply both some code, some arguments to it, run, then exit?</p>\n"}, {"tags": ["haskell"], "comments": [{"owner": {"reputation": 2179, "user_id": 412549, "user_type": "registered", "accept_rate": 50, "profile_image": "https://www.gravatar.com/avatar/a194a155579e30bda0926705aeb9d165?s=128&d=identicon&r=PG&f=1", "display_name": "Franky", "link": "https://stackoverflow.com/users/412549/franky"}, "edited": false, "score": 1, "creation_date": 1491226774, "post_id": 43186151, "comment_id": 73445409, "body": "What is the purpose of returning a <code>Maybe [a]</code> instead of a simple <code>[a]</code>?"}, {"owner": {"reputation": 107, "user_id": 5444440, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/SczvL.jpg?s=128&g=1", "display_name": "Rory Harrison", "link": "https://stackoverflow.com/users/5444440/rory-harrison"}, "reply_to_user": {"reputation": 2179, "user_id": 412549, "user_type": "registered", "accept_rate": 50, "profile_image": "https://www.gravatar.com/avatar/a194a155579e30bda0926705aeb9d165?s=128&d=identicon&r=PG&f=1", "display_name": "Franky", "link": "https://stackoverflow.com/users/412549/franky"}, "edited": false, "score": 0, "creation_date": 1491227014, "post_id": 43186151, "comment_id": 73445577, "body": "You&#39;re right, I should just use an [a]"}, {"owner": {"reputation": 1735, "user_id": 2892792, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/5DNyi.jpg?s=128&g=1", "display_name": "Lazersmoke", "link": "https://stackoverflow.com/users/2892792/lazersmoke"}, "edited": false, "score": 0, "creation_date": 1491232453, "post_id": 43186151, "comment_id": 73449699, "body": "These are not sets, they are lists. If you want sets, you should use <code>Data.Set</code> because that will enforce actual set conditions (no order, no duplicate members) and supports faster operations, including <code>O(m*log(n&#47;m+1)), m &lt;= n</code> set difference."}], "answers": [{"comments": [{"owner": {"reputation": 75362, "user_id": 625403, "user_type": "registered", "accept_rate": 82, "profile_image": "https://www.gravatar.com/avatar/786eed7da67079cb5d63a49d469af25b?s=128&d=identicon&r=PG", "display_name": "amalloy", "link": "https://stackoverflow.com/users/625403/amalloy"}, "edited": false, "score": 2, "creation_date": 1491234144, "post_id": 43186243, "comment_id": 73450842, "body": "<code>if foo then True else bar</code> is better written as <code>foo || bar</code>."}], "tags": [], "owner": {"reputation": 420, "user_id": 6496011, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/f5da204ac4ee7e380ab27daa05996a2a?s=128&d=identicon&r=PG&f=1", "display_name": "Antisthenes", "link": "https://stackoverflow.com/users/6496011/antisthenes"}, "is_accepted": true, "score": 4, "last_activity_date": 1491227631, "last_edit_date": 1491227631, "creation_date": 1491226951, "answer_id": 43186243, "question_id": 43186151, "link": "https://stackoverflow.com/questions/43186151/removing-a-subset-from-a-set/43186243#43186243", "title": "Removing a subset from a set", "body": "<p>You dont need to wrap result in Maybe, because you may always return empty List.</p>\n\n<p>Easiest implementation is:</p>\n\n<pre><code>removeSet xs ys = filter (not . (`elem` xs)) ys \n</code></pre>\n\n<p>After eta reduce:</p>\n\n<pre><code>removeSet xs = filter (not.(`elem`xs))\n</code></pre>\n\n<p>For more code-golfing point-free (point-less) style, it may also be written as:</p>\n\n<pre><code>removeSet = filter.((not.).(flip elem))\n</code></pre>\n\n<p>For more direct solution using recursion you may always use:</p>\n\n<pre><code>removeSet _  []    = []\nremoveSet [] ys    = ys\nremoveSet xs (y:ys)= if element y xs then removeSet xs ys else y:removeSet xs ys\n  where element x [] = False\n        element x (l:ls) = if l == x then True else element x ls\n</code></pre>\n"}], "owner": {"reputation": 107, "user_id": 5444440, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/SczvL.jpg?s=128&g=1", "display_name": "Rory Harrison", "link": "https://stackoverflow.com/users/5444440/rory-harrison"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 544, "favorite_count": 0, "accepted_answer_id": 43186243, "answer_count": 1, "score": 1, "last_activity_date": 1491241022, "creation_date": 1491226686, "last_edit_date": 1491241022, "question_id": 43186151, "link": "https://stackoverflow.com/questions/43186151/removing-a-subset-from-a-set", "title": "Removing a subset from a set", "body": "<p>This may be trivial but I'm stuck on writing a function that removes a subset of a set from the set itself (finding it's complement).<br>\nMy function is in the form:</p>\n\n<pre><code>removeSubset :: (Eq a) =&gt; [a] -&gt; [a] -&gt; [a] \nremoveSet [] ys = Just ys\nremoveSet --This is where I don't know how to remove the subset\n</code></pre>\n\n<p>Any help would be greatly appreciated as I am new to Haskell.  </p>\n"}, {"tags": ["haskell", "haskell-stack"], "comments": [{"owner": {"reputation": 3282, "user_id": 1042705, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/6f3b9beabf332ae9a36dbaa9ef661ea3?s=128&d=identicon&r=PG", "display_name": "Irfan", "link": "https://stackoverflow.com/users/1042705/irfan"}, "edited": false, "score": 0, "creation_date": 1491226019, "post_id": 43185686, "comment_id": 73444825, "body": "What are you trying to achieve ?"}, {"owner": {"reputation": 29966, "user_id": 637669, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/0227e5d5eaceb8ae2f751df38d421764?s=128&d=identicon&r=PG", "display_name": "arrowd", "link": "https://stackoverflow.com/users/637669/arrowd"}, "edited": false, "score": 0, "creation_date": 1491226734, "post_id": 43185686, "comment_id": 73445380, "body": "<code>readline</code> is a C library, IIRC, so you have to install it first. You&#39;d also need some sort of <code>readline-devel</code> package, if you are running Linux."}], "answers": [{"tags": [], "owner": {"reputation": 33, "user_id": 1545549, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/075240b523e95484393e9dacb09676e5?s=128&d=identicon&r=PG", "display_name": "Ayman Osman", "link": "https://stackoverflow.com/users/1545549/ayman-osman"}, "is_accepted": false, "score": 2, "last_activity_date": 1491237342, "creation_date": 1491237342, "answer_id": 43189865, "question_id": 43185686, "link": "https://stackoverflow.com/questions/43185686/readline-dependencie-error-with-stack/43189865#43189865", "title": "Readline dependencie error with stack", "body": "<p>Say your are on OSX</p>\n\n<pre><code>$ brew install readline\n[...]\nFor compilers to find this software you may need to set:\n    LDFLAGS:  -L/usr/local/opt/readline/lib\n    CPPFLAGS: -I/usr/local/opt/readline/include\n</code></pre>\n\n<p>Now you know where the library got installed you can set some environmental variables that <code>./configure</code> will pick up</p>\n\n<pre><code>LDFLAGS=-L/usr/local/opt/readline/lib \\\nCFLAGS=-I/usr/local/opt/readline/include \\\nstack install readline --extra-include-dirs=/usr/local/opt/readline/include --extra-lib-dirs=/usr/local/opt/readline/lib\n</code></pre>\n"}], "owner": {"reputation": 9, "user_id": 7808762, "user_type": "registered", "profile_image": "https://lh3.googleusercontent.com/-lOznjrL2sEI/AAAAAAAAAAI/AAAAAAAAAEQ/TldRpU5KYOo/photo.jpg?sz=128", "display_name": "Tomas Lopez", "link": "https://stackoverflow.com/users/7808762/tomas-lopez"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 279, "favorite_count": 0, "answer_count": 1, "score": 1, "last_activity_date": 1491237342, "creation_date": 1491225413, "question_id": 43185686, "link": "https://stackoverflow.com/questions/43185686/readline-dependencie-error-with-stack", "title": "Readline dependencie error with stack", "body": "<p>I have this error when I add this dependencie to my project.cabal file.</p>\n\n<pre><code>Warning: defaultUserHooks in Setup script is deprecated.\nConfiguring readline-1.0.3.0...\nchecking for gcc... /usr/bin/gcc\nchecking for C compiler default output file name... a.out\nchecking whether the C compiler works... yes\nchecking whether we are cross compiling... no\nchecking for suffix of executables... \nchecking for suffix of object files... o\nchecking whether we are using the GNU C compiler... yes\nchecking whether /usr/bin/gcc accepts -g... yes\nchecking for /usr/bin/gcc option to accept ISO C89... none needed\nchecking for GNUreadline.framework... checking for readline... no\nchecking for tputs in -lncurses... yes\nchecking for readline in -lreadline... no\nchecking for rl_readline_version... no\nconfigure: error: readline not found, so this package cannot be built\nSee `config.log' for more details.\n</code></pre>\n\n<p>what I have to do to solve this?</p>\n"}, {"tags": ["function", "haskell", "types"], "comments": [{"owner": {"reputation": 314794, "user_id": 67579, "user_type": "registered", "accept_rate": 81, "profile_image": "https://i.stack.imgur.com/BJXub.png?s=128&g=1", "display_name": "Willem Van Onsem", "link": "https://stackoverflow.com/users/67579/willem-van-onsem"}, "edited": false, "score": 1, "creation_date": 1491220586, "post_id": 43184002, "comment_id": 73440650, "body": "Why should the type be <code>Ord u</code>?"}, {"owner": {"reputation": 111, "user_id": 6115152, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/d52b9123fd6770864378ecbe41d1eb71?s=128&d=identicon&r=PG&f=1", "display_name": "user6115152", "link": "https://stackoverflow.com/users/6115152/user6115152"}, "reply_to_user": {"reputation": 314794, "user_id": 67579, "user_type": "registered", "accept_rate": 81, "profile_image": "https://i.stack.imgur.com/BJXub.png?s=128&g=1", "display_name": "Willem Van Onsem", "link": "https://stackoverflow.com/users/67579/willem-van-onsem"}, "edited": false, "score": 0, "creation_date": 1491221071, "post_id": 43184002, "comment_id": 73440993, "body": "The exercise says it must be ord u"}, {"owner": {"reputation": 314794, "user_id": 67579, "user_type": "registered", "accept_rate": 81, "profile_image": "https://i.stack.imgur.com/BJXub.png?s=128&g=1", "display_name": "Willem Van Onsem", "link": "https://stackoverflow.com/users/67579/willem-van-onsem"}, "edited": false, "score": 0, "creation_date": 1491221129, "post_id": 43184002, "comment_id": 73441038, "body": "but nowhere in your code you use some function that <code>Ord</code> is offering: you do not compare with <code>&lt;</code>, <code>&gt;</code>,..."}, {"owner": {"reputation": 111, "user_id": 6115152, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/d52b9123fd6770864378ecbe41d1eb71?s=128&d=identicon&r=PG&f=1", "display_name": "user6115152", "link": "https://stackoverflow.com/users/6115152/user6115152"}, "reply_to_user": {"reputation": 314794, "user_id": 67579, "user_type": "registered", "accept_rate": 81, "profile_image": "https://i.stack.imgur.com/BJXub.png?s=128&g=1", "display_name": "Willem Van Onsem", "link": "https://stackoverflow.com/users/67579/willem-van-onsem"}, "edited": false, "score": 0, "creation_date": 1491221215, "post_id": 43184002, "comment_id": 73441103, "body": "Yeah i have to sort the values as well but that&#39;s something it doesn&#39;t concern me right now"}, {"owner": {"reputation": 1735, "user_id": 2892792, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/5DNyi.jpg?s=128&g=1", "display_name": "Lazersmoke", "link": "https://stackoverflow.com/users/2892792/lazersmoke"}, "edited": false, "score": 0, "creation_date": 1491222487, "post_id": 43184002, "comment_id": 73442128, "body": "Fwiw this is the Applicative instance for lists. You can use <code>&lt;*&gt;</code>."}], "answers": [{"tags": [], "owner": {"reputation": 314794, "user_id": 67579, "user_type": "registered", "accept_rate": 81, "profile_image": "https://i.stack.imgur.com/BJXub.png?s=128&g=1", "display_name": "Willem Van Onsem", "link": "https://stackoverflow.com/users/67579/willem-van-onsem"}, "is_accepted": true, "score": 4, "last_activity_date": 1491221969, "last_edit_date": 1491221969, "creation_date": 1491221579, "answer_id": 43184369, "question_id": 43184002, "link": "https://stackoverflow.com/questions/43184002/error-inferred-type-is-not-general-enough/43184369#43184369", "title": "ERROR - Inferred type is not general enough", "body": "<p>The reason why you get this error is because there are <strong>conflicting type signatures</strong>:</p>\n\n<pre><code>apply :: <b>Ord u =&gt; [v-&gt;u]-&gt;[v]-&gt;[u]</b>\napply p s = <b>myApply p s []</b>              --line 59--\n\nmyApply :: <b>Ord u =&gt; [v-&gt;u]-&gt;[u]-&gt;[u]-&gt;[u]</b>\nmyApply f_list num_list starterlist\n    | null f_list = starterlist\n    | otherwise = myApply (tail f_list) (num_list) ( applyList (head     f_list) num_list starterlist )</code></pre>\n\n<p>As you can see, the <code>apply</code> function immediately calls the <code>myApply</code> function. Since <code>myApply</code> has signature <code>[v -&gt; u] -&gt; [u] -&gt; [u] -&gt; [u]</code>, it means that <code>apply</code> can only have signature <code>[v-&gt;u] -&gt; [u] -&gt; [u]</code>.</p>\n\n<p>A quick fix is to <strong>generalize</strong> both <code>myApply</code> and <code>myApplyList</code> to <code>[v -&gt; u] -&gt; [v] -&gt; [u] -&gt; [u]</code>. Now the compile will also detect an error you've made in your <code>applyList</code> function: you forgot to call <code>f</code> on the <code>head num_list</code>. So you can fix it and obtain the following code:</p>\n\n<pre><code>apply :: Ord u =&gt; [v-&gt;u]-&gt;[v]-&gt;[u]             \napply p s = myApply p s []              --line 59--\n\nmyApply :: Ord u =&gt; [v-&gt;u]-&gt;<b>[v]</b>-&gt;[u]-&gt;[u]\nmyApply f_list num_list starterlist\n    | null f_list = starterlist\n    | otherwise = myApply (tail f_list) (num_list) ( applyList (head     f_list) num_list starterlist )\n\napplyList :: Ord u =&gt; (v-&gt;u)-&gt;<b>[v]</b>-&gt;[u]-&gt;[u]\napplyList f num_list starterlist\n    | null num_list = starterlist\n    | otherwise = applyList f (tail num_list) ( (<b>f (</b>head num_list<b>)</b>) :     starterlist )</code></pre>\n\n<p>Nevertheless, this code is quite <em>unelegant</em> and uses way to many functions and arguments. You can replace it entirely with a single list comprehension:</p>\n\n<pre><code>apply :: [v -&gt; u] -&gt; [v] -&gt; [u]\napply fs xs = [f x | f &lt;- fs, x &lt;- xs]\n</code></pre>\n\n<p>Based on your comment you also have to sort the values later in the process, you can do this by using the <code>sort :: Ord a =&gt; [a] -&gt; [a]</code> builtin:</p>\n\n<pre><code>-- sorting variant\napply :: <b>Ord u =&gt;</b> [v -&gt; u] -&gt; [v] -&gt; [u]\napply fs xs = <b>sort</b> [f x | f &lt;- fs, x &lt;- xs]</code></pre>\n\n<p>This generates the required result:</p>\n\n<pre><code>Prelude Data.List&gt; (\\fs xs -&gt; sort [f x | f &lt;- fs, x &lt;- xs]) [(^2),(^3),(^4)] [2..8]\n[4,8,9,16,16,25,27,36,49,64,64,81,125,216,256,343,512,625,1296,2401,4096]\n</code></pre>\n"}, {"tags": [], "owner": {"reputation": 7105, "user_id": 236007, "user_type": "registered", "accept_rate": 90, "profile_image": "https://i.stack.imgur.com/BiYes.jpg?s=128&g=1", "display_name": "Emre Sevin&#231;", "link": "https://stackoverflow.com/users/236007/emre-sevin%c3%a7"}, "is_accepted": false, "score": 4, "last_activity_date": 1491226828, "creation_date": 1491226828, "answer_id": 43186192, "question_id": 43184002, "link": "https://stackoverflow.com/questions/43184002/error-inferred-type-is-not-general-enough/43186192#43186192", "title": "ERROR - Inferred type is not general enough", "body": "<p>Variation on a theme: taking into Willem's comment indicating that this is a pretty convoluted code (making it difficult to analyze) I'd start with a simpler code, without stating any types at all, to first get a simple working case (that is, a function that produces the expected output), still using a helper function, and recursion:</p>\n\n<pre><code>apply fs     []  = []\napply []     xs  = []\napply (f:fs) xs  = (helper f xs) ++ (apply fs xs)\n\nhelper f []     = []\nhelper f (x:xs) = f x : helper f xs\n</code></pre>\n\n<p>Then I would ask the Haskell compiler to give me information about what type signature it inferred:</p>\n\n<pre><code>*Main&gt; :t apply\napply :: [t1 -&gt; t] -&gt; [t1] -&gt; [t]\n</code></pre>\n\n<p>By realizing that <code>t1 -&gt; t</code> maps to your <code>v-&gt;u</code>, I can see that the type signature can also be written as:</p>\n\n<pre><code>[v -&gt; u] -&gt; [v] -&gt; [u] \n</code></pre>\n\n<p>Doing the similar for <code>helper</code>, you will end up with the following:</p>\n\n<pre><code>apply :: [v-&gt;u] -&gt; [v] -&gt; [u]             \napply fs     []  = []\napply []     xs  = []\napply (f:fs) xs  = (helper f xs) ++ (apply fs xs)\n\nhelper :: (v -&gt; u) -&gt; [v] -&gt; [u]\nhelper f []     = []\nhelper f (x:xs) = f x : helper f xs\n</code></pre>\n\n<p>From here, you can work your way by adding <code>Ord</code> constraint, and build up sorting functionality, etc.</p>\n"}], "owner": {"reputation": 111, "user_id": 6115152, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/d52b9123fd6770864378ecbe41d1eb71?s=128&d=identicon&r=PG&f=1", "display_name": "user6115152", "link": "https://stackoverflow.com/users/6115152/user6115152"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 242, "favorite_count": 0, "accepted_answer_id": 43184369, "answer_count": 2, "score": 3, "last_activity_date": 1491239101, "creation_date": 1491220519, "last_edit_date": 1491239101, "question_id": 43184002, "link": "https://stackoverflow.com/questions/43184002/error-inferred-type-is-not-general-enough", "title": "ERROR - Inferred type is not general enough", "body": "<p>I am trying to write a simple higher order function in Haskell which takes two arguments:</p>\n\n<ol>\n<li>A list of functions of any type.</li>\n<li>A list of (Numbers or <code>String</code>s or <code>Bool</code>ean, etc) --> any type</li>\n</ol>\n\n<p>The function should apply all the functions in the first list to all the elements in the the second list, store the values in a list, and return the list. An example of the program is:</p>\n\n<pre><code>Main&gt; apply [(^2),(^3),(^4)] [2..8]\n--result: --[4,8,9,16,25,27,32,36,49,64,81,125,128,216,256,343,512,625,1296,2401,4096]\n</code></pre>\n\n<p>The type of the function must be:</p>\n\n<pre><code>apply :: Ord u =&gt; [v-&gt;u]-&gt;[v]-&gt;[u]\n</code></pre>\n\n<p>To do that I've used two helper functions and used recursion. My program is this:</p>\n\n<pre><code>apply :: Ord u =&gt; [v-&gt;u]-&gt;[v]-&gt;[u]             \napply p s = myApply p s []              --line 59--\n\nmyApply :: Ord u =&gt; [v-&gt;u]-&gt;[u]-&gt;[u]-&gt;[u]\nmyApply f_list num_list starterlist\n    | null f_list = starterlist\n    | otherwise = myApply (tail f_list) (num_list) ( applyList (head     f_list) num_list starterlist )\n\napplyList :: Ord u =&gt; (v-&gt;u)-&gt;[u]-&gt;[u]-&gt;[u]\napplyList f num_list starterlist\n    | null num_list = starterlist\n    | otherwise = applyList f (tail num_list) ( (head num_list) :     starterlist )\n</code></pre>\n\n<p>I get the error:</p>\n\n<pre><code>ERROR \"Lab2.hs\":59 - Inferred type is not general enough\n*** Expression    : applyList\n*** Expected type : Ord a =&gt; (b -&gt; a) -&gt; [a] -&gt; [b] -&gt; [a]\n*** Inferred type : Ord a =&gt; (a -&gt; a) -&gt; [a] -&gt; [a] -&gt; [a]\n</code></pre>\n\n<p>Any idea what is wrong the with types?</p>\n"}, {"tags": ["haskell"], "answers": [{"comments": [{"owner": {"reputation": 11, "user_id": 7807955, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/c6afac70a46259426162613e4a4acf2d?s=128&d=identicon&r=PG", "display_name": "Frank Fischer", "link": "https://stackoverflow.com/users/7807955/frank-fischer"}, "edited": false, "score": 0, "creation_date": 1491219717, "post_id": 43182994, "comment_id": 73440054, "body": "thx a lot ... I have to chew that now slowly :-) But right now I reckognized that my understanding of list comprehension was much too naive: its quite a beast."}], "tags": [], "owner": {"reputation": 100892, "user_id": 745903, "user_type": "registered", "accept_rate": 74, "profile_image": "https://www.gravatar.com/avatar/50933f6638836741e620669b3940410e?s=128&d=identicon&r=PG", "display_name": "leftaroundabout", "link": "https://stackoverflow.com/users/745903/leftaroundabout"}, "is_accepted": false, "score": 2, "last_activity_date": 1491227722, "last_edit_date": 1491227722, "creation_date": 1491217531, "answer_id": 43182994, "question_id": 43182750, "link": "https://stackoverflow.com/questions/43182750/two-implementations-for-list-monad-bind-in-the-literature-why-are-they-equivale/43182994#43182994", "title": "Two implementations for List Monad bind in the literature: why are they equivalent?", "body": "<p>List comprehensions are just syntactic sugar. Basically, <code>[f x y | x&lt;-l, y&lt;-m]</code> is sugar for</p>\n\n<pre><code>concatMap (\\x -&gt; concatMap (\\y -&gt; return $ f x y) m) l\n</code></pre>\n\n<p>or equivalently</p>\n\n<pre><code>concat $ fmap (\\x -&gt; concat $ fmap (\\y -&gt; return $ f x y) m) l\n</code></pre>\n\n<p>thus the two implementations are indeed equivalent <em>by definition</em>.</p>\n\n<p>Anyway you can of course manually evaluate the example from the comprehension-based definition, using \u201cintuitive set comprehension\u201d evaluation:</p>\n\n<pre><code>pairs [1,2] [3,4]\n \u2261 do { x &lt;- [1,2]; y &lt;- [3,4]; return (x,y) }\n \u2261 [1,2] &gt;&gt;= \\x -&gt; [3,4] &gt;&gt;= \\y -&gt; return (x,y)\n \u2261 [p | x&lt;-[1,2], p &lt;- (\\\u03be -&gt; [3,4] &gt;&gt;= \\y -&gt; return (\u03be,y)) x]\n \u2261 [p | x&lt;-[1,2], p &lt;- ([3,4] &gt;&gt;= \\y -&gt; return (x,y))]\n \u2261 [p | x&lt;-[1,2], p &lt;- [q | y&lt;-[3,4], q &lt;- (\\\u03c5 -&gt; return (x,\u03c5)) y]]\n \u2261 [p | x&lt;-[1,2], p &lt;- [q | y&lt;-[3,4], q &lt;- return (x,y)]]\n \u2261 [p | x&lt;-[1,2], p &lt;- [q | y&lt;-[3,4], q &lt;- [(x,y)]]]\n \u2261 [p | x&lt;-[1,2], p &lt;- [(x,3), (x,4)]]\n \u2261 [(1,3), (1,4)] ++ [(2,3), (2,4)]\n \u2261 [(1,3), (1,4), (2,3), (2,4)]\n</code></pre>\n"}, {"comments": [{"owner": {"reputation": 11, "user_id": 7807955, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/c6afac70a46259426162613e4a4acf2d?s=128&d=identicon&r=PG", "display_name": "Frank Fischer", "link": "https://stackoverflow.com/users/7807955/frank-fischer"}, "edited": false, "score": 0, "creation_date": 1491219853, "post_id": 43183335, "comment_id": 73440155, "body": "Thank you ... now I learned that there is an implicit concat in list comprehensions."}, {"owner": {"reputation": 1735, "user_id": 2892792, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/5DNyi.jpg?s=128&g=1", "display_name": "Lazersmoke", "link": "https://stackoverflow.com/users/2892792/lazersmoke"}, "edited": false, "score": 0, "creation_date": 1491232858, "post_id": 43183335, "comment_id": 73450024, "body": "Note that list comprehensions are a special case of monad comprehensions, which are a special syntax for do-notation, which is special syntax for <code>&gt;&gt;=</code>, which uses <code>join</code> under the hood. The &quot;implicit concat&quot; is more generally the monadic <code>join :: Monad m =&gt; m (m a) -&gt; m a</code>."}, {"owner": {"reputation": 2231, "user_id": 1027321, "user_type": "registered", "accept_rate": 70, "profile_image": "https://i.stack.imgur.com/KkFZC.jpg?s=128&g=1", "display_name": "jakubdaniel", "link": "https://stackoverflow.com/users/1027321/jakubdaniel"}, "edited": false, "score": 0, "creation_date": 1491233060, "post_id": 43183335, "comment_id": 73450141, "body": "Yes, but explaining <code>&gt;&gt;=</code> implemented in terms of comprehension and explaining that in terms of <code>do</code>-notation and that in terms of <code>&gt;&gt;=</code> is a bit cyclic."}, {"owner": {"reputation": 31243, "user_id": 2751851, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/4ddc0.png?s=128&g=1", "display_name": "duplode", "link": "https://stackoverflow.com/users/2751851/duplode"}, "reply_to_user": {"reputation": 1735, "user_id": 2892792, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/5DNyi.jpg?s=128&g=1", "display_name": "Lazersmoke", "link": "https://stackoverflow.com/users/2892792/lazersmoke"}, "edited": false, "score": 0, "creation_date": 1491239825, "post_id": 43183335, "comment_id": 73454131, "body": "@Lazersmoke Indeed -- that <code>(&gt;&gt;= f) = join . fmap f</code> is relevant here. To avoid confusion, it is also worth mentioning that, as things stand, <code>(&gt;&gt;=)</code> doesn&#39;t <i>literally</i> use <code>join</code> under the hood (though it would of course be possible to implement it that way). <code>join x</code> is currently defined as <code>x &gt;&gt;= id</code>."}, {"owner": {"reputation": 1735, "user_id": 2892792, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/5DNyi.jpg?s=128&g=1", "display_name": "Lazersmoke", "link": "https://stackoverflow.com/users/2892792/lazersmoke"}, "reply_to_user": {"reputation": 31243, "user_id": 2751851, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/4ddc0.png?s=128&g=1", "display_name": "duplode", "link": "https://stackoverflow.com/users/2751851/duplode"}, "edited": false, "score": 0, "creation_date": 1491245375, "post_id": 43183335, "comment_id": 73457222, "body": "@duplode to clarify, I meant &quot;under the hood&quot; in the sense that <code>join</code> is the theoretical fundamental operation on monads, and that <code>&gt;&gt;=</code> is just a nice and equivalent way to define it (using the identity <code>join = (&gt;&gt;= id)</code>)"}, {"owner": {"reputation": 31243, "user_id": 2751851, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/4ddc0.png?s=128&g=1", "display_name": "duplode", "link": "https://stackoverflow.com/users/2751851/duplode"}, "reply_to_user": {"reputation": 1735, "user_id": 2892792, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/5DNyi.jpg?s=128&g=1", "display_name": "Lazersmoke", "link": "https://stackoverflow.com/users/2892792/lazersmoke"}, "edited": false, "score": 0, "creation_date": 1491251693, "post_id": 43183335, "comment_id": 73460487, "body": "( @Lazersmoke Yup -- it&#39;s just that &quot;under the hood&quot; initially made me think more of &quot;in letter&quot; than of &quot;in spirit&quot;.)"}], "tags": [], "owner": {"reputation": 2231, "user_id": 1027321, "user_type": "registered", "accept_rate": 70, "profile_image": "https://i.stack.imgur.com/KkFZC.jpg?s=128&g=1", "display_name": "jakubdaniel", "link": "https://stackoverflow.com/users/1027321/jakubdaniel"}, "is_accepted": false, "score": 0, "last_activity_date": 1491218481, "creation_date": 1491218481, "answer_id": 43183335, "question_id": 43182750, "link": "https://stackoverflow.com/questions/43182750/two-implementations-for-list-monad-bind-in-the-literature-why-are-they-equivale/43183335#43183335", "title": "Two implementations for List Monad bind in the literature: why are they equivalent?", "body": "<p><code>[y | x &lt;- xs, y &lt;- f x]</code> takes all the <code>x</code>s in <code>xs</code> one-by-one and</p>\n\n<ol>\n<li>apply <code>f</code> to them, which is a monadic action <code>a -&gt; [a]</code>, thus the result  is a list of values (<code>[a]</code>)</li>\n<li>the comprehension proceeds to address each <code>y</code> in <code>f x</code> one-by-one</li>\n<li>each <code>y</code> is sent to the output list</li>\n</ol>\n\n<p>this is equivalent to first mapping <code>f</code> over each of the elements of the input list, resulting in a list of nested lists, that are then concatenated. Notice that <code>fmap</code> is <code>map</code> for lists, and you could use <code>concatMap f xs</code> as the definition of <code>xs &gt;&gt;= f</code>.</p>\n"}], "owner": {"reputation": 11, "user_id": 7807955, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/c6afac70a46259426162613e4a4acf2d?s=128&d=identicon&r=PG", "display_name": "Frank Fischer", "link": "https://stackoverflow.com/users/7807955/frank-fischer"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 91, "favorite_count": 1, "answer_count": 2, "score": 1, "last_activity_date": 1491227722, "creation_date": 1491216834, "question_id": 43182750, "link": "https://stackoverflow.com/questions/43182750/two-implementations-for-list-monad-bind-in-the-literature-why-are-they-equivale", "title": "Two implementations for List Monad bind in the literature: why are they equivalent?", "body": "<p>Reading the Monad chapter in \"Programming in Haskell\" 2nd ed. from Graham Hutton, I found this example on page 167 to illustrate the behaviour of the List Monad:</p>\n\n<pre><code>&gt; pairs [1,2] [3,4]\n[(1,3),(1,4),(2,3),(2,4)]    \n</code></pre>\n\n<p>With pairs defined like this:</p>\n\n<pre><code>pairs :: [a] -&gt; [b] -&gt; [(a,b)]\npairs xs ys = do x &lt;- xs\n                 y &lt;- ys\n                 return (x,y)\n</code></pre>\n\n<p>And this implementation of bind:</p>\n\n<pre><code>instance Monad [] where\n   -- (&gt;&gt;=) :: [a] -&gt; (a -&gt; [b]) -&gt; [b]\n   xs &gt;&gt;= f = [y | x &lt;- xs, y &lt;- f x]\n</code></pre>\n\n<p>I tried to understand with pencil and paper how the example worked out, but didn't get it.</p>\n\n<p>Then I found, that in other books the bind operation is defined differently:</p>\n\n<pre><code>...\n   xs &gt;&gt;= f = concat (fmap f xs)\n</code></pre>\n\n<p>With this definition I understand why the example works.\nBut the first definition is the one I found on hackage in the prelude, so I trust its correct.</p>\n\n<p><strong>My question</strong>:</p>\n\n<ul>\n<li>Can anybody explain why the first definition is equivalent to the second?          (Where does the concat-stuff happen in the first one?)</li>\n</ul>\n"}, {"tags": ["haskell", "functor"], "answers": [{"comments": [{"owner": {"reputation": 29444, "user_id": 3072788, "user_type": "registered", "accept_rate": 82, "profile_image": "https://www.gravatar.com/avatar/220a45c2fcff7e7358d144551b116205?s=128&d=identicon&r=PG&f=1", "display_name": "Alec", "link": "https://stackoverflow.com/users/3072788/alec"}, "edited": false, "score": 2, "creation_date": 1491203714, "post_id": 43178579, "comment_id": 73430289, "body": "If you want to get even more &lt;s&gt;unreadable&lt;/s&gt; elegant, you can do <code>fmap g (Arr2 a) = Arr2 ((g .) . a)</code>."}, {"owner": {"reputation": 314794, "user_id": 67579, "user_type": "registered", "accept_rate": 81, "profile_image": "https://i.stack.imgur.com/BJXub.png?s=128&g=1", "display_name": "Willem Van Onsem", "link": "https://stackoverflow.com/users/67579/willem-van-onsem"}, "reply_to_user": {"reputation": 29444, "user_id": 3072788, "user_type": "registered", "accept_rate": 82, "profile_image": "https://www.gravatar.com/avatar/220a45c2fcff7e7358d144551b116205?s=128&d=identicon&r=PG&f=1", "display_name": "Alec", "link": "https://stackoverflow.com/users/3072788/alec"}, "edited": false, "score": 0, "creation_date": 1491203866, "post_id": 43178579, "comment_id": 73430363, "body": "@Alec: yeah. Thanks for that suggestion. Updated."}, {"owner": {"reputation": 57219, "user_id": 33796, "user_type": "registered", "accept_rate": 70, "profile_image": "https://www.gravatar.com/avatar/08727b23ba62e634b32988cdff082663?s=128&d=identicon&r=PG", "display_name": "luqui", "link": "https://stackoverflow.com/users/33796/luqui"}, "edited": false, "score": 2, "creation_date": 1491205748, "post_id": 43178579, "comment_id": 73431362, "body": "When pointfree goes beyond a single argument, I like to use <a href=\"http://conal.net/blog/posts/semantic-editor-combinators\" rel=\"nofollow noreferrer\">SECs</a>.  This <code>(.)</code> section nonsense has never appealed to me"}, {"owner": {"reputation": 747, "user_id": 1970264, "user_type": "registered", "accept_rate": 56, "profile_image": "https://www.gravatar.com/avatar/67f9ece670c7c74328b2f20488fd573c?s=128&d=identicon&r=PG", "display_name": "StalkAlex", "link": "https://stackoverflow.com/users/1970264/stalkalex"}, "edited": false, "score": 0, "creation_date": 1491682299, "post_id": 43178579, "comment_id": 73665316, "body": "How would Applicative instance would look like for the type above?"}], "tags": [], "owner": {"reputation": 314794, "user_id": 67579, "user_type": "registered", "accept_rate": 81, "profile_image": "https://i.stack.imgur.com/BJXub.png?s=128&g=1", "display_name": "Willem Van Onsem", "link": "https://stackoverflow.com/users/67579/willem-van-onsem"}, "is_accepted": true, "score": 5, "last_activity_date": 1491203852, "last_edit_date": 1495540000, "creation_date": 1491203471, "answer_id": 43178579, "question_id": 43178458, "link": "https://stackoverflow.com/questions/43178458/instance-of-a-functor/43178579#43178579", "title": "Instance of a Functor", "body": "<p>The <a href=\"http://hackage.haskell.org/package/base-4.9.1.0/docs/Prelude.html#t:Functor\" rel=\"nofollow noreferrer\"><code>Functor</code></a> class has as definition:</p>\n\n<pre><code>class Functor f where:\n    fmap :: (a -&gt; b) -&gt; f a -&gt; f b\n    (&lt;$) :: a -&gt; f b -&gt; f a\n</code></pre>\n\n<p>The <code>(&lt;$)</code> has a default implementation: <code>(&lt;$) = fmap . const</code> which works fine.</p>\n\n<p>So that means that if we enter a function (<code>g :: a -&gt; b</code>) as first argument, and an <code>Arr2</code> that produces an <code>a</code>, we have to generate an <code>Arr2</code> that calls that <code>g</code> on the <em>outcome</em> of the arrow if it is applied.</p>\n\n<p>As a result the definition of <code>fmap</code> for your <code>Arr2</code> is:</p>\n\n<pre><code>instance Functor (Arr2 e1 e2) where\n  fmap g (Arr2 a) = Arr2 (<b>\\x y -&gt; g (a x y)</b>)</code></pre>\n\n<p>Or more elegantly:</p>\n\n<pre><code>instance Functor (Arr2 e1 e2) where\n  fmap g (Arr2 a) = Arr2 (<b>\\x -&gt; g . (a x)</b>)</code></pre>\n\n<p>Or a more elegant version - commented by <a href=\"https://stackoverflow.com/questions/43178458/haskell-instance-of-a-functor/43178579?noredirect=1#comment73430289_43178579\">@Alec</a>:</p>\n\n<pre><code>instance Functor (Arr2 e1 e2) where\n  fmap g (Arr2 a) = Arr2 (<b>(g .) . a</b>)</code></pre>\n\n<p>(you can convert expressions to <em>pointfree</em> ones using <a href=\"http://pointfree.io/\" rel=\"nofollow noreferrer\">this tool</a>)</p>\n"}, {"tags": [], "owner": {"reputation": 1247, "user_id": 3485629, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/640b2583577ec470ac273b27f78025d5?s=128&d=identicon&r=PG", "display_name": "basile-henry", "link": "https://stackoverflow.com/users/3485629/basile-henry"}, "is_accepted": false, "score": 1, "last_activity_date": 1491272922, "creation_date": 1491272922, "answer_id": 43197297, "question_id": 43178458, "link": "https://stackoverflow.com/questions/43178458/instance-of-a-functor/43197297#43197297", "title": "Instance of a Functor", "body": "<p>The answer provided by <a href=\"https://stackoverflow.com/users/67579/willem-van-onsem\">Willem Van Onsem</a> is very good, I would just like to suggest the use of a language extension that can easily create <code>Functor</code> instances for newtypes: <code>DeriveFunctor</code>.</p>\n\n<p>At the top of your module you can add:</p>\n\n\n\n<pre><code>{-# LANGUAGE DeriveFunctor #-}\n</code></pre>\n\n<p>Then you can automatically derive your <code>Functor</code> instance:</p>\n\n\n\n<pre><code>newtype Arr2 e1 e2 a = Arr2 { getArr2 :: e1 -&gt; e2 -&gt; a } deriving Functor\n</code></pre>\n\n<p>Here's is how I would find out the type of <code>fmap</code> for this instance in GHCi:</p>\n\n\n\n<pre><code>\u03bb &gt; :set -XDeriveFunctor\n\u03bb &gt; newtype Arr2 e1 e2 a = Arr2 { getArr2 :: e1 -&gt; e2 -&gt; a } deriving Functor\n\u03bb &gt; :set -XTypeApplications \n\u03bb &gt; :t fmap @(Arr2 _ _)\nfmap @(Arr2 _ _) :: (a -&gt; b) -&gt; Arr2 t t1 a -&gt; Arr2 t t1 b\n</code></pre>\n"}], "owner": {"reputation": 681, "user_id": 6692318, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/ef3d4764458022d20b0d15c2c7fd3c96?s=128&d=identicon&r=PG&f=1", "display_name": "Atin", "link": "https://stackoverflow.com/users/6692318/atin"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 3232, "favorite_count": 0, "accepted_answer_id": 43178579, "answer_count": 2, "score": 4, "last_activity_date": 1491272922, "creation_date": 1491203088, "last_edit_date": 1491239112, "question_id": 43178458, "link": "https://stackoverflow.com/questions/43178458/instance-of-a-functor", "title": "Instance of a Functor", "body": "<p>I have a following type <code>newtype Arr2 e1 e2 a = Arr2 { getArr2 :: e1 -&gt; e2 -&gt; a }</code>.\nAnd I got to write Functor instance for it, yet i don't really understand how\nI tried </p>\n\n<pre><code>instance Functor (Arr2 e1 e2) where\n  fmap g (Arr2 a) = Arr2 (g a)\n</code></pre>\n\n<p>and </p>\n\n<pre><code>instance Functor (Arr2 e1 e2) where\n  fmap g = g . getArr2\n</code></pre>\n\n<p>which actually results in type </p>\n\n<pre><code>(a -&gt; b) -&gt; Arr2 e1 e2 a -&gt; b\n</code></pre>\n\n<p>instead of desired</p>\n\n<pre><code>(a -&gt; b) -&gt; Arr2 e1 e2 a -&gt; Arr2 e1 e2 b\n</code></pre>\n\n<p>So please, help me</p>\n"}, {"tags": ["c++", "loops", "haskell", "functional-programming", "iteration"], "answers": [{"comments": [{"owner": {"reputation": 29444, "user_id": 3072788, "user_type": "registered", "accept_rate": 82, "profile_image": "https://www.gravatar.com/avatar/220a45c2fcff7e7358d144551b116205?s=128&d=identicon&r=PG&f=1", "display_name": "Alec", "link": "https://stackoverflow.com/users/3072788/alec"}, "edited": false, "score": 0, "creation_date": 1491205479, "post_id": 43177562, "comment_id": 73431213, "body": "@Antisthenes Is it? Maybe. For an algorithm as sequential as Floyd-Warshall, I actually find the above more readable than map&#39;s and fold&#39;s - regardless of the fact that I also have some hard guarantees on the time/space usage (notice that output is an <i>unboxed</i> array). Also, <code>arrays</code> expresses multi-dimensional arrays much more clearly than nested vectors or lists."}, {"owner": {"reputation": 420, "user_id": 6496011, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/f5da204ac4ee7e380ab27daa05996a2a?s=128&d=identicon&r=PG&f=1", "display_name": "Antisthenes", "link": "https://stackoverflow.com/users/6496011/antisthenes"}, "edited": false, "score": 0, "creation_date": 1491205863, "post_id": 43177562, "comment_id": 73431423, "body": "It surely is more efficient than using functional approach, however this slightly misses the point of using Haskell in first place."}, {"owner": {"reputation": 57219, "user_id": 33796, "user_type": "registered", "accept_rate": 70, "profile_image": "https://www.gravatar.com/avatar/08727b23ba62e634b32988cdff082663?s=128&d=identicon&r=PG", "display_name": "luqui", "link": "https://stackoverflow.com/users/33796/luqui"}, "edited": false, "score": 1, "creation_date": 1491205959, "post_id": 43177562, "comment_id": 73431486, "body": "Keep in mind that <code>for</code> will construct a list of return values, only for it to be thrown away.  <a href=\"https://hackage.haskell.org/package/base-4.9.1.0/docs/Control-Monad.html#v:forM_\" rel=\"nofollow noreferrer\"><code>forM_</code></a> exists specifically because this has a cost."}, {"owner": {"reputation": 100185, "user_id": 3234959, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/93bb12ca0f93dfddb33880316f7e66c2?s=128&d=identicon&r=PG&f=1", "display_name": "chi", "link": "https://stackoverflow.com/users/3234959/chi"}, "reply_to_user": {"reputation": 57219, "user_id": 33796, "user_type": "registered", "accept_rate": 70, "profile_image": "https://www.gravatar.com/avatar/08727b23ba62e634b32988cdff082663?s=128&d=identicon&r=PG", "display_name": "luqui", "link": "https://stackoverflow.com/users/33796/luqui"}, "edited": false, "score": 2, "creation_date": 1491211943, "post_id": 43177562, "comment_id": 73434928, "body": "@luqui I&#39;m slowly phasing out <code>Control.Monad.forM_</code> in favor of <code>Data.Foldable.for_</code> in my new code."}, {"owner": {"reputation": 29444, "user_id": 3072788, "user_type": "registered", "accept_rate": 82, "profile_image": "https://www.gravatar.com/avatar/220a45c2fcff7e7358d144551b116205?s=128&d=identicon&r=PG&f=1", "display_name": "Alec", "link": "https://stackoverflow.com/users/3072788/alec"}, "reply_to_user": {"reputation": 100185, "user_id": 3234959, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/93bb12ca0f93dfddb33880316f7e66c2?s=128&d=identicon&r=PG&f=1", "display_name": "chi", "link": "https://stackoverflow.com/users/3234959/chi"}, "edited": false, "score": 0, "creation_date": 1491212141, "post_id": 43177562, "comment_id": 73435067, "body": "@chi Thanks! I keep forgetting about <code>for_</code>. @luqui Good advice - IIRC there is (was?) a recent issue about GHC performing significantly worse with <code>forM</code> (as compared to <code>forM_</code>)."}, {"owner": {"reputation": 75362, "user_id": 625403, "user_type": "registered", "accept_rate": 82, "profile_image": "https://www.gravatar.com/avatar/786eed7da67079cb5d63a49d469af25b?s=128&d=identicon&r=PG", "display_name": "amalloy", "link": "https://stackoverflow.com/users/625403/amalloy"}, "reply_to_user": {"reputation": 420, "user_id": 6496011, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/f5da204ac4ee7e380ab27daa05996a2a?s=128&d=identicon&r=PG&f=1", "display_name": "Antisthenes", "link": "https://stackoverflow.com/users/6496011/antisthenes"}, "edited": false, "score": 1, "creation_date": 1491235859, "post_id": 43177562, "comment_id": 73451955, "body": "@Antisthenes I don&#39;t really agree. One of the nice things about Haskell is that you <i>can</i> do stuff like this, when it&#39;s the clearest way to get something done. You can opt into whatever monads will simplify your problem space, rather than being stuck with the same approach to every problem."}], "tags": [], "owner": {"reputation": 29444, "user_id": 3072788, "user_type": "registered", "accept_rate": 82, "profile_image": "https://www.gravatar.com/avatar/220a45c2fcff7e7358d144551b116205?s=128&d=identicon&r=PG&f=1", "display_name": "Alec", "link": "https://stackoverflow.com/users/3072788/alec"}, "is_accepted": true, "score": 6, "last_activity_date": 1491211997, "last_edit_date": 1491211997, "creation_date": 1491199717, "answer_id": 43177562, "question_id": 43176808, "link": "https://stackoverflow.com/questions/43176808/iterative-procedure-with-nested-loops-in-functional-paradigm/43177562#43177562", "title": "Iterative procedure with nested loops in functional paradigm", "body": "<blockquote>\n  <p>Aside from trying to simulate an imperative procedure in Haskell I can't work out how re-write the above code in a 'pure' functional style.</p>\n</blockquote>\n\n<p>I'm not sure you <em>can</em> always rewrite a fundamentally imperative algorithm in a functional style. That said, here's how one would translate your example in Haskell. Note that in general, whenever you find yourself really needing to have mutable variables for a bit, you probably want to use the <a href=\"https://hackage.haskell.org/package/base-4.9.1.0/docs/Control-Monad-ST.html\" rel=\"nofollow noreferrer\"><code>ST</code> monad</a>. For arrays, you have the efficient <a href=\"https://hackage.haskell.org/package/array-0.5.1.1/docs/Data-Array.html\" rel=\"nofollow noreferrer\"><code>array</code></a> package.</p>\n\n<p>Here's what a full translation of that algorithm can look like</p>\n\n<pre class=\"lang-hs prettyprint-override\"><code>import Data.Array.Unboxed (UArray)\nimport Data.Array.ST (runSTUArray, newListArray, readArray, writeArray)\nimport Data.Maybe (fromMaybe)\nimport Control.Monad (when)\nimport Data.Foldable (for_)\n\n-- | Takes as input the number of vertices, function to weigh edges, and returns\n-- a matrix of the shortest distance between every two vertices.\nfloydWarshall :: Int -&gt; ((Int,Int) -&gt; Maybe Double) -&gt; UArray (Int,Int) Double\nfloydWarshall n weight = runSTUArray $ do\n    -- initialize the array with the right values\n    arr &lt;- newListArray ((0,0),(n-1,n-1))\n                        [ if i == j then 0 else fromMaybe (1 / 0) (weight (i,j))\n                        | i&lt;-[0..(n-1)], j&lt;-[0..(n-1)] ]\n\n    -- iteratively improve the shortest distances\n    for_ [0..(n-1)] $ \\k -&gt;\n      for_ [0..(n-1)] $ \\i -&gt;\n        for_ [0..(n-1)] $ \\j -&gt; do\n          arr_ik &lt;- readArray arr (i,k)\n          arr_kj &lt;- readArray arr (k,j)\n          arr_ij &lt;- readArray arr (i,j)\n          let sum = arr_ik + arr_kj\n          when (sum &lt; arr_ij)\n            (writeArray arr (i,j) sum)\n\n    return arr\n</code></pre>\n"}, {"comments": [{"owner": {"reputation": 29444, "user_id": 3072788, "user_type": "registered", "accept_rate": 82, "profile_image": "https://www.gravatar.com/avatar/220a45c2fcff7e7358d144551b116205?s=128&d=identicon&r=PG&f=1", "display_name": "Alec", "link": "https://stackoverflow.com/users/3072788/alec"}, "edited": false, "score": 0, "creation_date": 1491202652, "post_id": 43177692, "comment_id": 73429776, "body": "Although this could in theory be optimized to one mutable vector, this solution runs the risk of allocating quite a bit of space."}, {"owner": {"reputation": 420, "user_id": 6496011, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/f5da204ac4ee7e380ab27daa05996a2a?s=128&d=identicon&r=PG&f=1", "display_name": "Antisthenes", "link": "https://stackoverflow.com/users/6496011/antisthenes"}, "reply_to_user": {"reputation": 29444, "user_id": 3072788, "user_type": "registered", "accept_rate": 82, "profile_image": "https://www.gravatar.com/avatar/220a45c2fcff7e7358d144551b116205?s=128&d=identicon&r=PG&f=1", "display_name": "Alec", "link": "https://stackoverflow.com/users/3072788/alec"}, "edited": false, "score": 0, "creation_date": 1491204962, "post_id": 43177692, "comment_id": 73430951, "body": "It&#39;s true, that in production it should be profiled for memory usage, however it was specified, that question is about writing it &quot;purely functional style&quot;, which i did in my answer. Of course it may choke on very big matrices however this often is the case when using &quot;purely functional style&quot; with purely functional, immutable data structures."}, {"owner": {"reputation": 100185, "user_id": 3234959, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/93bb12ca0f93dfddb33880316f7e66c2?s=128&d=identicon&r=PG&f=1", "display_name": "chi", "link": "https://stackoverflow.com/users/3234959/chi"}, "edited": false, "score": 1, "creation_date": 1491211515, "post_id": 43177692, "comment_id": 73434638, "body": "Also consider <code>imap (\\j v -&gt; (m!i!k + m!k!j) `min` v)</code>"}], "tags": [], "owner": {"reputation": 420, "user_id": 6496011, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/f5da204ac4ee7e380ab27daa05996a2a?s=128&d=identicon&r=PG&f=1", "display_name": "Antisthenes", "link": "https://stackoverflow.com/users/6496011/antisthenes"}, "is_accepted": false, "score": 4, "last_activity_date": 1491211878, "last_edit_date": 1491211878, "creation_date": 1491200311, "answer_id": 43177692, "question_id": 43176808, "link": "https://stackoverflow.com/questions/43176808/iterative-procedure-with-nested-loops-in-functional-paradigm/43177692#43177692", "title": "Iterative procedure with nested loops in functional paradigm", "body": "<p>The best option is to use Data.Vector package and use ifoldl with nested imaps which will look like this:</p>\n\n<pre><code>{-# LANGUAGE OverloadedLists #-}\n\nimport Data.Vector\n\ntype Matrix a = Vector (Vector a)\n\nfloydwarshall mat = ifoldl (\\m k _ -&gt;\n                               imap (\\i row -&gt;\n                                       imap (\\j v -&gt; \n                                               (m!i!k + m!k!j) `min` v) row) m) mat mat\n</code></pre>\n\n<p>Ifoldl and imap alongside values stored inside vector maps using their indices, which allows you to call values at specific index. The foldl is needed to accumulate all the changes in iterations of k while keeping structure immutable. Inside of imaps you must index inside matrix m which is our accumulator for foldr and which keeps all changes.</p>\n\n<p>If you don't want to import packages, you may always implement imap and ifoldl for stock prelude lists </p>\n\n<pre><code>imap :: (Int -&gt; a -&gt; b) -&gt; [a] -&gt; [b]\nimap f = map (uncurry f) . zip [0,1..]\n\nifoldl :: (b -&gt; Int -&gt; a -&gt; b) -&gt; b -&gt; [a] -&gt; b\nifoldl f acc = foldl (\\ac -&gt; uncurry (f ac)) acc . zip [0,1..]\n</code></pre>\n\n<p>EDITED: According to suggestion by @chi</p>\n"}], "owner": {"reputation": 2837, "user_id": 1427563, "user_type": "registered", "accept_rate": 75, "profile_image": "https://i.stack.imgur.com/sdqnK.png?s=128&g=1", "display_name": "jla", "link": "https://stackoverflow.com/users/1427563/jla"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 223, "favorite_count": 0, "accepted_answer_id": 43177562, "answer_count": 2, "score": 2, "last_activity_date": 1491211997, "creation_date": 1491195816, "question_id": 43176808, "link": "https://stackoverflow.com/questions/43176808/iterative-procedure-with-nested-loops-in-functional-paradigm", "title": "Iterative procedure with nested loops in functional paradigm", "body": "<p>I'm learning functional programming (in Haskell) by re-writing some of my old C++ code. One example I'm working on involves the Floyd-Warshall graph search which runs on a 2D NxN adjacency matrix to find the shortest path between all pairs. It uses three nested for loops to scan the 2D array and iteratively reach a solution.</p>\n\n<p>The C++ code would typically be:</p>\n\n<pre><code>int size = adjacencyMatrix.size();\nfor ( int k = 0; k &lt; size; k++)\n{\n    for ( int i = 0; i &lt; size; i++)\n    {\n        for ( int j = 0; j &lt; size; j++)\n        {\n            double sum = adjacencyMatrix[i][k] + adjacencyMatrix[k][j];\n            if ( sum &lt; adjacencyMatrix[i][j] )\n            {\n                    adjacencyMatrix[i][j] = sum;\n            }\n        }\n    }\n}\n</code></pre>\n\n<p>The key to such a graph search is its iterative method. For example the code above is very sequential; it can only be parallelised to a moderate extent as some calculations can't be done till others have completed.</p>\n\n<p>Furthermore, having access to the index of the matrix means some clever manipulations within the array can be done. The innermost loop of the above graph search uses <code>adjacencyMatrix[i][k]</code>, <code>adjacencyMatrix[k][j]</code> and <code>adjacencyMatrix[i][j]</code>. I'm aware of the <code>map</code> function in Haskell, but that doesn't seem to have the same power and flexibility as using array indices.</p>\n\n<p>Aside from trying to simulate an imperative procedure in Haskell I can't work out how re-write the above code in a 'pure' functional style.</p>\n\n<p>How does an iterative procedure that uses complex nested loops to access array indices, such as the graph search above, translate to the functional paradigm?</p>\n"}, {"tags": ["haskell"], "answers": [{"tags": [], "owner": {"reputation": 24266, "user_id": 946226, "user_type": "registered", "accept_rate": 59, "profile_image": "https://www.gravatar.com/avatar/5823d09208b1e4b63bbfcd189492032c?s=128&d=identicon&r=PG", "display_name": "Joachim Breitner", "link": "https://stackoverflow.com/users/946226/joachim-breitner"}, "is_accepted": true, "score": 6, "last_activity_date": 1491194316, "creation_date": 1491194316, "answer_id": 43176580, "question_id": 43176321, "link": "https://stackoverflow.com/questions/43176321/haskell-zip-lists-with-type-int/43176580#43176580", "title": "Haskell zip lists with type Int", "body": "<p>The literal <code>1</code> is overloaded, i.e.</p>\n\n<pre><code>1 :: Num a =&gt; a\n</code></pre>\n\n<p>and will either be <code>Integer</code> or <code>Int</code>, depending on the context. So if you use <code>zip [1..] mylist</code> in a context that expects a type <code>[(Int, [String])]</code>, then this will work.</p>\n\n<p>You can also be explicit, by writing <code>zip [1::Int..] mylist</code> instead.</p>\n"}], "owner": {"reputation": 29, "user_id": 3305821, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/8e3aa303d79eaccfc01e4bccd0da797f?s=128&d=identicon&r=PG&f=1", "display_name": "user128350", "link": "https://stackoverflow.com/users/3305821/user128350"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 373, "favorite_count": 0, "accepted_answer_id": 43176580, "answer_count": 1, "score": 1, "last_activity_date": 1491215175, "creation_date": 1491192218, "last_edit_date": 1491215175, "question_id": 43176321, "link": "https://stackoverflow.com/questions/43176321/haskell-zip-lists-with-type-int", "title": "Haskell zip lists with type Int", "body": "<p>I'm having the following issue in Haskell.</p>\n\n<p>I try to zip a list and numbers in order to number the list\ni.e. <code>zip [1..] mylist</code>.</p>\n\n<p>However, the type for this is <code>[(Integer, [String])]</code>.</p>\n\n<p>Is there any way to get <code>Int</code> instead of <code>Integer</code> in this case?</p>\n"}, {"tags": ["haskell", "deriving", "newtype"], "comments": [{"owner": {"reputation": 75362, "user_id": 625403, "user_type": "registered", "accept_rate": 82, "profile_image": "https://www.gravatar.com/avatar/786eed7da67079cb5d63a49d469af25b?s=128&d=identicon&r=PG", "display_name": "amalloy", "link": "https://stackoverflow.com/users/625403/amalloy"}, "edited": false, "score": 1, "creation_date": 1491184851, "post_id": 43175498, "comment_id": 73424853, "body": "Give it a Show instance as well, and see what it prints as. It&#39;ll read the same way."}, {"owner": {"reputation": 15683, "user_id": 46571, "user_type": "registered", "accept_rate": 94, "profile_image": "https://www.gravatar.com/avatar/79eede5b02caa81db17f34026b24a734?s=128&d=identicon&r=PG", "display_name": "pyon", "link": "https://stackoverflow.com/users/46571/pyon"}, "edited": false, "score": 0, "creation_date": 1491184938, "post_id": 43175498, "comment_id": 73424867, "body": "If I understand correctly, the instance generated by <code>deriving Read</code> will work exactly the same way as if <code>IPAddress</code> were a <code>data</code> type"}, {"owner": {"reputation": 13920, "user_id": 371228, "user_type": "registered", "accept_rate": 96, "profile_image": "https://www.gravatar.com/avatar/a4028c5dd749d198d7a8f2601d4afe07?s=128&d=identicon&r=PG", "display_name": "bdesham", "link": "https://stackoverflow.com/users/371228/bdesham"}, "reply_to_user": {"reputation": 75362, "user_id": 625403, "user_type": "registered", "accept_rate": 82, "profile_image": "https://www.gravatar.com/avatar/786eed7da67079cb5d63a49d469af25b?s=128&d=identicon&r=PG", "display_name": "amalloy", "link": "https://stackoverflow.com/users/625403/amalloy"}, "edited": false, "score": 0, "creation_date": 1491185452, "post_id": 43175498, "comment_id": 73424959, "body": "@amalloy I added <code>IsString</code> to the list of derived classes and then I was able to create an <code>IPAddress</code> via <code>&quot;1.2.3.4&quot; :: IPAddress</code>. Calling <code>show</code> on this value gives <code>&quot;IPAddress 1.2.3.4&quot;</code>, and indeed <code>read &quot;IPAddress 1.2.3.4&quot; :: IPAddress</code> does what I want. I suppose you should turn your comment into an answer! I\u2019d love an explanation of why I have to prepend the value with <code>IPAddress</code>, though."}], "answers": [{"comments": [{"owner": {"reputation": 29444, "user_id": 3072788, "user_type": "registered", "accept_rate": 82, "profile_image": "https://www.gravatar.com/avatar/220a45c2fcff7e7358d144551b116205?s=128&d=identicon&r=PG&f=1", "display_name": "Alec", "link": "https://stackoverflow.com/users/3072788/alec"}, "edited": false, "score": 1, "creation_date": 1491202794, "post_id": 43175608, "comment_id": 73429855, "body": "&quot;It would be nice if there were some mechanism to instruct GHC to use a particular deriving mechanism&quot;. <a href=\"https://ghc.haskell.org/trac/ghc/wiki/Commentary/Compiler/DerivingStrategies\" rel=\"nofollow noreferrer\">This is coming in GHC 8.2</a>."}, {"owner": {"reputation": 40537, "user_id": 465378, "user_type": "registered", "accept_rate": 85, "profile_image": "https://www.gravatar.com/avatar/c03b8d34978563858020eff0d14cc17b?s=128&d=identicon&r=PG", "display_name": "Alexis King", "link": "https://stackoverflow.com/users/465378/alexis-king"}, "reply_to_user": {"reputation": 29444, "user_id": 3072788, "user_type": "registered", "accept_rate": 82, "profile_image": "https://www.gravatar.com/avatar/220a45c2fcff7e7358d144551b116205?s=128&d=identicon&r=PG&f=1", "display_name": "Alec", "link": "https://stackoverflow.com/users/3072788/alec"}, "edited": false, "score": 0, "creation_date": 1491203088, "post_id": 43175608, "comment_id": 73429985, "body": "@Alec Oh wow, I didn\u2019t know about that! That\u2019s awesome to hear, since it\u2019s a feature I\u2019ve wanted for a while now."}], "tags": [], "owner": {"reputation": 40537, "user_id": 465378, "user_type": "registered", "accept_rate": 85, "profile_image": "https://www.gravatar.com/avatar/c03b8d34978563858020eff0d14cc17b?s=128&d=identicon&r=PG", "display_name": "Alexis King", "link": "https://stackoverflow.com/users/465378/alexis-king"}, "is_accepted": true, "score": 8, "last_activity_date": 1491186191, "last_edit_date": 1491186191, "creation_date": 1491185727, "answer_id": 43175608, "question_id": 43175498, "link": "https://stackoverflow.com/questions/43175498/why-isn-t-this-newtype-being-given-the-right-read-instance/43175608#43175608", "title": "Why isn\u2019t this newtype being given the right Read instance?", "body": "<p>GHC has three mechanisms for deriving typeclass instances:</p>\n\n<ul>\n<li>The <a href=\"https://www.haskell.org/onlinereport/haskell2010/haskellch11.html#x18-18200011\" rel=\"noreferrer\">normal deriving mechanism</a> outlined in the Haskell standard, which can derive instances for a small, predefined set of classes (<code>Eq</code>, <code>Ord</code>, <code>Enum</code>, <code>Bounded</code>, <code>Read</code>, and <code>Show</code>).\n\n<ul>\n<li>The set of classes that can be derived can be extended using the <code>DeriveFunctor</code>, <code>DeriveFoldable</code>, <code>DeriveTraversable</code>, and <code>DeriveLift</code> extensions, which are treated the same way as the classes listed in the standard when enabled.</li>\n</ul></li>\n<li><a href=\"https://downloads.haskell.org/~ghc/8.0.2/docs/html/users_guide/glasgow_exts.html#generalised-derived-instances-for-newtypes\" rel=\"noreferrer\"><code>GeneralizedNewtypeDeriving</code></a>, which can derive instances that defer to instances on the wrapped type.</li>\n<li><a href=\"https://downloads.haskell.org/~ghc/8.0.2/docs/html/users_guide/glasgow_exts.html#deriving-any-other-class\" rel=\"noreferrer\"><code>DeriveAnyClass</code></a>, which turns derived classes into empty instance declarations.</li>\n</ul>\n\n<p>There\u2019s a problem here. It is extremely easy to construct a scenario where more than one of the above mechanisms can be used to derive an instance, and the instances can be quite different! In your example, both ordinary deriving <em>and</em> newtype deriving could apply. If you also enabled <code>DeriveAnyClass</code>, it could apply, too.</p>\n\n<p>To disambiguate, GHC uses hardcoded rules you cannot change, which it tries from top to bottom:</p>\n\n<ol>\n<li>If the class can be derived using the ordinary deriving mechanism, use that.</li>\n<li>If <code>DeriveAnyClass</code> is enabled, use that.</li>\n<li>If <code>GeneralizedNewtypeDeriving</code> is enabled and the declared datatype is a newtype, use that.</li>\n</ol>\n\n<p>Note that this means turning on <code>DeriveAnyClass</code> and <code>GeneralizedNewtypeDeriving</code> at the same time is effectively worthless. If anything, the bottom two rules should be swapped, but they can\u2019t really be changed now.</p>\n\n<p>In your case, since <code>Read</code> is a class for which an instance can be derived via the ordinary deriving mechanism, GHC uses that one instead of using newtype deriving, and you get the behavior you see. This is consistent with the way <code>Show</code> works, too\u2014deriving <code>Show</code> will produce an instance that includes <code>IPAddress</code> in the output\u2014so <code>Read</code> should follow the same format to satisfy the one law <code>Read</code> has.</p>\n\n<p>It would be nice if there were some mechanism to instruct GHC to use a particular deriving mechanism, but there currently isn\u2019t. In this case, you\u2019ll have to write the instance by hand. Fortunately, it isn\u2019t too hard.</p>\n"}], "owner": {"reputation": 13920, "user_id": 371228, "user_type": "registered", "accept_rate": 96, "profile_image": "https://www.gravatar.com/avatar/a4028c5dd749d198d7a8f2601d4afe07?s=128&d=identicon&r=PG", "display_name": "bdesham", "link": "https://stackoverflow.com/users/371228/bdesham"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 256, "favorite_count": 1, "accepted_answer_id": 43175608, "answer_count": 1, "score": 2, "last_activity_date": 1491186191, "creation_date": 1491184758, "question_id": 43175498, "link": "https://stackoverflow.com/questions/43175498/why-isn-t-this-newtype-being-given-the-right-read-instance", "title": "Why isn\u2019t this newtype being given the right Read instance?", "body": "<p>I created a <code>newtype</code> alias of the <code>IP</code> type from <code>Data.IP</code>:</p>\n\n<pre><code>{-# LANGUAGE GeneralizedNewtypeDeriving #-}\n\nmodule IPAddress (IPAddress) where\n\nimport Data.IP (IP)\nimport Database.PostgreSQL.Simple.ToField\n\nnewtype IPAddress = IPAddress IP\n    deriving (Read, Show)\n\ninstance ToField IPAddress where\n    toField ip = toField $ show ip\n</code></pre>\n\n<p>(I wanted to make it an instance of <code>ToField</code> without creating an orphan instance.)</p>\n\n<p>The new type doesn\u2019t seem to support <code>Read</code> in the way it should, though. In this GHCi transcript, you can see that the given string can be interpreted as an <code>IP</code> but not as an <code>IPAddress</code>:</p>\n\n<pre><code>*Main IPAddress&gt; :m + Data.IP\n*Main IPAddress Data.IP&gt; read \"1.2.3.4\" :: IP\n1.2.3.4\n*Main IPAddress Data.IP&gt; read \"1.2.3.4\" :: IPAddress\nIPAddress *** Exception: Prelude.read: no parse\n</code></pre>\n\n<p>The behavior is the same regardless of whether I have GeneralizedNewtypeDeriving on. Why is the <code>Read</code> instance for <code>IPAddress</code> not identical to the one for <code>IP</code>?</p>\n"}, {"tags": ["haskell", "haskell-snap-framework"], "comments": [{"owner": {"reputation": 215, "user_id": 2035316, "user_type": "registered", "accept_rate": 60, "profile_image": "https://www.gravatar.com/avatar/b84b148152679b9172a63ebb10a64f69?s=128&d=identicon&r=PG", "display_name": "Deck Pope", "link": "https://stackoverflow.com/users/2035316/deck-pope"}, "edited": false, "score": 0, "creation_date": 1497016033, "post_id": 43174936, "comment_id": 75915176, "body": "i also have something like this, with reference to <a href=\"https://stackoverflow.com/questions/30547361/how-can-i-stream-to-all-clients\">this question</a> but with no response. You can find a part of the code <a href=\"https://gist.github.com/deckool/faefa70142e4b2b915d8\" rel=\"nofollow noreferrer\">in here</a> but without streaming to all clients."}], "owner": {"reputation": 86, "user_id": 2089423, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/ecbfc6e2cca818321e288b8b811e1caf?s=128&d=identicon&r=PG&f=1", "display_name": "Fyrn", "link": "https://stackoverflow.com/users/2089423/fyrn"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 57, "favorite_count": 0, "answer_count": 0, "score": 1, "last_activity_date": 1491178824, "creation_date": 1491178824, "question_id": 43174936, "link": "https://stackoverflow.com/questions/43174936/write-eventsource-handlers-in-the-snap-framwork", "title": "Write EventSource Handlers in the Snap Framwork", "body": "<p>I have web based chat app written in Haskell's Snap Web framework, it currently uses web sockets. For a variety of reasons I want to move from Websockets to Server Sent Events. Some of my reasons are: Web sockets not being included in HTTP 2.0, and EventSource is more suited to interface with a functional language.</p>\n\n<p>I'm looking for any tips, documentation, advice, right-direction-pointing ect..\nrelated to the Snap framework and Sever Sent Events / EventSource</p>\n"}, {"tags": ["haskell", "aeson"], "comments": [{"owner": {"reputation": 40537, "user_id": 465378, "user_type": "registered", "accept_rate": 85, "profile_image": "https://www.gravatar.com/avatar/c03b8d34978563858020eff0d14cc17b?s=128&d=identicon&r=PG", "display_name": "Alexis King", "link": "https://stackoverflow.com/users/465378/alexis-king"}, "edited": false, "score": 1, "creation_date": 1491172238, "post_id": 43174206, "comment_id": 73422442, "body": "Here\u2019s a hint: every branch of a <code>case</code> statement must return the same type. Additionally, the a <code>do</code> block has the same type as its last expression. What should the type of <code>parseCfg</code> be? If you put type annotations on all your top-level declarations (which you should do, anyway), the solution to your problem should become much clearer."}, {"owner": {"reputation": 1953, "user_id": 899723, "user_type": "registered", "accept_rate": 86, "profile_image": "https://www.gravatar.com/avatar/f68bcc2d6f5196fa090d578eb8356b9c?s=128&d=identicon&r=PG", "display_name": "mac10688", "link": "https://stackoverflow.com/users/899723/mac10688"}, "edited": false, "score": 0, "creation_date": 1491172620, "post_id": 43174206, "comment_id": 73422537, "body": "Does return $ config j work?"}, {"owner": {"reputation": 175, "user_id": 1044712, "user_type": "registered", "accept_rate": 29, "profile_image": "https://www.gravatar.com/avatar/c01a279faed71c8bec6492a519373d95?s=128&d=identicon&r=PG", "display_name": "peteofce", "link": "https://stackoverflow.com/users/1044712/peteofce"}, "edited": false, "score": 0, "creation_date": 1491235621, "post_id": 43174206, "comment_id": 73451815, "body": "Alexis,  I&#39;d be OK with returning an empty Config record from &quot;Left -&gt;&quot; in order to make the types the same, but I&#39;m not sure how I would do that. Any ideas?  I&#39;ve tried a few different things, but with no success to this point."}, {"owner": {"reputation": 175, "user_id": 1044712, "user_type": "registered", "accept_rate": 29, "profile_image": "https://www.gravatar.com/avatar/c01a279faed71c8bec6492a519373d95?s=128&d=identicon&r=PG", "display_name": "peteofce", "link": "https://stackoverflow.com/users/1044712/peteofce"}, "edited": false, "score": 0, "creation_date": 1491328521, "post_id": 43174206, "comment_id": 73500264, "body": "Someone put a great deal of effort into an answer and then for some reason it disappeared.  Just curious what happened?"}, {"owner": {"reputation": 1369, "user_id": 509928, "user_type": "registered", "accept_rate": 83, "profile_image": "https://www.gravatar.com/avatar/57d816a396798416d079c92adbabdbf3?s=128&d=identicon&r=PG", "display_name": "Dave Compton", "link": "https://stackoverflow.com/users/509928/dave-compton"}, "edited": false, "score": 0, "creation_date": 1491331201, "post_id": 43174206, "comment_id": 73501877, "body": "I answered the question and then deleted my answer because, after giving it some thought, I didn&#39;t like it.  I&#39;m going to post an improvement but I didn&#39;t want to take a chance that the previous one would be accepted in the meantime."}], "answers": [{"tags": [], "owner": {"reputation": 1369, "user_id": 509928, "user_type": "registered", "accept_rate": 83, "profile_image": "https://www.gravatar.com/avatar/57d816a396798416d079c92adbabdbf3?s=128&d=identicon&r=PG", "display_name": "Dave Compton", "link": "https://stackoverflow.com/users/509928/dave-compton"}, "is_accepted": true, "score": 1, "last_activity_date": 1491331719, "last_edit_date": 1491331719, "creation_date": 1491274635, "answer_id": 43197505, "question_id": 43174206, "link": "https://stackoverflow.com/questions/43174206/trying-to-get-an-object-out-of-json-using-aeson/43197505#43197505", "title": "Trying to get an object out of json using aeson", "body": "<p>The root of the problem that you are running into is the call to <code>getCfg</code> in <code>parseCfg</code>.  The type of <code>getCfg</code> is <code>IO ByteString</code> which is an <code>IO</code> monad and the only things that you can do with an <code>IO</code> monad are to call the functions that must be defined for all monads (<code>bind</code>, <code>fmap</code>, <code>ap</code>, ...) all of which return another <code>IO</code> monad.  This means that if <code>parseCfg</code> is going to call <code>getCfg</code> then it <em>must</em> return an <code>IO</code> monad.</p>\n\n<p>To quote the <a href=\"https://wiki.haskell.org/All_About_Monads#No_way_out\" rel=\"nofollow noreferrer\">haskell wiki</a> : \"Because you can't escape from the IO monad, it is impossible to write a function that does a computation in the IO monad but whose result type does not include the <code>IO</code> type constructor.\"</p>\n\n<p>One way around this is to call <code>getCfg</code> outside of <code>parseCfg</code> and pass the result to <code>parseCfg</code>.  Then <code>parseCfg</code> <em>could</em> return a <code>Config</code> but it makes more sense to return <code>Either String Config</code> so that any parsing error from <code>eitherDecode</code> is preserved.  This lets you define <code>parseCfg</code> as nothing more than an <code>fmap</code> of <code>config</code> over the <code>eitherDecode</code> return value.</p>\n\n<p>The resulting function looks like this:</p>\n\n<pre><code>parseCfg :: ByteString -&gt; Either String Config\nparseCfg json = config &lt;$&gt; eitherDecode json \n</code></pre>\n\n<p>Here is your program, modified to run with the above <code>parseCfg</code>.  </p>\n\n<pre><code>{-# LANGUAGE DeriveGeneric #-}\n{-# LANGUAGE TemplateHaskell #-}\n\nimport Data.ByteString.Lazy as B\nimport Data.Aeson \nimport Data.Aeson.TH\nimport GHC.Generics\nimport Control.Monad.IO.Class\n\ndata CfgProperty = CfgProperty { \n                       env             :: String,\n                       host            :: String,\n                       port            :: String,\n                       directory       :: String\n                   } deriving (Show, Generic)\n\n-- Instead of FromJSON, use deriveJSON for CfgProperty \n-- which allows changing of field labels from lower \n-- case to upper case.\n\n$(deriveJSON \n\n      defaultOptions { fieldLabelModifier = let f \"env\" = \"Env\"\n                                                f \"host\" = \"Host\"\n                                                f \"port\" = \"Port\"\n                                                f \"directory\" = \"Directory\"\n                                                f other = other\n                                             in f\n                     } \n\n      ''CfgProperty\n )\n\ndata Connections = Connections { cfgProperty  :: CfgProperty\n                   , connectionName :: String\n                   } deriving (Show, Generic)\n\ndata Config = Config {connections :: [Connections]} deriving (Show, Generic)\n\ndata Cfg = Cfg { config :: Config } deriving (Show, Generic)\n\ninstance FromJSON Cfg\ninstance FromJSON Config\ninstance FromJSON Connections\n\njsonFile :: FilePath\njsonFile = \"config/config.json\"\n\ngetCfg :: IO ByteString\ngetCfg = B.readFile jsonFile\n\nparseCfg :: ByteString -&gt; Either String Config\nparseCfg json = config &lt;$&gt; eitherDecode json \n\nmain :: IO()\nmain = do\n    json &lt;- getCfg\n    case parseCfg json of\n        Left err -&gt;  Prelude.putStrLn err\n        Right cfg -&gt; print cfg  -- do whatever you want with cfg here.\n</code></pre>\n\n<p>Here's a modified <code>config.json</code>.  The original contained two <code>config</code> <code>JSON</code> records with nothing between them which was not valid <code>JSON</code>, and was not pertinent to the question.  </p>\n\n<pre><code>{\n  \"config\":\n  {\n    \"connections\": [\n    {\n      \"cfgProperty\":\n      {\n        \"Env\": \"local\",\n        \"Host\": \"localhost\",\n        \"Port\": \"8001\",\n        \"Directory\": \"/apps/workspace/hade/maps/src01_cvs\"\n      },\n      \"connectionName\": \"src01_cvs\"\n    },\n    {\n        \"cfgProperty\":\n        {\n          \"Env\": \"local\",\n          \"Host\": \"localhost\",\n          \"Port\": \"8001\",\n          \"Directory\": \"/apps/workspace/hade/maps/trg01_cvs\"\n        },\n        \"connectionName\": \"trg01_cvs\"\n      }\n    ]\n  }\n}\n</code></pre>\n"}], "owner": {"reputation": 175, "user_id": 1044712, "user_type": "registered", "accept_rate": 29, "profile_image": "https://www.gravatar.com/avatar/c01a279faed71c8bec6492a519373d95?s=128&d=identicon&r=PG", "display_name": "peteofce", "link": "https://stackoverflow.com/users/1044712/peteofce"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 138, "favorite_count": 0, "accepted_answer_id": 43197505, "answer_count": 1, "score": 1, "last_activity_date": 1491331719, "creation_date": 1491172038, "question_id": 43174206, "link": "https://stackoverflow.com/questions/43174206/trying-to-get-an-object-out-of-json-using-aeson", "title": "Trying to get an object out of json using aeson", "body": "<p>I am trying to get a Config data record out of the following code:</p>\n\n<pre><code>data Connections = Connections { cfgProperty  :: !Object\n                   , connectionName :: String\n                   } deriving (Show, Generic)\n\ndata Config = Config {connections :: [Connections]} deriving (Show, Generic)\n\ndata Cfg = Cfg { config :: Config } deriving (Show, Generic)\n\n\n\ninstance FromJSON Cfg\ninstance FromJSON Config\ninstance FromJSON Connections\ninstance ToJSON Cfg\ninstance ToJSON Config\ninstance ToJSON Connections\n\njsonFile :: FilePath\njsonFile = \"config/config.json\"\n\ngetCfg :: IO B.ByteString\ngetCfg = B.readFile jsonFile\n\n\nparseCfg = do\n      j &lt;- (A.eitherDecode &lt;$&gt; getCfg) :: IO (Either String Cfg)\n      case j of\n        Left err -&gt;  liftIO $ putStrLn err\n        Right j -&gt; config j\n</code></pre>\n\n<p>I'm getting the following error:</p>\n\n<pre><code>/apps/workspace/hade/src/Actor/MasterActor.hs: 56, 20\n\u2022 Couldn't match expected type \u2018IO ()\u2019 with actual type \u2018Config\u2019\n\u2022 In the expression: config j\n  In a case alternative: Right j -&gt; config j\n  In a stmt of a 'do' block:\n    case j of {\n      Left err -&gt; liftIO $ putStrLn err\n      Right j -&gt; config j }\n</code></pre>\n\n<p>Here is config.json</p>\n\n<pre><code>{\n  \"config\":\n  {\n    \"connections\": [\n    {\n      \"cfgProperty\":\n      {\n        \"Env\": \"local\",\n        \"Host\": \"localhost\",\n        \"Port\": \"8001\",\n        \"Directory\": \"/apps/workspace/hade/maps/src01_cvs\"\n      },\n      \"connectionName\": \"src01_cvs\"\n    },\n    {\n        \"cfgProperty\":\n        {\n          \"Env\": \"local\",\n          \"Host\": \"localhost\",\n          \"Port\": \"8001\",\n          \"Directory\": \"/apps/workspace/hade/maps/trg01_cvs\"\n        },\n        \"connectionName\": \"trg01_cvs\"\n      }\n    ]\n  }\n}{\n  \"config\":\n  {\n    \"connections\": [\n    {\n      \"cfgProperty\":\n      {\n        \"Env\": \"local\",\n        \"Host\": \"localhost\",\n        \"Port\": \"8001\",\n        \"Directory\": \"/apps/workspace/hade/maps/src01_cvs\"\n      },\n      \"connectionName\": \"src01_cvs\"\n    },\n    {\n        \"cfgProperty\":\n        {\n          \"Env\": \"local\",\n          \"Host\": \"localhost\",\n          \"Port\": \"8001\",\n          \"Directory\": \"/apps/workspace/hade/maps/trg01_cvs\"\n        },\n        \"connectionName\": \"trg01_cvs\"\n      }\n    ]\n  }\n}\n</code></pre>\n\n<p>I have tried many different configurations using both eitherDecode and decode, but I have run into roadblocks each time.  I can get the code to print out the Config record if I change the case to be:</p>\n\n<pre><code>      case j of\n        Left err -&gt;  putStrLn err\n        Right j -&gt; print $ config j\n</code></pre>\n\n<p>(along with some other changes), but I cannot get it to simply return the Config record itself. Any assistance would be appreciated.</p>\n"}, {"tags": ["haskell", "yesod", "yesod-forms"], "answers": [{"comments": [{"owner": {"reputation": 5139, "user_id": 705510, "user_type": "registered", "accept_rate": 89, "profile_image": "https://i.stack.imgur.com/7xrNQ.png?s=128&g=1", "display_name": "McBear Holden", "link": "https://stackoverflow.com/users/705510/mcbear-holden"}, "edited": false, "score": 0, "creation_date": 1491204850, "post_id": 43178750, "comment_id": 73430896, "body": "Wow this is clever and WAY easier than using Yesod Form + bootstrap!"}], "tags": [], "owner": {"reputation": 29966, "user_id": 637669, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/0227e5d5eaceb8ae2f751df38d421764?s=128&d=identicon&r=PG", "display_name": "arrowd", "link": "https://stackoverflow.com/users/637669/arrowd"}, "is_accepted": true, "score": 1, "last_activity_date": 1491204072, "creation_date": 1491204072, "answer_id": 43178750, "question_id": 43173790, "link": "https://stackoverflow.com/questions/43173790/how-to-get-user-input-in-yesod-without-using-yesod-form/43178750#43178750", "title": "How to get user input in Yesod without using Yesod Form", "body": "<p>You need to make a HTTP request to the server and pass it data.</p>\n\n<p>In case of GET request, you just declare handler parameters in <code>config/routes</code> and then get them as <code>getYourHandlerR</code> arguments. In case of POST, you can use <a href=\"https://www.stackage.org/haddock/lts-8.6/yesod-core-1.4.32/Yesod-Core-Json.html#v:requireJsonBody\" rel=\"nofollow noreferrer\">requireJsonBody</a> to get data as JSON or <a href=\"https://www.stackage.org/haddock/lts-8.6/yesod-core-1.4.32/Yesod-Core-Handler.html#v:getPostParams\" rel=\"nofollow noreferrer\">getPostParams</a>.</p>\n"}], "owner": {"reputation": 5139, "user_id": 705510, "user_type": "registered", "accept_rate": 89, "profile_image": "https://i.stack.imgur.com/7xrNQ.png?s=128&g=1", "display_name": "McBear Holden", "link": "https://stackoverflow.com/users/705510/mcbear-holden"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 97, "favorite_count": 0, "accepted_answer_id": 43178750, "answer_count": 1, "score": 0, "last_activity_date": 1491204072, "creation_date": 1491168922, "question_id": 43173790, "link": "https://stackoverflow.com/questions/43173790/how-to-get-user-input-in-yesod-without-using-yesod-form", "title": "How to get user input in Yesod without using Yesod Form", "body": "<p>In my page I have a search field(text area).</p>\n\n<p>Yesod Form is quite complicated to use, so I figure I'll just use Javascript to get the value typed by the user. But then how my Haskell program gets that value?</p>\n"}, {"tags": ["haskell"], "comments": [{"owner": {"reputation": 2334, "user_id": 2397162, "user_type": "registered", "accept_rate": 61, "profile_image": "https://www.gravatar.com/avatar/665b976c79d0c9c842b131a2df510c3c?s=128&d=identicon&r=PG", "display_name": "niceman", "link": "https://stackoverflow.com/users/2397162/niceman"}, "edited": false, "score": 0, "creation_date": 1491164303, "post_id": 43173076, "comment_id": 73420209, "body": "can you explain &quot;how is this fact made explicit?&quot; better ? what do you mean exactly ?"}], "answers": [{"comments": [{"owner": {"reputation": 1735, "user_id": 2892792, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/5DNyi.jpg?s=128&g=1", "display_name": "Lazersmoke", "link": "https://stackoverflow.com/users/2892792/lazersmoke"}, "edited": false, "score": 0, "creation_date": 1491180462, "post_id": 43173124, "comment_id": 73424016, "body": "Important to note: Haskell doesn&#39;t have &quot;sub-typeclasses,&quot; it simply checks that all instances of <code>Fractional</code> obey the class context, which in this case expresses a sub-typeclass-like relationship. It is not a special syntax, just a useful idiom."}], "tags": [], "owner": {"reputation": 100185, "user_id": 3234959, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/93bb12ca0f93dfddb33880316f7e66c2?s=128&d=identicon&r=PG&f=1", "display_name": "chi", "link": "https://stackoverflow.com/users/3234959/chi"}, "is_accepted": true, "score": 9, "last_activity_date": 1491164480, "creation_date": 1491164480, "answer_id": 43173124, "question_id": 43173076, "link": "https://stackoverflow.com/questions/43173076/how-do-we-know-if-a-typeclass-is-a-sub-typeclass-of-another-typeclass/43173124#43173124", "title": "How do we know if a typeclass is a sub-typeclass of another typeclass?", "body": "<p>It's in the definition of the <code>Fractional</code> class:</p>\n\n<pre><code>class Num a =&gt; Fractional a where\n   ...\n</code></pre>\n\n<p>You can see it typing <code>:i Fractional</code> in GHCi, or on the <a href=\"http://hackage.haskell.org/package/base-4.9.1.0/docs/Prelude.html#t:Fractional\" rel=\"noreferrer\">Haddock docs</a>.</p>\n"}], "owner": {"reputation": 1322, "user_id": 6695164, "user_type": "registered", "accept_rate": 57, "profile_image": "https://www.gravatar.com/avatar/962eb413ea9e37b168cb950cfd4211ab?s=128&d=identicon&r=PG&f=1", "display_name": "Adam", "link": "https://stackoverflow.com/users/6695164/adam"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 77, "favorite_count": 0, "accepted_answer_id": 43173124, "answer_count": 1, "score": 2, "last_activity_date": 1491164631, "creation_date": 1491164122, "last_edit_date": 1491164631, "question_id": 43173076, "link": "https://stackoverflow.com/questions/43173076/how-do-we-know-if-a-typeclass-is-a-sub-typeclass-of-another-typeclass", "title": "How do we know if a typeclass is a sub-typeclass of another typeclass?", "body": "<p>If we do\n<code>let add a b = a+b</code>\nthen <code>add :: Num a =&gt; a -&gt; a -&gt; a</code>.</p>\n\n<p>We also know that <code>1.5 :: Fractional a =&gt; a</code>.\nAnd <code>add 1 1.5</code> works flawlessly.</p>\n\n<p>If I understand correctly every type which has an instance of <code>Fractional</code> has also an instance of <code>Num</code>, but how is this fact made explicit?</p>\n"}, {"tags": ["function", "haskell", "if-statement", "runtime-error", "empty-list"], "comments": [{"owner": {"reputation": 100185, "user_id": 3234959, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/93bb12ca0f93dfddb33880316f7e66c2?s=128&d=identicon&r=PG&f=1", "display_name": "chi", "link": "https://stackoverflow.com/users/3234959/chi"}, "edited": false, "score": 2, "creation_date": 1491164400, "post_id": 43173048, "comment_id": 73420239, "body": "Using <code>head</code> and <code>tail</code> is inherently dangerous, and very rarely needed - I&#39;d avoid them as much as reasonably possible. Replace them with pattern matching, and turn on warnings with <code>-Wall</code> so that GHC can warn about missed cases."}], "answers": [{"comments": [{"owner": {"reputation": 45, "user_id": 7788477, "user_type": "registered", "accept_rate": 50, "profile_image": "https://www.gravatar.com/avatar/a673c33968b5655b9f86ff3ad5e232f9?s=128&d=identicon&r=PG&f=1", "display_name": "plshelp", "link": "https://stackoverflow.com/users/7788477/plshelp"}, "edited": false, "score": 0, "creation_date": 1491167641, "post_id": 43173098, "comment_id": 73421227, "body": "Do you know how I can make it exhaustive? I tried to have pattern matching with <code>foo board [] _ _ _ _ = sortBoard...</code> and another <code>food board _ _ _ _ [] = board</code> but it said pattern match was redundant. I&#39;ve been looking at this code for days and can&#39;t come up with anything."}, {"owner": {"reputation": 8237, "user_id": 2900502, "user_type": "registered", "accept_rate": 73, "profile_image": "https://i.stack.imgur.com/R1OjD.jpg?s=128&g=1", "display_name": "Shersh", "link": "https://stackoverflow.com/users/2900502/shersh"}, "reply_to_user": {"reputation": 45, "user_id": 7788477, "user_type": "registered", "accept_rate": 50, "profile_image": "https://www.gravatar.com/avatar/a673c33968b5655b9f86ff3ad5e232f9?s=128&d=identicon&r=PG&f=1", "display_name": "plshelp", "link": "https://stackoverflow.com/users/7788477/plshelp"}, "edited": false, "score": 0, "creation_date": 1491169112, "post_id": 43173098, "comment_id": 73421610, "body": "@JessSmith try this set of patterns. <code>ghc</code> doesn&#39;t warn me about redundant pattern matchings here <a href=\"http://lpaste.net/1351820791544545280\" rel=\"nofollow noreferrer\">lpaste.net/1351820791544545280</a>"}], "tags": [], "owner": {"reputation": 8237, "user_id": 2900502, "user_type": "registered", "accept_rate": 73, "profile_image": "https://i.stack.imgur.com/R1OjD.jpg?s=128&g=1", "display_name": "Shersh", "link": "https://stackoverflow.com/users/2900502/shersh"}, "is_accepted": false, "score": 1, "last_activity_date": 1491164343, "creation_date": 1491164343, "answer_id": 43173098, "question_id": 43173048, "link": "https://stackoverflow.com/questions/43173048/prelude-head-empty-list-in-if-statement/43173098#43173098", "title": "Prelude.head: empty list in if statement", "body": "<p>Problem is here: </p>\n\n<pre><code>newBoard        = set board (head spot) ('1')\n</code></pre>\n\n<p>You're calling <code>head</code> on <code>spot</code> list. But <code>spot</code> may be empty list. Your pattern matching is non-exhaustive enough. Here <code>foo board [] _ _ _ [] = board</code> you check that <code>spot</code> and <code>move</code> both empty simultaneosly. While one of them may be empty while the other one has at least one element. </p>\n\n<p>Try to structure your code in more modular manner making imposible states unrepresentable. Most likely your code can be refactored to avoid situations when only one list is empty, if one one of two can happen: both lists are empty or both has at least one element.</p>\n"}], "owner": {"reputation": 45, "user_id": 7788477, "user_type": "registered", "accept_rate": 50, "profile_image": "https://www.gravatar.com/avatar/a673c33968b5655b9f86ff3ad5e232f9?s=128&d=identicon&r=PG&f=1", "display_name": "plshelp", "link": "https://stackoverflow.com/users/7788477/plshelp"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 240, "favorite_count": 0, "answer_count": 1, "score": 1, "last_activity_date": 1491164343, "creation_date": 1491163908, "question_id": 43173048, "link": "https://stackoverflow.com/questions/43173048/prelude-head-empty-list-in-if-statement", "title": "Prelude.head: empty list in if statement", "body": "<p>I'm writing a function and it throws <code>Prelude.head empty list</code> if I use the variable <code>newBoard</code> where I have <code>sortBoard</code> in the if-else it throws this error. If I use the original <code>board</code> character it doesn't throw this error. </p>\n\n<pre><code>foo :: [[Char]] -&gt; [(Int, Int)] -&gt; [(Int, (Int, Int))] -&gt; Int -&gt; [(Int,Int)]-&gt; [Int]-&gt; [[Char]]\nfoo [] _ _ _ _ _ = []\nfoo board [] _ _ _ [] = board\nfoo board spot array number startArray move = nextStep\n    where \n        newBoard        = set board (head spot) ('1')\n        tailSpot        = tail spot\n        nextStep = \n            if tailSpot == []\n                then if (tail move) == []\n                        then newBoard\n                    else sortBoard newBoard array 1 [] (tail move)\n            else (foo newBoard tailSpot array 1 [] move)\n</code></pre>\n\n<p>For explination on this code, I have a game board and need to enter '1' in certain spots which are given by the variable <code>spot</code>. If I have gone through all the spots(<code>tailSpot</code>) and there are no more sections I need to change(<code>move</code>) it should just return the new board. If I still have sections I need to change, I exit this function and go back to finding the spots in that section so I can come back and switch them. If I still have a section and spots left, I keep going through this function until all spots are changed.</p>\n"}, {"tags": ["list", "haskell"], "comments": [{"owner": {"reputation": 46235, "user_id": 2541573, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/Z1qtP.png?s=128&g=1", "display_name": "jub0bs", "link": "https://stackoverflow.com/users/2541573/jub0bs"}, "edited": false, "score": 6, "creation_date": 1491159479, "post_id": 43172233, "comment_id": 73418513, "body": "You&#39;re looking for <a href=\"http://hackage.haskell.org/package/base-4.9.1.0/docs/Data-List.html#v:transpose\" rel=\"nofollow noreferrer\"><code>Data.List.transpose</code></a>."}, {"owner": {"reputation": 3422, "user_id": 1988505, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/f3281bec4f80318de1f897786661f9e4?s=128&d=identicon&r=PG", "display_name": "Wesley Baugh", "link": "https://stackoverflow.com/users/1988505/wesley-baugh"}, "reply_to_user": {"reputation": 46235, "user_id": 2541573, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/Z1qtP.png?s=128&g=1", "display_name": "jub0bs", "link": "https://stackoverflow.com/users/2541573/jub0bs"}, "edited": false, "score": 0, "creation_date": 1491160895, "post_id": 43172233, "comment_id": 73419045, "body": "Ah, of course! \ud83d\ude33 Thank you! \ud83d\ude0a"}, {"owner": {"reputation": 1589, "user_id": 2535671, "user_type": "registered", "accept_rate": 87, "profile_image": "https://www.gravatar.com/avatar/fca1ba52e0c41803e676d449ef242e75?s=128&d=identicon&r=PG&f=1", "display_name": "Julian Leviston", "link": "https://stackoverflow.com/users/2535671/julian-leviston"}, "reply_to_user": {"reputation": 46235, "user_id": 2541573, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/Z1qtP.png?s=128&g=1", "display_name": "jub0bs", "link": "https://stackoverflow.com/users/2541573/jub0bs"}, "edited": false, "score": 0, "creation_date": 1492324602, "post_id": 43172233, "comment_id": 73926390, "body": "@Jubobs why don&#39;t you answer the question? that way it gets cleared from the list of unanswered questions, and can be accepted?"}, {"owner": {"reputation": 46235, "user_id": 2541573, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/Z1qtP.png?s=128&g=1", "display_name": "jub0bs", "link": "https://stackoverflow.com/users/2541573/jub0bs"}, "reply_to_user": {"reputation": 1589, "user_id": 2535671, "user_type": "registered", "accept_rate": 87, "profile_image": "https://www.gravatar.com/avatar/fca1ba52e0c41803e676d449ef242e75?s=128&d=identicon&r=PG&f=1", "display_name": "Julian Leviston", "link": "https://stackoverflow.com/users/2535671/julian-leviston"}, "edited": false, "score": 0, "creation_date": 1492366880, "post_id": 43172233, "comment_id": 73937953, "body": "@JulianLeviston I honestly thought this would be promptly closed as a duplicate."}], "answers": [{"tags": [], "owner": {"reputation": 46235, "user_id": 2541573, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/Z1qtP.png?s=128&g=1", "display_name": "jub0bs", "link": "https://stackoverflow.com/users/2541573/jub0bs"}, "is_accepted": true, "score": 2, "last_activity_date": 1492415449, "last_edit_date": 1492415449, "creation_date": 1492366853, "answer_id": 43440543, "question_id": 43172233, "link": "https://stackoverflow.com/questions/43172233/join-elements-from-sublists/43440543#43440543", "title": "Join elements from sublists", "body": "<p><a href=\"http://hackage.haskell.org/package/base-4.9.1.0/docs/Data-List.html#v:transpose\" rel=\"nofollow noreferrer\"><code>Data.List.transpose</code></a> is right up your alley.</p>\n\n<p>Tip: when looking for functions that might already be implemented somewhere, try <a href=\"https://www.haskell.org/hoogle/\" rel=\"nofollow noreferrer\">Hoogle</a>, a nifty Haskell-API search engine. In your particular case, <a href=\"https://www.haskell.org/hoogle/?hoogle=%5B%5Ba%5D%5D+-%3E+%5B%5Ba%5D%5D\" rel=\"nofollow noreferrer\">searching for <code>[[a]] -&gt; [[a]]</code></a> returns <code>Data.List.transpose</code> as the top result.</p>\n"}], "owner": {"reputation": 3422, "user_id": 1988505, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/f3281bec4f80318de1f897786661f9e4?s=128&d=identicon&r=PG", "display_name": "Wesley Baugh", "link": "https://stackoverflow.com/users/1988505/wesley-baugh"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 116, "favorite_count": 0, "accepted_answer_id": 43440543, "answer_count": 1, "score": 1, "last_activity_date": 1492415449, "creation_date": 1491159134, "last_edit_date": 1491160067, "question_id": 43172233, "link": "https://stackoverflow.com/questions/43172233/join-elements-from-sublists", "title": "Join elements from sublists", "body": "<p>Given a square array, is there a way to use applicative style or similar to \"zip\" together the first element from each <code>[[a]]</code>, followed by the second element, and so on?</p>\n\n<pre class=\"lang-hs prettyprint-override\"><code>&gt; let xss = [[1,4,7], [2,5,8], [3,6,9]] :: [[Int]]\n&gt; map (\\i -&gt; map (!! i) xss) [0..length xss - 1]\n[[1,2,3],[4,5,6],[7,8,9]]\n</code></pre>\n\n<p>I wrote the above solution for a programming challenge website, but I'm not happy with the <code>map (!! i)</code> or the <code>[0..length xs - 1]</code>. Is there a more advanced way to do this?</p>\n"}, {"tags": ["haskell", "haskell-turtle"], "comments": [{"owner": {"reputation": 2831, "user_id": 183792, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/9ddcfbc6c31012fd25384f6301363347?s=128&d=identicon&r=PG&f=1", "display_name": "Michael", "link": "https://stackoverflow.com/users/183792/michael"}, "edited": false, "score": 0, "creation_date": 1491173556, "post_id": 43171692, "comment_id": 73422751, "body": "I&#39;m not sure what <code>PID</code> is doing, but if you define say <code>test cmd = view $ inshell (cmd &lt;&gt; &quot; &amp;  echo $!&quot;) empty</code> and run say <code>test &quot;cd .&quot;</code> and <code>test &quot;ls&quot;</code> and the python, you see the process id is the first of potentially many lines streamed. I think you will have trouble recovering just the first line from a <code>Shell</code>."}, {"owner": {"reputation": 110, "user_id": 3982150, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/5b47baacc0b5111efb0f12ea9d315a1c?s=128&d=identicon&r=PG&f=1", "display_name": "FintanH", "link": "https://stackoverflow.com/users/3982150/fintanh"}, "reply_to_user": {"reputation": 2831, "user_id": 183792, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/9ddcfbc6c31012fd25384f6301363347?s=128&d=identicon&r=PG&f=1", "display_name": "Michael", "link": "https://stackoverflow.com/users/183792/michael"}, "edited": false, "score": 0, "creation_date": 1491174089, "post_id": 43171692, "comment_id": 73422852, "body": "Thanks for the reply @Michael! PID was just a newtype wrapper around Text. I ended up using <code>System.Process</code> particularly <code>spawnCommand</code> and then this answer <a href=\"http://stackoverflow.com/a/27388709/3982150\">stackoverflow.com/a/27388709/3982150</a> showed me how to get the PID."}, {"owner": {"reputation": 2831, "user_id": 183792, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/9ddcfbc6c31012fd25384f6301363347?s=128&d=identicon&r=PG&f=1", "display_name": "Michael", "link": "https://stackoverflow.com/users/183792/michael"}, "edited": false, "score": 1, "creation_date": 1491174260, "post_id": 43171692, "comment_id": 73422890, "body": "You can for example make a list of the outputs with say <code>fold some_shell Control.Foldl.list</code> in IO and then examine the list, but of course the process will be over by the time you get the list."}, {"owner": {"reputation": 2831, "user_id": 183792, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/9ddcfbc6c31012fd25384f6301363347?s=128&d=identicon&r=PG&f=1", "display_name": "Michael", "link": "https://stackoverflow.com/users/183792/michael"}, "edited": false, "score": 0, "creation_date": 1491174530, "post_id": 43171692, "comment_id": 73422953, "body": "Btw, your program is the same as <code>fmap (PID . lineToText) $ inshell (shellCommand &lt;&gt; &quot;&amp; echo $!&quot;) empty</code>  -- it makes each streamed line into something of the form  <code>PID txt</code>"}, {"owner": {"reputation": 110, "user_id": 3982150, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/5b47baacc0b5111efb0f12ea9d315a1c?s=128&d=identicon&r=PG&f=1", "display_name": "FintanH", "link": "https://stackoverflow.com/users/3982150/fintanh"}, "reply_to_user": {"reputation": 2831, "user_id": 183792, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/9ddcfbc6c31012fd25384f6301363347?s=128&d=identicon&r=PG&f=1", "display_name": "Michael", "link": "https://stackoverflow.com/users/183792/michael"}, "edited": false, "score": 0, "creation_date": 1491209783, "post_id": 43171692, "comment_id": 73433516, "body": "Ah, the fold idea isn&#39;t too bad! My real command would be a long running server rather than a hello world program :D I&#39;ll see how far I get with my current solution first. Thanks for the help and pointers!"}], "owner": {"reputation": 110, "user_id": 3982150, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/5b47baacc0b5111efb0f12ea9d315a1c?s=128&d=identicon&r=PG&f=1", "display_name": "FintanH", "link": "https://stackoverflow.com/users/3982150/fintanh"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 92, "favorite_count": 1, "answer_count": 0, "score": 2, "last_activity_date": 1491156272, "creation_date": 1491156272, "question_id": 43171692, "link": "https://stackoverflow.com/questions/43171692/forking-turtle-inshell-command-not-streaming-stdout", "title": "Forking Turtle inshell command not streaming stdout", "body": "<p>I'm using the the following function to fork commands in my Turtle script:</p>\n\n<pre><code>forkCommand shellCommand = do\n  pid &lt;- inshell (shellCommand &lt;&gt; \"&amp; echo $!\") empty\n  return $ PID (lineToText pid)\n</code></pre>\n\n<p>The reason for doing this is because I want to get the PID of the forked process that I'm running.</p>\n\n<p>The issue is that the command I'm ruining isn't streaming any stdout. For example you could set shellCommand to:</p>\n\n<pre><code>\"python -c \\\"print('Hello, World')\\\"\"\n</code></pre>\n\n<p>and you won't see the print occur.</p>\n"}, {"tags": ["haskell", "concurrency"], "comments": [{"owner": {"reputation": 78982, "user_id": 1848654, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/84180c0f3c9c04f8b8f0613fc0129dac?s=128&d=identicon&r=PG", "display_name": "melpomene", "link": "https://stackoverflow.com/users/1848654/melpomene"}, "edited": false, "score": 0, "creation_date": 1491156412, "post_id": 43171683, "comment_id": 73417303, "body": "<code>C r &lt;- takeMVar chan</code>"}, {"owner": {"reputation": 77, "user_id": 4847601, "user_type": "registered", "accept_rate": 25, "profile_image": "https://www.gravatar.com/avatar/622f3c8150294e73770e53a8b45dc19a?s=128&d=identicon&r=PG&f=1", "display_name": "RawLamb", "link": "https://stackoverflow.com/users/4847601/rawlamb"}, "reply_to_user": {"reputation": 78982, "user_id": 1848654, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/84180c0f3c9c04f8b8f0613fc0129dac?s=128&d=identicon&r=PG", "display_name": "melpomene", "link": "https://stackoverflow.com/users/1848654/melpomene"}, "edited": false, "score": 0, "creation_date": 1491159599, "post_id": 43171683, "comment_id": 73418556, "body": "Thank you for your reply, although I&#39;m still having type issues. After getting Haskell to print the <code>Msg</code> as a char by itself, I try to add it to a new empty list <code>* Couldn&#39;t match type [] with IO       Expected type: IO Char         Actual type: [Char]</code>"}], "answers": [{"comments": [{"owner": {"reputation": 670, "user_id": 7781818, "user_type": "registered", "accept_rate": 80, "profile_image": "https://www.gravatar.com/avatar/13f5392f913a0f47fab3e6719bda4b08?s=128&d=identicon&r=PG&f=1", "display_name": "Chris", "link": "https://stackoverflow.com/users/7781818/chris"}, "edited": false, "score": 0, "creation_date": 1491299058, "post_id": 43203500, "comment_id": 73478988, "body": "aside: If you are unsatisfied with the way <code>deriving (Show)</code> represents your <code>Msg</code> you  can make <code>Msg</code> an instance of the <code>Show</code> type-class by providing your own implementation of show like so: <code>instance Show Msg where &lt;your implementation of show&gt;</code>."}], "tags": [], "owner": {"reputation": 670, "user_id": 7781818, "user_type": "registered", "accept_rate": 80, "profile_image": "https://www.gravatar.com/avatar/13f5392f913a0f47fab3e6719bda4b08?s=128&d=identicon&r=PG&f=1", "display_name": "Chris", "link": "https://stackoverflow.com/users/7781818/chris"}, "is_accepted": false, "score": 0, "last_activity_date": 1491301062, "last_edit_date": 1495542351, "creation_date": 1491298684, "answer_id": 43203500, "question_id": 43171683, "link": "https://stackoverflow.com/questions/43171683/concurrent-haskell-acting-upon-the-data-within-a-custom-data-type/43203500#43203500", "title": "Concurrent Haskell: Acting upon the data within a custom data type", "body": "<p>The problem seams to be that your list does not contain <code>C Char</code> but rather <code>Char</code>. This may be fixed by doing <code>let x = [C '1',C 's',C 'g',C '4',C '5']</code>.</p>\n\n<p>Your <code>userThread</code> puts a <code>C Char</code> into <code>chan</code>, so when you unpack it with <code>takeMVar (chan)</code> and bind it to <code>r</code>, <code>r</code> now has type <code>Msg</code>. Because in Haskell lists can only hold values of the same type, you can not prepend an <code>Msg</code> to a <code>[Char]</code>, therefor the error. Make all the elements of <code>x</code> of type <code>Msg</code> and all will be good (hopefully...). Alternatively you can implement a </p>\n\n<p><code>toChar :: Msg -&gt; Char\n toChar C c = c</code></p>\n\n<p>and do something like <code>(toChar r):x</code> if you insist on having <code>Char</code> in your list.</p>\n\n<p>for remvoing elements from x see <a href=\"https://stackoverflow.com/questions/10050988/haskell-removes-all-occurrences-of-a-given-value-from-within-a-list-of-lists\">this</a>. you can then write something of the sort:</p>\n\n<pre><code>if elem r x then newX = remove r x else newX = r:x --if x contains Msg\nif elem cr x then newX = remove cr x else newX = cr:x\n   where cr = toChar r --if you insist on having chars in x...\n</code></pre>\n\n<p>hope that helps.</p>\n"}], "owner": {"reputation": 77, "user_id": 4847601, "user_type": "registered", "accept_rate": 25, "profile_image": "https://www.gravatar.com/avatar/622f3c8150294e73770e53a8b45dc19a?s=128&d=identicon&r=PG&f=1", "display_name": "RawLamb", "link": "https://stackoverflow.com/users/4847601/rawlamb"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 78, "favorite_count": 0, "answer_count": 1, "score": 0, "last_activity_date": 1491301062, "creation_date": 1491156221, "question_id": 43171683, "link": "https://stackoverflow.com/questions/43171683/concurrent-haskell-acting-upon-the-data-within-a-custom-data-type", "title": "Concurrent Haskell: Acting upon the data within a custom data type", "body": "<p>So far in this program I have a custom data type, <code>Msg</code> which is a <code>C Char</code>. In the program, a separate thread is created and a separate function <code>userThread</code> listens for a keystroke and stores the char sent in an <code>MVar</code> that's acting as a simple communication channel between <code>main</code> and <code>userThread</code></p>\n\n<p>I have gotten to the point, using <code>deriving (Show)</code> where I'm able to print the Msg as to the terminal, like a string. If the user types <code>j</code> the output is:</p>\n\n<pre><code>C 'j' \n</code></pre>\n\n<p>(Note it also prints C when I only want the char itself)</p>\n\n<p>I have an existing list and my aim is if the char is NOT in that list, then add it. If it IS, then don't add it and remove all instances of that char in the list.</p>\n\n<p>For example, if a user typed <code>c</code>, then</p>\n\n<pre><code>[a,b] becomes [a,b,c]\n</code></pre>\n\n<p>but</p>\n\n<pre><code>[f,c,c,h,c] becomes [f,h]\n</code></pre>\n\n<p>My current code is below:</p>\n\n<pre><code>module Main where\n\nimport Control.Concurrent\nimport Control.Monad\nimport System.IO\nimport System.Random\nimport Text.Printf\n\ndata Msg = C Char deriving (Show)\n\nmain :: IO ()\nmain = loop\n where\n loop = do\n  hSetBuffering stdout NoBuffering\n  hSetBuffering stdin NoBuffering\n  hSetEcho stdin False\n\n  --already existing list    \n  let x = [1, 's', 'g', 4 ,5]\n  chan &lt;- newEmptyMVar\n  forkIO $ userThread (chan)\n  r &lt;- takeMVar (chan)\n\n  putStrLn $ show x\n  print r\n\n-- Listens for keystrokes from the user, the passes them to the main thread\nuserThread :: MVar Msg -&gt; IO ()\nuserThread chan = do\n  c &lt;- getChar\n  putMVar chan (C c)\n</code></pre>\n\n<p>I'm confused as I'm able to perform actions like Print on my <code>Msg</code> just fine because its actual content is a char. But when I try to ad it to a list using <code>r:x</code> the compile error says:</p>\n\n<pre><code>* Couldn't match type `Char' with `Msg'\n      Expected type: [Msg]\n        Actual type: [Char]\n</code></pre>\n\n<p>How can I make my Msg fit into this list? Thanks very much for your help.</p>\n"}, {"tags": ["haskell"], "answers": [{"comments": [{"owner": {"reputation": 25, "user_id": 7805417, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/4bf5d0a4f7448097ad61896b2c538c4b?s=128&d=identicon&r=PG&f=1", "display_name": "Eirini", "link": "https://stackoverflow.com/users/7805417/eirini"}, "edited": false, "score": 0, "creation_date": 1491156801, "post_id": 43171776, "comment_id": 73417475, "body": "oh ok, I understand. Thank you so much :)"}, {"owner": {"reputation": 100185, "user_id": 3234959, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/93bb12ca0f93dfddb33880316f7e66c2?s=128&d=identicon&r=PG&f=1", "display_name": "chi", "link": "https://stackoverflow.com/users/3234959/chi"}, "edited": false, "score": 0, "creation_date": 1491164781, "post_id": 43171776, "comment_id": 73420332, "body": "I second removing the <code>hs f 0 0</code> case. It looks funny to see that as a base case, when <code>n,m</code> are <i>increasing</i> (by 1) in each recursive call."}], "tags": [], "owner": {"reputation": 748, "user_id": 7801892, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/f9f87eb8937bf17dd8dee0658a4695d2?s=128&d=identicon&r=PG&f=1", "display_name": "Phil Kiener", "link": "https://stackoverflow.com/users/7801892/phil-kiener"}, "is_accepted": true, "score": 3, "last_activity_date": 1491156656, "creation_date": 1491156656, "answer_id": 43171776, "question_id": 43171615, "link": "https://stackoverflow.com/questions/43171615/infinite-loop-in-haskell-program/43171776#43171776", "title": "Infinite loop in haskell program", "body": "<p>The stack overflow is likely caused by the infinite recursion. Your guards are <code>m &lt;= n</code> and <code>n &lt;= m</code>; for every <code>n</code> and <code>m</code>, one of those is always true. Your <code>otherwise</code> is never reached, the recursion never terminates. You probably meant your guards to be <code>m &lt; n</code> and <code>n &lt; m</code>.</p>\n\n<p>Your <code>hs</code> should therefore be</p>\n\n<pre><code>hs f 0 0 = f 0\nhs f n m | m &lt; n     = f m + hs f n (m + 1)\n         | m &gt; n     = f n + hs f (n + 1) m\n         | otherwise = 0\n</code></pre>\n\n<p>Because of that last guard, you could even remove the pattern <code>hs f 0 0</code>; the <code>otherwise</code> catches that one.</p>\n"}], "owner": {"reputation": 25, "user_id": 7805417, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/4bf5d0a4f7448097ad61896b2c538c4b?s=128&d=identicon&r=PG&f=1", "display_name": "Eirini", "link": "https://stackoverflow.com/users/7805417/eirini"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 121, "favorite_count": 0, "accepted_answer_id": 43171776, "answer_count": 1, "score": 1, "last_activity_date": 1491161732, "creation_date": 1491155907, "last_edit_date": 1491161732, "question_id": 43171615, "link": "https://stackoverflow.com/questions/43171615/infinite-loop-in-haskell-program", "title": "Infinite loop in haskell program", "body": "<p>The following code gives me a stack overflow error in some cases (ex <code>hosum (\\x-&gt;x `mod` 3) 1000</code> ) and I don't understand why. Could anyone explain this to me? (I am new to Haskell and I'd appreciate any help :) )</p>\n\n<pre><code> hosum :: (Int -&gt; Int) -&gt;  (Int -&gt; Int)\n    hosum f  = (\\x -&gt; hs f x (- x))\n            where hs :: (Int -&gt; Int) -&gt; Int -&gt; Int -&gt; Int\n                  hs f 0 0 = f 0\n                  hs f n m\n                          | m &lt;= n \n                          = f m + hs f n (m+1)\n                          | n &lt;= m \n                          = f n + hs f (n+1) m\n                          | otherwise\n                          = 0\n</code></pre>\n"}, {"tags": ["haskell", "stream", "conduit"], "comments": [{"owner": {"reputation": 2831, "user_id": 183792, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/9ddcfbc6c31012fd25384f6301363347?s=128&d=identicon&r=PG&f=1", "display_name": "Michael", "link": "https://stackoverflow.com/users/183792/michael"}, "edited": false, "score": 2, "creation_date": 1491153407, "post_id": 43170646, "comment_id": 73416133, "body": "You should be using <code>runConduitRes</code> not <code>runConduit</code>. This will require a change in the signature for <code>command</code> which you are using at <code>Sink (Int,Text) (ResourceT (StateT Editor IO)) Editor</code>. You could just use <code>MonadState Editor m =&gt; Sink (Int,Text) m Editor</code> for example if you only use state operations.  See <a href=\"http://sprunge.us/gTWX\" rel=\"nofollow noreferrer\">sprunge.us/gTWX</a>"}], "owner": {"reputation": 3922, "user_id": 1198582, "user_type": "registered", "accept_rate": 99, "profile_image": "https://www.gravatar.com/avatar/02d3e1025aed5f061c481871986c45b1?s=128&d=identicon&r=PG", "display_name": "Michael Litchard", "link": "https://stackoverflow.com/users/1198582/michael-litchard"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 61, "favorite_count": 0, "answer_count": 0, "score": 1, "last_activity_date": 1491170961, "creation_date": 1491150286, "last_edit_date": 1491170961, "question_id": 43170646, "link": "https://stackoverflow.com/questions/43170646/how-can-i-replace-my-usage-of-bracket-with-bracketp", "title": "How can I replace my usage of bracket with bracketP", "body": "<p>The following code compiles.</p>\n\n<pre><code>result :: IO Editor\nresult = \n  bracket h (\\h' -&gt; hClose h' &gt;&gt; putStrLn \"closing file\") (\\h' -&gt; engineOne h')\n  where\n    h :: IO Handle\n    h = do h' &lt;- openFile \"data/tc_one.data\" ReadMode\n           _  &lt;- hGetLine h'\n           return h'\n\nengineOne :: Handle -&gt; IO Editor\nengineOne h = evalStateT conduit nullEDT\n  where conduit = runConduit   $ \n                  sourceHandle h .|\n                  parsed         .|\n                  command\n</code></pre>\n\n<p>But I wonder if I'm courting a space leak, and maybe I should be using <code>bracketP</code>. So I try:</p>\n\n<pre><code>dropLine :: MonadResource m =&gt; FilePath -&gt; ConduitM () ByteString m ()\ndropLine fp = bracketP h hClose sourceHandle\n  where \n    h :: IO Handle\n    h = do h' &lt;- openBinaryFile fp ReadMode\n           _  &lt;- hGetLine h'\n           return h'\n</code></pre>\n\n<p>by itself, it compiles.</p>\n\n<p>But when I put it in the pipeline</p>\n\n<pre><code>engineTwo :: FilePath -&gt; IO Editor\nengineTwo fp = evalStateT conduit nullEDT\n  where conduit = runConduit $ dropLine fp .| parsed .| command\n</code></pre>\n\n<p>I get this error</p>\n\n<pre><code>Editor.hs:54:32: error:\n    \u2022 No instance for (MonadResource IO)\n        arising from a use of \u2018dropLine\u2019\n    \u2022 In the first argument of \u2018(.|)\u2019, namely \u2018dropLine fp\u2019\n      In the second argument of \u2018($)\u2019, namely\n        \u2018dropLine fp .| parsed .| command\u2019\n      In the expression: runConduit $ dropLine fp .| parsed .| command\n</code></pre>\n\n<p>Here are the other type signatures:</p>\n\n<pre><code>command :: Sink (Int,Text) (StateT Editor IO) Editor\ncommand = undefined\n\nparsed :: Conduit ByteString (StateT Editor IO) (Int,Text)\nparsed = undefined\n</code></pre>\n\n<p>So the problem would appear to be the use of <code>IO</code> in the <code>StateT</code> monad. But I don't know what to do about it. Any ideas?</p>\n"}, {"tags": ["haskell", "tree", "haskell-lens", "lenses"], "comments": [{"owner": {"reputation": 31243, "user_id": 2751851, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/4ddc0.png?s=128&g=1", "display_name": "duplode", "link": "https://stackoverflow.com/users/2751851/duplode"}, "edited": false, "score": 0, "creation_date": 1491164185, "post_id": 43170630, "comment_id": 73420169, "body": "Minor clarification: is the root of the <code>originalTree</code> part of the <code>path</code>?"}, {"owner": {"reputation": 1242, "user_id": 3252252, "user_type": "registered", "accept_rate": 53, "profile_image": "https://i.stack.imgur.com/4V81y.jpg?s=128&g=1", "display_name": "Jesuspc", "link": "https://stackoverflow.com/users/3252252/jesuspc"}, "reply_to_user": {"reputation": 31243, "user_id": 2751851, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/4ddc0.png?s=128&g=1", "display_name": "duplode", "link": "https://stackoverflow.com/users/2751851/duplode"}, "edited": false, "score": 0, "creation_date": 1491164996, "post_id": 43170630, "comment_id": 73420409, "body": "I didn&#39;t include it in the path during my pseudoimplementation but it would make sense for it to be there. I would say yes."}, {"owner": {"reputation": 2313, "user_id": 5318306, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/897fd4f3b92d28c5c1eb28a8024661a1?s=128&d=identicon&r=PG&f=1", "display_name": "Gurkenglas", "link": "https://stackoverflow.com/users/5318306/gurkenglas"}, "edited": false, "score": 1, "creation_date": 1491221164, "post_id": 43170630, "comment_id": 73441057, "body": "<code>Contravariant</code> is for getting, you want to set, and you never use <code>cmap</code>. Remove the <code>Contravariant</code> constraint from <code>traversalPath</code>."}], "answers": [{"tags": [], "owner": {"reputation": 31243, "user_id": 2751851, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/4ddc0.png?s=128&g=1", "display_name": "duplode", "link": "https://stackoverflow.com/users/2751851/duplode"}, "is_accepted": true, "score": 1, "last_activity_date": 1491170613, "last_edit_date": 1491170613, "creation_date": 1491167415, "answer_id": 43173575, "question_id": 43170630, "link": "https://stackoverflow.com/questions/43170630/traversing-and-adding-elements-to-a-data-tree-using-lenses-in-haskell/43173575#43173575", "title": "Traversing and adding elements to a Data.Tree using Lenses in Haskell", "body": "<p>This is not specially elegant, but should do the trick:</p>\n\n<pre><code>import Control.Lens\nimport Data.Monoid (Endo(..)) -- A tidier idiom for 'foldr (.) id'.\nimport Data.List.NonEmpty (NonEmpty(..)) -- You don't want an empty path.\nimport qualified Data.List.NonEmpty as N\nimport Data.Tree\nimport Data.Tree.Lens -- That's where I got 'branches' from.\n\naddToTree :: Eq a =&gt; NonEmpty a -&gt; Tree a -&gt; Tree a -&gt; Tree a\naddToTree path newNode oldTree = head $ over pathForests (newNode :) [oldTree]\n    where\n    pathForests = appEndo $ foldMap (Endo . goDown) path \n    goDown x = traverse . filtered ((x ==) . rootLabel) . branches\n</code></pre>\n\n<p>(In particular, I never like using <code>head</code>, even in cases like this one in which it can't possibly fail. Feel free to replace it with your favourite circumlocution.)</p>\n\n<p>Demo:</p>\n\n<pre><code>GHCi&gt; addToTree (1 :| []) (Node 2 []) (Node 1 [])\nNode {rootLabel = 1, subForest = [Node {rootLabel = 2, subForest = []}]}\nGHCi&gt; addToTree (4 :| []) (Node 2 []) (Node 1 [])\nNode {rootLabel = 1, subForest = []}\nGHCi&gt; addToTree (1 :| [5]) (Node 2 []) (Node 1 [Node 5 [], Node 6 []])\nNode {rootLabel = 1, subForest = [Node {rootLabel = 5, subForest = [Node {rootLabel = 2, subForest = []}]},Node {rootLabel = 6, subForest = []}]}\nGHCi&gt; addToTree (1 :| [7]) (Node 2 []) (Node 1 [Node 5 [], Node 6 []])\nNode {rootLabel = 1, subForest = [Node {rootLabel = 5, subForest = []},Node {rootLabel = 6, subForest = []}]}\nGHCi&gt; addToTree (1 :| [5,3]) (Node 2 []) (Node 1 [Node 5 [], Node 6 []])\nNode {rootLabel = 1, subForest = [Node {rootLabel = 5, subForest = []},Node {rootLabel = 6, subForest = []}]}\n</code></pre>\n\n<p>Do note that we are dealing with traversals, and not with lenses -- there is no guarantee or expectation that the target of the path exists or is unique.</p>\n\n<p>Here is a more stylised variant, without <code>head</code> and using <a href=\"https://hackage.haskell.org/package/lens-4.15.1/docs/Control-Lens-Wrapped.html#v:alaf\" rel=\"nofollow noreferrer\"><code>alaf</code></a> to handle the <code>Endo</code> wrapping.</p>\n\n<pre><code>addToTree :: Eq a =&gt; NonEmpty a -&gt; Tree a -&gt; Tree a -&gt; Tree a\naddToTree (desiredRoot :| path) newNode oldTree@(Node x ts)\n    | x == desiredRoot = Node x (over pathForests (newNode :) ts)\n    | otherwise = oldTree\n    where\n    pathForests = alaf Endo foldMap goDown path \n    goDown x = traverse . filtered ((x ==) . rootLabel) . branches\n</code></pre>\n"}], "owner": {"reputation": 1242, "user_id": 3252252, "user_type": "registered", "accept_rate": 53, "profile_image": "https://i.stack.imgur.com/4V81y.jpg?s=128&g=1", "display_name": "Jesuspc", "link": "https://stackoverflow.com/users/3252252/jesuspc"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 257, "favorite_count": 0, "accepted_answer_id": 43173575, "answer_count": 1, "score": -2, "last_activity_date": 1491802379, "creation_date": 1491150161, "last_edit_date": 1491802379, "question_id": 43170630, "link": "https://stackoverflow.com/questions/43170630/traversing-and-adding-elements-to-a-data-tree-using-lenses-in-haskell", "title": "Traversing and adding elements to a Data.Tree using Lenses in Haskell", "body": "<p>I'm starting to use lenses and until now I've been unable to use them in a concrete part of a codebase I'm writing. My objective is to update a rose tree structure such as the one in <code>Data.Tree</code> by adding a new node inside one of the existing ones. To do so I thought that it would make sense to identify each node with a unique id, so it would look like that:</p>\n\n<pre><code>type MyTree = Tree Id\ntype Path = [Id]\n\naddToTree :: MyTree -&gt; MyTree -&gt; Path -&gt; MyTree\naddToTree originalTree newNode path = undefined\n</code></pre>\n\n<p>The function <code>addToTree</code> would have to traverse the <code>originalTree</code> by following the path of ids and add the <code>newNode</code> at that level, returning the whole updated tree. I haven't had problems to make a getter for that but I'm not being able to find an appropriate lens to perform the operation with.</p>\n\n<p>That's what I've got until now:</p>\n\n<pre><code>import           Control.Lens\nimport           Data.Tree\nimport           Data.Tree.Lens\n\naddToTree :: MyTree -&gt; Path -&gt; MyTree -&gt; MyTree\naddToTree tree path branch = tree &amp; (traversalPath path) . branches %~ (branch:)\n\ntraversalPath :: (Foldable t, Applicative f, Contravariant f) =&gt; t Id -&gt; (MyTree -&gt; f MyTree) -&gt; MyTree -&gt; f MyTree\ntraversalPath = foldl (\\acc id-&gt; acc . childTraversal id) id\n\nchildTraversal :: (Indexable Int p, Applicative f) =&gt; Id -&gt; p MyTree (f MyTree) -&gt; MyTree -&gt; f MyTree\nchildTraversal id = branches . traversed . withId id\n\nwithId :: (Choice p, Applicative f) =&gt; Id -&gt; Optic' p f MyTree MyTree\nwithId id = filtered (\\x -&gt; rootLabel x == id)\n</code></pre>\n\n<p>But it fails to compile with:</p>\n\n<blockquote>\n<pre><code>\u2022 No instance for (Contravariant Identity)\n    arising from a use of \u2018traversalPath\u2019\n\u2022 In the first argument of \u2018(.)\u2019, namely \u2018(traversalPath path)\u2019\n  In the first argument of \u2018(%~)\u2019, namely\n    \u2018(traversalPath path) . branches\u2019\n  In the second argument of \u2018(&amp;)\u2019, namely\n    \u2018(traversalPath path) . branches %~ (branch :)\u2019\n</code></pre>\n</blockquote>\n\n<p>Thanks!</p>\n"}, {"tags": ["haskell"], "comments": [{"owner": {"reputation": 936, "user_id": 4884579, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/b0fca1fac3b94fed8f0291116e9b4ef6?s=128&d=identicon&r=PG&f=1", "display_name": "Erik", "link": "https://stackoverflow.com/users/4884579/erik"}, "edited": false, "score": 2, "creation_date": 1491147614, "post_id": 43170136, "comment_id": 73414088, "body": "I don&#39;t know if it&#39;s better, but this would be one alternative (assuming you don&#39;t need the handle for something else): <code>tail . lines &lt;$&gt; readFile &quot;foo.dat&quot;</code>"}, {"owner": {"reputation": 3922, "user_id": 1198582, "user_type": "registered", "accept_rate": 99, "profile_image": "https://www.gravatar.com/avatar/02d3e1025aed5f061c481871986c45b1?s=128&d=identicon&r=PG", "display_name": "Michael Litchard", "link": "https://stackoverflow.com/users/1198582/michael-litchard"}, "reply_to_user": {"reputation": 936, "user_id": 4884579, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/b0fca1fac3b94fed8f0291116e9b4ef6?s=128&d=identicon&r=PG&f=1", "display_name": "Erik", "link": "https://stackoverflow.com/users/4884579/erik"}, "edited": false, "score": 0, "creation_date": 1491150409, "post_id": 43170136, "comment_id": 73415083, "body": "That doesn&#39;t meet the spec. I don&#39;t want to read the entire file here. I want to have a handle that points to the second line. Reading the rest of the file is an entirely different problem."}, {"owner": {"reputation": 100892, "user_id": 745903, "user_type": "registered", "accept_rate": 74, "profile_image": "https://www.gravatar.com/avatar/50933f6638836741e620669b3940410e?s=128&d=identicon&r=PG", "display_name": "leftaroundabout", "link": "https://stackoverflow.com/users/745903/leftaroundabout"}, "edited": false, "score": 0, "creation_date": 1491401587, "post_id": 43170136, "comment_id": 73537486, "body": "@MichaelLitchard well, but in <code>ReadMode</code> all you can do, really, is <i>read the file</i>, anyway. And often it&#39;s actually the best thing to use <code>readFile</code> to do just that: read the entire file into a string and be done with the IO. For dealing with plain string data is much nicer than having to worry about side-effects. \u2014 Note that this does <i>not</i> require the program to halt there and wait until the whole file contents are processed: it&#39;s lazy, i.e. only the lines you actually need are read. Though this can also cause some nasty surprises; reading it all strict is safer."}], "answers": [{"tags": [], "owner": {"reputation": 1589, "user_id": 2535671, "user_type": "registered", "accept_rate": 87, "profile_image": "https://www.gravatar.com/avatar/fca1ba52e0c41803e676d449ef242e75?s=128&d=identicon&r=PG&f=1", "display_name": "Julian Leviston", "link": "https://stackoverflow.com/users/2535671/julian-leviston"}, "is_accepted": true, "score": 1, "last_activity_date": 1492325345, "creation_date": 1492325345, "answer_id": 43434550, "question_id": 43170136, "link": "https://stackoverflow.com/questions/43170136/is-there-a-better-way-to-open-a-file-while-skipping-a-line/43434550#43434550", "title": "Is there a better way to open a file while skipping a line?", "body": "<p>There's a function called <code>hSeek</code> which may be what you're after.</p>\n\n<p><a href=\"http://hackage.haskell.org/package/base-4.9.1.0/docs/System-IO.html#v:hSeek\" rel=\"nofollow noreferrer\">http://hackage.haskell.org/package/base-4.9.1.0/docs/System-IO.html#v:hSeek</a></p>\n\n<p>Have an experiment with that using GHCi, I'd recommend.</p>\n"}], "owner": {"reputation": 3922, "user_id": 1198582, "user_type": "registered", "accept_rate": 99, "profile_image": "https://www.gravatar.com/avatar/02d3e1025aed5f061c481871986c45b1?s=128&d=identicon&r=PG", "display_name": "Michael Litchard", "link": "https://stackoverflow.com/users/1198582/michael-litchard"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 56, "favorite_count": 0, "accepted_answer_id": 43434550, "answer_count": 1, "score": 2, "last_activity_date": 1492325345, "creation_date": 1491147163, "last_edit_date": 1491398822, "question_id": 43170136, "link": "https://stackoverflow.com/questions/43170136/is-there-a-better-way-to-open-a-file-while-skipping-a-line", "title": "Is there a better way to open a file while skipping a line?", "body": "<p>I want to open a file and skip the first line.  This is what I have come up with:</p>\n\n<pre><code>h :: IO Handle\nh = do h' &lt;- openFile \"foo.dat\" ReadMode\n       _  &lt;- hGetLine h'\n       return h'\n</code></pre>\n\n<p>Is there a better way to accomplish this?</p>\n"}, {"tags": ["haskell", "concurrency", "io"], "answers": [{"comments": [{"owner": {"reputation": 77, "user_id": 4847601, "user_type": "registered", "accept_rate": 25, "profile_image": "https://www.gravatar.com/avatar/622f3c8150294e73770e53a8b45dc19a?s=128&d=identicon&r=PG&f=1", "display_name": "RawLamb", "link": "https://stackoverflow.com/users/4847601/rawlamb"}, "edited": false, "score": 1, "creation_date": 1491141401, "post_id": 43168763, "comment_id": 73412147, "body": "Thanks, this helped. I can now get the program to compile and print my char using <code>deriving (Show)</code>, however, the output for this is for example <code>C &#39;g&#39;</code>, how could I get it to just print the character pressed by the user?"}, {"owner": {"reputation": 15757, "user_id": 176841, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/45a168cb9eb8454d66c78f18e29d9342?s=128&d=identicon&r=PG", "display_name": "jberryman", "link": "https://stackoverflow.com/users/176841/jberryman"}, "reply_to_user": {"reputation": 77, "user_id": 4847601, "user_type": "registered", "accept_rate": 25, "profile_image": "https://www.gravatar.com/avatar/622f3c8150294e73770e53a8b45dc19a?s=128&d=identicon&r=PG&f=1", "display_name": "RawLamb", "link": "https://stackoverflow.com/users/4847601/rawlamb"}, "edited": false, "score": 1, "creation_date": 1491146102, "post_id": 43168763, "comment_id": 73413539, "body": "@SebMarsh you can define your own <code>Show</code> instance or you could define a function <code>Msg -&gt; String</code> or <code>Msg -&gt; Text</code> that pretty prints a message however you like (then call <code>putStrLn</code> to write it to stdout)"}, {"owner": {"reputation": 77, "user_id": 4847601, "user_type": "registered", "accept_rate": 25, "profile_image": "https://www.gravatar.com/avatar/622f3c8150294e73770e53a8b45dc19a?s=128&d=identicon&r=PG&f=1", "display_name": "RawLamb", "link": "https://stackoverflow.com/users/4847601/rawlamb"}, "edited": false, "score": 0, "creation_date": 1491152353, "post_id": 43168763, "comment_id": 73415754, "body": "Thanks again. As I replied to jberryman I figured that I could use something like this to get my Msg data to act like a String if it&#39;s a Char. How would I start out in doing this? I haven&#39;t used my own instances before so I&#39;m somewhat lost."}], "tags": [], "owner": {"reputation": 100185, "user_id": 3234959, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/93bb12ca0f93dfddb33880316f7e66c2?s=128&d=identicon&r=PG&f=1", "display_name": "chi", "link": "https://stackoverflow.com/users/3234959/chi"}, "is_accepted": false, "score": 3, "last_activity_date": 1491138880, "creation_date": 1491138880, "answer_id": 43168763, "question_id": 43168691, "link": "https://stackoverflow.com/questions/43168691/haskell-couldnt-match-expected-type-io-with-io-threadid/43168763#43168763", "title": "Haskell: &quot;Couldn&#39;t match expected type IO () with IO ThreadId&quot;", "body": "<p><code>forkIO $ userThread chan</code> is an IO action which returns <code>ThreadId</code>, and being the last statement in the <code>main</code> <code>do</code> block, it makes <code>main</code> return that as well. However, you declared <code>main :: IO ()</code> so there's a type mismatch.</p>\n\n<p>Simply return a dummy tuple.</p>\n\n<pre><code>main = do\n   ...\n   forkIO $ userThread chan\n   return ()\n</code></pre>\n\n<p>(There's also a <a href=\"http://hackage.haskell.org/package/base-4.9.1.0/docs/Control-Monad.html#v:void\" rel=\"nofollow noreferrer\"><code>void</code></a> library function for this, but you can ignore it.)</p>\n"}, {"comments": [{"owner": {"reputation": 77, "user_id": 4847601, "user_type": "registered", "accept_rate": 25, "profile_image": "https://www.gravatar.com/avatar/622f3c8150294e73770e53a8b45dc19a?s=128&d=identicon&r=PG&f=1", "display_name": "RawLamb", "link": "https://stackoverflow.com/users/4847601/rawlamb"}, "edited": false, "score": 1, "creation_date": 1491151909, "post_id": 43170081, "comment_id": 73415619, "body": "Thank you, this helped me understand my problem a little bit but now I&#39;m facing an entirely new problem on how to make my Msg type behave like a String. I&#39;d like to put it in an existing list if the typed char is in not in the list BUT if the char already exists in this list, it isn&#39;t added and all instances of that char are removed from the list. I&#39;ll create another question shortly after a little more research."}], "tags": [], "owner": {"reputation": 15757, "user_id": 176841, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/45a168cb9eb8454d66c78f18e29d9342?s=128&d=identicon&r=PG", "display_name": "jberryman", "link": "https://stackoverflow.com/users/176841/jberryman"}, "is_accepted": false, "score": 3, "last_activity_date": 1491146831, "creation_date": 1491146831, "answer_id": 43170081, "question_id": 43168691, "link": "https://stackoverflow.com/questions/43168691/haskell-couldnt-match-expected-type-io-with-io-threadid/43170081#43170081", "title": "Haskell: &quot;Couldn&#39;t match expected type IO () with IO ThreadId&quot;", "body": "<p>Since you're going to get this error over and over as you learn haskell, I wanted to unpack it for you:</p>\n\n<pre><code>assignment1.hs:20:3: error:\n</code></pre>\n\n<p>GHC is giving you the file, line number and column number: <code>file:line:col</code></p>\n\n<pre><code>    * Couldn't match type `ThreadId' with `()'\n      Expected type: IO ()\n        Actual type: IO ThreadId\n</code></pre>\n\n<p><code>Expected type</code> refers to the type GHC is expecting for an expression, based on the context e.g. a type signature you provided, or the way you use a value returned from that expression. <code>Actual type</code> is the... actual type of the expression, e.g. a literal <code>'c'</code> has type <code>Char</code>, <code>map fst [('c', undefined)]</code> has actual type <code>[Char]</code>, etc.</p>\n\n<pre><code>    * In a stmt of a 'do' block: forkIO $ userThread chan\n</code></pre>\n\n<p>This ^ is the problem statement. <code>forkIO</code> returns a <code>ThreadId</code> (which you can see from its type signature). The tricky part here then, I suppose, is to know why the typechecker was expecting a type <code>IO ()</code> (because of your type signature, and the fact that the value returned in the last statement of your <code>do</code> block will be the type returned, as chi mentions).</p>\n\n<p>It's useful to have <code>ghci</code> open to help you answer questions like these as you're developing:</p>\n\n<pre><code>Prelude&gt; import Control.Concurrent\nPrelude Control.Concurrent&gt; :t forkIO\nforkIO :: IO () -&gt; IO ThreadId\nPrelude Control.Concurrent&gt; :t ()\n() :: ()\nPrelude Control.Concurrent&gt; :t repeat ()\nrepeat () :: [()]\n</code></pre>\n\n<p>The rest is more context which you probably don't need if you have the file in front of you:</p>\n\n<pre><code>      In the expression:\n        do { hSetBuffering stdout NoBuffering;\n             hSetBuffering stdin NoBuffering;\n             hSetEcho stdin False;\n             chan &lt;- newEmptyMVar;\n             .... }\n      In an equation for `main':\n          main\n            = do { hSetBuffering stdout NoBuffering;\n                   hSetBuffering stdin NoBuffering;\n                   hSetEcho stdin False;\n                   .... }\nFailed, modules loaded: none.\n</code></pre>\n"}], "owner": {"reputation": 77, "user_id": 4847601, "user_type": "registered", "accept_rate": 25, "profile_image": "https://www.gravatar.com/avatar/622f3c8150294e73770e53a8b45dc19a?s=128&d=identicon&r=PG&f=1", "display_name": "RawLamb", "link": "https://stackoverflow.com/users/4847601/rawlamb"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 449, "favorite_count": 0, "answer_count": 2, "score": 1, "last_activity_date": 1491146831, "creation_date": 1491138425, "question_id": 43168691, "link": "https://stackoverflow.com/questions/43168691/haskell-couldnt-match-expected-type-io-with-io-threadid", "title": "Haskell: &quot;Couldn&#39;t match expected type IO () with IO ThreadId&quot;", "body": "<p>I'm new to concurrency in Haskell and I'm trying to get a result where a new MVar is made in the <code>main</code> thread, is passed over empty to the <code>userThread</code> thread, which takes a character input from the user, then puts that value in an MVar and has the <code>main</code> thread print it.</p>\n\n<p>Here is what I have so far</p>\n\n<pre><code>module Main where\n\nimport Control.Concurrent\nimport Control.Monad\nimport System.IO\nimport System.Random\nimport Text.Printf\n\ndata Msg = C Char | Time\n\n\nmain :: IO ()\nmain = do\n  hSetBuffering stdout NoBuffering\n  hSetBuffering stdin NoBuffering\n  hSetEcho stdin False\n\n  -- shared resources\n  chan &lt;- newEmptyMVar\n  forkIO $ userThread chan\n  --r &lt;- takeMVar chan\n  --show(r)\n\n\nuserThread :: MVar Msg -&gt; IO ()\nuserThread chan = forever $ do\n  x &lt;- getChar\n  putMVar chan (C x)\n</code></pre>\n\n<p>Right now, I'm stuck on trying to put the entered char into the MVar, I've pasted the error below</p>\n\n<pre><code>assignment1.hs:20:3: error:\n    * Couldn't match type `ThreadId' with `()'\n      Expected type: IO ()\n        Actual type: IO ThreadId\n    * In a stmt of a 'do' block: forkIO $ userThread chan\n      In the expression:\n        do { hSetBuffering stdout NoBuffering;\n             hSetBuffering stdin NoBuffering;\n             hSetEcho stdin False;\n             chan &lt;- newEmptyMVar;\n             .... }\n      In an equation for `main':\n          main\n            = do { hSetBuffering stdout NoBuffering;\n                   hSetBuffering stdin NoBuffering;\n                   hSetEcho stdin False;\n                   .... }\nFailed, modules loaded: none.\n</code></pre>\n\n<p>Any pointers in the right direction would be a great help!\nThanks everyone</p>\n"}, {"tags": ["string", "list", "haskell", "instance"], "comments": [{"owner": {"reputation": 1227, "user_id": 5053374, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/efe57f0998df065470ff42c938f781cf?s=128&d=identicon&r=PG", "display_name": "Libby", "link": "https://stackoverflow.com/users/5053374/libby"}, "edited": false, "score": 0, "creation_date": 1491138237, "post_id": 43168519, "comment_id": 73411245, "body": "You showed the input and output that you already have working. Could you add an example input and the desired output that you&#39;re having trouble with?"}, {"owner": {"reputation": 1487, "user_id": 3668541, "user_type": "registered", "accept_rate": 64, "profile_image": "https://www.gravatar.com/avatar/ba66d28285a3e98b836178617d096b75?s=128&d=identicon&r=PG&f=1", "display_name": "haz", "link": "https://stackoverflow.com/users/3668541/haz"}, "reply_to_user": {"reputation": 1227, "user_id": 5053374, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/efe57f0998df065470ff42c938f781cf?s=128&d=identicon&r=PG", "display_name": "Libby", "link": "https://stackoverflow.com/users/5053374/libby"}, "edited": false, "score": 0, "creation_date": 1491138418, "post_id": 43168519, "comment_id": 73411310, "body": "That&#39;d probably be helpful! Edited."}, {"owner": {"reputation": 100185, "user_id": 3234959, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/93bb12ca0f93dfddb33880316f7e66c2?s=128&d=identicon&r=PG&f=1", "display_name": "chi", "link": "https://stackoverflow.com/users/3234959/chi"}, "edited": false, "score": 1, "creation_date": 1491139316, "post_id": 43168519, "comment_id": 73411545, "body": "I&#39;m unsure about whether this is a good idea. <code>Show</code> is conventionally meant to produce single-line data representations, usually employing Haskell syntax for that. Using a multiple-line text like that will play weirdly with all standard containers like arrays, maps, sets, etc. (Lists <code>[]</code> are exceptional and can be customized, anyway.) I&#39;d consider using a custom pretty-printing routine <code>representatrix</code> which lies outside the <code>Show</code> class."}], "answers": [{"tags": [], "owner": {"reputation": 78982, "user_id": 1848654, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/84180c0f3c9c04f8b8f0613fc0129dac?s=128&d=identicon&r=PG", "display_name": "melpomene", "link": "https://stackoverflow.com/users/1848654/melpomene"}, "is_accepted": false, "score": 2, "last_activity_date": 1491138729, "creation_date": 1491138729, "answer_id": 43168742, "question_id": 43168519, "link": "https://stackoverflow.com/questions/43168519/instance-of-show-list-for-a-custom-datatype/43168742#43168742", "title": "Instance of Show list for a custom datatype", "body": "<p>This is exactly what the <a href=\"http://hackage.haskell.org/package/base-4.9.1.0/docs/Prelude.html#v:showList\" rel=\"nofollow noreferrer\"><code>showList</code></a> method is for:</p>\n\n<pre><code>instance Show a =&gt; Show (Matrix a) where\n    show (M a) = intercalate \"\\n\" (map (unwords . map show) a) ++ \"\\n\"\n    showList (m:ms) = shows m . (\"\\n\" ++) . showList ms\n</code></pre>\n\n<p>Note that this doesn't handle empty lists, though, so you also need</p>\n\n<pre><code>    showList [] = id\n</code></pre>\n\n<p>(or whatever you want it to show for empty lists.)</p>\n"}], "owner": {"reputation": 1487, "user_id": 3668541, "user_type": "registered", "accept_rate": 64, "profile_image": "https://www.gravatar.com/avatar/ba66d28285a3e98b836178617d096b75?s=128&d=identicon&r=PG&f=1", "display_name": "haz", "link": "https://stackoverflow.com/users/3668541/haz"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 230, "favorite_count": 0, "answer_count": 1, "score": 1, "last_activity_date": 1491138729, "creation_date": 1491137349, "last_edit_date": 1491138395, "question_id": 43168519, "link": "https://stackoverflow.com/questions/43168519/instance-of-show-list-for-a-custom-datatype", "title": "Instance of Show list for a custom datatype", "body": "<p>I have defined a (Matrix) datatype, as a 2D list:</p>\n\n<pre><code>newtype Matrix a = M [[a]]\n</code></pre>\n\n<p>and an instance for <code>Show</code>, as follows:</p>\n\n<pre><code>instance Show a =&gt; Show (Matrix a) where\n    show (M a) = intercalate \"\\n\" (map (unwords . map show) a) ++ \"\\n\"\n</code></pre>\n\n<p>Which behaves like so:</p>\n\n<pre><code>&gt; mat = M [[3,1,8],[6,3,0],[6,8,8]]\n&gt; mat\n3 1 8\n6 3 0\n6 8 8\n</code></pre>\n\n<p>However, I'd like to handle how it prints lists, because the default behaviour looks a bit weird. How do I specify this? I've tried something like these:</p>\n\n<pre><code>instance Show a =&gt; Show ([Matrix a]) where\n    show mat = case mat of\n      [M a] -&gt; intercalate \"\\n\" (map (unwords . map show) a) ++ \"\\n\"\n      (m:ms) -&gt; show m ++ \"\\n\" ++ show ms\n\n  instance Show a =&gt; Show (Matrix a) where\n    show (M a)  = intercalate \"\\n\" (map (unwords . map show) a) ++ \"\\n\"\n    show (m:ms) = show m ++ \"\\n\" ++ show ms\n</code></pre>\n\n<p>But I just get syntax errors. I tried googling the issue, but I couldn't find anything (Perhaps I used the wrong keywords?)</p>\n\n<p>Thanks in advance.</p>\n\n<p>EDIT:</p>\n\n<p>Desired input and output:</p>\n\n<pre><code>mat1 = M [[1,2],[3,4]]\nmat2 = M [[1,2],[3,4]]\n&gt; [mat1, mat2]\n1 2\n3 4,\n1 2\n3 4\n</code></pre>\n"}, {"tags": ["haskell", "yesod", "persistent", "esqueleto"], "answers": [{"tags": [], "owner": {"reputation": 3430, "user_id": 228136, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/fec7f2a7c5b8e1d66eabffe624d1cbf6?s=128&d=identicon&r=PG", "display_name": "Greyson", "link": "https://stackoverflow.com/users/228136/greyson"}, "is_accepted": true, "score": 2, "last_activity_date": 1491103196, "creation_date": 1491103196, "answer_id": 43164267, "question_id": 43163817, "link": "https://stackoverflow.com/questions/43163817/returning-maybe-entity-a-from-esqueleto-leftouterjoin/43164267#43164267", "title": "Returning `Maybe (Entity a)` from Esqueleto `LeftOuterJoin`", "body": "<p>This could probably be marked a duplicate of <a href=\"https://stackoverflow.com/questions/23967523/outer-joins-with-esqueleto\">Outer Joins with Esqueleto</a>; however the difference is in the projection.</p>\n\n<p>When dealing with any outer joins, all tables which may come back null should have <strong>all</strong> projections done with the <code>?.</code> syntax. This will force the table's entities to become <code>Maybe (Entity a)</code> So the solution to the above is </p>\n\n<pre><code>selectContainerSlots containerKey = do\n  stuff &lt;- select $ from $ \\(cs `LeftOuterJoin` i) -&gt; do\n    on $ cs ^. ContainerSlotItem ==. i ?. InventoryId\n    where_ $ cs ^. ContainerSlotContainer ==. val containerKey\n    return (cs, i)\n  return $ uncurry buildStuff &lt;$&gt; stuff\n</code></pre>\n\n<p>Additionally, if more than one table is chained; e.g.</p>\n\n<pre><code>select $ from $ \\(cs `LeftOuterJoin` (i `InnerJoin` is)) -&gt; do\n</code></pre>\n\n<p>Then <strong>both</strong> <code>i</code> and <code>is</code> (inventory SKU table) should be projected with that syntax:</p>\n\n<pre><code>  on $ i ?. InventoryId ==. is ?. InventorySkuItem\n  on $ cs ^. ContainerSlotItem ==. i ?. InventoryId\n</code></pre>\n"}], "owner": {"reputation": 3430, "user_id": 228136, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/fec7f2a7c5b8e1d66eabffe624d1cbf6?s=128&d=identicon&r=PG", "display_name": "Greyson", "link": "https://stackoverflow.com/users/228136/greyson"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 223, "favorite_count": 0, "accepted_answer_id": 43164267, "answer_count": 1, "score": 3, "last_activity_date": 1491103196, "creation_date": 1491097778, "question_id": 43163817, "link": "https://stackoverflow.com/questions/43163817/returning-maybe-entity-a-from-esqueleto-leftouterjoin", "title": "Returning `Maybe (Entity a)` from Esqueleto `LeftOuterJoin`", "body": "<p>From a contrived <code>config/models</code> in a scaffolded site:</p>\n\n<pre><code>Inventory\n  name        Text\n  description Text\nContainer\n  name        Text\nContainerSlot\n  container   ContainerId\n  item        InventoryId Maybe\n</code></pre>\n\n<p>Now, using Esqueleto, I want to use <code>LeftOuterJoin</code> to get the slots in a container, with the actual inventory empty if it has not been assigned.</p>\n\n<pre><code>selectContainerSlots containerKey = do\n  stuff &lt;- select $ from $ \\(cs `LeftOuterJoin` i) -&gt; do\n    on $ cs ^. ContainerSlotItem ==. just (i ^. InventoryId)\n    where_ $ cs ^. ContainerSlotContainer ==. val containerKey\n    return (cs, i)\n  return $ uncurry buildStuff &lt;$&gt; stuff\n</code></pre>\n\n<p>I would expect <code>buildStuff</code> to need the following signature due to the \"outer\" nature of the join:</p>\n\n<pre><code>buildStuff :: Entity ContainerSlot -&gt; Maybe (Entity Inventory) -&gt; Result\n</code></pre>\n\n<p>but find that it needs the following:</p>\n\n<pre><code>buildStuff :: Entity ContainerSlot -&gt; Entity Inventory -&gt; Result\n</code></pre>\n\n<p>Which causes runtime failures when (predictably) the the <code>Inventory</code> fields are filled with <code>NULL</code> values.</p>\n\n<pre><code>PersistMarshalError \"field id: int64 Expected Integer, received: PersistNull\"\n</code></pre>\n\n<p>Is there a way to project the <code>Entity Inventory</code> as an <code>Maybe (Entity Inventory)</code>?</p>\n"}, {"tags": ["haskell", "math"], "comments": [{"owner": {"reputation": 100892, "user_id": 745903, "user_type": "registered", "accept_rate": 74, "profile_image": "https://www.gravatar.com/avatar/50933f6638836741e620669b3940410e?s=128&d=identicon&r=PG", "display_name": "leftaroundabout", "link": "https://stackoverflow.com/users/745903/leftaroundabout"}, "edited": false, "score": 0, "creation_date": 1491137714, "post_id": 43163681, "comment_id": 73411069, "body": "I have no idea why <code>solveRationalLinearEqs</code> gives an <code>IO</code> result. This certainly seems to be an application where the result should be pure. \u2014 It can&#39;t be too hard to use solvers from other libraries; my <a href=\"http://hackage.haskell.org/package/linearmap-category-0.3.2.0/docs/Math-LinearMap-Category.html#g:10\" rel=\"nofollow noreferrer\"><code>\\$</code></a> should in principle work with <code>Rational</code>, I just haven&#39;t added <code>instance LinearSpace Rational</code> yet (but you could fork it and just copy <a href=\"https://github.com/leftaroundabout/linearmap-family/blob/5915be93/Math/LinearMap/Category/Instances.hs#L71\" rel=\"nofollow noreferrer\">the <code>Double</code> instance</a>)."}, {"owner": {"reputation": 225, "user_id": 2352867, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/sNljI.png?s=128&g=1", "display_name": "Tim", "link": "https://stackoverflow.com/users/2352867/tim"}, "reply_to_user": {"reputation": 100892, "user_id": 745903, "user_type": "registered", "accept_rate": 74, "profile_image": "https://www.gravatar.com/avatar/50933f6638836741e620669b3940410e?s=128&d=identicon&r=PG", "display_name": "leftaroundabout", "link": "https://stackoverflow.com/users/745903/leftaroundabout"}, "edited": false, "score": 0, "creation_date": 1491139594, "post_id": 43163681, "comment_id": 73411618, "body": "@leftaroundabout it uses external libraries (e.g. CVC4 or Z3) to actually solve the systems, so I guess that&#39;s why it wraps the result in an IO. Is the package you linked to yours? I couldn&#39;t find any libraries except the two I mentioned when I was googling initially."}, {"owner": {"reputation": 100892, "user_id": 745903, "user_type": "registered", "accept_rate": 74, "profile_image": "https://www.gravatar.com/avatar/50933f6638836741e620669b3940410e?s=128&d=identicon&r=PG", "display_name": "leftaroundabout", "link": "https://stackoverflow.com/users/745903/leftaroundabout"}, "edited": false, "score": 0, "creation_date": 1491144459, "post_id": 43163681, "comment_id": 73413077, "body": "Well, the FFI allows giving the bindings to such external functions a pure-function type, even though the compiler obviously can&#39;t confirm that this is valid. (<code>hmatrix</code> does this, it also calls externals from GSL.)"}, {"owner": {"reputation": 100892, "user_id": 745903, "user_type": "registered", "accept_rate": 74, "profile_image": "https://www.gravatar.com/avatar/50933f6638836741e620669b3940410e?s=128&d=identicon&r=PG", "display_name": "leftaroundabout", "link": "https://stackoverflow.com/users/745903/leftaroundabout"}, "edited": false, "score": 1, "creation_date": 1491144577, "post_id": 43163681, "comment_id": 73413106, "body": "As to <code>linearmap-category</code> \u2013 yes, I only wrote it last summer, it&#39;s (AFAIK) not used in any other projects yet, Google wouldn&#39;t consider it relevant. (Anyway Google is seldom the best search for Haskell-related stuff, for general concepts I&#39;d first go for the <a href=\"http://hackage.haskell.org/packages/search\" rel=\"nofollow noreferrer\">hackage package search</a>.) It&#39;s also hardly optimised at the moment, so whether this is good for your application I don&#39;t know, but it might well be. If you add &amp; test a <code>Rational</code> instance, the pull request would be highly welcome..."}, {"owner": {"reputation": 225, "user_id": 2352867, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/sNljI.png?s=128&g=1", "display_name": "Tim", "link": "https://stackoverflow.com/users/2352867/tim"}, "reply_to_user": {"reputation": 100892, "user_id": 745903, "user_type": "registered", "accept_rate": 74, "profile_image": "https://www.gravatar.com/avatar/50933f6638836741e620669b3940410e?s=128&d=identicon&r=PG", "display_name": "leftaroundabout", "link": "https://stackoverflow.com/users/745903/leftaroundabout"}, "edited": false, "score": 0, "creation_date": 1491146869, "post_id": 43163681, "comment_id": 73413800, "body": "@leftaroundabout after I&#39;ve finished working on this problem I will definitely try to get around to testing a <code>Rational</code> instance :) I&#39;m actually really interested in getting involved in the mathematical Haskell community, so might be a good way to start!"}, {"owner": {"reputation": 1593, "user_id": 1829442, "user_type": "registered", "accept_rate": 83, "profile_image": "https://www.gravatar.com/avatar/f1b88b650cc161e532273962f4017f75?s=128&d=identicon&r=PG", "display_name": "idontgetoutmuch", "link": "https://stackoverflow.com/users/1829442/idontgetoutmuch"}, "edited": false, "score": 0, "creation_date": 1491154387, "post_id": 43163681, "comment_id": 73416514, "body": "Just curious but why do you need greater than <code>Double</code> precision?"}, {"owner": {"reputation": 225, "user_id": 2352867, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/sNljI.png?s=128&g=1", "display_name": "Tim", "link": "https://stackoverflow.com/users/2352867/tim"}, "reply_to_user": {"reputation": 1593, "user_id": 1829442, "user_type": "registered", "accept_rate": 83, "profile_image": "https://www.gravatar.com/avatar/f1b88b650cc161e532273962f4017f75?s=128&d=identicon&r=PG", "display_name": "idontgetoutmuch", "link": "https://stackoverflow.com/users/1829442/idontgetoutmuch"}, "edited": false, "score": 0, "creation_date": 1491157112, "post_id": 43163681, "comment_id": 73417610, "body": "@idontgetoutmuch I know that the solutions will be very simple rational numbers, and for some reason working with <code>Double</code> gave me decimals like 0.11423... and I wasn&#39;t sure whether this should be 1/10 or 1/9, for example, especially since some numbers that I knew should be zero were given as ~0.1"}], "answers": [{"comments": [{"owner": {"reputation": 225, "user_id": 2352867, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/sNljI.png?s=128&g=1", "display_name": "Tim", "link": "https://stackoverflow.com/users/2352867/tim"}, "edited": false, "score": 0, "creation_date": 1491135273, "post_id": 43164030, "comment_id": 73410318, "body": "it&#39;s a bit annoying (i.e. makes things more confusing for me) that I have to deal with IO for the rest of my code and use fmap all the time etc. just because this one module has a return type of IO... but as long as it works, I&#39;ll deal with it! thanks"}, {"owner": {"reputation": 1735, "user_id": 2892792, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/5DNyi.jpg?s=128&g=1", "display_name": "Lazersmoke", "link": "https://stackoverflow.com/users/2892792/lazersmoke"}, "reply_to_user": {"reputation": 225, "user_id": 2352867, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/sNljI.png?s=128&g=1", "display_name": "Tim", "link": "https://stackoverflow.com/users/2352867/tim"}, "edited": false, "score": 0, "creation_date": 1491144452, "post_id": 43164030, "comment_id": 73413073, "body": "The reason it has <code>IO</code> in the type is because it does IO. If you want to ignore the fact that it does IO, and don&#39;t care where and when it does IO, you can use <code>unsafePerformIO</code>, but be aware that it might cause problems."}, {"owner": {"reputation": 100892, "user_id": 745903, "user_type": "registered", "accept_rate": 74, "profile_image": "https://www.gravatar.com/avatar/50933f6638836741e620669b3940410e?s=128&d=identicon&r=PG", "display_name": "leftaroundabout", "link": "https://stackoverflow.com/users/745903/leftaroundabout"}, "reply_to_user": {"reputation": 225, "user_id": 2352867, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/sNljI.png?s=128&g=1", "display_name": "Tim", "link": "https://stackoverflow.com/users/2352867/tim"}, "edited": false, "score": 1, "creation_date": 1491144929, "post_id": 43164030, "comment_id": 73413201, "body": "@Tim yes, this is one of the (rare!) occasions where <code>unsafePerformIO</code> might be Ok to use. But it&#39;s a bit annoying that the library burdens this risk upon the user; well-written FFI bindings should determine what&#39;s needed to ensure referential transparency and then offer pure wrappers that are reliable."}, {"owner": {"reputation": 225, "user_id": 2352867, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/sNljI.png?s=128&g=1", "display_name": "Tim", "link": "https://stackoverflow.com/users/2352867/tim"}, "edited": false, "score": 0, "creation_date": 1491147111, "post_id": 43164030, "comment_id": 73413896, "body": "@Lazersmoke I actually did end up just using unsafePerformIO. This code is only to calculate a few examples, and when I have them I can hopefully understand what I&#39;m studying better and come back and write some much nicer Haskell"}, {"owner": {"reputation": 18055, "user_id": 936310, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/302ec54987694b9746abf8e2e0ad8caf?s=128&d=identicon&r=PG&f=1", "display_name": "alias", "link": "https://stackoverflow.com/users/936310/alias"}, "edited": false, "score": 0, "creation_date": 1491172489, "post_id": 43164030, "comment_id": 73422507, "body": "I&#39;m the author of the linearEqSolver package. The reason it does IO is because it does solve the problem by calling out to an external SMT solver. (Such as Z3, Yices, etc.) Wrapping it up in an <code>unsafePerformIO</code> might be &quot;safe enough,&quot; but I&#39;d strongly recommend against it. You are truly making a call to a different program, running on your computer on a different thread. I think it would be wise to keep the IO type in this case, as exposed by the library."}, {"owner": {"reputation": 100892, "user_id": 745903, "user_type": "registered", "accept_rate": 74, "profile_image": "https://www.gravatar.com/avatar/50933f6638836741e620669b3940410e?s=128&d=identicon&r=PG", "display_name": "leftaroundabout", "link": "https://stackoverflow.com/users/745903/leftaroundabout"}, "reply_to_user": {"reputation": 18055, "user_id": 936310, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/302ec54987694b9746abf8e2e0ad8caf?s=128&d=identicon&r=PG&f=1", "display_name": "alias", "link": "https://stackoverflow.com/users/936310/alias"}, "edited": false, "score": 0, "creation_date": 1491173927, "post_id": 43164030, "comment_id": 73422825, "body": "@LeventErkok great you chime in. I hope I wasn&#39;t unjustly critical about your library. Didn&#39;t realise what a huge and rather thrilling project is behind that package \u2013 kudos! \u2014 I&#39;m really not into SMT, so I might be totally off, but... surely, at least this particular problem of calculating, in exact arithmetic, solutions to (full-rank) linear systems is perfecty well-defined and referentially transparent, so no matter if it&#39;s implemented through traditional LU etc. or external SMT solving, single- or multithreaded, it shouldn&#39;t need an <code>IO</code> result? Or do these solvers have global state?"}, {"owner": {"reputation": 18055, "user_id": 936310, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/302ec54987694b9746abf8e2e0ad8caf?s=128&d=identicon&r=PG&f=1", "display_name": "alias", "link": "https://stackoverflow.com/users/936310/alias"}, "reply_to_user": {"reputation": 100892, "user_id": 745903, "user_type": "registered", "accept_rate": 74, "profile_image": "https://www.gravatar.com/avatar/50933f6638836741e620669b3940410e?s=128&d=identicon&r=PG", "display_name": "leftaroundabout", "link": "https://stackoverflow.com/users/745903/leftaroundabout"}, "edited": false, "score": 0, "creation_date": 1491174387, "post_id": 43164030, "comment_id": 73422919, "body": "@leftaroundabout No problem at all; criticisms/suggestions are always welcome. I still think it&#39;s best to keep the IO: Depending on your solver configuration (starting seed, other options that you might invoke it with etc.) the solver can definitely return different answers to your query, if the given system of equations does not have a unique solution. Just by that argument, I think keeping the IO is justified. But I don&#39;t think anything <i>bad</i> would happen if you wrapped unsafePerformIO around it, since the interactions should be thread safe. (Of course, this is a proof obligation.)"}], "tags": [], "owner": {"reputation": 1735, "user_id": 2892792, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/5DNyi.jpg?s=128&g=1", "display_name": "Lazersmoke", "link": "https://stackoverflow.com/users/2892792/lazersmoke"}, "is_accepted": true, "score": 2, "last_activity_date": 1491100591, "creation_date": 1491100591, "answer_id": 43164030, "question_id": 43163681, "link": "https://stackoverflow.com/questions/43163681/solving-linear-equations-math-linearequationsolver-returns-iomayberational/43164030#43164030", "title": "Solving linear equations - Math.LinearEquationSolver returns IO(Maybe[Rational])", "body": "<p>The most idiomatic way to do this is to use <code>&gt;&gt;=</code> to combine the <code>IO</code> action that produces your result with the rest of your program.</p>\n\n<pre><code>(&gt;&gt;=) :: Monad m =&gt; m  a                  -&gt; (a                  -&gt; m  b) -&gt; m  b\n(&gt;&gt;=) ::            IO (Maybe [Rational]) -&gt; ((Maybe [Rational]) -&gt; IO a) -&gt; IO a\n</code></pre>\n\n<p>You would use it like this:</p>\n\n<pre><code>(linearEqSolver arg1 arg2 arg3 ... argn) &gt;&gt;= \\maybeResult -&gt; case maybeResult of\n  Just resultList -&gt; (... :: IO a)\n  Nothing -&gt; (... :: IO a)\n</code></pre>\n\n<p>Alternatively, if the rest of your code doesn't need <code>IO</code>, you can use <code>fmap</code>, or its infix synonym <code>&lt;$&gt;</code> to map a pure function over the result of <code>linearEqSolver</code>.</p>\n\n<pre><code>theRestOfYourCode :: Maybe [Rational] -&gt; a\n(theRestOfYourCode &lt;$&gt; (linearEqSolver arg1 arg2 ... argn)) :: IO a\n</code></pre>\n\n<p>Note: Most of these type signatures are just for clarity, and can be inferred.</p>\n\n<p>You could also use the <code>Monad</code> instance for <code>Maybe</code> in the same way, but pattern matching is clearer in this case, since it is hard to mentally parse expressions that use multiple <code>Monad</code> instances in general.</p>\n"}], "owner": {"reputation": 225, "user_id": 2352867, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/sNljI.png?s=128&g=1", "display_name": "Tim", "link": "https://stackoverflow.com/users/2352867/tim"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 354, "favorite_count": 0, "accepted_answer_id": 43164030, "answer_count": 1, "score": 1, "last_activity_date": 1491100591, "creation_date": 1491095986, "last_edit_date": 1491098782, "question_id": 43163681, "link": "https://stackoverflow.com/questions/43163681/solving-linear-equations-math-linearequationsolver-returns-iomayberational", "title": "Solving linear equations - Math.LinearEquationSolver returns IO(Maybe[Rational])", "body": "<p>I am writing a program to solve certain mathematical problems, and Haskell is the language I've written it in so far (for various reasons). At one point, I need to solve a system of linear equations, and then use the result for something else. I can give more details if needed, but didn't want to go crazy at first.</p>\n\n<p>The easiest way I could find of solving linear equations was to use the <code>Math.LinearEquationSolver</code> module from the <code>linearEqSolver</code> package on hackage. Everything works fine, except that all of the methods (e.g. <code>solveRationalLinearEqs</code>) have a return type of <code>IO (Maybe [Rational])</code>. I want to be able to feed the solution into a method which accepts <code>[Rational]</code>.</p>\n\n<p>I know that the whole point of <code>IO</code> is that you can't just take stuff out of it and put it back in, but I haven't written Haskell in enough years now that I've forgotten all of what I used to know about IO.</p>\n\n<p>Is there an easy explanation/example of what I should do? Is the simplest solution to use some other module/find some other way of solving the system of equations?</p>\n\n<p><strong>Edit:</strong> I have tried using the <code>HMatrix</code> method <code>linearSolveLS</code> but this returns a list of type <code>[Double]</code> (and is also nowhere near accurate enough for what I need, even if I did settle for a non-fractional type), whereas I would really prefer the return to be of type <code>[Rational]</code> (as in <code>LinearEquationSolver</code>).</p>\n"}, {"tags": ["haskell", "module", "haskell-stack"], "comments": [{"owner": {"reputation": 1227, "user_id": 5053374, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/efe57f0998df065470ff42c938f781cf?s=128&d=identicon&r=PG", "display_name": "Libby", "link": "https://stackoverflow.com/users/5053374/libby"}, "edited": false, "score": 1, "creation_date": 1491100029, "post_id": 43163491, "comment_id": 73402672, "body": "What does your *.cabal file look like?"}, {"owner": {"reputation": 1735, "user_id": 2892792, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/5DNyi.jpg?s=128&g=1", "display_name": "Lazersmoke", "link": "https://stackoverflow.com/users/2892792/lazersmoke"}, "edited": false, "score": 0, "creation_date": 1491100791, "post_id": 43163491, "comment_id": 73402790, "body": "You probably need to add <code>Shape</code> to the <code>exposed-modules</code> or <code>other-modules</code> field in your cabal file. This tells cabal to attempt to use that file for as a module."}, {"owner": {"reputation": 5335, "user_id": 2309862, "user_type": "registered", "accept_rate": 72, "profile_image": "https://i.stack.imgur.com/8xjCJ.jpg?s=128&g=1", "display_name": "vamsiampolu", "link": "https://stackoverflow.com/users/2309862/vamsiampolu"}, "reply_to_user": {"reputation": 1227, "user_id": 5053374, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/efe57f0998df065470ff42c938f781cf?s=128&d=identicon&r=PG", "display_name": "Libby", "link": "https://stackoverflow.com/users/5053374/libby"}, "edited": false, "score": 0, "creation_date": 1491110564, "post_id": 43163491, "comment_id": 73404332, "body": "@Libby I have added my .cabal file."}, {"owner": {"reputation": 5335, "user_id": 2309862, "user_type": "registered", "accept_rate": 72, "profile_image": "https://i.stack.imgur.com/8xjCJ.jpg?s=128&g=1", "display_name": "vamsiampolu", "link": "https://stackoverflow.com/users/2309862/vamsiampolu"}, "reply_to_user": {"reputation": 1735, "user_id": 2892792, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/5DNyi.jpg?s=128&g=1", "display_name": "Lazersmoke", "link": "https://stackoverflow.com/users/2892792/lazersmoke"}, "edited": false, "score": 0, "creation_date": 1491110894, "post_id": 43163491, "comment_id": 73404390, "body": "@Lazersmoke should I added the module to exposed-modules but it still gives me the same error."}, {"owner": {"reputation": 5335, "user_id": 2309862, "user_type": "registered", "accept_rate": 72, "profile_image": "https://i.stack.imgur.com/8xjCJ.jpg?s=128&g=1", "display_name": "vamsiampolu", "link": "https://stackoverflow.com/users/2309862/vamsiampolu"}, "reply_to_user": {"reputation": 1735, "user_id": 2892792, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/5DNyi.jpg?s=128&g=1", "display_name": "Lazersmoke", "link": "https://stackoverflow.com/users/2892792/lazersmoke"}, "edited": false, "score": 0, "creation_date": 1491124455, "post_id": 43163491, "comment_id": 73407372, "body": "I have solved the issue, I did not know that it was necessary to use the same file name as the module name. When I changed the name from <code>shapes</code> to <code>Shapes</code>, it picked up the module from <code>exposed-modules</code>. Thanks @Lazersmoke for the suggestion."}], "owner": {"reputation": 5335, "user_id": 2309862, "user_type": "registered", "accept_rate": 72, "profile_image": "https://i.stack.imgur.com/8xjCJ.jpg?s=128&g=1", "display_name": "vamsiampolu", "link": "https://stackoverflow.com/users/2309862/vamsiampolu"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 70, "favorite_count": 0, "answer_count": 0, "score": 0, "last_activity_date": 1491110978, "creation_date": 1491093823, "last_edit_date": 1491110978, "question_id": 43163491, "link": "https://stackoverflow.com/questions/43163491/could-not-load-exported-module-using-stack", "title": "Could not load exported module using stack", "body": "<p>I get an error when getting a <code>Shape</code> module within the same directory as the <code>Main</code> module inside the <code>Main</code> module when I do <code>stack build</code> or use <code>:r</code> inside <code>stack ghci</code>.</p>\n\n<pre><code>/home/vamsi/Do/learn-haskell/my-project/src/Main.hs:5:1: error:\n    Failed to load interface for \u2018Shapes\u2019\n    Use -v to see a list of the files searched for.\nFailed, modules loaded: none.\n</code></pre>\n\n<p>When run with <code>-v</code> added to the module:</p>\n\n<pre><code>[debug] Run process: ghc --interactive -i -odir=/home/vamsi/Do/learn-haskell/my-project/.stack-work/odir -hidir=/home/vamsi/Do/learn-haskell/my-project/.stack-work/odir -hide-all-packages -i/home/vamsi/Do/learn-haskell/my-project/src -i/home/vamsi/Do/learn-haskell/my-project/.stack-work/dist/x86_64-linux/Cabal-1.24.2.0/build/autogen -i/home/vamsi/Do/learn-haskell/my-project/.stack-work/dist/x86_64-linux/Cabal-1.24.2.0/build -i/home/vamsi/Do/learn-haskell/my-project/.stack-work/dist/x86_64-linux/Cabal-1.24.2.0/build/my-project/my-project-tmp -stubdir=/home/vamsi/Do/learn-haskell/my-project/.stack-work/dist/x86_64-linux/Cabal-1.24.2.0/build -package-id=base-4.9.1.0 -package-id=time-1.6.0.1 -package-id=aeson-1.0.2.1-CYngHPh1vosBJovY7C9thn -package-id=rethinkdb-2.2.0.9-Av4kLRfBxQS6TPGimEKUNt -optP-include -optP/tmp/vamsi/ghci11211/cabal_macros.h -ghci-script=/tmp/vamsi/ghci11211/ghci-script\n@(Stack/Exec.hs:79:10)\n2017-04-02 10:46:28.136659: [debug] Creating process: /home/vamsi/.stack/programs/x86_64-linux/ghc-8.0.2/bin/ghc --interactive -i -odir=/home/vamsi/Do/learn-haskell/my-project/.stack-work/odir -hidir=/home/vamsi/Do/learn-haskell/my-project/.stack-work/odir -hide-all-packages -i/home/vamsi/Do/learn-haskell/my-project/src -i/home/vamsi/Do/learn-haskell/my-project/.stack-work/dist/x86_64-linux/Cabal-1.24.2.0/build/autogen -i/home/vamsi/Do/learn-haskell/my-project/.stack-work/dist/x86_64-linux/Cabal-1.24.2.0/build -i/home/vamsi/Do/learn-haskell/my-project/.stack-work/dist/x86_64-linux/Cabal-1.24.2.0/build/my-project/my-project-tmp -stubdir=/home/vamsi/Do/learn-haskell/my-project/.stack-work/dist/x86_64-linux/Cabal-1.24.2.0/build -package-id=base-4.9.1.0 -package-id=time-1.6.0.1 -package-id=aeson-1.0.2.1-CYngHPh1vosBJovY7C9thn -package-id=rethinkdb-2.2.0.9-Av4kLRfBxQS6TPGimEKUNt -optP-include -optP/tmp/vamsi/ghci11211/cabal_macros.h -ghci-script=/tmp/vamsi/ghci11211/ghci-script\n</code></pre>\n\n<p>I created a <code>Shape</code> module based on the tutorial <a href=\"http://learnyouahaskell.com/making-our-own-types-and-typeclasses\" rel=\"nofollow noreferrer\">here</a>:</p>\n\n<pre><code>module Shapes(\n  Point(..),\n  Shape(..),\n  surface,\n  nudge,\n  baseCircle,\n  baseRectangle,\n  circle,\n  rectangle\n) where\n-- deriving Show automagically makes the type part of the Show typeclass\n-- if there is only one value constructor for a type use the same name as the type to represent the value constructor\n-- to export all value constructor for a type constructor use (..) after the type constructor's name like `Shape(..)`\n-- to allow only the type constructor to be exported just write `Shape` instead.\n-- if no type constructor is exported, use the auxiliary functions to create the types instead.\ndata Point = Point Float Float deriving (Show)\ndata Shape = Circle Point Float | Rectangle Point Point deriving (Show)\n\nsurface :: Shape -&gt; Float\nsurface (Circle _ r) = pi * r ^ 2\nsurface (Rectangle (Point x1 y1) (Point x2 y2)) = abs (x2 -x1) * abs (y2 - y1)\n\nnudge:: Shape -&gt; Float -&gt; Float -&gt; Shape\nnudge (Circle (Point x y) r) a b = Circle (Point (x + a) (y + b)) r\nnudge (Rectangle (Point x1 y1) (Point x2 y2)) a b = Rectangle (Point (x1 + a) (y1 + b)) (Point (x2 + a) (y2 + b))\n\n-- create auxiliary functions to avoid dealing with types directly\n-- partially apply the value constructor and alias it as base circle\n-- the function still needs a radius parameter\nbaseCircle :: Float -&gt; Shape\nbaseCircle = Circle (Point 0 0)\n\nbaseRectangle :: Float -&gt; Float -&gt; Shape\nbaseRectangle w h = Rectangle (Point 0 0) (Point w h)\n\ncircle :: Float -&gt; Float -&gt; Float -&gt; Shape\ncircle x y r = nudge (baseCircle r) x y\n\nrectangle :: Float -&gt; Float -&gt; Float -&gt; Float -&gt; Shape\nrectangle startX startY width height = nudge (baseRectangle width height) startX startY\n</code></pre>\n\n<p>and I am trying to use it in <code>main</code>:</p>\n\n<pre><code>module Main where\nimport System.IO (readFile)\nimport Data.Time (getCurrentTime)\nimport Data.Aeson (encode)\nimport Shapes (circle)\n\ngreet :: String -&gt; String\ngreet xs = \"Hello \" ++ xs ++ \"!\"\n\nprintTime = do\n  time &lt;- getCurrentTime\n  print time\n\nprintConfig = do\n  contents &lt;- readFile \"stack.yaml\"\n  putStrLn contents\n\nnumbers:: [Int]\nnumbers = [1, 2, 3, 4, 5]\n\nmain :: IO ()\nmain = do\n  name &lt;- getLine\n  putStrLn $ greet name\n  printConfig\n  printTime\n  print $ encode numbers\n</code></pre>\n\n<p>The <code>my-project.cabal</code> file looks like this:</p>\n\n<pre><code>name:                my-project\nversion:             0.1.0.0\n-- synopsis:\n-- description:\nhomepage:            https://github.com/githubuser/my-project#readme\nlicense:             BSD3\nlicense-file:        LICENSE\nauthor:              Author name here\nmaintainer:          example@example.com\ncopyright:           2017 Author name here\ncategory:            Web\nbuild-type:          Simple\ncabal-version:       &gt;=1.10\nextra-source-files:  README.md\n\nexecutable my-project\n  hs-source-dirs:      src\n  main-is:             Main.hs\n  default-language:    Haskell2010\n  build-depends:       base &gt;= 4.7 &amp;&amp; &lt; 5,\n                       time,\n                       aeson,\n                       rethinkdb\n</code></pre>\n\n<p><strong>UPDATE</strong></p>\n\n<p>The <code>exposed-modules</code> and <code>build-depends</code> in the <code>*.cabal</code> file as suggested:</p>\n\n<pre><code>exposed-modules:       Shapes\n  build-depends:       base &gt;= 4.7 &amp;&amp; &lt; 5,\n                       time,\n                       aeson,\n                       rethinkdb\n</code></pre>\n"}, {"tags": ["haskell", "memory-leaks", "lazy-evaluation"], "comments": [{"owner": {"reputation": 126897, "user_id": 791604, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/ce991df7a056248d5e4f6fc3659ba733?s=128&d=identicon&r=PG", "display_name": "Daniel Wagner", "link": "https://stackoverflow.com/users/791604/daniel-wagner"}, "edited": false, "score": 0, "creation_date": 1491112683, "post_id": 43163487, "comment_id": 73404705, "body": "What does this offer over <code>getAllInput = liftM2 (:) getChar getAllInput</code> (or even <code>getAllInput = getContents</code>)? The call to <code>getChar</code> will already wait until <code>hReady</code> is true, so I don&#39;t see what waiting for that to be true before calling <code>getChar</code> actually buys you."}, {"owner": {"reputation": 1423, "user_id": 1480605, "user_type": "registered", "accept_rate": 71, "profile_image": "https://www.gravatar.com/avatar/98d26ead0d4b27f07e8444bea07a3949?s=128&d=identicon&r=PG", "display_name": "Hew Wolff", "link": "https://stackoverflow.com/users/1480605/hew-wolff"}, "reply_to_user": {"reputation": 126897, "user_id": 791604, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/ce991df7a056248d5e4f6fc3659ba733?s=128&d=identicon&r=PG", "display_name": "Daniel Wagner", "link": "https://stackoverflow.com/users/791604/daniel-wagner"}, "edited": false, "score": 0, "creation_date": 1491145278, "post_id": 43163487, "comment_id": 73413316, "body": "@DanielWagner, I&#39;d like the function to terminate after a key press.  I think the SO answer I referred to above explains it pretty well."}, {"owner": {"reputation": 126897, "user_id": 791604, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/ce991df7a056248d5e4f6fc3659ba733?s=128&d=identicon&r=PG", "display_name": "Daniel Wagner", "link": "https://stackoverflow.com/users/791604/daniel-wagner"}, "edited": false, "score": 0, "creation_date": 1491148001, "post_id": 43163487, "comment_id": 73414229, "body": "Even after fixing this code, it doesn&#39;t terminate after one key press."}, {"owner": {"reputation": 2831, "user_id": 183792, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/9ddcfbc6c31012fd25384f6301363347?s=128&d=identicon&r=PG&f=1", "display_name": "Michael", "link": "https://stackoverflow.com/users/183792/michael"}, "edited": false, "score": 1, "creation_date": 1491151584, "post_id": 43163487, "comment_id": 73415494, "body": "If you start ghci with <code>ghci getchars.hs  +RTS -M100m</code> it will give you an error if you do <code>print $ length [1..]</code> or the like. This particular program is a peculiar empty loop so it just stays below the requisite level. I&#39;m not sure what could be done about it."}, {"owner": {"reputation": 2831, "user_id": 183792, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/9ddcfbc6c31012fd25384f6301363347?s=128&d=identicon&r=PG&f=1", "display_name": "Michael", "link": "https://stackoverflow.com/users/183792/michael"}, "reply_to_user": {"reputation": 126897, "user_id": 791604, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/ce991df7a056248d5e4f6fc3659ba733?s=128&d=identicon&r=PG", "display_name": "Daniel Wagner", "link": "https://stackoverflow.com/users/791604/daniel-wagner"}, "edited": false, "score": 0, "creation_date": 1491151804, "post_id": 43163487, "comment_id": 73415581, "body": "@DanielWagner This seems to terminate after a key press <a href=\"http://sprunge.us/UEdK\" rel=\"nofollow noreferrer\">sprunge.us/UEdK</a> Do you have some strange input?"}], "answers": [{"comments": [{"owner": {"reputation": 1423, "user_id": 1480605, "user_type": "registered", "accept_rate": 71, "profile_image": "https://www.gravatar.com/avatar/98d26ead0d4b27f07e8444bea07a3949?s=128&d=identicon&r=PG", "display_name": "Hew Wolff", "link": "https://stackoverflow.com/users/1480605/hew-wolff"}, "edited": false, "score": 0, "creation_date": 1491144244, "post_id": 43164361, "comment_id": 73413004, "body": "Thanks, I actually already did all that (that&#39;s what I meant by cleaning up the code).  You answered (1) nicely; how about (2)?"}, {"owner": {"reputation": 126897, "user_id": 791604, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/ce991df7a056248d5e4f6fc3659ba733?s=128&d=identicon&r=PG", "display_name": "Daniel Wagner", "link": "https://stackoverflow.com/users/791604/daniel-wagner"}, "reply_to_user": {"reputation": 1423, "user_id": 1480605, "user_type": "registered", "accept_rate": 71, "profile_image": "https://www.gravatar.com/avatar/98d26ead0d4b27f07e8444bea07a3949?s=128&d=identicon&r=PG", "display_name": "Hew Wolff", "link": "https://stackoverflow.com/users/1480605/hew-wolff"}, "edited": false, "score": 1, "creation_date": 1491148566, "post_id": 43164361, "comment_id": 73414444, "body": "@HewWolff Any program compiled with ghc and <code>-rtsopts</code> will accept <code>+RTS -M1G</code> (or similar) to set a one gigabyte maximum heap. In particular, ghci will accept this. See <code>+RTS --help</code> for more."}], "tags": [], "owner": {"reputation": 57219, "user_id": 33796, "user_type": "registered", "accept_rate": 70, "profile_image": "https://www.gravatar.com/avatar/08727b23ba62e634b32988cdff082663?s=128&d=identicon&r=PG", "display_name": "luqui", "link": "https://stackoverflow.com/users/33796/luqui"}, "is_accepted": false, "score": 5, "last_activity_date": 1491114600, "last_edit_date": 1491114600, "creation_date": 1491104100, "answer_id": 43164361, "question_id": 43163487, "link": "https://stackoverflow.com/questions/43163487/haskell-key-input-memory-leak/43164361#43164361", "title": "Haskell key input memory leak", "body": "<p>You have an infinite loop in <code>go</code>.  If <code>hReady</code> returns true, then you call <code>go</code> again, which immediately calls <code>hReady</code> again, which will of course return true, and so on.   You probably assume that <code>added</code> will be run because of <code>go (added chars getChar)</code>, but it will not; it is just building an <code>IO</code> action and passing it to <code>go</code> as an argument, but that argument is only used when <code>hReady</code> returns <code>False</code>.  The name <code>chars</code> is misleading -- <code>chars</code> is actually an I/O procedure which will return a list of characters when it is eventually run.</p>\n\n<p>In general, when using monads, a \"normal\" function signature looks like:</p>\n\n<pre><code>:: Foo -&gt; Bar -&gt; Baz -&gt; IO Quuz\n</code></pre>\n\n<p>That is, the monad (<code>IO</code>) is only present on the return value, not the arguments.  A signature like</p>\n\n<pre><code>:: IO Foo -&gt; IO Bar\n</code></pre>\n\n<p>usually indicates that something higher-order is going on, for example that this function will perhaps execute its argument multiple times or in a new context.</p>\n\n<p>I recommend the signatures </p>\n\n<pre><code>go :: [Char] -&gt; IO [Char]\nadded :: [Char] -&gt; Char -&gt; IO [Char]\n</code></pre>\n\n<p>and trying to get the program to compile from there. </p>\n\n<p>You should also try changing <code>added</code> to be a pure function</p>\n\n<pre><code>added :: [Char] -&gt; Char -&gt; [Char]\n</code></pre>\n\n<p>because it doesn't actually have any side effects.  The implementation and usage will need to be altered a little, though.</p>\n"}, {"comments": [{"owner": {"reputation": 31243, "user_id": 2751851, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/4ddc0.png?s=128&g=1", "display_name": "duplode", "link": "https://stackoverflow.com/users/2751851/duplode"}, "edited": false, "score": 1, "creation_date": 1492199840, "post_id": 43417518, "comment_id": 73895765, "body": "Note that using <code>c &lt;- getChar</code> in this manner implies changing the type of <code>added</code>, as suggested by the middle third of luqui&#39;s answer."}], "tags": [], "owner": {"reputation": 1423, "user_id": 1480605, "user_type": "registered", "accept_rate": 71, "profile_image": "https://www.gravatar.com/avatar/98d26ead0d4b27f07e8444bea07a3949?s=128&d=identicon&r=PG", "display_name": "Hew Wolff", "link": "https://stackoverflow.com/users/1480605/hew-wolff"}, "is_accepted": true, "score": 1, "last_activity_date": 1492199768, "last_edit_date": 1495542345, "creation_date": 1492195979, "answer_id": 43417518, "question_id": 43163487, "link": "https://stackoverflow.com/questions/43163487/haskell-key-input-memory-leak/43417518#43417518", "title": "Haskell key input memory leak", "body": "<p>Summarizing the discussion...</p>\n\n<p>(1) As explained by <a href=\"https://stackoverflow.com/a/43164361/2751851\">luqui's answer</a>, the memory leak is caused by an infinite loop in which lazy evaluation prevents <code>getChar</code> from being called.  Adding a line like <code>c &lt;- getChar</code> forces the call to happen, so that <code>go (added chars c)</code> is now safe to call.</p>\n\n<p>(2) Starting GHCi with a limited heap size, as in <code>ghci getchars.hs +RTS -M100m</code>, will interrupt the memory leak before it eats up all memory. See the <a href=\"https://downloads.haskell.org/~ghc/8.0.2/docs/html/users_guide/runtime_control.html#rts-flag--M\" rel=\"nofollow noreferrer\">GHC Users Guide</a> for further details.</p>\n"}], "owner": {"reputation": 1423, "user_id": 1480605, "user_type": "registered", "accept_rate": 71, "profile_image": "https://www.gravatar.com/avatar/98d26ead0d4b27f07e8444bea07a3949?s=128&d=identicon&r=PG", "display_name": "Hew Wolff", "link": "https://stackoverflow.com/users/1480605/hew-wolff"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 219, "favorite_count": 0, "accepted_answer_id": 43417518, "answer_count": 2, "score": 2, "last_activity_date": 1492199768, "creation_date": 1491093799, "last_edit_date": 1495540018, "question_id": 43163487, "link": "https://stackoverflow.com/questions/43163487/haskell-key-input-memory-leak", "title": "Haskell key input memory leak", "body": "<p>I came up with the following code for the raw-input problem, as discussed in <a href=\"https://stackoverflow.com/questions/23068218/haskell-read-raw-keyboard-input\">SO Haskell read raw keyboard input</a>.  Unfortunately, when I go to ghci, run <code>getAllInput</code>, and hit the right arrow key, it never returns.  Unless I kill it pretty quickly, it seems to eat all my memory so that other applications stop responding and I have to restart the OS.  In the Activity Monitor I can see the memory for the ghc process go quickly into the gigabytes.</p>\n\n<p>(1) I think the problem is in the recursive call of <code>go</code>, which is evaluated lazily by calling <code>hReady</code> before <code>getChar</code>; this means <code>hReady</code> keeps returning true and the stack grows forever.  Is that plausible?</p>\n\n<p>(2) I'm used to languages in which this would soon cause a stack overflow exception, so it wouldn't prevent me from working.  Is there any general way to protect against this massive memory leak?  Maybe starting ghci with a hard limit on memory use?</p>\n\n<pre><code>import System.IO\n\n-- For example, should get \"\\ESC[C\" from the user hitting the right arrow key.\ngetAllInput :: IO [Char]\ngetAllInput =\n  let\n    go :: IO [Char] -&gt; IO [Char]\n    go chars = do\n      more &lt;- hReady stdin\n      if more then go (added chars getChar) else chars\n    added :: IO [Char] -&gt; IO Char -&gt; IO [Char]\n    added chars char = do\n      chars1 &lt;- chars\n      char1 &lt;- char\n      return (chars1 ++ [char1])\n  in do\n    hSetBuffering stdin NoBuffering\n    firstChar &lt;- getChar\n    go (return [firstChar])\n</code></pre>\n\n<p>I'm running ghci 7.10.3 in OS X 10.11.6.  I cleaned up the code in some obvious ways, basically following <a href=\"https://stackoverflow.com/a/38553473/1480605\">the similar SO answer</a>: putting the <code>getChar</code> call in its own line fixes the problem.  But I'd like to understand this better in case it bites me again.</p>\n"}, {"tags": ["haskell", "fold"], "comments": [{"owner": {"reputation": 314794, "user_id": 67579, "user_type": "registered", "accept_rate": 81, "profile_image": "https://i.stack.imgur.com/BJXub.png?s=128&g=1", "display_name": "Willem Van Onsem", "link": "https://stackoverflow.com/users/67579/willem-van-onsem"}, "edited": false, "score": 0, "creation_date": 1491082407, "post_id": 43162239, "comment_id": 73399251, "body": "You know that <code>last</code> and <code>++</code> work in <i>O(n)</i> with <i>n</i> the size of the list?"}, {"owner": {"reputation": 161, "user_id": 3476740, "user_type": "registered", "accept_rate": 57, "profile_image": "https://www.gravatar.com/avatar/14a5d37197d6231c545fa5d8c81f3b2f?s=128&d=identicon&r=PG&f=1", "display_name": "Tony Chamberlain", "link": "https://stackoverflow.com/users/3476740/tony-chamberlain"}, "reply_to_user": {"reputation": 314794, "user_id": 67579, "user_type": "registered", "accept_rate": 81, "profile_image": "https://i.stack.imgur.com/BJXub.png?s=128&g=1", "display_name": "Willem Van Onsem", "link": "https://stackoverflow.com/users/67579/willem-van-onsem"}, "edited": false, "score": 0, "creation_date": 1491082602, "post_id": 43162239, "comment_id": 73399298, "body": "another reason I was trying to figure out how to make it a foldl1.  I think i could convert it to a foldr1 easily from there and the use head and : operators"}], "answers": [{"comments": [{"owner": {"reputation": 161, "user_id": 3476740, "user_type": "registered", "accept_rate": 57, "profile_image": "https://www.gravatar.com/avatar/14a5d37197d6231c545fa5d8c81f3b2f?s=128&d=identicon&r=PG&f=1", "display_name": "Tony Chamberlain", "link": "https://stackoverflow.com/users/3476740/tony-chamberlain"}, "edited": false, "score": 0, "creation_date": 1491089691, "post_id": 43162376, "comment_id": 73400986, "body": "Thanks for the help.  I&#39;m curious is the where + helper function a stylistic change, or will it actually compile into different code than the if-then-else?  Though I will be changing to the where style since it seems more readable."}, {"owner": {"reputation": 314794, "user_id": 67579, "user_type": "registered", "accept_rate": 81, "profile_image": "https://i.stack.imgur.com/BJXub.png?s=128&g=1", "display_name": "Willem Van Onsem", "link": "https://stackoverflow.com/users/67579/willem-van-onsem"}, "reply_to_user": {"reputation": 161, "user_id": 3476740, "user_type": "registered", "accept_rate": 57, "profile_image": "https://www.gravatar.com/avatar/14a5d37197d6231c545fa5d8c81f3b2f?s=128&d=identicon&r=PG&f=1", "display_name": "Tony Chamberlain", "link": "https://stackoverflow.com/users/3476740/tony-chamberlain"}, "edited": false, "score": 0, "creation_date": 1491120375, "post_id": 43162376, "comment_id": 73406366, "body": "@TonyChamberlain: I honestly don&#39;t know. I think the code will be a bit different, but guards are a popular mechanism in Haskell so I expect that performance-wise there is no much difference."}], "tags": [], "owner": {"reputation": 314794, "user_id": 67579, "user_type": "registered", "accept_rate": 81, "profile_image": "https://i.stack.imgur.com/BJXub.png?s=128&g=1", "display_name": "Willem Van Onsem", "link": "https://stackoverflow.com/users/67579/willem-van-onsem"}, "is_accepted": true, "score": 3, "last_activity_date": 1491129310, "last_edit_date": 1491129310, "creation_date": 1491083290, "answer_id": 43162376, "question_id": 43162239, "link": "https://stackoverflow.com/questions/43162239/converting-a-foldl-into-fold1/43162376#43162376", "title": "Converting a foldl into fold1", "body": "<blockquote>\n  <p>I was under the impression that foldl1 was basically :</p>\n\n<pre><code>foldl (function) [head a] a\n</code></pre>\n</blockquote>\n\n<p><strong>No</strong>, <code>foldl1</code> is basically:</p>\n\n<pre><code>foldl function <b>(head a) (tail a)</b></code></pre>\n\n<p>So the <strong>initial element is not a list of <code>head a</code>, but <code>head a</code></strong>.</p>\n\n<blockquote>\n  <p>How would you go about making this <code>fold</code> generic for any <code>Ord</code> type?</p>\n</blockquote>\n\n<p>Well a quick fix is:</p>\n\n<pre><code>foldl (\\acc x -&gt; if x&lt;=(last acc) then acc ++ [x] else [x]) [<b>head a</b>] <b>(tail a)</b></code></pre>\n\n<p>But there are still two problems:</p>\n\n<ul>\n<li>in case <code>a</code> is an <strong>empty list</strong>, this function will error (while you probably want to return the empty list); and</li>\n<li>the code is not terribly efficient since both <code>last</code> and <code>(++)</code> run in <em>O(n)</em>.</li>\n</ul>\n\n<p>The first problem can easily be addressed by using <em>pattern matching</em> to prevent that scenario. But for the latter you better would for instance use a <code>reverse</code> approach. Like for instance:</p>\n\n<pre><code>f :: Ord t =&gt; [t] -&gt; [t]\nf [] = [] -- case when the empty list is given\nf a = reverse $ foldl (\\acc@(ac:_) x -&gt; if x &lt;= ac then (x:acc) else [x]) [head a] (tail a)\n</code></pre>\n\n<p>Furthermore personally I am not a huge fan of <code>if</code>-<code>then</code>-<code>else</code> in functional programming, you can for instance define a helper function like:</p>\n\n<pre><code>f :: Ord t =&gt; [t] -&gt; [t]\nf [] = [] -- case when the empty list is given\nf a = reverse $ foldl g [head a] (tail a)\n    where g acc@(ac:_) x | x &lt;= ac = (x:acc)\n                         | otherwise = [x]\n</code></pre>\n\n<p>Now <code>reverse</code> runs in <em>O(n)</em> but this is done only <em>once</em>. Furthermore the <code>(:)</code> construction runs in <em>O(1)</em> so all the actions in <code>g</code> run in <em>O(1)</em> (well given the comparison of course works efficient, etc.) making the algorithm itself <em>O(n)</em>.</p>\n\n<p>For your sample input it gives:</p>\n\n<pre><code>*Main&gt; f [9,5,3,6,2,1]\n[6,2,1]\n</code></pre>\n"}, {"comments": [{"owner": {"reputation": 161, "user_id": 3476740, "user_type": "registered", "accept_rate": 57, "profile_image": "https://www.gravatar.com/avatar/14a5d37197d6231c545fa5d8c81f3b2f?s=128&d=identicon&r=PG&f=1", "display_name": "Tony Chamberlain", "link": "https://stackoverflow.com/users/3476740/tony-chamberlain"}, "edited": false, "score": 0, "creation_date": 1491089606, "post_id": 43162407, "comment_id": 73400966, "body": "Thanks for the insights into the errors.  I&#39;ve been using :t to look at function types, but just didn&#39;t catch the fact that a could be [t] and b could just a b Int in a regular fold."}], "tags": [], "owner": {"reputation": 8268, "user_id": 7602518, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/9ddcddc4afafdfc5603b2473b191c74f?s=128&d=identicon&r=PG", "display_name": "Pedro Castilho", "link": "https://stackoverflow.com/users/7602518/pedro-castilho"}, "is_accepted": false, "score": 2, "last_activity_date": 1491084145, "last_edit_date": 1491084145, "creation_date": 1491083492, "answer_id": 43162407, "question_id": 43162239, "link": "https://stackoverflow.com/questions/43162239/converting-a-foldl-into-fold1/43162407#43162407", "title": "Converting a foldl into fold1", "body": "<p>The type of <code>foldl1</code> is:</p>\n\n<pre><code>Foldable t =&gt; (a -&gt; a -&gt; a) -&gt; t a -&gt; a\n</code></pre>\n\n<p>Your function argument, </p>\n\n<pre><code>\\acc x -&gt; if x&lt;=(last acc) then acc ++ [x] else [x]\n</code></pre>\n\n<p>has type:</p>\n\n<pre><code>(Ord a) =&gt; [a] -&gt; a -&gt; [a]\n</code></pre>\n\n<p>When Haskell's typechecker tries typechecking your function, it'll try unifying the type <code>a -&gt; a -&gt; a</code> (the type of the first argument of <code>foldl1</code>) with the type <code>[a] -&gt; a -&gt; [a]</code> (the type of your function).</p>\n\n<p>To unify these types would require unifying <code>a</code> with <code>[a]</code>, which would lead to the infinite type <code>a ~ [a] ~ [[a]] ~ [[[a]]]...</code> and so on.</p>\n\n<p>The reason this works while using <code>foldl</code> is that the type of <code>foldl</code> is:</p>\n\n<p><code>Foldable t =&gt; (b -&gt; a -&gt; b) -&gt; b -&gt; t a -&gt; b</code></p>\n\n<p>So <code>[a]</code> gets unified with <code>b</code> and <code>a</code> gets unified with the other <code>a</code>, leading to no problem at all.</p>\n\n<p><code>foldl1</code> is limited in that it can only take functions which deal with only one type, or, in other terms,  the accumulator needs to be the same type as the input list (for instance, when folding a list of <code>Int</code>s, <code>foldl1</code> can only return an <code>Int</code>, while <code>foldl</code> can use arbitrary accumulators. So you can't do this using <code>foldl1</code>).</p>\n\n<p>With regards to making this generic for all <code>Ord</code> values, one possible solution is to make a new typeclass for values which state their own \"least-bound\" value, which would then be used by your function. You can't make this function as it is generic on all <code>Ord</code> values because not all <code>Ord</code> values have sequence least bounds you can use.</p>\n\n<pre><code>class LowerBounded a where\n    lowerBound :: a\n\ninstance LowerBounded Int where\n    lowerBound = -1\n\nfinalDecreasingSequence :: (Ord a, LowerBounded a) =&gt; [a] -&gt; [a]\nfinalDecreasingSequence = foldl buildSequence lowerBound\n  where buildSequence acc x\n    | x &lt;= (last acc) = acc ++ [x]\n    | otherwise       = [x]\n</code></pre>\n\n<p>You might also want to read a bit about <a href=\"https://en.wikipedia.org/wiki/Hindley%E2%80%93Milner_type_system\" rel=\"nofollow noreferrer\">how Haskell does its type inference</a>, as it helps a lot in figuring out errors like the one you got.</p>\n"}], "owner": {"reputation": 161, "user_id": 3476740, "user_type": "registered", "accept_rate": 57, "profile_image": "https://www.gravatar.com/avatar/14a5d37197d6231c545fa5d8c81f3b2f?s=128&d=identicon&r=PG&f=1", "display_name": "Tony Chamberlain", "link": "https://stackoverflow.com/users/3476740/tony-chamberlain"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 87, "favorite_count": 0, "accepted_answer_id": 43162376, "answer_count": 2, "score": 2, "last_activity_date": 1491129310, "creation_date": 1491082339, "last_edit_date": 1491129154, "question_id": 43162239, "link": "https://stackoverflow.com/questions/43162239/converting-a-foldl-into-fold1", "title": "Converting a foldl into fold1", "body": "<p>I am using the following fold to get the final monotonically decreasing sequence of a list.</p>\n\n<pre><code>foldl (\\acc x -&gt; if x&lt;=(last acc) then acc ++ [x] else [x]) [(-1)] a\n</code></pre>\n\n<p>So <code>[9,5,3,6,2,1]</code>  would return <code>[6,2,1]</code>\nHowever, with <code>foldl</code> I needed to supply a start for the fold namely <code>[(-1)]</code>.  I was trying to turn into to a <code>foldl1</code> to be able to handle any range of integers as well as any <code>Ord</code> a like so:</p>\n\n<pre><code>foldl1 (\\acc x -&gt; if x&lt;=(last acc) then acc ++ [x] else [x]) a\n</code></pre>\n\n<p>But I get there error:</p>\n\n<pre><code>cannot construct infinite type: a ~ [a]\nin the second argument of (&lt;=) namely last acc\n</code></pre>\n\n<p>I was under the impression that <code>foldl1</code> was basically :</p>\n\n<pre><code>foldl (function) [head a] a\n</code></pre>\n\n<p>But I guess this isn't so?  How would you go about making this fold generic for any <code>Ord</code> type?</p>\n"}, {"tags": ["haskell", "yesod", "haskell-persistent"], "answers": [{"tags": [], "owner": {"reputation": 3185, "user_id": 241899, "user_type": "registered", "accept_rate": 92, "profile_image": "https://www.gravatar.com/avatar/56dfa400a964081e78a0be24978e7cdf?s=128&d=identicon&r=PG", "display_name": "Vitaly Olegovitch", "link": "https://stackoverflow.com/users/241899/vitaly-olegovitch"}, "is_accepted": true, "score": 3, "last_activity_date": 1491082155, "creation_date": 1491082155, "answer_id": 43162221, "question_id": 43160513, "link": "https://stackoverflow.com/questions/43160513/haskell-couldnt-match-type-persistentitybackend-record0-with-sqlbackend/43162221#43162221", "title": "Haskell - Couldn&#39;t match type \u2018PersistEntityBackend record0\u2019 with \u2018SqlBackend\u2019", "body": "<p>First thing I did was to run <code>stack ghci</code>.</p>\n\n<p>Then I run <code>:info Actor</code>, where Actor is the name of my PersistEntity.</p>\n\n<p>Among other things, there was:</p>\n\n<pre><code>newtype instance Key Actor = ActorKey {unActorKey :: Int}\n</code></pre>\n\n<p>So I wrote:</p>\n\n<pre><code>maybeActor &lt;- runDB $ get $ ActorKey actorId\ncase maybeActor of\n    Just actor -&gt; defaultLayout $ do\n        $(widgetFile \"actor-edit\")\n    Nothing -&gt; defaultLayout $ do\n        $(widgetFile \"actor-new\")\n</code></pre>\n"}], "owner": {"reputation": 3185, "user_id": 241899, "user_type": "registered", "accept_rate": 92, "profile_image": "https://www.gravatar.com/avatar/56dfa400a964081e78a0be24978e7cdf?s=128&d=identicon&r=PG", "display_name": "Vitaly Olegovitch", "link": "https://stackoverflow.com/users/241899/vitaly-olegovitch"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 361, "favorite_count": 0, "accepted_answer_id": 43162221, "answer_count": 1, "score": 3, "last_activity_date": 1491082155, "creation_date": 1491071347, "last_edit_date": 1491074778, "question_id": 43160513, "link": "https://stackoverflow.com/questions/43160513/haskell-couldnt-match-type-persistentitybackend-record0-with-sqlbackend", "title": "Haskell - Couldn&#39;t match type \u2018PersistEntityBackend record0\u2019 with \u2018SqlBackend\u2019", "body": "<p>I am trying to get a record by id in Yesod. My code is:</p>\n\n<pre><code>getEditActorR :: Handler Html\ngetEditActorR = do\n    actorId &lt;- runInputGet $ ireq intField \"id\"\n    actor &lt;- runDB $ get $ Key $ PersistInt64 (fromIntegral actorId)\n    defaultLayout $ do\n        $(widgetFile \"actor-edit\")\n</code></pre>\n\n<p>The error I get is:</p>\n\n<pre><code>\u2022 Couldn't match type \u2018PersistEntityBackend record0\u2019\n                 with \u2018SqlBackend\u2019\n    arising from a use of \u2018get\u2019\n  The type variable \u2018record0\u2019 is ambiguous\n\u2022 In the second argument of \u2018($)\u2019, namely\n    \u2018get $ Key $ PersistInt64 (fromIntegral actorId)\u2019\n  In a stmt of a 'do' block:\n    actor &lt;- runDB $ get $ Key $ PersistInt64 (fromIntegral actorId)\n  In the expression:\n    do { actorId &lt;- runInputGet $ ireq intField \"id\";\n         actor &lt;- runDB $ get $ Key $ PersistInt64 (fromIntegral actorId);\n         defaultLayout $ do { (do { ... }) } }\n</code></pre>\n\n<p>How can I fix that?</p>\n"}, {"tags": ["haskell", "type-safety", "gadt", "data-kinds"], "comments": [{"owner": {"reputation": 37219, "user_id": 1523776, "user_type": "moderator", "accept_rate": 87, "profile_image": "https://www.gravatar.com/avatar/b3e0b5c8e42a8c38009ef2d969f8dabb?s=128&d=identicon&r=PG", "display_name": "Benjamin Hodgson", "link": "https://stackoverflow.com/users/1523776/benjamin-hodgson"}, "edited": false, "score": 1, "creation_date": 1491051428, "post_id": 43156781, "comment_id": 73389575, "body": "You wrote <code>plus</code> as a (value level) function but you&#39;re trying to use it in a type. Haskell can&#39;t do that. (It thinks the <code>plus</code> in the return type of <code>mul</code> is a type parameter.) Use type families."}, {"owner": {"reputation": 2173, "user_id": 3794544, "user_type": "registered", "accept_rate": 53, "profile_image": "https://www.gravatar.com/avatar/94226e756a1e68dd797037f11dc2102a?s=128&d=identicon&r=PG&f=1", "display_name": "user47376", "link": "https://stackoverflow.com/users/3794544/user47376"}, "reply_to_user": {"reputation": 37219, "user_id": 1523776, "user_type": "moderator", "accept_rate": 87, "profile_image": "https://www.gravatar.com/avatar/b3e0b5c8e42a8c38009ef2d969f8dabb?s=128&d=identicon&r=PG", "display_name": "Benjamin Hodgson", "link": "https://stackoverflow.com/users/1523776/benjamin-hodgson"}, "edited": false, "score": 0, "creation_date": 1491051919, "post_id": 43156781, "comment_id": 73389721, "body": "I used type-operators"}, {"owner": {"reputation": 100892, "user_id": 745903, "user_type": "registered", "accept_rate": 74, "profile_image": "https://www.gravatar.com/avatar/50933f6638836741e620669b3940410e?s=128&d=identicon&r=PG", "display_name": "leftaroundabout", "link": "https://stackoverflow.com/users/745903/leftaroundabout"}, "edited": false, "score": 1, "creation_date": 1491056787, "post_id": 43156781, "comment_id": 73391114, "body": "May I recommend you also consider <a href=\"http://hackage.haskell.org/package/linearmap-category-0.3.2.0/docs/Math-LinearMap-Category.html\" rel=\"nofollow noreferrer\">a coordinate-free approach to tensors</a>, without those silly indices..."}, {"owner": {"reputation": 57219, "user_id": 33796, "user_type": "registered", "accept_rate": 70, "profile_image": "https://www.gravatar.com/avatar/08727b23ba62e634b32988cdff082663?s=128&d=identicon&r=PG", "display_name": "luqui", "link": "https://stackoverflow.com/users/33796/luqui"}, "reply_to_user": {"reputation": 100892, "user_id": 745903, "user_type": "registered", "accept_rate": 74, "profile_image": "https://www.gravatar.com/avatar/50933f6638836741e620669b3940410e?s=128&d=identicon&r=PG", "display_name": "leftaroundabout", "link": "https://stackoverflow.com/users/745903/leftaroundabout"}, "edited": false, "score": 0, "creation_date": 1491071249, "post_id": 43156781, "comment_id": 73396055, "body": "@leftaroundabout wow cool library.  Not just an abstract model, but also some workhorses -- inversion, eigenvalues, ... .  Thanks for the pointer!"}, {"owner": {"reputation": 2173, "user_id": 3794544, "user_type": "registered", "accept_rate": 53, "profile_image": "https://www.gravatar.com/avatar/94226e756a1e68dd797037f11dc2102a?s=128&d=identicon&r=PG&f=1", "display_name": "user47376", "link": "https://stackoverflow.com/users/3794544/user47376"}, "edited": false, "score": 0, "creation_date": 1491125361, "post_id": 43156781, "comment_id": 73407598, "body": "I actually like the index notation. Maybe It&#39;s just a bias, I learned general relativity in this notation..."}], "answers": [{"tags": [], "owner": {"reputation": 2831, "user_id": 183792, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/9ddcfbc6c31012fd25384f6301363347?s=128&d=identicon&r=PG&f=1", "display_name": "Michael", "link": "https://stackoverflow.com/users/183792/michael"}, "is_accepted": true, "score": 4, "last_activity_date": 1491054293, "last_edit_date": 1491054293, "creation_date": 1491052919, "answer_id": 43157422, "question_id": 43156781, "link": "https://stackoverflow.com/questions/43156781/haskell-gadts-making-a-type-safe-tensor-types-for-riemannian-geometry/43157422#43157422", "title": "Haskell GADTs - making a type-safe Tensor types for Riemannian geometry", "body": "<p><code>plus</code> is just a function on values of type <code>Index</code> </p>\n\n<pre><code>&gt;&gt;&gt; plus Zero Zero\nZero\n&gt;&gt;&gt; plus Zero (Up Zero)\nUp Zero\n</code></pre>\n\n<p>so it can't appear in a type signature, as things are. You want to use the 'promoted' type where <code>Zero</code>, <code>Up Zero</code> etc. are types. Then you can write a type function and everything compiles.</p>\n\n<pre><code>{-# LANGUAGE GADTs #-}\n{-# LANGUAGE DataKinds #-}\n{-# LANGUAGE ExistentialQuantification #-}\n{-# LANGUAGE TypeOperators #-}\n{-# LANGUAGE TypeFamilies #-}\n\ndata Direction = T | X | Y | Z\ndata Index = Zero | Up Index | Down Index deriving (Eq, Show)\n\n-- type function Plus\ntype family Plus (i :: Index) (j :: Index) :: Index where\n  Plus Zero x = x\n  Plus (Up x) y  = Up (Plus x y)\n  Plus (Down x) y = Down (Plus x y)\n\n-- value fuction plus\nplus :: Index -&gt; Index -&gt; Index\nplus Zero x = x\nplus (Up x) y = Up (plus x y)\nplus (Down x) y = Down (plus x y)\n\ndata Tensor (a :: Index) where\n  Scalar :: Double -&gt; Tensor Zero\n  Cov :: (Direction -&gt; Tensor b) -&gt; Tensor (Up b)\n  Con :: (Direction -&gt; Tensor b) -&gt; Tensor (Down b)\n\nadd :: Tensor a -&gt; Tensor a -&gt; Tensor a\nadd (Scalar x) (Scalar y) = (Scalar (x + y))\nadd (Cov f) (Cov g) = (Cov (\\d -&gt; add (f d) (g d)))\nadd (Con f) (Con g) = (Con (\\d -&gt; add (f d) (g d)))\n\nmul :: Tensor a -&gt; Tensor b -&gt; Tensor (Plus a b)\nmul (Scalar x) (Scalar y) = (Scalar (x*y))\nmul (Scalar x) (Cov f) = (Cov (\\d -&gt; mul (Scalar x) (f d)))\nmul (Scalar x) (Con f) = (Con (\\d -&gt; mul (Scalar x) (f d)))\nmul (Cov f) y = (Cov (\\d -&gt; mul (f d) y))\nmul (Con f) y = (Con (\\d -&gt; mul (f d) y))\n</code></pre>\n\n<p>There was no ambiguity in <code>Plus</code> but I could have use the disambiguating tick <code>'</code> to signal that I was dealing with the type level <code>Zero</code>, <code>Up</code> etc.</p>\n\n<pre><code>type family Plus (i :: Index) (j :: Index) :: Index where\n  Plus 'Zero x = x\n  Plus ('Up x) y  = 'Up (Plus x y)\n  Plus ('Down x) y = 'Down (Plus x y)\n</code></pre>\n\n<p><code>TypeOperators</code> would permit you to write <code>a + b</code> rather than <code>Plus a b</code> above.  </p>\n\n<pre><code>type family (i :: Index) + (j :: Index) :: Index where\n  Zero + x = x\n  Up x + y  = Up (x + y)\n  Down x + y = Down (x + y) \n</code></pre>\n"}], "owner": {"reputation": 2173, "user_id": 3794544, "user_type": "registered", "accept_rate": 53, "profile_image": "https://www.gravatar.com/avatar/94226e756a1e68dd797037f11dc2102a?s=128&d=identicon&r=PG&f=1", "display_name": "user47376", "link": "https://stackoverflow.com/users/3794544/user47376"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 150, "favorite_count": 1, "accepted_answer_id": 43157422, "answer_count": 1, "score": 5, "last_activity_date": 1491054293, "creation_date": 1491048991, "question_id": 43156781, "link": "https://stackoverflow.com/questions/43156781/haskell-gadts-making-a-type-safe-tensor-types-for-riemannian-geometry", "title": "Haskell GADTs - making a type-safe Tensor types for Riemannian geometry", "body": "<p>I want to make a type safe implementation of Tensor calculus in Haskell using GADT's, so the rules are:</p>\n\n<ol>\n<li>Tensors are n-dimentional metrices with indecies that can be 'upstairs' or 'downstairs' eg: <a href=\"https://i.stack.imgur.com/M3clG.gif\" rel=\"noreferrer\"><img src=\"https://i.stack.imgur.com/M3clG.gif\" alt=\"enter image description here\"></a> - is a Tensor with no indecies (a scalar), <a href=\"https://i.stack.imgur.com/SzNaM.gif\" rel=\"noreferrer\"><img src=\"https://i.stack.imgur.com/SzNaM.gif\" alt=\"enter image description here\"></a> is a Tensor with one 'upstairs' index, <a href=\"https://i.stack.imgur.com/qH2Jk.gif\" rel=\"noreferrer\"><img src=\"https://i.stack.imgur.com/qH2Jk.gif\" alt=\"enter image description here\"></a> is a tensor with a bunch of 'upstairs' and 'downstairs' indecies</li>\n<li><p>You can ADD tensor of the same type, meaning they have the same indecies signature. the 0th index of the first tensor is of the same type(upstairs or downstairs) as the 0th index of the second tensor and so on... </p>\n\n<p><a href=\"https://i.stack.imgur.com/EV2ya.gif\" rel=\"noreferrer\"><img src=\"https://i.stack.imgur.com/EV2ya.gif\" alt=\"enter image description here\"></a>  ~~~~ OK</p>\n\n<p><a href=\"https://i.stack.imgur.com/LsbDU.gif\" rel=\"noreferrer\"><img src=\"https://i.stack.imgur.com/LsbDU.gif\" alt=\"enter image description here\"></a>  ~~~~ NOT OK</p></li>\n<li><p>You can MULTIPLY tensors and get bigger tensors, with the indecies concatenated: <a href=\"https://i.stack.imgur.com/pR3Mt.gif\" rel=\"noreferrer\"><img src=\"https://i.stack.imgur.com/pR3Mt.gif\" alt=\"enter image description here\"></a></p></li>\n</ol>\n\n<p>So I want that the type-checker of Haskell wouldn't allow me to write code that doesn't follow those rules, It wouldn't compile otherwise.</p>\n\n<p>Here is my attempt using GADTs:</p>\n\n<pre><code>{-# LANGUAGE GADTs #-}\n{-# LANGUAGE DataKinds #-}\n{-# LANGUAGE ExistentialQuantification #-}\n{-# LANGUAGE TypeOperators #-}\n\ndata Direction = T | X | Y | Z\ndata Index = Zero | Up Index | Down Index deriving (Eq, Show)\n\nplus :: Index -&gt; Index -&gt; Index\nplus Zero x = x\nplus (Up x) y = Up (plus x y)\nplus (Down x) y = Down (plus x y)\n\ndata Tensor a = (a ~ Zero) =&gt; Scalar Double | \n                forall b. (a ~ Up b) =&gt; Cov (Direction -&gt; Tensor b) |\n                forall b. (a ~ Down b) =&gt; Con (Direction -&gt; Tensor b) \n\nadd :: Tensor a -&gt; Tensor a -&gt; Tensor a\nadd (Scalar x) (Scalar y) = (Scalar (x + y))\nadd (Cov f) (Cov g) = (Cov (\\d -&gt; add (f d) (g d)))\nadd (Con f) (Con g) = (Con (\\d -&gt; add (f d) (g d)))\n\nmul :: Tensor a -&gt; Tensor b -&gt; Tensor (plus a b)\nmul (Scalar x) (Scalar y) = (Scalar (x*y))\nmul (Scalar x) (Cov f) = (Cov (\\d -&gt; mul (Scalar x) (f d)))\nmul (Scalar x) (Con f) = (Con (\\d -&gt; mul (Scalar x) (f d)))\nmul (Cov f) y = (Cov (\\d -&gt; mul (f d) y))\nmul (Con f) y = (Con (\\d -&gt; mul (f d) y))\n</code></pre>\n\n<p>But i'm getting: </p>\n\n<pre><code>Couldn't match type 'Down with `plus ('Down b1)'                                                                                                                                                                                                    \n    Expected type: Tensor (plus a b)                                                                                                                                                                                                                    \n      Actual type: Tensor ('Down b)                                                                                                                                                                                                                     \n    Relevant bindings include                                                                                                                                                                                                                           \n      f :: Direction -&gt; Tensor b1 (bound at main.hs:28:10)                                                                                                                                                                                              \n      mul :: Tensor a -&gt; Tensor b -&gt; Tensor (plus a b)                                                                                                                                                                                                  \n        (bound at main.hs:24:1)                                                                                                                                                                                                                         \n    In the expression: (Con (\\ d -&gt; mul (f d) y))                                                                                                                                                                                                       \n    In an equation for `mul':                                                                                                                                                                                                                           \n        mul (Con f) y = (Con (\\ d -&gt; mul (f d) y)) \n</code></pre>\n\n<p>What is the problem? </p>\n"}, {"tags": ["haskell", "gearman"], "answers": [{"comments": [{"owner": {"reputation": 1979, "user_id": 2789312, "user_type": "registered", "accept_rate": 92, "profile_image": "https://i.stack.imgur.com/4OgOz.png?s=128&g=1", "display_name": "palik", "link": "https://stackoverflow.com/users/2789312/palik"}, "edited": false, "score": 0, "creation_date": 1491165112, "post_id": 43160776, "comment_id": 73420451, "body": "I&#39;m really appreciate you detailed answer. I tried <code>t &lt;- W.runWorker gc (return g)</code> as well. Unfortunately in this case the compiler complains about <code>Couldn&#39;t match expected type</code>. That&#39;s the reason why I turned to let + return; I&#39;ll add the code snippet and the exception to my question."}], "tags": [], "owner": {"reputation": 57219, "user_id": 33796, "user_type": "registered", "accept_rate": 70, "profile_image": "https://www.gravatar.com/avatar/08727b23ba62e634b32988cdff082663?s=128&d=identicon&r=PG", "display_name": "luqui", "link": "https://stackoverflow.com/users/33796/luqui"}, "is_accepted": false, "score": 1, "last_activity_date": 1491072967, "creation_date": 1491072967, "answer_id": 43160776, "question_id": 43155857, "link": "https://stackoverflow.com/questions/43155857/how-does-hgearman-worker-work/43160776#43160776", "title": "How does hgearman worker work?", "body": "<p>A value of type <code>Gearman a</code> for some <code>a</code> is an <em>action</em>, a recipe to do something.  You can <em>bind</em> together such recipes to make bigger recipes, until you have constructed the <code>main</code> recipe which is the one that gets run.</p>\n\n<p>Practically speaking, it means if you are running a do-block that looks like this:</p>\n\n<pre><code>do ...\n   foo\n   ...\n</code></pre>\n\n<p>then <code>foo</code> will be run.  If you have a do-block that looks like this:</p>\n\n<pre><code>do ...\n   ret &lt;- foo\n   ...\n</code></pre>\n\n<p>then <code>foo</code> will be run and the result of running <code>foo</code> will be stored in ret.  Those two syntaxes are binds.  However if you are running a do-block that looks like this:</p>\n\n<pre><code>do ...\n   let ret = foo\n   ...\n</code></pre>\n\n<p>then <code>foo</code> will not be run -- instead you are just asking for the variable <code>ret</code> to be shorthand for <code>foo</code>, so <code>foo</code> and <code>ret</code> are afterwards interchangeable.</p>\n\n<p>So now you can see, in:</p>\n\n<pre><code>do g &lt;- W.registerWorker name func\n   let t = W.runWorker gc (return g)\n   return t &gt;&gt; return ()\n</code></pre>\n\n<p>the second line does not actually <em>run</em> a worker, it just lets <code>t</code> be a shorthand for running a worker.  Returning an action does not bind it either.  You need to bind:</p>\n\n<pre><code>   t &lt;- W.runWorker gc (return g)\n</code></pre>\n\n<p>By the way, I've been looking at the documentation and it looks like <code>registerWorker</code> returns a <code>Gearman ()</code>, which means that the result of running the action is <code>()</code>, or \"nothing interesting\".  So <code>g</code> is nothing interesting, you could get rid of it and say</p>\n\n<pre><code>do W.registerWorker name func\n   t &lt;- W.runWorker gc (return ())\n   return t &gt;&gt; return ()\n</code></pre>\n\n<p>Presumably in place of that <code>return ()</code> in the second line you would put an action that you wanted to run in the worker.  Like:</p>\n\n<pre><code>   t &lt;- W.runWorker gc $ do\n       ... the things you want the worker to do ...\n   return t &gt;&gt; return ()\n</code></pre>\n\n<p>And finally that last line: <code>return t &gt;&gt; return ()</code>, also written</p>\n\n<pre><code>do return t\n   return ()\n</code></pre>\n\n<p>is exactly the same thing as <code>return ()</code>.  <code>return x</code> constructs an action with no side-effects, which is only used for the result.  Then when you use <code>&gt;&gt;</code> (or don't bind the result in a <code>do</code> block) you run an action only for its side-effects and discard its result.  So the first <code>return</code> does nothing whatsoever.</p>\n"}, {"tags": [], "owner": {"reputation": 1979, "user_id": 2789312, "user_type": "registered", "accept_rate": 92, "profile_image": "https://i.stack.imgur.com/4OgOz.png?s=128&g=1", "display_name": "palik", "link": "https://stackoverflow.com/users/2789312/palik"}, "is_accepted": true, "score": 0, "last_activity_date": 1492524526, "creation_date": 1492524526, "answer_id": 43474542, "question_id": 43155857, "link": "https://stackoverflow.com/questions/43155857/how-does-hgearman-worker-work/43474542#43474542", "title": "How does hgearman worker work?", "body": "<p>Finally I implemented a gearman worker in Haskell.</p>\n\n<pre><code>{-# LANGUAGE DeriveDataTypeable #-}\nimport Control.Exception (Exception, IOException, catch, throwIO)\nimport qualified Data.ByteString.Char8 as B\nimport Control.Monad.State\nimport Data.Typeable     (Typeable)\nimport qualified Network.Gearman.Client as C\nimport qualified Network.Gearman.Worker as W\nimport Network.Gearman.Internal (Function, GearmanClient, Port)\nimport Network.Socket (HostName)\nimport           Control.Concurrent\nimport qualified Control.Monad.State as S\n\ndata ConnectException = ConnectException HostName Port IOException\n    deriving (Show, Typeable)\ninstance Exception ConnectException\n\nmain :: IO ()\nmain = do\n  c &lt;- connect\n  gc &lt;- either (error . B.unpack) return c\n  work gc\n  return ()\n  where\n    connect = C.connectGearman (B.pack \"worker-id\") host port `catch` \\e -&gt; throwIO (ConnectException host port e)\n    host = \"localhost\"::HostName\n    port =  4730::Port\n\nwork :: GearmanClient -&gt; IO ()\nwork gc = do\n      (res, _) &lt;- flip S.runStateT gc $ do\n          W.registerWorker (B.pack \"reverse\"::Function)  B.reverse\n          S.get &gt;&gt;= (\\env -&gt; forever $ S.liftIO (W.runWorker env (return ()) &gt;&gt; threadDelay (1000*1000)))\n          return ()\n      return res\n</code></pre>\n"}], "owner": {"reputation": 1979, "user_id": 2789312, "user_type": "registered", "accept_rate": 92, "profile_image": "https://i.stack.imgur.com/4OgOz.png?s=128&g=1", "display_name": "palik", "link": "https://stackoverflow.com/users/2789312/palik"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 103, "favorite_count": 0, "accepted_answer_id": 43474542, "answer_count": 2, "score": 1, "last_activity_date": 1492524526, "creation_date": 1491043670, "last_edit_date": 1495540946, "question_id": 43155857, "link": "https://stackoverflow.com/questions/43155857/how-does-hgearman-worker-work", "title": "How does hgearman worker work?", "body": "<p>I asked a question <a href=\"https://stackoverflow.com/questions/42774191/how-does-hgearman-client-work\">how does hgearman-client work?</a> three weeks ago. With some help I wrote a simple client application and I'm working on the worker side now. The worker implementation below compiles well and runs without any exception. The only trouble is that <code>W.runWorker gc (return g)</code> will not be executed. If I understand it correctly, it's the result of Haskell laziness and <code>return t</code> Monad wrapping. But I haven't faintest idea how to get rid of the issue. Could some one help?</p>\n\n<pre><code>import qualified Control.Monad.State as S\nimport qualified Data.ByteString.Char8 as B\nimport qualified Network.Gearman.Client as C\nimport qualified Network.Gearman.Worker as W\nimport Network.Gearman.Internal (Function, Port)\nimport Network.Socket (HostName)\n\nmain :: IO ()\nmain = do\n  c &lt;- connect\n  case c of\n    Left e -&gt; error $ B.unpack e\n    Right gc -&gt; do\n      (res, _) &lt;- flip S.runStateT gc $ do\n        g &lt;- (W.registerWorker name func)\n        let t = W.runWorker gc (return g)\n        return t &gt;&gt; return ()\n\n      return res\n  where\n    connect = C.connectGearman (B.pack \"i\") host port\n    host = \"localhost\"::HostName\n    port =  4730::Port\n    name = (B.pack \"foo\")::Function\n    func _ = B.pack \"bar\"\n</code></pre>\n\n<p>Unfortunately an attempt to bind <code>t &lt;- W.runWorker</code> ends in compiler exception. If I change the code in this way:  </p>\n\n<pre><code>Right gc -&gt; do\n  (res, _) &lt;- flip S.runStateT gc $ do\n    g &lt;- (W.registerWorker name func)\n    t &lt;- W.runWorker gc (return ())\n    return t &gt;&gt; return  ()\n\n  return res\n</code></pre>\n\n<p>The compilation fails with exception:</p>\n\n<pre><code>Couldn't match expected type `S.StateT\n                                Network.Gearman.Internal.GearmanClient IO a0'\n                with actual type `IO GHC.Conc.Sync.ThreadId'\n    In a stmt of a 'do' block: t &lt;- W.runWorker gc (return ())\n    In the second argument of `($)', namely\n      `do { g &lt;- (W.registerWorker name func);\n            t &lt;- W.runWorker gc (return ());\n            return t &gt;&gt; return () }'\n</code></pre>\n\n<p><code>IO GHC.Conc.Sync.ThreadId</code> is the result of <a href=\"https://hackage.haskell.org/package/hgearman-0.1.0.2/docs/Network-Gearman-Worker.html\" rel=\"nofollow noreferrer\">runWorker</a>.</p>\n"}, {"tags": ["haskell"], "comments": [{"owner": {"reputation": 24028, "user_id": 383200, "user_type": "registered", "accept_rate": 60, "profile_image": "https://www.gravatar.com/avatar/a9dc722f936cb1059adaae4fe39c07f0?s=128&d=identicon&r=PG", "display_name": "Carl", "link": "https://stackoverflow.com/users/383200/carl"}, "edited": false, "score": 0, "creation_date": 1491053627, "post_id": 43155806, "comment_id": 73390197, "body": "Please give us a starting point.  Include what code you&#39;ve tried, and where it went wrong."}, {"owner": {"reputation": 24028, "user_id": 383200, "user_type": "registered", "accept_rate": 60, "profile_image": "https://www.gravatar.com/avatar/a9dc722f936cb1059adaae4fe39c07f0?s=128&d=identicon&r=PG", "display_name": "Carl", "link": "https://stackoverflow.com/users/383200/carl"}, "edited": false, "score": 0, "creation_date": 1491055291, "post_id": 43155806, "comment_id": 73390691, "body": "FWIW, I disagree with the close vote.  This is a perfectly reasonable question for SO, if it included more information about what was tried and didn&#39;t work."}, {"owner": {"reputation": 2831, "user_id": 183792, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/9ddcfbc6c31012fd25384f6301363347?s=128&d=identicon&r=PG&f=1", "display_name": "Michael", "link": "https://stackoverflow.com/users/183792/michael"}, "edited": false, "score": 0, "creation_date": 1491081059, "post_id": 43155806, "comment_id": 73398942, "body": "Do you see how do this simpler exercise: write a <code>modify</code> that just uses <code>unsafeThaw</code> and then the function, and then <code>unsafeFreeze</code>? This will involve a little do-block with a line in the middle that has type <code>ST s ()</code> but the last line will have the type <code>ST s (Vector a)</code> In the middle you will apply the given modifying function that has type <code>(forall s. MVector s a -&gt; ST s ())</code> but the result of applying it will have type <code>ST s ()</code>"}, {"owner": {"reputation": 2863, "user_id": 2297560, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/948d4a17494b3c616a0873453b74670c?s=128&d=identicon&r=PG", "display_name": "user2297560", "link": "https://stackoverflow.com/users/2297560/user2297560"}, "edited": false, "score": 0, "creation_date": 1491138121, "post_id": 43155806, "comment_id": 73411201, "body": "<code>unsafeThaw</code> does not copy the original vector. You probably want to use <code>thaw</code> instead."}, {"owner": {"reputation": 409, "user_id": 1897830, "user_type": "registered", "accept_rate": 0, "profile_image": "https://www.gravatar.com/avatar/4bb6f01afcee8d6fd59ccb93499732d6?s=128&d=identicon&r=PG", "display_name": "user1897830", "link": "https://stackoverflow.com/users/1897830/user1897830"}, "edited": false, "score": 0, "creation_date": 1491184130, "post_id": 43155806, "comment_id": 73424731, "body": "Changing from unsafeThaw to thaw doesn&#39;t change anything."}], "answers": [{"tags": [], "owner": {"reputation": 409, "user_id": 1897830, "user_type": "registered", "accept_rate": 0, "profile_image": "https://www.gravatar.com/avatar/4bb6f01afcee8d6fd59ccb93499732d6?s=128&d=identicon&r=PG", "display_name": "user1897830", "link": "https://stackoverflow.com/users/1897830/user1897830"}, "is_accepted": false, "score": 1, "last_activity_date": 1491271530, "creation_date": 1491271530, "answer_id": 43197135, "question_id": 43155806, "link": "https://stackoverflow.com/questions/43155806/mutable-modifications-of-a-vector-using-st/43197135#43197135", "title": "Mutable modifications of a Vector using ST", "body": "<pre><code>{-# LANGUAGE RankNTypes #-}\nmodule Chp28v8 where\n\nimport Control.Monad.ST\nimport  qualified Data.Vector.Unboxed as V\nimport Data.Vector.Unboxed.Mutable\n\nmodify' :: V.Unbox a =&gt; (forall s. MVector s a -&gt; ST s ()) -&gt;\n                               V.Vector a -&gt; V.Vector a\nmodify' fn v = runST $ do\n  vm &lt;- V.thaw v\n  fn vm\n  V.unsafeFreeze vm\n</code></pre>\n"}], "owner": {"reputation": 409, "user_id": 1897830, "user_type": "registered", "accept_rate": 0, "profile_image": "https://www.gravatar.com/avatar/4bb6f01afcee8d6fd59ccb93499732d6?s=128&d=identicon&r=PG", "display_name": "user1897830", "link": "https://stackoverflow.com/users/1897830/user1897830"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 183, "favorite_count": 0, "answer_count": 1, "score": -3, "last_activity_date": 1491271530, "creation_date": 1491043354, "last_edit_date": 1491101381, "question_id": 43155806, "link": "https://stackoverflow.com/questions/43155806/mutable-modifications-of-a-vector-using-st", "title": "Mutable modifications of a Vector using ST", "body": "<p>I have been going through a School of Haskell tutorial on \"modify and the ST monad\". The question asks to come up with the code for modify which has the following type signature: <code>modify :: Unbox a =&gt; (forall s. MVector s a -&gt; ST s ()) -&gt; Vector a -&gt; Vector a</code>\nThis is what the function does:</p>\n\n<ol>\n<li>Creates a new mutable buffer the same length as the original vector</li>\n<li>Copies the values from the original vector into the new mutable vector</li>\n<li>Runs the provided ST action on the provided mutable vector</li>\n<li>Unsafely freezes the mutable vector and returns it.</li>\n</ol>\n\n<p>Also use runST from Control.Monad.ST</p>\n\n<p>I have been playing around with it however I can't get from <code>ST s ()</code> to <code>Vector a</code>.</p>\n\n<p>This is what I have:</p>\n\n<pre><code>{-# LANGUAGE RankNTypes #-}\nmodule Chp28v8 where\n\nimport Control.Monad.ST\nimport Data.STRef\nimport  qualified Data.Vector.Unboxed as V\n\nmodify' :: V.Unbox a =&gt; (forall s. MVector s a -&gt; ST s ()) -&gt;\n                               V.Vector a -&gt; V.Vector a\nmodify' fn v = runST $ do\n  vm &lt;- V.unsafeThaw v &gt;&gt;= newSTRef\n  modifySTRef vm fn\n  vm &gt;&gt;= V.unsafeFreeze\n</code></pre>\n"}, {"tags": ["haskell", "compare"], "comments": [{"owner": {"reputation": 100185, "user_id": 3234959, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/93bb12ca0f93dfddb33880316f7e66c2?s=128&d=identicon&r=PG&f=1", "display_name": "chi", "link": "https://stackoverflow.com/users/3234959/chi"}, "edited": false, "score": 0, "creation_date": 1491039489, "post_id": 43155079, "comment_id": 73386243, "body": "The code you show makes the second argument to be more important, but you say otherwise in the text -- which is it?"}], "answers": [{"tags": [], "owner": {"reputation": 100185, "user_id": 3234959, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/93bb12ca0f93dfddb33880316f7e66c2?s=128&d=identicon&r=PG&f=1", "display_name": "chi", "link": "https://stackoverflow.com/users/3234959/chi"}, "is_accepted": true, "score": 4, "last_activity_date": 1491039940, "last_edit_date": 1491039940, "creation_date": 1491039586, "answer_id": 43155179, "question_id": 43155079, "link": "https://stackoverflow.com/questions/43155079/is-there-a-way-in-haskell-to-compactly-and-efficiently-compare-by-multiple-param/43155179#43155179", "title": "Is there a way in haskell to compactly and efficiently compare by multiple parameters and in different orders", "body": "<p>I can't understand the precise ordering you want, but probably some variation of the following is what you are looking for</p>\n\n<pre><code>compareSol (s1, w1) (s2, w2) = compare (w1, sum s2) (w2, sum s1)\n</code></pre>\n\n<p>the above is equivalent to</p>\n\n<pre><code>compareSol (s1, w1) (s2, w2) \n   | w1 &lt; w2   = LT\n   | w1 &gt; w2   = GT\n   | otherwise = compare (sum s2) (sum s1)\n</code></pre>\n\n<p>or, fully expanded,</p>\n\n<pre><code>compareSol (s1, w1) (s2, w2) \n   | w1 &lt; w2 = LT\n   | w1 &gt; w2 = GT\n   | sum s1 &lt; sum s2 = GT\n   | sum s1 &gt; sum s2 = LT\n   | otherwise = EQ\n</code></pre>\n\n<p>Feel free to swap the comparisons around so to meet your goal.</p>\n"}, {"tags": [], "owner": {"reputation": 48938, "user_id": 246886, "user_type": "registered", "accept_rate": 94, "profile_image": "https://www.gravatar.com/avatar/dd1ebaade6623fc538fb8af3338e730d?s=128&d=identicon&r=PG", "display_name": "Jon Purdy", "link": "https://stackoverflow.com/users/246886/jon-purdy"}, "is_accepted": false, "score": 5, "last_activity_date": 1491043212, "last_edit_date": 1491043212, "creation_date": 1491041721, "answer_id": 43155554, "question_id": 43155079, "link": "https://stackoverflow.com/questions/43155079/is-there-a-way-in-haskell-to-compactly-and-efficiently-compare-by-multiple-param/43155554#43155554", "title": "Is there a way in haskell to compactly and efficiently compare by multiple parameters and in different orders", "body": "<p>You can use <code>comparing</code> and <code>Down</code> from <code>Data.Ord</code> with <code>&lt;&gt;</code> from <code>Data.Monoid</code>:</p>\n\n<pre><code>compareSol = comparing snd &lt;&gt; comparing (Down . sum . fst)\n</code></pre>\n\n<p>In this case you can also use the simpler <code>flip</code> instead of <code>Down</code>:</p>\n\n<pre><code>compareSol = comparing snd &lt;&gt; flip (comparing (sum . fst))\n</code></pre>\n\n<hr>\n\n<p>This is a combination of a few features.</p>\n\n<p><code>Data.Ord.comparing</code> compares two values based on a function of those values\u2014<code>comparing f</code> is equivalent to <code>compare `on` f</code> using <code>Data.Function.on</code>.</p>\n\n<pre><code>comparing :: Ord a =&gt; (b -&gt; a) -&gt; b -&gt; b -&gt; Ordering\n</code></pre>\n\n<p>The <code>Monoid</code> instance for <code>Ordering</code> gives you lexicographical ordering.</p>\n\n<pre><code>LT &lt;&gt; x = LT\nGT &lt;&gt; x = GT\nEQ &lt;&gt; x = x\n</code></pre>\n\n<p>The <code>Monoid</code> instance for functions lets you compose comparison functions of type <code>a -&gt; Ordering</code>, or in this case <code>a -&gt; a -&gt; Ordering</code>.</p>\n\n<pre><code>instance Monoid b =&gt; Monoid (a -&gt; b)\n-- instance Monoid c =&gt; Monoid (a -&gt; b -&gt; c)\n-- instance Monoid Ordering\n-- instance Monoid (a -&gt; b -&gt; Ordering)\n-- instance Monoid (a -&gt; a -&gt; Ordering)  given  a ~ b\n</code></pre>\n\n<p>And finally, the <code>Down</code> newtype inverts the ordering of the type it wraps, giving you reversed comparison for free:</p>\n\n<pre><code>     0 &lt;       1  ==  True\nDown 0 &lt;  Down 1  ==  False\n     0 &gt;       1  ==  False\nDown 0 &gt;  Down 1  ==  True\n</code></pre>\n"}], "owner": {"reputation": 4989, "user_id": 1685095, "user_type": "registered", "accept_rate": 42, "profile_image": "https://www.gravatar.com/avatar/5f06068bb9b4c00f12582ccc0ba64c4a?s=128&d=identicon&r=PG", "display_name": "user1685095", "link": "https://stackoverflow.com/users/1685095/user1685095"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 711, "favorite_count": 0, "accepted_answer_id": 43155179, "answer_count": 2, "score": 2, "last_activity_date": 1491043212, "creation_date": 1491038956, "question_id": 43155079, "link": "https://stackoverflow.com/questions/43155079/is-there-a-way-in-haskell-to-compactly-and-efficiently-compare-by-multiple-param", "title": "Is there a way in haskell to compactly and efficiently compare by multiple parameters and in different orders", "body": "<p>Suppose we have a list of tuples and we need to find maximum on some criterion. The criterion is the following - most important is the first element of the tuple (more is better) less important is second element (less is better).</p>\n\n<p>I know two ways of expressing this in Haskell.</p>\n\n<p>First one is to create a function that would make all the comparisons and return <code>(EQ, LT, GT)</code></p>\n\n<pre><code>compareSol (s1, w1) (s2, w2) = if weightComp == EQ then sizeComp else weightComp where \n    weightComp = compare w1 w2\n    sizeComp = compare (Map.foldl' (+) 0  s2) (Map.foldl' (+) 0  s1)\n</code></pre>\n\n<p>The second one is to use <code>comparing</code> from <code>Data.Ord</code> and give it a function that would return a score <code>\\ (x, y) -&gt; (x, 1 / y)</code> Which is I think more declarative, but would require more computations (<code>1 / y</code>)</p>\n\n<p>Is there a way of expressing this in both declarative and efficient way, like is sql?</p>\n"}, {"tags": ["haskell", "yesod"], "comments": [{"owner": {"reputation": 19307, "user_id": 1663462, "user_type": "registered", "accept_rate": 78, "profile_image": "https://www.gravatar.com/avatar/c30e0fa0f3a065c038c633a95066d299?s=128&d=identicon&r=PG", "display_name": "Chris Stryczynski", "link": "https://stackoverflow.com/users/1663462/chris-stryczynski"}, "edited": false, "score": 0, "creation_date": 1491318479, "post_id": 43154794, "comment_id": 73493736, "body": "Can you provide the contents of your template?"}, {"owner": {"reputation": 2696, "user_id": 1352426, "user_type": "registered", "accept_rate": 82, "profile_image": "https://i.stack.imgur.com/mQFHO.png?s=128&g=1", "display_name": "v0d1ch", "link": "https://stackoverflow.com/users/1352426/v0d1ch"}, "reply_to_user": {"reputation": 19307, "user_id": 1663462, "user_type": "registered", "accept_rate": 78, "profile_image": "https://www.gravatar.com/avatar/c30e0fa0f3a065c038c633a95066d299?s=128&d=identicon&r=PG", "display_name": "Chris Stryczynski", "link": "https://stackoverflow.com/users/1663462/chris-stryczynski"}, "edited": false, "score": 0, "creation_date": 1491334663, "post_id": 43154794, "comment_id": 73503807, "body": "The template for this page is separated on header widget and home page. Header widget is loaded on each page in Foundation.hs and home page template contains only html so I guess it is not useful."}], "answers": [{"tags": [], "owner": {"reputation": 1455, "user_id": 706882, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/1b8e621d3734b19dbb87061e1b9157e0?s=128&d=identicon&r=PG", "display_name": "sbditto85", "link": "https://stackoverflow.com/users/706882/sbditto85"}, "is_accepted": true, "score": 1, "last_activity_date": 1491350328, "creation_date": 1491350328, "answer_id": 43219686, "question_id": 43154794, "link": "https://stackoverflow.com/questions/43154794/yesod-include-widget-directly-in-template/43219686#43219686", "title": "Yesod - include widget directly in template", "body": "<p>change your</p>\n\n<pre><code>module Widget.Header where\n\nimport Prelude\nimport Yesod\n\ntwitterWidget :: MonadWidget m =&gt; String -&gt; m ()\ntwitterWidget twitteruser = do\n   toWidgetBody([hamlet| &lt;a href=\"https://twitter.com/#{twitteruser}\" .twitter-follow-button data-show-count=\"false\"&gt;Follow @#{twitteruser}\n                        &lt;script async src=\"//platform.twitter.com/widgets.js\" charset=\"utf-8\"&gt;\n                   |])\n</code></pre>\n\n<p>to something more like</p>\n\n<pre><code>module Widget.Header where\n\nimport Import\n\ntwitterWidget :: Yesod site =&gt; String -&gt; WidgetT site IO ()\ntwitterWidget twitteruser = do\n   toWidgetBody([hamlet| &lt;a href=\"https://twitter.com/#{twitteruser}\" .twitter-follow-button data-show-count=\"false\"&gt;Follow @#{twitteruser}\n                        &lt;script async src=\"//platform.twitter.com/widgets.js\" charset=\"utf-8\"&gt;\n                   |])\n</code></pre>\n\n<p>that way <code>m</code> becomes definitely <code>IO</code> and Haskell doesn't have to figure it out.</p>\n"}], "owner": {"reputation": 2696, "user_id": 1352426, "user_type": "registered", "accept_rate": 82, "profile_image": "https://i.stack.imgur.com/mQFHO.png?s=128&g=1", "display_name": "v0d1ch", "link": "https://stackoverflow.com/users/1352426/v0d1ch"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 126, "favorite_count": 0, "accepted_answer_id": 43219686, "answer_count": 1, "score": 2, "last_activity_date": 1491350328, "creation_date": 1491036982, "question_id": 43154794, "link": "https://stackoverflow.com/questions/43154794/yesod-include-widget-directly-in-template", "title": "Yesod - include widget directly in template", "body": "<p>I have a scaffolded Yesod app and created a simple widget that looks like this and is located in separate module:</p>\n\n<pre><code>module Widget.Header where\n\nimport Prelude\nimport Yesod\n\ntwitterWidget :: MonadWidget m =&gt; String -&gt; m ()\ntwitterWidget twitteruser = do\n   toWidgetBody([hamlet| &lt;a href=\"https://twitter.com/#{twitteruser}\" .twitter-follow-button data-show-count=\"false\"&gt;Follow @#{twitteruser}\n                            &lt;script async src=\"//platform.twitter.com/widgets.js\" charset=\"utf-8\"&gt;\n                       |])\n</code></pre>\n\n<p>I have included this module to .cabal file and I can load it in a Handler and all works.</p>\n\n<pre><code>twitterUsername :: String\ntwitterUsername = \"someusername\"\n\ngetHomeR :: Handler Html\ngetHomeR = do\n    (formWidget, formEnctype) &lt;- generateFormPost sampleForm\n    let submission = Nothing :: Maybe FileForm\n        handlerName = \"getHomeR\" :: Text\n    defaultLayout $ do\n        let (commentFormId, commentTextareaId, commentListId) = commentIds\n        aDomId &lt;- newIdent\n        setTitle \"Some title\"\n        twitterWidget twitterUsername \n        $(widgetFile \"homepage\")\n</code></pre>\n\n<p>So what I would like to do is to use it directly in another template but when I try do:</p>\n\n<pre><code>^{twitterWidget twitterUsername}\n</code></pre>\n\n<p>I get </p>\n\n<pre><code>\u2022 Ambiguous type variable \u2018m1\u2019 arising from a use of \u2018toWidget\u2019\n      prevents the constraint \u2018(ToWidget App (m1 ()))\u2019 from being solved.\n      Probable fix: use a type annotation to specify what \u2018m1\u2019 should be.\n      These potential instances exist:\n        instance (site' ~ site, IO ~ m, a ~ ()) =&gt;\n                 ToWidget site' (WidgetT site m a)\n          -- Defined in \u2018Yesod.Core.Widget\u2019\n        ...plus one instance involving out-of-scope types\n        (use -fprint-potential-instances to see them all)\n    \u2022 In the second argument of \u2018(GHC.Base..)\u2019, namely \u2018toWidget\u2019\n      In the expression: asWidgetT GHC.Base.. toWidget\n      In a stmt of a 'do' block:\n        (asWidgetT GHC.Base.. toWidget) (twitterWidget twitterUsername)\n</code></pre>\n\n<p>So my question is what is the right way to accomplish having multiple widgets loaded in templates all around the website serving different purposes ?</p>\n"}, {"tags": ["performance", "haskell", "memory", "monad-transformers"], "comments": [{"owner": {"reputation": 75362, "user_id": 625403, "user_type": "registered", "accept_rate": 82, "profile_image": "https://www.gravatar.com/avatar/786eed7da67079cb5d63a49d469af25b?s=128&d=identicon&r=PG", "display_name": "amalloy", "link": "https://stackoverflow.com/users/625403/amalloy"}, "edited": false, "score": 3, "creation_date": 1490997683, "post_id": 43149878, "comment_id": 73377676, "body": "Maybe I&#39;m just not experienced enough, but I am having a hard time understanding the recursion between <code>foo</code>/<code>tryR</code>/<code>check</code>. If you expand on how you think the function behaves, you will (a) make it easier for someone else to step in with an answer, and (b) perhaps discover the answer yourself by explaining the code more thoroughly. FWIW to me it looks like it ought to be quadratic, but as noted I don&#39;t think I have a clear idea of what is really going on."}, {"owner": {"reputation": 100892, "user_id": 745903, "user_type": "registered", "accept_rate": 74, "profile_image": "https://www.gravatar.com/avatar/50933f6638836741e620669b3940410e?s=128&d=identicon&r=PG", "display_name": "leftaroundabout", "link": "https://stackoverflow.com/users/745903/leftaroundabout"}, "edited": false, "score": 0, "creation_date": 1491005357, "post_id": 43149878, "comment_id": 73379545, "body": "Well, it <a href=\"https://gist.github.com/leftaroundabout/096dcbc919ce7f6eafbbcb5f222b069a\" rel=\"nofollow noreferrer\">definitely <i>is</i> exponential</a>. Also, optimisation (<code>-O2</code>) changes the performance by a constant factor but does nothing to the scaling."}, {"owner": {"reputation": 24509, "user_id": 6863749, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/UyoQv.jpg?s=128&g=1", "display_name": "Li-yao Xia", "link": "https://stackoverflow.com/users/6863749/li-yao-xia"}, "edited": false, "score": 0, "creation_date": 1491005956, "post_id": 43149878, "comment_id": 73379696, "body": "Interestingly the exponential behavior disappeared when I wrote <code>MaybeT</code> by hand. I traced it back to the implementation of <code>lift</code> which uses <code>liftM</code> instead of <code>fmap</code>... I almost have an explanation there."}, {"owner": {"reputation": 31243, "user_id": 2751851, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/4ddc0.png?s=128&g=1", "display_name": "duplode", "link": "https://stackoverflow.com/users/2751851/duplode"}, "edited": false, "score": 0, "creation_date": 1491017207, "post_id": 43149878, "comment_id": 73381523, "body": "Tangential note: as far as my understanding of the runtime statistics goes, the &quot;bytes allocated&quot; value is best taken as a symptom, rather than a cause -- adding an extra element really doubles the amount of work (cf. Li-yao Xia&#39;s answer), which in this case also results in a doubling of the allocations throughout the run."}], "answers": [{"comments": [{"owner": {"reputation": 31243, "user_id": 2751851, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/4ddc0.png?s=128&g=1", "display_name": "duplode", "link": "https://stackoverflow.com/users/2751851/duplode"}, "edited": false, "score": 1, "creation_date": 1491010678, "post_id": 43151568, "comment_id": 73380500, "body": "An even simpler/cruder demo: turn on <code>+s</code> and feed this to GHCi; then, add an extra <code>MaybeT</code> and try again: <code>return &quot;foo&quot; :: MaybeT ( MaybeT (MaybeT (MaybeT (MaybeT (MaybeT (MaybeT (MaybeT (MaybeT (MaybeT (MaybeT (MaybeT (MaybeT (MaybeT (MaybeT (MaybeT (MaybeT (MaybeT (MaybeT (MaybeT (MaybeT (MaybeT (MaybeT (MaybeT (Identity))))))))))))))))))))))) ) String</code>"}, {"owner": {"reputation": 31243, "user_id": 2751851, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/4ddc0.png?s=128&g=1", "display_name": "duplode", "link": "https://stackoverflow.com/users/2751851/duplode"}, "edited": false, "score": 0, "creation_date": 1491011406, "post_id": 43151568, "comment_id": 73380618, "body": "Also, as you say, making <code>lift</code> use <code>fmap</code> rather than <code>liftM</code> will fix it: <code>return</code> for a tower of <code>MaybeT</code> will then boil down to to <code>MaybeT . MaybeT  .  .  .  fmap (fmap Just) . fmap Just . return</code>, which is linear in the height of the tower."}, {"owner": {"reputation": 37219, "user_id": 1523776, "user_type": "moderator", "accept_rate": 87, "profile_image": "https://www.gravatar.com/avatar/b3e0b5c8e42a8c38009ef2d969f8dabb?s=128&d=identicon&r=PG", "display_name": "Benjamin Hodgson", "link": "https://stackoverflow.com/users/1523776/benjamin-hodgson"}, "edited": false, "score": 1, "creation_date": 1491041426, "post_id": 43151568, "comment_id": 73386733, "body": "Have you considered submitting a bugfix to <code>transformers</code>?"}, {"owner": {"reputation": 37219, "user_id": 1523776, "user_type": "moderator", "accept_rate": 87, "profile_image": "https://www.gravatar.com/avatar/b3e0b5c8e42a8c38009ef2d969f8dabb?s=128&d=identicon&r=PG", "display_name": "Benjamin Hodgson", "link": "https://stackoverflow.com/users/1523776/benjamin-hodgson"}, "edited": false, "score": 0, "creation_date": 1491041637, "post_id": 43151568, "comment_id": 73386792, "body": "BTW <code>Functor</code> was always a superclass of <code>Monad</code>. It was <code>Applicative</code> that was missing from the hierarchy. I don&#39;t think there was any rational reason <code>lift</code> was defined like that, it was just a regular bug"}, {"owner": {"reputation": 24509, "user_id": 6863749, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/UyoQv.jpg?s=128&g=1", "display_name": "Li-yao Xia", "link": "https://stackoverflow.com/users/6863749/li-yao-xia"}, "edited": false, "score": 0, "creation_date": 1491058613, "post_id": 43151568, "comment_id": 73391615, "body": "<code>Functor</code> was made a superclass of <code>Monad</code> at the same time as <code>Applicative</code> (<a href=\"http://hackage.haskell.org/package/base-4.7.0.2/docs/Control-Monad.html\" rel=\"nofollow noreferrer\">base 4.7 only has <code>class Monad m</code></a>), and this is why many instances in <code>transformers</code> have <code>(Functor m, Monad m)</code> constraints. I have <a href=\"http://hub.darcs.net/ross/transformers/issue/39\" rel=\"nofollow noreferrer\">reported this bug</a> though I haven&#39;t gotten around to fixing it myself."}], "tags": [], "owner": {"reputation": 24509, "user_id": 6863749, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/UyoQv.jpg?s=128&g=1", "display_name": "Li-yao Xia", "link": "https://stackoverflow.com/users/6863749/li-yao-xia"}, "is_accepted": true, "score": 21, "last_activity_date": 1491012278, "last_edit_date": 1491012278, "creation_date": 1491007712, "answer_id": 43151568, "question_id": 43149878, "link": "https://stackoverflow.com/questions/43149878/why-do-nested-maybets-cause-exponential-allocation/43151568#43151568", "title": "Why do nested MaybeT&#39;s cause exponential allocation", "body": "<p>The transformers package (currently at version 0.5.4.0) implements <code>MonadTrans</code> using <code>liftM</code>:</p>\n\n<pre><code>lift :: Monad m =&gt; m a -&gt; MaybeT m a\nlift = MaybeT . liftM Just\n</code></pre>\n\n<p>where <code>liftM</code> is a combinator defined as</p>\n\n<pre><code>liftM :: Monad m =&gt; (a -&gt; b) -&gt; m a -&gt; m b\nliftM f m = m &gt;&gt;= \\a -&gt; return (f a)\n</code></pre>\n\n<p>Furthermore, <code>return</code> is defined for <code>MaybeT</code> as</p>\n\n<pre><code>return :: Monad m =&gt; a -&gt; MaybeT m a\nreturn a = lift . return\n</code></pre>\n\n<p>Reduce the definition:</p>\n\n<pre><code>return :: Monad m =&gt; a -&gt; MaybeT m a\nreturn a = MaybeT (return a &gt;&gt;= \\a -&gt; return (Just a))\n</code></pre>\n\n<p>where the two inner <code>return</code> are instantiated at type <code>m</code>.</p>\n\n<p>One call to <code>return @(MaybeT m)</code> calls <code>return @m</code> twice, hence the exponential behavior you observe for a tower of <code>MaybeT</code>.</p>\n\n<p>This is fixable by using <code>fmap</code> instead of <code>liftM</code>, but this is backwards incompatible, when <code>Functor</code> was not a superclass of <code>Monad</code>.</p>\n\n<p><strong>EDIT:</strong> Other transformers do not have this issue, as <code>return</code> is not defined using <code>lift</code>, which provides an even better fix.</p>\n\n<pre><code>return = MaybeT . return . Just\n</code></pre>\n\n<hr>\n\n<p>Here is a more minimal test case:</p>\n\n<pre><code>{-# LANGUAGE RankNTypes, ScopedTypeVariables #-}\nimport Control.Monad.Trans.Maybe\nimport System.Environment\n\nf :: forall m proxy. Monad m =&gt; proxy m -&gt; Int -&gt; ()\nf _ 0 = (return () :: m ()) `seq` ()\nf _ n = f (undefined :: proxy (MaybeT m)) (n - 1)\n\nmain = do\n  n : _ &lt;- getArgs\n  f (undefined :: proxy []) (read n) `seq` return ()\n</code></pre>\n\n<p>Output</p>\n\n<pre><code>&gt; for i in {18..21} ; time ./b $i\n./b $i  0.35s user 0.04s system 99% cpu 0.390 total\n./b $i  0.71s user 0.07s system 99% cpu 0.782 total\n./b $i  1.38s user 0.18s system 99% cpu 1.565 total\n./b $i  2.82s user 0.32s system 100% cpu 3.139 total\n</code></pre>\n"}], "owner": {"reputation": 1525, "user_id": 546591, "user_type": "registered", "accept_rate": 74, "profile_image": "https://i.stack.imgur.com/33RTK.jpg?s=128&g=1", "display_name": "James Koppel", "link": "https://stackoverflow.com/users/546591/james-koppel"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 284, "favorite_count": 2, "accepted_answer_id": 43151568, "answer_count": 1, "score": 17, "last_activity_date": 1613795868, "creation_date": 1490995436, "last_edit_date": 1613795868, "question_id": 43149878, "link": "https://stackoverflow.com/questions/43149878/why-do-nested-maybets-cause-exponential-allocation", "title": "Why do nested MaybeT&#39;s cause exponential allocation", "body": "<p>I have a program. </p>\n\n<pre><code>import Control.Monad\nimport Control.Monad.Identity\nimport Control.Monad.Trans.Maybe\n\nimport System.Environment\n\ntryR :: Monad m =&gt; ([a] -&gt; MaybeT m [a]) -&gt; ([a] -&gt; m [a])\ntryR f x = do\n  m &lt;- runMaybeT (f x)\n  case m of\n    Just t -&gt; return t\n    Nothing -&gt; return x\n\ncheck :: MonadPlus m =&gt; Int -&gt; m Int\ncheck x = if x `mod` 2 == 0 then return (x `div` 2) else mzero\n\nfoo :: MonadPlus m =&gt; [Int] -&gt; m [Int]\nfoo [] = return []\nfoo (x:xs) = liftM2 (:) (check x) (tryR foo xs)\n\n\nrunFoo :: [Int] -&gt; [Int]\nrunFoo x = runIdentity $ tryR foo x\n\nmain :: IO ()\nmain = do\n  [n_str] &lt;- getArgs\n  let n = read n_str :: Int\n  print $ runFoo [2,4..n]\n</code></pre>\n\n<p>The main interesting thing about this program is that it can have many nested layers of MaybeT's. Here, doing so serves absolutely no purpose, but it did in the original program where I encountered this problem.</p>\n\n<p>Care to take a guess of the time complexity of this program?</p>\n\n<p>Okay, you cheated by reading the title of this question. Yes, it's exponential:</p>\n\n<pre><code>[jkoppel@dhcp-18-189-103-38:~/tmp]$ time ./ExpAlloc 50                                                                                                                                        (03-31 17:15)\n[1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21,22,23,24,25]\n./ExpAlloc 50  8.10s user 0.06s system 99% cpu 8.169 total\n[jkoppel@dhcp-18-189-103-38:~/tmp]$ time ./ExpAlloc 52                                                                                                                                        (03-31 17:15)\n[1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21,22,23,24,25,26]\n./ExpAlloc 52  16.10s user 0.12s system 99% cpu 16.227 total\n[jkoppel@dhcp-18-189-103-38:~/tmp]$ time ./ExpAlloc 54                                                                                                                                        (03-31 17:16)\n[1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21,22,23,24,25,26,27]\n./ExpAlloc 54  32.32s user 0.23s system 99% cpu 32.561 total\n</code></pre>\n\n<p>Some further inspection shows the reason is because it allocates an exponential amount of memory, which naturally takes an exponential amount of time:</p>\n\n<pre><code>[jkoppel@dhcp-18-189-103-38:~/tmp]$ time ./ExpAlloc 40 +RTS -s                                                                                                                                (03-31 17:17)\n[1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20]\n     939,634,520 bytes allocated in the heap\n       5,382,816 bytes copied during GC\n          75,808 bytes maximum residency (2 sample(s))\n          66,592 bytes maximum slop\n               2 MB total memory in use (0 MB lost due to fragmentation)\n\n                                     Tot time (elapsed)  Avg pause  Max pause\n  Gen  0      1796 colls,     0 par    0.008s   0.009s     0.0000s    0.0000s\n  Gen  1         2 colls,     0 par    0.000s   0.000s     0.0001s    0.0001s\n\n  INIT    time    0.000s  (  0.000s elapsed)\n  MUT     time    0.243s  (  0.246s elapsed)\n  GC      time    0.008s  (  0.009s elapsed)\n  EXIT    time    0.000s  (  0.000s elapsed)\n  Total   time    0.252s  (  0.256s elapsed)\n\n  %GC     time       3.2%  (3.6% elapsed)\n\n  Alloc rate    3,869,930,149 bytes per MUT second\n\n  Productivity  96.8% of total user, 95.3% of total elapsed\n\n./ExpAlloc 40 +RTS -s  0.25s user 0.00s system 98% cpu 0.260 total\n[jkoppel@dhcp-18-189-103-38:~/tmp]$ time ./ExpAlloc 42 +RTS -s                                                                                                                                (03-31 17:17)\n[1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21]\n   1,879,159,424 bytes allocated in the heap\n      10,767,048 bytes copied during GC\n          95,504 bytes maximum residency (3 sample(s))\n          71,152 bytes maximum slop\n               2 MB total memory in use (0 MB lost due to fragmentation)\n\n                                     Tot time (elapsed)  Avg pause  Max pause\n  Gen  0      3593 colls,     0 par    0.016s   0.018s     0.0000s    0.0000s\n  Gen  1         3 colls,     0 par    0.000s   0.000s     0.0001s    0.0001s\n\n  INIT    time    0.000s  (  0.000s elapsed)\n  MUT     time    0.493s  (  0.498s elapsed)\n  GC      time    0.016s  (  0.018s elapsed)\n  EXIT    time    0.000s  (  0.000s elapsed)\n  Total   time    0.510s  (  0.517s elapsed)\n\n  %GC     time       3.1%  (3.5% elapsed)\n\n  Alloc rate    3,810,430,292 bytes per MUT second\n\n  Productivity  96.8% of total user, 95.7% of total elapsed\n\n./ExpAlloc 42 +RTS -s  0.51s user 0.01s system 99% cpu 0.521 total\n[jkoppel@dhcp-18-189-103-38:~/tmp]$ time ./ExpAlloc 44 +RTS -s                                                                                                                                (03-31 17:17)\n[1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21,22]\n   3,758,208,408 bytes allocated in the heap\n      21,499,312 bytes copied during GC\n         102,056 bytes maximum residency (5 sample(s))\n          73,784 bytes maximum slop\n               2 MB total memory in use (0 MB lost due to fragmentation)\n\n                                     Tot time (elapsed)  Avg pause  Max pause\n  Gen  0      7186 colls,     0 par    0.032s   0.037s     0.0000s    0.0009s\n  Gen  1         5 colls,     0 par    0.000s   0.001s     0.0001s    0.0001s\n\n  INIT    time    0.000s  (  0.000s elapsed)\n  MUT     time    0.979s  (  0.987s elapsed)\n  GC      time    0.033s  (  0.038s elapsed)\n  EXIT    time    0.000s  (  0.000s elapsed)\n  Total   time    1.013s  (  1.024s elapsed)\n\n  %GC     time       3.2%  (3.7% elapsed)\n\n  Alloc rate    3,840,757,815 bytes per MUT second\n\n  Productivity  96.7% of total user, 95.6% of total elapsed\n\n./ExpAlloc 44 +RTS -s  1.01s user 0.01s system 99% cpu 1.029 total\n</code></pre>\n\n<p>I cannot for the life of me figure out why it does this. I'd appreciate any light people could shed on the situation.</p>\n"}, {"tags": ["haskell", "ghc", "freebsd", "dbus", "haskell-stack"], "comments": [{"owner": {"reputation": 43759, "user_id": 1651941, "user_type": "registered", "accept_rate": 97, "profile_image": "https://www.gravatar.com/avatar/a513bc1fa519d2fcf5e4e0d9b5500101?s=128&d=identicon&r=PG", "display_name": "Sibi", "link": "https://stackoverflow.com/users/1651941/sibi"}, "edited": false, "score": 1, "creation_date": 1491008595, "post_id": 43147207, "comment_id": 73380227, "body": "Probably it&#39;s a freebsd related issue ? Works fine on my Linux machine."}, {"owner": {"reputation": 29966, "user_id": 637669, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/0227e5d5eaceb8ae2f751df38d421764?s=128&d=identicon&r=PG", "display_name": "arrowd", "link": "https://stackoverflow.com/users/637669/arrowd"}, "edited": false, "score": 0, "creation_date": 1491029460, "post_id": 43147207, "comment_id": 73383841, "body": "Do you really need to start dbus manually? Just put <code>dbus_enable=&quot;YES&quot;</code> into <code>&#47;etc&#47;rc.conf</code> and then do <code>service dbus start</code>."}, {"owner": {"reputation": 711, "user_id": 774228, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/60d85066d4024c48c64b05f6d149833f?s=128&d=identicon&r=PG", "display_name": "unclechu", "link": "https://stackoverflow.com/users/774228/unclechu"}, "reply_to_user": {"reputation": 43759, "user_id": 1651941, "user_type": "registered", "accept_rate": 97, "profile_image": "https://www.gravatar.com/avatar/a513bc1fa519d2fcf5e4e0d9b5500101?s=128&d=identicon&r=PG", "display_name": "Sibi", "link": "https://stackoverflow.com/users/1651941/sibi"}, "edited": false, "score": 0, "creation_date": 1491066564, "post_id": 43147207, "comment_id": 73394398, "body": "@Sibi that&#39;s right, that why I added &quot;FreeBSD&quot; to the topic, I also added comment about it at the end to make it be more obvious."}, {"owner": {"reputation": 711, "user_id": 774228, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/60d85066d4024c48c64b05f6d149833f?s=128&d=identicon&r=PG", "display_name": "unclechu", "link": "https://stackoverflow.com/users/774228/unclechu"}, "reply_to_user": {"reputation": 29966, "user_id": 637669, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/0227e5d5eaceb8ae2f751df38d421764?s=128&d=identicon&r=PG", "display_name": "arrowd", "link": "https://stackoverflow.com/users/637669/arrowd"}, "edited": false, "score": 0, "creation_date": 1491067116, "post_id": 43147207, "comment_id": 73394612, "body": "@arrowd I actually have this option in <code>&#47;etc&#47;rc.conf</code> but for some reason when I enter <b>openbox</b> session from <b>gdm</b> I have no <code>DBUS_SESSION_BUS_ADDRESS</code> env variable set and when I try to start my app I get this error: <code>ClientError {clientErrorMessage = &quot;connectSession: DBUS_SESSION_BUS_ADDRESS is missing or invalid.&quot;, clientErrorFatal = True}</code>"}, {"owner": {"reputation": 29966, "user_id": 637669, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/0227e5d5eaceb8ae2f751df38d421764?s=128&d=identicon&r=PG", "display_name": "arrowd", "link": "https://stackoverflow.com/users/637669/arrowd"}, "edited": false, "score": 0, "creation_date": 1491068330, "post_id": 43147207, "comment_id": 73395027, "body": "@unclechu Yep, you are right. You can use <b>system</b> bus without any additional setup, but you have to do something to use session one. I&#39;m using kdm4, so i have <code>DBUS_SESSION_BUS_ADDRESS</code> defined automatically. Unfortunately, I don&#39;t know what&#39;s proper way to start session bus."}, {"owner": {"reputation": 97, "user_id": 594712, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/266afa3fd63f97c25fc5dc4b5305235c?s=128&d=identicon&r=PG", "display_name": "codedmart", "link": "https://stackoverflow.com/users/594712/codedmart"}, "edited": false, "score": 0, "creation_date": 1580601871, "post_id": 43147207, "comment_id": 106151801, "body": "@unclechu Did you ever resolve this? I am seeing the same problem."}, {"owner": {"reputation": 711, "user_id": 774228, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/60d85066d4024c48c64b05f6d149833f?s=128&d=identicon&r=PG", "display_name": "unclechu", "link": "https://stackoverflow.com/users/774228/unclechu"}, "reply_to_user": {"reputation": 97, "user_id": 594712, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/266afa3fd63f97c25fc5dc4b5305235c?s=128&d=identicon&r=PG", "display_name": "codedmart", "link": "https://stackoverflow.com/users/594712/codedmart"}, "edited": false, "score": 0, "creation_date": 1580735385, "post_id": 43147207, "comment_id": 106183433, "body": "@codedmart Nope, I just dropped my experiments of using FreeBSD in 2017 due to this issue. I also have tried to ask on some freenode chat, maybe in #freebsd, also sent a mail to mailing list of FreeBSD as far as I remember (about 3 years passed) but no one had any ideas of how to fix it and what causes this. Maybe it makes sense to try it again after few years to check whether it has being fixed or not."}], "owner": {"reputation": 711, "user_id": 774228, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/60d85066d4024c48c64b05f6d149833f?s=128&d=identicon&r=PG", "display_name": "unclechu", "link": "https://stackoverflow.com/users/774228/unclechu"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 298, "favorite_count": 0, "answer_count": 0, "score": 1, "last_activity_date": 1491066161, "creation_date": 1490984196, "last_edit_date": 1491066161, "question_id": 43147207, "link": "https://stackoverflow.com/questions/43147207/haskell-failing-to-connect-to-dbus-as-client-on-freebsd", "title": "Haskell: Failing to connect to DBus as client on FreeBSD", "body": "<p>I'm using this library to do this: <a href=\"http://hackage.haskell.org/package/dbus\" rel=\"nofollow noreferrer\">http://hackage.haskell.org/package/dbus</a>.\nHere is a minimal example to reproduce it:</p>\n\n<pre><code>#!/usr/bin/env stack\n-- stack runghc --resolver lts-7.20 --install-ghc --package dbus\nimport DBus.Client\nmain = () &lt;$ connectSession\n</code></pre>\n\n<p>When I try to start it I'm getting this error:</p>\n\n<pre><code>SocketError {socketErrorMessage = \"Authentication failed\", socketErrorFatal = True, socketErrorAddress = Just (Address \"unix:guid=53252465d2726f11957f8b9d58de79ab,path=/tmp/dbus-jUIv1mTBAV\")}\n</code></pre>\n\n<p>But using <code>dbus-send</code> utility I can make a request without any errors:</p>\n\n<pre><code>$ dbus-send --session --dest=org.freedesktop.DBus --type=method_call --print-reply /org/freedesktop/DBus org.freedesktop.DBus.ListNames\nmethod return time=1490977755.289281 sender=org.freedesktop.DBus -&gt; destination=:1.44 serial=3 reply_serial=2\n   array [\n      string \"org.freedesktop.DBus\"\n      string \"org.gtk.vfs.mountpoint_14512\"\n      string \":1.7\"\n... rest of the list was removed ...\n</code></pre>\n\n<p>I'm starting DBus daemon for session in <code>~/.profile</code> this way:</p>\n\n<pre><code>DBUS_SESSION_BUS_ADDRESS=`dbus-daemon --fork --session --print-address`\nexport DBUS_SESSION_BUS_ADDRESS\n</code></pre>\n\n<p>It is relevant only to <strong>FreeBSD</strong>, connecting to DBus works fine on GNU/Linux.</p>\n"}, {"tags": ["haskell"], "comments": [{"owner": {"reputation": 15757, "user_id": 176841, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/45a168cb9eb8454d66c78f18e29d9342?s=128&d=identicon&r=PG", "display_name": "jberryman", "link": "https://stackoverflow.com/users/176841/jberryman"}, "edited": false, "score": 0, "creation_date": 1490982687, "post_id": 43146748, "comment_id": 73371035, "body": "A parse error means the compiler couldn&#39;t even make sense of your code. You didn&#39;t include the part reference in the error message so I&#39;m not sure we can help you with it (but perhaps you need a <code>let</code> in a <code>do</code> block?). You&#39;ve got other syntax errors as well that I can see at a quick glance"}, {"owner": {"reputation": 4989, "user_id": 1685095, "user_type": "registered", "accept_rate": 42, "profile_image": "https://www.gravatar.com/avatar/5f06068bb9b4c00f12582ccc0ba64c4a?s=128&d=identicon&r=PG", "display_name": "user1685095", "link": "https://stackoverflow.com/users/1685095/user1685095"}, "reply_to_user": {"reputation": 15757, "user_id": 176841, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/45a168cb9eb8454d66c78f18e29d9342?s=128&d=identicon&r=PG", "display_name": "jberryman", "link": "https://stackoverflow.com/users/176841/jberryman"}, "edited": false, "score": 0, "creation_date": 1490982842, "post_id": 43146748, "comment_id": 73371137, "body": "@jberryman <code>Knapsack.hs:10:72: error:</code> I didn&#39;t included it because you don&#39;t know the line numbers. Well, if you see syntax errors and you understand what I meant, can you show how to write that in Haskell?"}], "answers": [{"comments": [{"owner": {"reputation": 4989, "user_id": 1685095, "user_type": "registered", "accept_rate": 42, "profile_image": "https://www.gravatar.com/avatar/5f06068bb9b4c00f12582ccc0ba64c4a?s=128&d=identicon&r=PG", "display_name": "user1685095", "link": "https://stackoverflow.com/users/1685095/user1685095"}, "edited": false, "score": 0, "creation_date": 1490984538, "post_id": 43146985, "comment_id": 73371933, "body": "Thanks! I&#39;m used to python tuple unpacking, so I missed that. Can you also show how to memoize this? I tried <code>bestUnbounded [1..100] 10000</code> and got hanging and stack overflow error."}], "tags": [], "owner": {"reputation": 28488, "user_id": 402884, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35583fe46c2cde92467710cc7ceff266?s=128&d=identicon&r=PG", "display_name": "Chris Martin", "link": "https://stackoverflow.com/users/402884/chris-martin"}, "is_accepted": true, "score": 1, "last_activity_date": 1490983325, "creation_date": 1490983325, "answer_id": 43146985, "question_id": 43146748, "link": "https://stackoverflow.com/questions/43146748/how-to-use-pattern-matching-inside-a-function/43146985#43146985", "title": "How to use pattern matching inside a function?", "body": "<p>This isn't syntactically valid:</p>\n\n<pre><code>solution, weight = bestUnbounded items (capacity - i)\n</code></pre>\n\n<p>I think you meant to pattern match on <code>(,)</code> like this:</p>\n\n<pre><code>(solution, weight) = bestUnbounded items (capacity - i)\n</code></pre>\n\n<p>The tuple syntax always requires parentheses, for both construction and pattern matching.</p>\n"}], "owner": {"reputation": 4989, "user_id": 1685095, "user_type": "registered", "accept_rate": 42, "profile_image": "https://www.gravatar.com/avatar/5f06068bb9b4c00f12582ccc0ba64c4a?s=128&d=identicon&r=PG", "display_name": "user1685095", "link": "https://stackoverflow.com/users/1685095/user1685095"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 118, "favorite_count": 0, "accepted_answer_id": 43146985, "answer_count": 1, "score": 0, "last_activity_date": 1490984241, "creation_date": 1490982364, "last_edit_date": 1490984241, "question_id": 43146748, "link": "https://stackoverflow.com/questions/43146748/how-to-use-pattern-matching-inside-a-function", "title": "How to use pattern matching inside a function?", "body": "<p>I'm struggling with implementation of an unbounded knapsack problem solver. I want to use recursion and memoization instead of explicit state.</p>\n\n<p>But the problem is that I can't find a way to express my thoughts in valid Haskell. Both versions This gives me</p>\n\n<pre><code>    parse error on input \u2018=\u2019\n    Perhaps you need a 'let' in a 'do' block?\n    e.g. 'let x = 5' instead of 'x = 5'\n\n\n\nbestUnbounded :: [Integer] -&gt; Integer -&gt; ([Integer], Integer)\nbestUnbounded items capacity = if capacity &lt;= 0\n                                  then ([], 0)\n                                  else maximumBy (comparing snd) solutions\n                                      where solutions = filter (\\ s -&gt; snd s &lt;= capacity) $ map solve items\n                                            solve i   = (solution, weight + i)\n                                                where solution, weight = bestUnbounded items (capacity - i)\n\n\n\n\nbestUnbounded :: [Integer] -&gt; Integer -&gt; ([Integer], Integer)\nbestUnbounded items capacity\n  | capacity &lt;= 0 = ([], 0)\n  | otherwise     = maximumBy (comparing snd) solutions\n      where solutions = filter (\\ s -&gt; snd s &lt;= capacity)  map solve items\n            solve i   = let solution, weight = bestUnbounded items (capacity - i)\n                        in (solution, weight + i)\n</code></pre>\n\n<p>If anyone could also show how to use <code>Data.Func.Memoize</code> on that I would be also grateful.</p>\n\n<p>EDIT1</p>\n\n<p>Working solution</p>\n\n<pre><code>import Data.List (maximumBy)\nimport Data.Ord (comparing)\nimport Data.Function.Memoize (memoize)\n\nbestUnbounded :: [Integer] -&gt; Integer -&gt; ([Integer], Integer)\nbestUnbounded items capacity\n  | capacity &lt;= 0 = ([], 0)\n  | otherwise     = solver' capacity\n  where solver' = memoize solver\n        solver capacity = maximumBy (comparing snd) solutions\n        solutions = filter (\\ s -&gt; snd s &lt;= capacity) $ map solve items\n        solve i   = let (solution, weight) = bestUnbounded items (capacity - i)\n                    in (i : solution, weight + i)\n</code></pre>\n"}, {"tags": ["haskell", "parsec"], "answers": [{"comments": [{"owner": {"reputation": 1826, "user_id": 2910747, "user_type": "registered", "accept_rate": 57, "profile_image": "https://i.stack.imgur.com/i8YjQ.png?s=128&g=1", "display_name": "Adrian May", "link": "https://stackoverflow.com/users/2910747/adrian-may"}, "edited": false, "score": 0, "creation_date": 1491210344, "post_id": 43149158, "comment_id": 73433836, "body": "That works, but it looks a bit nasty. Is it possible to write an operator to wrap that up so I could write it as parse (stringless &gt;&gt;&gt; commentless) &quot;stdin&quot; input?"}, {"owner": {"reputation": 1735, "user_id": 2892792, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/5DNyi.jpg?s=128&g=1", "display_name": "Lazersmoke", "link": "https://stackoverflow.com/users/2892792/lazersmoke"}, "reply_to_user": {"reputation": 1826, "user_id": 2910747, "user_type": "registered", "accept_rate": 57, "profile_image": "https://i.stack.imgur.com/i8YjQ.png?s=128&g=1", "display_name": "Adrian May", "link": "https://stackoverflow.com/users/2910747/adrian-may"}, "edited": false, "score": 0, "creation_date": 1491221786, "post_id": 43149158, "comment_id": 73441541, "body": "You can use do-notation."}], "tags": [], "owner": {"reputation": 1735, "user_id": 2892792, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/5DNyi.jpg?s=128&g=1", "display_name": "Lazersmoke", "link": "https://stackoverflow.com/users/2892792/lazersmoke"}, "is_accepted": true, "score": 2, "last_activity_date": 1490992079, "creation_date": 1490992079, "answer_id": 43149158, "question_id": 43145805, "link": "https://stackoverflow.com/questions/43145805/haskell-parsec-pipeline-of-transformers-of-the-whole-file/43149158#43149158", "title": "Haskell: Parsec: Pipeline of transformers of the whole file", "body": "<p>You need to bind <code>Either Error</code>, not <code>Parser</code>. You need to move the bind outside the <code>parse</code>, and use multiple <code>parse</code>s:</p>\n\n<pre><code>parse stringless \"(stdin)\" input &gt;&gt;= parse commentless \"(stdin)\"\n</code></pre>\n\n<p>There is probably a better approach than what you are using, but this will do what you want.</p>\n"}], "owner": {"reputation": 1826, "user_id": 2910747, "user_type": "registered", "accept_rate": 57, "profile_image": "https://i.stack.imgur.com/i8YjQ.png?s=128&g=1", "display_name": "Adrian May", "link": "https://stackoverflow.com/users/2910747/adrian-may"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 70, "favorite_count": 0, "accepted_answer_id": 43149158, "answer_count": 1, "score": 0, "last_activity_date": 1490992079, "creation_date": 1490978710, "question_id": 43145805, "link": "https://stackoverflow.com/questions/43145805/haskell-parsec-pipeline-of-transformers-of-the-whole-file", "title": "Haskell: Parsec: Pipeline of transformers of the whole file", "body": "<p>I'm trying to use parsec to read a C/C++/java source file and do a series of transformations on the entire file. The first phase removes strings and the second phase removes comments. (That's because you might get a /* inside a string.) </p>\n\n<p>So each phase transforms a string onto Either String Error, and I want to bind (in the sense of Either) them together to make a pipeline of transformations of the whole file. This seems like a fairly general requirement.</p>\n\n<pre><code>import Text.ParserCombinators.Parsec\n\ncommentless, stringless :: Parser String\n\nstringless = fmap concat ( (many (noneOf \"\\\"\")) `sepBy` quotedString ) \nquotedString = (char '\"') &gt;&gt; (many quotedChar) &gt;&gt; (char '\"')\nquotedChar = try (string \"\\\\\\\"\" &gt;&gt; return '\"' ) &lt;|&gt; (noneOf \"\\\"\")  \n\ncommentless = fmap concat $ notComment `sepBy` comment\nnotComment = manyTill anyChar (lookAhead (comment &lt;|&gt; eof))\ncomment = (string \"//\" &gt;&gt; manyTill anyChar newline &gt;&gt; spaces &gt;&gt; return ()) \n      &lt;|&gt; (string \"/*\" &gt;&gt; manyTill anyChar (string \"*/\") &gt;&gt;  spaces &gt;&gt; return ())\n\n\nmain =\n    do c &lt;- getContents\n       case parse commentless \"(stdin)\" c of -- THIS WORKS\n--     case parse stringless \"(stdin)\" c of -- THIS WORKS TOO    \n--     case parse (stringless `THISISWHATIWANT` commentless) \"(stdin)\" c of \n            Left e -&gt; do putStrLn \"Error parsing input:\"\n                         print e\n            Right r -&gt; print r\n</code></pre>\n\n<p>So how can I do this? I tried parserBind but it didn't work.</p>\n\n<p>(In case anybody cares why, I'm trying to do a kind of light parse where I just extract what I want but avoid parsing the entire grammar or even knowing whether it's C++ or Java. All I need to extract is the starting and ending line numbers of all classes and functions. So I envisage a bunch of preprocessing phases that just scrub out comments, #defines/ifdefs, template preambles and contents of parentheses (because of the semicolons in for clauses), then I'll parse for snippets preceding {s (or following }s because of typedefs) and stuff those snippets through yet another phase to get the type and name of whatever it is, then recurse to just the second level to get java member functions.)</p>\n"}, {"tags": ["haskell", "conduit"], "answers": [{"tags": [], "owner": {"reputation": 11051, "user_id": 347165, "user_type": "registered", "accept_rate": 77, "profile_image": "https://www.gravatar.com/avatar/4881e74d5b966aca3f5945a974e8d91b?s=128&d=identicon&r=PG", "display_name": "Xodarap", "link": "https://stackoverflow.com/users/347165/xodarap"}, "is_accepted": true, "score": 0, "last_activity_date": 1491404923, "creation_date": 1491404923, "answer_id": 43235119, "question_id": 43145613, "link": "https://stackoverflow.com/questions/43145613/can-i-set-the-column-order-for-conduit-csv-using-namedrecords/43235119#43235119", "title": "Can I set the column order for conduit-CSV using NamedRecords?", "body": "<p>I ended up just making my own function for this:</p>\n\n<pre><code>sortColumns :: (Monad m, DefaultOrdered a, ToNamedRecord a) =&gt; Conduit (Named a) m (Row ByteString)\nsortColumns = CL.map doSort\n\ndoSort :: (DefaultOrdered a, ToNamedRecord a) =&gt; Named a -&gt; Row ByteString\ndoSort value =\n  let columnMap = toNamedRecord $ getNamed value\n      headers = toList $ headerOrder $ getNamed value\n      bsValue = map (\\title -&gt; findWithDefault \"\" title columnMap) headers\n  in  bsValue\n</code></pre>\n"}], "owner": {"reputation": 11051, "user_id": 347165, "user_type": "registered", "accept_rate": 77, "profile_image": "https://www.gravatar.com/avatar/4881e74d5b966aca3f5945a974e8d91b?s=128&d=identicon&r=PG", "display_name": "Xodarap", "link": "https://stackoverflow.com/users/347165/xodarap"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 40, "favorite_count": 0, "accepted_answer_id": 43235119, "answer_count": 1, "score": 1, "last_activity_date": 1491404923, "creation_date": 1490978012, "question_id": 43145613, "link": "https://stackoverflow.com/questions/43145613/can-i-set-the-column-order-for-conduit-csv-using-namedrecords", "title": "Can I set the column order for conduit-CSV using NamedRecords?", "body": "<p>My code is below. It seems like the data gets output in a random order, which makes sense since <code>NamedRecord</code> is just a <code>Map</code>. Is there a way I can enforce a specific order?</p>\n\n<p>I think one option is to create a conduit of type <code>Conduit (Named a) m (Row Text)</code>, but it seems like this is a common enough use case that something standard should already exist.</p>\n\n<pre><code>processor :: Monad m =&gt; Conduit (Named FalconRow) m (Named HefRow)\nprocessor = do\n  value &lt;- await \n  case value of\n    Nothing -&gt; return ()\n    Just v -&gt; do\n      let transformed = (fixRow . getNamed) v\n      CL.sourceList $ Prelude.map Named transformed\n\nrunTranslation :: IO ()\nrunTranslation = runResourceT $ \n  transformCSV defCSVSettings \n               (sourceFile \"input.csv\") \n               processor\n               (sinkFile \"output.csv\")\n</code></pre>\n"}, {"tags": ["algorithm", "list", "haskell"], "comments": [{"owner": {"reputation": 1735, "user_id": 2892792, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/5DNyi.jpg?s=128&g=1", "display_name": "Lazersmoke", "link": "https://stackoverflow.com/users/2892792/lazersmoke"}, "edited": false, "score": 0, "creation_date": 1490992604, "post_id": 43144712, "comment_id": 73375858, "body": "Always use type signatures. They will make your intentions clear to the reader and yourself, and will help you understand the error messages."}], "answers": [{"tags": [], "owner": {"reputation": 2231, "user_id": 1027321, "user_type": "registered", "accept_rate": 70, "profile_image": "https://i.stack.imgur.com/KkFZC.jpg?s=128&g=1", "display_name": "jakubdaniel", "link": "https://stackoverflow.com/users/1027321/jakubdaniel"}, "is_accepted": true, "score": 3, "last_activity_date": 1490975955, "last_edit_date": 1490975955, "creation_date": 1490975322, "answer_id": 43144797, "question_id": 43144712, "link": "https://stackoverflow.com/questions/43144712/given-a-list-of-lists-return-a-listh-with-lists-length-in-another-list/43144797#43144797", "title": "Given a List of Lists, return a Listh with Lists&#39; length ( in another list)", "body": "<p>The line</p>\n\n<pre><code>listlon [] = 0\n</code></pre>\n\n<p>produces the output <code>0</code> in place of something of type <code>[a]</code>. You most probably meant <code>listlon [] = []</code>. However I suggest <code>listlon = map length</code> or <code>listlon = map len'</code>. Or maybe I just do not understand what it is that you really want. As a first step, it always helps to provide the intended signature. Is it true that you are after a function <code>listlon :: [[a]] -&gt; [Int]</code>?</p>\n\n<p>If my understanding is correct, the most direct fix would be:</p>\n\n<pre><code>listlon [] = []\nlistlon [x] = [len' x]\nlistlon (x:xs) = len' x : listlon xs\n</code></pre>\n\n<p>This fixes the types. But you can notice that the second equation is redundant and this is sufficient</p>\n\n<pre><code>listlon [] = []\nlistlon (x:xs) = len' x : listlon xs\n</code></pre>\n\n<p>and now you can notice that this in fact is mapping <code>len'</code> over the list, hence <code>map len'</code> as the pointfree definition of <code>listlon</code>.</p>\n\n<p>The error says that the compiler got confused about the return type. You are trying to return a <code>Num</code> by literals <code>0</code> and <code>1</code> as well as in form of a list (constructed by the last line). The constraint <code>Num [a]</code> is only possible using the extension <code>FlexibleContexts</code>. But in fact it only indicates the problem I described above. These kinds of error messages are sometimes confusing because the compiler cannot read your mind, and so it assumes you know what you are doing and only reports a problem when it cannot continue inferring types anymore due to some conflict.</p>\n"}], "owner": {"reputation": 656, "user_id": 6739197, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/596ca15ff00c5f201050c7b3194d9fd2?s=128&d=identicon&r=PG&f=1", "display_name": "victor.ja", "link": "https://stackoverflow.com/users/6739197/victor-ja"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 90, "favorite_count": 0, "accepted_answer_id": 43144797, "answer_count": 1, "score": 0, "last_activity_date": 1490975955, "creation_date": 1490975019, "question_id": 43144712, "link": "https://stackoverflow.com/questions/43144712/given-a-list-of-lists-return-a-listh-with-lists-length-in-another-list", "title": "Given a List of Lists, return a Listh with Lists&#39; length ( in another list)", "body": "<p>When I try to run the following function, I get an error:</p>\n\n<pre><code>len' [] = 0\nlen' (_:xs) = 1 + len' xs\n\nlistlon [] = 0\nlistlon [[]] = 1\nlistlon (x:xs) = ((len' x):(listlon xs))\n</code></pre>\n\n<blockquote>\n  <p>functions.hs:41:1: error:\n     \u2022 Non type-variable argument in the constraint: Num [a]\n      (Use FlexibleContexts to permit this)\n    \u2022 When checking the inferred type\n        listlon :: forall a t. (Num [a], Num a) => [[t]] -> [a]</p>\n</blockquote>\n\n<p>Can some one explain me, How to fix this? What is this error conveying exactly?</p>\n"}, {"tags": ["haskell", "monad-transformers", "parametric-polymorphism"], "comments": [{"owner": {"reputation": 94713, "user_id": 1139697, "user_type": "registered", "accept_rate": 86, "profile_image": "https://www.gravatar.com/avatar/5f136ddb684f39aaee1c028ee1950f6f?s=128&d=identicon&r=PG", "display_name": "Zeta", "link": "https://stackoverflow.com/users/1139697/zeta"}, "edited": false, "score": 1, "creation_date": 1490986412, "post_id": 43144578, "comment_id": 73372880, "body": "I suspect <i>history</i>. <code>Applicative</code> wasn&#39;t a superclass of <code>Monad</code>, so one would have to write <code>(Functor m, Monad m) =&gt;</code>. Also, the definition hasn&#39;t changed since version 0.3.: it still uses <code>do</code> notation. Ross Paterson could shed more light on that."}, {"owner": {"reputation": 1735, "user_id": 2892792, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/5DNyi.jpg?s=128&g=1", "display_name": "Lazersmoke", "link": "https://stackoverflow.com/users/2892792/lazersmoke"}, "edited": false, "score": 1, "creation_date": 1491023214, "post_id": 43144578, "comment_id": 73382572, "body": "I think it could still be done with <code>Monad m =&gt; (w -&gt; w&#39;) -&gt; WriterT w m a -&gt; WriterT w&#39; m a</code> since <code>fmap f ma = ma &gt;&gt;= \\x -&gt; return (f x)</code>"}, {"owner": {"reputation": 57219, "user_id": 33796, "user_type": "registered", "accept_rate": 70, "profile_image": "https://www.gravatar.com/avatar/08727b23ba62e634b32988cdff082663?s=128&d=identicon&r=PG", "display_name": "luqui", "link": "https://stackoverflow.com/users/33796/luqui"}, "edited": false, "score": 1, "creation_date": 1491033597, "post_id": 43144578, "comment_id": 73384808, "body": "Looks like an oversight to me.  Interesting note, though: <a href=\"https://hackage.haskell.org/package/mtl-2.2.1/docs/Control-Monad-Writer-Class.html#v:censor\" rel=\"nofollow noreferrer\">the version that operates on <code>MonadWriter</code></a> cannot express a changing <code>w</code> type."}], "owner": {"reputation": 100892, "user_id": 745903, "user_type": "registered", "accept_rate": 74, "profile_image": "https://www.gravatar.com/avatar/50933f6638836741e620669b3940410e?s=128&d=identicon&r=PG", "display_name": "leftaroundabout", "link": "https://stackoverflow.com/users/745903/leftaroundabout"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 66, "favorite_count": 0, "answer_count": 0, "score": 3, "last_activity_date": 1490974544, "creation_date": 1490974544, "question_id": 43144578, "link": "https://stackoverflow.com/questions/43144578/why-does-control-monad-trans-writer-censor-not-allow-transforming-the-writer-typ", "title": "Why does Control.Monad.Trans.Writer.censor not allow transforming the writer-type?", "body": "<p><a href=\"http://hackage.haskell.org/package/transformers-0.5.4.0/docs/Control-Monad-Trans-Writer-Lazy.html#v:censor\" rel=\"nofollow noreferrer\">The signature</a> is</p>\n\n<pre><code>censor :: Monad m =&gt; (w -&gt; w) -&gt; WriterT w m a -&gt; WriterT w m a\n</code></pre>\n\n<p>Yet we could easily have the strictly more general</p>\n\n<pre><code>censor :: Functor m =&gt; (w -&gt; w') -&gt; WriterT w m a -&gt; WriterT w' m a\ncensor = mapWriterT . fmap . second\n</code></pre>\n\n<p>Granted, this would not work as easily with <a href=\"http://hackage.haskell.org/package/mtl-2.2.1/docs/Control-Monad-Writer-Strict.html#v:censor\" rel=\"nofollow noreferrer\">the <code>mtl</code> pendant</a>, but is that a compelling reason? Or has it perhaps something to do with performance?</p>\n"}, {"tags": ["haskell"], "comments": [{"owner": {"reputation": 57219, "user_id": 33796, "user_type": "registered", "accept_rate": 70, "profile_image": "https://www.gravatar.com/avatar/08727b23ba62e634b32988cdff082663?s=128&d=identicon&r=PG", "display_name": "luqui", "link": "https://stackoverflow.com/users/33796/luqui"}, "edited": false, "score": 0, "creation_date": 1490987889, "post_id": 43144535, "comment_id": 73373656, "body": "I don&#39;t see how this helps with multiple layers.  E.g. how do you specify that a parameter <code>m</code> has the ability to raise exceptions without spelling out the <code>ExceptT</code> layer?"}, {"owner": {"reputation": 1735, "user_id": 2892792, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/5DNyi.jpg?s=128&g=1", "display_name": "Lazersmoke", "link": "https://stackoverflow.com/users/2892792/lazersmoke"}, "edited": false, "score": 0, "creation_date": 1490992478, "post_id": 43144535, "comment_id": 73375796, "body": "What would your instances of <code>FileEff</code> and <code>ConsoleEff</code> look like? I suspect you would have to rewrite them for every <code>repr</code>."}, {"owner": {"reputation": 654, "user_id": 7501619, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/dfb3e55ff104cf8485859d00fc6ecbcb?s=128&d=identicon&r=PG&f=1", "display_name": "Taren", "link": "https://stackoverflow.com/users/7501619/taren"}, "edited": false, "score": 0, "creation_date": 1490996302, "post_id": 43144535, "comment_id": 73377254, "body": "The MonadEff type would only replace the bottom layer.  You also have to rewrite FileEff and ConsoleEff for each repr. The useful thing is that you can add new effects that are embedded into the monad transformer while reusing the MonadEff lifts. So <code>(MonadError String m, MonadEff m, FileEff (Eff m)) =&gt; m ()</code> could be <code>Either String (IO ())</code> or <code>Either String (Tracer ())</code> and so on. It also allows for separate implementations for, say, ConsoleEff without re-implementing all of IO. I added example implementations for ConsoleEff to my question."}, {"owner": {"reputation": 8237, "user_id": 2900502, "user_type": "registered", "accept_rate": 73, "profile_image": "https://i.stack.imgur.com/R1OjD.jpg?s=128&g=1", "display_name": "Shersh", "link": "https://stackoverflow.com/users/2900502/shersh"}, "edited": false, "score": 0, "creation_date": 1491127512, "post_id": 43144535, "comment_id": 73408227, "body": "You can try to implement this as a library, support common <code>Reader</code>, <code>State</code>, etc. Maybe benchmark with <code>mtl</code> to see how well you&#39;re performing. If everything is good  then post on <i>Reddit</i> and get some reasonable critique :)"}], "owner": {"reputation": 654, "user_id": 7501619, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/dfb3e55ff104cf8485859d00fc6ecbcb?s=128&d=identicon&r=PG&f=1", "display_name": "Taren", "link": "https://stackoverflow.com/users/7501619/taren"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 133, "favorite_count": 1, "answer_count": 0, "score": 4, "last_activity_date": 1491140590, "creation_date": 1490974438, "last_edit_date": 1491140590, "question_id": 43144535, "link": "https://stackoverflow.com/questions/43144535/mixing-commutating-monads", "title": "Mixing commutating Monads", "body": "<p>I have been reading up on tagless final encodings which gave me a new perspective on mtl. Namely that the concrete monad stack specifies an interpreter for a dsl. This makes it much more obvious to me why the n^2 instances are needed.</p>\n\n<p>There obviously also are commutative monads for which this wouldn't be needed, though. The most notable use case would be splitting up IO so that it'd be easier to reason about and test.</p>\n\n<p>My first idea was to parametrize MonadIO with an implementation:</p>\n\n<pre><code>class (Monad m, Monad (Eff m)) =&gt; MonadEff m where\n    type Eff m :: (* -&gt; *)\n    liftEff :: Eff m a -&gt; m a\n</code></pre>\n\n<p>Astonishingly enough this seems to work out fine. It would allow to define lifting instances once</p>\n\n<pre><code>instance MonadEff IO where\n  type Eff IO = IO\n  liftEff = id\ninstance MonadEff Tracer where\n  type Eff Tracer = Tracer\n  liftEff = id\ninstance MonadEff m =&gt; MonadEff (ExceptT e m) where\n  type Eff (ExceptT a m) = Eff m\n  liftEff = lift . liftEff\n-- ...\n</code></pre>\n\n<p>And compose effects easily:</p>\n\n<pre><code>g :: (MonadEff m, MonadError String m, ConsoleEff (Eff m)) =&gt; m ()\ng = liftEff (put \"foo\") &gt;&gt; throwError \"bar\"\n\nh :: (MonadEff m, ConsoleEff (Eff m), FileEff (Eff m)) =&gt; m ()\nh = liftEff $ do\n  l1 &lt;- get\n  l2 &lt;- get\n  c &lt;- read l2\n  put $  c ++ l1\n\nclass FileEff repr where\n  read :: FilePath -&gt; repr String\n  write :: FilePath -&gt; String -&gt; repr ()\nclass ConsoleEff repr where\n  put :: String -&gt; repr ()\n  get :: repr String\ninstance ConsoleEff IO where\n  get  = getLine\n  put s = putStrLn s\ninstance ConsoleEff Tracer where\n  put s = W.tell [s] &gt;&gt; return ()\n  get = do\n    i &lt;- S.get\n    S.put (i+1)\n    W.tell $ [\"putL '\" ++ show i ++ \"'\"]\n    return $ \"$\" ++ show i ++ \"(get)\"\n</code></pre>\n\n<p>It also allows to use different representations for testing and so on.</p>\n\n<pre><code>exec :: IO a -&gt; IO a\nexec = id\ntrace :: Tracer a -&gt; [String]\ntrace (Tracer f) = snd . runWriter $ evalStateT f (0::Int)\n</code></pre>\n\n<p>So at first glance this seems to work out perfectly while only requiring harmless language extensions and fitting into the existing mtl infrastructure. I haven't seen this before, though, so I am assuming that there is a  catch to this all.</p>\n\n<p>What is the catch?</p>\n"}, {"tags": ["haskell", "list-comprehension"], "comments": [{"owner": {"reputation": 110733, "user_id": 1009479, "user_type": "registered", "accept_rate": 64, "profile_image": "https://i.stack.imgur.com/wlrC5.jpg?s=128&g=1", "display_name": "Yu Hao", "link": "https://stackoverflow.com/users/1009479/yu-hao"}, "edited": false, "score": 0, "creation_date": 1490947775, "post_id": 43135609, "comment_id": 73348702, "body": "It&#39;s better to show a simple example of <code>oldArray</code> and the expected result."}, {"owner": {"reputation": 100892, "user_id": 745903, "user_type": "registered", "accept_rate": 74, "profile_image": "https://www.gravatar.com/avatar/50933f6638836741e620669b3940410e?s=128&d=identicon&r=PG", "display_name": "leftaroundabout", "link": "https://stackoverflow.com/users/745903/leftaroundabout"}, "edited": false, "score": 3, "creation_date": 1490955821, "post_id": 43135609, "comment_id": 73353502, "body": "Note that <code>array</code> is <i>not</i> an array but, well, as list."}], "answers": [{"tags": [], "owner": {"reputation": 1074, "user_id": 47856, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/adb3e060ce9ead3f83ee7baa118bd588?s=128&d=identicon&r=PG", "display_name": "Oleg", "link": "https://stackoverflow.com/users/47856/oleg"}, "is_accepted": false, "score": 3, "last_activity_date": 1490947863, "creation_date": 1490947863, "answer_id": 43135695, "question_id": 43135609, "link": "https://stackoverflow.com/questions/43135609/list-comprehension-that-has-more-elements-than-array/43135695#43135695", "title": "List Comprehension that has more elements than array", "body": "<p>The sample code you've written solves the problem you've described.\nYou filter out elements where z is not 10, and then take only 2 first parts of a tuple to build a new array.</p>\n"}, {"tags": [], "owner": {"reputation": 3633, "user_id": 675154, "user_type": "registered", "accept_rate": 80, "profile_image": "https://www.gravatar.com/avatar/23da6806cab4830b5d1b15ef2a410541?s=128&d=identicon&r=PG", "display_name": "delta", "link": "https://stackoverflow.com/users/675154/delta"}, "is_accepted": false, "score": 2, "last_activity_date": 1490952757, "creation_date": 1490952757, "answer_id": 43137286, "question_id": 43135609, "link": "https://stackoverflow.com/questions/43135609/list-comprehension-that-has-more-elements-than-array/43137286#43137286", "title": "List Comprehension that has more elements than array", "body": "<p>I think what you really want to ask is how to debug a haskell program. For this case, just fire up <code>ghci</code>, and make your algorithm a little function, and play with it.</p>\n\n<pre><code>Prelude&gt; let foo oldArray = [(x,y)|(x,y,z)&lt;-oldArray, z == 10]\nPrelude&gt; foo [(1,2,3)]\n[]\nPrelude&gt; foo [(1,2,10)]\n[(1,2)]\nPrelude&gt; foo [(1,2,10),(3,4,5),(5,6,10)]\n[(1,2),(5,6)]\n</code></pre>\n\n<p>\"Working properly\" basically means what you really got is what you expected. As we can see, <code>foo</code> works fine.</p>\n\n<p>Or we could just use some <code>print</code> in the source file, and see if the output  is expected.</p>\n\n<p>For more, you can use <code>ghci debugger</code>, or <code>Debug.Trace</code>.</p>\n\n<hr>\n\n<ol>\n<li><a href=\"https://hackage.haskell.org/package/base-4.9.1.0/docs/Debug-Trace.html\" rel=\"nofollow noreferrer\">https://hackage.haskell.org/package/base-4.9.1.0/docs/Debug-Trace.html</a></li>\n<li><a href=\"https://wiki.haskell.org/Debugging\" rel=\"nofollow noreferrer\">https://wiki.haskell.org/Debugging</a></li>\n<li><a href=\"https://downloads.haskell.org/~ghc/latest/docs/html/users_guide/ghci.html#the-ghci-debugger\" rel=\"nofollow noreferrer\">https://downloads.haskell.org/~ghc/latest/docs/html/users_guide/ghci.html#the-ghci-debugger</a></li>\n</ol>\n"}], "owner": {"reputation": 45, "user_id": 7788477, "user_type": "registered", "accept_rate": 50, "profile_image": "https://www.gravatar.com/avatar/a673c33968b5655b9f86ff3ad5e232f9?s=128&d=identicon&r=PG&f=1", "display_name": "plshelp", "link": "https://stackoverflow.com/users/7788477/plshelp"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 119, "favorite_count": 0, "answer_count": 2, "score": 0, "last_activity_date": 1563080911, "creation_date": 1490947569, "last_edit_date": 1563080911, "question_id": 43135609, "link": "https://stackoverflow.com/questions/43135609/list-comprehension-that-has-more-elements-than-array", "title": "List Comprehension that has more elements than array", "body": "<p>I am trying to create an array with list comprehensions like:</p>\n\n<pre><code>array = [(x,y)|(x,y,z)&lt;-oldArray, z == 10]\n</code></pre>\n\n<p>Let's say that <code>oldArray</code> is a previously made array that has 3 Int values, but the new array I want to make only needs the first two, but whether or not they get added depends on a condition of the third.</p>\n\n<p>I can't tell if this is working correctly or not though.</p>\n"}, {"tags": ["haskell", "ghc"], "answers": [{"comments": [{"owner": {"reputation": 1735, "user_id": 2892792, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/5DNyi.jpg?s=128&g=1", "display_name": "Lazersmoke", "link": "https://stackoverflow.com/users/2892792/lazersmoke"}, "edited": false, "score": 2, "creation_date": 1490967319, "post_id": 43132448, "comment_id": 73361274, "body": "This is equivalent to <code>Some Ring</code> in <a href=\"https://github.com/Lazersmoke/ghost-buster/blob/master/src/Data/SuchThat.hs\" rel=\"nofollow noreferrer\">this</a> library. You don&#39;t need to define your own data type for each use since you can use constraint kinds to add an arbitrary amount of constraints to the value."}, {"owner": {"reputation": 24509, "user_id": 6863749, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/UyoQv.jpg?s=128&g=1", "display_name": "Li-yao Xia", "link": "https://stackoverflow.com/users/6863749/li-yao-xia"}, "reply_to_user": {"reputation": 1735, "user_id": 2892792, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/5DNyi.jpg?s=128&g=1", "display_name": "Lazersmoke", "link": "https://stackoverflow.com/users/2892792/lazersmoke"}, "edited": false, "score": 0, "creation_date": 1490974017, "post_id": 43132448, "comment_id": 73366107, "body": "Yes, this is a more general pattern indeed. I&#39;m surprised it doesn&#39;t exist elsewhere already."}], "tags": [], "owner": {"reputation": 24509, "user_id": 6863749, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/UyoQv.jpg?s=128&g=1", "display_name": "Li-yao Xia", "link": "https://stackoverflow.com/users/6863749/li-yao-xia"}, "is_accepted": true, "score": 22, "last_activity_date": 1490934314, "creation_date": 1490934314, "answer_id": 43132448, "question_id": 43132329, "link": "https://stackoverflow.com/questions/43132329/polymorphism-inside-monads/43132448#43132448", "title": "Polymorphism inside monads", "body": "<p>You can work around the absence of impredicative polymorphism by wrapping the polymorphic value in a special data type.</p>\n\n<pre><code>newtype AnyRing = AnyRing (forall a. Ring a =&gt; a)\n\nfoo :: Monad m =&gt; m AnyRing\n\nmain = do\n  AnyRing x &lt;- foo\n  print (x :: Double)\n  print (x :: Int)\n</code></pre>\n"}, {"tags": [], "owner": {"reputation": 21417, "user_id": 925978, "user_type": "registered", "accept_rate": 84, "profile_image": "https://www.gravatar.com/avatar/06e4467a5bd1538a92cefb20db07897a?s=128&d=identicon&r=PG&f=1", "display_name": "crockeea", "link": "https://stackoverflow.com/users/925978/crockeea"}, "is_accepted": false, "score": 3, "last_activity_date": 1490966674, "creation_date": 1490966674, "answer_id": 43141882, "question_id": 43132329, "link": "https://stackoverflow.com/questions/43132329/polymorphism-inside-monads/43141882#43141882", "title": "Polymorphism inside monads", "body": "<p>I found another interesting solution, which came from <a href=\"http://okmij.org/ftp/tagless-final/course/lecture.pdf\" rel=\"nofollow noreferrer\">this paper</a> on typed, tagless, final interpreters (section 2.3).</p>\n\n<p>The idea is to use a \"duplicator\":</p>\n\n<pre><code>data Dup a b = Dup a b\n\nduplicate :: Dup a b -&gt; (a,b)\nduplicate (Dup a b) = (a,b)\n\ninstance (Num a, Num b) =&gt; Num (Dup a b) where\n  fromInteger x = Dup (fromInteger x) (fromInteger x)\n  ...\n\nfoo :: (Monad mon, Num a) =&gt; mon a\nfoo = return 3\n\nmain :: IO ()\nmain = do\n x &lt;- foo\n let (y,z) = duplicate x\n print (y :: Double)\n print (z :: Int)\n</code></pre>\n\n<p>This solution isn't as general as Li-yao Xia's (it only works when the monadic value is an instance of a type class), but it is interesting because you don't need higher-rank polymorphism.</p>\n"}], "owner": {"reputation": 21417, "user_id": 925978, "user_type": "registered", "accept_rate": 84, "profile_image": "https://www.gravatar.com/avatar/06e4467a5bd1538a92cefb20db07897a?s=128&d=identicon&r=PG&f=1", "display_name": "crockeea", "link": "https://stackoverflow.com/users/925978/crockeea"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 597, "favorite_count": 1, "accepted_answer_id": 43132448, "answer_count": 2, "score": 14, "last_activity_date": 1490966674, "creation_date": 1490933565, "question_id": 43132329, "link": "https://stackoverflow.com/questions/43132329/polymorphism-inside-monads", "title": "Polymorphism inside monads", "body": "<p>I'm trying to pull a value out of a monad, but keep the <em>value</em>, which doesn't depend on the monad, polymorphic. Specifically:</p>\n\n<pre><code>foo :: (Monad mon, Ring a) =&gt; mon a\nfoo = return 3\n\nmain :: IO ()\nmain = do\n  x &lt;- foo\n  print (x :: Double)\n  print (x :: Int)\n</code></pre>\n\n<p>The point is that the monadic portion of the computation is expensive to compute, so I only want to do it once, while keeping the value in the monad polymorphic. All of my attempts so far:</p>\n\n<ol>\n<li>giving <code>x</code> the signature <code>forall a. (Ring a) =&gt; a</code>)</li>\n<li>giving <code>foo :: (Monad mon) =&gt; mon (forall a . (Ring a) =&gt; a)</code> </li>\n<li>enabling <code>-XNoMonomorphismRestriction</code> and <code>NoMonoLocalBins</code> </li>\n</ol>\n\n<p>have either not worked or given errors about impredicative polymorphism, which I'm not willing to use. Is there some way to pull a polymorphic value out of a monad without impredicative polymorphism (or alternatively: is there a safe way to use impredicative polymorphism in GHC)?</p>\n"}, {"tags": ["haskell", "parsec"], "comments": [{"owner": {"reputation": 314794, "user_id": 67579, "user_type": "registered", "accept_rate": 81, "profile_image": "https://i.stack.imgur.com/BJXub.png?s=128&g=1", "display_name": "Willem Van Onsem", "link": "https://stackoverflow.com/users/67579/willem-van-onsem"}, "edited": false, "score": 0, "creation_date": 1490915682, "post_id": 43129867, "comment_id": 73338199, "body": "So you want to <i>parse</i> positive integers?"}, {"owner": {"reputation": 111, "user_id": 7675168, "user_type": "registered", "profile_image": "https://graph.facebook.com/706160779556907/picture?type=large", "display_name": "Alikeju Adejo", "link": "https://stackoverflow.com/users/7675168/alikeju-adejo"}, "reply_to_user": {"reputation": 314794, "user_id": 67579, "user_type": "registered", "accept_rate": 81, "profile_image": "https://i.stack.imgur.com/BJXub.png?s=128&g=1", "display_name": "Willem Van Onsem", "link": "https://stackoverflow.com/users/67579/willem-van-onsem"}, "edited": false, "score": 0, "creation_date": 1490915777, "post_id": 43129867, "comment_id": 73338230, "body": "Yes I want to parse positive integers."}, {"owner": {"reputation": 314794, "user_id": 67579, "user_type": "registered", "accept_rate": 81, "profile_image": "https://i.stack.imgur.com/BJXub.png?s=128&g=1", "display_name": "Willem Van Onsem", "link": "https://stackoverflow.com/users/67579/willem-van-onsem"}, "edited": false, "score": 2, "creation_date": 1490915956, "post_id": 43129867, "comment_id": 73338280, "body": "But your type <code>[Char] st...</code> does not make much sense?"}], "answers": [{"tags": [], "owner": {"reputation": 314794, "user_id": 67579, "user_type": "registered", "accept_rate": 81, "profile_image": "https://i.stack.imgur.com/BJXub.png?s=128&g=1", "display_name": "Willem Van Onsem", "link": "https://stackoverflow.com/users/67579/willem-van-onsem"}, "is_accepted": false, "score": 4, "last_activity_date": 1490916090, "creation_date": 1490916090, "answer_id": 43129938, "question_id": 43129867, "link": "https://stackoverflow.com/questions/43129867/haskell-parsing-positive-integers/43129938#43129938", "title": "Haskell: Parsing Positive Integers", "body": "<p>Well it is simply the type that is wrong here.</p>\n\n<p>If you write <code>:t many1 digit</code> in the terminal, you get:</p>\n\n<pre><code>Prelude Text.Parsec.Combinator Text.Parsec.Char Text.Parsec.Prim&gt; :t many1 digit\nmany1 digit :: Stream s m Char =&gt; ParsecT s u m [Char]\n</code></pre>\n\n<p>So you can write the type signature of your function as:</p>\n\n<pre><code>number :: <b>Stream s m Char =&gt; ParsecT s u m [Char]</b>\nnumber =  many1 digit</code></pre>\n\n<p>(or simply omit a type signature).</p>\n\n<p>I don't see why you want a less generic type signature because potentially in the future you want to use <code>number</code> for something else.</p>\n\n<p>The reason why the compiler gives this error, is because the type <code>[Char]</code> has \"no type parameters\" you can fill in. So the compiler get confused why to call <code>[Char]</code> with <code>st</code>, and so on.</p>\n"}], "owner": {"reputation": 111, "user_id": 7675168, "user_type": "registered", "profile_image": "https://graph.facebook.com/706160779556907/picture?type=large", "display_name": "Alikeju Adejo", "link": "https://stackoverflow.com/users/7675168/alikeju-adejo"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 321, "favorite_count": 0, "answer_count": 1, "score": 0, "last_activity_date": 1490944979, "creation_date": 1490915637, "last_edit_date": 1490944979, "question_id": 43129867, "link": "https://stackoverflow.com/questions/43129867/haskell-parsing-positive-integers", "title": "Haskell: Parsing Positive Integers", "body": "<p>I am trying to parse positive integers in Haskell and I wrote this: </p>\n\n<pre><code>number ::  [Char] st Data.Functor.Identity.Identity [Char]\nnumber =   do\n           many1 digit\n</code></pre>\n\n<p>But I am getting this error: </p>\n\n<pre><code> \u2022 Expecting three fewer arguments to \u2018[Char]\u2019\n   Expected kind \u2018k0 -&gt; (* -&gt; *) -&gt; * -&gt; *\u2019, but \u2018[Char]\u2019 has kind \u2018*\u2019\n \u2022 In the type signature:\n    number :: [Char] st Identity [Char]\n    Failed, modules loaded: none.'\n</code></pre>\n\n<p>Why is this error thrown and how can I fix it?</p>\n"}, {"tags": ["haskell", "sum"], "comments": [{"owner": {"reputation": 853, "user_id": 3645112, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/QFHGj.jpg?s=128&g=1", "display_name": "Rainbacon", "link": "https://stackoverflow.com/users/3645112/rainbacon"}, "edited": false, "score": 1, "creation_date": 1490907355, "post_id": 43128046, "comment_id": 73335123, "body": "As is your question is poorly formed. Consider reading about <a href=\"https://stackoverflow.com/help/how-to-ask\">how to ask a good question</a>"}, {"owner": {"reputation": 7654, "user_id": 3392344, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/73b330bd0662d7c5afbfe3b503d1ef20?s=128&d=identicon&r=PG&f=1", "display_name": "dparoli", "link": "https://stackoverflow.com/users/3392344/dparoli"}, "edited": false, "score": 2, "creation_date": 1490908361, "post_id": 43128046, "comment_id": 73335664, "body": "and the error is?"}, {"owner": {"reputation": 2231, "user_id": 1027321, "user_type": "registered", "accept_rate": 70, "profile_image": "https://i.stack.imgur.com/KkFZC.jpg?s=128&g=1", "display_name": "jakubdaniel", "link": "https://stackoverflow.com/users/1027321/jakubdaniel"}, "edited": false, "score": 4, "creation_date": 1490908779, "post_id": 43128046, "comment_id": 73335863, "body": "I would suggest reading some introduction to haskell syntax. <a href=\"http://learnyouahaskell.com/\" rel=\"nofollow noreferrer\">Learn you a haskell</a>."}, {"owner": {"reputation": 94713, "user_id": 1139697, "user_type": "registered", "accept_rate": 86, "profile_image": "https://www.gravatar.com/avatar/5f136ddb684f39aaee1c028ee1950f6f?s=128&d=identicon&r=PG", "display_name": "Zeta", "link": "https://stackoverflow.com/users/1139697/zeta"}, "edited": false, "score": 1, "creation_date": 1490985043, "post_id": 43128046, "comment_id": 73372200, "body": "If you want to <i>sum</i> the numbers, why is your function called <i>gcd</i>?"}], "answers": [{"comments": [{"owner": {"reputation": 28384, "user_id": 104223, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/18ee4.png?s=128&g=1", "display_name": "Leigh", "link": "https://stackoverflow.com/users/104223/leigh"}, "edited": false, "score": 2, "creation_date": 1490924034, "post_id": 43128766, "comment_id": 73340197, "body": "Please add some context and briefly explain how the above solves the problem."}, {"owner": {"reputation": 936, "user_id": 4884579, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/b0fca1fac3b94fed8f0291116e9b4ef6?s=128&d=identicon&r=PG&f=1", "display_name": "Erik", "link": "https://stackoverflow.com/users/4884579/erik"}, "reply_to_user": {"reputation": 28384, "user_id": 104223, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/18ee4.png?s=128&g=1", "display_name": "Leigh", "link": "https://stackoverflow.com/users/104223/leigh"}, "edited": false, "score": 0, "creation_date": 1490970500, "post_id": 43128766, "comment_id": 73363582, "body": "You&#39;re right. Hopefully the answer is more helpful now."}], "tags": [], "owner": {"reputation": 936, "user_id": 4884579, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/b0fca1fac3b94fed8f0291116e9b4ef6?s=128&d=identicon&r=PG&f=1", "display_name": "Erik", "link": "https://stackoverflow.com/users/4884579/erik"}, "is_accepted": true, "score": 0, "last_activity_date": 1490970406, "last_edit_date": 1490970406, "creation_date": 1490909651, "answer_id": 43128766, "question_id": 43128046, "link": "https://stackoverflow.com/questions/43128046/sum-of-two-numbers-with-function-in-haskell/43128766#43128766", "title": "Sum of two numbers with function in haskell", "body": "<p>I think you may be confusing type variables which are used in type annotations, and the actual values being passed to the function.</p>\n\n<p>In your definition of mygcd:</p>\n\n<pre><code>mygcd c = a + b\n</code></pre>\n\n<p>Unless <code>a</code> and <code>b</code> are defined elsewhere, this will be an error. In other words, these <code>a</code>, <code>b</code>, and <code>c</code> are different than the <code>a</code>, <code>b</code>, and <code>c</code> mentioned in the type annotation for the function. The ones in the type annotation refer only to <em>types of variables</em>.</p>\n\n<p>If it is confusing, you can leave off the type annotation and let the compiler determine it for you. </p>\n\n<p>For instance, if you want a function to add two numbers, it's as simple as this:</p>\n\n<pre><code>addTwoNumbers a b = a + b\n</code></pre>\n\n<p>If you load this into GHCi, and check the type with <code>:t addTwoNumbers</code>, you'll see that the inferred type is <code>addTwoNumbers :: Num a =&gt; a -&gt; a -&gt; a</code>.</p>\n\n<p>If you would prefer the function add the contents of a tuple, you can change the definition to</p>\n\n<pre><code>addTuple (a, b) = a + b\n</code></pre>\n\n<p>Now the inferred type will be <code>addTuple :: Num a =&gt; (a, a) -&gt; a</code></p>\n\n<pre><code>mygcd :: Num a =&gt; (a, a) -&gt; a\nmygcd (a, b) = a + b \n\nmain = do\n  a &lt;- readLn\n  b &lt;- readLn\n  print $ mygcd (a, b)\n</code></pre>\n"}], "owner": {"reputation": 1, "user_id": 7788735, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/84d4b8bd200e6d6e432126fd52e41606?s=128&d=identicon&r=PG&f=1", "display_name": "Kiril Georgiev", "link": "https://stackoverflow.com/users/7788735/kiril-georgiev"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 5842, "favorite_count": 1, "accepted_answer_id": 43128766, "answer_count": 1, "score": -7, "last_activity_date": 1490970406, "creation_date": 1490906984, "question_id": 43128046, "link": "https://stackoverflow.com/questions/43128046/sum-of-two-numbers-with-function-in-haskell", "title": "Sum of two numbers with function in haskell", "body": "<p>I am beginner who wants to learn Haskell! I want to make a function, which has two parameters for input and one for output! The task of the function is to sum two numbers and to return the result! This is my code but it gives a error </p>\n\n<pre><code>mygcd :: (a , b) -&gt; c \nmygcd c = a + b \n\nmain = do\na &lt;- readLn\nb &lt;-readLn\nprint $ mygcd (a , b)\n</code></pre>\n\n<p>I will be thankful if you can help me!</p>\n"}, {"tags": ["haskell", "module"], "comments": [{"owner": {"reputation": 1218, "user_id": 6042307, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/ee6ebc7609bac3a4ddf6c7920c2c083a?s=128&d=identicon&r=PG", "display_name": "gabesoft", "link": "https://stackoverflow.com/users/6042307/gabesoft"}, "edited": false, "score": 0, "creation_date": 1490911446, "post_id": 43127606, "comment_id": 73336952, "body": "You should probably use stack to ensure all dependencies are consistent <a href=\"https://docs.haskellstack.org/en/stable/README/\" rel=\"nofollow noreferrer\">docs.haskellstack.org/en/stable/README</a>"}, {"owner": {"reputation": 31243, "user_id": 2751851, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/4ddc0.png?s=128&g=1", "display_name": "duplode", "link": "https://stackoverflow.com/users/2751851/duplode"}, "edited": false, "score": 4, "creation_date": 1490913914, "post_id": 43127606, "comment_id": 73337688, "body": "Please paste error messages as text, and not as images."}], "answers": [{"tags": [], "owner": {"reputation": 56659, "user_id": 450128, "user_type": "registered", "accept_rate": 62, "profile_image": "https://www.gravatar.com/avatar/2f72b3fdc99fe9fd1bbeb2f9da1d2c0a?s=128&d=identicon&r=PG", "display_name": "Ben", "link": "https://stackoverflow.com/users/450128/ben"}, "is_accepted": true, "score": 1, "last_activity_date": 1490912235, "creation_date": 1490912235, "answer_id": 43129318, "question_id": 43127606, "link": "https://stackoverflow.com/questions/43127606/conflicting-versions-of-data-map/43129318#43129318", "title": "Conflicting versions of Data.Map", "body": "<p>You have two versions of the containers package installed, and have  ended up referencing both of them. A Map produced by containers 0.5.7.1 can't be passed to a Map-consuming function from containers 0.5.10.1 (or any mismatched versions), even if their definition of Map in source code is the same.</p>\n\n<p>Without knowing more about your installation history, it's impossible to say exactly why that happened. I would guess you're just using <code>cabal install</code> to install packages as you need them, into the default user-wide package environment? That almost inevitably results in problems like this, eventually.</p>\n\n<p>The easiest immediate solution is to delete your entire store of installed packages and then reinstall everything you need again (preferably all at the same time, not with multiple separate invocations of <code>cabal install</code>).</p>\n\n<p>To prevent this from happening again, to could change your work practices to use tools like <code>cabal sandbox</code> or <code>stack</code>, which facilitate having separate package environments for each project.</p>\n"}, {"comments": [{"owner": {"reputation": 13734, "user_id": 938694, "user_type": "registered", "accept_rate": 59, "profile_image": "https://www.gravatar.com/avatar/b6678a430a805dd78366d6e135b49f2d?s=128&d=identicon&r=PG", "display_name": "Cubic", "link": "https://stackoverflow.com/users/938694/cubic"}, "edited": false, "score": 0, "creation_date": 1490944274, "post_id": 43130035, "comment_id": 73346774, "body": "No, OP clearly has both packages installed which is the problem. They&#39;re probably not using stack if they have a conflict like that."}], "tags": [], "owner": {"reputation": 936, "user_id": 4884579, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/b0fca1fac3b94fed8f0291116e9b4ef6?s=128&d=identicon&r=PG&f=1", "display_name": "Erik", "link": "https://stackoverflow.com/users/4884579/erik"}, "is_accepted": false, "score": 1, "last_activity_date": 1490917532, "last_edit_date": 1490917532, "creation_date": 1490916773, "answer_id": 43130035, "question_id": 43127606, "link": "https://stackoverflow.com/questions/43127606/conflicting-versions-of-data-map/43130035#43130035", "title": "Conflicting versions of Data.Map", "body": "<p>Tough to know for sure without more details, but I will assume you are using stack and the latest LTS snapshot (8.6 as of the time I'm writing this).</p>\n\n<p>This could be happening because <a href=\"https://www.stackage.org/lts-8.6\" rel=\"nofollow noreferrer\">LTS 8.6</a> has <a href=\"https://www.stackage.org/lts-8.6/package/containers-0.5.7.1\" rel=\"nofollow noreferrer\">containers-0.5.7.1</a>, and you are attempting to use a function that is in a newer version (<a href=\"https://hackage.haskell.org/package/containers-0.5.10.1\" rel=\"nofollow noreferrer\">containers-0.5.10.1</a>) which hasn't made its way from Hackage to Stackage yet.</p>\n\n<p>To resolve this, modify your <code>stack.yaml</code> file to include:</p>\n\n<pre><code>extra-deps:\n- containers-0.5.10.1\n</code></pre>\n"}], "owner": {"reputation": 153, "user_id": 7469141, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/Qcch8.jpg?s=128&g=1", "display_name": "Hackerman", "link": "https://stackoverflow.com/users/7469141/hackerman"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 76, "favorite_count": 0, "accepted_answer_id": 43129318, "answer_count": 2, "score": 0, "last_activity_date": 1490917532, "creation_date": 1490905193, "question_id": 43127606, "link": "https://stackoverflow.com/questions/43127606/conflicting-versions-of-data-map", "title": "Conflicting versions of Data.Map", "body": "<p>I'm working with this module <a href=\"https://hackage.haskell.org/package/hgeometry-0.6.0.0/docs/Algorithms-Geometry-LineSegmentIntersection-BentleyOttmann.html\" rel=\"nofollow noreferrer\">Algorithms.Geometry.LineSegmentIntersection.BentleyOttman</a> using the function \"intersections\"  that returns something of type <strong>Intersections</strong> which in turn is an alias for <strong>Map (Point 2 r) (Associated p r)</strong>. So, I try to manipulate that result with the corresponding functions of the <a href=\"https://hackage.haskell.org/package/containers-0.5.7.1/docs/Data-Map-Lazy.html\" rel=\"nofollow noreferrer\">Data.Map.Lazy</a> module, but I get the following error:\n<a href=\"https://i.stack.imgur.com/w2RLg.png\" rel=\"nofollow noreferrer\"><img src=\"https://i.stack.imgur.com/w2RLg.png\" alt=\"\"></a>\nAny ideas on how to fix it? Thanks!</p>\n"}, {"tags": ["haskell", "free-monad"], "comments": [{"owner": {"reputation": 2831, "user_id": 183792, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/9ddcfbc6c31012fd25384f6301363347?s=128&d=identicon&r=PG&f=1", "display_name": "Michael", "link": "https://stackoverflow.com/users/183792/michael"}, "edited": false, "score": 0, "creation_date": 1490962343, "post_id": 43126203, "comment_id": 73357765, "body": "I think it should be <code>transactExample = transact (Table UserTb) (Get someUserId)</code>"}, {"owner": {"reputation": 1722, "user_id": 1593986, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/8b55a5d33dee71102db716c72e166974?s=128&d=identicon&r=PG", "display_name": "vidi", "link": "https://stackoverflow.com/users/1593986/vidi"}, "reply_to_user": {"reputation": 2831, "user_id": 183792, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/9ddcfbc6c31012fd25384f6301363347?s=128&d=identicon&r=PG&f=1", "display_name": "Michael", "link": "https://stackoverflow.com/users/183792/michael"}, "edited": false, "score": 0, "creation_date": 1490975073, "post_id": 43126203, "comment_id": 73366709, "body": "You are right. I didn&#39;t actually get to compile that part"}], "answers": [{"comments": [{"owner": {"reputation": 1722, "user_id": 1593986, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/8b55a5d33dee71102db716c72e166974?s=128&d=identicon&r=PG", "display_name": "vidi", "link": "https://stackoverflow.com/users/1593986/vidi"}, "edited": false, "score": 0, "creation_date": 1490952147, "post_id": 43127003, "comment_id": 73351089, "body": "I&#39;ve tried that before, since all the examples that I&#39;ve seen were using id, but it doesn&#39;t work. The error is  &quot;Couldn&#39;t match type \u2018t\u2019 with \u2018Maybe r\u2019       \u2018t\u2019 is a rigid type variable bound by         the type signature for:           transact :: forall i r t. Table i r t -&gt; Op i r -&gt; AppM (Maybe r)         at src/App/AppMonad.hs:56:13       Expected type: Maybe r -&gt; t         Actual type: t -&gt; t     \u2022 In the second argument of \u2018tb\u2019, namely \u2018id\u2019... &quot;"}, {"owner": {"reputation": 24509, "user_id": 6863749, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/UyoQv.jpg?s=128&g=1", "display_name": "Li-yao Xia", "link": "https://stackoverflow.com/users/6863749/li-yao-xia"}, "reply_to_user": {"reputation": 1722, "user_id": 1593986, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/8b55a5d33dee71102db716c72e166974?s=128&d=identicon&r=PG", "display_name": "vidi", "link": "https://stackoverflow.com/users/1593986/vidi"}, "edited": false, "score": 0, "creation_date": 1490964176, "post_id": 43127003, "comment_id": 73358955, "body": "I changed the type of <code>transact</code>. There is no way otherwise."}, {"owner": {"reputation": 1722, "user_id": 1593986, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/8b55a5d33dee71102db716c72e166974?s=128&d=identicon&r=PG", "display_name": "vidi", "link": "https://stackoverflow.com/users/1593986/vidi"}, "edited": false, "score": 0, "creation_date": 1490975126, "post_id": 43127003, "comment_id": 73366747, "body": "I didn&#39;t see that. Indeed, with the type changed it compiles"}], "tags": [], "owner": {"reputation": 24509, "user_id": 6863749, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/UyoQv.jpg?s=128&g=1", "display_name": "Li-yao Xia", "link": "https://stackoverflow.com/users/6863749/li-yao-xia"}, "is_accepted": true, "score": 2, "last_activity_date": 1490976078, "last_edit_date": 1490976078, "creation_date": 1490902992, "answer_id": 43127003, "question_id": 43126203, "link": "https://stackoverflow.com/questions/43126203/how-to-write-a-dsl-based-on-free-monad/43127003#43127003", "title": "How to write a DSL based on free monad?", "body": "<p>Let's try to instantiate the body of the function progressively, keeping track of the expected type in the remaining hole: </p>\n\n<pre><code>transact :: Table i r a -&gt; Op i r -&gt; AppM (Maybe r)\ntransact (Table tb) op\n  = ??? :: AppM (Maybe r)\n  = liftF (??? :: AppF (Maybe r))\n  = liftF (DbTr (??? :: DbTrF (Maybe r)))\n  = liftF (DbTr (tb op (??? :: Maybe r -&gt; Maybe r))\n</code></pre>\n\n<p>But we also have, from the type of <code>Table tb</code>, <code>tb :: Op i r -&gt; (Maybe r -&gt; a) -&gt; DbTrF a</code>. Therefore <code>a ~ Maybe r</code>, and we can just solve the hole above using <code>id</code>, with a small change on the type of <code>transact</code>.</p>\n\n<pre><code>transact :: Table i r (Maybe r) -&gt; Op i r -&gt; AppM (Maybe r)\ntransact (Table tb) op = liftF (DbTr (tb op id))\n</code></pre>\n"}], "owner": {"reputation": 1722, "user_id": 1593986, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/8b55a5d33dee71102db716c72e166974?s=128&d=identicon&r=PG", "display_name": "vidi", "link": "https://stackoverflow.com/users/1593986/vidi"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 557, "favorite_count": 0, "accepted_answer_id": 43127003, "answer_count": 1, "score": 0, "last_activity_date": 1614608795, "creation_date": 1490900107, "last_edit_date": 1614608795, "question_id": 43126203, "link": "https://stackoverflow.com/questions/43126203/how-to-write-a-dsl-based-on-free-monad", "title": "How to write a DSL based on free monad?", "body": "<p>I'm playing with free monads in Haskell and I got stuck with defining the functions that lift the functor constructors in the Free monad.</p>\n\n<p>I have the AppF functor as a sum of several functors, each representing an effect. One of these functors is DbTrF, representing db transactions effects.</p>\n\n<p>So my AppF is defined like this:</p>\n\n<pre><code>data AppF a = \n  DbTr (DbTrF a)\n  | ... functors for the other types of effects\n  deriving (Functor)\n</code></pre>\n\n<p>my DbTrF is defined like this:</p>\n\n<pre><code>data Op i r =\n  Get i\n  | Insert i r\n  | Delete i\n  | Update i (r -&gt; r)\n\ndata DbTrF a =\n  UserTb (Op UserId UserData) (Maybe UserData -&gt; a)\n  | SessionTb (Op SessionId SessionData) (Maybe SessionData -&gt; a)\n  | ... here is the code for other tables\n  deriving(Functor)\n</code></pre>\n\n<p>then I would like to have a <strong>transact</strong> function </p>\n\n<pre><code>transact :: Table i r t-&gt; Op i r -&gt; AppM (Maybe r)\n</code></pre>\n\n<p>...which I would like to use like this:</p>\n\n<pre><code>transactExample = transact UserTb (Get someUserId)\n</code></pre>\n\n<p>For that I want to introduce the type Table as the function which takes an operation and returns a DbTrF value: </p>\n\n<pre><code>newtype Table i r a = Table {tbId :: Op i r -&gt; (Maybe r -&gt; a) -&gt; DbTrF a}\n</code></pre>\n\n<p>My attempt would be something like this:</p>\n\n<pre><code>transact (Table tb) op = liftF (DbTr (tb op ???))\n</code></pre>\n\n<p>but I'm not sure what to put instead of the question marks.</p>\n\n<p>Is this a good direction to follow or am I doing it wrong?</p>\n\n<p>Thanks!</p>\n"}, {"tags": ["haskell", "functional-programming", "agda", "idris"], "comments": [{"owner": {"reputation": 100185, "user_id": 3234959, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/93bb12ca0f93dfddb33880316f7e66c2?s=128&d=identicon&r=PG&f=1", "display_name": "chi", "link": "https://stackoverflow.com/users/3234959/chi"}, "edited": false, "score": 1, "creation_date": 1490893320, "post_id": 43123504, "comment_id": 73327311, "body": "This is an interesting question, but I think CS or TCS might be more appropriate sites for this."}], "answers": [{"comments": [{"owner": {"reputation": 44680, "user_id": 1031791, "user_type": "registered", "accept_rate": 54, "profile_image": "https://www.gravatar.com/avatar/fb710534fda446d2286074bb7692e65a?s=128&d=identicon&r=PG", "display_name": "MaiaVictor", "link": "https://stackoverflow.com/users/1031791/maiavictor"}, "edited": false, "score": 0, "creation_date": 1490894272, "post_id": 43124069, "comment_id": 73327884, "body": "Hmm so basically a term with type <code>Self x . type</code> has a copy of the term itself? Does that actually allow for Scott encodings? The paper seems to propose the solution to <code>O(n)</code> matching is Parigot encoding, not Scott... hmm..."}, {"owner": {"reputation": 100185, "user_id": 3234959, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/93bb12ca0f93dfddb33880316f7e66c2?s=128&d=identicon&r=PG&f=1", "display_name": "chi", "link": "https://stackoverflow.com/users/3234959/chi"}, "reply_to_user": {"reputation": 44680, "user_id": 1031791, "user_type": "registered", "accept_rate": 54, "profile_image": "https://www.gravatar.com/avatar/fb710534fda446d2286074bb7692e65a?s=128&d=identicon&r=PG", "display_name": "MaiaVictor", "link": "https://stackoverflow.com/users/1031791/maiavictor"}, "edited": false, "score": 0, "creation_date": 1490899166, "post_id": 43124069, "comment_id": 73330728, "body": "@MaiaVictor Roughly, yes. I don&#39;t know about how complex encodings are there -- I&#39;d need to read the paper more carefully."}], "tags": [], "owner": {"reputation": 100185, "user_id": 3234959, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/93bb12ca0f93dfddb33880316f7e66c2?s=128&d=identicon&r=PG&f=1", "display_name": "chi", "link": "https://stackoverflow.com/users/3234959/chi"}, "is_accepted": true, "score": 4, "last_activity_date": 1490893211, "creation_date": 1490893211, "answer_id": 43124069, "question_id": 43123504, "link": "https://stackoverflow.com/questions/43123504/what-is-the-exact-difference-between-fix-and-self-on-the-calculus-of-constructio/43124069#43124069", "title": "What is the exact difference between Fix and Self on the Calculus of Constructions?", "body": "<p>This is what I have understood after browsing the paper.</p>\n\n<p>A <code>Fix</code> type satisfies the typing equivalence (assuming equirecursive types)</p>\n\n<pre><code>G |- M : Fix x. t   &lt;=&gt;     G |- M : t{Fix x. t / x}\n</code></pre>\n\n<p>i.e. you can unfold the type over itself. Note how the term <code>M</code> does not play any role here. If using isorecursive types, <code>M</code> would get some isomorphism applied (e.g. a Haskell's <code>newtype</code> constructor), but it is not that important.</p>\n\n<p>Instead, Self types satisfy the following</p>\n\n<pre><code>G |- M : Self x. t   &lt;=&gt;     G |- M : t{M / x}\n</code></pre>\n\n<p>Now, <code>x</code> is not a type variable, but a term variable. The term gets \"moved\" inside the type. This is not a recursive type at all.</p>\n"}], "owner": {"reputation": 44680, "user_id": 1031791, "user_type": "registered", "accept_rate": 54, "profile_image": "https://www.gravatar.com/avatar/fb710534fda446d2286074bb7692e65a?s=128&d=identicon&r=PG", "display_name": "MaiaVictor", "link": "https://stackoverflow.com/users/1031791/maiavictor"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 260, "favorite_count": 2, "accepted_answer_id": 43124069, "answer_count": 1, "score": 6, "last_activity_date": 1490893211, "creation_date": 1490891378, "last_edit_date": 1490891745, "question_id": 43123504, "link": "https://stackoverflow.com/questions/43123504/what-is-the-exact-difference-between-fix-and-self-on-the-calculus-of-constructio", "title": "What is the exact difference between Fix and Self on the Calculus of Constructions?", "body": "<p>The <a href=\"https://fermat.github.io/document/papers/rta-tlca.pdf\" rel=\"noreferrer\">Self Types for Dependently Typed Lambda Encodings</a> paper (by Peng Fu and Aaron Stump) proposes self types, which are, supposedly, sufficient to encode the induction principle and <a href=\"https://en.wikipedia.org/wiki/Mogensen%E2%80%93Scott_encoding\" rel=\"noreferrer\">Scott-encoded</a> datatypes on the <a href=\"https://en.wikipedia.org/wiki/Calculus_of_constructions\" rel=\"noreferrer\">Calculus of Constructions</a>, without making the system inconsistent or introducing paradoxes. </p>\n\n<p>The notation of that paper is too heavy for me to fully understand how to implement it. </p>\n\n<p>What is, precisely, the main difference of Fix and Self? Or, in other words: in what points a naively implemented Fix should be restricted, so that it leaves no inconsistencies on the core calculus?</p>\n"}, {"tags": ["haskell", "exception-handling"], "comments": [{"owner": {"reputation": 94713, "user_id": 1139697, "user_type": "registered", "accept_rate": 86, "profile_image": "https://www.gravatar.com/avatar/5f136ddb684f39aaee1c028ee1950f6f?s=128&d=identicon&r=PG", "display_name": "Zeta", "link": "https://stackoverflow.com/users/1139697/zeta"}, "edited": false, "score": 0, "creation_date": 1490891619, "post_id": 43123454, "comment_id": 73326188, "body": "<code>if Exception e</code>?"}], "answers": [{"tags": [], "owner": {"reputation": 1247, "user_id": 3485629, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/640b2583577ec470ac273b27f78025d5?s=128&d=identicon&r=PG", "display_name": "basile-henry", "link": "https://stackoverflow.com/users/3485629/basile-henry"}, "is_accepted": true, "score": 0, "last_activity_date": 1490893579, "last_edit_date": 1490893579, "creation_date": 1490892953, "answer_id": 43124005, "question_id": 43123454, "link": "https://stackoverflow.com/questions/43123454/what-is-the-type-of-the-exception-exception-prelude-read-no-parse/43124005#43124005", "title": "What is the type of the exception &quot;Exception: Prelude.read: no parse&quot;", "body": "<p>The type of exception you get when doing <code>readLn</code> is <a href=\"https://hackage.haskell.org/package/base-4.9.1.0/docs/Prelude.html#t:IOError\" rel=\"nofollow noreferrer\"><code>IOError</code></a> which is just an alias for <a href=\"https://hackage.haskell.org/package/base-4.9.1.0/docs/Control-Exception-Base.html#t:IOException\" rel=\"nofollow noreferrer\"><code>IOException</code>.</a></p>\n\n<p>Here is how you could handle the error, I've added a type to <code>readLn</code> to enforce it to be read as an <code>Int</code>.</p>\n\n<pre class=\"lang-hs prettyprint-override\"><code>import           Control.Exception\n\nmain :: IO ()\nmain = catch takeNumber handleError\n\ntakeNumber :: IO ()\ntakeNumber = do\n  putStrLn \"Give me a number:\"\n  n &lt;- readLn :: IO Int\n  putStrLn (\"Success, your number is: \" ++ show n)\n\nhandleError :: IOError -&gt; IO ()\nhandleError e = do\n  putStrLn (\"Invalid number! Try again. The error was: \" ++ show e)\n  main\n</code></pre>\n"}], "owner": {"reputation": 177, "user_id": 6776511, "user_type": "registered", "accept_rate": 71, "profile_image": "https://www.gravatar.com/avatar/4567d009cb633351538c947fbe71a6d9?s=128&d=identicon&r=PG&f=1", "display_name": "&#201;owyn", "link": "https://stackoverflow.com/users/6776511/%c3%89owyn"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 88, "favorite_count": 0, "accepted_answer_id": 43124005, "answer_count": 1, "score": 1, "last_activity_date": 1490893579, "creation_date": 1490891244, "question_id": 43123454, "link": "https://stackoverflow.com/questions/43123454/what-is-the-type-of-the-exception-exception-prelude-read-no-parse", "title": "What is the type of the exception &quot;Exception: Prelude.read: no parse&quot;", "body": "<p>I'm trying catch the exception that happens when the user writes something different from than expected.</p>\n\n<p>I'm doing this:</p>\n\n<pre><code>main = do\n    {catch (take_number) fix_error;}\n    where\n        take_number = do\n        {\n            take_number \"Give me a number\";\n            n &lt;- readLn;\n        }\n        fix_error e = if Exception e then do\n            {\n                putStrLn \"Invalid number! Try again\";               \n                main;\n            }\n            else ioError e\n</code></pre>\n\n<p>I don't the exception type that I need catch in <code>Execption</code></p>\n"}, {"tags": ["haskell", "nfs", "haskell-stack", "cifs"], "comments": [{"owner": {"reputation": 500, "user_id": 5693521, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/ZkLP0.jpg?s=128&g=1", "display_name": "soulomoon", "link": "https://stackoverflow.com/users/5693521/soulomoon"}, "edited": false, "score": 0, "creation_date": 1540927443, "post_id": 43122126, "comment_id": 93041409, "body": "Have you solved it? It bugs me"}, {"owner": {"reputation": 11051, "user_id": 347165, "user_type": "registered", "accept_rate": 77, "profile_image": "https://www.gravatar.com/avatar/4881e74d5b966aca3f5945a974e8d91b?s=128&d=identicon&r=PG", "display_name": "Xodarap", "link": "https://stackoverflow.com/users/347165/xodarap"}, "reply_to_user": {"reputation": 500, "user_id": 5693521, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/ZkLP0.jpg?s=128&g=1", "display_name": "soulomoon", "link": "https://stackoverflow.com/users/5693521/soulomoon"}, "edited": false, "score": 0, "creation_date": 1540931970, "post_id": 43122126, "comment_id": 93043530, "body": "@soulomoon nope"}], "answers": [{"comments": [{"owner": {"reputation": 11051, "user_id": 347165, "user_type": "registered", "accept_rate": 77, "profile_image": "https://www.gravatar.com/avatar/4881e74d5b966aca3f5945a974e8d91b?s=128&d=identicon&r=PG", "display_name": "Xodarap", "link": "https://stackoverflow.com/users/347165/xodarap"}, "edited": false, "score": 0, "creation_date": 1496872171, "post_id": 43856052, "comment_id": 75845067, "body": "This doesn&#39;t seem to work for me. I symbolically linked it to <code>&#47;root&#47;aci</code> and still get the same error when building from there (Ubuntu)"}], "tags": [], "owner": {"reputation": 163, "user_id": 4615264, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/558e872bdaa42d1d43d31b5c92cb99c4?s=128&d=identicon&r=PG&f=1", "display_name": "Pavel Baravik", "link": "https://stackoverflow.com/users/4615264/pavel-baravik"}, "is_accepted": false, "score": 2, "last_activity_date": 1494272490, "creation_date": 1494272490, "answer_id": 43856052, "question_id": 43122126, "link": "https://stackoverflow.com/questions/43122126/cabal-copy-failed-during-stack-build-in-cifs-directory/43856052#43856052", "title": "&#39;cabal copy&#39; failed during `stack build` in cifs directory", "body": "<p>Looks like the issue is caused by the depth of the folder where the project lives (Windows 10, x64). From the moment the depth exceeds some threshold, described error appears. So try moving the project folder up in directories tree.</p>\n"}], "owner": {"reputation": 11051, "user_id": 347165, "user_type": "registered", "accept_rate": 77, "profile_image": "https://www.gravatar.com/avatar/4881e74d5b966aca3f5945a974e8d91b?s=128&d=identicon&r=PG", "display_name": "Xodarap", "link": "https://stackoverflow.com/users/347165/xodarap"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 568, "favorite_count": 0, "answer_count": 1, "score": 7, "last_activity_date": 1494272490, "creation_date": 1490887620, "last_edit_date": 1490887926, "question_id": 43122126, "link": "https://stackoverflow.com/questions/43122126/cabal-copy-failed-during-stack-build-in-cifs-directory", "title": "&#39;cabal copy&#39; failed during `stack build` in cifs directory", "body": "<p>I'm following <a href=\"https://docs.haskellstack.org/en/stable/GUIDE/#downloading-and-installation\" rel=\"noreferrer\">these instructions</a>. I successfully did <code>stack new</code> and <code>stack setup</code> but <code>stack build</code> fails.</p>\n\n<p>I found a <a href=\"https://github.com/commercialhaskell/stack/issues/2500\" rel=\"noreferrer\">git issue</a> that this may be due to extra files listed in the cabal file, but removing them didn't fix the issue (and I'm just using the <code>new-template</code> without any changes). I am on Ubuntu 14.04 and installed stack using the script. Is there anything else I can look into?</p>\n\n<p>It appears that this might be due to me trying to build inside of a cifs directory. Is there anything I can do to handle this?</p>\n\n<pre><code># stack build\nehri-haskell-0.1.0.0: configure (lib + exe)\nConfiguring ehri-haskell-0.1.0.0...\nehri-haskell-0.1.0.0: build (lib + exe)\nPreprocessing library ehri-haskell-0.1.0.0...\nPreprocessing executable 'ehri-haskell-exe' for ehri-haskell-0.1.0.0...\nehri-haskell-0.1.0.0: copy/register\nInstalling library in\n/mnt/docs/RubymineProjects/ehri-haskell/.stack-work/install/x86_64-linux/lts-8.6/8.0.2/lib/x86_64-linux-ghc-8.0.2/ehri-haskell-0.1.0.0-Kh3VLZPfbij7EgcL22QBMN\nInstalling executable(s) in\n/mnt/docs/RubymineProjects/ehri-haskell/.stack-work/install/x86_64-linux/lts-8.6/8.0.2/bin\n/mnt/docs/RubymineProjects/ehri-haskell/.stack-work/install/x86_64-linux/lts-8.6/8.0.2/bin/.copyFile5965166491189641421.tmp:\ncopyFile: does not exist (Host is down)\n'cabal copy' failed.  Error message:\n\n--  While building package ehri-haskell-0.1.0.0 using:\n      /root/.stack/setup-exe-cache/x86_64-linux/Cabal-simple_mPHDZzAJ_1.24.2.0_ghc-8.0.2 --builddir=.stack-work/dist/x86_64-linux/Cabal-1.24.2.0 copy\n    Process exited with code: ExitFailure 1\n\nOne possible cause of this issue is:\n* No module named \"Main\". The 'main-is' source file should usually have a header indicating that it's a 'Main' module.\n\n# stack --version\nVersion 1.4.0, Git revision e714f1dd3fade19496d91bd6a017e435a96a6bcd (4640 commits) x86_64 hpack-0.17.0\n</code></pre>\n"}, {"tags": ["haskell", "fold"], "comments": [{"owner": {"reputation": 51584, "user_id": 839246, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/9b0573c2b936b12828dd1e4cc04206dc?s=128&d=identicon&r=PG&f=1", "display_name": "bheklilr", "link": "https://stackoverflow.com/users/839246/bheklilr"}, "edited": false, "score": 0, "creation_date": 1490882357, "post_id": 43119882, "comment_id": 73319280, "body": "A fold will repeatably apply the given function to individual elements, with the previous result as one of the inputs.  There will be an order to this, it essentially turns your structure into a flat sequence.  Think about how you want to do this for your data structure.  What order do you want to apply the function in?  Essentially what I&#39;m asking is how can you turn <code>Stem a</code> into <code>[a]</code>?  At which point you don&#39;t need to write your own fold, you can use the built-in one for lists."}, {"owner": {"reputation": 247, "user_id": 3746816, "user_type": "registered", "accept_rate": 89, "profile_image": "https://www.gravatar.com/avatar/30722dac9f0fb2f4d3c743c0dc6d1d5d?s=128&d=identicon&r=PG&f=1", "display_name": "Liably", "link": "https://stackoverflow.com/users/3746816/liably"}, "reply_to_user": {"reputation": 51584, "user_id": 839246, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/9b0573c2b936b12828dd1e4cc04206dc?s=128&d=identicon&r=PG&f=1", "display_name": "bheklilr", "link": "https://stackoverflow.com/users/839246/bheklilr"}, "edited": false, "score": 0, "creation_date": 1490882523, "post_id": 43119882, "comment_id": 73319415, "body": "I know I could make use of the inbuilt ones but the book I&#39;m working through suggested I try one of these exercises, so I know it is possible but I&#39;m having trouble figuring it out. (And unfortunately it doesn&#39;t come with the answers for this one )"}, {"owner": {"reputation": 100185, "user_id": 3234959, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/93bb12ca0f93dfddb33880316f7e66c2?s=128&d=identicon&r=PG&f=1", "display_name": "chi", "link": "https://stackoverflow.com/users/3234959/chi"}, "edited": false, "score": 0, "creation_date": 1490882957, "post_id": 43119882, "comment_id": 73319761, "body": "<code>(x -&gt; u -&gt; u)</code> looks wrong to me, are you sure you don&#39;t want <code>(x -&gt; x -&gt; u)</code> instead? I would expect this: <code>foldTree :: (x -&gt; x -&gt; u) -&gt; (x -&gt; u) -&gt; Stem x -&gt; u</code>"}, {"owner": {"reputation": 247, "user_id": 3746816, "user_type": "registered", "accept_rate": 89, "profile_image": "https://www.gravatar.com/avatar/30722dac9f0fb2f4d3c743c0dc6d1d5d?s=128&d=identicon&r=PG&f=1", "display_name": "Liably", "link": "https://stackoverflow.com/users/3746816/liably"}, "edited": false, "score": 0, "creation_date": 1490883169, "post_id": 43119882, "comment_id": 73319917, "body": "I&#39;m sorry chi, but I don&#39;t understand how you came to that conclusion, would d you mind possibly explaining how how / why you think that?"}, {"owner": {"reputation": 100185, "user_id": 3234959, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/93bb12ca0f93dfddb33880316f7e66c2?s=128&d=identicon&r=PG&f=1", "display_name": "chi", "link": "https://stackoverflow.com/users/3234959/chi"}, "edited": false, "score": 0, "creation_date": 1490883281, "post_id": 43119882, "comment_id": 73320000, "body": "This question is now closed as a duplicate, but the tree in the duplicate question uses a different tree type (with data in the internal nodes instead of in the leaves). This changes the type of the <code>fold</code> function a bit, but the essence of the solution is the same."}, {"owner": {"reputation": 37219, "user_id": 1523776, "user_type": "moderator", "accept_rate": 87, "profile_image": "https://www.gravatar.com/avatar/b3e0b5c8e42a8c38009ef2d969f8dabb?s=128&d=identicon&r=PG", "display_name": "Benjamin Hodgson", "link": "https://stackoverflow.com/users/1523776/benjamin-hodgson"}, "reply_to_user": {"reputation": 100185, "user_id": 3234959, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/93bb12ca0f93dfddb33880316f7e66c2?s=128&d=identicon&r=PG&f=1", "display_name": "chi", "link": "https://stackoverflow.com/users/3234959/chi"}, "edited": false, "score": 0, "creation_date": 1490883331, "post_id": 43119882, "comment_id": 73320045, "body": "@chi oh, good point. I can re-open the question, but as you say it is nonetheless very similar in essence. What do you think?"}, {"owner": {"reputation": 51584, "user_id": 839246, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/9b0573c2b936b12828dd1e4cc04206dc?s=128&d=identicon&r=PG&f=1", "display_name": "bheklilr", "link": "https://stackoverflow.com/users/839246/bheklilr"}, "reply_to_user": {"reputation": 37219, "user_id": 1523776, "user_type": "moderator", "accept_rate": 87, "profile_image": "https://www.gravatar.com/avatar/b3e0b5c8e42a8c38009ef2d969f8dabb?s=128&d=identicon&r=PG", "display_name": "Benjamin Hodgson", "link": "https://stackoverflow.com/users/1523776/benjamin-hodgson"}, "edited": false, "score": 0, "creation_date": 1490883398, "post_id": 43119882, "comment_id": 73320095, "body": "Your question is definitely a duplicate as marked by @BenjaminHodgson, but in case you don&#39;t find the answer you&#39;re looking for in the linked question I had one mostly written up already that you can find <a href=\"https://gist.github.com/anonymous/f0537497faeeb775392eee79fdd9a9f7\" rel=\"nofollow noreferrer\">here</a>"}, {"owner": {"reputation": 247, "user_id": 3746816, "user_type": "registered", "accept_rate": 89, "profile_image": "https://www.gravatar.com/avatar/30722dac9f0fb2f4d3c743c0dc6d1d5d?s=128&d=identicon&r=PG&f=1", "display_name": "Liably", "link": "https://stackoverflow.com/users/3746816/liably"}, "reply_to_user": {"reputation": 37219, "user_id": 1523776, "user_type": "moderator", "accept_rate": 87, "profile_image": "https://www.gravatar.com/avatar/b3e0b5c8e42a8c38009ef2d969f8dabb?s=128&d=identicon&r=PG", "display_name": "Benjamin Hodgson", "link": "https://stackoverflow.com/users/1523776/benjamin-hodgson"}, "edited": false, "score": 0, "creation_date": 1490883491, "post_id": 43119882, "comment_id": 73320164, "body": "Thank you Bheklilr, @BenjaminHodgson I may not have a vote but surely this isn&#39;t an &quot;exact duplicate&quot; do to the difference in tree type as chi mentioned."}, {"owner": {"reputation": 100185, "user_id": 3234959, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/93bb12ca0f93dfddb33880316f7e66c2?s=128&d=identicon&r=PG&f=1", "display_name": "chi", "link": "https://stackoverflow.com/users/3234959/chi"}, "edited": false, "score": 0, "creation_date": 1490883574, "post_id": 43119882, "comment_id": 73320228, "body": "There&#39;s a general rule for folds: each constructor becomes a fold argument. Roughly, if the constructor has type, say <code>K :: T a -&gt; A -&gt; B -&gt; a -&gt; T a</code> then the corresponding argument has type <code>(u -&gt; A -&gt; A -&gt; a -&gt; u)</code> -- each <code>T a</code> is replaced by <code>u</code>, and other types are left as they are, where <code>u</code> is the final return type of <code>fold</code>."}, {"owner": {"reputation": 37219, "user_id": 1523776, "user_type": "moderator", "accept_rate": 87, "profile_image": "https://www.gravatar.com/avatar/b3e0b5c8e42a8c38009ef2d969f8dabb?s=128&d=identicon&r=PG", "display_name": "Benjamin Hodgson", "link": "https://stackoverflow.com/users/1523776/benjamin-hodgson"}, "reply_to_user": {"reputation": 100185, "user_id": 3234959, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/93bb12ca0f93dfddb33880316f7e66c2?s=128&d=identicon&r=PG&f=1", "display_name": "chi", "link": "https://stackoverflow.com/users/3234959/chi"}, "edited": false, "score": 0, "creation_date": 1490883623, "post_id": 43119882, "comment_id": 73320274, "body": "@chi You&#39;re talking about catamorphisms. I think the questioneer wanted a crush, ie a monoidal accumulation, ie a <code>Foldable.foldr</code>."}, {"owner": {"reputation": 100185, "user_id": 3234959, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/93bb12ca0f93dfddb33880316f7e66c2?s=128&d=identicon&r=PG&f=1", "display_name": "chi", "link": "https://stackoverflow.com/users/3234959/chi"}, "reply_to_user": {"reputation": 37219, "user_id": 1523776, "user_type": "moderator", "accept_rate": 87, "profile_image": "https://www.gravatar.com/avatar/b3e0b5c8e42a8c38009ef2d969f8dabb?s=128&d=identicon&r=PG", "display_name": "Benjamin Hodgson", "link": "https://stackoverflow.com/users/1523776/benjamin-hodgson"}, "edited": false, "score": 0, "creation_date": 1490883773, "post_id": 43119882, "comment_id": 73320405, "body": "@BenjaminHodgson I&#39;m unsure. We are probably so used to see catas that we put them in the &quot;seen-one-seen-all&quot; basket. For a beginner, however, relatively minor differences could be significant obstacles."}, {"owner": {"reputation": 100185, "user_id": 3234959, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/93bb12ca0f93dfddb33880316f7e66c2?s=128&d=identicon&r=PG&f=1", "display_name": "chi", "link": "https://stackoverflow.com/users/3234959/chi"}, "reply_to_user": {"reputation": 37219, "user_id": 1523776, "user_type": "moderator", "accept_rate": 87, "profile_image": "https://www.gravatar.com/avatar/b3e0b5c8e42a8c38009ef2d969f8dabb?s=128&d=identicon&r=PG", "display_name": "Benjamin Hodgson", "link": "https://stackoverflow.com/users/1523776/benjamin-hodgson"}, "edited": false, "score": 0, "creation_date": 1490883942, "post_id": 43119882, "comment_id": 73320569, "body": "@BenjaminHodgson Ahh! I see! I was mislead by the OP when he said &quot;like <code>foldr</code>&quot;. To the OP: there&#39;s a chance that I was speaking of the &quot;other&quot; fold (I <i>really</i> wish that <code>Foldable</code> was named something else!), which might not what you want. So, feel free to ignore what I said :-/"}, {"owner": {"reputation": 247, "user_id": 3746816, "user_type": "registered", "accept_rate": 89, "profile_image": "https://www.gravatar.com/avatar/30722dac9f0fb2f4d3c743c0dc6d1d5d?s=128&d=identicon&r=PG&f=1", "display_name": "Liably", "link": "https://stackoverflow.com/users/3746816/liably"}, "reply_to_user": {"reputation": 37219, "user_id": 1523776, "user_type": "moderator", "accept_rate": 87, "profile_image": "https://www.gravatar.com/avatar/b3e0b5c8e42a8c38009ef2d969f8dabb?s=128&d=identicon&r=PG", "display_name": "Benjamin Hodgson", "link": "https://stackoverflow.com/users/1523776/benjamin-hodgson"}, "edited": false, "score": 0, "creation_date": 1490884589, "post_id": 43119882, "comment_id": 73321146, "body": "So @BenjaminHodgson, What am I to do, that question you marked as duplicate really does not help me. Yes someone who is experienced in Haskell may be able to see the differences but as Chi says I&#39;m new to this so I&#39;m really struggling here to understand what I need to do. It&#39;s even harder when you close the question and point me to one which isn&#39;t &quot;an exact duplicate&quot;"}, {"owner": {"reputation": 37219, "user_id": 1523776, "user_type": "moderator", "accept_rate": 87, "profile_image": "https://www.gravatar.com/avatar/b3e0b5c8e42a8c38009ef2d969f8dabb?s=128&d=identicon&r=PG", "display_name": "Benjamin Hodgson", "link": "https://stackoverflow.com/users/1523776/benjamin-hodgson"}, "edited": false, "score": 0, "creation_date": 1490885860, "post_id": 43119882, "comment_id": 73322197, "body": "@Liably Reopened. For posterity here is the question I originally thought was a dupe: <a href=\"http://stackoverflow.com/questions/39180630/fold-tree-function\">stackoverflow.com/questions/39180630/fold-tree-function</a>"}, {"owner": {"reputation": 247, "user_id": 3746816, "user_type": "registered", "accept_rate": 89, "profile_image": "https://www.gravatar.com/avatar/30722dac9f0fb2f4d3c743c0dc6d1d5d?s=128&d=identicon&r=PG&f=1", "display_name": "Liably", "link": "https://stackoverflow.com/users/3746816/liably"}, "reply_to_user": {"reputation": 51584, "user_id": 839246, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/9b0573c2b936b12828dd1e4cc04206dc?s=128&d=identicon&r=PG&f=1", "display_name": "bheklilr", "link": "https://stackoverflow.com/users/839246/bheklilr"}, "edited": false, "score": 0, "creation_date": 1490887590, "post_id": 43119882, "comment_id": 73323440, "body": "Thank you, @bheklilr if you wish to paste your answer you provided in our chat I&#39;ll accept it. Thank you"}], "answers": [{"comments": [{"owner": {"reputation": 42094, "user_id": 828361, "user_type": "registered", "accept_rate": 44, "profile_image": "https://www.gravatar.com/avatar/6a82397672dcc1fca31c32508ef0798b?s=128&d=identicon&r=PG", "display_name": "pigworker", "link": "https://stackoverflow.com/users/828361/pigworker"}, "edited": false, "score": 1, "creation_date": 1490918174, "post_id": 43122636, "comment_id": 73338821, "body": "Double check your left-to-right orientation. The question requests <code>foldr</code>. This solution delivers neither <code>foldl</code> nor <code>foldr</code>. But the edit distance is small."}], "tags": [], "owner": {"reputation": 51584, "user_id": 839246, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/9b0573c2b936b12828dd1e4cc04206dc?s=128&d=identicon&r=PG&f=1", "display_name": "bheklilr", "link": "https://stackoverflow.com/users/839246/bheklilr"}, "is_accepted": true, "score": 2, "last_activity_date": 1490889041, "creation_date": 1490889041, "answer_id": 43122636, "question_id": 43119882, "link": "https://stackoverflow.com/questions/43119882/creating-a-custom-fold-function-for-custom-tree/43122636#43122636", "title": "Creating a Custom Fold Function for Custom Tree", "body": "<p>Work on the simple, specific cases first, and then extend the logic to the general cases.  You have the easy one, for <code>Leaf</code>:</p>\n\n<pre><code>foldTree f a (Leaf o) = f o a\n</code></pre>\n\n<p>Then think about what you want to happen where there's a <code>Node</code> with only two <code>Leaf</code>s:</p>\n\n<pre><code>foldTree f a (Node (Leaf x) (Leaf y)) = _\n</code></pre>\n\n<p>Here we know that <code>f</code> will have to be applied twice, but in what order?  Let's just start with the <code>Leaf</code> in the first slot of <code>Node</code>:</p>\n\n<pre><code>foldTree f a (Node (Leaf x) (Leaf y)) = _ (f x a)\n</code></pre>\n\n<p>I've left the hole (<code>_</code>) in the expression because GHC will actually tell you what type of thing needs to go there when you try to compile.  In this case, it'll say that you need something of type <code>u -&gt; u</code> since <code>f x a :: u</code>.  Well, we know that <code>f :: x -&gt; u -&gt; u</code>, so we can write</p>\n\n<pre><code>foldTree f a (Node (Leaf x) (Leaf y)) = f _ (f x a)\n</code></pre>\n\n<p>Now the only thing that can fill this hole is <code>y</code> from the right leaf, so</p>\n\n<pre><code>foldTree f a (Node (Leaf x) (Leaf y)) = f y (f x a)\n</code></pre>\n\n<p>But we know that <code>f x a</code> is the same as <code>foldTree f a (Leaf x)</code>, so we can substitute that in:</p>\n\n<pre><code>foldTree f a (Node (Leaf x) (Leaf y)) = f y (foldTree f a (Leaf x))\n</code></pre>\n\n<p>Then replace <code>Leaf x</code> with just a single variable:</p>\n\n<pre><code>foldTree f a (Node left (Leaf y)) = f y (foldTree f a left)\n</code></pre>\n\n<p>If you squint your eyes and look closely, you'll see the same pattern a second time.  Just do a quick substitution</p>\n\n<pre><code>foldTree f a (Node left (Leaf y)) = f y a'\n  where a' = foldTree f a left\n</code></pre>\n\n<p>Now you can do the substitution</p>\n\n<pre><code>foldTree f a (Node left right) = foldTree f a' right\n  where a' = foldTree f a left\n</code></pre>\n\n<p>And the whole definition is</p>\n\n<pre><code>foldTree f a (Leaf x) = f x a\nfoldTree f a (Node left right) = foldTree f (foldTree f a left) right\n</code></pre>\n"}], "owner": {"reputation": 247, "user_id": 3746816, "user_type": "registered", "accept_rate": 89, "profile_image": "https://www.gravatar.com/avatar/30722dac9f0fb2f4d3c743c0dc6d1d5d?s=128&d=identicon&r=PG&f=1", "display_name": "Liably", "link": "https://stackoverflow.com/users/3746816/liably"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 542, "favorite_count": 0, "accepted_answer_id": 43122636, "answer_count": 1, "score": 1, "last_activity_date": 1490889041, "creation_date": 1490881851, "last_edit_date": 1490886502, "question_id": 43119882, "link": "https://stackoverflow.com/questions/43119882/creating-a-custom-fold-function-for-custom-tree", "title": "Creating a Custom Fold Function for Custom Tree", "body": "<p>I'm attempting to create my own fold function which I can then use on my custom tree.</p>\n\n<p>My Tree is simple like so:</p>\n\n<pre><code>data Stem a = Node (Stem a) (Stem a) | Leaf a\n</code></pre>\n\n<p>I want to be able to build a <code>foldTree</code> function which works much in the same way as <code>foldr</code> would.</p>\n\n<p>I've manage to get it to work for when <code>n=1</code> or just a <code>leaf</code> with the following</p>\n\n<pre><code>foldTree :: (x -&gt; u -&gt; u) -&gt; u -&gt; Stem x -&gt; u\nfoldTree f a (Leaf o) = f o a\n</code></pre>\n\n<p>But I can't seem to work out the next line (IE for when there are nodes and leafs), I understand I need to recursively call foldTree but I'm not sure how I can do it. I've tried the following but I'm not having much luck. </p>\n\n<pre><code>foldTree f a (Node l r) = f a (foldTree f a l) (foldTree f a r)\n</code></pre>\n\n<p>This doesn't work as I know my parameters are <code>x -&gt; u  -&gt; u</code> and so I've got one too many parameters. Although this is where I am stuck I'm not sure how to traverse both paths correctly.</p>\n\n<p>So all together I have</p>\n\n<pre><code>foldTree :: (x -&gt; u -&gt; u) -&gt; u -&gt; Stem x -&gt; u\nfoldTree f a (Leaf o) = f o a\nfoldTree f a (Node l r) = f a (foldTree f a l) (foldTree f a r) &lt;-- Not working\n</code></pre>\n\n<p>How can I update this second line (or possibly something else in the method to get it to work?</p>\n\n<p>Thanks for the help!</p>\n"}, {"tags": ["parsing", "haskell", "heap-memory", "tail-recursion", "parsec"], "comments": [{"owner": {"reputation": 24028, "user_id": 383200, "user_type": "registered", "accept_rate": 60, "profile_image": "https://www.gravatar.com/avatar/a9dc722f936cb1059adaae4fe39c07f0?s=128&d=identicon&r=PG", "display_name": "Carl", "link": "https://stackoverflow.com/users/383200/carl"}, "edited": false, "score": 3, "creation_date": 1490880564, "post_id": 43119278, "comment_id": 73317851, "body": "Tail recursion isn&#39;t necessary or sufficient for haskell code to run in constant space."}, {"owner": {"reputation": 3128, "user_id": 3040129, "user_type": "registered", "accept_rate": 86, "profile_image": "https://i.stack.imgur.com/TcwLC.png?s=128&g=1", "display_name": "illabout", "link": "https://stackoverflow.com/users/3040129/illabout"}, "reply_to_user": {"reputation": 24028, "user_id": 383200, "user_type": "registered", "accept_rate": 60, "profile_image": "https://www.gravatar.com/avatar/a9dc722f936cb1059adaae4fe39c07f0?s=128&d=identicon&r=PG", "display_name": "Carl", "link": "https://stackoverflow.com/users/383200/carl"}, "edited": false, "score": 1, "creation_date": 1490880654, "post_id": 43119278, "comment_id": 73317938, "body": "@Carl That&#39;s interesting, thanks.  Would you be able to add an answer explaining it?  Or maybe point me to a paper or blog post explaining it?"}], "owner": {"reputation": 3128, "user_id": 3040129, "user_type": "registered", "accept_rate": 86, "profile_image": "https://i.stack.imgur.com/TcwLC.png?s=128&g=1", "display_name": "illabout", "link": "https://stackoverflow.com/users/3040129/illabout"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 111, "favorite_count": 1, "answer_count": 0, "score": 4, "last_activity_date": 1490880352, "creation_date": 1490880352, "last_edit_date": 1495535458, "question_id": 43119278, "link": "https://stackoverflow.com/questions/43119278/how-to-tell-whether-parsec-parser-uses-constant-heap-space-in-haskell", "title": "how to tell whether Parsec parser uses constant heap space in Haskell", "body": "<p>In a <a href=\"https://stackoverflow.com/questions/43092461/heap-usage-for-cps-vs-non-cps-parsers-in-haskells-parsec\">recent question</a>, I asked about the following\n<a href=\"https://hackage.haskell.org/package/parsec\" rel=\"nofollow noreferrer\">parsec</a> parser:</p>\n\n<pre><code>manyLength\n  :: forall s u m a. ParsecT s u m a -&gt; ParsecT s u m Int\nmanyLength p = go 0\n  where\n    go :: Int -&gt; ParsecT s u m Int\n    go !i = (p *&gt; go (i + 1)) &lt;|&gt; pure i\n</code></pre>\n\n<p>This function is similar to <a href=\"https://hackage.haskell.org/package/parsec-3.1.11/docs/Text-Parsec-Prim.html#v:many\" rel=\"nofollow noreferrer\"><code>many</code></a>.  However, instead of returning <code>[a]</code>, it\nreturns the number of times it was able to successfully run <code>p</code>.</p>\n\n<p>This works well, except for one problem.  It doesn't run in constant heap\nspace.</p>\n\n<p>In the linked question, <a href=\"https://stackoverflow.com/a/43094097/3040129\">Li-yao\nXia</a> gives an alternative way of\nwriting <code>manyLength</code> that uses constant heap space:</p>\n\n<pre><code>manyLengthConstantHeap\n  :: forall s u m a. ParsecT s u m a -&gt; ParsecT s u m Int\nmanyLengthConstantHeap p = go 0\n  where\n    go :: Int -&gt; ParsecT s u m Int\n    go !i =\n      ((p *&gt; pure True) &lt;|&gt; pure False) &gt;&gt;=\n        \\success -&gt; if success then go (i+1) else pure i\n</code></pre>\n\n<p>This is a significant improvement, but I don't understand why\n<code>manyLengthConstantHeap</code> uses constant heap space, while my original <code>manyLength</code> doesn't.</p>\n\n<p>If you inline <code>(&lt;|&gt;)</code> in <code>manyLength</code>, it looks somewhat like this:</p>\n\n<pre><code>manyLengthInline\n  :: forall s u m a. Monad m =&gt; ParsecT s u m a -&gt; ParsecT s u m Int\nmanyLengthInline p = go 0\n  where\n    go :: Int -&gt; ParsecT s u m Int\n    go !i =\n      ParsecT $ \\s cok cerr eok eerr -&gt;\n        let meerr :: ParserError -&gt; m b\n            meerr err =\n              let neok :: Int -&gt; State s u -&gt; ParserError -&gt; m b\n                  neok y s' err' = eok y s' (mergeError err err')\n                  neerr :: ParserError -&gt; m b\n                  neerr err' = eerr $ mergeError err err'\n              in unParser (pure i) s cok cerr neok neerr\n        in unParser (p *&gt; go (i + 1)) s cok cerr eok meerr\n</code></pre>\n\n<p>If you inline <code>(&gt;&gt;=)</code> in <code>manyLengthConstantHeap</code>, it looks somewhat like this:</p>\n\n<pre><code>manyLengthConstantHeapInline\n  :: forall s u m a. Monad m =&gt; ParsecT s u m a -&gt; ParsecT s u m Int\nmanyLengthConstantHeapInline p = go 0\n  where\n    go :: Int -&gt; ParsecT s u m Int\n    go !i =\n      ParsecT $ \\s cok cerr eok eerr -&gt;\n        let mcok :: Bool -&gt; State s u -&gt; ParserError -&gt; m b\n            mcok success s' err =\n                let peok :: Int -&gt; State s u -&gt; ParserError -&gt; m b\n                    peok int s'' err' = cok int s'' (mergeError err err')\n                    peerr :: ParserError -&gt; m b\n                    peerr err' = cerr (mergeError err err')\n                in unParser\n                    (if success then go (i + 1) else pure i)\n                    s'\n                    cok\n                    cerr\n                    peok\n                    peerr\n            meok :: Bool -&gt; State s u -&gt; ParserError -&gt; m b\n            meok success s' err =\n                let peok :: Int -&gt; State s u -&gt; ParserError -&gt; m b\n                    peok int s'' err' = eok int s'' (mergeError err err')\n                    peerr :: ParserError -&gt; m b\n                    peerr err' = eerr (mergeError err err')\n                in unParser\n                    (if success then go (i + 1) else pure i)\n                    s'\n                    cok\n                    pcerr\n                    peok\n                    peerr\n        in unParser ((p *&gt; pure True) &lt;|&gt; pure False) s mcok cerr meok eerr\n</code></pre>\n\n<p>Here is the ParsecT constructor for completeness:</p>\n\n<pre><code>newtype ParsecT s u m a = ParsecT\n  { unParser\n      :: forall b .\n         State s u\n      -&gt; (a -&gt; State s u -&gt; ParseError -&gt; m b) -- consumed ok\n      -&gt; (ParseError -&gt; m b)                   -- consumed err\n      -&gt; (a -&gt; State s u -&gt; ParseError -&gt; m b) -- empty ok\n      -&gt; (ParseError -&gt; m b)                   -- empty err\n      -&gt; m b\n  }\n</code></pre>\n\n<hr>\n\n<p>Why does <code>manyLengthConstantHeap</code> run with constant heap space, while\n<code>manyLength</code> does not?  It doesn't look like the recursive call to <code>go</code> is in\nthe tail-call position for either <code>manyLengthConstantHeap</code> or <code>manyLength</code>.</p>\n\n<p>When writing parsec parsers in the future, how can I <em>know the space\nrequirements for a given parser</em>?  How did Li-yao Xia know that\n<code>manyLengthConstantHeap</code> would be okay?</p>\n\n<p>I don't feel like I have any confidence in predicting which parsers will use a\nlot of memory on a large input.</p>\n\n<p>Is there an easy way to figure out whether a given function will be\ntail-recursive in Haskell without running it?  Or better yet, without compiling\nit?</p>\n"}, {"tags": ["scala", "haskell", "typeclass", "existential-type"], "answers": [{"comments": [{"owner": {"reputation": 329, "user_id": 3183129, "user_type": "registered", "accept_rate": 75, "profile_image": "https://i.stack.imgur.com/VxaBO.jpg?s=128&g=1", "display_name": "C\u0103lin", "link": "https://stackoverflow.com/users/3183129/c%c4%83lin"}, "edited": false, "score": 0, "creation_date": 1490879438, "post_id": 43118300, "comment_id": 73316911, "body": "Thanks!  I updated my top post, please take a look.  The only thing that I still don&#39;t like in the new approach is that I had to drop the implicit parameter as you pointed out, but I have to explicitly specify <i>exprInstance</i> each time.  Is there any way I could avoid that?  Thank you!"}, {"owner": {"reputation": 26162, "user_id": 1596545, "user_type": "registered", "accept_rate": 99, "profile_image": "https://www.gravatar.com/avatar/f0b6a45e63d51bc49612282891c49526?s=128&d=identicon&r=PG&f=1", "display_name": "flavian", "link": "https://stackoverflow.com/users/1596545/flavian"}, "reply_to_user": {"reputation": 329, "user_id": 3183129, "user_type": "registered", "accept_rate": 75, "profile_image": "https://i.stack.imgur.com/VxaBO.jpg?s=128&g=1", "display_name": "C\u0103lin", "link": "https://stackoverflow.com/users/3183129/c%c4%83lin"}, "edited": false, "score": 0, "creation_date": 1490879744, "post_id": 43118300, "comment_id": 73317179, "body": "@C\u0103linCruceru I&#39;m afraid I don&#39;t have more time on my hands, but I&#39;d spend some time learning the ropes and the common patterns."}, {"owner": {"reputation": 329, "user_id": 3183129, "user_type": "registered", "accept_rate": 75, "profile_image": "https://i.stack.imgur.com/VxaBO.jpg?s=128&g=1", "display_name": "C\u0103lin", "link": "https://stackoverflow.com/users/3183129/c%c4%83lin"}, "edited": false, "score": 0, "creation_date": 1490879762, "post_id": 43118300, "comment_id": 73317192, "body": "I guess I could just make another function, let&#39;s call it <code>evaluate</code> and place it at the top, instead of making the <code>Expr</code> trait an instance of <code>Eval</code>.  And in the implementation of all overridden <code>eval</code>s I would recursively call <code>evaluate</code>."}], "tags": [], "owner": {"reputation": 26162, "user_id": 1596545, "user_type": "registered", "accept_rate": 99, "profile_image": "https://www.gravatar.com/avatar/f0b6a45e63d51bc49612282891c49526?s=128&d=identicon&r=PG&f=1", "display_name": "flavian", "link": "https://stackoverflow.com/users/1596545/flavian"}, "is_accepted": true, "score": 3, "last_activity_date": 1490877957, "creation_date": 1490877957, "answer_id": 43118300, "question_id": 43117678, "link": "https://stackoverflow.com/questions/43117678/how-to-express-this-existential-type-from-haskell-in-scala/43118300#43118300", "title": "How to express this existential type from Haskell in Scala?", "body": "<p>Your problem is that you are using an extractor (<code>unapply</code>), but neglecting the fact that implicits are not by default exposed as part of <code>unapply</code>.</p>\n\n<p>So this line:</p>\n\n<pre><code>def eval(expr: Exp) = expr match { case Expr(e, ev) =&gt; ev.eval(e) }\n</code></pre>\n\n<p>There is no <code>case Expr(e, ev)</code>, only <code>case Expr(e)</code>, because only <code>e</code> is exposed. Either write a custom extractor or find a different approach.</p>\n\n<p>Scala does offer existential types of the form:</p>\n\n<pre><code>Expr[T] forSome { type T})\n</code></pre>\n\n<p>That has a shorthand type notation available: <code>Expr[_]</code></p>\n\n<p>Your code has a few more issues though:</p>\n\n<p>If you define an <code>implicit</code> on <code>eval</code>, all implementors must implement an <code>eval</code> function with that particular signature, you can't override <code>eval</code> with an implementation that doesn't contain the implicit in the signature like you do in.</p>\n\n<pre><code> implicit val baseExprInstance = new Eval[BaseExpr] {\n    def eval(baseExpr: BaseExpr)(implicit e: Eval[Exp]): Int =\n      baseExpr match {\n        case Const(c)      =&gt; c\n        case Add(lhs, rhs) =&gt; e.eval(lhs) + e.eval(rhs)\n        case Mul(lhs, rhs) =&gt; e.eval(lhs) + e.eval(rhs)\n      }\n  }\n</code></pre>\n\n<p>Next up you are going to need to either make <code>T</code> on <code>Expr</code> contravariant or make <code>SubExpr</code> also extend <code>Exp</code>, you have a problem here:</p>\n\n<pre><code>  // instance Eval SubExp where\n  //   eval (Sub a b) = eval a - eval b\n  implicit val subExprInstance = new Eval[SubExpr] {\n    def eval(subExpr: SubExpr)(implicit e: Eval[SubExpr]): Int =\n      e.eval(subExpr.lhs) - e.eval(subExpr.rhs)\n  }\n</code></pre>\n\n<p>If you will try to match the type signature, <code>implicit e: Eval[SubExpr]</code> can eval types that are <code>T &gt;: SubExpr</code>, but what you require is a lower <code>Exp</code> implicit for <code>Eval</code>.</p>\n"}], "owner": {"reputation": 329, "user_id": 3183129, "user_type": "registered", "accept_rate": 75, "profile_image": "https://i.stack.imgur.com/VxaBO.jpg?s=128&g=1", "display_name": "C\u0103lin", "link": "https://stackoverflow.com/users/3183129/c%c4%83lin"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 82, "favorite_count": 0, "accepted_answer_id": 43118300, "answer_count": 1, "score": 0, "last_activity_date": 1490879337, "creation_date": 1490876321, "last_edit_date": 1495540459, "question_id": 43117678, "link": "https://stackoverflow.com/questions/43117678/how-to-express-this-existential-type-from-haskell-in-scala", "title": "How to express this existential type from Haskell in Scala?", "body": "<p>I am trying to adapt <a href=\"https://stackoverflow.com/a/6896401/3183129\">this Haskell implementation</a> of the type classes based solution of the <a href=\"https://en.wikipedia.org/wiki/Expression_problem\" rel=\"nofollow noreferrer\">expression problem</a> to Scala.  My current code is below.  I'm having problems expressing the existential type <code>Exp</code> in Scala.</p>\n\n<p>How can I achieve the same thing?</p>\n\n<pre class=\"lang-scala prettyprint-override\"><code>object ExpressionProblem {\n\n  // class Eval a where\n  //   eval :: a -&gt; Int\n  trait Eval[A] {\n    def eval(expr: A): Int\n  }\n\n  // data Exp = forall t. Eval t =&gt; Expr t\n  sealed abstract class Exp\n  case class Expr[T](val e: T)(implicit ev: Eval[T]) extends Exp\n\n  // instance Eval Exp where\n  //   eval (Expr e) = eval e\n  implicit val exprInstance = new Eval[Exp] {\n    def eval(expr: Exp) = expr match { case Expr(e, ev) =&gt; ev.eval(e) }\n  }\n  //                                   ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n  //                                       here is the problem\n\n  // data BaseExp = Const Int | Add Exp Exp | Mul Exp Exp\n  sealed abstract class BaseExpr\n  case class Const(c: Int) extends BaseExpr\n  case class Add(lhs: Exp, rhs: Exp) extends BaseExpr\n  case class Mul(lhs: Exp, rhs: Exp) extends BaseExpr\n\n  // instance Eval BaseExp where\n  //   eval (Const n) = n\n  //   eval (Add a b) = eval a + eval b\n  //   eval (Mul a b) = eval a * eval b\n  implicit val baseExprInstance = new Eval[BaseExpr] {\n    def eval(baseExpr: BaseExpr)(implicit e: Eval[Exp]): Int =\n      baseExpr match {\n        case Const(c)      =&gt; c\n        case Add(lhs, rhs) =&gt; e.eval(lhs) + e.eval(rhs)\n        case Mul(lhs, rhs) =&gt; e.eval(lhs) + e.eval(rhs)\n      }\n  }\n\n  // TODO: Is there an easier way to make all of them implicitly convertible?\n  //\n  // The following doesn't seem to work:\n  //\n  //    implicit def baseExprToExp[T &lt;: BaseExpr](t: T): Exp = Expr[BaseExpr](t)\n  //\n  implicit def constToExp(c: Const): Exp = Expr[BaseExpr](c)\n  implicit def addToExp(a: Add): Exp = Expr[BaseExpr](a)\n  implicit def mulToExp(m: Mul): Exp = Expr[BaseExpr](m)\n\n  ///////////////////////////////////////////////\n  // Possibly in another module/lib.\n  ///////////////////////////////////////////////\n\n  // data SubExp = Sub Exp Exp\n  case class SubExpr(val lhs: Exp, val rhs: Exp)\n\n  // instance Eval SubExp where\n  //   eval (Sub a b) = eval a - eval b\n  implicit val subExprInstance = new Eval[SubExpr] {\n    def eval(subExpr: SubExpr)(implicit e: Eval[Exp]): Int =\n      e.eval(subExpr.lhs) - e.eval(subExpr.rhs)\n  }\n\n  // Make it implicitly convertible to Exp.\n  implicit def subExprToExp(s: SubExpr): Exp = Expr(s)\n\n  object Test {\n    val exprs: List[Exp] = List(\n      SubExpr(Const(10), Const(3)),\n      Add(Const(1), Const(1))\n    )\n  }\n\n} // ExpressionProblem\n</code></pre>\n\n<p><strong>EDIT</strong>:  Meanwhile I found this <a href=\"https://stackoverflow.com/a/7214438/3183129\">relevant StackOverflow</a> answer and I adapted my code to it.</p>\n\n<pre><code>import scala.language.implicitConversions\n\nobject ExpressionProblem {\n\n  // class Eval a where\n  //   eval :: a -&gt; Int\n  trait Eval[A] {\n    def eval(expr: A): Int\n  }\n\n  //////////////////////////////////////////\n  // HERE'S THE MAGIC\n  //\n  // data Expr = forall t. Eval t =&gt; Expr t\n  trait Expr {\n    type T\n    val t: T\n    val evalInst: Eval[T]\n  }\n\n  object Expr {\n    def apply[T0 : Eval](t0: T0) = new Expr {\n      type T = T0\n      val t = t0\n      val evalInst = implicitly[Eval[T]]\n    }\n  }\n\n  // Default boxing is needed\n  implicit def box[T : Eval](t: T) = Expr(t)\n\n  // instance Eval Expr where\n  //   eval (Expr e) = eval e\n  implicit object exprInstance extends Eval[Expr] {\n    def eval(expr: Expr) = expr.evalInst.eval(expr.t)\n  }\n\n  // data BaseExpr = Const Int | Add Expr Expr | Mul Expr Exp\n  sealed abstract class BaseExpr\n  case class Const(c: Int) extends BaseExpr\n  case class Add(lhs: Expr, rhs: Expr) extends BaseExpr\n  case class Mul(lhs: Expr, rhs: Expr) extends BaseExpr\n\n  // instance Eval BaseExpr where\n  //   eval (Const n) = n\n  //   eval (Add a b) = eval a + eval b\n  //   eval (Mul a b) = eval a * eval b\n  implicit object baseExprInstance extends Eval[BaseExpr] {\n    def eval(baseExpr: BaseExpr): Int =\n      baseExpr match {\n        case Const(c)      =&gt; c\n        case Add(lhs, rhs) =&gt; exprInstance.eval(lhs) + exprInstance.eval(rhs)\n        case Mul(lhs, rhs) =&gt; exprInstance.eval(lhs) + exprInstance.eval(rhs)\n      }\n  }\n\n  // Implicit conversions for all base expressions\n  implicit def baseExprToExpr[T &lt;: BaseExpr](t: T): Expr = Expr[BaseExpr](t)\n\n  ///////////////////////////////////////////////\n  // Possibly somewhere else (in the future).\n  ///////////////////////////////////////////////\n\n  // data SubExpr = Sub Expr Exp\n  case class SubExpr(val lhs: Expr, val rhs: Expr)\n\n  // instance Eval SubExpr where\n  //   eval (Sub a b) = eval a - eval b\n  implicit object subExprInstance extends Eval[SubExpr] {\n    def eval(subExpr: SubExpr): Int =\n      exprInstance.eval(subExpr.lhs) - exprInstance.eval(subExpr.rhs)\n  }\n\n  // NOTE: We don't have to provide an implicit conversion to Expr as the\n  // default `box` one suffices.\n\n  object Test {\n    val exprs: List[Expr] = List(\n      SubExpr(Const(10), Const(3)),\n      Add(Const(1), Const(1))\n    )\n  }\n\n} // ExpressionProblem\n</code></pre>\n"}, {"tags": ["haskell"], "comments": [{"owner": {"reputation": 100185, "user_id": 3234959, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/93bb12ca0f93dfddb33880316f7e66c2?s=128&d=identicon&r=PG&f=1", "display_name": "chi", "link": "https://stackoverflow.com/users/3234959/chi"}, "edited": false, "score": 0, "creation_date": 1490884334, "post_id": 43117432, "comment_id": 73320932, "body": "Minor style comment: <code>Bot (val : values bot) (low bot) (high bot)</code> can also be written <code>bot{values = val : values bot}</code> using the &quot;record update&quot; syntax."}, {"owner": {"reputation": 100185, "user_id": 3234959, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/93bb12ca0f93dfddb33880316f7e66c2?s=128&d=identicon&r=PG&f=1", "display_name": "chi", "link": "https://stackoverflow.com/users/3234959/chi"}, "edited": false, "score": 0, "creation_date": 1490884466, "post_id": 43117432, "comment_id": 73321042, "body": "Also, check out <a href=\"http://hackage.haskell.org/package/containers-0.5.10.1/docs/Data-Map-Lazy.html#v:update\" rel=\"nofollow noreferrer\"><code>Map.update</code></a> and related functions to modify a map."}], "answers": [{"comments": [{"owner": {"reputation": 31, "user_id": 5785152, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/9fe617e4e25bfeb73235c00412e3b3eb?s=128&d=identicon&r=PG&f=1", "display_name": "Miguel Boland", "link": "https://stackoverflow.com/users/5785152/miguel-boland"}, "edited": false, "score": 0, "creation_date": 1490878439, "post_id": 43118203, "comment_id": 73316038, "body": "Well spotted, thanks Libby! I&#39;ll be updating my code to use a few more subtypes, and will make sure I don&#39;t mess up like this again!"}], "tags": [], "owner": {"reputation": 1227, "user_id": 5053374, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/efe57f0998df065470ff42c938f781cf?s=128&d=identicon&r=PG", "display_name": "Libby", "link": "https://stackoverflow.com/users/5053374/libby"}, "is_accepted": true, "score": 6, "last_activity_date": 1490877708, "creation_date": 1490877708, "answer_id": 43118203, "question_id": 43117432, "link": "https://stackoverflow.com/questions/43117432/cannot-cons-to-a-list-in-haskell-data-structure/43118203#43118203", "title": "Cannot cons to a list in Haskell data structure", "body": "<p>I think you mean <code>bot = getBot botInd oldM</code> not <code>bot = getBot val oldM</code>.</p>\n\n<p>The compiler could have caught this, except you're using <code>Int</code> as the type of both the value you want to put in and how you're looking up the bot. </p>\n\n<p>Maybe if you pass in the whole <code>Bot</code> to <code>giveValue</code> instead, then you could be sure that you're giving the right value to the right bot?</p>\n\n<p>You could also wrap the \"bot id\" in a newtype, like <code>newtype BotId = BotId { unBotId :: Int }</code>. <code>getBot</code> would take a <code>BotId</code>, and then ghc would've complained that you were passing in an integer instead of an id!</p>\n\n<p>Also, consider using <code>Maybe Int</code> instead of <code>Int</code> for <code>low</code> and <code>high</code>. The fact that you're using a <code>falseVal</code> is a big red flag that you should be using <code>Maybe</code> instead.</p>\n"}], "owner": {"reputation": 31, "user_id": 5785152, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/9fe617e4e25bfeb73235c00412e3b3eb?s=128&d=identicon&r=PG&f=1", "display_name": "Miguel Boland", "link": "https://stackoverflow.com/users/5785152/miguel-boland"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 75, "favorite_count": 0, "accepted_answer_id": 43118203, "answer_count": 1, "score": 0, "last_activity_date": 1563080932, "creation_date": 1490875627, "last_edit_date": 1563080932, "question_id": 43117432, "link": "https://stackoverflow.com/questions/43117432/cannot-cons-to-a-list-in-haskell-data-structure", "title": "Cannot cons to a list in Haskell data structure", "body": "<p>The code below has a data structure Bot which has a parameter values of type [Int]. The function giveValue retrieves the bot of a given index from a hashmap, adds a value to that bot's values parameter and returns the updated hashmap. However, it currently replaces the existing Int in values, rather than append to the array. Could someone explain to me why this is happening?</p>\n\n<pre><code>import Data.List.Split\nimport Data.List\nimport Data.Map (Map)\nimport qualified Data.Map.Strict as Map\n\ndata Bot = Bot {values :: [Int], low :: Int, high :: Int}\ninstance Show (Bot) where\n    show b = show (values b) ++ \" \" ++ show (low b) ++ \" \" ++ show (high b)\n\n\ngetBot :: Int -&gt; Map Int (Bot)-&gt; Bot\ngetBot i m\n    | (length bots == 1) = bots !! 0\n    | otherwise = Bot [] falseVal falseVal\n    where\n        falseVal = -1\n        bots = [b | (i2, b) &lt;- Map.toList m, i2==i]\n\n\ngiveValue :: Int -&gt; Int -&gt; Map Int (Bot) -&gt; Map Int (Bot)\ngiveValue botInd val oldM = newM\n    where\n        bot = getBot val oldM\n        newM = Map.insert botInd (Bot (val : values bot) (low bot) (high bot)) oldM\n\nmain = do\n    let bot = Bot [17] 3 4\n    let bots = Map.insert 0 bot (Map.empty)\n\n    print $ giveValue 0 61 bots  \n    -- Prints fromList [(0, [12] -1 -1)]\n</code></pre>\n"}, {"tags": ["haskell", "functor", "type-constructor"], "comments": [{"owner": {"reputation": 100185, "user_id": 3234959, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/93bb12ca0f93dfddb33880316f7e66c2?s=128&d=identicon&r=PG&f=1", "display_name": "chi", "link": "https://stackoverflow.com/users/3234959/chi"}, "edited": false, "score": 0, "creation_date": 1490869030, "post_id": 43113488, "comment_id": 73309356, "body": "No, it is not possible, unfortunately. If it were, for <code>f::a-&gt;b</code>, is the type of <code>fmap f (undefined::F a a)</code> equal to <code>F a b</code> or <code>F b a</code>? The usual workaround is to define a custom <code>newtype</code> as jd823592 does below."}, {"owner": {"reputation": 1259, "user_id": 7139373, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/00b75c9aba5294d9bcad49ea5d425d7b?s=128&d=identicon&r=PG&f=1", "display_name": "devxeq", "link": "https://stackoverflow.com/users/7139373/devxeq"}, "edited": false, "score": 0, "creation_date": 1490869797, "post_id": 43113488, "comment_id": 73309862, "body": "You can get the &#39;kind&#39; of a data type by entering <code>:k datatype</code> in ghci. This is what you get for Maybe, <code>Maybe :: * -&gt; *</code>. For a data type to be an instance of Functor, it has to be of kind <code>* -&gt; *</code>.  MyTypeconstructor is of kind <code>* -&gt; * -&gt; *</code>. If you do want to create a functor, wrap it in a different type.  <code>ProxyTypeConstructor b a = MyTypeconstructor a b</code>  And then have a way to convert between these two data types."}], "answers": [{"tags": [], "owner": {"reputation": 2231, "user_id": 1027321, "user_type": "registered", "accept_rate": 70, "profile_image": "https://i.stack.imgur.com/KkFZC.jpg?s=128&g=1", "display_name": "jakubdaniel", "link": "https://stackoverflow.com/users/1027321/jakubdaniel"}, "is_accepted": true, "score": 5, "last_activity_date": 1490870274, "last_edit_date": 1490870274, "creation_date": 1490866896, "answer_id": 43114055, "question_id": 43113488, "link": "https://stackoverflow.com/questions/43113488/how-to-make-a-type-constructor-part-of-the-functor-typeclass-if-it-has-more-than/43114055#43114055", "title": "How to make a Type-constructor part of the Functor typeclass if it has more than one Type-parameter?", "body": "<p>Suppose you have <code>data F a b = ...</code>, define</p>\n\n<pre><code>newtype Fx a = Fx { unFx :: F a X }\n</code></pre>\n\n<p>to partially apply <code>F</code> to <code>X</code> in the second argument. Now you can use</p>\n\n<pre><code>instance Functor Fx where\n    fmap f fa = ...\n</code></pre>\n\n<p>to define your instance for <code>F _ X</code>.</p>\n"}, {"tags": [], "owner": {"reputation": 153048, "user_id": 9204, "user_type": "registered", "accept_rate": 82, "profile_image": "https://www.gravatar.com/avatar/c79937a093ff9e963c563e22cd385f30?s=128&d=identicon&r=PG", "display_name": "Alexey Romanov", "link": "https://stackoverflow.com/users/9204/alexey-romanov"}, "is_accepted": false, "score": 2, "last_activity_date": 1490884996, "creation_date": 1490884996, "answer_id": 43121116, "question_id": 43113488, "link": "https://stackoverflow.com/questions/43113488/how-to-make-a-type-constructor-part-of-the-functor-typeclass-if-it-has-more-than/43121116#43121116", "title": "How to make a Type-constructor part of the Functor typeclass if it has more than one Type-parameter?", "body": "<p>More generally, you can write </p>\n\n<pre><code>newtype FlippedF a b = FlippedF { unFlip :: F b a } \n</code></pre>\n\n<p>and then </p>\n\n<pre><code>instance Functor (FlippedF argB)\n</code></pre>\n\n<p>Or even more generally,</p>\n\n<pre><code>newtype Flip f a b = Flip { unFlip :: f b a }\n\ninstance Functor (Flip F argB)\n</code></pre>\n\n<p><code>Flip</code> and many more type-level combinators are defined in e.g. <a href=\"http://hackage.haskell.org/package/TypeCompose-0.9.12/docs/Control-Compose.html#g:9\" rel=\"nofollow noreferrer\">http://hackage.haskell.org/package/TypeCompose-0.9.12/docs/Control-Compose.html#g:9</a> (and also <a href=\"http://hackage.haskell.org/package/bifunctors-5.4.1/docs/Data-Bifunctor-Flip.html#t:Flip\" rel=\"nofollow noreferrer\">http://hackage.haskell.org/package/bifunctors-5.4.1/docs/Data-Bifunctor-Flip.html#t:Flip</a>)</p>\n"}], "owner": {"reputation": 670, "user_id": 7781818, "user_type": "registered", "accept_rate": 80, "profile_image": "https://www.gravatar.com/avatar/13f5392f913a0f47fab3e6719bda4b08?s=128&d=identicon&r=PG&f=1", "display_name": "Chris", "link": "https://stackoverflow.com/users/7781818/chris"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 175, "favorite_count": 0, "accepted_answer_id": 43114055, "answer_count": 2, "score": 3, "last_activity_date": 1490884996, "creation_date": 1490865476, "question_id": 43113488, "link": "https://stackoverflow.com/questions/43113488/how-to-make-a-type-constructor-part-of-the-functor-typeclass-if-it-has-more-than", "title": "How to make a Type-constructor part of the Functor typeclass if it has more than one Type-parameter?", "body": "<p>I am trying to understand the way the Functor-Typeclass works in Haskell. If you have a function <code>f :: a -&gt; b -&gt; c</code> and you want to partially apply it to the <code>argB</code> to get a function that takes one argument, you can simply do: </p>\n\n<pre><code>f' :: a -&gt; c\nf' x = f x argB\n</code></pre>\n\n<p>and use that. Is it possible to get such behavior when making something part of the Functor-Typeclass with something like this:</p>\n\n<pre><code>instance Functor (MyTypeconstructor _ argB) where\n   fmap &lt;implementation of fmap&gt;\n</code></pre>\n\n<p>I know you can partially apply a Type-constructor to its first type-parameter (standart currying):</p>\n\n<pre><code>instance Functor (MyTypeconstructor argA) where\n   fmap &lt;implementation of fmap&gt;\n</code></pre>\n\n<p>but how can you partially apply it to its <code>second / third / all except one</code> type-parameter, if this is possible?</p>\n\n<p>thank you.</p>\n"}, {"tags": ["haskell", "haskell-stack"], "comments": [{"owner": {"reputation": 14781, "user_id": 630160, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/4445f21326af525a8ad19af7e3ae41a8?s=128&d=identicon&r=PG", "display_name": "epsilonhalbe", "link": "https://stackoverflow.com/users/630160/epsilonhalbe"}, "edited": false, "score": 1, "creation_date": 1490858922, "post_id": 43110766, "comment_id": 73302559, "body": "You can also delete the section about readme in your cabal file"}, {"owner": {"reputation": 3231, "user_id": 1013393, "user_type": "registered", "accept_rate": 60, "profile_image": "https://www.gravatar.com/avatar/7bca51e5ae3eb8dc24a98616b4e5d6fd?s=128&d=identicon&r=PG", "display_name": "sjakobi", "link": "https://stackoverflow.com/users/1013393/sjakobi"}, "edited": false, "score": 0, "creation_date": 1490874417, "post_id": 43110766, "comment_id": 73313051, "body": "I have created a PR to fix that warning: <a href=\"https://github.com/commercialhaskell/stack-templates/pull/101\" rel=\"nofollow noreferrer\">github.com/commercialhaskell/stack-templates/pull/101</a>"}], "answers": [{"comments": [{"owner": {"reputation": 25, "user_id": 7789669, "user_type": "registered", "profile_image": "https://lh6.googleusercontent.com/-BW7QHakeC0o/AAAAAAAAAAI/AAAAAAAAABE/nEezdhjsQUE/photo.jpg?sz=128", "display_name": "artur dinanmitt", "link": "https://stackoverflow.com/users/7789669/artur-dinanmitt"}, "edited": false, "score": 0, "creation_date": 1490857746, "post_id": 43110785, "comment_id": 73301833, "body": "Thank you for answer, Sibi."}, {"owner": {"reputation": 25, "user_id": 7789669, "user_type": "registered", "profile_image": "https://lh6.googleusercontent.com/-BW7QHakeC0o/AAAAAAAAAAI/AAAAAAAAABE/nEezdhjsQUE/photo.jpg?sz=128", "display_name": "artur dinanmitt", "link": "https://stackoverflow.com/users/7789669/artur-dinanmitt"}, "edited": false, "score": 0, "creation_date": 1490857762, "post_id": 43110785, "comment_id": 73301841, "body": "But i have to use Windows"}, {"owner": {"reputation": 43759, "user_id": 1651941, "user_type": "registered", "accept_rate": 97, "profile_image": "https://www.gravatar.com/avatar/a513bc1fa519d2fcf5e4e0d9b5500101?s=128&d=identicon&r=PG", "display_name": "Sibi", "link": "https://stackoverflow.com/users/1651941/sibi"}, "reply_to_user": {"reputation": 25, "user_id": 7789669, "user_type": "registered", "profile_image": "https://lh6.googleusercontent.com/-BW7QHakeC0o/AAAAAAAAAAI/AAAAAAAAABE/nEezdhjsQUE/photo.jpg?sz=128", "display_name": "artur dinanmitt", "link": "https://stackoverflow.com/users/7789669/artur-dinanmitt"}, "edited": false, "score": 0, "creation_date": 1490858002, "post_id": 43110785, "comment_id": 73301993, "body": "@arturdinanmitt Does this work on Windows: <code>copy NUL README.md</code> ?"}, {"owner": {"reputation": 25, "user_id": 7789669, "user_type": "registered", "profile_image": "https://lh6.googleusercontent.com/-BW7QHakeC0o/AAAAAAAAAAI/AAAAAAAAABE/nEezdhjsQUE/photo.jpg?sz=128", "display_name": "artur dinanmitt", "link": "https://stackoverflow.com/users/7789669/artur-dinanmitt"}, "edited": false, "score": 0, "creation_date": 1490858363, "post_id": 43110785, "comment_id": 73302210, "body": "Yes, it&#39;s work. But it cause this: Linking .stack-work\\dist\\ca59d0ab\\build\\pro-exe\\pro-exe.exe ... C:/Users/artur_1sf4rbk/AppData/Local/Programs/stack/x86_64-w&zwnj;&#8203;indows/ghc-8.0.2/min&zwnj;&#8203;gw/bin/ld.exe: cannot find -lHSpro-0.1.0.0-AZbCCAnOhQfJaZyKTc2UJL collect2.exe: error: ld returned 1 exit status <code>gcc.exe&#39; failed in phase </code>Linker&#39;. (Exit code: 1)"}, {"owner": {"reputation": 25, "user_id": 7789669, "user_type": "registered", "profile_image": "https://lh6.googleusercontent.com/-BW7QHakeC0o/AAAAAAAAAAI/AAAAAAAAABE/nEezdhjsQUE/photo.jpg?sz=128", "display_name": "artur dinanmitt", "link": "https://stackoverflow.com/users/7789669/artur-dinanmitt"}, "edited": false, "score": 0, "creation_date": 1490858402, "post_id": 43110785, "comment_id": 73302240, "body": "And have I always create REDME for myself?"}, {"owner": {"reputation": 14781, "user_id": 630160, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/4445f21326af525a8ad19af7e3ae41a8?s=128&d=identicon&r=PG", "display_name": "epsilonhalbe", "link": "https://stackoverflow.com/users/630160/epsilonhalbe"}, "edited": false, "score": 0, "creation_date": 1490859575, "post_id": 43110785, "comment_id": 73302982, "body": "For the linker error please create a new question. Do not forget to include the cabal file and your stack.yaml"}, {"owner": {"reputation": 43759, "user_id": 1651941, "user_type": "registered", "accept_rate": 97, "profile_image": "https://www.gravatar.com/avatar/a513bc1fa519d2fcf5e4e0d9b5500101?s=128&d=identicon&r=PG", "display_name": "Sibi", "link": "https://stackoverflow.com/users/1651941/sibi"}, "reply_to_user": {"reputation": 25, "user_id": 7789669, "user_type": "registered", "profile_image": "https://lh6.googleusercontent.com/-BW7QHakeC0o/AAAAAAAAAAI/AAAAAAAAABE/nEezdhjsQUE/photo.jpg?sz=128", "display_name": "artur dinanmitt", "link": "https://stackoverflow.com/users/7789669/artur-dinanmitt"}, "edited": false, "score": 0, "creation_date": 1490861590, "post_id": 43110785, "comment_id": 73304181, "body": "@arturdinanmitt No, only once. Also as epsilonhalbe suggested, you can remove the entry from the cabal section."}, {"owner": {"reputation": 94713, "user_id": 1139697, "user_type": "registered", "accept_rate": 86, "profile_image": "https://www.gravatar.com/avatar/5f136ddb684f39aaee1c028ee1950f6f?s=128&d=identicon&r=PG", "display_name": "Zeta", "link": "https://stackoverflow.com/users/1139697/zeta"}, "edited": false, "score": 0, "creation_date": 1490862626, "post_id": 43110785, "comment_id": 73304798, "body": "A default README should be there if you use <code>stack new</code>."}], "tags": [], "owner": {"reputation": 43759, "user_id": 1651941, "user_type": "registered", "accept_rate": 97, "profile_image": "https://www.gravatar.com/avatar/a513bc1fa519d2fcf5e4e0d9b5500101?s=128&d=identicon&r=PG", "display_name": "Sibi", "link": "https://stackoverflow.com/users/1651941/sibi"}, "is_accepted": true, "score": 1, "last_activity_date": 1490857482, "creation_date": 1490857482, "answer_id": 43110785, "question_id": 43110766, "link": "https://stackoverflow.com/questions/43110766/warning-file-listed-in-ass-cabal-file-does-not-exist-readme-md/43110785#43110785", "title": "Warning: File listed in ass.cabal file does not exist: README.md", "body": "<p>You don't have <code>README.md</code> in your project. Just create that file and the warning will go off:</p>\n\n<pre><code>$ touch README.md\n</code></pre>\n\n<p>Note that you have to create the file inside the project's folder.</p>\n"}], "owner": {"reputation": 25, "user_id": 7789669, "user_type": "registered", "profile_image": "https://lh6.googleusercontent.com/-BW7QHakeC0o/AAAAAAAAAAI/AAAAAAAAABE/nEezdhjsQUE/photo.jpg?sz=128", "display_name": "artur dinanmitt", "link": "https://stackoverflow.com/users/7789669/artur-dinanmitt"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 158, "favorite_count": 0, "accepted_answer_id": 43110785, "answer_count": 1, "score": 1, "last_activity_date": 1490857482, "creation_date": 1490857423, "question_id": 43110766, "link": "https://stackoverflow.com/questions/43110766/warning-file-listed-in-ass-cabal-file-does-not-exist-readme-md", "title": "Warning: File listed in ass.cabal file does not exist: README.md", "body": "<p>I've just started to learn haskell and I faced this proble while trying to         <strong>stack build</strong>.\nWhat's the way to solve it?\nThank you in advance.</p>\n"}, {"tags": ["scala", "haskell", "functional-programming"], "comments": [{"owner": {"reputation": 94553, "user_id": 775806, "user_type": "registered", "accept_rate": 96, "profile_image": "https://i.stack.imgur.com/XNd2C.png?s=128&g=1", "display_name": "n. &#39;pronouns&#39; m.", "link": "https://stackoverflow.com/users/775806/n-pronouns-m"}, "edited": false, "score": 0, "creation_date": 1490848111, "post_id": 43108537, "comment_id": 73297580, "body": "How do you write <i>any</i>  generic function that accepts an object and serialises it?"}], "answers": [{"tags": [], "owner": {"reputation": 11826, "user_id": 480674, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/fad9d486ce723011505e86c2136937ca?s=128&d=identicon&r=PG", "display_name": "pedrofurla", "link": "https://stackoverflow.com/users/480674/pedrofurla"}, "is_accepted": false, "score": 8, "last_activity_date": 1490888039, "last_edit_date": 1490888039, "creation_date": 1490849152, "answer_id": 43108752, "question_id": 43108537, "link": "https://stackoverflow.com/questions/43108537/how-to-define-typeclass-instance-for-higher-kinded-types-in-scala/43108752#43108752", "title": "How to define typeclass instance for higher kinded types in Scala?", "body": "<p>The thing is, you are using a existencial in <code>Serializer[List[_]]</code> effectively the only thing that an overriding method can accept then is <code>List[_]</code>. The way is to somehow provide a concrete type <code>List[T]</code> to the serializer. The trick:</p>\n\n<pre><code>scala&gt; :paste\n// Entering paste mode (ctrl-D to finish)\n// trait Serializer and the implicit object removed for brevity, the former was implemented with x.getBytes\n\nimplicit def listIsSerializable[T:Serializer]:Serializer[List[T]] = \n  new Serializer[List[T]] {\n    def toBytes(xs:List[T])=xs.map(implicitly[Serializer[T]].toBytes).toArray.flatten   \n  }\n\n// Exiting paste mode, now interpreting.\n\ndefined trait Serializer\ndefined object StringSerializer\nlistIsSerializable: [T](implicit evidence$1: Serializer[T])Serializer[List[T]]\n\nscala&gt; implicitly[Serializer[List[String]]].toBytes(List(\"A\",\"B\"))\nres0: Array[Byte] = Array(65, 66)\n</code></pre>\n"}], "owner": {"reputation": 261, "user_id": 3651032, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/2167a152448781d5a539d29ef1517e9a?s=128&d=identicon&r=PG&f=1", "display_name": "user50874", "link": "https://stackoverflow.com/users/3651032/user50874"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 192, "favorite_count": 0, "answer_count": 1, "score": 1, "last_activity_date": 1490888039, "creation_date": 1490847776, "question_id": 43108537, "link": "https://stackoverflow.com/questions/43108537/how-to-define-typeclass-instance-for-higher-kinded-types-in-scala", "title": "How to define typeclass instance for higher kinded types in Scala?", "body": "<p>I'm implementing a typeclass of serializable types in Scala. It's easy for simple types</p>\n\n<pre><code>trait Serializer[T] {\n  def toBytes(a: T): Array[Byte]\n}\n\nimplicit object StringSerializer extends Serializer[String] {\n    override def toBytes(x: String) = ...\n}\n\n// similar codes for other simple types\n</code></pre>\n\n<p>But I got stuck in defining an instance for higher kinded types like Option[T], List[T], etc. Naturally, List[T] is serializable only if T is serializable. But how to express the constraint in Scala? My unsuccessful try:</p>\n\n<pre><code>implicit object ListSerializer extends Serializer[List[_]] {\n  // won't compile\n  override def toBytes[T: Serializer](a: List[T]): Array[Byte] = ...\n}\n</code></pre>\n"}, {"tags": ["haskell", "exception-handling"], "comments": [{"owner": {"reputation": 14781, "user_id": 630160, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/4445f21326af525a8ad19af7e3ae41a8?s=128&d=identicon&r=PG", "display_name": "epsilonhalbe", "link": "https://stackoverflow.com/users/630160/epsilonhalbe"}, "edited": false, "score": 0, "creation_date": 1490858566, "post_id": 43106444, "comment_id": 73302328, "body": "I think if and the equals sign should switch positions\u200b"}], "answers": [{"tags": [], "owner": {"reputation": 48938, "user_id": 246886, "user_type": "registered", "accept_rate": 94, "profile_image": "https://www.gravatar.com/avatar/dd1ebaade6623fc538fb8af3338e730d?s=128&d=identicon&r=PG", "display_name": "Jon Purdy", "link": "https://stackoverflow.com/users/246886/jon-purdy"}, "is_accepted": true, "score": 1, "last_activity_date": 1490835053, "creation_date": 1490835053, "answer_id": 43106607, "question_id": 43106444, "link": "https://stackoverflow.com/questions/43106444/parse-error-on-input-if-in-catch-clause-for-readfile/43106607#43106607", "title": "parse error on input `if&#39; in catch clause for readFile", "body": "<p>You swapped <code>=</code> and <code>if</code> in the definition of <code>fix_error</code>.</p>\n\n<p>The syntax for a definition is:</p>\n\n<pre><code>name args = body\n</code></pre>\n\n<p>The syntax for an <code>if</code> expression is:</p>\n\n<pre><code>if condition then true_branch else false_branch\n</code></pre>\n\n<p>You simply need to combine these:</p>\n\n<pre><code>fix_error erro = if isDoesNotExistError erro\n               ----\n  then do\n    putStr \"Exception: file doesn't exist\"\n    ...\n  else ioError erro\n</code></pre>\n\n<p>Or use a guard:</p>\n\n<pre><code>fix_error erro\n  | isDoesNotExistError erro = do\n    putStr \"Exception: file doesn't exist\"\n    ...\n  | otherwise = ioError erro\n</code></pre>\n\n<p>I\u2019ve omitted the curly braces and semicolons, but you can include them if you prefer.</p>\n"}], "owner": {"reputation": 177, "user_id": 6776511, "user_type": "registered", "accept_rate": 71, "profile_image": "https://www.gravatar.com/avatar/4567d009cb633351538c947fbe71a6d9?s=128&d=identicon&r=PG&f=1", "display_name": "&#201;owyn", "link": "https://stackoverflow.com/users/6776511/%c3%89owyn"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 76, "favorite_count": 0, "accepted_answer_id": 43106607, "answer_count": 1, "score": 0, "last_activity_date": 1490835053, "creation_date": 1490833622, "question_id": 43106444, "link": "https://stackoverflow.com/questions/43106444/parse-error-on-input-if-in-catch-clause-for-readfile", "title": "parse error on input `if&#39; in catch clause for readFile", "body": "<p>I'm trying handling an exception when I read a file but I'm receiving the message </p>\n\n<blockquote>\n  <p>parse error on input `if'</p>\n</blockquote>\n\n<pre><code>readTxt = do\n            {catch (read_file) fix_error;}\n            where\n                read_file = do\n                {\n                    f &lt;- openFile \"file.txt\" ReadMode;\n                    content &lt;- hGetContents f;\n                    putStrLn content;\n                    hClose f;\n                }   \n                fix_error erro if = isDoesNotExistError erro\n                    then do\n                    {\n                        putStr \"Exception: file doesn't exists\";\n                        writeFile \"file.txt\" \"First Line\"\n                    }\n                else ioError erro \n</code></pre>\n\n<p>I read that when I have an <code>if</code> I need that the <code>then</code> and <code>else</code> clauses return the same type. I believe that I'm doing this, so I don't know why I'm receiving the error message</p>\n"}]