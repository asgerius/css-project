[{"tags": ["haskell"], "comments": [{"owner": {"reputation": 10378, "user_id": 2476735, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/39e9447bbc32246fcd23b76b5e946618?s=128&d=identicon&r=PG&f=1", "display_name": "David Young", "link": "https://stackoverflow.com/users/2476735/david-young"}, "edited": false, "score": 0, "creation_date": 1469039331, "post_id": 38487907, "comment_id": 64378126, "body": "Are you familiar with <a href=\"https://www.schoolofhaskell.com/school/to-infinity-and-beyond/pick-of-the-week/sum-types\" rel=\"nofollow noreferrer\">sum types</a>?"}, {"owner": {"reputation": 130, "user_id": 4069779, "user_type": "registered", "accept_rate": 60, "profile_image": "https://i.stack.imgur.com/ALMw9.jpg?s=128&g=1", "display_name": "Jeroen Bourgois", "link": "https://stackoverflow.com/users/4069779/jeroen-bourgois"}, "reply_to_user": {"reputation": 10378, "user_id": 2476735, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/39e9447bbc32246fcd23b76b5e946618?s=128&d=identicon&r=PG&f=1", "display_name": "David Young", "link": "https://stackoverflow.com/users/2476735/david-young"}, "edited": false, "score": 0, "creation_date": 1469039981, "post_id": 38487907, "comment_id": 64378474, "body": "No, I am readying the documentation right now, thank you! I could make it work with the update above and also with the suggestion below."}, {"owner": {"reputation": 37219, "user_id": 1523776, "user_type": "moderator", "accept_rate": 87, "profile_image": "https://www.gravatar.com/avatar/b3e0b5c8e42a8c38009ef2d969f8dabb?s=128&d=identicon&r=PG", "display_name": "Benjamin Hodgson", "link": "https://stackoverflow.com/users/1523776/benjamin-hodgson"}, "edited": false, "score": 0, "creation_date": 1469058053, "post_id": 38487907, "comment_id": 64386415, "body": "Perhaps this question would be better suited to <a href=\"http://codereview.stackexchange.com/\">Code Review</a>?"}, {"owner": {"reputation": 2690, "user_id": 3296811, "user_type": "registered", "accept_rate": 80, "profile_image": "https://i.stack.imgur.com/Lt27n.jpg?s=128&g=1", "display_name": "Quill", "link": "https://stackoverflow.com/users/3296811/quill"}, "edited": false, "score": 0, "creation_date": 1469059279, "post_id": 38487907, "comment_id": 64386668, "body": "This may be on-topic for Code Review if <b>a)</b> the code works <b>and b)</b> the code isn&#39;t hypothetical or incomplete in any way"}], "answers": [{"comments": [{"owner": {"reputation": 14582, "user_id": 2225384, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/f30b04ed4d0b3fc4bc791a28815f34ca?s=128&d=identicon&r=PG", "display_name": "Rein Henrichs", "link": "https://stackoverflow.com/users/2225384/rein-henrichs"}, "edited": false, "score": 0, "creation_date": 1469097136, "post_id": 38488148, "comment_id": 64402576, "body": "The braces on the right hand side of your functions are unnecessary, btw. E.g., <code>taskPrice t = price t * inHours t</code>"}, {"owner": {"reputation": 384463, "user_id": 1126841, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/fa05233b2357f8d11c22ef4cfc7bb85c?s=128&d=identicon&r=PG", "display_name": "chepner", "link": "https://stackoverflow.com/users/1126841/chepner"}, "edited": false, "score": 0, "creation_date": 1469125968, "post_id": 38488148, "comment_id": 64421064, "body": "I tend to overuse parentheses, mostly out of habit from when I couldn&#39;t remember exactly how currying and function application interacted with infix operators."}], "tags": [], "owner": {"reputation": 384463, "user_id": 1126841, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/fa05233b2357f8d11c22ef4cfc7bb85c?s=128&d=identicon&r=PG", "display_name": "chepner", "link": "https://stackoverflow.com/users/1126841/chepner"}, "is_accepted": true, "score": 4, "last_activity_date": 1469039429, "last_edit_date": 1469039429, "creation_date": 1469039225, "answer_id": 38488148, "question_id": 38487907, "link": "https://stackoverflow.com/questions/38487907/function-pattern-match-depending-on-data-argument/38488148#38488148", "title": "Function pattern match depending on data argument", "body": "<p>You don't really need an explicit fold here. You just need a combination of <code>map</code> and <code>sum</code>.</p>\n\n<pre><code>inHours :: Task -&gt; Double\ninHours (Task amt _ \"hours\") = amt\ninHours (Task amt _ \"days\") = 8 * amt\n\ntaskPrice :: Task -&gt; Double\ntaskPrice t = (price t) * (inHours t)\n\ncalcPrice :: [Task] -&gt; Double\ncalcPrice = sum . (map taskPrice)\n\ncalcInvoiceHours :: [Task] -&gt; Double\ncalcInvoiceHours = sum . (map inHours)\n</code></pre>\n"}, {"comments": [{"owner": {"reputation": 130, "user_id": 4069779, "user_type": "registered", "accept_rate": 60, "profile_image": "https://i.stack.imgur.com/ALMw9.jpg?s=128&g=1", "display_name": "Jeroen Bourgois", "link": "https://stackoverflow.com/users/4069779/jeroen-bourgois"}, "edited": false, "score": 0, "creation_date": 1469125396, "post_id": 38492521, "comment_id": 64420758, "body": "Thank you for your answer! This is a bit much for me to grasp at the time, but I will keep it in mind while growing in the Haskell mindset/syntax"}], "tags": [], "owner": {"reputation": 37219, "user_id": 1523776, "user_type": "moderator", "accept_rate": 87, "profile_image": "https://www.gravatar.com/avatar/b3e0b5c8e42a8c38009ef2d969f8dabb?s=128&d=identicon&r=PG", "display_name": "Benjamin Hodgson", "link": "https://stackoverflow.com/users/1523776/benjamin-hodgson"}, "is_accepted": false, "score": 1, "last_activity_date": 1469058168, "last_edit_date": 1469058168, "creation_date": 1469057829, "answer_id": 38492521, "question_id": 38487907, "link": "https://stackoverflow.com/questions/38487907/function-pattern-match-depending-on-data-argument/38492521#38492521", "title": "Function pattern match depending on data argument", "body": "<p>You've left the treatment of <em>time</em> as a largely implicit part of your data model. I would model timespans as a self-contained abstract data type, with functions to calculate new timespans and to project various components of the timespan. This allows you to perform calculations in a canonical unit of your choice (I've chosen \"ticks\") in a manner that is opaque to code which uses the <code>TimeSpan</code> type.</p>\n\n<pre><code>-- Make the type abstract, so users can't directly manipulate ticks,\n-- by keeping the TimeSpan constructor private to this module\nnewtype TimeSpan = TimeSpan Integer\n\n-- you could pack these two into a Monoid instance if you like, or use GeneralizedNewtypeDeriving and get it without writing any code\nzero :: TimeSpan\nzero = TimeSpan 0\nplus :: TimeSpan -&gt; TimeSpan -&gt; TimeSpan\nplus (TimeSpan x) (TimeSpan y) = TimeSpan (x + y)\n\nticksPerHour :: Fractional a =&gt; a\nticksPerHour = 10000 * 1000 * 60 * 60  -- 10,000 ticks per millisecond\n\nfromHours :: Float -&gt; TimeSpan\nfromHours = TimeSpan . hoursToTicks\n    where hoursToTicks x = round (x * ticksPerHour)\n\ntoHours :: TimeSpan -&gt; Float\ntoHours (TimeSpan x) = ticksToHours x\n    where ticksToHours x = fromIntegral x / ticksPerHour\n\n-- similar functions to measure the timespan in days, etc\n</code></pre>\n\n<p>This is just how you'd do it in an object-oriented language. <a href=\"https://msdn.microsoft.com/en-us/library/system.timespan(v=vs.110).aspx\" rel=\"nofollow\">C#'s <code>TimeSpan</code></a> is a <code>struct</code> (don't get me started on how bad C# structs are at data abstraction) which internally counts a <em>private</em> number of ticks, with public methods to convert a <code>TimeSpan</code> into various other measuring schemes such as hours or days. It's also more-or-less <a href=\"http://downloads.haskell.org/~ghc/8.0.1/docs/html/libraries/time-1.6.0.1/Data-Time-Clock.html#t:DiffTime\" rel=\"nofollow\">what you'll find in Haskell's <code>Data.Time.Clock</code></a> module.</p>\n\n<p>Now you can use the abstract <code>TimeSpan</code> type directly in your code, delegating to your <code>TimeSpan</code> library to do the adding and subtracting in a units-independent manner.</p>\n\n<pre><code>data Task = Task {\n    taskLength :: TimeSpan,\n    taskPrice :: Money  -- omitted: a similar treatment to build an abstract Money type\n}\n\ntotalTime :: [Task] -&gt; TimeSpan\ntotalTime = foldl' plus zero . map taskLength\n\ntotalTimeHours :: [Task] -&gt; Float\ntotalTimeHours = toHours . totalTime\n</code></pre>\n"}], "owner": {"reputation": 130, "user_id": 4069779, "user_type": "registered", "accept_rate": 60, "profile_image": "https://i.stack.imgur.com/ALMw9.jpg?s=128&g=1", "display_name": "Jeroen Bourgois", "link": "https://stackoverflow.com/users/4069779/jeroen-bourgois"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 80, "favorite_count": 0, "accepted_answer_id": 38488148, "answer_count": 2, "score": 0, "last_activity_date": 1469058168, "creation_date": 1469038393, "last_edit_date": 1469039055, "question_id": 38487907, "link": "https://stackoverflow.com/questions/38487907/function-pattern-match-depending-on-data-argument", "title": "Function pattern match depending on data argument", "body": "<p>First of: sorry for the ambigous question title...\nSecond: I am a <em>complete</em> beginner...</p>\n\n<p>I have a very simple data type called Task. A Task had a price, an amount and a unit. The unit can be days or hours.</p>\n\n<p>I want to calculate the total amount and total price for a list of Tasks. For the price there is no issue, I multiply each price with the amount for the given task and it adds up. But for the amount I am stuck.</p>\n\n<p>I cannot easely fold a list of hours and days. Say I have a task with 1 hour and one with 1 day, both of them have an amount of 1, but the total should be in one unit. I chose 'hour' as the base unit.</p>\n\n<p>So to recap, this is my type:</p>\n\n<pre><code>-- data --\n\n-- the task is parsed from json, but I would like the `unit` type to be\n-- custom like `Hour | Day` instead of String. But that is an aeson issue?\ndata Task = {\n  amount :: Double,\n  price :: Double,\n  unit :: String\n}\n\n-- functions --\n\ntaskPrice :: Task -&gt; Double\ntaskPrice t = fromIntegral (price t) * amount t\n\ncalcPrice :: [Task] -&gt; Double\ncalcPrice [] = 0\ncalcPrice [x] = taskPrice x\ncalcPrice (x:xs) = foldl (\\acc x -&gt; acc + (taskPrice x)) (taskPrice x) xs\n\n-- this version will add days and hours like they are equal...\ncalcInvoiceHours :: [Task] -&gt; Double\ncalcInvoiceHours [] = 0\ncalcInvoiceHours [x] = amount x\ncalcInvoiceHours (x:xs) = foldl (\\acc x -&gt; acc + (amount x)) (amount x) xs\n</code></pre>\n\n<p>Every Task <em>knows</em> it's own type, but a switch case inside the pattern matching is not the way to go I guess... In some naive pseudo code I would write:</p>\n\n<pre><code>calcInvoiceHours :: [Task] -&gt; Double\ncalcInvoiceHours [] = 0\ncalcInvoiceHours [x -&gt; unit x === Hour] = amount x\ncalcInvoiceHours [x -&gt; unit x === Day] = (amount x) * 8 -- work 8 hours a day\ncalcInvoiceHours (x:xs) = foldl (\\acc x -&gt; acc + (amount x)) (amount x)\n</code></pre>\n\n<p>I <em>know</em> this is wrong, but I do not know how to do it. I might be running before I can walk here, but it seems like such a simple task (no pun intended).</p>\n\n<p>Thanks! </p>\n\n<p><strong>== UPDATE ==</strong></p>\n\n<p>I found a way! But if this is not the good way, I would be glad to hear how I can improve! Plus I am still searching to parse the strings 'hours' and 'days' to a concrete custome type Hour | Day from json.</p>\n\n<pre><code>taskHours :: Task -&gt; Double\ntaskHours (Task _ amount _ unit)\n  | unit == \"hours\" = amount\n  | otherwise = amount * 8\n\ncalcInvoiceHours :: [Task] -&gt; Double\ncalcInvoiceHours [] = 0\ncalcInvoiceHours [x] = taskHours x\ncalcInvoiceHours (x:xs) = foldl (\\acc x -&gt; acc + (taskHours x)) (taskHours x) xs\n</code></pre>\n"}, {"tags": ["haskell", "opengl", "textures", "glfw"], "comments": [{"owner": {"reputation": 574, "user_id": 1504029, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/96a8e68ffdcc9aca971108c6a989b74c?s=128&d=identicon&r=PG", "display_name": "Paul Visschers", "link": "https://stackoverflow.com/users/1504029/paul-visschers"}, "edited": false, "score": 0, "creation_date": 1469189344, "post_id": 38486100, "comment_id": 64446362, "body": "Where did you get <code>readFunction</code> from, what type is it and how is it defined? Also why the <code>unsafeCoerce</code>?"}, {"owner": {"reputation": 574, "user_id": 1504029, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/96a8e68ffdcc9aca971108c6a989b74c?s=128&d=identicon&r=PG", "display_name": "Paul Visschers", "link": "https://stackoverflow.com/users/1504029/paul-visschers"}, "edited": false, "score": 0, "creation_date": 1469190256, "post_id": 38486100, "comment_id": 64446920, "body": "Uh, I meant <code>readTexture</code> in my previous comment."}, {"owner": {"reputation": 71, "user_id": 6614616, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/837e04716b819d95cb0e68bae8ea3d6e?s=128&d=identicon&r=PG&f=1", "display_name": "user6614616", "link": "https://stackoverflow.com/users/6614616/user6614616"}, "reply_to_user": {"reputation": 574, "user_id": 1504029, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/96a8e68ffdcc9aca971108c6a989b74c?s=128&d=identicon&r=PG", "display_name": "Paul Visschers", "link": "https://stackoverflow.com/users/1504029/paul-visschers"}, "edited": false, "score": 0, "creation_date": 1469359458, "post_id": 38486100, "comment_id": 64493649, "body": "I got the readFunction from <a href=\"http://stackoverflow.com/questions/23540558/haskell-opengl-texture-glfw\">here</a>.  I think I added the <code>unsafeCoerce</code> because when compiling for Windows (using wine) it complained that there was two different types of textureobjects. I added <code>unsafeCoerce</code>, and have since come up with a better, safer, way of doing it. I forgot to remove <code>unsafeCoerce</code>, so thanks for pointing it out. I removed it, but I got the same result."}], "owner": {"reputation": 71, "user_id": 6614616, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/837e04716b819d95cb0e68bae8ea3d6e?s=128&d=identicon&r=PG&f=1", "display_name": "user6614616", "link": "https://stackoverflow.com/users/6614616/user6614616"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 152, "favorite_count": 1, "answer_count": 0, "score": 1, "last_activity_date": 1469561942, "creation_date": 1469032546, "last_edit_date": 1469561942, "question_id": 38486100, "link": "https://stackoverflow.com/questions/38486100/how-to-store-opengl-textureobjects-in-haskell", "title": "How to store OpenGL TextureObjects in haskell?", "body": "<p>I am currently trying to write a graphical application in haskell using OpenGL and GLFW-b. I am rather new to OpenGL, and I am having some problems displaying the TextureObjects. I have tried two ways of doing it.</p>\n\n<p>The first way I tried was to store the textures as an TextureObject, and then simply using it as an input argument to the render function (see below). However, this doesn't work, as \n<a href=\"http://i.stack.imgur.com/oVJTj.png\" rel=\"nofollow\">the texture objects simply appear as white squares.</a>\nI will also note that it probably took several second for the program to start, presumably because it loaded all the graphics.</p>\n\n<p>The second thing I tried was to store the textures as an IO TextureObject. <a href=\"http://i.stack.imgur.com/Fvh1k.png\" rel=\"nofollow\">This worked</a>\n, but it is very slow. It slows down to a few frames per second. I suspect this is because the textures need to be reloaded every time they are drawn. In order to test this, I renamed the textures while the program are running, and indeed the program crashed, confirming that it needs to reload the textures every iteration.</p>\n\n<p>The texture is loaded with the function</p>\n\n<pre><code>loadTexture' :: FilePath -&gt; IO TextureObject\nloadTexture' f = do\n    tex &lt;- either error id &lt;$&gt; readTexture f\n\n    textureFilter Texture2D $= ((Linear', Nothing), Linear')\n\n    return tex\n</code></pre>\n\n<p>and rendered with</p>\n\n<pre><code>renderTexture :: Area -&gt; Area -&gt; TextureObject -&gt; IO()\nrenderTexture window area tex =\n    let (x,x') = xRangeToGL window $ getXRange area\n        (y,y') = yRangeToGL window $ getYRange area\n\n     in do textureBinding Texture2D $= Just tex\n           renderPrimitive Quads $ do\n               col\n               txc 1 1 &gt;&gt; ver x' y'\n               txc 1 0 &gt;&gt; ver x' y\n               txc 0 0 &gt;&gt; ver x  y\n               txc 0 1 &gt;&gt; ver x  y'\n    where col     = color    (Color3 1.0 1.0 1.0 :: Color3    GLfloat)\n          ver x y = vertex   (Vertex2 x y        :: Vertex2   GLfloat)\n          txc u v = texCoord (TexCoord2 u v      :: TexCoord2 GLfloat)\n</code></pre>\n\n<p>The OpenGL settings are</p>\n\n<pre><code>clearColor            $= Color4 r g b 1.0\ndepthFunc             $= Just Lequal\nblendFunc             $= (SrcAlpha, OneMinusSrcAlpha)\nnormalize             $= Enabled\ntexture Texture2D     $= Enabled\nshadeModel            $= Smooth\n</code></pre>\n\n<p>This is my first post, so please tell me if I have missed something, and thank you for your kind assistance!</p>\n\n<p><strong>Bad practice solution:</strong></p>\n\n<p>I have come up with a solution, I have added it as an edit, rather than a solution, because I'm not certain that it is good practice --- it is not the type of answer I would like to have to this post, but it can still be of use to those who wish to answer.</p>\n\n<p>Calling <code>loadTexture</code> using <code>unsafeCoerce</code>, </p>\n\n<pre><code>unsafePerformIO $ loadTexture \"foo/bar.png\"\n</code></pre>\n\n<p>works. However, rewriting the <code>loadTexture'</code> function as  </p>\n\n<pre><code>loadTexture' :: FilePath -&gt; IO TextureObject\nloadTexture' f = do\n    let tex = unsafePerformIO $ either error id &lt;$&gt; readTexture f\n\n    textureFilter Texture2D $= ((Linear', Nothing), Linear')\n\n    return tex\n</code></pre>\n\n<p>does not work.</p>\n"}, {"tags": ["haskell", "types"], "comments": [{"owner": {"reputation": 48129, "user_id": 76051, "user_type": "registered", "accept_rate": 91, "profile_image": "https://i.stack.imgur.com/AGDxz.jpg?s=128&g=1", "display_name": "Carsten", "link": "https://stackoverflow.com/users/76051/carsten"}, "edited": false, "score": 0, "creation_date": 1469032091, "post_id": 38485939, "comment_id": 64373861, "body": "well types are erased at runtime (can you give an example - because isn&#39;t what you are asking just some kind of <code>isElem value set</code> where <code>set</code> is defined at runtime?)"}, {"owner": {"reputation": 457, "user_id": 107667, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/07d51368cc7c0681b8eba2adeb8e3130?s=128&d=identicon&r=PG", "display_name": "Tom Johnson", "link": "https://stackoverflow.com/users/107667/tom-johnson"}, "reply_to_user": {"reputation": 48129, "user_id": 76051, "user_type": "registered", "accept_rate": 91, "profile_image": "https://i.stack.imgur.com/AGDxz.jpg?s=128&g=1", "display_name": "Carsten", "link": "https://stackoverflow.com/users/76051/carsten"}, "edited": false, "score": 0, "creation_date": 1469032169, "post_id": 38485939, "comment_id": 64373915, "body": "This is basically the problem I&#39;m having. I thought it might be possible to have some internal representation as ([allowed], Maybe value) but it doesn&#39;t have very nice semantics."}, {"owner": {"reputation": 94553, "user_id": 775806, "user_type": "registered", "accept_rate": 96, "profile_image": "https://i.stack.imgur.com/XNd2C.png?s=128&g=1", "display_name": "n. &#39;pronouns&#39; m.", "link": "https://stackoverflow.com/users/775806/n-pronouns-m"}, "edited": false, "score": 1, "creation_date": 1469032199, "post_id": 38485939, "comment_id": 64373932, "body": "Can you show some imaginary code using this hypothetical feature? Are you talking about something like dependent types?"}, {"owner": {"reputation": 100185, "user_id": 3234959, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/93bb12ca0f93dfddb33880316f7e66c2?s=128&d=identicon&r=PG&f=1", "display_name": "chi", "link": "https://stackoverflow.com/users/3234959/chi"}, "edited": false, "score": 0, "creation_date": 1469032408, "post_id": 38485939, "comment_id": 64374041, "body": "As much as I love Haskell, I&#39;d not say it can effectively handle static range checks. E.g. array index runtime checks are still needed (or unsafely avoided, when performance really matters)."}, {"owner": {"reputation": 100892, "user_id": 745903, "user_type": "registered", "accept_rate": 74, "profile_image": "https://www.gravatar.com/avatar/50933f6638836741e620669b3940410e?s=128&d=identicon&r=PG", "display_name": "leftaroundabout", "link": "https://stackoverflow.com/users/745903/leftaroundabout"}, "reply_to_user": {"reputation": 100185, "user_id": 3234959, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/93bb12ca0f93dfddb33880316f7e66c2?s=128&d=identicon&r=PG&f=1", "display_name": "chi", "link": "https://stackoverflow.com/users/3234959/chi"}, "edited": false, "score": 0, "creation_date": 1469033187, "post_id": 38485939, "comment_id": 64374472, "body": "@chi: at least for the example of array indices, I&#39;d say Haskell does a pretty good job of doing \u201cstatic range checks\u201d \u2013 by consequenty eschewing indices from being used in the first place!"}, {"owner": {"reputation": 100185, "user_id": 3234959, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/93bb12ca0f93dfddb33880316f7e66c2?s=128&d=identicon&r=PG&f=1", "display_name": "chi", "link": "https://stackoverflow.com/users/3234959/chi"}, "reply_to_user": {"reputation": 100892, "user_id": 745903, "user_type": "registered", "accept_rate": 74, "profile_image": "https://www.gravatar.com/avatar/50933f6638836741e620669b3940410e?s=128&d=identicon&r=PG", "display_name": "leftaroundabout", "link": "https://stackoverflow.com/users/745903/leftaroundabout"}, "edited": false, "score": 1, "creation_date": 1469039310, "post_id": 38485939, "comment_id": 64378103, "body": "@leftaroundabout True, yet sometimes random access is really needed. Actually, I&#39;d say that if you are using arrays without needing random access, you are doing it wrong. :)"}, {"owner": {"reputation": 100892, "user_id": 745903, "user_type": "registered", "accept_rate": 74, "profile_image": "https://www.gravatar.com/avatar/50933f6638836741e620669b3940410e?s=128&d=identicon&r=PG", "display_name": "leftaroundabout", "link": "https://stackoverflow.com/users/745903/leftaroundabout"}, "reply_to_user": {"reputation": 100185, "user_id": 3234959, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/93bb12ca0f93dfddb33880316f7e66c2?s=128&d=identicon&r=PG&f=1", "display_name": "chi", "link": "https://stackoverflow.com/users/3234959/chi"}, "edited": false, "score": 2, "creation_date": 1469040648, "post_id": 38485939, "comment_id": 64378858, "body": "@chi: well, if you only need operations that would have the same complexity on lists, it can still make sense to use arrays instead for performance. But you&#39;re right \u2013 realising that I need random access is what usually prompts me to switch from lists to arrays (though <code>IntMap</code> can occasionally be a better choice). My point was that indices are far less often needed in Haskell than in most other languages, even less than in R or Matlab etc. which also advertise heavily the avoidance of indices."}], "answers": [{"tags": [], "owner": {"reputation": 126897, "user_id": 791604, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/ce991df7a056248d5e4f6fc3659ba733?s=128&d=identicon&r=PG", "display_name": "Daniel Wagner", "link": "https://stackoverflow.com/users/791604/daniel-wagner"}, "is_accepted": false, "score": 1, "last_activity_date": 1469037010, "creation_date": 1469037010, "answer_id": 38487438, "question_id": 38485939, "link": "https://stackoverflow.com/questions/38485939/haskell-finite-types-of-user-defined-values/38487438#38487438", "title": "Haskell: finite types of user-defined values?", "body": "<p>Perhaps a <code>Set</code> is suitable for your needs. We have:</p>\n\n<pre><code>initialize :: Ord a =&gt; [a] -&gt; Set a\ninitialize = fromList\n\nconstruct :: Ord a =&gt; a -&gt; Set a -&gt; Maybe a\nconstruct x xs = guard (x `member` xs) &gt;&gt; return x\n\ndynamicMinBound :: Set a -&gt; Maybe a\ndynamicMinBound xs = fst &lt;$&gt; minView xs\n\ndynamicMaxBound :: Set a -&gt; Maybe a\ndynamicMaxBound xs = fst &lt;$&gt; maxView xs\n\nenumerate :: Set a -&gt; [a]\nenumerate = toList\n\ndynamicToEnum :: Int -&gt; Set a -&gt; Maybe a\ndynamicToEnum n xs = guard (inRange n (0, size xs-1)) &gt;&gt; return (elemAt n xs)\n\ndynamicFromEnum :: Ord a =&gt; a -&gt; Set a -&gt; Maybe Int\ndynamicFromEnum = lookupIndex\n</code></pre>\n\n<p>I believe this covers the operations you asked for, though I could easily have misunderstood something -- your specification is not 100% clear to me.</p>\n"}, {"comments": [{"owner": {"reputation": 457, "user_id": 107667, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/07d51368cc7c0681b8eba2adeb8e3130?s=128&d=identicon&r=PG", "display_name": "Tom Johnson", "link": "https://stackoverflow.com/users/107667/tom-johnson"}, "edited": false, "score": 0, "creation_date": 1469047621, "post_id": 38489941, "comment_id": 64382736, "body": "Sorry for the sparsity; I&#39;m finding it a difficult concept to express. After a quick Google, it seems that I do want dependent types. In this case, ones whose set of values depend on something defined at runtime. I&#39;m going to accept your answer however as I believe it&#39;s the closest I can get to my goal in Haskell. Thanks for your help."}, {"owner": {"reputation": 44013, "user_id": 1477667, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/trgKM.jpg?s=128&g=1", "display_name": "dfeuer", "link": "https://stackoverflow.com/users/1477667/dfeuer"}, "reply_to_user": {"reputation": 457, "user_id": 107667, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/07d51368cc7c0681b8eba2adeb8e3130?s=128&d=identicon&r=PG", "display_name": "Tom Johnson", "link": "https://stackoverflow.com/users/107667/tom-johnson"}, "edited": false, "score": 1, "creation_date": 1469071280, "post_id": 38489941, "comment_id": 64389325, "body": "@TomJohnson, you may well be able to do what you want in Haskell with singletons; it&#39;ll just be rather ugly and likely inefficient. The trick there is to come up with a type-level representation of a set of values, and then use a GADT to bring that down to the term level. Take a look at <a href=\"http://hackage.haskell.org/package/type-level-sets-0.7/docs/Data-Type-Set.html\" rel=\"nofollow noreferrer\">Data.Type.Set</a> in the <code>type-level-sets</code> package for a relatively simple (but still quite tricky!) example."}], "tags": [], "owner": {"reputation": 44013, "user_id": 1477667, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/trgKM.jpg?s=128&g=1", "display_name": "dfeuer", "link": "https://stackoverflow.com/users/1477667/dfeuer"}, "is_accepted": true, "score": 2, "last_activity_date": 1469079475, "last_edit_date": 1495541837, "creation_date": 1469045364, "answer_id": 38489941, "question_id": 38485939, "link": "https://stackoverflow.com/questions/38485939/haskell-finite-types-of-user-defined-values/38489941#38489941", "title": "Haskell: finite types of user-defined values?", "body": "<p>Your sample code is, unfortunately, too sparse to indicate what you really mean. I'm guessing you may be after dependent types, as <a href=\"https://stackoverflow.com/questions/38485939/haskell-finite-types-of-user-defined-values#comment64373932_38485939\">n.m. suggested</a>. If that is the case, you're likely better off looking at something like Agda instead of Haskell. If you want a somewhat safer version of what <a href=\"https://stackoverflow.com/a/38487438/1477667\">Daniel Wagner suggested</a>, you can get it with the <a href=\"https://hackage.haskell.org/package/reflection\" rel=\"nofollow noreferrer\">reflection</a> package.</p>\n\n<pre><code>{-# LANGUAGE ScopedTypeVariables #-}\n{-# LANGUAGE MultiParamTypeClasses #-}\n{-# LANGUAGE FlexibleContexts #-}\n{-# LANGUAGE UndecidableInstances #-}\n{-# LANGUAGE RankNTypes #-}\n{-# LANGUAGE GeneralizedNewtypeDeriving #-}\n{-# LANGUAGE StandaloneDeriving #-}\n\nmodule DynEnum (.... not including newtype constructors) where\n\nimport Data.Reflection\nimport Data.Proxy\nimport Data.Set (Set, splitMember, size, lookupIndex, fromList, elemAt, member, findMin, findMax)\nimport Data.Foldable\nimport Data.Bool\nimport Data.Type.Coercion\n\n-- Just Enum\nnewtype Limited a s = Limited { unLimited :: a }\n\ntype role Limited representational nominal\n\n-- We can safely conflate types of values that come\n-- from the same set.\ncoerceLimited :: (Reifies s (Set a), Reifies t (Set a), Ord a)\n              =&gt; Maybe (Coercion (Limited a s) (Limited a t))\ncoerceLimited\n  | reflect (Proxy :: Proxy s) == reflect (Proxy :: Proxy t)\n      = Just Coercion\n  | otherwise = Nothing\n\ninstance (Ord a, Reifies s (Set a)) =&gt; Enum (Limited a s) where\n  toEnum i\n    | 0 &lt;= i &amp;&amp; i &lt; size values = Limited $ elemAt i values\n    | otherwise = error \"Limited toEnum: out of range\"\n    where values = reflect (Proxy :: Proxy s)\n  fromEnum x = case lookupIndex (unLimited x) (reflect x) of\n                 Nothing -&gt; error \"Limited fromEnum: out of range\"\n                 Just i -&gt; i\n  enumFrom (Limited a) = case splitMember a (reflect (Proxy :: Proxy s)) of\n                 (_, False, s) -&gt; fmap Limited $ toList s\n                 (_, True, s) -&gt; Limited a : fmap Limited (toList s)\n  enumFromTo (Limited a) (Limited b) = case splitMember a (reflect (Proxy :: Proxy s)) of\n                 (_, inclFirst, s) -&gt; case splitMember b s of\n                   (t, inclLast, _) -&gt; bool id (Limited a:) inclFirst\n                                        . (map Limited (toList t) ++)\n                                        $ bool [] [Limited b] inclLast\n\ninitialize :: Ord a\n           =&gt; [a]\n           -&gt; (forall s . Enum (Limited a s) =&gt; Proxy s -&gt; r)\n           -&gt; r\ninitialize vals f = reify (fromList vals) f\n\nconstruct :: forall s a . (Ord a, Reifies s (Set a)) =&gt; a -&gt; Maybe (Limited a s)\nconstruct x\n  | x `member` reflect (Proxy :: Proxy s) = Just (Limited x)\n  | otherwise = Nothing\n\nnewtype Bound a b = Bound a deriving (Enum)\n\ntype role Bound representational nominal\n\ninstance Reifies b (a, a) =&gt; Bounded (Bound a b) where\n  minBound = Bound . fst $ reflect (Proxy :: Proxy b)\n  maxBound = Bound . snd $ reflect (Proxy :: Proxy b)\n\ninitializeBounded :: (a, a)\n                  -&gt; (forall b . Bounded (Bound a b) =&gt; Proxy b -&gt; r)\n                  -&gt; r\ninitializeBounded bounds f = reify bounds f\n\nnewtype LimitedB a s b = LimitedB (Bound (Limited a s) b)\n\nderiving instance (Ord a, Reifies s (Set a)) =&gt; Enum (LimitedB a s b)\nderiving instance Reifies b (Limited a s, Limited a s) =&gt; Bounded (LimitedB a s b)\n\ninitializeLimitedB :: Ord a\n                   =&gt; [a]\n                   -&gt; (forall s b . (Enum (LimitedB a s b), Bounded (LimitedB a s b)) =&gt; Proxy s -&gt; Proxy b -&gt; r)\n                   -&gt; r\ninitializeLimitedB [] _f = error \"Cannot initialize LimitedB with an empty list\"\ninitializeLimitedB vals f = reify set $ \\ps -&gt;\n                     reify (Limited (findMin set), Limited (findMax set)) $ \\pb -&gt;\n                     f ps pb\n  where\n    set = fromList vals\n</code></pre>\n"}], "owner": {"reputation": 457, "user_id": 107667, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/07d51368cc7c0681b8eba2adeb8e3130?s=128&d=identicon&r=PG", "display_name": "Tom Johnson", "link": "https://stackoverflow.com/users/107667/tom-johnson"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 194, "favorite_count": 2, "accepted_answer_id": 38489941, "answer_count": 2, "score": 0, "last_activity_date": 1469079475, "creation_date": 1469032004, "last_edit_date": 1469032547, "question_id": 38485939, "link": "https://stackoverflow.com/questions/38485939/haskell-finite-types-of-user-defined-values", "title": "Haskell: finite types of user-defined values?", "body": "<p>Part of the power of Haskell is delegating range checks to the type system (see for example Numeric.Natural). Is this possible to do for types whose set of values is defined once at runtime? I'd effectively like an Enum whose values are unknown at compile-time.</p>\n\n<p>Edit: In terms of example usage:</p>\n\n<pre><code>-- Defines the list of allowed values\ninit :: [a] -&gt; ?\n\n-- Constructs a new instance\nconstruct :: a -&gt; ? -&gt; Maybe Foo\n\n-- Then just usable like an enum\nbar :: Int -&gt; Foo -&gt; Bar\n</code></pre>\n\n<p>Ideally I'd be able to use things like <code>Bounded</code> on it too.</p>\n"}, {"tags": ["haskell", "type-conversion"], "comments": [{"owner": {"reputation": 48129, "user_id": 76051, "user_type": "registered", "accept_rate": 91, "profile_image": "https://i.stack.imgur.com/AGDxz.jpg?s=128&g=1", "display_name": "Carsten", "link": "https://stackoverflow.com/users/76051/carsten"}, "edited": false, "score": 0, "creation_date": 1469031218, "post_id": 38485664, "comment_id": 64373368, "body": "use <code>div</code> instead of <code>&#47;</code> and <code>floor</code>"}, {"owner": {"reputation": 48129, "user_id": 76051, "user_type": "registered", "accept_rate": 91, "profile_image": "https://i.stack.imgur.com/AGDxz.jpg?s=128&g=1", "display_name": "Carsten", "link": "https://stackoverflow.com/users/76051/carsten"}, "edited": false, "score": 0, "creation_date": 1469031330, "post_id": 38485664, "comment_id": 64373429, "body": "<code>digits x = if x &gt; 0 then (x `mod` 10) : digits (x `div` 10) else [x `mod` 10]</code> - please note that you will get a reversed list (and an unwanted <code>0</code> in most cases)"}, {"owner": {"reputation": 100892, "user_id": 745903, "user_type": "registered", "accept_rate": 74, "profile_image": "https://www.gravatar.com/avatar/50933f6638836741e620669b3940410e?s=128&d=identicon&r=PG", "display_name": "leftaroundabout", "link": "https://stackoverflow.com/users/745903/leftaroundabout"}, "edited": false, "score": 1, "creation_date": 1469031963, "post_id": 38485664, "comment_id": 64373784, "body": "That&#39;s a GHCi error message from trying to <i>use</i> the function in some context. Always add type signatures to your functions, so the problems become apparent right away, not somewhere else."}, {"owner": {"reputation": 4545, "user_id": 3901400, "user_type": "registered", "accept_rate": 69, "profile_image": "https://i.stack.imgur.com/gvB8O.jpg?s=128&g=1", "display_name": "Marcus Ruddick", "link": "https://stackoverflow.com/users/3901400/marcus-ruddick"}, "edited": false, "score": 0, "creation_date": 1469032598, "post_id": 38485664, "comment_id": 64374143, "body": "Thanks! the reversed list is expected."}], "answers": [{"comments": [{"owner": {"reputation": 4545, "user_id": 3901400, "user_type": "registered", "accept_rate": 69, "profile_image": "https://i.stack.imgur.com/gvB8O.jpg?s=128&g=1", "display_name": "Marcus Ruddick", "link": "https://stackoverflow.com/users/3901400/marcus-ruddick"}, "edited": false, "score": 0, "creation_date": 1469032673, "post_id": 38486115, "comment_id": 64374186, "body": "Thank you for the thorough explanation"}, {"owner": {"reputation": 48129, "user_id": 76051, "user_type": "registered", "accept_rate": 91, "profile_image": "https://i.stack.imgur.com/AGDxz.jpg?s=128&g=1", "display_name": "Carsten", "link": "https://stackoverflow.com/users/76051/carsten"}, "edited": false, "score": 1, "creation_date": 1469043883, "post_id": 38486115, "comment_id": 64380688, "body": "good answer - I think we should probably include something like this in either the Haskell-tag or in the (beta?) documentation thing StackExchange is working on as this question/problem (using <code>(&#47;)</code> where <code>div</code> is needed) is really a common issue here - sadly I could not find one of the other occurrences to link this too (as usually the title does not indicate the problem directly)"}, {"owner": {"reputation": 29444, "user_id": 3072788, "user_type": "registered", "accept_rate": 82, "profile_image": "https://www.gravatar.com/avatar/220a45c2fcff7e7358d144551b116205?s=128&d=identicon&r=PG&f=1", "display_name": "Alec", "link": "https://stackoverflow.com/users/3072788/alec"}, "reply_to_user": {"reputation": 48129, "user_id": 76051, "user_type": "registered", "accept_rate": 91, "profile_image": "https://i.stack.imgur.com/AGDxz.jpg?s=128&g=1", "display_name": "Carsten", "link": "https://stackoverflow.com/users/76051/carsten"}, "edited": false, "score": 0, "creation_date": 1469115231, "post_id": 38486115, "comment_id": 64414854, "body": "@Carsten Where would you recommend putting it in there? I poked around a bit but I couldn&#39;t really find a place for this sort of thing..."}, {"owner": {"reputation": 48129, "user_id": 76051, "user_type": "registered", "accept_rate": 91, "profile_image": "https://i.stack.imgur.com/AGDxz.jpg?s=128&g=1", "display_name": "Carsten", "link": "https://stackoverflow.com/users/76051/carsten"}, "edited": false, "score": 0, "creation_date": 1469116579, "post_id": 38486115, "comment_id": 64415739, "body": "in the tag or in the docu? Probably something titled <code>div vs &#47;</code>"}], "tags": [], "owner": {"reputation": 29444, "user_id": 3072788, "user_type": "registered", "accept_rate": 82, "profile_image": "https://www.gravatar.com/avatar/220a45c2fcff7e7358d144551b116205?s=128&d=identicon&r=PG&f=1", "display_name": "Alec", "link": "https://stackoverflow.com/users/3072788/alec"}, "is_accepted": true, "score": 2, "last_activity_date": 1469037253, "last_edit_date": 1469037253, "creation_date": 1469032589, "answer_id": 38486115, "question_id": 38485664, "link": "https://stackoverflow.com/questions/38485664/trouble-getting-types-to-match-up-in-haskell/38486115#38486115", "title": "Trouble getting types to match up in Haskell", "body": "<p>To elaborate on Carsten's comment, the problem is that Haskell infers the type signature</p>\n\n<pre><code>digits :: (RealFrac a, Integral a) =&gt; a -&gt; [a]\n</code></pre>\n\n<p>when what you wanted was</p>\n\n<pre><code>digits :: Integral a =&gt; a -&gt; [a]\n</code></pre>\n\n<p>The reason it infers the former is that you use <a href=\"http://hackage.haskell.org/package/base-4.9.0.0/docs/Prelude.html#v:-47-\" rel=\"nofollow\"><code>(/)</code></a> and <a href=\"http://hackage.haskell.org/package/base-4.9.0.0/docs/Prelude.html#v:floor\" rel=\"nofollow\"><code>floor</code></a>, which are defined in the <code>Fractional</code> and <code>RealFrac</code> classes. As leftaroundabout points out, this isn't really a problem until you try to run your function with an actual number, at which point Haskell fails to find a good number type to default to (Haskell number literals are actually polymorphic, and there are special defaulting rules for when you don't explicitly declare a type), hence the weird error message. You would get a more descriptive error message if you tried something like <code>digits (1 :: Int)</code>:</p>\n\n<pre><code>&lt;interactive&gt;:19:1: error:\n  \u2022 No instance for (RealFrac Int) arising from a use of \u2018digits\u2019\n  \u2022 In the expression: digits (1 :: Int)\n    In an equation for \u2018it\u2019: it = digits (1 :: Int)\n</code></pre>\n\n<p>The fix, as Carsten pointed out, is to use <code>div</code> instead of <code>(/)</code> and <code>floor</code>.</p>\n"}], "owner": {"reputation": 4545, "user_id": 3901400, "user_type": "registered", "accept_rate": 69, "profile_image": "https://i.stack.imgur.com/gvB8O.jpg?s=128&g=1", "display_name": "Marcus Ruddick", "link": "https://stackoverflow.com/users/3901400/marcus-ruddick"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 53, "favorite_count": 0, "accepted_answer_id": 38486115, "answer_count": 1, "score": 1, "last_activity_date": 1469037253, "creation_date": 1469031144, "last_edit_date": 1469031206, "question_id": 38485664, "link": "https://stackoverflow.com/questions/38485664/trouble-getting-types-to-match-up-in-haskell", "title": "Trouble getting types to match up in Haskell", "body": "<p>I am trying to get a list of the digits from a number, here is my code:</p>\n\n<pre><code>digits x = if x &gt; 0 then (i : digits (floor (x / 10))) else [i]\n    where i = (mod x 10)\n</code></pre>\n\n<p>The error I get for this code is:</p>\n\n<pre><code>No instance for (Integral a0) arising from a use of \u2018it\u2019\n    The type variable \u2018a0\u2019 is ambiguous\n    Note: there are several potential instances:\n      instance Integral Integer -- Defined in \u2018GHC.Real\u2019\n      instance Integral Int -- Defined in \u2018GHC.Real\u2019\n      instance Integral Word -- Defined in \u2018GHC.Real\u2019\n    In the first argument of \u2018print\u2019, namely \u2018it\u2019\n    In a stmt of an interactive GHCi command: print it\n</code></pre>\n\n<p>what am I doing wrong?</p>\n"}, {"tags": ["haskell", "ffi"], "comments": [{"owner": {"reputation": 94713, "user_id": 1139697, "user_type": "registered", "accept_rate": 86, "profile_image": "https://www.gravatar.com/avatar/5f136ddb684f39aaee1c028ee1950f6f?s=128&d=identicon&r=PG", "display_name": "Zeta", "link": "https://stackoverflow.com/users/1139697/zeta"}, "edited": false, "score": 2, "creation_date": 1469041892, "post_id": 38485133, "comment_id": 64379577, "body": "Can you recreate the behaviour in a <a href=\"https://stackoverflow.com/help/minimal-reproducible-example\">minimal reproducible example</a>? Otherwise it will be difficult to reproduce the behaviour completely. Either way, I <i>guess</i> that at some point memory that&#39;s owned by GEGL gets freed by something in your Haskell code. And the second <code>free()</code> tends to segfault at the weirdest times (after all, it&#39;s undefined behaviour)."}, {"owner": {"reputation": 36, "user_id": 4366908, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/uXY4B.png?s=128&g=1", "display_name": "nek0", "link": "https://stackoverflow.com/users/4366908/nek0"}, "reply_to_user": {"reputation": 94713, "user_id": 1139697, "user_type": "registered", "accept_rate": 86, "profile_image": "https://www.gravatar.com/avatar/5f136ddb684f39aaee1c028ee1950f6f?s=128&d=identicon&r=PG", "display_name": "Zeta", "link": "https://stackoverflow.com/users/1139697/zeta"}, "edited": false, "score": 0, "creation_date": 1469121470, "post_id": 38485133, "comment_id": 64418586, "body": "Thanks for the advice. added a small example. I am not aware of freeing any pointers in my code."}, {"owner": {"reputation": 94713, "user_id": 1139697, "user_type": "registered", "accept_rate": 86, "profile_image": "https://www.gravatar.com/avatar/5f136ddb684f39aaee1c028ee1950f6f?s=128&d=identicon&r=PG", "display_name": "Zeta", "link": "https://stackoverflow.com/users/1139697/zeta"}, "edited": false, "score": 0, "creation_date": 1469127311, "post_id": 38485133, "comment_id": 64421823, "body": "As a non-static <code>int[5]</code>, you may not use the returned pointer after you&#39;ve left its scope. That&#39;s basically the same -&gt; UB."}, {"owner": {"reputation": 36, "user_id": 4366908, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/uXY4B.png?s=128&g=1", "display_name": "nek0", "link": "https://stackoverflow.com/users/4366908/nek0"}, "reply_to_user": {"reputation": 94713, "user_id": 1139697, "user_type": "registered", "accept_rate": 86, "profile_image": "https://www.gravatar.com/avatar/5f136ddb684f39aaee1c028ee1950f6f?s=128&d=identicon&r=PG", "display_name": "Zeta", "link": "https://stackoverflow.com/users/1139697/zeta"}, "edited": false, "score": 0, "creation_date": 1469196569, "post_id": 38485133, "comment_id": 64451087, "body": "Thank you so much. with a <code>static</code> prepending tha variable the example works. I&#39;ll try to get my project working with it, but I see a problem with non constant initializers when compiling. I&#39;ll try to solve that. Would you like to write a proper answer so I can accept it?"}, {"owner": {"reputation": 36, "user_id": 4366908, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/uXY4B.png?s=128&g=1", "display_name": "nek0", "link": "https://stackoverflow.com/users/4366908/nek0"}, "reply_to_user": {"reputation": 94713, "user_id": 1139697, "user_type": "registered", "accept_rate": 86, "profile_image": "https://www.gravatar.com/avatar/5f136ddb684f39aaee1c028ee1950f6f?s=128&d=identicon&r=PG", "display_name": "Zeta", "link": "https://stackoverflow.com/users/1139697/zeta"}, "edited": false, "score": 0, "creation_date": 1469377136, "post_id": 38485133, "comment_id": 64499119, "body": "after some hours tinkering with it it now finally works. Thank you very much."}], "owner": {"reputation": 36, "user_id": 4366908, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/uXY4B.png?s=128&g=1", "display_name": "nek0", "link": "https://stackoverflow.com/users/4366908/nek0"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 182, "favorite_count": 0, "answer_count": 0, "score": 0, "last_activity_date": 1469121811, "creation_date": 1469029652, "last_edit_date": 1469121811, "question_id": 38485133, "link": "https://stackoverflow.com/questions/38485133/passing-data-from-c-to-haskell-and-back", "title": "Passing data from C to Haskell and back", "body": "<p>I am currently writing Haskell bindings to the GEGL library, which is originally written in C. It's my first time using the FFI, so I may have missed something.</p>\n\n<p>My Problem is, that I get segfaults at code like this:</p>\n\n<pre><code>-- | Simple iteration over a rectangle section of a buffer.\niterateOver   \n  :: GeglBuffer               -- ^ Target buffer\n  -&gt; GeglRectangle            -- ^ Rectangle to iterate over\n  -&gt; BablFormat               -- ^ Pixel format\n  -&gt; GeglAccessMode           -- ^ Access mode to pixel data\n  -&gt; GeglAbyssPolicy          -- ^ Abbyss policy for pixel data\n  -&gt; (Pixel -&gt; Pixel) -- Function to apply to each pixel\n  -&gt; IO ()\niterateOver buf rect form am ap func = do\n  traceIO \"start\"\n  (FFI.GeglBufferIterator iterPtr) &lt;- gegl_buffer_iterator_new buf rect form am ap\n  traceIO \"new iterator\"\n  untilM_ (do\n    floats &lt;-  map (\\(CFloat f) -&gt; f) &lt;$&gt; FFI.c_gegl_peek_data iterPtr -- Code breaks here\n    traceIO \"peeked data\"\n    let ops =  buildPixelList rect floats\n        nps =  map func ops\n        nfl =  map CFloat $ buildFloatList nps\n    FFI.c_gegl_poke_data iterPtr nfl\n    traceIO \"poked data\"                                                        \n    ) ( not &lt;$&gt; gegl_buffer_iterator_next (FFI.GeglBufferIterator iterPtr))\n  traceIO \"finished\"\n</code></pre>\n\n<p>The <code>c_gegl_peek_data</code> function has been written with <code>inline-c</code> and looks as follows:</p>\n\n<pre><code>-- | Get the list of pixel data out of a 'GeglBufferIterator'.\nc_gegl_peek_data\n  :: GeglBufferIteratorDummy -- ^ Iterator to take data from\n  -&gt; IO [CFloat]\nc_gegl_peek_data ptr = do\n  fptr &lt;- [C.block| float * {\n    GeglBufferIterator * cptr =  $(void * ptr);\n    float * a = (float *) cptr-&gt;data[0];\n    return a;\n    }|]\n  (CInt length) &lt;- [C.block| int {\n    GeglBufferIterator * cptr = $(void * ptr);\n    int a = cptr-&gt;length;\n    return a;\n    }|]\n  peekArray (fromIntegral length :: Int) fptr\n</code></pre>\n\n<p>Can anyone of you point out, where my error is?</p>\n\n<p>Thanks in advance.</p>\n\n<p><strong>EDIT:</strong></p>\n\n<p>Here is a small minimal self-contained example of the same problem. it only requires the <code>inline-c</code> package.</p>\n\n<pre><code>{-#LANGUAGE QuasiQuotes #-}\n{-#LANGUAGE OverloadedStrings #-}\n{-#LANGUAGE TemplateHaskell #-}\n{-#LANGUAGE ForeignFunctionInterface #-}\n\nmodule Main where\n\nimport qualified Language.C.Inline as C\nimport Foreign.Marshal.Array\nimport Debug.Trace\n\nmain :: IO ()\nmain = do\n  traceIO \"start\"\n  ptr &lt;- [C.block| int * {\n    int a[5] = {0,1,2,3,4};\n    return a;\n    }|]\n  traceIO \"got pointer\"\n  a &lt;- peekArray 5 ptr\n  traceIO \"peeked pointer\"\n  putStrLn $ show a\n  traceIO \"finish\"\n</code></pre>\n\n<p>Furthermore I add the cabal file for this example:</p>\n\n<pre><code>name:                sandbox\nversion:             0.0.0.0\nsynopsis:            Small example\nauthor:              nek0\nmaintainer:          nek0@nek0.eu\nbuild-type:          Simple\ncabal-version:       &gt;=1.10\n\nexecutable sandbox\n  hs-source-dirs:      app\n  main-is:             Main.hs\n  c-sources:           app/Main.c\n  ghc-options:         -Wall -threaded -rtsopts -with-rtsopts=-N\n  build-depends:       base\n                     , inline-c\n  default-language:    Haskell2010\n</code></pre>\n"}, {"tags": ["haskell", "serialization"], "comments": [{"owner": {"reputation": 100185, "user_id": 3234959, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/93bb12ca0f93dfddb33880316f7e66c2?s=128&d=identicon&r=PG&f=1", "display_name": "chi", "link": "https://stackoverflow.com/users/3234959/chi"}, "edited": false, "score": 0, "creation_date": 1469029419, "post_id": 38484622, "comment_id": 64372089, "body": "I fear that the correct type for this would something like <code>Get (exists a. Get a)</code>, using existential rather than universal quantification (and let&#39;s ignore the predicativity issues for now...). This also means that this parser would not offer any static guarantee about the type of the output, and as such its result would be practically unusable. I&#39;d make the parser return something in a large sum, or at worst return <code>Dynamic</code>. As such it seems unfeasible."}, {"owner": {"reputation": 48938, "user_id": 246886, "user_type": "registered", "accept_rate": 94, "profile_image": "https://www.gravatar.com/avatar/dd1ebaade6623fc538fb8af3338e730d?s=128&d=identicon&r=PG", "display_name": "Jon Purdy", "link": "https://stackoverflow.com/users/246886/jon-purdy"}, "edited": false, "score": 3, "creation_date": 1469038371, "post_id": 38484622, "comment_id": 64377552, "body": "Apart from the details with existentials that others have pointed out, your intuition that <code>Get (Get a)</code> gives you context-sensitivity is right. It\u2019s basically the reason <code>Monad</code> is equipped with <code>join :: m (m a) -&gt; m a</code>: <code>Monad</code> describes computations that can depend on previous results\u2014unlike, say, <code>Applicative</code>."}], "answers": [{"tags": [], "owner": {"reputation": 100892, "user_id": 745903, "user_type": "registered", "accept_rate": 74, "profile_image": "https://www.gravatar.com/avatar/50933f6638836741e620669b3940410e?s=128&d=identicon&r=PG", "display_name": "leftaroundabout", "link": "https://stackoverflow.com/users/745903/leftaroundabout"}, "is_accepted": true, "score": 5, "last_activity_date": 1469030570, "last_edit_date": 1469030570, "creation_date": 1469029591, "answer_id": 38485110, "question_id": 38484622, "link": "https://stackoverflow.com/questions/38484622/haskell-get-a-get-monad-and-also-return-polymorphism-over-infinite-types/38485110#38485110", "title": "Haskell: Get a Get monad and also return polymorphism over infinite types", "body": "<p>You aren't really returning something polymorphic (<em>universally quantified</em>) there \u2013 in fact you're always returning a concrete type <code>Get A</code>, but it will only be decided at runtime which it is. This is called <a href=\"https://wiki.haskell.org/Existential_type\" rel=\"nofollow\">existential quantification</a>. Haskell98 didn't have any such thing, but you can do it with generalised algebraic data types:</p>\n\n<pre><code>{-# LANGUAGE GADTs #-}\ndata GetSomething where\n   GetSomething :: Get a -&gt; GetSomething\n\nparseTypeDescriptor :: Get GetSomething\n-- first part of the type descriptor is an id (Word8) that implies a type\nparseTypeDescriptor = getWord8 &gt;&gt;= go\n   where go 0 = return $ GetSomething getWord8\n         go 1 = return $ GetSomething getWord16be\n         go 2 = return $ GetSomething getWord32be\n</code></pre>\n\n<p>So far so good... trouble is, there's not really anything useful you can do with <code>GetSomething</code>, because there's no way to know what type it actually yields (it's hidden within the GADT). There are ways to overcome this \u2013 for instance, if all the parsed types belong to a common type class, you can add it as a constraint:</p>\n\n<pre><code>data GetSomething where\n   GetSomething :: CommonClass a =&gt; Get a -&gt; GetSomething\n</code></pre>\n\n<p>This way you will be able to parse values and do something with them even without knowing the exact type.</p>\n\n<p>However, this is probably not the best approach: you'll basically always have to run after the missing type information and hack around to still get stuff done. Existentials are considered a bit of an antipattern in Haskell.</p>\n\n<p>A better solution is likely to put the types in a clear alternative data structure:</p>\n\n<pre><code>data GetSomething\n   = GetW8 (Get Word8)\n   | GetW16 (Get Word16)\n   | ...\n   | GetList [GetSomething]\n</code></pre>\n\n<p>Then you can simply pattern-match to find out what particular type you have, and because the list of supported types is finite you can be sure you won't run into problems because a type isn't actually supported.</p>\n"}], "owner": {"reputation": 145, "user_id": 4749904, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/7ksgF.jpg?s=128&g=1", "display_name": "silver", "link": "https://stackoverflow.com/users/4749904/silver"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 96, "favorite_count": 0, "accepted_answer_id": 38485110, "answer_count": 1, "score": 4, "last_activity_date": 1469030570, "creation_date": 1469028285, "question_id": 38484622, "link": "https://stackoverflow.com/questions/38484622/haskell-get-a-get-monad-and-also-return-polymorphism-over-infinite-types", "title": "Haskell: Get a Get monad and also return polymorphism over infinite types", "body": "<p>I apologize in advance if the following is based on a misunderstanding on my part. I couldn't find the answers I needed anywhere.</p>\n\n<p>I am implementing a program that reads serialized objects from a file, using lazy evaluation all throughout. I am parsing the file by first reading it in as a single Lazy ByteString and then parsing it using the Get Monad. Within the file, there is one point where type descriptors are stored, and another point where data is storied. Type descriptors tell me how data is to be interpreted and which type it eventually has, and that type can take nested forms; Double or [[Word8]] are two possibilities.</p>\n\n<p>Now, the idea to do this that I came up with (and which briefly sounded incredibly elegant) is the following: what if the method (that parses the type descriptor) creates \u2013 but not runs \u2013 a Get Monad that can then <em>later</em> be run with the ByteString that holds the data?</p>\n\n<p>That would necessitate a method such as this:</p>\n\n<pre><code>parseTypeDescriptor :: Get (Get a)\n</code></pre>\n\n<p>Where a is the same type that the descriptor describes (meaning it can take nested forms). Here are some parts of the code right now:</p>\n\n<pre><code>parseTypeDescriptor :: Get (Get a)\n-- first part of the type descriptor is an id (Word8) that implies a type\nparseTypeDescriptor = getWord8 &gt;&gt;= go\n   where go 0 = return getWord8\n         go 1 = return getWord16be\n         go 2 = return getWord32be\n                 ...\n         -- id 5 indicates that the type is an array\n         -- this means two more values are coming;\n         -- the first indicates the array's length, the second its type\n         go 5 = do n      &lt;- getWord8\n                   action &lt;- parseTypeDescriptor\n                   return $ -- TODO --\n</code></pre>\n\n<p>The type of 'action' should be 'Get a'. What I need at -- TODO -- is to construct a value that executes action n times, puts those values in an array, and puts a Get around that array.</p>\n\n<p>Example: if action = getWord16be and n = 2; then TODO ought to be equivalent to this:</p>\n\n<pre><code>TODO :: Get [a]\nTODO = do x &lt;- getWord16be\n          y &lt;- getWord16be\n          return [x,y]\n</code></pre>\n\n<hr>\n\n<p>I have 3 problems with all this:</p>\n\n<ol>\n<li>I don't know what code at -- TODO -- does what I want</li>\n<li>The compiler tells me the root method (parseTypeDescriptors) can't\nreturn more than one type. If it returns Get (Get Word8) it can't\nalso return Get (Get [Word8])</li>\n<li>I am not sure if, when the Top-level Get is run, it can be avoided\nthat the Gets it creates are also run</li>\n</ol>\n\n<p>I'm beginning to suspect that this is actually impossible to do, but I hope I'm wrong-- and that my explanation was understandable.</p>\n"}, {"tags": ["haskell", "quickcheck"], "comments": [{"owner": {"reputation": 48129, "user_id": 76051, "user_type": "registered", "accept_rate": 91, "profile_image": "https://i.stack.imgur.com/AGDxz.jpg?s=128&g=1", "display_name": "Carsten", "link": "https://stackoverflow.com/users/76051/carsten"}, "edited": false, "score": 0, "creation_date": 1469023084, "post_id": 38483248, "comment_id": 64368900, "body": "how did you wrap it in <code>cover</code>?"}, {"owner": {"reputation": 44013, "user_id": 1477667, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/trgKM.jpg?s=128&g=1", "display_name": "dfeuer", "link": "https://stackoverflow.com/users/1477667/dfeuer"}, "edited": false, "score": 0, "creation_date": 1469025968, "post_id": 38483248, "comment_id": 64371112, "body": "You can generate an arbitrary <i>list</i> of cases, count how many pass, and set your own threshold."}, {"owner": {"reputation": 6568, "user_id": 383508, "user_type": "registered", "accept_rate": 82, "profile_image": "https://www.gravatar.com/avatar/d9d61149baeb9e5c9d1432b220e49cd0?s=128&d=identicon&r=PG", "display_name": "fho", "link": "https://stackoverflow.com/users/383508/fho"}, "reply_to_user": {"reputation": 44013, "user_id": 1477667, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/trgKM.jpg?s=128&g=1", "display_name": "dfeuer", "link": "https://stackoverflow.com/users/1477667/dfeuer"}, "edited": false, "score": 0, "creation_date": 1469030503, "post_id": 38483248, "comment_id": 64372847, "body": "@dfeuer yep ... that&#39;s what I am doing now. But this doesn&#39;t seem to be ... <i>elegant</i> :-)"}, {"owner": {"reputation": 44013, "user_id": 1477667, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/trgKM.jpg?s=128&g=1", "display_name": "dfeuer", "link": "https://stackoverflow.com/users/1477667/dfeuer"}, "edited": false, "score": 0, "creation_date": 1469038021, "post_id": 38483248, "comment_id": 64377327, "body": "No, it&#39;s not so elegant, but QuickCheck wasn&#39;t designed for testing Monte Carlo algorithms! To really test what you&#39;re after, you shouldn&#39;t really be counting cases that lie within fixed error bounds anyway. I&#39;m no statistics master, but I think you should probably be looking at some more global error measurement (something in the general nature of the mean of the sum of the squares of the errors, say). The paper itself may give some insight into what that global measurement should be, or you can consult your local statistics expert."}, {"owner": {"reputation": 60057, "user_id": 1333025, "user_type": "registered", "accept_rate": 65, "profile_image": "https://www.gravatar.com/avatar/79ab43010f900324ac5e2de19a2916cb?s=128&d=identicon&r=PG", "display_name": "Petr", "link": "https://stackoverflow.com/users/1333025/petr"}, "edited": false, "score": 0, "creation_date": 1469123862, "post_id": 38483248, "comment_id": 64419867, "body": "There is also another problem: Values in <code>Arbitrary</code> instances are constructed to cover various corner cases and produce relatively small test cases, so they don&#39;t have uniform (or otherwise &quot;nice&quot;) statistical distribution. So it&#39;s difficult to test any statistical properties of algorithms that take such values as inputs. My guess would be that a proper test should start with well defined input distribution and use some kind of <a href=\"https://en.wikipedia.org/wiki/Statistical_hypothesis_testing\" rel=\"nofollow noreferrer\">statistical hypothesis testing</a>."}], "owner": {"reputation": 6568, "user_id": 383508, "user_type": "registered", "accept_rate": 82, "profile_image": "https://www.gravatar.com/avatar/d9d61149baeb9e5c9d1432b220e49cd0?s=128&d=identicon&r=PG", "display_name": "fho", "link": "https://stackoverflow.com/users/383508/fho"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 106, "favorite_count": 2, "answer_count": 0, "score": 4, "last_activity_date": 1469023964, "creation_date": 1469022756, "last_edit_date": 1469023964, "question_id": 38483248, "link": "https://stackoverflow.com/questions/38483248/how-to-quickcheck-an-approximative-algorithm", "title": "How to QuickCheck an approximative algorithm?", "body": "<p>I am testing an approximative algorithm (<em>FastDTW</em>) against the optimal solution by calculating the relative error and comparing that to the errors given in the paper [1]. </p>\n\n<p>Problem is that the errors can get much larger than the ones given in the paper and without setting the tolerance to \"accept all\" there is no way that all tests pass.</p>\n\n<p>Is there a way to tell <code>QuickCheck</code> that I expect only <code>n</code> of the tests to pass? I see that there is the function <a href=\"https://hackage.haskell.org/package/QuickCheck-2.9.1/docs/Test-QuickCheck.html#v:cover\" rel=\"nofollow\"><code>cover</code></a>. But just wrapping the test in that does not seem to work as expected.</p>\n\n<p>Alternatively I could run the test several times manually and pass if at least <code>n</code> tests pass, but I hope that this can be achieved through <code>QuickCheck</code>.</p>\n\n<h3>Edit in response to Carsten</h3>\n\n<p>I wrapped like this:</p>\n\n<pre><code>actualTest :: [Double] -&gt; [Double] -&gt; Bool\nactualTest = ... -- runs dtw and fastDtw, compares errors against goal\n\ncoverTest :: Property\ncoverTest = cover True percentage label actualTest\n</code></pre>\n\n<p>But I am not sure about the first parameter <code>class</code>, or the label one. Thinking about it more ... I guess <code>cover</code> is used to ensure that at least a certain percentage of tests conform to a certain condition.</p>\n\n<p>[1] <a href=\"http://citeseerx.ist.psu.edu/viewdoc/download?doi=10.1.1.432.4253&amp;rep=rep1&amp;type=pdf#page=64\" rel=\"nofollow\">http://citeseerx.ist.psu.edu/viewdoc/download?doi=10.1.1.432.4253&amp;rep=rep1&amp;type=pdf#page=64</a></p>\n"}, {"tags": ["haskell"], "comments": [{"owner": {"reputation": 100185, "user_id": 3234959, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/93bb12ca0f93dfddb33880316f7e66c2?s=128&d=identicon&r=PG&f=1", "display_name": "chi", "link": "https://stackoverflow.com/users/3234959/chi"}, "edited": false, "score": 0, "creation_date": 1469020456, "post_id": 38481712, "comment_id": 64366770, "body": "You code violates the indentation rules: see e.g. <a href=\"http://stackoverflow.com/a/33010779/3234959\">here</a> for a quick summary."}], "answers": [{"tags": [], "owner": {"reputation": 48129, "user_id": 76051, "user_type": "registered", "accept_rate": 91, "profile_image": "https://i.stack.imgur.com/AGDxz.jpg?s=128&g=1", "display_name": "Carsten", "link": "https://stackoverflow.com/users/76051/carsten"}, "is_accepted": false, "score": 5, "last_activity_date": 1469021406, "last_edit_date": 1469021406, "creation_date": 1469019410, "answer_id": 38481971, "question_id": 38481712, "link": "https://stackoverflow.com/questions/38481712/why-wont-this-load-into-ghci/38481971#38481971", "title": "Why won&#39;t this load into GHCI", "body": "<p>it's not the whitespaces - it's the <code>let</code> (and you have to indent the body of <code>partial_sums</code> as chi mentioned - sorry I didn't check this at first):</p>\n\n<p>if you want to define the function in a <code>.hs</code> file you should write something like this:</p>\n\n<pre><code>partialsums lst = reverse ( partial_sums lst 0 [] ) where\n                  partial_sums ls accum accumulator_list = \n                     if ls == [] then accumulator_list else\n                     partial_sums ( tail ls ) ( accum + head ls ) \n                     ((accum + head ls) : accumulator_list)\n</code></pre>\n\n<p>although I would write it more like this:</p>\n\n<pre><code>partialsums lst = reverse ( partial_sums lst 0 [] ) \n   where\n      partial_sums ls accum accumulator_list = \n         if ls == [] \n         then accumulator_list \n         else\n            partial_sums ( tail ls ) ( accum + head ls ) \n                  ((accum + head ls) : accumulator_list)\n</code></pre>\n\n<hr>\n\n<h3>improving on it</h3>\n\n<p>I would further suggest to add a <em>signature</em> and to use pattern-matching instead of the <code>if</code>, <code>head</code> and <code>tail</code> like this:</p>\n\n<pre><code>partialsums :: Num a =&gt; [a] -&gt; [a]\npartialsums lst = reverse ( partial_sums lst 0 [] ) \n   where\n      partial_sums [] _ accumulator_list = accumulator_list\n      partial_sums (h:tl) accum accumulator_list =\n            let accum' = accum + h in\n            partial_sums tl accum' (accum' : accumulator_list)\n</code></pre>\n\n<p>all should give you:</p>\n\n<pre><code>&gt; partialsums [1..5]\n[1,3,6,10,15]\n</code></pre>\n\n<hr>\n\n<h3>using <code>scanl1</code></h3>\n\n<p>fun fact: you can actually use <code>scanl1</code> to define this very easy:</p>\n\n<pre><code>partialSums :: Num a =&gt; [a] -&gt; [a]\npartialSums = scanl1 (+)\n</code></pre>\n"}, {"tags": [], "owner": {"reputation": 175, "user_id": 6100902, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/a6258d0cd48308d643be416d03c73d4e?s=128&d=identicon&r=PG&f=1", "display_name": "Douglas Lewit", "link": "https://stackoverflow.com/users/6100902/douglas-lewit"}, "is_accepted": false, "score": 0, "last_activity_date": 1469113428, "creation_date": 1469113428, "answer_id": 38507802, "question_id": 38481712, "link": "https://stackoverflow.com/questions/38481712/why-wont-this-load-into-ghci/38507802#38507802", "title": "Why won&#39;t this load into GHCI", "body": "<p>Thanks for the great answers!  When is it appropriate to use the \"let\" keyword?  Yes, that's exactly why I could not load my function definition into GHCI.  </p>\n\n<p>I've also been playing around with Python.  Python's list comprehensions are just wonderful.  In Python the partialsums function could be written like this:</p>\n\n<p>def partialsums(array):\n   return [sum([array[n] for n in range(0, t + 1)]) for t in range(0, len(array))]</p>\n\n<p>I know Haskell uses list comprehensions as well, but for Haskell the syntax is a little different.  Any ideas on how I could do something similar in Haskell?  Thanks for the help!  ( Don't worry.  This is not for a class.  I'm just trying to figure out Haskell on my own.  I thought I would try it.  A fun language, but definitely challenging. )</p>\n"}], "owner": {"reputation": 175, "user_id": 6100902, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/a6258d0cd48308d643be416d03c73d4e?s=128&d=identicon&r=PG&f=1", "display_name": "Douglas Lewit", "link": "https://stackoverflow.com/users/6100902/douglas-lewit"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 81, "favorite_count": 0, "answer_count": 2, "score": 0, "last_activity_date": 1469113428, "creation_date": 1469018688, "last_edit_date": 1469018787, "question_id": 38481712, "link": "https://stackoverflow.com/questions/38481712/why-wont-this-load-into-ghci", "title": "Why won&#39;t this load into GHCI", "body": "<p>I don't understand why this won't load into the interactive Haskell interpreter.  When I type the function definition directly into GHCI it works just great.  But when I try to load the function definition from a .hs file, that's when I get an error message.  Any ideas?  Thanks for the help.</p>\n\n<pre><code>let partialsums lst = reverse ( partial_sums lst 0 [] ) where\n                      partial_sums ls accum accumulator_list = \n                      if ls == [] then accumulator_list else\n                      partial_sums ( tail ls ) ( accum + head ls ) \n                      ((accum + head ls) : accumulator_list)\n</code></pre>\n\n<p>I've tried this same function definition in Python, Ruby and Ocaml.  No problems at all!  ( Python's whitespace rules are simple and intuitive.  Ruby and Ocaml do not read whitespace.  In those languages whitespace is strictly there for the convenience of the person reading the program.  But I think Haskell has some pretty strict whitespace rules that I'm not familiar with. )  </p>\n\n<p>Thanks for the help.  Haskell sure looks interesting, but it's a hard, hard language to learn without the supervision or guidance of a good professor.  I'm just trying to learn the language on my own.</p>\n"}, {"tags": ["haskell", "cabal", "haskell-stack", "hakyll"], "comments": [{"owner": {"reputation": 43759, "user_id": 1651941, "user_type": "registered", "accept_rate": 97, "profile_image": "https://www.gravatar.com/avatar/a513bc1fa519d2fcf5e4e0d9b5500101?s=128&d=identicon&r=PG", "display_name": "Sibi", "link": "https://stackoverflow.com/users/1651941/sibi"}, "edited": false, "score": 0, "creation_date": 1469016025, "post_id": 38478048, "comment_id": 64363415, "body": "What is your <code>stack</code> version ? Also, why don&#39;t you just try <code>stack install hakyll</code> (although your command should also work)."}, {"owner": {"reputation": 3754, "user_id": 604382, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/b768ebe08698de5cf097fbaa2e66f9cf?s=128&d=identicon&r=PG", "display_name": "declension", "link": "https://stackoverflow.com/users/604382/declension"}, "reply_to_user": {"reputation": 43759, "user_id": 1651941, "user_type": "registered", "accept_rate": 97, "profile_image": "https://www.gravatar.com/avatar/a513bc1fa519d2fcf5e4e0d9b5500101?s=128&d=identicon&r=PG", "display_name": "Sibi", "link": "https://stackoverflow.com/users/1651941/sibi"}, "edited": false, "score": 0, "creation_date": 1469016135, "post_id": 38478048, "comment_id": 64363492, "body": "Hi. This is Stack <code>1.1.2</code>, and I did try that - it&#39;s just to indicate what resolver I&#39;m using really."}, {"owner": {"reputation": 43759, "user_id": 1651941, "user_type": "registered", "accept_rate": 97, "profile_image": "https://www.gravatar.com/avatar/a513bc1fa519d2fcf5e4e0d9b5500101?s=128&d=identicon&r=PG", "display_name": "Sibi", "link": "https://stackoverflow.com/users/1651941/sibi"}, "edited": false, "score": 2, "creation_date": 1469016828, "post_id": 38478048, "comment_id": 64363956, "body": "This seems strange. Can you nuke your <code>~&#47;.stack</code> and try again ?"}, {"owner": {"reputation": 3754, "user_id": 604382, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/b768ebe08698de5cf097fbaa2e66f9cf?s=128&d=identicon&r=PG", "display_name": "declension", "link": "https://stackoverflow.com/users/604382/declension"}, "reply_to_user": {"reputation": 43759, "user_id": 1651941, "user_type": "registered", "accept_rate": 97, "profile_image": "https://www.gravatar.com/avatar/a513bc1fa519d2fcf5e4e0d9b5500101?s=128&d=identicon&r=PG", "display_name": "Sibi", "link": "https://stackoverflow.com/users/1651941/sibi"}, "edited": false, "score": 0, "creation_date": 1469024832, "post_id": 38478048, "comment_id": 64370262, "body": "@sibi that worked! No idea why... but thanks! If you want to make it an answer I can accept (though am interested what was happening still)"}, {"owner": {"reputation": 4071, "user_id": 3806046, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/5fedf50ce7cd2659bca902e9a2969158?s=128&d=identicon&r=PG&f=1", "display_name": "jkeuhlen", "link": "https://stackoverflow.com/users/3806046/jkeuhlen"}, "edited": false, "score": 0, "creation_date": 1469025149, "post_id": 38478048, "comment_id": 64370522, "body": "Flagging to close since it doesn&#39;t seem reproducible any ways."}], "answers": [{"tags": [], "owner": {"reputation": 43759, "user_id": 1651941, "user_type": "registered", "accept_rate": 97, "profile_image": "https://www.gravatar.com/avatar/a513bc1fa519d2fcf5e4e0d9b5500101?s=128&d=identicon&r=PG", "display_name": "Sibi", "link": "https://stackoverflow.com/users/1651941/sibi"}, "is_accepted": true, "score": 1, "last_activity_date": 1470167690, "last_edit_date": 1470167690, "creation_date": 1469177023, "answer_id": 38521980, "question_id": 38478048, "link": "https://stackoverflow.com/questions/38478048/hakyll-build-failing-using-stack/38521980#38521980", "title": "Hakyll build failing using Stack", "body": "<p>My guess is that you have corrupted packages in your <code>~/.stack</code>.</p>\n\n<p>So nuking <code>~/.stack</code> and trying to install again would be a good check to see if that is the case.</p>\n"}], "owner": {"reputation": 3754, "user_id": 604382, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/b768ebe08698de5cf097fbaa2e66f9cf?s=128&d=identicon&r=PG", "display_name": "declension", "link": "https://stackoverflow.com/users/604382/declension"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 264, "favorite_count": 0, "accepted_answer_id": 38521980, "answer_count": 1, "score": 1, "last_activity_date": 1483518573, "creation_date": 1469008629, "last_edit_date": 1483518573, "question_id": 38478048, "link": "https://stackoverflow.com/questions/38478048/hakyll-build-failing-using-stack", "title": "Hakyll build failing using Stack", "body": "<p>When building <a href=\"https://jaspervdj.be/hakyll/\" rel=\"nofollow\">Hakyll</a> using Stack <a href=\"https://jaspervdj.be/hakyll/tutorials/01-installation.html\" rel=\"nofollow\">as suggested</a>, I do something like this (pinning the resolver version for immutability):</p>\n\n<pre><code>$ stack --resolver lts-6.6 install hakyll\n</code></pre>\n\n<p>But what I get is:</p>\n\n<pre>Progress: 10/23\n--  While building package x509-1.6.3 using:\n      /home/nick/.stack/setup-exe-cache/x86_64-linux/setup-Simple-Cabal-1.22.5.0-ghc-7.10.3 --builddir=.stack-work/dist/x86_64-linux/Cabal-1.22.5.0 configure --with-ghc=/home/nick/.stack/programs/x86_64-linux/ghc-7.10.3/bin/ghc --with-ghc-pkg=/home/nick/.stack/programs/x86_64-linux/ghc-7.10.3/bin/ghc-pkg --user --package-db=clear --package-db=global --package-db=/home/nick/.stack/snapshots/x86_64-linux/lts-6.7/7.10.3/pkgdb --libdir=/home/nick/.stack/snapshots/x86_64-linux/lts-6.7/7.10.3/lib --bindir=/home/nick/.stack/snapshots/x86_64-linux/lts-6.7/7.10.3/bin --datadir=/home/nick/.stack/snapshots/x86_64-linux/lts-6.7/7.10.3/share --libexecdir=/home/nick/.stack/snapshots/x86_64-linux/lts-6.7/7.10.3/libexec --sysconfdir=/home/nick/.stack/snapshots/x86_64-linux/lts-6.7/7.10.3/etc --docdir=/home/nick/.stack/snapshots/x86_64-linux/lts-6.7/7.10.3/doc/x509-1.6.3 --htmldir=/home/nick/.stack/snapshots/x86_64-linux/lts-6.7/7.10.3/doc/x509-1.6.3 --haddockdir=/home/nick/.stack/snapshots/x86_64-linux/lts-6.7/7.10.3/doc/x509-1.6.3 --dependency=asn1-encoding=asn1-encoding-0.9.4-52d17dc2a2e779a5ef2b648ff3af0b8d --dependency=asn1-parse=asn1-parse-0.9.4-43faa79aaa0849b68c778a71952dc386 --dependency=asn1-types=asn1-types-0.3.2-29bde644dfae66857755e962eab5b971 --dependency=base=base-4.8.2.0-0d6d1084fbc041e1cded9228e80e264d --dependency=bytestring=bytestring-0.10.6.0-9a873bcf33d6ce2fd2698ce69e2c1c66 --dependency=containers=containers-0.5.6.2-59326c33e30ec8f6afd574cbac625bbb --dependency=cryptonite=cryptonite-0.15-34cd3a38b66fe576d3e80f28bfa0826d --dependency=hourglass=hourglass-0.2.10-337cca0f9d281b8b30d82ffb2a5abd50 --dependency=memory=memory-0.13-039b91f332a8ac781f93bf90ac1b3d77 --dependency=mtl=mtl-2.2.1-3af90341e75ee52dfc4e3143b4e5d219 --dependency=pem=pem-0.2.2-5f6df2ca3b7f68abc9010881cb82b5dd\n    Process exited with code: ExitFailure 1\n    Logs have been written to: /home/nick/.stack/global-project/.stack-work/logs/x509-1.6.3.log\n\n    Configuring x509-1.6.3...\n    setup-Simple-Cabal-1.22.5.0-ghc-7.10.3: The following installed packages are\n    broken because other packages they depend on are missing. These broken\n    packages must be rebuilt before they can be used.\n    package pem-0.2.2 is broken due to missing package\n    base64-bytestring-1.0.0.1-4aa13e7ac7c5b00cc0cd642708d4e148,\n    bytestring-0.10.6.0-c60f4c543b22c7f7293a06ae48820437\n</pre>\n\n<p>I've tried various other <code>lts-*</code> resolvers but no luck there either, and can't really work out what's needed to fix the build issue... especially being a bit of a newbie here... Any ideas, please?</p>\n"}, {"tags": ["parsing", "haskell"], "comments": [{"owner": {"reputation": 12533, "user_id": 931027, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/lWhaB.jpg?s=128&g=1", "display_name": "Kusalananda", "link": "https://stackoverflow.com/users/931027/kusalananda"}, "edited": false, "score": 0, "creation_date": 1468947297, "post_id": 38464298, "comment_id": 64332642, "body": "It would be nice to know what language this is..."}, {"owner": {"reputation": 339644, "user_id": 118068, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/077db5466d3b58e7bbbd498dca173f04?s=128&d=identicon&r=PG", "display_name": "Marc B", "link": "https://stackoverflow.com/users/118068/marc-b"}, "edited": false, "score": 0, "creation_date": 1468947316, "post_id": 38464298, "comment_id": 64332653, "body": "what lang is this? python?"}, {"owner": {"reputation": 53, "user_id": 6307484, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/3e5b72ed4f2a61899601cbf5ac63c6f1?s=128&d=identicon&r=PG&f=1", "display_name": "Janet2001", "link": "https://stackoverflow.com/users/6307484/janet2001"}, "edited": false, "score": 0, "creation_date": 1468947649, "post_id": 38464298, "comment_id": 64332824, "body": "sorry its haskell!"}, {"owner": {"reputation": 2666, "user_id": 382780, "user_type": "registered", "accept_rate": 80, "profile_image": "https://www.gravatar.com/avatar/7e2b7c885cfa6c044bd14500052d2060?s=128&d=identicon&r=PG", "display_name": "31eee384", "link": "https://stackoverflow.com/users/382780/31eee384"}, "edited": false, "score": 1, "creation_date": 1468947932, "post_id": 38464298, "comment_id": 64332965, "body": "What are <code>replace</code> and <code>use</code>?"}, {"owner": {"reputation": 53, "user_id": 6307484, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/3e5b72ed4f2a61899601cbf5ac63c6f1?s=128&d=identicon&r=PG&f=1", "display_name": "Janet2001", "link": "https://stackoverflow.com/users/6307484/janet2001"}, "edited": false, "score": 0, "creation_date": 1468948116, "post_id": 38464298, "comment_id": 64333072, "body": "i thought there where orders. could i replace them with something else?"}, {"owner": {"reputation": 44013, "user_id": 1477667, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/trgKM.jpg?s=128&g=1", "display_name": "dfeuer", "link": "https://stackoverflow.com/users/1477667/dfeuer"}, "edited": false, "score": 1, "creation_date": 1468964477, "post_id": 38464298, "comment_id": 64342052, "body": "I&#39;m voting to close this question as off-topic because Stack Overflow is not a substitute for a tutorial, book, or teacher when beginning to learn a new programming language."}, {"owner": {"reputation": 44013, "user_id": 1477667, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/trgKM.jpg?s=128&g=1", "display_name": "dfeuer", "link": "https://stackoverflow.com/users/1477667/dfeuer"}, "edited": false, "score": 0, "creation_date": 1468964699, "post_id": 38464298, "comment_id": 64342144, "body": "Aside from all the good advice @ErikR gives, you should reconsider <code>c</code> and <code>d</code>. Why does <code>bonuspunkte</code> need to take two Boolean variables if it&#39;s only going to combine them? The simplest change is to make it take just <i>one</i>, and require the caller to combine them. But really, I&#39;d skip that part altogether, and let the caller decide whether to apply the bonus."}, {"owner": {"reputation": 45534, "user_id": 106104, "user_type": "registered", "accept_rate": 62, "profile_image": "https://www.gravatar.com/avatar/c88b9310b92a937108ec4336c2832f92?s=128&d=identicon&r=PG", "display_name": "user253751", "link": "https://stackoverflow.com/users/106104/user253751"}, "edited": false, "score": 0, "creation_date": 1469068698, "post_id": 38464298, "comment_id": 64388704, "body": "@Janet2001 Why did you think that?"}], "answers": [{"tags": [], "owner": {"reputation": 49959, "user_id": 866915, "user_type": "registered", "accept_rate": 70, "profile_image": "https://www.gravatar.com/avatar/09242131d6e17cbbe31e8547514da6e5?s=128&d=identicon&r=PG", "display_name": "ErikR", "link": "https://stackoverflow.com/users/866915/erikr"}, "is_accepted": true, "score": 4, "last_activity_date": 1468948742, "creation_date": 1468948742, "answer_id": 38464751, "question_id": 38464298, "link": "https://stackoverflow.com/questions/38464298/parse-error-on-input-if-why/38464751#38464751", "title": "parse error on input \u2018if\u2019 - why?", "body": "<p>You cannot change the value a variable is bound to in Haskell. You can, however, create a new variable names.</p>\n\n<pre><code>bonuspunkte a b c d =\n  let a' = min 480 a\n      b' = min 375 b\n  in if c &amp;&amp; d then (11.5 *(a'/480)) + (8.5 *(b'/375))\n               else 0\n</code></pre>\n\n<p>Note how the variables <code>a'</code> and <code>b'</code> - not <code>a</code> and <code>b</code> - are used in the formula in the if-then-else statement.</p>\n\n<p>Also note the indentation. Like Python, Haskell is an indentation significant language.</p>\n"}], "owner": {"reputation": 53, "user_id": 6307484, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/3e5b72ed4f2a61899601cbf5ac63c6f1?s=128&d=identicon&r=PG&f=1", "display_name": "Janet2001", "link": "https://stackoverflow.com/users/6307484/janet2001"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 415, "favorite_count": 0, "accepted_answer_id": 38464751, "answer_count": 1, "score": -2, "last_activity_date": 1468948742, "creation_date": 1468947107, "last_edit_date": 1468947716, "question_id": 38464298, "link": "https://stackoverflow.com/questions/38464298/parse-error-on-input-if-why", "title": "parse error on input \u2018if\u2019 - why?", "body": "<p>I dont know why my programme doesnt work, my ghci shows always the following \"parse error on input <code>if</code> \".\nThis is my code:</p>\n\n<pre><code>import Data.List\nimport System.IO\n\nbonuspunkte c d a b =\n\nif (a &gt; 480) then replace a \"480\" else use a\nif (b &gt; 375) then replace b \"375\" else use b    \n\nif (c == True) &amp;&amp; (d == True)   \n\nthen (11.5 *(a/480)) + (8.5 *(b/375))\nelse 0\n</code></pre>\n\n<p>I am also not quite sure about the \"replace\" operation, my idea was, that if a is bigger then 480, then you should go on working with 480 though. same with b.\nI'd be very grateful if somebody could help me.</p>\n"}, {"tags": ["haskell", "types", "linguistics"], "answers": [{"comments": [{"owner": {"reputation": 25144, "user_id": 477476, "user_type": "registered", "accept_rate": 85, "profile_image": "https://i.stack.imgur.com/Qf4TT.png?s=128&g=1", "display_name": "Cactus", "link": "https://stackoverflow.com/users/477476/cactus"}, "edited": false, "score": 1, "creation_date": 1468998830, "post_id": 38464554, "comment_id": 64352155, "body": "You don&#39;t need a dedicated <code>Nil</code> constructor: the empty <code>Map</code> will work just as well (and gets rid of the <code>Nil</code> / <code>Trie mempty</code> redundancy)"}], "tags": [], "owner": {"reputation": 49959, "user_id": 866915, "user_type": "registered", "accept_rate": 70, "profile_image": "https://www.gravatar.com/avatar/09242131d6e17cbbe31e8547514da6e5?s=128&d=identicon&r=PG", "display_name": "ErikR", "link": "https://stackoverflow.com/users/866915/erikr"}, "is_accepted": true, "score": 6, "last_activity_date": 1468948068, "creation_date": 1468948068, "answer_id": 38464554, "question_id": 38463452, "link": "https://stackoverflow.com/questions/38463452/representing-types-and-occurrences-so-easy-to-understand-so-difficult-to-c/38464554#38464554", "title": "Representing Types And Occurrences: (so) easy to understand, (so) difficult to code", "body": "<p>You need to define a recursive data structure like this:</p>\n\n<pre><code>data Trie = Nil | Trie (Map Char (Int, Trie))\n</code></pre>\n\n<p>This allows the show and add functions to be defined recursively.</p>\n\n<p>Here is an implementation. Run <code>test3</code> to see an example of how it works.</p>\n\n<pre><code>import qualified Data.Map as M\nimport Text.PrettyPrint\nimport Data.List\n\ndata Trie = Nil | Trie (M.Map Char (Int, Trie))\n\nshowTrie :: String -&gt; Trie -&gt; Doc\nshowTrie _ Nil = empty\nshowTrie prefix (Trie m) =\n  vcat $ \n    do (k,(count,t)) &lt;- M.assocs m\n       let prefix' = prefix ++ [k]\n       return $\n         vcat [ lparen &lt;&gt; char '\"' &lt;&gt; text prefix' &lt;&gt; char '\"' &lt;&gt; comma &lt;&gt; int count &lt;&gt; rparen\n              , nest 4 (showTrie prefix' t)\n              ]\n\n-- add an element to a Trie\naddTrie :: Trie -&gt; String -&gt; Trie\naddTrie t [] = t\naddTrie Nil xs = addTrie (Trie M.empty) xs\naddTrie (Trie m) (x:xs) = \n  case M.lookup x m of\n    Nothing     -&gt; let t' = addTrie Nil xs\n                   in Trie $ M.insert x (1,t') m\n    Just (c,t)  -&gt; let t' = addTrie t xs\n                   in Trie $ M.insert x (c+1,t') m\n\ntest1 = \n  let t1 = addTrie Nil \"abcd\"\n      t2 = addTrie t1  \"abce\"\n  in putStrLn $ render $ showTrie \"\" t2\n\ntest2 n str =\n  putStrLn $ render $ showTrie \"\" $\n      foldr (flip addTrie) Nil (map (take n) (tails str))\n\ntest3 = test2 4 \"31415926535897932384626433832795028841971693993751058209749445923078164062862089986280348253421170679821480865132823066470938446095505822317253594081284811174502841027019385211055596446229489549303819644288109756659334461284756\"\n</code></pre>\n"}], "owner": {"reputation": 1069, "user_id": 2153280, "user_type": "registered", "accept_rate": 82, "profile_image": "https://i.stack.imgur.com/zkQvQ.jpg?s=128&g=1", "display_name": "Alberto Capitani", "link": "https://stackoverflow.com/users/2153280/alberto-capitani"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 104, "favorite_count": 1, "accepted_answer_id": 38464554, "answer_count": 1, "score": 1, "last_activity_date": 1468958157, "creation_date": 1468944094, "last_edit_date": 1468958157, "question_id": 38463452, "link": "https://stackoverflow.com/questions/38463452/representing-types-and-occurrences-so-easy-to-understand-so-difficult-to-c", "title": "Representing Types And Occurrences: (so) easy to understand, (so) difficult to code", "body": "<p>A brief introduction to the types and occurrences through examples.</p>\n\n<blockquote>\n  <p>Ex1. <code>abbacb</code></p>\n  \n  <p><code>a</code>, <code>b</code>, <code>c</code> are the types.</p>\n  \n  <p><code>a</code> occurres 2 times; <code>b</code> occurres 3 times; <code>c</code> occurres 1 times.</p>\n</blockquote>\n\n<p>This can be represented more concisely as <code>[('a',2),('b',3),('c',1)]</code> (Indeed, the order doesn't matter).</p>\n\n<blockquote>\n  <p>Ex2. <code>abbacb</code></p>\n  \n  <p><code>ab</code>, <code>bb</code>, <code>ba</code>, <code>ac</code>, <code>cb</code> are sequences of types</p>\n  \n  <p>Each sequence occurs only once.</p>\n</blockquote>\n\n<p>This can be represented as <code>[(\"ab\",1),(\"bb\",1),(\"ba\",1),(\"ac\",1),(\"cb\",1)]</code></p>\n\n<p>The following graphical structure has the same informative content of the previous two:</p>\n\n<pre><code>('a',2)          -- 'a'  occurs 2 times\n     ('b',1)     -- \"ab\" occurs 1 times\n     ('c',1)     -- \"ac\" occurs 1 times\n('b',2)          -- 'b'  occurs 2 times\n     ('a',1)     -- \"ba\" occurs 1 times\n     ('b',1)     -- \"bb\" occurs 1 times\n('c',1)          -- 'c'  occurs 1 times\n     ('b',1)     -- \"cb\" occurs 1 times\n</code></pre>\n\n<p>In Haskell: <code>[(('a',2),[('b',1),('c',1)]),(('b',2),[('a',1),('b',1)]),(('c',1),[('b',1)])]</code></p>\n\n<p>For occurrences of sequences of 3 elements:</p>\n\n<pre><code>('a',2)              -- 'a'   occurs 2 times\n     ('b',1)         -- \"ab\"  occurs 1 times\n          ('b',1)    -- \"abb\" occurs 1 times\n     ('c',1)         -- \"ac\"  occurs 1 times\n          ('b',1)    -- \"acb\" occurs 1 times\n...\n</code></pre>\n\n<p>In Haskell: </p>\n\n<pre><code>[\n    (('a',2), [(('b',1),[('b',1)]),(('c',1),[('b',1)])]),\n    (('b',2), [(('a',1),[('c',1)]),(('b',1),[('a',1)])])\n]\n</code></pre>\n\n<p>with type <code>[((Char, Int), [((Char, Int), [(Char, Int)])])]</code></p>\n\n<p>Even considering only the sequences of two and three elements, the comprehensibility of the graphical representation is much greater than that in Haskell.</p>\n\n<p>In addition, lists are not very efficient, so I used the <code>Data.Map</code> library and consequently a slightly different representation.</p>\n\n<p>The following examples are based on Pi's digits. Interesting results can be obtained using the words of a novel.</p>\n\n<p><strong>My questions are</strong>:</p>\n\n<ol>\n<li><p>Functions dedicated to the sequences of the three types are very complicated. It is possible to <em>drastically simplify</em> them?</p></li>\n<li><p>I cannot even imagine how it is possible to generalize the functions for <em>sequences of arbitrary length</em>. Someone has an idea of how it could be done?</p></li>\n<li><p>Using the following data type recursion should be easier to implement:</p>\n\n<pre><code>data TuplesTypesOccurences a = L (M.Map a Int) | B  (M.Map a (Int,TuplesTypesOccurences a))\n</code></pre>\n\n<p>In this way however does not lose access to all of the functions in <code>Data.Map</code> library?</p>\n\n<pre><code>import qualified Data.Map as M\nimport Data.List (sortBy)\n\npiDigits = \"31415926535897932384626433832795028841971693993751058209749445923078164062862089986280348253421170679821480865132823066470938446095505822317253594081284811174502841027019385211055596446229489549303819644288109756659334461284756\"\n\ntype TypesOccurrences a = M.Map a Int\n\ntoTypeOccurrences :: Ord k =&gt; [k] -&gt; TypesOccurrences k -&gt; TypesOccurrences k  \ntoTypeOccurrences [] mp = mp\ntoTypeOccurrences (x:xs) mp = toTypeOccurrences xs $ M.insertWith (+) x 1 mp\n-- ex. toTypeOccurrences piDigits M.empty\n\npprintTO :: Show a =&gt; TypesOccurrences a -&gt; IO ()\npprintTO = mapM_ putStrLn . map (\\(xs,n) -&gt; show xs ++ \"  \" ++ (show n)). sortBy (\\x y -&gt; compare (snd y) (snd x)) . M.toList\n-- ex. pprintTO . M.filter (&gt; 22) . toTypeOccurrences piDigits $ M.empty\n\ntype Seq2TypeOccurrences a = M.Map a (Int,TypesOccurrences a)\n\ntoSQ2TO :: Ord a =&gt; [a] -&gt; Seq2TypeOccurrences a -&gt; Seq2TypeOccurrences a\ntoSQ2TO []       mp = mp\ntoSQ2TO [x]      mp = mp\ntoSQ2TO (x:y:xs) mp = toSQ2TO (y:xs) $\n  case M.lookup x mp of\n    Nothing       -&gt; M.insert x (1,M.singleton y 1) mp\n    Just (_,mp2) -&gt; case M.lookup y mp2 of\n        Nothing -&gt; M.update (\\(n,mp2) -&gt; Just (n+1,M.insert y 1 mp2)) x mp\n        Just _  -&gt; M.update (\\(n,mp2) -&gt; Just (n+1,M.update (\\m -&gt; Just (m+1)) y mp2)) x mp\n-- ex. toSQ2TO piDigits M.empty\n\npprintSQ2TO :: Show a =&gt; Seq2TypeOccurrences a -&gt; IO ()\npprintSQ2TO = mapM_ putStrLn . map (\\(x,(n,mp)) -&gt; \"(\" ++ (show x) ++ \",\" ++ (show n) ++ \")\\n\\t\" ++ (drop 2 . concatMap ((\"\\n\\t\" ++) . show) . M.toList $ mp)) . M.toList\n-- ex. pprintSQ2TO (toSQ2TO piDigits  M.empty)\n\ngreaterThanSQ2TO :: Ord a =&gt; Int -&gt; Seq2TypeOccurrences a -&gt; Seq2TypeOccurrences a\ngreaterThanSQ2TO n =   M.filter (\\(_,mp2) -&gt; not . M.null $ mp2) . M.map (\\(o,mp2) -&gt; (o,M.filter (&gt; n) mp2)) . M.filter (\\(m,mp) -&gt; m &gt; n)\n-- ex. pprintSQ2TO . greaterThanSQ2TO 4 . toSQ2TO piDigits $ M.empty\n\ndescSortSQ2TO :: Ord a =&gt; Seq2TypeOccurrences a -&gt; [([a], Int)]\ndescSortSQ2TO = sortBy (\\xs ys -&gt; compare (snd ys) (snd xs)) . concatMap (\\(x,ys) -&gt; zipWith (\\x (y,n) -&gt; ([x,y],n)) (repeat x) ys ) . map (\\(x,(_,mp2)) -&gt; (x,M.toList mp2)) . M.toList\n-- mapM_ print . descSortSQ2TO . greaterThanSQ2TO 4 . toSQ2TO piDigits $ M.empty\n\nunionSQ2TO :: Ord a =&gt; Seq2TypeOccurrences a -&gt; Seq2TypeOccurrences a -&gt; Seq2TypeOccurrences a\nunionSQ2TO = M.unionWith (\\(n1,mp1) (n2,mp2) -&gt; (n1+n2, M.unionWith (+) mp1 mp2))\n\ntype Seq3TypeOccurrences a = M.Map a (Int,Seq2TypeOccurrences a)\n\ntoSQ3TO :: Ord k =&gt; [k] -&gt; Seq3TypeOccurrences k -&gt; Seq3TypeOccurrences k\ntoSQ3TO []    mp = mp\ntoSQ3TO [x]   mp = mp\ntoSQ3TO [x,y] mp = mp\ntoSQ3TO (x:y:z:xs) mp = toSQ3TO (y:z:xs) $\n  case M.lookup x mp of\n    Nothing -&gt; M.insert x (1,M.singleton y (1,M.singleton z 1)) mp\n    Just (_,mp2) -&gt; case M.lookup y mp2 of\n       Nothing -&gt; M.update (\\(n,mp2) -&gt; Just (n+1,M.insert y (1,M.singleton z 1) mp2)) x mp\n       Just (m,kns3)  -&gt; case M.lookup z kns3 of\n            Nothing -&gt; M.update (\\(n,_) -&gt; Just (n+1,M.update (\\(m,mp3) -&gt; Just (m+1,M.insert z 1    mp3)) y mp2)) x mp\n            Just _  -&gt; M.update (\\(n,_) -&gt; Just (n+1,M.update (\\(m,mp3) -&gt; Just (m+1,M.update (Just . (+1)) z mp3)) y mp2)) x mp\n-- ex. toSQ3TO piDigits M.empty\n\npprint3 :: Show a =&gt; Seq3TypeOccurrences a -&gt; IO ()\npprint3 = mapM_ putStrLn . map (\\(x,(n,mp)) -&gt; \"(\" ++ (show x) ++ \",\" ++ (show n) ++ \")\" ++ (concatMap (\\(x2,(n2,mp2)) -&gt; \"\\n\\t(\" ++ (show x2) ++ \",\" ++ (show n2) ++ \")\" ++ (f mp2)) . M.toList $ mp)) . M.toList\n  where\n  f = concatMap (\\(x,n) -&gt; \"\\n\\t\\t(\" ++ (show x) ++ \",\" ++ (show n) ++ \")\") . M.toList\n-- pprint3 . toSQ3TO piDigits $ M.empty  \n\npprint3B :: Show a =&gt; Seq3TypeOccurrences a -&gt; IO ()\npprint3B = mapM_ putStrLn . map (\\(xs,n) -&gt; show xs ++ \"  \" ++ (show n)) . concatMap (\\(xs,mp) -&gt; zipWith (\\ys (z,n) -&gt; (ys ++ [z],n)) (repeat xs) mp) . concatMap (\\(x,mp) -&gt; zipWith (\\y (z,mp2) -&gt; ([y,z],mp2)) (repeat x) mp) . map (\\(x,(_,mp)) -&gt; (x, map (\\(y,(_,mp2)) -&gt; (y, M.toList mp2)) $ M.toList mp)) . M.toList\n-- pprint3B . toSQ3TO piDigits $ M.empty \n\ngreaterThan3Q2TO :: Ord a =&gt; Int -&gt; Seq3TypeOccurrences a -&gt;  Seq3TypeOccurrences a\ngreaterThan3Q2TO n = M.filter (\\(_,mp) -&gt; not . M.null $ mp)\n  . M.map (\\(m,mp) -&gt; (m,M.filter (\\(o,mp2) -&gt; not . M.null $ mp2) mp))\n  . M.map (\\(m,mp) -&gt; (m,M.map (\\(o,mp2) -&gt; (o,M.filter (&gt;n) mp2)) mp))\n  . M.filter (\\(_,mp) -&gt; not. M.null $ mp)\n  . M.map (\\(m,mp) -&gt; (m,M.filter ((n &lt;) . fst) mp))\n  . M.filter (\\(m,mp) -&gt; m &gt; n)\n-- ex. pprint3B . greaterThan3Q2TO 2 . toSQ3TO piDigits $ M.empty\n\nunionSQ3TO :: Ord a =&gt; Seq3TypeOccurrences a -&gt; Seq3TypeOccurrences a -&gt; Seq3TypeOccurrences a\nunionSQ3TO = M.unionWith (\\(n,mp2a) (m,mp2b) -&gt; (n+m,unionSQ2TO mp2a mp2b))\n</code></pre></li>\n</ol>\n"}, {"tags": ["haskell", "polymorphism"], "comments": [{"owner": {"reputation": 49959, "user_id": 866915, "user_type": "registered", "accept_rate": 70, "profile_image": "https://www.gravatar.com/avatar/09242131d6e17cbbe31e8547514da6e5?s=128&d=identicon&r=PG", "display_name": "ErikR", "link": "https://stackoverflow.com/users/866915/erikr"}, "edited": false, "score": 2, "creation_date": 1468943587, "post_id": 38463040, "comment_id": 64330430, "body": "What exactly do you mean by &quot;<i>Num is able to coerce to Double or Integer with no issue</i>&quot;?"}, {"owner": {"reputation": 62421, "user_id": 216164, "user_type": "registered", "accept_rate": 89, "profile_image": "https://www.gravatar.com/avatar/786f224adbe0784cdf7d0f15476061fe?s=128&d=identicon&r=PG", "display_name": "Thomas M. DuBuisson", "link": "https://stackoverflow.com/users/216164/thomas-m-dubuisson"}, "edited": false, "score": 0, "creation_date": 1468951968, "post_id": 38463040, "comment_id": 64335353, "body": "<code>Num</code> is not a type.  I think your questions can be answered by learning about type classes."}], "answers": [{"tags": [], "owner": {"reputation": 1049, "user_id": 1587418, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/61f71f8acb7a3af01ec2bd418cd2f899?s=128&d=identicon&r=PG", "display_name": "NonNumeric", "link": "https://stackoverflow.com/users/1587418/nonnumeric"}, "is_accepted": true, "score": 6, "last_activity_date": 1468944718, "last_edit_date": 1468944718, "creation_date": 1468943871, "answer_id": 38463378, "question_id": 38463040, "link": "https://stackoverflow.com/questions/38463040/how-fromintegral-or-read-works/38463378#38463378", "title": "How fromIntegral or read works", "body": "<p>The type checker is able to infer not only the types of function arguments but also the return type. Actually there is no special case there. If you store the result of <code>fromIntegral</code> or <code>read</code> in <code>Integer</code>, the version for this type will get called. You can create your own function in the same way.</p>\n\n<p>For example:</p>\n\n<pre><code>class Foo a where\n  foo :: a\n\ninstance Foo Integer where\n  foo = 7\n\ninstance Foo String where\n  foo = \"Hello\"\n\nx :: Integer\nx = 3\n\nmain = do\n  putStrLn foo\n  print (foo + x)\n</code></pre>\n\n<p>Because <code>putStrLn</code> has type <code>String -&gt; IO ()</code> the type checker finds that the type of <code>foo</code> in <code>putStrLn foo</code> must be <code>String</code> for the program to compile. The type of <code>foo</code> is <code>Foo a =&gt; a</code>. So it deduces that <code>a == String</code> and searches for <code>Foo String</code> instance. Such instance exists and it causes the<code>foo :: Foo String =&gt; String</code> value to be selected there.</p>\n\n<p>Similar reasoning happens in <code>print (foo + x)</code>. <code>x</code> is known to be <code>Integer</code>, and because the type of <code>(+)</code> is <code>Num a =&gt; a -&gt; a -&gt; a</code> the type checker deduces that the left argument of the addition operator must also be <code>Integer</code> so it searches for <code>Foo Integer</code> instance and substitutes the <code>Integer</code> variant.</p>\n\n<p>There is no direction from function arguments to (possible) return type like in C++. The type checker may even deduce function arguments based on knowledge of what the function is expected to return. Another example:</p>\n\n<pre><code>twice :: a -&gt; [a]\ntwice a = [a,a]\n\ny :: [Integer]\ny = twice foo\n</code></pre>\n\n<p>The function argument here is of type <code>Foo a =&gt; a</code> which is not enough to decide which <code>foo</code> to use. But because the result is already known to be <code>[Integer]</code> the type checker finds that it has to provide value of type <code>Integer</code> to <code>twice</code> and does so by using the appropriate instance of <code>foo</code>.</p>\n"}, {"tags": [], "owner": {"reputation": 49959, "user_id": 866915, "user_type": "registered", "accept_rate": 70, "profile_image": "https://www.gravatar.com/avatar/09242131d6e17cbbe31e8547514da6e5?s=128&d=identicon&r=PG", "display_name": "ErikR", "link": "https://stackoverflow.com/users/866915/erikr"}, "is_accepted": false, "score": 2, "last_activity_date": 1468943897, "creation_date": 1468943897, "answer_id": 38463388, "question_id": 38463040, "link": "https://stackoverflow.com/questions/38463040/how-fromintegral-or-read-works/38463388#38463388", "title": "How fromIntegral or read works", "body": "<p><code>read</code> is a member of a <a href=\"https://www.haskell.org/tutorial/classes.html\" rel=\"nofollow\">typeclass</a> which means that its implementation can depend on a type parameter.</p>\n\n<p>Also, numeric literals like <code>1</code>, <code>42</code>, etc. are syntatic sugar for function calls <code>fromInteger 1</code>, <code>fromInteger 42</code>, etc., and <code>fromInteger</code> itself is a member of the Num typeclass.</p>\n\n<p>Thus, the literal <code>42</code> (or <code>fromInteger 42</code>) can return an <code>Int</code> or <code>Double</code> or any other Num instance depending on the context in which it is called.</p>\n"}, {"tags": [], "owner": {"reputation": 4565, "user_id": 1134885, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/7c428466054762cf7d4b5fb5f4396fa2?s=128&d=identicon&r=PG", "display_name": "NovaDenizen", "link": "https://stackoverflow.com/users/1134885/novadenizen"}, "is_accepted": false, "score": 2, "last_activity_date": 1468974446, "creation_date": 1468974446, "answer_id": 38470548, "question_id": 38463040, "link": "https://stackoverflow.com/questions/38463040/how-fromintegral-or-read-works/38470548#38470548", "title": "How fromIntegral or read works", "body": "<p>I'm being a little particular about terminology here, because I think the words you're using betray some misunderstandings about how Haskell works.</p>\n\n<blockquote>\n  <p>The fromIntegral returns a Num data type. </p>\n</blockquote>\n\n<p>More precisely, <code>fromIntegral</code> takes as input any type that has an instance of <code>class Integral</code>, and can return any type that is an instance of <code>class Num</code>.  The prelude defines it like this:</p>\n\n<pre><code>fromIntegral :: (Integral a, Num b) =&gt; a -&gt; b\nfromIntegral = fromInteger . toInteger\n</code></pre>\n\n<p>Types with an <code>Integral</code> instance implement the<code>toInteger</code> function, and all types with a <code>Num</code> instance implement <code>fromInteger</code>.  <code>fromIntegral</code> uses the <code>toInteger</code> associated with the <code>Integral a</code> instance to turn a value of type <code>a</code> into an Integer.  Then it uses the <code>fromInteger</code> from the <code>Num b</code> instance to convert that Integer into a value of type <code>b</code>.   </p>\n\n<blockquote>\n  <p>But it seems that Num is able to coerce to Double or Integer with no issue. </p>\n</blockquote>\n\n<p>Every time a haskell function is used, it is \"expanded\".  Its definition is substituted for the function call, and the parameters used are substituted into the definition.  Each time it is expanded in a different context, it can have different types in its type variables.  So each time a function is expanded, it takes certain concrete types and returns a certain concrete type.  It doesn't return a typeless thing that gets coerced at some later time.</p>\n\n<blockquote>\n  <p>Similarly, the read function is able to return whatever that is required to fit its type signature. </p>\n</blockquote>\n\n<pre><code>read :: Read a =&gt; String -&gt; a\n</code></pre>\n\n<p><code>read</code> takes a <code>String</code> as input, and can be used in any context that returns values of a type for which an instance of <code>class Read</code> exists.  When it is expanded during execution of a program, this type is known.  It uses the particular definitions in the <code>Read a</code> instance to parse the string into the correct type.</p>\n"}], "owner": {"reputation": 678, "user_id": 467739, "user_type": "registered", "accept_rate": 83, "profile_image": "https://www.gravatar.com/avatar/4800b0ca9fbbd5875a6917805e77928f?s=128&d=identicon&r=PG", "display_name": "asdacap", "link": "https://stackoverflow.com/users/467739/asdacap"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 381, "favorite_count": 0, "accepted_answer_id": 38463378, "answer_count": 3, "score": 1, "last_activity_date": 1468974446, "creation_date": 1468942901, "question_id": 38463040, "link": "https://stackoverflow.com/questions/38463040/how-fromintegral-or-read-works", "title": "How fromIntegral or read works", "body": "<p>The <code>fromIntegral</code> returns a <code>Num</code> data type. But it seems that <code>Num</code> is able to coerce to <code>Double</code> or <code>Integer</code> with no issue. Similarly, the <code>read</code> function is able to return whatever that is required to fit its type signature. How does this works? And if I do need to make a similar function, how do I do it?</p>\n"}, {"tags": ["haskell", "abstract-syntax-tree", "comonad", "catamorphism", "recursion-schemes"], "comments": [{"owner": {"reputation": 37219, "user_id": 1523776, "user_type": "moderator", "accept_rate": 87, "profile_image": "https://www.gravatar.com/avatar/b3e0b5c8e42a8c38009ef2d969f8dabb?s=128&d=identicon&r=PG", "display_name": "Benjamin Hodgson", "link": "https://stackoverflow.com/users/1523776/benjamin-hodgson"}, "edited": false, "score": 4, "creation_date": 1468943343, "post_id": 38462563, "comment_id": 64330265, "body": "Interesting question. I don&#39;t have an answer for you right now but I will share this thought. <code>Free</code> is inductive and <code>Cofree</code> is coinductive. That is, <i>tearing down</i> a (well-behaved) free monad using a (total) algebra for an arbitrary functor is guaranteed terminating, and <i>building up</i> a cofree comonad using a coalgebra is guaranteed productive. The other way round is not true"}], "answers": [{"comments": [{"owner": {"reputation": 13807, "user_id": 2407038, "user_type": "registered", "accept_rate": 64, "profile_image": "https://www.gravatar.com/avatar/538f6f4a9aa43841841de7d8e8b169fc?s=128&d=identicon&r=PG&f=1", "display_name": "user2407038", "link": "https://stackoverflow.com/users/2407038/user2407038"}, "edited": false, "score": 0, "creation_date": 1468946095, "post_id": 38463785, "comment_id": 64332008, "body": "When you encounter this pattern often, it becomes useful to define such a constant annotation directly: <code>data (:&amp;) x f a = x :&amp; f a</code> - this is just a matter of preference, of course."}, {"owner": {"reputation": 37219, "user_id": 1523776, "user_type": "moderator", "accept_rate": 87, "profile_image": "https://www.gravatar.com/avatar/b3e0b5c8e42a8c38009ef2d969f8dabb?s=128&d=identicon&r=PG", "display_name": "Benjamin Hodgson", "link": "https://stackoverflow.com/users/1523776/benjamin-hodgson"}, "reply_to_user": {"reputation": 13807, "user_id": 2407038, "user_type": "registered", "accept_rate": 64, "profile_image": "https://www.gravatar.com/avatar/538f6f4a9aa43841841de7d8e8b169fc?s=128&d=identicon&r=PG&f=1", "display_name": "user2407038", "link": "https://stackoverflow.com/users/2407038/user2407038"}, "edited": false, "score": 2, "creation_date": 1468946343, "post_id": 38463785, "comment_id": 64332134, "body": "@user2407038 I prefer to reuse smaller bits like <code>K</code> and <code>:*:</code>, and define type/pattern synonyms for doman-specific uses. <code>type (x :&amp; g) = K x :*: g</code> and <code>pattern x :&amp; y = K x :*: y</code>"}, {"owner": {"reputation": 2166, "user_id": 2196034, "user_type": "registered", "accept_rate": 51, "profile_image": "https://i.stack.imgur.com/HFZxO.jpg?s=128&g=1", "display_name": "Luciano", "link": "https://stackoverflow.com/users/2196034/luciano"}, "edited": false, "score": 0, "creation_date": 1614878194, "post_id": 38463785, "comment_id": 117526363, "body": "Why doesn&#39;t this work with the original <code>Cofree</code> type for annotation? (Or does it?)"}], "tags": [], "owner": {"reputation": 37219, "user_id": 1523776, "user_type": "moderator", "accept_rate": 87, "profile_image": "https://www.gravatar.com/avatar/b3e0b5c8e42a8c38009ef2d969f8dabb?s=128&d=identicon&r=PG", "display_name": "Benjamin Hodgson", "link": "https://stackoverflow.com/users/1523776/benjamin-hodgson"}, "is_accepted": true, "score": 10, "last_activity_date": 1469016761, "last_edit_date": 1469016761, "creation_date": 1468945153, "answer_id": 38463785, "question_id": 38462563, "link": "https://stackoverflow.com/questions/38462563/how-to-work-with-ast-with-cofree-annotation/38463785#38463785", "title": "How to work with AST with Cofree annotation?", "body": "<p>An alternative way of annotating your syntax tree is to compose the annotation into the base functor.</p>\n\n<pre><code>-- constant functor\nnewtype K c a = K c\n    deriving (Eq, Ord, Show, Read, Functor, Foldable, Traversable)\n\n-- functor product\ndata (f :*: g) a = (:*:) { left :: f a, right :: g a }\n    deriving (Eq, Ord, Show, Read, Functor, Foldable, Traversable)\n</code></pre>\n\n<p>We're going to use the functor product to attach an annotation (inside a <code>K</code>) to each layer of the tree.</p>\n\n<pre><code>type AnnExpr = Fix (K LineNumber :*: ExprF)\n</code></pre>\n\n<p>If you can generate annotations while only inspecting a single layer of the tree (that is, your annotation-generating code can be expressed as a natural transformation) then you can use the following bit of machinery to modify the functor while keeping the fixpoint structure in place:</p>\n\n<pre><code>hoistFix :: Functor f =&gt; (forall a. f a -&gt; g a) -&gt; Fix f -&gt; Fix g\nhoistFix f = Fix . f . fmap (hoistFix f) . unFix\n</code></pre>\n\n<p>This is of limited usefulness, though, as most interesting annotations such as type-checking require traversal of the syntax tree.</p>\n\n<p>You can reuse the code to tear down an <code>Expr</code> by simply ignoring the annotations. Given an algebra for <code>ExprF</code>...</p>\n\n<pre><code>-- instructions for a stack machine\ndata Inst = PUSH Int | ADD\ntype Prog = [Inst]\n\ncompile_ :: ExprF Prog -&gt; Prog\ncompile_ (Const x) = [PUSH x]\ncompile_ (Add x y) = x ++ y ++ [ADD]\n</code></pre>\n\n<p>... you can use it to tear down either an <code>Expr</code> or an <code>AnnExpr</code>:</p>\n\n<pre><code>compileE :: Expr -&gt; Prog \ncompileE = cata compile_\n\ncompileA :: AnnExpr -&gt; Prog\ncompileA = cata (compile_ . right)\n</code></pre>\n"}], "owner": {"reputation": 2216, "user_id": 2260919, "user_type": "registered", "accept_rate": 86, "profile_image": "https://www.gravatar.com/avatar/6732557387dfa9107c693e19b95b292e?s=128&d=identicon&r=PG", "display_name": "ais", "link": "https://stackoverflow.com/users/2260919/ais"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 1619, "favorite_count": 8, "accepted_answer_id": 38463785, "answer_count": 1, "score": 6, "last_activity_date": 1473958551, "creation_date": 1468941635, "last_edit_date": 1473958551, "question_id": 38462563, "link": "https://stackoverflow.com/questions/38462563/how-to-work-with-ast-with-cofree-annotation", "title": "How to work with AST with Cofree annotation?", "body": "<p>I have this simple <code>Expr</code> AST and I can easily convert it to <code>String</code>.</p>\n\n<pre><code>import Prelude hiding (Foldable)\nimport qualified Prelude\nimport Data.Foldable as F\nimport Data.Functor.Foldable\nimport Data.Monoid\nimport Control.Comonad.Cofree\n\ndata ExprF r = Const Int\n              | Add   r r\n                deriving ( Show, Eq, Ord, Functor, Prelude.Foldable )\n\ntype Expr = Fix ExprF\n\ntestExpr = Fix $ Add (Fix (Const 1)) (Fix (Const 2))\n\nconvertToString :: Expr -&gt; String\nconvertToString = cata $ \\case\n  e@(Const x) -&gt; show x\n  e@(Add x y) -&gt; unwords [x, \"+\", y]\n</code></pre>\n\n<p>Now I want to add an additional data to it.\nSo I am trying to use <code>Cofree</code></p>\n\n<pre><code>type LineNumber = Int\ntype Expr2 = Cofree ExprF LineNumber\n</code></pre>\n\n<p>I can convert <code>Expr</code> to <code>Expr2</code></p>\n\n<pre><code>addLineNumbers :: Expr -&gt; Expr2\naddLineNumbers = cata $ \\case\n  e@(Const _) -&gt; 1 :&lt; e\n  e -&gt; 2 :&lt; e\n</code></pre>\n\n<p>But I cannot figure out how to convert <code>Expr2</code> to <code>String</code></p>\n\n<pre><code>convertToString2 :: Expr2 -&gt; String\nconvertToString2 = cata $ \\case\n  e@(_ :&lt; (Const x)) -&gt; show x\n  e@(_ :&lt; (Add x y)) -&gt; unwords [x, \"+\", y]\n</code></pre>\n\n<p>Also, is Cofree the best way to solve this annotation problem?</p>\n"}, {"tags": ["haskell"], "comments": [{"owner": {"reputation": 51584, "user_id": 839246, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/9b0573c2b936b12828dd1e4cc04206dc?s=128&d=identicon&r=PG&f=1", "display_name": "bheklilr", "link": "https://stackoverflow.com/users/839246/bheklilr"}, "edited": false, "score": 0, "creation_date": 1468939635, "post_id": 38461593, "comment_id": 64327722, "body": "Sounds like you might benefit from functions like <code>groupBy</code> and co in <code>Data.List</code>.  Take a look at that module to see if there&#39;s anything that gives you an idea of how to solve this."}, {"owner": {"user_type": "does_not_exist", "display_name": "user6518699"}, "edited": false, "score": 0, "creation_date": 1468939709, "post_id": 38461593, "comment_id": 64327770, "body": "I was thinking about lambda and map but I have no idea how to combine it with checking tuples in list"}, {"owner": {"reputation": 791, "user_id": 1587319, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/1c8a88b9a8d79a518cba52a7a8d099f9?s=128&d=identicon&r=PG", "display_name": "pdexter", "link": "https://stackoverflow.com/users/1587319/pdexter"}, "edited": false, "score": 0, "creation_date": 1468942308, "post_id": 38461593, "comment_id": 64329529, "body": "Try writing small functions which handle each part of your algorithm. For example, write a function which takes two tuples and increment the second element if and only if the first element is the same."}, {"owner": {"reputation": 4185, "user_id": 15467, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/a89c04ada36efa853c7f5be0a96b6dd9?s=128&d=identicon&r=PG", "display_name": "ja.", "link": "https://stackoverflow.com/users/15467/ja"}, "edited": false, "score": 0, "creation_date": 1468966092, "post_id": 38461593, "comment_id": 64342717, "body": "so what&#39;s the result of this? What&#39;s the type of the result?  It&#39;s a bit unclear from your description.  Do you know how to pattern match on tuples?"}, {"owner": {"reputation": 2313, "user_id": 5318306, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/897fd4f3b92d28c5c1eb28a8024661a1?s=128&d=identicon&r=PG&f=1", "display_name": "Gurkenglas", "link": "https://stackoverflow.com/users/5318306/gurkenglas"}, "edited": false, "score": 0, "creation_date": 1468974995, "post_id": 38461593, "comment_id": 64344965, "body": "Are you sure you don&#39;t want instead to turn [0, 1, 2, 3, 3, 3, 4, 4] into [(0, 0), (1, 0), (2, 0), (3, 0), (3, 1), (3, 2), (4, 0), (4, 1)]? Doubles aren&#39;t that great for equality checking after you&#39;ve done any arithmetic on them, and you don&#39;t seem to need the initial y. If I&#39;m right, you want <code>group</code>, <code>concatMap</code>, <code>zip</code> and <code>[0..]</code>. You can find the first three on hoogle/hayoo, which you can find on google."}], "answers": [{"tags": [], "owner": {"reputation": 23600, "user_id": 1695172, "user_type": "registered", "accept_rate": 91, "profile_image": "https://www.gravatar.com/avatar/6319d7eafca7852cf04c88598ca31e75?s=128&d=identicon&r=PG", "display_name": "Netwave", "link": "https://stackoverflow.com/users/1695172/netwave"}, "is_accepted": false, "score": -1, "last_activity_date": 1469001137, "last_edit_date": 1469001137, "creation_date": 1469000210, "answer_id": 38475119, "question_id": 38461593, "link": "https://stackoverflow.com/questions/38461593/how-to-compare-two-tuple-in-list/38475119#38475119", "title": "How to compare two tuple in list?", "body": "<p>Not tested, but something like this will do:</p>\n\n<pre><code>foo :: [(Float, Float)] -&gt; [(Float, Float)]\nfoo []  = []\nfoo [x] = [x]\nfoo ((xx, xy):(yx, yy):xs) = (xx, xy): theTuple : (foo ((yx, yy):xs))\n    where\n        theTuple = if xx == yx then (yx, yy) else (yx, yy+1)\n</code></pre>\n"}], "owner": {"user_type": "does_not_exist", "display_name": "user6518699"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 1091, "favorite_count": 0, "answer_count": 1, "score": 1, "last_activity_date": 1469001137, "creation_date": 1468939088, "last_edit_date": 1468939201, "question_id": 38461593, "link": "https://stackoverflow.com/questions/38461593/how-to-compare-two-tuple-in-list", "title": "How to compare two tuple in list?", "body": "<p>I have list of tuples like this: </p>\n\n<pre><code>[(0.0,0.0),(1.0,0.0),(2.0,0.0),(3.0,0.0),(3.0,0.0),(3.0,0.0),(4.0,0.0),(4.0,0.0)]\n</code></pre>\n\n<p>where first element is the X-coordinate and second the Y-coordinate and I now want to write function that will return :</p>\n\n<pre><code>[(0.0,0.0),(1.0,0.0),(2.0,0.0),(3.0,0.0),(3.0,1.0),(3.0,2.0),(4.0,0.0),(4.0,1.0)]\n</code></pre>\n\n<p>It takes first element from first tuple and first from second tuple and if they are not equal, Y is unchanged but if they are equal we add one to Y.</p>\n\n<p>if someone has an idea how to write in Haskell?</p>\n"}, {"tags": ["haskell"], "answers": [{"tags": [], "owner": {"reputation": 100185, "user_id": 3234959, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/93bb12ca0f93dfddb33880316f7e66c2?s=128&d=identicon&r=PG&f=1", "display_name": "chi", "link": "https://stackoverflow.com/users/3234959/chi"}, "is_accepted": true, "score": 5, "last_activity_date": 1468939711, "last_edit_date": 1468939711, "creation_date": 1468939339, "answer_id": 38461685, "question_id": 38461326, "link": "https://stackoverflow.com/questions/38461326/polykinded-type-composition/38461685#38461685", "title": "Polykinded type composition", "body": "<p>I think GHC is not currently able to make those point-free.</p>\n\n<p>GHCi 8.0 seems to accept this.</p>\n\n<pre><code>&gt; :set -XPolyKinds\n&gt; type C (m :: k1 -&gt; k) (n :: k2 -&gt; k1) (t :: k2) = m (n t)\n&gt; :i C\ntype C (m :: k1 -&gt; k) (n :: k2 -&gt; k1) (t :: k2) = m (n t) :: k\n</code></pre>\n\n<p>However, note that this can not be partially applied, in general, and will require you to eta-expand your definitions.</p>\n\n<p>E.g. we can't use <code>type T = C [] []</code> but we can use <code>type T a = C [] [] a</code>.</p>\n\n<p>Without eta-expansion, I don't think we can return a type of kind <code>k2 -&gt; k</code> unless that's a type constructor. We don't have type-level lambdas (or partial application).</p>\n"}], "owner": {"reputation": 81794, "user_id": 9859, "user_type": "registered", "accept_rate": 89, "profile_image": "https://i.stack.imgur.com/KEZOL.jpg?s=128&g=1", "display_name": "rampion", "link": "https://stackoverflow.com/users/9859/rampion"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 137, "favorite_count": 0, "accepted_answer_id": 38461685, "answer_count": 1, "score": 3, "last_activity_date": 1468939711, "creation_date": 1468938376, "question_id": 38461326, "link": "https://stackoverflow.com/questions/38461326/polykinded-type-composition", "title": "Polykinded type composition", "body": "<p>I've got a couple type aliases that all fit a similar pattern:</p>\n\n<pre><code>type Foo f = Bar (Qoox f)\ntype Faa f = Bar (Qaax f)\ntype Moo f = Fez (Rxoo f)\ntype Maa f = Fez (Rxaa f)\n-- ...\n</code></pre>\n\n<p>I want to make the aliases point-free, so I can use them on their own.  Rather than define newtypes, I thought it'd be neat if I could do type-level composition:</p>\n\n<pre><code>type Foo = Bar `Compose1` Qoox\ntype Faa = Bar `Compose1` Qaax\ntype Moo = Fez `Compose2` Rxoo\ntype Maa = Fez `Compose2` Rxaa\n-- ...\n</code></pre>\n\n<p>But I keep having to define multiple <code>Compose</code> types because the base types are of different kinds.</p>\n\n<p>What I'd like is a polykinded type-level function</p>\n\n<pre><code>type family (.) (m :: k1 -&gt; k) (n :: k2 -&gt; k1) :: k2 -&gt; k where\n</code></pre>\n\n<p>So I could just do</p>\n\n<pre><code>type Foo = Bar . Qoox\ntype Faa = Bar . Qaax\ntype Moo = Fez . Rxoo\ntype Maa = Fez . Rxaa\n-- ...\n</code></pre>\n\n<p>But I suspect that might be beyond Haskell's current capabilities, and I don't want to waste time trying to implement the impossible.</p>\n\n<p>Can such composition be done in Haskell using the extensions available in GHC8?</p>\n"}, {"tags": ["haskell", "pattern-matching", "tuples"], "comments": [{"owner": {"reputation": 791, "user_id": 1587319, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/1c8a88b9a8d79a518cba52a7a8d099f9?s=128&d=identicon&r=PG", "display_name": "pdexter", "link": "https://stackoverflow.com/users/1587319/pdexter"}, "edited": false, "score": 3, "creation_date": 1468923924, "post_id": 38455563, "comment_id": 64315765, "body": "You want the result to have type [(Int, Int, Int)] ? You cannot be generic on the length of TUPLES so you should think twice about what you&#39;re trying to accomplish. If you are fine with the result being a list (but just want to print to the user the presence of a tuple) then you can pretty print the list with parenthesis."}, {"owner": {"reputation": 237, "user_id": 5539565, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/e3caea1216cdc02bbed42516c88cde26?s=128&d=identicon&r=PG&f=1", "display_name": "FastBatteryCharger", "link": "https://stackoverflow.com/users/5539565/fastbatterycharger"}, "reply_to_user": {"reputation": 791, "user_id": 1587319, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/1c8a88b9a8d79a518cba52a7a8d099f9?s=128&d=identicon&r=PG", "display_name": "pdexter", "link": "https://stackoverflow.com/users/1587319/pdexter"}, "edited": false, "score": 0, "creation_date": 1468924386, "post_id": 38455563, "comment_id": 64316089, "body": "why is it not possible to create the searched output? *I am not trying to accomplish something special, i only want to &quot;play around&quot; with the pattern matching for learning purposes."}, {"owner": {"reputation": 791, "user_id": 1587319, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/1c8a88b9a8d79a518cba52a7a8d099f9?s=128&d=identicon&r=PG", "display_name": "pdexter", "link": "https://stackoverflow.com/users/1587319/pdexter"}, "edited": false, "score": 1, "creation_date": 1468924620, "post_id": 38455563, "comment_id": 64316240, "body": "Because you can&#39;t create a tuple with arbitrary length."}, {"owner": {"reputation": 237, "user_id": 5539565, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/e3caea1216cdc02bbed42516c88cde26?s=128&d=identicon&r=PG&f=1", "display_name": "FastBatteryCharger", "link": "https://stackoverflow.com/users/5539565/fastbatterycharger"}, "reply_to_user": {"reputation": 791, "user_id": 1587319, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/1c8a88b9a8d79a518cba52a7a8d099f9?s=128&d=identicon&r=PG", "display_name": "pdexter", "link": "https://stackoverflow.com/users/1587319/pdexter"}, "edited": false, "score": 0, "creation_date": 1468924741, "post_id": 38455563, "comment_id": 64316324, "body": "I see!! Is there any way to make it work if i define that my tuple has 3 elements?"}, {"owner": {"reputation": 37219, "user_id": 1523776, "user_type": "moderator", "accept_rate": 87, "profile_image": "https://www.gravatar.com/avatar/b3e0b5c8e42a8c38009ef2d969f8dabb?s=128&d=identicon&r=PG", "display_name": "Benjamin Hodgson", "link": "https://stackoverflow.com/users/1523776/benjamin-hodgson"}, "edited": false, "score": 2, "creation_date": 1468926305, "post_id": 38455563, "comment_id": 64317441, "body": "@MartinM What should happen when your input list has more than three tuples inside it?"}, {"owner": {"reputation": 237, "user_id": 5539565, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/e3caea1216cdc02bbed42516c88cde26?s=128&d=identicon&r=PG&f=1", "display_name": "FastBatteryCharger", "link": "https://stackoverflow.com/users/5539565/fastbatterycharger"}, "edited": false, "score": 0, "creation_date": 1468926678, "post_id": 38455563, "comment_id": 64317715, "body": "I did not think about that situation... Maybe i should have a seperated function to take 3 elements and put them together into a tuple."}, {"owner": {"reputation": 791, "user_id": 1587319, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/1c8a88b9a8d79a518cba52a7a8d099f9?s=128&d=identicon&r=PG", "display_name": "pdexter", "link": "https://stackoverflow.com/users/1587319/pdexter"}, "edited": false, "score": 0, "creation_date": 1468929425, "post_id": 38455563, "comment_id": 64319771, "body": "Yes, you can pattern match on the list directly, don&#39;t use recursion. Just pattern match on a list with 3 elements."}, {"owner": {"reputation": 14582, "user_id": 2225384, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/f30b04ed4d0b3fc4bc791a28815f34ca?s=128&d=identicon&r=PG", "display_name": "Rein Henrichs", "link": "https://stackoverflow.com/users/2225384/rein-henrichs"}, "edited": false, "score": 2, "creation_date": 1469089330, "post_id": 38455563, "comment_id": 64397359, "body": "Ah yes, <a href=\"https://xkcd.com/221/\" rel=\"nofollow noreferrer\">lists of arbitrary length 3</a>."}], "answers": [{"comments": [{"owner": {"reputation": 237, "user_id": 5539565, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/e3caea1216cdc02bbed42516c88cde26?s=128&d=identicon&r=PG&f=1", "display_name": "FastBatteryCharger", "link": "https://stackoverflow.com/users/5539565/fastbatterycharger"}, "edited": false, "score": 1, "creation_date": 1469090402, "post_id": 38457402, "comment_id": 64398098, "body": "Thats very helpful and now i really understand the problem mentioned in the first place!!"}], "tags": [], "owner": {"reputation": 1512, "user_id": 1153801, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/JzItT.jpg?s=128&g=1", "display_name": "SND", "link": "https://stackoverflow.com/users/1153801/snd"}, "is_accepted": true, "score": 1, "last_activity_date": 1468928133, "creation_date": 1468928133, "answer_id": 38457402, "question_id": 38455563, "link": "https://stackoverflow.com/questions/38455563/haskell-pattern-matching-on-lists-to-get-every-first-element-of-tuples-with-arb/38457402#38457402", "title": "Haskell, pattern-matching on lists to get every first element of tuples with arbitrary length", "body": "<p>As yet stated in the comment by @pdexter, you cannot create a tuple with arbitrary length. So what you're trying to do will only work when the tuple exactly pattern matches a tuple with 3 Ints. Let me show you an example to clarify what I mean:</p>\n\n<pre><code>helper :: [(Int,Int,Int)] -&gt; (Int,Int,Int)\nhelper xs = (x,y,z)\n            where [x,y,z] = f xs\n\nf :: [(Int,Int,Int)] -&gt; [Int]\nf []           = []\nf ((x,y,z):xs) = x : (f xs)\n</code></pre>\n\n<p>Here we manage to create <code>(x,y,z)</code> by pattern matching on <code>[x,y,z]</code>, but what if there were more than three tuples, our pattern matching would no longer be valid?</p>\n\n<p>So you should ask yourself the question what it is you're really trying to accomplish with this code and what scenarios might occur (e.g.: empty tuples, tuples with varying lengths mutually, .. ?) and also, how should your program handle these different cases?</p>\n\n<p>If there is no functional reason as to why you like the output to be in a tuple, I suggest you keep the function as is.</p>\n\n<p>Good luck!</p>\n"}], "owner": {"reputation": 237, "user_id": 5539565, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/e3caea1216cdc02bbed42516c88cde26?s=128&d=identicon&r=PG&f=1", "display_name": "FastBatteryCharger", "link": "https://stackoverflow.com/users/5539565/fastbatterycharger"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 442, "favorite_count": 1, "accepted_answer_id": 38457402, "answer_count": 1, "score": 1, "last_activity_date": 1468932568, "creation_date": 1468923103, "last_edit_date": 1468932568, "question_id": 38455563, "link": "https://stackoverflow.com/questions/38455563/haskell-pattern-matching-on-lists-to-get-every-first-element-of-tuples-with-arb", "title": "Haskell, pattern-matching on lists to get every first element of tuples with arbitrary length", "body": "<p>I want to get the first element of every tuple stored in a list like so:</p>\n\n<pre><code>INPUT         :   [(1,2,3), (1,4,5), (1,6,7)]\nWanted OUTPUT :   [(1,1,1)]  % Note the tuple notation\n</code></pre>\n\n<p>This is the function I have written so far:</p>\n\n<pre><code>f [] = []\nf ((x,y,z):xs) = x:(f xs)\n</code></pre>\n\n<p>But it gives me this output:</p>\n\n<pre><code>[1,1,1]\n</code></pre>\n\n<p>instead of</p>\n\n<pre><code>[(1,1,1)]\n</code></pre>\n\n<p>Where is my misunderstanding?</p>\n"}, {"tags": ["haskell"], "answers": [{"tags": [], "owner": {"reputation": 29444, "user_id": 3072788, "user_type": "registered", "accept_rate": 82, "profile_image": "https://www.gravatar.com/avatar/220a45c2fcff7e7358d144551b116205?s=128&d=identicon&r=PG&f=1", "display_name": "Alec", "link": "https://stackoverflow.com/users/3072788/alec"}, "is_accepted": true, "score": 7, "last_activity_date": 1468900259, "last_edit_date": 1495542275, "creation_date": 1468899930, "answer_id": 38449261, "question_id": 38449140, "link": "https://stackoverflow.com/questions/38449140/couldnt-match-expected-type-a-with-actual-type-double/38449261#38449261", "title": "Couldn&#39;t match expected type \u2018a\u2019 with actual type \u2018Double\u2019:", "body": "<p>This is an example of the <a href=\"https://wiki.haskell.org/Monomorphism_restriction\" rel=\"nofollow noreferrer\">monomorphism restriction</a>.</p>\n\n<p>When you load a file into <code>ghci</code> or compile it with <code>ghc</code>, the monomorphism restriction is enabled, which means that you get certain defaulting rules in type inference. In this case, Haskell infers that <code>phi</code> and <code>minusphi</code> have type <code>Double</code> instead of <code>Floating a =&gt; a</code>, which is what you wanted.</p>\n\n<p>In <code>ghci</code> itself though, the monomorphism restriction is not enabled, so the most general types <em>are</em> inferred.</p>\n\n<p>To fix this in your example above, just add the explicit type annotation:</p>\n\n<pre><code>phi, minusphi :: Floating a =&gt; a\nphi = (1 + sqrt 5) / 2\nminusphi = (1 - sqrt 5) / 2\n</code></pre>\n\n<p><a href=\"https://stackoverflow.com/questions/4179453/why-are-polymorphic-values-not-inferred-in-haskell\">Here's</a> a previous question which has a better answer IMO.</p>\n"}], "owner": {"reputation": 129, "user_id": 3125971, "user_type": "registered", "accept_rate": 67, "profile_image": "https://www.gravatar.com/avatar/a092521402d91d8e76d1d870561113b2?s=128&d=identicon&r=PG&f=1", "display_name": "user3125971", "link": "https://stackoverflow.com/users/3125971/user3125971"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 1555, "favorite_count": 0, "closed_date": 1468934908, "accepted_answer_id": 38449261, "answer_count": 1, "score": 2, "last_activity_date": 1468927206, "creation_date": 1468899021, "last_edit_date": 1468927206, "question_id": 38449140, "link": "https://stackoverflow.com/questions/38449140/couldnt-match-expected-type-a-with-actual-type-double", "closed_reason": "Duplicate", "title": "Couldn&#39;t match expected type \u2018a\u2019 with actual type \u2018Double\u2019:", "body": "<p>I declared the type declaration by checking it from ghci but loading the module gives error:</p>\n\n<pre><code>even-fibbanaci-sum.hs:7:12: error:\n     Couldn't match expected type \u2018a\u2019 with actual type \u2018Double\u2019\n     \u2018a\u2019 is a rigid type variable bound by\n       the type signature for:\n         getFib :: forall b a. (Integral b, Floating a) =&gt; b -&gt; a\n       at even-fibbanaci-sum.hs:4:12\n     In the expression: ((phi ^ n) - (minusphi ^ n)) / sqrt 5\n     In an equation for \u2018getFib\u2019:\n         getFib n = ((phi ^ n) - (minusphi ^ n)) / sqrt 5    \u2022 Relevant bindings include\n       getFib :: b -&gt; a (bound at even-fibbanaci-sum.hs:5:1)\n</code></pre>\n\n<p>Here is my code</p>\n\n<pre><code>phi = (1 + sqrt 5) / 2\nminusphi = (1 - sqrt 5) / 2\n\ngetFib ::  (Integral b,Floating a) =&gt; b -&gt; a\ngetFib n = ((phi ^ n) - (minusphi ^ n)) / sqrt 5\n\nfibSum :: (Integral b,Floating a) =&gt; b -&gt; a\nfibSum x =sum $ map getFib [2,5..x]\n</code></pre>\n\n<p>but when it in ghci it works fine.</p>\n"}, {"tags": ["haskell", "exponential", "exponent"], "comments": [{"owner": {"reputation": 100892, "user_id": 745903, "user_type": "registered", "accept_rate": 74, "profile_image": "https://www.gravatar.com/avatar/50933f6638836741e620669b3940410e?s=128&d=identicon&r=PG", "display_name": "leftaroundabout", "link": "https://stackoverflow.com/users/745903/leftaroundabout"}, "edited": false, "score": 1, "creation_date": 1468881122, "post_id": 38446931, "comment_id": 64299324, "body": "Neither is this a Haskell question, nor does it IMO qualify as sufficiently researched. If you flesh this out a bit, it might make a good <a href=\"http://mathematics.stackexchange.com\">Math.SE</a> or perhaps <a href=\"https://cs.stackexchange.com\">Computer Science</a> question though."}, {"owner": {"reputation": 157, "user_id": 6247458, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/07882b10c91e1e95ade0bffc3ff728f0?s=128&d=identicon&r=PG&f=1", "display_name": "jaw2233", "link": "https://stackoverflow.com/users/6247458/jaw2233"}, "reply_to_user": {"reputation": 100892, "user_id": 745903, "user_type": "registered", "accept_rate": 74, "profile_image": "https://www.gravatar.com/avatar/50933f6638836741e620669b3940410e?s=128&d=identicon&r=PG", "display_name": "leftaroundabout", "link": "https://stackoverflow.com/users/745903/leftaroundabout"}, "edited": false, "score": 0, "creation_date": 1468881298, "post_id": 38446931, "comment_id": 64299370, "body": "Ah, I ment to be asking if there was a built in function for this."}, {"owner": {"reputation": 49959, "user_id": 866915, "user_type": "registered", "accept_rate": 70, "profile_image": "https://www.gravatar.com/avatar/09242131d6e17cbbe31e8547514da6e5?s=128&d=identicon&r=PG", "display_name": "ErikR", "link": "https://stackoverflow.com/users/866915/erikr"}, "edited": false, "score": 0, "creation_date": 1468881891, "post_id": 38446931, "comment_id": 64299549, "body": "What exactly do you mean by a &quot;non-decimal triangle&quot; or &quot;quadrilateral&quot;? Does <code>x = log Q &#47; log T</code> work for you?"}, {"owner": {"reputation": 157, "user_id": 6247458, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/07882b10c91e1e95ade0bffc3ff728f0?s=128&d=identicon&r=PG&f=1", "display_name": "jaw2233", "link": "https://stackoverflow.com/users/6247458/jaw2233"}, "edited": false, "score": 0, "creation_date": 1468882290, "post_id": 38446931, "comment_id": 64299665, "body": "Got me again. I ment triangles and quaderlateral shapes with integer angles and i fixed the question to reflect that. My laptop gave out on running the calc on quaderlaterals but im working on another test case. Ill comment the results."}, {"owner": {"reputation": 157, "user_id": 6247458, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/07882b10c91e1e95ade0bffc3ff728f0?s=128&d=identicon&r=PG&f=1", "display_name": "jaw2233", "link": "https://stackoverflow.com/users/6247458/jaw2233"}, "edited": false, "score": 0, "creation_date": 1468882793, "post_id": 38446931, "comment_id": 64299797, "body": "That worked but apparently there already is a function for that as stated by the answer, but thanks for showing how it works!"}], "answers": [{"tags": [], "owner": {"reputation": 126897, "user_id": 791604, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/ce991df7a056248d5e4f6fc3659ba733?s=128&d=identicon&r=PG", "display_name": "Daniel Wagner", "link": "https://stackoverflow.com/users/791604/daniel-wagner"}, "is_accepted": true, "score": 6, "last_activity_date": 1468881913, "creation_date": 1468881913, "answer_id": 38447076, "question_id": 38446931, "link": "https://stackoverflow.com/questions/38446931/haskell-is-it-possible-to-take-2-ints-and-find-a-common-exponent/38447076#38447076", "title": "Haskell - Is it possible to take 2 ints and find a common exponent?", "body": "<p>If <code>q = t^x</code>, then <code>x = logBase t q</code>.</p>\n"}], "owner": {"reputation": 157, "user_id": 6247458, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/07882b10c91e1e95ade0bffc3ff728f0?s=128&d=identicon&r=PG&f=1", "display_name": "jaw2233", "link": "https://stackoverflow.com/users/6247458/jaw2233"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 102, "favorite_count": 0, "accepted_answer_id": 38447076, "answer_count": 1, "score": -5, "last_activity_date": 1468882091, "creation_date": 1468880937, "last_edit_date": 1468882091, "question_id": 38446931, "link": "https://stackoverflow.com/questions/38446931/haskell-is-it-possible-to-take-2-ints-and-find-a-common-exponent", "title": "Haskell - Is it possible to take 2 ints and find a common exponent?", "body": "<p>Lets say i want to find if the relation between the amount of possible triangles with integer angles and quadrilaterals with integer angles can be represented by an exponent. like say T is triangles and Q is quadrilaterals</p>\n\n<pre><code>Q = T^x\n</code></pre>\n\n<p>Is there a function that I can use to find if i can represent it like that and if possible, what the exponent is?</p>\n"}, {"tags": ["haskell", "ghci"], "comments": [{"owner": {"user_type": "does_not_exist", "display_name": "user824425"}, "edited": false, "score": 3, "creation_date": 1468876138, "post_id": 38445968, "comment_id": 64297383, "body": "To me, GHCi is vaguely(!) like you&#39;re in a huge <code>IO</code>-typed <code>do</code> block. Except that expressions like <code>1 + 2</code> still work. You can only use <code>let</code> to bind variables in a <code>do</code> block. A Haskell module (or &quot;a source file&quot;) is an entirely different beast."}, {"owner": {"reputation": 384463, "user_id": 1126841, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/fa05233b2357f8d11c22ef4cfc7bb85c?s=128&d=identicon&r=PG", "display_name": "chepner", "link": "https://stackoverflow.com/users/1126841/chepner"}, "edited": false, "score": 0, "creation_date": 1468876373, "post_id": 38445968, "comment_id": 64297501, "body": "I get a parse error with <code>ghc</code> on the two <code>let</code> fragments you show."}, {"owner": {"reputation": 18780, "user_id": 683218, "user_type": "registered", "accept_rate": 69, "profile_image": "https://i.stack.imgur.com/7Vy7c.png?s=128&g=1", "display_name": "tinlyx", "link": "https://stackoverflow.com/users/683218/tinlyx"}, "reply_to_user": {"reputation": 384463, "user_id": 1126841, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/fa05233b2357f8d11c22ef4cfc7bb85c?s=128&d=identicon&r=PG", "display_name": "chepner", "link": "https://stackoverflow.com/users/1126841/chepner"}, "edited": false, "score": 0, "creation_date": 1468876573, "post_id": 38445968, "comment_id": 64297608, "body": "@chepner Thanks. I meant to two <code>let</code> gives an error in GHCi. Updated"}, {"owner": {"reputation": 126897, "user_id": 791604, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/ce991df7a056248d5e4f6fc3659ba733?s=128&d=identicon&r=PG", "display_name": "Daniel Wagner", "link": "https://stackoverflow.com/users/791604/daniel-wagner"}, "edited": false, "score": 2, "creation_date": 1468877311, "post_id": 38445968, "comment_id": 64297939, "body": "I&#39;ve always found that error oddly non-uniform; I would almost argue it should be an overlapping patterns warning rather than an error (all of the zero patterns that appear as arguments to the two defining clauses for <code>a</code> are identical!). Compare the message you get when you compile a file with <code>a () = 1; a () = 2</code>."}, {"owner": {"reputation": 56659, "user_id": 450128, "user_type": "registered", "accept_rate": 62, "profile_image": "https://www.gravatar.com/avatar/2f72b3fdc99fe9fd1bbeb2f9da1d2c0a?s=128&d=identicon&r=PG", "display_name": "Ben", "link": "https://stackoverflow.com/users/450128/ben"}, "reply_to_user": {"reputation": 126897, "user_id": 791604, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/ce991df7a056248d5e4f6fc3659ba733?s=128&d=identicon&r=PG", "display_name": "Daniel Wagner", "link": "https://stackoverflow.com/users/791604/daniel-wagner"}, "edited": false, "score": 0, "creation_date": 1468895566, "post_id": 38445968, "comment_id": 64302604, "body": "@DanielWagner That&#39;s a very good point... Though if you interpret them as merely overlapping patterns and leave it to be covered by the existing warning, the behaviour you&#39;d get is that the <i>first</i> definition would win rather than the last, which is almost certainly surprising. &quot;Never useful and usually surprising&quot; seems worth adding a special case to make it an error, rather than &quot;never useful but at least intuitive&quot; as the overlapping patterns warning is."}, {"owner": {"reputation": 84731, "user_id": 510937, "user_type": "registered", "accept_rate": 80, "profile_image": "https://www.gravatar.com/avatar/70b13a9ae1aae1ca1aa6ac8dab4643f2?s=128&d=identicon&r=PG", "display_name": "Bakuriu", "link": "https://stackoverflow.com/users/510937/bakuriu"}, "edited": false, "score": 0, "creation_date": 1468920929, "post_id": 38445968, "comment_id": 64313589, "body": "GHCi is meant for <i>interactive</i> use. If you mistype the value of an expression would you really want to have to reset all the work you have done until that point just because you missed a <code>+1</code> instead of just redefining it and continue yur work?"}], "answers": [{"tags": [], "owner": {"reputation": 384463, "user_id": 1126841, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/fa05233b2357f8d11c22ef4cfc7bb85c?s=128&d=identicon&r=PG", "display_name": "chepner", "link": "https://stackoverflow.com/users/1126841/chepner"}, "is_accepted": false, "score": 4, "last_activity_date": 1468876799, "creation_date": 1468876799, "answer_id": 38446175, "question_id": 38445968, "link": "https://stackoverflow.com/questions/38445968/difference-between-variable-definition-in-a-haskell-source-file-and-in-ghci/38446175#38446175", "title": "difference between variable definition in a Haskell source file and in GHCi?", "body": "<p>Successive <code>let</code> \"statements\" in the interactive interpreter are really the equivalent of nested <code>let</code> expressions. They behave as if there is an implied <code>in</code> following the assignment, and the rest of the interpreter session comprises the body of the <code>let</code>. That is</p>\n\n<pre><code>&gt;&gt;&gt; let a = 1\n&gt;&gt;&gt; let a = 1\n&gt;&gt;&gt; print a\n</code></pre>\n\n<p>is the same as</p>\n\n<pre><code>let a = 1 in\nlet a = 1 in\nprint a\n</code></pre>\n"}, {"comments": [{"owner": {"reputation": 18780, "user_id": 683218, "user_type": "registered", "accept_rate": 69, "profile_image": "https://i.stack.imgur.com/7Vy7c.png?s=128&g=1", "display_name": "tinlyx", "link": "https://stackoverflow.com/users/683218/tinlyx"}, "edited": false, "score": 0, "creation_date": 1469083914, "post_id": 38448591, "comment_id": 64393837, "body": "Your first sentence pretty much says it. Thanks for the clarification."}], "tags": [], "owner": {"reputation": 56659, "user_id": 450128, "user_type": "registered", "accept_rate": 62, "profile_image": "https://www.gravatar.com/avatar/2f72b3fdc99fe9fd1bbeb2f9da1d2c0a?s=128&d=identicon&r=PG", "display_name": "Ben", "link": "https://stackoverflow.com/users/450128/ben"}, "is_accepted": true, "score": 0, "last_activity_date": 1468894954, "creation_date": 1468894954, "answer_id": 38448591, "question_id": 38445968, "link": "https://stackoverflow.com/questions/38445968/difference-between-variable-definition-in-a-haskell-source-file-and-in-ghci/38448591#38448591", "title": "difference between variable definition in a Haskell source file and in GHCi?", "body": "<p>There is a key difference in Haskell in having two definitions of the same name and identical scopes, and having two definitions of the same name in nested scopes. GHCi vs modules in a file isn't really related to the underlying concept here, but those situations do lead you to encounter problems if you're not familiar with it.</p>\n\n<p>A let-expression (and a let-statement in a do block) creates a <em>set</em> of bindings with the same scope, not just a single binding. For example, as an expression:</p>\n\n<pre><code>let a = True\n    a = False\nin  a\n</code></pre>\n\n<p>Or with braces and semicolons (more convenient to paste into GHCi without turning on multi-line mode):</p>\n\n<pre><code>let { a = True; a = False} in a\n</code></pre>\n\n<p>This will fail, whether in a module or in GHCi. There cannot be a single variable <code>a</code> that is both <code>True</code> and <code>False</code>, and there can't be two separate variables named <code>a</code> in the same scope (or it would be impossible to know which one was being referred to by the source text <code>a</code>).</p>\n\n<p>The variables in a single binding set are all defined \"at once\"; the order they're written in is not relevant at all. You can see this because it's possible to define mututally-recursive bindings that all refer to each other, and couldn't possibly be defined one-at-a-time in any order:</p>\n\n<pre><code>\u03bb let a = True : b\n|     b = False : a\n| in  take 10 a\n[True,False,True,False,True,False,True,False,True,False]\nit :: [Bool]\n</code></pre>\n\n<p>Here I've defined an infinite list of alternating <code>True</code> and <code>False</code>, and used it to come up with a finite result.</p>\n\n<p>A Haskell module is a <strong>single</strong> scope, containing all the definitions in the file. Exactly as in a let-expression with multiple bindings, all the definitions \"happen at once\"<sup>1</sup>; they're only in a particular order because writing them down in a file inevitably introduces an order. So in a module this:</p>\n\n<pre><code>a = True\na = False\n</code></pre>\n\n<p>gives you an error, as you've seen.</p>\n\n<p>In a do-block you have let-statements rather than let-expressions.<sup>2</sup> These don't have an <code>in</code> part since they just scope over the entire rest of the do-block.<sup>3</sup> GHCi commands are very like entering statements in an <code>IO</code> do-block, so you have the same option there, and that's what you're using in your example.</p>\n\n<p>However your example has <em>two</em> let-bindings, not one. So there are two separate variables named <code>a</code> defined in two separate scopes.</p>\n\n<p>Haskell doesn't care (almost ever) about the written order of different definitions, but it <em>does</em> care about the \"nesting order\" of nested scopes; the rule is that when you refer to a variable <code>a</code>, you get the inner-most definition of <code>a</code> whose scope contains the reference.<sup>4</sup></p>\n\n<p>As an aside, hiding an outer-scope name by reusing a name in an inner scope is known as <strong>shadowing</strong> (we say the inner definition shadows the outer one). It's a useful general programming term to know, since the concept comes up in many languages.</p>\n\n<p>So it's not that the rules about when you can define a name twice are different in GHCi vs a module, its just that the different context makes different things easier.</p>\n\n<p>If you want to put a bunch of definitions in a module, the easy thing to do is make them all top-level definitions, which all have the same scope (the whole module) and so you get an error if you use the same name twice. You have to work a bit more to nest the definitions.</p>\n\n<p>In GHCi you're entering commands one-at-a-time, and it's more work to use multi-line commands or braces-and-semicolon style, so the easy thing when you want to enter several definitions is to use several let statements, and so you end up shadowing earlier definitions if you reuse names.<sup>5</sup> You have to more deliberately try to actually enter multiple names in the same scope.</p>\n\n<hr>\n\n<p><sup>1</sup> Or more accurately the bindings \"just are\" without any notion of \"the time at which they happen\" at all.</p>\n\n<p><sup>2</sup> Or rather: you have let-statements as well as let-expressions, since statements are mostly made up of expressions and a let-expression is always valid as an expression.</p>\n\n<p><sup>3</sup> You can see this as a general rule that later statements in a do-block are conceptually nested inside all earlier statements, since that's what they mean when you translate them to monadic operations; indeed let-statements are actually translated to let-expressions with the rest of the do-block inside the <code>in</code> part.</p>\n\n<p><sup>4</sup> It's not ambiguous like two variables with the same name in the same scope would be, though it is impossible to refer to any further-out definitions.</p>\n\n<p><sup>5</sup> And note that anything you've previously defined referring to the name before the shadowing will still behave <em>exactly</em> as it did before, referring to the previous name. This includes functions that return the value of the variable. It's easiest to understand shadowing as introducing a <em>different</em> variable that happens to have the same name as an earlier one, rather than trying to understand it as actually changing what the earlier variable name refers to.</p>\n"}], "owner": {"reputation": 18780, "user_id": 683218, "user_type": "registered", "accept_rate": 69, "profile_image": "https://i.stack.imgur.com/7Vy7c.png?s=128&g=1", "display_name": "tinlyx", "link": "https://stackoverflow.com/users/683218/tinlyx"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 246, "favorite_count": 0, "accepted_answer_id": 38448591, "answer_count": 2, "score": 0, "last_activity_date": 1468894954, "creation_date": 1468875888, "last_edit_date": 1468876517, "question_id": 38445968, "link": "https://stackoverflow.com/questions/38445968/difference-between-variable-definition-in-a-haskell-source-file-and-in-ghci", "title": "difference between variable definition in a Haskell source file and in GHCi?", "body": "<p>In a Haskell source file, I can write </p>\n\n<pre><code>a = 1\n</code></pre>\n\n<p>and I had the impression that I have to write the same in GHCi as</p>\n\n<pre><code>let a = 1\n</code></pre>\n\n<p>, for <code>a = 1</code> in GHCi gives a parse error on <code>=</code>.</p>\n\n<p>Now, if I write </p>\n\n<pre><code>a = 1\na = 2\n</code></pre>\n\n<p>in a source file, I will get an error about Multiple declaration of <code>a</code>, but it is <strong>OK</strong> to write in GHCi:</p>\n\n<pre><code>let a = 1\nlet a = 2\n</code></pre>\n\n<p>Can someone help clarify the difference between the two styles?</p>\n"}, {"tags": ["haskell", "asynchronous", "exception-handling"], "comments": [{"owner": {"reputation": 49959, "user_id": 866915, "user_type": "registered", "accept_rate": 70, "profile_image": "https://www.gravatar.com/avatar/09242131d6e17cbbe31e8547514da6e5?s=128&d=identicon&r=PG", "display_name": "ErikR", "link": "https://stackoverflow.com/users/866915/erikr"}, "edited": false, "score": 0, "creation_date": 1468881345, "post_id": 38445720, "comment_id": 64299383, "body": "if you don&#39;t get any answers here, you should ask <a href=\"https://groups.google.com/forum/#!forum/haskell-cafe\" rel=\"nofollow noreferrer\">the Haskell-Cafe mailing list</a> or <a href=\"http://reddit.com/r/haskell\" rel=\"nofollow noreferrer\">/r/haskell</a>."}], "owner": {"reputation": 4471, "user_id": 3858142, "user_type": "registered", "accept_rate": 46, "profile_image": "https://www.gravatar.com/avatar/4c27dead2edf0b6dc28833a694c42ba1?s=128&d=identicon&r=PG&f=1", "display_name": "sevo", "link": "https://stackoverflow.com/users/3858142/sevo"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 55, "favorite_count": 0, "closed_date": 1468889532, "answer_count": 0, "score": 2, "last_activity_date": 1468874788, "creation_date": 1468874788, "question_id": 38445720, "link": "https://stackoverflow.com/questions/38445720/what-would-be-the-consequences-of-semi-asynchronous-exception-handling-in-ghc", "closed_reason": "Needs more focus", "title": "What would be the consequences of semi-asynchronous exception handling in GHC?", "body": "<p>I'm worried that approach to asynchronous exceptions in <code>GHC</code> might be a net-loss for many applications.</p>\n\n<p>While <a href=\"http://community.haskell.org/~simonmar/papers/async.pdf\" rel=\"nofollow\">the paper</a> explains the design to a great detail, it's too complex for average programmers to tell whether this approach provides any benefits at all in their daily work. </p>\n\n<p>Section 2 lists four reasons for current approach (speculative computation, timeouts, user interrupt and resource exhaustion). In my opinion, three are about ability to cancel computations and one is about ability to recover from resource exhaustion which I find questionable (is there any publicly available code that demonstrates this?).</p>\n\n<p>In particular, as mentioned in the paper, <code>Java</code> deprecated <code>Thread.stop()</code> because aborted computation would result in undefined state. Aren't <code>IO</code> actions in <code>GHC</code> subject to the same? Add laziness and the API becomes much more complex in comparison for no clear benefit to most applications.</p>\n\n<p>To summarize, if <code>GHC</code> used the same approach as <code>Java</code> (safe-points, interrupt polling) what would be the consequences to the ecosystem?</p>\n"}, {"tags": ["user-interface", "haskell", "button", "filechooser", "gtk2hs"], "comments": [{"owner": {"reputation": 48129, "user_id": 76051, "user_type": "registered", "accept_rate": 91, "profile_image": "https://i.stack.imgur.com/AGDxz.jpg?s=128&g=1", "display_name": "Carsten", "link": "https://stackoverflow.com/users/76051/carsten"}, "edited": false, "score": 0, "creation_date": 1468868074, "post_id": 38443877, "comment_id": 64293411, "body": "change the signature to <code>IO Files</code> (don&#39;t know the type of your Files so look for it), move <code>widgetDestroy ...</code> into both <code>case</code>s and then use <code>return files</code> right below them both"}, {"owner": {"user_type": "does_not_exist", "display_name": "user4424299"}, "reply_to_user": {"reputation": 48129, "user_id": 76051, "user_type": "registered", "accept_rate": 91, "profile_image": "https://i.stack.imgur.com/AGDxz.jpg?s=128&g=1", "display_name": "Carsten", "link": "https://stackoverflow.com/users/76051/carsten"}, "edited": false, "score": 0, "creation_date": 1468868493, "post_id": 38443877, "comment_id": 64293636, "body": "@Carsten: thank you! But how can I access these from the onClicked function in the main function?"}, {"owner": {"reputation": 126897, "user_id": 791604, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/ce991df7a056248d5e4f6fc3659ba733?s=128&d=identicon&r=PG", "display_name": "Daniel Wagner", "link": "https://stackoverflow.com/users/791604/daniel-wagner"}, "edited": false, "score": 0, "creation_date": 1468869083, "post_id": 38443877, "comment_id": 64293942, "body": "Possible duplicate of <a href=\"http://stackoverflow.com/q/12002814/791604\">How to deal with application state in Gtk2Hs</a>. Does the answer there address your concerns? If not, why not?"}, {"owner": {"user_type": "does_not_exist", "display_name": "user4424299"}, "reply_to_user": {"reputation": 126897, "user_id": 791604, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/ce991df7a056248d5e4f6fc3659ba733?s=128&d=identicon&r=PG", "display_name": "Daniel Wagner", "link": "https://stackoverflow.com/users/791604/daniel-wagner"}, "edited": false, "score": 0, "creation_date": 1468869357, "post_id": 38443877, "comment_id": 64294081, "body": "@Daniel Wagner I think the MVar&#39;s might work! Thank you!"}], "owner": {"user_type": "does_not_exist", "display_name": "user4424299"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 31, "favorite_count": 0, "closed_date": 1468872085, "answer_count": 0, "score": 0, "last_activity_date": 1468867294, "creation_date": 1468867294, "question_id": 38443877, "link": "https://stackoverflow.com/questions/38443877/how-to-pass-data-from-onclick-function", "closed_reason": "Duplicate", "title": "How to pass data from onClick function", "body": "<p>I'm building a small Haskell GUI application as an exercise for myself using the gtk2hs library, but I'm stuck at a certain point. So I want to show a FileChooserDialog where a user can select multiple images, and I made a function that does all of this, but now I cannot think of a way to return these values to the main function so that these can work with the selected files. This is my main function that creates main window:</p>\n\n<pre><code>main :: IO ()\nmain = do\n    initGUI\n    window &lt;- windowNew\n    set window [windowDefaultWidth := 300, windowDefaultHeight := 150, containerBorderWidth := 10]\n    table &lt;- tableNew 3 4 True\n    containerAdd window table\n    startButton &lt;- buttonNewWithLabel \"Start\"\n    tableAttachDefaults table startButton 0 4 2 3\n    selectButton &lt;- buttonNewWithLabel \"Select images\"\n    tableAttachDefaults table selectButton 0 2 0 1\n    selectedLabel &lt;- labelNew (Just \"0 images selected\")\n    tableAttachDefaults table selectedLabel 2 4 0 1\n    onClicked selectButton (selectImages selectedLabel window)\n    shiftLabel &lt;- labelNew (Just \"Days to shift: \")\n    -- Left align text in label\n    miscSetAlignment shiftLabel 0.0 0.5\n    tableAttachDefaults table shiftLabel 0 3 1 2\n    adjustment &lt;- adjustmentNew 0.0 (-5000.0) 5000.0 1.0 10.0 0.0\n    spinner &lt;- spinButtonNew adjustment 0.5 0\n    tableAttachDefaults table spinner 3 4 1 2\n    widgetShowAll window\n    mainGUI\n</code></pre>\n\n<p>The function that shows the FileChooserDialog is the selectImages function and is an onClick function for the selectButton. This function works like this:</p>\n\n<pre><code>selectImages :: LabelClass self =&gt; self -&gt; Window -&gt; IO ()\nselectImages resultLabel parent = do\n    chooser &lt;- fileChooserDialogNew (Just \"Select images\") (Just parent) FileChooserActionOpen [(\"Cancel\", ResponseCancel), (\"Open\", ResponseAccept)]\n    fileChooserSetSelectMultiple chooser True\n    widgetShow chooser\n    response &lt;- dialogRun chooser\n    case response of\n        ResponseCancel -&gt; putStrLn \"Cancelled\"\n        ResponseAccept -&gt; do\n            files &lt;- fileChooserGetFilenames chooser\n            labelSetText resultLabel $ (show (length files)) ++ \" images selected\"\n    widgetDestroy chooser\n</code></pre>\n\n<p>Now what I want to do, is to be able to return the files array from the selectImages function to the main function for further processing. How can I do this? Should I somehow use the StateT transformer? Or something else?</p>\n"}, {"tags": ["haskell", "pattern-matching", "monads"], "comments": [{"owner": {"reputation": 37219, "user_id": 1523776, "user_type": "moderator", "accept_rate": 87, "profile_image": "https://www.gravatar.com/avatar/b3e0b5c8e42a8c38009ef2d969f8dabb?s=128&d=identicon&r=PG", "display_name": "Benjamin Hodgson", "link": "https://stackoverflow.com/users/1523776/benjamin-hodgson"}, "edited": false, "score": 2, "creation_date": 1468864871, "post_id": 38442963, "comment_id": 64291876, "body": "I think you&#39;ve confused yourself. You&#39;ll only enter the guard (or the <code>if-then-else</code>) if <code>Bar</code> matches. If <code>Bar</code> matched (and you reached the conditional), then you already know that <code>Baz</code>, <code>Quux</code> et al don&#39;t match, so there&#39;s no reason to continue with the <code>case</code> block."}, {"owner": {"reputation": 48938, "user_id": 246886, "user_type": "registered", "accept_rate": 94, "profile_image": "https://www.gravatar.com/avatar/dd1ebaade6623fc538fb8af3338e730d?s=128&d=identicon&r=PG", "display_name": "Jon Purdy", "link": "https://stackoverflow.com/users/246886/jon-purdy"}, "reply_to_user": {"reputation": 37219, "user_id": 1523776, "user_type": "moderator", "accept_rate": 87, "profile_image": "https://www.gravatar.com/avatar/b3e0b5c8e42a8c38009ef2d969f8dabb?s=128&d=identicon&r=PG", "display_name": "Benjamin Hodgson", "link": "https://stackoverflow.com/users/1523776/benjamin-hodgson"}, "edited": false, "score": 0, "creation_date": 1468865172, "post_id": 38442963, "comment_id": 64292040, "body": "@BenjaminHodgson: Good catch. Updated the example. I\u2019m operating on a pair of values, and it\u2019s still possible for later cases to match."}, {"owner": {"reputation": 84731, "user_id": 510937, "user_type": "registered", "accept_rate": 80, "profile_image": "https://www.gravatar.com/avatar/70b13a9ae1aae1ca1aa6ac8dab4643f2?s=128&d=identicon&r=PG", "display_name": "Bakuriu", "link": "https://stackoverflow.com/users/510937/bakuriu"}, "edited": false, "score": 2, "creation_date": 1468865589, "post_id": 38442963, "comment_id": 64292222, "body": "No it&#39;s not. Can you just provide the <b>actual case</b> you are using instead of one with made up names that doesn&#39;t actually show what you are doing?"}, {"owner": {"reputation": 48938, "user_id": 246886, "user_type": "registered", "accept_rate": 94, "profile_image": "https://www.gravatar.com/avatar/dd1ebaade6623fc538fb8af3338e730d?s=128&d=identicon&r=PG", "display_name": "Jon Purdy", "link": "https://stackoverflow.com/users/246886/jon-purdy"}, "reply_to_user": {"reputation": 84731, "user_id": 510937, "user_type": "registered", "accept_rate": 80, "profile_image": "https://www.gravatar.com/avatar/70b13a9ae1aae1ca1aa6ac8dab4643f2?s=128&d=identicon&r=PG", "display_name": "Bakuriu", "link": "https://stackoverflow.com/users/510937/bakuriu"}, "edited": false, "score": 0, "creation_date": 1468866257, "post_id": 38442963, "comment_id": 64292521, "body": "@Bakuriu: The real code is more complex, and I don\u2019t know that it\u2019s really relevant, but I can update the example in a moment. In reality I have a constructor <code>:@</code>, and my <code>Bar</code> case is really a match on <code>Ctor &quot;Join&quot; :@ a :@ b</code>, which comes before matching on the more generic case of <code>a :@ b</code>."}, {"owner": {"reputation": 384463, "user_id": 1126841, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/fa05233b2357f8d11c22ef4cfc7bb85c?s=128&d=identicon&r=PG", "display_name": "chepner", "link": "https://stackoverflow.com/users/1126841/chepner"}, "edited": false, "score": 2, "creation_date": 1468866386, "post_id": 38442963, "comment_id": 64292578, "body": "@JonPurdy You don&#39;t have to post your real code, but you do need to post an <i>actual</i>, executable example that demonstrates the problem."}], "answers": [{"comments": [{"owner": {"reputation": 10378, "user_id": 2476735, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/39e9447bbc32246fcd23b76b5e946618?s=128&d=identicon&r=PG&f=1", "display_name": "David Young", "link": "https://stackoverflow.com/users/2476735/david-young"}, "edited": false, "score": 2, "creation_date": 1468887581, "post_id": 38443414, "comment_id": 64300905, "body": "If the match in the fall-through is something relatively specific like <code>x :@ y</code> (as @JonPurdy seems to have implied in a comment), you could make <code>rest</code> a two argument function to avoid having a partial function."}], "tags": [], "owner": {"reputation": 37219, "user_id": 1523776, "user_type": "moderator", "accept_rate": 87, "profile_image": "https://www.gravatar.com/avatar/b3e0b5c8e42a8c38009ef2d969f8dabb?s=128&d=identicon&r=PG", "display_name": "Benjamin Hodgson", "link": "https://stackoverflow.com/users/1523776/benjamin-hodgson"}, "is_accepted": false, "score": 3, "last_activity_date": 1468877064, "last_edit_date": 1468877064, "creation_date": 1468865654, "answer_id": 38443414, "question_id": 38442963, "link": "https://stackoverflow.com/questions/38442963/exhaustive-case-with-monadic-guard/38443414#38443414", "title": "Exhaustive case with monadic guard", "body": "<p>One simple option would be to grab the second half of your <code>case</code> block and put it in a separate function.</p>\n\n<pre><code>case (x, y) of\n  (Foo ..., Foo ...) -&gt; ...\n  x@(Bar ..., Bar ...) -&gt; do\n    condition &lt;- action\n    if condition\n    then ...\n    else rest x\n  x -&gt; rest x\n\nrest (Baz ..., ...) = ...\nrest (Var ..., ...) = ...\n...\nrest _ = undefined\n</code></pre>\n\n<p>It's a bit unsatisfying to use <code>undefined</code> in the fall-through case of <code>rest</code> to catch patterns which you believe should've been matched in the first half of the original <code>case</code> block. If you manage to violate the precondition (that <code>(Foo, Foo)</code> etc didn't match) then you'd get a runtime error.</p>\n"}, {"tags": [], "owner": {"reputation": 100185, "user_id": 3234959, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/93bb12ca0f93dfddb33880316f7e66c2?s=128&d=identicon&r=PG&f=1", "display_name": "chi", "link": "https://stackoverflow.com/users/3234959/chi"}, "is_accepted": false, "score": 3, "last_activity_date": 1468867113, "last_edit_date": 1468867113, "creation_date": 1468866812, "answer_id": 38443743, "question_id": 38442963, "link": "https://stackoverflow.com/questions/38442963/exhaustive-case-with-monadic-guard/38443743#38443743", "title": "Exhaustive case with monadic guard", "body": "<p>I'm not a fan of the approach below, but I will share it anyway:</p>\n\n<pre><code>fix (\\proceed b -&gt; case (x, y, b) of\n  (Foo ..., Foo ..., False) -&gt; ...\n  (Bar ..., Bar ..., False) -&gt; do\n    condition &lt;- action\n    if condition\n      then ...\n      else proceed True\n  (Baz ..., ..., _) -&gt; ...\n  (Var ..., ..., _) -&gt; ...\n  ...\n) False\n</code></pre>\n\n<p>The additional flag <code>b</code> is initially false, so all the branches are considered. Once we <code>proceed</code>, we set it to true so that the first branches are skipped.</p>\n\n<p>May or may not be statically found exhaustive, depending on the actual patterns.</p>\n"}, {"tags": [], "owner": {"reputation": 48938, "user_id": 246886, "user_type": "registered", "accept_rate": 94, "profile_image": "https://www.gravatar.com/avatar/dd1ebaade6623fc538fb8af3338e730d?s=128&d=identicon&r=PG", "display_name": "Jon Purdy", "link": "https://stackoverflow.com/users/246886/jon-purdy"}, "is_accepted": false, "score": 0, "last_activity_date": 1523772349, "creation_date": 1523772349, "answer_id": 49838986, "question_id": 38442963, "link": "https://stackoverflow.com/questions/38442963/exhaustive-case-with-monadic-guard/49838986#49838986", "title": "Exhaustive case with monadic guard", "body": "<p>What I ended up doing was using a monad stack equipped with <code>Maybe</code> and replacing the <code>case</code> with <code>asum</code> over a list of actions, following this structure:</p>\n\n<pre><code>asum\n\n  [ do\n    pattern1 &lt;- pure input  -- failed pattern matches fall through\n    body1\n\n  , do\n    pattern2 &lt;- pure input\n    body2\n\n  , do\n    pattern1 &lt;- pure input\n    guard condition         -- guards also fall through\n    body3\n\n  , ...\n\n  ]\n</code></pre>\n\n<p>As I recently described in <a href=\"https://stackoverflow.com/a/49518519/246886\">this answer</a> to someone else\u2019s question. Unfortunately, this doesn\u2019t allow exhaustiveness checking.</p>\n"}, {"tags": [], "owner": {"reputation": 20862, "user_id": 376113, "user_type": "registered", "accept_rate": 72, "profile_image": "https://www.gravatar.com/avatar/d3a5bd12fe6d876527a3cf4ac0de5fc6?s=128&d=identicon&r=PG", "display_name": "mb14", "link": "https://stackoverflow.com/users/376113/mb14"}, "is_accepted": false, "score": 0, "last_activity_date": 1523788904, "creation_date": 1523788904, "answer_id": 49841003, "question_id": 38442963, "link": "https://stackoverflow.com/questions/38442963/exhaustive-case-with-monadic-guard/49841003#49841003", "title": "Exhaustive case with monadic guard", "body": "<p>The obvious question is : can you not untangle the pure and impure bit ?\nWithout the actual code is hard to tell but if only one condition is actually the problem you can do a two level cases using Either or Maybe, which capture all the specific conditions.</p>\n\n<pre><code>step &lt;-case x of \n   pattern2 -&gt; condition &lt;- action\n                if condition \n                then Just whatToDo\n                else Nothing\n\n   pattern5 -&gt; condition &lt;- action2\n                if condition\n                then Just whatToDo2\n\n   _ -&gt; Nothing\n\ncase step of\n  Just action -&gt; action\n  Nothing -&gt; case x of\n       pattern 1 -&gt; body1\n       ....\n</code></pre>\n\n<p>Depending on your real case, you might want to use a different intermediate type, maybe even create your own custom one, or realize you actually don't even need any.</p>\n"}], "owner": {"reputation": 48938, "user_id": 246886, "user_type": "registered", "accept_rate": 94, "profile_image": "https://www.gravatar.com/avatar/dd1ebaade6623fc538fb8af3338e730d?s=128&d=identicon&r=PG", "display_name": "Jon Purdy", "link": "https://stackoverflow.com/users/246886/jon-purdy"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 352, "favorite_count": 1, "answer_count": 4, "score": 3, "last_activity_date": 1523788904, "creation_date": 1468863995, "last_edit_date": 1468890258, "question_id": 38442963, "link": "https://stackoverflow.com/questions/38442963/exhaustive-case-with-monadic-guard", "title": "Exhaustive case with monadic guard", "body": "<p>I have a <code>case</code> expression with a relatively large number of patterns:</p>\n\n<pre><code>case x of\n  ... -&gt; ...\n  ... -&gt; ...\n  ... -&gt; ...\n  ... -&gt; ...\n  ...\n  _ -&gt; ...\n</code></pre>\n\n<p>One of these cases has a guard:</p>\n\n<pre><code>case x of\n  ... -&gt; ...\n  ... -&gt; ...\n  ... | condition -&gt; ...\n    -- If condition is false, fall through to \u201cRest\u201d.\n\n  -- Rest:\n  ... -&gt; ...\n  ... -&gt; ...\n  ...\n  _ -&gt; ...\n</code></pre>\n\n<p>If the guard doesn\u2019t match, we just fall through to the remaining cases, no problem. But now I need to test the condition monadically, so I do:</p>\n\n<pre><code>case x of\n  ... -&gt; ...\n  ... -&gt; ...\n  ... -&gt; do\n    condition &lt;- action\n    if condition\n      then ...\n      else ...  -- How to fall through?\n\n  -- Rest:\n  ... -&gt; ...\n  ... -&gt; ...\n  ...\n  _ -&gt; ...\n</code></pre>\n\n<p>However, I think I\u2019ve made a misstep. There doesn\u2019t seem to be a way of having the <code>else</code> branch proceed to the remaining cases without duplicating those branches or factoring them into a function. And either way messes with exhaustivity checking: if I want to add a case after the guard, the compiler doesn\u2019t know whether the matches are exhaustive.</p>\n\n<p>How can I change this function, or parameterise/wrap the datatype, to get exhaustiveness checking using a monadic guard? </p>\n"}, {"tags": ["haskell", "types", "ghc"], "answers": [{"comments": [{"owner": {"reputation": 4545, "user_id": 3901400, "user_type": "registered", "accept_rate": 69, "profile_image": "https://i.stack.imgur.com/gvB8O.jpg?s=128&g=1", "display_name": "Marcus Ruddick", "link": "https://stackoverflow.com/users/3901400/marcus-ruddick"}, "edited": false, "score": 0, "creation_date": 1468858179, "post_id": 38441335, "comment_id": 64288405, "body": "Thank you, that was it!, ill accept when it allows me to"}], "tags": [], "owner": {"reputation": 13920, "user_id": 371228, "user_type": "registered", "accept_rate": 96, "profile_image": "https://www.gravatar.com/avatar/a4028c5dd749d198d7a8f2601d4afe07?s=128&d=identicon&r=PG", "display_name": "bdesham", "link": "https://stackoverflow.com/users/371228/bdesham"}, "is_accepted": true, "score": 8, "last_activity_date": 1540051282, "last_edit_date": 1540051282, "creation_date": 1468857860, "answer_id": 38441335, "question_id": 38441204, "link": "https://stackoverflow.com/questions/38441204/expected-a-type-but-num-a-has-kind-ghc-prim-constraint/38441335#38441335", "title": "Expected a type, but \u2018Num a\u2019 has kind \u2018GHC.Prim.Constraint\u2019", "body": "<p>When you write</p>\n\n<pre><code>apply :: Num a =&gt; Poly a -&gt; Num a -&gt; Num a\n</code></pre>\n\n<p>the first instance of <code>Num a</code> is a constraint that means that the type <code>a</code> must conform to the <code>Num</code> typeclass. Once you\u2019ve specified that constraint once, though, you don\u2019t need to do so again. The problem you\u2019re having is that you\u2019re using the <em>constraint</em> <code>Num a</code> a couple more times on this line when you should just be using the <em>type</em> <code>a</code>. To solve your problem, change the type of <code>apply</code> to the following:</p>\n\n<pre><code>apply :: Num a =&gt; Poly a -&gt; a -&gt; a\n</code></pre>\n\n<p>Informally speaking, the things between <code>::</code> and <code>=&gt;</code> in a type signature are constraints, while the things to the right of <code>=&gt;</code> need to be types. (Note that some type signatures don\u2019t include any constraints, in which case they won\u2019t include the <code>=&gt;</code> delimiter either.)</p>\n"}], "owner": {"reputation": 4545, "user_id": 3901400, "user_type": "registered", "accept_rate": 69, "profile_image": "https://i.stack.imgur.com/gvB8O.jpg?s=128&g=1", "display_name": "Marcus Ruddick", "link": "https://stackoverflow.com/users/3901400/marcus-ruddick"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 8406, "favorite_count": 1, "accepted_answer_id": 38441335, "answer_count": 1, "score": 3, "last_activity_date": 1540051282, "creation_date": 1468857442, "last_edit_date": 1481203289, "question_id": 38441204, "link": "https://stackoverflow.com/questions/38441204/expected-a-type-but-num-a-has-kind-ghc-prim-constraint", "title": "Expected a type, but \u2018Num a\u2019 has kind \u2018GHC.Prim.Constraint\u2019", "body": "<p>I'm attempting to take a polynomial representation in list form (e.g. [3, 2, 1] is 3x^2 + 2x + 1) and evaluate it, by executing apply on the polynomial and a number for x. The polynomial is to be evaluated for x.</p>\n\n<p>This is my code:</p>\n\n<pre><code>newtype Poly a = P [a]\n\napply :: Num a =&gt; Poly a -&gt; Num a -&gt; Num a\napply (P p) x = if (i &gt; 0) then (x * ((head p) ^ i)) + (apply (P (tail p)) x) else p\n    where  i = length p\n</code></pre>\n\n<p>The problem is when I try to compile this code, I get an error that I don't understand: </p>\n\n<blockquote>\n  <p>Expected a type, but \u2018Num a\u2019 has kind \u2018GHC.Prim.Constraint\u2019<br>\n      In the type signature for \u2018apply\u2019:<br>\n        apply :: Num a => Poly a -> Num a -> Num a  </p>\n</blockquote>\n"}, {"tags": ["haskell"], "comments": [{"owner": {"reputation": 49959, "user_id": 866915, "user_type": "registered", "accept_rate": 70, "profile_image": "https://www.gravatar.com/avatar/09242131d6e17cbbe31e8547514da6e5?s=128&d=identicon&r=PG", "display_name": "ErikR", "link": "https://stackoverflow.com/users/866915/erikr"}, "edited": false, "score": 0, "creation_date": 1468856278, "post_id": 38440636, "comment_id": 64287224, "body": "To help us understand the question, what result do you want for your example?"}, {"owner": {"reputation": 791, "user_id": 1587319, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/1c8a88b9a8d79a518cba52a7a8d099f9?s=128&d=identicon&r=PG", "display_name": "pdexter", "link": "https://stackoverflow.com/users/1587319/pdexter"}, "edited": false, "score": 0, "creation_date": 1468856573, "post_id": 38440636, "comment_id": 64287404, "body": "It sounds like you want to map over the vertices"}, {"owner": {"user_type": "does_not_exist", "display_name": "user6518699"}, "edited": false, "score": 0, "creation_date": 1468856667, "post_id": 38440636, "comment_id": 64287462, "body": "I want to assign to each vertex x and y, and then display each vertex on the screen :)"}], "answers": [{"tags": [], "owner": {"reputation": 62421, "user_id": 216164, "user_type": "registered", "accept_rate": 89, "profile_image": "https://www.gravatar.com/avatar/786f224adbe0784cdf7d0f15476061fe?s=128&d=identicon&r=PG", "display_name": "Thomas M. DuBuisson", "link": "https://stackoverflow.com/users/216164/thomas-m-dubuisson"}, "is_accepted": false, "score": 1, "last_activity_date": 1468867661, "creation_date": 1468867661, "answer_id": 38443968, "question_id": 38440636, "link": "https://stackoverflow.com/questions/38440636/vertex-representation-haskell/38443968#38443968", "title": "Vertex representation haskell", "body": "<p>Step 1: Write a question that compiles:</p>\n\n<pre><code>import Data.Graph.Inductive\nimport Data.Graph.Inductive.Example\n</code></pre>\n\n<p>Step 2: Include enough words to help us understand what you are doing:</p>\n\n<pre><code>-- Construct a graph with node Ids from 1 to 7 and edges with ids\n-- all set to '1'.\ngraph1 :: Gr Int Int.\ngraph1 = mkGraph (genLNodes 1 7)[(1,2,1),\n                (2,3,1),\n                (3,4,1),\n                (3,5,1),\n                (5,6,1),\n                (5,7,1)]\n\nmain :: IO ()\nmain =\n do let l1 = level 1 graph1\n    -- ^^ This is a breadth-first search of the graph starting at node '1'.\n    print l1\n    -- Output: [(1,0),(2,1),(3,2),(4,3),(5,3),(6,4),(7,4)]\n</code></pre>\n\n<p>Step 3: State the desired end goal and attempts to reach that state.  Sadly you have shown no attempt to solve the problem.  Zero effort questions are generally discouraged here.  Even if you can't get things to work it is generally more productive to show your attempt - it serves as a focal point for learning and teaching.</p>\n\n<p>My interpretation of your goal and solution is thus:</p>\n\n<pre><code>-- Now we want to assign each vertex an x and y value where 'x' is\n-- taken as the 2nd element in the above-printed tuple - that is, the\n-- 'x' value is the distance from the starting vertex which was '1'.\nlet xyGraph = map (\\(nodeId,xVal) -&gt; (nodeId,xVal,defaultYValue)) l1\n    defaultYValue = 0\nprint xyGraph\n</code></pre>\n"}], "owner": {"user_type": "does_not_exist", "display_name": "user6518699"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 126, "favorite_count": 0, "answer_count": 1, "score": 1, "last_activity_date": 1468867661, "creation_date": 1468855755, "last_edit_date": 1468866483, "question_id": 38440636, "link": "https://stackoverflow.com/questions/38440636/vertex-representation-haskell", "title": "Vertex representation haskell", "body": "<p>I'm using <a href=\"https://hackage.haskell.org/package/fgl\" rel=\"nofollow\">fgl</a> to represent my graph:</p>\n\n<pre><code>graph1 :: Gr Int Int \ngraph1 = mkGraph (genLNodes 1 7)[(1,2,1),\n                (2,3,1),\n                (3,4,1),\n                (3,5,1),\n                (5,6,1),\n                (5,7,1)]\n</code></pre>\n\n<p>Then I do </p>\n\n<pre><code>level 1 graph1\n</code></pre>\n\n<p>which returns</p>\n\n<pre><code>[(1,0),(2,1),(3,2),(4,3),(5,3),(6,4),(7,4)]\n</code></pre>\n\n<p>and now I want to assign to each vertex X and Y coordinates, where X is the second value from the tuple. For example, for the tuple <code>(1,0)</code>, X=0. Y is not relevant, and could be 0 for now.</p>\n\n<p>I don't know how to write it in Haskell; I would be very grateful for some help.</p>\n"}, {"tags": ["haskell"], "comments": [{"owner": {"reputation": 791, "user_id": 1587319, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/1c8a88b9a8d79a518cba52a7a8d099f9?s=128&d=identicon&r=PG", "display_name": "pdexter", "link": "https://stackoverflow.com/users/1587319/pdexter"}, "edited": false, "score": 1, "creation_date": 1468851416, "post_id": 38439008, "comment_id": 64283690, "body": "You can try <code>fromIntegral</code> but it adds an additional constraint of <code>Integral</code>"}, {"owner": {"reputation": 701, "user_id": 2028189, "user_type": "registered", "accept_rate": 71, "profile_image": "https://www.gravatar.com/avatar/c4ca5514c17ff9231cb37f60e6cd922c?s=128&d=identicon&r=PG", "display_name": "Kwang Yul Seo", "link": "https://stackoverflow.com/users/2028189/kwang-yul-seo"}, "reply_to_user": {"reputation": 791, "user_id": 1587319, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/1c8a88b9a8d79a518cba52a7a8d099f9?s=128&d=identicon&r=PG", "display_name": "pdexter", "link": "https://stackoverflow.com/users/1587319/pdexter"}, "edited": false, "score": 0, "creation_date": 1468851607, "post_id": 38439008, "comment_id": 64283822, "body": "@pdexter But Float is not an instance of Integral."}, {"owner": {"reputation": 791, "user_id": 1587319, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/1c8a88b9a8d79a518cba52a7a8d099f9?s=128&d=identicon&r=PG", "display_name": "pdexter", "link": "https://stackoverflow.com/users/1587319/pdexter"}, "edited": false, "score": 1, "creation_date": 1468851852, "post_id": 38439008, "comment_id": 64284016, "body": "Can you rephrase your question? The topic says &quot;How to convert (Num a) =&gt; a to Float&quot; but your question asks how to write a generic function to multiply a Num a by 2. What exactly do you want to do?"}, {"owner": {"reputation": 701, "user_id": 2028189, "user_type": "registered", "accept_rate": 71, "profile_image": "https://www.gravatar.com/avatar/c4ca5514c17ff9231cb37f60e6cd922c?s=128&d=identicon&r=PG", "display_name": "Kwang Yul Seo", "link": "https://stackoverflow.com/users/2028189/kwang-yul-seo"}, "reply_to_user": {"reputation": 791, "user_id": 1587319, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/1c8a88b9a8d79a518cba52a7a8d099f9?s=128&d=identicon&r=PG", "display_name": "pdexter", "link": "https://stackoverflow.com/users/1587319/pdexter"}, "edited": false, "score": 0, "creation_date": 1468851887, "post_id": 38439008, "comment_id": 64284053, "body": "@BenjaminHodgson <code>(*2) :: Num a =&gt; a -&gt; a</code> can be <code>Int -&gt; Int</code> or <code>Float -&gt; Float</code>. But it can&#39;t be <code>Int -&gt; Float</code>."}, {"owner": {"reputation": 49959, "user_id": 866915, "user_type": "registered", "accept_rate": 70, "profile_image": "https://www.gravatar.com/avatar/09242131d6e17cbbe31e8547514da6e5?s=128&d=identicon&r=PG", "display_name": "ErikR", "link": "https://stackoverflow.com/users/866915/erikr"}, "edited": false, "score": 0, "creation_date": 1468852121, "post_id": 38439008, "comment_id": 64284230, "body": "You should explain why you need the exact signature <code>multiplyBy2 :: Num a =&gt; a -&gt; Float</code> , and perhaps we can show you how to organize your code differently."}], "answers": [{"comments": [{"owner": {"reputation": 94553, "user_id": 775806, "user_type": "registered", "accept_rate": 96, "profile_image": "https://i.stack.imgur.com/XNd2C.png?s=128&g=1", "display_name": "n. &#39;pronouns&#39; m.", "link": "https://stackoverflow.com/users/775806/n-pronouns-m"}, "edited": false, "score": 1, "creation_date": 1468852372, "post_id": 38439296, "comment_id": 64284410, "body": "<code>Complex</code> are not good <code>Num</code>s because every <code>Num</code> is supposed to have a <code>signum</code> (whether this is a good or bad thing I won&#39;t argue here ;)"}, {"owner": {"reputation": 701, "user_id": 2028189, "user_type": "registered", "accept_rate": 71, "profile_image": "https://www.gravatar.com/avatar/c4ca5514c17ff9231cb37f60e6cd922c?s=128&d=identicon&r=PG", "display_name": "Kwang Yul Seo", "link": "https://stackoverflow.com/users/2028189/kwang-yul-seo"}, "edited": false, "score": 0, "creation_date": 1468852394, "post_id": 38439296, "comment_id": 64284431, "body": "Thanks! Now I understand why there is no <code>toFloat :: Num a =&gt; a -&gt; Float</code>."}, {"owner": {"reputation": 37219, "user_id": 1523776, "user_type": "moderator", "accept_rate": 87, "profile_image": "https://www.gravatar.com/avatar/b3e0b5c8e42a8c38009ef2d969f8dabb?s=128&d=identicon&r=PG", "display_name": "Benjamin Hodgson", "link": "https://stackoverflow.com/users/1523776/benjamin-hodgson"}, "edited": false, "score": 6, "creation_date": 1468852558, "post_id": 38439296, "comment_id": 64284569, "body": "@nm The <a href=\"http://hackage.haskell.org/package/base-4.9.0.0/docs/Prelude.html#v:signum\" rel=\"nofollow noreferrer\">docs</a> say nothing more restrictive than <i>The functions <code>abs</code> and <code>signum</code> should satisfy the law <code>abs x * signum x == x</code></i>. There&#39;s a sensible implementation of this law for complex numbers: <code>abs (A e^i\u03c6) = A</code> and <code>signum (A e^i\u03c6) = e^i\u03c6</code>. I omitted it from my answer because I couldn&#39;t be bothered to do the trig to convert from rectangular to polar."}, {"owner": {"reputation": 84731, "user_id": 510937, "user_type": "registered", "accept_rate": 80, "profile_image": "https://www.gravatar.com/avatar/70b13a9ae1aae1ca1aa6ac8dab4643f2?s=128&d=identicon&r=PG", "display_name": "Bakuriu", "link": "https://stackoverflow.com/users/510937/bakuriu"}, "edited": false, "score": 0, "creation_date": 1468852673, "post_id": 38439296, "comment_id": 64284680, "body": "@BenjaminHodgson Exactly. The only problem with the complex instance is that due to signum being more comple it might have rounding errors."}, {"owner": {"reputation": 94553, "user_id": 775806, "user_type": "registered", "accept_rate": 96, "profile_image": "https://i.stack.imgur.com/XNd2C.png?s=128&g=1", "display_name": "n. &#39;pronouns&#39; m.", "link": "https://stackoverflow.com/users/775806/n-pronouns-m"}, "edited": false, "score": 1, "creation_date": 1468852688, "post_id": 38439296, "comment_id": 64284689, "body": "Yeah, saw that. So the signum is just the argument. This is stretching the definition IMHO."}, {"owner": {"reputation": 14582, "user_id": 2225384, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/f30b04ed4d0b3fc4bc791a28815f34ca?s=128&d=identicon&r=PG", "display_name": "Rein Henrichs", "link": "https://stackoverflow.com/users/2225384/rein-henrichs"}, "reply_to_user": {"reputation": 94553, "user_id": 775806, "user_type": "registered", "accept_rate": 96, "profile_image": "https://i.stack.imgur.com/XNd2C.png?s=128&g=1", "display_name": "n. &#39;pronouns&#39; m.", "link": "https://stackoverflow.com/users/775806/n-pronouns-m"}, "edited": false, "score": 2, "creation_date": 1468878785, "post_id": 38439296, "comment_id": 64298559, "body": "@n.m. well, <code>Num</code> isn&#39;t a very good typeclass. It is at best poorly named."}], "tags": [], "owner": {"reputation": 37219, "user_id": 1523776, "user_type": "moderator", "accept_rate": 87, "profile_image": "https://www.gravatar.com/avatar/b3e0b5c8e42a8c38009ef2d969f8dabb?s=128&d=identicon&r=PG", "display_name": "Benjamin Hodgson", "link": "https://stackoverflow.com/users/1523776/benjamin-hodgson"}, "is_accepted": false, "score": 9, "last_activity_date": 1468882710, "last_edit_date": 1468882710, "creation_date": 1468852173, "answer_id": 38439296, "question_id": 38439008, "link": "https://stackoverflow.com/questions/38439008/how-to-convert-num-a-a-to-float-in-haskell/38439296#38439296", "title": "How to convert (Num a) =&gt; a to Float in Haskell?", "body": "<p>Not every instance of <code>Num</code> has a sensible conversion to <code>Float</code>. For a simple (ha ha) example consider complex numbers:</p>\n\n<pre><code>-- represented in rectangular coordinates\ndata Complex = Complex { real :: Float, imaginary :: Float } deriving (Eq, Ord, Show, Read)\n\ninstance Num Complex where\n    Complex u v + Complex x y = Complex (u + x) (v + y)\n    Complex u v * Complex x y = Complex (u * x - v * y) (v * x + u * y)\n    negate (Complex u v) = Complex (negate u) (negate v)\n    -- etc\n</code></pre>\n\n<p>Clearly there is no way to convert a <code>Complex</code> to a <code>Float</code> without throwing away information: <code>Float</code>s live on (a subset of) the real line whereas complex numbers live on the complex plane. There is no function <code>toFloat :: Num a =&gt; a -&gt; Float</code> that works for all instances of <code>Num</code>.</p>\n"}, {"tags": [], "owner": {"reputation": 126897, "user_id": 791604, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/ce991df7a056248d5e4f6fc3659ba733?s=128&d=identicon&r=PG", "display_name": "Daniel Wagner", "link": "https://stackoverflow.com/users/791604/daniel-wagner"}, "is_accepted": true, "score": 3, "last_activity_date": 1468855046, "creation_date": 1468855046, "answer_id": 38440393, "question_id": 38439008, "link": "https://stackoverflow.com/questions/38439008/how-to-convert-num-a-a-to-float-in-haskell/38440393#38440393", "title": "How to convert (Num a) =&gt; a to Float in Haskell?", "body": "<p>You can write</p>\n\n<pre><code>byTwo :: Real a =&gt; a -&gt; Float\nbyTwo x = 2 * realToFrac x\n</code></pre>\n\n<p>which can be specialized to both types you request, <code>Int -&gt; Float</code> and <code>Float -&gt; Float</code>.</p>\n"}], "owner": {"reputation": 701, "user_id": 2028189, "user_type": "registered", "accept_rate": 71, "profile_image": "https://www.gravatar.com/avatar/c4ca5514c17ff9231cb37f60e6cd922c?s=128&d=identicon&r=PG", "display_name": "Kwang Yul Seo", "link": "https://stackoverflow.com/users/2028189/kwang-yul-seo"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 680, "favorite_count": 0, "accepted_answer_id": 38440393, "answer_count": 2, "score": 2, "last_activity_date": 1468882710, "creation_date": 1468851325, "question_id": 38439008, "link": "https://stackoverflow.com/questions/38439008/how-to-convert-num-a-a-to-float-in-haskell", "title": "How to convert (Num a) =&gt; a to Float in Haskell?", "body": "<p>Is it possible to combine the following two functions into one polymorphic function in Haskell?</p>\n\n<pre><code>mutiplyByTwoI :: Int -&gt; Float\nmutiplyByTwoI x = fromIntegral x * 2.0\n\nmutiplyByTwoF :: Float -&gt; Float\nmutiplyByTwoF x = x * 2.0\n</code></pre>\n\n<p>I tried <code>Num a</code>, but I couldn't find a way to convert <code>Num a</code> to Float.</p>\n\n<pre><code>mutiplyByTwo :: (Num a) =&gt; a -&gt; Float\nmutiplyByTwo = undefined\n</code></pre>\n"}, {"tags": ["c", "windows", "haskell", "gcc"], "comments": [{"owner": {"reputation": 11381, "user_id": 4774918, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/kQQAl.jpg?s=128&g=1", "display_name": "too honest for this site", "link": "https://stackoverflow.com/users/4774918/too-honest-for-this-site"}, "edited": false, "score": 0, "creation_date": 1468851370, "post_id": 38438932, "comment_id": 64283654, "body": "Cyg<b>win</b> is not and not related to Linux"}, {"owner": {"reputation": 73, "user_id": 6312262, "user_type": "registered", "profile_image": "https://lh5.googleusercontent.com/-Fj81ampoak8/AAAAAAAAAAI/AAAAAAAAABg/QZgIwEz_k5k/photo.jpg?sz=128", "display_name": "Andrea Cane", "link": "https://stackoverflow.com/users/6312262/andrea-cane"}, "reply_to_user": {"reputation": 11381, "user_id": 4774918, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/kQQAl.jpg?s=128&g=1", "display_name": "too honest for this site", "link": "https://stackoverflow.com/users/4774918/too-honest-for-this-site"}, "edited": false, "score": 0, "creation_date": 1468851442, "post_id": 38438932, "comment_id": 64283712, "body": "Pardon me. I&#39;ll edit it."}, {"owner": {"reputation": 120941, "user_id": 2402272, "user_type": "registered", "accept_rate": 85, "profile_image": "https://www.gravatar.com/avatar/1182b1d5518a596d4e8cfe0567a65c4d?s=128&d=identicon&r=PG", "display_name": "John Bollinger", "link": "https://stackoverflow.com/users/2402272/john-bollinger"}, "edited": false, "score": 0, "creation_date": 1468852288, "post_id": 38438932, "comment_id": 64284347, "body": "The configure script will have created a log file, as indeed it tells you.  That log file should show you details of the test that configure performed that led it to conclude that your compiler does not work -- the code it tried to compile, the compilation command, and how it attempted to run the compiled result."}], "answers": [{"comments": [{"owner": {"reputation": 15485, "user_id": 3629249, "user_type": "registered", "profile_image": "https://graph.facebook.com/100000228362830/picture?type=large", "display_name": "user3629249", "link": "https://stackoverflow.com/users/3629249/user3629249"}, "edited": false, "score": 0, "creation_date": 1468961124, "post_id": 38463839, "comment_id": 64340381, "body": "you will have problems with the path to the <code>bin</code>, <code>lib</code>, and <code>include</code> directories containing spaces.  Suggest moving the tool chain.  HOWEVER, the <code>mingw</code> is for development under <code>windows</code> not under <code>cygwin</code>.  BUT if your using <code>cygwin</code>, 1) must have installed the <code>cygwin</code> specific tool chain 2) must have run the <code>startup batch</code> file for <code>cygwin</code> before doing anything else.   Per your question, those steps have not been properly performed."}, {"owner": {"reputation": 73, "user_id": 6312262, "user_type": "registered", "profile_image": "https://lh5.googleusercontent.com/-Fj81ampoak8/AAAAAAAAAAI/AAAAAAAAABg/QZgIwEz_k5k/photo.jpg?sz=128", "display_name": "Andrea Cane", "link": "https://stackoverflow.com/users/6312262/andrea-cane"}, "reply_to_user": {"reputation": 15485, "user_id": 3629249, "user_type": "registered", "profile_image": "https://graph.facebook.com/100000228362830/picture?type=large", "display_name": "user3629249", "link": "https://stackoverflow.com/users/3629249/user3629249"}, "edited": false, "score": 0, "creation_date": 1469025615, "post_id": 38463839, "comment_id": 64370871, "body": "in the end, i ran the <code>cabal install tidal</code> from the windows cmd prompt, so i had no problems. surely it used cygwin as the tool chain"}], "tags": [], "owner": {"reputation": 73, "user_id": 6312262, "user_type": "registered", "profile_image": "https://lh5.googleusercontent.com/-Fj81ampoak8/AAAAAAAAAAI/AAAAAAAAABg/QZgIwEz_k5k/photo.jpg?sz=128", "display_name": "Andrea Cane", "link": "https://stackoverflow.com/users/6312262/andrea-cane"}, "is_accepted": true, "score": 4, "last_activity_date": 1468945356, "creation_date": 1468945356, "answer_id": 38463839, "question_id": 38438932, "link": "https://stackoverflow.com/questions/38438932/gycwin-c-compiler-cannot-create-executables-tidalcycles-installation/38463839#38463839", "title": "Gycwin: c compiler cannot create executables - tidalcycles installation", "body": "<p>Found the problem: I didn't complete Haskell installation editing the cabal <code>config.file</code>, with</p>\n\n<pre><code>extra-prog-path: C:\\Program Files\\Haskell Platform\\8.0.1\\msys\\usr\\bin\nextra-lib-dirs: C:\\Program Files\\Haskell Platform\\8.0.1\\mingw\\lib\nextra-include-dirs: C:\\Program Files\\Haskell Platform\\8.0.1\\mingw\\include+\n</code></pre>\n\n<p>as this source <a href=\"https://www.haskell.org/platform/\" rel=\"nofollow\">https://www.haskell.org/platform/</a> says.</p>\n"}], "owner": {"reputation": 73, "user_id": 6312262, "user_type": "registered", "profile_image": "https://lh5.googleusercontent.com/-Fj81ampoak8/AAAAAAAAAAI/AAAAAAAAABg/QZgIwEz_k5k/photo.jpg?sz=128", "display_name": "Andrea Cane", "link": "https://stackoverflow.com/users/6312262/andrea-cane"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 1439, "favorite_count": 0, "accepted_answer_id": 38463839, "answer_count": 1, "score": 2, "last_activity_date": 1468945356, "creation_date": 1468851091, "last_edit_date": 1468851474, "question_id": 38438932, "link": "https://stackoverflow.com/questions/38438932/gycwin-c-compiler-cannot-create-executables-tidalcycles-installation", "title": "Gycwin: c compiler cannot create executables - tidalcycles installation", "body": "<p>I'm trying to install tidalcycles (<a href=\"http://tidalcycles.org/getting_started.html\" rel=\"nofollow\">http://tidalcycles.org/getting_started.html</a>), but i had problems running the  <code>cabal install tidal</code> command.\nOriginally i had an issue due to windows10 compatibility, so I installed Cygwin and i tried to run the command from his shell. But then this occurs:</p>\n\n<pre><code>Andrea@Pc_di_Andrea ~\n$ cabal install tidal\nResolving dependencies...\nConfiguring old-time-1.1.0.3...\nConfiguring network-2.6.2.1...\nFailed to install old-time-1.1.0.3\nBuild log ( C:\\Users\\Andrea\\AppData\\Roaming\\cabal\\logs\\old-time-1.1.0.3.log):\nConfiguring old-time-1.1.0.3...\nconfigure: WARNING: unrecognized options: --with-compiler\nchecking for gcc... C:\\PROGRA~1\\HASKEL~1\\802E01~1.1\\mingw\\bin\\gcc.exe\nchecking whether the C compiler works... no\nconfigure: error: in `/tmp/cabal-tmp-8957/old-time-1.1.0.3':\nconfigure: error: C compiler cannot create executables\nSee `config.log' for more details\ncabal: Leaving directory 'C:\\cygwin\\tmp\\cabal-tmp-8957\\old-time-1.1.0.3'\nFailed to install network-2.6.2.1\nBuild log ( C:\\Users\\Andrea\\AppData\\Roaming\\cabal\\logs\\network-2.6.2.1.log ):\nConfiguring network-2.6.2.1...\nconfigure: WARNING: unrecognized options: --with-compiler\nchecking build system type... i686-pc-cygwin\nchecking host system type... i686-pc-cygwin\nchecking for gcc... C:\\PROGRA~1\\HASKEL~1\\802E01~1.1\\mingw\\bin\\gcc.exe\nchecking whether the C compiler works... no\nconfigure: error: in `/tmp/cabal-tmp-8956/network-2.6.2.1':\nconfigure: error: C compiler cannot create executables\nSee `config.log' for more details\ncabal: Leaving directory 'C:\\cygwin\\tmp\\cabal-tmp-8956\\network-2.6.2.1'\ncabal.exe: Error: some packages failed to install:\nhosc-0.15 depends on network-2.6.2.1 which failed to install.\nmersenne-random-pure64-0.2.0.5 depends on old-time-1.1.0.3 which failed to\ninstall.\nnetwork-2.6.2.1 failed during the configure step. The exception was:\nExitFailure 77\nold-time-1.1.0.3 failed during the configure step. The exception was:\nExitFailure 77\ntidal-0.8 depends on old-time-1.1.0.3 which failed to install.\nwebsockets-0.9.6.2 depends on network-2.6.2.1 which failed to install.\n</code></pre>\n\n<p>So, it says that the</p>\n\n<pre><code>configure: error: C compiler cannot create executables\n</code></pre>\n\n<p>is the problem. I'm running the 32bit version, and the c compiler should be installed, since i get this reply from the system: </p>\n\n<pre><code>Andrea@Pc_di_Andrea ~\n$  echo; gcc --version; echo; g++ --version;\n\ngcc (GCC) 5.4.0\nCopyright (C) 2015 Free Software Foundation, Inc.\nThis is free software; see the source for copying conditions.  There is NO\nwarranty; not even for MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.\n\n\ng++ (GCC) 5.4.0\nCopyright (C) 2015 Free Software Foundation, Inc.\nThis is free software; see the source for copying conditions.  There is NO\nwarranty; not even for MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.\n</code></pre>\n\n<p>I'm a total newbie to this 'cygwin enviroment' and  I apologize if my question is not appropriate, but I read some guides about this c compiler problem and i didn't understand what i'm doing wrong, at all.</p>\n"}, {"tags": ["haskell"], "answers": [{"comments": [{"owner": {"reputation": 49959, "user_id": 866915, "user_type": "registered", "accept_rate": 70, "profile_image": "https://www.gravatar.com/avatar/09242131d6e17cbbe31e8547514da6e5?s=128&d=identicon&r=PG", "display_name": "ErikR", "link": "https://stackoverflow.com/users/866915/erikr"}, "edited": false, "score": 1, "creation_date": 1468836084, "post_id": 38433724, "comment_id": 64273073, "body": "It appears you are using the <a href=\"http://hackage.haskell.org/package/threepenny-gui-0.6.0.6/docs/Graphics-UI-Threepenny-Core.html#g:3\" rel=\"nofollow noreferrer\">UI monad</a> from the <a href=\"http://hackage.haskell.org/package/threepenny-gui-0.6.0.6\" rel=\"nofollow noreferrer\">threepenny package</a> - right?"}, {"owner": {"reputation": 100185, "user_id": 3234959, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/93bb12ca0f93dfddb33880316f7e66c2?s=128&d=identicon&r=PG&f=1", "display_name": "chi", "link": "https://stackoverflow.com/users/3234959/chi"}, "reply_to_user": {"reputation": 49959, "user_id": 866915, "user_type": "registered", "accept_rate": 70, "profile_image": "https://www.gravatar.com/avatar/09242131d6e17cbbe31e8547514da6e5?s=128&d=identicon&r=PG", "display_name": "ErikR", "link": "https://stackoverflow.com/users/866915/erikr"}, "edited": false, "score": 0, "creation_date": 1468836161, "post_id": 38433724, "comment_id": 64273120, "body": "I have no idea what the OP is using -- you are probably right."}, {"owner": {"reputation": 375, "user_id": 5287908, "user_type": "registered", "accept_rate": 89, "profile_image": "https://i.stack.imgur.com/w0QJd.png?s=128&g=1", "display_name": "QSpider", "link": "https://stackoverflow.com/users/5287908/qspider"}, "edited": false, "score": 0, "creation_date": 1468910349, "post_id": 38433724, "comment_id": 64307073, "body": "UI monad not from  threepenny package! Monad is written by me <code>data UI a = UI a</code>. And instance Functor, Applicativ, Monad for UI."}, {"owner": {"reputation": 375, "user_id": 5287908, "user_type": "registered", "accept_rate": 89, "profile_image": "https://i.stack.imgur.com/w0QJd.png?s=128&g=1", "display_name": "QSpider", "link": "https://stackoverflow.com/users/5287908/qspider"}, "edited": false, "score": 0, "creation_date": 1468910395, "post_id": 38433724, "comment_id": 64307097, "body": "I&#39;m just developing a wrapper for Blaze."}, {"owner": {"reputation": 375, "user_id": 5287908, "user_type": "registered", "accept_rate": 89, "profile_image": "https://i.stack.imgur.com/w0QJd.png?s=128&g=1", "display_name": "QSpider", "link": "https://stackoverflow.com/users/5287908/qspider"}, "edited": false, "score": 0, "creation_date": 1468911070, "post_id": 38433724, "comment_id": 64307448, "body": "But How can I release <code>liftIO :: UI a -&gt; IO a</code>?"}, {"owner": {"reputation": 375, "user_id": 5287908, "user_type": "registered", "accept_rate": 89, "profile_image": "https://i.stack.imgur.com/w0QJd.png?s=128&g=1", "display_name": "QSpider", "link": "https://stackoverflow.com/users/5287908/qspider"}, "edited": false, "score": 0, "creation_date": 1468912672, "post_id": 38433724, "comment_id": 64308342, "body": "I tryed to use <code>IO</code> instead <code>UI</code>. Everything is working!!! Thank you!!!But still I want to use my <code>UI</code> monad. If I release <code>liftIO :: UI a -&gt; IO a</code>, then wil be OK? but HOW?"}, {"owner": {"reputation": 375, "user_id": 5287908, "user_type": "registered", "accept_rate": 89, "profile_image": "https://i.stack.imgur.com/w0QJd.png?s=128&g=1", "display_name": "QSpider", "link": "https://stackoverflow.com/users/5287908/qspider"}, "edited": false, "score": 0, "creation_date": 1468915122, "post_id": 38433724, "comment_id": 64309744, "body": "I will do so <code>type UI == IO</code>.But I do not like this solution."}], "tags": [], "owner": {"reputation": 100185, "user_id": 3234959, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/93bb12ca0f93dfddb33880316f7e66c2?s=128&d=identicon&r=PG&f=1", "display_name": "chi", "link": "https://stackoverflow.com/users/3234959/chi"}, "is_accepted": true, "score": 5, "last_activity_date": 1468835765, "creation_date": 1468835765, "answer_id": 38433724, "question_id": 38431487, "link": "https://stackoverflow.com/questions/38431487/caching-the-results-of-the-function-in-haskell/38433724#38433724", "title": "Caching the results of the function in Haskell", "body": "<p>I'd recommend you rework the UUID generation so that it fits the <code>UI</code> monad you are working in. <code>unsafe</code> things are best to be avoided in general -- especially in cases like yours where you use those to <em>lie</em> to the compiler: a type like <code>String</code> promises the value is a fixed, constant string value, allowing the compiler to optimize assuming this. This will make the code very, very fragile, in that it might work or not depending on the optimizations.</p>\n\n<p>In the code below, I am guessing a few types, so this could not match exactly with your library.</p>\n\n<pre><code>generateUUID :: IO String\ngenerateUUID = UV.toString . fromJust &lt;$&gt; UV1.nextUUID\n\nwuiPanel :: UI WidgetUI\nwuiPanel = do\n    uuid &lt;- liftIO generateUUID\n    let elem = ContainerUI $ H.div\n    return $ createWidgetUI elem uuid\n</code></pre>\n\n<p>To do: better handling of <code>nextUUID</code>, which might return <code>Nothing</code> \"if you request UUIDs too quickly\" (scary quote from the docs). Are you sure you can't use the <code>V4.nextRandom</code> which will never return <code>Nothing</code>s?</p>\n"}], "owner": {"reputation": 375, "user_id": 5287908, "user_type": "registered", "accept_rate": 89, "profile_image": "https://i.stack.imgur.com/w0QJd.png?s=128&g=1", "display_name": "QSpider", "link": "https://stackoverflow.com/users/5287908/qspider"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 146, "favorite_count": 1, "accepted_answer_id": 38433724, "answer_count": 1, "score": -4, "last_activity_date": 1543675940, "creation_date": 1468829017, "last_edit_date": 1543675940, "question_id": 38431487, "link": "https://stackoverflow.com/questions/38431487/caching-the-results-of-the-function-in-haskell", "title": "Caching the results of the function in Haskell", "body": "<p>I use the following function to generate GUID:</p>\n\n<pre><code>import Data.UUID as UV\nimport Data.UUID.V1 as UV1\n\ngenerateUUID :: String\ngenerateUUID = UV.toString $ fromJust $ unsafePerformIO UV1.nextUUID\n</code></pre>\n\n<p>And I use the <code>generateUUID</code> for the creation of elements</p>\n\n<pre><code>createWidgetUI element uuid =\n    WidgetUI { wui_title    = \"\"\n             , wui_id       = uuid\n             , wui_attr_style = \"\"\n             , wui_attr_class = \"\"\n             , wui_styles   = []\n             , wui_scripts  = []\n             , wui_contents = []\n             , wui_children = []\n             , wui_element  = element\n             }\n\nwuiPanel :: UI WidgetUI\nwuiPanel = do\n    return $ createWidgetUI elem uuid\n    where\n        uuid = generateUUID\n        elem = ContainerUI $ H.div\n</code></pre>\n\n<p>When I call the method <code>wuiPanel</code> several times, I get same UUID value! But I need to every call the method <code>wuiPanel</code> to get elements with different UUID value. I can not understand how to implement it.</p>\n"}, {"tags": ["haskell", "pointfree"], "comments": [{"owner": {"reputation": 48129, "user_id": 76051, "user_type": "registered", "accept_rate": 91, "profile_image": "https://i.stack.imgur.com/AGDxz.jpg?s=128&g=1", "display_name": "Carsten", "link": "https://stackoverflow.com/users/76051/carsten"}, "edited": false, "score": 0, "creation_date": 1468816002, "post_id": 38428512, "comment_id": 64263502, "body": "just to make it clear: did you compile with optimizations, which GHC did you use and can you please add the <code>foldl&#39;</code> version (or at least say if you just switched the arguments or did change anything else)? - also which Euler problem is this in case anyone want to run the example?"}, {"owner": {"reputation": 48129, "user_id": 76051, "user_type": "registered", "accept_rate": 91, "profile_image": "https://i.stack.imgur.com/AGDxz.jpg?s=128&g=1", "display_name": "Carsten", "link": "https://stackoverflow.com/users/76051/carsten"}, "edited": false, "score": 1, "creation_date": 1468816320, "post_id": 38428512, "comment_id": 64263570, "body": "btw: are the <code>cs</code> lists themselves and what is your <code>f</code>?"}, {"owner": {"reputation": 2313, "user_id": 1513295, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/bc00550a36e3d751bee5e0027f929cbf?s=128&d=identicon&r=PG", "display_name": "semicolon", "link": "https://stackoverflow.com/users/1513295/semicolon"}, "reply_to_user": {"reputation": 48129, "user_id": 76051, "user_type": "registered", "accept_rate": 91, "profile_image": "https://i.stack.imgur.com/AGDxz.jpg?s=128&g=1", "display_name": "Carsten", "link": "https://stackoverflow.com/users/76051/carsten"}, "edited": false, "score": 0, "creation_date": 1468816508, "post_id": 38428512, "comment_id": 64263608, "body": "The <code>cs</code> themselves were lists yeah. Lists of a custom simple enum data type. One <code>f</code> (the one that took up most of the allocation) was <code>valid (x : xs) (y : ys) = x &#47;= y &amp;&amp; valid xs ys</code> and <code>valid _ _ = True</code>. I didn&#39;t want to copy too much into the question to avoid spoiling the Project Euler problem as it is a fairly difficult (70% difficulty) and very fun problem."}, {"owner": {"reputation": 44013, "user_id": 1477667, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/trgKM.jpg?s=128&g=1", "display_name": "dfeuer", "link": "https://stackoverflow.com/users/1477667/dfeuer"}, "edited": false, "score": 1, "creation_date": 1468818301, "post_id": 38428512, "comment_id": 64264061, "body": "Why <code>fromBool</code> and not just <code>fromEnum</code>?"}, {"owner": {"reputation": 94713, "user_id": 1139697, "user_type": "registered", "accept_rate": 86, "profile_image": "https://www.gravatar.com/avatar/5f136ddb684f39aaee1c028ee1950f6f?s=128&d=identicon&r=PG", "display_name": "Zeta", "link": "https://stackoverflow.com/users/1139697/zeta"}, "edited": false, "score": 1, "creation_date": 1468832945, "post_id": 38428512, "comment_id": 64270973, "body": "While I have an explanation, it&#39;s really hard to reproduce your behaviour completely. The culprits are  <code>uncurry</code> and some optimizations, that&#39;s for sure, but in order to provide a complete answer, some example functions/values would be <i>really</i> helpful."}, {"owner": {"reputation": 48129, "user_id": 76051, "user_type": "registered", "accept_rate": 91, "profile_image": "https://i.stack.imgur.com/AGDxz.jpg?s=128&g=1", "display_name": "Carsten", "link": "https://stackoverflow.com/users/76051/carsten"}, "reply_to_user": {"reputation": 100185, "user_id": 3234959, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/93bb12ca0f93dfddb33880316f7e66c2?s=128&d=identicon&r=PG&f=1", "display_name": "chi", "link": "https://stackoverflow.com/users/3234959/chi"}, "edited": false, "score": 0, "creation_date": 1468836648, "post_id": 38428512, "comment_id": 64273468, "body": "@chi isn&#39;t this part of the question (seems like a similar switch took 2-times the memory) - TBH I&#39;m more interested in this part"}, {"owner": {"reputation": 100185, "user_id": 3234959, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/93bb12ca0f93dfddb33880316f7e66c2?s=128&d=identicon&r=PG&f=1", "display_name": "chi", "link": "https://stackoverflow.com/users/3234959/chi"}, "reply_to_user": {"reputation": 48129, "user_id": 76051, "user_type": "registered", "accept_rate": 91, "profile_image": "https://i.stack.imgur.com/AGDxz.jpg?s=128&g=1", "display_name": "Carsten", "link": "https://stackoverflow.com/users/76051/carsten"}, "edited": false, "score": 0, "creation_date": 1468840112, "post_id": 38428512, "comment_id": 64275664, "body": "@Carsten Oh, right. I missed a paragraph above. Interesting..."}, {"owner": {"reputation": 94713, "user_id": 1139697, "user_type": "registered", "accept_rate": 86, "profile_image": "https://www.gravatar.com/avatar/5f136ddb684f39aaee1c028ee1950f6f?s=128&d=identicon&r=PG", "display_name": "Zeta", "link": "https://stackoverflow.com/users/1139697/zeta"}, "edited": false, "score": 1, "creation_date": 1468840258, "post_id": 38428512, "comment_id": 64275743, "body": "Grah. This is ridiculous. If you use <code>a ~ Int</code>, GHC creates a point-free variant with the same allocation behaviour, <b><i>unless you call the function twice</i></b>. If you use <code>a ~ Bool</code>, point-free functions <i>always</i> lead to the allocation behavior. So, long story short, it&#39;s a PITA to reproduce your behaviour exactly. Please add at least the used type for <code>a</code>."}, {"owner": {"reputation": 2313, "user_id": 1513295, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/bc00550a36e3d751bee5e0027f929cbf?s=128&d=identicon&r=PG", "display_name": "semicolon", "link": "https://stackoverflow.com/users/1513295/semicolon"}, "reply_to_user": {"reputation": 44013, "user_id": 1477667, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/trgKM.jpg?s=128&g=1", "display_name": "dfeuer", "link": "https://stackoverflow.com/users/1477667/dfeuer"}, "edited": false, "score": 1, "creation_date": 1468849702, "post_id": 38428512, "comment_id": 64282466, "body": "@dfeuer Well now I feel dumb, in my defense <code>fromBool</code> appears before <code>fromEnum</code> in hoogle when I searched for <code>Bool -&gt; Int</code>."}, {"owner": {"reputation": 2313, "user_id": 1513295, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/bc00550a36e3d751bee5e0027f929cbf?s=128&d=identicon&r=PG", "display_name": "semicolon", "link": "https://stackoverflow.com/users/1513295/semicolon"}, "reply_to_user": {"reputation": 94713, "user_id": 1139697, "user_type": "registered", "accept_rate": 86, "profile_image": "https://www.gravatar.com/avatar/5f136ddb684f39aaee1c028ee1950f6f?s=128&d=identicon&r=PG", "display_name": "Zeta", "link": "https://stackoverflow.com/users/1139697/zeta"}, "edited": false, "score": 0, "creation_date": 1468849759, "post_id": 38428512, "comment_id": 64282509, "body": "@Zeta I added the code. Was hoping to avoid spoilers and what not. But yeah my code is identical to the code I now pasted into the question. Just varying which 2 of the 3 variants I comment out."}, {"owner": {"reputation": 49959, "user_id": 866915, "user_type": "registered", "accept_rate": 70, "profile_image": "https://www.gravatar.com/avatar/09242131d6e17cbbe31e8547514da6e5?s=128&d=identicon&r=PG", "display_name": "ErikR", "link": "https://stackoverflow.com/users/866915/erikr"}, "edited": false, "score": 0, "creation_date": 1468852345, "post_id": 38428512, "comment_id": 64284391, "body": "re: spoilers - if you don&#39;t mention what problem it solves nobody would be the wiser."}, {"owner": {"reputation": 2313, "user_id": 1513295, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/bc00550a36e3d751bee5e0027f929cbf?s=128&d=identicon&r=PG", "display_name": "semicolon", "link": "https://stackoverflow.com/users/1513295/semicolon"}, "reply_to_user": {"reputation": 49959, "user_id": 866915, "user_type": "registered", "accept_rate": 70, "profile_image": "https://www.gravatar.com/avatar/09242131d6e17cbbe31e8547514da6e5?s=128&d=identicon&r=PG", "display_name": "ErikR", "link": "https://stackoverflow.com/users/866915/erikr"}, "edited": false, "score": 0, "creation_date": 1468852976, "post_id": 38428512, "comment_id": 64284912, "body": "@ErikR yeah that is probably true, but I just didn&#39;t want someone that likes Project Euler to thoroughly analyze my code and then stumble on the problem and be disappointed that they already know how to do it."}, {"owner": {"reputation": 94713, "user_id": 1139697, "user_type": "registered", "accept_rate": 86, "profile_image": "https://www.gravatar.com/avatar/5f136ddb684f39aaee1c028ee1950f6f?s=128&d=identicon&r=PG", "display_name": "Zeta", "link": "https://stackoverflow.com/users/1139697/zeta"}, "edited": false, "score": 0, "creation_date": 1468854843, "post_id": 38428512, "comment_id": 64286247, "body": "@semicolon: That has been a wild ride. See answer below. Spoilers: it&#39;s, as I thought, <code>uncurry</code> and laziness."}], "answers": [{"comments": [{"owner": {"reputation": 2313, "user_id": 1513295, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/bc00550a36e3d751bee5e0027f929cbf?s=128&d=identicon&r=PG", "display_name": "semicolon", "link": "https://stackoverflow.com/users/1513295/semicolon"}, "edited": false, "score": 0, "creation_date": 1468856009, "post_id": 38440296, "comment_id": 64287067, "body": "Thank you so much! Awesome write up! I know that generally weird performance stuff is either due to laziness or sharing (too much or too little), but I totally forgot about <code>_|_</code> and <code>(_|_, _|_)</code> being totally different things. So I incorrectly assumed that using tuples couldn&#39;t cause any weird laziness related issues."}, {"owner": {"reputation": 44013, "user_id": 1477667, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/trgKM.jpg?s=128&g=1", "display_name": "dfeuer", "link": "https://stackoverflow.com/users/1477667/dfeuer"}, "edited": false, "score": 0, "creation_date": 1468865954, "post_id": 38440296, "comment_id": 64292384, "body": "I don&#39;t see what&#39;s particularly correct about <code>uncurry (const (const 0))</code> being <code>0</code>. I&#39;m also annoyed by the excessive laziness of <code>bimap</code> for pairs."}, {"owner": {"reputation": 94713, "user_id": 1139697, "user_type": "registered", "accept_rate": 86, "profile_image": "https://www.gravatar.com/avatar/5f136ddb684f39aaee1c028ee1950f6f?s=128&d=identicon&r=PG", "display_name": "Zeta", "link": "https://stackoverflow.com/users/1139697/zeta"}, "reply_to_user": {"reputation": 44013, "user_id": 1477667, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/trgKM.jpg?s=128&g=1", "display_name": "dfeuer", "link": "https://stackoverflow.com/users/1477667/dfeuer"}, "edited": false, "score": 0, "creation_date": 1468867874, "post_id": 38440296, "comment_id": 64293290, "body": "@dfeuer <a href=\"https://www.haskell.org/onlinereport/haskell2010/haskellch9.html#x16-1710009\" rel=\"nofollow noreferrer\">That&#39;s how it&#39;s defined in the report</a>. But yes, that kind of laziness is kind of unexpected."}, {"owner": {"reputation": 2313, "user_id": 1513295, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/bc00550a36e3d751bee5e0027f929cbf?s=128&d=identicon&r=PG", "display_name": "semicolon", "link": "https://stackoverflow.com/users/1513295/semicolon"}, "reply_to_user": {"reputation": 44013, "user_id": 1477667, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/trgKM.jpg?s=128&g=1", "display_name": "dfeuer", "link": "https://stackoverflow.com/users/1477667/dfeuer"}, "edited": false, "score": 0, "creation_date": 1468942844, "post_id": 38440296, "comment_id": 64329901, "body": "@dfeuer I mean Haskell by default generally minimizes strictness. And the least strict way to define <code>uncurry</code> is <code>uncurry f ~(x, y) = f x y</code>, which gives you <code>uncurry (const (const 0)) undefined == 0</code>."}, {"owner": {"reputation": 44013, "user_id": 1477667, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/trgKM.jpg?s=128&g=1", "display_name": "dfeuer", "link": "https://stackoverflow.com/users/1477667/dfeuer"}, "reply_to_user": {"reputation": 2313, "user_id": 1513295, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/bc00550a36e3d751bee5e0027f929cbf?s=128&d=identicon&r=PG", "display_name": "semicolon", "link": "https://stackoverflow.com/users/1513295/semicolon"}, "edited": false, "score": 0, "creation_date": 1468943410, "post_id": 38440296, "comment_id": 64330317, "body": "@semicolon, yes, I understand that line of reasoning. But lazy deconstruction of a tuple or record is generally best done by hand in the special cases that require it, although I&#39;m given to understand this may not be the case for <code>Arrow</code> work. Unfortunately, some thought is usually required to figure out just where laziness is needed."}, {"owner": {"reputation": 2313, "user_id": 1513295, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/bc00550a36e3d751bee5e0027f929cbf?s=128&d=identicon&r=PG", "display_name": "semicolon", "link": "https://stackoverflow.com/users/1513295/semicolon"}, "reply_to_user": {"reputation": 44013, "user_id": 1477667, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/trgKM.jpg?s=128&g=1", "display_name": "dfeuer", "link": "https://stackoverflow.com/users/1477667/dfeuer"}, "edited": false, "score": 0, "creation_date": 1468944173, "post_id": 38440296, "comment_id": 64330805, "body": "@dfeuer Yeah that is probably true. But just like with <code>genericLength</code> Haskell seems to default to maximally lazy even when you don&#39;t always want that in the interest of maximizing the number of correct programs at the cost of performance."}], "tags": [], "owner": {"reputation": 94713, "user_id": 1139697, "user_type": "registered", "accept_rate": 86, "profile_image": "https://www.gravatar.com/avatar/5f136ddb684f39aaee1c028ee1950f6f?s=128&d=identicon&r=PG", "display_name": "Zeta", "link": "https://stackoverflow.com/users/1139697/zeta"}, "is_accepted": true, "score": 13, "last_activity_date": 1468854803, "creation_date": 1468854803, "answer_id": 38440296, "question_id": 38428512, "link": "https://stackoverflow.com/questions/38428512/why-does-the-pointfree-version-of-my-function-use-much-more-memory/38440296#38440296", "title": "Why does the pointfree version of my function use much more memory", "body": "<p><sup><strong>Note:</strong> This post is written in literate Haskell. Copy it into a file, save it as *.lhs, and compile/load with in GHC(i). Also, I started writing this answer before you've edited your code, but the lesson stays the same.</sup></p>\n\n<h1>TL;DR</h1>\n\n<p>The <code>Prelude</code> function <code>uncurry</code> is too lazy, whereas your pattern match is just strict enough.</p>\n\n<h1>A word of caution and a disclaimer</h1>\n\n<p>We're entering a magical, weird place. Beware. Also, my CORE abilities are rudimentary. Now that I've lost all my credibility, let's get started.</p>\n\n<h1>The tested code</h1>\n\n<p>In order to know where we get the additional memory requirements, it's useful to have more than two functions.</p>\n\n<pre><code>&gt; import Control.Monad (forM_)\n</code></pre>\n\n<p>This is your original, non-pointfree variant:</p>\n\n<pre><code>&gt; matches :: (a -&gt; a -&gt; Bool) -&gt; a -&gt; [(a, Int)] -&gt; Int\n&gt; matches    f cs = foldr (\\(cs', n) a -&gt; fromEnum (f cs cs') * n + a) 0\n</code></pre>\n\n<p>This is a variant that's only slightly point-free, the parameter <code>a</code> is eta-reduced.</p>\n\n<pre><code>&gt; matchesPF' :: (a -&gt; a -&gt; Bool) -&gt; a -&gt; [(a, Int)] -&gt; Int\n&gt; matchesPF' f cs = foldr (\\(cs', n) -&gt; (+) (fromEnum (f cs cs') * n)) 0\n</code></pre>\n\n<p>This is a variant that inlines <code>uncurry</code> by hand.</p>\n\n<pre><code>&gt; matchesPFI :: (a -&gt; a -&gt; Bool) -&gt; a -&gt; [(a, Int)] -&gt; Int\n&gt; matchesPFI f cs = foldr ((+) . (\\(cs', n) -&gt; fromEnum (f cs cs') * n)) 0\n</code></pre>\n\n<p>This your pointfree version.</p>\n\n<pre><code>&gt; matchesPF :: (a -&gt; a -&gt; Bool) -&gt; a -&gt; [(a, Int)] -&gt; Int\n&gt; matchesPF  f cs = foldr ((+) . uncurry  ((*) . fromEnum . f cs)) 0\n</code></pre>\n\n<p>This is a variant that uses a custom <code>uncurry</code>, see below.</p>\n\n<pre><code>&gt; matchesPFU :: (a -&gt; a -&gt; Bool) -&gt; a -&gt; [(a, Int)] -&gt; Int\n&gt; matchesPFU f cs = foldr ((+) . uncurryI ((*) . fromEnum . f cs)) 0\n</code></pre>\n\n<p>This is a variant that uses a custom lazy <code>uncurry</code>, see below.</p>\n\n<pre><code>&gt; matchesPFL :: (a -&gt; a -&gt; Bool) -&gt; a -&gt; [(a, Int)] -&gt; Int\n&gt; matchesPFL f cs = foldr ((+) . uncurryL ((*) . fromEnum . f cs)) 0\n</code></pre>\n\n<p>To test the functions easily, we use a list:</p>\n\n<pre><code>&gt; funcs = [matches, matchesPF', matchesPF, matchesPFL, matchesPFU, matchesPFI]\n</code></pre>\n\n<p>Our self-written <code>uncurry</code>:</p>\n\n<pre><code>&gt; uncurryI :: (a -&gt; b -&gt; c) -&gt; (a, b) -&gt; c\n&gt; uncurryI f (a,b) = f a b\n</code></pre>\n\n<p>A lazier <code>uncurry</code>:</p>\n\n<pre><code>&gt; uncurryL :: (a -&gt; b -&gt; c) -&gt; (a, b) -&gt; c\n&gt; uncurryL f p = f (fst p) (snd p)\n</code></pre>\n\n<p>The lazy variant <code>uncurryL</code> has the same semantics as the variant in <code>Prelude</code>, e.g.</p>\n\n<pre><code>uncurry (\\_ _ -&gt; 0) undefined == 0 == uncurryL (\\_ _ -&gt; 0) undefined\n</code></pre>\n\n<p>whereas <code>uncurryI</code> is strict in the pair's spine.</p>\n\n<pre><code>&gt; main = do\n&gt;   let f a b = a &lt; b\n&gt;   forM_ [1..10] $ \\i -&gt;\n&gt;     forM_ funcs $ \\m -&gt;\n&gt;       print $ m f i (zip (cycle [1..10]) [1..i*100000])\n</code></pre>\n\n<p>The list <code>[1..i*100000]</code> depends on <code>i</code> deliberately, so that we don't introduce a CAF and skew our allocation profile.</p>\n\n<h2>The desugared code</h2>\n\n<p>Before we delve into the profile, let's have a look at the desugared code of each function:</p>\n\n<pre><code>==================== Desugar (after optimization) ====================\nResult size of Desugar (after optimization)\n  = {terms: 221, types: 419, coercions: 0}\n\nuncurryL\nuncurryL = \\ @ a @ b @ c f p -&gt; f (fst p) (snd p)\n\nuncurryI\nuncurryI = \\ @ a @ b @ c f ds -&gt; case ds of _ { (a, b) -&gt; f a b }\n\n-- uncurried inlined by hand\nmatchesPFI =\n  \\ @ a f cs -&gt;\n    foldr\n      $fFoldable[]\n      (. (+ $fNumInt)\n         (\\ ds -&gt;\n            case ds of _ { (cs', n) -&gt;\n            * $fNumInt (fromEnum $fEnumBool (f cs cs')) n\n            }))\n      (I# 0)\n\n-- lazy uncurry\nmatchesPFL =\n  \\ @ a f cs -&gt;\n    foldr\n      $fFoldable[]\n      (. (+ $fNumInt)\n         (uncurryL (. (* $fNumInt) (. (fromEnum $fEnumBool) (f cs)))))\n      (I# 0)\n\n-- stricter uncurry\nmatchesPFU =\n  \\ @ a f cs -&gt;\n    foldr\n      $fFoldable[]\n      (. (+ $fNumInt)\n         (uncurryI (. (* $fNumInt) (. (fromEnum $fEnumBool) (f cs)))))\n      (I# 0)\n\n-- normal uncurry\nmatchesPF =\n  \\ @ a f cs -&gt;\n    foldr\n      $fFoldable[]\n      (. (+ $fNumInt)\n         (uncurry (. (* $fNumInt) (. (fromEnum $fEnumBool) (f cs)))))\n      (I# 0)\n\n-- eta-reduced a\nmatchesPF' =\n  \\ @ a f cs -&gt;\n    foldr\n      $fFoldable[]\n      (\\ ds -&gt;\n         case ds of _ { (cs', n) -&gt;\n         + $fNumInt (* $fNumInt (fromEnum $fEnumBool (f cs cs')) n)\n         })\n      (I# 0)\n\n-- non-point-free\nmatches =\n  \\ @ a f cs -&gt;\n    foldr\n      $fFoldable[]\n      (\\ ds a -&gt;\n         case ds of _ { (cs', n) -&gt;\n         + $fNumInt (* $fNumInt (fromEnum $fEnumBool (f cs cs')) n) a\n         })\n      (I# 0)\n</code></pre>\n\n<p>So far, everything seems well. There's nothing surprising going on. Typeclass functions are replaced with their dictionary variants, e.g. <code>foldr</code> becomes<code></code>foldr $fFoldable[]`, since we call it on a list.</p>\n\n<h2>The profile</h2>\n\n<pre>   Mon Jul 18 15:47 2016 Time and Allocation Profiling Report  (Final)\n\n       Prof +RTS -s -p -RTS\n\n    total time  =        1.45 secs   (1446 ticks @ 1000 us, 1 processor)\n    total alloc = 1,144,197,200 bytes  (excludes profiling overheads)\n\nCOST CENTRE  MODULE    %time %alloc\n\nmatchesPF'   Main       13.6    0.0\nmatchesPF    Main       13.3   11.5\nmain.\\.\\     Main       11.8   76.9\nmain.f       Main       10.9    0.0\nuncurryL     Main        9.5   11.5\nmatchesPFU   Main        8.9    0.0\nmatchesPFI   Main        7.3    0.0\nmatches      Main        6.9    0.0\nmatchesPFL   Main        6.3    0.0\nuncurryI     Main        5.3    0.0\nmatchesPF'.\\ Main        2.6    0.0\nmatchesPFI.\\ Main        2.0    0.0\nmatches.\\    Main        1.5    0.0\n\n\n                                                             individual     inherited\nCOST CENTRE        MODULE                  no.     entries  %time %alloc   %time %alloc\n\nMAIN               MAIN                     44           0    0.0    0.0   100.0  100.0\n main              Main                     89           0    0.0    0.0   100.0  100.0\n  main.\\           Main                     90          10    0.0    0.0   100.0  100.0\n   main.\\.\\        Main                     92          60   11.8   76.9   100.0  100.0\n    funcs          Main                     93           0    0.0    0.0    88.2   23.1\n     matchesPFI    Main                    110          10    7.3    0.0    11.7    0.0\n      matchesPFI.\\ Main                    111     5500000    2.0    0.0     4.4    0.0\n       main.f      Main                    112     5500000    2.4    0.0     2.4    0.0\n     matchesPFU    Main                    107          10    8.9    0.0    15.3    0.0\n      uncurryI     Main                    108     5500000    5.3    0.0     6.4    0.0\n       main.f      Main                    109     5500000    1.1    0.0     1.1    0.0\n     matchesPFL    Main                    104          10    6.3    0.0    17.7   11.5\n      uncurryL     Main                    105     5500000    9.5   11.5    11.4   11.5\n       main.f      Main                    106     5500000    1.9    0.0     1.9    0.0\n     matchesPF     Main                    102          10   13.3   11.5    15.4   11.5\n      main.f       Main                    103     5500000    2.1    0.0     2.1    0.0\n     matchesPF'    Main                     99          10   13.6    0.0    17.2    0.0\n      matchesPF'.\\ Main                    100     5500000    2.6    0.0     3.6    0.0\n       main.f      Main                    101     5500000    1.0    0.0     1.0    0.0\n     matches       Main                     94          10    6.9    0.0    10.9    0.0\n      matches.\\    Main                     97     5500000    1.5    0.0     4.0    0.0\n       main.f      Main                     98     5500000    2.5    0.0     2.5    0.0\n CAF               Main                     87           0    0.0    0.0     0.0    0.0\n  funcs            Main                     91           1    0.0    0.0     0.0    0.0\n  main             Main                     88           1    0.0    0.0     0.0    0.0\n   main.\\          Main                     95           0    0.0    0.0     0.0    0.0\n    main.\\.\\       Main                     96           0    0.0    0.0     0.0    0.0\n CAF               GHC.IO.Handle.FD         84           0    0.0    0.0     0.0    0.0\n CAF               GHC.Conc.Signal          78           0    0.0    0.0     0.0    0.0\n CAF               GHC.IO.Encoding          76           0    0.0    0.0     0.0    0.0\n CAF               GHC.IO.Handle.Text       75           0    0.0    0.0     0.0    0.0\n CAF               GHC.IO.Encoding.Iconv    59           0    0.0    0.0     0.0    0.0\n</pre>\n\n<p>Ignore the <code>main\\.\\.</code> noise, it's just the list. However, there's one point that one should notice immediately: <code>matchesPF</code> and <code>uncurryL</code> use the same <code>alloc%</code>:</p>\n\n<pre><code>matchesPF    Main       13.3   11.5\nuncurryL     Main        9.5   11.5\n</code></pre>\n\n<h1>Getting to the CORE</h1>\n\n<p>Now it's time to inspect the resulting CORE (<code>ghc -ddump-simpl</code>). We'll notice that most of the functions have been transformed into worker wrappers, and they look more or less the same (<code>-dsuppress-all -dsuppress-uniques</code>):</p>\n\n<pre><code>$wa5\n$wa5 =\n  \\ @ a1 w w1 w2 -&gt;\n    letrec {\n      $wgo\n      $wgo =\n        \\ w3 -&gt;\n          case w3 of _ {\n            [] -&gt; 0;\n            : y ys -&gt;\n              case y of _ { (cs', n) -&gt;\n              case $wgo ys of ww { __DEFAULT -&gt;\n              case w w1 cs' of _ {\n                False -&gt; case n of _ { I# y1 -&gt; ww };\n                True -&gt; case n of _ { I# y1 -&gt; +# y1 ww }\n              }\n              }\n              }\n          }; } in\n    $wgo w2\n</code></pre>\n\n<p>This is your usual worker-wrapper. <code>$wgo</code> takes a list, checks whether it's empty, is strict in the head (<code>case y of _ { (cs', n) -&gt;\u2026</code>) and lazy in the recursive result <code>$wgo ys of ww</code>.</p>\n\n<p>All functions look the same. Well, all except <code>matchesPF</code> (your variant)</p>\n\n<pre><code>-- matchesPF\n$wa3 =\n  \\ @ a1 w w1 w2 -&gt;\n    letrec {\n      $wgo =\n        \\ w3 -&gt;\n          case w3 of _ {\n            [] -&gt; 0;\n            : y ys -&gt;\n              case $wgo ys of ww { __DEFAULT -&gt;\n              case let {\n                     x = case y of _ { (x1, ds) -&gt; x1 } } in\n                   case w w1 x of _ {\n                     False -&gt;\n                       case y of _ { (ds, y1) -&gt; case y1 of _ { I# y2 -&gt; main13 } };\n                              -- main13 is just #I 0\n                     True -&gt; case y of _ { (ds, y1) -&gt; y1 }\n                   }\n              of _ { I# x -&gt;\n              +# x ww\n              }\n              }\n          }; } in\n    $wgo w2\n</code></pre>\n\n<p>and <code>matchesPFL</code> (the variant that uses the lazy <code>uncurryL</code>)</p>\n\n<pre><code>-- matchesPFL\n$wa2\n$wa2 =\n  \\ @ a1 w w1 w2 -&gt;\n    letrec {\n      $wgo =\n        \\ w3 -&gt;\n          case w3 of _ {\n            [] -&gt; 0;\n            : y ys -&gt;\n              case $wgo ys of ww { __DEFAULT -&gt;\n              case snd y of ww1 { I# ww2 -&gt;\n              case let {\n                     x = fst y } in\n                   case w w1 x of _ {\n                     False -&gt; main13;\n                     True -&gt; ww1\n                   }\n              of _ { I# x -&gt;\n              +# x ww\n              }\n              }\n              }\n          }; } in\n    $wgo w2\n</code></pre>\n\n<p>They are virtually the same. And both of them contain <strong><code>let</code> bindings</strong>. This will create a thunk and usually lead to worse space requirements.</p>\n\n<h1>The solution</h1>\n\n<p>I think the culprit at this point is clear. It is <code>uncurry</code>. GHC wants to enforce the correct semantics of</p>\n\n<pre><code>uncurry (const (const 0)) undefined\n</code></pre>\n\n<p>However, this adds laziness and additional thunks. Your non-pointfree variant doesn't introduce that behaviour, since you pattern match on the pair:</p>\n\n<pre><code>foldr (\\(cs', n) a -&gt; \u2026)\n</code></pre>\n\n<p>Still don't trust me? Use a lazy pattern match</p>\n\n<pre><code>foldr (\\ ~(cs', n) a -&gt; \u2026)\n</code></pre>\n\n<p>and you will notice that <code>matches</code> will behave the same as <code>matchesPF</code>. So use slightly stricter variant of <code>uncurry</code>. <code>uncurryI</code> is enough to give the strictness analyzer a hint.</p>\n\n<p>Note that pairs are notorious for this behaviour. <a href=\"http://book.realworldhaskell.org/read/profiling-and-optimization.html\" rel=\"noreferrer\">RWH spents a whole chapter trying to optimize the behaviour of a single function</a> where intermediate pairs lead to problems.</p>\n"}], "owner": {"reputation": 2313, "user_id": 1513295, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/bc00550a36e3d751bee5e0027f929cbf?s=128&d=identicon&r=PG", "display_name": "semicolon", "link": "https://stackoverflow.com/users/1513295/semicolon"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 280, "favorite_count": 2, "accepted_answer_id": 38440296, "answer_count": 1, "score": 16, "last_activity_date": 1468854803, "creation_date": 1468815318, "last_edit_date": 1468849587, "question_id": 38428512, "link": "https://stackoverflow.com/questions/38428512/why-does-the-pointfree-version-of-my-function-use-much-more-memory", "title": "Why does the pointfree version of my function use much more memory", "body": "<p>I was working on a Project Euler problem and ended up with a Haskell file that included a function that looked like this:</p>\n\n<pre><code>matches :: (a -&gt; a -&gt; Bool) -&gt; a -&gt; [(a, Int)] -&gt; Int\nmatches f cs = foldr (\\(cs', n) a -&gt; fromBool (f cs cs') * n + a) 0\n</code></pre>\n\n<p>With <code>fromBool</code> imported from <code>Foreign.Marshal.Utils</code> just to quickly convert <code>True</code> to <code>1</code> and <code>False</code> to <code>0</code>.</p>\n\n<p>I was trying to get a little more speed out of my solution so I tried switching from <code>foldr</code> to <code>foldl'</code> (switching the arguments in the process) as I assumed <code>foldr</code> didn't make much sense to use on numbers.</p>\n\n<p>Switching from <code>foldr</code> to <code>foldl'</code> caused me to allocate more than twice as much memory according to GHC's profiler.</p>\n\n<p>For fun I also decided to replace the lambda with a pointfree version of the function:</p>\n\n<pre><code>matches :: (a -&gt; a -&gt; Bool) -&gt; a -&gt; [(a, Int)] -&gt; Int\nmatches f cs = foldr ((+) . uncurry ((*) . fromBool . f cs)) 0\n</code></pre>\n\n<p>This caused my memory allocation to increase 20x from the <code>foldr</code> version.</p>\n\n<p>Now this isn't a huge deal as even in the 20x case the total memory allocation was only about <code>135Mb</code> and the runtime of the program was relatively unaffected, if anything the higher memory allocation versions ran slightly faster.</p>\n\n<p>But I am really curious as to how these results could be possible, so that in future I will be able to pick the \"right\" function when I don't have as much leeway.</p>\n\n<p>EDIT:</p>\n\n<p>GHC version 7.10.2, compiled with <code>-O2 -prof -fprof-auto</code>. Executed with <code>+RTS -p</code>.</p>\n\n<p>EDIT 2:</p>\n\n<p>Alright it looks like this is too difficult to reproduce to omit the rest of the code, well here is the entire program:</p>\n\n<p>SPOILERS BELOW:</p>\n\n<pre><code>{-# LANGUAGE NoMonomorphismRestriction #-}\n\nimport Control.Monad\nimport Data.List\nimport Foreign.Marshal.Utils\n\ndata Color = Red | Green | Blue deriving (Eq, Enum, Bounded, Show)\n\ncolors :: [Color]\ncolors = [Red ..]\n\nmatches :: (a -&gt; a -&gt; Bool) -&gt; a -&gt; [(a, Int)] -&gt; Int\nmatches f x = foldr ((+) . uncurry ((*) . fromBool . f x)) 0\n-- matches f x = foldr (\\(y, n) a -&gt; fromBool (f x y) * n + a) 0\n-- matches f x = foldl' (\\a (y, n) -&gt; fromBool (f x y) * n + a) 0\n\ninvert :: [([Color], Int)] -&gt; [([Color], Int)]\ninvert rs = (\\cs -&gt; (cs, matches valid cs rs)) &lt;$&gt; choices\n  where\n    len = maximum $ length . fst &lt;$&gt; rs\n    choices = replicateM len colors\n    valid (x : xs) (y : ys) = x /= y &amp;&amp; valid xs ys\n    valid _ _ = True\n\nexpand :: [([Color], Int)] -&gt; [([Color], Int)]\nexpand rs = (\\cs -&gt; (cs, matches valid cs rs)) &lt;$&gt; choices\n  where\n    len = maximum $ length . fst &lt;$&gt; rs\n    choices = replicateM (len + 1) colors\n    valid (x1 : x2 : xs) (y : ys) = x1 /= y &amp;&amp; x2 /= y &amp;&amp; valid (x2 : xs) ys\n    valid _ _ = True\n\ngetRow :: Int -&gt; [([Color], Int)]\ngetRow 1 = flip (,) 1 . pure &lt;$&gt; colors\ngetRow n = expand . invert $ getRow (n - 1)\n\nresult :: Int -&gt; Int\nresult n = sum $ snd &lt;$&gt; getRow n\n\nmain :: IO ()\nmain = print $ result 8\n</code></pre>\n"}, {"tags": ["haskell", "polymorphism", "algebraic-data-types"], "comments": [{"owner": {"reputation": 25321, "user_id": 163177, "user_type": "registered", "accept_rate": 86, "profile_image": "https://www.gravatar.com/avatar/e811b5337bcad19d52c8fed3a0ea0075?s=128&d=identicon&r=PG", "display_name": "John F. Miller", "link": "https://stackoverflow.com/users/163177/john-f-miller"}, "edited": false, "score": 0, "creation_date": 1468808960, "post_id": 38427807, "comment_id": 64262104, "body": "Note: using GHC.  Extensions ok."}], "answers": [{"tags": [], "owner": {"reputation": 49959, "user_id": 866915, "user_type": "registered", "accept_rate": 70, "profile_image": "https://www.gravatar.com/avatar/09242131d6e17cbbe31e8547514da6e5?s=128&d=identicon&r=PG", "display_name": "ErikR", "link": "https://stackoverflow.com/users/866915/erikr"}, "is_accepted": true, "score": 9, "last_activity_date": 1468810103, "creation_date": 1468810103, "answer_id": 38427932, "question_id": 38427807, "link": "https://stackoverflow.com/questions/38427807/how-to-store-a-polymorphic-function-in-a-data-type/38427932#38427932", "title": "How to store a polymorphic function in a data type", "body": "<p>Use <code>forall</code> with the <code>RankNTypes</code> extension:</p>\n\n<pre><code>{-# LANGUAGE RankNTypes #-}\n\nimport Control.Monad.State\n\ntype Foo = String\n\ndata Bar = Bar {\n   -- other members here\n   runWithState :: forall a. State Foo a -&gt; a\n}\n</code></pre>\n"}], "owner": {"reputation": 25321, "user_id": 163177, "user_type": "registered", "accept_rate": 86, "profile_image": "https://www.gravatar.com/avatar/e811b5337bcad19d52c8fed3a0ea0075?s=128&d=identicon&r=PG", "display_name": "John F. Miller", "link": "https://stackoverflow.com/users/163177/john-f-miller"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 117, "favorite_count": 0, "accepted_answer_id": 38427932, "answer_count": 1, "score": 3, "last_activity_date": 1468810103, "creation_date": 1468808834, "question_id": 38427807, "link": "https://stackoverflow.com/questions/38427807/how-to-store-a-polymorphic-function-in-a-data-type", "title": "How to store a polymorphic function in a data type", "body": "<p>I have a <code>data</code> type in which I would like to store a function: <code>State Foo a -&gt; a</code>.  Presumably, when an instance of this type is created the program will partially apply <code>evalState</code> with the initial state for the computation and store the resulting function in the data structure.  Later, the function could be retrieved from the instance and used to evaluate one or more computations within the <code>State</code> monad and get the result.</p>\n\n<pre><code>-- This doesn't work\ndata Bar = Bar {\n  -- other members here\n  runWithState :: State Foo a -&gt; a\n}\n\n==&gt; Not in scope: type variable 'a'\n</code></pre>\n\n<p>I cannot make a more concrete because I do not know what the end result of the computation will be, and it could change depending on what computation produces.</p>\n\n<p>How do I make the type checker work with this?</p>\n"}, {"tags": ["haskell"], "comments": [{"owner": {"reputation": 9806, "user_id": 382982, "user_type": "registered", "accept_rate": 85, "profile_image": "https://i.stack.imgur.com/9ZaxF.jpg?s=128&g=1", "display_name": "pdoherty926", "link": "https://stackoverflow.com/users/382982/pdoherty926"}, "edited": false, "score": 0, "creation_date": 1468802732, "post_id": 38427242, "comment_id": 64261106, "body": "See <a href=\"http://stackoverflow.com/a/23611674/382982\">this</a> answer."}], "answers": [{"comments": [{"owner": {"reputation": 1, "user_id": 3995605, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/d74e1155e43ef92887efbe5b3c446eb9?s=128&d=identicon&r=PG&f=1", "display_name": "Yk Kim", "link": "https://stackoverflow.com/users/3995605/yk-kim"}, "edited": false, "score": 0, "creation_date": 1468805256, "post_id": 38427274, "comment_id": 64261505, "body": "Thanks. It works with <code>main = do ([] :: [Int])</code>"}, {"owner": {"reputation": 14781, "user_id": 630160, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/4445f21326af525a8ad19af7e3ae41a8?s=128&d=identicon&r=PG", "display_name": "epsilonhalbe", "link": "https://stackoverflow.com/users/630160/epsilonhalbe"}, "reply_to_user": {"reputation": 1, "user_id": 3995605, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/d74e1155e43ef92887efbe5b3c446eb9?s=128&d=identicon&r=PG&f=1", "display_name": "Yk Kim", "link": "https://stackoverflow.com/users/3995605/yk-kim"}, "edited": false, "score": 0, "creation_date": 1468824891, "post_id": 38427274, "comment_id": 64266632, "body": "I think it shouldn&#39;t work like that, I think you are missing a <code>print</code>"}, {"owner": {"reputation": 1, "user_id": 3995605, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/d74e1155e43ef92887efbe5b3c446eb9?s=128&d=identicon&r=PG&f=1", "display_name": "Yk Kim", "link": "https://stackoverflow.com/users/3995605/yk-kim"}, "edited": false, "score": 0, "creation_date": 1468917068, "post_id": 38427274, "comment_id": 64310864, "body": "Yes, I failed. <code>main = do print ([] :: [Int])</code> is right. Thanks again."}], "tags": [], "owner": {"reputation": 14781, "user_id": 630160, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/4445f21326af525a8ad19af7e3ae41a8?s=128&d=identicon&r=PG", "display_name": "epsilonhalbe", "link": "https://stackoverflow.com/users/630160/epsilonhalbe"}, "is_accepted": false, "score": 4, "last_activity_date": 1468803534, "last_edit_date": 1468803534, "creation_date": 1468802922, "answer_id": 38427274, "question_id": 38427242, "link": "https://stackoverflow.com/questions/38427242/print-empty-list-in-haskell/38427274#38427274", "title": "Print empty list in Haskell", "body": "<p>Lists in Haskell are polymorphic in their element's type and as <code>[]</code> contains not enough information you have to supply ghc with it by explicitly giving a type annotation <code>[] :: [Int]</code> for example.</p>\n\n<p>The error you are getting is due to the fact that the <code>Show</code> instance for lists is depending on the <code>Show</code> instance for its elements, and as ghc cannot determine that it assumes that ist has no such instance.</p>\n\n<p>Now you might think everything can be converted to a <code>String</code>, but then you could think of <code>Int -&gt; Int</code> and try</p>\n\n<pre><code>show [(+1)]\n</code></pre>\n\n<p>Which will not work as functions in Haskell have no default <code>Show</code> instance.</p>\n"}], "owner": {"reputation": 1, "user_id": 3995605, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/d74e1155e43ef92887efbe5b3c446eb9?s=128&d=identicon&r=PG&f=1", "display_name": "Yk Kim", "link": "https://stackoverflow.com/users/3995605/yk-kim"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 811, "favorite_count": 0, "closed_date": 1468855466, "answer_count": 1, "score": 0, "last_activity_date": 1468803700, "creation_date": 1468802514, "last_edit_date": 1468803700, "question_id": 38427242, "link": "https://stackoverflow.com/questions/38427242/print-empty-list-in-haskell", "closed_reason": "Duplicate", "title": "Print empty list in Haskell", "body": "<p>This is haskell code. I'm finding why I am wrong with below.</p>\n\n<pre><code>main = do\n    print [1] -- Okay\n    print [] -- error\n</code></pre>\n\n<p>Error strings are following.</p>\n\n<blockquote>\n  <p>P07.hs:38:11: error:\n      ? Ambiguous type variable \u2018t0\u2019 arising from a use of \u2018print\u2019\n        prevents the constraint \u2018(Show t0)\u2019 from being solved.\n        Probable fix: use a type annotation to specify what \u2018t0\u2019 should be.\n        These potential instances exist:\n          instance Show Ordering -- Defined in \u2018GHC.Show\u2019\n          instance Show Integer -- Defined in \u2018GHC.Show\u2019\n          instance Show a => Show (Maybe a) -- Defined in \u2018GHC.Show\u2019\n          ...plus 22 others\n          ...plus five instances involving out-of-scope types\n          (use -fprint-potential-instances to see them all)\n      ? In a stmt of a 'do' block: print []\n        In the expression: do { print [] }\n        In an equation for \u2018main\u2019: main = do { print [] }</p>\n</blockquote>\n\n<p>I tried <code>[] :: Show</code> not working. I think I just don't know what the errors mean.. please help me.\nThanks.</p>\n"}, {"tags": ["haskell"], "answers": [{"tags": [], "owner": {"reputation": 1099, "user_id": 6513157, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/3d45981b71a14222513f57e8566e4b8b?s=128&d=identicon&r=PG&f=1", "display_name": "R B", "link": "https://stackoverflow.com/users/6513157/r-b"}, "is_accepted": false, "score": 4, "last_activity_date": 1468802649, "creation_date": 1468802649, "answer_id": 38427253, "question_id": 38426885, "link": "https://stackoverflow.com/questions/38426885/what-is-cons-in-data-fixedlist-source-code/38427253#38427253", "title": "What is `Cons` in Data.FixedList source code?", "body": "<p>This is mostly fancy formatting of things you've seen before.</p>\n\n<pre><code>data FixedList f =&gt; Cons f a = (:.) { head :: a\n                                    , tail :: (f a)\n                                    } deriving (Eq, Ord)\n</code></pre>\n\n<p><code>FixedList f</code> is just a typeclass constraint on the <code>Cons f a</code> datatype. <code>(:.)</code> is an infix data constructor.</p>\n"}, {"tags": [], "owner": {"reputation": 2846, "user_id": 4347335, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/eb7e6f293a134a5defec74e12cae42cc?s=128&d=identicon&r=PG&f=1", "display_name": "cchalmers", "link": "https://stackoverflow.com/users/4347335/cchalmers"}, "is_accepted": true, "score": 7, "last_activity_date": 1468805955, "last_edit_date": 1495540736, "creation_date": 1468802700, "answer_id": 38427259, "question_id": 38426885, "link": "https://stackoverflow.com/questions/38426885/what-is-cons-in-data-fixedlist-source-code/38427259#38427259", "title": "What is `Cons` in Data.FixedList source code?", "body": "<p>First of all the <code>FixedList f =&gt;</code> enforces the constraint that <code>f</code> is a <code>FixedList</code> when using the constructor. I'm not sure why it's used here. It is generally <a href=\"https://stackoverflow.com/questions/12770278/typeclass-constraints-on-data-declarations\">advised against</a>.</p>\n\n<p>In Haskell, you can make infix data constructors with symbols starting with <code>:</code>. In the library, the constructor is put in brackets <code>(:.)</code> so it can be used with record syntax. Without record syntax it would look like this:</p>\n\n<pre><code>data Cons f a = a :. f a\n</code></pre>\n\n<p>Pattern matching is very similar to lists. Here's a simple function using it:</p>\n\n<pre><code>mapHead :: FixedList f =&gt; (a -&gt; a) -&gt; Cons f a -&gt; Cons f a\nmapHead f (a :. as) = f a :. as\n</code></pre>\n\n<p>Here's a definition without using an infix constructor.</p>\n\n<pre><code>data Cons f a = Cons\n  { head :: a\n  , tail :: f a\n  }\n</code></pre>\n"}], "owner": {"reputation": 9953, "user_id": 1218699, "user_type": "registered", "accept_rate": 71, "profile_image": "https://www.gravatar.com/avatar/d1ab4e94ac98c77234e0be3ed75ef51f?s=128&d=identicon&r=PG&f=1", "display_name": "sin\u03b8", "link": "https://stackoverflow.com/users/1218699/sin%ce%b8"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 178, "favorite_count": 0, "accepted_answer_id": 38427259, "answer_count": 2, "score": 2, "last_activity_date": 1468805955, "creation_date": 1468798013, "question_id": 38426885, "link": "https://stackoverflow.com/questions/38426885/what-is-cons-in-data-fixedlist-source-code", "title": "What is `Cons` in Data.FixedList source code?", "body": "<p>In the source code for <a href=\"https://hackage.haskell.org/package/fixed-list-0.1.6/docs/src/Data-FixedList.html#FixedList28\" rel=\"nofollow\">Data.FixedList</a>, I found the following definition:</p>\n\n<pre><code>data FixedList f =&gt;\n  Cons f a = (:.) {\n    head :: a,\n    tail :: (f a)\n  }  deriving (Eq, Ord)\n</code></pre>\n\n<p>As someone very new to Haskell, it's hard to figure out what's going on here. I understand syntax such as <code>data TypeName = TypeName { a :: Int, b :: Int} deriving (Show)</code> or <code>data TypeName = TypeA | TypeB</code>, but the code above is over my head. Any documentation / or walk-through would be much appreciated!</p>\n"}, {"tags": ["haskell", "ascii", "n-queens"], "answers": [{"comments": [{"owner": {"reputation": 27, "user_id": 5588119, "user_type": "registered", "accept_rate": 75, "profile_image": "https://graph.facebook.com/431618530370419/picture?type=large", "display_name": "cndolo", "link": "https://stackoverflow.com/users/5588119/cndolo"}, "edited": false, "score": 0, "creation_date": 1468790641, "post_id": 38426027, "comment_id": 64258734, "body": "Thank you for your speedy answer! However this isn&#39;t quite what I&#39;m looking for since I haven&#39;t really started working with Control.Monad. I guess my question lacked specification in that respect."}, {"owner": {"reputation": 49959, "user_id": 866915, "user_type": "registered", "accept_rate": 70, "profile_image": "https://www.gravatar.com/avatar/09242131d6e17cbbe31e8547514da6e5?s=128&d=identicon&r=PG", "display_name": "ErikR", "link": "https://stackoverflow.com/users/866915/erikr"}, "reply_to_user": {"reputation": 27, "user_id": 5588119, "user_type": "registered", "accept_rate": 75, "profile_image": "https://graph.facebook.com/431618530370419/picture?type=large", "display_name": "cndolo", "link": "https://stackoverflow.com/users/5588119/cndolo"}, "edited": false, "score": 0, "creation_date": 1468790889, "post_id": 38426027, "comment_id": 64258801, "body": "Found a few typos in my answer - updated with corrections."}], "tags": [], "owner": {"reputation": 49959, "user_id": 866915, "user_type": "registered", "accept_rate": 70, "profile_image": "https://www.gravatar.com/avatar/09242131d6e17cbbe31e8547514da6e5?s=128&d=identicon&r=PG", "display_name": "ErikR", "link": "https://stackoverflow.com/users/866915/erikr"}, "is_accepted": false, "score": 0, "last_activity_date": 1468790800, "last_edit_date": 1468790800, "creation_date": 1468790383, "answer_id": 38426027, "question_id": 38425982, "link": "https://stackoverflow.com/questions/38425982/haskell-n-queens-ascii-graphic/38426027#38426027", "title": "Haskell: n queens ASCII graphic", "body": "<p>Looks like this should work:</p>\n\n<pre><code>import Control.Monad\n\nforM_ (map drawQueens (queens 8)) putStrLn\n</code></pre>\n\n<p><code>forM_</code> \"gives\" each result in <code>drawQueens ...</code>  to <code>putStrLn</code>.</p>\n\n<p><strong>Update</strong></p>\n\n<p><code>putStrLn</code> actually prints a String to the console thereby \"interpreting\" the new lines.</p>\n\n<p>For example:</p>\n\n<pre><code>ghci&gt; \"line 1\\nline 2\\n\"\n\"line 1\\nline 2\\n\"\nghci&gt; putStrLn \"line 1\\nline 2\\n\"\nline 1\nline 2\n</code></pre>\n"}, {"comments": [{"owner": {"reputation": 27, "user_id": 5588119, "user_type": "registered", "accept_rate": 75, "profile_image": "https://graph.facebook.com/431618530370419/picture?type=large", "display_name": "cndolo", "link": "https://stackoverflow.com/users/5588119/cndolo"}, "edited": false, "score": 0, "creation_date": 1468792385, "post_id": 38426113, "comment_id": 64259173, "body": "thanks for your help! However, I&#39;m not really sure what to do with &quot;print . drawQueens . head . queens :: Int -&gt; IO ()&quot;; I figured this is a function composition, but I don&#39;t know to what part of my code I should add this to. Any help will be appreciated."}, {"owner": {"reputation": 2313, "user_id": 5318306, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/897fd4f3b92d28c5c1eb28a8024661a1?s=128&d=identicon&r=PG&f=1", "display_name": "Gurkenglas", "link": "https://stackoverflow.com/users/5318306/gurkenglas"}, "reply_to_user": {"reputation": 27, "user_id": 5588119, "user_type": "registered", "accept_rate": 75, "profile_image": "https://graph.facebook.com/431618530370419/picture?type=large", "display_name": "cndolo", "link": "https://stackoverflow.com/users/5588119/cndolo"}, "edited": false, "score": 0, "creation_date": 1468793682, "post_id": 38426113, "comment_id": 64259508, "body": "ghci, when given any value that is not of type IO a for some a, will plug it into print. Reading your &quot;current output&quot;, I&#39;ll adjust my answer."}], "tags": [], "owner": {"reputation": 2313, "user_id": 5318306, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/897fd4f3b92d28c5c1eb28a8024661a1?s=128&d=identicon&r=PG&f=1", "display_name": "Gurkenglas", "link": "https://stackoverflow.com/users/5318306/gurkenglas"}, "is_accepted": false, "score": 1, "last_activity_date": 1468793751, "last_edit_date": 1468793751, "creation_date": 1468790965, "answer_id": 38426113, "question_id": 38425982, "link": "https://stackoverflow.com/questions/38425982/haskell-n-queens-ascii-graphic/38426113#38426113", "title": "Haskell: n queens ASCII graphic", "body": "<p>Giving ghci <code>drawQueens (head (queens 8))</code> will output a string that you can copypaste into code to get that string back, including quotes, literal \\n etc.</p>\n\n<p>Giving ghci <code>putStr (drawQueens (head (queens 8)))</code> will instead \"interpret\" the string, converting \\n to newlines, omitting the quotes, etc. <code>putStrLn</code> instead of <code>putStr</code> adds a newline at the end.</p>\n\n<p>Both of these will crash if the list returned by queens is empty. Safer variants include <code>listToMaybe</code>, case matches and/or the <code>forM</code>/<code>traverse</code> stuff from the other answer.</p>\n"}, {"comments": [{"owner": {"reputation": 27, "user_id": 5588119, "user_type": "registered", "accept_rate": 75, "profile_image": "https://graph.facebook.com/431618530370419/picture?type=large", "display_name": "cndolo", "link": "https://stackoverflow.com/users/5588119/cndolo"}, "edited": false, "score": 0, "creation_date": 1468792743, "post_id": 38426292, "comment_id": 64259263, "body": "Thank you, I&#39;ll have a look at that right away. And how do I get the vertical &quot;1 2 3 4 5 6 7 8&quot;?"}], "tags": [], "owner": {"reputation": 100892, "user_id": 745903, "user_type": "registered", "accept_rate": 74, "profile_image": "https://www.gravatar.com/avatar/50933f6638836741e620669b3940410e?s=128&d=identicon&r=PG", "display_name": "leftaroundabout", "link": "https://stackoverflow.com/users/745903/leftaroundabout"}, "is_accepted": true, "score": 3, "last_activity_date": 1468795500, "last_edit_date": 1468795500, "creation_date": 1468792479, "answer_id": 38426292, "question_id": 38425982, "link": "https://stackoverflow.com/questions/38425982/haskell-n-queens-ascii-graphic/38426292#38426292", "title": "Haskell: n queens ASCII graphic", "body": "<p>The compiler \u201cinterprets\u201d <code>'\\n'</code> just fine. Only, newlines aren't really \u201csafe characters\u201d, as in: you can't use a string literal with newlines in it directly in Haskell code. And the output of <code>print</code>, which GHCi uses by default to, well, print stuff, always tries to generate valid Haskell code, hence it escapes these newlines in again. This can be surpressed if you just instruct it to cat the string as it is to the terminal:</p>\n\n<pre><code>*Main&gt; drawQueens [4,2,7,3,6,8,5,1]\n\"1 2 3 4 5 6 7 8\\n___D____\\n_D______\\n______D_\\n__D_____\\n_____D__\\n_______D\\n____D___\\nD_______\\n\\n\"\n*Main&gt; putStrLn $ drawQueens [4,2,7,3,6,8,5,1]\n1 2 3 4 5 6 7 8\n___D____\n_D______\n______D_\n__D_____\n_____D__\n_______D\n____D___\nD_______\n</code></pre>\n\n<p>There's still another problem: you don't have the same spacing in the number ow as in the actuall chessboard. Well, that's easily fixed too.</p>\n\n<pre><code>drawQueens :: [Int] -&gt; String\ndrawQueens [] = \"\"\ndrawQueens x = \"1 2 3 4 5 6 7 8\" ++ \"\\n\" ++ concatMap showRow x\n    where\n        size = length x\n        spaces n = concat $ replicate n \"\u25a1 \"\n        showRow n = spaces (n - 1) ++ \"\u265b \" ++ spaces (size - n) ++ \"\\n\"\n</code></pre>\n\n<p>This then gives:</p>\n\n<pre><code>*Main&gt; putStrLn $ drawQueens [4,2,7,3,6,8,5,1]\n1 2 3 4 5 6 7 8\n\u25a1 \u25a1 \u25a1 \u265b \u25a1 \u25a1 \u25a1 \u25a1 \n\u25a1 \u265b \u25a1 \u25a1 \u25a1 \u25a1 \u25a1 \u25a1 \n\u25a1 \u25a1 \u25a1 \u25a1 \u25a1 \u25a1 \u265b \u25a1 \n\u25a1 \u25a1 \u265b \u25a1 \u25a1 \u25a1 \u25a1 \u25a1 \n\u25a1 \u25a1 \u25a1 \u25a1 \u25a1 \u265b \u25a1 \u25a1 \n\u25a1 \u25a1 \u25a1 \u25a1 \u25a1 \u25a1 \u25a1 \u265b \n\u25a1 \u25a1 \u25a1 \u25a1 \u265b \u25a1 \u25a1 \u25a1 \n\u265b \u25a1 \u25a1 \u25a1 \u25a1 \u25a1 \u25a1 \u25a1 \n</code></pre>\n\n<p>Fancy version:</p>\n\n<pre><code>chessboardRow, chessboardRow' :: [Maybe Char] -&gt; String\nchessboardRow' [] = \"\u258c\"\nchessboardRow' (Just c:cs) = '\u258c':c:chessboardRow cs\nchessboardRow' (Nothing:cs) = \"\u258c \"++chessboardRow cs\nchessboardRow [] = \" \"\nchessboardRow (Just c:cs) = '\u2590':c:chessboardRow' cs\nchessboardRow (Nothing:cs) = \"\u2590\u2588\"++chessboardRow' cs\n\ndrawQueens :: [Int] -&gt; String\ndrawQueens [] = \"\"\ndrawQueens x = \"  a b c d e f g h\" ++ \"\\n\"\n                 ++ concat (reverse $ \n                             zipWith3 showRow\n                                      ['1'..]\n                                      (cycle [chessboardRow, chessboardRow'])\n                                      x)\n                 ++ \"\\n\"\n    where\n        size = length x\n        showRow i rsh n = i : rsh (replicate (n - 1) Nothing\n                                      ++ [Just '\u265b']\n                                      ++ replicate (size - n) Nothing)\n                              ++ \"\\n\"\n</code></pre>\n\n<p>gives</p>\n\n<pre><code>  a b c d e f g h\n8\u258c\u265b\u2590\u2588\u258c \u2590\u2588\u258c \u2590\u2588\u258c \u2590\u2588\u258c\n7\u2590\u2588\u258c \u2590\u2588\u258c \u2590\u265b\u258c \u2590\u2588\u258c  \n6\u258c \u2590\u2588\u258c \u2590\u2588\u258c \u2590\u2588\u258c \u2590\u265b\u258c\n5\u2590\u2588\u258c \u2590\u2588\u258c \u2590\u2588\u258c\u265b\u2590\u2588\u258c  \n4\u258c \u2590\u2588\u258c\u265b\u2590\u2588\u258c \u2590\u2588\u258c \u2590\u2588\u258c\n3\u2590\u2588\u258c \u2590\u2588\u258c \u2590\u2588\u258c \u2590\u265b\u258c  \n2\u258c \u2590\u265b\u258c \u2590\u2588\u258c \u2590\u2588\u258c \u2590\u2588\u258c\n1\u2590\u2588\u258c \u2590\u2588\u258c\u265b\u2590\u2588\u258c \u2590\u2588\u258c  \n</code></pre>\n"}], "owner": {"reputation": 27, "user_id": 5588119, "user_type": "registered", "accept_rate": 75, "profile_image": "https://graph.facebook.com/431618530370419/picture?type=large", "display_name": "cndolo", "link": "https://stackoverflow.com/users/5588119/cndolo"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 213, "favorite_count": 1, "accepted_answer_id": 38426292, "answer_count": 3, "score": 0, "last_activity_date": 1468795500, "creation_date": 1468790049, "question_id": 38425982, "link": "https://stackoverflow.com/questions/38425982/haskell-n-queens-ascii-graphic", "title": "Haskell: n queens ASCII graphic", "body": "<p>I've been working on the n queens problem on Haskell and I have been able to solve it for the most part. </p>\n\n<pre><code>queens :: Int -&gt; [[Int]]\nqueens 0 = [[]]\nqueens n = [ x : y | y &lt;- queens (n-1), x &lt;- [1..8], safe x y 1]\n     where\n         safe x [] n = True\n         safe x (y:ys) n = and [ x /= y , x /= y + n , x /= y - n , safe x ys (n+1)]\ndrawQueens :: [Int] -&gt; String\ndrawQueens [] = \"\"\ndrawQueens x = \"1 2 3 4 5 6 7 8\" ++ ['\\n'] ++ concatMap showRow x  ++       ['\\n']\n    where\n        size = length x\n        spaces = replicate size '_' ++  \"\"\n        showRow n = take (n - 1) spaces ++ \"D\" ++ take (size - n) spaces   ++ ['\\n']\n</code></pre>\n\n<p>My second function, drawQueens, should ideally transform one solution to the queens problem to an ASCII graphic (see image below). My problems/questions are:</p>\n\n<ol>\n<li>how do I get the queens function which outputs [[Int]] to \"give\" one [Int] to the drawQueens function? </li>\n</ol>\n\n<p>2.Why isn't the compiler interpreting the ['\\n']? How can I modify my code in order to achieve the desired output? </p>\n\n<p>This was initially a homework question during the semester but I am now doing it just for myself. </p>\n\n<p><a href=\"http://i.stack.imgur.com/znmeC.png\" rel=\"nofollow\">My desired output for n = 8</a></p>\n\n<p><a href=\"http://i.stack.imgur.com/AB8Uh.png\" rel=\"nofollow\">This is what my output of drawQueens looks like currently</a></p>\n\n<p>Thank you for all your help.</p>\n"}, {"tags": ["haskell", "syntax", "let"], "comments": [{"owner": {"reputation": 791, "user_id": 1587319, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/1c8a88b9a8d79a518cba52a7a8d099f9?s=128&d=identicon&r=PG", "display_name": "pdexter", "link": "https://stackoverflow.com/users/1587319/pdexter"}, "edited": false, "score": 0, "creation_date": 1468788554, "post_id": 38425796, "comment_id": 64258180, "body": "<code>r</code> would be a function and <code>m</code> would be a parameter."}], "answers": [{"tags": [], "owner": {"reputation": 37219, "user_id": 1523776, "user_type": "moderator", "accept_rate": 87, "profile_image": "https://www.gravatar.com/avatar/b3e0b5c8e42a8c38009ef2d969f8dabb?s=128&d=identicon&r=PG", "display_name": "Benjamin Hodgson", "link": "https://stackoverflow.com/users/1523776/benjamin-hodgson"}, "is_accepted": true, "score": 6, "last_activity_date": 1468836507, "last_edit_date": 1468836507, "creation_date": 1468788631, "answer_id": 38425824, "question_id": 38425796, "link": "https://stackoverflow.com/questions/38425796/what-is-going-on-in-this-let-expression/38425824#38425824", "title": "What is going on in this let expression?", "body": "<p>That's a (local) function declaration with the name <code>r</code>. <code>m</code> is the function's parameter. It's equivalent to:</p>\n\n<pre><code>let r = \\m -&gt; runReaderT (runConfigM m) c\n</code></pre>\n"}], "owner": {"reputation": 108, "user_id": 629166, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/8c9f92c097d9b9275f169ebd5a51509e?s=128&d=identicon&r=PG", "display_name": "npj", "link": "https://stackoverflow.com/users/629166/npj"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 82, "favorite_count": 0, "accepted_answer_id": 38425824, "answer_count": 1, "score": 0, "last_activity_date": 1469115579, "creation_date": 1468788396, "last_edit_date": 1469115579, "question_id": 38425796, "link": "https://stackoverflow.com/questions/38425796/what-is-going-on-in-this-let-expression", "title": "What is going on in this let expression?", "body": "<p>I am reading through this <a href=\"http://taylor.fausak.me/2014/10/21/building-a-json-rest-api-in-haskell/#transformers\" rel=\"nofollow\">blog post</a> about writing an API in Haskell with Scotty, and I came across the section on monad transformers. I understand the concept of monad transformers, but I cannot wrap my head around what's going on here:</p>\n\n<pre><code>let r m = runReaderT (runConfigM m) c\n</code></pre>\n\n<p>How can the expression reference <code>m</code> when <code>m</code> is declared in the same <code>let</code> expression that uses it? What is going on here? What is <code>m</code>?</p>\n"}, {"tags": ["haskell", "hspec"], "answers": [{"tags": [], "owner": {"reputation": 49959, "user_id": 866915, "user_type": "registered", "accept_rate": 70, "profile_image": "https://www.gravatar.com/avatar/09242131d6e17cbbe31e8547514da6e5?s=128&d=identicon&r=PG", "display_name": "ErikR", "link": "https://stackoverflow.com/users/866915/erikr"}, "is_accepted": false, "score": 7, "last_activity_date": 1468782116, "creation_date": 1468782116, "answer_id": 38424891, "question_id": 38424627, "link": "https://stackoverflow.com/questions/38424627/how-to-division-operator-scenario-when-denominator-is-zero-or-both-numerator-a/38424891#38424891", "title": "How to division operator scenario when denominator is zero , or both numerator and denominator are zero?", "body": "<p>Use the functions <a href=\"http://hackage.haskell.org/package/base-4.9.0.0/docs/Prelude.html#v:isInfinite\"><strong>isInfinite</strong></a> and <a href=\"http://hackage.haskell.org/package/base-4.9.0.0/docs/Prelude.html#v:isNaN\"><strong>isNaN</strong></a>:</p>\n\n<pre><code>Prelude&gt; isInfinite (3 / 0.0)\nTrue\nPrelude&gt; isNaN (0.0/0.0)\nTrue\n</code></pre>\n"}], "owner": {"reputation": 91, "user_id": 2226545, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/1Ibry.jpg?s=128&g=1", "display_name": "phoenix", "link": "https://stackoverflow.com/users/2226545/phoenix"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 73, "favorite_count": 0, "answer_count": 1, "score": 1, "last_activity_date": 1468782912, "creation_date": 1468780486, "last_edit_date": 1468782912, "question_id": 38424627, "link": "https://stackoverflow.com/questions/38424627/how-to-division-operator-scenario-when-denominator-is-zero-or-both-numerator-a", "title": "How to division operator scenario when denominator is zero , or both numerator and denominator are zero?", "body": "<p>I am trying to do TDD in haskell using HSpec. So while writing special case scenario for division operator for example:</p>\n\n<ul>\n<li><code>3 / 0 =&gt; Infinity</code></li>\n<li><code>0 / 0 =&gt; Nan</code></li>\n</ul>\n\n<p>How to test the above cases using Hspec ?</p>\n"}, {"tags": ["haskell", "process", "signals", "ghci"], "comments": [{"owner": {"reputation": 126897, "user_id": 791604, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/ce991df7a056248d5e4f6fc3659ba733?s=128&d=identicon&r=PG", "display_name": "Daniel Wagner", "link": "https://stackoverflow.com/users/791604/daniel-wagner"}, "edited": false, "score": 0, "creation_date": 1468777722, "post_id": 38423727, "comment_id": 64254930, "body": "Sanity check: when I run <code>ssh my.fun.server ghci</code> in my shell and hit Ctrl+D, my ssh session ends. Are you saying that ssh does not behave this way for you?"}, {"owner": {"reputation": 126897, "user_id": 791604, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/ce991df7a056248d5e4f6fc3659ba733?s=128&d=identicon&r=PG", "display_name": "Daniel Wagner", "link": "https://stackoverflow.com/users/791604/daniel-wagner"}, "edited": false, "score": 0, "creation_date": 1468777964, "post_id": 38423727, "comment_id": 64255016, "body": "Also, I understand why you left out the arguments to <code>ssh</code>, but you should include your definitions for <code>_terminateSsh</code> and <code>_waitForSsh</code> to make this a complete question."}, {"owner": {"reputation": 3766, "user_id": 167485, "user_type": "registered", "accept_rate": 67, "profile_image": "https://www.gravatar.com/avatar/80c33b5a72595157a2a8a217a7af3e38?s=128&d=identicon&r=PG", "display_name": "Rehno Lindeque", "link": "https://stackoverflow.com/users/167485/rehno-lindeque"}, "reply_to_user": {"reputation": 126897, "user_id": 791604, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/ce991df7a056248d5e4f6fc3659ba733?s=128&d=identicon&r=PG", "display_name": "Daniel Wagner", "link": "https://stackoverflow.com/users/791604/daniel-wagner"}, "edited": false, "score": 0, "creation_date": 1468779660, "post_id": 38423727, "comment_id": 64255562, "body": "I&#39;m not connecting to ghci via ssh, the ssh tunnel is just a process I spawn to connect to a remote database: <code>[ &quot;-N&quot;, sshUser ++ &quot;@&quot; ++ sshRemoteHost, &quot;-L&quot;, localDbPort ++ &quot;:localhost:&quot; ++ sshRemoteDbPort ]</code>."}, {"owner": {"reputation": 3766, "user_id": 167485, "user_type": "registered", "accept_rate": 67, "profile_image": "https://www.gravatar.com/avatar/80c33b5a72595157a2a8a217a7af3e38?s=128&d=identicon&r=PG", "display_name": "Rehno Lindeque", "link": "https://stackoverflow.com/users/167485/rehno-lindeque"}, "reply_to_user": {"reputation": 126897, "user_id": 791604, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/ce991df7a056248d5e4f6fc3659ba733?s=128&d=identicon&r=PG", "display_name": "Daniel Wagner", "link": "https://stackoverflow.com/users/791604/daniel-wagner"}, "edited": false, "score": 0, "creation_date": 1468780040, "post_id": 38423727, "comment_id": 64255686, "body": "In other words I only provided the second part for context, but I believe the specific process <code>ssh</code> should be somewhat irrelevant... (it could as easily be <code>Process.proc &quot;sleep&quot; [ &quot;999&quot; ]</code>)"}, {"owner": {"reputation": 126897, "user_id": 791604, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/ce991df7a056248d5e4f6fc3659ba733?s=128&d=identicon&r=PG", "display_name": "Daniel Wagner", "link": "https://stackoverflow.com/users/791604/daniel-wagner"}, "edited": false, "score": 0, "creation_date": 1468788655, "post_id": 38423727, "comment_id": 64258207, "body": "Thanks for the clarification. The question makes a lot more sense now."}], "answers": [{"comments": [{"owner": {"reputation": 3766, "user_id": 167485, "user_type": "registered", "accept_rate": 67, "profile_image": "https://www.gravatar.com/avatar/80c33b5a72595157a2a8a217a7af3e38?s=128&d=identicon&r=PG", "display_name": "Rehno Lindeque", "link": "https://stackoverflow.com/users/167485/rehno-lindeque"}, "edited": false, "score": 0, "creation_date": 1468800209, "post_id": 38425921, "comment_id": 64260754, "body": "Thank you for the help Daniel, I&#39;ll see about creating a ticket at least."}], "tags": [], "owner": {"reputation": 126897, "user_id": 791604, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/ce991df7a056248d5e4f6fc3659ba733?s=128&d=identicon&r=PG", "display_name": "Daniel Wagner", "link": "https://stackoverflow.com/users/791604/daniel-wagner"}, "is_accepted": false, "score": 1, "last_activity_date": 1468789516, "creation_date": 1468789516, "answer_id": 38425921, "question_id": 38423727, "link": "https://stackoverflow.com/questions/38423727/how-to-install-a-cleanup-handler-for-ghci-on-quit/38425921#38425921", "title": "How to install a cleanup handler for ghci on :quit?", "body": "<p>After reviewing the documentation, I believe there is not a good way to do this. You should consider diving into the ghci code yourself to implement this feature.</p>\n"}], "owner": {"reputation": 3766, "user_id": 167485, "user_type": "registered", "accept_rate": 67, "profile_image": "https://www.gravatar.com/avatar/80c33b5a72595157a2a8a217a7af3e38?s=128&d=identicon&r=PG", "display_name": "Rehno Lindeque", "link": "https://stackoverflow.com/users/167485/rehno-lindeque"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 74, "favorite_count": 0, "answer_count": 1, "score": 1, "last_activity_date": 1468789516, "creation_date": 1468774817, "last_edit_date": 1468780249, "question_id": 38423727, "link": "https://stackoverflow.com/questions/38423727/how-to-install-a-cleanup-handler-for-ghci-on-quit", "title": "How to install a cleanup handler for ghci on :quit?", "body": "<p>When using <code>:quit</code>,<code>:q</code> or <code>CTRL+d</code> in ghci the repl terminates without raising signal as far as I can tell.</p>\n\n<p>How could one execute some cleanup code in this case? I've tried installing several signal handlers to see if that would do the trick, but it doesn't appear as though ghci makes use of these:</p>\n\n<pre><code>Prelude&gt; import System.Posix.Signals\nPrelude System.Posix.Signals&gt; installHandler sigINT (Catch $ print \"cleanup (via INT)\") Nothing\nPrelude System.Posix.Signals&gt; installHandler sigTERM (Catch $ print \"cleanup (via TERM)\") Nothing\nPrelude System.Posix.Signals&gt; :quit\nLeaving GHCi.\n</code></pre>\n\n<p>The result I was hoping for is <code>cleanup (..)</code> being printed to the console to indicate that it was triggered.</p>\n\n<p>I know that it is possible to override <code>:q</code> and <code>:quit</code> using <code>:def</code>, but this doesn't handle my preferred method for exiting the repl, which is <code>CTRL+d</code>.</p>\n\n<hr>\n\n<p>The context for this question is this: I've spawned a process to ssh tunnel to a server where an unprotected database is running. This process persists when exiting the repl, which forces me to kill the process manually every time.</p>\n\n<pre><code>import qualified System.Process as Process\n\nforkSshTunnel = forkIO $ do\n  let sshProc = do\n            (_,_,_, phandle) &lt;- Process.createProcess $\n                                  (Process.proc \"ssh\" [ {- ... -} ])\n                                  { Process.std_in  = Process.CreatePipe\n                                  , Process.std_out = Process.Inherit\n                                  , Process.std_err = Process.Inherit\n                                  }\n            return phandle\n  bracket sshProc _terminateSsh _waitForSsh\n</code></pre>\n"}, {"tags": ["haskell", "functional-programming", "dsl", "purescript"], "comments": [{"owner": {"reputation": 61029, "user_id": 625914, "user_type": "registered", "accept_rate": 70, "profile_image": "https://www.gravatar.com/avatar/f1932d8bf4e9dbf779a48b41bbf21592?s=128&d=identicon&r=PG", "display_name": "behzad.nouri", "link": "https://stackoverflow.com/users/625914/behzad-nouri"}, "edited": false, "score": 0, "creation_date": 1468775727, "post_id": 38423611, "comment_id": 64254225, "body": "outside module extensibility can be achieved using <i>type-classes</i>."}], "answers": [{"comments": [{"owner": {"reputation": 44680, "user_id": 1031791, "user_type": "registered", "accept_rate": 54, "profile_image": "https://www.gravatar.com/avatar/fb710534fda446d2286074bb7692e65a?s=128&d=identicon&r=PG", "display_name": "MaiaVictor", "link": "https://stackoverflow.com/users/1031791/maiavictor"}, "edited": false, "score": 2, "creation_date": 1468778000, "post_id": 38424082, "comment_id": 64255024, "body": "I&#39;m not sure I understand this... how does this allow different users to compose their moves into a single game, for example, without touching the code of each other?"}, {"owner": {"reputation": 126897, "user_id": 791604, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/ce991df7a056248d5e4f6fc3659ba733?s=128&d=identicon&r=PG", "display_name": "Daniel Wagner", "link": "https://stackoverflow.com/users/791604/daniel-wagner"}, "reply_to_user": {"reputation": 44680, "user_id": 1031791, "user_type": "registered", "accept_rate": 54, "profile_image": "https://www.gravatar.com/avatar/fb710534fda446d2286074bb7692e65a?s=128&d=identicon&r=PG", "display_name": "MaiaVictor", "link": "https://stackoverflow.com/users/1031791/maiavictor"}, "edited": false, "score": 0, "creation_date": 1468778658, "post_id": 38424082, "comment_id": 64255248, "body": "@Viclib It doesn&#39;t. Also, you didn&#39;t ask for that; also also, it doesn&#39;t sound possible. If I want to define a <code>SweepKick</code> move without knowing about your moves and you want to define a <code>KarateChop</code> move without knowing about my moves, what is the poor engine supposed to do when it sees a <code>SweepKick</code> vs. <code>KarateChop</code>? Neither of us has told it what should happen in that case."}, {"owner": {"reputation": 44680, "user_id": 1031791, "user_type": "registered", "accept_rate": 54, "profile_image": "https://www.gravatar.com/avatar/fb710534fda446d2286074bb7692e65a?s=128&d=identicon&r=PG", "display_name": "MaiaVictor", "link": "https://stackoverflow.com/users/1031791/maiavictor"}, "edited": false, "score": 0, "creation_date": 1468778817, "post_id": 38424082, "comment_id": 64255300, "body": "Yep, I think I&#39;m not expressing myself well, but that is for the fact I don&#39;t understand well the problem I&#39;m solving. I understand the issue you raised and it makes sense. It also made me realize that it is not true that both players don&#39;t know the code of each other - the last player to propose a new move does know about all the previous implemented moves, so, in theory, he should specify the interaction with all the previous moves. I&#39;m gonna think about that now..."}, {"owner": {"reputation": 126897, "user_id": 791604, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/ce991df7a056248d5e4f6fc3659ba733?s=128&d=identicon&r=PG", "display_name": "Daniel Wagner", "link": "https://stackoverflow.com/users/791604/daniel-wagner"}, "reply_to_user": {"reputation": 44680, "user_id": 1031791, "user_type": "registered", "accept_rate": 54, "profile_image": "https://www.gravatar.com/avatar/fb710534fda446d2286074bb7692e65a?s=128&d=identicon&r=PG", "display_name": "MaiaVictor", "link": "https://stackoverflow.com/users/1031791/maiavictor"}, "edited": false, "score": 0, "creation_date": 1468778875, "post_id": 38424082, "comment_id": 64255324, "body": "@Viclib In that case, it is straightforward to extend the parameterization technique to handle arbitrary <code>Either</code>s rather than just <code>Either DuelMove</code>. Then it is easy to do what you ask; each programmer that adds new moves also adds a layer of <code>turn</code>. (e.g. the second progammer writes <code>turn secondUserL secondUserR secondUserRL (turn firstUserL firstUserR firstUserRL)</code>."}, {"owner": {"reputation": 44680, "user_id": 1031791, "user_type": "registered", "accept_rate": 54, "profile_image": "https://www.gravatar.com/avatar/fb710534fda446d2286074bb7692e65a?s=128&d=identicon&r=PG", "display_name": "MaiaVictor", "link": "https://stackoverflow.com/users/1031791/maiavictor"}, "edited": false, "score": 0, "creation_date": 1468778905, "post_id": 38424082, "comment_id": 64255340, "body": "Yep, it might be. I think I&#39;m getting there, let me just think for a while."}, {"owner": {"reputation": 44680, "user_id": 1031791, "user_type": "registered", "accept_rate": 54, "profile_image": "https://www.gravatar.com/avatar/fb710534fda446d2286074bb7692e65a?s=128&d=identicon&r=PG", "display_name": "MaiaVictor", "link": "https://stackoverflow.com/users/1031791/maiavictor"}, "edited": false, "score": 0, "creation_date": 1468779753, "post_id": 38424082, "comment_id": 64255594, "body": "Well, I&#39;m really confused, the problem seems much harder than I thought. For example, suppose there are 120 moves, each one with a type. Then I decide to add: <code>Mirror: if hit by an energy move, reflects its damage.</code> - now, how could adding such a move work? I&#39;d have to add 120 layers, and each layer would basically duplicate the existing code for the old moves. Looks like my approach overall is simply not well thought. I feel like I&#39;m missing something."}, {"owner": {"reputation": 44680, "user_id": 1031791, "user_type": "registered", "accept_rate": 54, "profile_image": "https://www.gravatar.com/avatar/fb710534fda446d2286074bb7692e65a?s=128&d=identicon&r=PG", "display_name": "MaiaVictor", "link": "https://stackoverflow.com/users/1031791/maiavictor"}, "edited": false, "score": 1, "creation_date": 1468780470, "post_id": 38424082, "comment_id": 64255813, "body": "To be clear: I think my whole design is flawed. Maybe it would be better if I just asked directly how you would create a turn-based game on which you can add new moves incrementally, without having to edit the old code, nor add a new number of clauses proportional to the length of the old code. I think this might have something to do with the expression problem?"}], "tags": [], "owner": {"reputation": 126897, "user_id": 791604, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/ce991df7a056248d5e4f6fc3659ba733?s=128&d=identicon&r=PG", "display_name": "Daniel Wagner", "link": "https://stackoverflow.com/users/791604/daniel-wagner"}, "is_accepted": false, "score": 1, "last_activity_date": 1468776945, "creation_date": 1468776945, "answer_id": 38424082, "question_id": 38423611, "link": "https://stackoverflow.com/questions/38423611/general-approach-for-user-extensible-move-effects-on-turn-based-games/38424082#38424082", "title": "General approach for user-extensible move effects on turn-based games?", "body": "<p>A simple trick is to parameterize the <code>turn</code> function. Thus:</p>\n\n<pre><code>type DuelMovePlus = Either DuelMove\n\nturn :: (a -&gt; DuelMove -&gt; Either Player DuelState)\n     -&gt; (DuelMove -&gt; a -&gt; Either Player DuelState)\n     -&gt; (a -&gt; a        -&gt; Either Player DuelState)\n     -&gt; DuelMovePlus a -&gt; DuelMovePlus a -&gt; Either Player DuelState\nturn userL userR userLR = \\case\n    (Left  l, Left  r) -&gt; {- same code as before -}\n    (Left  l, Right r) -&gt; userR  l r\n    (Right l, Left  r) -&gt; userL  l r\n    (Right l, Right r) -&gt; userLR l r\n</code></pre>\n"}], "owner": {"reputation": 44680, "user_id": 1031791, "user_type": "registered", "accept_rate": 54, "profile_image": "https://www.gravatar.com/avatar/fb710534fda446d2286074bb7692e65a?s=128&d=identicon&r=PG", "display_name": "MaiaVictor", "link": "https://stackoverflow.com/users/1031791/maiavictor"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 120, "favorite_count": 0, "answer_count": 1, "score": 3, "last_activity_date": 1468788975, "creation_date": 1468774157, "last_edit_date": 1468788975, "question_id": 38423611, "link": "https://stackoverflow.com/questions/38423611/general-approach-for-user-extensible-move-effects-on-turn-based-games", "title": "General approach for user-extensible move effects on turn-based games?", "body": "<p>A simple form of a turn-based game can be abstracted in a functional language as:</p>\n\n<pre><code>data Player \n  = PlayerA\n  | PlayerB\n  deriving Show\n\ndata Game state move = Game {\n  start :: state,\n  turn :: (move, move)\n    -&gt; state\n    -&gt; Either Player state}\n\nplay :: [(m, m)] -&gt; Game s m -&gt; Maybe Player\nplay moves game \n  = either Just (const Nothing) \n  $ foldr tick (Right (start game)) moves where\n    tick move (Right state) = turn game move state\n    tick move p = p\n</code></pre>\n\n<p>In that setting, a game has an initial state, a type of valid moves, and a function that computes the next state (or a winner) based on the move picked by each player on that turn. This definition is enough to create any kind of turn-based game - from something as simple as rock-paper-scissors, to a fully featured battle RPG. Here is a simple duel game:</p>\n\n<pre><code>data DuelMove = Punch | Guard | Rest\n\ndata DuelState = DuelState {\n  p1hp :: Int,\n  p2hp :: Int}\n  deriving Show\n\nduel :: Game DuelState DuelMove \nduel = Game start turn where\n\n  start = DuelState 4 4\n\n  turn (ma,mb) (DuelState p1 p2) \n    | p1 &lt;= 0 = Left PlayerB\n    | p2 &lt;= 0 = Left PlayerA\n    | otherwise = attack ma mb where\n      attack Punch Punch = Right (DuelState (p1-1) (p2-1))\n      attack Punch Guard = Right (DuelState (p1-2) (p2+0))\n      attack Punch  Rest = Right (DuelState (p1+0) (p2-2))\n      attack Guard Punch = Right (DuelState (p1+0) (p2-2))\n      attack Guard Guard = Right (DuelState (p1+0) (p2+0))\n      attack Guard  Rest = Right (DuelState (p1+0) (p2+2))\n      attack  Rest Punch = Right (DuelState (p1-2) (p2+0))\n      attack  Rest Guard = Right (DuelState (p1+0) (p2+2))\n      attack  Rest  Rest = Right (DuelState (p1+2) (p2+2))\n\nmain :: IO ()\nmain = print $ play moves duel where\n  moves = [\n    (Punch, Punch),\n    (Punch, Guard),\n    (Guard, Punch),\n    (Rest, Rest),\n    (Punch, Guard),\n    (Guard, Punch),\n    (Punch, Rest)]\n</code></pre>\n\n<p>There is a problem with that abstraction, though: adding new moves require editing the definition of the the types and, consequently, the source-code of <code>turn</code>. This is not sufficient if you want to allow your users to define their own moves. Is there any abstraction for similar turn-based games, which elegantly allow for new moves to be added without modifying the original code?</p>\n"}, {"tags": ["haskell", "ghc"], "answers": [{"tags": [], "owner": {"reputation": 21417, "user_id": 925978, "user_type": "registered", "accept_rate": 84, "profile_image": "https://www.gravatar.com/avatar/06e4467a5bd1538a92cefb20db07897a?s=128&d=identicon&r=PG&f=1", "display_name": "crockeea", "link": "https://stackoverflow.com/users/925978/crockeea"}, "is_accepted": true, "score": 5, "last_activity_date": 1468765449, "last_edit_date": 1495540735, "creation_date": 1468765449, "answer_id": 38422256, "question_id": 38422069, "link": "https://stackoverflow.com/questions/38422069/how-to-dump-the-result-of-loop-fusion-in-haskell/38422256#38422256", "title": "How to dump the result of loop fusion in Haskell?", "body": "<p>In general, you want to look at GHC Core. The primary option to see core output is to use the <code>-ddump-simpl</code> for GHC, described <a href=\"http://downloads.haskell.org/~ghc/latest/docs/html/users_guide/debugging.html#ghc-flag--ddump-simpl\" rel=\"nofollow noreferrer\">here</a>. There are also many flags to modify that output (to make it simpler), such as <code>-dsuppress-all</code>.</p>\n\n<p>Information on actually <em>reading</em> core can be found <a href=\"https://stackoverflow.com/questions/6121146/reading-ghc-core\">here</a>.</p>\n"}], "owner": {"reputation": 701, "user_id": 2028189, "user_type": "registered", "accept_rate": 71, "profile_image": "https://www.gravatar.com/avatar/c4ca5514c17ff9231cb37f60e6cd922c?s=128&d=identicon&r=PG", "display_name": "Kwang Yul Seo", "link": "https://stackoverflow.com/users/2028189/kwang-yul-seo"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 121, "favorite_count": 0, "accepted_answer_id": 38422256, "answer_count": 1, "score": 4, "last_activity_date": 1469115425, "creation_date": 1468764339, "last_edit_date": 1469115425, "question_id": 38422069, "link": "https://stackoverflow.com/questions/38422069/how-to-dump-the-result-of-loop-fusion-in-haskell", "title": "How to dump the result of loop fusion in Haskell?", "body": "<p>Section 2.3.1.1 \"A note on fusion\" of <a href=\"https://wiki.haskell.org/Numeric_Haskell:_A_Vector_Tutorial\" rel=\"nofollow\">Haskell Wiki's Numeric Haskell page</a> explains loop fusion by showing the optimised code as in the following:</p>\n\n<p>Before optimization:</p>\n\n<pre><code>import qualified Data.Vector as V\n\ntest :: V.Vector Int -&gt; Double\ntest = V.foldl (\\ a b -&gt; a * sqrt (fromIntegral b)) 0\n\ncreate :: Int -&gt; V.Vector Int\ncreate n = (V.enumFromTo 1 n)\n\nmain = print (test (create 1000000))\n</code></pre>\n\n<p>After optimization:</p>\n\n<pre><code>main_$s$wfoldlM_loop :: Int# -&gt; Double# -&gt; Double#\nmain_$s$wfoldlM_loop =\n  \\ (sc_sWA :: Int#) (sc1_sWB :: Double#) -&gt;\n    case &lt;=# sc_sWA 1000000 of _ {\n      False -&gt; sc1_sWB;\n      True -&gt;\n        main_$s$wfoldlM_loop\n          (+# sc_sWA 1)\n          (*##\n             sc1_sWB (sqrtDouble# (int2Double# sc_sWA)))\n    }\n</code></pre>\n\n<p>I am curious about how I can see the optimised code like this. The article mentioned <em>ghc-core tool</em>, but didn't show the specific command.</p>\n"}, {"tags": ["haskell", "exception-handling"], "answers": [{"comments": [{"owner": {"reputation": 4471, "user_id": 3858142, "user_type": "registered", "accept_rate": 46, "profile_image": "https://www.gravatar.com/avatar/4c27dead2edf0b6dc28833a694c42ba1?s=128&d=identicon&r=PG&f=1", "display_name": "sevo", "link": "https://stackoverflow.com/users/3858142/sevo"}, "edited": false, "score": 0, "creation_date": 1468765246, "post_id": 38421856, "comment_id": 64250730, "body": "Why then <code>main</code> does not have <code>IO a</code> type?"}, {"owner": {"reputation": 2831, "user_id": 183792, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/9ddcfbc6c31012fd25384f6301363347?s=128&d=identicon&r=PG&f=1", "display_name": "Michael", "link": "https://stackoverflow.com/users/183792/michael"}, "edited": false, "score": 3, "creation_date": 1468765669, "post_id": 38421856, "comment_id": 64250859, "body": "<code>main</code> can have <code>IO a</code> or <code>IO Int</code> as a type."}, {"owner": {"reputation": 44013, "user_id": 1477667, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/trgKM.jpg?s=128&g=1", "display_name": "dfeuer", "link": "https://stackoverflow.com/users/1477667/dfeuer"}, "reply_to_user": {"reputation": 4471, "user_id": 3858142, "user_type": "registered", "accept_rate": 46, "profile_image": "https://www.gravatar.com/avatar/4c27dead2edf0b6dc28833a694c42ba1?s=128&d=identicon&r=PG&f=1", "display_name": "sevo", "link": "https://stackoverflow.com/users/3858142/sevo"}, "edited": false, "score": 1, "creation_date": 1468791755, "post_id": 38421856, "comment_id": 64259031, "body": "@sevo, it&#39;s probably best to stick to the rule that <code>main</code> should have type <code>IO ()</code> if the program can exit by completing the main action, and type <code>IO a</code> or <code>IO Void</code> if the program only exits as the result of an uncaught exception or an explicit call to <code>exitWith</code> or similar. But <code>main</code> is allowed to have any <code>IO</code> type."}], "tags": [], "owner": {"reputation": 49959, "user_id": 866915, "user_type": "registered", "accept_rate": 70, "profile_image": "https://www.gravatar.com/avatar/09242131d6e17cbbe31e8547514da6e5?s=128&d=identicon&r=PG", "display_name": "ErikR", "link": "https://stackoverflow.com/users/866915/erikr"}, "is_accepted": true, "score": 7, "last_activity_date": 1468770244, "last_edit_date": 1468770244, "creation_date": 1468762866, "answer_id": 38421856, "question_id": 38421682, "link": "https://stackoverflow.com/questions/38421682/why-does-bracket-require-release-to-produce-result-that-is-ignored/38421856#38421856", "title": "Why does bracket require `release` to produce result that is ignored?", "body": "<p>I think you have it backwards - <code>bracket</code> will ignore the result of the release operation for you.</p>\n\n<p>If the signature of the release operation was <code>a -&gt; IO ()</code> then you would have to supply a function which always returned <code>()</code>. By making the signature <code>a -&gt; IO b</code> your release function can return anything since\nthe type variable <code>b</code> is not referenced anywhere else in the signature -i.e.\nit is totally unrelated to any of the other type variables.</p>\n"}], "owner": {"reputation": 4471, "user_id": 3858142, "user_type": "registered", "accept_rate": 46, "profile_image": "https://www.gravatar.com/avatar/4c27dead2edf0b6dc28833a694c42ba1?s=128&d=identicon&r=PG&f=1", "display_name": "sevo", "link": "https://stackoverflow.com/users/3858142/sevo"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 61, "favorite_count": 0, "accepted_answer_id": 38421856, "answer_count": 1, "score": 2, "last_activity_date": 1468770244, "creation_date": 1468761685, "last_edit_date": 1468763018, "question_id": 38421682, "link": "https://stackoverflow.com/questions/38421682/why-does-bracket-require-release-to-produce-result-that-is-ignored", "title": "Why does bracket require `release` to produce result that is ignored?", "body": "<pre><code>bracket\n        :: IO a         -- ^ computation to run first (\\\"acquire resource\\\")\n        -&gt; (a -&gt; IO b)  -- ^ computation to run last (\\\"release resource\\\")\n        -&gt; (a -&gt; IO c)  -- ^ computation to run in-between\n        -&gt; IO c         -- returns the value from the in-between computation\nbracket before after thing =\n  mask $ \\restore -&gt; do\n    a &lt;- before\n    r &lt;- restore (thing a) `onException` after a\n    _ &lt;- after a\n    return r\n</code></pre>\n\n<p>Is this related to some API design pattern or conventions ? Why not use the following part of signature?</p>\n\n<pre><code>        -&gt; (a -&gt; IO ())  -- ^ computation to run last (empty result)\n</code></pre>\n\n<p>or </p>\n\n<pre><code>        -&gt; (a -&gt; IO a)  -- ^ computation to run last (`a` cannot be ignored)\n</code></pre>\n"}, {"tags": ["haskell", "ghc", "servant", "phantom-types", "type-synonyms"], "comments": [{"owner": {"reputation": 19084, "user_id": 1482749, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/7ff9982206dde8c2bbb151a7305c00f3?s=128&d=identicon&r=PG", "display_name": "kosmikus", "link": "https://stackoverflow.com/users/1482749/kosmikus"}, "edited": false, "score": 4, "creation_date": 1468758317, "post_id": 38420499, "comment_id": 64248795, "body": "<code>TokenProtect</code> is a type synonym and does not use <code>auth</code> on the right hand side. If you expand the type synonym in the second line, you get <code>type instance AuthServerData (AuthProtect &quot;auth-token&quot;) = Id auth</code>, so <code>auth</code> on the right-hand side is effectively unbound."}, {"owner": {"reputation": 13807, "user_id": 2407038, "user_type": "registered", "accept_rate": 64, "profile_image": "https://www.gravatar.com/avatar/538f6f4a9aa43841841de7d8e8b169fc?s=128&d=identicon&r=PG&f=1", "display_name": "user2407038", "link": "https://stackoverflow.com/users/2407038/user2407038"}, "edited": false, "score": 1, "creation_date": 1468762048, "post_id": 38420499, "comment_id": 64249858, "body": "There&#39;s no way to tell how to &#39;fix&#39; this without having some broader context as to what this type family is trying to accomplish. You could e.g. add a parameter to <code>AuthServerData</code>: <code>type instance AuthServerData (AuthProtect &quot;auth-token&quot;) auth = Id auth</code>"}, {"owner": {"reputation": 24028, "user_id": 383200, "user_type": "registered", "accept_rate": 60, "profile_image": "https://www.gravatar.com/avatar/a9dc722f936cb1059adaae4fe39c07f0?s=128&d=identicon&r=PG", "display_name": "Carl", "link": "https://stackoverflow.com/users/383200/carl"}, "edited": false, "score": 2, "creation_date": 1468764938, "post_id": 38420499, "comment_id": 64250642, "body": "I&#39;m pretty sure the fix is using <code>newtype</code> instead of <code>type</code>."}, {"owner": {"reputation": 44013, "user_id": 1477667, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/trgKM.jpg?s=128&g=1", "display_name": "dfeuer", "link": "https://stackoverflow.com/users/1477667/dfeuer"}, "edited": false, "score": 0, "creation_date": 1469135163, "post_id": 38420499, "comment_id": 64425750, "body": "Type synonyms are <i>almost never</i> what you really want. Honestly, the only uses I find really convincing are higher-rank ones, as seen in <code>lens</code>. In most simple cases, the discipline required to make type synonyms helpful is just not worth the trouble."}], "answers": [{"tags": [], "owner": {"reputation": 25144, "user_id": 477476, "user_type": "registered", "accept_rate": 85, "profile_image": "https://i.stack.imgur.com/Qf4TT.png?s=128&g=1", "display_name": "Cactus", "link": "https://stackoverflow.com/users/477476/cactus"}, "is_accepted": false, "score": 0, "last_activity_date": 1469115291, "creation_date": 1469115291, "answer_id": 38508483, "question_id": 38420499, "link": "https://stackoverflow.com/questions/38420499/type-instance-and-phantom-type/38508483#38508483", "title": "Type instance and phantom type", "body": "<p>You'll need to turn <code>TokenProtect</code> into a <code>newtype</code> wrapper:</p>\n\n<pre><code>newtype TokenProtect auth = TokenProtect (AuthProtect \"auth-token\")\ntype instance AuthServerData (TokenProtect auth) = Id auth\n</code></pre>\n\n<p>The reason for that is that type synonyms are just that: synonyms; so your code is equivalent to writing</p>\n\n<pre><code>type instance AuthServerData (AuthProtect \"auth-token\") = Id auth\n</code></pre>\n\n<p>which of course refers to the unbound type variable <code>auth</code>. </p>\n"}, {"tags": [], "owner": {"reputation": 247, "user_id": 2104932, "user_type": "registered", "accept_rate": 80, "profile_image": "https://i.stack.imgur.com/bs98N.jpg?s=128&g=1", "display_name": "matchwood", "link": "https://stackoverflow.com/users/2104932/matchwood"}, "is_accepted": false, "score": 0, "last_activity_date": 1477580563, "last_edit_date": 1477580563, "creation_date": 1477580217, "answer_id": 40287910, "question_id": 38420499, "link": "https://stackoverflow.com/questions/38420499/type-instance-and-phantom-type/40287910#40287910", "title": "Type instance and phantom type", "body": "<p>I encountered the issue using Servant, and I think my use case was similar to the original questioner's. Basically I wanted AuthProtect to allow me to thread a type constrained by some type synonym provided by a class through to my handlers, like</p>\n\n<pre><code>class IsDatabase db where \n   type DatabaseAuthResult db :: *\ninstance IsDatabase MyDBType\n   type DatabaseAuthResult MyDBType = DBUser\n</code></pre>\n\n<p>Therefore needing something like the original poster's code:</p>\n\n<pre><code>type TokenProtect db = AuthProtect \"auth-token\"\ntype instance AuthServerData (TokenProtect db) = DatabaseAuthResult db\n</code></pre>\n\n<p>As far as I can work out, this is simply not possible within the structure of Servant's <a href=\"https://www.stackage.org/haddock/nightly-2016-10-25/servant-server-0.9.0.1/Servant-Server-Experimental-Auth.html#t:AuthHandler\" rel=\"nofollow\">general auth implementation</a>. Cactus' answer correctly says that you have to wrap the existential in a newtype, but that in itself will simply lead to a compilation error to do with Servant constraints, probably some issue with a <code>HasServer</code> instance.</p>\n\n<p>There is a general answer to this issue, however, which is simply to replicate Servant's <code>AuthProtect</code>, <code>AuthHandler</code> etc with your own implementation, and write your own version of HasServer for it.</p>\n\n<pre><code>-- import for all the internal servant stuff like addAuthCheck\nimport Servant.Server.Internal.RoutingApplication\n\ndata DBAuthProtect (tag :: k) db deriving (Typeable)\nnewtype DBAuthHandler r db result = DBAuthHandler {unDBAuthHandler :: r -&gt; Handler result}\n\ninstance ( HasServer api context\n         , HasContextEntry context (DBAuthHandler Request db (AuthServerData (DBAuthProtect tag db))))\n  =&gt; HasServer (DBAuthProtect tag db :&gt; api) context where\n  type ServerT (DBAuthProtect tag db :&gt; api) m = AuthServerData (DBAuthProtect tag db) -&gt; ServerT api m\n  route Proxy context subserver = \n    route (Proxy :: Proxy api) context (subserver `addAuthCheck` withRequest authCheck)\n      where \n       authHandler :: Request -&gt; Handler (AuthServerData (DBAuthProtect tag db))\n       authHandler = unDBAuthHandler (getContextEntry context)\n       authCheck :: Request -&gt; DelayedIO (AuthServerData (DBAuthProtect tag db))\n       authCheck = (&gt;&gt;= either delayedFailFatal return) . liftIO . runExceptT . authHandler\n</code></pre>\n\n<p>You can then use this similarly to <code>AuthProtect</code>, so something like</p>\n\n<pre><code>type TokenProtect db = DBAuthProtect \"auth-token\" db\ntype instance AuthServerData (TokenProtect db) = DatabaseAuthResult db\ntype ProtectedAPI db = \"private\" :&gt; TokenProtect db :&gt; Get [...]\ndbAuthHandler :: (IsDatabase db) =&gt; db -&gt; DBAuthHandler Request db (DatabaseAuthResult db)\ndbAuthHandler db = DBAuthHandler $ \\ req -&gt; do \n  -- req :: Request\n  -- ... do some work here and return a type (DatabaseAuthResult db), so for MyDBType you would return DBUser - you have both the db itself and the request to work with\n</code></pre>\n\n<p>Finally you put this all together by using Servant's <code>serveWithContext</code> and in the context you provide the handler partially applied</p>\n\n<pre><code>mkContext :: db -&gt; Context '[DBAuthHandler Request db (AuthServerData db)]\nmkContext db = dbAuthHandler db :. EmptyContext\n\nmain :: IO ()\nmain = do \n  db &lt;- getMyDBSomehow -- a concrete type, say MyDBType\n  let myApi = (Proxy :: Proxy (ProtectedAPI MyDBType))\n  serveWithContext myApi (mkContext db) handlers      \n</code></pre>\n\n<p>Basically the way this works is to thread a type variable through the various bits and pieces so you end up with an api parameterised by a db type (similarly for handlers), allowing you to use type synonyms in your api type and therefore in your handlers.</p>\n\n<p>If you are using a custom monad for your app you can improve on this pattern by using <code>enter</code> when running your authHandler (and add any context your app monad needs to the context you pass to you <code>serveWithContext</code>, but that is beyond the scope of this question...).</p>\n"}], "owner": {"reputation": 449, "user_id": 1422441, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/ffb37250909dac913e7ade723b670002?s=128&d=identicon&r=PG", "display_name": "lthms", "link": "https://stackoverflow.com/users/1422441/lthms"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 221, "favorite_count": 0, "answer_count": 2, "score": 0, "last_activity_date": 1477580563, "creation_date": 1468753251, "last_edit_date": 1469115307, "question_id": 38420499, "link": "https://stackoverflow.com/questions/38420499/type-instance-and-phantom-type", "title": "Type instance and phantom type", "body": "<p>I ran into a strange error, I cannot find a way to fix it. I\u2019m using servant and I am trying to build a generic authentication library (no backend by default, for instance).</p>\n\n<p>The code is the following:</p>\n\n<pre><code>type TokenProtect auth = AuthProtect \"auth-token\"\ntype instance AuthServerData (TokenProtect auth) = Id auth\n</code></pre>\n\n<p><code>Id</code> is another type family. The error message is the following.</p>\n\n<pre><code>    \u2022 Family instance purports to bind type variable \u2018auth\u2019\n        but the real LHS (expanding synonyms) is:\n          AuthServerData (AuthProtect \"auth-token\") = ...\n    \u2022 In the type instance declaration for \u2018AuthServerData\u2019\n</code></pre>\n\n<p>Do you know how I can fix this code?</p>\n"}, {"tags": ["windows", "haskell", "wxwidgets", "cabal-install", "wxhaskell"], "comments": [{"owner": {"reputation": 43759, "user_id": 1651941, "user_type": "registered", "accept_rate": 97, "profile_image": "https://www.gravatar.com/avatar/a513bc1fa519d2fcf5e4e0d9b5500101?s=128&d=identicon&r=PG", "display_name": "Sibi", "link": "https://stackoverflow.com/users/1651941/sibi"}, "edited": false, "score": 0, "creation_date": 1468750103, "post_id": 38419108, "comment_id": 64246788, "body": "Try following the instruction from here: <a href=\"https://github.com/wxHaskell/wxHaskell\" rel=\"nofollow noreferrer\">github.com/wxHaskell/wxHaskell</a> . It seems you need a lower version of Haskell platform according to the instructions specified there."}, {"owner": {"reputation": 5, "user_id": 6408404, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/91c9110e352dc2a56c99a787c531ffa0?s=128&d=identicon&r=PG&f=1", "display_name": "John Lion", "link": "https://stackoverflow.com/users/6408404/john-lion"}, "reply_to_user": {"reputation": 43759, "user_id": 1651941, "user_type": "registered", "accept_rate": 97, "profile_image": "https://www.gravatar.com/avatar/a513bc1fa519d2fcf5e4e0d9b5500101?s=128&d=identicon&r=PG", "display_name": "Sibi", "link": "https://stackoverflow.com/users/1651941/sibi"}, "edited": false, "score": 0, "creation_date": 1468760510, "post_id": 38419108, "comment_id": 64249423, "body": "@Sibi I tried that, didn&#39;t work tho. Now it says that it can&#39;t find a file while building wxc."}, {"owner": {"reputation": 43759, "user_id": 1651941, "user_type": "registered", "accept_rate": 97, "profile_image": "https://www.gravatar.com/avatar/a513bc1fa519d2fcf5e4e0d9b5500101?s=128&d=identicon&r=PG", "display_name": "Sibi", "link": "https://stackoverflow.com/users/1651941/sibi"}, "edited": false, "score": 0, "creation_date": 1468760711, "post_id": 38419108, "comment_id": 64249483, "body": "Can you update the question with exact error messages? That&#39;s how others can help you."}, {"owner": {"reputation": 21417, "user_id": 925978, "user_type": "registered", "accept_rate": 84, "profile_image": "https://www.gravatar.com/avatar/06e4467a5bd1538a92cefb20db07897a?s=128&d=identicon&r=PG&f=1", "display_name": "crockeea", "link": "https://stackoverflow.com/users/925978/crockeea"}, "edited": false, "score": 0, "creation_date": 1468766102, "post_id": 38419108, "comment_id": 64251017, "body": "You&#39;ll need to use the <code>-v3</code> option when building to get a better error message."}, {"owner": {"reputation": 5, "user_id": 6408404, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/91c9110e352dc2a56c99a787c531ffa0?s=128&d=identicon&r=PG&f=1", "display_name": "John Lion", "link": "https://stackoverflow.com/users/6408404/john-lion"}, "reply_to_user": {"reputation": 21417, "user_id": 925978, "user_type": "registered", "accept_rate": 84, "profile_image": "https://www.gravatar.com/avatar/06e4467a5bd1538a92cefb20db07897a?s=128&d=identicon&r=PG&f=1", "display_name": "crockeea", "link": "https://stackoverflow.com/users/925978/crockeea"}, "edited": false, "score": 0, "creation_date": 1468767531, "post_id": 38419108, "comment_id": 64251486, "body": "@Eric How do I do that with cabal-install?"}, {"owner": {"reputation": 5, "user_id": 6408404, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/91c9110e352dc2a56c99a787c531ffa0?s=128&d=identicon&r=PG&f=1", "display_name": "John Lion", "link": "https://stackoverflow.com/users/6408404/john-lion"}, "edited": false, "score": 0, "creation_date": 1468767842, "post_id": 38419108, "comment_id": 64251575, "body": "Could it be that I need an older version of cabal-install? My current version is 1.24.0.0"}, {"owner": {"reputation": 21417, "user_id": 925978, "user_type": "registered", "accept_rate": 84, "profile_image": "https://www.gravatar.com/avatar/06e4467a5bd1538a92cefb20db07897a?s=128&d=identicon&r=PG&f=1", "display_name": "crockeea", "link": "https://stackoverflow.com/users/925978/crockeea"}, "edited": false, "score": 0, "creation_date": 1468769986, "post_id": 38419108, "comment_id": 64252282, "body": "Run` cabal build -v3<code>. However, I just noticed the </code>Maybe.fromJust: Nothing`.  That&#39;s strange since you&#39;re getting a runtime error during the build."}, {"owner": {"reputation": 5, "user_id": 6408404, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/91c9110e352dc2a56c99a787c531ffa0?s=128&d=identicon&r=PG&f=1", "display_name": "John Lion", "link": "https://stackoverflow.com/users/6408404/john-lion"}, "edited": false, "score": 0, "creation_date": 1468772549, "post_id": 38419108, "comment_id": 64253144, "body": "I have installed some packages that are mentioned in extended log, but it still doesn&#39;t work. Why is cabal-install complaining about gcc?"}], "answers": [{"tags": [], "owner": {"reputation": 2667, "user_id": 325725, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/3db095f94749aaedfea12b927b13cf74?s=128&d=identicon&r=PG", "display_name": "Phyx", "link": "https://stackoverflow.com/users/325725/phyx"}, "is_accepted": false, "score": 0, "last_activity_date": 1470469142, "creation_date": 1470469142, "answer_id": 38801786, "question_id": 38419108, "link": "https://stackoverflow.com/questions/38419108/how-to-install-wxhaskell/38801786#38801786", "title": "How to install wxHaskell?", "body": "<p>From the log it seems that maybe <code>pkg-config</code> is missing. From the platform's built in msys2 run <code>pacman -S pkg-config</code> and install it, see if it works after that.</p>\n"}, {"tags": [], "owner": {"reputation": 46777, "user_id": 1100107, "user_type": "registered", "accept_rate": 80, "profile_image": "https://www.gravatar.com/avatar/8789d3da0b482bcd8e562bfdf3687c74?s=128&d=identicon&r=PG", "display_name": "St&#233;phane Laurent", "link": "https://stackoverflow.com/users/1100107/st%c3%a9phane-laurent"}, "is_accepted": false, "score": 0, "last_activity_date": 1495981392, "creation_date": 1495981392, "answer_id": 44228347, "question_id": 38419108, "link": "https://stackoverflow.com/questions/38419108/how-to-install-wxhaskell/44228347#44228347", "title": "How to install wxHaskell?", "body": "<p>I've installed it as follows.</p>\n\n<ul>\n<li><p>Download <a href=\"https://sourceforge.net/projects/wxhaskell/files/wxInstall/\" rel=\"nofollow noreferrer\">wxInstall-Achelanne-64-0.1.zip</a>, unzip, and set this folder as the current directory in a terminal</p></li>\n<li><p>Type</p></li>\n</ul>\n\n<p><code>\nSet WXWIN=%CD%\\wxWidgets\nSet WXCFG=gcc_dll\\mswu\nSet PATH=%CD%;%PATH%\ncabal unpack wxdirect\ncabal install ./wxdirect-xxx\n</code>\n(where <code>xxx</code> is e.g. <code>0.92.3</code>).</p>\n\n<ul>\n<li><p>Find the file <code>wxdirect.exe</code> and put it in the current directory.</p></li>\n<li><p>Rename the file <code>wxWdigets/include/wx/setup_redirect.h</code> to <code>wxWdigets/include/wx/setup.h</code></p></li>\n<li><p>Type </p></li>\n</ul>\n\n<p><code>\n    cabal unpack wxc\n    cabal install ./wxc-xxx\n</code></p>\n\n<ul>\n<li><p>Find the file <code>wxc.dll</code> and put it in the <code>DLLs</code> folder.</p></li>\n<li><p>Put the folders <code>DLLs</code> and <code>wxWidgets\\lib\\gcc_dll</code> in your search path.</p></li>\n<li><p>Now you can install <code>wxcore</code> and <code>wx</code>. </p></li>\n</ul>\n"}], "owner": {"reputation": 5, "user_id": 6408404, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/91c9110e352dc2a56c99a787c531ffa0?s=128&d=identicon&r=PG&f=1", "display_name": "John Lion", "link": "https://stackoverflow.com/users/6408404/john-lion"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 770, "favorite_count": 0, "answer_count": 2, "score": 0, "last_activity_date": 1495981392, "creation_date": 1468742359, "last_edit_date": 1468772238, "question_id": 38419108, "link": "https://stackoverflow.com/questions/38419108/how-to-install-wxhaskell", "title": "How to install wxHaskell?", "body": "<p>I have downloaded the latest Haskell Platform(8.0.1 version) for Windows 7, wxWidgets-3.0.2, set all the needed environment variables. I have successfully installed \"wxdirect\" using \"cabal install\", but when I try to install \"wxc\" it fails. Install logs:</p>\n\n<pre><code>C:\\wxWidgets-3.0.2\\lib\\gcc_dll\\mswud\\..: getDirectoryContents: does not exist\n(The system cannot find the path specified.)\ncabal: Leaving directory '.'\n</code></pre>\n\n<p>Where do I need to get that \"gcc_dll\\mswud\\\" folder?</p>\n\n<p>P.S Neither Abriline nor Achelanne works for me for some reason.</p>\n\n<p>P.P.S I tried to install this library following Haskell-wiki instructions, but it didn't work complaining about a ton of dependencies.</p>\n\n<p><strong><em>UPDATE</em></strong>\nI tried installing the wxHaskell using Haskell Platform 2014.2.0.0 with Abriline installer. It stopped on building wxc. Logs:</p>\n\n<pre><code>Building wxc\nsetup.exe: Maybe.fromJust: Nothing\n 1] Compiling Main             ( wxc-0.92.2.0\\dist\\setup\\setup.hs,     wxc-0.92.2.0\\dist\\setup\\Main.o )\nLinking .\\wxc-0.92.2.0\\dist\\setup\\setup.exe ...\nThe bitness is correct\nConfiguring wxc-0.92.2.0...\nConfiguring wxc to build against wxWidgets 3.0.2\ncabal: Leaving directory '.\\wxc-0.92.2.0'\n</code></pre>\n\n<p><strong><em>UPDATE</em></strong>\nExtended logs with \"cabal install wxc -v3\":\n<a href=\"http://rgho.st/7BJcHzJTF\" rel=\"nofollow\">http://rgho.st/7BJcHzJTF</a></p>\n"}, {"tags": ["haskell", "tuples", "monads"], "comments": [{"owner": {"reputation": 2831, "user_id": 183792, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/9ddcfbc6c31012fd25384f6301363347?s=128&d=identicon&r=PG&f=1", "display_name": "Michael", "link": "https://stackoverflow.com/users/183792/michael"}, "edited": false, "score": 6, "creation_date": 1468701957, "post_id": 38415374, "comment_id": 64238270, "body": "I guess it&#39;s new with <code>ghc-8.1</code> - <code>ghci</code> says <code>instance Monoid a =&gt; Monad ((,) a) -- Defined in \u2018GHC.Base\u2019</code>"}, {"owner": {"reputation": 7030, "user_id": 3032349, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/3cd8d19756aa9bc73d8045ae988ae728?s=128&d=identicon&r=PG&f=1", "display_name": "ThreeFx", "link": "https://stackoverflow.com/users/3032349/threefx"}, "edited": false, "score": 0, "creation_date": 1468703593, "post_id": 38415374, "comment_id": 64238660, "body": "A wild guess: because it isn&#39;t general enough? It may be the reason why <code>Set</code> doesn&#39;t have one..."}, {"owner": {"reputation": 75362, "user_id": 625403, "user_type": "registered", "accept_rate": 82, "profile_image": "https://www.gravatar.com/avatar/786eed7da67079cb5d63a49d469af25b?s=128&d=identicon&r=PG", "display_name": "amalloy", "link": "https://stackoverflow.com/users/625403/amalloy"}, "edited": false, "score": 1, "creation_date": 1468705386, "post_id": 38415374, "comment_id": 64239068, "body": "<code>Set</code> has no monad instance because no instance can exist that satisfies the monad laws. The proposed instance fo <code>((,) a)</code> is law-abiding, and I think is the only possible law-abiding instance, so it makes sense to create it."}, {"owner": {"reputation": 7030, "user_id": 3032349, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/3cd8d19756aa9bc73d8045ae988ae728?s=128&d=identicon&r=PG&f=1", "display_name": "ThreeFx", "link": "https://stackoverflow.com/users/3032349/threefx"}, "edited": false, "score": 0, "creation_date": 1468706204, "post_id": 38415374, "comment_id": 64239243, "body": "Don&#39;t instances have to be as general as possible? I cannot seem to think of another data type which needs constraints, which is why it seems like a too restrictive instance IMO"}, {"owner": {"reputation": 81794, "user_id": 9859, "user_type": "registered", "accept_rate": 89, "profile_image": "https://i.stack.imgur.com/KEZOL.jpg?s=128&g=1", "display_name": "rampion", "link": "https://stackoverflow.com/users/9859/rampion"}, "edited": false, "score": 3, "creation_date": 1468706314, "post_id": 38415374, "comment_id": 64239257, "body": "I&#39;ve usually just used <a href=\"http://learnyouahaskell.com/for-a-few-monads-more\" rel=\"nofollow noreferrer\">the Writer Monad</a> instead..."}, {"owner": {"reputation": 10378, "user_id": 2476735, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/39e9447bbc32246fcd23b76b5e946618?s=128&d=identicon&r=PG&f=1", "display_name": "David Young", "link": "https://stackoverflow.com/users/2476735/david-young"}, "reply_to_user": {"reputation": 7030, "user_id": 3032349, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/3cd8d19756aa9bc73d8045ae988ae728?s=128&d=identicon&r=PG&f=1", "display_name": "ThreeFx", "link": "https://stackoverflow.com/users/3032349/threefx"}, "edited": false, "score": 2, "creation_date": 1468707406, "post_id": 38415374, "comment_id": 64239441, "body": "@ThreeFx This is as general as possible. Also, not having the instance at all would be even more restrictive. And, as Michael mentioned, this instance already exists in the latest stable version of GHC."}, {"owner": {"reputation": 2313, "user_id": 1513295, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/bc00550a36e3d751bee5e0027f929cbf?s=128&d=identicon&r=PG", "display_name": "semicolon", "link": "https://stackoverflow.com/users/1513295/semicolon"}, "reply_to_user": {"reputation": 7030, "user_id": 3032349, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/3cd8d19756aa9bc73d8045ae988ae728?s=128&d=identicon&r=PG&f=1", "display_name": "ThreeFx", "link": "https://stackoverflow.com/users/3032349/threefx"}, "edited": false, "score": 0, "creation_date": 1468725728, "post_id": 38415374, "comment_id": 64242091, "body": "@ThreeFx How in the world is this instance more restrictive than not having an instance seeing as it is the only possible law abiding instance. Also I mentioned another data type that needs constraints at the very beginning of my question: <code>instance Monoid a =&gt; Applicative ((,) a)</code>."}], "answers": [{"comments": [{"owner": {"reputation": 21417, "user_id": 925978, "user_type": "registered", "accept_rate": 84, "profile_image": "https://www.gravatar.com/avatar/06e4467a5bd1538a92cefb20db07897a?s=128&d=identicon&r=PG&f=1", "display_name": "crockeea", "link": "https://stackoverflow.com/users/925978/crockeea"}, "edited": false, "score": 1, "creation_date": 1468767070, "post_id": 38418419, "comment_id": 64251342, "body": "<code>8.1</code> is not yet out; he meant <code>8.0.1</code>. The instance can be found <a href=\"https://hackage.haskell.org/package/base-4.9.0.0/docs/Control-Monad.html#control.i:ic:Monad:Monad:25\" rel=\"nofollow noreferrer\">here</a>."}], "tags": [], "owner": {"reputation": 2313, "user_id": 1513295, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/bc00550a36e3d751bee5e0027f929cbf?s=128&d=identicon&r=PG", "display_name": "semicolon", "link": "https://stackoverflow.com/users/1513295/semicolon"}, "is_accepted": true, "score": 2, "last_activity_date": 1468796067, "last_edit_date": 1468796067, "creation_date": 1468735626, "answer_id": 38418419, "question_id": 38415374, "link": "https://stackoverflow.com/questions/38415374/why-does-tuple-not-have-a-monad-instance/38418419#38418419", "title": "Why does Tuple not have a Monad instance?", "body": "<p>Well it seems like the answer to this question is that I just have to use <code>ghc-8.0.1</code>, which does give <code>Tuple</code> a <code>Monad</code> instance. Credit to @Michael for pointing this out.</p>\n"}], "owner": {"reputation": 2313, "user_id": 1513295, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/bc00550a36e3d751bee5e0027f929cbf?s=128&d=identicon&r=PG", "display_name": "semicolon", "link": "https://stackoverflow.com/users/1513295/semicolon"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 1946, "favorite_count": 1, "accepted_answer_id": 38418419, "answer_count": 1, "score": 9, "last_activity_date": 1468796067, "creation_date": 1468701200, "question_id": 38415374, "link": "https://stackoverflow.com/questions/38415374/why-does-tuple-not-have-a-monad-instance", "title": "Why does Tuple not have a Monad instance?", "body": "<p>One thing I noticed was that <code>Tuple</code> does not have a <code>Monad</code> instance.</p>\n\n<p>Tuple does however have an <code>Applicative</code> instance:</p>\n\n<pre><code>instance Monoid a =&gt; Applicative ((,) a)\n</code></pre>\n\n<p>Which already extremely heavily restricts what we can make the <code>Monad</code> instance be.</p>\n\n<p>Lets look at the type signature we would get for join:</p>\n\n<pre><code>instance Monoid a =&gt; Monad ((,) a)\n\njoin :: Monad m =&gt; m (m a) -&gt; m a\n\njoin :: Monoid a =&gt; (a, (a, b)) -&gt; (a, b)\n</code></pre>\n\n<p>We can also look at the Monad laws:</p>\n\n<pre><code>join $ f &lt;$&gt; pure x == f x\njoin $ f &lt;$&gt; (mempty, x) == f x\njoin (mempty, f x) == f x\njoin (mempty, (a, b)) == (a, b)\n\njoin $ pure &lt;$&gt; x = x\njoin $ pure &lt;$&gt; (a, b) = (a, b)\njoin (a, (mempty, b)) = (a, b)\n</code></pre>\n\n<p>At this point we know that combining <code>mempty</code> and <code>x</code> in either way results in <code>x</code>. And the only type information we have about <code>x</code> is that it is a <code>Monoid</code>. So basically the only two implementations are:</p>\n\n<pre><code>join (a, (b, x)) = (a &lt;&gt; b, x)\n</code></pre>\n\n<p>and:</p>\n\n<pre><code>join (a, (b, x)) = (b &lt;&gt; a, x)\n</code></pre>\n\n<p>And the second one of those makes <code>ap</code> and <code>&lt;*&gt;</code> not the same.</p>\n\n<p>So now we know that the only valid <code>Monad</code> instance for <code>((,) a)</code> is:</p>\n\n<pre><code>instance Monoid a =&gt; Monad ((,) a) where\n    (a, c) &gt;&gt;= f = let (b, c') = f c in (a &lt;&gt; b, c')\n</code></pre>\n\n<p>So why is that not currently the case?</p>\n"}, {"tags": ["haskell"], "comments": [{"owner": {"reputation": 27561, "user_id": 214446, "user_type": "registered", "accept_rate": 74, "profile_image": "https://www.gravatar.com/avatar/5deb6b87326686b1f2e9fdb37ceac210?s=128&d=identicon&r=PG", "display_name": "mb21", "link": "https://stackoverflow.com/users/214446/mb21"}, "edited": false, "score": 0, "creation_date": 1468689901, "post_id": 38413532, "comment_id": 64235125, "body": "I can recommend <a href=\"http://learnyouahaskell.com/for-a-few-monads-more#state\" rel=\"nofollow noreferrer\">learnyouahaskell.com/for-a-few-monads-more#state</a>"}], "answers": [{"comments": [{"owner": {"reputation": 1995, "user_id": 713861, "user_type": "registered", "accept_rate": 72, "profile_image": "https://www.gravatar.com/avatar/1ed73350b722bb9ea9d5a8720a1af4f3?s=128&d=identicon&r=PG", "display_name": "GreenSaguaro", "link": "https://stackoverflow.com/users/713861/greensaguaro"}, "edited": false, "score": 0, "creation_date": 1468691141, "post_id": 38413717, "comment_id": 64235453, "body": "What I am looking for is the low level mechanics of how is does the implicit mutable state/variable"}, {"owner": {"reputation": 100185, "user_id": 3234959, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/93bb12ca0f93dfddb33880316f7e66c2?s=128&d=identicon&r=PG&f=1", "display_name": "chi", "link": "https://stackoverflow.com/users/3234959/chi"}, "reply_to_user": {"reputation": 1995, "user_id": 713861, "user_type": "registered", "accept_rate": 72, "profile_image": "https://www.gravatar.com/avatar/1ed73350b722bb9ea9d5a8720a1af4f3?s=128&d=identicon&r=PG", "display_name": "GreenSaguaro", "link": "https://stackoverflow.com/users/713861/greensaguaro"}, "edited": false, "score": 0, "creation_date": 1468699170, "post_id": 38413717, "comment_id": 64237560, "body": "There are tutorials that explain that. The link above by @mb21 does as well, did you read that?"}, {"owner": {"reputation": 1995, "user_id": 713861, "user_type": "registered", "accept_rate": 72, "profile_image": "https://www.gravatar.com/avatar/1ed73350b722bb9ea9d5a8720a1af4f3?s=128&d=identicon&r=PG", "display_name": "GreenSaguaro", "link": "https://stackoverflow.com/users/713861/greensaguaro"}, "edited": false, "score": 0, "creation_date": 1468774920, "post_id": 38413717, "comment_id": 64253944, "body": "I will check it out. Thank you."}], "tags": [], "owner": {"reputation": 100185, "user_id": 3234959, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/93bb12ca0f93dfddb33880316f7e66c2?s=128&d=identicon&r=PG&f=1", "display_name": "chi", "link": "https://stackoverflow.com/users/3234959/chi"}, "is_accepted": false, "score": 2, "last_activity_date": 1468689850, "creation_date": 1468689850, "answer_id": 38413717, "question_id": 38413532, "link": "https://stackoverflow.com/questions/38413532/having-trouble-to-understand-monadstate-put-with-return/38413717#38413717", "title": "Having trouble to understand MonadState put with return", "body": "<p>The state monad models an implicit mutable state/variable. <code>put 10</code> writes 10 in the variable and returns a dummy value <code>()</code>. Then <code>... &gt;&gt; return 5</code> discards the <code>()</code> and returns <code>5</code>.</p>\n\n<p>You can spot this from its type:</p>\n\n<pre><code>put :: s -&gt; State s ()\n                 -- ^ -- the type of the returned value\n</code></pre>\n\n<p>So, the whole monadic computation <code>put 10 &gt;&gt; return 5</code> modifies the internal variable to 10, but returns 5. </p>\n\n<p>Finally, <code>runState (...) 9</code> provides <code>9</code> as an initial value for the implicit variable (which will be immediately overwritten), runs the computation, and then\nextracts both the variable and the returned value, building a pair with these.</p>\n"}, {"tags": [], "owner": {"reputation": 4565, "user_id": 1134885, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/7c428466054762cf7d4b5fb5f4396fa2?s=128&d=identicon&r=PG", "display_name": "NovaDenizen", "link": "https://stackoverflow.com/users/1134885/novadenizen"}, "is_accepted": false, "score": 2, "last_activity_date": 1468690112, "creation_date": 1468690112, "answer_id": 38413764, "question_id": 38413532, "link": "https://stackoverflow.com/questions/38413532/having-trouble-to-understand-monadstate-put-with-return/38413764#38413764", "title": "Having trouble to understand MonadState put with return", "body": "<p>The way to think of it is that <code>runState (put 10 &gt;&gt; return 5) 9</code> First takes <code>9</code> and holds it in the state variable.  Then it starts to perform the monadic computation.  </p>\n\n<p><code>put 10</code> replaces the state (which is currently <code>9</code>) with <code>10</code>.  Then <code>return 5</code> causes the output of the monadic computation to be <code>5</code>.  </p>\n\n<p><code>runState</code> takes a monadic computation and an initial state value as parameters.  Then it runs the monadic computation, then it returns the result of the computation alongside the final value of the state variable.</p>\n"}, {"tags": [], "owner": {"reputation": 10378, "user_id": 2476735, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/39e9447bbc32246fcd23b76b5e946618?s=128&d=identicon&r=PG&f=1", "display_name": "David Young", "link": "https://stackoverflow.com/users/2476735/david-young"}, "is_accepted": true, "score": 5, "last_activity_date": 1468713560, "last_edit_date": 1468713560, "creation_date": 1468705282, "answer_id": 38415901, "question_id": 38413532, "link": "https://stackoverflow.com/questions/38413532/having-trouble-to-understand-monadstate-put-with-return/38415901#38415901", "title": "Having trouble to understand MonadState put with return", "body": "<p><code>State s a</code> is ultimately just a wrapper around the function <code>s -&gt; (a, s)</code>\nso, for the purposes of learning, it might be easier to just consider this\nfunction directly, without the extra wrapping. We can also define a type synonym\nthat could make it easier to read. I will show the type sigatures without\nit first, then with it.</p>\n\n<p>We have the monad definition (with renamed functions):</p>\n\n<pre><code>sReturn :: a -&gt; (s -&gt; (a, s))\nsReturn x = \\s -&gt; (x, s)\n\n(+&gt;&gt;=) :: (s -&gt; (a, s)) -&gt; (a -&gt;   (s -&gt; (b, s))) -&gt;   (s -&gt; (b, s))\nf +&gt;&gt;= g = \\s1 -&gt;\n  let (a, s2) = f s1\n      (b, s3) = (g a) s2\n  in (b, s3)\n\n(+&gt;&gt;) :: (s -&gt; (a, s)) -&gt; (s -&gt; (b, s)) -&gt; (s -&gt; (b, s))\nf +&gt;&gt; g = f +&gt;&gt;= (\\_ -&gt; g)\n</code></pre>\n\n<p>We can also define the State-specific functions:</p>\n\n<pre><code>putS :: s -&gt; (s -&gt; ((), s))\nputS newState = \\s -&gt; ((), newState)\n\ngetS :: s -&gt; (s, s)\ngetS = \\s -&gt; (s, s)\n\nrunS :: (s -&gt; (a, s)) -&gt; s -&gt; (a, s)\nrunS f s = f s\n</code></pre>\n\n<p>Note, I've included some extra parentheses and some things that are technically\nunnecessary, but will hopefully clarify things.</p>\n\n<p>Anywhere you see something like <code>(s -&gt; (a, s))</code>, you can replace it with\n<code>State s a</code> in the above code, using this type synonym:</p>\n\n<pre><code>type State s a = s -&gt; (a, s)\n</code></pre>\n\n<p>Making that replacement, we get the signatures:</p>\n\n<pre><code>sReturn :: a -&gt; State s a\n(+&gt;&gt;=)  :: State s a -&gt; (a -&gt; State s b) -&gt; State s b\n(+&gt;&gt;)   :: State s a -&gt; State s b -&gt; State s b\n\nputS    :: s -&gt; State s ()\ngetS    :: State s s\nrunS    :: State s a -&gt; s -&gt; (a, s)\n</code></pre>\n\n<p>Now, if we translate your example, we can follow the steps of the reduction:</p>\n\n<pre><code>runS ( putS 10 +&gt;&gt; sReturn 5 ) 9           -- The initial expression\nrunS ( putS 10 +&gt;&gt;= (\\_ -&gt; sReturn 5) ) 9  -- Apply (+&gt;&gt;)\nrunS ( \\s1 -&gt;                              -- Apply (+&gt;&gt;=)\n       let (a, s2) = (putS 10) s1\n           (b, s3) = ((\\_ -&gt; sReturn 5) a) s2\n       in (b, s3) )\n     9\nrunS ( \\s1 -&gt;\n       let (a, s2) = (putS 10) s1\n           (b, s3) = (sReturn 5) s2         -- Reduce lambda application\n       in (b, s3) )\n     9\nrunS ( \\s1 -&gt;\n       let (a, s2) = (\\s -&gt; ((), 10)) s1    -- Apply putS\n           (b, s3) = (sReturn 5) s2\n       in (b, s3) )\n     9\nrunS ( \\s1 -&gt;\n       let (a, s2) = ((), 10)               -- Reduce lambda application\n           (b, s3) = (sReturn 5) s2\n       in (b, s3) )\n     9\nrunS ( \\s1 -&gt;\n       let (b, s3) = (sReturn 5) 10         -- Substitute for s2 (a is not needed)\n       in (b, s3) )\n     9\nrunS ( \\s1 -&gt;\n       let (b, s3) = (\\s -&gt; (5, s)) 10      -- Apply sReturn\n       in (b, s3) )\n     9\nrunS ( \\s1 -&gt;\n       let (b, s3) = (5, 10)                -- Reduce lambda application\n       in (b, s3) )\n     9\nrunS ( \\s1 -&gt; (5, 10) ) 9                   -- Substitute for (b, s3)\n(\\s1 -&gt; (5, 10)) 9                          -- Apply runS\n(5, 10)                                     -- Reduce lambda application\n</code></pre>\n\n<p>I highly recommend trying to do this kind of step-by-step reduction when trying to learn a new Haskell abstraction like <code>State</code>. That might seem like a lot of steps to go through each time but, as you work\nwith the abstraction more, you develop an intuition that makes easy to figure out\nwithout having to write out the steps.</p>\n\n<p>Part of the intuition for State is that a stateful, or state-dependent, value is a function from a state value to a pair containing the state-dependent value and a new state value. This allows it to both take in a new state and change its value appropriately and give back a new modified state. The <code>State</code> monad methods do the threading of these state values automatically.</p>\n\n<p>Also, the real <code>State</code> is just a wrapper around the function type we used above. As a result, the only difference between what we have done here and the way it is \"actually\" done is that we have merely omitted the wrapping and unwrapping of the function value inside <code>State</code>.</p>\n"}], "owner": {"reputation": 1995, "user_id": 713861, "user_type": "registered", "accept_rate": 72, "profile_image": "https://www.gravatar.com/avatar/1ed73350b722bb9ea9d5a8720a1af4f3?s=128&d=identicon&r=PG", "display_name": "GreenSaguaro", "link": "https://stackoverflow.com/users/713861/greensaguaro"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 87, "favorite_count": 0, "accepted_answer_id": 38415901, "answer_count": 3, "score": 0, "last_activity_date": 1468713560, "creation_date": 1468688556, "question_id": 38413532, "link": "https://stackoverflow.com/questions/38413532/having-trouble-to-understand-monadstate-put-with-return", "title": "Having trouble to understand MonadState put with return", "body": "<p>In the following code, I get the expected result:</p>\n\n<pre><code>Prelude Control.Monad.State&gt; runState ( put 10 &gt;&gt; return 5 ) 9\n(5,10)\n</code></pre>\n\n<p>But what really baffles me is how precisely the value given to <code>put</code> is available to <code>return</code> and ends up in the final result, or how exactly the value is hidden and taken out later. I have sought out many tutorials on state in Haskell, but I have not yet found an explanation that really, really breaks it down in a way that is not high level.</p>\n\n<p>My understanding of <code>&gt;&gt;</code> is that the value on the left will be dropped, so this adds to my confusion of how the value for <code>put</code> is passed along.</p>\n\n<p>Thanks in advance for help in understanding this.</p>\n"}, {"tags": ["haskell", "recursion"], "comments": [{"owner": {"reputation": 84731, "user_id": 510937, "user_type": "registered", "accept_rate": 80, "profile_image": "https://www.gravatar.com/avatar/70b13a9ae1aae1ca1aa6ac8dab4643f2?s=128&d=identicon&r=PG", "display_name": "Bakuriu", "link": "https://stackoverflow.com/users/510937/bakuriu"}, "edited": false, "score": 1, "creation_date": 1468764079, "post_id": 38413219, "comment_id": 64250425, "body": "Note: the compiler isn&#39;t able to use any property of your generic recursive definition. However the compiler knows how to treat <code>foldr</code> via rewriting rules, which means that defining functions via <code>foldr</code> allows the compiler to optimize the code more."}], "answers": [{"tags": [], "owner": {"reputation": 100185, "user_id": 3234959, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/93bb12ca0f93dfddb33880316f7e66c2?s=128&d=identicon&r=PG&f=1", "display_name": "chi", "link": "https://stackoverflow.com/users/3234959/chi"}, "is_accepted": false, "score": 3, "last_activity_date": 1468687224, "creation_date": 1468687224, "answer_id": 38413309, "question_id": 38413219, "link": "https://stackoverflow.com/questions/38413219/is-using-fold-less-efficient-than-standard-recursion/38413309#38413309", "title": "Is using fold less efficient than standard recursion", "body": "<blockquote>\n  <p>If I understand the foldr implementation correctly, it will iterate over the entire list every time, even if it matched the first element it came across.</p>\n</blockquote>\n\n<p>This is wrong. <code>foldr</code> will evaluate the list only as much as needed.</p>\n\n<p>E.g.</p>\n\n<pre><code>foldr (&amp;&amp;) True [True, False, error \"unreached code here\"]\n</code></pre>\n\n<p>returns <code>False</code> since the error is never evaluated, precisely as in</p>\n\n<pre><code>(True &amp;&amp; (False &amp;&amp; (error \"unreached code here\" &amp;&amp; True)))\n</code></pre>\n\n<p>Indeed, since the end of the list is never reached, we can also write</p>\n\n<pre><code>foldr (&amp;&amp;) (error \"end\") [True, False, error \"unreached code here\"]\n</code></pre>\n\n<p>and still obtain <code>False</code>.</p>\n"}, {"comments": [{"owner": {"reputation": 7264, "user_id": 146452, "user_type": "registered", "accept_rate": 92, "profile_image": "https://www.gravatar.com/avatar/55e2e2dbef238cbc9d9a3b914b9a65a5?s=128&d=identicon&r=PG", "display_name": "mclark1129", "link": "https://stackoverflow.com/users/146452/mclark1129"}, "edited": false, "score": 0, "creation_date": 1468690756, "post_id": 38413324, "comment_id": 64235356, "body": "I&#39;ll need to keep staring at this for awhile until it sinks in, but I think I get what you mean about the recursion being built into <code>acc</code>.  Thanks!"}], "tags": [], "owner": {"reputation": 78982, "user_id": 1848654, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/84180c0f3c9c04f8b8f0613fc0129dac?s=128&d=identicon&r=PG", "display_name": "melpomene", "link": "https://stackoverflow.com/users/1848654/melpomene"}, "is_accepted": true, "score": 13, "last_activity_date": 1468687636, "last_edit_date": 1468687636, "creation_date": 1468687291, "answer_id": 38413324, "question_id": 38413219, "link": "https://stackoverflow.com/questions/38413219/is-using-fold-less-efficient-than-standard-recursion/38413324#38413324", "title": "Is using fold less efficient than standard recursion", "body": "<ol>\n<li><p><code>foldr</code> is written using standard recursion.</p></li>\n<li><p>The recursive call to <code>foldr</code> is hidden inside of <code>acc</code>. If your code doesn't use <code>acc</code>, it will never be computed (because Haskell is lazy). So the <code>foldr</code> version is efficient and will also return early.</p></li>\n</ol>\n\n<p>Here's an example demonstrating this:</p>\n\n<pre><code>Prelude&gt; foldr (\\x z -&gt; \"done\") \"acc\" [0 ..]\n\"done\"\n</code></pre>\n\n<p>This expression returns <code>\"done\"</code> immediately, even though the input list is infinitely long.</p>\n\n<hr>\n\n<p>If <code>foldr</code> is defined as:</p>\n\n<pre><code>foldr f z (x : xs) = f x (foldr f z xs)\nfoldr _ z [] = z\n</code></pre>\n\n<p>, then evaluation goes via</p>\n\n<pre><code>f x (foldr f z xs)\n    where\n    f = \\x z -&gt; \"done\"\n    x = 0\n    z = \"acc\"\n    xs = ...  -- unevaluated, but is [1 ..]\n</code></pre>\n\n<p>which is</p>\n\n<pre><code>(\\x z -&gt; \"done\") 0 (foldr (\\x z -&gt; \"done\") \"acc\" [1 ..])\n</code></pre>\n\n<p>which turns into <code>\"done\"</code> because the first function doesn't use <code>z</code>, so the recursive call is never needed.</p>\n"}, {"tags": [], "owner": {"reputation": 49959, "user_id": 866915, "user_type": "registered", "accept_rate": 70, "profile_image": "https://www.gravatar.com/avatar/09242131d6e17cbbe31e8547514da6e5?s=128&d=identicon&r=PG", "display_name": "ErikR", "link": "https://stackoverflow.com/users/866915/erikr"}, "is_accepted": false, "score": 3, "last_activity_date": 1468687502, "creation_date": 1468687502, "answer_id": 38413359, "question_id": 38413219, "link": "https://stackoverflow.com/questions/38413219/is-using-fold-less-efficient-than-standard-recursion/38413359#38413359", "title": "Is using fold less efficient than standard recursion", "body": "<p>Here is code which demonstrates that <code>foldr</code> does indeed \"short-circuit\" the evaluation of <code>findKey</code>:</p>\n\n<pre><code>import Debug.Trace\n\nfindKey :: (Eq k) =&gt; k -&gt; [(k,v)] -&gt; Maybe v  \nfindKey key = foldr (\\(k,v) acc -&gt; if key == k then Just v else acc) Nothing  \n\ntr x = trace msg x\n  where msg = \"=== at: \" ++ show x\n\nthelist = [ tr (1,'a'), tr (2,'b'), tr (3, 'c'), tr (4, 'd') ]\n</code></pre>\n\n<p>An example of running <code>findKey</code> in ghci:</p>\n\n<pre><code>*Main&gt; findKey 2 thelist\n=== at: (1,'a')\n=== at: (2,'b')\nJust 'b'\n*Main&gt;\n</code></pre>\n"}, {"tags": [], "owner": {"reputation": 7618, "user_id": 1509744, "user_type": "registered", "accept_rate": 81, "profile_image": "https://www.gravatar.com/avatar/1f661ea35aa6e2858e56717c813c8280?s=128&d=identicon&r=PG&f=1", "display_name": "gen", "link": "https://stackoverflow.com/users/1509744/gen"}, "is_accepted": false, "score": 2, "last_activity_date": 1468690708, "last_edit_date": 1468690708, "creation_date": 1468688445, "answer_id": 38413513, "question_id": 38413219, "link": "https://stackoverflow.com/questions/38413219/is-using-fold-less-efficient-than-standard-recursion/38413513#38413513", "title": "Is using fold less efficient than standard recursion", "body": "<p>Think of foldr using the following definition (using standard recursion):</p>\n\n<pre><code>foldr :: (a -&gt; b -&gt; b) -&gt; b -&gt; [a] -&gt; b\nfoldr f e [] = e\nfoldr f e (x:xs) = f x (foldr f e xs)\n</code></pre>\n\n<p>The third line shows that the second implementation for findKey will return upon finding the first match. </p>\n\n<hr>\n\n<p>As a sidenote: assume you had the following definition (which does not have identical functionality) for findKey (as an exercise you might want to rewrite the definition using foldr):</p>\n\n<pre><code>findKey :: (Eq k) =&gt; k -&gt; [(k,v)] -&gt; [v]\nfindKey key [] = []\nfindKey key ((kHead, vHead):rest) = if (key == kHead) then vHead:(findKey key rest) else findKey key rest\n</code></pre>\n\n<p>Now you might think that this would iterate through the whole input list. Depending on how you invoke this function, it could be the case that it iterates through the whole list, but at the same time this can give you the first match efficiently too. Due to Haskell's lazy evaluation the following code:</p>\n\n<pre><code>head (findKey key li)\n</code></pre>\n\n<p>will give you the first match (assuming that there's one) with the same efficiency as your first example.</p>\n"}, {"tags": [], "owner": {"reputation": 61419, "user_id": 849891, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/MbEO3.png?s=128&g=1", "display_name": "Will Ness", "link": "https://stackoverflow.com/users/849891/will-ness"}, "is_accepted": false, "score": 2, "last_activity_date": 1468705797, "last_edit_date": 1468705797, "creation_date": 1468696199, "answer_id": 38414661, "question_id": 38413219, "link": "https://stackoverflow.com/questions/38413219/is-using-fold-less-efficient-than-standard-recursion/38414661#38414661", "title": "Is using fold less efficient than standard recursion", "body": "<pre><code>foldr f z [a,b,c,...,n]                   == \na `f` (b `f` (c `f` (... (n `f` z) ...))) == \nf a (foldr f z [b,c,...,n])               == \nf a acc   where   acc = foldr f z [b,c,...,n]\n</code></pre>\n\n<p>So <em>if</em> your <code>f</code> returns <em>before</em> <a href=\"https://en.wikipedia.org/wiki/Lazy_evaluation\" rel=\"nofollow\">forcing</a> <code>acc</code>, <code>acc</code> remains not forced, i.e. no part of the list argument beyond its head element <code>a</code> is accessed, like e.g. when you have</p>\n\n<pre><code>f a acc = ...\n</code></pre>\n\n<p>If, on the other hand, your <code>f</code> does force its second argument, e.g. if it's defined as</p>\n\n<pre><code>f a (x:xs) = ...\n</code></pre>\n\n<p>then the <code>acc</code> <em>is</em> forced before <code>f</code> starts its work, and the list <em>will</em> be accessed in whole before the processing begins -- in whole, because <code>acc = f b acc2</code> and <em>that</em> invocation of <code>f</code> must force <em>its</em> second argument, <code>acc2</code>, so its value, <code>acc</code>, can be forced (pattern-matched with <code>(x:xs)</code>, that is); and so forth.</p>\n"}], "owner": {"reputation": 7264, "user_id": 146452, "user_type": "registered", "accept_rate": 92, "profile_image": "https://www.gravatar.com/avatar/55e2e2dbef238cbc9d9a3b914b9a65a5?s=128&d=identicon&r=PG", "display_name": "mclark1129", "link": "https://stackoverflow.com/users/146452/mclark1129"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 646, "favorite_count": 1, "accepted_answer_id": 38413324, "answer_count": 5, "score": 11, "last_activity_date": 1468705797, "creation_date": 1468686715, "question_id": 38413219, "link": "https://stackoverflow.com/questions/38413219/is-using-fold-less-efficient-than-standard-recursion", "title": "Is using fold less efficient than standard recursion", "body": "<p>I'm going through the Learn You a Haskell book right now and I'm curious about how this particular example works.  The book first demonstrates an implementation of <code>findKey</code> using traditional recursion:</p>\n\n<pre><code>findKey :: (Eq k) =&gt; k -&gt; [(k,v)] -&gt; Maybe v  \nfindKey key [] = Nothing  \nfindKey key ((k,v):xs) = if key == k  \n                            then Just v  \n                            else findKey key xs  \n</code></pre>\n\n<p>The book then follows up with a shorter implementation using <code>foldr</code></p>\n\n<pre><code>findKey :: (Eq k) =&gt; k -&gt; [(k,v)] -&gt; Maybe v  \nfindKey key = foldr (\\(k,v) acc -&gt; if key == k then Just v else acc) Nothing  \n</code></pre>\n\n<p>With the standard recursion, the function should immediately return once it hits the first element with the provided key.  If I understand the <code>foldr</code> implementation correctly, it will iterate over the entire list every time, even if it matched the first element it came across.  That doesn't seem like a very efficient way to handle the problem.</p>\n\n<p>Is there something I'm not getting about how the <code>foldr</code> implementation works?  Or is there some kind of magic within Haskell that makes this implementation not quite as inefficient as I think it is?</p>\n"}, {"tags": ["python", "haskell", "ghc"], "comments": [{"owner": {"reputation": 7240, "user_id": 327201, "user_type": "registered", "accept_rate": 73, "profile_image": "https://www.gravatar.com/avatar/0ee53216660fae93d26f8dcaba3945a0?s=128&d=identicon&r=PG", "display_name": "Ramon Snir", "link": "https://stackoverflow.com/users/327201/ramon-snir"}, "edited": false, "score": 12, "creation_date": 1468652604, "post_id": 38408394, "comment_id": 64225640, "body": "I&#39;m voting to close this question as off-topic because it isn&#39;t about programming at all. If curious about decisions made by the GHC team, ask them in their mailinglist."}, {"owner": {"reputation": 49959, "user_id": 866915, "user_type": "registered", "accept_rate": 70, "profile_image": "https://www.gravatar.com/avatar/09242131d6e17cbbe31e8547514da6e5?s=128&d=identicon&r=PG", "display_name": "ErikR", "link": "https://stackoverflow.com/users/866915/erikr"}, "edited": false, "score": 3, "creation_date": 1468653819, "post_id": 38408394, "comment_id": 64225936, "body": "or ask <a href=\"http://reddit.com/r/haskell\" rel=\"nofollow noreferrer\">/r/haskell</a> or the <a href=\"https://groups.google.com/forum/#!forum/haskell-cafe\" rel=\"nofollow noreferrer\">Haskell-Cafe mailing list</a>"}, {"owner": {"user_type": "does_not_exist", "display_name": "user824425"}, "edited": false, "score": 6, "creation_date": 1468663844, "post_id": 38408394, "comment_id": 64228226, "body": "I think it&#39;d make more sense to move this question to programmers.SE than to simply close it. It&#39;s a legitimate question for software engineering, but just outside the scope of SO."}, {"owner": {"reputation": 84731, "user_id": 510937, "user_type": "registered", "accept_rate": 80, "profile_image": "https://www.gravatar.com/avatar/70b13a9ae1aae1ca1aa6ac8dab4643f2?s=128&d=identicon&r=PG", "display_name": "Bakuriu", "link": "https://stackoverflow.com/users/510937/bakuriu"}, "edited": false, "score": 1, "creation_date": 1468672269, "post_id": 38408394, "comment_id": 64230392, "body": "@Rhymoid I don&#39;t think so. It&#39;s a matter of policy and history of a specific project and the only ones that can answers are those involved in that project, and as such it isn&#39;t suitable to any Q&amp;A site.  <b>If</b> the question was: &quot;Which advantages does python provide with respect to Haskell regarding testing a piece of software?&quot; then it <i>might</i> have been suitable for Programmers, but that&#39;s a more general question."}, {"owner": {"user_type": "does_not_exist", "display_name": "user824425"}, "reply_to_user": {"reputation": 84731, "user_id": 510937, "user_type": "registered", "accept_rate": 80, "profile_image": "https://www.gravatar.com/avatar/70b13a9ae1aae1ca1aa6ac8dab4643f2?s=128&d=identicon&r=PG", "display_name": "Bakuriu", "link": "https://stackoverflow.com/users/510937/bakuriu"}, "edited": false, "score": 1, "creation_date": 1468673147, "post_id": 38408394, "comment_id": 64230645, "body": "@Bakuriu I think that the general pattern of using a time-tested, more widely understood, and better ported programming language for a testing framework implies all main advantages. I get that it&#39;s &quot;a matter of policy and history of a specific project&quot;, but isn&#39;t that because this question only becomes relevant (and quite important, TBH) when you&#39;re implementing a production-ready programming language (which is quite a rare situation)?"}, {"owner": {"reputation": 44013, "user_id": 1477667, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/trgKM.jpg?s=128&g=1", "display_name": "dfeuer", "link": "https://stackoverflow.com/users/1477667/dfeuer"}, "edited": false, "score": 4, "creation_date": 1468676819, "post_id": 38408394, "comment_id": 64231604, "body": "@Rhymoid, GHC and Python really started around the same time."}, {"owner": {"reputation": 37486, "user_id": 371753, "user_type": "registered", "accept_rate": 83, "profile_image": "https://i.stack.imgur.com/znFEK.jpg?s=128&g=1", "display_name": "sclv", "link": "https://stackoverflow.com/users/371753/sclv"}, "edited": false, "score": 2, "creation_date": 1468917664, "post_id": 38408394, "comment_id": 64311255, "body": "Why is a matter of history of a project (in this case a programming language) not suitable to SO? It&#39;s a question, and there are those qualified to answer it."}, {"owner": {"reputation": 3104, "user_id": 1527176, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/N29xj.jpg?s=128&g=1", "display_name": "eguaio", "link": "https://stackoverflow.com/users/1527176/eguaio"}, "edited": false, "score": 0, "creation_date": 1476293022, "post_id": 38408394, "comment_id": 67287281, "body": "because they got tired of monads? :)"}, {"owner": {"reputation": 15711, "user_id": 655372, "user_type": "registered", "accept_rate": 79, "profile_image": "https://www.gravatar.com/avatar/0c85ef5eb7678857e2a6b793dfe055a3?s=128&d=identicon&r=PG", "display_name": "theheadofabroom", "link": "https://stackoverflow.com/users/655372/theheadofabroom"}, "edited": false, "score": 1, "creation_date": 1478617673, "post_id": 38408394, "comment_id": 68224309, "body": "I&#39;m voting to close this question as off-topic because it&#39;s asking why a specific project made an operational decision - this seems more suited for Quora than any of the Stack Exchange network sites"}, {"owner": {"reputation": 3434, "user_id": 1018733, "user_type": "registered", "accept_rate": 46, "profile_image": "https://i.stack.imgur.com/gGYmO.jpg?s=128&g=1", "display_name": "SwimBikeRun", "link": "https://stackoverflow.com/users/1018733/swimbikerun"}, "edited": false, "score": 0, "creation_date": 1575161756, "post_id": 38408394, "comment_id": 104472826, "body": "I very often come to SO threads via google searching, get the answer I was looking for, then see the mostly objective question was closed as off topic. Thankfully people answer them and SO keeps them around :)"}], "answers": [{"tags": [], "owner": {"reputation": 435, "user_id": 5918049, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/af98991f08e77e25ea70c29de12edb49?s=128&d=identicon&r=PG&f=1", "display_name": "eigil", "link": "https://stackoverflow.com/users/5918049/eigil"}, "is_accepted": true, "score": 6, "last_activity_date": 1479306165, "last_edit_date": 1479306165, "creation_date": 1479304832, "answer_id": 40634064, "question_id": 38408394, "link": "https://stackoverflow.com/questions/38408394/why-is-the-ghc-test-suite-written-in-python-not-haskell/40634064#40634064", "title": "Why is the GHC test suite written in Python, not Haskell?", "body": "<p>The <a href=\"https://github.com/ghc/ghc/commit/e5063a042c9a1701ea7273da7bacb530d5c077d3\" rel=\"noreferrer\">commit</a> message introducing Python explains a lot of it:</p>\n\n<blockquote>\n  <p>Revamp the testsuite framework.  The previous framework was an\n  experiment that got a little out of control - a whole new language\n  with an interpreter written in Haskell was rather heavyweight and left\n  us with a maintenance problem.</p>\n  \n  <p>So the new test driver is written in Python.  The downside is that you\n  need Python to run the testsuite, but we don't think that's too big a\n  problem since it only affects developers and Python installs pretty\n  easily onto everything these days.</p>\n  \n  <p>Highlights:</p>\n  \n  <ul>\n  <li><p>790 lines of Python, vs. 5300 lines of Haskell + 720 lines of &lt;strange made-up language&gt;.</p></li>\n  <li><p>the framework supports running tests in various \"ways\", which should\n  catch more bugs.  By default, each test is run in three ways:\n  normal, -O, and -O -fasm.  Additionally, if profiling libraries\n  have been built, another way (-O -prof -auto-all) is added.  I plan\n  to also add a 'GHCi' way.</p>\n  \n  <p>Running tests multiple ways has already shown up some new bugs!</p></li>\n  <li><p>documentation is in the README file and is somewhat improved.</p></li>\n  <li><p>the framework is rather less GHC-specific, and could without much\n  difficulty be coaxed into using other compilers.  Most of the\n  GHC-specificness is in a separate configuration file (config/ghc).</p></li>\n  </ul>\n  \n  <p>Things may need a while to settle down.  Expect some unexpected\n  failures.</p>\n</blockquote>\n"}], "owner": {"reputation": 1155, "user_id": 450246, "user_type": "registered", "accept_rate": 86, "profile_image": "https://www.gravatar.com/avatar/c29b0a16d9f66e9b6c3ac4787d71247c?s=128&d=identicon&r=PG", "display_name": "JesseW", "link": "https://stackoverflow.com/users/450246/jessew"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 1165, "favorite_count": 2, "accepted_answer_id": 40634064, "answer_count": 1, "score": 11, "last_activity_date": 1479306165, "creation_date": 1468650042, "last_edit_date": 1592644375, "question_id": 38408394, "link": "https://stackoverflow.com/questions/38408394/why-is-the-ghc-test-suite-written-in-python-not-haskell", "title": "Why is the GHC test suite written in Python, not Haskell?", "body": "<p>I noticed that GHC (a widely-used Haskell compiler) has a test suite written in Python, not in Haskell (as I would naively expect). What is the history of this? Are there particular advantages to writing the test suite in a different language?</p>\n<p><em>edit:</em> Per a suggestion in the comments, I asked this in <a href=\"https://www.reddit.com/r/haskell/comments/4tbtph/why_is_the_ghc_test_suite_written_in_python_not/\" rel=\"noreferrer\">/r/haskell</a>. It has now generated three answers, which I've quoted below:</p>\n<p><strong>tathougies</strong> said:</p>\n<blockquote>\n<p>The test suite driver seems to be written in Python. Python is a good high-level scripting language.</p>\n<p>It's like asking 'why does GHC use Make instead of haskell'? Probably because make is better at running shell programs with external dependency resolution built-in.</p>\n<p>The tests themselves seem to be written in Haskell, verifying certain properties of the compiler and catching regressions. If they fail, it looks like the python driver is informed, and then would report the error to the user.</p>\n</blockquote>\n<p><strong>phadej</strong> added:</p>\n<blockquote>\n<p>FWIW GHC's built system is being rewritten to use shake: the Haskell library.</p>\n</blockquote>\n<p><strong>eacameron</strong> said:</p>\n<blockquote>\n<p>I don't know. But GHC doesn't have the luxury of using Haskell the same way you and I do. It has to bootstrap using a previous version of itself and it wants to avoid dependencies. Python is a pretty light-weight requirement since most systems (except Windows) come with it built in.</p>\n</blockquote>\n"}, {"tags": ["parsing", "haskell", "abstract-syntax-tree"], "comments": [{"owner": {"reputation": 49959, "user_id": 866915, "user_type": "registered", "accept_rate": 70, "profile_image": "https://www.gravatar.com/avatar/09242131d6e17cbbe31e8547514da6e5?s=128&d=identicon&r=PG", "display_name": "ErikR", "link": "https://stackoverflow.com/users/866915/erikr"}, "edited": false, "score": 0, "creation_date": 1468626596, "post_id": 38405937, "comment_id": 64221363, "body": "if the Language.Haskell.* modules are not working for you, perhaps try out the libraries behind this project: <a href=\"http://haskelltools.org\" rel=\"nofollow noreferrer\">haskelltools.org</a>  Looks like their code is available both on Hackage and github."}, {"owner": {"reputation": 13807, "user_id": 2407038, "user_type": "registered", "accept_rate": 64, "profile_image": "https://www.gravatar.com/avatar/538f6f4a9aa43841841de7d8e8b169fc?s=128&d=identicon&r=PG&f=1", "display_name": "user2407038", "link": "https://stackoverflow.com/users/2407038/user2407038"}, "edited": false, "score": 0, "creation_date": 1468640088, "post_id": 38405937, "comment_id": 64223196, "body": "It won&#39;t be possible - <a href=\"https://hackage.haskell.org/package/haskell-src-1.0.2.0/docs/Language-Haskell-Syntax.html#t:HsExp\" rel=\"nofollow noreferrer\">the majority</a> of expression constructors simply do not contain an <code>SrcLoc</code>. I don&#39;t think this parser aims to give the user completely accurate line numbers - even ghc doesn&#39;t get this quite right all the time."}, {"owner": {"reputation": 422, "user_id": 4476484, "user_type": "registered", "accept_rate": 75, "profile_image": "https://i.stack.imgur.com/bMNeb.jpg?s=128&g=1", "display_name": "nullromo", "link": "https://stackoverflow.com/users/4476484/nullromo"}, "edited": false, "score": 0, "creation_date": 1468788093, "post_id": 38405937, "comment_id": 64258056, "body": "I realize that the constructors do not contain SrcLoc information. What I&#39;m looking for is either a different parser or an alternate method of determining the line numbers."}], "answers": [{"comments": [{"owner": {"reputation": 422, "user_id": 4476484, "user_type": "registered", "accept_rate": 75, "profile_image": "https://i.stack.imgur.com/bMNeb.jpg?s=128&g=1", "display_name": "nullromo", "link": "https://stackoverflow.com/users/4476484/nullromo"}, "edited": false, "score": 0, "creation_date": 1470252791, "post_id": 38693367, "comment_id": 64878245, "body": "Using <code>Language.Haskell.Exts.Parser.parse</code> , I still get the same problem. I end up with a <code>Module</code> rather than an <code>HsModule</code>, and there still is no location information on every node."}], "tags": [], "owner": {"reputation": 25144, "user_id": 477476, "user_type": "registered", "accept_rate": 85, "profile_image": "https://i.stack.imgur.com/Qf4TT.png?s=128&g=1", "display_name": "Cactus", "link": "https://stackoverflow.com/users/477476/cactus"}, "is_accepted": false, "score": 0, "last_activity_date": 1470037246, "creation_date": 1470037246, "answer_id": 38693367, "question_id": 38405937, "link": "https://stackoverflow.com/questions/38405937/haskell-ast-incomplete-location-information/38693367#38693367", "title": "Haskell AST Incomplete Location Information", "body": "<p><a href=\"https://hackage.haskell.org/package/haskell-src-exts\" rel=\"nofollow\"><code>haskell-src-exts</code></a> has a location tag (<a href=\"https://hackage.haskell.org/package/haskell-src-exts-1.18.2/docs/Language-Haskell-Exts-SrcLoc.html#t:SrcSpanInfo\" rel=\"nofollow\"><code>SrcSpanInfo</code></a> by default) on <a href=\"https://hackage.haskell.org/package/haskell-src-exts-1.18.2/docs/Language-Haskell-Exts-Syntax.html#t:Exp\" rel=\"nofollow\">every subexpression</a>; it should have enough detail to disambiguate your two example cases.</p>\n"}], "owner": {"reputation": 422, "user_id": 4476484, "user_type": "registered", "accept_rate": 75, "profile_image": "https://i.stack.imgur.com/bMNeb.jpg?s=128&g=1", "display_name": "nullromo", "link": "https://stackoverflow.com/users/4476484/nullromo"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 110, "favorite_count": 0, "answer_count": 1, "score": 2, "last_activity_date": 1470037246, "creation_date": 1468622395, "question_id": 38405937, "link": "https://stackoverflow.com/questions/38405937/haskell-ast-incomplete-location-information", "title": "Haskell AST Incomplete Location Information", "body": "<p>I've been trying to build Haskell AST's so that I can find out which AST nodes exist on which lines of a source file. So far, I am using <code>Language.Haskell.Parser</code> and <code>Language.Haskell.Syntax</code>, which seem to work fairly well. I can generate a tree, then run through each part of it get out the line number using <code>srcLine loc</code> (where <code>loc</code> is a SrcLoc).</p>\n\n<p>However, I am running into issues when the parsed file looks like this:</p>\n\n<p>FILE 1</p>\n\n<pre><code>1| rangeLeq :: Integer -&gt; NonnegRange\n2| rangeLeq n =\n3|   Range BoundaryBelowAll (BoundaryAbove n)\n</code></pre>\n\n<p>The file could easily have been written like this:</p>\n\n<p>FILE 2</p>\n\n<pre><code>1| rangeLeq :: Integer -&gt; NonnegRange\n2| rangeLeq n = Range BoundaryBelowAll (BoundaryAbove n)\n</code></pre>\n\n<p>The problem is that the parser sees these two as equivalent. It does not assign a SrcLoc to everything, only to certain parts of the AST. So what I end up with is the following output for both file 1 and file 2:</p>\n\n<pre><code>line 1: HsTypeSig\n        |--HsIdent (rangeLeq)\n        |--HsQualType\n           |--HsContext\n           |--HsTyFun\n              |--HsTyCon\n                 |--HsUnQual\n                    |--HsIdent (Integer)\n              |--HsTyCon\n                 |--HsUnQual\n                    |--HsIdent (NonnegRange)\nline 2: HsMatch\n        |--HsIdent (rangeLeq)\n        |--HsPVar\n           |--HsIdent (n)\n        |--HsUnGuardedRhs\n           |--HsApp\n              |--HsApp\n                 |--HsCon\n                    |--HsUnQual\n                       |--HsIdent (Range)\n                 |--HsCon\n                    |--HsUnQual\n                       |--HsIdent (BoundaryBelowAll)\n              |--HsParen\n                 |--HsApp\n                    |--HsCon\n                       |--HsUnQual\n                          |--HsIdent (BoundaryAbove)\n                    |--HsVar\n                       |--HsUnQual\n                          |--HsIdent (n)\n</code></pre>\n\n<p>So the issue here is that there is no location information on most of the nodes, so it sees the function definition (<code>HsMatch</code>) as a single line. In case it is unclear, The <code>HsMatch</code> represents <code>rangeLeq n = Range BoundaryBelowAll (BoundaryAbove n)</code> in the code. Since the only part of the AST that comes with a <code>SrcLoc</code> is the <code>HsMatch</code> itself, the parser is assuming that all parts of the <code>HsMatch</code> are on the same line.</p>\n\n<p><code>tl;dr</code> How can I get a correct parse, such that lines in the source file that are split unnecessarily still get tagged with the appropriate line? Id est, I want a parse that tags <em>every single node</em> with a <code>SrcLoc</code>, not just certain nodes.</p>\n"}, {"tags": ["haskell", "haskell-stack"], "comments": [{"owner": {"reputation": 7136, "user_id": 1467115, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/81bee3c36aa1c59317d525baabecec11?s=128&d=identicon&r=PG", "display_name": "Jan Gerlinger", "link": "https://stackoverflow.com/users/1467115/jan-gerlinger"}, "edited": false, "score": 1, "creation_date": 1468670327, "post_id": 38404833, "comment_id": 64229886, "body": "In newer stack versions you can also just call <code>stack build --profile</code> as a shortcut for all the other flags."}, {"owner": {"reputation": 7397, "user_id": 27385, "user_type": "registered", "accept_rate": 86, "profile_image": "https://www.gravatar.com/avatar/8ad2304dd68978c01b9bf45daa6d9fe4?s=128&d=identicon&r=PG&f=1", "display_name": "Alex", "link": "https://stackoverflow.com/users/27385/alex"}, "reply_to_user": {"reputation": 7136, "user_id": 1467115, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/81bee3c36aa1c59317d525baabecec11?s=128&d=identicon&r=PG", "display_name": "Jan Gerlinger", "link": "https://stackoverflow.com/users/1467115/jan-gerlinger"}, "edited": false, "score": 0, "creation_date": 1469974838, "post_id": 38404833, "comment_id": 64749000, "body": "See <a href=\"http://stackoverflow.com/documentation/haskell/2970/stack/16600/profiling-with-stack\">this example</a> for more info"}], "answers": [{"comments": [{"owner": {"reputation": 7397, "user_id": 27385, "user_type": "registered", "accept_rate": 86, "profile_image": "https://www.gravatar.com/avatar/8ad2304dd68978c01b9bf45daa6d9fe4?s=128&d=identicon&r=PG&f=1", "display_name": "Alex", "link": "https://stackoverflow.com/users/27385/alex"}, "edited": false, "score": 0, "creation_date": 1468652121, "post_id": 38405157, "comment_id": 64225532, "body": "<code>stack exec -- which ghc</code> says /usr/bin/ghc. My stack.yml just has <code>lts-5.17</code> for the resolver. I am trying <code>stack build --executable-profiling --library-profiling --ghc-options=&quot;-fprof-auto -rtsopts&quot; --no-system-ghc</code> now. Should I remove ghc from the system?"}, {"owner": {"reputation": 7397, "user_id": 27385, "user_type": "registered", "accept_rate": 86, "profile_image": "https://www.gravatar.com/avatar/8ad2304dd68978c01b9bf45daa6d9fe4?s=128&d=identicon&r=PG&f=1", "display_name": "Alex", "link": "https://stackoverflow.com/users/27385/alex"}, "edited": false, "score": 0, "creation_date": 1468658866, "post_id": 38405157, "comment_id": 64227028, "body": "I added <code>-threaded -rtsopts -with-rtsopts=-N -eventlog -prof</code> to <code>ghc-options</code> in my .cabal, and then ran <code>-threaded -rtsopts -with-rtsopts=-N -eventlog -prof</code>. I can now get profiling information from my application and run with <code>+RTS -p</code>. Thank you for your help!"}], "tags": [], "owner": {"reputation": 3075, "user_id": 1164871, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/4d6a54a3752ab47170d790085935988f?s=128&d=identicon&r=PG", "display_name": "mgsloan", "link": "https://stackoverflow.com/users/1164871/mgsloan"}, "is_accepted": true, "score": 3, "last_activity_date": 1468621939, "last_edit_date": 1468621939, "creation_date": 1468617436, "answer_id": 38405157, "question_id": 38404833, "link": "https://stackoverflow.com/questions/38404833/haskell-stacks-executable-profiling-and-ghc-options-fails-to-build/38405157#38405157", "title": "Haskell Stack&#39;s executable profiling and ghc options fails to build", "body": "<p>What does \"stack exec -- which ghc\" say?  If your ghc is installed globally, it could be that it lacks profiling libraries.  If so, \"stack setup --no-system-ghc\" + \"stack build --no-system-ghc\"</p>\n\n<p>What is your stack.yaml configuration?  If you've set a resolver of \"ghc-*\", it won't work unless you specify the versions of all your dependencies in \"extra-deps\".  Usually you'll want to use a stackage snapshot - <a href=\"https://www.stackage.org/\" rel=\"nofollow\">https://www.stackage.org/</a></p>\n"}], "owner": {"reputation": 7397, "user_id": 27385, "user_type": "registered", "accept_rate": 86, "profile_image": "https://www.gravatar.com/avatar/8ad2304dd68978c01b9bf45daa6d9fe4?s=128&d=identicon&r=PG&f=1", "display_name": "Alex", "link": "https://stackoverflow.com/users/27385/alex"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 594, "favorite_count": 0, "accepted_answer_id": 38405157, "answer_count": 1, "score": 1, "last_activity_date": 1468621939, "creation_date": 1468615926, "question_id": 38404833, "link": "https://stackoverflow.com/questions/38404833/haskell-stacks-executable-profiling-and-ghc-options-fails-to-build", "title": "Haskell Stack&#39;s executable profiling and ghc options fails to build", "body": "<p>I'm trying to debug performance problems in a Haskell project, but I can't get profiling to be compiled in so I can use it through <code>+RTS -p</code> command line arguments.</p>\n\n<p>The options for GHC in my <code>.cabal</code> file are:</p>\n\n<pre><code>ghc-options:         -threaded -rtsopts -with-rtsopts=-N -Wall -Werror\n</code></pre>\n\n<p>Here's me attempting to build it:</p>\n\n<pre><code>stack build --executable-profiling --library-profiling --ghc-options=\"-fprof-auto -rtsopts\"\n</code></pre>\n\n<p>Which results in:</p>\n\n<pre><code>While constructing the BuildPlan the following exceptions were encountered:\n\n--  Failure when adding dependencies:    \n      base: needed (&gt;=2 &amp;&amp; &lt;5), not present in build plan (latest applicable is 4.9.0.0)\n      mtl: needed (&gt;=2.1 &amp;&amp; &lt;2.3), couldn't resolve its dependencies\n      random: needed (-any), couldn't resolve its dependencies\n      transformers: needed (&gt;=0.3 &amp;&amp; &lt;0.6), couldn't resolve its dependencies\n      transformers-compat: needed (&gt;=0.4 &amp;&amp; &lt;0.6), couldn't resolve its dependencies\n    needed for package: MonadRandom-0.4.2.3\n\n--  Failure when adding dependencies:    \n      base: needed (&gt;=4 &amp;&amp; &lt;5), not present in build plan (latest applicable is 4.9.0.0)\n      stm: needed (&gt;=2.0 &amp;&amp; &lt;2.5), couldn't resolve its dependencies\n      transformers: needed (&gt;=0.2 &amp;&amp; &lt;0.6), couldn't resolve its dependencies\n    needed for package: StateVar-1.1.0.4\n&lt;snipped large log&gt;\n</code></pre>\n\n<p>Even trying with just <code>stack build --executable-profiling</code> results in the same error.</p>\n\n<p>For reference, my library dependencies are:</p>\n\n<pre><code>   build-depends:       base &gt;= 4.7 &amp;&amp; &lt; 5\n                     , aeson\n                     , servant\n                     , servant-server \n                     , wai\n                     , warp\n                     , either\n                     , bytestring\n                     , transformers\n                     , postgresql-simple\n                     , amazonka\n                     , amazonka-sqs\n                     , lens\n                     , text\n                     , time\n                     , resource-pool\n</code></pre>\n\n<p>How can I resolve this so I can compile my project with stack and have profiling built in for use with <code>+RTS -p</code>?</p>\n"}, {"tags": ["string", "parsing", "haskell", "parsec"], "comments": [{"owner": {"reputation": 49959, "user_id": 866915, "user_type": "registered", "accept_rate": 70, "profile_image": "https://www.gravatar.com/avatar/09242131d6e17cbbe31e8547514da6e5?s=128&d=identicon&r=PG", "display_name": "ErikR", "link": "https://stackoverflow.com/users/866915/erikr"}, "edited": false, "score": 0, "creation_date": 1468613461, "post_id": 38403791, "comment_id": 64217139, "body": "Stylistically I would use <code>fmap</code> instead of <code>liftM</code>. Also I&#39;m pretty sure you don&#39;t need <code>try</code> around either <code>eof</code> or <code>oneOf</code>, My understanding is that you only need <code>try</code> if the parser can consume input without succeeding."}, {"owner": {"reputation": 126897, "user_id": 791604, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/ce991df7a056248d5e4f6fc3659ba733?s=128&d=identicon&r=PG", "display_name": "Daniel Wagner", "link": "https://stackoverflow.com/users/791604/daniel-wagner"}, "edited": false, "score": 0, "creation_date": 1468616152, "post_id": 38403791, "comment_id": 64218282, "body": "Your <code>try</code> is probably going to have to be higher -- e.g. <code>endOfQuote = try $ do { ... }</code> or even better <code>quotedLabel = do { ... endBy1 anyChar (try endOfQuote) ... }</code>. Are you sure you want <code>endBy1</code>? The documentation for it doesn&#39;t seem to match your description of what you want."}], "answers": [{"comments": [{"owner": {"reputation": 100185, "user_id": 3234959, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/93bb12ca0f93dfddb33880316f7e66c2?s=128&d=identicon&r=PG&f=1", "display_name": "chi", "link": "https://stackoverflow.com/users/3234959/chi"}, "edited": false, "score": 1, "creation_date": 1468612906, "post_id": 38404185, "comment_id": 64216854, "body": "Also, <code>Control.Monad.void :: :: Functor f =&gt; f a -&gt; f () </code>"}], "tags": [], "owner": {"reputation": 49959, "user_id": 866915, "user_type": "registered", "accept_rate": 70, "profile_image": "https://www.gravatar.com/avatar/09242131d6e17cbbe31e8547514da6e5?s=128&d=identicon&r=PG", "display_name": "ErikR", "link": "https://stackoverflow.com/users/866915/erikr"}, "is_accepted": false, "score": 2, "last_activity_date": 1468612638, "creation_date": 1468612638, "answer_id": 38404185, "question_id": 38403791, "link": "https://stackoverflow.com/questions/38403791/parsec3-text-parser-for-quoted-string-where-everything-is-allowed-in-between-qu/38404185#38404185", "title": "Parsec3 Text parser for quoted string, where everything is allowed in between quotes", "body": "<p>To change the result of any functor computation you can just use:</p>\n\n<pre><code>fmap (const x) functor_comp\n</code></pre>\n\n<p>e.g.:</p>\n\n<pre><code>getLine :: IO String\nfmap (const ()) getLine :: IO ()\n\neof :: Parser ()\noneOf \"| \"  :: Parser Char\n\nfmap (const ()) (oneOf \"| \") :: Parser ()\n</code></pre>\n\n<p>Another option is to use operators from <code>Control.Applicative</code>:</p>\n\n<pre><code>getLine *&gt; return 3  :: IO Integer\n</code></pre>\n\n<p>This performs <code>getLine</code>, discards the result and returns 3.</p>\n\n<p>In your case, you might use:</p>\n\n<pre><code>try(eof) &lt;|&gt; try( oneOf \"| \" *&gt; return ())\n</code></pre>\n"}, {"comments": [{"owner": {"reputation": 729, "user_id": 2181977, "user_type": "registered", "accept_rate": 86, "profile_image": "https://www.gravatar.com/avatar/0b84fe9137990458c9a91dcadd10579c?s=128&d=identicon&r=PG", "display_name": "Fredrik Karlsson", "link": "https://stackoverflow.com/users/2181977/fredrik-karlsson"}, "edited": false, "score": 0, "creation_date": 1468689833, "post_id": 38408834, "comment_id": 64235106, "body": "Ok, this works. A bit unsatisfactory that I need to use <code>Char</code> and then pack concatenated Strings to Text, but at least it seems to work for all exemple I can think of right now."}, {"owner": {"reputation": 49959, "user_id": 866915, "user_type": "registered", "accept_rate": 70, "profile_image": "https://www.gravatar.com/avatar/09242131d6e17cbbe31e8547514da6e5?s=128&d=identicon&r=PG", "display_name": "ErikR", "link": "https://stackoverflow.com/users/866915/erikr"}, "reply_to_user": {"reputation": 729, "user_id": 2181977, "user_type": "registered", "accept_rate": 86, "profile_image": "https://www.gravatar.com/avatar/0b84fe9137990458c9a91dcadd10579c?s=128&d=identicon&r=PG", "display_name": "Fredrik Karlsson", "link": "https://stackoverflow.com/users/2181977/fredrik-karlsson"}, "edited": false, "score": 0, "creation_date": 1468690703, "post_id": 38408834, "comment_id": 64235347, "body": "You don&#39;t have to perform the conversion of String -&gt; Text for every sub-parser. For instance, you can convert <code>labels</code> to a <code>Parser [Text]</code> with: <code>fmap (map T.pack) labels</code>."}, {"owner": {"reputation": 729, "user_id": 2181977, "user_type": "registered", "accept_rate": 86, "profile_image": "https://www.gravatar.com/avatar/0b84fe9137990458c9a91dcadd10579c?s=128&d=identicon&r=PG", "display_name": "Fredrik Karlsson", "link": "https://stackoverflow.com/users/2181977/fredrik-karlsson"}, "edited": false, "score": 0, "creation_date": 1469130301, "post_id": 38408834, "comment_id": 64423284, "body": "Yes, that is true. Thanks."}], "tags": [], "owner": {"reputation": 49959, "user_id": 866915, "user_type": "registered", "accept_rate": 70, "profile_image": "https://www.gravatar.com/avatar/09242131d6e17cbbe31e8547514da6e5?s=128&d=identicon&r=PG", "display_name": "ErikR", "link": "https://stackoverflow.com/users/866915/erikr"}, "is_accepted": true, "score": 2, "last_activity_date": 1468655631, "last_edit_date": 1495541912, "creation_date": 1468653606, "answer_id": 38408834, "question_id": 38403791, "link": "https://stackoverflow.com/questions/38403791/parsec3-text-parser-for-quoted-string-where-everything-is-allowed-in-between-qu/38408834#38408834", "title": "Parsec3 Text parser for quoted string, where everything is allowed in between quotes", "body": "<p><strong>Whitespace</strong></p>\n\n<p>First a comment on handling white space...</p>\n\n<p>Generally the practice is to write your parsers so that they\nconsume the whitespace following a token \nor syntactic unit. It's common to define combinator like:</p>\n\n<pre><code>lexeme p = p &lt;* spaces\n</code></pre>\n\n<p>to easily convert a parser <em>p</em>  to one that discards the whitespace\nfollowing whatever <em>p</em> parses. E.g., if you have</p>\n\n<pre><code>number = many1 digit\n</code></pre>\n\n<p>simply use <code>lexeme number</code> whenever you want to eat up the\nwhitespace following the number.</p>\n\n<p>For more on this approach to handling whitespace and other advice\non parsing languages, see <a href=\"https://mrkkrp.github.io/megaparsec/tutorials/parsing-simple-imperative-language.html#lexer\" rel=\"nofollow noreferrer\">this Megaparsec tutorial</a>.</p>\n\n<p><strong>Label expressions</strong></p>\n\n<p>Based on <a href=\"https://stackoverflow.com/questions/24940541/parsing-single-qoute-char-in-a-single-quoted-string-in-parsec\">your previous SO question</a> it appears you want\nto parse expressions of the form:</p>\n\n<pre><code>label1 | label2 | ... | labeln\n</code></pre>\n\n<p>where each label may be a simple label or a quoted label.</p>\n\n<p>The idiomatic way to parse this pattern is to use <code>sepBy</code> like this:</p>\n\n<pre><code>labels :: Parser String\nlabels = sepBy1 (try quotedLabel &lt;|&gt; simpleLabel) (char '|')\n</code></pre>\n\n<p>We define both simpleLabel and quotedLabel in terms of\nwhat characters may occur in them. For simpleLabel a valid\ncharacter is a non-| and non-space:</p>\n\n<pre><code>simpleLabel :: Parser String\nsimpleLabel = many (noneOf \"| \")\n</code></pre>\n\n<p>A quotedLabel is a single quote followed by a run\nof valid quotedLabel-characters followed by an ending\nsingle quote:</p>\n\n<pre><code>sq = char '\\''\n\nquotedLabel :: Parser String\nquotedLabel = do\n  char sq\n  chs &lt;- many validChar\n  char sq\n  return chs\n</code></pre>\n\n<p>A validChar is either a non-single quote or a single\nquote not followed by eof or a vertical bar:</p>\n\n<pre><code>validChar = noneOf [sq] &lt;|&gt; try validQuote\n\nvalidQuote = do\n  char sq\n  notFollowedBy eof\n  notFollowedBy (char '|')\n  return sq\n</code></pre>\n\n<p>The first <code>notFollowedBy</code> will fail if the single quote appears just\nbefore the end of input. The second <code>notFollowedBy</code> will fail if\nnext character is a vertical bar. Therefore the sequence of the two\nwill succeed only if there is a non-vertical bar character following\nthe single quote. In this case the single quote should be interpreted\nas part of the string and not the terminating single quote.</p>\n\n<p>Unfortunately this doesn't quite work because the\ncurrent implementation of <code>notFollowedBy</code>\nwill always succeed with a parser which does not consume any\ninput -- i.e. like <code>eof</code>. (See <a href=\"https://github.com/aslatter/parsec/issues/8\" rel=\"nofollow noreferrer\">this issue</a> for more details.)</p>\n\n<p>To work around this problem we can use this alternate\nimplementation:</p>\n\n<pre><code>notFollowedBy' :: (Stream s m t, Show a) =&gt; ParsecT s u m a -&gt; ParsecT s u m ()\nnotFollowedBy' p = try $ join $\n      do {a &lt;- try p; return (unexpected (show a));}\n  &lt;|&gt; return (return ())\n</code></pre>\n\n<p>Here is the complete solution with some tests. By adding a few <code>lexeme</code>\ncalls you can make this parser eat up any white space where you decide\nit is not significant.</p>\n\n<pre><code>import Text.Parsec hiding (labels)\nimport Text.Parsec.String\nimport Control.Monad\n\nnotFollowedBy' :: (Stream s m t, Show a) =&gt; ParsecT s u m a -&gt; ParsecT s u m ()\nnotFollowedBy' p = try $ join $\n      do {a &lt;- try p; return (unexpected (show a));}\n  &lt;|&gt; return (return ())\n\nsq = '\\''\n\nvalidChar = do\n  noneOf \"'\" &lt;|&gt; try validQuote\n\nvalidQuote = do\n  char sq\n  notFollowedBy' eof\n  notFollowedBy (char '|')\n  return sq\n\nquotedLabel :: Parser String\nquotedLabel = do\n  char sq\n  str &lt;- many validChar\n  char sq\n  return str\n\nplainLabel :: Parser String\nplainLabel = many (noneOf \"| \")\n\nlabels :: Parser [String]\nlabels = sepBy1 (try quotedLabel &lt;|&gt; try plainLabel) (char '|')\n\ntest input expected = do\n  case parse (labels &lt;* eof) \"\" input of\n    Left e -&gt; putStrLn $ \"error: \" ++ show e\n    Right v -&gt; if v == expected\n                 then putStrLn $ \"OK - got: \" ++ show v\n                 else putStrLn $ \"NOT OK - got: \" ++ show v ++ \"  expected: \" ++ show expected\n\ntest1 = test \"a|b|c\"      [\"a\",\"b\",\"c\"]\ntest2 = test \"a|'b b'|c\"  [\"a\", \"b b\", \"c\"]\ntest3 = test \"'abc''|def\" [\"abc'\", \"def\" ]\ntest4 = test \"'abc'\"      [\"abc\"]\ntest5 = test \"x|'abc'\"    [\"x\",\"abc\"]\n</code></pre>\n"}], "owner": {"reputation": 729, "user_id": 2181977, "user_type": "registered", "accept_rate": 86, "profile_image": "https://www.gravatar.com/avatar/0b84fe9137990458c9a91dcadd10579c?s=128&d=identicon&r=PG", "display_name": "Fredrik Karlsson", "link": "https://stackoverflow.com/users/2181977/fredrik-karlsson"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 93, "favorite_count": 0, "accepted_answer_id": 38408834, "answer_count": 2, "score": 0, "last_activity_date": 1468655631, "creation_date": 1468610968, "last_edit_date": 1495535329, "question_id": 38403791, "link": "https://stackoverflow.com/questions/38403791/parsec3-text-parser-for-quoted-string-where-everything-is-allowed-in-between-qu", "title": "Parsec3 Text parser for quoted string, where everything is allowed in between quotes", "body": "<p>I have actually asked this question before (<a href=\"https://stackoverflow.com/questions/24940541/parsing-single-qoute-char-in-a-single-quoted-string-in-parsec\">here</a>) but it turns out that the solution provided did not handle all test cases. Also, I need 'Text' parser rather than 'String', so I need parsec3.</p>\n\n<p>Ok, the parser should allow for EVERY type of char inbetween quotes, even quotes. The end of the quoted text is marked by a ' character, followed by |, a space or end of input.</p>\n\n<p>So, </p>\n\n<blockquote>\n  <p>'aa''''| </p>\n</blockquote>\n\n<p>should return a string </p>\n\n<blockquote>\n  <p>aa'''</p>\n</blockquote>\n\n<p>This is what I have:</p>\n\n<pre><code>import Text.Parsec\nimport Text.Parsec.Text\n\n\nquotedLabel :: Parser Text\nquotedLabel = do -- reads the first quote.\n    spaces\n    string \"'\"\n    lab &lt;-  liftM pack $ endBy1 anyChar endOfQuote\n    return  lab\n\nendOfQuote = do\n    string \"'\"\n    try(eof) &lt;|&gt; try( oneOf \"| \")\n</code></pre>\n\n<p>Now, the problem here is of course that <code>eof</code> has a different type than <code>oneOf \"| \"</code>, so compilation falls.</p>\n\n<p>How do I fix this? Is there a better way to achieve what I am trying to do?</p>\n"}, {"tags": ["algorithm", "haskell", "optimization", "maximize"], "comments": [{"owner": {"reputation": 49959, "user_id": 866915, "user_type": "registered", "accept_rate": 70, "profile_image": "https://www.gravatar.com/avatar/09242131d6e17cbbe31e8547514da6e5?s=128&d=identicon&r=PG", "display_name": "ErikR", "link": "https://stackoverflow.com/users/866915/erikr"}, "edited": false, "score": 2, "creation_date": 1468604764, "post_id": 38402199, "comment_id": 64212664, "body": "How would you do it in another language?"}, {"owner": {"reputation": 1099, "user_id": 6513157, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/3d45981b71a14222513f57e8566e4b8b?s=128&d=identicon&r=PG&f=1", "display_name": "R B", "link": "https://stackoverflow.com/users/6513157/r-b"}, "edited": false, "score": 3, "creation_date": 1468605094, "post_id": 38402199, "comment_id": 64212823, "body": "Why isn&#39;t the answer <code>[34, 34, 34]</code>? Try reading up on the subset sum problem and determining what properties you need your solution to hold first."}, {"owner": {"reputation": 48129, "user_id": 76051, "user_type": "registered", "accept_rate": 91, "profile_image": "https://i.stack.imgur.com/AGDxz.jpg?s=128&g=1", "display_name": "Carsten", "link": "https://stackoverflow.com/users/76051/carsten"}, "edited": false, "score": 2, "creation_date": 1468605166, "post_id": 38402199, "comment_id": 64212857, "body": "well the problem looks like knapsack (brute-force would be <code>maximumBy (compare `on` sum) . filter ((&lt;= 103) . sum) $ subsequences [15,20,5,45,34]</code>) - but this would not allow picking items more than once"}, {"owner": {"reputation": 69, "user_id": 5987052, "user_type": "registered", "accept_rate": 100, "profile_image": "https://graph.facebook.com/1267479463266681/picture?type=large", "display_name": "Breno Henrique", "link": "https://stackoverflow.com/users/5987052/breno-henrique"}, "reply_to_user": {"reputation": 1099, "user_id": 6513157, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/3d45981b71a14222513f57e8566e4b8b?s=128&d=identicon&r=PG&f=1", "display_name": "R B", "link": "https://stackoverflow.com/users/6513157/r-b"}, "edited": false, "score": 0, "creation_date": 1468605355, "post_id": 38402199, "comment_id": 64212957, "body": "@RowanBlush sorry, I edited the properties of the solution. Thanks!"}, {"owner": {"reputation": 69, "user_id": 5987052, "user_type": "registered", "accept_rate": 100, "profile_image": "https://graph.facebook.com/1267479463266681/picture?type=large", "display_name": "Breno Henrique", "link": "https://stackoverflow.com/users/5987052/breno-henrique"}, "reply_to_user": {"reputation": 49959, "user_id": 866915, "user_type": "registered", "accept_rate": 70, "profile_image": "https://www.gravatar.com/avatar/09242131d6e17cbbe31e8547514da6e5?s=128&d=identicon&r=PG", "display_name": "ErikR", "link": "https://stackoverflow.com/users/866915/erikr"}, "edited": false, "score": 0, "creation_date": 1468606415, "post_id": 38402199, "comment_id": 64213520, "body": "@ErikR find the heavier box. Add (heavierBox % truckCapacity) heavier boxes. Take the largest value less than the rest of this division, and repeat the process. Right?"}, {"owner": {"reputation": 49959, "user_id": 866915, "user_type": "registered", "accept_rate": 70, "profile_image": "https://www.gravatar.com/avatar/09242131d6e17cbbe31e8547514da6e5?s=128&d=identicon&r=PG", "display_name": "ErikR", "link": "https://stackoverflow.com/users/866915/erikr"}, "edited": false, "score": 0, "creation_date": 1468606547, "post_id": 38402199, "comment_id": 64213595, "body": "If you post working code as part of your question we might be able to help you translate it to Haskell."}, {"owner": {"reputation": 49959, "user_id": 866915, "user_type": "registered", "accept_rate": 70, "profile_image": "https://www.gravatar.com/avatar/09242131d6e17cbbe31e8547514da6e5?s=128&d=identicon&r=PG", "display_name": "ErikR", "link": "https://stackoverflow.com/users/866915/erikr"}, "reply_to_user": {"reputation": 48129, "user_id": 76051, "user_type": "registered", "accept_rate": 91, "profile_image": "https://i.stack.imgur.com/AGDxz.jpg?s=128&g=1", "display_name": "Carsten", "link": "https://stackoverflow.com/users/76051/carsten"}, "edited": false, "score": 0, "creation_date": 1468613597, "post_id": 38402199, "comment_id": 64217210, "body": "@Carsten - how about for each weight <code>w</code> just replicate it  <code>div 103 w</code> times in the input list?"}, {"owner": {"reputation": 69, "user_id": 5987052, "user_type": "registered", "accept_rate": 100, "profile_image": "https://graph.facebook.com/1267479463266681/picture?type=large", "display_name": "Breno Henrique", "link": "https://stackoverflow.com/users/5987052/breno-henrique"}, "reply_to_user": {"reputation": 48129, "user_id": 76051, "user_type": "registered", "accept_rate": 91, "profile_image": "https://i.stack.imgur.com/AGDxz.jpg?s=128&g=1", "display_name": "Carsten", "link": "https://stackoverflow.com/users/76051/carsten"}, "edited": false, "score": 0, "creation_date": 1468619435, "post_id": 38402199, "comment_id": 64219485, "body": "@Carsten i know this, but i don&#39;t know the haskell implementation of this! Thank you!"}, {"owner": {"reputation": 84731, "user_id": 510937, "user_type": "registered", "accept_rate": 80, "profile_image": "https://www.gravatar.com/avatar/70b13a9ae1aae1ca1aa6ac8dab4643f2?s=128&d=identicon&r=PG", "display_name": "Bakuriu", "link": "https://stackoverflow.com/users/510937/bakuriu"}, "edited": false, "score": 0, "creation_date": 1468621476, "post_id": 38402199, "comment_id": 64220129, "body": "@BrenoHenrique The &quot;algorithm&quot; you described in the previous comments doesn&#39;t always provide the optimal answer. It works only with if the boxes have capacities that at least double each time (BTW: that&#39;s why usually coins come in 1 cent, 2 cent, 5 cent, 10 cent, 20 cent, 50 cent, etc.. because in this way you <i>can</i> use this naive algorithm to compute the change to give)."}, {"owner": {"reputation": 69, "user_id": 5987052, "user_type": "registered", "accept_rate": 100, "profile_image": "https://graph.facebook.com/1267479463266681/picture?type=large", "display_name": "Breno Henrique", "link": "https://stackoverflow.com/users/5987052/breno-henrique"}, "reply_to_user": {"reputation": 84731, "user_id": 510937, "user_type": "registered", "accept_rate": 80, "profile_image": "https://www.gravatar.com/avatar/70b13a9ae1aae1ca1aa6ac8dab4643f2?s=128&d=identicon&r=PG", "display_name": "Bakuriu", "link": "https://stackoverflow.com/users/510937/bakuriu"}, "edited": false, "score": 0, "creation_date": 1468621751, "post_id": 38402199, "comment_id": 64220214, "body": "@Bakuriu ok, do you know how to implement this? in haskell"}], "answers": [{"comments": [{"owner": {"reputation": 69, "user_id": 5987052, "user_type": "registered", "accept_rate": 100, "profile_image": "https://graph.facebook.com/1267479463266681/picture?type=large", "display_name": "Breno Henrique", "link": "https://stackoverflow.com/users/5987052/breno-henrique"}, "edited": false, "score": 0, "creation_date": 1468682809, "post_id": 38406778, "comment_id": 64233106, "body": "but the big boxes have priority to load."}, {"owner": {"reputation": 62252, "user_id": 1435869, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/TrEd9.jpg?s=128&g=1", "display_name": "karakfa", "link": "https://stackoverflow.com/users/1435869/karakfa"}, "reply_to_user": {"reputation": 69, "user_id": 5987052, "user_type": "registered", "accept_rate": 100, "profile_image": "https://graph.facebook.com/1267479463266681/picture?type=large", "display_name": "Breno Henrique", "link": "https://stackoverflow.com/users/5987052/breno-henrique"}, "edited": false, "score": 0, "creation_date": 1468692691, "post_id": 38406778, "comment_id": 64235835, "body": "Isn&#39;t this the solution?  If not spec needs to include the trade-off between component size and unfulfilled capacity."}, {"owner": {"reputation": 69, "user_id": 5987052, "user_type": "registered", "accept_rate": 100, "profile_image": "https://graph.facebook.com/1267479463266681/picture?type=large", "display_name": "Breno Henrique", "link": "https://stackoverflow.com/users/5987052/breno-henrique"}, "edited": false, "score": 0, "creation_date": 1468692830, "post_id": 38406778, "comment_id": 64235867, "body": "output should be:        maximizeLoad 103 [15, 20, 5, 45, 34]      [45, 45, 5, 5]"}, {"owner": {"reputation": 62252, "user_id": 1435869, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/TrEd9.jpg?s=128&g=1", "display_name": "karakfa", "link": "https://stackoverflow.com/users/1435869/karakfa"}, "reply_to_user": {"reputation": 69, "user_id": 5987052, "user_type": "registered", "accept_rate": 100, "profile_image": "https://graph.facebook.com/1267479463266681/picture?type=large", "display_name": "Breno Henrique", "link": "https://stackoverflow.com/users/5987052/breno-henrique"}, "edited": false, "score": 0, "creation_date": 1468693003, "post_id": 38406778, "comment_id": 64235908, "body": "That&#39;s 3 less than 103!  What is the trade-off?  Otherwise, a greedy algorithm will do.  Assume 100 target with <code>[60, 50]</code>  should the solution be <code>[60]</code> or <code>[50, 50]</code>?"}, {"owner": {"reputation": 69, "user_id": 5987052, "user_type": "registered", "accept_rate": 100, "profile_image": "https://graph.facebook.com/1267479463266681/picture?type=large", "display_name": "Breno Henrique", "link": "https://stackoverflow.com/users/5987052/breno-henrique"}, "edited": false, "score": 0, "creation_date": 1468694450, "post_id": 38406778, "comment_id": 64236249, "body": "for the [60, 50], algorithm will output [60]."}, {"owner": {"reputation": 62252, "user_id": 1435869, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/TrEd9.jpg?s=128&g=1", "display_name": "karakfa", "link": "https://stackoverflow.com/users/1435869/karakfa"}, "reply_to_user": {"reputation": 69, "user_id": 5987052, "user_type": "registered", "accept_rate": 100, "profile_image": "https://graph.facebook.com/1267479463266681/picture?type=large", "display_name": "Breno Henrique", "link": "https://stackoverflow.com/users/5987052/breno-henrique"}, "edited": false, "score": 0, "creation_date": 1468696258, "post_id": 38406778, "comment_id": 64236751, "body": "OK, then you just need a greedy algorithm, should be much simpler than my solution which does exhaustive search."}], "tags": [], "owner": {"reputation": 62252, "user_id": 1435869, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/TrEd9.jpg?s=128&g=1", "display_name": "karakfa", "link": "https://stackoverflow.com/users/1435869/karakfa"}, "is_accepted": true, "score": 3, "last_activity_date": 1468697353, "last_edit_date": 1468697353, "creation_date": 1468631033, "answer_id": 38406778, "question_id": 38402199, "link": "https://stackoverflow.com/questions/38402199/greedy-algorithm-implementation-haskell/38406778#38406778", "title": "Greedy algorithm implementation, Haskell", "body": "<p>Bruce force approach with smart filtering</p>\n\n<pre><code>maximumLoad n = head \n              . head \n              . group length \n              . last \n              . group sum \n              . filter ((&lt;= n) . sum)\n              . map concat \n              . sequence \n              . map (rep n)\n              . reverse \n              . sort\n        where rep n x = take ((div n x)+1) $ iterate (x:) []\n              group f = groupBy ((==) `on` f) . sortBy (comparing f) \n\n&gt; maximumLoad 103 [15, 20, 5, 45, 34]\n[34,34,20,15]\n</code></pre>\n\n<p><strong>UPDATE</strong> For the greedy algorithm, it will be much simpler.  I think the code is easy to read to describe the algorithm.  Expects reverse sorted input list.</p>\n\n<pre><code>maxLoad _ [] = []\nmaxLoad n (x:xs) | n==0 = []\n                 | x &lt;= n = x: maxLoad (n-x) (x:xs)\n                 | otherwise = maxLoad n xs\n\n&gt; maxLoad 103 $ reverse $ sort [15, 20, 5, 45, 34]\n[45,45,5,5]\n</code></pre>\n"}], "owner": {"reputation": 69, "user_id": 5987052, "user_type": "registered", "accept_rate": 100, "profile_image": "https://graph.facebook.com/1267479463266681/picture?type=large", "display_name": "Breno Henrique", "link": "https://stackoverflow.com/users/5987052/breno-henrique"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 749, "favorite_count": 0, "closed_date": 1468663747, "accepted_answer_id": 38406778, "answer_count": 1, "score": 0, "last_activity_date": 1468697353, "creation_date": 1468604412, "last_edit_date": 1468696531, "question_id": 38402199, "link": "https://stackoverflow.com/questions/38402199/greedy-algorithm-implementation-haskell", "closed_reason": "Needs more focus", "title": "Greedy algorithm implementation, Haskell", "body": "<p>I need to implement a Haskell function who receives one Int (truck load capacity), and a list of Ints (boxes models that can be loaded on the truck).</p>\n\n<p>To define which box models must be placed preferably in\ntruck, it's requested that the boxes with greater capacity in\nrelation to the available space, always be placed first.</p>\n\n<p>The algorithm should return the list of models of boxes to be placed on truck. I have no idea how to program this a functional paradigm :/</p>\n\n<pre><code>maximizeLoad 103 [15, 20, 5, 45, 34]\n[45, 45, 5, 5]\n</code></pre>\n\n<p>Thanks!</p>\n"}, {"tags": ["sql", "haskell", "yesod", "esqueleto"], "answers": [{"tags": [], "owner": {"reputation": 49959, "user_id": 866915, "user_type": "registered", "accept_rate": 70, "profile_image": "https://www.gravatar.com/avatar/09242131d6e17cbbe31e8547514da6e5?s=128&d=identicon&r=PG", "display_name": "ErikR", "link": "https://stackoverflow.com/users/866915/erikr"}, "is_accepted": true, "score": 4, "last_activity_date": 1468606300, "creation_date": 1468606300, "answer_id": 38402666, "question_id": 38402035, "link": "https://stackoverflow.com/questions/38402035/esqueleto-count-inside-select/38402666#38402666", "title": "Esqueleto count inside select", "body": "<p>The <a href=\"https://hackage.haskell.org/package/esqueleto-2.4.3/docs/Database-Esqueleto.html#v:groupBy\" rel=\"nofollow\"><strong>esqueleto docs for <code>groupBy</code></strong></a> contain good examples of how to use it.</p>\n\n<p>Moreover, by reading through the <a href=\"https://hackage.haskell.org/package/esqueleto-2.4.3/docs/Database-Esqueleto.html#g:3\" rel=\"nofollow\"><strong>Getting Started</strong></a> section, you'll see several example of queries including the equivalent of <code>table.*</code>:</p>\n\n<pre><code>do people &lt;- select $\n             from $ \\person -&gt; do\n             return person\n</code></pre>\n\n<p>Putting the two together means something like this should work:</p>\n\n<pre><code>select $ from \\(g `LeftOuterJoin` gh) -&gt; do\n  on (gu ^. GroupId ==. g ^. Id)\n  groupBy (g ^. Id)\n  return (g, countRows)\n</code></pre>\n"}], "owner": {"reputation": 1336, "user_id": 2801316, "user_type": "registered", "accept_rate": 87, "profile_image": "https://i.stack.imgur.com/cqx1a.jpg?s=128&g=1", "display_name": "FtheBuilder", "link": "https://stackoverflow.com/users/2801316/fthebuilder"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 114, "favorite_count": 0, "accepted_answer_id": 38402666, "answer_count": 1, "score": 1, "last_activity_date": 1468606300, "creation_date": 1468603807, "question_id": 38402035, "link": "https://stackoverflow.com/questions/38402035/esqueleto-count-inside-select", "title": "Esqueleto count inside select", "body": "<p>I have the following <code>Entities</code>:</p>\n\n<pre><code>Group\n  name Text\n\nGroupUser\n  user UserId\n  group GroupId\n</code></pre>\n\n<p>and I would like to do a query like this:</p>\n\n<pre><code>select g.* /* Everything from g */\n     , count(gu.id) groupUsersCount \n  from Group g\n  left outer join GroupUser gu on gu.groupId = g.id\ngroup by g.id\n</code></pre>\n\n<p>Can it be done with <code>Esqueleto</code>?</p>\n"}, {"tags": ["function", "haskell", "monads"], "answers": [{"tags": [], "owner": {"reputation": 1099, "user_id": 6513157, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/3d45981b71a14222513f57e8566e4b8b?s=128&d=identicon&r=PG&f=1", "display_name": "R B", "link": "https://stackoverflow.com/users/6513157/r-b"}, "is_accepted": true, "score": 6, "last_activity_date": 1468603044, "creation_date": 1468603044, "answer_id": 38401829, "question_id": 38401606, "link": "https://stackoverflow.com/questions/38401606/why-does-x-f-x-x-join-f/38401829#38401829", "title": "Why does `\\x -&gt; f x x` = `join f`?", "body": "<p>This is a pretty simple algebraic transformation of the <code>Monad ((-&gt;) r)</code> on the type level. Watch as we specialize and simplify the type of <code>join</code>.</p>\n\n<pre><code>join :: Monad m =&gt; m        (m        a)  -&gt; m        a\njoin ::            ((-&gt;) r) (((-&gt;) r) a)  -&gt; ((-&gt;) r) a  -- Specializing\njoin ::            (r -&gt;    (r -&gt;     a)) -&gt; (r -&gt;    a) -- Infix\njoin ::            (r -&gt;     r -&gt;     a)  -&gt; r  -&gt;    a  -- Simplifying\n</code></pre>\n"}, {"tags": [], "owner": {"reputation": 339851, "user_id": 149392, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/7a561ec0875fcbbe3066ea8fe288ec77?s=128&d=identicon&r=PG", "display_name": "sepp2k", "link": "https://stackoverflow.com/users/149392/sepp2k"}, "is_accepted": false, "score": 3, "last_activity_date": 1468603045, "creation_date": 1468603045, "answer_id": 38401830, "question_id": 38401606, "link": "https://stackoverflow.com/questions/38401606/why-does-x-f-x-x-join-f/38401830#38401830", "title": "Why does `\\x -&gt; f x x` = `join f`?", "body": "<p>If we substitute <code>x -&gt;</code> for <code>m</code> in the type of <code>join</code>, we get <code>(x -&gt; x -&gt; a) -&gt; x -&gt; a</code>. If we apply <code>f</code> to that (which I assume has the type <code>x -&gt; x -&gt; a</code> for some <code>x</code> and <code>a</code>), we get <code>x -&gt; a</code>, which is also the type of <code>\\x -&gt; f x x</code>.</p>\n"}, {"tags": [], "owner": {"reputation": 62252, "user_id": 1435869, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/TrEd9.jpg?s=128&g=1", "display_name": "karakfa", "link": "https://stackoverflow.com/users/1435869/karakfa"}, "is_accepted": false, "score": 3, "last_activity_date": 1468603305, "creation_date": 1468603305, "answer_id": 38401898, "question_id": 38401606, "link": "https://stackoverflow.com/questions/38401606/why-does-x-f-x-x-join-f/38401898#38401898", "title": "Why does `\\x -&gt; f x x` = `join f`?", "body": "<p>no deep insights here, but a mechanical explanation.</p>\n\n<pre><code>instance Monad ((-&gt;) r) where\n    f &gt;&gt;= k = \\ r -&gt; k (f r) r\n</code></pre>\n\n<p>where join is defined as </p>\n\n<pre><code>join f = f &gt;&gt;= id\n</code></pre>\n\n<p>substituting definition</p>\n\n<pre><code>join f = \\x -&gt; id (f x) x\n       = \\x -&gt; f x x\n</code></pre>\n"}], "owner": {"reputation": 1835, "user_id": 6292577, "user_type": "registered", "accept_rate": 70, "profile_image": "https://i.stack.imgur.com/gqMCP.jpg?s=128&g=1", "display_name": "rityzmon", "link": "https://stackoverflow.com/users/6292577/rityzmon"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 246, "favorite_count": 1, "accepted_answer_id": 38401829, "answer_count": 3, "score": 4, "last_activity_date": 1468607165, "creation_date": 1468602197, "last_edit_date": 1468607165, "question_id": 38401606, "link": "https://stackoverflow.com/questions/38401606/why-does-x-f-x-x-join-f", "title": "Why does `\\x -&gt; f x x` = `join f`?", "body": "<p>I found out recently that the pointfree for <code>\\x -&gt; f x x</code> is <code>join f</code>, and wanted to understand why. I started here:</p>\n\n<pre><code>join :: Monad m =&gt; m (m a) -&gt; m a\n</code></pre>\n\n<p>then got stumped because I'm not familiar with the \"function monad\". Could someone help me with the type derivation that explains the equality?</p>\n"}, {"tags": ["haskell"], "answers": [{"tags": [], "owner": {"reputation": 100185, "user_id": 3234959, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/93bb12ca0f93dfddb33880316f7e66c2?s=128&d=identicon&r=PG&f=1", "display_name": "chi", "link": "https://stackoverflow.com/users/3234959/chi"}, "is_accepted": false, "score": 3, "last_activity_date": 1468584445, "last_edit_date": 1468584445, "creation_date": 1468583989, "answer_id": 38395599, "question_id": 38395117, "link": "https://stackoverflow.com/questions/38395117/why-does-replacing-the-dollar-sign-with-parentheses-in-this-expression-leads/38395599#38395599", "title": "Why does replacing the dollar sign ($) with parentheses in this expression leads to an error?", "body": "<pre><code>foldr (-) 0 . map (uncurry (*)) $ coords 5 7\n-- is equivalent to\n( foldr (-) 0 . map (uncurry (*)) )  (coords 5 7)\n-- and to\nfoldr (-) 0 ( map (uncurry (*)) (coords 5 7) )\n\n\nfoldr (-) 0 . map (uncurry (*)) (coords 5 7)\n-- is equivalent to\nfoldr (-) 0 . ( map (uncurry (*)) (coords 5 7) )\n-- and to\n\\x -&gt; foldr (-) 0 ( map (uncurry (*)) (coords 5 7) x)\n</code></pre>\n\n<p>In the latter, the result of <code>map (uncurry (*)) (coords 5 7)</code> is passed to <code>.</code> as its second argument, but it's a list, not a function, so a type error arises.</p>\n\n<p>Note that is is also OK:</p>\n\n<pre><code>foldr (-) 0 $ map (uncurry (*)) (coords 5 7)\n</code></pre>\n"}, {"comments": [{"owner": {"reputation": 77, "user_id": 6593955, "user_type": "registered", "accept_rate": 50, "profile_image": "https://www.gravatar.com/avatar/68a10f6edad741147d93d02207e62db1?s=128&d=identicon&r=PG&f=1", "display_name": "linjunshi", "link": "https://stackoverflow.com/users/6593955/linjunshi"}, "edited": false, "score": 0, "creation_date": 1468661590, "post_id": 38395630, "comment_id": 64227657, "body": "I see now, thanks, I am wondering why (uncurry (*)) ) as a argument with a () didn&#39;t cause the problem but the last argument (coords 5 7) did? and btw, what if there are multiple $ in the expression? How would the interpreter interpret the expression?"}], "tags": [], "owner": {"reputation": 94713, "user_id": 1139697, "user_type": "registered", "accept_rate": 86, "profile_image": "https://www.gravatar.com/avatar/5f136ddb684f39aaee1c028ee1950f6f?s=128&d=identicon&r=PG", "display_name": "Zeta", "link": "https://stackoverflow.com/users/1139697/zeta"}, "is_accepted": true, "score": 3, "last_activity_date": 1468584080, "creation_date": 1468584080, "answer_id": 38395630, "question_id": 38395117, "link": "https://stackoverflow.com/questions/38395117/why-does-replacing-the-dollar-sign-with-parentheses-in-this-expression-leads/38395630#38395630", "title": "Why does replacing the dollar sign ($) with parentheses in this expression leads to an error?", "body": "<p>There's an easier example:</p>\n\n<pre><code>Prelude&gt; id . id $ \"Example\"\n\"Example\"\nPrelude&gt; id . id (\"Example\")\n&lt;interactive&gt;:2:10:\n    Couldn't match expected type \u2018a -&gt; c\u2019 with actual type \u2018[Char]\u2019\n    Relevant bindings include it :: a -&gt; c (bound at &lt;interactive&gt;:2:1)\n    In the first argument of \u2018id\u2019, namely \u2018(\"Example\")\u2019\n    In the second argument of \u2018(.)\u2019, namely \u2018id (\"Example\")\u2019\n    In the expression: id . id (\"Example\")\n</code></pre>\n\n<p>The problem is that function application binds stronger than <code>(.)</code>. The fixity level of <code>($)</code> fixes this:</p>\n\n<pre><code>id . id $ \"Example\" = (id . id) $ \"Example\"\n                    = (id . id) \"Example\"\n</code></pre>\n\n<p>However, with <code>(...)</code>, the function application wins and you end up using <code>(.)</code> with a non-function as second argument:</p>\n\n<pre><code>id . id (\"Example\") = id . id \"Example\"\n                    = id . (id \"Example\") -- apply id\n                    = id . (\"Example\")\n                    = type error, since \"Example\" isn't a function\n</code></pre>\n"}, {"tags": [], "owner": {"reputation": 100892, "user_id": 745903, "user_type": "registered", "accept_rate": 74, "profile_image": "https://www.gravatar.com/avatar/50933f6638836741e620669b3940410e?s=128&d=identicon&r=PG", "display_name": "leftaroundabout", "link": "https://stackoverflow.com/users/745903/leftaroundabout"}, "is_accepted": false, "score": 2, "last_activity_date": 1468584272, "creation_date": 1468584272, "answer_id": 38395680, "question_id": 38395117, "link": "https://stackoverflow.com/questions/38395117/why-does-replacing-the-dollar-sign-with-parentheses-in-this-expression-leads/38395680#38395680", "title": "Why does replacing the dollar sign ($) with parentheses in this expression leads to an error?", "body": "<p><code>$</code> is simply a no-op in infix form. Because it's an infix operator with low fixity:</p>\n\n<pre><code>GHCi&gt; :i $\n($) :: (a -&gt; b) -&gt; a -&gt; b   -- Defined in \u2018GHC.Base\u2019\ninfixr 0 $\n</code></pre>\n\n<p>any expression in which it occurs is parsed <em>as if</em> it had parenthesis. In your example, </p>\n\n<pre><code>foldr (-) 0 . map (uncurry (*)) $ coords 5 7\n</code></pre>\n\n<p>is parsed as</p>\n\n<pre><code>  (   (foldr (-) 0)\n    . (map (uncurry (*))) )\n$ (coords 5 7)\n</code></pre>\n\n<p>because <code>$</code> has lower fixity than <code>.</code>. This works in exactly the same way as if you write <code>1 + 2 * 3</code>: this is parsed as <code>(1) + (2*3)</code>, because <code>*</code> has higher fixity than <code>+</code>.</p>\n\n<p>When the <code>$</code> operator is then <em>evaluated</em>, all it does is apply the function on the LHS \u2013 in you case, this is <code>foldr (-) 0 . map (uncurry (*))</code> \u2013 to the RHS expression <code>coords 5 7</code>. Applying a function to its argument is of course also exactly what happens if you just wrote <code>function (argument)</code>, however you need to specify the correct function! To write you example without <code>$</code>, you must group it as</p>\n\n<pre><code>( foldr (-) 0 . map (uncurry (*)) ) (coords 5 7)\n</code></pre>\n\n<p>whereas your attempt is parsed differently: function application binds more tightly than any infix, even <code>.</code>, so your attempt is equivalent to</p>\n\n<pre><code>foldr (-) 0 . ( map (uncurry (*)) (coords 5 7) )\n</code></pre>\n\n<p>which doesn't make sense.</p>\n"}], "owner": {"reputation": 77, "user_id": 6593955, "user_type": "registered", "accept_rate": 50, "profile_image": "https://www.gravatar.com/avatar/68a10f6edad741147d93d02207e62db1?s=128&d=identicon&r=PG&f=1", "display_name": "linjunshi", "link": "https://stackoverflow.com/users/6593955/linjunshi"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 499, "favorite_count": 0, "closed_date": 1468595895, "accepted_answer_id": 38395630, "answer_count": 3, "score": 2, "last_activity_date": 1522503761, "creation_date": 1468582468, "last_edit_date": 1522503761, "question_id": 38395117, "link": "https://stackoverflow.com/questions/38395117/why-does-replacing-the-dollar-sign-with-parentheses-in-this-expression-leads", "closed_reason": "Duplicate", "title": "Why does replacing the dollar sign ($) with parentheses in this expression leads to an error?", "body": "<p>I have these two expressions:</p>\n\n<ol>\n<li><p><code>foldr (-) 0 . map (uncurry (*)) $ coords 5 7</code></p></li>\n<li><p><code>foldr (-) 0 . map (uncurry (*)) (coords 5 7)</code></p></li>\n</ol>\n\n<p>The (1) works print out the result, but (2) have error says:</p>\n\n<pre><code>&lt;interactive&gt;:50:15:\n    Couldn't match expected type \u2018a -&gt; t0 c\u2019\n                with actual type \u2018[Integer]\u2019\n    Relevant bindings include\n      it :: a -&gt; c (bound at &lt;interactive&gt;:50:1)\n    Possible cause: \u2018map\u2019 is applied to too many arguments\n    In the second argument of \u2018(.)\u2019, namely\n      \u2018map (uncurry (*)) (coords 5 7)\u2019\n    In the expression: foldr (-) 0 . map (uncurry (*)) (coords 5 7)\n</code></pre>\n\n<p>Can any one tell me what's the difference between these two? Thanks.</p>\n"}, {"tags": ["haskell"], "answers": [{"tags": [], "owner": {"reputation": 100185, "user_id": 3234959, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/93bb12ca0f93dfddb33880316f7e66c2?s=128&d=identicon&r=PG&f=1", "display_name": "chi", "link": "https://stackoverflow.com/users/3234959/chi"}, "is_accepted": true, "score": 2, "last_activity_date": 1468584676, "creation_date": 1468584676, "answer_id": 38395808, "question_id": 38394803, "link": "https://stackoverflow.com/questions/38394803/normal-applicative-order-reduction/38395808#38395808", "title": "Normal/Applicative Order Reduction", "body": "<p>The GHC runtime does not use a term reduction strategy, since that would be very inefficient. Indeed, GHC is a proper compiler, targeting the STG-machine as an abstract machine for its runtime.</p>\n\n<p>Still, it achieves the same semantics of normal order reduction -- i.e. non-strict semantics.</p>\n\n<p>One can still force some arguments to be evaluated, as in applicative order reduction as follows:</p>\n\n<pre><code>foo x y = x `seq` actualFoo x y\n</code></pre>\n\n<p>Above, <code>x</code> is evaluated immediately, while <code>y</code> is not.</p>\n\n<p>Other common equivalent patterns:</p>\n\n<pre><code>foo x y | seq x False = undefined\nfoo x y = actualFoo x y\n\n-- or, with a GHC extension\n\nfoo !x y = actualFoo x y\n</code></pre>\n"}], "owner": {"reputation": 9225, "user_id": 3248346, "user_type": "registered", "accept_rate": 68, "profile_image": "https://www.gravatar.com/avatar/377f7423a286949201e0aa8cb2257fcc?s=128&d=identicon&r=PG&f=1", "display_name": "M.K.", "link": "https://stackoverflow.com/users/3248346/m-k"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 498, "favorite_count": 0, "accepted_answer_id": 38395808, "answer_count": 1, "score": 3, "last_activity_date": 1468584676, "creation_date": 1468581409, "question_id": 38394803, "link": "https://stackoverflow.com/questions/38394803/normal-applicative-order-reduction", "title": "Normal/Applicative Order Reduction", "body": "<p>In terms of evaluating function applications does Haskell only support normal order reduction or does it also support applicative order reduction? Am I correct in thinking that normal order is what gives Haskell its laziness?</p>\n"}, {"tags": ["haskell", "memoization", "monad-transformers", "state-monad", "free-monad"], "answers": [{"tags": [], "owner": {"reputation": 2831, "user_id": 183792, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/9ddcfbc6c31012fd25384f6301363347?s=128&d=identicon&r=PG&f=1", "display_name": "Michael", "link": "https://stackoverflow.com/users/183792/michael"}, "is_accepted": true, "score": 2, "last_activity_date": 1468602270, "last_edit_date": 1468602270, "creation_date": 1468582304, "answer_id": 38395068, "question_id": 38392568, "link": "https://stackoverflow.com/questions/38392568/haskell-memoising-using-monadstate-inside-a-freemonad-interpreter/38395068#38395068", "title": "Haskell: Memoising using MonadState inside a FreeMonad Interpreter", "body": "<p>Use <code>iterTM</code> instead of <code>iterT</code>:</p>\n\n<pre><code>runMyDsl :: (MonadLogger m, MonadIO m, MonadCatch m) =&gt; MyDslT m a -&gt; m a\nrunMyDsl dsl = evalStateT (iterTM run dsl) Map.empty\n  where\n  run (Log message continue)      = logger message &gt;&gt; continue\n  run (GetThingById id' continue) = do\n    m &lt;- get \n    case Map.lookup id' m of\n      Nothing -&gt; do \n         thing &lt;- getThingById id' \n         put (Map.insert id' thing m)\n         continue thing\n      Just thing -&gt; continue thing\n</code></pre>\n\n<p>Equivalently, you can use <code>iterT</code> if you first raise <code>MyDsl m a</code> to an <code>MyDsl (StateT Int m) a</code> using <code>hoistFT lift</code>, like so: </p>\n\n<pre><code>runMyDsl :: (MonadLogger m, MonadIO m, MonadCatch m) =&gt; MyDslT m a -&gt; m a\nrunMyDsl dsl = evalStateT (iterT run (hoistFT lift dsl)) Map.empty\n</code></pre>\n\n<p>This makes <code>dsl</code> into a <code>MyDsl (StateT Int m) a</code> that doesn't actually involve any state updates, though <code>run</code> does involve state transitions.</p>\n"}], "owner": {"reputation": 365, "user_id": 1560138, "user_type": "registered", "accept_rate": 89, "profile_image": "https://www.gravatar.com/avatar/370b89d2b931def9f3df67326283b295?s=128&d=identicon&r=PG", "display_name": "tmortiboy", "link": "https://stackoverflow.com/users/1560138/tmortiboy"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 133, "favorite_count": 0, "accepted_answer_id": 38395068, "answer_count": 1, "score": 2, "last_activity_date": 1468602270, "creation_date": 1468574886, "question_id": 38392568, "link": "https://stackoverflow.com/questions/38392568/haskell-memoising-using-monadstate-inside-a-freemonad-interpreter", "title": "Haskell: Memoising using MonadState inside a FreeMonad Interpreter", "body": "<p>Given that I have the following DSL (using a Free Monad) and its interpreter:</p>\n\n<pre><code>data MyDslF next =\n    GetThingById Int (Thing -&gt; next)\n  | Log Text next\n\ntype MyDslT = FT MyDslF\n\nrunMyDsl :: (MonadLogger m, MonadIO m, MonadCatch m) =&gt; MyDslT m a -&gt; m a\nrunMyDsl = iterT run\n  where\n    run :: (MonadLogger m, MonadIO m, MonadCatch m) =&gt; MyDslF (m a) -&gt; m a\n    run (Log message continue)      = Logger.log message &gt;&gt; continue\n    run (GetThingById id' continue) = SomeApi.getThingById id' &gt;&gt;= continue\n</code></pre>\n\n<p>I would like to change the interpreter internally to use MonadState so that if a <code>Thing</code> has already been retrieved for a given <code>Id</code>, then there is no second call to <code>SomeApi</code></p>\n\n<p>Lets assume I already know how to write the memoised version using <code>get</code> and <code>put</code>, but the problem I am having is running the <code>MonadState</code> inside <code>runMyDsl</code>.\nI was thinking the solution would look similar to:</p>\n\n<pre><code>type ThingMap = Map Int Thing\n\nrunMyDsl :: (MonadLogger m, MonadIO m, MonadCatch m) =&gt; MyDslT m a -&gt; m a\nrunMyDsl = flip evalStateT mempty . iterT run\n  where\n    run :: (MonadLogger m, MonadIO m, MonadCatch m, MonadState ThingMap m) =&gt; MyDslF (m a) -&gt; m a\n    run ..\n</code></pre>\n\n<p>But the types do not align, since <code>run</code> returns <code>(.. , MonadState ThingMap m) =&gt; m a</code> and <code>evalStateT</code> expects <code>StateT ThingMap m a</code>.</p>\n"}, {"tags": ["haskell", "design-patterns", "f#"], "comments": [{"owner": {"reputation": 24860, "user_id": 124259, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/1d025118a63330a62aeaff66a420e8b1?s=128&d=identicon&r=PG&f=1", "display_name": "John Palmer", "link": "https://stackoverflow.com/users/124259/john-palmer"}, "edited": false, "score": 1, "creation_date": 1468571700, "post_id": 38390690, "comment_id": 64191688, "body": "I imagine you can cheat if you used some C# with the F# by taking advantage of the way the DU is compiled."}, {"owner": {"reputation": 8452, "user_id": 621427, "user_type": "registered", "accept_rate": 74, "profile_image": "https://i.stack.imgur.com/0eFAm.png?s=128&g=1", "display_name": "robkuz", "link": "https://stackoverflow.com/users/621427/robkuz"}, "reply_to_user": {"reputation": 24860, "user_id": 124259, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/1d025118a63330a62aeaff66a420e8b1?s=128&d=identicon&r=PG&f=1", "display_name": "John Palmer", "link": "https://stackoverflow.com/users/124259/john-palmer"}, "edited": false, "score": 0, "creation_date": 1468571745, "post_id": 38390690, "comment_id": 64191726, "body": "@JohnPalmer ah, no cheating and C# allowed. sorry. ;-)"}], "answers": [{"comments": [{"owner": {"reputation": 8452, "user_id": 621427, "user_type": "registered", "accept_rate": 74, "profile_image": "https://i.stack.imgur.com/0eFAm.png?s=128&g=1", "display_name": "robkuz", "link": "https://stackoverflow.com/users/621427/robkuz"}, "edited": false, "score": 0, "creation_date": 1468571855, "post_id": 38391365, "comment_id": 64191800, "body": "thanks @josejuan. could you explain what the code starting at line 6 does (the type constructor for Amount) or give me a direction where to read it."}, {"owner": {"reputation": 100185, "user_id": 3234959, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/93bb12ca0f93dfddb33880316f7e66c2?s=128&d=identicon&r=PG&f=1", "display_name": "chi", "link": "https://stackoverflow.com/users/3234959/chi"}, "edited": false, "score": 0, "creation_date": 1468575165, "post_id": 38391365, "comment_id": 64193920, "body": "Note that the first <code>data Amount</code> is not really a GADT, but only a phantom type too like the second one. No GADTs have been used here, only their syntax."}], "tags": [], "owner": {"reputation": 6942, "user_id": 1540749, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/dd6c24a0bc5c0a59a456aa8b08a78b6a?s=128&d=identicon&r=PG", "display_name": "josejuan", "link": "https://stackoverflow.com/users/1540749/josejuan"}, "is_accepted": true, "score": 4, "last_activity_date": 1468574558, "last_edit_date": 1468574558, "creation_date": 1468571202, "answer_id": 38391365, "question_id": 38390690, "link": "https://stackoverflow.com/questions/38390690/how-to-restrict-a-du-adt-to-certain-case-identifiers-value-constructors/38391365#38391365", "title": "How to restrict a DU/ADT to certain case identifiers/value constructors", "body": "<p>A <em>\"direct\"</em> translation could be</p>\n\n<pre><code>{-# LANGUAGE GADTs, DataKinds, KindSignatures #-}\n\ndata Currency = USD | EUR deriving Show\n\n-- We use `Currency` values to create `Amount` types\n--   read about types in Haskell ([Kinds][1]: *, * -&gt; *, ...)\n--   here we fix one * to be Currency\ndata Amount :: Currency -&gt; * where\n     -- Data constructor, take one float and return some Amount\n     Amount :: Float -&gt; Amount a\n\n-- Extract the specific currency symbol require extra effort\ninstance Show (Amount a) where\n    show (Amount k) = show k\n\n-- Many amounts (same currency)\n-- `a` restrict `a1` and `a1` to have the same type =&gt; the same currency\ndata PData a = PData { a1 :: Amount a\n                     , a2 :: Amount a\n                     } deriving Show\n\n-- Helpers\nusd :: Float -&gt; Amount USD\nusd = Amount\n\neur :: Float -&gt; Amount EUR\neur = Amount\n\nmain = do\n\n    print $ PData (usd 3) (usd 4)  -- OK\n    print $ PData (eur 3) (eur 4)  -- OK\n    print $ PData (eur 3) (usd 4)  -- KO, Couldn't match type 'USD with 'EUR\n</code></pre>\n\n<p>(1) <a href=\"https://wiki.haskell.org/Kind\" rel=\"nofollow\">https://wiki.haskell.org/Kind</a></p>\n\n<p>On the other hand, @TheInnerLight remember me you can use <a href=\"https://wiki.haskell.org/Phantom_type\" rel=\"nofollow\">phantom types</a></p>\n\n<pre><code>-- NOTE: this is not a \"direct translation\" since currencies are not\n--       enumerated and is slightly different\ndata USD = USD\ndata EUR = EUR\n\ndata Amount c = Amount { amount :: Float }\n\ninstance Show (Amount c) where\n    show (Amount a) = show a\n\ndata PData c = PData { c1 :: Amount c\n                     , c2 :: Amount c }\n                       deriving Show\n\nusd :: Float -&gt; Amount USD\nusd = Amount\n\neur :: Float -&gt; Amount EUR\neur = Amount\n\nmain = do\n\n    print $ PData (usd 3) (usd 4)  -- OK\n    print $ PData (eur 3) (eur 4)  -- OK\n    print $ PData (eur 3) (usd 4)  -- KO, Couldn't match type 'USD with 'EUR\n</code></pre>\n\n<p>One way to extract currency symbols (or any other data) could be</p>\n\n<pre><code>class    Symbol c   where symbol :: c -&gt; String\ninstance Symbol USD where symbol _ = \"USD\"\ninstance Symbol EUR where symbol _ = \"EUR\"\n\ninstance Symbol c =&gt; Show (Amount c) where\n    show s@(Amount a) = sym undefined s ++ \" \" ++ show a\n                        where sym :: Symbol c =&gt; c -&gt; Amount c -&gt; String\n                              sym k _ = symbol k\n</code></pre>\n\n<p>printing</p>\n\n<pre><code>PData {c1 = USD 3.0, c2 = USD 4.0}\nPData {c1 = EUR 3.0, c2 = EUR 4.0}\n</code></pre>\n"}, {"comments": [{"owner": {"reputation": 8452, "user_id": 621427, "user_type": "registered", "accept_rate": 74, "profile_image": "https://i.stack.imgur.com/0eFAm.png?s=128&g=1", "display_name": "robkuz", "link": "https://stackoverflow.com/users/621427/robkuz"}, "edited": false, "score": 0, "creation_date": 1468572464, "post_id": 38391616, "comment_id": 64192185, "body": "thanks @klasske.   actually your solution is pretty close to using Units of Measurement in F#. And probably if you go that route one should simply use Measurements me thinks as you can easily constrain the parameter to only measurement types."}], "tags": [], "owner": {"reputation": 2094, "user_id": 3929902, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/DDmIg.png?s=128&g=1", "display_name": "klasske", "link": "https://stackoverflow.com/users/3929902/klasske"}, "is_accepted": false, "score": 3, "last_activity_date": 1468571975, "last_edit_date": 1495542399, "creation_date": 1468571975, "answer_id": 38391616, "question_id": 38390690, "link": "https://stackoverflow.com/questions/38390690/how-to-restrict-a-du-adt-to-certain-case-identifiers-value-constructors/38391616#38391616", "title": "How to restrict a DU/ADT to certain case identifiers/value constructors", "body": "<p>You can't directly compare subtypes of DUs in F# (also see this answer: <a href=\"https://stackoverflow.com/a/30841893/3929902\">https://stackoverflow.com/a/30841893/3929902</a> ), but you could use this roundabout way of achieving it:</p>\n\n<pre><code>type USD =\n    Amount of decimal\ntype EUR =\n    Amount of decimal\n\ntype Currency = \n    | USD of USD\n    | EUR of EUR\n\ntype PositionalData&lt;'T&gt; =\n  {\n      grossAmount: 'T\n      pos1: 'T\n      pos2: 'T\n  }        \n\nlet valid = {\n    grossAmount = USD.Amount 10.0m;\n    pos1 = USD.Amount 7.0m;\n    pos2 = USD.Amount 3.0m;\n}\n\nlet wrong = {\n    grossAmount = USD.Amount 10.0m;\n    pos1 = USD.Amount 7.0m;\n    pos2 = EUR.Amount 3.0m;\n}\n</code></pre>\n\n<p>An obvious problem with this answer though is that PositionalData is not constrained to Currency, but can be of any type</p>\n"}, {"tags": [], "owner": {"reputation": 11496, "user_id": 5438433, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/OJ1qY.png?s=128&g=1", "display_name": "TheInnerLight", "link": "https://stackoverflow.com/users/5438433/theinnerlight"}, "is_accepted": false, "score": 3, "last_activity_date": 1468573485, "last_edit_date": 1495535328, "creation_date": 1468573485, "answer_id": 38392127, "question_id": 38390690, "link": "https://stackoverflow.com/questions/38390690/how-to-restrict-a-du-adt-to-certain-case-identifiers-value-constructors/38392127#38392127", "title": "How to restrict a DU/ADT to certain case identifiers/value constructors", "body": "<p>There is no way to constrain to a particular union case because they aren't, themselves, types.  That means that the union case a particular value belongs to isn't available at compile time.</p>\n\n<p>For this particular case, as you point out in your question, I would use units of measure rather the discriminated unions to solve the problem in F#.</p>\n\n<p>To solve the problem more generally, it's generally better to invert the relationship to something like this:</p>\n\n<pre><code>type PositionalData = {\n    grossAmount: decimal;\n    pos1: decimal;\n    pos2: decimal;\n}\n\ntype Currency =\n    | USD of PositionalData\n    | EUR of PositionalData\n</code></pre>\n\n<p>You could make this applicable beyond <code>PositionalData</code> with a type like:</p>\n\n<pre><code>type Currency&lt;'a&gt; =\n    | USD of 'a\n    | EUR of 'a\n</code></pre>\n\n<p>For the Haskell case, I recommend reviewing <a href=\"https://stackoverflow.com/questions/35279100/in-haskell-how-do-you-restrict-functions-to-only-one-constructor-of-a-data-type\">this answer</a>.</p>\n"}], "owner": {"reputation": 8452, "user_id": 621427, "user_type": "registered", "accept_rate": 74, "profile_image": "https://i.stack.imgur.com/0eFAm.png?s=128&g=1", "display_name": "robkuz", "link": "https://stackoverflow.com/users/621427/robkuz"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 168, "favorite_count": 0, "accepted_answer_id": 38391365, "answer_count": 3, "score": 4, "last_activity_date": 1468574558, "creation_date": 1468569036, "question_id": 38390690, "link": "https://stackoverflow.com/questions/38390690/how-to-restrict-a-du-adt-to-certain-case-identifiers-value-constructors", "title": "How to restrict a DU/ADT to certain case identifiers/value constructors", "body": "<p>How would I approach  the following situatiuon?<br>\nI have a DU (for example a Currency) and some record type.\nNow for the record type fields I have the requierements that the actual values for a given instance should al be of the same case identifier (or in Haskell the same value constructor)</p>\n\n<pre><code>type Currency =\n    | USD of decimal\n    | EUR of decimal\n\ntype PositionalData = {\n    grossAmount: Currency;\n    pos1: Currency;\n    pos2: Currency;\n}\n</code></pre>\n\n<p>for example the following is valid</p>\n\n<pre><code>let valid = {\n    grossAmount = USD 10.0m;\n    pos1 = USD 7.0m;\n    pos2 = USD 3.0m;\n}\n</code></pre>\n\n<p>where as this example should be invalid</p>\n\n<pre><code>let wrong = {\n    grossAmount = USD 10.0m;\n    pos1 = USD 7.0m;\n    pos2 = EUR 3.0m;\n    ^^^^^^^^^^^^^^^^\n}\n</code></pre>\n\n<p>I know this particular example can be solved in F# using Units of Measurement. But its easy to envision an example that is not solvable via that mechanism.\nSo I like to ask you to consider a more generic answer and not necessarily one that just solves the give code example.</p>\n\n<p>Looking forward to your brain dumps ;-)</p>\n\n<p>PS: for all the Haskeleers around - It would be interesting to see how ADT (maybe in combination wit higher kinded types) can solve that.</p>\n"}, {"tags": ["haskell", "frp"], "comments": [{"owner": {"reputation": 94713, "user_id": 1139697, "user_type": "registered", "accept_rate": 86, "profile_image": "https://www.gravatar.com/avatar/5f136ddb684f39aaee1c028ee1950f6f?s=128&d=identicon&r=PG", "display_name": "Zeta", "link": "https://stackoverflow.com/users/1139697/zeta"}, "edited": false, "score": 1, "creation_date": 1468568113, "post_id": 38388773, "comment_id": 64189570, "body": "I think that&#39;s too broad, asking for a off-site resource, is opinion based  <i>and</i> leads to a discussion. You&#39;re probably better off at the haskell-cafe mailing list, /r/reddit or other similar sites."}, {"owner": {"reputation": 1029, "user_id": 668074, "user_type": "registered", "accept_rate": 59, "profile_image": "https://www.gravatar.com/avatar/f82d3dd033cd691ad5340b9620bdcf38?s=128&d=identicon&r=PG", "display_name": "user668074", "link": "https://stackoverflow.com/users/668074/user668074"}, "reply_to_user": {"reputation": 94713, "user_id": 1139697, "user_type": "registered", "accept_rate": 86, "profile_image": "https://www.gravatar.com/avatar/5f136ddb684f39aaee1c028ee1950f6f?s=128&d=identicon&r=PG", "display_name": "Zeta", "link": "https://stackoverflow.com/users/1139697/zeta"}, "edited": false, "score": 0, "creation_date": 1468569801, "post_id": 38388773, "comment_id": 64190547, "body": "Is it less broad if I restrict my question to comparing Yampa, netwire, and reactive-banana? Part of the reason I asked this question is the other related questions on this site are a bit out of date (by several years) and I wanted to gather more recent information."}, {"owner": {"reputation": 2831, "user_id": 183792, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/9ddcfbc6c31012fd25384f6301363347?s=128&d=identicon&r=PG&f=1", "display_name": "Michael", "link": "https://stackoverflow.com/users/183792/michael"}, "edited": false, "score": 0, "creation_date": 1468588664, "post_id": 38388773, "comment_id": 64202522, "body": "You should add <code>reflex</code> to the list of packages you ask about <a href=\"https://hackage.haskell.org/package/reflex\" rel=\"nofollow noreferrer\">hackage.haskell.org/package/reflex</a>  <a href=\"https://www.reddit.com/r/reflexfrp/\" rel=\"nofollow noreferrer\">reddit.com/r/reflexfrp</a>  on irc #reflex-frp , not sure what other things..."}], "answers": [{"tags": [], "owner": {"reputation": 587, "user_id": 1015602, "user_type": "registered", "accept_rate": 58, "profile_image": "https://www.gravatar.com/avatar/ea1629e2c2d1d82ab8c3645d82ecc60d?s=128&d=identicon&r=PG", "display_name": "Free_D", "link": "https://stackoverflow.com/users/1015602/free-d"}, "is_accepted": false, "score": 3, "last_activity_date": 1468592942, "creation_date": 1468592942, "answer_id": 38398673, "question_id": 38388773, "link": "https://stackoverflow.com/questions/38388773/comparing-functional-reactive-programming-packages-in-haskell/38398673#38398673", "title": "Comparing Functional Reactive Programming packages in Haskell", "body": "<p>I found this link very helpful for comparing FRP libraries.  It gives example code for a simple application written in each library.</p>\n\n<p><a href=\"https://github.com/gelisam/frp-zoo\" rel=\"nofollow\">https://github.com/gelisam/frp-zoo</a></p>\n"}], "owner": {"reputation": 1029, "user_id": 668074, "user_type": "registered", "accept_rate": 59, "profile_image": "https://www.gravatar.com/avatar/f82d3dd033cd691ad5340b9620bdcf38?s=128&d=identicon&r=PG", "display_name": "user668074", "link": "https://stackoverflow.com/users/668074/user668074"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 525, "favorite_count": 0, "closed_date": 1468629652, "answer_count": 1, "score": 4, "last_activity_date": 1468592942, "creation_date": 1468562110, "last_edit_date": 1495541289, "question_id": 38388773, "link": "https://stackoverflow.com/questions/38388773/comparing-functional-reactive-programming-packages-in-haskell", "closed_reason": "Needs more focus", "title": "Comparing Functional Reactive Programming packages in Haskell", "body": "<p>I am new to functional reactive programming and I would like to know how different packages compare in Haskell. They all seem to have slightly different approaches and I don't know enough to choose between them.</p>\n\n<p>I also think that the available information for some of the packages is out of date. <a href=\"https://stackoverflow.com/questions/13341937/whats-the-status-of-current-functional-reactive-programming-implementations\">This</a> previous Stack Overflow question recommends either <code>netwire</code> or <code>reactive-banana</code> but currently <code>netwire</code> won't install with <code>stack</code> because it depends on an out of date <code>profunctors</code> package.</p>\n\n<p>So basically, for a beginner, how do the various FRP packages compare against each other? And which are best for GUI applications and which are best for simulation/game applications?</p>\n\n<p>Thanks,</p>\n"}, {"tags": ["haskell"], "comments": [{"owner": {"reputation": 126897, "user_id": 791604, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/ce991df7a056248d5e4f6fc3659ba733?s=128&d=identicon&r=PG", "display_name": "Daniel Wagner", "link": "https://stackoverflow.com/users/791604/daniel-wagner"}, "edited": false, "score": 2, "creation_date": 1468601679, "post_id": 38385666, "comment_id": 64211023, "body": "Everything about the design of Haskell is supposed to discourage the use of globals this way -- and for good reason; globals cause code not to be compositional and encourage subtle coupling, two sources of subtle bugs that can be tricky to track down. I would think twice and maybe thrice before using <code>unsafePerformIO</code> over <code>ReaderT</code>."}, {"owner": {"reputation": 971, "user_id": 1263037, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/20a7364d5fd4920c0b718f7005b763d7?s=128&d=identicon&r=PG", "display_name": "Richard E. Silverman", "link": "https://stackoverflow.com/users/1263037/richard-e-silverman"}, "reply_to_user": {"reputation": 126897, "user_id": 791604, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/ce991df7a056248d5e4f6fc3659ba733?s=128&d=identicon&r=PG", "display_name": "Daniel Wagner", "link": "https://stackoverflow.com/users/791604/daniel-wagner"}, "edited": false, "score": 0, "creation_date": 1468626426, "post_id": 38385666, "comment_id": 64221331, "body": "Thanks, but I don\u2019t see how your comment relates to my question; I think you\u2019re oversimplifying. Global mutable state is problematic and discouraged in favor of other mechanisms. This is not global mutable state; it is global constants whose values are initialized from the outside world and thereafter do not change. There are many applications of <code>unsafePerformIO</code> that range from entirely innocuous to wholly unsuitable; I think this occupies a middle ground that is worth discussing (more interesting is whether this is a usage that should be supported in some more direct and safe way)."}, {"owner": {"reputation": 971, "user_id": 1263037, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/20a7364d5fd4920c0b718f7005b763d7?s=128&d=identicon&r=PG", "display_name": "Richard E. Silverman", "link": "https://stackoverflow.com/users/1263037/richard-e-silverman"}, "reply_to_user": {"reputation": 126897, "user_id": 791604, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/ce991df7a056248d5e4f6fc3659ba733?s=128&d=identicon&r=PG", "display_name": "Daniel Wagner", "link": "https://stackoverflow.com/users/791604/daniel-wagner"}, "edited": false, "score": 0, "creation_date": 1468627270, "post_id": 38385666, "comment_id": 64221469, "body": "Another way to think about this: the class of behaviors I\u2019m talking about could be obtained in the following clunky way: run a program that fetches some data via I/O; take the results and substitute them into the template text of the main program, as the values of some global bindings; then compile and run the main program. You would then safely have the advantage of referring to those constants easily throughout the program. It seems that it should not be so hard to implement this pattern directly."}, {"owner": {"reputation": 126897, "user_id": 791604, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/ce991df7a056248d5e4f6fc3659ba733?s=128&d=identicon&r=PG", "display_name": "Daniel Wagner", "link": "https://stackoverflow.com/users/791604/daniel-wagner"}, "edited": false, "score": 1, "creation_date": 1468627941, "post_id": 38385666, "comment_id": 64221564, "body": "The difference being, of course, that the distinction between parts of the program that rely on configuration information -- hence may be coupled to other actions that also rely on the configuration -- and the parts that are independent of configuration is no longer transparently available by their types. This additionally makes reasoning about program behavior more difficult; because one may no longer rely on the sanctity of types and must therefore <i>always</i> inspect the implementation to discover whether the configuration is consulted or not."}, {"owner": {"reputation": 971, "user_id": 1263037, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/20a7364d5fd4920c0b718f7005b763d7?s=128&d=identicon&r=PG", "display_name": "Richard E. Silverman", "link": "https://stackoverflow.com/users/1263037/richard-e-silverman"}, "reply_to_user": {"reputation": 126897, "user_id": 791604, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/ce991df7a056248d5e4f6fc3659ba733?s=128&d=identicon&r=PG", "display_name": "Daniel Wagner", "link": "https://stackoverflow.com/users/791604/daniel-wagner"}, "edited": false, "score": 0, "creation_date": 1468628563, "post_id": 38385666, "comment_id": 64221678, "body": "That\u2019s an interesting point: people use types to track different kinds of information. Absent <code>unsafePerformIO</code> and friends you can use types to tell you about what the program could possibly depend on, in a broader sense encompassing the whole system in which the program runs. With it, even if the use is sound in terms of language semantics, the types now say less about that."}, {"owner": {"reputation": 100892, "user_id": 745903, "user_type": "registered", "accept_rate": 74, "profile_image": "https://www.gravatar.com/avatar/50933f6638836741e620669b3940410e?s=128&d=identicon&r=PG", "display_name": "leftaroundabout", "link": "https://stackoverflow.com/users/745903/leftaroundabout"}, "edited": false, "score": 2, "creation_date": 1468629411, "post_id": 38385666, "comment_id": 64221820, "body": "Constants that very between different program runs aren&#39;t really constants. Such global pseudo-constants do perhaps not cause quite as much trouble as global variables that vary <i>during</i> runtime, but still quite too much trouble. I can tell a story of this from experience with Fortran hydrodynamics simulation code... the global configuration parameters are a maintenance nightmare. Please, do just pass the configuration around as an explicit parameter... this really isn&#39;t so ugly, not in modern Haskell with lenses etc.."}, {"owner": {"reputation": 100892, "user_id": 745903, "user_type": "registered", "accept_rate": 74, "profile_image": "https://www.gravatar.com/avatar/50933f6638836741e620669b3940410e?s=128&d=identicon&r=PG", "display_name": "leftaroundabout", "link": "https://stackoverflow.com/users/745903/leftaroundabout"}, "edited": false, "score": 1, "creation_date": 1468629415, "post_id": 38385666, "comment_id": 64221821, "body": "...That said \u2013 I still think such constants could have good uses: for data that actually is constant even between program runs, but too big to hard-code. Hence, +1."}, {"owner": {"reputation": 56659, "user_id": 450128, "user_type": "registered", "accept_rate": 62, "profile_image": "https://www.gravatar.com/avatar/2f72b3fdc99fe9fd1bbeb2f9da1d2c0a?s=128&d=identicon&r=PG", "display_name": "Ben", "link": "https://stackoverflow.com/users/450128/ben"}, "edited": false, "score": 1, "creation_date": 1468629926, "post_id": 38385666, "comment_id": 64221897, "body": "I usually feel such global constants <i>should</i> be function parameters; the behavior of the function <i>is</i> parameterized by the &quot;constants&quot; and I <i>do</i> need call the functions with different values of these &quot;parameters&quot; (when the program is invoked with different arguments/config). Making them actual parameters makes it easier to test, easier to generalise the program so that something it previously only did once per run it now does several times, easier to factor things into a library."}], "answers": [{"tags": [], "owner": {"reputation": 49959, "user_id": 866915, "user_type": "registered", "accept_rate": 70, "profile_image": "https://www.gravatar.com/avatar/09242131d6e17cbbe31e8547514da6e5?s=128&d=identicon&r=PG", "display_name": "ErikR", "link": "https://stackoverflow.com/users/866915/erikr"}, "is_accepted": false, "score": 0, "last_activity_date": 1468687755, "last_edit_date": 1468687755, "creation_date": 1468539425, "answer_id": 38385825, "question_id": 38385666, "link": "https://stackoverflow.com/questions/38385666/haskell-use-of-unsafeperformio-for-global-constant-bindings/38385825#38385825", "title": "Haskell: use of unsafePerformIO for global constant bindings", "body": "<p>Two cases from Hackage that come to mind:</p>\n\n<p>The package <a href=\"https://hackage.haskell.org/package/cmdargs\" rel=\"nofollow\"><strong>cmdargs</strong></a> makes use of <code>unsafePerformIO</code> - treating command line arguments as constant.</p>\n\n<p>In the package <a href=\"http://hackage.haskell.org/package/oeis\" rel=\"nofollow\"><strong>oeis</strong></a>, the\n\"pure\" function <a href=\"http://hackage.haskell.org/package/oeis-0.3.6/docs/Math-OEIS.html#v:getSequenceByID\" rel=\"nofollow\"><code>getSequenceByID</code></a> uses unsafePerformIO to return content from a web page on <a href=\"http://oeis.org\" rel=\"nofollow\">http://oeis.org</a>. It notes in its documentation:</p>\n\n<blockquote>\n  <p>Note that the result is not in the IO monad, even though the implementation requires looking up information via the Internet. There are no side effects to speak of, and from a practical point of view the function is referentially transparent (OEIS A-numbers could change in theory, but it's extremely unlikely).</p>\n</blockquote>\n"}, {"comments": [{"owner": {"reputation": 971, "user_id": 1263037, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/20a7364d5fd4920c0b718f7005b763d7?s=128&d=identicon&r=PG", "display_name": "Richard E. Silverman", "link": "https://stackoverflow.com/users/1263037/richard-e-silverman"}, "edited": false, "score": 0, "creation_date": 1468596116, "post_id": 38388592, "comment_id": 64207842, "body": "Thanks for your comments. I\u2019m aware of these limitations, but I wouldn\u2019t go so far as to say that the technique demonstrated in the sample program is only for \u201ctoys.\u201d As far as timing goes (your \u201cArbitrary program initialization\u201d), this is in fact often the behavior I want. It is useful to not have to decide up front in which program mode I need a particular external parameter, but rather let laziness abort the program if and only if it actually gets used. Of course, sometimes the initialization is expensive and so I\u2019d force it as you describe in order to find out."}, {"owner": {"reputation": 971, "user_id": 1263037, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/20a7364d5fd4920c0b718f7005b763d7?s=128&d=identicon&r=PG", "display_name": "Richard E. Silverman", "link": "https://stackoverflow.com/users/1263037/richard-e-silverman"}, "edited": false, "score": 1, "creation_date": 1468596548, "post_id": 38388592, "comment_id": 64208164, "body": "Similarly, for a reconfigurable daemon I would never use this technique in the first place, because then the configuration is not in fact constant; it\u2019s changing data read from the outside world and should be handled as usual using monadic I/O. I want to limit the discussion here to constants read from the outside. Your point about command-line/configuration overriding is well taken, though; I do that often but just hadn\u2019t gotten to it yet in these programs. It\u2019s possible that there are just too many caveats to make this attractive when taken all together; that\u2019s exactly what I\u2019d like to see."}, {"owner": {"reputation": 971, "user_id": 1263037, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/20a7364d5fd4920c0b718f7005b763d7?s=128&d=identicon&r=PG", "display_name": "Richard E. Silverman", "link": "https://stackoverflow.com/users/1263037/richard-e-silverman"}, "edited": false, "score": 0, "creation_date": 1468597674, "post_id": 38388592, "comment_id": 64208821, "body": "Actually, now that I think about it, I don\u2019t see that overriding is really a problem. If there\u2019s a top-level parameter foo :: Foo specified in configuration that may be given on the command line, then I\u2019d have confFoo :: Foo for the former and cmdFoo :: Maybe Foo for the latter, and compute foo = fromMaybe confFoo cmdFoo. This is better anyway in that I don\u2019t then lose track of the provenance of the setting."}], "tags": [], "owner": {"reputation": 1099, "user_id": 6513157, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/3d45981b71a14222513f57e8566e4b8b?s=128&d=identicon&r=PG&f=1", "display_name": "R B", "link": "https://stackoverflow.com/users/6513157/r-b"}, "is_accepted": false, "score": 2, "last_activity_date": 1468561364, "creation_date": 1468561364, "answer_id": 38388592, "question_id": 38385666, "link": "https://stackoverflow.com/questions/38385666/haskell-use-of-unsafeperformio-for-global-constant-bindings/38388592#38388592", "title": "Haskell: use of unsafePerformIO for global constant bindings", "body": "<p>I don't know if I'd consider top-level command line parsing to always be OK! Specifically, observe what happens with this alternate <code>main</code> when the user provides bad input.</p>\n\n<pre><code>main = do\n  putStrLn \"Arbitrary program initialization\"\n  verbose \"a verbose message\"\n  say \"a regular message\"\n  putStrLn \"Clean shutdown\"\n</code></pre>\n\n<blockquote>\n<pre><code>&gt; ./commands -x\nArbitrary program initialization\nInvalid option `-x'\n\nUsage: ...\n</code></pre>\n</blockquote>\n\n<p>Now in this case you can force one (or all!) of the pure values so that the parser is known to have run by a well-defined point in time.</p>\n\n<pre><code>main = do\n  () &lt;- return $ cQuiet `seq` cVerbose `seq` cForce `seq` ()\n  -- ...\n</code></pre>\n\n<blockquote>\n<pre><code>&gt; ./commands -x\nInvalid option `-x'\n...\n</code></pre>\n</blockquote>\n\n<p>But what happens if you have something like&mdash;</p>\n\n<pre><code>forkIO (withArgs newArgs action)\n</code></pre>\n\n<p>The only sensible thing to do is <code>{-# NOINLINE cQuiet #-}</code> and friends, so some of those precautions in <code>System.IO.Unsafe</code> do apply to you. But this is an interesting case to patch over, note that you have given up the ability to run sub-computations with alternate values. An e.g. <code>ReaderT</code> solution using <code>local</code> doesn't have that drawback.</p>\n\n<p>This seems an even larger drawback to me in the case of reading config files, as long running applications usually are reconfigurable without requiring a stop/start cycle. A top-level pure value precludes reconfiguration.</p>\n\n<p>But maybe this is even more clear if you consider the intersection of both your config files and your command line arguments. In many utilities arguments on the command line override values provided in a config file, an impossible behavior given what you have now.</p>\n\n<p>For toys, sure, go hog wild. For anything else, at least make your top-level value an <code>IORef</code> or <code>MVar</code>. There are some ways to still make the non-<code>unsafePerformIO</code> solutions nicer though. Consider&mdash;</p>\n\n<pre><code>data Config = Config { say     :: String -&gt; IO ()\n                     , verbose :: String -&gt; IO ()\n                     }\n\nmkSay :: Bool -&gt; String -&gt; IO ()\nmkSay quiet s | quiet     = return ()\n              | otherwise = putStrLn s\n\n-- In some action...\n  let config = Config (mkSay quietFlag) (mkVerbose verboseFlag)\n\ncompute :: Config -&gt; IO Value\ncompute config = do\n  -- ...\n  verbose config \"Debugging info\"\n  -- ...\n</code></pre>\n\n<p>This also respects the spirit of Haskell function signatures, in that it's now clear (without even needing to consider the open world of IO) that your functions' behavior actually does depend on program configuration.</p>\n"}, {"comments": [{"owner": {"reputation": 106, "user_id": 13890432, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/11e08f1420b8c6349a4b4b4ca8367ebe?s=128&d=identicon&r=PG&f=1", "display_name": "galagora", "link": "https://stackoverflow.com/users/13890432/galagora"}, "edited": false, "score": 0, "creation_date": 1603463554, "post_id": 38414236, "comment_id": 114053998, "body": "Also note <a href=\"https://kcsongor.github.io/global-implicit-parameters/\" rel=\"nofollow noreferrer\">this trick</a> which lets you use them globally - extremely useful to avoid a major refactor."}], "tags": [], "owner": {"reputation": 4565, "user_id": 1134885, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/7c428466054762cf7d4b5fb5f4396fa2?s=128&d=identicon&r=PG", "display_name": "NovaDenizen", "link": "https://stackoverflow.com/users/1134885/novadenizen"}, "is_accepted": false, "score": 1, "last_activity_date": 1468693411, "creation_date": 1468693411, "answer_id": 38414236, "question_id": 38385666, "link": "https://stackoverflow.com/questions/38385666/haskell-use-of-unsafeperformio-for-global-constant-bindings/38414236#38414236", "title": "Haskell: use of unsafePerformIO for global constant bindings", "body": "<p><a href=\"https://downloads.haskell.org/~ghc/latest/docs/html/users_guide/glasgow_exts.html#implicit-parameters\" rel=\"nofollow\">-XImplicitParams</a> is useful in this situation.</p>\n\n<pre><code>{-# LANGUAGE ImplicitParams #-}\n\ndata CommandLine = CommandLine\n  Bool               --quiet\n  Bool               --verbose\n  Bool               --force\n\nsay' :: Bool -&gt; String -&gt; IO ()\nsay' = bool (const $ return ()) putStrLn\n\nsay, verbose :: (?cmdLine :: CommandLine) =&gt; String -&gt; IO ()\nsay = case ?cmdLine of CommandLine cQuiet _ _ -&gt; say' $ not cQuiet\nverbose = case ?cmdLine of CommandLine _ cVerbose _ -&gt; say' cVerbose\n</code></pre>\n\n<p>Anything that is implicitly typed and uses <code>say</code> or <code>verbose</code> will have the <code>?cmdLine :: CommandLine</code> implicit parameter added to its type.  </p>\n\n<pre><code>:type (\\s -&gt; say (show s))\n(\\s -&gt; say (show s))\n  :: (Show a, ?cmdLine::CommandLine) =&gt; a -&gt; IO ()\n</code></pre>\n"}], "owner": {"reputation": 971, "user_id": 1263037, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/20a7364d5fd4920c0b718f7005b763d7?s=128&d=identicon&r=PG", "display_name": "Richard E. Silverman", "link": "https://stackoverflow.com/users/1263037/richard-e-silverman"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 462, "favorite_count": 1, "answer_count": 3, "score": 3, "last_activity_date": 1468693411, "creation_date": 1468538241, "last_edit_date": 1468628130, "question_id": 38385666, "link": "https://stackoverflow.com/questions/38385666/haskell-use-of-unsafeperformio-for-global-constant-bindings", "title": "Haskell: use of unsafePerformIO for global constant bindings", "body": "<p>There are lots of discussions of using <code>unsafePerformIO</code> carefully for global mutable variables, and some language additions to support it (e.g. <a href=\"https://hackage.haskell.org/package/global-variables-1.0.1.1/docs/Data-Global.html\" rel=\"nofollow\"><code>Data.Global</code></a>). I have a related but distinct question: using it for global <em>constant</em> bindings. Here\u2019s a usage I consider entirely OK: command-line parsing.</p>\n\n<pre><code>module Main where\n\n--------------------------------------------------------------------------------\nimport Data.Bool (bool)\nimport Data.Monoid ((&lt;&gt;))\nimport Options.Applicative (short, help, execParser, info, helper, fullDesc,\n                            progDesc, long, switch)\nimport System.IO.Unsafe (unsafePerformIO)\n\n--------------------------------------------------------------------------------\ndata CommandLine = CommandLine\n  Bool               --quiet\n  Bool               --verbose\n  Bool               --force\n\ncommandLineParser = CommandLine\n\n  &lt;$&gt; switch\n    (  long \"quiet\"\n    &lt;&gt; short 'q'\n    &lt;&gt; help \"Show only error messages.\")\n\n  &lt;*&gt; switch\n    (  long \"verbose\"\n    &lt;&gt; short 'v'\n    &lt;&gt; help \"Show lots of detail.\")\n\n  &lt;*&gt; switch\n    (  long \"force\"\n    &lt;&gt; short 'f'\n    &lt;&gt; help \"Do stuff anyway.\")\n\n{- Parse the command line, and bind related values globally for\nconvenience. This use of unsafePerformIO is OK since the action has no\nside effects and it's idempotent. -}\n\nCommandLine cQuiet cVerbose cForce \n\n  = unsafePerformIO . execParser $ info (helper &lt;*&gt; commandLineParser)\n      ( fullDesc\n     &lt;&gt; progDesc \"example program\"\n      )\n\n-- Print a message:\nsay     = say' $ not cQuiet -- unless --quiet\nverbose = say' cVerbose     -- if --verbose\nsay'    = bool (const $ return ()) putStrLn\n\n--------------------------------------------------------------------------------\nmain :: IO ()\n\nmain = do\n  verbose \"a verbose message\"\n  say \"a regular message\"\n</code></pre>\n\n<p>It is very valuable to be able to refer <code>cQuiet</code>, <code>cVerbose</code>, etc. globally rather than have to pass them around as arguments wherever they\u2019re needed. After all, this is exactly what global identifiers are for: these have a single value that never changes during any run of the program \u2014 it just happens that the value is initialized from the outside world rather than declared in the program text.</p>\n\n<p>It makes sense in principal to do the same thing with other sorts of constant data fetched from the outside, e.g. settings from a configuration file \u2014 but then an extra point arises: the action which fetches those is not idempotent, unlike reading the command line (I\u2019m slightly abusing the term \u201cidempotent\u201d here, but trust that I\u2019m understood). This just adds the constraint that the action must be performed only once. My question is: what\u2019s the best way to do that with code of this form:</p>\n\n<pre><code>data Config = Foo String | Bar (Maybe String) | Baz Int\n\nreadConfig :: IO Config\nreadConfig = do \u2026\n\nConfig foo bar baz = unsafePerformIO readConfig\n</code></pre>\n\n<p>The <a href=\"https://hackage.haskell.org/package/base-4.9.0.0/docs/System-IO-Unsafe.html\" rel=\"nofollow\">doc</a> suggests to me that this is sufficient and none of the precautions mentioned there are needed, but I\u2019m not sure. I\u2019ve seen proposals for adding a top-level syntax inspired by do-notation specifically for such situations:</p>\n\n<pre><code>Config foo bar baz &lt;- readConfig\n</code></pre>\n\n<p>\u2026 which seems like a very good idea; I\u2019d rather be sure the action will be performed at most once than rely on various compiler settings and hope no compiler behavior comes along that breaks existing code.</p>\n\n<p>I feel the fact that these are in fact constants, together with the ugliness involved in passing such things around explicitly despite the fact that they never change, argue strongly for there being a safe and supported way to do this. I\u2019m open to hearing contrary opinions if someone thinks I\u2019m missing an important point here, though.</p>\n\n<p><strong>Updates</strong></p>\n\n<ul>\n<li><p>The <code>say</code> and <code>verbose</code> uses in the example are not the best, because it\u2019s not values in the <code>IO</code> monad that are the real annoyance \u2014 these could easily read the parameters from a global <code>IORef</code>. The problem is the use of such parameters pervasively in pure code, which have to all be rewritten to either take the parameters explicitly (even though these do not change and thus should not need to be function parameters), or be converted to <code>IO</code> which is even worse. I\u2019ll improve the example when I have time.</p></li>\n<li><p>Another way to think about this: the class of behaviors I\u2019m talking about could be obtained in the following clunky way: run a program that fetches some data via I/O; take the results and substitute them into the template text of the main program as the values of some global bindings; then compile and run the resulting main program. You would then safely have the advantage of referring to those constants easily throughout the program. It seems that it should not be so hard to implement this pattern directly. I phrased the question mentioning <code>unsafePerformIO</code>, but really I\u2019m interested in understanding this kind of behavior, and what the best way to obtain it would be. <code>unsafePerformIO</code> is one way, but it has drawbacks.</p></li>\n</ul>\n\n<p><em>known limitations:</em></p>\n\n<ul>\n<li>With <code>unsafePerformIO</code>, when the data-fetching action happens is not fixed. This may be a feature, so that e.g. an error related to a missing configuration parameter occurs if and only if that parameter is ever actually used. If you need different behavior, you\u2019ll have to force the values with <code>seq</code> as needed.</li>\n</ul>\n"}, {"tags": ["haskell"], "answers": [{"comments": [{"owner": {"reputation": 100185, "user_id": 3234959, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/93bb12ca0f93dfddb33880316f7e66c2?s=128&d=identicon&r=PG&f=1", "display_name": "chi", "link": "https://stackoverflow.com/users/3234959/chi"}, "edited": false, "score": 1, "creation_date": 1468527212, "post_id": 38383337, "comment_id": 64176768, "body": "Never forget to turn on warnings: they will point out that you forgot to handle the <code>ParseFailed</code> case. Having two possible outcomes (success and failure) is the whole point of <code>ParseResult</code>."}, {"owner": {"reputation": 1404, "user_id": 5559663, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/sQiE2.gif?s=128&g=1", "display_name": "baxbaxwalanuksiwe", "link": "https://stackoverflow.com/users/5559663/baxbaxwalanuksiwe"}, "edited": false, "score": 0, "creation_date": 1468527332, "post_id": 38383337, "comment_id": 64176844, "body": "That is because <code>ParseResult a</code> is a type. Pattern matching only accepts patterns on a value level. That&#39;s why you have to match your parameter to a data constructor. It is comparable to <code>Maybe</code>. To extract a value from a value of type <code>Maybe a</code>, you have to match it to <code>Just</code>, not to <code>Maybe</code>, that wouldn&#39;t make sense."}], "tags": [], "owner": {"reputation": 422, "user_id": 4476484, "user_type": "registered", "accept_rate": 75, "profile_image": "https://i.stack.imgur.com/bMNeb.jpg?s=128&g=1", "display_name": "nullromo", "link": "https://stackoverflow.com/users/4476484/nullromo"}, "is_accepted": false, "score": 1, "last_activity_date": 1468526692, "creation_date": 1468526692, "answer_id": 38383337, "question_id": 38383279, "link": "https://stackoverflow.com/questions/38383279/extracting-information-from-haskell-object/38383337#38383337", "title": "Extracting Information from Haskell Object", "body": "<p>I just figured out how to do this. It seems that when I was trying to define</p>\n\n<pre><code>extract :: ParseResult a -&gt; a\nextract (ParseResult a) = a\n</code></pre>\n\n<p>I actually needed to use</p>\n\n<pre><code>extract :: ParseResult a -&gt; a\nextract (ParseOk a) = a\n</code></pre>\n\n<p>instead. I'm not 100% sure why this is.</p>\n"}, {"comments": [{"owner": {"reputation": 44013, "user_id": 1477667, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/trgKM.jpg?s=128&g=1", "display_name": "dfeuer", "link": "https://stackoverflow.com/users/1477667/dfeuer"}, "edited": false, "score": 2, "creation_date": 1468547948, "post_id": 38383418, "comment_id": 64183175, "body": "<code>getData</code> is bogus. Bailing with <code>error</code> is the wrong way to handle a parse error."}], "tags": [], "owner": {"reputation": 314794, "user_id": 67579, "user_type": "registered", "accept_rate": 81, "profile_image": "https://i.stack.imgur.com/BJXub.png?s=128&g=1", "display_name": "Willem Van Onsem", "link": "https://stackoverflow.com/users/67579/willem-van-onsem"}, "is_accepted": true, "score": 3, "last_activity_date": 1468526991, "creation_date": 1468526991, "answer_id": 38383418, "question_id": 38383279, "link": "https://stackoverflow.com/questions/38383279/extracting-information-from-haskell-object/38383418#38383418", "title": "Extracting Information from Haskell Object", "body": "<p>The definition of <a href=\"http://hackage.haskell.org/package/haskell-src-1.0.2.0/docs/Language-Haskell-ParseMonad.html#t:ParseResult\" rel=\"nofollow\"><code>ParseResult</code></a> is:</p>\n\n<pre><code>data ParseResult a = ParseOk a | ParseFailed SrcLoc String\n</code></pre>\n\n<p>(obtained from source code)</p>\n\n<p>So there are two possibilities: either the parsing succeeded, and it will return a <code>ParseOk</code> instance, or something went wrong during the parsing in which case you get the location of the error, and an error message with a <code>ParseFailed</code> constructor.</p>\n\n<p>So you can define a function:</p>\n\n<pre><code>getData :: ParseResult a -&gt; a\ngetData (ParseOk x) = x\ngetData (ParseFailed _ s) = error s\n</code></pre>\n\n<p>It is better to then throw an error as well, since it is always possible that your compiler/interpreter/analyzer/... parses a Haskell program containing syntax errors.</p>\n"}, {"comments": [{"owner": {"reputation": 422, "user_id": 4476484, "user_type": "registered", "accept_rate": 75, "profile_image": "https://i.stack.imgur.com/bMNeb.jpg?s=128&g=1", "display_name": "nullromo", "link": "https://stackoverflow.com/users/4476484/nullromo"}, "edited": false, "score": 0, "creation_date": 1468533059, "post_id": 38383452, "comment_id": 64179508, "body": "That makes sense. What I wasn&#39;t understanding is that <code>ParseResult</code> has 2 <i>and only 2</i> possible values: <code>ParseOk</code> and <code>ParseFailed</code>, which are wrapped around the actual value (<code>HsModule</code> in the success case and <code>SrcLoc</code> &amp; <code>String</code> in the failure case)."}], "tags": [], "owner": {"reputation": 75362, "user_id": 625403, "user_type": "registered", "accept_rate": 82, "profile_image": "https://www.gravatar.com/avatar/786eed7da67079cb5d63a49d469af25b?s=128&d=identicon&r=PG", "display_name": "amalloy", "link": "https://stackoverflow.com/users/625403/amalloy"}, "is_accepted": false, "score": 7, "last_activity_date": 1468534929, "last_edit_date": 1468534929, "creation_date": 1468527081, "answer_id": 38383452, "question_id": 38383279, "link": "https://stackoverflow.com/questions/38383279/extracting-information-from-haskell-object/38383452#38383452", "title": "Extracting Information from Haskell Object", "body": "<p>Looking for a general function of type</p>\n\n<pre><code>extract :: AnyType a -&gt; a\n</code></pre>\n\n<p>does indeed show a big misunderstanding about Haskell. Consider the many things <code>AnyType</code> might be, and how you might extract exactly one object from it. What about <code>Maybe Int</code>? You can easily enough convert <code>Just 5</code> to <code>5</code>, but what number should you return for <code>Nothing</code>? </p>\n\n<p>Or what if <code>AnyType</code> is <code>[]</code>, so that you have <code>[String]</code>? What should be the result of </p>\n\n<pre><code>extract [\"help\", \"i'm\", \"trapped\"]\n</code></pre>\n\n<p>or of </p>\n\n<pre><code>extract []\n</code></pre>\n\n<p>?</p>\n\n<p><code>ParseResult</code> has a similar \"problem\", in that it uses <code>ParseOk</code> to contain results indicating that everything was fine, and <code>ParseFailed</code> to indicate an error. Your incomplete pattern match successfully gets the result if the parse succeeded, but will crash your program if in fact the parse failed. By using <code>ParseResult</code>, Haskell is encouraging you to consider what you should do if the code you are analyzing did not parse correctly, rather than to just blithely assume it will come out fine.</p>\n"}], "owner": {"reputation": 422, "user_id": 4476484, "user_type": "registered", "accept_rate": 75, "profile_image": "https://i.stack.imgur.com/bMNeb.jpg?s=128&g=1", "display_name": "nullromo", "link": "https://stackoverflow.com/users/4476484/nullromo"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 301, "favorite_count": 0, "accepted_answer_id": 38383418, "answer_count": 3, "score": 2, "last_activity_date": 1468534929, "creation_date": 1468526445, "question_id": 38383279, "link": "https://stackoverflow.com/questions/38383279/extracting-information-from-haskell-object", "title": "Extracting Information from Haskell Object", "body": "<p>I'm new to Haskell and I'm confused on how to get values out of function results. In my particular case, I am trying to parse Haskell files and see which AST nodes appear on which lines. This is the code I have so far:</p>\n\n<pre><code>import Language.Haskell.Parser\nimport Language.Haskell.Syntax\n\ngetTree :: String -&gt; IO (ParseResult HsModule)\ngetTree path = do\n               file &lt;- readFile path\n               let tree = parseModuleWithMode (ParseMode path) file\n               return tree\n\nmain :: IO ()\nmain = do\n       tree &lt;- getTree \"ex.hs\"\n       -- &lt;do something with the tree other than print it&gt;\n       print tree\n</code></pre>\n\n<p>So on the line where I have the comment, I have a syntax tree as <code>tree</code>. It appears to have type <code>ParseResult HsModule</code>. What I want is just <code>HsModule</code>. I guess what I'm looking for is a function as follows:</p>\n\n<pre><code>extract :: ParseResult a -&gt; a\n</code></pre>\n\n<p>Or better yet, a general Haskell function</p>\n\n<pre><code>extract :: AnyType a -&gt; a\n</code></pre>\n\n<p>Maybe I'm missing a major concept about Haskell here?</p>\n\n<p>p.s. I understand that thinking of these things as \"Objects\" and trying to access \"Fields\" from them is wrong, but I'd like an explanation of how to deal with this type of thing in general.</p>\n"}, {"tags": ["haskell", "ghc"], "comments": [{"owner": {"reputation": 13807, "user_id": 2407038, "user_type": "registered", "accept_rate": 64, "profile_image": "https://www.gravatar.com/avatar/538f6f4a9aa43841841de7d8e8b169fc?s=128&d=identicon&r=PG&f=1", "display_name": "user2407038", "link": "https://stackoverflow.com/users/2407038/user2407038"}, "edited": false, "score": 0, "creation_date": 1468644158, "post_id": 38382525, "comment_id": 64223837, "body": "Type synonyms do not have constructors, so naturally importing the constructors of a type synonym will fail. Import the constructors from whichever module exports them: <code>import {B&#47;C} (Event(MakeEvent))</code>. Pattern syns won&#39;t really help here - the <code>MakeEvent</code> constructor would clash with the <code>MakeEvent</code> pattern, so you would have to import them qualified. Furthermore, you do not need any such aliases - simply re-export <code>MakeEvent</code> from module <code>C</code>."}, {"owner": {"reputation": 5734, "user_id": 394796, "user_type": "registered", "accept_rate": 86, "profile_image": "https://www.gravatar.com/avatar/aad9f3d17d0679d81841dc6d83a03ea3?s=128&d=identicon&r=PG", "display_name": "Cameron Martin", "link": "https://stackoverflow.com/users/394796/cameron-martin"}, "reply_to_user": {"reputation": 13807, "user_id": 2407038, "user_type": "registered", "accept_rate": 64, "profile_image": "https://www.gravatar.com/avatar/538f6f4a9aa43841841de7d8e8b169fc?s=128&d=identicon&r=PG&f=1", "display_name": "user2407038", "link": "https://stackoverflow.com/users/2407038/user2407038"}, "edited": false, "score": 0, "creation_date": 1468869634, "post_id": 38382525, "comment_id": 64294214, "body": "Related: <a href=\"http://stackoverflow.com/questions/35616041/can-i-export-constructors-along-with-a-type-alias\" title=\"can i export constructors along with a type alias\">stackoverflow.com/questions/35616041/&hellip;</a>"}], "answers": [{"comments": [{"owner": {"reputation": 5734, "user_id": 394796, "user_type": "registered", "accept_rate": 86, "profile_image": "https://www.gravatar.com/avatar/aad9f3d17d0679d81841dc6d83a03ea3?s=128&d=identicon&r=PG", "display_name": "Cameron Martin", "link": "https://stackoverflow.com/users/394796/cameron-martin"}, "edited": false, "score": 0, "creation_date": 1468530741, "post_id": 38382851, "comment_id": 64178592, "body": "I don&#39;t want to hide <code>Event</code>. Module C just re-exports it for convenience (so that I don&#39;t have to use qualified imports), as it&#39;s purpose it to allow module A and B to interoperate. I would be happy exporting just the data constructors from module A, except I can&#39;t without exporting the type constructor, which causes an ambiguous reference in module D. Maybe the best thing to do is scrap the type alias and just use qualified imports."}, {"owner": {"reputation": 44013, "user_id": 1477667, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/trgKM.jpg?s=128&g=1", "display_name": "dfeuer", "link": "https://stackoverflow.com/users/1477667/dfeuer"}, "reply_to_user": {"reputation": 5734, "user_id": 394796, "user_type": "registered", "accept_rate": 86, "profile_image": "https://www.gravatar.com/avatar/aad9f3d17d0679d81841dc6d83a03ea3?s=128&d=identicon&r=PG", "display_name": "Cameron Martin", "link": "https://stackoverflow.com/users/394796/cameron-martin"}, "edited": false, "score": 0, "creation_date": 1468534753, "post_id": 38382851, "comment_id": 64180112, "body": "@CameronMartin, that sounds like a good plan to me. It&#39;d be nice if you could import the type qualified but its constructors unqualified. As it is, your best bet may be a qualified import along with local bidirectional pattern synonyms."}], "tags": [], "owner": {"reputation": 44013, "user_id": 1477667, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/trgKM.jpg?s=128&g=1", "display_name": "dfeuer", "link": "https://stackoverflow.com/users/1477667/dfeuer"}, "is_accepted": false, "score": 2, "last_activity_date": 1468525052, "creation_date": 1468525052, "answer_id": 38382851, "question_id": 38382525, "link": "https://stackoverflow.com/questions/38382525/can-i-import-a-type-synonyms-data-constructors-without-using-the-viewpatterns-g/38382851#38382851", "title": "Can I import a type synonym&#39;s data constructors without using the ViewPatterns GHC extension?", "body": "<p>Don't use type synonyms to enforce abstraction barriers, except possibly small, private ones. They're no good at it. If you want to hide <code>Event</code>, use a newtype and pattern synonyms.</p>\n"}], "owner": {"reputation": 5734, "user_id": 394796, "user_type": "registered", "accept_rate": 86, "profile_image": "https://www.gravatar.com/avatar/aad9f3d17d0679d81841dc6d83a03ea3?s=128&d=identicon&r=PG", "display_name": "Cameron Martin", "link": "https://stackoverflow.com/users/394796/cameron-martin"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 272, "favorite_count": 0, "answer_count": 1, "score": 2, "last_activity_date": 1468525052, "creation_date": 1468523937, "question_id": 38382525, "link": "https://stackoverflow.com/questions/38382525/can-i-import-a-type-synonyms-data-constructors-without-using-the-viewpatterns-g", "title": "Can I import a type synonym&#39;s data constructors without using the ViewPatterns GHC extension?", "body": "<p>I have a module A and B which both export the <code>Event</code> type. Module C defines a type synonym to module A's <code>Event</code>, calling it <code>InputEvent</code>.</p>\n\n<p>I then consume both module B and module C in a module D:</p>\n\n<pre><code>module D where\n\nimport B (Event)\nimport C (InputEvent)\n</code></pre>\n\n<p>However, if I try to import <code>InputEvent</code>'s type constructors (say, <code>MakeEvent</code>), I get the error:</p>\n\n<pre><code>Module\n\u2018C\u2019\ndoes not export\n\u2018InputEvent(MakeEvent)\u2019\n</code></pre>\n\n<p>This could be solved by using the ViewPatterns GHC extension and exporting an alias to MakeEvent from module C:</p>\n\n<pre><code>makeEvent = MakeEvent\n</code></pre>\n\n<p>However, is there a way of importing the MakeEvent data constructor without using the ViewPatterns extension?</p>\n"}, {"tags": ["haskell", "monads"], "comments": [{"owner": {"reputation": 126897, "user_id": 791604, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/ce991df7a056248d5e4f6fc3659ba733?s=128&d=identicon&r=PG", "display_name": "Daniel Wagner", "link": "https://stackoverflow.com/users/791604/daniel-wagner"}, "edited": false, "score": 1, "creation_date": 1468523122, "post_id": 38382214, "comment_id": 64174402, "body": "Include the definition of <code>Lock</code>."}], "answers": [{"tags": [], "owner": {"reputation": 126897, "user_id": 791604, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/ce991df7a056248d5e4f6fc3659ba733?s=128&d=identicon&r=PG", "display_name": "Daniel Wagner", "link": "https://stackoverflow.com/users/791604/daniel-wagner"}, "is_accepted": true, "score": 5, "last_activity_date": 1468523253, "creation_date": 1468523253, "answer_id": 38382344, "question_id": 38382214, "link": "https://stackoverflow.com/questions/38382214/monad-bind-insists-on-different-type/38382344#38382344", "title": "Monad bind insists on different type?", "body": "<p>I assume your definition of <code>Lock</code> looks like this:</p>\n\n<pre><code>data Lock a = Working Bool a\n</code></pre>\n\n<p>Now, let's look at the type of <code>(&gt;&gt;=)</code>:</p>\n\n<pre><code>(&gt;&gt;=) :: Lock a -&gt; (a -&gt; Lock b) -&gt; Lock b\n</code></pre>\n\n<p>The important thing here is that it is the caller of <code>(&gt;&gt;=)</code> (and not the implementor) that gets to choose the values of <code>a</code> and <code>b</code>; for example, I might use it as if it had type:</p>\n\n<pre><code>(&gt;&gt;=) :: Lock Int -&gt; (Int -&gt; Lock Bool) -&gt; Lock Bool\n</code></pre>\n\n<p>Now it is clear why your implementation is incorrect: in</p>\n\n<pre><code>Working False int &gt;&gt;= _ = Working False int\n</code></pre>\n\n<p>you would be returning a <code>Lock Int</code> instead of a <code>Lock Bool</code>.</p>\n"}, {"tags": [], "owner": {"reputation": 75362, "user_id": 625403, "user_type": "registered", "accept_rate": 82, "profile_image": "https://www.gravatar.com/avatar/786eed7da67079cb5d63a49d469af25b?s=128&d=identicon&r=PG", "display_name": "amalloy", "link": "https://stackoverflow.com/users/625403/amalloy"}, "is_accepted": false, "score": 2, "last_activity_date": 1468523320, "creation_date": 1468523320, "answer_id": 38382369, "question_id": 38382214, "link": "https://stackoverflow.com/questions/38382214/monad-bind-insists-on-different-type/38382369#38382369", "title": "Monad bind insists on different type?", "body": "<p>The caller has a <code>Lock a</code>, and a function <code>a -&gt; Lock b</code>, and your implementation of <code>&gt;&gt;=</code> must combine those into a <code>Lock b</code>. You didn't provide the definition of <code>Lock</code>, but I assume it looks like this:</p>\n\n<pre><code>data Lock a = Working Bool a\n</code></pre>\n\n<p>The problem in your implementation is that you have an <code>a</code>, the second field in the <code>Working</code> constructor, and you need a <code>b</code> in order to produce a <code>Lock b</code>. You can't just return <code>Working False a</code>, because that is a <code>Lock a</code>, which is not what <code>&gt;&gt;=</code> promises to return. The only way you have to get a <code>b</code> out of an <code>a</code> is through the user's function <code>f</code>, so you really have no choice but to call it.</p>\n\n<p>The reason this is not true once you add the <code>Broken</code> constructor, is that you can easily construct a <code>Lock b</code> now, for any <code>b</code>, because <code>Broken</code> doesn't require any values of the type it is parameterized over.</p>\n\n<p>You can see the same basic phenomenon with the implementation of </p>\n\n<pre><code>(&gt;&gt;=) :: Maybe a -&gt; (a -&gt; Maybe b) -&gt; Maybe b\n</code></pre>\n\n<p>When you write <code>Nothing &gt;&gt;= f</code>, there is no <code>a</code> to call the function on, so how can a <code>Maybe b</code> be constructed? Again, <code>Nothing</code> suffices, because it doesn't care what type it is parameterized with.</p>\n"}], "owner": {"reputation": 128, "user_id": 5659642, "user_type": "registered", "accept_rate": 80, "profile_image": "https://www.gravatar.com/avatar/4db3f3c5bf843ade12eee8879ce80824?s=128&d=identicon&r=PG&f=1", "display_name": "John Z.", "link": "https://stackoverflow.com/users/5659642/john-z"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 72, "favorite_count": 0, "accepted_answer_id": 38382344, "answer_count": 2, "score": 2, "last_activity_date": 1468523586, "creation_date": 1468522785, "last_edit_date": 1468523586, "question_id": 38382214, "link": "https://stackoverflow.com/questions/38382214/monad-bind-insists-on-different-type", "title": "Monad bind insists on different type?", "body": "<p>why is this not a correct implementation?</p>\n\n<pre><code>instance Monad Lock where\n   (Working False x) &gt;&gt;= _ = Working False x\n   (Working True  x) &gt;&gt;= f = f x\n</code></pre>\n\n<p>The error GHC spits out is the one about rigid type variables:</p>\n\n<pre><code>\u2022 Couldn't match type \u2018a\u2019 with \u2018b\u2019\n  \u2018a\u2019 is a rigid type variable bound by\n    the type signature for:\n      (&gt;&gt;=) :: forall a b. Lock a -&gt; (a -&gt; Lock b) -&gt; Lock b\n    at src/Computers.hs:32:22\n  \u2018b\u2019 is a rigid type variable bound by\n    the type signature for:\n      (&gt;&gt;=) :: forall a b. Lock a -&gt; (a -&gt; Lock b) -&gt; Lock b\n    at src/Computers.hs:32:22\n  Expected type: Lock b\n    Actual type: Lock a\n</code></pre>\n\n<p>I am probably misinterpreting the error, but from my limited understanding, compiler actually <em>requires</em> me to spit out a different parameterized type, rather than the same type.</p>\n\n<p>I tried adding a different constructor without the type parameter (and change semantics just for the test) - then it works fine:</p>\n\n<pre><code>instance Monad Lock where\n   Broken            &gt;&gt;= _ = Broken\n   (Working False x) &gt;&gt;= _ = Broken\n   (Working True  x) &gt;&gt;= f = f x \n</code></pre>\n\n<p>Edit:\nindeed, the definition of Lock is:</p>\n\n<pre><code>data Lock a = Working Bool a\n</code></pre>\n"}, {"tags": ["haskell"], "comments": [{"owner": {"reputation": 94713, "user_id": 1139697, "user_type": "registered", "accept_rate": 86, "profile_image": "https://www.gravatar.com/avatar/5f136ddb684f39aaee1c028ee1950f6f?s=128&d=identicon&r=PG", "display_name": "Zeta", "link": "https://stackoverflow.com/users/1139697/zeta"}, "edited": false, "score": 3, "creation_date": 1468515815, "post_id": 38380121, "comment_id": 64170158, "body": "Where&#39;s the definition of <code>Option</code> and <code>Forward</code>/<code>Future</code>?"}, {"owner": {"reputation": 9225, "user_id": 3248346, "user_type": "registered", "accept_rate": 68, "profile_image": "https://www.gravatar.com/avatar/377f7423a286949201e0aa8cb2257fcc?s=128&d=identicon&r=PG&f=1", "display_name": "M.K.", "link": "https://stackoverflow.com/users/3248346/m-k"}, "reply_to_user": {"reputation": 94713, "user_id": 1139697, "user_type": "registered", "accept_rate": 86, "profile_image": "https://www.gravatar.com/avatar/5f136ddb684f39aaee1c028ee1950f6f?s=128&d=identicon&r=PG", "display_name": "Zeta", "link": "https://stackoverflow.com/users/1139697/zeta"}, "edited": false, "score": 0, "creation_date": 1468518410, "post_id": 38380121, "comment_id": 64171619, "body": "@Zeta, I&#39;ve added the types."}, {"owner": {"reputation": 94713, "user_id": 1139697, "user_type": "registered", "accept_rate": 86, "profile_image": "https://www.gravatar.com/avatar/5f136ddb684f39aaee1c028ee1950f6f?s=128&d=identicon&r=PG", "display_name": "Zeta", "link": "https://stackoverflow.com/users/1139697/zeta"}, "edited": false, "score": 0, "creation_date": 1468518554, "post_id": 38380121, "comment_id": 64171709, "body": "@Why are those three types? Why not <code>data OptionKind = Future | Forward</code>? By the way, now <code>Price</code> is missing. And <code>Type</code>. And <code>Style</code>."}, {"owner": {"reputation": 9225, "user_id": 3248346, "user_type": "registered", "accept_rate": 68, "profile_image": "https://www.gravatar.com/avatar/377f7423a286949201e0aa8cb2257fcc?s=128&d=identicon&r=PG&f=1", "display_name": "M.K.", "link": "https://stackoverflow.com/users/3248346/m-k"}, "reply_to_user": {"reputation": 94713, "user_id": 1139697, "user_type": "registered", "accept_rate": 86, "profile_image": "https://www.gravatar.com/avatar/5f136ddb684f39aaee1c028ee1950f6f?s=128&d=identicon&r=PG", "display_name": "Zeta", "link": "https://stackoverflow.com/users/1139697/zeta"}, "edited": false, "score": 0, "creation_date": 1468518936, "post_id": 38380121, "comment_id": 64171930, "body": "@Zeta, added the other types."}], "answers": [{"tags": [], "owner": {"reputation": 7395, "user_id": 309760, "user_type": "registered", "accept_rate": 50, "profile_image": "https://www.gravatar.com/avatar/6a8c18bf11374f3580503d024623d820?s=128&d=identicon&r=PG", "display_name": "Paul S", "link": "https://stackoverflow.com/users/309760/paul-s"}, "is_accepted": false, "score": 1, "last_activity_date": 1468520220, "creation_date": 1468520220, "answer_id": 38381413, "question_id": 38380121, "link": "https://stackoverflow.com/questions/38380121/correct-use-of-typeclasses-in-haskell/38381413#38381413", "title": "Correct Use of Typeclasses in Haskell", "body": "<p>How about this?</p>\n\n<pre><code>data Option = Option ForFut Type Style Strike Expiration deriving (Show)\ndata ForFut = Forward Price | Future Price deriving (Show)\n\ntype Barrier = Double\ntype Expiration = Double\ntype Price = Double\ntype Strike = Double\ntype Value = Double\ntype Dividend = Double\n\ntype Rate = Double\n\ndata Type = Call | Put deriving (Eq, Show)\ndata Style = European | American deriving (Eq, Show)\n\ncall :: Double -&gt; Double -&gt; Double -&gt; Double -&gt; Double -&gt; Double\ncall = undefined\n\nput :: Double -&gt; Double -&gt; Double -&gt; Double -&gt; Double -&gt; Double\nput = undefined\n\nprice :: Option -&gt; Double -&gt; Double -&gt; Double\nprice ( Option ( Future s ) Call European k t ) r v = call s k r t v\nprice ( Option ( Future s ) Put European k t ) r v = put s k r t v\nprice ( Option ( Forward s ) Call European k t ) r v = call s k r t v\nprice ( Option ( Forward s ) Put European k t ) r v = put s k r t v\n</code></pre>\n\n<p>So I've combined the <code>Forward</code> and <code>Future</code> types into a single type. This then avoids the need to make <code>Option</code> a higher kinded type. The type class can then be removed, and <code>price</code> can be defined with simple pattern matching.</p>\n"}, {"comments": [{"owner": {"reputation": 9225, "user_id": 3248346, "user_type": "registered", "accept_rate": 68, "profile_image": "https://www.gravatar.com/avatar/377f7423a286949201e0aa8cb2257fcc?s=128&d=identicon&r=PG&f=1", "display_name": "M.K.", "link": "https://stackoverflow.com/users/3248346/m-k"}, "edited": false, "score": 0, "creation_date": 1468529716, "post_id": 38381995, "comment_id": 64178072, "body": "I have about 7 other different types like future and forward that I have to code for as well. Those types will have other attributes so sticking them all in the Option type as above would not be a good idea I think. The fields I have for Option at the moment (from a business perspective) pertain to that type only and not to Forward, Future and the other types I have. I tried to separate them out as I have done into their own types so the information does not get conflated. This is my first foray with Haskell and in particular Haskell design."}, {"owner": {"reputation": 9225, "user_id": 3248346, "user_type": "registered", "accept_rate": 68, "profile_image": "https://www.gravatar.com/avatar/377f7423a286949201e0aa8cb2257fcc?s=128&d=identicon&r=PG&f=1", "display_name": "M.K.", "link": "https://stackoverflow.com/users/3248346/m-k"}, "edited": false, "score": 0, "creation_date": 1468529758, "post_id": 38381995, "comment_id": 64178099, "body": "Also I&#39;m just wondering what was stopping me from pattern matching like you have done above when I have an Option type which is higher kinded. To me, it made sense to make Option a type constructor because in itself it is useless until another type is added to it to make it into a financial contract. I was just making that notion explicit."}, {"owner": {"reputation": 126897, "user_id": 791604, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/ce991df7a056248d5e4f6fc3659ba733?s=128&d=identicon&r=PG", "display_name": "Daniel Wagner", "link": "https://stackoverflow.com/users/791604/daniel-wagner"}, "reply_to_user": {"reputation": 9225, "user_id": 3248346, "user_type": "registered", "accept_rate": 68, "profile_image": "https://www.gravatar.com/avatar/377f7423a286949201e0aa8cb2257fcc?s=128&d=identicon&r=PG&f=1", "display_name": "M.K.", "link": "https://stackoverflow.com/users/3248346/m-k"}, "edited": false, "score": 0, "creation_date": 1468530398, "post_id": 38381995, "comment_id": 64178440, "body": "@Mika&#39;il In such a case, a typeclass might be okay. But I would suggest a much smaller class; perhaps <code>class HasPrice a where getPrice :: a -&gt; Price</code> with instances for <code>Forward</code> and <code>Future</code>; then write something like <code>optionPrice :: HasPrice a =&gt; Option a -&gt; Double -&gt; Double -&gt; Double; optionPrice (Option s Call European k t) r v = call (getPrice s) k r t v</code>."}, {"owner": {"reputation": 9225, "user_id": 3248346, "user_type": "registered", "accept_rate": 68, "profile_image": "https://www.gravatar.com/avatar/377f7423a286949201e0aa8cb2257fcc?s=128&d=identicon&r=PG&f=1", "display_name": "M.K.", "link": "https://stackoverflow.com/users/3248346/m-k"}, "edited": false, "score": 0, "creation_date": 1468530691, "post_id": 38381995, "comment_id": 64178578, "body": "Thanks for that suggestion. I was thinking on similar lines as well but never went forward that idea. I will investigate it."}], "tags": [], "owner": {"reputation": 126897, "user_id": 791604, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/ce991df7a056248d5e4f6fc3659ba733?s=128&d=identicon&r=PG", "display_name": "Daniel Wagner", "link": "https://stackoverflow.com/users/791604/daniel-wagner"}, "is_accepted": false, "score": 5, "last_activity_date": 1468522093, "creation_date": 1468522093, "answer_id": 38381995, "question_id": 38380121, "link": "https://stackoverflow.com/questions/38380121/correct-use-of-typeclasses-in-haskell/38381995#38381995", "title": "Correct Use of Typeclasses in Haskell", "body": "<p>I think I would just make the the argument to <code>Option</code> be a phantom type:</p>\n\n<pre><code>data Option a = Option Price Type Style Strike\ndata Future\ndata Forward\n\nprice :: Option a -&gt; Double -&gt; Double -&gt; Double\nprice (Option s Call European k t) r v = call s k r t v\nprice (Option s Put  European k t) r v = put  s k r t v\n</code></pre>\n\n<p>Much less repetition, and no need for a type-class, but you still get a type-level distinction between forward options (<code>Option Forward</code>) and future options (<code>Option Future</code>) should you need that elsewhere. If you're really excited, you could turn on <code>DataKinds</code> to make sure that <code>Future</code> and <code>Forward</code> are the only two possible type-level arguments to <code>Option</code>.</p>\n"}], "owner": {"reputation": 9225, "user_id": 3248346, "user_type": "registered", "accept_rate": 68, "profile_image": "https://www.gravatar.com/avatar/377f7423a286949201e0aa8cb2257fcc?s=128&d=identicon&r=PG&f=1", "display_name": "M.K.", "link": "https://stackoverflow.com/users/3248346/m-k"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 109, "favorite_count": 0, "answer_count": 2, "score": 1, "last_activity_date": 1468522093, "creation_date": 1468515670, "last_edit_date": 1468518905, "question_id": 38380121, "link": "https://stackoverflow.com/questions/38380121/correct-use-of-typeclasses-in-haskell", "title": "Correct Use of Typeclasses in Haskell", "body": "<p>I wrote a typeclass to avoid having to write a duplicate function for a different type as below:</p>\n\n<pre><code>import Statistics.Distribution.Normal\nimport Data.Random\n\nd1 :: Double -&gt; Double -&gt; Double -&gt; Double -&gt; Double -&gt; Double\nd1 s k r v t = ( log ( s / k ) + ( ( v * v ) / 2 ) * t ) / ( v * sqrt t )\n\nd2 :: Double -&gt; Double -&gt; Double -&gt; Double -&gt; Double -&gt; Double\nd2 s k r v t = d1 s k r v t - v * sqrt t\n\ncall :: Double -&gt; Double -&gt; Double -&gt; Double -&gt; Double -&gt; Double\ncall s k r t v = exp ( -r * t ) * ( s * cdf normal ( d1 s k r v t )\n                                  - k * cdf normal ( d2 s k r v t ) )\n  where normal = Normal (0 :: Double) 1\n\nput :: Double -&gt; Double -&gt; Double -&gt; Double -&gt; Double -&gt; Double\nput s k r t v = exp ( -r * t ) * ( k * cdf normal ( - d2 s k r v t )\n                                 - s * cdf normal ( - d1 s k r v t ) )\n  where normal = Normal (0 :: Double) 1\n\nclass Black a where\n  price :: a -&gt; Double -&gt; Double -&gt; Double\n\ninstance Black ( Option Future ) where\n  price ( Option ( Future s ) Call European k t ) r v = call s k r t v\n  price ( Option ( Future s ) Put European k t ) r v = put s k r t v\n\ninstance Black ( Option Forward ) where\n  price ( Option ( Forward s ) Call European k t ) r v = call s k r t v\n  price ( Option ( Forward s ) Put European k t ) r v = put s k r t v\n</code></pre>\n\n<p>Is this a valid use of typeclasses? The reason I am asking is that I am not overloading the definition of the price function for any given type. All I am doing is avoiding having to write:</p>\n\n<pre><code>priceFuture :: (Option Future) -&gt; Double -&gt; Double -&gt; Double\n// impl\npriceFoward :: (Option Forward) -&gt; Double -&gt; Double -&gt; Double\nimpl\n\n\n\ndata Option a = Option a Type Style Strike Expiration deriving (Show)\ndata Future = Future Price deriving (Show)\ndata Forward = Forward Price deriving (Show)\n\ntype Barrier = Double\ntype Expiration = Double\ntype Price = Double\ntype Strike = Double\ntype Value = Double\ntype Dividend = Double\ntype Rate = Double\n\ndata Type = Call | Put deriving (Eq, Show)\ndata Style = European | American deriving (Eq, Show)\n</code></pre>\n"}, {"tags": ["haskell"], "comments": [{"owner": {"reputation": 44013, "user_id": 1477667, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/trgKM.jpg?s=128&g=1", "display_name": "dfeuer", "link": "https://stackoverflow.com/users/1477667/dfeuer"}, "edited": false, "score": 0, "creation_date": 1468524300, "post_id": 38379048, "comment_id": 64175104, "body": "This isn&#39;t relevant, but you should rename <code>Const</code> to something else. There&#39;s an extremely popular type in <code>Control.Applicative</code> that looks like <code>newtype Const a b = Const { getConst :: a }</code>. Reusing that name is likely to confuse people. One option might be <code>Lit</code>, for &quot;literal&quot;."}, {"owner": {"reputation": 44013, "user_id": 1477667, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/trgKM.jpg?s=128&g=1", "display_name": "dfeuer", "link": "https://stackoverflow.com/users/1477667/dfeuer"}, "edited": false, "score": 0, "creation_date": 1468524701, "post_id": 38379048, "comment_id": 64175338, "body": "You will eventually learn about the <code>Writer</code> type, which solves this problem quite neatly."}, {"owner": {"reputation": 63, "user_id": 4245747, "user_type": "registered", "profile_image": "https://lh6.googleusercontent.com/-0spxv6fcmHo/AAAAAAAAAAI/AAAAAAAAAVc/EhXWdQl69e8/photo.jpg?sz=128", "display_name": "Mykhailo Iaremenko", "link": "https://stackoverflow.com/users/4245747/mykhailo-iaremenko"}, "reply_to_user": {"reputation": 44013, "user_id": 1477667, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/trgKM.jpg?s=128&g=1", "display_name": "dfeuer", "link": "https://stackoverflow.com/users/1477667/dfeuer"}, "edited": false, "score": 0, "creation_date": 1468584930, "post_id": 38379048, "comment_id": 64200055, "body": "These conditions were already set in the task that&#39;s why I wanted to solve the task with predefined conditions."}], "answers": [{"comments": [{"owner": {"reputation": 63, "user_id": 4245747, "user_type": "registered", "profile_image": "https://lh6.googleusercontent.com/-0spxv6fcmHo/AAAAAAAAAAI/AAAAAAAAAVc/EhXWdQl69e8/photo.jpg?sz=128", "display_name": "Mykhailo Iaremenko", "link": "https://stackoverflow.com/users/4245747/mykhailo-iaremenko"}, "edited": false, "score": 0, "creation_date": 1468515928, "post_id": 38379830, "comment_id": 64170217, "body": "I got your idea! Thanks"}], "tags": [], "owner": {"reputation": 94713, "user_id": 1139697, "user_type": "registered", "accept_rate": 86, "profile_image": "https://www.gravatar.com/avatar/5f136ddb684f39aaee1c028ee1950f6f?s=128&d=identicon&r=PG", "display_name": "Zeta", "link": "https://stackoverflow.com/users/1139697/zeta"}, "is_accepted": true, "score": 5, "last_activity_date": 1468515034, "last_edit_date": 1468515034, "creation_date": 1468514675, "answer_id": 38379830, "question_id": 38379048, "link": "https://stackoverflow.com/questions/38379048/haskell-function-construction/38379830#38379830", "title": "Haskell function construction", "body": "<p>While <code>checkValue</code> is recursive, <code>eval'</code> isn't. We can show this with a smaller example:</p>\n\n<pre><code>true   = Const True\nsmall1 = And true $ And true $ And true true\n</code></pre>\n\n\n\n<pre><code>ghci&gt; eval' small1\n(True,[\n And (Const True) (And (Const True) (And (Const True) (Const True))), -- level 1\n Const True, And (Const True) (And (Const True) (Const True))         -- level 2\n  -- other levels missing\n ])\n</code></pre>\n\n<p>You have to apply <code>eval'</code> recursively on <code>es1</code> and <code>es2</code>. Even better, have <code>eval</code> actually evaluate the expressions fully:</p>\n\n<pre><code>eval :: Expr -&gt; (Bool, [Expr])\neval expr = case expr of\n    Const b   -&gt; (b, [expr])\n    And e1 e2 -&gt; evalWith (&amp;&amp;) e1 e2\n    Or  e1 e2 -&gt; evalWith (||) e1 e2 \n  where\n    evalWith op e1 e2 = \n      let (b1, es1') = eval e1\n          (b2, es2') = eval e2\n      in (b1 `op` b2, expr : (es1' ++ es2'))\n</code></pre>\n"}], "owner": {"reputation": 63, "user_id": 4245747, "user_type": "registered", "profile_image": "https://lh6.googleusercontent.com/-0spxv6fcmHo/AAAAAAAAAAI/AAAAAAAAAVc/EhXWdQl69e8/photo.jpg?sz=128", "display_name": "Mykhailo Iaremenko", "link": "https://stackoverflow.com/users/4245747/mykhailo-iaremenko"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 130, "favorite_count": 0, "accepted_answer_id": 38379830, "answer_count": 1, "score": 2, "last_activity_date": 1468515034, "creation_date": 1468512240, "question_id": 38379048, "link": "https://stackoverflow.com/questions/38379048/haskell-function-construction", "title": "Haskell function construction", "body": "<p>I am learning Haskell and stacked in one weird problem.\nI have a long expression and I need to devide it into small expressions and log them. I've managed to solve that part but I cannot understand why I cannot add details for (Const Bool) to all details.</p>\n\n<pre><code>module MonadicInterpreterLog where\n\nimport Test.HUnit (runTestTT,Test(TestLabel,TestList),(~?=))\n\nimport Control.Monad \nimport Control.Applicative hiding (Const)\n\n-- Simple Boolean expressions\ndata Expr = Const Bool | And Expr Expr | Or Expr Expr\n  deriving (Eq, Show, Read)\n\nsample1 = And (Const True) (Or (Const False) (Const True))\nsample2 = And (Or (Const False) (Const True)) (And (Const False) (Const True))\n\neval' :: Expr -&gt; [Expr] -&gt; (Bool, [Expr])\neval' (Const b) es = (b, Const b : es)\neval' (And e1 e2) es = (checkValue e1 &amp;&amp; checkValue e2, And e1 e2 : e1 : e2 : es)\neval' (Or e1 e2) es = (checkValue e1 || checkValue e2, Or e1 e2 : e1 : e2 : es)\n\ncheckValue :: Expr -&gt; Bool\ncheckValue (Const b) = b\ncheckValue (And e1 e2) = checkValue e1 &amp;&amp; checkValue e2\ncheckValue (Or e1 e2) = checkValue e1 || checkValue e2\n\n\n\nmain :: IO ()\nmain = do\n    testresults &lt;- runTestTT tests\n    print testresults\n\ntestlog1, testlog2 :: [Expr]\ntestlog1 = [(And (Const True) (Or (Const False) (Const True))),\n        (Const True),\n        (Or (Const False) (Const True)),\n        (Const False),\n        (Const True)]\ntestlog2 = [(And (Or (Const False) (Const True)) (And (Const False) (Const True))),\n             (Or (Const False) (Const True)),\n             (Const False),\n             (Const True),\n             (And (Const False) (Const True)),\n             (Const False),\n             (Const True)]\n\n-- | List of tests for 'parseScore'.\ntests :: Test\ntests = TestLabel \"MonadicInterpreterLog\" (TestList [\n    eval' sample1 [] ~?= (True,testlog1),\n    eval' sample2 [] ~?= (False,testlog2)\n    ])\n</code></pre>\n\n<p>The error message I get:</p>\n\n<pre><code>MonadicInterpreterLog.hs:96 \nexpected: (True,[And (Const True) (Or (Const False) (Const True)),Const True,Or (Const False) (Const True),Const False,Const True])\nbut got: (True,[And (Const True) (Or (Const False) (Const True)),Const True,Or (Const False) (Const True)]) \n</code></pre>\n\n<p>So as you see the part for (Const Bool) is missing. What wrong am I doing?\nThank you in advance</p>\n"}, {"tags": ["haskell", "github", "dependency-management", "cabal", "haskell-stack"], "answers": [{"comments": [{"owner": {"reputation": 4250, "user_id": 1833322, "user_type": "registered", "accept_rate": 77, "profile_image": "https://www.gravatar.com/avatar/c32eff9bf6efb2b8e496407efa690e99?s=128&d=identicon&r=PG", "display_name": "Flip", "link": "https://stackoverflow.com/users/1833322/flip"}, "edited": false, "score": 5, "creation_date": 1520473491, "post_id": 38378177, "comment_id": 85333734, "body": "This answer seems out of date. You can specify urls and filepaths under extra-deps"}, {"owner": {"reputation": 9281, "user_id": 393758, "user_type": "registered", "accept_rate": 58, "profile_image": "https://www.gravatar.com/avatar/3ee15f717c343aabe3e14db32c22130b?s=128&d=identicon&r=PG", "display_name": "danza", "link": "https://stackoverflow.com/users/393758/danza"}, "reply_to_user": {"reputation": 4250, "user_id": 1833322, "user_type": "registered", "accept_rate": 77, "profile_image": "https://www.gravatar.com/avatar/c32eff9bf6efb2b8e496407efa690e99?s=128&d=identicon&r=PG", "display_name": "Flip", "link": "https://stackoverflow.com/users/1833322/flip"}, "edited": false, "score": 0, "creation_date": 1525877152, "post_id": 38378177, "comment_id": 87530132, "body": "@Flip could you paste a link to that part of the doc?"}, {"owner": {"reputation": 4250, "user_id": 1833322, "user_type": "registered", "accept_rate": 77, "profile_image": "https://www.gravatar.com/avatar/c32eff9bf6efb2b8e496407efa690e99?s=128&d=identicon&r=PG", "display_name": "Flip", "link": "https://stackoverflow.com/users/1833322/flip"}, "edited": false, "score": 2, "creation_date": 1525893440, "post_id": 38378177, "comment_id": 87539127, "body": "It&#39;s on the same page. <a href=\"https://docs.haskellstack.org/en/stable/yaml_configuration/#packages-and-extra-deps\" rel=\"nofollow noreferrer\">docs.haskellstack.org/en/stable/yaml_configuration/&hellip;</a> There are a lot of examples in this section. From the docs: Extra dependencies, which are packages provided locally on top of the snapshot definition of available packages. These can come from Hackage (or an alternative package index you&#39;ve defined, see package-indices), an HTTP(S) or local archive, a Git or Mercurial repository, or a local file path."}], "tags": [], "owner": {"reputation": 1099, "user_id": 6513157, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/3d45981b71a14222513f57e8566e4b8b?s=128&d=identicon&r=PG&f=1", "display_name": "R B", "link": "https://stackoverflow.com/users/6513157/r-b"}, "is_accepted": true, "score": 24, "last_activity_date": 1582981927, "last_edit_date": 1582981927, "creation_date": 1468509738, "answer_id": 38378177, "question_id": 38377521, "link": "https://stackoverflow.com/questions/38377521/haskell-stack-install-package-dependency-from-github/38378177#38378177", "title": "Haskell Stack install package dependency from github", "body": "<p><strong>For stack &lt;1.11:</strong></p>\n\n<p>The <a href=\"http://docs.haskellstack.org/en/stable/yaml_configuration/#packages\" rel=\"nofollow noreferrer\">documentation for the <code>stack.yaml</code> <code>packages</code> section</a> gives examples of referring to more complex package locations.</p>\n\n<blockquote>\n<pre><code>packages:\n- location: .\n- location: dir1/dir2\n- location: https://example.com/foo/bar/baz-0.0.2.tar.gz\n- location: http://github.com/yesodweb/wai/archive/2f8a8e1b771829f4a8a77c0111352ce45a14c30f.zip\n- location:\n    git: git@github.com:commercialhaskell/stack.git\n    commit: 6a86ee32e5b869a877151f74064572225e1a0398\n- location:\n    hg: https://example.com/hg/repo\n    commit: da39a3ee5e6b4b0d3255bfef95601890afd80709\n</code></pre>\n</blockquote>\n\n<p>Then add <code>extra-dep: true</code> to the <code>package</code> entry just to tell <code>stack</code> not to treat the code it pulls in as something you're developing on (e.g., don't load it in GHCi).</p>\n"}, {"tags": [], "owner": {"reputation": 9281, "user_id": 393758, "user_type": "registered", "accept_rate": 58, "profile_image": "https://www.gravatar.com/avatar/3ee15f717c343aabe3e14db32c22130b?s=128&d=identicon&r=PG", "display_name": "danza", "link": "https://stackoverflow.com/users/393758/danza"}, "is_accepted": false, "score": 2, "last_activity_date": 1525877949, "creation_date": 1525877949, "answer_id": 50256465, "question_id": 38377521, "link": "https://stackoverflow.com/questions/38377521/haskell-stack-install-package-dependency-from-github/50256465#50256465", "title": "Haskell Stack install package dependency from github", "body": "<p>In my case i wanted to depend on a fork of pandoc, specifying a precise commit. It worked by adding the following to <code>stack.yml</code>:</p>\n\n<p><code>\nextra-deps:\n- archive: https://github.com/italia/pandoc/archive/1327c564cccf5dfa387a2956443990d9854c85cd.zip\n</code></p>\n\n<p>This would work with any <em>branch-like</em> URL on Git. I found my url by browsing the files at the commit and copying the URL from the \"Download ZIP\" button.</p>\n\n<p>Note that my branch has a specific version, higher than any version Stack could fetch from the resolver. I pinpoint the version in the Cabal dependencies. If the version on that branch would overlap with one available in the resolver's index, i'm not sure about which one would be picked</p>\n"}, {"tags": [], "owner": {"reputation": 4588, "user_id": 4126843, "user_type": "registered", "accept_rate": 88, "profile_image": "https://i.stack.imgur.com/4r8yp.png?s=128&g=1", "display_name": "PHPirate", "link": "https://stackoverflow.com/users/4126843/phpirate"}, "is_accepted": false, "score": 18, "last_activity_date": 1574940903, "last_edit_date": 1574940903, "creation_date": 1533284888, "answer_id": 51668350, "question_id": 38377521, "link": "https://stackoverflow.com/questions/38377521/haskell-stack-install-package-dependency-from-github/51668350#51668350", "title": "Haskell Stack install package dependency from github", "body": "<p><strong>New syntax for Stack >1.7.1</strong></p>\n\n<p>As @Flip commented, the docs at <a href=\"https://docs.haskellstack.org/en/stable/yaml_configuration/#packages-and-extra-deps\" rel=\"noreferrer\">docs.haskellstack.org</a>\nclarify the new syntax for your <code>stack.yaml</code> is: (note the full commit hash needs to be used)</p>\n\n<pre><code>extra-deps:\n- github: apolishch/prime_table\n  commit: a510622a824af999a809191e8c959b8ea5fa8bdb\n- github: apolishch/reactive-banana\n  commit: 74bac0f86ed172f95bb6f6a31041992fc161cf79\n  subdirs: reactive-banana\n</code></pre>\n\n<p>To be clear: dependencies in your <code>stack.yaml</code> make sure that the packages (which are not in Stackage) are available would some <code>.cabal</code> file in your project want them, just in case. </p>\n\n<p>You still have to specify the name of the package in <code>build-depends</code> in your <code>.cabal</code> file to say you actually depend on the package.</p>\n\n<p>Note it doesn't matter what branch the commit is on, and repos can be forks. When a package is in a subdirectory, you can specify it, otherwise it will default to top-level.</p>\n\n<p><strong>Syntax for Stack >1.6.0</strong></p>\n\n<pre><code>extra-deps:\n- github: git@github.com:apolishch/prime_table.git\n  commit: a510622a824af999a809191e8c959b8ea5fa8bdb\n</code></pre>\n\n<p>[Edit] I have found that sometimes the syntax from 1.7.1 fails with error message</p>\n\n<pre><code>C:\\Users\\username\\AppData\\Local\\Programs\\stack\\x86_64-windows\\ghc-8.4.3\\lib/../mingw/bin\\ar.exe: .stack-work\\dist\\7d103d30\\build\\objs-10648\\libHSpackagename-0.1.0.0-DlGXqyeqb9MDn2z8KhgjVb.a: No such file or directory\n</code></pre>\n\n<p>and I solved that by using the 1.6.0 syntax, even though I was using Stack 1.7.1.\nWhen using Travis, that will fail because Travis can't clone via SSH without your SSH keys of course. But you can still use the https link as</p>\n\n<pre><code>extra-deps:\n- github: https://github.com/apolishch/prime_table.git\n  commit: a510622a824af999a809191e8c959b8ea5fa8bdb\n</code></pre>\n"}], "owner": {"reputation": 13393, "user_id": 1772334, "user_type": "registered", "accept_rate": 65, "profile_image": "https://www.gravatar.com/avatar/36bbc437a85c7654d1841ad508c78acb?s=128&d=identicon&r=PG", "display_name": "Abraham P", "link": "https://stackoverflow.com/users/1772334/abraham-p"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 6604, "favorite_count": 10, "accepted_answer_id": 38378177, "answer_count": 3, "score": 32, "last_activity_date": 1582981927, "creation_date": 1468508129, "last_edit_date": 1503161028, "question_id": 38377521, "link": "https://stackoverflow.com/questions/38377521/haskell-stack-install-package-dependency-from-github", "title": "Haskell Stack install package dependency from github", "body": "<p>Is it possible to install a version of a package from github using Haskell stack?</p>\n\n<p>e.g. in a <code>.cabal</code> or a <code>stack.yaml</code> file, how can I point a dependency at a git repo/branch/revision?</p>\n"}, {"tags": ["haskell", "functional-programming", "tuples"], "answers": [{"comments": [{"owner": {"reputation": 1754, "user_id": 349913, "user_type": "registered", "accept_rate": 52, "profile_image": "https://i.stack.imgur.com/yLegF.jpg?s=128&g=1", "display_name": "murungu", "link": "https://stackoverflow.com/users/349913/murungu"}, "edited": false, "score": 0, "creation_date": 1468504295, "post_id": 38376027, "comment_id": 64162440, "body": "BTW Is the general term for this operation &quot;hoisting&quot; ?"}, {"owner": {"reputation": 37219, "user_id": 1523776, "user_type": "moderator", "accept_rate": 87, "profile_image": "https://www.gravatar.com/avatar/b3e0b5c8e42a8c38009ef2d969f8dabb?s=128&d=identicon&r=PG", "display_name": "Benjamin Hodgson", "link": "https://stackoverflow.com/users/1523776/benjamin-hodgson"}, "reply_to_user": {"reputation": 1754, "user_id": 349913, "user_type": "registered", "accept_rate": 52, "profile_image": "https://i.stack.imgur.com/yLegF.jpg?s=128&g=1", "display_name": "murungu", "link": "https://stackoverflow.com/users/349913/murungu"}, "edited": false, "score": 0, "creation_date": 1468504937, "post_id": 38376027, "comment_id": 64162889, "body": "<code>hoist</code> is one of those words that means all sorts of things. I just used it here because I couldn&#39;t think of a better one"}, {"owner": {"reputation": 1754, "user_id": 349913, "user_type": "registered", "accept_rate": 52, "profile_image": "https://i.stack.imgur.com/yLegF.jpg?s=128&g=1", "display_name": "murungu", "link": "https://stackoverflow.com/users/349913/murungu"}, "edited": false, "score": 0, "creation_date": 1468505433, "post_id": 38376027, "comment_id": 64163188, "body": "Thanks. It would be nice if there was a catalog of functional design patterns that used consistent terminology for this stuff."}, {"owner": {"reputation": 37219, "user_id": 1523776, "user_type": "moderator", "accept_rate": 87, "profile_image": "https://www.gravatar.com/avatar/b3e0b5c8e42a8c38009ef2d969f8dabb?s=128&d=identicon&r=PG", "display_name": "Benjamin Hodgson", "link": "https://stackoverflow.com/users/1523776/benjamin-hodgson"}, "reply_to_user": {"reputation": 1754, "user_id": 349913, "user_type": "registered", "accept_rate": 52, "profile_image": "https://i.stack.imgur.com/yLegF.jpg?s=128&g=1", "display_name": "murungu", "link": "https://stackoverflow.com/users/349913/murungu"}, "edited": false, "score": 1, "creation_date": 1468506035, "post_id": 38376027, "comment_id": 64163590, "body": "Somewhat relevant: If you look at it sideways, you see something resembling a sequencing operation in the function monad. Supposing you had a homogeneous list of functions <code>[a -&gt; b]</code> (rather than a heterogeneous tuple) then you get <a href=\"https://hackage.haskell.org/package/base-4.9.0.0/docs/Data-Traversable.html#v:sequenceA\" rel=\"nofollow noreferrer\"><code>sequenceA :: [a -&gt; b] -&gt; a -&gt; [b]</code></a> for free."}, {"owner": {"reputation": 6500, "user_id": 57879, "user_type": "registered", "accept_rate": 71, "profile_image": "https://www.gravatar.com/avatar/419a88bdf20aeaa3fb2de53ca0f4d836?s=128&d=identicon&r=PG", "display_name": "yatima2975", "link": "https://stackoverflow.com/users/57879/yatima2975"}, "edited": false, "score": 1, "creation_date": 1468511078, "post_id": 38376027, "comment_id": 64167350, "body": "Somewhat tongue-in-cheek: One of the functional design patterns relevant here is &quot;Don&#39;t use tuples&quot;"}, {"owner": {"reputation": 44013, "user_id": 1477667, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/trgKM.jpg?s=128&g=1", "display_name": "dfeuer", "link": "https://stackoverflow.com/users/1477667/dfeuer"}, "edited": false, "score": 0, "creation_date": 1468524097, "post_id": 38376027, "comment_id": 64174977, "body": "You can surely write something like this using generics. I can&#39;t promise you&#39;ll like it though."}, {"owner": {"reputation": 1754, "user_id": 349913, "user_type": "registered", "accept_rate": 52, "profile_image": "https://i.stack.imgur.com/yLegF.jpg?s=128&g=1", "display_name": "murungu", "link": "https://stackoverflow.com/users/349913/murungu"}, "reply_to_user": {"reputation": 6500, "user_id": 57879, "user_type": "registered", "accept_rate": 71, "profile_image": "https://www.gravatar.com/avatar/419a88bdf20aeaa3fb2de53ca0f4d836?s=128&d=identicon&r=PG", "display_name": "yatima2975", "link": "https://stackoverflow.com/users/57879/yatima2975"}, "edited": false, "score": 0, "creation_date": 1468572736, "post_id": 38376027, "comment_id": 64192336, "body": "@yatima2975 You mentioned &quot;Don&#39;t use tuples&quot;, could you justify your comment? If there is good reason to use some other way of solving this problem I would like to know."}, {"owner": {"reputation": 44013, "user_id": 1477667, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/trgKM.jpg?s=128&g=1", "display_name": "dfeuer", "link": "https://stackoverflow.com/users/1477667/dfeuer"}, "reply_to_user": {"reputation": 1754, "user_id": 349913, "user_type": "registered", "accept_rate": 52, "profile_image": "https://i.stack.imgur.com/yLegF.jpg?s=128&g=1", "display_name": "murungu", "link": "https://stackoverflow.com/users/349913/murungu"}, "edited": false, "score": 0, "creation_date": 1468622001, "post_id": 38376027, "comment_id": 64220284, "body": "@murungu, how did you get yourself into this situation to begin with?"}], "tags": [], "owner": {"reputation": 37219, "user_id": 1523776, "user_type": "moderator", "accept_rate": 87, "profile_image": "https://www.gravatar.com/avatar/b3e0b5c8e42a8c38009ef2d969f8dabb?s=128&d=identicon&r=PG", "display_name": "Benjamin Hodgson", "link": "https://stackoverflow.com/users/1523776/benjamin-hodgson"}, "is_accepted": true, "score": 4, "last_activity_date": 1468504111, "creation_date": 1468504111, "answer_id": 38376027, "question_id": 38375984, "link": "https://stackoverflow.com/questions/38375984/howto-transform-a-tuple-of-functions-into-a-function-that-emits-a-tuple/38376027#38376027", "title": "HOWTO transform a tuple of functions into a function that emits a tuple", "body": "<p>It's pretty simple. You just have to unpack the tuple and apply each function in it to the same input.</p>\n\n<pre><code>hoistTup :: (a -&gt; b, a -&gt; c, a -&gt; d) -&gt; (a -&gt; (b, c, d))\nhoistTup (f, g, h) x = (f x, g x, h x)\n</code></pre>\n"}, {"tags": [], "owner": {"reputation": 384463, "user_id": 1126841, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/fa05233b2357f8d11c22ef4cfc7bb85c?s=128&d=identicon&r=PG", "display_name": "chepner", "link": "https://stackoverflow.com/users/1126841/chepner"}, "is_accepted": false, "score": 0, "last_activity_date": 1468517051, "last_edit_date": 1468517051, "creation_date": 1468512192, "answer_id": 38379033, "question_id": 38375984, "link": "https://stackoverflow.com/questions/38375984/howto-transform-a-tuple-of-functions-into-a-function-that-emits-a-tuple/38379033#38379033", "title": "HOWTO transform a tuple of functions into a function that emits a tuple", "body": "<p><code>Control.Arrow.(&amp;&amp;&amp;)</code> does this for pairs of functions, but it's not immediately extensible to larger tuples.</p>\n\n<pre><code>&gt;&gt;&gt; (negate &amp;&amp;&amp; (+1)) 3\n(-3,4)\n&gt;&gt;&gt; (negate &amp;&amp;&amp; (+1) &amp;&amp;&amp; (+2)) 3\n(-3,(4,5))\n</code></pre>\n\n<p>Using <em>lists</em> of functions, you can just use <code>&lt;*&gt;</code> (after wrapping the input in a list as well):</p>\n\n<pre><code>&gt;&gt;&gt; [negate, (+1), (+2)] &lt;*&gt; [3]\n[-3, 4, 5]\n</code></pre>\n"}], "owner": {"reputation": 1754, "user_id": 349913, "user_type": "registered", "accept_rate": 52, "profile_image": "https://i.stack.imgur.com/yLegF.jpg?s=128&g=1", "display_name": "murungu", "link": "https://stackoverflow.com/users/349913/murungu"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 218, "favorite_count": 1, "accepted_answer_id": 38376027, "answer_count": 2, "score": 2, "last_activity_date": 1468600824, "creation_date": 1468504019, "last_edit_date": 1468600824, "question_id": 38375984, "link": "https://stackoverflow.com/questions/38375984/howto-transform-a-tuple-of-functions-into-a-function-that-emits-a-tuple", "title": "HOWTO transform a tuple of functions into a function that emits a tuple", "body": "<p>Given that I have a tuple of functions with the same input but different outputs:</p>\n\n<pre><code>(A -&gt; B, A -&gt; C, A -&gt; D)\n</code></pre>\n\n<p>How do I convert this into a function that returns a tuple of the respective outputs:</p>\n\n<pre><code>A -&gt; (B,C,D)\n</code></pre>\n\n<p>Is there a generic solution to this problem and does it have a name? Code examples are appreciated. </p>\n"}, {"tags": ["haskell", "typeclass"], "comments": [{"owner": {"reputation": 44013, "user_id": 1477667, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/trgKM.jpg?s=128&g=1", "display_name": "dfeuer", "link": "https://stackoverflow.com/users/1477667/dfeuer"}, "edited": false, "score": 2, "creation_date": 1468479482, "post_id": 38366802, "comment_id": 64146258, "body": "I can see some problems already, but you really should post the definition of <code>Poly</code>."}, {"owner": {"reputation": 44013, "user_id": 1477667, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/trgKM.jpg?s=128&g=1", "display_name": "dfeuer", "link": "https://stackoverflow.com/users/1477667/dfeuer"}, "edited": false, "score": 0, "creation_date": 1468480555, "post_id": 38366802, "comment_id": 64146854, "body": "Also, you should start small and work your way up. Can you write the <code>form</code> function at the top level (not in a <code>where</code> clause), with its own type signature? Once you&#39;ve done that, you can build up a little..."}], "answers": [{"comments": [{"owner": {"reputation": 4545, "user_id": 3901400, "user_type": "registered", "accept_rate": 69, "profile_image": "https://i.stack.imgur.com/gvB8O.jpg?s=128&g=1", "display_name": "Marcus Ruddick", "link": "https://stackoverflow.com/users/3901400/marcus-ruddick"}, "edited": false, "score": 0, "creation_date": 1468512925, "post_id": 38367793, "comment_id": 64168519, "body": "I am attempting to complete the work in this assignment: <a href=\"http://www.seas.upenn.edu/~cis194/hw/04-typeclasses.pdf\" rel=\"nofollow noreferrer\">seas.upenn.edu/~cis194/hw/04-typeclasses.pdf</a>, which is how i start out with <code>newtype Poly a = P [a]</code>, i will add this to the beginning, I got the form portion to work, now attempting to make the comprehension put it all together. thank you for your input, it has been helpful so far!"}, {"owner": {"reputation": 4545, "user_id": 3901400, "user_type": "registered", "accept_rate": 69, "profile_image": "https://i.stack.imgur.com/gvB8O.jpg?s=128&g=1", "display_name": "Marcus Ruddick", "link": "https://stackoverflow.com/users/3901400/marcus-ruddick"}, "edited": false, "score": 0, "creation_date": 1468513082, "post_id": 38367793, "comment_id": 64168602, "body": "I will also edit the code to represent the changes made"}], "tags": [], "owner": {"reputation": 44013, "user_id": 1477667, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/trgKM.jpg?s=128&g=1", "display_name": "dfeuer", "link": "https://stackoverflow.com/users/1477667/dfeuer"}, "is_accepted": true, "score": 5, "last_activity_date": 1468480453, "creation_date": 1468480453, "answer_id": 38367793, "question_id": 38366802, "link": "https://stackoverflow.com/questions/38366802/error-couldnt-match-expected-type-char-with-actual-type-char/38367793#38367793", "title": "error Couldn&#39;t match expected type \u2018Char\u2019 with actual type \u2018[Char]\u2019", "body": "<p>You write</p>\n\n<blockquote>\n  <p>from my understanding haskell's \"append\" function should be able to concatenate a Char to a string/[Char].</p>\n</blockquote>\n\n<p>I have no idea where you got this idea. It's wrong. I'm guessing you've defined</p>\n\n<pre><code>type Poly a = [a]\n</code></pre>\n\n<p>and I'll go with that assumption.</p>\n\n<pre><code>instance (Num a, Show a) =&gt; Show (Poly a) where\n</code></pre>\n\n<p>This is wrong. <code>Poly</code> is a <em>type synonym</em>. You can only declare instances for proper first-class types (the application of a type constructor to zero or more type variables). You can fix this by using, instead,</p>\n\n<pre><code>newtype Poly a = Poly {getPoly :: [a]}\n</code></pre>\n\n<p>but then you need to wrap/unwrap the <code>Poly</code> data constructor as required. Once you've gotten this right, you'll probably see that the <code>Num</code> constraint you've given is unnecessary.</p>\n\n<pre><code>show p = [\"\" ++ form (p !! i) i | i &lt;- [(length p)..0]]\n</code></pre>\n\n<p>There are a few problems. The big one is that this does not define a string (list of characters) but rather a list of strings. You can fix this, generally, by applying <code>concat</code> to the result. The second one is that <code>\"\" ++ anything</code> is just <code>anything</code>, because concatenating the empty list to another list doesn't do anything. The third problem is that you're trying to count down, but you've done it wrong. That notation only counts up. To count down, you have to show that you want to count down:</p>\n\n<pre><code>let lp = length p in [lp, (lp-1) .. 0]\n</code></pre>\n\n<p>The last thing I see immediately (some of these mistakes are repeated in the preceding two lines):</p>\n\n<pre><code>    | otherwise = e ++ \"x^\" ++ i ++ \" + \"\n</code></pre>\n\n<p>Now <code>i</code> is an <code>Int</code>, and <code>++</code> only works for lists. So that will not work. You need to first convert <code>i</code> to a string using <code>show</code>. <code>e</code> is of type <code>a</code>, and needs to be converted to a string using <code>show</code> as well.</p>\n"}], "owner": {"reputation": 4545, "user_id": 3901400, "user_type": "registered", "accept_rate": 69, "profile_image": "https://i.stack.imgur.com/gvB8O.jpg?s=128&g=1", "display_name": "Marcus Ruddick", "link": "https://stackoverflow.com/users/3901400/marcus-ruddick"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 1389, "favorite_count": 0, "accepted_answer_id": 38367793, "answer_count": 1, "score": 1, "last_activity_date": 1468513340, "creation_date": 1468477089, "last_edit_date": 1468513340, "question_id": 38366802, "link": "https://stackoverflow.com/questions/38366802/error-couldnt-match-expected-type-char-with-actual-type-char", "title": "error Couldn&#39;t match expected type \u2018Char\u2019 with actual type \u2018[Char]\u2019", "body": "<p>I am trying to build a string representation for the show function of a typeclass representing a polynomial. I keep getting type errors of a mismatch from 'Char' to '[Char]', but from my understanding haskell's \"append\" function should be able to concatenate a Char to a string/[Char]. I don't understand where the problem lies, or where to look for a solution based on the errors I receive. here is the faulty code:</p>\n\n<pre><code>newtype Poly a = P [a]\n\ninstance (Num a, Show a) =&gt; Show (Poly a) where\n    show p = [\"\" : form (p !! i) i | i &lt;- [l,(l-1)..0]]\n        where\n            l = length p\n            form e i \n                | i == 0 = elem\n                | i == 1 = elem ++ \"x + \"\n                | otherwise = elem ++ \"x^\" ++ (show i) ++ \" + \"\n                    where elem = show e\n</code></pre>\n\n<p>any help would be greatly appreciated, thanks in advance.</p>\n"}]