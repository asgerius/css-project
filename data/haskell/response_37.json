[{"tags": ["haskell", "cabal", "haskell-stack"], "answers": [{"comments": [{"owner": {"reputation": 464, "user_id": 3435730, "user_type": "registered", "accept_rate": 64, "profile_image": "https://www.gravatar.com/avatar/6b4cad01be7d94b2182896e7e9d241d3?s=128&d=identicon&r=PG&f=1", "display_name": "asg0451", "link": "https://stackoverflow.com/users/3435730/asg0451"}, "edited": false, "score": 0, "creation_date": 1443054437, "post_id": 32751481, "comment_id": 53343619, "body": "ahh yes of course. the error&#39;s line number and HTTP&#39;s version number (wtf?) threw me off. Thanks!"}, {"owner": {"reputation": 49959, "user_id": 866915, "user_type": "registered", "accept_rate": 70, "profile_image": "https://www.gravatar.com/avatar/09242131d6e17cbbe31e8547514da6e5?s=128&d=identicon&r=PG", "display_name": "ErikR", "link": "https://stackoverflow.com/users/866915/erikr"}, "reply_to_user": {"reputation": 464, "user_id": 3435730, "user_type": "registered", "accept_rate": 64, "profile_image": "https://www.gravatar.com/avatar/6b4cad01be7d94b2182896e7e9d241d3?s=128&d=identicon&r=PG&f=1", "display_name": "asg0451", "link": "https://stackoverflow.com/users/3435730/asg0451"}, "edited": false, "score": 0, "creation_date": 1443054734, "post_id": 32751481, "comment_id": 53343685, "body": "yeah - the line number is not accurate. any error in the block will be reported at the first line in the block, unfortunately. It&#39;s interesting that cabal doesn&#39;t allow that package name."}], "tags": [], "owner": {"reputation": 49959, "user_id": 866915, "user_type": "registered", "accept_rate": 70, "profile_image": "https://www.gravatar.com/avatar/09242131d6e17cbbe31e8547514da6e5?s=128&d=identicon&r=PG", "display_name": "ErikR", "link": "https://stackoverflow.com/users/866915/erikr"}, "is_accepted": true, "score": 2, "last_activity_date": 1443056337, "last_edit_date": 1443056337, "creation_date": 1443054091, "answer_id": 32751481, "question_id": 32751149, "link": "https://stackoverflow.com/questions/32751149/cabal-fails-to-parse-build-depends-in-test-suite-block/32751481#32751481", "title": "Cabal fails to parse build-depends in test-suite block", "body": "<p>The last line should be:</p>\n\n<pre><code>                 , HTTP\n</code></pre>\n\n<p>and not <code>HTTP-4000</code>. Perhaps you want <code>, HTTP &gt;= 4000</code>.</p>\n\n<p>Here is some more info on the problem...</p>\n\n<p>This is the code in the <code>Cabal</code> library to parse a package name <a href=\"https://hackage.haskell.org/package/Cabal-1.22.4.0/docs/src/Distribution.Package.html#PackageName\" rel=\"nofollow\">(link)</a></p>\n\n<pre><code>instance Text PackageName where\n  disp (PackageName n) = Disp.text n\n  parse = do\n    ns &lt;- Parse.sepBy1 component (Parse.char '-')\n    return (PackageName (intercalate \"-\" ns))\n    where\n      component = do\n        cs &lt;- Parse.munch1 Char.isAlphaNum\n        if all Char.isDigit cs then Parse.pfail else return cs\n        -- each component must contain an alphabetic character, to avoid\n        -- ambiguity in identifiers like foo-1 (the 1 is the version number).\n</code></pre>\n\n<p>Note the comment at the end. Perhaps at one time <code>build-depends:</code> accepted the syntax <code>name-version</code>, e.g. <code>aeson-0.10.0.0</code>, and later this was changed to require use of the relational operators, e.g. <code>aeson == 0.10.0.0</code>.</p>\n\n<p>Now that we always use the relational operators perhaps it might be possible to allow package names with an all numeric component.</p>\n\n<p>In any case, something like <code>foo-123x</code> is a valid package name since the second component isn't all numeric.</p>\n"}], "owner": {"reputation": 464, "user_id": 3435730, "user_type": "registered", "accept_rate": 64, "profile_image": "https://www.gravatar.com/avatar/6b4cad01be7d94b2182896e7e9d241d3?s=128&d=identicon&r=PG&f=1", "display_name": "asg0451", "link": "https://stackoverflow.com/users/3435730/asg0451"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 1262, "favorite_count": 1, "accepted_answer_id": 32751481, "answer_count": 1, "score": 2, "last_activity_date": 1443056337, "creation_date": 1443051423, "last_edit_date": 1443051623, "question_id": 32751149, "link": "https://stackoverflow.com/questions/32751149/cabal-fails-to-parse-build-depends-in-test-suite-block", "title": "Cabal fails to parse build-depends in test-suite block", "body": "<p>I am trying to add testing to a package I am working on (I am using stack). Everything worked up until this point. I am running the following versions (as up-to-date as my ubuntu will get):</p>\n\n<pre><code>cabal-install version 1.22.6.0\nusing version 1.22.4.0 of the Cabal library\n\nStack: Version 0.1.4.0, Git revision 3a665fe1bc52776041a1c25cc47734e691805b6c (1724 commits) X86_64\n</code></pre>\n\n<p>This is the offending section:</p>\n\n<pre><code>Test-Suite test-one\n  main-is: Test.hs\n  type: exitcode-stdio-1.0\n  hs-source-dirs: test\n  build-depends: base &gt;= 4.7 &amp;&amp; &lt; 5\n               , scotty &gt;= 0.10.2\n               , scotty-login-session\n               , text\n               , wai\n               , wai-extra\n               , HUnit\n               , HTTP-4000\n</code></pre>\n\n<p>and this is the error that stack/cabal give when trying to build or test:</p>\n\n<pre><code>Unable to parse cabal file &lt;mypackage&gt;.cabal: NoParse \"build-depends\" 44\n</code></pre>\n\n<p>that 44 is the build-depends line above.</p>\n\n<p>What is happening here? I followed the Cabal User Guide, and my google-fu turned up nothing. The rest of the cabal file is linked <a href=\"http://lpaste.net/141589\" rel=\"nofollow\">here</a> for reference.</p>\n\n<p>My system is ubuntu 14.04 LTS if that helps.</p>\n"}, {"tags": ["python", "haskell", "numpy"], "comments": [{"owner": {"reputation": 23444, "user_id": 414413, "user_type": "registered", "accept_rate": 79, "profile_image": "https://www.gravatar.com/avatar/6de2113f01432aa844dc85070ff33e89?s=128&d=identicon&r=PG", "display_name": "Cirdec", "link": "https://stackoverflow.com/users/414413/cirdec"}, "edited": false, "score": 0, "creation_date": 1443052319, "post_id": 32751054, "comment_id": 53343096, "body": "Are you sure that in <code>feedforward</code> <code>a</code> should have type <code>Float</code>? Shouldn&#39;t the input to the network be a vector like <code>[Float]</code>, or does the network always have only one input? If the network has more than one input, each neuron should have a vector of weights <code>[Float]</code>, a layer would be multiple neurons <code>[[Float]]</code> and the entire multiple layer network would be multiple layers <code>[[[Float]]]</code>."}, {"owner": {"reputation": 1220, "user_id": 2124732, "user_type": "registered", "accept_rate": 86, "profile_image": "https://www.gravatar.com/avatar/cf9d2998c0d9cb26334028f72185fe38?s=128&d=identicon&r=PG", "display_name": "Christopher Dumas", "link": "https://stackoverflow.com/users/2124732/christopher-dumas"}, "reply_to_user": {"reputation": 23444, "user_id": 414413, "user_type": "registered", "accept_rate": 79, "profile_image": "https://www.gravatar.com/avatar/6de2113f01432aa844dc85070ff33e89?s=128&d=identicon&r=PG", "display_name": "Cirdec", "link": "https://stackoverflow.com/users/414413/cirdec"}, "edited": false, "score": 0, "creation_date": 1443052748, "post_id": 32751054, "comment_id": 53343216, "body": "Yeah, I just came to that (or a similar) conciliation just now. I&#39;m really messing with stuff I don&#39;t understand very well here, though. Thanks!"}, {"owner": {"reputation": 2838, "user_id": 3614521, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/AR81q.png?s=128&g=1", "display_name": "Mephy", "link": "https://stackoverflow.com/users/3614521/mephy"}, "edited": false, "score": 2, "creation_date": 1443055429, "post_id": 32751054, "comment_id": 53343854, "body": "You could write unit tests for both programs and compare the results."}, {"owner": {"reputation": 49959, "user_id": 866915, "user_type": "registered", "accept_rate": 70, "profile_image": "https://www.gravatar.com/avatar/09242131d6e17cbbe31e8547514da6e5?s=128&d=identicon&r=PG", "display_name": "ErikR", "link": "https://stackoverflow.com/users/866915/erikr"}, "edited": false, "score": 0, "creation_date": 1443058711, "post_id": 32751054, "comment_id": 53344529, "body": "You might interested in this simple <a href=\"http://iamtrask.github.io/2015/07/12/basic-python-network/\" rel=\"nofollow noreferrer\">Python implementation</a> and this <a href=\"https://gist.github.com/gatlin/e81b8c572b2f284f1423\" rel=\"nofollow noreferrer\">Haskell version</a>"}, {"owner": {"reputation": 84731, "user_id": 510937, "user_type": "registered", "accept_rate": 80, "profile_image": "https://www.gravatar.com/avatar/70b13a9ae1aae1ca1aa6ac8dab4643f2?s=128&d=identicon&r=PG", "display_name": "Bakuriu", "link": "https://stackoverflow.com/users/510937/bakuriu"}, "edited": false, "score": 2, "creation_date": 1443072251, "post_id": 32751054, "comment_id": 53347878, "body": "Well, there is an obvious difference. <code>np.random.randn</code> isn&#39;t a pure function while your <code>rands</code> is. If you want to generate random numbers in Haskell you&#39;d have to use <a href=\"https://hackage.haskell.org/package/random-1.1/docs/System-Random.html\" rel=\"nofollow noreferrer\"><code>System.Random</code></a>."}], "answers": [{"tags": [], "owner": {"reputation": 33184, "user_id": 247623, "user_type": "registered", "accept_rate": 72, "profile_image": "https://www.gravatar.com/avatar/bb9e67348d3e0e93ef12dd97c41a6c22?s=128&d=identicon&r=PG&f=1", "display_name": "Erik Kaplun", "link": "https://stackoverflow.com/users/247623/erik-kaplun"}, "is_accepted": true, "score": 1, "last_activity_date": 1443109485, "last_edit_date": 1443109485, "creation_date": 1443089147, "answer_id": 32758622, "question_id": 32751054, "link": "https://stackoverflow.com/questions/32751054/is-this-haskell-code-equivalent-to-this-python-code/32758622#32758622", "title": "Is this Haskell code equivalent to this Python code?", "body": "\n\n<p>First of all: note that the Python version lacks the equivalent of <code>deriving (Show, Eq, Ord)</code> \u2014 try implementing the corresponding <code>__magic__</code> methods and see how many lines of code are added. Without these, <code>==</code>, <code>&lt;=</code>, <code>&gt;</code>, as well as <code>print Network()</code> make little to no sense.</p>\n\n<p>Basically the verbosity mainly comes from the type signatures. Also, you can move <code>rands</code> to a <code>where</code> block under <code>buildNetwork</code> and simply completely get rid of <code>toFloat</code> by replacing any calls to <code>toFloat</code> with <code>fromIntegral</code> with no type annotation. Plus perhaps some other tiny refactorings.</p>\n\n<p>In general, you can expect, in some situations, for some things to be somewhat more verbose in languages that are generally much more concise. I'm sure as your neural network program progresses towards a more substantial code base, Haskell will be less verbose than Python, ignoring the possible existence of neural network libraries for Python that might be more mature than their (possibly non-existent) Haskell counterparts.</p>\n\n<pre class=\"lang-hs prettyprint-override\"><code>data NNetwork = NNetwork { nlayers :: Int\n                         , sizes   :: [Int]\n                         , biases  :: [[Float]]\n                         , weights :: [[Float]] }\n                deriving (Show, Ord, Eq)\n\nbuildNetwork sizes =\n  NNetwork { nlayers = length sizes\n           , sizes   = sizes\n           , biases  = map (\\y -&gt; replicate y (sig . fromIntegral . rands $ y)) sizes\n           , weights = map (\\y -&gt; replicate y (fromIntegral . rands $ y)) sizes }\n  where rands x = (7 * x) `mod` 11\n\nfeedforward net a = map (equation a) (zip (weights net) (biases net))\n\nsig a = 1 / (1 + exp (-a))\n\nequation a (w, b) = map sig $ zipWith (+) (dot w rep) b\n  where dot = zipWith (*)\n        rep = replicate (length w) a\n</code></pre>\n\n<p>and well you can do some micro-refactorings in the <code>buildNetwork</code> to remove some minor duplication but that would just shorten the lines, and would possibly make the code less readable to a domain expert:</p>\n\n<pre class=\"lang-hs prettyprint-override\"><code>buildNetwork sizes =\n  NNetwork { nlayers = length sizes\n           , sizes   = sizes\n           , biases  = nameMe sig\n           , weights = nameMe id }\n  where nameMe fn = map (replicate y (fn y')) sizes\n        y'        = fromIntegral $ y * 7 `mod` 11\n</code></pre>\n"}], "owner": {"reputation": 1220, "user_id": 2124732, "user_type": "registered", "accept_rate": 86, "profile_image": "https://www.gravatar.com/avatar/cf9d2998c0d9cb26334028f72185fe38?s=128&d=identicon&r=PG", "display_name": "Christopher Dumas", "link": "https://stackoverflow.com/users/2124732/christopher-dumas"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 284, "favorite_count": 0, "accepted_answer_id": 32758622, "answer_count": 1, "score": 2, "last_activity_date": 1443109485, "creation_date": 1443050733, "question_id": 32751054, "link": "https://stackoverflow.com/questions/32751054/is-this-haskell-code-equivalent-to-this-python-code", "title": "Is this Haskell code equivalent to this Python code?", "body": "<p>I'm trying to port a Python program to Haskell, and I'm fairly new to NumPy (which the Python program uses) So I'm wondering why this code isn't equivalent.\nHere's my Haskell code:</p>\n\n<pre><code>data NNetwork = NNetwork { nlayers :: Int\n                         , sizes   :: [Int]\n                         , biases  :: [[Float]]\n                         , weights :: [[Float]] }\n                deriving (Show, Ord, Eq)\n\nbuildNetwork :: [Int] -&gt; NNetwork\nbuildNetwork sizes = NNetwork { nlayers = length sizes\n                              , sizes   = sizes\n                              , biases  = map (\\y -&gt; replicate y (sig . toFloat . rands $ y)) sizes\n                              , weights = map (\\y -&gt; replicate y (toFloat $ rands y)) sizes }\nfeedforward :: NNetwork -&gt; Float -&gt; [[Float]]\nfeedforward net a = map (equation a) (zip (weights net) (biases net))\n\ntoFloat x = fromIntegral x :: Float\n\nsig :: Float -&gt; Float\nsig a = 1 / (1 + exp (-a))\n\nrands :: Int -&gt; Int\nrands x = (7 * x) `mod` 11\n\nequation :: Float -&gt; ([Float], [Float]) -&gt; [Float]\nequation a (w, b) = map sig $ zipWith (+) (dot w (rep w a)) b\n  where dot = zipWith (*)\n        rep a b = replicate (length a) b\n</code></pre>\n\n<p>And the original Python code:</p>\n\n<pre><code>class Network(object):\n\n    def __init__(self, sizes):\n        self.num_layers = len(sizes)\n        self.sizes = sizes\n        self.biases = [np.random.randn(y, 1) for y in sizes[1:]]\n        self.weights = [np.random.randn(y, x) \n                        for x, y in zip(sizes[:-1], sizes[1:])]\n\ndef sigmoid(z):\n    return 1.0/(1.0+np.exp(-z))\n\ndef feedforward(self, a):\n        \"\"\"Return the output of the network if \"a\" is input.\"\"\"\n        for b, w in zip(self.biases, self.weights):\n            a = sigmoid(np.dot(w, a)+b)\n        return a\n</code></pre>\n\n<p>I'm trying to port a very simple neural network program from Python to Haskell, because I enjoy Haskell much more. I'm also worried that I'm doing something wrong, because the Haskell code is far more verbose.</p>\n\n<p>- Thanks!</p>\n"}, {"tags": ["haskell", "types", "compiler-errors"], "comments": [{"owner": {"reputation": 21417, "user_id": 925978, "user_type": "registered", "accept_rate": 84, "profile_image": "https://www.gravatar.com/avatar/06e4467a5bd1538a92cefb20db07897a?s=128&d=identicon&r=PG&f=1", "display_name": "crockeea", "link": "https://stackoverflow.com/users/925978/crockeea"}, "edited": false, "score": 0, "creation_date": 1443047422, "post_id": 32750414, "comment_id": 53341650, "body": "You haven&#39;t given us most of your code (<code>biases</code>? <code>NNetwork</code>? <code>sig</code>?), so we can&#39;t help."}, {"owner": {"reputation": 62421, "user_id": 216164, "user_type": "registered", "accept_rate": 89, "profile_image": "https://www.gravatar.com/avatar/786f224adbe0784cdf7d0f15476061fe?s=128&d=identicon&r=PG", "display_name": "Thomas M. DuBuisson", "link": "https://stackoverflow.com/users/216164/thomas-m-dubuisson"}, "edited": false, "score": 1, "creation_date": 1443052081, "post_id": 32750414, "comment_id": 53343047, "body": "Add more type signatures. For example, if you give a type to <code>eq22</code> and the compiler disagrees with that type then you will get a more localized, and typically easier to understand, type error."}], "answers": [{"tags": [], "owner": {"reputation": 62421, "user_id": 216164, "user_type": "registered", "accept_rate": 89, "profile_image": "https://www.gravatar.com/avatar/786f224adbe0784cdf7d0f15476061fe?s=128&d=identicon&r=PG", "display_name": "Thomas M. DuBuisson", "link": "https://stackoverflow.com/users/216164/thomas-m-dubuisson"}, "is_accepted": true, "score": 2, "last_activity_date": 1443052475, "creation_date": 1443052475, "answer_id": 32751285, "question_id": 32750414, "link": "https://stackoverflow.com/questions/32750414/haskell-strange-zip-error/32751285#32751285", "title": "Haskell strange `zip` error", "body": "<p>The problem is:</p>\n\n<pre><code>eq22 :: Float -&gt; ([Float], [Float]) -&gt;  Float\neq22 a (w, b) = sig $ (dot w (rep w a)) + b\n</code></pre>\n\n<p>Except that in this context <code>b</code> is a <code>[Float]</code> and used as a <code>Float</code> (see <code>+ b</code>).  Did you mean some sort of function over <code>b</code>?</p>\n\n<p>Also, these are not arrays, but lists.</p>\n"}], "owner": {"reputation": 1220, "user_id": 2124732, "user_type": "registered", "accept_rate": 86, "profile_image": "https://www.gravatar.com/avatar/cf9d2998c0d9cb26334028f72185fe38?s=128&d=identicon&r=PG", "display_name": "Christopher Dumas", "link": "https://stackoverflow.com/users/2124732/christopher-dumas"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 78, "favorite_count": 0, "accepted_answer_id": 32751285, "answer_count": 1, "score": -1, "last_activity_date": 1443052475, "creation_date": 1443046556, "last_edit_date": 1443048014, "question_id": 32750414, "link": "https://stackoverflow.com/questions/32750414/haskell-strange-zip-error", "title": "Haskell strange `zip` error", "body": "<p>I'm trying to zip two <code>[[Float]]</code> arrays, and then preform a calculation on each element. The resulting zip-ed array will have type <code>[([Float], [Float])]</code>, I think.</p>\n\n<p>But I keep on getting an error where Haskell tells me:</p>\n\n<pre><code>[1 of 1] Compiling Mod               ( Mod.hs, interpreted )\n\nNN.hs:38:42:\n    Couldn't match type \u2018[Float]\u2019 with \u2018Float\u2019\n    Expected type: [Float]\n      Actual type: [[Float]]\n    In the second argument of \u2018zip\u2019, namely \u2018bs\u2019\n    In the second argument of \u2018map\u2019, namely \u2018(zip ws bs)\u2019\nFailed, modules loaded: none.\n</code></pre>\n\n<p>I can't seem to figure out a MCVE, because this is what if (kinda/sorta) trying to do:</p>\n\n<pre><code>feedforward :: ([[Float]], [[Float]]) -&gt; Float -&gt; [Float]\nfeedforward (ws, bs) a = map (equation a) (zip ws bs)\n  where equation a (w, b) = (sum $ zipWith (*) w b) + a\n</code></pre>\n\n<p>But that actually compiles! Whereas my real code looks like this:</p>\n\n<pre><code>data NNetwork = NNetwork { nlayers :: Int\n                         , sizes   :: [Int]\n                         , biases  :: [[Float]]\n                         , weights :: [[Float]] }\n                deriving (Show, Ord, Eq)\n\ntoFloat x = fromIntegral x :: Float\n\nsig :: Float -&gt; Float\nsig a = 1 / (1 + exp (-a))\n\n\nfeedforward :: NNetwork -&gt; Float -&gt; [Float]\nfeedforward net a = map (eq22 a) (zip ws bs)\n  where bs = biases net\n        ws = weights net\n        dot a b = sum $ zipWith (*) a b\n        rep a b = replicate (length a) b\n        eq22 a (w, b) = sig $ (dot w (rep w a)) + b\n</code></pre>\n\n<p>And yet it <strong>doesn't work</strong>!</p>\n\n<p>- Thanks in advance</p>\n"}, {"tags": ["algorithm", "haskell"], "comments": [{"owner": {"reputation": 1955, "user_id": 1211428, "user_type": "registered", "accept_rate": 83, "profile_image": "https://www.gravatar.com/avatar/c4514c5bec0f849d1a202dd4fb25a6dc?s=128&d=identicon&r=PG", "display_name": "zaquest", "link": "https://stackoverflow.com/users/1211428/zaquest"}, "edited": false, "score": 1, "creation_date": 1443039315, "post_id": 32748205, "comment_id": 53338031, "body": "If <code>f :: a -&gt; a</code> is the whole type then all this function can do is to either raise an error or return its argument. Assuming its not doing something magical I&#39;d tell <code>f = id</code>."}, {"owner": {"reputation": 48129, "user_id": 76051, "user_type": "registered", "accept_rate": 91, "profile_image": "https://i.stack.imgur.com/AGDxz.jpg?s=128&g=1", "display_name": "Carsten", "link": "https://stackoverflow.com/users/76051/carsten"}, "edited": false, "score": 1, "creation_date": 1443039530, "post_id": 32748205, "comment_id": 53338161, "body": "surely you want <code>Eq a =&gt; a -&gt; a</code> right? without it you cannot even tell if <code>f a == f b</code> for some <code>a,b</code>, and you really want <code>cycleLength :: Eq a =&gt; (a -&gt; a) -&gt; a -&gt; Integer</code> I guess?"}, {"owner": {"reputation": 35444, "user_id": 656912, "user_type": "registered", "accept_rate": 66, "profile_image": "https://www.gravatar.com/avatar/ce95c01cbd4f90f014d988ae5c8a422d?s=128&d=identicon&r=PG", "display_name": "orome", "link": "https://stackoverflow.com/users/656912/orome"}, "reply_to_user": {"reputation": 48129, "user_id": 76051, "user_type": "registered", "accept_rate": 91, "profile_image": "https://i.stack.imgur.com/AGDxz.jpg?s=128&g=1", "display_name": "Carsten", "link": "https://stackoverflow.com/users/76051/carsten"}, "edited": false, "score": 0, "creation_date": 1443039611, "post_id": 32748205, "comment_id": 53338191, "body": "@Carsten: Yes, I should have specified that (it is the case). Fixed."}, {"owner": {"reputation": 48129, "user_id": 76051, "user_type": "registered", "accept_rate": 91, "profile_image": "https://i.stack.imgur.com/AGDxz.jpg?s=128&g=1", "display_name": "Carsten", "link": "https://stackoverflow.com/users/76051/carsten"}, "edited": false, "score": 0, "creation_date": 1443039699, "post_id": 32748205, "comment_id": 53338247, "body": "in this case you can do some very basic (really bad perfomance) stuff by iterative adding values to a list till you hit an existing element and then get the length of it I guess"}, {"owner": {"reputation": 35444, "user_id": 656912, "user_type": "registered", "accept_rate": 66, "profile_image": "https://www.gravatar.com/avatar/ce95c01cbd4f90f014d988ae5c8a422d?s=128&d=identicon&r=PG", "display_name": "orome", "link": "https://stackoverflow.com/users/656912/orome"}, "reply_to_user": {"reputation": 48129, "user_id": 76051, "user_type": "registered", "accept_rate": 91, "profile_image": "https://i.stack.imgur.com/AGDxz.jpg?s=128&g=1", "display_name": "Carsten", "link": "https://stackoverflow.com/users/76051/carsten"}, "edited": false, "score": 0, "creation_date": 1443039856, "post_id": 32748205, "comment_id": 53338319, "body": "@Carsten: Not sure about <code>cycleLength</code> (or where to find it)."}], "answers": [{"comments": [{"owner": {"reputation": 35444, "user_id": 656912, "user_type": "registered", "accept_rate": 66, "profile_image": "https://www.gravatar.com/avatar/ce95c01cbd4f90f014d988ae5c8a422d?s=128&d=identicon&r=PG", "display_name": "orome", "link": "https://stackoverflow.com/users/656912/orome"}, "edited": false, "score": 0, "creation_date": 1443040046, "post_id": 32748669, "comment_id": 53338419, "body": "Looks like you&#39;re the last man standing: All the other answers have vanished (and didn&#39;t work). Help!"}, {"owner": {"reputation": 171740, "user_id": 869736, "user_type": "registered", "accept_rate": 82, "profile_image": "https://www.gravatar.com/avatar/671f732e3c68c387c702112a30e5ebd8?s=128&d=identicon&r=PG&f=1", "display_name": "Louis Wasserman", "link": "https://stackoverflow.com/users/869736/louis-wasserman"}, "reply_to_user": {"reputation": 35444, "user_id": 656912, "user_type": "registered", "accept_rate": 66, "profile_image": "https://www.gravatar.com/avatar/ce95c01cbd4f90f014d988ae5c8a422d?s=128&d=identicon&r=PG", "display_name": "orome", "link": "https://stackoverflow.com/users/656912/orome"}, "edited": false, "score": 0, "creation_date": 1443040611, "post_id": 32748669, "comment_id": 53338707, "body": "The linked article outlines some algorithms for the problem pretty clearly.  Have you tried implementing them?"}, {"owner": {"reputation": 35444, "user_id": 656912, "user_type": "registered", "accept_rate": 66, "profile_image": "https://www.gravatar.com/avatar/ce95c01cbd4f90f014d988ae5c8a422d?s=128&d=identicon&r=PG", "display_name": "orome", "link": "https://stackoverflow.com/users/656912/orome"}, "edited": false, "score": 0, "creation_date": 1443040782, "post_id": 32748669, "comment_id": 53338810, "body": "No, not in the few minutes since I asked the question."}, {"owner": {"reputation": 11366, "user_id": 3922954, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/76ba47d2fdd24ab56b0b273cce2075e5?s=128&d=identicon&r=PG&f=1", "display_name": "AJF", "link": "https://stackoverflow.com/users/3922954/ajf"}, "edited": false, "score": 1, "creation_date": 1443042448, "post_id": 32748669, "comment_id": 53339625, "body": "Can you add more to this answer than just a link?"}, {"owner": {"reputation": 61419, "user_id": 849891, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/MbEO3.png?s=128&g=1", "display_name": "Will Ness", "link": "https://stackoverflow.com/users/849891/will-ness"}, "edited": false, "score": 0, "creation_date": 1443052596, "post_id": 32748669, "comment_id": 53343179, "body": "and the answer to the OP&#39;s question seems to be: <code>mu + lam</code>."}, {"owner": {"reputation": 17809, "user_id": 1088108, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/63781cd38e91aa346a3849bc3ef3e550?s=128&d=identicon&r=PG&f=1", "display_name": "&#216;rjan Johansen", "link": "https://stackoverflow.com/users/1088108/%c3%98rjan-johansen"}, "edited": false, "score": 0, "creation_date": 1443053113, "post_id": 32748669, "comment_id": 53343313, "body": "I think this does more work than necessary to answer OP&#39;s question, though."}], "tags": [], "owner": {"reputation": 171740, "user_id": 869736, "user_type": "registered", "accept_rate": 82, "profile_image": "https://www.gravatar.com/avatar/671f732e3c68c387c702112a30e5ebd8?s=128&d=identicon&r=PG&f=1", "display_name": "Louis Wasserman", "link": "https://stackoverflow.com/users/869736/louis-wasserman"}, "is_accepted": true, "score": 9, "last_activity_date": 1443050062, "last_edit_date": 1443050062, "creation_date": 1443039284, "answer_id": 32748669, "question_id": 32748205, "link": "https://stackoverflow.com/questions/32748205/how-do-i-determine-the-number-of-values-assumed-by-a-repeating-function-in-has/32748669#32748669", "title": "How do I determine the number of values assumed by a &quot;repeating&quot; function in Haskell?", "body": "<p>This is literally exactly the problem addressed by <a href=\"https://en.wikipedia.org/wiki/Cycle_detection\" rel=\"nofollow\">https://en.wikipedia.org/wiki/Cycle_detection</a> .  That page specifies several well-known solutions to that problem.</p>\n\n<p>Here's an untested Haskell implementation of the basic tortoise-and-hare algorithm:</p>\n\n<pre><code>floyd :: Eq a =&gt; (a -&gt; a) -&gt; a -&gt; (Int, Int)\nfloyd f x0 = (lam, mu) where\n  hare0 = head\n    [t | (h, t) &lt;- tail $ zip (iterate f x0) (iterate (f . f) x0), h == t]\n  (mu, tortoise1) = head \n    [(m, t) | (m, t, h) &lt;- zip3 [0..] (iterate f x0) (iterate f hare0), t == h]\n  lam = head [l | (l, h) &lt;- zip [1..] (iterate f (f tortoise1)), h == tortoise1]\n</code></pre>\n"}, {"comments": [{"owner": {"reputation": 35444, "user_id": 656912, "user_type": "registered", "accept_rate": 66, "profile_image": "https://www.gravatar.com/avatar/ce95c01cbd4f90f014d988ae5c8a422d?s=128&d=identicon&r=PG", "display_name": "orome", "link": "https://stackoverflow.com/users/656912/orome"}, "edited": false, "score": 0, "creation_date": 1443040711, "post_id": 32748947, "comment_id": 53338765, "body": "That&#39;s certainly faster than what I was doing (and seems to work)!"}, {"owner": {"reputation": 48129, "user_id": 76051, "user_type": "registered", "accept_rate": 91, "profile_image": "https://i.stack.imgur.com/AGDxz.jpg?s=128&g=1", "display_name": "Carsten", "link": "https://stackoverflow.com/users/76051/carsten"}, "reply_to_user": {"reputation": 35444, "user_id": 656912, "user_type": "registered", "accept_rate": 66, "profile_image": "https://www.gravatar.com/avatar/ce95c01cbd4f90f014d988ae5c8a422d?s=128&d=identicon&r=PG", "display_name": "orome", "link": "https://stackoverflow.com/users/656912/orome"}, "edited": false, "score": 0, "creation_date": 1443040774, "post_id": 32748947, "comment_id": 53338804, "body": "still the algorithms you&#39;ll find in the wiki article Louis linked will be a lot faster ;)"}, {"owner": {"reputation": 17809, "user_id": 1088108, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/63781cd38e91aa346a3849bc3ef3e550?s=128&d=identicon&r=PG&f=1", "display_name": "&#216;rjan Johansen", "link": "https://stackoverflow.com/users/1088108/%c3%98rjan-johansen"}, "edited": false, "score": 0, "creation_date": 1443052928, "post_id": 32748947, "comment_id": 53343262, "body": "An &quot;obvious&quot; improvement is to use something like <code>Data.Set</code> for the &quot;accumulator&quot; instead of a list (requires an <code>Ord</code> constraint though). Also note that a full <code>unfoldr</code> isn&#39;t necessary unless you need the lazily produced list: just the take the length of the final accumulater."}], "tags": [], "owner": {"reputation": 48129, "user_id": 76051, "user_type": "registered", "accept_rate": 91, "profile_image": "https://i.stack.imgur.com/AGDxz.jpg?s=128&g=1", "display_name": "Carsten", "link": "https://stackoverflow.com/users/76051/carsten"}, "is_accepted": false, "score": 2, "last_activity_date": 1443040385, "creation_date": 1443040385, "answer_id": 32748947, "question_id": 32748205, "link": "https://stackoverflow.com/questions/32748205/how-do-i-determine-the-number-of-values-assumed-by-a-repeating-function-in-has/32748947#32748947", "title": "How do I determine the number of values assumed by a &quot;repeating&quot; function in Haskell?", "body": "<p>Ok, here is the very basic idea I was commenting about:</p>\n\n<pre><code>import Data.List(unfoldr, genericLength)\n\ncycleLen :: Eq a =&gt; (a -&gt; a) -&gt; a -&gt; Integer\ncycleLen f a0 = 1 + genericLength (unfoldr gen [a0])\n  where gen xs@(x:_) =\n          let a' = f x\n          in if a' `elem` xs then Nothing else Just (a',a':xs)\n        gen [] = undefined\n</code></pre>\n\n<p>let's test it with some very basic function:</p>\n\n<pre><code>test :: Int -&gt; Int\ntest x = (x*2+1) `mod` 10\n\n\u03bb&gt; cycleLen test 0\n5\n\u03bb&gt; take 6 (iterate test 0)\n[0,1,3,7,5,1]\n\n\u03bb&gt; cycleLen test 4\n2\n\u03bb&gt; take 6 (iterate test 4)\n[4,9,9,9,9,9]\n</code></pre>\n\n<p>seems fine ;)</p>\n\n<p>but beware: it's surely not the optimal way to do it - but it works for small stuff I guess</p>\n"}], "owner": {"reputation": 35444, "user_id": 656912, "user_type": "registered", "accept_rate": 66, "profile_image": "https://www.gravatar.com/avatar/ce95c01cbd4f90f014d988ae5c8a422d?s=128&d=identicon&r=PG", "display_name": "orome", "link": "https://stackoverflow.com/users/656912/orome"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 119, "favorite_count": 0, "accepted_answer_id": 32748669, "answer_count": 2, "score": 3, "last_activity_date": 1443050062, "creation_date": 1443037426, "last_edit_date": 1443039629, "question_id": 32748205, "link": "https://stackoverflow.com/questions/32748205/how-do-i-determine-the-number-of-values-assumed-by-a-repeating-function-in-has", "title": "How do I determine the number of values assumed by a &quot;repeating&quot; function in Haskell?", "body": "<p>I have a function</p>\n\n<pre><code>f :: Eq a =&gt; a -&gt; a\n</code></pre>\n\n<p>which I know eventually repeats itself (I'm not quite sure what such a function is called; \"periodic\" comes to mind, but that's a bit different, isn't it), and I want to determine how many unique values it produces.</p>\n\n<p>Naively, something like</p>\n\n<pre><code>import Data.List (nub)\nlength $ nub $ take n $ iterate f a0\n</code></pre>\n\n<p>where <code>a0</code> is some initial <code>a</code> and <code>n</code> is some large number that I know exceeds the number of unique values for <code>f</code>, will work. But, in addition to having the obvious drawback that I must guess or trial-and-error <code>n</code>, this is impractical (in my case, anyway) because <code>f</code> can be time-consuming.</p>\n\n<p>What is the best way to find the list of unique value produced by recurring application of such a \"repeating\" (or whatever the correct term is) function in Haskell?</p>\n"}, {"tags": ["haskell", "parametric-polymorphism", "subtyping", "type-theory"], "comments": [{"owner": {"reputation": 11366, "user_id": 3922954, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/76ba47d2fdd24ab56b0b273cce2075e5?s=128&d=identicon&r=PG&f=1", "display_name": "AJF", "link": "https://stackoverflow.com/users/3922954/ajf"}, "edited": false, "score": 0, "creation_date": 1443034261, "post_id": 32747094, "comment_id": 53335200, "body": "<code>undefined</code> is <i>not</i> subtyping. It is an error. Why do you think this is subtyping?"}, {"owner": {"reputation": 81794, "user_id": 9859, "user_type": "registered", "accept_rate": 89, "profile_image": "https://i.stack.imgur.com/KEZOL.jpg?s=128&g=1", "display_name": "rampion", "link": "https://stackoverflow.com/users/9859/rampion"}, "edited": false, "score": 4, "creation_date": 1443034465, "post_id": 32747094, "comment_id": 53335312, "body": "Here&#39;s a different example: <code>mempty :: forall m. Monoid m =&gt; m</code> and <code>let x = mempty :: [Int]</code>."}, {"owner": {"reputation": 81794, "user_id": 9859, "user_type": "registered", "accept_rate": 89, "profile_image": "https://i.stack.imgur.com/KEZOL.jpg?s=128&g=1", "display_name": "rampion", "link": "https://stackoverflow.com/users/9859/rampion"}, "edited": false, "score": 0, "creation_date": 1443034572, "post_id": 32747094, "comment_id": 53335389, "body": "But I distract - what&#39;s really going on here is any value of type <code>forall a. a</code> is equivalent to <a href=\"https://wiki.haskell.org/Bottom\" rel=\"nofollow noreferrer\">bottom</a> - &quot;bottom is an inhabitant of every type (though with some caveats concerning types of unboxed kind), bottoms can be used wherever a value of that type would be.&quot;"}, {"owner": {"reputation": 81794, "user_id": 9859, "user_type": "registered", "accept_rate": 89, "profile_image": "https://i.stack.imgur.com/KEZOL.jpg?s=128&g=1", "display_name": "rampion", "link": "https://stackoverflow.com/users/9859/rampion"}, "edited": false, "score": 0, "creation_date": 1443034754, "post_id": 32747094, "comment_id": 53335492, "body": "The <code>Monoid</code> example is quite different, since what&#39;s really happening is that the typeclass instances are passed behind the scenes like a dictionary, so that the type restriction <code>::[Int]</code> causes a lookup in that dictionary."}, {"owner": {"reputation": 30739, "user_id": 1804599, "user_type": "registered", "accept_rate": 84, "profile_image": "https://i.stack.imgur.com/v91P3.jpg?s=128&g=1", "display_name": "rightfold", "link": "https://stackoverflow.com/users/1804599/rightfold"}, "edited": false, "score": 5, "creation_date": 1443034770, "post_id": 32747094, "comment_id": 53335505, "body": "Nontermination (bottom) is about the value. This question is about the type."}, {"owner": {"reputation": 100185, "user_id": 3234959, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/93bb12ca0f93dfddb33880316f7e66c2?s=128&d=identicon&r=PG&f=1", "display_name": "chi", "link": "https://stackoverflow.com/users/3234959/chi"}, "edited": false, "score": 1, "creation_date": 1443038601, "post_id": 32747094, "comment_id": 53337670, "body": "Just a practical example: you can write <code>[Int]</code> but you can&#39;t write <code>[forall a. a]</code> (unless you enable impredicativity, which does not work so well with type inference)."}, {"owner": {"reputation": 17809, "user_id": 1088108, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/63781cd38e91aa346a3849bc3ef3e550?s=128&d=identicon&r=PG&f=1", "display_name": "&#216;rjan Johansen", "link": "https://stackoverflow.com/users/1088108/%c3%98rjan-johansen"}, "edited": false, "score": 4, "creation_date": 1443053894, "post_id": 32747094, "comment_id": 53343487, "body": "I&#39;d like to mention that the <a href=\"http://hackage.haskell.org/package/lens\" rel=\"nofollow noreferrer\"><code>lens</code></a> library has a quite impressive &quot;subtyping hierarchy&quot; encoded using forall polymorphism and typeclasses. So whether or not this counts as subtyping, it can certainly be used that way."}], "answers": [{"comments": [{"owner": {"reputation": 2915, "user_id": 1295154, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/9687b362fd1d4754033efc0b19001e81?s=128&d=identicon&r=PG", "display_name": "Dominique Devriese", "link": "https://stackoverflow.com/users/1295154/dominique-devriese"}, "edited": false, "score": 0, "creation_date": 1443038305, "post_id": 32747640, "comment_id": 53337504, "body": "I do not see how this answer addresses the question: &quot;<i>why</i> is forall a. a not considered as a subtype of Int?&quot;."}, {"owner": {"reputation": 13734, "user_id": 938694, "user_type": "registered", "accept_rate": 59, "profile_image": "https://www.gravatar.com/avatar/b6678a430a805dd78366d6e135b49f2d?s=128&d=identicon&r=PG", "display_name": "Cubic", "link": "https://stackoverflow.com/users/938694/cubic"}, "reply_to_user": {"reputation": 2915, "user_id": 1295154, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/9687b362fd1d4754033efc0b19001e81?s=128&d=identicon&r=PG", "display_name": "Dominique Devriese", "link": "https://stackoverflow.com/users/1295154/dominique-devriese"}, "edited": false, "score": 3, "creation_date": 1443042318, "post_id": 32747640, "comment_id": 53339570, "body": "@DominiqueDevriese The primary reason would be that it&#39;s not a type?"}, {"owner": {"reputation": 2915, "user_id": 1295154, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/9687b362fd1d4754033efc0b19001e81?s=128&d=identicon&r=PG", "display_name": "Dominique Devriese", "link": "https://stackoverflow.com/users/1295154/dominique-devriese"}, "reply_to_user": {"reputation": 13734, "user_id": 938694, "user_type": "registered", "accept_rate": 59, "profile_image": "https://www.gravatar.com/avatar/b6678a430a805dd78366d6e135b49f2d?s=128&d=identicon&r=PG", "display_name": "Cubic", "link": "https://stackoverflow.com/users/938694/cubic"}, "edited": false, "score": 1, "creation_date": 1443084279, "post_id": 32747640, "comment_id": 53353388, "body": "@Cubic: What is not a type? <code>forall a. a</code> and <code>Int</code> are clearly types, right?"}, {"owner": {"reputation": 44013, "user_id": 1477667, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/trgKM.jpg?s=128&g=1", "display_name": "dfeuer", "link": "https://stackoverflow.com/users/1477667/dfeuer"}, "edited": false, "score": 0, "creation_date": 1443108101, "post_id": 32747640, "comment_id": 53369295, "body": "What could it be other than a type?"}], "tags": [], "owner": {"reputation": 81794, "user_id": 9859, "user_type": "registered", "accept_rate": 89, "profile_image": "https://i.stack.imgur.com/KEZOL.jpg?s=128&g=1", "display_name": "rampion", "link": "https://stackoverflow.com/users/9859/rampion"}, "is_accepted": false, "score": 2, "last_activity_date": 1443035433, "creation_date": 1443035433, "answer_id": 32747640, "question_id": 32747094, "link": "https://stackoverflow.com/questions/32747094/why-is-forall-a-a-not-considered-a-subtype-of-int-while-i-can-use-an-expression/32747640#32747640", "title": "Why is forall a. a not considered a subtype of Int while I can use an expression of type forall a. a anywhere one of type Int is expected?", "body": "<p>It's not subtyping, it's <a href=\"https://en.wikipedia.org/wiki/Unification_%28computer_science%29\" rel=\"nofollow\">type unification!</a></p>\n\n<pre><code>a :: forall a. a\na = undefined\n\nb :: Int\nb = a\n</code></pre>\n\n<p>In <code>b = a</code>, we're constraining <code>b</code> and <code>a</code> to be of the same type, so the compiler checks that that is possible. <code>a</code> has type <code>forall a. a</code>, which, by definition, unifies with every type, so the compiler oks our constraint.</p>\n\n<p>Type unification also lets us do things like:</p>\n\n<pre><code>f :: (a -&gt; Int) -&gt; a\ng :: (String -&gt; b) -&gt; b\nh :: String -&gt; Int\nh = f g\n</code></pre>\n\n<p>Walking through the unification, <code>f :: (a -&gt; Int) -&gt; a</code> means <code>g</code> must have type <code>a -&gt; Int</code>, which means <code>a -&gt; Int</code> must unify with <code>(String -&gt; b) -&gt; b</code>, so <code>b</code> must <code>b</code> must be <code>Int</code>, which gives <code>g</code> the concrete type <code>(String -&gt; Int) -&gt; Int</code>, which means <code>a</code> is <code>String -&gt; Int</code>.</p>\n\n<p>Neither <code>a -&gt; Int</code> nor <code>(String -&gt; b) -&gt; b</code> is a subtype of the other, but they can be unified as <code>(String -&gt; Int) -&gt; Int</code>.</p>\n"}, {"comments": [{"owner": {"reputation": 2915, "user_id": 1295154, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/9687b362fd1d4754033efc0b19001e81?s=128&d=identicon&r=PG", "display_name": "Dominique Devriese", "link": "https://stackoverflow.com/users/1295154/dominique-devriese"}, "edited": false, "score": 1, "creation_date": 1443038062, "post_id": 32747699, "comment_id": 53337375, "body": "I think you are wrong that this is not subtyping.  See my answer below."}], "tags": [], "owner": {"reputation": 11366, "user_id": 3922954, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/76ba47d2fdd24ab56b0b273cce2075e5?s=128&d=identicon&r=PG&f=1", "display_name": "AJF", "link": "https://stackoverflow.com/users/3922954/ajf"}, "is_accepted": false, "score": 3, "last_activity_date": 1443037455, "last_edit_date": 1443037455, "creation_date": 1443035652, "answer_id": 32747699, "question_id": 32747094, "link": "https://stackoverflow.com/questions/32747094/why-is-forall-a-a-not-considered-a-subtype-of-int-while-i-can-use-an-expression/32747699#32747699", "title": "Why is forall a. a not considered a subtype of Int while I can use an expression of type forall a. a anywhere one of type Int is expected?", "body": "<p>By <code>:: a</code> we mean \"Any type\", but not a subtype. <code>a</code> <em>could</em> be <code>Int</code>, or <code>Bool</code>, or <code>IO (Maybe Ordering)</code>, but none in particular. <code>a</code> is not a type exactly, but a type variable.</p>\n\n<p>Let's say we have a function like this:</p>\n\n<pre><code>id x = x\n</code></pre>\n\n<p>The compiler understands that there is no specific type for our argument <code>x</code>. We can use <em>any</em> type for <code>x</code>, just as long as it's equivalent to whatever comes out of id. So, we write the signature as so:</p>\n\n<pre><code>--    /- Any type in...\n--    |    /- ...same type out.\n--    V    V\nid :: a -&gt; a\n</code></pre>\n\n<p>Remember that types begin with a capital letter in Haskell. This is not a type: it is a type variable!</p>\n\n<p>We use polymorphism because it's easier to do so. For instance, composition is a useful idea:</p>\n\n<pre><code>(&gt;&gt;&gt;) :: (a -&gt; b) -&gt; (b -&gt; c) -&gt; (a -&gt; c)\n(&gt;&gt;&gt;) f g a = g (f a)\n</code></pre>\n\n<p>So we can write things like:</p>\n\n<pre><code>plusOneTimesFive :: Int -&gt; Int\nplusOneTimesFive = (+1) &gt;&gt;&gt; (* 5)\n\nreverseHead :: [Bool] -&gt; Bool\nreverseHead = reverse &gt;&gt;&gt; head\n</code></pre>\n\n<p>But what if we had to write every type out like this:</p>\n\n<pre><code>(&gt;&gt;&gt;) :: (Bool -&gt; Int) -&gt; (Int -&gt; String) -&gt; (Bool -&gt; String)\n(&gt;&gt;&gt;) f g a = g (f a)\n\n(&gt;&gt;&gt;') :: (Ordering -&gt; Double) -&gt; (Double -&gt; IO ()) -&gt; (Ordering -&gt; IO ())\n(&gt;&gt;&gt;') f g a = g (f a)\n\n(&gt;&gt;&gt;'') :: (Int -&gt; Int) -&gt; (Int -&gt; Bool) -&gt; (Int -&gt; Bool)\n(&gt;&gt;&gt;'') f g a = g (f a)\n\n-- ...and so on.\n</code></pre>\n\n<p>That'd just be silly.</p>\n\n<p>So the compiler infers the type using type unification like so:</p>\n\n<p>Let's say I input this into GHCi. Let's say <code>6</code> in an <code>Int</code> for simplicity here.</p>\n\n<pre><code>id 6\n</code></pre>\n\n<p>The compiler thinks: \"<code>id :: a -&gt; a</code>, and it's being passed an <code>Int</code>, so <code>a = Int</code>, so <code>id 6 :: Int</code>.</p>\n\n<p>This is <em>not</em> subtyping. Subtyping could be captured using typeclasses, but this is basic polymorphism at play.</p>\n"}, {"comments": [{"owner": {"reputation": 2915, "user_id": 1295154, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/9687b362fd1d4754033efc0b19001e81?s=128&d=identicon&r=PG", "display_name": "Dominique Devriese", "link": "https://stackoverflow.com/users/1295154/dominique-devriese"}, "edited": false, "score": 1, "creation_date": 1443038185, "post_id": 32748039, "comment_id": 53337449, "body": "It is worth noting that some formalisations of polymorphic type systems (i.e. close relatives of Haskell&#39;s) actually <i>do</i> model the more-polymorphic-than relation as a form of subtyping.  See my answer for an example reference."}, {"owner": {"reputation": 44013, "user_id": 1477667, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/trgKM.jpg?s=128&g=1", "display_name": "dfeuer", "link": "https://stackoverflow.com/users/1477667/dfeuer"}, "reply_to_user": {"reputation": 2915, "user_id": 1295154, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/9687b362fd1d4754033efc0b19001e81?s=128&d=identicon&r=PG", "display_name": "Dominique Devriese", "link": "https://stackoverflow.com/users/1295154/dominique-devriese"}, "edited": false, "score": 0, "creation_date": 1443107963, "post_id": 32748039, "comment_id": 53369192, "body": "While GHC uses a System F variant as its underlying theory, that doesn&#39;t seem inherent in the Haskell type system. I wonder if the sorts of theories @DominiqueDevriese mentions could be used instead."}, {"owner": {"reputation": 2915, "user_id": 1295154, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/9687b362fd1d4754033efc0b19001e81?s=128&d=identicon&r=PG", "display_name": "Dominique Devriese", "link": "https://stackoverflow.com/users/1295154/dominique-devriese"}, "reply_to_user": {"reputation": 44013, "user_id": 1477667, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/trgKM.jpg?s=128&g=1", "display_name": "dfeuer", "link": "https://stackoverflow.com/users/1477667/dfeuer"}, "edited": false, "score": 0, "creation_date": 1443122829, "post_id": 32748039, "comment_id": 53377820, "body": "@dfeuer The two types of &quot;core language&quot; (the one from &quot;Putting type annotations to work&quot; vs. GHC&#39;s System F extension) are different in scope/purpose.  The former includes a form of type inference since, for example, values of type <code>forall a. a</code> can be used where <code>Int</code>s are needed.  GHC&#39;s System F descendents requires explicit type applications to convert <code>forall a. a</code> values to <code>Int</code>s.  The language only models Haskell when type inference has first added necessary type applications/abstractions. Not modelling type inference is an advantage/disadvantage depending on the application, I guess."}], "tags": [], "owner": {"reputation": 28456, "user_id": 1094403, "user_type": "registered", "accept_rate": 83, "profile_image": "https://www.gravatar.com/avatar/3770aa7eae5c211921493abd0d2c9f5a?s=128&d=identicon&r=PG", "display_name": "Luis Casillas", "link": "https://stackoverflow.com/users/1094403/luis-casillas"}, "is_accepted": false, "score": 11, "last_activity_date": 1443039441, "last_edit_date": 1443039441, "creation_date": 1443036874, "answer_id": 32748039, "question_id": 32747094, "link": "https://stackoverflow.com/questions/32747094/why-is-forall-a-a-not-considered-a-subtype-of-int-while-i-can-use-an-expression/32748039#32748039", "title": "Why is forall a. a not considered a subtype of Int while I can use an expression of type forall a. a anywhere one of type Int is expected?", "body": "<p>With a question like this, I would take a step back and say that, fundamentally, the mathematical theories that underlie Haskell's design are <a href=\"https://en.wikipedia.org/wiki/System_F\" rel=\"noreferrer\">System F</a> variants that do not have the concept of subtyping.  </p>\n\n<p>Yes, it is possible to look at Haskell's surface syntax and notice that there are cases like what you bring up, where an expression of some type <code>T</code> can be used in any context where <code>T'</code> is expected.  But this doesn't arise because Haskell was designed to support subtypes.  Rather, it arises as an accident of the fact that Haskell was designed to be more user-friendly than a faithful rendering of System F would be.  </p>\n\n<p>In this case, it has to do with the fact that type-level quantifiers are generally not written explicitly in Haskell code, and type level lambdas and applications <em>never</em> are.  If you look at the type <code>forall a. a</code> from a System F angle, the substitutability into <code>Int</code> contexts goes away.  <code>a :: forall a. a</code> is a type level function and cannot be used in a context that expects <code>Int</code>\u2014you need to first apply it to <code>Int</code> to get <code>a Int :: Int</code>, which is then what you can actually use in an <code>Int</code> context.  Haskell's syntax hides that in the name of user-friendliness, but it's there in the underlying theory.</p>\n\n<p>So in short, while you could analyze Haskell by tabulating which expression types can be substituted into which context types and demonstrate that there is some sort of crypto-subtype relation, it's just not fruitful because it yields analyses that swim against the current of the design.  And it's not so much a matter of technicalities as it is of intent and other human factors.</p>\n"}, {"comments": [{"owner": {"reputation": 11366, "user_id": 3922954, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/76ba47d2fdd24ab56b0b273cce2075e5?s=128&d=identicon&r=PG&f=1", "display_name": "AJF", "link": "https://stackoverflow.com/users/3922954/ajf"}, "edited": false, "score": 0, "creation_date": 1443040715, "post_id": 32748345, "comment_id": 53338768, "body": "I think calling it subtyping is misleading. It is not OOP-style subtyping in the true sense. Though that paper is an interesting one indeed."}, {"owner": {"reputation": 2915, "user_id": 1295154, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/9687b362fd1d4754033efc0b19001e81?s=128&d=identicon&r=PG", "display_name": "Dominique Devriese", "link": "https://stackoverflow.com/users/1295154/dominique-devriese"}, "reply_to_user": {"reputation": 11366, "user_id": 3922954, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/76ba47d2fdd24ab56b0b273cce2075e5?s=128&d=identicon&r=PG&f=1", "display_name": "AJF", "link": "https://stackoverflow.com/users/3922954/ajf"}, "edited": false, "score": 0, "creation_date": 1443084359, "post_id": 32748345, "comment_id": 53353430, "body": "I disagree: the point is that there is more to subtyping than OOP-style subtyping."}], "tags": [], "owner": {"reputation": 2915, "user_id": 1295154, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/9687b362fd1d4754033efc0b19001e81?s=128&d=identicon&r=PG", "display_name": "Dominique Devriese", "link": "https://stackoverflow.com/users/1295154/dominique-devriese"}, "is_accepted": false, "score": 5, "last_activity_date": 1443037954, "creation_date": 1443037954, "answer_id": 32748345, "question_id": 32747094, "link": "https://stackoverflow.com/questions/32747094/why-is-forall-a-a-not-considered-a-subtype-of-int-while-i-can-use-an-expression/32748345#32748345", "title": "Why is forall a. a not considered a subtype of Int while I can use an expression of type forall a. a anywhere one of type Int is expected?", "body": "<p>You are correct that the types a value of type <code>forall a. a</code> can be used wherever an <code>Int</code> is expected and that this implies a subtype relationship between the two types.  The other answers above try to convince you that this \"more-polymorphic-than\"-relation is not subtyping. However, while it is certainly different from the forms of subtyping found in typical object-oriented languages, this does not mean that the \"more-polymorphic-than\"-relation cannot be seen as a (different) form of subtyping.  In fact, some formalisations of polymorphic type systems model exactly this relation in their subtype relation.  This is the case, for example, in the type system in Odersky and L\u00e4ufer's paper <a href=\"http://dl.acm.org/citation.cfm?id=237729\" rel=\"noreferrer\">\"Putting type annotations to work\"</a>.</p>\n"}, {"comments": [{"owner": {"reputation": 44013, "user_id": 1477667, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/trgKM.jpg?s=128&g=1", "display_name": "dfeuer", "link": "https://stackoverflow.com/users/1477667/dfeuer"}, "edited": false, "score": 0, "creation_date": 1443107654, "post_id": 32748736, "comment_id": 53368991, "body": "Doesn&#39;t <code>t \u2291 s</code> mean that <code>t</code> is more specific than <code>s</code>, rather than more general?"}, {"owner": {"reputation": 60057, "user_id": 1333025, "user_type": "registered", "accept_rate": 65, "profile_image": "https://www.gravatar.com/avatar/79ab43010f900324ac5e2de19a2916cb?s=128&d=identicon&r=PG", "display_name": "Petr", "link": "https://stackoverflow.com/users/1333025/petr"}, "reply_to_user": {"reputation": 44013, "user_id": 1477667, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/trgKM.jpg?s=128&g=1", "display_name": "dfeuer", "link": "https://stackoverflow.com/users/1477667/dfeuer"}, "edited": false, "score": 0, "creation_date": 1443108338, "post_id": 32748736, "comment_id": 53369438, "body": "@dfeuer I used the same notation as the Wikipedia <a href=\"https://en.wikipedia.org/wiki/Hindley%E2%80%93Milner_type_system#Polymorphic_type_order\" rel=\"nofollow noreferrer\">page on HM</a> where \u2291 means &quot;more general than&quot;. It could be that the page is wrong :)."}, {"owner": {"reputation": 44013, "user_id": 1477667, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/trgKM.jpg?s=128&g=1", "display_name": "dfeuer", "link": "https://stackoverflow.com/users/1477667/dfeuer"}, "edited": false, "score": 0, "creation_date": 1443108428, "post_id": 32748736, "comment_id": 53369505, "body": "You write also &quot;meaning that if <code>M : t</code> then also <code>M : s</code>&quot; which doesn&#39;t <i>seem</i> to match. I could be wrong though."}, {"owner": {"reputation": 60057, "user_id": 1333025, "user_type": "registered", "accept_rate": 65, "profile_image": "https://www.gravatar.com/avatar/79ab43010f900324ac5e2de19a2916cb?s=128&d=identicon&r=PG", "display_name": "Petr", "link": "https://stackoverflow.com/users/1333025/petr"}, "reply_to_user": {"reputation": 44013, "user_id": 1477667, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/trgKM.jpg?s=128&g=1", "display_name": "dfeuer", "link": "https://stackoverflow.com/users/1477667/dfeuer"}, "edited": false, "score": 1, "creation_date": 1443110959, "post_id": 32748736, "comment_id": 53371212, "body": "@dfeuer As I understand it, if <code>t</code> is more general, it has less values (this is probably the reason for \u2291). So it <code>M : t</code> and <code>s</code> is a specialization of <code>t</code>, then also <code>M : s</code>."}, {"owner": {"reputation": 44013, "user_id": 1477667, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/trgKM.jpg?s=128&g=1", "display_name": "dfeuer", "link": "https://stackoverflow.com/users/1477667/dfeuer"}, "edited": false, "score": 0, "creation_date": 1443111184, "post_id": 32748736, "comment_id": 53371368, "body": "Hmm, yeah, that&#39;s probably it. I know how to use these relationships properly, but I have no idea how to name them properly."}], "tags": [], "owner": {"reputation": 60057, "user_id": 1333025, "user_type": "registered", "accept_rate": 65, "profile_image": "https://www.gravatar.com/avatar/79ab43010f900324ac5e2de19a2916cb?s=128&d=identicon&r=PG", "display_name": "Petr", "link": "https://stackoverflow.com/users/1333025/petr"}, "is_accepted": true, "score": 14, "last_activity_date": 1443084799, "last_edit_date": 1443084799, "creation_date": 1443039524, "answer_id": 32748736, "question_id": 32747094, "link": "https://stackoverflow.com/questions/32747094/why-is-forall-a-a-not-considered-a-subtype-of-int-while-i-can-use-an-expression/32748736#32748736", "title": "Why is forall a. a not considered a subtype of Int while I can use an expression of type forall a. a anywhere one of type Int is expected?", "body": "<p>In typed lambda calculi, we have the typing relation, usually denoted as <code>:</code> or in Haskell as <code>::</code>. In general the relation is \"many to many\", so a type can contain multiple values and also a value can have many types.</p>\n\n<p>In particular in polymorphic type systems a value can have multiple types. For example</p>\n\n<pre><code>map :: (a -&gt; b) -&gt; [a] -&gt; [b]\n</code></pre>\n\n<p>but also</p>\n\n<pre><code>map :: (Int -&gt; Int) -&gt; [Int] -&gt; [Int].\n</code></pre>\n\n<p>In such type systems it's (sometimes) possible to define a relation on types with the meaning \"more general type than\", a <a href=\"https://en.wikipedia.org/wiki/Hindley%E2%80%93Milner_type_system#Polymorphic_type_order\" rel=\"nofollow noreferrer\">type order</a>. If <code>t \u2291 s</code> then <code>t</code> is more general than <code>s</code>, meaning that if <code>M : t</code> then also <code>M : s</code>, and the typing rules of such a type system allow to infer exactly that. Or we say that <code>s</code> is a specialization of <code>t</code>.  So in this sense, there is a <a href=\"https://en.wikipedia.org/wiki/Subtyping\" rel=\"nofollow noreferrer\">subtyping</a> relation on types.</p>\n\n<p>However, when we talk about subtyping in object oriented languages, we usually mean <a href=\"https://en.wikipedia.org/wiki/Nominal_type_system\" rel=\"nofollow noreferrer\">nominal subtyping</a>, that is, we <em>declare</em> which types are subtypes of what, like when we define class inheritance. While in Haskell, it's a property of types, independent of any declarations. For example any type is a specialization of <code>forall a . a</code>.</p>\n\n<p>For the <a href=\"https://en.wikipedia.org/wiki/Hindley%E2%80%93Milner_type_system\" rel=\"nofollow noreferrer\">Hindley-Milner type system</a>, which allows type inference and which is the base for most functional languages, there is the notion of <a href=\"https://en.wikipedia.org/wiki/Hindley%E2%80%93Milner_type_system#Principal_type\" rel=\"nofollow noreferrer\">principal type</a>: If an expression <code>M</code> has a (any) type, then it also has its principal type, and the principal type is the most general type of all the possible types of <code>M</code>. The key feature is that the HM type inference algorithm always finds the most general type. So the most general, inferred principal type can be specialized to any valid type of <code>M</code>.</p>\n"}], "owner": {"reputation": 30739, "user_id": 1804599, "user_type": "registered", "accept_rate": 84, "profile_image": "https://i.stack.imgur.com/v91P3.jpg?s=128&g=1", "display_name": "rightfold", "link": "https://stackoverflow.com/users/1804599/rightfold"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 711, "favorite_count": 2, "accepted_answer_id": 32748736, "answer_count": 5, "score": 16, "last_activity_date": 1443084799, "creation_date": 1443033687, "last_edit_date": 1443034801, "question_id": 32747094, "link": "https://stackoverflow.com/questions/32747094/why-is-forall-a-a-not-considered-a-subtype-of-int-while-i-can-use-an-expression", "title": "Why is forall a. a not considered a subtype of Int while I can use an expression of type forall a. a anywhere one of type Int is expected?", "body": "<p>Consider the following pair of function definitions, which pass the type checker:</p>\n\n<pre><code>a :: forall a. a\na = undefined\n\nb :: Int\nb = a\n</code></pre>\n\n<p>I.e. an expression of type <code>forall a. a</code> can be used where one of type <code>Int</code> is expected. This seems to me a lot like subtyping but it is claimed the type system of Haskell lacks subtyping. How do these forms of substitutability differ?</p>\n\n<p>This question is not specific to <code>forall a. a</code>. Other examples include:</p>\n\n<pre><code>id :: forall a. a -&gt; a\nid x = x\n\nidInt :: Int -&gt; Int\nidInt = id\n</code></pre>\n"}, {"tags": ["haskell", "functional-programming", "frp", "arrows", "netwire"], "comments": [{"owner": {"reputation": 13734, "user_id": 938694, "user_type": "registered", "accept_rate": 59, "profile_image": "https://www.gravatar.com/avatar/b6678a430a805dd78366d6e135b49f2d?s=128&d=identicon&r=PG", "display_name": "Cubic", "link": "https://stackoverflow.com/users/938694/cubic"}, "edited": false, "score": 0, "creation_date": 1443112435, "post_id": 32745934, "comment_id": 53372193, "body": "Apparently you&#39;ve already answered your own question. Put it as an answer, instead of adding it to your question. (In particular, it&#39;s probably enough to mention <code>mkGen_</code> and it&#39;s type in the answer, the particular implementation is likely less interesting for future readers). If you have more questions, ask them separately instead of changing your questions."}, {"owner": {"reputation": 1221, "user_id": 2353597, "user_type": "registered", "accept_rate": 58, "profile_image": "https://www.gravatar.com/avatar/bd9a1e25ba73d9fdfa8c87013ac122da?s=128&d=identicon&r=PG", "display_name": "Carl Dong", "link": "https://stackoverflow.com/users/2353597/carl-dong"}, "reply_to_user": {"reputation": 13734, "user_id": 938694, "user_type": "registered", "accept_rate": 59, "profile_image": "https://www.gravatar.com/avatar/b6678a430a805dd78366d6e135b49f2d?s=128&d=identicon&r=PG", "display_name": "Cubic", "link": "https://stackoverflow.com/users/938694/cubic"}, "edited": false, "score": 0, "creation_date": 1443116771, "post_id": 32745934, "comment_id": 53374692, "body": "No, I have not verified whether it works yet"}, {"owner": {"reputation": 1221, "user_id": 2353597, "user_type": "registered", "accept_rate": 58, "profile_image": "https://www.gravatar.com/avatar/bd9a1e25ba73d9fdfa8c87013ac122da?s=128&d=identicon&r=PG", "display_name": "Carl Dong", "link": "https://stackoverflow.com/users/2353597/carl-dong"}, "reply_to_user": {"reputation": 13734, "user_id": 938694, "user_type": "registered", "accept_rate": 59, "profile_image": "https://www.gravatar.com/avatar/b6678a430a805dd78366d6e135b49f2d?s=128&d=identicon&r=PG", "display_name": "Cubic", "link": "https://stackoverflow.com/users/938694/cubic"}, "edited": false, "score": 0, "creation_date": 1443495164, "post_id": 32745934, "comment_id": 53505408, "body": "Now I kind of verified using <code>putStrLn</code> as a simpler example."}, {"owner": {"reputation": 2567, "user_id": 994206, "user_type": "registered", "accept_rate": 84, "profile_image": "https://www.gravatar.com/avatar/699bacad8f85a069dda312cc29e03baa?s=128&d=identicon&r=PG", "display_name": "Mokosha", "link": "https://stackoverflow.com/users/994206/mokosha"}, "edited": false, "score": 0, "creation_date": 1443568001, "post_id": 32745934, "comment_id": 53543996, "body": "Wires, and FRP in general, are a way to model time-varying values. They shouldn&#39;t really &quot;create&quot; anything ever. Your program, as you have it written, will create a new SDL surface every time the wire is evaluated!"}, {"owner": {"reputation": 1221, "user_id": 2353597, "user_type": "registered", "accept_rate": 58, "profile_image": "https://www.gravatar.com/avatar/bd9a1e25ba73d9fdfa8c87013ac122da?s=128&d=identicon&r=PG", "display_name": "Carl Dong", "link": "https://stackoverflow.com/users/2353597/carl-dong"}, "edited": false, "score": 0, "creation_date": 1443581190, "post_id": 32745934, "comment_id": 53547370, "body": "Will the previous unused surfaces be garbage collected? Of course, semantically it is the same to update the same surface (it is state, anyway), but I think those are implementation details."}], "answers": [{"comments": [{"owner": {"reputation": 13734, "user_id": 938694, "user_type": "registered", "accept_rate": 59, "profile_image": "https://www.gravatar.com/avatar/b6678a430a805dd78366d6e135b49f2d?s=128&d=identicon&r=PG", "display_name": "Cubic", "link": "https://stackoverflow.com/users/938694/cubic"}, "edited": false, "score": 0, "creation_date": 1443495559, "post_id": 32834841, "comment_id": 53505508, "body": "Note that <code>m &gt;&gt;= return . f</code> is just <code>fmap f m</code>. Also I&#39;m not sure what you mean when you say putStrLn generalizes to all wires?"}, {"owner": {"reputation": 1221, "user_id": 2353597, "user_type": "registered", "accept_rate": 58, "profile_image": "https://www.gravatar.com/avatar/bd9a1e25ba73d9fdfa8c87013ac122da?s=128&d=identicon&r=PG", "display_name": "Carl Dong", "link": "https://stackoverflow.com/users/2353597/carl-dong"}, "reply_to_user": {"reputation": 13734, "user_id": 938694, "user_type": "registered", "accept_rate": 59, "profile_image": "https://www.gravatar.com/avatar/b6678a430a805dd78366d6e135b49f2d?s=128&d=identicon&r=PG", "display_name": "Cubic", "link": "https://stackoverflow.com/users/938694/cubic"}, "edited": false, "score": 0, "creation_date": 1443495775, "post_id": 32834841, "comment_id": 53505564, "body": "When I say it generalizes to all wires, I actually mean that similar things applies to lifting all <code>a -&gt; m b</code> functions into <code>Wire s e m a b</code>"}, {"owner": {"reputation": 1221, "user_id": 2353597, "user_type": "registered", "accept_rate": 58, "profile_image": "https://www.gravatar.com/avatar/bd9a1e25ba73d9fdfa8c87013ac122da?s=128&d=identicon&r=PG", "display_name": "Carl Dong", "link": "https://stackoverflow.com/users/2353597/carl-dong"}, "reply_to_user": {"reputation": 13734, "user_id": 938694, "user_type": "registered", "accept_rate": 59, "profile_image": "https://www.gravatar.com/avatar/b6678a430a805dd78366d6e135b49f2d?s=128&d=identicon&r=PG", "display_name": "Cubic", "link": "https://stackoverflow.com/users/938694/cubic"}, "edited": false, "score": 0, "creation_date": 1443495935, "post_id": 32834841, "comment_id": 53505606, "body": "Right, <code>\\a -&gt; fmap Right $ f a</code> works too. But I think <code>\\a -&gt; (f a &gt;&gt;= return . Right)</code> probably expresses better for this purpose?"}, {"owner": {"reputation": 1221, "user_id": 2353597, "user_type": "registered", "accept_rate": 58, "profile_image": "https://www.gravatar.com/avatar/bd9a1e25ba73d9fdfa8c87013ac122da?s=128&d=identicon&r=PG", "display_name": "Carl Dong", "link": "https://stackoverflow.com/users/2353597/carl-dong"}, "reply_to_user": {"reputation": 13734, "user_id": 938694, "user_type": "registered", "accept_rate": 59, "profile_image": "https://www.gravatar.com/avatar/b6678a430a805dd78366d6e135b49f2d?s=128&d=identicon&r=PG", "display_name": "Cubic", "link": "https://stackoverflow.com/users/938694/cubic"}, "edited": false, "score": 0, "creation_date": 1443496231, "post_id": 32834841, "comment_id": 53505672, "body": "No, sorry, <code>fmap</code> doesn&#39;t seem to work with Monads. The compiler tells me to add <code>Functor m</code>, but that is not correct."}, {"owner": {"reputation": 1221, "user_id": 2353597, "user_type": "registered", "accept_rate": 58, "profile_image": "https://www.gravatar.com/avatar/bd9a1e25ba73d9fdfa8c87013ac122da?s=128&d=identicon&r=PG", "display_name": "Carl Dong", "link": "https://stackoverflow.com/users/2353597/carl-dong"}, "reply_to_user": {"reputation": 13734, "user_id": 938694, "user_type": "registered", "accept_rate": 59, "profile_image": "https://www.gravatar.com/avatar/b6678a430a805dd78366d6e135b49f2d?s=128&d=identicon&r=PG", "display_name": "Cubic", "link": "https://stackoverflow.com/users/938694/cubic"}, "edited": false, "score": 0, "creation_date": 1443496314, "post_id": 32834841, "comment_id": 53505685, "body": "OK, that should be <code>liftM</code> instead of fmap. I will add that in my answer"}, {"owner": {"reputation": 13734, "user_id": 938694, "user_type": "registered", "accept_rate": 59, "profile_image": "https://www.gravatar.com/avatar/b6678a430a805dd78366d6e135b49f2d?s=128&d=identicon&r=PG", "display_name": "Cubic", "link": "https://stackoverflow.com/users/938694/cubic"}, "edited": false, "score": 0, "creation_date": 1443496881, "post_id": 32834841, "comment_id": 53505822, "body": "You&#39;re using an old version of ghc. Starting with 7.10, monad implies functor (and applicative). Even before that, most libraries defining monads already defined corresponding functor/applicative instances. Oh and I&#39;m not sure if that&#39;s guaranteed anywhere but you&#39;ll find that liftm is pretty much always just Gmail fmap with a stricter type signature"}, {"owner": {"reputation": 1221, "user_id": 2353597, "user_type": "registered", "accept_rate": 58, "profile_image": "https://www.gravatar.com/avatar/bd9a1e25ba73d9fdfa8c87013ac122da?s=128&d=identicon&r=PG", "display_name": "Carl Dong", "link": "https://stackoverflow.com/users/2353597/carl-dong"}, "reply_to_user": {"reputation": 13734, "user_id": 938694, "user_type": "registered", "accept_rate": 59, "profile_image": "https://www.gravatar.com/avatar/b6678a430a805dd78366d6e135b49f2d?s=128&d=identicon&r=PG", "display_name": "Cubic", "link": "https://stackoverflow.com/users/938694/cubic"}, "edited": false, "score": 0, "creation_date": 1443496997, "post_id": 32834841, "comment_id": 53505847, "body": "I see. I am on Ubuntu 14.04, so I only get 7.6. Since I like to use the general <code>(Monad m =&gt; ...)</code>, and don&#39;t want to hack my system too much, I would keep it like that."}, {"owner": {"reputation": 13734, "user_id": 938694, "user_type": "registered", "accept_rate": 59, "profile_image": "https://www.gravatar.com/avatar/b6678a430a805dd78366d6e135b49f2d?s=128&d=identicon&r=PG", "display_name": "Cubic", "link": "https://stackoverflow.com/users/938694/cubic"}, "edited": false, "score": 0, "creation_date": 1443497249, "post_id": 32834841, "comment_id": 53505916, "body": "Installing software isn&#39;t &quot;hacking your system&quot;. I found that ubuntus package repositories are pretty worthless for things that are actively being developed (which is certainly true for Haskell). You&#39;ll find that there are ppas providing up to date versions of ghc. You could also use stack and let that manage ghc for you instead."}], "tags": [], "owner": {"reputation": 1221, "user_id": 2353597, "user_type": "registered", "accept_rate": 58, "profile_image": "https://www.gravatar.com/avatar/bd9a1e25ba73d9fdfa8c87013ac122da?s=128&d=identicon&r=PG", "display_name": "Carl Dong", "link": "https://stackoverflow.com/users/2353597/carl-dong"}, "is_accepted": true, "score": 1, "last_activity_date": 1443497706, "last_edit_date": 1443497706, "creation_date": 1443494521, "answer_id": 32834841, "question_id": 32745934, "link": "https://stackoverflow.com/questions/32745934/kleisli-arrow-in-netwire-5/32834841#32834841", "title": "Kleisli Arrow in Netwire 5?", "body": "<p>Now, after playing around with Arrows, I will answer my own question\nusing the function <code>putStrLn</code>. It has type <code>String -&gt; IO ()</code>, which is\n<code>a -&gt; m b</code>, so the method should generalize to all Kleisli wires. I also illustrate how to drive the wire, and the result is amazingly simple.</p>\n\n<p>The entire code is written in Literate Haskell, so just copy it and run.</p>\n\n<p>First, there are some imports for the Netwire 5 library</p>\n\n<pre><code>import Control.Wire\nimport Control.Arrow\nimport Prelude hiding ((.), id)\n</code></pre>\n\n<p>Now, this is the core of making a Kleisli Wire. Assume you have a\nfunction with type <code>a -&gt; m b</code> that needs to be lifted into a wire. Now,\nnotice that <code>mkGen_</code> has type\n<code>mkGen_ :: Monad m =&gt; (a -&gt; m (Either e b)) -&gt; Wire s e m a b</code></p>\n\n<p>So, to make a wire out of <code>a -&gt; m b</code>, we first need to get a function\nwith type <code>a -&gt; m (Either () b)</code>. Notice that Left inhibits the wire,\nwhile Right activates it, so the inner part is <code>Either () b</code> instead of\n<code>Either b ()</code>. Actually, if you try the latter, an obscure compile error\nwill tell you get this in the wrong way.</p>\n\n<p>To get <code>a -&gt; m (Either () b)</code>, first consider how to get\n<code>m (Either () b)</code> from <code>m b</code>, we extract the value from the monad (m\nb), lift it to Right, then return to the monad m. In short:\n<code>mB &gt;&gt;= return . Right</code>. Since we don't have the value \"mB\" here, we\nmake a lambda expression to get <code>a -&gt; m (Either () b)</code>:</p>\n\n<pre><code>liftToEither :: (Monad m) =&gt; (a -&gt; m b) -&gt; (a -&gt; m (Either () b))\nliftToEither f = \\a -&gt; (f a &gt;&gt;= return . Right)\n</code></pre>\n\n<p>Now, we can make a Kleisli wire:</p>\n\n<pre><code>mkKleisli :: (Monad m, Monoid e) =&gt; (a -&gt; m b) -&gt; Wire s e m a b\nmkKleisli f = mkGen_ $ \\a -&gt; (f a &gt;&gt;= return . Right)\n</code></pre>\n\n<p>So, let's try the canonical \"hello, world\" wire!</p>\n\n<pre><code>helloWire :: Wire s () IO () ()\nhelloWire = pure \"hello, world\" &gt;&gt;&gt; mkKleisli putStrLn\n</code></pre>\n\n<p>Now comes the main function to illustrate how to drive the wire. Note\nthat comparing to the source of <code>testWire</code> in <code>the Control.Wire.Run</code>\nfrom the Netwire library, there is no use of liftIO: the outer program\nknows nothing about how the wires work internally. It merely steps the\nwires ignoring what is in it. <code>Maybe</code> this <code>Just</code> means better\ncomposition than using <code>Nothing</code> about Kleisli Wires? (No pun intended!)</p>\n\n<pre><code>main = go clockSession_ helloWire\n    where\n      go s w = do\n        (ds, s') &lt;- stepSession s\n        (mx, w') &lt;- stepWire w ds (Right ())\n        go s' w'\n</code></pre>\n\n<p>Now here comes the code. Unfortunately StackOverflow does not work quite well with Literate Haskell...</p>\n\n<pre><code>{-# LANGUAGE Arrows #-}\n\nmodule Main where\n\nimport Control.Wire\nimport Control.Monad\nimport Control.Arrow\nimport Prelude hiding ((.), id)\n\nmkKleisli :: (Monad m, Monoid e) =&gt; (a -&gt; m b) -&gt; Wire s e m a b\nmkKleisli f = mkGen_ $ \\a -&gt; liftM Right $ f a\n\nhelloWire :: Wire s () IO () ()\nhelloWire = pure \"hello, world\" &gt;&gt;&gt; mkKleisli putStrLn\n\nmain = go clockSession_ helloWire\n    where\n      go s w = do\n        (ds, s') &lt;- stepSession s\n        (mx, w') &lt;- stepWire w ds (Right ())\n        go s' w'\n</code></pre>\n\n<p><em>Update</em></p>\n\n<p>Thanks to Cubic's inspiration. <code>liftToEither</code> can actually be written in, you guess it, <code>liftM</code>:</p>\n\n<pre><code>liftToEither f = \\a -&gt; liftM Right $ f a\nmkKleisli f = mkGen_ $ \\a -&gt; liftM Right $ f a\n</code></pre>\n"}], "owner": {"reputation": 1221, "user_id": 2353597, "user_type": "registered", "accept_rate": 58, "profile_image": "https://www.gravatar.com/avatar/bd9a1e25ba73d9fdfa8c87013ac122da?s=128&d=identicon&r=PG", "display_name": "Carl Dong", "link": "https://stackoverflow.com/users/2353597/carl-dong"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 221, "favorite_count": 0, "accepted_answer_id": 32834841, "answer_count": 1, "score": 3, "last_activity_date": 1443497706, "creation_date": 1443029602, "last_edit_date": 1443032904, "question_id": 32745934, "link": "https://stackoverflow.com/questions/32745934/kleisli-arrow-in-netwire-5", "title": "Kleisli Arrow in Netwire 5?", "body": "<p>I am trying to create a game using Haskell + Netwire 5 (+ SDL). Now I am working on the output part, where I would like to create wires that read in some game state and output the SDL surfaces to be blitted on screen. </p>\n\n<p>However, the problem is that SDL surfaces are contained in <code>IO</code> monad, so any function that creates such surfaces must have type <code>a -&gt; IO b</code>. Of course, <code>arr</code> does not construct a <code>Wire</code> from <code>a -&gt; m b</code>. However, since the type signature of a wire is <code>(Monad m, Monoid e) =&gt; Wire s e m a b</code>, it looks quite like a Kleisi Arrow, but I cannot find a suitable constructor for making such a wire.</p>\n\n<p>I am new to FRP and Arrows, and have not programmed a lot in Haskell, so this may not be the best way to implement the graphics output. If I am wrong from the beginning, please let me know.</p>\n\n<p>Some SDL functions related:</p>\n\n<pre><code>createRGBSurfaceEndian :: [SurfaceFlag] -&gt; Int -&gt; Int -&gt; Int -&gt; IO Surface\n\nfillRect :: Surface -&gt; Maybe Rect -&gt; Pixel -&gt; IO Bool\n\nblitSurface :: Surface -&gt; Maybe Rect -&gt; Surface -&gt; Maybe Rect -&gt; IO Bool\n\nflip :: Surface -&gt; IO ()\n</code></pre>\n\n<h1>Update 1</h1>\n\n<p>This code type checks, but now I am trying to interface it with SDL for testing</p>\n\n<pre><code>wTestOutput :: (Monoid e) =&gt; Wire s e IO () SDL.Surface\nwTestOutput = mkGen_ $ \\a -&gt; (makeSurf a &gt;&gt;= return . Right)\n    where\n      makeSurf :: a -&gt; IO SDL.Surface\n      makeSurf _ = do\n        s &lt;- SDL.createRGBSurfaceEndian [SDL.SWSurface] 800 600 32\n        SDL.fillRect s (Just testRect) (SDL.Pixel 0xFF000000)\n        return s\n      testRect = SDL.Rect 100 100 0 0\n</code></pre>\n"}, {"tags": ["haskell"], "comments": [{"owner": {"reputation": 1790, "user_id": 3350784, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/OTuvN.png?s=128&g=1", "display_name": "Yuuri", "link": "https://stackoverflow.com/users/3350784/yuuri"}, "edited": false, "score": 2, "creation_date": 1443022975, "post_id": 32743674, "comment_id": 53328638, "body": "What if numbers of slots and strings differ?"}, {"owner": {"reputation": 93, "user_id": 3373360, "user_type": "registered", "accept_rate": 62, "profile_image": "https://www.gravatar.com/avatar/6609c270726f8d90ab6ba223f3edf459?s=128&d=identicon&r=PG&f=1", "display_name": "user3373360", "link": "https://stackoverflow.com/users/3373360/user3373360"}, "reply_to_user": {"reputation": 1790, "user_id": 3350784, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/OTuvN.png?s=128&g=1", "display_name": "Yuuri", "link": "https://stackoverflow.com/users/3350784/yuuri"}, "edited": false, "score": 0, "creation_date": 1443023110, "post_id": 32743674, "comment_id": 53328731, "body": "@Yuuri it&#39;s allowed to crash. For this case we just need to worry about if the number of slots is equal to the number of strings."}], "answers": [{"comments": [{"owner": {"reputation": 93, "user_id": 3373360, "user_type": "registered", "accept_rate": 62, "profile_image": "https://www.gravatar.com/avatar/6609c270726f8d90ab6ba223f3edf459?s=128&d=identicon&r=PG&f=1", "display_name": "user3373360", "link": "https://stackoverflow.com/users/3373360/user3373360"}, "edited": false, "score": 0, "creation_date": 1443028993, "post_id": 32745578, "comment_id": 53332204, "body": "I get an error: Non type-variable argument in the constraint: MonadState [[a]] m (Use FlexibleContexts to permit this)"}], "tags": [], "owner": {"reputation": 13807, "user_id": 2407038, "user_type": "registered", "accept_rate": 64, "profile_image": "https://www.gravatar.com/avatar/538f6f4a9aa43841841de7d8e8b169fc?s=128&d=identicon&r=PG&f=1", "display_name": "user2407038", "link": "https://stackoverflow.com/users/2407038/user2407038"}, "is_accepted": true, "score": 1, "last_activity_date": 1443028358, "creation_date": 1443028358, "answer_id": 32745578, "question_id": 32743674, "link": "https://stackoverflow.com/questions/32743674/how-to-replace-empty-slots-in-a-template-with-strings-in-haskell/32745578#32745578", "title": "How to replace empty slots in a Template with strings in Haskell?", "body": "<p>A very simple solution using the <code>State</code> monad is possible:</p>\n\n<pre><code>import Control.Monad\nimport Control.Monad.State \n\ntemplate :: Template -&gt; [String] -&gt; String\ntemplate (Template xs) strs = evalState (foldM f [] xs) strs where \n  f s (Left s') = return (s ++ s')\n  f s Right{} = state $ \\(r:rs) -&gt; (s++r,rs) \n</code></pre>\n\n<p>As per your requirements, this crashes (with a pattern match error) in case the number of slots and strings differ.</p>\n"}], "owner": {"reputation": 93, "user_id": 3373360, "user_type": "registered", "accept_rate": 62, "profile_image": "https://www.gravatar.com/avatar/6609c270726f8d90ab6ba223f3edf459?s=128&d=identicon&r=PG&f=1", "display_name": "user3373360", "link": "https://stackoverflow.com/users/3373360/user3373360"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 183, "favorite_count": 0, "accepted_answer_id": 32745578, "answer_count": 1, "score": 0, "last_activity_date": 1443028358, "creation_date": 1443022126, "last_edit_date": 1443026763, "question_id": 32743674, "link": "https://stackoverflow.com/questions/32743674/how-to-replace-empty-slots-in-a-template-with-strings-in-haskell", "title": "How to replace empty slots in a Template with strings in Haskell?", "body": "<p>I'm trying to write a function which takes a Template \"xs\" and replaces the empty slots with the strings in \"strs\". Below is an example:</p>\n\n<pre><code>template {}word{}{} [\"9\", \"2\", \"7\"] = 9word27\n</code></pre>\n\n<p>I'm looking for any help that may be useful. Below is what I have so far:</p>\n\n<pre><code>template :: Template -&gt; [String] -&gt; String\ntemplate (Template xs) strs =\n</code></pre>\n\n<p>Some helper functions:</p>\n\n<pre><code>data Slot = Slot\n          deriving (Show, Eq)\n\ndata Template =\n  Template [Either String Slot]\n  deriving Eq\n\ninstance Show Template where\n  show (Template xs) =   concat $ map f xs\n    where f (Left x) = x\n          f (Right x) = \"{}\"\ndata Def =\n  Def [Template]\n  deriving Eq\n</code></pre>\n\n<p>We can always assume that the number of slots is equivalent to the number of strings.</p>\n"}, {"tags": ["haskell", "dependent-type", "type-families"], "comments": [{"owner": {"reputation": 57219, "user_id": 33796, "user_type": "registered", "accept_rate": 70, "profile_image": "https://www.gravatar.com/avatar/08727b23ba62e634b32988cdff082663?s=128&d=identicon&r=PG", "display_name": "luqui", "link": "https://stackoverflow.com/users/33796/luqui"}, "edited": false, "score": 5, "creation_date": 1442996136, "post_id": 32733368, "comment_id": 53309726, "body": "I know GHC isn&#39;t too good with injective data families.  Making a wrapper sometimes works, e.g. <code>newtype ID&#39; a = ID&#39; (ID a)</code>."}, {"owner": {"reputation": 17809, "user_id": 1088108, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/63781cd38e91aa346a3849bc3ef3e550?s=128&d=identicon&r=PG&f=1", "display_name": "&#216;rjan Johansen", "link": "https://stackoverflow.com/users/1088108/%c3%98rjan-johansen"}, "edited": false, "score": 5, "creation_date": 1442996992, "post_id": 32733368, "comment_id": 53310186, "body": "Seems to me like this might be a GHC bug. Those types ought to be &quot;surely apart&quot; (GHC technical term)."}, {"owner": {"reputation": 17809, "user_id": 1088108, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/63781cd38e91aa346a3849bc3ef3e550?s=128&d=identicon&r=PG&f=1", "display_name": "&#216;rjan Johansen", "link": "https://stackoverflow.com/users/1088108/%c3%98rjan-johansen"}, "edited": false, "score": 1, "creation_date": 1442997810, "post_id": 32733368, "comment_id": 53310634, "body": "<a href=\"https://ghc.haskell.org/trac/ghc/ticket/10910\" rel=\"nofollow noreferrer\">Reported it</a>."}, {"owner": {"reputation": 37219, "user_id": 1523776, "user_type": "moderator", "accept_rate": 87, "profile_image": "https://www.gravatar.com/avatar/b3e0b5c8e42a8c38009ef2d969f8dabb?s=128&d=identicon&r=PG", "display_name": "Benjamin Hodgson", "link": "https://stackoverflow.com/users/1523776/benjamin-hodgson"}, "reply_to_user": {"reputation": 17809, "user_id": 1088108, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/63781cd38e91aa346a3849bc3ef3e550?s=128&d=identicon&r=PG&f=1", "display_name": "&#216;rjan Johansen", "link": "https://stackoverflow.com/users/1088108/%c3%98rjan-johansen"}, "edited": false, "score": 3, "creation_date": 1443010732, "post_id": 32733368, "comment_id": 53319326, "body": "@&#216;rjanJohansen Thanks for reporting it, I&#39;ve cc-ed myself on the issue. @luqui The <code>newtype</code> thing does work but it&#39;s not very nice :("}, {"owner": {"reputation": 14485, "user_id": 190376, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/cd8280c5e1491b8cf55760750ed97dec?s=128&d=identicon&r=PG", "display_name": "Reid Barton", "link": "https://stackoverflow.com/users/190376/reid-barton"}, "edited": false, "score": 3, "creation_date": 1443024459, "post_id": 32733368, "comment_id": 53329682, "body": "(Just a terminology note. The property that tells you that <code>ID User</code> and <code>Int</code> are unequal is generativity, not injectivity. Data families are automatically both generative and injective, but an injective type family <code>ID&#39;</code> could still satisfy <code>ID&#39; User = Int</code>.)"}, {"owner": {"reputation": 17809, "user_id": 1088108, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/63781cd38e91aa346a3849bc3ef3e550?s=128&d=identicon&r=PG&f=1", "display_name": "&#216;rjan Johansen", "link": "https://stackoverflow.com/users/1088108/%c3%98rjan-johansen"}, "edited": false, "score": 1, "creation_date": 1443044527, "post_id": 32733368, "comment_id": 53340593, "body": "And it looks like there was <a href=\"https://ghc.haskell.org/trac/ghc/ticket/10713\" rel=\"nofollow noreferrer\">an older ticket</a> that my googling attempts had missed. So this is already fixed in GHC HEAD!"}], "answers": [{"tags": [], "owner": {"reputation": 17809, "user_id": 1088108, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/63781cd38e91aa346a3849bc3ef3e550?s=128&d=identicon&r=PG&f=1", "display_name": "&#216;rjan Johansen", "link": "https://stackoverflow.com/users/1088108/%c3%98rjan-johansen"}, "is_accepted": true, "score": 3, "last_activity_date": 1443056154, "creation_date": 1443056154, "answer_id": 32751745, "question_id": 32733368, "link": "https://stackoverflow.com/questions/32733368/type-inequalities-in-the-presence-of-data-families/32751745#32751745", "title": "Type (in)equalities in the presence of data families", "body": "<p>It turns out this was a <a href=\"https://ghc.haskell.org/trac/ghc/ticket/10713\" rel=\"nofollow\">known GHC bug</a>. The fix is already in GHC head, and should be in the next upcoming releases (GHC 8.0.1 and maybe 7.10.3).</p>\n\n<p>Other than that, @luqui's suggestion of a newtype wrapper seems the simplest option.</p>\n"}], "owner": {"reputation": 37219, "user_id": 1523776, "user_type": "moderator", "accept_rate": 87, "profile_image": "https://www.gravatar.com/avatar/b3e0b5c8e42a8c38009ef2d969f8dabb?s=128&d=identicon&r=PG", "display_name": "Benjamin Hodgson", "link": "https://stackoverflow.com/users/1523776/benjamin-hodgson"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 165, "favorite_count": 0, "accepted_answer_id": 32751745, "answer_count": 1, "score": 14, "last_activity_date": 1443056154, "creation_date": 1442992834, "last_edit_date": 1443032249, "question_id": 32733368, "link": "https://stackoverflow.com/questions/32733368/type-inequalities-in-the-presence-of-data-families", "title": "Type (in)equalities in the presence of data families", "body": "<p>I've got a type family which determines whether something is at the head of a type-level list.</p>\n\n<pre><code>type family AtHead x xs where\n    AtHead x (x ': xs) = True\n    AtHead y (x ': xs) = False\n</code></pre>\n\n<p>I want to construct the singleton representative of this result. This works fine for lists of simple types.</p>\n\n<pre><code>data Booly b where\n    Truey :: Booly True\n    Falsey :: Booly False\n\ntest1 :: Booly (AtHead Char [Char, Int])\ntest1 = Truey\ntest2 :: Booly (AtHead Int [Char, Int])\ntest2 = Falsey\n</code></pre>\n\n<p>But what I <em>really</em> want to do is construct this value for a list of members of an indexed <code>data family</code>. (In practice, I'm trying to project elements out of a heterogeneous list of <code>ID</code>s based on their type.)</p>\n\n<pre><code>data family ID a\n\ndata User = User\nnewtype instance ID User = UserId Int\n</code></pre>\n\n<p>This works when the <code>ID</code> we're looking for is at the head of the list.</p>\n\n<pre><code>test3 :: Booly (AtHead (ID User) [ID User, Char])\ntest3 = Truey\n</code></pre>\n\n<p>But it fails otherwise.</p>\n\n<pre><code>test4 :: Booly (AtHead (ID User) [Int, ID User])\ntest4 = Falsey\n\n    Couldn't match type \u2018AtHead (ID User) '[Int, ID User]\u2019\n                  with \u2018'False\u2019\n    Expected type: Booly (AtHead (ID User) '[Int, ID User])\n      Actual type: Booly 'False\n    In the expression: Falsey\n    In an equation for \u2018test4\u2019: test4 = Falsey\n</code></pre>\n\n<p><code>AtHead (ID User) '[Int, ID User]</code> doesn't unify with <code>'False</code>. It looks like GHC is reluctant to make the judgment that <code>ID User</code> and <code>Int</code> are unequal, even though <code>ID</code> is an injective <code>data family</code> (and is therefore in principle equal only to (things that reduce to) <code>ID User</code>).</p>\n\n<p>My intuition for what the constraint solver will and won't accept is rather weak: I feel like this ought to compile. Can anyone explain why my code doesn't type-check? Does there exist a way to cajole GHC into accepting it, perhaps by proving a theorem?</p>\n"}, {"tags": ["haskell", "conduit"], "comments": [{"owner": {"reputation": 23816, "user_id": 572606, "user_type": "registered", "accept_rate": 81, "profile_image": "https://www.gravatar.com/avatar/c20a126ad0dce40e8fc4a43456107919?s=128&d=identicon&r=PG", "display_name": "shang", "link": "https://stackoverflow.com/users/572606/shang"}, "edited": false, "score": 4, "creation_date": 1442999021, "post_id": 32732545, "comment_id": 53311355, "body": "Conduits can consume several inputs to produce one output. What should <code>pairConduit</code> do in that situation?"}, {"owner": {"reputation": 1011, "user_id": 1846758, "user_type": "registered", "accept_rate": 83, "profile_image": "https://www.gravatar.com/avatar/51d73b3b1efd718864b0ee0438afe551?s=128&d=identicon&r=PG", "display_name": "highfly22", "link": "https://stackoverflow.com/users/1846758/highfly22"}, "reply_to_user": {"reputation": 23816, "user_id": 572606, "user_type": "registered", "accept_rate": 81, "profile_image": "https://www.gravatar.com/avatar/c20a126ad0dce40e8fc4a43456107919?s=128&d=identicon&r=PG", "display_name": "shang", "link": "https://stackoverflow.com/users/572606/shang"}, "edited": false, "score": 0, "creation_date": 1443003157, "post_id": 32732545, "comment_id": 53314212, "body": "Good Point! It seems conduit should not be used in that way."}], "owner": {"reputation": 1011, "user_id": 1846758, "user_type": "registered", "accept_rate": 83, "profile_image": "https://www.gravatar.com/avatar/51d73b3b1efd718864b0ee0438afe551?s=128&d=identicon&r=PG", "display_name": "highfly22", "link": "https://stackoverflow.com/users/1846758/highfly22"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 69, "favorite_count": 0, "answer_count": 0, "score": 3, "last_activity_date": 1442994699, "creation_date": 1442989935, "last_edit_date": 1442994699, "question_id": 32732545, "link": "https://stackoverflow.com/questions/32732545/how-to-create-a-new-conduit-producing-input-and-output", "title": "How to create a new conduit producing input and output", "body": "<p>I am finding such a Conduit function to produce both input and output</p>\n\n<pre><code>pairConduit :: (Monad m) =&gt; ConduitM i o m r -&gt; ConduitM i (i, o) m r\n</code></pre>\n\n<p>I got a wrong solution:</p>\n\n<pre><code>pairConduit :: (Monad m) =&gt; ConduitM i o m () -&gt; ConduitM i (i, o) m ()\npairConduit c = do\n    mb &lt;- await\n    case mb of\n        (Just i) -&gt; do \n             mapOutput (\\a -&gt; (i,a)) c\n        Nothing -&gt; return ()\n</code></pre>\n"}, {"tags": ["haskell", "typeclass", "type-families"], "comments": [{"owner": {"reputation": 31243, "user_id": 2751851, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/4ddc0.png?s=128&g=1", "display_name": "duplode", "link": "https://stackoverflow.com/users/2751851/duplode"}, "edited": false, "score": 1, "creation_date": 1442993074, "post_id": 32732270, "comment_id": 53308052, "body": "A non-answer: you might use <code>Identity</code> in the first case and a suitable newtype in the second one (I can&#39;t think of any standard one right now). That is a crude workaround, but it might prove less painful than the advanced trickery this seems to call for. By the way, the &quot;I don&#39;t want to just make it <code>f :: (a, b) -&gt; (c, d)</code> as I want to maintain the invariant...&quot; sounds a lot like the issue of <i>lens</i> lenses being <code>Lens s t a b</code> <a href=\"http://comonad.com/reader/2012/mirrored-lenses\" rel=\"nofollow noreferrer\">even though the four parameters are mutually dependent</a> (see the &quot;Why is it a Lens Family?&quot; section of the post)."}, {"owner": {"reputation": 14485, "user_id": 190376, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/cd8280c5e1491b8cf55760750ed97dec?s=128&d=identicon&r=PG", "display_name": "Reid Barton", "link": "https://stackoverflow.com/users/190376/reid-barton"}, "edited": false, "score": 0, "creation_date": 1443025028, "post_id": 32732270, "comment_id": 53330042, "body": "I think this is basically the same question as <a href=\"http://stackoverflow.com/questions/4922560/why-doesnt-typesynonyminstances-allow-partially-applied-type-synonyms-to-be-use\" title=\"why doesnt typesynonyminstances allow partially applied type synonyms to be use\">stackoverflow.com/questions/4922560/&hellip;</a>"}], "answers": [{"comments": [{"owner": {"reputation": 36513, "user_id": 752976, "user_type": "registered", "accept_rate": 84, "profile_image": "https://i.stack.imgur.com/j7Uis.jpg?s=128&g=1", "display_name": "Bartek Banachewicz", "link": "https://stackoverflow.com/users/752976/bartek-banachewicz"}, "edited": false, "score": 0, "creation_date": 1443006518, "post_id": 32737628, "comment_id": 53316422, "body": "<code>Data.Coerce</code> looks really interesting. Thanks for that answer."}], "tags": [], "owner": {"reputation": 100185, "user_id": 3234959, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/93bb12ca0f93dfddb33880316f7e66c2?s=128&d=identicon&r=PG&f=1", "display_name": "chi", "link": "https://stackoverflow.com/users/3234959/chi"}, "is_accepted": false, "score": 5, "last_activity_date": 1443005486, "creation_date": 1443005486, "answer_id": 32737628, "question_id": 32732270, "link": "https://stackoverflow.com/questions/32732270/generalising-class-parameters/32737628#32737628", "title": "Generalising class parameters", "body": "<p>This may or may not answer your question depending on what you actually need to do.</p>\n\n<p>A standard solution is to use a newtype to define new instances. E.g.</p>\n\n<pre><code>newtype Pair a = Pair (a, a)\ninstance C a b Pair where\n   f = ...\n</code></pre>\n\n<p>However, this will cause <code>f</code> to have type</p>\n\n<pre><code>f :: (a, b) -&gt; (Pair a, Pair b)\n</code></pre>\n\n<p>instead of the wanted</p>\n\n<pre><code>f :: (a, b) -&gt; ((a, a), (b, b))\n</code></pre>\n\n<p>The latter can be recovered in a boring way:</p>\n\n<pre><code>f' :: (a, b) -&gt; ((a, a), (b, b))\nf' p = case f p of (Pair x, Pair y) -&gt; (x, y)\n</code></pre>\n\n<p>Now, writing \"adapter\" functions such as <code>f'</code> feels redundant: after all we are simply removing a <code>newtype</code> wrapper, which does not change the runtime representation. Worse, this could be inefficient: consider transforming <code>[Pair a]</code> into <code>[(a, a)]</code>. To do that, we would need to map over the whole list, so we pay O(n) do do essentially <em>nothing</em>.</p>\n\n<p>An efficient alternative can be constructed using <a href=\"https://downloads.haskell.org/~ghc/latest/docs/html/libraries/base-4.8.1.0/Data-Coerce.html\">safe coercions</a>:</p>\n\n<pre><code>import Data.Coerce\n\nf'' :: forall a b. (a, b) -&gt; ((a, a), (b, b))\nf'' = coerce (f :: (a, b) -&gt; (Pair a, Pair b))\n</code></pre>\n\n<p>This allows the use of <code>newtype</code>s to drive instance selection, and yet remove them when they get in the way.</p>\n\n<p>Now, if your aim really is to define new instances without <code>newtype</code>s, this does not help much. If instead you want a simple way to remove <code>newtype</code>s wrappers from instance methods, it can help.</p>\n"}], "owner": {"reputation": 20310, "user_id": 525980, "user_type": "registered", "accept_rate": 48, "profile_image": "https://www.gravatar.com/avatar/8dafe66793ee2f32192e9fcefb389a12?s=128&d=identicon&r=PG", "display_name": "Clinton", "link": "https://stackoverflow.com/users/525980/clinton"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 87, "favorite_count": 1, "answer_count": 1, "score": 6, "last_activity_date": 1443005486, "creation_date": 1442988820, "last_edit_date": 1442989356, "question_id": 32732270, "link": "https://stackoverflow.com/questions/32732270/generalising-class-parameters", "title": "Generalising class parameters", "body": "<p>Lets say I've got the class:</p>\n\n<pre><code>class C a b t where\n  f :: (a, b) -&gt; (t a, t b)\n</code></pre>\n\n<p>Now with this definition, I can define instances for say:</p>\n\n<pre><code>(a,b) -&gt; (Maybe a, Maybe b)\n(a,b) -&gt; ([a], [b])\n</code></pre>\n\n<p>But not for (as far as I understand):</p>\n\n<pre><code>(a,b) -&gt; (a,b)\n(a,b) -&gt; ((a, a), (b, b))\n</code></pre>\n\n<p>I could instead change my class definition like so:</p>\n\n<pre><code>type family T a b x\n\nclass C a b where\n  f :: (a, b) -&gt; (T a b a, T a b b)\n</code></pre>\n\n<p>Which would allow me to do the above, but then I'd only be able to declare one <code>f</code> for each <code>a</code> and <code>b</code>.</p>\n\n<p>Basically I want to be able to pass a type family as <code>t</code> in the original definition, which is implicitly resolved by the type checker if known. I don't want to just make it <code>f :: (a, b) -&gt; (c, d)</code> as I want to maintain the invariant that both <code>a</code> and <code>b</code> have the same thing done to them, so <code>swap . f</code> is the same type as <code>f . swap</code>. I'm thinking I might need <a href=\"https://ghc.haskell.org/trac/ghc/wiki/InjectiveTypeFamilies\">injective type families</a> (from GHC 8.0) but I'm not sure. But maybe there's another way?</p>\n"}, {"tags": ["haskell", "type-inference", "type-systems"], "comments": [{"owner": {"reputation": 5535, "user_id": 7295772, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/ZhWhR.jpg?s=128&g=1", "display_name": "Fabrizio Bertoglio", "link": "https://stackoverflow.com/users/7295772/fabrizio-bertoglio"}, "edited": false, "score": 0, "creation_date": 1488876329, "post_id": 32732074, "comment_id": 72414502, "body": "I have the same problem, your question helped me in finding a solution"}], "answers": [{"tags": [], "owner": {"reputation": 29966, "user_id": 637669, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/0227e5d5eaceb8ae2f751df38d421764?s=128&d=identicon&r=PG", "display_name": "arrowd", "link": "https://stackoverflow.com/users/637669/arrowd"}, "is_accepted": false, "score": 3, "last_activity_date": 1442988299, "creation_date": 1442988299, "answer_id": 32732132, "question_id": 32732074, "link": "https://stackoverflow.com/questions/32732074/why-does-this-function-take-an-a/32732132#32732132", "title": "Why does this function take an [[a]]?", "body": "<p>Because of <code>(x ++ list)</code> expression in the second line, typechecker thinks that <code>x :: [a]</code>. You wanted to write <code>(x : list)</code>, i guess.</p>\n"}, {"tags": [], "owner": {"reputation": 6075, "user_id": 147442, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/a5cb67e96d4c724cfac0ff043b11c87e?s=128&d=identicon&r=PG&f=1", "display_name": "R&#252;diger Hanke", "link": "https://stackoverflow.com/users/147442/r%c3%bcdiger-hanke"}, "is_accepted": true, "score": 9, "last_activity_date": 1442992941, "creation_date": 1442992941, "answer_id": 32733410, "question_id": 32732074, "link": "https://stackoverflow.com/questions/32732074/why-does-this-function-take-an-a/32733410#32733410", "title": "Why does this function take an [[a]]?", "body": "<p>If you don't get the expected type, it's a good idea to add an explicit type signature to tell the compiler what you want the type to be, here:</p>\n\n<pre><code>reverseh' :: [a] -&gt; [a] -&gt; [a]\n</code></pre>\n\n<p>Then you get a compilation error:</p>\n\n<pre><code>Couldn't match expected type `[a]' with actual type `a'     \n  `a' is a rigid type variable bound by                     \n      the type signature for reverseh' :: [a] -&gt; [a] -&gt; [a] \n      at reverseh.hs:1:14                                   \nRelevant bindings include                                   \n  list :: [a] (bound at reverseh.hs:3:18)                   \n  xs :: [a] (bound at reverseh.hs:3:14)                     \n  x :: a (bound at reverseh.hs:3:12)                        \n  reverseh' :: [a] -&gt; [a] -&gt; [a] (bound at reverseh.hs:2:1) \nIn the first argument of `(++)', namely `x'                 \nIn the second argument of reverseh', namely `(x ++ list)'   \n</code></pre>\n\n<p>This tells you that in <code>(x ++ list)</code>, <code>x</code> needs to be of type <code>[a]</code> in order to typecheck, but with the type signature you have in mind, <code>x</code> really is of type <code>a</code>. So you want to replace <code>++</code> with a function of type <code>a -&gt; [a] -&gt; [a]</code>, and so you go with <code>(x : list)</code>.</p>\n"}], "owner": {"reputation": 174, "user_id": 1829376, "user_type": "registered", "accept_rate": 89, "profile_image": "https://www.gravatar.com/avatar/57a99b4d09f0204222e3cb8f0f00457b?s=128&d=identicon&r=PG", "display_name": "Katharine Kim", "link": "https://stackoverflow.com/users/1829376/katharine-kim"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 98, "favorite_count": 0, "accepted_answer_id": 32733410, "answer_count": 2, "score": 0, "last_activity_date": 1443025242, "creation_date": 1442988068, "last_edit_date": 1443025242, "question_id": 32732074, "link": "https://stackoverflow.com/questions/32732074/why-does-this-function-take-an-a", "title": "Why does this function take an [[a]]?", "body": "<p>I am writing Haskell code practicing tail recursion to inverse a list and have came up with this solution:</p>\n\n<pre><code>reverseh' [] list = list\nreverseh' (x:xs) list = reverseh' (xs) (x ++ list)\nreverse' x = reverseh' x []\n</code></pre>\n\n<p>It only works with list of list but I wanted it to be have type signature <code>[a] -&gt; [a]</code>.</p>\n\n<p>Could you please explain what I am doing wrong here?</p>\n"}, {"tags": ["haskell", "sandbox", "ghc", "cabal"], "comments": [{"owner": {"reputation": 31243, "user_id": 2751851, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/4ddc0.png?s=128&g=1", "display_name": "duplode", "link": "https://stackoverflow.com/users/2751851/duplode"}, "edited": false, "score": 5, "creation_date": 1442982269, "post_id": 32730692, "comment_id": 53303590, "body": "Why in the world would someone vote to close because &quot;Questions about general computing hardware and software are off-topic for Stack Overflow unless they directly involve tools used primarily for programming&quot;? o_O"}], "answers": [{"comments": [{"owner": {"reputation": 845, "user_id": 4725700, "user_type": "registered", "accept_rate": 72, "profile_image": "https://www.gravatar.com/avatar/b517b68a2f6eee6dc160661a0e78e4ce?s=128&d=identicon&r=PG&f=1", "display_name": "mntk123", "link": "https://stackoverflow.com/users/4725700/mntk123"}, "edited": false, "score": 0, "creation_date": 1442983244, "post_id": 32730789, "comment_id": 53303851, "body": "on my machine there seem to be no packages in <code>&#47;usr&#47;local&#47;lib&#47;ghc</code> but they seem to be in <code>&#47;var&#47;lib&#47;ghc&#47;</code> and there seem to be a lot of packages in there. Even <code>GLUT-2.1.2.2</code> is there."}, {"owner": {"reputation": 845, "user_id": 4725700, "user_type": "registered", "accept_rate": 72, "profile_image": "https://www.gravatar.com/avatar/b517b68a2f6eee6dc160661a0e78e4ce?s=128&d=identicon&r=PG&f=1", "display_name": "mntk123", "link": "https://stackoverflow.com/users/4725700/mntk123"}, "edited": false, "score": 0, "creation_date": 1443016085, "post_id": 32730789, "comment_id": 53323516, "body": "I guess it needs more explanation. I have edited the question."}], "tags": [], "owner": {"reputation": 21417, "user_id": 925978, "user_type": "registered", "accept_rate": 84, "profile_image": "https://www.gravatar.com/avatar/06e4467a5bd1538a92cefb20db07897a?s=128&d=identicon&r=PG&f=1", "display_name": "crockeea", "link": "https://stackoverflow.com/users/925978/crockeea"}, "is_accepted": false, "score": 4, "last_activity_date": 1442981240, "creation_date": 1442981240, "answer_id": 32730789, "question_id": 32730692, "link": "https://stackoverflow.com/questions/32730692/which-packages-are-hardwired-into-ghc/32730789#32730789", "title": "Which packages are hardwired into GHC?", "body": "<p>If you run <code>ghc-pkg list</code>, there should be two lists of packages: those installed in <code>/usr/local/lib/ghc</code> (or wherever GHC is installed), and those in <code>~/.ghc/</code>. The packages in <code>/usr/local/lib/ghc</code> come with GHC.</p>\n"}], "owner": {"reputation": 845, "user_id": 4725700, "user_type": "registered", "accept_rate": 72, "profile_image": "https://www.gravatar.com/avatar/b517b68a2f6eee6dc160661a0e78e4ce?s=128&d=identicon&r=PG&f=1", "display_name": "mntk123", "link": "https://stackoverflow.com/users/4725700/mntk123"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 108, "favorite_count": 1, "answer_count": 1, "score": 8, "last_activity_date": 1443016278, "creation_date": 1442980595, "last_edit_date": 1495541736, "question_id": 32730692, "link": "https://stackoverflow.com/questions/32730692/which-packages-are-hardwired-into-ghc", "title": "Which packages are hardwired into GHC?", "body": "<p>While trying out the <code>cabal sandbox</code> I found that you cannot install different versions of <code>base</code> and some other packages in sandbox as pointed out in <a href=\"https://stackoverflow.com/a/32724583/4725700\">this answer</a>.</p>\n\n<p>I wonder which packages are hardwired into GHC. Is there a complete list somewhere?\nI could not find it using google.\nI don't just want to get the list of packages that gets installed with ghc. I want to know which packages are so intrinsic to GHC that you cannot install multiple versions of those packages even in a sandbox.\nIn other words, Which packages are not at all amenable to cabal sandbox?</p>\n"}, {"tags": ["haskell", "ghc", "hsc2hs"], "answers": [{"tags": [], "owner": {"reputation": 18999, "user_id": 825637, "user_type": "registered", "accept_rate": 85, "profile_image": "https://www.gravatar.com/avatar/825a58fde1ef99db42c5354dab6cd472?s=128&d=identicon&r=PG", "display_name": "MasterMastic", "link": "https://stackoverflow.com/users/825637/mastermastic"}, "is_accepted": false, "score": 4, "last_activity_date": 1442962473, "creation_date": 1442962473, "answer_id": 32728330, "question_id": 32728329, "link": "https://stackoverflow.com/questions/32728329/how-to-specialize-for-a-hsc2hs-type/32728330#32728330", "title": "How to SPECIALIZE for a hsc2hs type?", "body": "<p>It's possible to delegate the <code>#type</code> using a <code>type</code> declaration:</p>\n\n<pre><code>type SDWORD = #{type DWORD}\n{-# SPECIALIZE someFn :: SDWORD -&gt; SDWORD -&gt; Bool #-}\nsomeFn :: Eq a =&gt; a -&gt; a -&gt; Bool\n</code></pre>\n"}], "owner": {"reputation": 18999, "user_id": 825637, "user_type": "registered", "accept_rate": 85, "profile_image": "https://www.gravatar.com/avatar/825a58fde1ef99db42c5354dab6cd472?s=128&d=identicon&r=PG", "display_name": "MasterMastic", "link": "https://stackoverflow.com/users/825637/mastermastic"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 40, "favorite_count": 0, "answer_count": 1, "score": 3, "last_activity_date": 1442962473, "creation_date": 1442962473, "question_id": 32728329, "link": "https://stackoverflow.com/questions/32728329/how-to-specialize-for-a-hsc2hs-type", "title": "How to SPECIALIZE for a hsc2hs type?", "body": "<p>I'm trying to use the SPECIALIZE pragma to a type I get through hsc2hs's <code>#type</code>.</p>\n\n<p>I tried something like this:</p>\n\n<pre><code>{-# SPECIALIZE someFn :: #{type DWORD} -&gt; #{type DWORD} -&gt; Bool #-}\nsomeFn :: Eq a =&gt; a -&gt; a -&gt; Bool\n</code></pre>\n\n<p>That attempt fails with a <code>parse error on input '#'</code> (on the first <code>#{type DWORD}</code>).</p>\n\n<p>I've put an answer that I found to work but I'm really hoping for something cleaner -- or more precisely: something that doesn't impact the entire module's code.</p>\n"}, {"tags": ["haskell", "functional-programming", "seq"], "comments": [{"owner": {"reputation": 314794, "user_id": 67579, "user_type": "registered", "accept_rate": 81, "profile_image": "https://i.stack.imgur.com/BJXub.png?s=128&g=1", "display_name": "Willem Van Onsem", "link": "https://stackoverflow.com/users/67579/willem-van-onsem"}, "edited": false, "score": 0, "creation_date": 1442960980, "post_id": 32727923, "comment_id": 53298289, "body": "In what <i>&quot;context&quot;</i> is <code>take 2000</code> written? In the interactive shell?"}, {"owner": {"reputation": 314794, "user_id": 67579, "user_type": "registered", "accept_rate": 81, "profile_image": "https://i.stack.imgur.com/BJXub.png?s=128&g=1", "display_name": "Willem Van Onsem", "link": "https://stackoverflow.com/users/67579/willem-van-onsem"}, "edited": false, "score": 1, "creation_date": 1442961985, "post_id": 32727923, "comment_id": 53298653, "body": "I don&#39;t really see why you have to evaluate this strictly: you can still have memoization lazily: if you need key <code>400</code>, it will evaluate until it has found that element. It is possible it has done work in between. If you later need, <code>300</code> good chance, it is already evaluated. If you need element <code>600</code>, it can continue the work already carried out by evaluating <code>400</code> and <code>300</code>. Memoization and lazyness are not opposites."}, {"owner": {"reputation": 44013, "user_id": 1477667, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/trgKM.jpg?s=128&g=1", "display_name": "dfeuer", "link": "https://stackoverflow.com/users/1477667/dfeuer"}, "edited": false, "score": 0, "creation_date": 1443285548, "post_id": 32727923, "comment_id": 53436398, "body": "Be wary of <code>deepseq</code>--it can easily make your program slow. A decent rule of thumb for single-threaded programs is that you should never <code>deepseq</code> anything large unless you absolutely need to. For parallel programs, you should typically <code>deepseq</code> large values only if doing so requires a lot of work per element. Remember: loading a value from memory into cache is expensive. If you dig through a data structure to force everything, and then go through it again to use it, you pay that cost twice. In many cases, you&#39;ll also burn a lot of extra time in garbage collection."}], "answers": [{"comments": [{"owner": {"reputation": 17809, "user_id": 1088108, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/63781cd38e91aa346a3849bc3ef3e550?s=128&d=identicon&r=PG&f=1", "display_name": "&#216;rjan Johansen", "link": "https://stackoverflow.com/users/1088108/%c3%98rjan-johansen"}, "edited": false, "score": 0, "creation_date": 1442962607, "post_id": 32728112, "comment_id": 53298844, "body": "I believe the <code>$!</code> in <code>return $! take 2000 (iterate parts&#39; (M.fromList [(1,[[1]])]))</code> is entirely useless, because it only evaluates up to the topmost list constructor, and <code>take 2000 (iterate ... ...)</code> doesn&#39;t need to evaluate <i>any</i> of the <code>...</code> parts to find that the list is non-empty."}, {"owner": {"reputation": 314794, "user_id": 67579, "user_type": "registered", "accept_rate": 81, "profile_image": "https://i.stack.imgur.com/BJXub.png?s=128&g=1", "display_name": "Willem Van Onsem", "link": "https://stackoverflow.com/users/67579/willem-van-onsem"}, "reply_to_user": {"reputation": 17809, "user_id": 1088108, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/63781cd38e91aa346a3849bc3ef3e550?s=128&d=identicon&r=PG&f=1", "display_name": "&#216;rjan Johansen", "link": "https://stackoverflow.com/users/1088108/%c3%98rjan-johansen"}, "edited": false, "score": 0, "creation_date": 1442962740, "post_id": 32728112, "comment_id": 53298883, "body": "@&#216;rjanJohansen: true, that&#39;s why you need to perform &quot;strictness&quot; on every call level, such that the <code>i</code>-th element is forced to be evaluated as well..."}], "tags": [], "owner": {"reputation": 314794, "user_id": 67579, "user_type": "registered", "accept_rate": 81, "profile_image": "https://i.stack.imgur.com/BJXub.png?s=128&g=1", "display_name": "Willem Van Onsem", "link": "https://stackoverflow.com/users/67579/willem-van-onsem"}, "is_accepted": true, "score": 4, "last_activity_date": 1442963142, "last_edit_date": 1442963142, "creation_date": 1442961326, "answer_id": 32728112, "question_id": 32727923, "link": "https://stackoverflow.com/questions/32727923/forcing-strict-evaluation-what-am-i-doing-wrong/32728112#32728112", "title": "Forcing Strict Evaluation - What am I doing wrong?", "body": "<p><strong>Short answer:</strong></p>\n\n<p>If you need to <strong>calculate the entire list/array/map/...</strong> at once, you can use <code>deepseq</code> as @JoshuaRahm suggests, or the <code>($!!)</code> operator.</p>\n\n<p>The answer below how you can enforce strictness, but <strong>only on level-1</strong> (it evaluates until it reaches a datastructure that may contain (remainders) of expression trees).</p>\n\n<p>Furthermore the answer argues <strong>why laziness and memoization are not (necessarily) opposites</strong> of each other.</p>\n\n<p><strong>More advanced:</strong></p>\n\n<p>Haskell is a lazy language, it means it only <em>calculates</em> something, if it is absolutely necessary. An expression like:</p>\n\n<pre><code>take 2000 (iterate parts' (M.fromList [(1,[[1]])]))\n</code></pre>\n\n<p>is not evaluated immediately: Haskell simply stores that this has to be calculated later. Later if you really need the first, second, <em>i</em>-th, or the length of the list, it will evaluate it, and even then in a lazy fashion: if you need the first element, from the moment it has found the way to calculate that element, it will represent it as:</p>\n\n<pre><code>element : take 1999 (&lt;some-expression&gt;)\n</code></pre>\n\n<p>You can however force Haskell to evaluate something strictly with the <a href=\"https://wiki.haskell.org/Performance/Strictness\" rel=\"nofollow\">exclamation mark (<code>!</code>)</a>, this is called <em>strictness</em>. For instance:</p>\n\n<pre><code>main = do\n    return $! take 2000 (iterate parts' (M.fromList [(1,[[1]])]))\n</code></pre>\n\n<p>Or in case it is an argument, you can use it like:</p>\n\n<pre><code>f x !y !z = x+y+z\n</code></pre>\n\n<p>Here you force Haskell to evaluate <code>y</code> and <code>z</code> before \"increasing the expression tree\" as:</p>\n\n<blockquote>\n  <p><em>expression-for-x<code>+</code>expression-for-y<code>+</code>expression-for-z</em>.</p>\n</blockquote>\n\n<p><strong>EDIT</strong>: if you use it in a let pattern, you can <a href=\"https://ghc.haskell.org/trac/ghc/wiki/StrictPragma\" rel=\"nofollow\">use the bang as well</a>:</p>\n\n<pre><code>let !foo = take 2000 (iterate parts' (M.fromList [(1,[[1]])])) in ...\n</code></pre>\n\n<hr>\n\n<p>Note that you only collapse the structure to the <em>first level</em>. Thus <code>let !foo</code> will more or less only evaluate up to <code>(_:_)</code>.</p>\n\n<hr>\n\n<p><strong>Note</strong>: note that <em>memoization</em> and <em>lazyness</em> are not necessary opposites of each other. Consider the list:</p>\n\n<pre><code>numbers :: [Integer]\nnumbers = 0:[i+(sum (genericTake i numbers))|i&lt;-[1..]]\n</code></pre>\n\n<p>As you can see, calculating a number requires a large amount of computational effort. Numbers is represented like:</p>\n\n<pre><code>numbers ---&gt; (0:[i+(sum (genericTake i numbers))|i&lt;-[1..]])\n</code></pre>\n\n<p>if however, I evaluate <code>numbers!!1</code>, it will have to calculate the first element, it returns <code>1</code>; but the internal structure of <code>numbers</code> is evaluated as well. Now it looks like:</p>\n\n<pre><code>numbers (0:1:[i+(sum (genericTake i numbers))|i&lt;-[2..]])\n</code></pre>\n\n<p>The computation <code>numbers!!1</code> thus will \"help\" future computations, because you will never have to recalcuate the second element in the list.</p>\n\n<p>If you for instance calculate <code>numbers!!4000</code>, it will take a few seconds. Later if you calculate <code>numbers!!4001</code>, it will be calculated almost instantly. Simply because the work already done by <code>numbers!!4000</code> is <em>reused</em>.</p>\n"}, {"tags": [], "owner": {"reputation": 524, "user_id": 4544466, "user_type": "registered", "profile_image": "https://lh6.googleusercontent.com/-euIebM1E474/AAAAAAAAAAI/AAAAAAAAACo/TsKazqL7Mas/photo.jpg?sz=128", "display_name": "Joshua Rahm", "link": "https://stackoverflow.com/users/4544466/joshua-rahm"}, "is_accepted": false, "score": 4, "last_activity_date": 1442961414, "creation_date": 1442961414, "answer_id": 32728136, "question_id": 32727923, "link": "https://stackoverflow.com/questions/32727923/forcing-strict-evaluation-what-am-i-doing-wrong/32728136#32728136", "title": "Forcing Strict Evaluation - What am I doing wrong?", "body": "<p>Arrays might be able to help, but you can also try taking advantage of the <a href=\"https://hackage.haskell.org/package/deepseq\" rel=\"nofollow\">deepseq</a> library. So you can write code like this:</p>\n\n<pre><code>let x = take 2000 (iterate parts' (M.fromList [(1,[[1]])])) in do\n     x `deepseq` print (x !! 5)    -- takes a *really* long time\n     print (x !! 1999)             -- finishes instantly\n</code></pre>\n"}, {"tags": [], "owner": {"reputation": 49959, "user_id": 866915, "user_type": "registered", "accept_rate": 70, "profile_image": "https://www.gravatar.com/avatar/09242131d6e17cbbe31e8547514da6e5?s=128&d=identicon&r=PG", "display_name": "ErikR", "link": "https://stackoverflow.com/users/866915/erikr"}, "is_accepted": false, "score": 4, "last_activity_date": 1442964215, "creation_date": 1442964215, "answer_id": 32728614, "question_id": 32727923, "link": "https://stackoverflow.com/questions/32727923/forcing-strict-evaluation-what-am-i-doing-wrong/32728614#32728614", "title": "Forcing Strict Evaluation - What am I doing wrong?", "body": "<p>You are memoizing the partitions functions, but there are some drawbacks to your approach:</p>\n\n<ul>\n<li>you are only memoizing up to a specific value which you have to specify beforehand</li>\n<li>you need to call <code>nub</code> and <code>sort</code></li>\n</ul>\n\n<p>Here is an approach using <code>Data.Memocombinators</code>:</p>\n\n<pre><code>import Data.Memocombinators\n\nparts = integral go\n  where\n    go k | k &lt;= 0 = []  -- for safety\n    go 1 = [[1]]\n    go n = [[n]] ++ [ (a : p) | a &lt;- [n-1,n-2..1], p &lt;- parts (n-a), a &gt;= head p ]\n</code></pre>\n\n<p>E.g.:</p>\n\n<pre><code>ghci&gt; parts 4\n[[4],[3,1],[2,2],[2,1,1],[1,1,1,1]]\n</code></pre>\n\n<p>This memoization is dynamic, so only the values you actually access will be memoized.</p>\n\n<p>Note how it is constructed - <code>parts = integral go</code>, and <code>go</code> uses <code>parts</code> for any recursive calls. We use the <code>integral</code> combinator here because <code>parts</code> is a function of an Int.</p>\n"}], "owner": {"reputation": 1555, "user_id": 901883, "user_type": "registered", "accept_rate": 58, "profile_image": "https://www.gravatar.com/avatar/e052e211d757479676da909bbc472440?s=128&d=identicon&r=PG", "display_name": "manasij7479", "link": "https://stackoverflow.com/users/901883/manasij7479"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 395, "favorite_count": 0, "accepted_answer_id": 32728112, "answer_count": 3, "score": 2, "last_activity_date": 1442982618, "creation_date": 1442960399, "last_edit_date": 1442982618, "question_id": 32727923, "link": "https://stackoverflow.com/questions/32727923/forcing-strict-evaluation-what-am-i-doing-wrong", "title": "Forcing Strict Evaluation - What am I doing wrong?", "body": "<p>I want an intermediate result computed before generating the new one to get the benefit of memoization.</p>\n\n<pre><code>import qualified Data.Map.Strict as M\nimport Data.List\nparts' m = newmap\n    where\n    n = M.size m + 1 \n    lists =  nub $ map sort $ \n        [n] : (concat $ map (\\i -&gt; map (i:) (M.findWithDefault [] (n-i) m)) [1..n])\n    newmap = seq lists (M.insert n lists m)\n</code></pre>\n\n<p>But, then if I do</p>\n\n<pre><code>take 2000 (iterate parts' (M.fromList [(1,[[1]])]))\n</code></pre>\n\n<p>It still completes instantaneously.</p>\n\n<p>(Can using an Array instead of a Map help?)</p>\n"}, {"tags": ["haskell", "assert", "assertions"], "comments": [{"owner": {"reputation": 15757, "user_id": 176841, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/45a168cb9eb8454d66c78f18e29d9342?s=128&d=identicon&r=PG", "display_name": "jberryman", "link": "https://stackoverflow.com/users/176841/jberryman"}, "edited": false, "score": 0, "creation_date": 1442959402, "post_id": 32727418, "comment_id": 53297747, "body": "The assertion is working fine for me in GHCi 7.10 (which I assume you&#39;re using) and 7.6, are you sure about that case? And in the compiled example are you compiling with optimizations? In that case assertions become no-ops"}, {"owner": {"reputation": 35444, "user_id": 656912, "user_type": "registered", "accept_rate": 66, "profile_image": "https://www.gravatar.com/avatar/ce95c01cbd4f90f014d988ae5c8a422d?s=128&d=identicon&r=PG", "display_name": "orome", "link": "https://stackoverflow.com/users/656912/orome"}, "reply_to_user": {"reputation": 15757, "user_id": 176841, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/45a168cb9eb8454d66c78f18e29d9342?s=128&d=identicon&r=PG", "display_name": "jberryman", "link": "https://stackoverflow.com/users/176841/jberryman"}, "edited": false, "score": 0, "creation_date": 1442959796, "post_id": 32727418, "comment_id": 53297901, "body": "@jberryman: 7.10.2 (added). Yes, certain. Could I have set something in GHCi that optimizes? I don&#39;t have any flags set (that I&#39;m aware of) when I compile."}, {"owner": {"reputation": 17809, "user_id": 1088108, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/63781cd38e91aa346a3849bc3ef3e550?s=128&d=identicon&r=PG&f=1", "display_name": "&#216;rjan Johansen", "link": "https://stackoverflow.com/users/1088108/%c3%98rjan-johansen"}, "edited": false, "score": 0, "creation_date": 1442960328, "post_id": 32727418, "comment_id": 53298062, "body": "Does the output of the <code>:set</code> command in GHCi contain <code>-fignore-asserts</code>? That would explain GHCi although not standalone GHC... alternatively, GHCi bytecode <i>never</i> optimizes, does it contain <code>-fobject-code</code>?"}, {"owner": {"reputation": 35444, "user_id": 656912, "user_type": "registered", "accept_rate": 66, "profile_image": "https://www.gravatar.com/avatar/ce95c01cbd4f90f014d988ae5c8a422d?s=128&d=identicon&r=PG", "display_name": "orome", "link": "https://stackoverflow.com/users/656912/orome"}, "reply_to_user": {"reputation": 17809, "user_id": 1088108, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/63781cd38e91aa346a3849bc3ef3e550?s=128&d=identicon&r=PG&f=1", "display_name": "&#216;rjan Johansen", "link": "https://stackoverflow.com/users/1088108/%c3%98rjan-johansen"}, "edited": false, "score": 0, "creation_date": 1442960971, "post_id": 32727418, "comment_id": 53298285, "body": "@&#216;rjanJohansen: Output of <code>:set</code> added to question."}, {"owner": {"reputation": 17809, "user_id": 1088108, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/63781cd38e91aa346a3849bc3ef3e550?s=128&d=identicon&r=PG&f=1", "display_name": "&#216;rjan Johansen", "link": "https://stackoverflow.com/users/1088108/%c3%98rjan-johansen"}, "edited": false, "score": 0, "creation_date": 1442961472, "post_id": 32727418, "comment_id": 53298455, "body": "Hm. Another hunch, if you have a <code>*.o</code> file for the module/program, try deleting it before trying GHCi again. It may have been compiled with optimizations and then all the other paths pick it up..."}, {"owner": {"reputation": 35444, "user_id": 656912, "user_type": "registered", "accept_rate": 66, "profile_image": "https://www.gravatar.com/avatar/ce95c01cbd4f90f014d988ae5c8a422d?s=128&d=identicon&r=PG", "display_name": "orome", "link": "https://stackoverflow.com/users/656912/orome"}, "reply_to_user": {"reputation": 17809, "user_id": 1088108, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/63781cd38e91aa346a3849bc3ef3e550?s=128&d=identicon&r=PG&f=1", "display_name": "&#216;rjan Johansen", "link": "https://stackoverflow.com/users/1088108/%c3%98rjan-johansen"}, "edited": false, "score": 0, "creation_date": 1442961756, "post_id": 32727418, "comment_id": 53298565, "body": "@&#216;rjanJohansen: No <code>*.o</code> files for the code containing the definition of <code>f</code>."}, {"owner": {"reputation": 15757, "user_id": 176841, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/45a168cb9eb8454d66c78f18e29d9342?s=128&d=identicon&r=PG", "display_name": "jberryman", "link": "https://stackoverflow.com/users/176841/jberryman"}, "edited": false, "score": 0, "creation_date": 1442962528, "post_id": 32727418, "comment_id": 53298819, "body": "(I tested on GHCi 7.10.1)"}, {"owner": {"reputation": 17809, "user_id": 1088108, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/63781cd38e91aa346a3849bc3ef3e550?s=128&d=identicon&r=PG&f=1", "display_name": "&#216;rjan Johansen", "link": "https://stackoverflow.com/users/1088108/%c3%98rjan-johansen"}, "edited": false, "score": 0, "creation_date": 1442966456, "post_id": 32727418, "comment_id": 53299990, "body": "(I tested on GHC and GHCi 7.10.2)"}, {"owner": {"reputation": 35444, "user_id": 656912, "user_type": "registered", "accept_rate": 66, "profile_image": "https://www.gravatar.com/avatar/ce95c01cbd4f90f014d988ae5c8a422d?s=128&d=identicon&r=PG", "display_name": "orome", "link": "https://stackoverflow.com/users/656912/orome"}, "reply_to_user": {"reputation": 17809, "user_id": 1088108, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/63781cd38e91aa346a3849bc3ef3e550?s=128&d=identicon&r=PG&f=1", "display_name": "&#216;rjan Johansen", "link": "https://stackoverflow.com/users/1088108/%c3%98rjan-johansen"}, "edited": false, "score": 0, "creation_date": 1442967108, "post_id": 32727418, "comment_id": 53300164, "body": "@&#216;rjanJohansen: I&#39;ve confirmed that I&#39;m seeing this. Build library, with <code>f</code> in it, <code>import</code> the library, and run <code>f</code> as above: <code>negative index</code> (rather than a failed assertion)."}, {"owner": {"reputation": 35444, "user_id": 656912, "user_type": "registered", "accept_rate": 66, "profile_image": "https://www.gravatar.com/avatar/ce95c01cbd4f90f014d988ae5c8a422d?s=128&d=identicon&r=PG", "display_name": "orome", "link": "https://stackoverflow.com/users/656912/orome"}, "reply_to_user": {"reputation": 17809, "user_id": 1088108, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/63781cd38e91aa346a3849bc3ef3e550?s=128&d=identicon&r=PG&f=1", "display_name": "&#216;rjan Johansen", "link": "https://stackoverflow.com/users/1088108/%c3%98rjan-johansen"}, "edited": false, "score": 0, "creation_date": 1442967570, "post_id": 32727418, "comment_id": 53300278, "body": "@&#216;rjanJohansen: Note that I&#39;m using Haskell-Platform 7.10.2-a, if that matters."}, {"owner": {"reputation": 17809, "user_id": 1088108, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/63781cd38e91aa346a3849bc3ef3e550?s=128&d=identicon&r=PG&f=1", "display_name": "&#216;rjan Johansen", "link": "https://stackoverflow.com/users/1088108/%c3%98rjan-johansen"}, "edited": false, "score": 0, "creation_date": 1442971347, "post_id": 32727418, "comment_id": 53301084, "body": "Me too. Cannot reproduce. BTW do you have the <code>GHC_OPTIONS</code> environment variable set to anything?"}, {"owner": {"reputation": 35444, "user_id": 656912, "user_type": "registered", "accept_rate": 66, "profile_image": "https://www.gravatar.com/avatar/ce95c01cbd4f90f014d988ae5c8a422d?s=128&d=identicon&r=PG", "display_name": "orome", "link": "https://stackoverflow.com/users/656912/orome"}, "reply_to_user": {"reputation": 17809, "user_id": 1088108, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/63781cd38e91aa346a3849bc3ef3e550?s=128&d=identicon&r=PG&f=1", "display_name": "&#216;rjan Johansen", "link": "https://stackoverflow.com/users/1088108/%c3%98rjan-johansen"}, "edited": false, "score": 0, "creation_date": 1442972427, "post_id": 32727418, "comment_id": 53301333, "body": "@&#216;rjanJohansen: Nope: <code>env</code> doesn&#39;t list it."}, {"owner": {"reputation": 35444, "user_id": 656912, "user_type": "registered", "accept_rate": 66, "profile_image": "https://www.gravatar.com/avatar/ce95c01cbd4f90f014d988ae5c8a422d?s=128&d=identicon&r=PG", "display_name": "orome", "link": "https://stackoverflow.com/users/656912/orome"}, "reply_to_user": {"reputation": 15757, "user_id": 176841, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/45a168cb9eb8454d66c78f18e29d9342?s=128&d=identicon&r=PG", "display_name": "jberryman", "link": "https://stackoverflow.com/users/176841/jberryman"}, "edited": false, "score": 0, "creation_date": 1444755767, "post_id": 32727418, "comment_id": 54031488, "body": "@jberryman: Indeed, the issue here seems to be simply that <code>assert</code> gets turned into a no-op in any compiled code, but if I just load the file (with <code>:l</code>) they are not. I&#39;d except that as an answer."}], "owner": {"reputation": 35444, "user_id": 656912, "user_type": "registered", "accept_rate": 66, "profile_image": "https://www.gravatar.com/avatar/ce95c01cbd4f90f014d988ae5c8a422d?s=128&d=identicon&r=PG", "display_name": "orome", "link": "https://stackoverflow.com/users/656912/orome"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 219, "favorite_count": 1, "answer_count": 0, "score": 4, "last_activity_date": 1443306104, "creation_date": 1442958083, "last_edit_date": 1443306104, "question_id": 32727418, "link": "https://stackoverflow.com/questions/32727418/why-does-my-haskell-assertion-only-happen-in-ihaskell", "title": "Why does my Haskell assertion only happen in IHaskell?", "body": "<p>If I define</p>\n\n<pre><code>import Control.Exception (assert)\nimport Data.Char (ord)\n\nf :: String -&gt; String\nf s = assert (all (`elem` letters) s) $ (letters!!) &lt;$&gt; (ix &lt;$&gt; s)\n    where\n        ix ch = (ord ch - ord 'A')\n        letters = ['A'..'Z']\n</code></pre>\n\n<p>then if I execute</p>\n\n<pre><code>f \"AB.CD\"\n</code></pre>\n\n<p>in IHaskell, I get</p>\n\n<pre><code>:10:7-12: Assertion failed\n</code></pre>\n\n<p>as I would expect. But in all other settings, the assertion seems to be ignored. For example in GHCi (7.10.2) I get</p>\n\n<pre><code>ghci&gt;f \"AB.CD\"\n\"AB*** Exception: Prelude.!!: negative index \n</code></pre>\n\n<p>and if I put the expression in a program </p>\n\n<pre><code>main :: IO ()\nmain = do\n    print $ f \"AB.CD\"\n</code></pre>\n\n<p>I get</p>\n\n<pre><code>prgm: Prelude.!!: negative index\n\"AB\n</code></pre>\n\n<p>Why is my assertion being ignored everywhere but in IHaskell?</p>\n\n<hr>\n\n<p>In GHCi, <code>:set</code> gives:</p>\n\n<pre><code>options currently set: none.\nbase language is: Haskell2010\nwith the following modifiers:\n  -XNoDatatypeContexts\n  -XNondecreasingIndentation\nGHCi-specific dynamic flag settings:\nother dynamic, non-language, flag settings:\n  -fimplicit-import-qualified\nwarning settings:\n</code></pre>\n"}, {"tags": ["haskell", "types"], "comments": [{"owner": {"reputation": 60956, "user_id": 8922, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/f1634a09333f7b391db92e1d2bea6253?s=128&d=identicon&r=PG", "display_name": "Sebastian Redl", "link": "https://stackoverflow.com/users/8922/sebastian-redl"}, "edited": false, "score": 8, "creation_date": 1442957206, "post_id": 32727219, "comment_id": 53296782, "body": "Yes. That&#39;s it."}, {"owner": {"reputation": 62252, "user_id": 1435869, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/TrEd9.jpg?s=128&g=1", "display_name": "karakfa", "link": "https://stackoverflow.com/users/1435869/karakfa"}, "edited": false, "score": 0, "creation_date": 1442957892, "post_id": 32727219, "comment_id": 53297095, "body": "You may want to use <code>Integer</code> at least"}, {"owner": {"reputation": 31243, "user_id": 2751851, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/4ddc0.png?s=128&g=1", "display_name": "duplode", "link": "https://stackoverflow.com/users/2751851/duplode"}, "edited": false, "score": 2, "creation_date": 1442957972, "post_id": 32727219, "comment_id": 53297135, "body": "A detail: that type means you can use any type of <i>integer</i> numbers (that is, any type which is an instance of <code>Integer</code>). For instance, <code>factorial 0.5</code> won&#39;t work."}], "answers": [{"comments": [{"owner": {"reputation": 73, "user_id": 5147485, "user_type": "registered", "accept_rate": 60, "profile_image": "https://www.gravatar.com/avatar/a851f836656a6c5db4c694fadb5ac100?s=128&d=identicon&r=PG&f=1", "display_name": "paulo_ferreira", "link": "https://stackoverflow.com/users/5147485/paulo-ferreira"}, "edited": false, "score": 0, "creation_date": 1443047097, "post_id": 32727738, "comment_id": 53341542, "body": "So if i put (Num a) instead of (Integral a) factorial 0.5 will work?"}, {"owner": {"reputation": 44013, "user_id": 1477667, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/trgKM.jpg?s=128&g=1", "display_name": "dfeuer", "link": "https://stackoverflow.com/users/1477667/dfeuer"}, "reply_to_user": {"reputation": 73, "user_id": 5147485, "user_type": "registered", "accept_rate": 60, "profile_image": "https://www.gravatar.com/avatar/a851f836656a6c5db4c694fadb5ac100?s=128&d=identicon&r=PG&f=1", "display_name": "paulo_ferreira", "link": "https://stackoverflow.com/users/5147485/paulo-ferreira"}, "edited": false, "score": 0, "creation_date": 1443054799, "post_id": 32727738, "comment_id": 53343703, "body": "@paulo_ferreira, when you do that, and test it, what happens? Can you figure out why?"}], "tags": [], "owner": {"reputation": 44013, "user_id": 1477667, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/trgKM.jpg?s=128&g=1", "display_name": "dfeuer", "link": "https://stackoverflow.com/users/1477667/dfeuer"}, "is_accepted": false, "score": 2, "last_activity_date": 1443035855, "last_edit_date": 1443035855, "creation_date": 1442959566, "answer_id": 32727738, "question_id": 32727219, "link": "https://stackoverflow.com/questions/32727219/types-of-a-function/32727738#32727738", "title": "Types of a function", "body": "<p><em>This answer is a mashup of the comments to the question.</em></p>\n\n<p>Your interpretation is correct, except for one detail: that type means you can use any type of <em>integer</em> numbers (that is, any type which is an instance of <code>Integer</code>). For instance, <code>factorial 0.5</code> won't work, as expected for a factorial function.</p>\n"}], "owner": {"reputation": 73, "user_id": 5147485, "user_type": "registered", "accept_rate": 60, "profile_image": "https://www.gravatar.com/avatar/a851f836656a6c5db4c694fadb5ac100?s=128&d=identicon&r=PG&f=1", "display_name": "paulo_ferreira", "link": "https://stackoverflow.com/users/5147485/paulo-ferreira"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 95, "favorite_count": 0, "answer_count": 1, "score": 0, "last_activity_date": 1443035855, "creation_date": 1442957134, "last_edit_date": 1442957825, "question_id": 32727219, "link": "https://stackoverflow.com/questions/32727219/types-of-a-function", "title": "Types of a function", "body": "<p>I saw on a Haskell tutorial this function: </p>\n\n<pre><code>factorial :: (Integral a) =&gt; a -&gt; a \n</code></pre>\n\n<p>My question is why should I use that instead of this:</p>\n\n<pre><code>factorial :: Int-&gt;Int\n</code></pre>\n\n<p>It's because with the first one we can use every type of numbers and in the second one we can only use an <code>Int</code>?</p>\n"}, {"tags": ["haskell", "unicode"], "comments": [{"owner": {"reputation": 126897, "user_id": 791604, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/ce991df7a056248d5e4f6fc3659ba733?s=128&d=identicon&r=PG", "display_name": "Daniel Wagner", "link": "https://stackoverflow.com/users/791604/daniel-wagner"}, "edited": false, "score": 1, "creation_date": 1442956650, "post_id": 32726855, "comment_id": 53296523, "body": "Possibly a duplicate of <a href=\"http://stackoverflow.com/q/24953125/791604\">this one</a>? I could close it myself, but I&#39;m not sure on this one. What do you think, @raxacoricofallapatorius? Does it explain enough for you to understand what you&#39;re seeing here?"}, {"owner": {"reputation": 35444, "user_id": 656912, "user_type": "registered", "accept_rate": 66, "profile_image": "https://www.gravatar.com/avatar/ce95c01cbd4f90f014d988ae5c8a422d?s=128&d=identicon&r=PG", "display_name": "orome", "link": "https://stackoverflow.com/users/656912/orome"}, "reply_to_user": {"reputation": 126897, "user_id": 791604, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/ce991df7a056248d5e4f6fc3659ba733?s=128&d=identicon&r=PG", "display_name": "Daniel Wagner", "link": "https://stackoverflow.com/users/791604/daniel-wagner"}, "edited": false, "score": 0, "creation_date": 1442957534, "post_id": 32726855, "comment_id": 53296942, "body": "@DanielWagner: Yes, that does it!"}], "owner": {"reputation": 35444, "user_id": 656912, "user_type": "registered", "accept_rate": 66, "profile_image": "https://www.gravatar.com/avatar/ce95c01cbd4f90f014d988ae5c8a422d?s=128&d=identicon&r=PG", "display_name": "orome", "link": "https://stackoverflow.com/users/656912/orome"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 46, "favorite_count": 0, "closed_date": 1442957574, "answer_count": 0, "score": 0, "last_activity_date": 1442955710, "creation_date": 1442955710, "question_id": 32726855, "link": "https://stackoverflow.com/questions/32726855/is-there-a-way-to-always-see-the-glyphs-for-unicode-characters-in-haskell", "closed_reason": "Duplicate", "title": "Is there a way to always see the glyphs for Unicode characters in Haskell?", "body": "<p>Why do I sometimes fail to see the Unicode representation of characters in Haskell. For example I get</p>\n\n<pre><code>ghci&gt;let b = \"\u03b2\"\nghci&gt;print b\n\"\\946\"\nghci&gt;putStr b\n\u03b2\n</code></pre>\n\n<p>Is there a way to always get <code>\u03b2</code>? Are Unicode characters always represented as character code strings, and \"converted\" to glyphs by some functions (e.g. <code>putStr</code>; others perhaps)?</p>\n"}, {"tags": ["haskell", "haddock"], "answers": [{"comments": [{"owner": {"reputation": 35444, "user_id": 656912, "user_type": "registered", "accept_rate": 66, "profile_image": "https://www.gravatar.com/avatar/ce95c01cbd4f90f014d988ae5c8a422d?s=128&d=identicon&r=PG", "display_name": "orome", "link": "https://stackoverflow.com/users/656912/orome"}, "edited": false, "score": 0, "creation_date": 1442955768, "post_id": 32726843, "comment_id": 53296106, "body": "Excellent, thanks! A good model of &quot;done right&quot; is very helpful."}], "tags": [], "owner": {"reputation": 31243, "user_id": 2751851, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/4ddc0.png?s=128&g=1", "display_name": "duplode", "link": "https://stackoverflow.com/users/2751851/duplode"}, "is_accepted": true, "score": 7, "last_activity_date": 1442957649, "last_edit_date": 1442957649, "creation_date": 1442955637, "answer_id": 32726843, "question_id": 32726594, "link": "https://stackoverflow.com/questions/32726594/should-i-use-let-in-my-repl-haddock-examples/32726843#32726843", "title": "Should I use &#39;let&#39; in my REPL Haddock examples?", "body": "<p>I believe you should write your snippets for GHCi, which <em>de facto</em> is the standard REPL. As it stands, that means using <code>let</code>. Somewhat arbitrary example: <a href=\"https://hackage.haskell.org/package/foldl-1.1.1/docs/Control-Foldl.html\" rel=\"nofollow\"><code>Control.Foldl</code> documentation</a> (libraries by Gabriel Gonzalez provide good examples of \"haddocks done right\"). </p>\n"}], "owner": {"reputation": 35444, "user_id": 656912, "user_type": "registered", "accept_rate": 66, "profile_image": "https://www.gravatar.com/avatar/ce95c01cbd4f90f014d988ae5c8a422d?s=128&d=identicon&r=PG", "display_name": "orome", "link": "https://stackoverflow.com/users/656912/orome"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 75, "favorite_count": 0, "accepted_answer_id": 32726843, "answer_count": 1, "score": 2, "last_activity_date": 1442957649, "creation_date": 1442954830, "question_id": 32726594, "link": "https://stackoverflow.com/questions/32726594/should-i-use-let-in-my-repl-haddock-examples", "title": "Should I use &#39;let&#39; in my REPL Haddock examples?", "body": "<p>What is the correct idiom for assignments in <a href=\"https://www.haskell.org/haddock/doc/html/ch03s08.html#idm140354810775744\" rel=\"nofollow\">Haddock REPL examples</a>? Specifically, should I use <code>let</code> </p>\n\n<pre><code>&gt;&gt;&gt; let x = 5\n&gt;&gt;&gt; x + 2\n7\n</code></pre>\n\n<p>(as is \u2014 still \u2014\u00a0expected by GHCi) or omit it </p>\n\n<pre><code>&gt;&gt;&gt; x = 5\n&gt;&gt;&gt; x + 2\n7\n</code></pre>\n\n<p>(as I can in IHaskell)?</p>\n"}, {"tags": ["css", "haskell", "haddock"], "comments": [{"owner": {"reputation": 313, "user_id": 4375436, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/42bf13a66826489c4590b44e9a1f1e95?s=128&d=identicon&r=PG", "display_name": "Tim Ellison", "link": "https://stackoverflow.com/users/4375436/tim-ellison"}, "edited": false, "score": 2, "creation_date": 1600172323, "post_id": 32725800, "comment_id": 112998464, "body": "Try &quot;theme&quot;? <a href=\"https://haskell-haddock.readthedocs.io/en/latest/invoking.html#cmdoption-theme\" rel=\"nofollow noreferrer\">haskell-haddock.readthedocs.io/en/latest/&hellip;</a>"}], "answers": [{"comments": [{"owner": {"reputation": 35444, "user_id": 656912, "user_type": "registered", "accept_rate": 66, "profile_image": "https://www.gravatar.com/avatar/ce95c01cbd4f90f014d988ae5c8a422d?s=128&d=identicon&r=PG", "display_name": "orome", "link": "https://stackoverflow.com/users/656912/orome"}, "edited": false, "score": 0, "creation_date": 1600705936, "post_id": 63993299, "comment_id": 113165446, "body": "That seems to do the trick locally, but how do I enforce that on <a href=\"https://hackage.haskell.org/package/crypto-enigma-0.1.1.6/docs/Crypto-Enigma.html\" rel=\"nofollow noreferrer\">Hackage</a> and <a href=\"https://www.stackage.org/haddock/lts-16.15/crypto-enigma-0.1.1.6/Crypto-Enigma.html\" rel=\"nofollow noreferrer\">Stackage</a>? I don&#39;t see where I can specify <code>--theme</code> for either."}], "tags": [], "owner": {"reputation": 1064, "user_id": 12153248, "user_type": "registered", "profile_image": "https://lh3.googleusercontent.com/-f7ubefVLzQg/AAAAAAAAAAI/AAAAAAAAAAA/ACHi3rdOhhV81djlo9daQq8Jy-mYdaQz5A/photo.jpg?sz=128", "display_name": "Ari Fordsham", "link": "https://stackoverflow.com/users/12153248/ari-fordsham"}, "is_accepted": true, "score": 1, "last_activity_date": 1600694921, "creation_date": 1600694921, "answer_id": 63993299, "question_id": 32725800, "link": "https://stackoverflow.com/questions/32725800/how-do-i-get-a-style-menu-in-my-haddock-documentation/63993299#63993299", "title": "How do I get a &quot;Style&quot; menu in my Haddock documentation?", "body": "<p>This feature is implemented with the <code>--theme</code> flag to Haddock: <a href=\"https://haskell-haddock.readthedocs.io/en/latest/invoking.html#cmdoption-theme\" rel=\"nofollow noreferrer\">https://haskell-haddock.readthedocs.io/en/latest/invoking.html#cmdoption-theme</a></p>\n"}], "owner": {"reputation": 35444, "user_id": 656912, "user_type": "registered", "accept_rate": 66, "profile_image": "https://www.gravatar.com/avatar/ce95c01cbd4f90f014d988ae5c8a422d?s=128&d=identicon&r=PG", "display_name": "orome", "link": "https://stackoverflow.com/users/656912/orome"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 289, "favorite_count": 1, "accepted_answer_id": 63993299, "answer_count": 1, "score": 13, "last_activity_date": 1600694921, "creation_date": 1442952091, "last_edit_date": 1560816540, "question_id": 32725800, "link": "https://stackoverflow.com/questions/32725800/how-do-i-get-a-style-menu-in-my-haddock-documentation", "title": "How do I get a &quot;Style&quot; menu in my Haddock documentation?", "body": "<p>Some packages (the Haddock documentation for example <a href=\"http://hackage.haskell.org/package/hS3-0.5.8/docs/Data-String-Utils.html\" rel=\"nofollow noreferrer\">Data.String.Utils</a>) have a menubar that includes a \"Style\" menu that allows choosing among styles used to display the documentation:</p>\n\n<p><a href=\"https://i.stack.imgur.com/Z0QRN.png\" rel=\"nofollow noreferrer\"><img src=\"https://i.stack.imgur.com/Z0QRN.png\" alt=\"enter image description here\"></a></p>\n\n<p>How do I get this menu in the documentation for my own packages? What setting should I use to include it, and how do I specify which styles are offered?</p>\n\n<p>I've tried things like</p>\n\n<pre><code>haddock\n  -- ...\n  css: /path/to/mystuff.css, Default, Ocean\n  -- ...\n</code></pre>\n\n<p>and </p>\n\n<pre><code>haddock\n\n  -- ...\n  css: Default\n  css: Ocean\n  css: /path/to/mystuff.css\n  -- ...\n</code></pre>\n\n<p>In my <code>~/.cabal/config</code>; but the former fails and the latter just formats using the last-listed <code>css</code> entry, with no \"Style\" menu.</p>\n"}, {"tags": ["debugging", "haskell"], "comments": [{"owner": {"reputation": 84731, "user_id": 510937, "user_type": "registered", "accept_rate": 80, "profile_image": "https://www.gravatar.com/avatar/70b13a9ae1aae1ca1aa6ac8dab4643f2?s=128&d=identicon&r=PG", "display_name": "Bakuriu", "link": "https://stackoverflow.com/users/510937/bakuriu"}, "edited": false, "score": 1, "creation_date": 1442949010, "post_id": 32724534, "comment_id": 53292456, "body": "When you say that you tried to generate trees by hand but you were unable to identify the bug you mean that you didn&#39;t get any error or that you did get the error but you were unable to understand why you got the error with that tree? In the latter case please provide the inputs you tried."}, {"owner": {"reputation": 2282, "user_id": 1035792, "user_type": "registered", "accept_rate": 81, "profile_image": "https://i.stack.imgur.com/cQjEY.png?s=128&g=1", "display_name": "gsscoder", "link": "https://stackoverflow.com/users/1035792/gsscoder"}, "reply_to_user": {"reputation": 84731, "user_id": 510937, "user_type": "registered", "accept_rate": 80, "profile_image": "https://www.gravatar.com/avatar/70b13a9ae1aae1ca1aa6ac8dab4643f2?s=128&d=identicon&r=PG", "display_name": "Bakuriu", "link": "https://stackoverflow.com/users/510937/bakuriu"}, "edited": false, "score": 0, "creation_date": 1442987031, "post_id": 32724534, "comment_id": 53305013, "body": "@Bakuriu, I&#39;ve tried composing the tree like <code>let e = Sum (Constant (Well VariableY))</code> or <code>e &lt;- gen X</code> (where X is normally 10, 20 ... 50)` and than <code>f &lt;- eval e. This allowed me to test </code>f` typing: <code>f(3.2, 0,34)</code> in <b>GHCi</b>."}], "answers": [{"comments": [{"owner": {"reputation": 17809, "user_id": 1088108, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/63781cd38e91aa346a3849bc3ef3e550?s=128&d=identicon&r=PG&f=1", "display_name": "&#216;rjan Johansen", "link": "https://stackoverflow.com/users/1088108/%c3%98rjan-johansen"}, "edited": false, "score": 3, "creation_date": 1442963347, "post_id": 32725021, "comment_id": 53299078, "body": "Small caveat: <code>(&#47;0)</code> is perfectly capable of raising that error if you use it on <code>Rational</code> rather than floating point. Although in this case the OP doesn&#39;t seem to be using <code>Rational</code> except indirectly through <code>mod&#39;</code>."}, {"owner": {"reputation": 2282, "user_id": 1035792, "user_type": "registered", "accept_rate": 81, "profile_image": "https://i.stack.imgur.com/cQjEY.png?s=128&g=1", "display_name": "gsscoder", "link": "https://stackoverflow.com/users/1035792/gsscoder"}, "edited": false, "score": 0, "creation_date": 1442987237, "post_id": 32725021, "comment_id": 53305094, "body": "@Zeta, +1 and this answers. At this point what this the more correct way to fix this bug? Just prevents that <code>mod&#39;</code> is applied with a second argument equal to <code>0</code>?"}, {"owner": {"reputation": 94713, "user_id": 1139697, "user_type": "registered", "accept_rate": 86, "profile_image": "https://www.gravatar.com/avatar/5f136ddb684f39aaee1c028ee1950f6f?s=128&d=identicon&r=PG", "display_name": "Zeta", "link": "https://stackoverflow.com/users/1139697/zeta"}, "reply_to_user": {"reputation": 17809, "user_id": 1088108, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/63781cd38e91aa346a3849bc3ef3e550?s=128&d=identicon&r=PG&f=1", "display_name": "&#216;rjan Johansen", "link": "https://stackoverflow.com/users/1088108/%c3%98rjan-johansen"}, "edited": false, "score": 1, "creation_date": 1442987238, "post_id": 32725021, "comment_id": 53305095, "body": "@&#216;rjanJohansen True. After all, <code>mod&#39;</code> uses <code>&#47;</code> on <code>Rational</code> via <code>div&#39;</code>."}, {"owner": {"reputation": 2282, "user_id": 1035792, "user_type": "registered", "accept_rate": 81, "profile_image": "https://i.stack.imgur.com/cQjEY.png?s=128&g=1", "display_name": "gsscoder", "link": "https://stackoverflow.com/users/1035792/gsscoder"}, "reply_to_user": {"reputation": 17809, "user_id": 1088108, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/63781cd38e91aa346a3849bc3ef3e550?s=128&d=identicon&r=PG&f=1", "display_name": "&#216;rjan Johansen", "link": "https://stackoverflow.com/users/1088108/%c3%98rjan-johansen"}, "edited": false, "score": 0, "creation_date": 1442987480, "post_id": 32725021, "comment_id": 53305180, "body": "@&#216;rjanJohansen: +1 for further clarification on <code>mod&#39;</code> and <code>Rational</code>."}, {"owner": {"reputation": 2282, "user_id": 1035792, "user_type": "registered", "accept_rate": 81, "profile_image": "https://i.stack.imgur.com/cQjEY.png?s=128&g=1", "display_name": "gsscoder", "link": "https://stackoverflow.com/users/1035792/gsscoder"}, "edited": false, "score": 0, "creation_date": 1442988084, "post_id": 32725021, "comment_id": 53305420, "body": "@Zeta, what do you mean with alternative <code>mod&#39;</code> variant? To what variant you&#39;re referring? The one in your post?"}, {"owner": {"reputation": 94713, "user_id": 1139697, "user_type": "registered", "accept_rate": 86, "profile_image": "https://www.gravatar.com/avatar/5f136ddb684f39aaee1c028ee1950f6f?s=128&d=identicon&r=PG", "display_name": "Zeta", "link": "https://stackoverflow.com/users/1139697/zeta"}, "reply_to_user": {"reputation": 2282, "user_id": 1035792, "user_type": "registered", "accept_rate": 81, "profile_image": "https://i.stack.imgur.com/cQjEY.png?s=128&g=1", "display_name": "gsscoder", "link": "https://stackoverflow.com/users/1035792/gsscoder"}, "edited": false, "score": 1, "creation_date": 1442988641, "post_id": 32725021, "comment_id": 53305659, "body": "@gsscoder: Finally had some coffee, I wrote my answer yesterday just before I went to bed. I&#39;ve checked some things, and you actually use <code>mod&#39; a 0</code> somewhere, where I thought you used <code>mod&#39; a someVerySmallValueCloseToZero</code>. This is the actual source of your error, sorry for the confusion. Basically, <code>mod a 0</code> doesn&#39;t make sense from a mathematical point of view."}, {"owner": {"reputation": 2282, "user_id": 1035792, "user_type": "registered", "accept_rate": 81, "profile_image": "https://i.stack.imgur.com/cQjEY.png?s=128&g=1", "display_name": "gsscoder", "link": "https://stackoverflow.com/users/1035792/gsscoder"}, "edited": false, "score": 0, "creation_date": 1442988726, "post_id": 32725021, "comment_id": 53305705, "body": "I want to add that it finally works, as soon I&#39;ll add the 1..1000 loop to generate more images. Now I post to Gist the fixed code. Thansk to everyone helped and explained."}, {"owner": {"reputation": 2282, "user_id": 1035792, "user_type": "registered", "accept_rate": 81, "profile_image": "https://i.stack.imgur.com/cQjEY.png?s=128&g=1", "display_name": "gsscoder", "link": "https://stackoverflow.com/users/1035792/gsscoder"}, "edited": false, "score": 0, "creation_date": 1443010429, "post_id": 32725021, "comment_id": 53319094, "body": "@Zeta, but my implementation is a port of <b>F#</b>... Also the <b>F#</b> version has this problem? Because now I can generate one image with <code>gen 50</code>."}], "tags": [], "owner": {"reputation": 94713, "user_id": 1139697, "user_type": "registered", "accept_rate": 86, "profile_image": "https://www.gravatar.com/avatar/5f136ddb684f39aaee1c028ee1950f6f?s=128&d=identicon&r=PG", "display_name": "Zeta", "link": "https://stackoverflow.com/users/1139697/zeta"}, "is_accepted": true, "score": 6, "last_activity_date": 1442988553, "last_edit_date": 1442988553, "creation_date": 1442949155, "answer_id": 32725021, "question_id": 32724534, "link": "https://stackoverflow.com/questions/32724534/find-the-origin-of-ratio-has-zero-denominator-exception/32725021#32725021", "title": "Find the origin of &quot;Ratio has zero denominator&quot; Exception", "body": "<h1>The exception</h1>\n\n<p>Let's focus on the exception first.</p>\n\n<h2>Finding the bug</h2>\n\n<blockquote>\n  <p>where's is the bug (in this specific case)?</p>\n</blockquote>\n\n<p>In <code>mod'</code>. We can check this easily if we provide an alternative version instead of the one by <code>Data.Fixed</code>:</p>\n\n<pre><code>mod' :: RealFrac a =&gt; a -&gt; a -&gt; a\nmod' _ 0 = error \"Used mod' on 0\"\nmod' a b =\n    let k = floor $ a / b\n    in a - (fromInteger k) * b\n</code></pre>\n\n<p>We now get <code>Used mod' on 0</code>.</p>\n\n<h2>Rationale</h2>\n\n<blockquote>\n  <p>which tool do I need to master to find bugs like this (or bugs in general)?</p>\n</blockquote>\n\n<p>In this case, the necessary hint was already in the exception's message:</p>\n\n<blockquote>\n<pre><code>Ratio has zero denominator\n</code></pre>\n</blockquote>\n\n<p>This means that there's a place where you divide by zero in the context of a <a href=\"http://hackage.haskell.org/package/base-4.8.1.0/docs/Data-Ratio.html#t:Ratio\" rel=\"nofollow\"><code>Ratio</code></a>. So you need to look after all places where you divide something. Since you use only <code>(/)</code> and <code>mod'</code>, it boils down to whether one of them actually <em>can</em> throw this exception:</p>\n\n<ul>\n<li><code>(/)</code> usually returns <code>\u00b1Infinity</code> on division by zero if used on <code>Double</code>,</li>\n<li><code>mod'</code> uses <code>toRational</code> internally, which is a <code>Ratio Integer</code>.</li>\n</ul>\n\n<p>So there's only one culprit left. Note that the other implementation yields the same results if <code>b</code> isn't zero.</p>\n\n<h1>The <em>actual</em> problem</h1>\n\n<p>Using <code>mod</code> or <code>mod'</code> with <code>b == 0</code> isn't well-defined. After all, a <a href=\"https://en.wikipedia.org/wiki/Modulo_operation\" rel=\"nofollow\">modulo operation</a> should hold the following property:</p>\n\n<pre><code>prop_mod :: Integral n =&gt; n -&gt; n -&gt; Bool\nprop_mod a b = \n  let m = a `mod` b\n      d = a `div` b\n\n  in a == b * d + m   -- (1)\n     &amp;&amp; abs m &lt; abs b -- (2)\n</code></pre>\n\n<p>If <code>b == 0</code>, there doesn't exist any pair <code>(d, m)</code> such that (1) <strong>and</strong> (2) hold. If we relax this law and throw (2) away, the result of <code>mod</code> isn't necessarily unique anymore. This leads to the following definition:</p>\n\n<pre><code>mod' :: RealFrac a =&gt; a -&gt; a -&gt; a\nmod' a 0 = a -- this is arbitrary\nmod' a b =\n    let k = floor $ a / b\n    in a - (fromInteger k) * b\n</code></pre>\n\n<p>However, this is an arbitrary definition. You have to ask yourself, \"What do I actually want to do if I cannot use <code>mod</code> in a sane way\". Since F# apparently didn't complain about <code>a % 0</code>, have a look at their documentation.</p>\n\n<p>Either way, you cannot use a library <code>mod</code> function, since they aren't defined for a zero denominator.</p>\n"}], "owner": {"reputation": 2282, "user_id": 1035792, "user_type": "registered", "accept_rate": 81, "profile_image": "https://i.stack.imgur.com/cQjEY.png?s=128&g=1", "display_name": "gsscoder", "link": "https://stackoverflow.com/users/1035792/gsscoder"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 364, "favorite_count": 0, "accepted_answer_id": 32725021, "answer_count": 1, "score": 5, "last_activity_date": 1442988553, "creation_date": 1442947406, "last_edit_date": 1442947717, "question_id": 32724534, "link": "https://stackoverflow.com/questions/32724534/find-the-origin-of-ratio-has-zero-denominator-exception", "title": "Find the origin of &quot;Ratio has zero denominator&quot; Exception", "body": "<p>As a personal excercize in the process of learning <strong>Haskell</strong>, I'm trying to port this <strong>F#</strong> snippet for <a href=\"http://fssnip.net/si\" rel=\"noreferrer\">Random Art</a>.</p>\n\n<p>I've not embedded full source code for not bloating the question, but is available as <a href=\"https://gist.github.com/gsscoder/20a88f635ad8cb25d9d1\" rel=\"noreferrer\">gist</a>.</p>\n\n<p>An important part of the program is this <code>Expr</code> type:</p>\n\n<pre><code>\ndata Expr =\n    VariableX\n  | VariableY\n  | Constant\n  | Sum Expr Expr\n  | Product Expr Expr\n  | Mod Expr Expr\n  | Well Expr\n  | Tent Expr\n  | Sin Expr\n  | Level Expr Expr Expr\n  | Mix Expr Expr Expr\n  deriving Show\n</code></pre>\n\n<p>and two functions:</p>\n\n<ul>\n<li><p><code>gen :: Int -&gt; IO Expr</code> random generates a <em>tree-like</em> structure given a number of iterations</p></li>\n<li><p><code>eval :: Expr -&gt; IO (Point -&gt; Rgb Double)</code> walks the tree and terminates producing a drawing function.</p></li>\n</ul>\n\n<p>More high is the number passed to <code>gen</code>\u00a0than higher are the probability that the following exception is generated: <code>Ratio has zero denominator</code>.</p>\n\n<p>I'm new to Haskell so to solve the problem I've tried to compile it as above:</p>\n\n<pre><code>\nghc RandomArt.hs -prof -auto-all -caf-all\n</code></pre>\n\n<p>Obtaining only this more (to me quite useless) info:</p>\n\n<pre><code>\n$ ./RandomArt +RTS -xc\n\n*** Exception (reporting due to +RTS -xc): (THUNK_STATIC), stack trace:\n  GHC.Real.CAF\n  --> evaluated by: Main.eval.\\,\n  called from Main.eval,\n  called from Main.tga.pxs',\n  called from Main.tga,\n  called from Main.save,\n  called from Main.main,\n  called from :Main.CAF:main\n  --> evaluated by: Main.eval.\\.r,\n  called from Main.eval.\\,\n  called from Main.eval,\n  called from Main.tga.pxs',\n  called from Main.tga,\n  called from Main.save,\n  called from Main.main,\n  called from :Main.CAF:main\n*** Exception (reporting due to +RTS -xc): (THUNK_STATIC), stack trace:\n  Main.tga,\n  called from Main.save,\n  called from Main.main,\n  called from GHC.Real.CAF\nRandomArt: Ratio has zero denominator\n</code></pre>\n\n<p>The code that persist the generated function to a <strong>TGA</strong> file works because it was my <a href=\"https://gist.github.com/gsscoder/41df52d9b2f9c29f29f7\" rel=\"noreferrer\">previous excercize</a> (a port from <strong>OCaml</strong>).</p>\n\n<p>I've tried executing various <code>Expr</code> tree from <strong>GHCi</strong>, assembling data by <em>hand</em> or applying functions as in the program but I wasn't able to identify the bug.</p>\n\n<p>Haskell docs talks about a package named <code>loch</code> that should able to compile preserving source code line numbers, but I was not able to install it (while I normally install with <code>cabal install</code> every package I need).</p>\n\n<p>The question, to be honest are two:</p>\n\n<ul>\n<li><p>where's is the bug (in this specific case)?</p></li>\n<li><p>which tool do I need to master to find bugs like this (or bugs in general)?</p></li>\n</ul>\n\n<p>Thanks in advance.</p>\n"}, {"tags": ["haskell", "sandbox", "cabal"], "comments": [{"owner": {"reputation": 44013, "user_id": 1477667, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/trgKM.jpg?s=128&g=1", "display_name": "dfeuer", "link": "https://stackoverflow.com/users/1477667/dfeuer"}, "edited": false, "score": 0, "creation_date": 1442947242, "post_id": 32724130, "comment_id": 53291482, "body": "What version of GHC are you running?"}, {"owner": {"reputation": 31243, "user_id": 2751851, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/4ddc0.png?s=128&g=1", "display_name": "duplode", "link": "https://stackoverflow.com/users/2751851/duplode"}, "edited": false, "score": 0, "creation_date": 1442947802, "post_id": 32724130, "comment_id": 53291781, "body": "You don&#39;t need to download a tarball from Hackage to install packages in a sandbox. Just do <code>cabal sandbox init</code> to create the sandbox and then <code>cabal install gloss-examples</code> (or whatever else you want) from the same directory."}, {"owner": {"reputation": 44013, "user_id": 1477667, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/trgKM.jpg?s=128&g=1", "display_name": "dfeuer", "link": "https://stackoverflow.com/users/1477667/dfeuer"}, "reply_to_user": {"reputation": 31243, "user_id": 2751851, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/4ddc0.png?s=128&g=1", "display_name": "duplode", "link": "https://stackoverflow.com/users/2751851/duplode"}, "edited": false, "score": 1, "creation_date": 1442948375, "post_id": 32724130, "comment_id": 53292108, "body": "@duplode, from the fact that they want an examples package, I guessed they may want to set up a sandbox for dependencies and then build the package with various modifications rather than installing it."}, {"owner": {"reputation": 31243, "user_id": 2751851, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/4ddc0.png?s=128&g=1", "display_name": "duplode", "link": "https://stackoverflow.com/users/2751851/duplode"}, "reply_to_user": {"reputation": 44013, "user_id": 1477667, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/trgKM.jpg?s=128&g=1", "display_name": "dfeuer", "link": "https://stackoverflow.com/users/1477667/dfeuer"}, "edited": false, "score": 0, "creation_date": 1442948611, "post_id": 32724130, "comment_id": 53292249, "body": "@dfeuer Yup, that makes sense."}, {"owner": {"reputation": 845, "user_id": 4725700, "user_type": "registered", "accept_rate": 72, "profile_image": "https://www.gravatar.com/avatar/b517b68a2f6eee6dc160661a0e78e4ce?s=128&d=identicon&r=PG&f=1", "display_name": "mntk123", "link": "https://stackoverflow.com/users/4725700/mntk123"}, "edited": false, "score": 0, "creation_date": 1442970770, "post_id": 32724130, "comment_id": 53300954, "body": "I am using GHC 7-4.1"}, {"owner": {"reputation": 44013, "user_id": 1477667, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/trgKM.jpg?s=128&g=1", "display_name": "dfeuer", "link": "https://stackoverflow.com/users/1477667/dfeuer"}, "edited": false, "score": 0, "creation_date": 1442974621, "post_id": 32724130, "comment_id": 53301810, "body": "That is a pretty old version. The latest version is 7.10.2. You should probably upgrade."}], "answers": [{"comments": [{"owner": {"reputation": 845, "user_id": 4725700, "user_type": "registered", "accept_rate": 72, "profile_image": "https://www.gravatar.com/avatar/b517b68a2f6eee6dc160661a0e78e4ce?s=128&d=identicon&r=PG&f=1", "display_name": "mntk123", "link": "https://stackoverflow.com/users/4725700/mntk123"}, "edited": false, "score": 0, "creation_date": 1442970718, "post_id": 32724583, "comment_id": 53300944, "body": "thanks for pointing out the <code>base</code> dependency. Is it only <code>base</code> or what other dependencies are hardwired in GHC?"}, {"owner": {"reputation": 44013, "user_id": 1477667, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/trgKM.jpg?s=128&g=1", "display_name": "dfeuer", "link": "https://stackoverflow.com/users/1477667/dfeuer"}, "reply_to_user": {"reputation": 845, "user_id": 4725700, "user_type": "registered", "accept_rate": 72, "profile_image": "https://www.gravatar.com/avatar/b517b68a2f6eee6dc160661a0e78e4ce?s=128&d=identicon&r=PG&f=1", "display_name": "mntk123", "link": "https://stackoverflow.com/users/4725700/mntk123"}, "edited": false, "score": 0, "creation_date": 1442975132, "post_id": 32724583, "comment_id": 53301910, "body": "@mntk123, I&#39;m not entirely sure. <code>base</code> isn&#39;t actually completely hard-wired, I don&#39;t think, but it&#39;s pretty tightly tied in&amp;mdash;it depends on enough subtle details that it&#39;s highly unlikely that two major versions of <code>base</code> will each work with any given major version of GHC (e.g., base 4.7 goes with GHC 7.8; base 4.8 goes with GHC 7.10), and there could even be problems between minor versions. The most hard-wired package is <code>ghc-prim</code>, which should be seen as <i>part</i> of the compiler."}, {"owner": {"reputation": 44013, "user_id": 1477667, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/trgKM.jpg?s=128&g=1", "display_name": "dfeuer", "link": "https://stackoverflow.com/users/1477667/dfeuer"}, "reply_to_user": {"reputation": 845, "user_id": 4725700, "user_type": "registered", "accept_rate": 72, "profile_image": "https://www.gravatar.com/avatar/b517b68a2f6eee6dc160661a0e78e4ce?s=128&d=identicon&r=PG&f=1", "display_name": "mntk123", "link": "https://stackoverflow.com/users/4725700/mntk123"}, "edited": false, "score": 0, "creation_date": 1442975357, "post_id": 32724583, "comment_id": 53301958, "body": "The <code>containers</code> package is pretty tightly tied in too, at least for some purposes, because the <code>ghc</code> package (yep, that&#39;s also pretty tight) exposes some compiler structures as containers (as I understand it). There may be others."}], "tags": [], "owner": {"reputation": 44013, "user_id": 1477667, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/trgKM.jpg?s=128&g=1", "display_name": "dfeuer", "link": "https://stackoverflow.com/users/1477667/dfeuer"}, "is_accepted": true, "score": 2, "last_activity_date": 1442947870, "last_edit_date": 1442947870, "creation_date": 1442947579, "answer_id": 32724583, "question_id": 32724130, "link": "https://stackoverflow.com/questions/32724130/haskell-cabal-sandbox-how-to-install-packages/32724583#32724583", "title": "haskell cabal sandbox how to install packages?", "body": "<p>It appears to me that you have downloaded a version of <code>gloss-examples</code> that is not compatible with your version of the <code>base</code> library. There are two ways to fix this:</p>\n\n<ol>\n<li><p>Download a version (presumably an older one) that is compatible with your <code>base</code> library. <a href=\"https://hackage.haskell.org/package/gloss-examples\" rel=\"nofollow\">The contents page for the package on Hackage</a> has a long list of available versions near the top. It may also be possible to use <code>cabal fetch</code> to do this&mdash;I'm not sure.</p></li>\n<li><p>Upgrade GHC to get a newer <code>base</code>. You generally cannot upgrade <code>base</code> without upgrading GHC.</p></li>\n</ol>\n"}], "owner": {"reputation": 845, "user_id": 4725700, "user_type": "registered", "accept_rate": 72, "profile_image": "https://www.gravatar.com/avatar/b517b68a2f6eee6dc160661a0e78e4ce?s=128&d=identicon&r=PG&f=1", "display_name": "mntk123", "link": "https://stackoverflow.com/users/4725700/mntk123"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 1413, "favorite_count": 0, "accepted_answer_id": 32724583, "answer_count": 1, "score": 1, "last_activity_date": 1442947870, "creation_date": 1442946103, "question_id": 32724130, "link": "https://stackoverflow.com/questions/32724130/haskell-cabal-sandbox-how-to-install-packages", "title": "haskell cabal sandbox how to install packages?", "body": "<p>I wish if someone tells me the steps required to install <code>gloss-examples</code> in a sandbox along with all its dependencies.\nHere is what I tried to do:</p>\n\n<p>I downloaded the <code>gloss-examples</code> package from <a href=\"https://hackage.haskell.org/package/gloss-examples-1.9.4.1/gloss-examples-1.9.4.1.tar.gz\" rel=\"nofollow\">hackage</a>.</p>\n\n<p>When I ran the command, after changing into the <code>~/gloss/gloss-examples-1.9.4.1</code></p>\n\n<pre><code>~/gloss/gloss-examples-1.9.4.1$cabal sandbox init\n</code></pre>\n\n<p>it succeeded, so I issued the command</p>\n\n<pre><code>~/gloss/gloss-examples-1.9.4.1$cabal install --only-dependencies\n</code></pre>\n\n<p>but then I got the following errors:</p>\n\n<pre><code>Resolving dependencies...\ncabal: Could not resolve dependencies:\ntrying: gloss-examples-1.9.4.1 (user goal)\nnext goal: base (dependency of gloss-examples-1.9.4.1)\nrejecting: base-4.5.0.0/installed-c8e... (conflict: gloss-examples =&gt;\nbase==4.8.*)\nrejecting: base-4.8.1.0, base-4.8.0.0, base-4.7.0.2, base-4.7.0.1,\nbase-4.7.0.0, base-4.6.0.1, base-4.6.0.0, base-4.5.1.0, base-4.5.0.0,\nbase-4.4.1.0, base-4.4.0.0, base-4.3.1.0, base-4.3.0.0, base-4.2.0.2,\nbase-4.2.0.1, base-4.2.0.0, base-4.1.0.0, base-4.0.0.0, base-3.0.3.2,\nbase-3.0.3.1 (constraint from non-upgradeable package requires installed\ninstance)\nDependency tree exhaustively searched.\n\nNote: when using a sandbox, all packages are required to have consistent\ndependencies. Try reinstalling/unregistering the offending packages or\nrecreating the sandbox.\n</code></pre>\n\n<p>How do I install this package <code>gloss-examples</code> and all its dependencies in the sandbox directory only? I think I understand that cabal sandbox allows you to install any arbitrary package with all dependencies (some or all them conflicting with globally installed packages) installed in a separate directory. \nIs this even possible?\nI think I am missing something. Is this a right use-case for cabal sandbox?\nSeeing the following </p>\n\n<p><code>Note: when using a sandbox, all packages are required to have consistent dependencies.</code></p>\n\n<p>Is there a difference between <code>conflicting dependencies</code> and <code>not consistent dependencies</code>?</p>\n\n<p>I tried many tutorials including <a href=\"http://coldwa.st/e/blog/2013-08-20-Cabal-sandbox.html\" rel=\"nofollow\">this</a> but could not understand how to use cabal sandbox.</p>\n"}, {"tags": ["haskell", "xor", "bytestring"], "comments": [{"owner": {"reputation": 58792, "user_id": 1006010, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/f683d229f3673c9dcc3f3f2796d75c09?s=128&d=identicon&r=PG", "display_name": "MathematicalOrchid", "link": "https://stackoverflow.com/users/1006010/mathematicalorchid"}, "edited": false, "score": 1, "creation_date": 1442936145, "post_id": 32720849, "comment_id": 53284546, "body": "Any specific reason why bytestring, rather than a mutable array or an unboxed vector or something?"}, {"owner": {"reputation": 43, "user_id": 5300933, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/4957584b608b4adae0fa131d8c2fed46?s=128&d=identicon&r=PG&f=1", "display_name": "Kirill Nesterov", "link": "https://stackoverflow.com/users/5300933/kirill-nesterov"}, "reply_to_user": {"reputation": 58792, "user_id": 1006010, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/f683d229f3673c9dcc3f3f2796d75c09?s=128&d=identicon&r=PG", "display_name": "MathematicalOrchid", "link": "https://stackoverflow.com/users/1006010/mathematicalorchid"}, "edited": false, "score": 0, "creation_date": 1442936614, "post_id": 32720849, "comment_id": 53284864, "body": "I&#39;m working with multiple data structures which contains lazy ByteString, so I&#39;m trying to generalize mutation of their parts. It will be pretty difficult to rewrite all of them."}, {"owner": {"reputation": 23444, "user_id": 414413, "user_type": "registered", "accept_rate": 79, "profile_image": "https://www.gravatar.com/avatar/6de2113f01432aa844dc85070ff33e89?s=128&d=identicon&r=PG", "display_name": "Cirdec", "link": "https://stackoverflow.com/users/414413/cirdec"}, "edited": false, "score": 5, "creation_date": 1442937246, "post_id": 32720849, "comment_id": 53285331, "body": "If you are using lazy bytestrings, trust the garbage collector on this one. The chunks of the lazy bytestring will be deallocated if you don&#39;t need them anymore because they aren&#39;t referenced elsewhere, which is exactly when mutating them would be safe. Just be sure to avoid hanging on to references to the entire original bytestring or structures that hold the entire original bytestrings."}, {"owner": {"reputation": 44013, "user_id": 1477667, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/trgKM.jpg?s=128&g=1", "display_name": "dfeuer", "link": "https://stackoverflow.com/users/1477667/dfeuer"}, "edited": false, "score": 0, "creation_date": 1442938989, "post_id": 32720849, "comment_id": 53286459, "body": "<code>ByteString</code> isn&#39;t really designed for mutation. There are tricks you can play with <a href=\"https://hackage.haskell.org/package/bytestring/docs/Data-ByteString-Unsafe.html\" rel=\"nofollow noreferrer\">unsafe bytestring operations</a> but you probably shouldn&#39;t."}, {"owner": {"reputation": 62421, "user_id": 216164, "user_type": "registered", "accept_rate": 89, "profile_image": "https://www.gravatar.com/avatar/786f224adbe0784cdf7d0f15476061fe?s=128&d=identicon&r=PG", "display_name": "Thomas M. DuBuisson", "link": "https://stackoverflow.com/users/216164/thomas-m-dubuisson"}, "edited": false, "score": 0, "creation_date": 1442940440, "post_id": 32720849, "comment_id": 53287361, "body": "He doesn&#39;t appear to actually need mutation, the question talks of computations involving bytestrings."}, {"owner": {"reputation": 84731, "user_id": 510937, "user_type": "registered", "accept_rate": 80, "profile_image": "https://www.gravatar.com/avatar/70b13a9ae1aae1ca1aa6ac8dab4643f2?s=128&d=identicon&r=PG", "display_name": "Bakuriu", "link": "https://stackoverflow.com/users/510937/bakuriu"}, "edited": false, "score": 1, "creation_date": 1442940923, "post_id": 32720849, "comment_id": 53287679, "body": "I&#39;ve gone ahead and change mutate/mutation to transform. Hopefully this makes the question less ambiguous. If the OP recognizes he actually wants to mutate the values he can re-edit his question or rollback."}, {"owner": {"reputation": 43, "user_id": 5300933, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/4957584b608b4adae0fa131d8c2fed46?s=128&d=identicon&r=PG&f=1", "display_name": "Kirill Nesterov", "link": "https://stackoverflow.com/users/5300933/kirill-nesterov"}, "edited": false, "score": 0, "creation_date": 1443003407, "post_id": 32720849, "comment_id": 53314376, "body": "Yes, that&#39;s right. I&#39;ve used term mutation from fuzz testing, not the mutation of memory or and object. Thanks for fixing question."}], "owner": {"reputation": 43, "user_id": 5300933, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/4957584b608b4adae0fa131d8c2fed46?s=128&d=identicon&r=PG&f=1", "display_name": "Kirill Nesterov", "link": "https://stackoverflow.com/users/5300933/kirill-nesterov"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 118, "favorite_count": 0, "answer_count": 0, "score": 2, "last_activity_date": 1442940871, "creation_date": 1442935419, "last_edit_date": 1442940871, "question_id": 32720849, "link": "https://stackoverflow.com/questions/32720849/bytestring-transformation", "title": "ByteString transformation", "body": "<p>I'm trying to write a simple function to transform <code>ByteString</code>s with given <code>ratio</code>. Quantity of <code>xor</code>ed bits depends on the <code>length</code> and <code>ratio</code>. </p>\n\n<pre><code>rr &lt;- randomRIO (0, BL.length bs)\nlet howMuch = floor $ (ratio args) * (fromIntegral rr)\ntransformIndexes &lt;- replicateM howMuch $ randomRange (0, BL.length w)\n</code></pre>\n\n<p>What is the most efficient way to transform the <code>ByteString</code> value <code>bs</code>?</p>\n\n<p>My first idea was to build another zero-filled <code>ByteString</code> of the same length with xored bits on random positions and then use <code>BL.zipWith xor</code>, but I'm afraid it's not the most efficient way because input <code>bs</code> can be pretty big.</p>\n"}, {"tags": ["haskell", "cabal", "haddock", "haskell-stack"], "comments": [{"owner": {"reputation": 6075, "user_id": 147442, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/a5cb67e96d4c724cfac0ff043b11c87e?s=128&d=identicon&r=PG&f=1", "display_name": "R&#252;diger Hanke", "link": "https://stackoverflow.com/users/147442/r%c3%bcdiger-hanke"}, "edited": false, "score": 2, "creation_date": 1442929392, "post_id": 32712775, "comment_id": 53279428, "body": "Is your project an executable or a library? I think stack only generates docs for libraries currently (for those it prints the path to the docs after the command, or you can see it from <code>stack path</code>), see here: <a href=\"https://github.com/commercialhaskell/stack/issues/729\" rel=\"nofollow noreferrer\">github.com/commercialhaskell/stack/issues/729</a> (including suggested workaround for building docs for executables with &quot;cabal haddock&quot;)."}, {"owner": {"reputation": 2271, "user_id": 4994500, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/233389523330bec1d6e95f4c480d5741?s=128&d=identicon&r=PG&f=1", "display_name": "Sam van Herwaarden", "link": "https://stackoverflow.com/users/4994500/sam-van-herwaarden"}, "reply_to_user": {"reputation": 6075, "user_id": 147442, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/a5cb67e96d4c724cfac0ff043b11c87e?s=128&d=identicon&r=PG&f=1", "display_name": "R&#252;diger Hanke", "link": "https://stackoverflow.com/users/147442/r%c3%bcdiger-hanke"}, "edited": false, "score": 0, "creation_date": 1442930087, "post_id": 32712775, "comment_id": 53279955, "body": "@R&#252;digerHanke: Great, thanks. With that link I worked it out, indeed using <code>cabal haddock</code> and the linked suggested workaround. If you want to write it out as an answer I&#39;ll accept it, if not I can write up the solution myself. (My project is an executable.)"}], "answers": [{"comments": [{"owner": {"reputation": 2271, "user_id": 4994500, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/233389523330bec1d6e95f4c480d5741?s=128&d=identicon&r=PG&f=1", "display_name": "Sam van Herwaarden", "link": "https://stackoverflow.com/users/4994500/sam-van-herwaarden"}, "edited": false, "score": 0, "creation_date": 1442933512, "post_id": 32718946, "comment_id": 53282551, "body": "I don&#39;t really understand the SO edit system yet :/ Maybe I&#39;m going mad but I was fairly sure when I suggested the edit the <code>cabal configure</code> command was not yet in your post. Now the edit history says it was, making the edit meaningless. Anyway thanks for the answer and feel free to roll the edit back..."}, {"owner": {"reputation": 17809, "user_id": 1088108, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/63781cd38e91aa346a3849bc3ef3e550?s=128&d=identicon&r=PG&f=1", "display_name": "&#216;rjan Johansen", "link": "https://stackoverflow.com/users/1088108/%c3%98rjan-johansen"}, "reply_to_user": {"reputation": 2271, "user_id": 4994500, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/233389523330bec1d6e95f4c480d5741?s=128&d=identicon&r=PG&f=1", "display_name": "Sam van Herwaarden", "link": "https://stackoverflow.com/users/4994500/sam-van-herwaarden"}, "edited": false, "score": 2, "creation_date": 1442964691, "post_id": 32718946, "comment_id": 53299485, "body": "@SamvanHerwaarden I believe for a few minutes after an answer is first posted, the author can edit it without it showing up in the history. Maybe that&#39;s what happened here."}, {"owner": {"reputation": 19307, "user_id": 1663462, "user_type": "registered", "accept_rate": 78, "profile_image": "https://www.gravatar.com/avatar/c30e0fa0f3a065c038c633a95066d299?s=128&d=identicon&r=PG", "display_name": "Chris Stryczynski", "link": "https://stackoverflow.com/users/1663462/chris-stryczynski"}, "edited": false, "score": 1, "creation_date": 1513423452, "post_id": 32718946, "comment_id": 82654286, "body": "Runing the <code>cabal configure ...</code> command returns a failure of <code>cabal: ghc-pkg dump failed</code> for me."}, {"owner": {"reputation": 5657, "user_id": 534481, "user_type": "registered", "accept_rate": 31, "profile_image": "https://www.gravatar.com/avatar/60df8c1a366ab1bf4378154e71a93367?s=128&d=identicon&r=PG", "display_name": "Saurabh Nanda", "link": "https://stackoverflow.com/users/534481/saurabh-nanda"}, "reply_to_user": {"reputation": 19307, "user_id": 1663462, "user_type": "registered", "accept_rate": 78, "profile_image": "https://www.gravatar.com/avatar/c30e0fa0f3a065c038c633a95066d299?s=128&d=identicon&r=PG", "display_name": "Chris Stryczynski", "link": "https://stackoverflow.com/users/1663462/chris-stryczynski"}, "edited": false, "score": 0, "creation_date": 1532611989, "post_id": 32718946, "comment_id": 90047894, "body": "I&#39;m facing the same issue as @ChrisStryczynski Is there a solution for <code>cabal: ghc-pkg dump failed</code>?"}], "tags": [], "owner": {"reputation": 6075, "user_id": 147442, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/a5cb67e96d4c724cfac0ff043b11c87e?s=128&d=identicon&r=PG&f=1", "display_name": "R&#252;diger Hanke", "link": "https://stackoverflow.com/users/147442/r%c3%bcdiger-hanke"}, "is_accepted": true, "score": 18, "last_activity_date": 1442933217, "last_edit_date": 1442933217, "creation_date": 1442930416, "answer_id": 32718946, "question_id": 32712775, "link": "https://stackoverflow.com/questions/32712775/generating-documentation-for-my-own-code-with-haddock-and-stack/32718946#32718946", "title": "Generating documentation for my own code with Haddock and stack", "body": "<p>According to <a href=\"https://github.com/commercialhaskell/stack/issues/729\">this ticket</a> on the stack issue tracker, Stack can currently only build documentation for libraries, but not executables.</p>\n\n<p>Cabal can be configured to work with the stack databases with this command:</p>\n\n<pre><code>cabal configure --package-db=clear --package-db=global --package-db=$(stack path --snapshot-pkg-db) --package-db=$(stack path --local-pkg-db)\n</code></pre>\n\n<p>after which you can run <code>cabal haddock --executables</code> to generate the documentation.</p>\n\n<p>By the way, <code>stack haddock</code> is only a shortcut for <code>stack build --haddock</code>, so there is no need to write <code>stack haddock --haddock</code>.</p>\n"}, {"comments": [{"owner": {"reputation": 3254, "user_id": 3169029, "user_type": "registered", "accept_rate": 81, "profile_image": "https://www.gravatar.com/avatar/0af57d5b6e070c3e08a536505210f610?s=128&d=identicon&r=PG", "display_name": "Erik", "link": "https://stackoverflow.com/users/3169029/erik"}, "edited": false, "score": 0, "creation_date": 1507747505, "post_id": 45530936, "comment_id": 80338645, "body": "Awesome, thanks! I get warnings about primitive types such as <code>Int</code> not being available. Any way to include docs for some specific types?"}], "tags": [], "owner": {"reputation": 19307, "user_id": 1663462, "user_type": "registered", "accept_rate": 78, "profile_image": "https://www.gravatar.com/avatar/c30e0fa0f3a065c038c633a95066d299?s=128&d=identicon&r=PG", "display_name": "Chris Stryczynski", "link": "https://stackoverflow.com/users/1663462/chris-stryczynski"}, "is_accepted": false, "score": 7, "last_activity_date": 1513423811, "last_edit_date": 1513423811, "creation_date": 1502014473, "answer_id": 45530936, "question_id": 32712775, "link": "https://stackoverflow.com/questions/32712775/generating-documentation-for-my-own-code-with-haddock-and-stack/45530936#45530936", "title": "Generating documentation for my own code with Haddock and stack", "body": "<p><a href=\"https://www.reddit.com/r/haskell/comments/5ugm9s/how_to_generate_haddock_docs_for_nonlibrary_code/ddtwqzc/\" rel=\"noreferrer\">https://www.reddit.com/r/haskell/comments/5ugm9s/how_to_generate_haddock_docs_for_nonlibrary_code/ddtwqzc/</a></p>\n\n<p>The following solution only works when individual files are specified:</p>\n\n<pre><code>stack exec -- haddock --html src/Example.hs src/Main.hs --hyperlinked-source --odir=dist/docs\n</code></pre>\n"}], "owner": {"reputation": 2271, "user_id": 4994500, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/233389523330bec1d6e95f4c480d5741?s=128&d=identicon&r=PG&f=1", "display_name": "Sam van Herwaarden", "link": "https://stackoverflow.com/users/4994500/sam-van-herwaarden"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 5020, "favorite_count": 4, "accepted_answer_id": 32718946, "answer_count": 2, "score": 32, "last_activity_date": 1513423811, "creation_date": 1442912483, "last_edit_date": 1442929914, "question_id": 32712775, "link": "https://stackoverflow.com/questions/32712775/generating-documentation-for-my-own-code-with-haddock-and-stack", "title": "Generating documentation for my own code with Haddock and stack", "body": "<p>I have annotated my code in Haddock style and would like to generate browse-able documentation. Since I am also using stack, I want to integrate the documentation generation into the workflow. However, I have not yet been able to generate anything useful.</p>\n\n<p>I can run</p>\n\n<pre><code>stack haddock\n</code></pre>\n\n<p>and it will generate documentation in the style I want (to be found deep inside <code>~/.stack/</code>), but it only seems to generate documentation for the packages I depend on, rather than for my own code.</p>\n\n<p>When I run</p>\n\n<pre><code>stack haddock --help\n</code></pre>\n\n<p>I get the impression that I can use the additional argument <code>--haddock</code> to generate documentation for my own project, and <code>--no-haddock-deps</code> to leave out the documentation for my dependencies. However, when I run</p>\n\n<pre><code>stack haddock --haddock --no-haddock-deps\n</code></pre>\n\n<p>nothing seems to happen. If I <code>stack clean</code> first it will recompile all my code but no output is generated seeming to relate in any way to documentation.</p>\n\n<p>As an intermediate solution I have also tried running Haddock by itself, i.e.</p>\n\n<pre><code>haddock my-source.hs\n</code></pre>\n\n<p>but then I get an error that it cannot find a module the file depends on (which is installed locally by stack). This gives me the impression that documentation generation will have to go through stack somehow. I have looked for, but not really found any explanations related to configuring my <code>.cabal</code> and <code>stack.yaml</code> files for documentation.</p>\n\n<p><strong>TL;DR</strong></p>\n\n<p>How can I use stack and Haddock to generate documentation for the code in my own package?</p>\n"}, {"tags": ["haskell", "haskell-stack"], "answers": [{"tags": [], "owner": {"reputation": 30377, "user_id": 369198, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/71596bb1ca3ba3aa4400c3f407baec9f?s=128&d=identicon&r=PG", "display_name": "Michael Snoyman", "link": "https://stackoverflow.com/users/369198/michael-snoyman"}, "is_accepted": false, "score": 3, "last_activity_date": 1443033670, "creation_date": 1443033670, "answer_id": 32747088, "question_id": 32712084, "link": "https://stackoverflow.com/questions/32712084/could-i-make-stack-use-my-patched-cabal-library/32747088#32747088", "title": "Could I make Stack use my patched Cabal library?", "body": "<p>Stack will use the newest version of the Cabal library in your global database, so installing it there (such as by using the Setup.hs script directly) should work.</p>\n"}], "owner": {"reputation": 970, "user_id": 6464, "user_type": "registered", "accept_rate": 88, "profile_image": "https://www.gravatar.com/avatar/0403a2339c5e4ae8cc7e22ddf3cf300d?s=128&d=identicon&r=PG", "display_name": "Anton", "link": "https://stackoverflow.com/users/6464/anton"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 87, "favorite_count": 0, "answer_count": 1, "score": 5, "last_activity_date": 1443033670, "creation_date": 1442910574, "last_edit_date": 1442942746, "question_id": 32712084, "link": "https://stackoverflow.com/questions/32712084/could-i-make-stack-use-my-patched-cabal-library", "title": "Could I make Stack use my patched Cabal library?", "body": "<p>Does anyone know if there exists an easy way to make <a href=\"https://github.com/commercialhaskell/stack\" rel=\"nofollow\">Stack</a> use specific patched version of Cabal library from my GitHub repository? I'm very pleased with how can I use forked versions of other packages by just putting them into <code>packages:</code> section of <code>stack.yaml</code>, but that doesn't seem to work with Cabal.</p>\n\n<p>What I wanted is some way to specify git repository URL and revision in <code>stack.yaml</code> and have Cabal library built from that source, not from Hackage or whatever upstream repository. Could this be done?</p>\n"}, {"tags": ["haskell", "generics", "types"], "comments": [{"owner": {"reputation": 23444, "user_id": 414413, "user_type": "registered", "accept_rate": 79, "profile_image": "https://www.gravatar.com/avatar/6de2113f01432aa844dc85070ff33e89?s=128&d=identicon&r=PG", "display_name": "Cirdec", "link": "https://stackoverflow.com/users/414413/cirdec"}, "edited": false, "score": 0, "creation_date": 1442927968, "post_id": 32711316, "comment_id": 53278318, "body": "What are you trying to accomplish? For <code>Generic</code> the parameter isn&#39;t really used. For <code>Generic1</code> it is the type parameter as in the <code>a</code> in <code>data Pair a = Pair a a</code> and is included in the <code>Rep1</code> as (ignoring metadata)  <code>Par1 :*: Par1</code>. Ignoring generics, <code>MyClass</code> requires a function from <code>r a -&gt; Maybe Int</code> for all <code>a</code>; a function <code>SomeClass a =&gt; a -&gt; Maybe Int</code> won&#39;t help you construct a function for all <code>a</code>, since it only works on some <code>a</code>s, those with a <code>SomeClass a =&gt; </code> dictionary."}, {"owner": {"reputation": 655, "user_id": 2424911, "user_type": "registered", "accept_rate": 50, "profile_image": "https://i.stack.imgur.com/6YlX9.jpg?s=128&g=1", "display_name": "Maarten Faddegon", "link": "https://stackoverflow.com/users/2424911/maarten-faddegon"}, "reply_to_user": {"reputation": 23444, "user_id": 414413, "user_type": "registered", "accept_rate": 79, "profile_image": "https://www.gravatar.com/avatar/6de2113f01432aa844dc85070ff33e89?s=128&d=identicon&r=PG", "display_name": "Cirdec", "link": "https://stackoverflow.com/users/414413/cirdec"}, "edited": false, "score": 0, "creation_date": 1442929026, "post_id": 32711316, "comment_id": 53279117, "body": "Adding a <code>SomeClass</code> constraint to the <code>MyClass</code> definition would be fine."}], "answers": [{"comments": [{"owner": {"reputation": 44013, "user_id": 1477667, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/trgKM.jpg?s=128&g=1", "display_name": "dfeuer", "link": "https://stackoverflow.com/users/1477667/dfeuer"}, "edited": false, "score": 0, "creation_date": 1442937932, "post_id": 32719591, "comment_id": 53285801, "body": "You might want to mention that the (IMO, shady) reason <code>Generic</code> has an utterly useless type parameter <code>p</code> is that this allows <code>Generic</code> and <code>Generic1</code> to use the same representation types."}, {"owner": {"reputation": 44013, "user_id": 1477667, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/trgKM.jpg?s=128&g=1", "display_name": "dfeuer", "link": "https://stackoverflow.com/users/1477667/dfeuer"}, "edited": false, "score": 0, "creation_date": 1442938040, "post_id": 32719591, "comment_id": 53285870, "body": "I think this is a somewhat shady reason because 1. It makes the simple version (<code>Generic</code>) much harder for new users of the library to use and 2. The minute you want <code>Generic2</code>, you find that the library doesn&#39;t provide it, and you&#39;d need a whole new set of types to support it anyway."}, {"owner": {"reputation": 23444, "user_id": 414413, "user_type": "registered", "accept_rate": 79, "profile_image": "https://www.gravatar.com/avatar/6de2113f01432aa844dc85070ff33e89?s=128&d=identicon&r=PG", "display_name": "Cirdec", "link": "https://stackoverflow.com/users/414413/cirdec"}, "reply_to_user": {"reputation": 44013, "user_id": 1477667, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/trgKM.jpg?s=128&g=1", "display_name": "dfeuer", "link": "https://stackoverflow.com/users/1477667/dfeuer"}, "edited": false, "score": 0, "creation_date": 1442940451, "post_id": 32719591, "comment_id": 53287369, "body": "@dfeuer It&#39;s not so much shady as boundry-pushing. Imagine that the types like <code>(f :+: g) p</code> are polykinded and that for <code>p :: k</code>,  <code>f</code> and <code>g</code> have the kind <code>k -&gt; *</code>. When these were made, there weren&#39;t poly-kinded types, and even now there isn&#39;t a way (that I know of) to make a type level list of types of heterogeneous kinds."}, {"owner": {"reputation": 655, "user_id": 2424911, "user_type": "registered", "accept_rate": 50, "profile_image": "https://i.stack.imgur.com/6YlX9.jpg?s=128&g=1", "display_name": "Maarten Faddegon", "link": "https://stackoverflow.com/users/2424911/maarten-faddegon"}, "edited": false, "score": 0, "creation_date": 1442994579, "post_id": 32719591, "comment_id": 53308912, "body": "Cirdec, I know my example is a bit contrived, but I don&#39;t think your solution would allow me to use the <code>someFun</code> instance for sum types."}, {"owner": {"reputation": 23444, "user_id": 414413, "user_type": "registered", "accept_rate": 79, "profile_image": "https://www.gravatar.com/avatar/6de2113f01432aa844dc85070ff33e89?s=128&d=identicon&r=PG", "display_name": "Cirdec", "link": "https://stackoverflow.com/users/414413/cirdec"}, "reply_to_user": {"reputation": 655, "user_id": 2424911, "user_type": "registered", "accept_rate": 50, "profile_image": "https://i.stack.imgur.com/6YlX9.jpg?s=128&g=1", "display_name": "Maarten Faddegon", "link": "https://stackoverflow.com/users/2424911/maarten-faddegon"}, "edited": false, "score": 0, "creation_date": 1443022551, "post_id": 32719591, "comment_id": 53328388, "body": "@MaartenFaddegon I&#39;ve added <a href=\"http://stackoverflow.com/a/32743715/414413\">another answer</a> that literally uses <code>someFun</code> in sum types. I doubt it is what you want and I suspect you misunderstand your problem. You will get higher quality answers that are more useful to everyone if you ask how to solve a real problem instead of asking how to solve an incidental problem you encountered trying to solve a real problem."}], "tags": [], "owner": {"reputation": 23444, "user_id": 414413, "user_type": "registered", "accept_rate": 79, "profile_image": "https://www.gravatar.com/avatar/6de2113f01432aa844dc85070ff33e89?s=128&d=identicon&r=PG", "display_name": "Cirdec", "link": "https://stackoverflow.com/users/414413/cirdec"}, "is_accepted": false, "score": 3, "last_activity_date": 1442933061, "last_edit_date": 1442933061, "creation_date": 1442932067, "answer_id": 32719591, "question_id": 32711316, "link": "https://stackoverflow.com/questions/32711316/how-do-i-specifiy-class-constraints-for-p-in-f-g-p-with-from-ghc-gen/32719591#32719591", "title": "How do I specifiy class constraints for p in (:+:) f g p? (With :+: from GHC.Generics)", "body": "<p>If you add a <code>SomeClass a</code> constraint to <code>myFun</code> there's really nothing more to do.</p>\n\n<pre><code>{-# LANGUAGE TypeOperators #-}\n{-# LANGUAGE DefaultSignatures #-}\n{-# LANGUAGE FlexibleContexts #-}\n\nimport Control.Applicative\nimport GHC.Generics\n\nclass SomeClass a where\n    someFun :: a -&gt; Maybe Int\n\nclass MyClass f where\n    myFun :: SomeClass a =&gt; f a -&gt; Maybe Int\n\n    default myFun :: (Generic1 f, MyClass (Rep1 f), SomeClass a) =&gt; f a -&gt; Maybe Int\n    myFun f = myFun (from1 f)\n</code></pre>\n\n<p>You can write instances for all of the data types used in generic representations. The most interesting of these is <code>Par1</code>, which actually uses the <code>SomeClass a</code> constraint to use <code>someFun</code> on an occurrence of the parameter.</p>\n\n<pre><code>-- occurences of the parameter\ninstance MyClass Par1 where\n    myFun (Par1 p) = someFun p\n\n-- recursions of kind *\ninstance SomeClass a =&gt; MyClass (K1 i a) where\n    myFun (K1 a) = someFun a\n\n-- recursions of kind * -&gt; *\ninstance MyClass f =&gt; MyClass (Rec1 f) where\n    myFun (Rec1 f) = myFun f\n\n-- constructors with no arguments\ninstance MyClass U1 where\n    myFun (U1) = Nothing -- or Just 0 or Just 1 depending on what you're doing\n\n-- constructors with multiple arguments\ninstance (MyClass f, MyClass g) =&gt; MyClass (f :*: g) where\n    myFun (f :*: g) = liftA2 (+) (myFun f) (myFun g)  -- or howerever you are going to combine the Maybe Int\n\n-- data types with multiple constructors\ninstance (MyClass f, MyClass g) =&gt; MyClass (f :+: g) where\n    myFun (L1 f) = myFun f\n    myFun (R1 g) = myFun g\n\n-- metadata\ninstance (MyClass f) =&gt; MyClass (M1 i c f) where\n    myFun (M1 f) = myFun f\n</code></pre>\n\n<p>If you want to support composition of functors, we'll have to be a bit more clever. The obvious definition requires a <code>SomeClass (Maybe Int)</code> instance.</p>\n\n<pre><code>-- composition of functors\ninstance (MyClass f, MyClass g, Functor f) =&gt; MyClass (f :.: g) where\n    myFun (Comp1 fg) = myFun $ fmap myFun fg\n</code></pre>\n\n<h3>Deriving SomeClass from MyClass</h3>\n\n<p>We'll get <code>SomeClass</code> instances generically reusing <code>MyClass</code> to get them. Since <code>MyClass</code>'s <code>myFun</code> requires a <code>SomeClass</code> instance, we'll need to prove that the parameter <code>Par1</code> never occurs in a <code>Rep</code>. <code>from'</code> will prove that the parameter is empty.</p>\n\n<pre><code>class SomeClass a where\n    someFun :: a -&gt; Maybe Int\n\n    default someFun :: (Generic a, MyClass (Rep a)) =&gt; a -&gt; Maybe Int\n    someFun a = myFun (from' a)\n</code></pre>\n\n<p>The <code>Void</code> type from <a href=\"https://hackage.haskell.org/package/void\" rel=\"nofollow\">void</a> represents a type that can't logically exist. The following proves that the parameter for a <code>Generic</code> is always empty</p>\n\n<pre><code>-- Prove that the parameter is always empty\nfrom' :: Generic a =&gt; a -&gt; Rep a Void\nfrom' = from\n</code></pre>\n\n<p>To satisfy the <code>SomeClass</code> constraint for <code>myFun</code> we equip <code>Void</code> with a <code>SomeClass</code> instance. We can be sure <code>someFun :: Void -&gt; Maybe Int</code> is never called because there's no value of type <code>Void</code> to pass to it.</p>\n\n<pre><code>instance SomeClass Void where\n    someFun = absurd\n</code></pre>\n\n<p>Now we can derive an instance for <code>SomeClass (Maybe Int)</code> assuming we have a <code>SomeClass Int</code> instance.</p>\n\n<pre><code>-- The following instances are needed for the composition of functors\ninstance SomeClass Int where\n    someFun = Just\n\ninstance SomeClass a =&gt; SomeClass (Maybe a)\n</code></pre>\n\n<h3>Deriving SomeClass</h3>\n\n<p>You don't need to reuse <code>MyClass</code> with <code>Void</code> to derive <code>SomeClass</code> instances. Instead you can define another class for things that have a <code>myFun</code> regardless of what the parameter is.</p>\n\n<pre><code>class GSomeClass f where\n    gsomeFun :: f a -&gt; Maybe Int\n</code></pre>\n\n<p>You'd write <code>GSomeClass</code> instances for everything except <code>Par1</code> and <code>Rec1</code> and use <code>GSomeClass</code> to derive <code>SomeClass</code> instances. The <code>Generic</code> instances never use the parameter, not even for types like <code>Maybe a</code>; instead each occurrence of the parameter <code>a</code> appears as a <code>K1 i a p</code>.</p>\n\n<pre><code>class SomeClass a where\n    someFun :: a -&gt; Maybe Int\n\n    default someFun :: (Generic a, GSomeClass (Rep a)) =&gt; a -&gt; Maybe Int\n    someFun a = gsomeFun (from a)\n</code></pre>\n"}, {"tags": [], "owner": {"reputation": 23444, "user_id": 414413, "user_type": "registered", "accept_rate": 79, "profile_image": "https://www.gravatar.com/avatar/6de2113f01432aa844dc85070ff33e89?s=128&d=identicon&r=PG", "display_name": "Cirdec", "link": "https://stackoverflow.com/users/414413/cirdec"}, "is_accepted": false, "score": 0, "last_activity_date": 1443022270, "creation_date": 1443022270, "answer_id": 32743715, "question_id": 32711316, "link": "https://stackoverflow.com/questions/32711316/how-do-i-specifiy-class-constraints-for-p-in-f-g-p-with-from-ghc-gen/32743715#32743715", "title": "How do I specifiy class constraints for p in (:+:) f g p? (With :+: from GHC.Generics)", "body": "<p>There's no way in Haskell currently to write constraints of the kind <code>forall p. SomeClass (f p) =&gt;</code> which is what you are trying to do in the type</p>\n\n<pre><code>(SomeClass (f p), SomeClass (g p), MyClass f, MyClass g) =&gt; MyClass ((:+:) f g)\n</code></pre>\n\n<p>There is a trick to capture those constraints with a second type class. You could write a second class <code>FSomeClass f</code> that represents <code>forall p. SomeClass (f p)</code>. If <code>SomeClass</code> is simple, you can just reproduce the fields of the dictionary for <code>SomeClass</code> in the dictionary for <code>FSomeClass</code>, using <code>f a</code> in place of <code>a</code> everywhere.</p>\n\n<pre><code>class FSomeClass f where\n    fsomeFun :: f a -&gt; Maybe Int\n</code></pre>\n\n<p>If <code>SomeClass</code> is more complicated, or if you need to provide a real <code>SomeClass</code> instance to code that depends on it, you can instead capture the entire <code>SomeClass</code> dictionary in a <code>GADT</code>. <code>Dict</code> captures a dictionary for any constraint.</p>\n\n<pre><code>{-# LANGUAGE GADTs #-}\n{-# LANGUAGE ConstraintKinds #-}\n\ndata Dict c where\n    Dict :: c =&gt; Dict c\n</code></pre>\n\n<p>With <code>Dict</code>s we can write a class that says that, for every <code>a</code>, <code>f a</code> has a <code>SomeClass</code> instance trapped in a <code>Dict</code>.</p>\n\n<pre><code>class FSomeClass f where\n    someDict :: p0 a -&gt; p1 f -&gt; Dict (SomeClass (f a))\n    --          |       |       ^ there's a SomeClass (f a) instance\n    --          |       ^ for this f\n    --          ^ for any a \n</code></pre>\n\n<p>To get to the <code>SomeClass (f a)</code> instance you'd pattern match on the dictionary.</p>\n\n<h3>SomeClass and FSomeClass instances</h3>\n\n<p>We'll make <code>SomeClass (f p)</code> instances for all the types from <code>GHC.Generics</code> and <code>FSomeClass f</code> instances that demonstrate that <code>p</code> can vary over all types.</p>\n\n<pre><code>{-# LANGUAGE TypeOperators #-}\n{-# LANGUAGE FlexibleContexts #-}\n{-# LANGUAGE FlexibleInstances #-}\n{-# LANGUAGE ScopedTypeVariables #-}\n</code></pre>\n\n<p>For <code>Par1</code>, there's nothing we can do with the parameter <code>p</code>, since it can vary over all types. Our only other option is to provide no <code>SomeClass (Par1 p)</code> instance. For <code>Par1</code>, <code>K1</code>, and <code>U1</code> the <code>SomeClass</code> instances have no constraints and the <code>FSomeClass</code> instance just captures the <code>SomeClass</code> dictionary.</p>\n\n<pre><code>instance SomeClass (Par1 p) where\n    someFun (Par1 p) = Nothing -- You can't do anything with the p; you know nothing about it.\n\ninstance FSomeClass Par1 where\n    someDict _ _ = Dict\n\ninstance SomeClass a =&gt; SomeClass (K1 i a p) where\n    someFun (K1 a) = someFun a\n\ninstance SomeClass a =&gt; FSomeClass (K1 i a) where\n    someDict _ _ = Dict\n\ninstance SomeClass (U1 p) where\n    someFun (U1) = Nothing -- or Just 0 or Just 1 depending on what you're doing\n\ninstance FSomeClass U1 where\n    someDict _ _ = Dict\n</code></pre>\n\n<p>The <code>SomeClass</code> instances for <code>M1</code> and <code>Rec1</code> require a <code>SomeClass (f p) =&gt;</code> constraint. Before we can construct a <code>Dict</code> for e.g. <code>SomeClass (Rec1 f p)</code> we have to introduce a dictionary for <code>SomeClass (f p)</code>. We get the dictionary from <code>SomeClass (f p)</code> from the <code>FSomeClass</code> instance for <code>f</code> and pattern match on its <code>Dict</code>.</p>\n\n<pre><code>instance SomeClass (f p) =&gt; SomeClass (Rec1 f p) where\n    someFun (Rec1 f) = someFun f\n\ninstance (FSomeClass f) =&gt; FSomeClass (Rec1 f) where\n    someDict pa _ = case someDict pa (Proxy :: Proxy f) of Dict -&gt; Dict\n\ninstance SomeClass (f p) =&gt; SomeClass (M1 i c f p) where\n    someFun (M1 f) = someFun f\n\ninstance (FSomeClass f) =&gt; FSomeClass (M1 i c f) where\n    someDict pa _ = case someDict pa (Proxy :: Proxy f) of Dict -&gt; Dict\n</code></pre>\n\n<p>For products and sums there are two constraints on the <code>SomeClass</code> instances, so we get and pattern match on two dictionaries. We'd handle composition of functors the same way, but I'm skipping it for brevity.</p>\n\n<pre><code>instance (SomeClass (f p), SomeClass (g p)) =&gt; SomeClass ((f :*: g) p) where\n    someFun (f :*: g) = liftA2 (+) (someFun f) (someFun g)   -- or howerever you are going to combine the Maybe Int\n\ninstance (FSomeClass f, FSomeClass g) =&gt; FSomeClass (f :*: g) where\n    someDict pa _ = case someDict pa (Proxy :: Proxy f) of\n                       Dict -&gt; case someDict pa (Proxy :: Proxy g) of\n                           Dict -&gt; Dict\n\ninstance (SomeClass (f p), SomeClass (g p)) =&gt; SomeClass ((f :+: g) p)  where\n    someFun (L1 f) = someFun f\n    someFun (R1 g) = someFun g\n\ninstance (FSomeClass f, FSomeClass g) =&gt; FSomeClass (f :+: g) where\n    someDict pa _ = case someDict pa (Proxy :: Proxy f) of\n                       Dict -&gt; case someDict pa (Proxy :: Proxy g) of\n                           Dict -&gt; Dict\n</code></pre>\n\n<h3>Using FSomeClass</h3>\n\n<p>With your original <code>MyClass</code></p>\n\n<pre><code>class MyClass f where\n    myFun :: f a -&gt; Maybe Int\n</code></pre>\n\n<p>We'll write an instance for <code>:+:</code>. We'll take your original signature and replace <code>SomeClass (f p)</code> with <code>FSomeClass f</code>.</p>\n\n<pre><code>instance (SomeClass (f p), SomeClass (g p), MyClass f, MyClass g) =&gt; MyClass ((:+:) f g)\ninstance (FSomeClass f,    FSomeClass g   , MyClass f, MyClass g) =&gt; MyClass ((:+:) f g)\n</code></pre>\n\n<p>The branch for <code>R1</code> literally uses <code>someFun</code>. </p>\n\n<pre><code>instance (FSomeClass f, FSomeClass g, MyClass f, MyClass g) =&gt; MyClass (f :+: g) where\n    myFun (L1 f) = myFun f\n    myFun (R1 g) = case someDict g (Proxy :: Proxy g) of\n                       Dict -&gt; someFun g\n</code></pre>\n\n<p>I cannot recommend writing instances for <code>:+:</code> that are not associative. If you want to treat the first constructor differently, you should guarantee that later constructors won't be treated in the same way as the first constructor. A datatype</p>\n\n<pre><code>data MySum = A | B | C\n</code></pre>\n\n<p>Has more than one possible representation. Taking liberties with metadata, the two possible representations for <code>MySum</code> are</p>\n\n<pre><code> A :+: (B :+: C)\n(A :+: B) :+: C\n</code></pre>\n\n<p>The constructors' representations could be either of</p>\n\n<pre><code>L1 A      | R1 (L1 B) | R1 (L1 C)\nL1 (L1 A) | L1 (R1 B) | R1     C\n</code></pre>\n"}], "owner": {"reputation": 655, "user_id": 2424911, "user_type": "registered", "accept_rate": 50, "profile_image": "https://i.stack.imgur.com/6YlX9.jpg?s=128&g=1", "display_name": "Maarten Faddegon", "link": "https://stackoverflow.com/users/2424911/maarten-faddegon"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 77, "favorite_count": 0, "answer_count": 2, "score": 3, "last_activity_date": 1443022270, "creation_date": 1442908323, "last_edit_date": 1442912730, "question_id": 32711316, "link": "https://stackoverflow.com/questions/32711316/how-do-i-specifiy-class-constraints-for-p-in-f-g-p-with-from-ghc-gen", "title": "How do I specifiy class constraints for p in (:+:) f g p? (With :+: from GHC.Generics)", "body": "<p>To encode choice between constructors GHC.Generics defines the following type:</p>\n\n<pre><code>data    (:+:) f g p = L1 (f p) | R1 (g p)\n</code></pre>\n\n<p>The Generic class provides the method from to convert a Generic type to a representation:</p>\n\n<pre><code>from :: a -&gt; Rep a x\n</code></pre>\n\n<p>To write a function that is type generic, I define a class that works on the representation:</p>\n\n<pre><code>class MyClass r where myFun :: r a -&gt; Maybe Int\n</code></pre>\n\n<p>Assume I also have a class SomeClass for which I defined the instance:</p>\n\n<pre><code>instance (SomeClass (f p),SomeClass (g p)) =&gt; SomeClass ((:+:) f g p) where\n  someFun (R1 _) = Just 42\n</code></pre>\n\n<p>How would I add a SomeClass constraint to an MyClass instance of the Generic sum type? In other words, what is wrong with the following instance:</p>\n\n<pre><code>instance (SomeClass (f p), SomeClass (g p), MyClass f, MyClass g)\n      =&gt; MyClass ((:+:) f g) where\n myFun (L1 x) = myFun x\n myFun y      = someFun y -- Error: Could not deduce (SomeClass (f a))\n                          -- arising from a use of \u2018someFun\u2019\n</code></pre>\n\n<p>A complete example I wrote is:</p>\n\n<pre><code>{-# LANGUAGE TypeOperators, DefaultSignatures, DeriveGeneric, FlexibleContexts, \n             UndecidableInstances, AllowAmbiguousTypes, RankNTypes #-}\nmodule M where\nimport GHC.Generics\n\n---\n\nclass SomeClass a where \n  someFun :: a -&gt; Maybe Int\n  default someFun :: (Generic a, MyClass (Rep a)) =&gt; a -&gt; Maybe Int\n  someFun x = myFun (from x)\n\ninstance (SomeClass (f p),SomeClass (g p)) =&gt; SomeClass ((:+:) f g p) where\n  someFun (R1 _) = Just 42\n\ninstance SomeClass Int where\n  someFun i  = Just i\n\n---\n\nclass MyClass r where \n  myFun :: r a -&gt; Maybe Int\n\ninstance (SomeClass a) =&gt; MyClass (K1 i a) where\n  myFun (K1 x) = someFun x -- This is fine\n\ninstance (SomeClass (f p), SomeClass (g p), MyClass f, MyClass g) =&gt; MyClass ((:+:) f g) where\n  myFun (L1 x) = myFun x\n  myFun y      = someFun y -- Error: Could not deduce (SomeClass (f a)) arising from a use of \u2018someFun\u2019\n</code></pre>\n"}, {"tags": ["haskell", "monads", "free-monad"], "comments": [{"owner": {"reputation": 5184, "user_id": 1935631, "user_type": "registered", "accept_rate": 87, "profile_image": "https://www.gravatar.com/avatar/0e4d0d6c5ce5e9350cacc818ee350347?s=128&d=identicon&r=PG", "display_name": "Sassa NF", "link": "https://stackoverflow.com/users/1935631/sassa-nf"}, "edited": false, "score": 1, "creation_date": 1442922608, "post_id": 32708525, "comment_id": 53274427, "body": "yes, <code>Zero</code> is a functor from <code>Hask</code> to <code>0</code>, the empty category (which then is embedded back into Hask)."}], "answers": [{"comments": [{"owner": {"reputation": 100185, "user_id": 3234959, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/93bb12ca0f93dfddb33880316f7e66c2?s=128&d=identicon&r=PG&f=1", "display_name": "chi", "link": "https://stackoverflow.com/users/3234959/chi"}, "edited": false, "score": 0, "creation_date": 1442912378, "post_id": 32708629, "comment_id": 53267711, "body": "I wondered what happens if we cheat and do <code>fmap f _|_</code> in both these functor instances. In GHCi 7.10.2, the first instance errors out with <code>Exception: Void fmap</code>, without trying to evaluate the bottom, while the second does evaluate it. I&#39;d have expected a non-exhaustiveness error instead. Not that this really matters -- both instances are fine, albeit they produce different bottoms if we pass one."}, {"owner": {"reputation": 126897, "user_id": 791604, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/ce991df7a056248d5e4f6fc3659ba733?s=128&d=identicon&r=PG", "display_name": "Daniel Wagner", "link": "https://stackoverflow.com/users/791604/daniel-wagner"}, "reply_to_user": {"reputation": 100185, "user_id": 3234959, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/93bb12ca0f93dfddb33880316f7e66c2?s=128&d=identicon&r=PG&f=1", "display_name": "chi", "link": "https://stackoverflow.com/users/3234959/chi"}, "edited": false, "score": 2, "creation_date": 1442940879, "post_id": 32708629, "comment_id": 53287647, "body": "@chi You definitely shouldn&#39;t expect a non-exhaustiveness error: these pattern matches are exhaustive!"}, {"owner": {"reputation": 100185, "user_id": 3234959, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/93bb12ca0f93dfddb33880316f7e66c2?s=128&d=identicon&r=PG&f=1", "display_name": "chi", "link": "https://stackoverflow.com/users/3234959/chi"}, "edited": false, "score": 0, "creation_date": 1442942921, "post_id": 32708629, "comment_id": 53288897, "body": "I somehow expected the practical equivalence between <code>case e of p1 -&gt; e1 ; .. ; pn -&gt; en</code> and <code>case e of ... ; pn -&gt; en ; _ -&gt; error &quot;non exhaustive&quot;</code>. This &quot;under-the-hood&quot; equivalence only breaks for n=0 (if we do not identify &quot;different&quot; bottoms). About exhaustiveness... I would be more convinced in Agda/Coq or any other total programming language. In Haskell, you are right, but bottoms are strange beasts, and I have no clear idea about whether <code>case _|_ :: Void of {}</code> should evaluate the argument or not, operationally speaking."}], "tags": [], "owner": {"reputation": 126897, "user_id": 791604, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/ce991df7a056248d5e4f6fc3659ba733?s=128&d=identicon&r=PG", "display_name": "Daniel Wagner", "link": "https://stackoverflow.com/users/791604/daniel-wagner"}, "is_accepted": true, "score": 12, "last_activity_date": 1442897578, "creation_date": 1442897578, "answer_id": 32708629, "question_id": 32708525, "link": "https://stackoverflow.com/questions/32708525/writing-the-identity-monad-in-terms-of-free/32708629#32708629", "title": "Writing the Identity monad in terms of Free", "body": "<p>If you turn on <code>DeriveFunctor</code>, you can write</p>\n\n<pre><code>data Zero a deriving Functor\n</code></pre>\n\n<p>but you might consider that cheating. If you want to write it yourself, you can turn on <code>EmptyCase</code>, instead, then write the funky-looking</p>\n\n<pre><code>instance Functor Zero where\n    fmap f z = case z of\n</code></pre>\n"}, {"tags": [], "owner": {"reputation": 28456, "user_id": 1094403, "user_type": "registered", "accept_rate": 83, "profile_image": "https://www.gravatar.com/avatar/3770aa7eae5c211921493abd0d2c9f5a?s=128&d=identicon&r=PG", "display_name": "Luis Casillas", "link": "https://stackoverflow.com/users/1094403/luis-casillas"}, "is_accepted": false, "score": 7, "last_activity_date": 1442948216, "last_edit_date": 1495540233, "creation_date": 1442902790, "answer_id": 32709701, "question_id": 32708525, "link": "https://stackoverflow.com/questions/32708525/writing-the-identity-monad-in-terms-of-free/32709701#32709701", "title": "Writing the Identity monad in terms of Free", "body": "<p>One way to go about this is to use <a href=\"https://hackage.haskell.org/package/void-0.7.1/docs/Data-Void.html\" rel=\"nofollow noreferrer\"><code>Data.Void</code></a> instead of an empty <code>data</code> declaration, like this:</p>\n\n<pre><code>import Data.Void\n\n-- `Zero a` is isomorphic to `Void`\nnewtype Zero a = Zero Void\n\ninstance Functor Zero where\n    -- You can promise anything if the precondition is that\n    -- somebody's gotta give you an `x :: Void`.\n    fmap f (Zero x) = absurd x\n</code></pre>\n\n<p>See <a href=\"https://stackoverflow.com/questions/14131856/whats-the-absurd-function-in-data-void-useful-for\">this question</a> for some really great explanations of what <code>Void</code> is useful for.  But the key idea is that the <code>absurd :: Void -&gt; a</code> function lets you go from that can-never-happen <code>x :: Void</code> binding into any type you like.</p>\n"}, {"comments": [{"owner": {"reputation": 28456, "user_id": 1094403, "user_type": "registered", "accept_rate": 83, "profile_image": "https://www.gravatar.com/avatar/3770aa7eae5c211921493abd0d2c9f5a?s=128&d=identicon&r=PG", "display_name": "Luis Casillas", "link": "https://stackoverflow.com/users/1094403/luis-casillas"}, "edited": false, "score": 0, "creation_date": 1442946765, "post_id": 32718591, "comment_id": 53291197, "body": "It&#39;s worth pointing out that this is more or less how the <code>Data.Void</code> module is implemented."}, {"owner": {"reputation": 64094, "user_id": 476408, "user_type": "registered", "accept_rate": 70, "profile_image": "https://www.gravatar.com/avatar/2bc1bffafe7aa29ef900b98d1fd1e94e?s=128&d=identicon&r=PG", "display_name": "J. Abrahamson", "link": "https://stackoverflow.com/users/476408/j-abrahamson"}, "reply_to_user": {"reputation": 28456, "user_id": 1094403, "user_type": "registered", "accept_rate": 83, "profile_image": "https://www.gravatar.com/avatar/3770aa7eae5c211921493abd0d2c9f5a?s=128&d=identicon&r=PG", "display_name": "Luis Casillas", "link": "https://stackoverflow.com/users/1094403/luis-casillas"}, "edited": false, "score": 0, "creation_date": 1442946890, "post_id": 32718591, "comment_id": 53291261, "body": "Hah, yes, that is true!"}, {"owner": {"reputation": 44013, "user_id": 1477667, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/trgKM.jpg?s=128&g=1", "display_name": "dfeuer", "link": "https://stackoverflow.com/users/1477667/dfeuer"}, "edited": false, "score": 1, "creation_date": 1442946891, "post_id": 32718591, "comment_id": 53291262, "body": "<code>Data.Void</code> used to do this, before <code>EmptyCase</code> came out (it was changed when it moved from <code>void</code> to <code>base</code>). I don&#39;t know if it changed for clarity, efficiency, or error reporting reasons. Do you?"}, {"owner": {"reputation": 28456, "user_id": 1094403, "user_type": "registered", "accept_rate": 83, "profile_image": "https://www.gravatar.com/avatar/3770aa7eae5c211921493abd0d2c9f5a?s=128&d=identicon&r=PG", "display_name": "Luis Casillas", "link": "https://stackoverflow.com/users/1094403/luis-casillas"}, "reply_to_user": {"reputation": 44013, "user_id": 1477667, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/trgKM.jpg?s=128&g=1", "display_name": "dfeuer", "link": "https://stackoverflow.com/users/1477667/dfeuer"}, "edited": false, "score": 1, "creation_date": 1442970578, "post_id": 32718591, "comment_id": 53300906, "body": "@dfeuer: Oh, I hadn&#39;t noticed that <code>base</code> now has <code>Void</code> (since 4.8.0.0). Note that the old <code>void</code> package advertised itself as &quot;a Haskell 98 logically uninhabited data type&quot;; that&#39;s the original point of this answer&#39;s trick."}], "tags": [], "owner": {"reputation": 64094, "user_id": 476408, "user_type": "registered", "accept_rate": 70, "profile_image": "https://www.gravatar.com/avatar/2bc1bffafe7aa29ef900b98d1fd1e94e?s=128&d=identicon&r=PG", "display_name": "J. Abrahamson", "link": "https://stackoverflow.com/users/476408/j-abrahamson"}, "is_accepted": false, "score": 7, "last_activity_date": 1442929502, "creation_date": 1442929502, "answer_id": 32718591, "question_id": 32708525, "link": "https://stackoverflow.com/questions/32708525/writing-the-identity-monad-in-terms-of-free/32718591#32718591", "title": "Writing the Identity monad in terms of Free", "body": "<p>A trick way of defining <code>Zero a</code> is the following.</p>\n\n<pre><code>newtype Zero a = Zero (Zero a)\n</code></pre>\n\n<p>In other words, it encodes the sort of silly, slightly non-obvious statement that there is actually one way to get a value of <code>Zero a</code>: you must already have one!</p>\n\n<p>With this definition, <code>absurd :: Zero a -&gt; b</code> is definable in a \"natural\" way</p>\n\n<pre><code>absurd :: Zero a -&gt; b\nabsurd (Zero z) = absurd z\n</code></pre>\n\n<p>In some sense these definitions are all legal because they point out exactly how they are not possible to instantiate. No values of <code>Zero a</code> can be constructed unless someone else \"cheats\" first.</p>\n\n<pre><code>instance Functor Zero where\n  fmap f = absurd\n</code></pre>\n"}, {"tags": [], "owner": {"reputation": 44013, "user_id": 1477667, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/trgKM.jpg?s=128&g=1", "display_name": "dfeuer", "link": "https://stackoverflow.com/users/1477667/dfeuer"}, "is_accepted": false, "score": 3, "last_activity_date": 1442959445, "last_edit_date": 1495540768, "creation_date": 1442954408, "answer_id": 32726468, "question_id": 32708525, "link": "https://stackoverflow.com/questions/32708525/writing-the-identity-monad-in-terms-of-free/32726468#32726468", "title": "Writing the Identity monad in terms of Free", "body": "<p>Another spin on Luis Casillas's <a href=\"https://stackoverflow.com/a/32709701/1477667\">answer</a> is to build your type entirely from stock parts:</p>\n\n<pre><code>type Id = Free (Const Void)\n</code></pre>\n\n<p>The <code>Functor</code> instance for <code>Const x</code> will work as you wish (its <code>fmap</code> doesn't do anything, which is just fine), and you'll only need to take care when unpacking:</p>\n\n<pre><code>runId (Pure x) = x\nrunId (Free (Const ab)) = absurd ab\n</code></pre>\n\n<p>All of these things, of course, are only \"morally\" equivalent to <code>Identity</code>, because they all introduce extra values. In particular, we can distinguish among</p>\n\n<pre><code>bottom\nPure bottom\nFree bottom\n</code></pre>\n"}], "owner": {"reputation": 327, "user_id": 1179127, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/oxV4A.jpg?s=128&g=1", "display_name": "Alex Beal", "link": "https://stackoverflow.com/users/1179127/alex-beal"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 345, "favorite_count": 1, "accepted_answer_id": 32708629, "answer_count": 4, "score": 11, "last_activity_date": 1442959445, "creation_date": 1442896930, "question_id": 32708525, "link": "https://stackoverflow.com/questions/32708525/writing-the-identity-monad-in-terms-of-free", "title": "Writing the Identity monad in terms of Free", "body": "<p>In \"Data types a la carte\" Swierstra writes that given <code>Free</code> (which he calls <code>Term</code>) and <code>Zero</code> you can implement the Identity monad:</p>\n\n<pre><code>data Term f a = Pure a\n              | Impure (f (Term f a))\ndata Zero a\n</code></pre>\n\n<p><code>Term Zero</code> is now the Identity monad. I understand why this is. The issue is that I can never use <code>Term Zero</code> as a Monad because of the pesky <code>Functor f =&gt;</code> constraint: </p>\n\n<pre><code>instance Functor f =&gt; Monad (Term f) where\n    return x = Pure x\n    (Pure x) &gt;&gt;= f = f x \n    (Impure f) &gt;&gt;= t = Impure (fmap (&gt;&gt;=f) t) \n</code></pre>\n\n<p>How do I make <code>Zero</code> a Functor?</p>\n\n<pre><code>instance Functor Zero where\n    fmap f z = ???\n</code></pre>\n\n<p>It seems like there's a trick here: Since <code>Zero</code> has no constructors, <code>Impure</code> can never be used, and so the <code>Impure</code> case of <code>&gt;&gt;=</code> is never called. This means <code>fmap</code> is never called, so there's a sense in which this is ok:</p>\n\n<pre><code>instance Functor Zero where\n    fmap f z = undefined\n</code></pre>\n\n<p>The problem is, this feels like cheating. What am I missing? Is <code>Zero</code> actually a Functor? Or perhaps <code>Zero</code> isn't a Functor, and this is a shortcoming of how we express <code>Free</code> in Haskell?</p>\n"}, {"tags": ["haskell", "typeclass", "functor"], "comments": [{"owner": {"reputation": 17809, "user_id": 1088108, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/63781cd38e91aa346a3849bc3ef3e550?s=128&d=identicon&r=PG&f=1", "display_name": "&#216;rjan Johansen", "link": "https://stackoverflow.com/users/1088108/%c3%98rjan-johansen"}, "edited": false, "score": 0, "creation_date": 1442911276, "post_id": 32708391, "comment_id": 53266969, "body": "You edited your question to add <code>a</code> and <code>b</code> arguments to <code>Functor</code>. That makes it a very different question: Now it is possible to define with GHC (and my original answer no longer applies to this version). However, at the same time, the answer to your question now is a definite <i>no</i>: there are now many <i>uses</i> that stop working, namely any where you <i>don&#39;t</i> want to provide <code>a</code> and <code>b</code> as fixed ahead of time. Also even when it still works, all type signatures need to change."}, {"owner": {"reputation": 100892, "user_id": 745903, "user_type": "registered", "accept_rate": 74, "profile_image": "https://www.gravatar.com/avatar/50933f6638836741e620669b3940410e?s=128&d=identicon&r=PG", "display_name": "leftaroundabout", "link": "https://stackoverflow.com/users/745903/leftaroundabout"}, "edited": false, "score": 0, "creation_date": 1442932387, "post_id": 32708391, "comment_id": 53281749, "body": "Is none of the various available generalisations to the <code>Functor</code> class (&#91;<a href=\"http://hackage.haskell.org/package/hask-0/docs/Hask-Category.html#t:Functor\" rel=\"nofollow noreferrer\">1</a>&#93; &#91;<a href=\"http://hackage.haskell.org/package/data-category-0.6.1/docs/Data-Category-Functor.html\" rel=\"nofollow noreferrer\">2</a>&#93; &#91;<a href=\"http://hackage.haskell.org/package/constrained-categories-0.2.1.1/docs/Control-Functor-Constrained.html\" rel=\"nofollow noreferrer\">3</a>&#93;) general enough for you?"}], "answers": [{"comments": [{"owner": {"reputation": 44013, "user_id": 1477667, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/trgKM.jpg?s=128&g=1", "display_name": "dfeuer", "link": "https://stackoverflow.com/users/1477667/dfeuer"}, "edited": false, "score": 1, "creation_date": 1442900490, "post_id": 32708568, "comment_id": 53261290, "body": "Isn&#39;t this addressed (at least partially) by <a href=\"https://hackage.haskell.org/package/constraints/docs/Data-Constraint-Forall.html\" rel=\"nofollow noreferrer\">Data.Constraint.Forall</a>?"}, {"owner": {"reputation": 17809, "user_id": 1088108, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/63781cd38e91aa346a3849bc3ef3e550?s=128&d=identicon&r=PG&f=1", "display_name": "&#216;rjan Johansen", "link": "https://stackoverflow.com/users/1088108/%c3%98rjan-johansen"}, "reply_to_user": {"reputation": 44013, "user_id": 1477667, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/trgKM.jpg?s=128&g=1", "display_name": "dfeuer", "link": "https://stackoverflow.com/users/1477667/dfeuer"}, "edited": false, "score": 3, "creation_date": 1442902084, "post_id": 32708568, "comment_id": 53261881, "body": "@dfeuer I&#39;m afraid the version on Hackage is <a href=\"https://github.com/ekmett/constraints/issues/11\" rel=\"nofollow noreferrer\">broken</a>. There&#39;s a new version on GitHub which is safe (as far as we know) but cannot be as automatically inferred."}, {"owner": {"reputation": 44013, "user_id": 1477667, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/trgKM.jpg?s=128&g=1", "display_name": "dfeuer", "link": "https://stackoverflow.com/users/1477667/dfeuer"}, "edited": false, "score": 0, "creation_date": 1442906078, "post_id": 32708568, "comment_id": 53263890, "body": "Och. Sad. Nice work implementing <code>unsafeCoerce</code>. I wish I understood it. What weakness did you find?"}, {"owner": {"reputation": 17809, "user_id": 1088108, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/63781cd38e91aa346a3849bc3ef3e550?s=128&d=identicon&r=PG&f=1", "display_name": "&#216;rjan Johansen", "link": "https://stackoverflow.com/users/1088108/%c3%98rjan-johansen"}, "reply_to_user": {"reputation": 44013, "user_id": 1477667, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/trgKM.jpg?s=128&g=1", "display_name": "dfeuer", "link": "https://stackoverflow.com/users/1477667/dfeuer"}, "edited": false, "score": 2, "creation_date": 1442907786, "post_id": 32708568, "comment_id": 53264896, "body": "@dfeuer The <code>Forall</code> trick depended on there being no way to distinguish when a constraint &quot;holds for two hidden concrete types <code>A</code> and <code>B</code>&quot; from when it &quot;holds for all types&quot;. Unfortunately type equality constraints break this assumption, and type families make it possible to escalate this to <code>unsafeCoerce</code>. (A closed family is a bit easier - the first, more complicated version <a href=\"http://oerjan.nvg.org/haskell/Forall/UC3.hs\" rel=\"nofollow noreferrer\">can be adapted</a> to an open one. Possibly GADTs might work too.)"}, {"owner": {"reputation": 17809, "user_id": 1088108, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/63781cd38e91aa346a3849bc3ef3e550?s=128&d=identicon&r=PG&f=1", "display_name": "&#216;rjan Johansen", "link": "https://stackoverflow.com/users/1088108/%c3%98rjan-johansen"}, "reply_to_user": {"reputation": 44013, "user_id": 1477667, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/trgKM.jpg?s=128&g=1", "display_name": "dfeuer", "link": "https://stackoverflow.com/users/1477667/dfeuer"}, "edited": false, "score": 2, "creation_date": 1442908182, "post_id": 32708568, "comment_id": 53265107, "body": "@dfeuer Oh and for the simplest version most of the remaining complexity is about splitting everything into small enough, sufficiently well-hidden steps that GHC doesn&#39;t see enough at a time to realize something&#39;s horribly wrong."}], "tags": [], "owner": {"reputation": 17809, "user_id": 1088108, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/63781cd38e91aa346a3849bc3ef3e550?s=128&d=identicon&r=PG&f=1", "display_name": "&#216;rjan Johansen", "link": "https://stackoverflow.com/users/1088108/%c3%98rjan-johansen"}, "is_accepted": false, "score": 4, "last_activity_date": 1442898234, "last_edit_date": 1442898234, "creation_date": 1442897200, "answer_id": 32708568, "question_id": 32708391, "link": "https://stackoverflow.com/questions/32708391/a-more-generic-functor-class/32708568#32708568", "title": "A more generic Functor class", "body": "<p>As far as can ascertain, your definition doesn't work in current GHC, even with <code>UndecidableInstances</code>.</p>\n\n<p>The problem is you would need a hypothetical extension \"<code>RankNConstraints</code>\" which would allow you to mention <code>a</code> and <code>b</code> in your last instance declaration despite that they're not in the head of it, e.g. as</p>\n\n<pre><code>instance (forall a b. GenericFunctor ((a -&gt; b) -&gt; f a -&gt; f b)) =&gt; Functor f where\n</code></pre>\n\n<p>I've thought for a while that this extension would be great to have, for this and many other purposes (e.g. Stackoverflow answers keep coming up where it would have seemed relevant). And so have many others, since at least 2000 when SPJ and Ralph Hinze suggested it <a href=\"http://research.microsoft.com/en-us/um/people/simonpj/papers/derive.htm\" rel=\"nofollow\">in a paper</a>.</p>\n\n<p>Unfortunately, I recently learned from an <a href=\"https://ghc.haskell.org/trac/ghc/ticket/2893\" rel=\"nofollow\">old GHC ticket</a> that it's unknown how to implement it sanely because it wreaks havoc with type inference.</p>\n"}, {"tags": [], "owner": {"reputation": 5184, "user_id": 1935631, "user_type": "registered", "accept_rate": 87, "profile_image": "https://www.gravatar.com/avatar/0e4d0d6c5ce5e9350cacc818ee350347?s=128&d=identicon&r=PG", "display_name": "Sassa NF", "link": "https://stackoverflow.com/users/1935631/sassa-nf"}, "is_accepted": false, "score": 2, "last_activity_date": 1442910070, "creation_date": 1442910070, "answer_id": 32711924, "question_id": 32708391, "link": "https://stackoverflow.com/questions/32708391/a-more-generic-functor-class/32711924#32711924", "title": "A more generic Functor class", "body": "<p>I think the bigger problem here is that a <code>Functor</code> is not only a <code>map</code>, but a few laws that go with it. I don't see how you could express the laws for the <code>GenericFunctor</code> you propose.</p>\n\n<p>For example, <code>id</code> and <code>(.)</code> in <code>Category</code> define what identity and composition means - now you could define a <code>GenericFunctor</code> for a pair of <code>Categories</code>.</p>\n"}], "owner": {"reputation": 20310, "user_id": 525980, "user_type": "registered", "accept_rate": 48, "profile_image": "https://www.gravatar.com/avatar/8dafe66793ee2f32192e9fcefb389a12?s=128&d=identicon&r=PG", "display_name": "Clinton", "link": "https://stackoverflow.com/users/525980/clinton"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 123, "favorite_count": 0, "answer_count": 2, "score": 3, "last_activity_date": 1559485158, "creation_date": 1442896095, "last_edit_date": 1559485158, "question_id": 32708391, "link": "https://stackoverflow.com/questions/32708391/a-more-generic-functor-class", "title": "A more generic Functor class", "body": "<p>This question may seem a little bit silly, but I'll ask it first then explain the rationale behind it.</p>\n\n<p>Lets say we redefine <code>Functor</code> in the following way:</p>\n\n<pre><code>{-# LANGUAGE FlexibleContexts #-}\n{-# LANGUAGE FlexibleInstances #-}\n\nclass Functor a where\n  generic_fmap :: a\n\ninstance Functor ((a -&gt; b) -&gt; Maybe a -&gt; Maybe b) where\n  generic_fmap f (Just x) = Just (f x)\n  generic_fmap _ Nothing = Nothing\n\ninstance Functor ((a -&gt; b) -&gt; [a] -&gt; [b]) where\n  generic_fmap = map\n\n-- etc with more instances    \n</code></pre>\n\n<p>And then, I've considered two approaches for the definition of <code>fmap</code>.</p>\n\n<p>(1):</p>\n\n<pre><code>fmap :: (Functor ((a -&gt; b) -&gt; f a -&gt; f b)) =&gt; (a -&gt; b) -&gt; f a -&gt; f b\nfmap = generic_fmap\n</code></pre>\n\n<p>or (2) (which needs undecidable instances) (<strong>Edited</strong>):</p>\n\n<pre><code>class Functor f a b where\n  fmap :: (a -&gt; b) -&gt; f a -&gt; f b\n\ninstance (GenericFunctor ((a -&gt; b) -&gt; f a -&gt; f b)) =&gt; Functor f a b where\n  fmap = generic_fmap\n</code></pre>\n\n<p>Besides the increased typing and ugliness, is there anything we lose defining <code>fmap</code> in either of these ways? </p>\n\n<p>The reason I'm asking is that I've found that the standard <code>Functor</code> class is more specific than the mathematical definition, so many things that otherwise would fit as functors can not be functors in Haskell. My idea was to define a very generic <code>Functor</code> class (perhaps not as generic as above though). But by making it too generic you'd lose type inference. So then users can decide to use different versions of <code>fmap</code> depending on whether they need generality or type inference. Much like how users can choose between <code>.</code> in prelude (that only works on standard functions) or <code>.</code> in <code>Control.Category</code> (that works on all categories). </p>\n\n<p>I know there's a bunch of backwards compatibility problems also, but my first question is, are my definitions identical to use for instance <em>users</em> (not worrying about those who want to define instances for the moment). </p>\n"}, {"tags": ["haskell", "delimited-continuations"], "comments": [{"owner": {"reputation": 44013, "user_id": 1477667, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/trgKM.jpg?s=128&g=1", "display_name": "dfeuer", "link": "https://stackoverflow.com/users/1477667/dfeuer"}, "edited": false, "score": 7, "creation_date": 1442892938, "post_id": 32707517, "comment_id": 53259133, "body": "You should really avoid extremes of point-free silliness (e.g., <code>ch&#39;</code>), especially when you don&#39;t know what your code will ultimately look like and especially when you want other people to help. If you really like, you can use the standard function <code>bool</code>, which is similar but readily recognized as the <code>Bool</code> eliminator. Note also: <code>not . (== &quot;pause&quot;)</code> is better written <code>(&#47;= &quot;pause&quot;)</code>."}, {"owner": {"reputation": 58792, "user_id": 1006010, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/f683d229f3673c9dcc3f3f2796d75c09?s=128&d=identicon&r=PG", "display_name": "MathematicalOrchid", "link": "https://stackoverflow.com/users/1006010/mathematicalorchid"}, "edited": false, "score": 1, "creation_date": 1442909485, "post_id": 32707517, "comment_id": 53265838, "body": "Maybe something like this? <a href=\"http://stackoverflow.com/questions/10236953/the-pause-monad\">stackoverflow.com/questions/10236953/the-pause-monad</a>"}], "owner": {"reputation": 37, "user_id": 5199947, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/c478d77060616ab6948fa009c0f9dc37?s=128&d=identicon&r=PG", "display_name": "user5199947", "link": "https://stackoverflow.com/users/5199947/user5199947"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 138, "favorite_count": 0, "answer_count": 0, "score": 1, "last_activity_date": 1442912255, "creation_date": 1442889477, "last_edit_date": 1442912255, "question_id": 32707517, "link": "https://stackoverflow.com/questions/32707517/pause-computation-with-continuation", "title": "Pause computation with continuation", "body": "<p>I'm trying to pause a computation and later resume it on demand (upon a prompt from the user). It should resemble something like the following, only using the continuation monad.</p>\n\n<pre><code>import Control.Monad.IO.Class (liftIO,MonadIO(..))\nimport Data.Void\n\nf :: MonadIO m =&gt; Int -&gt; Int -&gt; m Void\nf x y = do\n  liftIO (print x)\n  input &lt;- liftIO getLine\n  if input /= \"pause\"\n     then (f (x+1) y)\n     else (f' y x)\n\nf' :: MonadIO m =&gt; Int -&gt; Int -&gt; m Void\nf' x y = do\n  liftIO (print x)\n  input &lt;- liftIO getLine\n  if input /= \"pause\"\n     then (f' (x-1) y)\n     else (f y x)\n</code></pre>\n\n<p>Example output:</p>\n\n<pre><code>\u03bb&gt; f 5 5\n5\n\n6\n\n7\n\n8\npause\n5\n\n4\n\n3\n\n2\npause\n8\n\n9\n\n10\nInterrupted.\n</code></pre>\n\n<p>Original version of the question:</p>\n\n<pre><code>-- Helpers\ncond = fmap (not . (== \"pause\")) getLine\nch b x y = if b then x else y\nch' :: a -&gt; a -&gt; Bool -&gt; a\nch' = flip . (flip ch)\n\n-- Main code\nf i i' = liftIO (print i) &gt;&gt; liftIO cond &gt;&gt;= ch' (f (i+1) i') (f' i'  i)\nf' i i' = liftIO (print i) &gt;&gt; liftIO cond &gt;&gt;= ch' (f' (i-1) i') (f i' i)\n</code></pre>\n"}, {"tags": ["haskell", "quickcheck"], "answers": [{"tags": [], "owner": {"reputation": 17809, "user_id": 1088108, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/63781cd38e91aa346a3849bc3ef3e550?s=128&d=identicon&r=PG&f=1", "display_name": "&#216;rjan Johansen", "link": "https://stackoverflow.com/users/1088108/%c3%98rjan-johansen"}, "is_accepted": true, "score": 8, "last_activity_date": 1442895069, "last_edit_date": 1442895069, "creation_date": 1442892820, "answer_id": 32707922, "question_id": 32707454, "link": "https://stackoverflow.com/questions/32707454/running-quickcheck-against-simple-test-w-function/32707922#32707922", "title": "Running QuickCheck against Simple Test w/ Function", "body": "<p>QuickCheck has a special module <a href=\"http://hackage.haskell.org/package/QuickCheck-2.8.1/docs/Test-QuickCheck-Function.html\"><code>Test.QuickCheck.Function</code></a> for generating \"functions\" that can be showed (and also \"shrinked\", which is how QuickCheck simplifies its counterexamples). You can convert them to ordinary functions using <code>apply</code>.  For example if you have the file:</p>\n\n<pre><code>import Test.QuickCheck\nimport Test.QuickCheck.Function\n\ntest :: Fun Int Int -&gt; Int -&gt; Bool\ntest _ _ = True\n\ntest2 :: Fun Int Int -&gt; Int -&gt; Bool\ntest2 f x = apply f x == x\n</code></pre>\n\n<p>Then in GHCi:</p>\n\n<pre><code>*Main&gt; quickCheck test\n+++ OK, passed 100 tests.\n*Main&gt; quickCheck test2\n*** Failed! Falsifiable (after 2 tests and 3 shrinks): \n{_-&gt;0}\n1\n</code></pre>\n\n<p>It <em>is</em> actually possible to define a <code>Show</code> instance for functions themselves, and use that.  But unless your input type is a finite type like <code>Bool</code>, you won't be able to print all information about the function this way.  You can import a dummy instance that shows <em>no</em> useful information from <code>Text.Show.Functions</code>.</p>\n\n<p>However, the <code>Test.QuickCheck.Function.Fun</code> type used above looks like it's been designed to give the essential information much more succinctly, so I'd certainly use that myself if possible.</p>\n"}], "owner": {"reputation": 37991, "user_id": 409976, "user_type": "registered", "accept_rate": 68, "profile_image": "https://www.gravatar.com/avatar/9ccda0b49cc974197399eae01ebd6850?s=128&d=identicon&r=PG", "display_name": "Kevin Meredith", "link": "https://stackoverflow.com/users/409976/kevin-meredith"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 115, "favorite_count": 1, "accepted_answer_id": 32707922, "answer_count": 1, "score": 7, "last_activity_date": 1442895069, "creation_date": 1442888858, "question_id": 32707454, "link": "https://stackoverflow.com/questions/32707454/running-quickcheck-against-simple-test-w-function", "title": "Running QuickCheck against Simple Test w/ Function", "body": "<p>Given the following:</p>\n\n<pre><code>test :: (Int -&gt; Int) -&gt; Int -&gt; Bool\ntest _ _ = True\n</code></pre>\n\n<p>After compiling the source, I try to run <code>quickCheck test</code>:</p>\n\n<pre><code>&gt; quickCheck test\n&lt;interactive&gt;:27:1:\n    No instance for (Show (Int -&gt; Int))\n      arising from a use of \u2018quickCheck\u2019\n    In the expression: quickCheck test\n    In an equation for \u2018it\u2019: it = quickCheck test\n</code></pre>\n\n<p>Looking at this <a href=\"https://wiki.haskell.org/Show_instance_for_functions\">Show instance for functions</a>, it appears to me that no such instance exists.</p>\n\n<p>How can I run <code>quickCheck test</code>, i.e. get around or address the missing <code>Show</code> instance for <code>Int -&gt; Int</code>?</p>\n"}, {"tags": ["haskell", "random"], "answers": [{"comments": [{"owner": {"reputation": 17809, "user_id": 1088108, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/63781cd38e91aa346a3849bc3ef3e550?s=128&d=identicon&r=PG&f=1", "display_name": "&#216;rjan Johansen", "link": "https://stackoverflow.com/users/1088108/%c3%98rjan-johansen"}, "edited": false, "score": 3, "creation_date": 1442895634, "post_id": 32707323, "comment_id": 53259766, "body": "Although that&#39;s a good way to start, those are not complete <code>do</code> blocks, because the last statement in one must be a single expression, not a <code>let ...</code> or <code>... &lt;- ...</code>."}], "tags": [], "owner": {"reputation": 21417, "user_id": 925978, "user_type": "registered", "accept_rate": 84, "profile_image": "https://www.gravatar.com/avatar/06e4467a5bd1538a92cefb20db07897a?s=128&d=identicon&r=PG&f=1", "display_name": "crockeea", "link": "https://stackoverflow.com/users/925978/crockeea"}, "is_accepted": false, "score": 6, "last_activity_date": 1442888364, "last_edit_date": 1442888364, "creation_date": 1442887837, "answer_id": 32707323, "question_id": 32707251, "link": "https://stackoverflow.com/questions/32707251/cant-generate-random-numbers/32707323#32707323", "title": "Can&#39;t generate random numbers", "body": "<p>I highly recommend one of the many great, free Haskell tutorials, such as <a href=\"http://learnyouahaskell.com/\">Learn You A Haskell</a> or <a href=\"http://book.realworldhaskell.org/\">Real World Haskell</a>. </p>\n\n<p>You can find more about <code>do</code> notation <a href=\"https://en.wikibooks.org/wiki/Haskell/do_notation\">here</a>.</p>\n\n<p>To specifically answer your question, you are misusing the <code>let</code> keyword with <code>do</code> notation. The basic rule is: if the answer is in a monad, you should use <code>&lt;-</code> with no <code>let</code>. If the value is not in a monad, write <code>let bla = ...</code>. You can write several such statements in a row without duplicating the <code>let</code> keyword:</p>\n\n<pre><code>do\n  x &lt;- y :: m a\n  let z = z1\n      z' = z2\n      ...\n  w &lt;- w' :: m b\n  z &lt;- z' :: m c\n...\n</code></pre>\n\n<p>Your code should be more like:</p>\n\n<pre><code>main :: IO ()\nmain = do\n  g &lt;- getStdGen\n  let bla = randomRs (0,360) g\n</code></pre>\n\n<p>An even better option is to use <a href=\"https://hackage.haskell.org/package/MonadRandom\"><code>MonadRandom</code></a> to hide the generator (state) completely:</p>\n\n<pre><code>include Control.Monad.Random\n\nmain :: IO ()\nmain = do\n  bla &lt;- getRandomR (0,360)\n</code></pre>\n"}], "owner": {"reputation": 2302, "user_id": 2054434, "user_type": "registered", "accept_rate": 51, "profile_image": "https://www.gravatar.com/avatar/e8f5c753d781ce498b857ec9b7ce366f?s=128&d=identicon&r=PG&f=1", "display_name": "PlayHardGoPro", "link": "https://stackoverflow.com/users/2054434/playhardgopro"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 343, "favorite_count": 1, "answer_count": 1, "score": 0, "last_activity_date": 1442888364, "creation_date": 1442887347, "question_id": 32707251, "link": "https://stackoverflow.com/questions/32707251/cant-generate-random-numbers", "title": "Can&#39;t generate random numbers", "body": "<p>I can't figure out how to generate random number.  </p>\n\n<p>Here is how I'm trying to do according to <a href=\"https://www.fpcomplete.com/school/starting-with-haskell/libraries-and-frameworks/randoms\" rel=\"nofollow\">this</a>:  </p>\n\n<pre><code>main :: IO ()\nmain = do\n  let\n     g &lt;- getStdGen\n     bla = randomRs (0, 360) g\n</code></pre>\n\n<p>Also tried:  </p>\n\n<pre><code>main :: IO ()\nmain = do\n  let\n    r &lt;- randomIO\n</code></pre>\n\n<p>then:  </p>\n\n<blockquote>\n  <p>parse error on input `&lt;-'\n  Perhaps this statement should be within a 'do' block? </p>\n</blockquote>\n"}, {"tags": ["haskell"], "answers": [{"tags": [], "owner": {"reputation": 126897, "user_id": 791604, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/ce991df7a056248d5e4f6fc3659ba733?s=128&d=identicon&r=PG", "display_name": "Daniel Wagner", "link": "https://stackoverflow.com/users/791604/daniel-wagner"}, "is_accepted": true, "score": 8, "last_activity_date": 1442886169, "creation_date": 1442886169, "answer_id": 32707105, "question_id": 32706873, "link": "https://stackoverflow.com/questions/32706873/how-come-par-uses-only-one-core-but-faster/32707105#32707105", "title": "How come `par` uses only one core but faster?", "body": "<blockquote>\n  <p>Why did it only use one core?</p>\n</blockquote>\n\n<p>Because you used the non-threaded runtime. Compile with <code>-threaded</code> to take advantage of the fancy new threaded runtime. But because of the answer to the second question, this won't help you on this microbenchmark: you've only written one core's worth of computation to do.</p>\n\n<blockquote>\n  <p>Why did it go faster?</p>\n</blockquote>\n\n<p>Because it computed less stuff: since the first argument to <code>par</code> is never used by the second argument, it gets stuffed into a spark that never gets demanded and hence never gets forced to do its work. On the other hand, <code>pseq</code> <em>always</em> does the work needed for its first argument, even when that value isn't used by its second argument.</p>\n"}], "owner": {"reputation": 5447, "user_id": 667027, "user_type": "registered", "accept_rate": 60, "profile_image": "https://www.gravatar.com/avatar/2cc242c4ce73c7e429f9f86f262d1844?s=128&d=identicon&r=PG", "display_name": "xzhu", "link": "https://stackoverflow.com/users/667027/xzhu"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 89, "favorite_count": 1, "accepted_answer_id": 32707105, "answer_count": 1, "score": 2, "last_activity_date": 1442886169, "creation_date": 1442884359, "question_id": 32706873, "link": "https://stackoverflow.com/questions/32706873/how-come-par-uses-only-one-core-but-faster", "title": "How come `par` uses only one core but faster?", "body": "<p>I'm trying to test the <code>parallel</code> package, specifically the <code>par</code> function. I wrote a simple program to test whether parallelism would speed up an otherwise sequential program.</p>\n\n<p>So here I wrote two scripts, first sequential:</p>\n\n<pre><code>import Control.Parallel\n\nn = 600000000\n\nmain = print $ pseq (mod (sum [1..n]) 5) (mod (sum [1..n]) 5)\n</code></pre>\n\n<p>second parallel:</p>\n\n<pre><code>import Control.Parallel\n\nn = 600000000\n\nmain = print $ par (mod (sum [1..n]) 5) (mod (sum [1..n]) 5)\n</code></pre>\n\n<p>And I compiled each one using <code>ghc -O2</code> and ran them, and then measured the running time using GNU <code>time</code>. Here is what I got:</p>\n\n<p>Sequential:</p>\n\n<pre><code>User time (seconds): 13.79\nSystem time (seconds): 0.04\nPercent of CPU this job got: 99%\nElapsed (wall clock) time (h:mm:ss or m:ss): 0:13.85\n</code></pre>\n\n<p>Parallel:</p>\n\n<pre><code>User time (seconds): 6.89\nSystem time (seconds): 0.05\nPercent of CPU this job got: 99%\nElapsed (wall clock) time (h:mm:ss or m:ss): 0:06.97\n</code></pre>\n\n<p>which is interesting but perplexing: how come the parallel version is two times faster, but used only one core?</p>\n"}, {"tags": ["haskell", "emacs", "elisp", "fold"], "answers": [{"comments": [{"owner": {"reputation": 26618, "user_id": 1283394, "user_type": "registered", "accept_rate": 83, "profile_image": "https://www.gravatar.com/avatar/6d7d7689f9562293f6106353a6b1a905?s=128&d=identicon&r=PG", "display_name": "Stefan", "link": "https://stackoverflow.com/users/1283394/stefan"}, "edited": false, "score": 0, "creation_date": 1442951453, "post_id": 32707167, "comment_id": 53293733, "body": "Please don&#39;t recommend <code>(setq lexical-binding t)</code> since it doesn&#39;t really do what you want in general.  Instead he should add <code>-*- lexical-binding:t -*-</code> to the beginning of the file where you writes this code (and re-open that file to make that annotation take effect)."}, {"owner": {"reputation": 27385, "user_id": 729907, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/HeXcc.png?s=128&g=1", "display_name": "Drew", "link": "https://stackoverflow.com/users/729907/drew"}, "reply_to_user": {"reputation": 26618, "user_id": 1283394, "user_type": "registered", "accept_rate": 83, "profile_image": "https://www.gravatar.com/avatar/6d7d7689f9562293f6106353a6b1a905?s=128&d=identicon&r=PG", "display_name": "Stefan", "link": "https://stackoverflow.com/users/1283394/stefan"}, "edited": false, "score": 0, "creation_date": 1442955681, "post_id": 32707167, "comment_id": 53296062, "body": "@Stefan: Yes, agreed, but there is no file here. That is, there is not necessarily a file. I took it that the code shown could be evaluated in other contexts - <code>*scratch*</code>, for example. The real point of the answer is that the OP code needs lexical binding."}, {"owner": {"reputation": 26618, "user_id": 1283394, "user_type": "registered", "accept_rate": 83, "profile_image": "https://www.gravatar.com/avatar/6d7d7689f9562293f6106353a6b1a905?s=128&d=identicon&r=PG", "display_name": "Stefan", "link": "https://stackoverflow.com/users/1283394/stefan"}, "edited": false, "score": 0, "creation_date": 1442965541, "post_id": 32707167, "comment_id": 53299725, "body": "sure, but don&#39;t give the rule as &quot;use setq ...&quot; since that&#39;s just a recipe for problems (including inducing a wrong mental model of how lexical-binding works)."}, {"owner": {"reputation": 706, "user_id": 3458802, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/wSpto.jpg?s=128&g=1", "display_name": "duthen", "link": "https://stackoverflow.com/users/3458802/duthen"}, "edited": false, "score": 0, "creation_date": 1443734152, "post_id": 32707167, "comment_id": 53623292, "body": "You just need the lexical binding for the <code>f</code> variable. Hence this should work:    <code>(defun mymap (f l)     (lexical-let ((f f))      (foldr (lambda (x z)               (cons (funcall f x) z))             nil             l)))</code>"}], "tags": [], "owner": {"reputation": 27385, "user_id": 729907, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/HeXcc.png?s=128&g=1", "display_name": "Drew", "link": "https://stackoverflow.com/users/729907/drew"}, "is_accepted": true, "score": 3, "last_activity_date": 1442886630, "creation_date": 1442886630, "answer_id": 32707167, "question_id": 32706529, "link": "https://stackoverflow.com/questions/32706529/implementing-map-using-foldr-in-emacs-lisp/32707167#32707167", "title": "Implementing map using foldr in Emacs Lisp", "body": "<pre><code>(setq lexical-binding t)\n</code></pre>\n\n<p><code>f</code> is a free variable in the lambda form you pass to <code>foldr</code>.</p>\n\n<p>With lexical binding, your example works fine:</p>\n\n<pre><code>(map (lambda (x) (+ x 1)) '(1 2 3 4 5)) ; ==&gt; (2 3 4 5 6)\n</code></pre>\n"}], "owner": {"reputation": 43, "user_id": 3854518, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/pK6kd.jpg?s=128&g=1", "display_name": "rodamber", "link": "https://stackoverflow.com/users/3854518/rodamber"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 195, "favorite_count": 0, "accepted_answer_id": 32707167, "answer_count": 1, "score": 4, "last_activity_date": 1442898143, "creation_date": 1442881710, "last_edit_date": 1442898143, "question_id": 32706529, "link": "https://stackoverflow.com/questions/32706529/implementing-map-using-foldr-in-emacs-lisp", "title": "Implementing map using foldr in Emacs Lisp", "body": "<p>I'm starting to learn Emacs Lisp and as an exercise I'm trying to implement map using foldr. The code is the following:</p>\n\n<pre><code>(defun foldr (f z l)\n   (if (null l)\n       z\n       (funcall f (car l)\n                  (foldr f z\n                           (cdr l)))))\n\n(defun map (f l)\n   (foldr (lambda (x z)\n            (cons (funcall f x) z))\n          nil\n          l))\n</code></pre>\n\n<p>However, when I try to evaluate, for example,</p>\n\n<pre><code>(map (lambda (x) (+ x 1)) '(1 2 3 4 5))\n</code></pre>\n\n<p>in Emacs with eval-last-sexp (after evaluating both foldr and map), the result is the following:</p>\n\n<pre><code>Debugger entered--Lisp error: (wrong-number-of-arguments (lambda (x z) (cons (funcall f x) z)) 1)\n  (lambda (x z) (cons (funcall f x) z))(5)\n  funcall((lambda (x z) (cons (funcall f x) z)) 5)\n  (cons (funcall f x) z)\n  (lambda (x z) (cons (funcall f x) z))(5 nil)\n  funcall((lambda (x z) (cons (funcall f x) z)) 5 nil)\n  (if (null l) z (funcall f (car l) (foldr f z (cdr l))))\n  foldr((lambda (x z) (cons (funcall f x) z)) nil (5))\n  (funcall f (car l) (foldr f z (cdr l)))\n  (if (null l) z (funcall f (car l) (foldr f z (cdr l))))\n  foldr((lambda (x z) (cons (funcall f x) z)) nil (4 5))\n  (funcall f (car l) (foldr f z (cdr l)))\n  (if (null l) z (funcall f (car l) (foldr f z (cdr l))))\n  foldr((lambda (x z) (cons (funcall f x) z)) nil (3 4 5))\n  (funcall f (car l) (foldr f z (cdr l)))\n  (if (null l) z (funcall f (car l) (foldr f z (cdr l))))\n  foldr((lambda (x z) (cons (funcall f x) z)) nil (2 3 4 5))\n  (funcall f (car l) (foldr f z (cdr l)))\n  (if (null l) z (funcall f (car l) (foldr f z (cdr l))))\n  foldr((lambda (x z) (cons (funcall f x) z)) nil (1 2 3 4 5))\n  map((lambda (x) (+ x 1)) (1 2 3 4 5))\n  eval((map (function (lambda (x) (+ x 1))) (quote (1 2 3 4 5))) nil)\n  eval-last-sexp-1(nil)\n  #[257 \"\\204\\303!\\207  \\303!\\n)B\\211A  =\\204\\211A\\211@\\207\" [eval-expression-debug-on-error eval-last-sexp-fake-value debug-on-error eval-last-sexp-1] 4 2471606 \"P\"](nil)\n  ad-Advice-eval-last-sexp(#[257 \"\\204\\303!\\207 \\303!\\n)B\\211A  =\\204\\211A\\211@\\207\" [eval-expression-debug-on-error eval-last-sexp-fake-value debug-on-error eval-last-sexp-1] 4 2471606 \"P\"] nil)\n  apply(ad-Advice-eval-last-sexp #[257 \"\\204\\303!\\207   \\303!\\n)B\\211A  =\\204\\211A\\211@\\207\" [eval-expression-debug-on-error eval-last-sexp-fake-value debug-on-error eval-last-sexp-1] 4 2471606 \"P\"] nil)\n  eval-last-sexp(nil)\n  call-interactively(eval-last-sexp nil nil)\n  command-execute(eval-last-sexp)\n</code></pre>\n\n<p>I don't understand why this doesn't work, when the following super similar implementation in Haskell works fine:</p>\n\n<pre><code>foldr f z l = if (null l)\n              then z\n              else f (head l) (foldr f z (tail l))\n\nmap f l = foldr (\\ x z -&gt; (:) (f x) z) [] l\n</code></pre>\n\n<p>So why aren't the Lisp and Haskell programs equivalent? What's the nature of the problem in the Lisp implementation, i.e., why isn't map working?</p>\n"}, {"tags": ["performance", "haskell"], "comments": [{"owner": {"reputation": 44013, "user_id": 1477667, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/trgKM.jpg?s=128&g=1", "display_name": "dfeuer", "link": "https://stackoverflow.com/users/1477667/dfeuer"}, "edited": false, "score": 0, "creation_date": 1442867783, "post_id": 32703519, "comment_id": 53251661, "body": "For performance tuning: it looks like <code>STT s Identity</code> will have some allocation overhead over the usual <code>ST s</code>; if you don&#39;t need the peculiar <code>STT</code> powers, you might want to just use <code>ST</code>."}, {"owner": {"reputation": 4185, "user_id": 1424121, "user_type": "registered", "accept_rate": 62, "profile_image": "https://www.gravatar.com/avatar/c6f5c5cd761b9ce4493fd875cc041ac3?s=128&d=identicon&r=PG", "display_name": "ryachza", "link": "https://stackoverflow.com/users/1424121/ryachza"}, "reply_to_user": {"reputation": 44013, "user_id": 1477667, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/trgKM.jpg?s=128&g=1", "display_name": "dfeuer", "link": "https://stackoverflow.com/users/1477667/dfeuer"}, "edited": false, "score": 0, "creation_date": 1442871310, "post_id": 32703519, "comment_id": 53253366, "body": "@dfeuer Indeed I may remove it, but I put it in the implementation initially expecting to need to embed <code>Either</code> and it got transferred over. Thanks for the tip!"}], "answers": [{"comments": [{"owner": {"reputation": 4185, "user_id": 1424121, "user_type": "registered", "accept_rate": 62, "profile_image": "https://www.gravatar.com/avatar/c6f5c5cd761b9ce4493fd875cc041ac3?s=128&d=identicon&r=PG", "display_name": "ryachza", "link": "https://stackoverflow.com/users/1424121/ryachza"}, "edited": false, "score": 0, "creation_date": 1442871456, "post_id": 32704031, "comment_id": 53253428, "body": "Thanks this worked perfectly. I tried several strictness annotations and different fold methods but my focus was always on the arguments not the application. The thought that it was the write value never crossed my mind."}, {"owner": {"reputation": 126897, "user_id": 791604, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/ce991df7a056248d5e4f6fc3659ba733?s=128&d=identicon&r=PG", "display_name": "Daniel Wagner", "link": "https://stackoverflow.com/users/791604/daniel-wagner"}, "reply_to_user": {"reputation": 4185, "user_id": 1424121, "user_type": "registered", "accept_rate": 62, "profile_image": "https://www.gravatar.com/avatar/c6f5c5cd761b9ce4493fd875cc041ac3?s=128&d=identicon&r=PG", "display_name": "ryachza", "link": "https://stackoverflow.com/users/1424121/ryachza"}, "edited": false, "score": 0, "creation_date": 1442879355, "post_id": 32704031, "comment_id": 53255966, "body": "@ryachza Indeed, it is a subtle error, one that was burned into my brain by the despair of a late-night, last-minute debugging session..."}], "tags": [], "owner": {"reputation": 126897, "user_id": 791604, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/ce991df7a056248d5e4f6fc3659ba733?s=128&d=identicon&r=PG", "display_name": "Daniel Wagner", "link": "https://stackoverflow.com/users/791604/daniel-wagner"}, "is_accepted": true, "score": 15, "last_activity_date": 1442869757, "last_edit_date": 1442869757, "creation_date": 1442867383, "answer_id": 32704031, "question_id": 32703519, "link": "https://stackoverflow.com/questions/32703519/monadic-fold-in-constant-space/32704031#32704031", "title": "Monadic Fold in Constant Space", "body": "<p>The problem is not with the fold, but with the fold body. This program allocates a lot:</p>\n\n<pre><code>testST = runST $ do\n    ref &lt;- newSTRef 0\n    forM_ [1..10000000] $ \\x -&gt; do\n         val &lt;- readSTRef ref\n         writeSTRef ref (val + x)\n    readSTRef ref\n</code></pre>\n\n<p>This program, whose only difference is on the <code>writeSTRef</code> line, allocates almost nothing:</p>\n\n<pre><code>testST = runST $ do\n    ref &lt;- newSTRef 0\n    forM_ [1..10000000] $ \\x -&gt; do\n        val &lt;- readSTRef ref\n        writeSTRef ref $! val + x\n    readSTRef ref\n</code></pre>\n\n<p>The difference between the two pieces of code is a good hint to what's going on: in the former, you are creating a reference to a deeply-nested thunk with 10000000 layers of applications of <code>+</code>; whereas the latter flattens the thunk at each step.</p>\n\n<p>By the way, this common pitfall is <a href=\"https://hackage.haskell.org/package/base-4.7.0.2/docs/Data-STRef.html#v:modifySTRef\">explicitly called out in the documentation for <code>modifySTRef</code></a>.</p>\n"}], "owner": {"reputation": 4185, "user_id": 1424121, "user_type": "registered", "accept_rate": 62, "profile_image": "https://www.gravatar.com/avatar/c6f5c5cd761b9ce4493fd875cc041ac3?s=128&d=identicon&r=PG", "display_name": "ryachza", "link": "https://stackoverflow.com/users/1424121/ryachza"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 136, "favorite_count": 0, "accepted_answer_id": 32704031, "answer_count": 1, "score": 9, "last_activity_date": 1442869757, "creation_date": 1442865467, "question_id": 32703519, "link": "https://stackoverflow.com/questions/32703519/monadic-fold-in-constant-space", "title": "Monadic Fold in Constant Space", "body": "<p>How can I fold a lazy list using a monadic action in constant space? The problem I'm trying to solve is aggregating a large file, and I believe for the sake of performance I require mutability. I have an implementation working in ST using mutable vectors, but it uses too much memory. Below is an example of what I'm attempting. I also experimented briefly with Conduit but that didn't appear to provide any improvement.</p>\n\n<p>ST forM_:</p>\n\n<pre><code>import Control.Monad (forM_)\nimport Control.Monad.ST.Trans as STT\nimport Control.Monad.Identity as Identity\n\ntestST :: Int\ntestST = do\n  Identity.runIdentity $ STT.runST $ do\n    a &lt;- STT.newSTRef 0\n    forM_ [1..10000000] (\\x -&gt; do\n        a' &lt;- STT.readSTRef a\n        STT.writeSTRef a (a' + x)\n      )\n    STT.readSTRef a\n</code></pre>\n\n<p>Conduit:</p>\n\n<pre><code>import Data.Conduit (($=),(=$),($$))\nimport qualified Data.Conduit as C\nimport qualified Data.Conduit.List as CL\n\ntestCL :: IO Int\ntestCL = CL.sourceList [1..10000000] $$ CL.foldM (\\a x -&gt; return (a + x)) 0\n</code></pre>\n"}, {"tags": ["haskell", "floating-point", "precision"], "comments": [{"owner": {"reputation": 15757, "user_id": 176841, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/45a168cb9eb8454d66c78f18e29d9342?s=128&d=identicon&r=PG", "display_name": "jberryman", "link": "https://stackoverflow.com/users/176841/jberryman"}, "edited": false, "score": 1, "creation_date": 1442875715, "post_id": 32703276, "comment_id": 53254877, "body": "It might be nice if GHC would warn you of unrepresentable floating point literals, the way it does with out of range integrals. Maybe you could open a ticket on the GHC trac"}, {"owner": {"reputation": 14582, "user_id": 2225384, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/f30b04ed4d0b3fc4bc791a28815f34ca?s=128&d=identicon&r=PG", "display_name": "Rein Henrichs", "link": "https://stackoverflow.com/users/2225384/rein-henrichs"}, "edited": false, "score": 1, "creation_date": 1442876924, "post_id": 32703276, "comment_id": 53255304, "body": "You should use <code>Double</code> for all real-world code involving floating point numbers unless you have a very specific need for <code>Float</code>."}, {"owner": {"reputation": 44013, "user_id": 1477667, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/trgKM.jpg?s=128&g=1", "display_name": "dfeuer", "link": "https://stackoverflow.com/users/1477667/dfeuer"}, "reply_to_user": {"reputation": 15757, "user_id": 176841, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/45a168cb9eb8454d66c78f18e29d9342?s=128&d=identicon&r=PG", "display_name": "jberryman", "link": "https://stackoverflow.com/users/176841/jberryman"}, "edited": false, "score": 1, "creation_date": 1442882560, "post_id": 32703276, "comment_id": 53256759, "body": "@jberryman, most fractional floating point literals cannot be represented exactly. While the suggestion has much merit, I suspect it would annoy too many people and lead to too much confusion."}], "answers": [{"tags": [], "owner": {"reputation": 78982, "user_id": 1848654, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/84180c0f3c9c04f8b8f0613fc0129dac?s=128&d=identicon&r=PG", "display_name": "melpomene", "link": "https://stackoverflow.com/users/1848654/melpomene"}, "is_accepted": false, "score": 5, "last_activity_date": 1442865508, "creation_date": 1442865508, "answer_id": 32703534, "question_id": 32703276, "link": "https://stackoverflow.com/questions/32703276/type-conversion-and-equality-behaviour/32703534#32703534", "title": "Type conversion and equality behaviour", "body": "<p>Your code can be simplified to:</p>\n\n<pre><code>&gt; (1.00000001 :: Float) == 1\nTrue\n</code></pre>\n\n<p>Looks like <code>Float</code> simply doesn't have enough precision to store the last bits of <code>1.00000001</code>, so it gets truncated to plain <code>1</code>.</p>\n"}, {"comments": [{"owner": {"reputation": 22266, "user_id": 649287, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/7c0ea0055b84020bf860c05f53ba53d5?s=128&d=identicon&r=PG", "display_name": "augustss", "link": "https://stackoverflow.com/users/649287/augustss"}, "edited": false, "score": 1, "creation_date": 1442873478, "post_id": 32703579, "comment_id": 53254148, "body": "It&#39;s not the == that is inaccurate, it does its job perfectly.  It&#39;s the numeric literal that is too inexact as a Float."}, {"owner": {"reputation": 44013, "user_id": 1477667, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/trgKM.jpg?s=128&g=1", "display_name": "dfeuer", "link": "https://stackoverflow.com/users/1477667/dfeuer"}, "reply_to_user": {"reputation": 22266, "user_id": 649287, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/7c0ea0055b84020bf860c05f53ba53d5?s=128&d=identicon&r=PG", "display_name": "augustss", "link": "https://stackoverflow.com/users/649287/augustss"}, "edited": false, "score": 0, "creation_date": 1442873804, "post_id": 32703579, "comment_id": 53254261, "body": "@augustss, indeed, there is a threshold that one example crosses and the other does not. The main idea I was trying to convey is that floating point is fussy and does not always &quot;make sense&quot;."}], "tags": [], "owner": {"reputation": 44013, "user_id": 1477667, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/trgKM.jpg?s=128&g=1", "display_name": "dfeuer", "link": "https://stackoverflow.com/users/1477667/dfeuer"}, "is_accepted": true, "score": 7, "last_activity_date": 1442873981, "last_edit_date": 1442873981, "creation_date": 1442865678, "answer_id": 32703579, "question_id": 32703276, "link": "https://stackoverflow.com/questions/32703276/type-conversion-and-equality-behaviour/32703579#32703579", "title": "Type conversion and equality behaviour", "body": "<p>Floating point operations are generally approximate, and <code>==</code> is not one of the exceptions to that rule. Single-precision floating point (<code>Float</code>) runs out of precision pretty quickly, while the more-generally-useful double-precision floating point (<code>Double</code>) has some more. In either case, your decimal fraction will be converted approximately to binary floating point, and then the equality test will also be approximate. General rule: floating point representations are not numbers, and they are not even legitimate instances of the <code>Eq</code> class. If you want to use them, you need to pay attention to their limitations.</p>\n\n<p>In this case, you need to think about when you want to consider the integer equal to the floating point representation. You may or may not want to rely directly on the built-in comparison and rounding operations.</p>\n\n<p>For some of the details you'll have to think about, check out the classic <a href=\"http://docs.oracle.com/cd/E19957-01/806-3568/ncg_goldberg.html\" rel=\"nofollow\">What Every Computer Scientist Should Know About Floating-Point Arithmetic</a>, and don't skip the corrections and updates in the footnotes.</p>\n"}, {"comments": [{"owner": {"reputation": 126897, "user_id": 791604, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/ce991df7a056248d5e4f6fc3659ba733?s=128&d=identicon&r=PG", "display_name": "Daniel Wagner", "link": "https://stackoverflow.com/users/791604/daniel-wagner"}, "edited": false, "score": 1, "creation_date": 1442879180, "post_id": 32703661, "comment_id": 53255924, "body": "While it&#39;s true that <code>1&#47;10^n</code> can&#39;t be represented exactly, that&#39;s not really related to the problem."}, {"owner": {"reputation": 3667, "user_id": 3288910, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/b2c2b8044eca80b9a707c716c530d9f5?s=128&d=identicon&r=PG", "display_name": "Jason", "link": "https://stackoverflow.com/users/3288910/jason"}, "reply_to_user": {"reputation": 126897, "user_id": 791604, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/ce991df7a056248d5e4f6fc3659ba733?s=128&d=identicon&r=PG", "display_name": "Daniel Wagner", "link": "https://stackoverflow.com/users/791604/daniel-wagner"}, "edited": false, "score": 0, "creation_date": 1442883858, "post_id": 32703661, "comment_id": 53257050, "body": "The actual representation in IEEE 754 largely affects the result.  However, a representable value could also be truncated due to precision."}, {"owner": {"reputation": 126897, "user_id": 791604, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/ce991df7a056248d5e4f6fc3659ba733?s=128&d=identicon&r=PG", "display_name": "Daniel Wagner", "link": "https://stackoverflow.com/users/791604/daniel-wagner"}, "edited": false, "score": 1, "creation_date": 1442885679, "post_id": 32703661, "comment_id": 53257422, "body": "You can see the same problem when calling <code>mystery</code> with final arguments of <code>1.000000007450580596923828125</code> and <code>1.00000011920928955078125</code>,  which are both exactly representable in base-2 floating point. The problem here is one of precision, not representability."}, {"owner": {"reputation": 3667, "user_id": 3288910, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/b2c2b8044eca80b9a707c716c530d9f5?s=128&d=identicon&r=PG", "display_name": "Jason", "link": "https://stackoverflow.com/users/3288910/jason"}, "reply_to_user": {"reputation": 126897, "user_id": 791604, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/ce991df7a056248d5e4f6fc3659ba733?s=128&d=identicon&r=PG", "display_name": "Daniel Wagner", "link": "https://stackoverflow.com/users/791604/daniel-wagner"}, "edited": false, "score": 0, "creation_date": 1442885994, "post_id": 32703661, "comment_id": 53257522, "body": "Exactly, but a fractional value being larger than another fractional value doesn&#39;t imply that it needs less precision to be represented.  The mantissa may just not have enough bits."}], "tags": [], "owner": {"reputation": 3667, "user_id": 3288910, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/b2c2b8044eca80b9a707c716c530d9f5?s=128&d=identicon&r=PG", "display_name": "Jason", "link": "https://stackoverflow.com/users/3288910/jason"}, "is_accepted": false, "score": 3, "last_activity_date": 1442873945, "last_edit_date": 1442873945, "creation_date": 1442865968, "answer_id": 32703661, "question_id": 32703276, "link": "https://stackoverflow.com/questions/32703276/type-conversion-and-equality-behaviour/32703661#32703661", "title": "Type conversion and equality behaviour", "body": "<p><code>1/10^n</code> can't be represented in base2 floating point (IEEE 754), so the value is probably truncated.</p>\n\n<p>Semantically, for integer comparison it's probably more accurate to <code>truncate</code> the floating point value.</p>\n\n<pre><code>mystery :: Int -&gt; Int -&gt; Float -&gt; Bool\nmystery x y z = not (x == y &amp;&amp; y == truncate z)\n</code></pre>\n"}], "owner": {"reputation": 6440, "user_id": 3768332, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/qXVHN.jpg?s=128&g=1", "display_name": "Jamie Counsell", "link": "https://stackoverflow.com/users/3768332/jamie-counsell"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 108, "favorite_count": 0, "accepted_answer_id": 32703579, "answer_count": 3, "score": 1, "last_activity_date": 1442873981, "creation_date": 1442864545, "last_edit_date": 1442866103, "question_id": 32703276, "link": "https://stackoverflow.com/questions/32703276/type-conversion-and-equality-behaviour", "title": "Type conversion and equality behaviour", "body": "<p>I'm new to Haskell, and just stumbled across this problem. I'm trying to figure out an explaination, but I don't have enough experience with Haskell types to be sure.</p>\n\n<p>The function:</p>\n\n<pre><code>mystery :: Int -&gt; Int -&gt; Float -&gt; Bool\nmystery x y z = not ((x==y) &amp;&amp; ((fromIntegral y) == z ))\n</code></pre>\n\n<p>behaves as it seems like it would. It's basically checking if the values are all NOT equal, but doing a type conversion from an <code>Integral</code> <code>y</code> to make sure it can be compared with <code>z</code></p>\n\n<p>If this is true, then why does:</p>\n\n<pre><code>case1 = do \n    if mystery 1 1 1.00000001 -- a very small number\n        then putStrLn \"True\"\n        else putStrLn \"False\"\n</code></pre>\n\n<p>Print False (ie. The values are all equal, so <code>1 == 1 == 1.00000001</code>) whereas:</p>\n\n<pre><code>case2 = do \n    if mystery 1 1 1.0000001 -- a larger number\n        then putStrLn \"True\"\n        else putStrLn \"False\"\n</code></pre>\n\n<p>Prints True? (ie. The values are not all equal)</p>\n\n<p>I know it likely has something to do with precision, but I don't get it. Any help is greatly appreciated.</p>\n"}, {"tags": ["haskell", "cabal", "cabal-install", "haddock"], "comments": [{"owner": {"reputation": 84731, "user_id": 510937, "user_type": "registered", "accept_rate": 80, "profile_image": "https://www.gravatar.com/avatar/70b13a9ae1aae1ca1aa6ac8dab4643f2?s=128&d=identicon&r=PG", "display_name": "Bakuriu", "link": "https://stackoverflow.com/users/510937/bakuriu"}, "edited": false, "score": 0, "creation_date": 1442859537, "post_id": 32701705, "comment_id": 53247129, "body": "I don&#39;t remember: does haddock fail to build if you link to something that doesn&#39;t exists? Like using <code>&#39;MyModule&#39;</code> and you have no <code>MyModule</code> available. Because if it simply gives a warning and continue to run then the behaviour is required: any change to existing files or addition of files could modify the output of the other modules&#39; documentation."}, {"owner": {"reputation": 49959, "user_id": 866915, "user_type": "registered", "accept_rate": 70, "profile_image": "https://www.gravatar.com/avatar/09242131d6e17cbbe31e8547514da6e5?s=128&d=identicon&r=PG", "display_name": "ErikR", "link": "https://stackoverflow.com/users/866915/erikr"}, "edited": false, "score": 0, "creation_date": 1442859957, "post_id": 32701705, "comment_id": 53247381, "body": "I believe a lot of time is spent rebuilding the global index pages. A lot of time could be saved if those pages were not built. Use the -v flag with cabal to see what haddock commands are being executed."}, {"owner": {"reputation": 21417, "user_id": 925978, "user_type": "registered", "accept_rate": 84, "profile_image": "https://www.gravatar.com/avatar/06e4467a5bd1538a92cefb20db07897a?s=128&d=identicon&r=PG&f=1", "display_name": "crockeea", "link": "https://stackoverflow.com/users/925978/crockeea"}, "reply_to_user": {"reputation": 84731, "user_id": 510937, "user_type": "registered", "accept_rate": 80, "profile_image": "https://www.gravatar.com/avatar/70b13a9ae1aae1ca1aa6ac8dab4643f2?s=128&d=identicon&r=PG", "display_name": "Bakuriu", "link": "https://stackoverflow.com/users/510937/bakuriu"}, "edited": false, "score": 0, "creation_date": 1442860016, "post_id": 32701705, "comment_id": 53247422, "body": "@Bakuriu If I add a random <code>import ModuleDoesNotExist</code> to the top of a file, haddock short circuits and does not output any documentation. If I force any other sort of compile error (e.g. a syntax error), haddock outputs documentation up to the module with the error, but then short circuits and does not output documentation for the rest of the modules."}, {"owner": {"reputation": 21417, "user_id": 925978, "user_type": "registered", "accept_rate": 84, "profile_image": "https://www.gravatar.com/avatar/06e4467a5bd1538a92cefb20db07897a?s=128&d=identicon&r=PG&f=1", "display_name": "crockeea", "link": "https://stackoverflow.com/users/925978/crockeea"}, "reply_to_user": {"reputation": 49959, "user_id": 866915, "user_type": "registered", "accept_rate": 70, "profile_image": "https://www.gravatar.com/avatar/09242131d6e17cbbe31e8547514da6e5?s=128&d=identicon&r=PG", "display_name": "ErikR", "link": "https://stackoverflow.com/users/866915/erikr"}, "edited": false, "score": 0, "creation_date": 1442863051, "post_id": 32701705, "comment_id": 53249119, "body": "@user5402 Added link in question."}, {"owner": {"reputation": 49959, "user_id": 866915, "user_type": "registered", "accept_rate": 70, "profile_image": "https://www.gravatar.com/avatar/09242131d6e17cbbe31e8547514da6e5?s=128&d=identicon&r=PG", "display_name": "ErikR", "link": "https://stackoverflow.com/users/866915/erikr"}, "edited": false, "score": 0, "creation_date": 1442882071, "post_id": 32701705, "comment_id": 53256611, "body": "How much time is it taking? As an experiment I built the docs for parsec with <code>cabal haddock</code> and it only took a few seconds. However, if I run <code>cabal install</code> it will take a lot longer because the global index files have to be regenerated. So how big is your code? Exactly what commands are you running and how long are these commands taking?"}, {"owner": {"reputation": 21417, "user_id": 925978, "user_type": "registered", "accept_rate": 84, "profile_image": "https://www.gravatar.com/avatar/06e4467a5bd1538a92cefb20db07897a?s=128&d=identicon&r=PG&f=1", "display_name": "crockeea", "link": "https://stackoverflow.com/users/925978/crockeea"}, "reply_to_user": {"reputation": 49959, "user_id": 866915, "user_type": "registered", "accept_rate": 70, "profile_image": "https://www.gravatar.com/avatar/09242131d6e17cbbe31e8547514da6e5?s=128&d=identicon&r=PG", "display_name": "ErikR", "link": "https://stackoverflow.com/users/866915/erikr"}, "edited": false, "score": 0, "creation_date": 1442884477, "post_id": 32701705, "comment_id": 53257193, "body": "@user5402 I&#39;m not running <code>cabal install</code> at all. <code>cabal clean; configure; haddock</code> takes 41 seconds, as does <code>cabal clean; configure; build; haddock</code>. The library is quite large."}, {"owner": {"reputation": 49959, "user_id": 866915, "user_type": "registered", "accept_rate": 70, "profile_image": "https://www.gravatar.com/avatar/09242131d6e17cbbe31e8547514da6e5?s=128&d=identicon&r=PG", "display_name": "ErikR", "link": "https://stackoverflow.com/users/866915/erikr"}, "edited": false, "score": 0, "creation_date": 1442889957, "post_id": 32701705, "comment_id": 53258483, "body": "how long is the <code>cabal haddock</code> command taking?"}, {"owner": {"reputation": 21417, "user_id": 925978, "user_type": "registered", "accept_rate": 84, "profile_image": "https://www.gravatar.com/avatar/06e4467a5bd1538a92cefb20db07897a?s=128&d=identicon&r=PG&f=1", "display_name": "crockeea", "link": "https://stackoverflow.com/users/925978/crockeea"}, "reply_to_user": {"reputation": 49959, "user_id": 866915, "user_type": "registered", "accept_rate": 70, "profile_image": "https://www.gravatar.com/avatar/09242131d6e17cbbe31e8547514da6e5?s=128&d=identicon&r=PG", "display_name": "ErikR", "link": "https://stackoverflow.com/users/866915/erikr"}, "edited": false, "score": 0, "creation_date": 1442890760, "post_id": 32701705, "comment_id": 53258633, "body": "@user5402 The 41 seconds was just for the <code>cabal haddock</code> part, in both cases. Building takes a long time on its own, but I didn&#39;t include that time above."}], "answers": [{"comments": [{"owner": {"reputation": 21417, "user_id": 925978, "user_type": "registered", "accept_rate": 84, "profile_image": "https://www.gravatar.com/avatar/06e4467a5bd1538a92cefb20db07897a?s=128&d=identicon&r=PG&f=1", "display_name": "crockeea", "link": "https://stackoverflow.com/users/925978/crockeea"}, "edited": false, "score": 0, "creation_date": 1443534762, "post_id": 32845587, "comment_id": 53525547, "body": "<code>cabal haddock --haddock-options=--verbosity=2</code> doesn&#39;t print anything about &quot;creating interfaces&quot; or &quot;attaching instances&quot;."}, {"owner": {"reputation": 11487, "user_id": 1308058, "user_type": "registered", "accept_rate": 61, "profile_image": "https://www.gravatar.com/avatar/2be2ab74793559ea1c1dbdf55ccdf90b?s=128&d=identicon&r=PG", "display_name": "phadej", "link": "https://stackoverflow.com/users/1308058/phadej"}, "reply_to_user": {"reputation": 21417, "user_id": 925978, "user_type": "registered", "accept_rate": 84, "profile_image": "https://www.gravatar.com/avatar/06e4467a5bd1538a92cefb20db07897a?s=128&d=identicon&r=PG&f=1", "display_name": "crockeea", "link": "https://stackoverflow.com/users/925978/crockeea"}, "edited": false, "score": 0, "creation_date": 1443535745, "post_id": 32845587, "comment_id": 53526308, "body": "@Erik, it seems you have to give <code>-v3</code> to <code>cabal</code> to get <code>haddock</code> verbose output. OTOH it seems that most time is spend in between <code>Creating interfaces...</code> and <code>Attacing instances</code>. Maybe there is an optimisation opportunity."}, {"owner": {"reputation": 21417, "user_id": 925978, "user_type": "registered", "accept_rate": 84, "profile_image": "https://www.gravatar.com/avatar/06e4467a5bd1538a92cefb20db07897a?s=128&d=identicon&r=PG&f=1", "display_name": "crockeea", "link": "https://stackoverflow.com/users/925978/crockeea"}, "edited": false, "score": 0, "creation_date": 1443536532, "post_id": 32845587, "comment_id": 53526914, "body": "&quot;Attaching instances&quot; and &quot;Creating interfaces&quot; are both basically instantaneous, but the &quot;Checking module&quot; step takes a noticeable amount of time for each module."}, {"owner": {"reputation": 11487, "user_id": 1308058, "user_type": "registered", "accept_rate": 61, "profile_image": "https://www.gravatar.com/avatar/2be2ab74793559ea1c1dbdf55ccdf90b?s=128&d=identicon&r=PG", "display_name": "phadej", "link": "https://stackoverflow.com/users/1308058/phadej"}, "reply_to_user": {"reputation": 21417, "user_id": 925978, "user_type": "registered", "accept_rate": 84, "profile_image": "https://www.gravatar.com/avatar/06e4467a5bd1538a92cefb20db07897a?s=128&d=identicon&r=PG&f=1", "display_name": "crockeea", "link": "https://stackoverflow.com/users/925978/crockeea"}, "edited": false, "score": 0, "creation_date": 1443537098, "post_id": 32845587, "comment_id": 53527370, "body": "Ok. There is an intermediate type <a href=\"https://github.com/haskell/haddock/blob/master/haddock-api/src/Haddock/Interface.hs#L168\" rel=\"nofollow noreferrer\"><code>TypecheckedModule</code></a> which looks like it could be possible to serialise to disk and back, but I don&#39;t know enough about GHC internals if something is happening in <code>Ghc</code> monad, that need to be preserved as well. It&#39;s better to turn to <code>ghc-dev</code> or <code>haddock</code> issue tracker from here."}], "tags": [], "owner": {"reputation": 11487, "user_id": 1308058, "user_type": "registered", "accept_rate": 61, "profile_image": "https://www.gravatar.com/avatar/2be2ab74793559ea1c1dbdf55ccdf90b?s=128&d=identicon&r=PG", "display_name": "phadej", "link": "https://stackoverflow.com/users/1308058/phadej"}, "is_accepted": false, "score": 1, "last_activity_date": 1443534188, "creation_date": 1443534188, "answer_id": 32845587, "question_id": 32701705, "link": "https://stackoverflow.com/questions/32701705/differential-documentation-with-haddock/32845587#32845587", "title": "Differential Documentation with haddock", "body": "<p><a href=\"http://hackage.haskell.org/package/haddock-api-2.16.1/docs/Documentation-Haddock.html#v:processModules\" rel=\"nofollow\">processModules</a> documentation says:</p>\n\n<blockquote>\n  <p>Create Interfaces and a link environment by typechecking the list of modules using the GHC API and processing the resulting syntax trees.</p>\n</blockquote>\n\n<p>And that is the core function of <code>haddock</code>. So ATM the answer your question is <em>No</em>.</p>\n\n<p><code>cabal build</code> doesn't help <code>cabal haddock</code> at all, as <code>haddock</code> type-checks modules with different parameters (e.g. <code>__HADDOCK__</code> CPP variable enabled)</p>\n\n<p>Making reliable incremental haddock generation is hard, as the code later in the dependency graph can alter the modules documentation previous to that point: particularly the instances listings. Probably one could dump module interfaces.</p>\n\n<p>Looking <a href=\"https://github.com/haskell/haddock/blob/master/haddock-api/src/Haddock/Interface.hs#L72\" rel=\"nofollow\">at the code of <code>processModules</code></a> the first step is something that could be possible to do incrementally, rest is using global information.</p>\n\n<p>Try turn verbosity to the max i.e. <code>--haddock-options=--verbosity=2</code> and check how much time is spent between <code>Creating interfaces...</code> and <code>Attaching instances...</code>.</p>\n"}], "owner": {"reputation": 21417, "user_id": 925978, "user_type": "registered", "accept_rate": 84, "profile_image": "https://www.gravatar.com/avatar/06e4467a5bd1538a92cefb20db07897a?s=128&d=identicon&r=PG&f=1", "display_name": "crockeea", "link": "https://stackoverflow.com/users/925978/crockeea"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 219, "favorite_count": 1, "answer_count": 1, "score": 7, "last_activity_date": 1443534188, "creation_date": 1442858244, "last_edit_date": 1442863043, "question_id": 32701705, "link": "https://stackoverflow.com/questions/32701705/differential-documentation-with-haddock", "title": "Differential Documentation with haddock", "body": "<p>If I do a <code>cabal build</code> on my library, then change a file, the next time I run <code>cabal build</code>, I only have to recompile files affected by the changes. I'm not getting the same behavior with the <code>cabal haddock</code> command: when I run it after changing a file, cabal/haddock ends up throwing out all of the previous work and starting from scratch. This is rather time consuming; is there a way to get differential updates to documentation?</p>\n\n<p>Here's a <a href=\"http://lpaste.net/141429\" rel=\"nofollow\">dump of the command cabal issues</a> to generate the documentation.</p>\n"}, {"tags": ["haskell"], "comments": [{"owner": {"reputation": 6159, "user_id": 754705, "user_type": "registered", "accept_rate": 60, "profile_image": "https://www.gravatar.com/avatar/942fe51aac5dc523f0305439fa9a6e3d?s=128&d=identicon&r=PG&f=1", "display_name": "Michael", "link": "https://stackoverflow.com/users/754705/michael"}, "edited": false, "score": 6, "creation_date": 1442858511, "post_id": 32701596, "comment_id": 53246513, "body": "you mean, it&#39;s not tagged as &quot;safe&quot; - the function is perfectly safe - you could make a patch and send it to the maintainer, he will probably be happy to include it."}, {"owner": {"reputation": 35444, "user_id": 656912, "user_type": "registered", "accept_rate": 66, "profile_image": "https://www.gravatar.com/avatar/ce95c01cbd4f90f014d988ae5c8a422d?s=128&d=identicon&r=PG", "display_name": "orome", "link": "https://stackoverflow.com/users/656912/orome"}, "reply_to_user": {"reputation": 6159, "user_id": 754705, "user_type": "registered", "accept_rate": 60, "profile_image": "https://www.gravatar.com/avatar/942fe51aac5dc523f0305439fa9a6e3d?s=128&d=identicon&r=PG&f=1", "display_name": "Michael", "link": "https://stackoverflow.com/users/754705/michael"}, "edited": false, "score": 0, "creation_date": 1442858954, "post_id": 32701596, "comment_id": 53246746, "body": "@Michael: Exactly what it says in the linked docs: <code>{-# LANGUAGE Safe #-}</code> fails with a warning that <code>Data.String.Utils can&#39;t be safely imported! The module isn&#39;t safe.</code>"}, {"owner": {"reputation": 14582, "user_id": 2225384, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/f30b04ed4d0b3fc4bc791a28815f34ca?s=128&d=identicon&r=PG", "display_name": "Rein Henrichs", "link": "https://stackoverflow.com/users/2225384/rein-henrichs"}, "edited": false, "score": 5, "creation_date": 1442859297, "post_id": 32701596, "comment_id": 53246973, "body": "@raxacoricofallapatorius That&#39;s what Michael is saying. If it were tagged as safe, this wouldn&#39;t happen."}, {"owner": {"reputation": 35444, "user_id": 656912, "user_type": "registered", "accept_rate": 66, "profile_image": "https://www.gravatar.com/avatar/ce95c01cbd4f90f014d988ae5c8a422d?s=128&d=identicon&r=PG", "display_name": "orome", "link": "https://stackoverflow.com/users/656912/orome"}, "reply_to_user": {"reputation": 14582, "user_id": 2225384, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/f30b04ed4d0b3fc4bc791a28815f34ca?s=128&d=identicon&r=PG", "display_name": "Rein Henrichs", "link": "https://stackoverflow.com/users/2225384/rein-henrichs"}, "edited": false, "score": 0, "creation_date": 1442859846, "post_id": 32701596, "comment_id": 53247308, "body": "@ReinHenrichs: We&#39;re going in circles (I&#39;m not maligning the function): see the quotes around &quot;safe&quot;? I&#39;m asking exactly that: is there something I can substitute so I don&#39;t have to import a package that isn&#39;t (currently) <i>tagged as</i> safe (while I wait for it to be)."}, {"owner": {"reputation": 84731, "user_id": 510937, "user_type": "registered", "accept_rate": 80, "profile_image": "https://www.gravatar.com/avatar/70b13a9ae1aae1ca1aa6ac8dab4643f2?s=128&d=identicon&r=PG", "display_name": "Bakuriu", "link": "https://stackoverflow.com/users/510937/bakuriu"}, "edited": false, "score": 0, "creation_date": 1442859880, "post_id": 32701596, "comment_id": 53247332, "body": "Note: in the documentation you linked on the top right it says: <code>Safe Haskell\tNone</code> so the source code is missing the safe declaration. On your computer you probably have only the compiled version of your package so the compiler has no chance to verify the source code for safety: hence, for your safety, it just assumes the module is not safe for a safe use."}, {"owner": {"reputation": 35444, "user_id": 656912, "user_type": "registered", "accept_rate": 66, "profile_image": "https://www.gravatar.com/avatar/ce95c01cbd4f90f014d988ae5c8a422d?s=128&d=identicon&r=PG", "display_name": "orome", "link": "https://stackoverflow.com/users/656912/orome"}, "reply_to_user": {"reputation": 84731, "user_id": 510937, "user_type": "registered", "accept_rate": 80, "profile_image": "https://www.gravatar.com/avatar/70b13a9ae1aae1ca1aa6ac8dab4643f2?s=128&d=identicon&r=PG", "display_name": "Bakuriu", "link": "https://stackoverflow.com/users/510937/bakuriu"}, "edited": false, "score": 0, "creation_date": 1442859965, "post_id": 32701596, "comment_id": 53247390, "body": "@Bakuriu: Yes, that answers the final (subsidiary) part of the question: It&#39;s not &quot;safe&quot; just because it isn&#39;t marked as safe. But the main question stands: what can I do instead in the mean time?"}, {"owner": {"reputation": 44013, "user_id": 1477667, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/trgKM.jpg?s=128&g=1", "display_name": "dfeuer", "link": "https://stackoverflow.com/users/1477667/dfeuer"}, "edited": false, "score": 1, "creation_date": 1442860310, "post_id": 32701596, "comment_id": 53247571, "body": "You can write your own <code>Trustworthy</code> <code>MyStrings</code> module to re-export the safe functions you use from there."}, {"owner": {"reputation": 44013, "user_id": 1477667, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/trgKM.jpg?s=128&g=1", "display_name": "dfeuer", "link": "https://stackoverflow.com/users/1477667/dfeuer"}, "reply_to_user": {"reputation": 6159, "user_id": 754705, "user_type": "registered", "accept_rate": 60, "profile_image": "https://www.gravatar.com/avatar/942fe51aac5dc523f0305439fa9a6e3d?s=128&d=identicon&r=PG&f=1", "display_name": "Michael", "link": "https://stackoverflow.com/users/754705/michael"}, "edited": false, "score": 0, "creation_date": 1442860529, "post_id": 32701596, "comment_id": 53247695, "body": "@Michael, indeed it appears that the module imports only safe things, except for another <code>Utils</code> module which could itself be inferred safe."}, {"owner": {"reputation": 35444, "user_id": 656912, "user_type": "registered", "accept_rate": 66, "profile_image": "https://www.gravatar.com/avatar/ce95c01cbd4f90f014d988ae5c8a422d?s=128&d=identicon&r=PG", "display_name": "orome", "link": "https://stackoverflow.com/users/656912/orome"}, "reply_to_user": {"reputation": 44013, "user_id": 1477667, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/trgKM.jpg?s=128&g=1", "display_name": "dfeuer", "link": "https://stackoverflow.com/users/1477667/dfeuer"}, "edited": false, "score": 1, "creation_date": 1442860717, "post_id": 32701596, "comment_id": 53247808, "body": "@dfeuer: I just wonder if I can write (or if there exists somewhere) some code that does what <code>replace</code> is doing in the example, so I don&#39;t have to import a module that isn&#39;t passing as &quot;Safe&quot;."}, {"owner": {"reputation": 44013, "user_id": 1477667, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/trgKM.jpg?s=128&g=1", "display_name": "dfeuer", "link": "https://stackoverflow.com/users/1477667/dfeuer"}, "edited": false, "score": 0, "creation_date": 1442860837, "post_id": 32701596, "comment_id": 53247887, "body": "Note: marking a module <code>TrustWorthy</code> imposes a substantial maintenance burden--you become responsible for ensuring that the imported functions remain safe when the underlying module is updated, and those who don&#39;t trust you need to audit that code themselves. All told, it&#39;s far better to get the appropriate annotations pushed upstream."}, {"owner": {"reputation": 44013, "user_id": 1477667, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/trgKM.jpg?s=128&g=1", "display_name": "dfeuer", "link": "https://stackoverflow.com/users/1477667/dfeuer"}, "edited": false, "score": 0, "creation_date": 1442860991, "post_id": 32701596, "comment_id": 53247977, "body": "You absolutely can. Just click on the link to the source code and copy it. You may have to copy and paste some dependencies as well. Once you&#39;ve pushed the fix upstream, you can use CPP to fix things up for a few years."}], "answers": [{"comments": [{"owner": {"reputation": 35444, "user_id": 656912, "user_type": "registered", "accept_rate": 66, "profile_image": "https://www.gravatar.com/avatar/ce95c01cbd4f90f014d988ae5c8a422d?s=128&d=identicon&r=PG", "display_name": "orome", "link": "https://stackoverflow.com/users/656912/orome"}, "edited": false, "score": 0, "creation_date": 1442861105, "post_id": 32702412, "comment_id": 53248041, "body": "&quot;Its wrong to call it &#39;not safe&#39;&quot; Yes, that clearly sent people on the wrong track!"}, {"owner": {"reputation": 35444, "user_id": 656912, "user_type": "registered", "accept_rate": 66, "profile_image": "https://www.gravatar.com/avatar/ce95c01cbd4f90f014d988ae5c8a422d?s=128&d=identicon&r=PG", "display_name": "orome", "link": "https://stackoverflow.com/users/656912/orome"}, "edited": false, "score": 0, "creation_date": 1442861416, "post_id": 32702412, "comment_id": 53248217, "body": "The question is really: How do I write the code above to perform do what replace does (in the context given)? Long term is seems like the right solution (not listed above) is to have the maintainer tag the package is safe."}, {"owner": {"reputation": 2319, "user_id": 2211273, "user_type": "registered", "accept_rate": 89, "profile_image": "https://www.gravatar.com/avatar/6d55ba6b0f08aed750502866c7e7ee77?s=128&d=identicon&r=PG", "display_name": "Kritzefitz", "link": "https://stackoverflow.com/users/2211273/kritzefitz"}, "edited": false, "score": 0, "creation_date": 1442862620, "post_id": 32702412, "comment_id": 53248895, "body": "Just out of curiosity: How come the package isn&#39;t tagged as safe? You say it should be safe (because it only uses safe functionality), but AFAIK such packages are normally tagged as &quot;Safe-Inferred&quot;, if they are really safe. Why isn&#39;t this the case for this module?"}, {"owner": {"reputation": 6159, "user_id": 754705, "user_type": "registered", "accept_rate": 60, "profile_image": "https://www.gravatar.com/avatar/942fe51aac5dc523f0305439fa9a6e3d?s=128&d=identicon&r=PG&f=1", "display_name": "Michael", "link": "https://stackoverflow.com/users/754705/michael"}, "reply_to_user": {"reputation": 2319, "user_id": 2211273, "user_type": "registered", "accept_rate": 89, "profile_image": "https://www.gravatar.com/avatar/6d55ba6b0f08aed750502866c7e7ee77?s=128&d=identicon&r=PG", "display_name": "Kritzefitz", "link": "https://stackoverflow.com/users/2211273/kritzefitz"}, "edited": false, "score": 1, "creation_date": 1442863542, "post_id": 32702412, "comment_id": 53249395, "body": "@Kritzefitz - I don&#39;t say &quot;it should be safe because it only uses safe functionality&quot;... I say &quot;it <i>is</i> safe, because the functions it exposes are all pure, and they don&#39;t have any side-effects&quot;. A module with just one value <code>foo = unsafePerformIO $ return (42 :: Int)</code> is also safe, even though it uses unsafePerformIO - it is not safe-inferred though. &quot;safe&quot; means that the functions are pure and that they don&#39;t have side-effects. &quot;being tagged as safe&quot; should mean the same in an ideal world, but in this case it is clearly not the same"}, {"owner": {"reputation": 2319, "user_id": 2211273, "user_type": "registered", "accept_rate": 89, "profile_image": "https://www.gravatar.com/avatar/6d55ba6b0f08aed750502866c7e7ee77?s=128&d=identicon&r=PG", "display_name": "Kritzefitz", "link": "https://stackoverflow.com/users/2211273/kritzefitz"}, "edited": false, "score": 0, "creation_date": 1442863818, "post_id": 32702412, "comment_id": 53249559, "body": "Indeed. MissingH fails to compile with Safe explicitly enabled. Pity that the author didn&#39;t mark it as Trustworthy."}, {"owner": {"reputation": 44013, "user_id": 1477667, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/trgKM.jpg?s=128&g=1", "display_name": "dfeuer", "link": "https://stackoverflow.com/users/1477667/dfeuer"}, "edited": false, "score": 2, "creation_date": 1442865122, "post_id": 32702412, "comment_id": 53250240, "body": "Safety works on the module level, not the package one. Those particular modules could be inferred safe if they just claimed safety."}, {"owner": {"reputation": 2319, "user_id": 2211273, "user_type": "registered", "accept_rate": 89, "profile_image": "https://www.gravatar.com/avatar/6d55ba6b0f08aed750502866c7e7ee77?s=128&d=identicon&r=PG", "display_name": "Kritzefitz", "link": "https://stackoverflow.com/users/2211273/kritzefitz"}, "reply_to_user": {"reputation": 44013, "user_id": 1477667, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/trgKM.jpg?s=128&g=1", "display_name": "dfeuer", "link": "https://stackoverflow.com/users/1477667/dfeuer"}, "edited": false, "score": 0, "creation_date": 1442865629, "post_id": 32702412, "comment_id": 53250495, "body": "@dfeuer Okay, but then it&#39;s again unclear why that particular module wasn&#39;t Safe-Inferred (I thought Michael&#39;s comment about the use of <code>unsafePerformIO</code> was supposed to explain it, but maybe it wasn&#39;t)."}, {"owner": {"reputation": 44013, "user_id": 1477667, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/trgKM.jpg?s=128&g=1", "display_name": "dfeuer", "link": "https://stackoverflow.com/users/1477667/dfeuer"}, "reply_to_user": {"reputation": 2319, "user_id": 2211273, "user_type": "registered", "accept_rate": 89, "profile_image": "https://www.gravatar.com/avatar/6d55ba6b0f08aed750502866c7e7ee77?s=128&d=identicon&r=PG", "display_name": "Kritzefitz", "link": "https://stackoverflow.com/users/2211273/kritzefitz"}, "edited": false, "score": 2, "creation_date": 1442867060, "post_id": 32702412, "comment_id": 53251289, "body": "@Kritzefitz, I think I tracked down the problem. Hackage is lying to us. It claims that <code>Text.Regex</code> in <code>regex-compat</code> is <code>safe-inferred</code>, but in fact that module (which I believe to be safe) uses ones from <code>regex-posix</code> that themselves actually use (but do not, as far as I can tell, export) unsafe functions. <code>Data.String.Utils</code> imports that regex module, and is therefore not inferred safe. The true solution is to get <code>regex-posix</code> and/or <code>regex-compat</code> to use the appropriate <code>Trustworthy</code> pragmas."}], "tags": [], "owner": {"reputation": 6159, "user_id": 754705, "user_type": "registered", "accept_rate": 60, "profile_image": "https://www.gravatar.com/avatar/942fe51aac5dc523f0305439fa9a6e3d?s=128&d=identicon&r=PG&f=1", "display_name": "Michael", "link": "https://stackoverflow.com/users/754705/michael"}, "is_accepted": false, "score": 1, "last_activity_date": 1442860938, "creation_date": 1442860938, "answer_id": 32702412, "question_id": 32701596, "link": "https://stackoverflow.com/questions/32701596/is-there-a-safe-alternative-the-data-string-utilss-replace-in-haskell/32702412#32702412", "title": "Is there a &quot;Safe&quot; alternative the Data.String.Utils&#39;s &#39;replace&#39; in Haskell?", "body": "<p>tl;dr: <code>import Data.Text (replace)</code> - if you can live with the more restricted type signature?</p>\n\n<hr>\n\n<p>1) The <code>Data.String.Utils</code> module is not tagged as <em>safe</em>, although it should be.</p>\n\n<p>2) The <code>Data.String.Utils</code> module <em>is</em> safe. Its wrong to call it \"not safe\", even if you put quotes around \"safe\". GHC tells you that the module would be unsafe, because it uses a conservative approach: if it can't prove at compile time that the module is safe, it assumes that it is unsafe. But no matter how loud the compiler complains that the module would be unsafe, it still remains perfectly safe.</p>\n\n<p>3) On the other hand, it would be possible to write a module, export some version of <code>unsafePerformIO</code>, and mark it as \"Trustworthy\". GHC would think that the module can be safely imported. But in fact, the module is inherently unsafe.</p>\n\n<p><strong>So, what are your options now?</strong></p>\n\n<p>A) Download the source of the package, and modify the modules that you need, and for which you know that they are safe, to include a \"Trustworthy\" tag at the beginning: <code>{-# LANGUAGE Trustworthy #-}</code></p>\n\n<p>(You may send a patch to the maintainer, or you may keep it to yourself)</p>\n\n<p>B) You write your own version of <code>replace</code> and mark it as safe.</p>\n\n<p>C) Maybe you can use <code>replace</code> from <code>Data.Text</code>. But that is limited to <code>Text</code>, whereas the other <code>replace</code> function works on arbitrary lists.</p>\n\n<p>At least on <a href=\"https://www.haskell.org/hoogle/?\" rel=\"nofollow\">Hoogle</a> there are no other methods with a <code>[a] -&gt; [a] -&gt; [a] -&gt; [a]</code> signature for your use-case.</p>\n"}], "owner": {"reputation": 35444, "user_id": 656912, "user_type": "registered", "accept_rate": 66, "profile_image": "https://www.gravatar.com/avatar/ce95c01cbd4f90f014d988ae5c8a422d?s=128&d=identicon&r=PG", "display_name": "orome", "link": "https://stackoverflow.com/users/656912/orome"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 257, "favorite_count": 0, "answer_count": 1, "score": 9, "last_activity_date": 1442860938, "creation_date": 1442857862, "last_edit_date": 1442859093, "question_id": 32701596, "link": "https://stackoverflow.com/questions/32701596/is-there-a-safe-alternative-the-data-string-utilss-replace-in-haskell", "title": "Is there a &quot;Safe&quot; alternative the Data.String.Utils&#39;s &#39;replace&#39; in Haskell?", "body": "<p>I'm unable to mark as <a href=\"https://downloads.haskell.org/~ghc/7.8.2/docs/html/users_guide/safe-haskell.html\">\"Safe\"</a> code containing, for example </p>\n\n<pre><code>import Data.String.Utils (replace)\n\npreproc :: String -&gt; String\npreproc s = foldl1 fmap (uncurry replace &lt;$&gt; subs)  s\n            where subs = [(\"1\",\"a\"),(\"2\",\"bb\"),(\"3\",\"z\"),(\"4\",\"mr\")(\"0\",\"xx\")]\n</code></pre>\n\n<p>because (apparently) <a href=\"http://hackage.haskell.org/package/hS3-0.5.8/docs/Data-String-Utils.html\"><code>Data.String.Utils</code></a>'s is not \"safe\". </p>\n\n<p>Is there a safe alternative to <code>replace</code>? And why isn't <code>replace</code> safe anyway?</p>\n"}, {"tags": ["haskell", "config", "haddock"], "answers": [{"tags": [], "owner": {"reputation": 36, "user_id": 4366908, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/uXY4B.png?s=128&g=1", "display_name": "nek0", "link": "https://stackoverflow.com/users/4366908/nek0"}, "is_accepted": false, "score": 0, "last_activity_date": 1537935045, "creation_date": 1537935045, "answer_id": 52509811, "question_id": 32700763, "link": "https://stackoverflow.com/questions/32700763/how-do-i-customize-haddock-document-generation-for-all-packages/52509811#52509811", "title": "How do I customize Haddock document generation, for all packages?", "body": "<p>First of all, the settings in <code>~/.cabal/config</code> are your per-user default settings. Your alterations would come into effect, whenever you call <code>cabal haddock</code>.</p>\n\n<p>Since the haddock documentation is built statically for each package, you would need to rerun the <code>cabal haddock</code> command for every package you install to change the appearance of its docs.</p>\n\n<p>Also you seem to have mixed up something a little: <code>cabal sdist</code> does not upload anything to Hackage. That's what <code>cabal upload</code> is for.</p>\n\n<p>Usually you just upload the bare package to Hackage and the server builds the documentation himself, but there is a way to upload the documentation you built yourself, in case the server fails to build it or for other reasons. I use the following script I found at <a href=\"http://hackage.haskell.org/upload\" rel=\"nofollow noreferrer\">http://hackage.haskell.org/upload</a> with some alterations:</p>\n\n<pre><code>#!/bin/sh\nset -e\n\ndir=$(mktemp -d dist-docs.XXXXXX)\ntrap 'rm -rf \"$dir\"' EXIT\n\ncabal haddock --builddir=\"$dir\" --for-hackage --haddock-option=--hyperlinked-source\n# Starting with cabal 2.0, `--publish` is needed for uploading to non-candidate releases\ncabal upload -d $dir/*-docs.tar.gz --publish\n</code></pre>\n"}], "owner": {"reputation": 35444, "user_id": 656912, "user_type": "registered", "accept_rate": 66, "profile_image": "https://www.gravatar.com/avatar/ce95c01cbd4f90f014d988ae5c8a422d?s=128&d=identicon&r=PG", "display_name": "orome", "link": "https://stackoverflow.com/users/656912/orome"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 245, "favorite_count": 2, "answer_count": 1, "score": 10, "last_activity_date": 1537935045, "creation_date": 1442854834, "last_edit_date": 1442952193, "question_id": 32700763, "link": "https://stackoverflow.com/questions/32700763/how-do-i-customize-haddock-document-generation-for-all-packages", "title": "How do I customize Haddock document generation, for all packages?", "body": "<p>It's not clear to me how to customize the documents that</p>\n\n<pre><code>cabal haddock\n</code></pre>\n\n<p>generates. For example how do I include source links, or use a custom CSS file so that they apply in all cases?</p>\n\n<p>In my <code>~/.cabal/config</code> I've tried</p>\n\n<pre><code>haddock\n  -- keep-temp-files: False\n  -- hoogle: False\n  -- html: False\n  -- html-location:\n  -- executables: False\n  -- tests: False\n  -- benchmarks: False\n  -- all:\n  -- internal: False\n  css: /Users/Rax/Projects/Haskell/Package/mystuff.css\n  hyperlink-source: True\n  -- hscolour-css:\n  -- contents-location:\n</code></pre>\n\n<p>but it's unclear to me what the scope if these settings is.</p>\n\n<p>How do I customize the default document generation for all documents generated by Haddock: packages I build with <code>cabal haddock</code>, for packages I install from Hackage with <code>cabal install</code>, and even to packages I upload to Hackage with <code>cabal sdist</code>?</p>\n"}, {"tags": ["haskell"], "answers": [{"comments": [{"owner": {"reputation": 65, "user_id": 5330987, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/cc83ef22819c01bceec3444c00180fb7?s=128&d=identicon&r=PG&f=1", "display_name": "mcNuggetsplays", "link": "https://stackoverflow.com/users/5330987/mcnuggetsplays"}, "edited": false, "score": 1, "creation_date": 1442853745, "post_id": 32700334, "comment_id": 53243818, "body": "Thanks, real big help. Yeah I got the root and children functions down now."}], "tags": [], "owner": {"reputation": 48129, "user_id": 76051, "user_type": "registered", "accept_rate": 91, "profile_image": "https://i.stack.imgur.com/AGDxz.jpg?s=128&g=1", "display_name": "Carsten", "link": "https://stackoverflow.com/users/76051/carsten"}, "is_accepted": true, "score": 11, "last_activity_date": 1442853438, "creation_date": 1442853438, "answer_id": 32700334, "question_id": 32700129, "link": "https://stackoverflow.com/questions/32700129/haskell-strange-operator/32700334#32700334", "title": "Haskell Strange Operator", "body": "<p>t's very similar to the definition of a list:</p>\n\n<ul>\n<li><code>(:&gt;)</code> is a bit like <code>(:)</code></li>\n<li><code>data Rose a = a :&gt; [Rose a]</code> tells you, that you can get a <code>t :: Rose a</code>\n\n<ul>\n<li>with an element <code>x :: a</code></li>\n<li>and children <code>rs :: [Rose a]</code> </li>\n<li>by <code>t = x :&gt; rs</code> </li>\n</ul></li>\n</ul>\n\n<p>of course you can get back the elements like this too:</p>\n\n<pre><code>root (x :&gt; rs) = ... \n</code></pre>\n\n<p>I hope you get the rest by yourself ;)</p>\n"}, {"tags": [], "owner": {"reputation": 51584, "user_id": 839246, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/9b0573c2b936b12828dd1e4cc04206dc?s=128&d=identicon&r=PG&f=1", "display_name": "bheklilr", "link": "https://stackoverflow.com/users/839246/bheklilr"}, "is_accepted": false, "score": 9, "last_activity_date": 1442854345, "last_edit_date": 1442854345, "creation_date": 1442853472, "answer_id": 32700345, "question_id": 32700129, "link": "https://stackoverflow.com/questions/32700129/haskell-strange-operator/32700345#32700345", "title": "Haskell Strange Operator", "body": "<p>The <code>:&gt;</code> operator is actually a data constructor.  It would be equivalent to define the type as</p>\n\n<pre><code>data Rose a = Node a [Rose a]\n</code></pre>\n\n<p>Where <code>(:&gt;) = Node</code>.  So with this alternate definition you would have</p>\n\n<pre><code>root :: Rose a -&gt; a\nroot (Node a subnodes) = a\n</code></pre>\n\n<p>Substituting for the actual constructor <code>:&gt;</code> you would have</p>\n\n<pre><code>root ((:&gt;) a subnodes) = a\n</code></pre>\n\n<p>Which can also be written as</p>\n\n<pre><code>root (a :&gt; subnodes) = a\n</code></pre>\n\n<p>As @Carsten says it's just like the list constructor <code>:</code>, just specialized for the <code>Rose</code> data type.</p>\n"}, {"tags": [], "owner": {"reputation": 94553, "user_id": 775806, "user_type": "registered", "accept_rate": 96, "profile_image": "https://i.stack.imgur.com/XNd2C.png?s=128&g=1", "display_name": "n. &#39;pronouns&#39; m.", "link": "https://stackoverflow.com/users/775806/n-pronouns-m"}, "is_accepted": false, "score": 7, "last_activity_date": 1442855195, "last_edit_date": 1442855195, "creation_date": 1442854754, "answer_id": 32700743, "question_id": 32700129, "link": "https://stackoverflow.com/questions/32700129/haskell-strange-operator/32700743#32700743", "title": "Haskell Strange Operator", "body": "<p>The <code>:&gt;</code> operator has no predefined meaning. It is <em>introduced by</em> your Rose definition, just like the identifier <code>Rose</code> is. In Haskell you can define your own operators, this is one of them. </p>\n\n<p>This particular operator is a data constructor, which can be determined by the first character. Data constructors start with a colon. Operators that don't start with a colon are normal functions.</p>\n\n<p>It works exactly like any other data constructor, the only difference is that it's written in infix form, like <code>:</code>. In this program, it can be read as \"attached to\".</p>\n\n<p>Since everyone can use it in their own program for any purpose, it is pointless to google it.</p>\n"}], "owner": {"reputation": 65, "user_id": 5330987, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/cc83ef22819c01bceec3444c00180fb7?s=128&d=identicon&r=PG&f=1", "display_name": "mcNuggetsplays", "link": "https://stackoverflow.com/users/5330987/mcnuggetsplays"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 212, "favorite_count": 2, "accepted_answer_id": 32700334, "answer_count": 3, "score": 6, "last_activity_date": 1442855195, "creation_date": 1442852740, "question_id": 32700129, "link": "https://stackoverflow.com/questions/32700129/haskell-strange-operator", "title": "Haskell Strange Operator", "body": "<p>For an assignment for my functional programming class I am working on an exercise on trees. And more specifically on Rose trees. In the framework that we got the data type 'Rose' is already defined, but it has an operator :>. I searched it on hoogle and it said that it's the rightmost element of a sequence and the rest of the sequence. (Part of the framework below) </p>\n\n<pre><code>data Rose a = a :&gt; [Rose a]\nderiving (Eq, Show)\n\n-- Exercise 1\n\nroot :: Rose a -&gt; a\nroot = undefined\n\nchildren :: Rose a -&gt; [Rose a]\nchildren = undefined\n</code></pre>\n\n<p>I by no means need you guys to tell me how the root and children function should be made. But if you guys could give me some tips as to how to read the 'data Rose a' line or maybe show me how a rose tree would be build up. These things would be a really big help as I enjoy doing the excercises.</p>\n\n<p>I hope someone can point me in the right direction.</p>\n"}, {"tags": ["haskell"], "comments": [{"owner": {"reputation": 2231, "user_id": 1027321, "user_type": "registered", "accept_rate": 70, "profile_image": "https://i.stack.imgur.com/KkFZC.jpg?s=128&g=1", "display_name": "jakubdaniel", "link": "https://stackoverflow.com/users/1027321/jakubdaniel"}, "edited": false, "score": 0, "creation_date": 1442848931, "post_id": 32698743, "comment_id": 53240859, "body": "This question, though very interesting, is likely to have just subjective answers. As such, it does not meet the SO requirements."}, {"owner": {"reputation": 1284, "user_id": 5209349, "user_type": "registered", "accept_rate": 80, "profile_image": "https://www.gravatar.com/avatar/0f5341e747308691d40f30d79ffd75f9?s=128&d=identicon&r=PG", "display_name": "Michael Benfield", "link": "https://stackoverflow.com/users/5209349/michael-benfield"}, "edited": false, "score": 1, "creation_date": 1442850274, "post_id": 32698743, "comment_id": 53241720, "body": "Previously asked: <a href=\"http://stackoverflow.com/questions/12432154/int-vs-word-in-common-use\" title=\"int vs word in common use\">stackoverflow.com/questions/12432154/int-vs-word-in-common-u&zwnj;&#8203;se</a>"}], "answers": [{"tags": [], "owner": {"reputation": 13699, "user_id": 11173, "user_type": "registered", "accept_rate": 77, "profile_image": "https://www.gravatar.com/avatar/6b5276e65cb7a7417188c9a035953cee?s=128&d=identicon&r=PG", "display_name": "Doug McClean", "link": "https://stackoverflow.com/users/11173/doug-mcclean"}, "is_accepted": true, "score": 18, "last_activity_date": 1442849068, "creation_date": 1442849068, "answer_id": 32698956, "question_id": 32698743, "link": "https://stackoverflow.com/questions/32698743/why-is-unsigned-int-so-rare-in-haskell/32698956#32698956", "title": "Why is unsigned int so rare in haskell?", "body": "<p>We only just now got <a href=\"http://hackage.haskell.org/package/base-4.8.1.0/docs/Numeric-Natural.html\"><code>Numeric.Natural</code></a> in <code>base</code>, too.</p>\n\n<p>I think it is just historical accident. <code>Int</code> and <code>Integer</code> were in the haskell 98 prelude, which didn't get bogged down with lots of other fixed-size integer types.</p>\n"}], "owner": {"reputation": 2647, "user_id": 2141650, "user_type": "registered", "accept_rate": 60, "profile_image": "https://www.gravatar.com/avatar/68388df031850463b7bbb5a9e6034abe?s=128&d=identicon&r=PG", "display_name": "user2141650", "link": "https://stackoverflow.com/users/2141650/user2141650"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 2989, "favorite_count": 0, "closed_date": 1442850322, "accepted_answer_id": 32698956, "answer_count": 1, "score": 15, "last_activity_date": 1442849068, "creation_date": 1442848395, "question_id": 32698743, "link": "https://stackoverflow.com/questions/32698743/why-is-unsigned-int-so-rare-in-haskell", "closed_reason": "Duplicate", "title": "Why is unsigned int so rare in haskell?", "body": "<p>Generally Haskell libraries make a point of making impossible states unrepresentable in the types. But I often see <code>Int</code> used where only a non-negative number makes sense. Why is <code>Word</code> not used in those cases?</p>\n"}, {"tags": ["haskell", "typeclass"], "comments": [{"owner": {"reputation": 58792, "user_id": 1006010, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/f683d229f3673c9dcc3f3f2796d75c09?s=128&d=identicon&r=PG", "display_name": "MathematicalOrchid", "link": "https://stackoverflow.com/users/1006010/mathematicalorchid"}, "edited": false, "score": 0, "creation_date": 1442841793, "post_id": 32695897, "comment_id": 53235822, "body": "I see several things wrong with your code, but I&#39;m still not sure exactly what you&#39;re trying to <i>achieve</i>. You want the class to be hidden, but you don&#39;t want the class to be hidden...?"}, {"owner": {"reputation": 764, "user_id": 3529754, "user_type": "registered", "accept_rate": 86, "profile_image": "https://www.gravatar.com/avatar/a8311cc9fdf0e052da7367ae79775c1c?s=128&d=identicon&r=PG&f=1", "display_name": "bash0r", "link": "https://stackoverflow.com/users/3529754/bash0r"}, "reply_to_user": {"reputation": 58792, "user_id": 1006010, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/f683d229f3673c9dcc3f3f2796d75c09?s=128&d=identicon&r=PG", "display_name": "MathematicalOrchid", "link": "https://stackoverflow.com/users/1006010/mathematicalorchid"}, "edited": false, "score": 0, "creation_date": 1442842347, "post_id": 32695897, "comment_id": 53236234, "body": "@MathematicalOrchid I don&#39;t want to expose it directly. I want to wrap a little EDSL around it to make it useful. The class itself needs to be visible from outside but I don&#39;t want users of the library to be forced to import the type class qualified. The hiding of the module where the class definition relies is just for structuring of my source code internally in the project. I hope that clarifies it a bit.  PS: I&#39;m quite new to Haskell so please excuse any mistakes I made. I didn&#39;t understand all internals of Haskell yet."}, {"owner": {"reputation": 58792, "user_id": 1006010, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/f683d229f3673c9dcc3f3f2796d75c09?s=128&d=identicon&r=PG", "display_name": "MathematicalOrchid", "link": "https://stackoverflow.com/users/1006010/mathematicalorchid"}, "edited": false, "score": 0, "creation_date": 1442842637, "post_id": 32695897, "comment_id": 53236437, "body": "&quot;I don&#39;t want to expose it&quot; / &quot;The class needs to be visible&quot;. Uh, still confused. What exactly do you want to be visible? (And what does &quot;qualified&quot; have to do with it?)"}, {"owner": {"reputation": 764, "user_id": 3529754, "user_type": "registered", "accept_rate": 86, "profile_image": "https://www.gravatar.com/avatar/a8311cc9fdf0e052da7367ae79775c1c?s=128&d=identicon&r=PG&f=1", "display_name": "bash0r", "link": "https://stackoverflow.com/users/3529754/bash0r"}, "reply_to_user": {"reputation": 58792, "user_id": 1006010, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/f683d229f3673c9dcc3f3f2796d75c09?s=128&d=identicon&r=PG", "display_name": "MathematicalOrchid", "link": "https://stackoverflow.com/users/1006010/mathematicalorchid"}, "edited": false, "score": 0, "creation_date": 1442843261, "post_id": 32695897, "comment_id": 53236904, "body": "@MathematicalOrchid I want every class and type to be in it&#39;s own source file as far as I can. For me it&#39;s more logical to structure my sources this way. By exposing the module <code>Foo.Bar</code> I want the user to get access to the type class <code>C</code> defined in <code>Foo.Bar.Class</code>. My type class is named <code>C</code> in my sources too. I have multiple type classes and types which are just named <code>C</code> and <code>T</code>. For this to work I need qualified import. But re-exporting the type class under a different name does not work as I expect it to behave."}, {"owner": {"reputation": 764, "user_id": 3529754, "user_type": "registered", "accept_rate": 86, "profile_image": "https://www.gravatar.com/avatar/a8311cc9fdf0e052da7367ae79775c1c?s=128&d=identicon&r=PG&f=1", "display_name": "bash0r", "link": "https://stackoverflow.com/users/3529754/bash0r"}, "reply_to_user": {"reputation": 58792, "user_id": 1006010, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/f683d229f3673c9dcc3f3f2796d75c09?s=128&d=identicon&r=PG", "display_name": "MathematicalOrchid", "link": "https://stackoverflow.com/users/1006010/mathematicalorchid"}, "edited": false, "score": 0, "creation_date": 1442843412, "post_id": 32695897, "comment_id": 53237016, "body": "@MathematicalOrchid In a third source file I want <code>import FooBar</code> only. I don&#39;t want to import all implementation details. As the compilation error started with the constraint kind (<code>type Class = T.C</code>) I think it has to do with it. I guess I did something wrong with my module export declaration in <code>Foo.Bar</code>."}, {"owner": {"reputation": 58792, "user_id": 1006010, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/f683d229f3673c9dcc3f3f2796d75c09?s=128&d=identicon&r=PG", "display_name": "MathematicalOrchid", "link": "https://stackoverflow.com/users/1006010/mathematicalorchid"}, "edited": false, "score": 2, "creation_date": 1442844470, "post_id": 32695897, "comment_id": 53237799, "body": "You can&#39;t create aliases for <i>classes</i>, only types (and functions, obviously). A class can never be renamed. If I were you... don&#39;t name all your classes <code>C</code>! Problem solved... (Do you actually need classes to begin with?)"}, {"owner": {"reputation": 764, "user_id": 3529754, "user_type": "registered", "accept_rate": 86, "profile_image": "https://www.gravatar.com/avatar/a8311cc9fdf0e052da7367ae79775c1c?s=128&d=identicon&r=PG&f=1", "display_name": "bash0r", "link": "https://stackoverflow.com/users/3529754/bash0r"}, "reply_to_user": {"reputation": 58792, "user_id": 1006010, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/f683d229f3673c9dcc3f3f2796d75c09?s=128&d=identicon&r=PG", "display_name": "MathematicalOrchid", "link": "https://stackoverflow.com/users/1006010/mathematicalorchid"}, "edited": false, "score": 0, "creation_date": 1442844558, "post_id": 32695897, "comment_id": 53237856, "body": "@MathematicalOrchid I will try it the other way now. But it is indeed possible with the GHC extension <code>{-# LANGUAGE ConstraintKinds #-}</code>. :)"}, {"owner": {"reputation": 2319, "user_id": 2211273, "user_type": "registered", "accept_rate": 89, "profile_image": "https://www.gravatar.com/avatar/6d55ba6b0f08aed750502866c7e7ee77?s=128&d=identicon&r=PG", "display_name": "Kritzefitz", "link": "https://stackoverflow.com/users/2211273/kritzefitz"}, "edited": false, "score": 0, "creation_date": 1442844655, "post_id": 32695897, "comment_id": 53237917, "body": "When you export the <code>Class</code>, you don&#39;t export <code>foo</code> with it. In the end <code>Class</code> just refers to the class, not to <code>foo</code>. If you also want <code>foo</code> to be re-export, you need to do that explicitely. However, like MathematicalOrchid said, you probably should just give your classes/types different names."}, {"owner": {"reputation": 764, "user_id": 3529754, "user_type": "registered", "accept_rate": 86, "profile_image": "https://www.gravatar.com/avatar/a8311cc9fdf0e052da7367ae79775c1c?s=128&d=identicon&r=PG&f=1", "display_name": "bash0r", "link": "https://stackoverflow.com/users/3529754/bash0r"}, "reply_to_user": {"reputation": 2319, "user_id": 2211273, "user_type": "registered", "accept_rate": 89, "profile_image": "https://www.gravatar.com/avatar/6d55ba6b0f08aed750502866c7e7ee77?s=128&d=identicon&r=PG", "display_name": "Kritzefitz", "link": "https://stackoverflow.com/users/2211273/kritzefitz"}, "edited": false, "score": 0, "creation_date": 1442845411, "post_id": 32695897, "comment_id": 53238424, "body": "@Kritzefitz Specifying explicitly didn&#39;t fix the problem. I&#39;ll try to get it working and maybe file a bug the GHC team. I guess it&#39;s a problem in the compiler. Explicitly exporting the function definitions in the class didn&#39;t help. For now I&#39;ll do it the &quot;normal&quot; way."}, {"owner": {"reputation": 2319, "user_id": 2211273, "user_type": "registered", "accept_rate": 89, "profile_image": "https://www.gravatar.com/avatar/6d55ba6b0f08aed750502866c7e7ee77?s=128&d=identicon&r=PG", "display_name": "Kritzefitz", "link": "https://stackoverflow.com/users/2211273/kritzefitz"}, "edited": false, "score": 0, "creation_date": 1442845526, "post_id": 32695897, "comment_id": 53238493, "body": "I could imagine that it doesn&#39;t work because <code>Class</code> doesn&#39;t actually refer to <code>C</code>, but rather to a type that fulfils the constraint <code>C</code> (thus it&#39;s actually <code>(C a) =&gt; a</code>, in which case it&#39;s by design that you can&#39;t make an instance of <code>Class</code>. I never worked with <code>ConstraintKinds</code> though, but just guessed that by the name."}, {"owner": {"reputation": 764, "user_id": 3529754, "user_type": "registered", "accept_rate": 86, "profile_image": "https://www.gravatar.com/avatar/a8311cc9fdf0e052da7367ae79775c1c?s=128&d=identicon&r=PG&f=1", "display_name": "bash0r", "link": "https://stackoverflow.com/users/3529754/bash0r"}, "edited": false, "score": 0, "creation_date": 1442845704, "post_id": 32695897, "comment_id": 53238612, "body": "I could even imagine that you&#39;re right. But wouldn&#39;t the possibility to create instances of the aliased class via the alias just a pure logical behavior?"}, {"owner": {"reputation": 14485, "user_id": 190376, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/cd8280c5e1491b8cf55760750ed97dec?s=128&d=identicon&r=PG", "display_name": "Reid Barton", "link": "https://stackoverflow.com/users/190376/reid-barton"}, "edited": false, "score": 2, "creation_date": 1442846920, "post_id": 32695897, "comment_id": 53239463, "body": "See <a href=\"https://ghc.haskell.org/trac/ghc/ticket/7543\" rel=\"nofollow noreferrer\">ghc.haskell.org/trac/ghc/ticket/7543</a>. There are technical reasons for GHC&#39;s behavior explained in the first comment. You should assume that the thing that comes after <code>instance</code> has to actually be the name of the class you want to write an instance for."}, {"owner": {"reputation": 764, "user_id": 3529754, "user_type": "registered", "accept_rate": 86, "profile_image": "https://www.gravatar.com/avatar/a8311cc9fdf0e052da7367ae79775c1c?s=128&d=identicon&r=PG&f=1", "display_name": "bash0r", "link": "https://stackoverflow.com/users/3529754/bash0r"}, "reply_to_user": {"reputation": 14485, "user_id": 190376, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/cd8280c5e1491b8cf55760750ed97dec?s=128&d=identicon&r=PG", "display_name": "Reid Barton", "link": "https://stackoverflow.com/users/190376/reid-barton"}, "edited": false, "score": 0, "creation_date": 1442847340, "post_id": 32695897, "comment_id": 53239783, "body": "@ReidBarton Oh thanks for the link! So what I&#39;m trying to accomplish isn&#39;t even possible, I guess."}, {"owner": {"reputation": 34864, "user_id": 237428, "user_type": "registered", "accept_rate": 78, "profile_image": "https://i.stack.imgur.com/ThNhZ.jpg?s=128&g=1", "display_name": "Antal Spector-Zabusky", "link": "https://stackoverflow.com/users/237428/antal-spector-zabusky"}, "edited": false, "score": 0, "creation_date": 1442854761, "post_id": 32695897, "comment_id": 53244375, "body": "I don&#39;t know that it&#39;s quite a duplicate, but see also <a href=\"http://stackoverflow.com/q/29039526/237428\">&quot;Defining partially applied typeclasses&quot;</a> (full disclosure: which I answered), which addresses the same impossibility."}], "owner": {"reputation": 764, "user_id": 3529754, "user_type": "registered", "accept_rate": 86, "profile_image": "https://www.gravatar.com/avatar/a8311cc9fdf0e052da7367ae79775c1c?s=128&d=identicon&r=PG&f=1", "display_name": "bash0r", "link": "https://stackoverflow.com/users/3529754/bash0r"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 359, "favorite_count": 1, "answer_count": 0, "score": 2, "last_activity_date": 1442840821, "creation_date": 1442840389, "last_edit_date": 1442840821, "question_id": 32695897, "link": "https://stackoverflow.com/questions/32695897/haskell-type-class-alias-and-module-re-export", "title": "Haskell type class alias and module re-export", "body": "<p>I'm struggling with Haskell's type classes at the moment. I'm using the language extension <code>{-# LANGUAGE ConstraintKinds #-}</code> to give a type class a type alias.</p>\n\n<p>The module containing the type class looks something like that:</p>\n\n<pre><code>module Foo.Bar.Class\n( C (..)\n) where\n\nclass C a where\n  foo :: a\n</code></pre>\n\n<p>Now I want to hide the internal definition of the type class and expose a more restricted interface of the type class:</p>\n\n<pre><code>{-# LANGUAGE ConstraintKinds #-}\n\nmodule Foo.Bar where\n( Class\n) where\n\nimport qualified Foo.Bar.Class as C\n\n\ntype Class = C\n</code></pre>\n\n<p>The cabal file adds Foo.Bar.Class to the hidden list of modules and Foo.Bar to the exposed module list.</p>\n\n<p>But when I try to use the so defined type class the compiler starts complaining that <code>foo</code> is not a (visible) function of the type class <code>Class</code>.</p>\n\n<p>My instance looks like so:</p>\n\n<pre><code>data FooBar = Foo | Bar\n\ninstance Class (FooBar -&gt; String) where\n  foo Foo = \"foo\"\n  foo Bar = \"bar\"\n</code></pre>\n\n<p>Adding <code>(..)</code> behind the export of <code>Class</code> or <code>C.foo</code> to the module export didn't help me get <code>foo</code> visible. Can anybody help?</p>\n\n<p>Thanks in advance!</p>\n"}, {"tags": ["haskell", "ghc"], "answers": [{"tags": [], "owner": {"reputation": 58792, "user_id": 1006010, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/f683d229f3673c9dcc3f3f2796d75c09?s=128&d=identicon&r=PG", "display_name": "MathematicalOrchid", "link": "https://stackoverflow.com/users/1006010/mathematicalorchid"}, "is_accepted": true, "score": 5, "last_activity_date": 1592121255, "last_edit_date": 1592121255, "creation_date": 1442839711, "answer_id": 32695664, "question_id": 32695343, "link": "https://stackoverflow.com/questions/32695343/specify-custom-temporary-directory-for-ghc-compiler/32695664#32695664", "title": "Specify custom temporary directory for ghc compiler", "body": "<p>How about this?</p>\n\n<p><a href=\"https://downloads.haskell.org/~ghc/latest/docs/html/users_guide/separate_compilation.html#redirecting-temporary-files\" rel=\"nofollow noreferrer\">https://downloads.haskell.org/~ghc/latest/docs/html/users_guide/separate_compilation.html#redirecting-temporary-files</a></p>\n\n<blockquote>\n  <p><code>-tmpdir</code></p>\n  \n  <p>If you have trouble because of running out of space in /tmp (or wherever your installation thinks temporary files should go), you may use the -tmpdir  option to specify an alternate directory. For example, -tmpdir . says to put temporary files in the current working directory.</p>\n  \n  <p>Alternatively, use your TMPDIR environment variable. Set it to the name of the directory where temporary files should be put. GCC and other programs will honour the TMPDIR variable as well.</p>\n  \n  <p>Even better idea: Set the DEFAULT_TMPDIR make variable when building GHC, and never worry about TMPDIR again. (see the build documentation).</p>\n</blockquote>\n"}], "owner": {"reputation": 123, "user_id": 2297870, "user_type": "registered", "accept_rate": 0, "profile_image": "https://www.gravatar.com/avatar/40b6014ab7aee184d8e9d2df85514952?s=128&d=identicon&r=PG", "display_name": "Somil Bhandari", "link": "https://stackoverflow.com/users/2297870/somil-bhandari"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 167, "favorite_count": 0, "accepted_answer_id": 32695664, "answer_count": 1, "score": 1, "last_activity_date": 1592121255, "creation_date": 1442838808, "last_edit_date": 1442851912, "question_id": 32695343, "link": "https://stackoverflow.com/questions/32695343/specify-custom-temporary-directory-for-ghc-compiler", "title": "Specify custom temporary directory for ghc compiler", "body": "<p>I am using ghc on my web server running Ubuntu 14.04 LTS. Due to some restrictions, I cannot provide write permissions to /tmp folder.</p>\n\n<p>The ghc compiler is throwing this error after removing permissions to the /tmp folder</p>\n\n<pre><code>/tmp/ghc12032_0: createDirectory: permission denied (Permission denied)\n</code></pre>\n\n<p>Is there a way to provide a custom temporary directory for ghc? I didn't find any compiler flag which can help with that. I need to provide a custom directory every time I invoke ghc. Any help would be appreciated.</p>\n"}, {"tags": ["haskell", "functor", "category-theory"], "answers": [{"comments": [{"owner": {"reputation": 100185, "user_id": 3234959, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/93bb12ca0f93dfddb33880316f7e66c2?s=128&d=identicon&r=PG&f=1", "display_name": "chi", "link": "https://stackoverflow.com/users/3234959/chi"}, "edited": false, "score": 1, "creation_date": 1442846892, "post_id": 32696064, "comment_id": 53239443, "body": "I would be tempted to use <code>class .. =&gt; Functor (f :: k) ...</code> with <code>PolyKinds</code>, and remove the dummy occurrences of <code>()</code> below. Whether this is a good idea or not, I&#39;m not 100% sure."}, {"owner": {"reputation": 100892, "user_id": 745903, "user_type": "registered", "accept_rate": 74, "profile_image": "https://www.gravatar.com/avatar/50933f6638836741e620669b3940410e?s=128&d=identicon&r=PG", "display_name": "leftaroundabout", "link": "https://stackoverflow.com/users/745903/leftaroundabout"}, "reply_to_user": {"reputation": 100185, "user_id": 3234959, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/93bb12ca0f93dfddb33880316f7e66c2?s=128&d=identicon&r=PG&f=1", "display_name": "chi", "link": "https://stackoverflow.com/users/3234959/chi"}, "edited": false, "score": 0, "creation_date": 1442847331, "post_id": 32696064, "comment_id": 53239772, "body": "@chi I considered writing that myself, but I&#39;m not really firm with PolyKinds."}], "tags": [], "owner": {"reputation": 100892, "user_id": 745903, "user_type": "registered", "accept_rate": 74, "profile_image": "https://www.gravatar.com/avatar/50933f6638836741e620669b3940410e?s=128&d=identicon&r=PG", "display_name": "leftaroundabout", "link": "https://stackoverflow.com/users/745903/leftaroundabout"}, "is_accepted": false, "score": 3, "last_activity_date": 1442840836, "creation_date": 1442840836, "answer_id": 32696064, "question_id": 32695316, "link": "https://stackoverflow.com/questions/32695316/issues-generalising-functor/32696064#32696064", "title": "Issues Generalising Functor", "body": "<p>The closest you could get would be</p>\n\n<pre><code>class (Category r, Category t) =&gt; Functor\n          (f :: *) (r :: *-&gt;*-&gt;*) (t :: *-&gt;*-&gt;*) where\n  type F f x :: *\n  fmap :: Tagged f ( r a b -&gt; t (F f a) (F f b) )\n\ninstance Functor [()] (-&gt;) (-&gt;) where\n  type F [()] x = [x]\n  fmap = Tagged map\n\ninstance (Monad m) =&gt; Functor (Kleisli m () ()) (-&gt;) (Kleisli m) where\n  type F (Kleisli m () ()) x = x\n  fmap = Tagged $ \\f -&gt; Kleisli $ return . f\n</code></pre>\n"}], "owner": {"reputation": 20310, "user_id": 525980, "user_type": "registered", "accept_rate": 48, "profile_image": "https://www.gravatar.com/avatar/8dafe66793ee2f32192e9fcefb389a12?s=128&d=identicon&r=PG", "display_name": "Clinton", "link": "https://stackoverflow.com/users/525980/clinton"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 74, "favorite_count": 0, "answer_count": 1, "score": 2, "last_activity_date": 1442841242, "creation_date": 1442838724, "last_edit_date": 1495535223, "question_id": 32695316, "link": "https://stackoverflow.com/questions/32695316/issues-generalising-functor", "title": "Issues Generalising Functor", "body": "<p><a href=\"https://hackage.haskell.org/package/categories-1.0.7/docs/Control-Categorical-Functor.html#t:Functor\" rel=\"nofollow noreferrer\">Functor in Control.Categorical.Functor</a> has the following definition:</p>\n\n<pre><code>class (Category r, Category t) =&gt; Functor f r t | f r -&gt; t, f t -&gt; r where\n  fmap :: r a b -&gt; t (f a) (f b)\n</code></pre>\n\n<p>But lets say I want to have a functor from ordinary functions to <a href=\"https://hackage.haskell.org/package/base-4.8.1.0/docs/Control-Arrow.html#t:Kleisli\" rel=\"nofollow noreferrer\">Kleisli</a> arrows (this is perhaps a silly example) .</p>\n\n<p>I'd want a type like this:</p>\n\n<pre><code>fmap :: (Monad m) =&gt; (a -&gt; b) -&gt; Kleisli m a b\n</code></pre>\n\n<p>Well I can let <code>r = (-&gt;)</code>, <code>t = Kleisli m</code> to get:</p>\n\n<pre><code>fmap :: (Monad m) =&gt; (a -&gt; b) -&gt; Kleisli m (f a) (f b)\n</code></pre>\n\n<p>But then, what's <code>f</code>?! I really just want it to disappear. I could use the <a href=\"http://hackage.haskell.org/package/base-4.8.0.0/docs/Data-Functor-Identity.html#t:Identity\" rel=\"nofollow noreferrer\">Identity</a> functor by letting <code>f = Identity</code> but then I get:</p>\n\n<pre><code>fmap :: (Monad m) =&gt; (a -&gt; b) -&gt; Kleisli m (Identity a) (Identity b)\n</code></pre>\n\n<p>which would require some messy unwrapping.</p>\n\n<p>I then thought of defining Functor like this:</p>\n\n<pre><code>class (Category r, Category t) =&gt; Functor r t where\n  type family F r t x :: *\n  fmap :: r a b -&gt; t (F r t a) (F r t b)\n</code></pre>\n\n<p>This allows me to define a Functor instance for Kleisli as follows (without an ugly Identity wrapper):</p>\n\n<pre><code>instance (Monad m) =&gt; Functor (-&gt;) (Kleisli m) where\n  type F (-&gt;) (Kleisli m) a = a\n  fmap f = Kleisli (return . f)\n</code></pre>\n\n<p>And after this, I'm pretty sure I'm at:</p>\n\n<pre><code>fmap :: (Monad m) =&gt; (a -&gt; b) -&gt; Kleisli m a b\n</code></pre>\n\n<p>Which is good.</p>\n\n<p>Now, there's one issue I can identify straight away namely, for a given <code>r</code> and <code>t</code> parameters to <code>Functor</code>, the original class definition allows multiple options for <code>f</code>, whereas with my definition, <code>r</code> and <code>t</code> determine <code>f</code>. This is a serious problem, as if I define say:</p>\n\n<pre><code>fmap :: (a -&gt; b) -&gt; (Maybe a -&gt; Maybe b)\n</code></pre>\n\n<p>I can't then define:</p>\n\n<pre><code>fmap :: (a -&gt; b) -&gt; ([a] -&gt; [b])\n</code></pre>\n\n<p>As in both cases, <code>r = (-&gt;)</code> and <code>t = (-&gt;)</code>. So currently my <code>Functor</code> doesn't even replace the original Prelude version.</p>\n\n<p>So there's some questions I now have:</p>\n\n<ol>\n<li>Can I adjust my definition so <code>r</code> and <code>t</code> do not determine <code>f</code> (like the original version)? Or would this require <a href=\"https://ghc.haskell.org/trac/ghc/wiki/InjectiveTypeFamilies\" rel=\"nofollow noreferrer\">Injective Type Families</a> (I'm happy to compile head to try this if this is the case). </li>\n<li>Can I further adjust my definition so that <code>f</code> and <code>r</code> determines <code>t</code> and also <code>f</code> and <code>t</code> determines <code>r</code>?</li>\n<li>After doing the above (or not if it's not possible) what are the potential impacts on type inference?</li>\n<li>Are there any other bad things about my class definition as compared to the original, other than things like increased typing?</li>\n<li>Are there any alternate approaches that still allow me to define the Kleisli functor without wrapping with Identity whilst being \"better\" that what I've proposed (more useful structure, better type inference etc).</li>\n</ol>\n\n<p>I'm sorry the last few questions are a bit vague, I understand that type inference vs generality is often a tradeoff, but I'm just looking for some thoughts on it in this particular case.</p>\n\n<p>(This question partly follows on from answers to <a href=\"https://stackoverflow.com/questions/32687682/typeclass-for-what-seems-to-be-a-contravariant-functor-implementing-function-i\">this question</a>)</p>\n"}, {"tags": ["python", "html", "regex", "haskell", "optimization"], "comments": [{"owner": {"reputation": 983, "user_id": 2407413, "user_type": "registered", "accept_rate": 91, "profile_image": "https://www.gravatar.com/avatar/a0127be1eaeb8927c1bcba11cd9641f9?s=128&d=identicon&r=PG", "display_name": "akalikin", "link": "https://stackoverflow.com/users/2407413/akalikin"}, "edited": false, "score": 11, "creation_date": 1442836857, "post_id": 32694646, "comment_id": 53232315, "body": "Watch out, &quot;You can&#39;t parse html with regex&quot; people are coming"}, {"owner": {"reputation": 261, "user_id": 1834416, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/64JHm.png?s=128&g=1", "display_name": "Manuel", "link": "https://stackoverflow.com/users/1834416/manuel"}, "reply_to_user": {"reputation": 983, "user_id": 2407413, "user_type": "registered", "accept_rate": 91, "profile_image": "https://www.gravatar.com/avatar/a0127be1eaeb8927c1bcba11cd9641f9?s=128&d=identicon&r=PG", "display_name": "akalikin", "link": "https://stackoverflow.com/users/2407413/akalikin"}, "edited": false, "score": 0, "creation_date": 1442836923, "post_id": 32694646, "comment_id": 53232355, "body": "I know. But for me this works (I&#39;m not parsing tons of webpages, just a few, with a finite number of tags, etc.). In case it&#39;s not okey, I hope those people offer an alternative :)"}, {"owner": {"reputation": 3508, "user_id": 5069029, "user_type": "registered", "profile_image": "https://lh3.googleusercontent.com/-Fdj5oVYaBD0/AAAAAAAAAAI/AAAAAAAAADY/EhiTrws4Qiw/photo.jpg?sz=128", "display_name": "301_Moved_Permanently", "link": "https://stackoverflow.com/users/5069029/301-moved-permanently"}, "edited": false, "score": 1, "creation_date": 1442837022, "post_id": 32694646, "comment_id": 53232429, "body": "Might be better suited for <a href=\"http://codereview.stackexchange.com\">Code Review</a>"}, {"owner": {"reputation": 31243, "user_id": 2751851, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/4ddc0.png?s=128&g=1", "display_name": "duplode", "link": "https://stackoverflow.com/users/2751851/duplode"}, "edited": false, "score": 1, "creation_date": 1442847690, "post_id": 32694646, "comment_id": 53240041, "body": "You probably can solve this easily with <a href=\"https://hackage.haskell.org/package/pandoc-1.15.0.6\" rel=\"nofollow noreferrer\"><i>pandoc</i></a>, which is both a document conversion application and a Haskell library. Other libraries such as <a href=\"https://hackage.haskell.org/package/tagsoup\" rel=\"nofollow noreferrer\"><i>tagsoup</i></a> can help if you need to adjust the HTML before the conversion."}, {"owner": {"reputation": 49959, "user_id": 866915, "user_type": "registered", "accept_rate": 70, "profile_image": "https://www.gravatar.com/avatar/09242131d6e17cbbe31e8547514da6e5?s=128&d=identicon&r=PG", "display_name": "ErikR", "link": "https://stackoverflow.com/users/866915/erikr"}, "edited": false, "score": 0, "creation_date": 1442849773, "post_id": 32694646, "comment_id": 53241423, "body": "for printing the result to a file, see this SO question: <a href=\"http://stackoverflow.com/q/5214578/866915\">stackoverflow.com/q/5214578/866915</a>"}], "owner": {"reputation": 261, "user_id": 1834416, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/64JHm.png?s=128&g=1", "display_name": "Manuel", "link": "https://stackoverflow.com/users/1834416/manuel"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 93, "favorite_count": 0, "answer_count": 0, "score": 1, "last_activity_date": 1442836659, "creation_date": 1442836659, "question_id": 32694646, "link": "https://stackoverflow.com/questions/32694646/fetching-and-transforming-an-html-document", "title": "Fetching and transforming an HTML document", "body": "<p>I want to create an script that downloads a webpage, transforms some code (from HTML to TeX), and then prints it to a file. I got the first two parts, but I don't know how to print it to a file.</p>\n\n<p>I use regular expressions, but I have heard lots of bad things about them, but\u2026 how could I do this with one of those HTML parsers?</p>\n\n<p>I take a list of urls <code>urllist</code>, and a list of lists for regexes <code>regexlist</code> (the first item is the search, and the second item is the replacement). I loop over all of them and save each url (after transforming through the regexes) into one entry in a dictionary. From there, what I would like to do is print each entry of the dictionary to a different file.</p>\n\n<p>By the way, if you want to show a different solution with another language to show its <em>beauties</em>, do it without problem, I'm looking for different languages :) And, in case you answer in Python, you can definitely optimize this by using a <em>good</em> solution.</p>\n\n<p>In any case, here's my code. Any suggestion would be great (I'm completely new in this language, and programming in general).</p>\n\n<pre><code>import urllib\nimport re\n\noutputpath = \"~/Desktop/foo/\"\nwebpath  = \"http://learnyouahaskell.com/\"\nnamelist = [ \"introduction\",\n             \"starting-out\" ]\nurllist = []\nfor i in range(len(namelist)):\n  urllist.append(webpath + namelist[i])\n\nregexlist = [ [ r\"^&lt;!DOCTYPE([\\s\\S]+?)&lt;h1\" , \"\\\\startweb\\n\\n&lt;h1\" ],\n              [ r\"&lt;/p&gt;[\\s\\n]*?&lt;div class[\\s\\S]+?&lt;/script&gt;\\n&lt;/body&gt;\\n&lt;/html&gt;\", \"&lt;/p&gt;\\n\\n\\\\stopweb\"],\n              [ r\"&lt;h1.*?&gt;(.+?)&lt;/h1&gt;\" , r\"\\chapter{\\1}\\n\" ],\n              [ r\"&lt;h2&gt;(.+?)&lt;/h2&gt;\" , r\"\\section{\\1}\\n\" ],\n              [ r\"&lt;i&gt;(.+?)&lt;/i&gt;\" , r\"\\emph{\\1}\" ],\n              [ r\"&lt;em&gt;(.+?)&lt;/em&gt;\" , r\"\\\\bold{\\1}\" ],\n              [ \"&lt;p&gt;\", \"\\n\" ], [ \"&lt;/p&gt;\", \"\\n\" ],\n              [ \"&lt;pre name=\\\"code\\\" class=\\\"haskell: (.+?)\\\"&gt;([\\\\s\\\\S]+?)\\n?&lt;/pre&gt;\" , r\"\\n\\starthaskell[\\1]\\2\\n\\stophaskell\\n\" ],\n              [ \"\\n\\n\\\\haskell\" , \"\\n\\haskell\" ],\n              [ \"&lt;span class=\\\"fixed\\\"&gt;(.+?)&lt;/span&gt;\" , r\"\\\\typehaskell{\\1}\"],\n              [ \"&lt;span class=\\\"label function\\\"&gt;(.+?)&lt;/span&gt;\" , r\"\\\\haskellfunction{\\1}\"],\n              [ \"&lt;span class=\\\"(class label|label class)\\\"&gt;(.+?)&lt;/span&gt;\" , r\"\\\\haskellclass{\\1}\"],\n              [ \"&lt;span class=\\\"label type\\\"&gt;(.+?)&lt;/span&gt;\" , r\"\\\\haskelltype{\\1}\"],\n              [ \"&lt;img src=\\\"(http://s3.amazonaws.com/lyah/)(.+?).png\\\" (alt|class)=\\\"(.+?)\\\" (class|alt)=\\\"(.+?)\\\" width=\\\"(\\d+)\\\" height=\\\"(\\d+)\\\"&gt;\" , r\"\\n\\placeimage[\\2]{url=\\1\\2.png,\\3=\\4,\\5=\\6,width=\\7pt,height=\\8pt}\\n\" ],\n              [ \"&lt;a href=\\\"(.+?)\\\"&gt;(.+?)&lt;/a&gt;\" , r\"\\\\url[\\1]{\\2}\" ],\n              [ \"&lt;a.*?&gt;&lt;/a&gt;\", \"\" ],\n              [ \"#\" , \"\\#\" ],\n              [ \"&amp;amp;\" , \"&amp;\" ],\n              [ \"&amp;hellip;\" , \"\\dots\" ],\n              [ \"&amp;gt;\" , \"&gt;\" ],\n              [ \"&amp;lt;\" , \"&lt;\" ]\n            ]\n\nfinaldoc = {}\nfor i in range(len(namelist)):\n  htmlfile = urllib.urlopen(urllist[i])\n  htmltext = htmlfile.read()\n  for regex in regexlist:\n    searchpattern  = regex[0]\n    replacepattern = regex[1]\n    htmltext = re.sub(searchpattern, replacepattern, htmltext)\n  finaldoc[namelist[i]] = htmltext\n</code></pre>\n"}, {"tags": ["scala", "haskell", "scalaz", "scalaz7"], "answers": [{"comments": [{"owner": {"reputation": 1347, "user_id": 432779, "user_type": "registered", "accept_rate": 56, "profile_image": "https://www.gravatar.com/avatar/48a5f4e45308362d9c0d18de8932010c?s=128&d=identicon&r=PG", "display_name": "mjaskowski", "link": "https://stackoverflow.com/users/432779/mjaskowski"}, "edited": false, "score": 0, "creation_date": 1442837323, "post_id": 32693163, "comment_id": 53232631, "body": "The second ones does the thing, thanks! The first one does not compile - tried to fix it somehow but my knowledge is too limited atm.  Here is a reversed question to mine: <a href=\"http://stackoverflow.com/questions/8736164/what-are-type-lambdas-in-scala-and-what-are-their-benefits\" title=\"what are type lambdas in scala and what are their benefits\">stackoverflow.com/questions/8736164/&hellip;</a>  I guess sth similar must be available in Haskell as well but not in the particular example of Writer, right?  <a href=\"http://stackoverflow.com/questions/4069840/lambda-for-type-expressions-in-haskell\" title=\"lambda for type expressions in haskell\">stackoverflow.com/questions/4069840/&hellip;</a>"}, {"owner": {"reputation": 5954, "user_id": 913053, "user_type": "registered", "accept_rate": 67, "profile_image": "https://www.gravatar.com/avatar/743aa0a59a62edfdc9c58509cd956a67?s=128&d=identicon&r=PG", "display_name": "Aldo Stracquadanio", "link": "https://stackoverflow.com/users/913053/aldo-stracquadanio"}, "reply_to_user": {"reputation": 1347, "user_id": 432779, "user_type": "registered", "accept_rate": 56, "profile_image": "https://www.gravatar.com/avatar/48a5f4e45308362d9c0d18de8932010c?s=128&d=identicon&r=PG", "display_name": "mjaskowski", "link": "https://stackoverflow.com/users/432779/mjaskowski"}, "edited": false, "score": 0, "creation_date": 1442840001, "post_id": 32693163, "comment_id": 53234517, "body": "I don&#39;t know much about how Haskell deals with this but I suspect that it is a bit more flexible when partially applying types with multiple parameters. I&#39;d like to know what is the failure for the type lambda."}], "tags": [], "owner": {"reputation": 5954, "user_id": 913053, "user_type": "registered", "accept_rate": 67, "profile_image": "https://www.gravatar.com/avatar/743aa0a59a62edfdc9c58509cd956a67?s=128&d=identicon&r=PG", "display_name": "Aldo Stracquadanio", "link": "https://stackoverflow.com/users/913053/aldo-stracquadanio"}, "is_accepted": true, "score": 2, "last_activity_date": 1442831998, "creation_date": 1442831998, "answer_id": 32693163, "question_id": 32692819, "link": "https://stackoverflow.com/questions/32692819/scalaz-writer-monad-and-filterm/32693163#32693163", "title": "Scalaz Writer Monad and filterM", "body": "<p>The issue is due to the fact that Scala can't really know how to fit a type with three <em>holes</em> into the argument expected by <code>filterM</code>, which has only one <em>hole</em> filled with a <code>Boolean</code>.</p>\n\n<p>You could solve your problem using some weird type-lambda syntax like this (not tested, may not work):</p>\n\n<pre><code>val keepSmall: (Int =&gt; ({type L[T] = WriterT[Id, Vector[String], T]})#L) = ...\n</code></pre>\n\n<p>Or (much easier) by introducing a type alias as follows:</p>\n\n<pre><code>type MyWriter[T] = WriterT[Id, Vector[String], T]\nval keepSmall: (Int =&gt; MyWriter[Boolean]) = ...\n</code></pre>\n\n<p>This will make sure that the kind of the argument expected by <code>filterM</code> matches with the kind of the argument you are providing. </p>\n"}], "owner": {"reputation": 1347, "user_id": 432779, "user_type": "registered", "accept_rate": 56, "profile_image": "https://www.gravatar.com/avatar/48a5f4e45308362d9c0d18de8932010c?s=128&d=identicon&r=PG", "display_name": "mjaskowski", "link": "https://stackoverflow.com/users/432779/mjaskowski"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 203, "favorite_count": 0, "accepted_answer_id": 32693163, "answer_count": 1, "score": 0, "last_activity_date": 1442837527, "creation_date": 1442831020, "last_edit_date": 1442837527, "question_id": 32692819, "link": "https://stackoverflow.com/questions/32692819/scalaz-writer-monad-and-filterm", "title": "Scalaz Writer Monad and filterM", "body": "<p>I am working my way through <a href=\"http://eed3si9n.com/learning-scalaz/\" rel=\"nofollow\">learning scalaz</a> and <a href=\"http://learnyouahaskell.com/\" rel=\"nofollow\">Learn You A Haskell For Greater Good</a> and wonder how to translate the filterM example from LYAHFGG to Scala.</p>\n\n<p><code>fst $ runWriter $ filterM keepSmall [9,1,5,2,10,3]</code></p>\n\n<p>with <code>keepSmall</code> defined as</p>\n\n<pre><code>keepSmall :: Int -&gt; Writer [String] Bool  \nkeepSmall x  \n    | x &lt; 4 = do  \n        tell [\"Keeping \" ++ show x]  \n        return True  \n    | otherwise = do  \n        tell [show x ++ \" is too large, throwing it away\"]  \n        return False\n</code></pre>\n\n<p>My naive approach ends with compilation errors and I have no clue how to go around that issue!</p>\n\n<pre><code>    val keepSmall: (Int =&gt; WriterT[Id, Vector[String], Boolean]) = (x: Int) =&gt; \n      if (x &lt; 4) for {\n        _ &lt;- Vector(\"Keeping \" + x.shows).tell\n      } yield true\n      else for {\n        _ &lt;- Vector(x.shows + \" is too large, throwing it away\").tell\n      } yield false\n\nprintln(List(9,1,5,2,10,3) filterM keepSmall)\n</code></pre>\n\n<p>Compilation errors:</p>\n\n<pre><code> Error:(182, 32) no type parameters for method filterM: (p: Int =&gt; M[Boolean])(implicit evidence$4: scalaz.Applicative[M])M[List[Int]] exist so that it can be applied to arguments (Int =&gt; scalaz.WriterT[scalaz.Scalaz.Id,Vector[String],Boolean])\n --- because ---\nargument expression's type is not compatible with formal parameter type;\n found   : Int =&gt; scalaz.WriterT[scalaz.Scalaz.Id,Vector[String],Boolean]\n required: Int =&gt; ?M[Boolean]\n    println(List(9,1,5,2,10,3) filterM keepSmall)\n                               ^\n</code></pre>\n\n<p>and</p>\n\n<pre><code>Error:(182, 40) type mismatch;\n found   : Int =&gt; scalaz.WriterT[scalaz.Scalaz.Id,Vector[String],Boolean]\n required: Int =&gt; M[Boolean]\n    println(List(9,1,5,2,10,3) filterM keepSmall)\n                                       ^\n</code></pre>\n"}, {"tags": ["javascript", "haskell", "underscore.js", "lodash", "ramda.js"], "comments": [{"owner": {"reputation": 100185, "user_id": 3234959, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/93bb12ca0f93dfddb33880316f7e66c2?s=128&d=identicon&r=PG&f=1", "display_name": "chi", "link": "https://stackoverflow.com/users/3234959/chi"}, "edited": false, "score": 0, "creation_date": 1442831373, "post_id": 32692057, "comment_id": 53228913, "body": "My 2 cents: as much as I love functional programming, I find the idiom accumulator+recursion to be a somewhat inelegant encoding of a stateful <code>for</code> loop. In an imperative language, I&#39;d prefer a loop over that FP idiom. Of course, sometimes such loops are actually folds, as in the posted example, and in such cases I find the FP higher-order folds to be more elegant than <code>for</code>s or accumulators. Of course, all of this is just a matter of personal taste."}], "answers": [{"tags": [], "owner": {"reputation": 43759, "user_id": 1651941, "user_type": "registered", "accept_rate": 97, "profile_image": "https://www.gravatar.com/avatar/a513bc1fa519d2fcf5e4e0d9b5500101?s=128&d=identicon&r=PG", "display_name": "Sibi", "link": "https://stackoverflow.com/users/1651941/sibi"}, "is_accepted": false, "score": 4, "last_activity_date": 1442829755, "creation_date": 1442829755, "answer_id": 32692390, "question_id": 32692057, "link": "https://stackoverflow.com/questions/32692057/use-of-functional-haskell-like-accumulator-in-javascript-functions/32692390#32692390", "title": "Use of functional Haskell-like Accumulator in javascript functions", "body": "<p>This is a direct translation of the Haskell code in javascript :</p>\n\n<pre><code>function power_acc(x, y) {\n    return aux(x,y,1);\n    function aux(x, y, acc) {\n        if (y == 0)\n            return acc;\n        else\n            return aux(x, y-1, acc*x);\n    }\n}\n</code></pre>\n\n<blockquote>\n  <p>Is there any library like ramda, lodash, ... that supports this\n  way of programming? </p>\n</blockquote>\n\n<p>You don't need lodash or ramda for that. You can do that with your\nplain javascript just as I have shown above. Also note that lodash is\nan utility library providing a consistent API for operating with\ncollections in a functional way. It won't help you in these scenarios.</p>\n"}, {"comments": [{"owner": {"reputation": 36858, "user_id": 1243641, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/a70aa9d494bf438c8b56aced999e897f?s=128&d=identicon&r=PG", "display_name": "Scott Sauyet", "link": "https://stackoverflow.com/users/1243641/scott-sauyet"}, "edited": false, "score": 2, "creation_date": 1442841593, "post_id": 32692835, "comment_id": 53235678, "body": "&quot;With ES6, tail recursion is fully supported in JS&quot;  ... However, it&#39;s really <a href=\"https://kangax.github.io/compat-table/es6/#proper_tail_calls_(tail_call_optimisation)\" rel=\"nofollow noreferrer\">not implemented yet</a>."}, {"owner": {"reputation": 507143, "user_id": 1048572, "user_type": "registered", "accept_rate": 77, "profile_image": "https://www.gravatar.com/avatar/7f2c4de95e8f4f8f5a71c3aaf0ed312a?s=128&d=identicon&r=PG", "display_name": "Bergi", "link": "https://stackoverflow.com/users/1048572/bergi"}, "reply_to_user": {"reputation": 36858, "user_id": 1243641, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/a70aa9d494bf438c8b56aced999e897f?s=128&d=identicon&r=PG", "display_name": "Scott Sauyet", "link": "https://stackoverflow.com/users/1243641/scott-sauyet"}, "edited": false, "score": 0, "creation_date": 1442847557, "post_id": 32692835, "comment_id": 53239939, "body": "@ScottSauyet: True (unless for babel). Just another reason to use the idiomatic loop :-)"}], "tags": [], "owner": {"reputation": 507143, "user_id": 1048572, "user_type": "registered", "accept_rate": 77, "profile_image": "https://www.gravatar.com/avatar/7f2c4de95e8f4f8f5a71c3aaf0ed312a?s=128&d=identicon&r=PG", "display_name": "Bergi", "link": "https://stackoverflow.com/users/1048572/bergi"}, "is_accepted": true, "score": 4, "last_activity_date": 1442831087, "creation_date": 1442831087, "answer_id": 32692835, "question_id": 32692057, "link": "https://stackoverflow.com/questions/32692057/use-of-functional-haskell-like-accumulator-in-javascript-functions/32692835#32692835", "title": "Use of functional Haskell-like Accumulator in javascript functions", "body": "<blockquote>\n  <p>Is there a construct in javascript similar to that? </p>\n</blockquote>\n\n<p>Yes, you can literally translate this to JS:</p>\n\n<pre><code>function power_acc(x, y) { // Double -&gt; Int -&gt; Double\n    y = y&gt;&gt;&gt;0; // cast to positive int (avoiding nontermination)\n    return power_acc_h(x, y, 1);\n}\nfunction power_acc_h(x, y, acc) { // Double -&gt; Int -&gt; Double -&gt; Double\n    return y == 0\n      ? acc\n      : power_acc_h(x, y-1, acc*x);\n}\n</code></pre>\n\n<blockquote>\n  <p>Or does it even make sense regarding efficiency since javascript is not as functional as Haskell?</p>\n</blockquote>\n\n<p>With ES6, tail recursion is fully supported in JS, and you'll get the same efficiency as with a loop (and possibly even better than haskell, as you don't create lazy multiplications).</p>\n\n<blockquote>\n  <p>Is there any library like ramda, lodash, ... that supports this way of programming</p>\n</blockquote>\n\n<p>No library required. Although I'm sure there are libs that simplify type checking or offer nicer notation for pattern matching.</p>\n\n<blockquote>\n  <p>How would you write this for example in javascript?</p>\n</blockquote>\n\n<p>You'd use a <code>while</code> loop. All accumulation functions in haskell are written this way because they can be directly optimised into a loop, and that's the notation you should use for this construct in JS (as most programmers are familiar with it):</p>\n\n<pre><code>function power_acc(x, y) { // Double -&gt; Int -&gt; Double\n    y = y&gt;&gt;&gt;0; // cast to positive int (avoiding nontermination)\n    var acc = 1;\n    while (y != 0) {\n        acc *= x;\n        y -= 1;\n    }\n    return acc;\n}\n</code></pre>\n\n<p>Mutating local variables is no harm, your function is still pure. If you're looking for an even shorter notation, use a <code>for</code> loop.</p>\n"}, {"tags": [], "owner": {"reputation": 4761, "user_id": 2277395, "user_type": "registered", "accept_rate": 56, "profile_image": "https://www.gravatar.com/avatar/09841ca82e49f998ea0b8f159dea87c1?s=128&d=identicon&r=PG", "display_name": "Martin Drautzburg", "link": "https://stackoverflow.com/users/2277395/martin-drautzburg"}, "is_accepted": false, "score": 3, "last_activity_date": 1442852783, "last_edit_date": 1442852783, "creation_date": 1442831151, "answer_id": 32692859, "question_id": 32692057, "link": "https://stackoverflow.com/questions/32692057/use-of-functional-haskell-like-accumulator-in-javascript-functions/32692859#32692859", "title": "Use of functional Haskell-like Accumulator in javascript functions", "body": "<p>In addition to Sibi's answer, I'd like to point out that javascript (at least nodejs) actually allocates stack space. It works fine and fast up to exponents of about 13,000, then you'll get <code>RangeError: Maximum call stack size exceeded</code>. To carry out this experimant you need to set the base to a number close to 1 (e.g. 1.0001) or you'll get Infinity.</p>\n\n<p>Haskell does not suffer from this problem. An exponent 1000 times as big (namely 13,000,000) still does not cause any space problems, though it does take a few seconds to run. This is because the recursion is a tail call, and these run in constant space in haskell.</p>\n\n<p>So in a way Sibi's answer mimicks haskells expressiveness, but it still exhibits a different runtime behavior. I don't think there is anythining you can do about this.</p>\n"}, {"tags": [], "owner": {"reputation": 36858, "user_id": 1243641, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/a70aa9d494bf438c8b56aced999e897f?s=128&d=identicon&r=PG", "display_name": "Scott Sauyet", "link": "https://stackoverflow.com/users/1243641/scott-sauyet"}, "is_accepted": false, "score": 3, "last_activity_date": 1442858754, "last_edit_date": 1442858754, "creation_date": 1442842947, "answer_id": 32696839, "question_id": 32692057, "link": "https://stackoverflow.com/questions/32692057/use-of-functional-haskell-like-accumulator-in-javascript-functions/32696839#32696839", "title": "Use of functional Haskell-like Accumulator in javascript functions", "body": "<p>I agree with all the answers in that a library is neither required nor particularly helpful.  (I'm one of the authors of Ramda, BTW.)</p>\n\n<p>Bergi's translation into JS is fine, although I think it's more idiomatic at least in browser-side JS, to embed the helper function inside a local closure, something a little closer to Sibi's answer.</p>\n\n<p>The reason for the performance problem that Martin Drautzburg points out is that, although tail-call optimization <a href=\"http://www.ecma-international.org/ecma-262/6.0/#sec-preparefortailcall\" rel=\"nofollow\">is specified</a>, it's <a href=\"https://kangax.github.io/compat-table/es6/#proper_tail_calls_(tail_call_optimisation)\" rel=\"nofollow\">barely implemented</a> anywhere.  One exception is Babel's support for direct recursion, so a Babel-transpiled version should get the expected performance benefit.</p>\n\n<p>So if you want to do this because of the elegance and because you believe TCO will come along soon enough, and if you're not worried about current possible performance problems, then these responses are useful, and I'll even throw one more ES6 technique into the mix:</p>\n\n<pre><code>// Double -&gt; Int -&gt; Double -&gt; Double\nfunction powerAcc(x, y, acc = 1) {\n    return y == 0 ? acc : powerAcc(x, y - 1, acc * x);\n}\n\npowerAcc(2, 5); //=&gt; 32\n</code></pre>\n\n<p><a href=\"http://www.ecma-international.org/ecma-262/6.0/#sec-functiondeclarationinstantiation\" rel=\"nofollow\">Default function parameters</a> help replace some simple forms of pattern matching in this language, which doesn't have true pattern matching.  This still relies on TCO, but makes for somewhat cleaner code.  It should also run performantly in Babel.</p>\n"}], "owner": {"reputation": 345, "user_id": 3893149, "user_type": "registered", "accept_rate": 78, "profile_image": "https://i.stack.imgur.com/aVlsz.jpg?s=128&g=1", "display_name": "Vin Banton", "link": "https://stackoverflow.com/users/3893149/vin-banton"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 234, "favorite_count": 0, "accepted_answer_id": 32692835, "answer_count": 4, "score": 2, "last_activity_date": 1550711635, "creation_date": 1442828755, "last_edit_date": 1550711635, "question_id": 32692057, "link": "https://stackoverflow.com/questions/32692057/use-of-functional-haskell-like-accumulator-in-javascript-functions", "title": "Use of functional Haskell-like Accumulator in javascript functions", "body": "<p>I'm currently looking into Haskell and i'm fascinated by some of its features, for example the end-recursive functions using an accumulator.</p>\n\n<p>Questions:</p>\n\n<ol>\n<li>Is there a construct in javascript similar to that? Or does it even\nmake sense regarding efficiency since javascript is not as\nfunctional as Haskell?</li>\n<li>Is there any library like ramda, lodash, ... that supports this way\nof programming</li>\n<li><p>And if so, how would you write this for example in javascript:</p>\n\n<pre><code> power_acc :: Double -&gt; Int -&gt; Double\n power_acc x y = power_acc_h x y 1\n\n power_acc_h :: Double -&gt; Int -&gt; Double -&gt; Double\n power_acc_h x 0 acc = acc\n power_acc_h x y acc = power_acc_h x (y-1) (acc*x)\n</code></pre></li>\n</ol>\n"}, {"tags": ["haskell", "category-theory", "category-abstractions"], "comments": [{"owner": {"reputation": 67060, "user_id": 783743, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/835bdcdab3e4bf466f0d59f809c50035?s=128&d=identicon&r=PG", "display_name": "Aadit M Shah", "link": "https://stackoverflow.com/users/783743/aadit-m-shah"}, "edited": false, "score": 1, "creation_date": 1442812968, "post_id": 32687682, "comment_id": 53219944, "body": "You might find this blog post interesting: <a href=\"http://gelisam.blogspot.com/2013/07/the-commutative-monad.html\" rel=\"nofollow noreferrer\">gelisam.blogspot.com/2013/07/the-commutative-monad.html</a>"}, {"owner": {"reputation": 67060, "user_id": 783743, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/835bdcdab3e4bf466f0d59f809c50035?s=128&d=identicon&r=PG", "display_name": "Aadit M Shah", "link": "https://stackoverflow.com/users/783743/aadit-m-shah"}, "edited": false, "score": 2, "creation_date": 1442814689, "post_id": 32687682, "comment_id": 53220456, "body": "The problem, in my humble opinion, is that <code>invert</code> is a contravariant endofunctor in the category of <code>Invertible</code> whereas <code>Contravariant f</code> is a contravariant endofunctor in the category of <code>Hask</code>."}, {"owner": {"reputation": 44013, "user_id": 1477667, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/trgKM.jpg?s=128&g=1", "display_name": "dfeuer", "link": "https://stackoverflow.com/users/1477667/dfeuer"}, "reply_to_user": {"reputation": 67060, "user_id": 783743, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/835bdcdab3e4bf466f0d59f809c50035?s=128&d=identicon&r=PG", "display_name": "Aadit M Shah", "link": "https://stackoverflow.com/users/783743/aadit-m-shah"}, "edited": false, "score": 0, "creation_date": 1442815390, "post_id": 32687682, "comment_id": 53220716, "body": "@AaditMShah, that was my guess too, but I don&#39;t know enough category theory to be confident."}, {"owner": {"reputation": 44013, "user_id": 1477667, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/trgKM.jpg?s=128&g=1", "display_name": "dfeuer", "link": "https://stackoverflow.com/users/1477667/dfeuer"}, "edited": false, "score": 1, "creation_date": 1442853645, "post_id": 32687682, "comment_id": 53243750, "body": "You may or may not already know about the lens types <code>Iso s t a b = forall f p . (Functor f, Profunctor p) =&gt; p a (f b) -&gt; p s (f t)</code> and <code>Iso&#39; a b = Iso a a b b</code>. <code>Iso&#39;</code> ends up being isomorphic to your type. This doesn&#39;t relate to your question; I just thought you might find it interesting."}], "answers": [{"comments": [{"owner": {"reputation": 67060, "user_id": 783743, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/835bdcdab3e4bf466f0d59f809c50035?s=128&d=identicon&r=PG", "display_name": "Aadit M Shah", "link": "https://stackoverflow.com/users/783743/aadit-m-shah"}, "edited": false, "score": 0, "creation_date": 1442815024, "post_id": 32688139, "comment_id": 53220594, "body": "You beat me to it. I knew that the problem was because the OP was trying to marry <code>Prelude.id</code> with <code>Control.Category.id</code> and <code>Prelude..</code> with <code>Control.Category..</code>, but I didn&#39;t get the time to write an answer. I was led astray by the following blog post: <a href=\"http://gelisam.blogspot.com/2013/07/the-commutative-monad.html\" rel=\"nofollow noreferrer\">gelisam.blogspot.com/2013/07/the-commutative-monad.html</a>"}, {"owner": {"reputation": 20310, "user_id": 525980, "user_type": "registered", "accept_rate": 48, "profile_image": "https://www.gravatar.com/avatar/8dafe66793ee2f32192e9fcefb389a12?s=128&d=identicon&r=PG", "display_name": "Clinton", "link": "https://stackoverflow.com/users/525980/clinton"}, "edited": false, "score": 2, "creation_date": 1442818361, "post_id": 32688139, "comment_id": 53221887, "body": "Lets say we reverse what&#39;s found in Control.Categorical.fmap which is <code>r a b -&gt; t (f a) (f b)</code>. Instead reverse to be <code>contramap :: r a b -&gt; t (f b) (f a)</code>. Let r = Invertible and t = Invertible. From here we&#39;ve got <code>contramap :: Invertible a b -&gt; Invertible (f b) (f a)</code>. I guess at this point we just need &quot;f&quot; to be Id?"}, {"owner": {"reputation": 67060, "user_id": 783743, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/835bdcdab3e4bf466f0d59f809c50035?s=128&d=identicon&r=PG", "display_name": "Aadit M Shah", "link": "https://stackoverflow.com/users/783743/aadit-m-shah"}, "reply_to_user": {"reputation": 20310, "user_id": 525980, "user_type": "registered", "accept_rate": 48, "profile_image": "https://www.gravatar.com/avatar/8dafe66793ee2f32192e9fcefb389a12?s=128&d=identicon&r=PG", "display_name": "Clinton", "link": "https://stackoverflow.com/users/525980/clinton"}, "edited": false, "score": 0, "creation_date": 1442850537, "post_id": 32688139, "comment_id": 53241903, "body": "@Clinton Indeed. You would define <code>class (Category c, Category d) =&gt; Contravariant f c d | f c -&gt; d, f d -&gt; c where contramap :: c x y -&gt; d (f y) (f x)</code>. Then you would define <code>instance Contravariant Identity Invertible Invertible where contramap (Invertible f g) = Invertible (Identity . g . runIdentity) (Identity . f . runIdentity)</code>. Now you have <code>contramap</code> isomorphic to <code>invert</code>. However, I doubt that you would want to use <code>contramap</code> because you would have to deal with an unnecessary <code>Identity</code> wrapper. You&#39;re better off simply using the <code>invert</code> function directly."}], "tags": [], "owner": {"reputation": 57219, "user_id": 33796, "user_type": "registered", "accept_rate": 70, "profile_image": "https://www.gravatar.com/avatar/08727b23ba62e634b32988cdff082663?s=128&d=identicon&r=PG", "display_name": "luqui", "link": "https://stackoverflow.com/users/33796/luqui"}, "is_accepted": false, "score": 8, "last_activity_date": 1442818533, "last_edit_date": 1442818533, "creation_date": 1442814535, "answer_id": 32688139, "question_id": 32687682, "link": "https://stackoverflow.com/questions/32687682/typeclass-for-what-seems-to-be-a-contravariant-functor-implementing-function-i/32688139#32688139", "title": "Typeclass for (what seems to be) a contravariant functor implementing function inversion", "body": "<p>A category has two collections: objects and morphisms.</p>\n\n<p>The usual Haskell prelude, and it appears that the classes in <code>Data.Functor.Contravariant</code>, only operate on a very narrow category, that is the category where types are objects and functions are morphisms, usually denoted <strong>Hask</strong>. The standard <code>Functor</code> class is also very narrow: they only represent <em>endofunctors</em> on <strong>Hask</strong>: they must take types to types and functions to functions.</p>\n\n<p>Take for example the functor <code>Maybe</code>.  The way <code>Maybe</code> acts on types is just that it takes types <code>a</code> to <code>Maybe a</code>.  <code>Maybe</code> maps <code>Int</code> to <code>Maybe Int</code> and so on (I know this sounds a bit trivial).  What it does to morphisms is encoded by <code>fmap</code>: <code>fmap</code> takes <code>f :: (a -&gt; b)</code>, a morphism between two objects in <strong>Hask</strong>, and maps it to <code>fmap f :: (Maybe a -&gt; Maybe b)</code>, another morphism in <strong>Hask</strong> between the objects that the functor maps to.  In Haskell we could not define a <code>Functor</code> which takes e.g. <code>Int</code> to <code>Char</code> -- all Haskell <code>Functor</code>s have to be type constructors -- but in general category theory we could.</p>\n\n<p><code>Control.Category</code> generalizes a little bit: the objects of a <code>Control.Category</code> category <code>C</code> are still types[1] just like in <strong>Hask</strong>, but its morphisms are things of type <code>C a b</code>.  So in your example, the objects are still arbitrary types, but your morphisms are things of type <code>Invertible a b</code>.  Since your morphisms are not functions, you will not be able to use the standard <code>Functor</code> classes. </p>\n\n<p>However, it's a fun exercise in building up your category theory knowhow to define a functor class which operates between <code>Category</code> categories rather than assuming <strong>Hask</strong>, which would capture your example. Remember, a functor acts on objects (types) <em>and</em> morphisms.</p>\n\n<p>I'll leave you with that -- feel free to comment if you would like more guidance.</p>\n\n<hr>\n\n<p>[1] Ignoring <code>PolyKinds</code>, which makes this a bit more general.</p>\n"}], "owner": {"reputation": 20310, "user_id": 525980, "user_type": "registered", "accept_rate": 48, "profile_image": "https://www.gravatar.com/avatar/8dafe66793ee2f32192e9fcefb389a12?s=128&d=identicon&r=PG", "display_name": "Clinton", "link": "https://stackoverflow.com/users/525980/clinton"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 169, "favorite_count": 1, "answer_count": 1, "score": 6, "last_activity_date": 1559485006, "creation_date": 1442811602, "last_edit_date": 1559485006, "question_id": 32687682, "link": "https://stackoverflow.com/questions/32687682/typeclass-for-what-seems-to-be-a-contravariant-functor-implementing-function-i", "title": "Typeclass for (what seems to be) a contravariant functor implementing function inversion", "body": "<p>Lets say I have the following</p>\n\n<pre><code>import Control.Category (Category, (.), id)\n\ndata Invertible a b = Invertible (a -&gt; b) (b -&gt; a)\n\ninstance Category Invertible where\n  id = Invertible Prelude.id Prelude.id\n  (Invertible f f') . (Invertible g g') = \n    Invertible (f Prelude.. g) (g' Prelude.. f')\n\ninvert (Invertible x y) = Invertible y x\n</code></pre>\n\n<p>Note that the following is true:</p>\n\n<pre><code>invert (g . f) == invert f . invert g\n</code></pre>\n\n<p>This structure seems very similar to a <a href=\"https://en.wikipedia.org/wiki/Functor#Covariance_and_contravariance\">contravariant functor (wikipedia)</a>, as it follows the same axiom:</p>\n\n<pre><code> F(g . f) = F(f) . F(g) \n</code></pre>\n\n<p>In my case, <code>F</code> is simply <code>invert</code>.</p>\n\n<p>I looked at <a href=\"https://hackage.haskell.org/package/contravariant-1.3.3/docs/Data-Functor-Contravariant.html#v:contramap\">Data.Functor.Contravariant.contramap</a>, which has a function of the type:</p>\n\n<pre><code>(a -&gt; b) -&gt; f b -&gt; f a\n</code></pre>\n\n<p>But I didn't know how'd I'd implement that in my situation. For example, I can't work out a sensible choice for <code>f</code>, and in my situation, there's no function <code>a -&gt; b</code>, just <code>invert</code>.</p>\n\n<p>However, <code>invert</code> nevertheless fits the mathematical axiom of a contravariant functor, so I'm thinking I can fit this into some existing class, but I just can't find which one and how to do it. Any help or pointers would be appreciated.</p>\n"}, {"tags": ["haskell"], "comments": [{"owner": {"reputation": 44013, "user_id": 1477667, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/trgKM.jpg?s=128&g=1", "display_name": "dfeuer", "link": "https://stackoverflow.com/users/1477667/dfeuer"}, "edited": false, "score": 3, "creation_date": 1442812332, "post_id": 32687680, "comment_id": 53219770, "body": "Does this actually have anything to do with the <code>TemplateHaskell</code> language extension, or just something you&#39;re calling a template?"}, {"owner": {"reputation": 55, "user_id": 5357736, "user_type": "registered", "accept_rate": 50, "profile_image": "https://www.gravatar.com/avatar/b319f086ca2471700d7396a6f135e04a?s=128&d=identicon&r=PG&f=1", "display_name": "user_9", "link": "https://stackoverflow.com/users/5357736/user-9"}, "reply_to_user": {"reputation": 44013, "user_id": 1477667, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/trgKM.jpg?s=128&g=1", "display_name": "dfeuer", "link": "https://stackoverflow.com/users/1477667/dfeuer"}, "edited": false, "score": 0, "creation_date": 1442819449, "post_id": 32687680, "comment_id": 53222338, "body": "@dfeuer hmm well I guess it&#39;s just something we call template"}], "answers": [{"comments": [{"owner": {"reputation": 1790, "user_id": 3350784, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/OTuvN.png?s=128&g=1", "display_name": "Yuuri", "link": "https://stackoverflow.com/users/3350784/yuuri"}, "edited": false, "score": 0, "creation_date": 1442835971, "post_id": 32689571, "comment_id": 53231738, "body": "I&#39;d consider using <code>map (either (const 0) (const 1))</code> in the first example."}, {"owner": {"reputation": 43759, "user_id": 1651941, "user_type": "registered", "accept_rate": 97, "profile_image": "https://www.gravatar.com/avatar/a513bc1fa519d2fcf5e4e0d9b5500101?s=128&d=identicon&r=PG", "display_name": "Sibi", "link": "https://stackoverflow.com/users/1651941/sibi"}, "reply_to_user": {"reputation": 1790, "user_id": 3350784, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/OTuvN.png?s=128&g=1", "display_name": "Yuuri", "link": "https://stackoverflow.com/users/3350784/yuuri"}, "edited": false, "score": 0, "creation_date": 1443022352, "post_id": 32689571, "comment_id": 53328276, "body": "@Yuuri, That&#39;s cleaner. Updated the answer."}], "tags": [], "owner": {"reputation": 43759, "user_id": 1651941, "user_type": "registered", "accept_rate": 97, "profile_image": "https://www.gravatar.com/avatar/a513bc1fa519d2fcf5e4e0d9b5500101?s=128&d=identicon&r=PG", "display_name": "Sibi", "link": "https://stackoverflow.com/users/1651941/sibi"}, "is_accepted": true, "score": 2, "last_activity_date": 1443022357, "last_edit_date": 1443022357, "creation_date": 1442820420, "answer_id": 32689571, "question_id": 32687680, "link": "https://stackoverflow.com/questions/32687680/count-number-of-slots-in-a-template-in-haskell/32689571#32689571", "title": "Count number of slots in a template in haskell", "body": "<p>Something like this should work:</p>\n\n<pre><code>template :: Template -&gt; Int\ntemplate (Template xs) = sum $ map (\\x -&gt; either (\\_ -&gt; 0) (\\_ -&gt; 1) x) xs\n</code></pre>\n\n<p>In case you are seeing value of <code>Right</code> value constructor, you are returning <code>1</code> else <code>0</code>. And finally you just sum it up to get the number of slots.</p>\n\n<p>Or as Yuuri points out, this is more elegant:</p>\n\n<pre><code>template :: Template -&gt; Int\ntemplate (Template xs) = sum $ map (either (const 0) (const 1)) xs\n</code></pre>\n\n<p>Or even this:</p>\n\n<pre><code>import Data.Either (rights)\n\ntemplate :: Template -&gt; Int\ntemplate (Template xs) = length $ rights xs\n</code></pre>\n\n<p>Demo in <code>ghci</code>:</p>\n\n<pre><code>\u03bb&gt; template $ Template [Right Slot, Right Slot, Right Slot]\n3\n\u03bb&gt; template $ Template [Right Slot, Right Slot, Right Slot, Left \"hi\"]\n3\n\u03bb&gt; template $ Template [Right Slot, Right Slot, Right Slot, Left \"hi\", Right Slot]\n4\n\u03bb&gt; template $ Template []\n0\n</code></pre>\n"}], "owner": {"reputation": 55, "user_id": 5357736, "user_type": "registered", "accept_rate": 50, "profile_image": "https://www.gravatar.com/avatar/b319f086ca2471700d7396a6f135e04a?s=128&d=identicon&r=PG&f=1", "display_name": "user_9", "link": "https://stackoverflow.com/users/5357736/user-9"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 204, "favorite_count": 1, "accepted_answer_id": 32689571, "answer_count": 1, "score": 1, "last_activity_date": 1443022357, "creation_date": 1442811594, "last_edit_date": 1442819426, "question_id": 32687680, "link": "https://stackoverflow.com/questions/32687680/count-number-of-slots-in-a-template-in-haskell", "title": "Count number of slots in a template in haskell", "body": "<p>I need to write a function, that will count the number of slots in a template. Such <code>template ({})foo{}{} = 3</code>. I have function prototype as </p>\n\n<pre><code>template :: Template -&gt; Int\ntemplatey (Template xs) =\n</code></pre>\n\n<p>And some helper functions:</p>\n\n<pre><code>data Slot = Slot\n      deriving (Show, Eq)\n\ndata Template =\n    Template [Either String Slot]\n    deriving Eq\n\ninstance Show Template where\n show (Template xs) =   concat $ map f xs\n    where f (Left x) = x\n      f (Right x) = \"{}\"\n\ndata Def =\n    Def [Template]\n    deriving Eq\n</code></pre>\n\n<p>I wrote that: </p>\n\n<p><code>temp = Template [Right Slot]</code>\nAnd I guess I need to use map somehow to check if input template matches temp. But, I can't find the way how to do it. Any help is highly appreciated. </p>\n"}, {"tags": ["haskell"], "comments": [{"owner": {"reputation": 44013, "user_id": 1477667, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/trgKM.jpg?s=128&g=1", "display_name": "dfeuer", "link": "https://stackoverflow.com/users/1477667/dfeuer"}, "edited": false, "score": 1, "creation_date": 1442811942, "post_id": 32687677, "comment_id": 53219645, "body": "As far as I can tell, it&#39;s not even a wrapper around <code>bytestring</code>&#39;s <code>Builder</code> type\u2014it <i>is</i> <code>bytestring</code>&#39;s <code>Builder</code> type!"}, {"owner": {"reputation": 30377, "user_id": 369198, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/71596bb1ca3ba3aa4400c3f407baec9f?s=128&d=identicon&r=PG", "display_name": "Michael Snoyman", "link": "https://stackoverflow.com/users/369198/michael-snoyman"}, "reply_to_user": {"reputation": 44013, "user_id": 1477667, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/trgKM.jpg?s=128&g=1", "display_name": "dfeuer", "link": "https://stackoverflow.com/users/1477667/dfeuer"}, "edited": false, "score": 0, "creation_date": 1442813152, "post_id": 32687677, "comment_id": 53219983, "body": "Correct. I meant that the package itself is a wrapper, providing the legacy names for new functions."}, {"owner": {"reputation": 30377, "user_id": 369198, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/71596bb1ca3ba3aa4400c3f407baec9f?s=128&d=identicon&r=PG", "display_name": "Michael Snoyman", "link": "https://stackoverflow.com/users/369198/michael-snoyman"}, "reply_to_user": {"reputation": 44013, "user_id": 1477667, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/trgKM.jpg?s=128&g=1", "display_name": "dfeuer", "link": "https://stackoverflow.com/users/1477667/dfeuer"}, "edited": false, "score": 1, "creation_date": 1442813285, "post_id": 32687677, "comment_id": 53220024, "body": "And looking at <a href=\"http://haddock.stackage.org/nightly-2015-09-20/blaze-builder-0.4.0.1/src/Blaze-ByteString-Builder-Char-Utf8.html#fromText\" rel=\"nofollow noreferrer\">the source for blaze-builder</a>, looks like an assumption on my part may have been wrong: it defines <code>fromText = fromString . unpack</code>"}, {"owner": {"reputation": 13626, "user_id": 492865, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/5c69a2080e68c8606961a18aba3a08ec?s=128&d=identicon&r=PG", "display_name": "Yuras", "link": "https://stackoverflow.com/users/492865/yuras"}, "edited": false, "score": 1, "creation_date": 1442832480, "post_id": 32687677, "comment_id": 53229633, "body": "I&#39;m not sure I understand the question correctly, but probably you want <a href=\"https://hackage.haskell.org/package/text-1.2.1.3/docs/Data-Text-Encoding.html#v:encodeUtf8Builder\" rel=\"nofollow noreferrer\">encodeUtf8Builder</a>?"}, {"owner": {"reputation": 11062, "user_id": 296827, "user_type": "registered", "accept_rate": 92, "profile_image": "https://i.stack.imgur.com/eMQgS.jpg?s=128&g=1", "display_name": "dsign", "link": "https://stackoverflow.com/users/296827/dsign"}, "edited": false, "score": 0, "creation_date": 1442832641, "post_id": 32687677, "comment_id": 53229747, "body": "What is wrong with Builder.byteString . Encoding.encodeUtf8  ?"}, {"owner": {"reputation": 30377, "user_id": 369198, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/71596bb1ca3ba3aa4400c3f407baec9f?s=128&d=identicon&r=PG", "display_name": "Michael Snoyman", "link": "https://stackoverflow.com/users/369198/michael-snoyman"}, "reply_to_user": {"reputation": 13626, "user_id": 492865, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/5c69a2080e68c8606961a18aba3a08ec?s=128&d=identicon&r=PG", "display_name": "Yuras", "link": "https://stackoverflow.com/users/492865/yuras"}, "edited": false, "score": 0, "creation_date": 1442833062, "post_id": 32687677, "comment_id": 53229994, "body": "@yuras that&#39;s the ticket. Could you add it as an answer so I can accept it?"}], "answers": [{"tags": [], "owner": {"reputation": 13626, "user_id": 492865, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/5c69a2080e68c8606961a18aba3a08ec?s=128&d=identicon&r=PG", "display_name": "Yuras", "link": "https://stackoverflow.com/users/492865/yuras"}, "is_accepted": true, "score": 4, "last_activity_date": 1442833327, "creation_date": 1442833327, "answer_id": 32693561, "question_id": 32687677, "link": "https://stackoverflow.com/questions/32687677/how-do-i-convert-a-text-to-a-bytestring-builder/32693561#32693561", "title": "How do I convert a Text to a bytestring Builder?", "body": "<p>You can use <a href=\"https://hackage.haskell.org/package/text-1.2.1.3/docs/Data-Text-Encoding.html#v:encodeUtf8Builder\" rel=\"nofollow\">encodeUtf8Builder</a> function and the corresponding function for <a href=\"https://hackage.haskell.org/package/text-1.2.1.3/docs/Data-Text-Lazy-Encoding.html#v:encodeUtf8Builder\" rel=\"nofollow\">lazy text</a>.</p>\n"}], "owner": {"reputation": 30377, "user_id": 369198, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/71596bb1ca3ba3aa4400c3f407baec9f?s=128&d=identicon&r=PG", "display_name": "Michael Snoyman", "link": "https://stackoverflow.com/users/369198/michael-snoyman"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 2601, "favorite_count": 0, "accepted_answer_id": 32693561, "answer_count": 1, "score": 5, "last_activity_date": 1442833327, "creation_date": 1442811559, "last_edit_date": 1442822452, "question_id": 32687677, "link": "https://stackoverflow.com/questions/32687677/how-do-i-convert-a-text-to-a-bytestring-builder", "title": "How do I convert a Text to a bytestring Builder?", "body": "<p>The <code>blaze-builder</code> package provides a <code>.Char.Utf8</code> module which includes <code>fromText</code> and <code>fromLazyText</code> for efficiently converting a value from the text package into a <code>blaze-builder</code> <code>Builder</code> value. With the new Builder API in <code>bytestring</code>, however, no such function exists (since <code>bytestring</code> does not depend on <code>text</code>). We could unpack the <code>Text</code> values and use <code>stringUtf8</code>, but that's almost certain to be much slower.</p>\n\n<p>Another option would be to use <code>blaze-builder</code>, which is now actually just a wrapper around <code>bytestring</code>'s <code>Builder</code> type, but I'm wondering if there's a more idiomatic way of approaching this.</p>\n"}, {"tags": ["haskell", "functional-programming", "equation", "solver", "lambda-calculus"], "comments": [{"owner": {"reputation": 44013, "user_id": 1477667, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/trgKM.jpg?s=128&g=1", "display_name": "dfeuer", "link": "https://stackoverflow.com/users/1477667/dfeuer"}, "edited": false, "score": 3, "creation_date": 1442808686, "post_id": 32687183, "comment_id": 53218771, "body": "What notion of equality are you using here?"}, {"owner": {"reputation": 44680, "user_id": 1031791, "user_type": "registered", "accept_rate": 54, "profile_image": "https://www.gravatar.com/avatar/fb710534fda446d2286074bb7692e65a?s=128&d=identicon&r=PG", "display_name": "MaiaVictor", "link": "https://stackoverflow.com/users/1031791/maiavictor"}, "reply_to_user": {"reputation": 44013, "user_id": 1477667, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/trgKM.jpg?s=128&g=1", "display_name": "dfeuer", "link": "https://stackoverflow.com/users/1477667/dfeuer"}, "edited": false, "score": 1, "creation_date": 1442809168, "post_id": 32687183, "comment_id": 53218900, "body": "<a href=\"http://ncatlab.org/nlab/show/equality\" rel=\"nofollow noreferrer\">Computational equality</a>*. Please read <code>a = b</code> as <code>a</code> beta reduces to <code>b</code>, in strong normal form."}, {"owner": {"reputation": 84731, "user_id": 510937, "user_type": "registered", "accept_rate": 80, "profile_image": "https://www.gravatar.com/avatar/70b13a9ae1aae1ca1aa6ac8dab4643f2?s=128&d=identicon&r=PG", "display_name": "Bakuriu", "link": "https://stackoverflow.com/users/510937/bakuriu"}, "edited": false, "score": 2, "creation_date": 1442827172, "post_id": 32687183, "comment_id": 53226487, "body": "While I find your question interesting I do not think this is a good fit for Stack Overflow. If you are asking about algorithms you should ask on [computer science.SE]. As it stands your question doesn&#39;t seem about programming but about algorithm design and it&#39;s too broad to be answered on SO (a definite answer to your question would be a book/sets of books)."}, {"owner": {"reputation": 44680, "user_id": 1031791, "user_type": "registered", "accept_rate": 54, "profile_image": "https://www.gravatar.com/avatar/fb710534fda446d2286074bb7692e65a?s=128&d=identicon&r=PG", "display_name": "MaiaVictor", "link": "https://stackoverflow.com/users/1031791/maiavictor"}, "edited": false, "score": 0, "creation_date": 1442845175, "post_id": 32687183, "comment_id": 53238260, "body": "I didn&#39;t know where to post, book suggestions are really welcome."}], "answers": [{"tags": [], "owner": {"reputation": 8625, "user_id": 2642162, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/f497a9526578cba7c81514047b3120fb?s=128&d=identicon&r=PG", "display_name": "gsg", "link": "https://stackoverflow.com/users/2642162/gsg"}, "is_accepted": false, "score": 9, "last_activity_date": 1442810662, "creation_date": 1442810662, "answer_id": 32687508, "question_id": 32687183, "link": "https://stackoverflow.com/questions/32687183/what-are-the-state-of-art-methods-for-solving-functional-equations/32687508#32687508", "title": "What are the state-of-art methods for solving functional equations?", "body": "<p>I'm not sure about state of the art, but William E Byrd's work on relational interpreters (such as <a href=\"http://webyrd.net/quines/quines.pdf\">this paper</a>) allows program synthesis of this kind.</p>\n\n<p>Also see his <a href=\"https://www.youtube.com/watch?v=eQL48qYDwp4\">PolyConf talk</a> for some neat stuff on searching for program terms. Your examples seem like they would be fairly easy to express in that way.</p>\n"}, {"tags": [], "owner": {"reputation": 220, "user_id": 2059388, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/Tlv20.jpg?s=128&g=1", "display_name": "cody", "link": "https://stackoverflow.com/users/2059388/cody"}, "is_accepted": true, "score": 3, "last_activity_date": 1442934300, "last_edit_date": 1495541197, "creation_date": 1442934300, "answer_id": 32720405, "question_id": 32687183, "link": "https://stackoverflow.com/questions/32687183/what-are-the-state-of-art-methods-for-solving-functional-equations/32720405#32720405", "title": "What are the state-of-art methods for solving functional equations?", "body": "<p>In general, <a href=\"https://en.wikipedia.org/wiki/Unification_%28computer_science%29#Higher-order_unification\" rel=\"nofollow noreferrer\">higher order unification</a> is undecidable, so you can't hope for a general procedure for finding solutions to these kinds of equations.</p>\n\n<p>There has been a significant amount of work on finding solutions to such problems, but I don't know of any that gives the answer to your particular problem. Some good references are summarized in this answer: <a href=\"https://stackoverflow.com/questions/1936432/higher-order-unification\">Higher-order unification</a></p>\n"}], "owner": {"reputation": 44680, "user_id": 1031791, "user_type": "registered", "accept_rate": 54, "profile_image": "https://www.gravatar.com/avatar/fb710534fda446d2286074bb7692e65a?s=128&d=identicon&r=PG", "display_name": "MaiaVictor", "link": "https://stackoverflow.com/users/1031791/maiavictor"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 3775, "favorite_count": 8, "accepted_answer_id": 32720405, "answer_count": 2, "score": 12, "last_activity_date": 1442934300, "creation_date": 1442808310, "question_id": 32687183, "link": "https://stackoverflow.com/questions/32687183/what-are-the-state-of-art-methods-for-solving-functional-equations", "title": "What are the state-of-art methods for solving functional equations?", "body": "<p>Suppose that you want to find a \u03bb-calculus program, <code>T</code>, that satisfies the following equations:</p>\n\n<pre><code>(T (\u03bb f x . x))            = (\u03bb a t . a)\n(T (\u03bb f x . (f x)))        = (\u03bb a t . (t a))\n(T (\u03bb f x . (f (f x))))    = (\u03bb a b t . (t a b))\n(T (\u03bb f x . (f (f (f x)))) = (\u03bb a b c t . (t a b c))\n</code></pre>\n\n<p>On this case, I've manually found this solution:</p>\n\n<pre><code>T = (\u03bb t . (t (\u03bb b c d . (b (\u03bb e . (c e d)))) (\u03bb b . b) (\u03bb b . b)))\n</code></pre>\n\n<p>Is there any strategy for solving such \u03bb-calculus equations automatically? What is the state of art on that subject?</p>\n"}, {"tags": ["haskell", "typeclass"], "comments": [{"owner": {"reputation": 44013, "user_id": 1477667, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/trgKM.jpg?s=128&g=1", "display_name": "dfeuer", "link": "https://stackoverflow.com/users/1477667/dfeuer"}, "edited": false, "score": 0, "creation_date": 1442807771, "post_id": 32687063, "comment_id": 53218569, "body": "What Haskell implementation are you using (including version number)? Does your code really say exactly <code>f :: ZeroPositive =&gt; [Int] -&gt; [ZeroPositive]</code>? I&#39;d expect that to give a kind error, and it does on my computer."}, {"owner": {"reputation": 63, "user_id": 5080989, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/WU5CR.jpg?s=128&g=1", "display_name": "B. Zen", "link": "https://stackoverflow.com/users/5080989/b-zen"}, "reply_to_user": {"reputation": 44013, "user_id": 1477667, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/trgKM.jpg?s=128&g=1", "display_name": "dfeuer", "link": "https://stackoverflow.com/users/1477667/dfeuer"}, "edited": false, "score": 0, "creation_date": 1442808082, "post_id": 32687063, "comment_id": 53218630, "body": "Glasgow Haskell Compiler, Version 7.6.3, stage 2 booted by GHC version 7.6.3"}, {"owner": {"reputation": 44013, "user_id": 1477667, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/trgKM.jpg?s=128&g=1", "display_name": "dfeuer", "link": "https://stackoverflow.com/users/1477667/dfeuer"}, "edited": false, "score": 0, "creation_date": 1442808514, "post_id": 32687063, "comment_id": 53218731, "body": "7.6.3 is essentially obsolete. 7.8.4 is still fairly widely used. The most recent release was 7.10.2; there may or may not be a 7.10.3 at some point to fix a few more bugs, and 8.0 is scheduled for February."}], "answers": [{"comments": [{"owner": {"reputation": 17809, "user_id": 1088108, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/63781cd38e91aa346a3849bc3ef3e550?s=128&d=identicon&r=PG&f=1", "display_name": "&#216;rjan Johansen", "link": "https://stackoverflow.com/users/1088108/%c3%98rjan-johansen"}, "reply_to_user": {"reputation": 63, "user_id": 5080989, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/WU5CR.jpg?s=128&g=1", "display_name": "B. Zen", "link": "https://stackoverflow.com/users/5080989/b-zen"}, "edited": false, "score": 1, "creation_date": 1442809067, "post_id": 32687134, "comment_id": 53218874, "body": "I was a bit confused because I found a webpage noting that 7.4 was the version that introduced the extension.  However I now remember reading that it was so broken that it was only at 7.6 that they got fixed enough that people could start <i>using</i> it. I haven&#39;t managed to find the actual GHC bug report for the <code>=&gt;</code> vs. <code>-&gt;</code> confusion (impossible to Google those)."}, {"owner": {"reputation": 63, "user_id": 5080989, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/WU5CR.jpg?s=128&g=1", "display_name": "B. Zen", "link": "https://stackoverflow.com/users/5080989/b-zen"}, "edited": false, "score": 0, "creation_date": 1442809606, "post_id": 32687134, "comment_id": 53218991, "body": "Interesting reason for the error message, thanks. I will try to find a better way to keep my ghc up to date."}, {"owner": {"reputation": 17809, "user_id": 1088108, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/63781cd38e91aa346a3849bc3ef3e550?s=128&d=identicon&r=PG&f=1", "display_name": "&#216;rjan Johansen", "link": "https://stackoverflow.com/users/1088108/%c3%98rjan-johansen"}, "reply_to_user": {"reputation": 63, "user_id": 5080989, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/WU5CR.jpg?s=128&g=1", "display_name": "B. Zen", "link": "https://stackoverflow.com/users/5080989/b-zen"}, "edited": false, "score": 1, "creation_date": 1442809697, "post_id": 32687134, "comment_id": 53219011, "body": "And I finally found the bug ticket."}], "tags": [], "owner": {"reputation": 17809, "user_id": 1088108, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/63781cd38e91aa346a3849bc3ef3e550?s=128&d=identicon&r=PG&f=1", "display_name": "&#216;rjan Johansen", "link": "https://stackoverflow.com/users/1088108/%c3%98rjan-johansen"}, "is_accepted": true, "score": 5, "last_activity_date": 1442809523, "last_edit_date": 1442809523, "creation_date": 1442807921, "answer_id": 32687134, "question_id": 32687063, "link": "https://stackoverflow.com/questions/32687063/why-does-adding-a-data-type-as-constraint-to-type-declaration-result-in-matching/32687134#32687134", "title": "Why does adding a data type as constraint to type declaration result in matching error instead of a more correct error?", "body": "<p>This <em>should</em> be an error because <code>ZeroPositive</code> is a data type, not a class, so is not allowed as a constraint.</p>\n\n<p>However the strange error message you are getting, is because you are using an old GHC version that had <a href=\"https://ghc.haskell.org/trac/ghc/ticket/8863\" rel=\"nofollow\">a bug</a> (<s>GHC 7.4 if I recall correctly</s>GHC 7.6, the one which got the <code>ConstraintKinds</code> extension generally working and therefore made <code>=&gt;</code> and <code>-&gt;</code> allowed in more of the same places in the syntax) that made it treat <code>=&gt;</code> as <code>-&gt;</code> if you put an actual data type instead of constraint to the left of it.</p>\n"}, {"comments": [{"owner": {"reputation": 63, "user_id": 5080989, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/WU5CR.jpg?s=128&g=1", "display_name": "B. Zen", "link": "https://stackoverflow.com/users/5080989/b-zen"}, "edited": false, "score": 0, "creation_date": 1442809241, "post_id": 32687173, "comment_id": 53218915, "body": "Thanks, I still mix some concepts sometimes. Is Haskell Platform recommended or there are other better options?"}, {"owner": {"reputation": 44013, "user_id": 1477667, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/trgKM.jpg?s=128&g=1", "display_name": "dfeuer", "link": "https://stackoverflow.com/users/1477667/dfeuer"}, "reply_to_user": {"reputation": 63, "user_id": 5080989, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/WU5CR.jpg?s=128&g=1", "display_name": "B. Zen", "link": "https://stackoverflow.com/users/5080989/b-zen"}, "edited": false, "score": 0, "creation_date": 1442810628, "post_id": 32687173, "comment_id": 53219249, "body": "@B.Zen, opinions vary widely, and the &quot;what&#39;s the best way to get Haskell&quot; question is a matter of active discussion and development. A lot of people seem to like <code>stack</code> for work that doesn&#39;t require bleeding-edge libraries. Others prefer to go with a traditional <code>cabal-install</code> approach with lots of sandboxes (an approach that is becoming much more manageable than it used to be). I can&#39;t make any particular recommendations."}], "tags": [], "owner": {"reputation": 44013, "user_id": 1477667, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/trgKM.jpg?s=128&g=1", "display_name": "dfeuer", "link": "https://stackoverflow.com/users/1477667/dfeuer"}, "is_accepted": false, "score": 4, "last_activity_date": 1442808227, "creation_date": 1442808227, "answer_id": 32687173, "question_id": 32687063, "link": "https://stackoverflow.com/questions/32687063/why-does-adding-a-data-type-as-constraint-to-type-declaration-result-in-matching/32687173#32687173", "title": "Why does adding a data type as constraint to type declaration result in matching error instead of a more correct error?", "body": "<p>I don't understand the error you're getting; \u00d8rjan Johansen's answer gives a plausible explanation. The real problem is this: any time a type signature indicates <code>a =&gt; b</code>, <code>a</code> is expected to be a <em>constraint</em>. In standard Haskell, that means that <code>a</code> looks like <code>C t</code>, where <code>C</code> is the name of a class and <code>t</code> is a type variable. In Glasgow Haskell, constraints can be a great deal richer. In any case, however, data and constraint are entirely different sorts of things (they have different types, in a general sense), so you simply can't use a datatype as a context.</p>\n"}], "owner": {"reputation": 63, "user_id": 5080989, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/WU5CR.jpg?s=128&g=1", "display_name": "B. Zen", "link": "https://stackoverflow.com/users/5080989/b-zen"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 59, "favorite_count": 0, "accepted_answer_id": 32687134, "answer_count": 2, "score": 4, "last_activity_date": 1442809523, "creation_date": 1442807297, "last_edit_date": 1442809090, "question_id": 32687063, "link": "https://stackoverflow.com/questions/32687063/why-does-adding-a-data-type-as-constraint-to-type-declaration-result-in-matching", "title": "Why does adding a data type as constraint to type declaration result in matching error instead of a more correct error?", "body": "<p>Or, putting in other terms, is there a case to add a constraint like described below?</p>\n\n<p><strong>Working code</strong>, with minimal type declaration for function <em>f</em>:    </p>\n\n<pre><code>data ZeroPositive = Zero | Positive Int deriving Show\nf :: [Int] -&gt; [ZeroPositive]\nf [] = []\nf (0:xs) = Zero:(f xs)\nf (x:xs) = (Positive x):(f xs)\nmain = putStrLn . show $ f [0,2]\n</code></pre>\n\n<p>result:</p>\n\n<pre><code>[Zero,Positive 2]\n</code></pre>\n\n<p><strong>Broken code</strong> with useless constraint <em>ZeroPositive</em>:</p>\n\n<pre><code>data ZeroPositive = Zero | Positive Int deriving Show\nf :: ZeroPositive =&gt; [Int] -&gt; [ZeroPositive]\nf [] = []\nf (0:xs) = Zero:(f xs)\nf (x:xs) = (Positive x):(f xs)\nmain = putStrLn . show $ f [0,2]\n</code></pre>\n\n<p>result:</p>\n\n<pre><code>  99.hs:3:7:\n  Couldn't match expected type `ZeroPositive' with actual type `[t0]'\n  In the pattern: []\n  In an equation for `f': f [] = []\n\n  99.hs:3:12:\n  Couldn't match expected type `[Int] -&gt; [ZeroPositive]'\n          with actual type `[a0]'\n  In the expression: []\n  In an equation for `f': f [] = []\n\n  ...\n\n  99.hs:6:32:\n  Couldn't match expected type `ZeroPositive' with actual type `[t0]'\n  In the first argument of `f', namely `[0, 2]'\n  In the second argument of `($)', namely `f [0, 2]'\n  In the expression: putStrLn . show $ f [0, 2]\n</code></pre>\n"}, {"tags": ["algorithm", "haskell", "optimization", "combinatorics", "finite-group-theory"], "comments": [{"owner": {"reputation": 126897, "user_id": 791604, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/ce991df7a056248d5e4f6fc3659ba733?s=128&d=identicon&r=PG", "display_name": "Daniel Wagner", "link": "https://stackoverflow.com/users/791604/daniel-wagner"}, "edited": false, "score": 1, "creation_date": 1442801059, "post_id": 32686225, "comment_id": 53217151, "body": "I think with one generator, you get the <a href=\"https://en.wikipedia.org/wiki/Knapsack_problem\" rel=\"nofollow noreferrer\">knapsack problem</a>, which is known to be NP-complete. So I don&#39;t think you&#39;re going to find an efficient algorithm for this, sorry."}, {"owner": {"reputation": 51837, "user_id": 2144669, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/5e7393f439028063515255b63ed94cfd?s=128&d=identicon&r=PG", "display_name": "David Eisenstat", "link": "https://stackoverflow.com/users/2144669/david-eisenstat"}, "edited": false, "score": 1, "creation_date": 1442801065, "post_id": 32686225, "comment_id": 53217152, "body": "This is really a lattice problem."}, {"owner": {"reputation": 13699, "user_id": 11173, "user_type": "registered", "accept_rate": 77, "profile_image": "https://www.gravatar.com/avatar/6b5276e65cb7a7417188c9a035953cee?s=128&d=identicon&r=PG", "display_name": "Doug McClean", "link": "https://stackoverflow.com/users/11173/doug-mcclean"}, "reply_to_user": {"reputation": 126897, "user_id": 791604, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/ce991df7a056248d5e4f6fc3659ba733?s=128&d=identicon&r=PG", "display_name": "Daniel Wagner", "link": "https://stackoverflow.com/users/791604/daniel-wagner"}, "edited": false, "score": 0, "creation_date": 1442801327, "post_id": 32686225, "comment_id": 53217201, "body": "I&#39;m not sure about that, @DanielWagner. With the knapsack problem you don&#39;t have &quot;negative things&quot; like the group inverse provides. I think I am correct that this one can be expressed as a shortest path problem and you can use Dijkstra&#39;s algorithm."}, {"owner": {"reputation": 126897, "user_id": 791604, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/ce991df7a056248d5e4f6fc3659ba733?s=128&d=identicon&r=PG", "display_name": "Daniel Wagner", "link": "https://stackoverflow.com/users/791604/daniel-wagner"}, "edited": false, "score": 0, "creation_date": 1442801479, "post_id": 32686225, "comment_id": 53217228, "body": "@DougMcClean That&#39;s certainly true!"}, {"owner": {"reputation": 13699, "user_id": 11173, "user_type": "registered", "accept_rate": 77, "profile_image": "https://www.gravatar.com/avatar/6b5276e65cb7a7417188c9a035953cee?s=128&d=identicon&r=PG", "display_name": "Doug McClean", "link": "https://stackoverflow.com/users/11173/doug-mcclean"}, "edited": false, "score": 0, "creation_date": 1442801687, "post_id": 32686225, "comment_id": 53217281, "body": "Oh, wait, then again there might be exponentially many vertices in the graph. I think there are, unless there is a clever way to choose a smaller finite subgraph of the infinite graph to look at, or a way to lazily expand it that looks at a sub-exponential part of it."}, {"owner": {"reputation": 49959, "user_id": 866915, "user_type": "registered", "accept_rate": 70, "profile_image": "https://www.gravatar.com/avatar/09242131d6e17cbbe31e8547514da6e5?s=128&d=identicon&r=PG", "display_name": "ErikR", "link": "https://stackoverflow.com/users/866915/erikr"}, "edited": false, "score": 1, "creation_date": 1442801693, "post_id": 32686225, "comment_id": 53217282, "body": "Sounds related to the <a href=\"https://en.wikipedia.org/wiki/Lattice_problem#Closest_vector_problem_.28CVP.29\" rel=\"nofollow noreferrer\">closest vector problem</a> with an L^1 norm. I would ask the math stack exchange forum."}, {"owner": {"reputation": 12194, "user_id": 4474419, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/04ce27f0ebe4713b51911cd8475c3b42?s=128&d=identicon&r=PG", "display_name": "Davislor", "link": "https://stackoverflow.com/users/4474419/davislor"}, "edited": false, "score": 2, "creation_date": 1442802678, "post_id": 32686225, "comment_id": 53217488, "body": "@Doug McClean Aren&#39;t the costs of inverse-elements also strictly positive?  One optimization by the structure of the problem is obvious, though: since the group is Abelian, you can prune the inverses of any element already in a proposed solution, as it can never be optimal to cancel an earlier step out at a strictly-positive cost.  You can likewise prune the inverses of the products of the powerset of your search path."}, {"owner": {"reputation": 4938, "user_id": 1465011, "user_type": "registered", "accept_rate": 98, "profile_image": "https://www.gravatar.com/avatar/5c11daff0c870a2b41ae9b907a136adf?s=128&d=identicon&r=PG", "display_name": "recursion.ninja", "link": "https://stackoverflow.com/users/1465011/recursion-ninja"}, "edited": false, "score": 0, "creation_date": 1442803192, "post_id": 32686225, "comment_id": 53217592, "body": "<b><i>Clearly</i></b> this question should be migrated to <a href=\"http://cs.stackexchange.com\">CS.SE</a> or <a href=\"http://math.stackexchange.com\">Math.SE</a>..."}, {"owner": {"reputation": 12194, "user_id": 4474419, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/04ce27f0ebe4713b51911cd8475c3b42?s=128&d=identicon&r=PG", "display_name": "Davislor", "link": "https://stackoverflow.com/users/4474419/davislor"}, "edited": false, "score": 0, "creation_date": 1442804086, "post_id": 32686225, "comment_id": 53217769, "body": "Or more generally: if <i>a</i> is in a proposed solution, all elements generated by -<i>a</i> in their minimal decompositions can be pruned from the search, as <i>a</i> + (- <i>a</i> + <i>b</i>) = <i>b</i>, but at a strictly-higher cost."}, {"owner": {"reputation": 13635, "user_id": 1061413, "user_type": "registered", "accept_rate": 62, "profile_image": "https://www.gravatar.com/avatar/0beb915463288cb6e8b50e8121860717?s=128&d=identicon&r=PG", "display_name": "Amit Kumar Gupta", "link": "https://stackoverflow.com/users/1061413/amit-kumar-gupta"}, "edited": false, "score": 0, "creation_date": 1442815565, "post_id": 32686225, "comment_id": 53220784, "body": "I assume the cost of the inverse of some element p of P is the same as the cost of p, and the only valid expressions allowed (to which we can associate a total cost) are products of positive powers of elements of P and their inverses."}, {"owner": {"reputation": 13699, "user_id": 11173, "user_type": "registered", "accept_rate": 77, "profile_image": "https://www.gravatar.com/avatar/6b5276e65cb7a7417188c9a035953cee?s=128&d=identicon&r=PG", "display_name": "Doug McClean", "link": "https://stackoverflow.com/users/11173/doug-mcclean"}, "reply_to_user": {"reputation": 13635, "user_id": 1061413, "user_type": "registered", "accept_rate": 62, "profile_image": "https://www.gravatar.com/avatar/0beb915463288cb6e8b50e8121860717?s=128&d=identicon&r=PG", "display_name": "Amit Kumar Gupta", "link": "https://stackoverflow.com/users/1061413/amit-kumar-gupta"}, "edited": false, "score": 0, "creation_date": 1442848455, "post_id": 32686225, "comment_id": 53240562, "body": "Yes @AmitKumarGupta, that&#39;s correct on both counts."}], "answers": [{"comments": [{"owner": {"reputation": 13699, "user_id": 11173, "user_type": "registered", "accept_rate": 77, "profile_image": "https://www.gravatar.com/avatar/6b5276e65cb7a7417188c9a035953cee?s=128&d=identicon&r=PG", "display_name": "Doug McClean", "link": "https://stackoverflow.com/users/11173/doug-mcclean"}, "edited": false, "score": 0, "creation_date": 1442925480, "post_id": 32687493, "comment_id": 53276444, "body": "I think this is very much on the right track, but some things have come up and so I don&#39;t have time to try it for a couple of days. Just a note to say I appreciate the effort and will have more to say once I can really dig in to it. :)"}, {"owner": {"reputation": 13699, "user_id": 11173, "user_type": "registered", "accept_rate": 77, "profile_image": "https://www.gravatar.com/avatar/6b5276e65cb7a7417188c9a035953cee?s=128&d=identicon&r=PG", "display_name": "Doug McClean", "link": "https://stackoverflow.com/users/11173/doug-mcclean"}, "edited": false, "score": 0, "creation_date": 1442943315, "post_id": 32687493, "comment_id": 53289114, "body": "On the afterthoughts part, why isn&#39;t the nullary product a good representation of the identity element? It is a free abelian group, so there are no complex roots of unity, and we can have the guards you are talking about to prune the <code>gs</code> that we recurse with."}, {"owner": {"reputation": 12194, "user_id": 4474419, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/04ce27f0ebe4713b51911cd8475c3b42?s=128&d=identicon&r=PG", "display_name": "Davislor", "link": "https://stackoverflow.com/users/4474419/davislor"}, "reply_to_user": {"reputation": 13699, "user_id": 11173, "user_type": "registered", "accept_rate": 77, "profile_image": "https://www.gravatar.com/avatar/6b5276e65cb7a7417188c9a035953cee?s=128&d=identicon&r=PG", "display_name": "Doug McClean", "link": "https://stackoverflow.com/users/11173/doug-mcclean"}, "edited": false, "score": 0, "creation_date": 1442945195, "post_id": 32687493, "comment_id": 53290179, "body": "Good point about the nullary product.  Will add.  Complex roots of unity was just the first example that came to mind where we care about the generators of the identity."}, {"owner": {"reputation": 13699, "user_id": 11173, "user_type": "registered", "accept_rate": 77, "profile_image": "https://www.gravatar.com/avatar/6b5276e65cb7a7417188c9a035953cee?s=128&d=identicon&r=PG", "display_name": "Doug McClean", "link": "https://stackoverflow.com/users/11173/doug-mcclean"}, "edited": false, "score": 0, "creation_date": 1442957338, "post_id": 32687493, "comment_id": 53296853, "body": "One note on this. We can compute from the given information in the problem what the cutoff to use is, because we know that any element <code>e</code> can be factored into the generators and we know that all of the generators are in <code>P</code>. This gives an upper bound on what we should be willing to pay for <code>e</code>."}, {"owner": {"reputation": 12194, "user_id": 4474419, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/04ce27f0ebe4713b51911cd8475c3b42?s=128&d=identicon&r=PG", "display_name": "Davislor", "link": "https://stackoverflow.com/users/4474419/davislor"}, "reply_to_user": {"reputation": 13699, "user_id": 11173, "user_type": "registered", "accept_rate": 77, "profile_image": "https://www.gravatar.com/avatar/6b5276e65cb7a7417188c9a035953cee?s=128&d=identicon&r=PG", "display_name": "Doug McClean", "link": "https://stackoverflow.com/users/11173/doug-mcclean"}, "edited": false, "score": 1, "creation_date": 1442971037, "post_id": 32687493, "comment_id": 53301019, "body": "I don&#39;t think it does, unless we also have an upper bound on multiplicity (or what&#39;s the upper bound for <b>Z</b>?), but I&#39;m about to leave for Yom Kippur."}, {"owner": {"reputation": 13699, "user_id": 11173, "user_type": "registered", "accept_rate": 77, "profile_image": "https://www.gravatar.com/avatar/6b5276e65cb7a7417188c9a035953cee?s=128&d=identicon&r=PG", "display_name": "Doug McClean", "link": "https://stackoverflow.com/users/11173/doug-mcclean"}, "edited": false, "score": 0, "creation_date": 1442973179, "post_id": 32687493, "comment_id": 53301479, "body": "Yeah, good point, that was wrong. I was implicitly using another rule that the group generators are more expensive than the compound terms, which happens to hold for the instance of this problem that I am actually trying to solve. Probably more useful to solve without considering that rule in case it changes."}, {"owner": {"reputation": 13699, "user_id": 11173, "user_type": "registered", "accept_rate": 77, "profile_image": "https://www.gravatar.com/avatar/6b5276e65cb7a7417188c9a035953cee?s=128&d=identicon&r=PG", "display_name": "Doug McClean", "link": "https://stackoverflow.com/users/11173/doug-mcclean"}, "edited": false, "score": 1, "creation_date": 1443495013, "post_id": 32687493, "comment_id": 53505376, "body": "This does indeed work. I am going to use it as a baseline and see if I can make a faster branch-and-bound one using any extra info I can find about my specific problem. Thanks much!"}], "tags": [], "owner": {"reputation": 12194, "user_id": 4474419, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/04ce27f0ebe4713b51911cd8475c3b42?s=128&d=identicon&r=PG", "display_name": "Davislor", "link": "https://stackoverflow.com/users/4474419/davislor"}, "is_accepted": true, "score": 1, "last_activity_date": 1442945560, "last_edit_date": 1442945560, "creation_date": 1442810563, "answer_id": 32687493, "question_id": 32686225, "link": "https://stackoverflow.com/questions/32686225/minimum-cost-factoring-in-abelian-groups/32687493#32687493", "title": "Minimum cost factoring in abelian groups", "body": "<h3>Warning: Untested Pseudocode</h3>\n\n<pre><code>This is pseudocode.  It isn't finished and probably won't even compile.\n\nminCost :: element -&gt; [generator] -&gt; number -&gt; Maybe [generator]\nminCost _ [] _ = Nothing\nminCost x _ c | (elemCost x) + c &gt; cutoff = Nothing\nminCost e _ _ = Just [] -- The factorization of the identity is the nullary product.\nminCost x gs _ | elem x gs = Just [x]\nminCost x gs _ | elem x ps = Nothing -- in P but not in gs.\nminCost x gs c  =\n  argmin\n    pathCost\n    [maybeCons g (minCost (x-g) [h| h &lt;- gs, h &lt;= g, h /= -g] (c+(elemCost g))) | g&lt;-gs]\n\nmaybeCons :: a -&gt; Maybe [a] -&gt; Maybe [a]\nmaybeCons _ Nothing = Nothing\nmaybeCons x (Just xs) = Just (x:xs)\n\nelemCost :: element -&gt; number\npathCost :: [element] -&gt; number\npathCost = sum . map elemCost\n\nargmin :: (a -&gt; n) -&gt; [Maybe a] -&gt; Maybe a\n-- Return the item with the lowest cost, or Nothing if there isn't one.\n</code></pre>\n\n<p>There's a little bit of handwaving here, but the logic should, I hope, be clear.  We have to impose an arbitrary total ordering on <em>P</em> and <code>argmin</code> has to handle results of <code>Nothing</code>, representing that there's no way to generate <em>x</em> from that subset of <em>P</em>. My pseudocode doesn't have quite the right syntax to do this, for readability.</p>\n\n<p>Excluding <em>h</em> > <em>g</em> from the allowed generators is safe, because any solution containing <em>h</em> would be found by the <code>minCost (x-h)</code> branch, up to permutation (and <em>G</em> is Abelian, so any solutions that are permutations are equivalent).  Excluding -<em>g</em> is safe because <em>g</em> + (-<em>g</em> + <em>a</em>) = <em>a</em>, but at strictly higher cost, so no such solution could be optimal.</p>\n\n<p>The algorithm needs a way to prune branches such as, when <em>P</em> = {1,-1,i,-i}, testing (2+i) {1,-1,-i}, (2+2i) {1,-1,-i}, ad infinitum. This probably requires pruning the search when the cost exceeds a cutoff.  With that fix, it terminates because each recursion reduces the size of <code>gs</code> or the number of steps until <em>x</em> reduces to a generator, until it reaches one of the base cases or the cost accumulates above the threshold.  (This might be improved by passing up the lowest cost calculated on any parallel branch so far.)  It cannot repeat a computation because we have excluded the inverses of all previous steps in the path.</p>\n\n<h3>Afterthoughts</h3>\n\n<p>Saying that <em>e</em> generates itself even if not in <em>P</em> is incorrect by requirements and unnecessary for correctness: the algorithm never adds an element to its own inverse, so this can only occur if we ask explicitly how to generate the identity.  And that's a valid query: complex roots of unity?</p>\n\n<p>On further reflection, thanks for the suggestion to represent the identity as the nullary product.  Otherwise, we'd fail because we never check generators against their inverses!  It has the right type, too!</p>\n\n<p>There's a case to make the return type <code>[[generator]]</code> instead of <code>Maybe [generator]</code> and return all optimal productions, representing <code>Nothing</code> as <code>[]</code>.  The definition of <code>maybeCons</code> would become just <code>map ((:)g)</code>.  However, this risks exponential blow-up if there are a lot of equally-cheap paths.</p>\n\n<p>Returning the cost along with the factorization, in a tuple, would both let us prune any later parallel branch with a higher cost sooner.  Or we could use <code>pathCost</code> for this.</p>\n\n<p>The particular lattice structure of your group might suggest more ways to prune, although I'm not thinking of any others <strong>in general</strong>.  For instance, for the complex integers under addition, we can easily detect what the two (at most) generators must be just from the real and imaginary coefficients.  In many groups, we can easily detect that something is not a product of a particular generator by which subset of <em>G</em> it is in.  These could be additional guards that tail-recurse with a proper subset of <code>gs</code>.</p>\n\n<p>The <code>generator</code> type has to be the same as <code>element</code> or an instance of it, because of the cost function.  The ordering relation might be defined only for generators, or their structure might be simpler.  It might have a different name if the group has a natural ordering that happens to be less efficient for the algorithm.</p>\n\n<p>I'll leave in the note that the code isn't supposed to compile because I'm pretty sure I wrote at least one bug.</p>\n"}], "owner": {"reputation": 13699, "user_id": 11173, "user_type": "registered", "accept_rate": 77, "profile_image": "https://www.gravatar.com/avatar/6b5276e65cb7a7417188c9a035953cee?s=128&d=identicon&r=PG", "display_name": "Doug McClean", "link": "https://stackoverflow.com/users/11173/doug-mcclean"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 142, "favorite_count": 1, "accepted_answer_id": 32687493, "answer_count": 1, "score": 10, "last_activity_date": 1442945560, "creation_date": 1442800127, "last_edit_date": 1442943450, "question_id": 32686225, "link": "https://stackoverflow.com/questions/32686225/minimum-cost-factoring-in-abelian-groups", "title": "Minimum cost factoring in abelian groups", "body": "<p>I have a certain optimization problem, and I'm wondering if there is a clever approach for solving it. (This may well have been extensively studied and I just don't know what name to look it up under.)</p>\n\n<p>I have a (EDIT: free) finitely generated Abelian group, <code>G</code>, on <code>n</code> generators. I also have a set <code>P</code> of elements of <code>G</code>, each labeled with a strictly-positive cost. All of the generators of <code>G</code> appear in <code>P</code>, so it is always possible to express any element of <code>G</code> as a product of elements of <code>P</code> or their inverses. The cost of any such product is the sum of the costs of the elements of <code>P</code> that appear in it, taking into account how often they appear. The cost of the nullary product, which expresses the identity element of <code>G</code>, is zero.</p>\n\n<p>Given an element of the group I'd like a way to find a minimum-cost product that expresses it in terms of elements of <code>P</code>.</p>\n\n<p>It's straightforward to translate this into a shortest-path problem without negative dicycles (on an infinite graph, but for any given element you only need a finite part of it near the identity element). It's also straightforward to translate it into an integer linear programming problem.</p>\n\n<p>It may be that one of those translations is the way to go? Or does the additional structure of this problem lead to an easier way to do it? In my actual problems <code>5 &lt;= n &lt;= 10</code> and the elements I'm interested in never have multiplicities of any of the generators bigger than roughly +/- 20.</p>\n\n<p>I'm working in Haskell, so functional approaches would be preferred to stateful ones, but stateful approaches are OK too.</p>\n"}, {"tags": ["string", "list", "function", "haskell", "tuples"], "comments": [{"owner": {"reputation": 12194, "user_id": 4474419, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/04ce27f0ebe4713b51911cd8475c3b42?s=128&d=identicon&r=PG", "display_name": "Davislor", "link": "https://stackoverflow.com/users/4474419/davislor"}, "edited": false, "score": 3, "creation_date": 1442800293, "post_id": 32686157, "comment_id": 53216999, "body": "You have some ideas how to proceed; do they work?  Please post what you have before asking for help on your homework.  But: what kind of list do you need to have before you can output <code>a 1,2</code>?  How would you build that list from that input?"}], "answers": [{"tags": [], "owner": {"reputation": 49959, "user_id": 866915, "user_type": "registered", "accept_rate": 70, "profile_image": "https://www.gravatar.com/avatar/09242131d6e17cbbe31e8547514da6e5?s=128&d=identicon&r=PG", "display_name": "ErikR", "link": "https://stackoverflow.com/users/866915/erikr"}, "is_accepted": false, "score": 2, "last_activity_date": 1442800394, "creation_date": 1442800394, "answer_id": 32686267, "question_id": 32686157, "link": "https://stackoverflow.com/questions/32686157/haskell-output-list-of-tuples-as-string-output/32686267#32686267", "title": "Haskell: Output list of tuples as string output", "body": "<p>If you have this list:</p>\n\n<pre><code>pairs = [ (\"a\", [1,2]), (\"b\", [1]), (\"c\", [1]), (\"dd\", [2]) ]\n</code></pre>\n\n<p>then you can get the desired output with:</p>\n\n<pre><code>putStrLn $ unlines [ x ++ \" \" ++ unwords (map show ys) | (x, ys) &lt;- pairs ]\n</code></pre>\n\n<p>but you have to figure out how to get the <code>pairs</code> list first.</p>\n"}, {"comments": [{"owner": {"reputation": 1895, "user_id": 3621754, "user_type": "registered", "accept_rate": 63, "profile_image": "https://www.gravatar.com/avatar/2dc5c4eed3ed0e149b0bd6783a07fe0b?s=128&d=identicon&r=PG&f=1", "display_name": "sanic", "link": "https://stackoverflow.com/users/3621754/sanic"}, "edited": false, "score": 0, "creation_date": 1442801319, "post_id": 32686272, "comment_id": 53217199, "body": "Thank you for the guidance here! So based off your 1st hint, the aggregate function (w/o someFunc) makes the first element in the tuple into a list. I assume I need to use find &quot;someFunc&quot; that will combine the list of integers in the 1st tuple spot if the 2nd tuple spot is the same. Is foldr apart of this process?"}, {"owner": {"reputation": 51584, "user_id": 839246, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/9b0573c2b936b12828dd1e4cc04206dc?s=128&d=identicon&r=PG&f=1", "display_name": "bheklilr", "link": "https://stackoverflow.com/users/839246/bheklilr"}, "reply_to_user": {"reputation": 1895, "user_id": 3621754, "user_type": "registered", "accept_rate": 63, "profile_image": "https://www.gravatar.com/avatar/2dc5c4eed3ed0e149b0bd6783a07fe0b?s=128&d=identicon&r=PG&f=1", "display_name": "sanic", "link": "https://stackoverflow.com/users/3621754/sanic"}, "edited": false, "score": 0, "creation_date": 1442801429, "post_id": 32686272, "comment_id": 53217216, "body": "@shamu11 Correct, <code>someFunc</code> is what you&#39;ll need to implement.  The rest of that definitely is simply taking every <code>(n, str)</code> and turning it into <code>([n], str)</code>.  Folds are the Haskell way of doing loops that aggregate a value, and <code>foldr</code> is a good place to start."}, {"owner": {"reputation": 44013, "user_id": 1477667, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/trgKM.jpg?s=128&g=1", "display_name": "dfeuer", "link": "https://stackoverflow.com/users/1477667/dfeuer"}, "reply_to_user": {"reputation": 1895, "user_id": 3621754, "user_type": "registered", "accept_rate": 63, "profile_image": "https://www.gravatar.com/avatar/2dc5c4eed3ed0e149b0bd6783a07fe0b?s=128&d=identicon&r=PG&f=1", "display_name": "sanic", "link": "https://stackoverflow.com/users/3621754/sanic"}, "edited": false, "score": 0, "creation_date": 1442801523, "post_id": 32686272, "comment_id": 53217241, "body": "@shamu, there is a convenience function, <code>intercalate</code>, that you may find helpful dealing with part of this answer."}, {"owner": {"reputation": 1895, "user_id": 3621754, "user_type": "registered", "accept_rate": 63, "profile_image": "https://www.gravatar.com/avatar/2dc5c4eed3ed0e149b0bd6783a07fe0b?s=128&d=identicon&r=PG&f=1", "display_name": "sanic", "link": "https://stackoverflow.com/users/3621754/sanic"}, "edited": false, "score": 0, "creation_date": 1442801982, "post_id": 32686272, "comment_id": 53217343, "body": "Okay so I see how both intercalate and foldr could be very useful here. I think I&#39;m close when I do this:   let aggregate items = foldr (intercalate) $ (map (&#40;num, str) -&gt; ([num], str)) items)  however I&#39;m still getting a type error."}], "tags": [], "owner": {"reputation": 51584, "user_id": 839246, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/9b0573c2b936b12828dd1e4cc04206dc?s=128&d=identicon&r=PG&f=1", "display_name": "bheklilr", "link": "https://stackoverflow.com/users/839246/bheklilr"}, "is_accepted": true, "score": 2, "last_activity_date": 1442800408, "creation_date": 1442800408, "answer_id": 32686272, "question_id": 32686157, "link": "https://stackoverflow.com/questions/32686157/haskell-output-list-of-tuples-as-string-output/32686272#32686272", "title": "Haskell: Output list of tuples as string output", "body": "<p>Break the problem down into steps.  What you really want to do first is aggregate all the tuples that have the same string in the second position, so you'll have a function like</p>\n\n<pre><code>aggregate :: [(Int, String)] -&gt; [([Int], String)]\n</code></pre>\n\n<p>So for your input list you would get the output</p>\n\n<pre><code>[([1, 2], \"a\"), ([1], \"b\"), ([1], \"c\"), ([2], \"dd\")]\n</code></pre>\n\n<p>Your hints are</p>\n\n<pre><code>aggregate items = someFunc (map (\\(num, str) -&gt; ([num], str)) items)\n</code></pre>\n\n<p>And take a look at <code>foldr</code>.  Before you ask a follow up question about <code>foldr</code>, there are probably hundreds of stackoverflow answers showing how to use it already, take some time to figure it out or it'll get closed immediately as a duplicate.</p>\n\n<p>Then you need a function to convert a single tuple of this form into a single <code>String</code> for outputting:</p>\n\n<pre><code>prettyPrint :: ([Int], String) -&gt; String\nprettyPrint (nums, str) = str ++ \" \" ++ joinWithComma (map show nums)\n</code></pre>\n\n<p>Where you'll have to implement <code>joinWithComma</code> yourself.  Then you need to calculate this and print it for each item in your aggregated list, <code>mapM_</code> and <code>putStrLn</code> would be preferred, so your <code>main</code> might look like</p>\n\n<pre><code>main :: IO ()\nmain = do\n    let inputList = [(2,\"a\"), (1,\"a\"), (1,\"b\"), (1,\"c\"), (2,\"dd\")]\n    mapM_ (putStrLn . prettyPrint) (aggregate inputList)\n</code></pre>\n"}, {"tags": [], "owner": {"reputation": 52258, "user_id": 375232, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/h3OwD.png?s=128&g=1", "display_name": "Landei", "link": "https://stackoverflow.com/users/375232/landei"}, "is_accepted": false, "score": 0, "last_activity_date": 1442844519, "creation_date": 1442844519, "answer_id": 32697370, "question_id": 32686157, "link": "https://stackoverflow.com/questions/32686157/haskell-output-list-of-tuples-as-string-output/32697370#32697370", "title": "Haskell: Output list of tuples as string output", "body": "<p>Work step by step. You could start with the <code>groupBy</code> function:</p>\n\n<pre><code>groupBy (\\x y-&gt; (snd x)==(snd y)) [(2,\"a\"), (1,\"a\"), (1,\"b\"), (1,\"c\"), (2,\"dd\")]\n</code></pre>\n\n<p>gives you</p>\n\n<pre><code>[[(2,\"a\"),(1,\"a\")],[(1,\"b\")],[(1,\"c\")],[(2,\"dd\")]]\n</code></pre>\n\n<p>The next step would be \"totalling\" the inner lists, <code>map</code> and <code>foldL</code> (and depending on your requirements maybe <code>sortBy</code>) should be helpful. If you have this, constructing the output is trivial (using <code>show</code>, as you already mentioned).</p>\n"}], "owner": {"reputation": 1895, "user_id": 3621754, "user_type": "registered", "accept_rate": 63, "profile_image": "https://www.gravatar.com/avatar/2dc5c4eed3ed0e149b0bd6783a07fe0b?s=128&d=identicon&r=PG&f=1", "display_name": "sanic", "link": "https://stackoverflow.com/users/3621754/sanic"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 2137, "favorite_count": 0, "accepted_answer_id": 32686272, "answer_count": 3, "score": 0, "last_activity_date": 1443551205, "creation_date": 1442799373, "last_edit_date": 1443551205, "question_id": 32686157, "link": "https://stackoverflow.com/questions/32686157/haskell-output-list-of-tuples-as-string-output", "title": "Haskell: Output list of tuples as string output", "body": "<p>I'm trying to get this list of tuples:</p>\n\n<pre><code>[(2,\"a\"), (1,\"a\"), (1,\"b\"), (1,\"c\"), (2,\"dd\")]\n</code></pre>\n\n<p>into this string output</p>\n\n<pre><code>a 1,2\n\nb 1\n\nc 1\n\ndd 2\n</code></pre>\n\n<p>I assume I need to use the unzip and unlines functions. But I also saw some solutions using the show function which makes the integers strings. Any ideas?</p>\n"}, {"tags": ["list", "haskell", "tuples"], "comments": [{"owner": {"reputation": 61419, "user_id": 849891, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/MbEO3.png?s=128&g=1", "display_name": "Will Ness", "link": "https://stackoverflow.com/users/849891/will-ness"}, "edited": false, "score": 0, "creation_date": 1453808054, "post_id": 32686043, "comment_id": 57752578, "body": "remove duplicates from <i>sorted</i> lists in <i>O(n)</i> time with <code>map head . group</code>."}, {"owner": {"reputation": 61419, "user_id": 849891, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/MbEO3.png?s=128&g=1", "display_name": "Will Ness", "link": "https://stackoverflow.com/users/849891/will-ness"}, "edited": false, "score": 0, "creation_date": 1453811478, "post_id": 32686043, "comment_id": 57754387, "body": "if you allow for <code>...(1,&quot;b&quot;),(2,&quot;b&quot;),(1,&quot;b&quot;),...</code> then we&#39;d have to use <code>map (head . nub) . groupBy ((==) `on` snd)</code>. Presumably the longest group will still be short so <code>nub</code> won&#39;t be such a problem. If not, there&#39;s always <code>Set</code> or <code>HashMap</code>. Still, breaking it up into groups first, in <i>O(n)</i>, can&#39;t hurt. -- Another possibility is to re-sort lexicographically (with a <a href=\"http://hackage.haskell.org/package/base-4.8.2.0/docs/Data-List.html#v:sort\" rel=\"nofollow noreferrer\">stable sort</a>) by <code>snd</code> major and <code>fst</code> minor, which should be near-linear; and then put it through the <code>map head . group</code>."}], "answers": [{"comments": [{"owner": {"reputation": 44013, "user_id": 1477667, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/trgKM.jpg?s=128&g=1", "display_name": "dfeuer", "link": "https://stackoverflow.com/users/1477667/dfeuer"}, "reply_to_user": {"reputation": 1895, "user_id": 3621754, "user_type": "registered", "accept_rate": 63, "profile_image": "https://www.gravatar.com/avatar/2dc5c4eed3ed0e149b0bd6783a07fe0b?s=128&d=identicon&r=PG&f=1", "display_name": "sanic", "link": "https://stackoverflow.com/users/3621754/sanic"}, "edited": false, "score": 0, "creation_date": 1442800200, "post_id": 32686104, "comment_id": 53216978, "body": "@shamu11, <code>nub</code> is very slow for lists that are not short. If the elements can be ordered, you can do much better."}, {"owner": {"reputation": 57219, "user_id": 33796, "user_type": "registered", "accept_rate": 70, "profile_image": "https://www.gravatar.com/avatar/08727b23ba62e634b32988cdff082663?s=128&d=identicon&r=PG", "display_name": "luqui", "link": "https://stackoverflow.com/users/33796/luqui"}, "edited": false, "score": 2, "creation_date": 1442800910, "post_id": 32686104, "comment_id": 53217110, "body": "Ah <code>reverse . foldl</code>!  This is definitely a <code>foldr</code> problem, nice and streamy."}, {"owner": {"reputation": 44013, "user_id": 1477667, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/trgKM.jpg?s=128&g=1", "display_name": "dfeuer", "link": "https://stackoverflow.com/users/1477667/dfeuer"}, "edited": false, "score": 0, "creation_date": 1442801292, "post_id": 32686104, "comment_id": 53217197, "body": "@behzad.nouri, this is a case where <code>foldr</code> will be quite a lot more efficient than <code>foldl</code>, and may even complete successfully in cases that would run <code>foldl</code> out of memory."}, {"owner": {"reputation": 61029, "user_id": 625914, "user_type": "registered", "accept_rate": 70, "profile_image": "https://www.gravatar.com/avatar/f1932d8bf4e9dbf779a48b41bbf21592?s=128&d=identicon&r=PG", "display_name": "behzad.nouri", "link": "https://stackoverflow.com/users/625914/behzad-nouri"}, "reply_to_user": {"reputation": 44013, "user_id": 1477667, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/trgKM.jpg?s=128&g=1", "display_name": "dfeuer", "link": "https://stackoverflow.com/users/1477667/dfeuer"}, "edited": false, "score": 0, "creation_date": 1442802471, "post_id": 32686104, "comment_id": 53217434, "body": "@dfeuer please do some <i>benchmarks</i> and show that the foldr version will be &quot;a lot more efficient&quot;. note that haskell <code>nub</code> function keeps the <b>first</b> occurrence of each element. so should its alternative implementations."}, {"owner": {"reputation": 44013, "user_id": 1477667, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/trgKM.jpg?s=128&g=1", "display_name": "dfeuer", "link": "https://stackoverflow.com/users/1477667/dfeuer"}, "edited": false, "score": 0, "creation_date": 1442809860, "post_id": 32686104, "comment_id": 53219054, "body": "See my answer. I&#39;ve spent enough days benchmarking list code not to need to benchmark this particular exercise."}], "tags": [], "owner": {"reputation": 61029, "user_id": 625914, "user_type": "registered", "accept_rate": 70, "profile_image": "https://www.gravatar.com/avatar/f1932d8bf4e9dbf779a48b41bbf21592?s=128&d=identicon&r=PG", "display_name": "behzad.nouri", "link": "https://stackoverflow.com/users/625914/behzad-nouri"}, "is_accepted": true, "score": 6, "last_activity_date": 1442835759, "last_edit_date": 1442835759, "creation_date": 1442798865, "answer_id": 32686104, "question_id": 32686043, "link": "https://stackoverflow.com/questions/32686043/haskell-removing-duplicates-tuples-from-a-list/32686104#32686104", "title": "Haskell: Removing duplicates tuples from a list?", "body": "<p>Searching for <code>Eq a =&gt; [a] -&gt; [a]</code> on <a href=\"https://www.haskell.org/hoogle/?hoogle=Eq+a+%3D%3E+[a]+-%3E+[a]\" rel=\"nofollow\">hoogle</a>, returns <a href=\"https://hackage.haskell.org/package/base-4.8.1.0/docs/Data-List.html#v:nub\" rel=\"nofollow\"><code>nub</code></a> function:</p>\n\n<blockquote>\n  <p>The nub function removes duplicate elements from a list. In particular, it keeps only the first occurrence of each element. (The name nub means `essence'.)</p>\n</blockquote>\n\n<p>As in the documentation the more general case is <a href=\"https://hackage.haskell.org/package/base-4.8.1.0/docs/Data-List.html#v:nubBy\" rel=\"nofollow\"><code>nubBy</code></a>.</p>\n\n<p>That said, this is an <code>O(n^2)</code> algorithm and may not be very efficient. An alternative would be to use <a href=\"https://hackage.haskell.org/package/containers-0.5.6.3/docs/Data-Set.html#v:fromList\" rel=\"nofollow\"><code>Data.Set.fromList</code></a> if the values are an instance of <code>Ord</code> type-class, as in:</p>\n\n<pre><code>import qualified Data.Set as Set\n\nnub' :: Ord a =&gt; [a] -&gt; [a]\nnub' = Set.toList . Set.fromList\n</code></pre>\n\n<p>though this will <em>not</em> maintain the order of the original list.</p>\n\n<p>A simple set style solution which <em>maintains the order</em> of the original list can be:</p>\n\n<pre><code>import Data.Set (Set, member, insert, empty)\n\nnub' :: Ord a =&gt; [a] -&gt; [a]\nnub' = reverse . fst . foldl loop ([], empty)\n    where\n    loop :: Ord a =&gt; ([a], Set a) -&gt; a -&gt; ([a], Set a)\n    loop acc@(xs, obs) x\n        | x `member` obs = acc\n        | otherwise = (x:xs, x `insert` obs)\n</code></pre>\n"}, {"tags": [], "owner": {"reputation": 44013, "user_id": 1477667, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/trgKM.jpg?s=128&g=1", "display_name": "dfeuer", "link": "https://stackoverflow.com/users/1477667/dfeuer"}, "is_accepted": false, "score": 4, "last_activity_date": 1442809641, "creation_date": 1442809641, "answer_id": 32687355, "question_id": 32686043, "link": "https://stackoverflow.com/questions/32686043/haskell-removing-duplicates-tuples-from-a-list/32687355#32687355", "title": "Haskell: Removing duplicates tuples from a list?", "body": "<p>If you want to define a version of <code>nub</code> for <code>Ord</code>, I recommend using</p>\n\n<pre><code>nub' :: Ord a =&gt; [a] -&gt; [a]\nnub' xs = foldr go (`seq` []) xs empty\n  where\n    go x r obs\n      | x `member` obs = r obs\n      | otherwise = obs' `seq` x : r obs'\n      where obs' = x `insert` obs\n</code></pre>\n\n<p>To see what this is doing, you can get rid of the <code>foldr</code>:</p>\n\n<pre><code>nub' :: Ord a =&gt; [a] -&gt; [a]\nnub' xs = nub'' xs empty\n  where\n    nub'' [] obs = obs `seq` []\n    nub'' (y : ys) obs\n      | y `member` obs = nub'' ys obs\n      | otherwise = obs' `seq` y : nub'' ys obs'\n      where obs' = y `insert` obs\n</code></pre>\n\n<p>One key point about this implementation, as opposed to \nbehzad.nouri's, is that it produces elements lazily, as they are consumed. This is generally much better for cache utilization and garbage collection, as well as using a constant factor less memory than the reversing algorithm.</p>\n"}], "owner": {"reputation": 1895, "user_id": 3621754, "user_type": "registered", "accept_rate": 63, "profile_image": "https://www.gravatar.com/avatar/2dc5c4eed3ed0e149b0bd6783a07fe0b?s=128&d=identicon&r=PG&f=1", "display_name": "sanic", "link": "https://stackoverflow.com/users/3621754/sanic"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 1439, "favorite_count": 1, "accepted_answer_id": 32686104, "answer_count": 2, "score": 0, "last_activity_date": 1443551234, "creation_date": 1442798419, "last_edit_date": 1443551234, "question_id": 32686043, "link": "https://stackoverflow.com/questions/32686043/haskell-removing-duplicates-tuples-from-a-list", "title": "Haskell: Removing duplicates tuples from a list?", "body": "<p>I'm trying to get from the before to after state. Is there a convenient Haskell function for removing duplicate tuples from a list? Or perhaps it is something a bit more complicated such as iterating through the entire list?</p>\n\n<pre><code>Before: the list of tuples, sorted by word, as in\n   [(2,\"a\"), (1,\"a\"), (1,\"b\"), (1,\"b\"), (1,\"c\"), (2,\"dd\")]\nAfter: the list of sorted tuples with exact duplicates removed, as in\n   [(2,\"a\"), (1,\"a\"), (1,\"b\"), (1,\"c\"), (2,\"dd\")]\n</code></pre>\n"}, {"tags": ["haskell"], "answers": [{"comments": [{"owner": {"reputation": 31243, "user_id": 2751851, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/4ddc0.png?s=128&g=1", "display_name": "duplode", "link": "https://stackoverflow.com/users/2751851/duplode"}, "edited": false, "score": 4, "creation_date": 1442795899, "post_id": 32685714, "comment_id": 53216183, "body": "&quot;do-blocks are bad, avoid them&quot; is a very extreme position. There is a nuanced pedagogical argument about not using do-blocks at first when teaching beginners, but other than that do-blocks are fine and perfectly idiomatic Haskell. As for if-then-else, it is indeed the case that there usually are nicer alternatives, such as the one you show in the second half of the answer."}, {"owner": {"reputation": 314794, "user_id": 67579, "user_type": "registered", "accept_rate": 81, "profile_image": "https://i.stack.imgur.com/BJXub.png?s=128&g=1", "display_name": "Willem Van Onsem", "link": "https://stackoverflow.com/users/67579/willem-van-onsem"}, "reply_to_user": {"reputation": 31243, "user_id": 2751851, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/4ddc0.png?s=128&g=1", "display_name": "duplode", "link": "https://stackoverflow.com/users/2751851/duplode"}, "edited": false, "score": 0, "creation_date": 1442796003, "post_id": 32685714, "comment_id": 53216203, "body": "Here we go again... First of all, if you read carefully, it says &quot;are considered by many...&quot;; furthermore it links to a page of the Haskell wiki that explains it more carefully. If I would have to explain all in my course texts, they would be 3k+ pages instead of 300. The statement is a small footnote, it is not relevant to the question itself, but is relevant for people wanting to improve code hygiene and thus read the page behind the link."}, {"owner": {"reputation": 31243, "user_id": 2751851, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/4ddc0.png?s=128&g=1", "display_name": "duplode", "link": "https://stackoverflow.com/users/2751851/duplode"}, "edited": false, "score": 0, "creation_date": 1442796377, "post_id": 32685714, "comment_id": 53216265, "body": "I noticed that (though I would dispute the &quot;many&quot;). I only mentioned the majority opinion here to hopefully prevent the OP from avoiding do-blocks for no good reason. I wrote it as a comment because I didn&#39;t feel it justified a competing answer."}, {"owner": {"reputation": 314794, "user_id": 67579, "user_type": "registered", "accept_rate": 81, "profile_image": "https://i.stack.imgur.com/BJXub.png?s=128&g=1", "display_name": "Willem Van Onsem", "link": "https://stackoverflow.com/users/67579/willem-van-onsem"}, "reply_to_user": {"reputation": 31243, "user_id": 2751851, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/4ddc0.png?s=128&g=1", "display_name": "duplode", "link": "https://stackoverflow.com/users/2751851/duplode"}, "edited": false, "score": 0, "creation_date": 1442796436, "post_id": 32685714, "comment_id": 53216286, "body": "@duplode: modified... Happy?"}, {"owner": {"reputation": 31243, "user_id": 2751851, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/4ddc0.png?s=128&g=1", "display_name": "duplode", "link": "https://stackoverflow.com/users/2751851/duplode"}, "edited": false, "score": 1, "creation_date": 1442797750, "post_id": 32685714, "comment_id": 53216501, "body": "It is certainly better, though I believe &quot;do-blocks are bad&quot; is such a minority stance it doesn&#39;t deserve a mention at all (the if-then-else part is fine). Please note that my comments (and, I presume, those of other [haskell] regulars as well) are not meant as nitpicking for the sake of it. We just care about lowering the likelihood of readers getting unnecessarily confused over details."}, {"owner": {"reputation": 44013, "user_id": 1477667, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/trgKM.jpg?s=128&g=1", "display_name": "dfeuer", "link": "https://stackoverflow.com/users/1477667/dfeuer"}, "edited": false, "score": 1, "creation_date": 1442798227, "post_id": 32685714, "comment_id": 53216601, "body": "I don&#39;t see how monads have anything to do with it. The reason <code>if</code> requires an <code>else</code> is that <code>if</code> chooses between two expressions. It has to have an expression for the case where the condition holds and one for the case where it does not."}], "tags": [], "owner": {"reputation": 314794, "user_id": 67579, "user_type": "registered", "accept_rate": 81, "profile_image": "https://i.stack.imgur.com/BJXub.png?s=128&g=1", "display_name": "Willem Van Onsem", "link": "https://stackoverflow.com/users/67579/willem-van-onsem"}, "is_accepted": false, "score": 3, "last_activity_date": 1442796839, "last_edit_date": 1495539886, "creation_date": 1442795132, "answer_id": 32685714, "question_id": 32685682, "link": "https://stackoverflow.com/questions/32685682/i-keep-getting-solution-hs91-parse-error-on-input-main-i-am-trying-to-pri/32685714#32685714", "title": "I keep getting solution.hs:9:1: parse error on input `main&#39; . I am trying to print hello world n times recursively", "body": "<p>This is because in Haskell the <code>if-then-else</code> structure, it <a href=\"https://stackoverflow.com/questions/832828/haskell-do-nothing-io-or-if-without-else\"><em>requires an <code>else</code></em></a>. This works:</p>\n\n<pre><code>hello_worlds n = if n &gt; 0\n                 then do putStrLn \"Hello World\"\n                         hello_worlds (n-1)\n                 else return ()\n\nmain = do\n   n &lt;- readLn :: IO Int\n   hello_worlds n\n</code></pre>\n\n<p>Where the <code>return ()</code> can be seen as a <em>no-operation</em> statement.</p>\n\n<p>This is mainly because I/O in Haskell is done using <em>Monads</em>: The <code>IO a</code>; with <code>a</code> the \"return-type\" of the Monad. Now evidently you do not return anything, but it could be possible that your I/O monad did (like <code>IO Int</code>), in which case both branches should return something.</p>\n\n<p>Anyway, using an <code>if-then-else</code> block is by some (under some circumstances) considered to be <a href=\"https://wiki.haskell.org/If-then-else#What_is_so_bad_about_the_if-then-else_sugar.3F\" rel=\"nofollow noreferrer\"><em>bad</em></a> as is the <code>do</code> statement as well.</p>\n\n<hr>\n\n<p>You can replace this <code>if</code> statement (which is by some considered to be <em>un-Haskell</em>); and make it more declarative using:</p>\n\n<pre><code>import Control.Monad(replicateM_)\n\nmain = do\n   n &lt;- readLn :: IO Int\n   replicateM_ n $ putStrLn \"Hello World\"\n</code></pre>\n\n<p>because it makes it syntactically very clear that you are going to repeat (<code>replicate</code>) the <code>putStrLn \"Hello World\"</code> statement <code>n</code> times, whereas for the recursive approach it requires more thinking on how this works.</p>\n"}], "owner": {"reputation": 11, "user_id": 5357269, "user_type": "registered", "profile_image": "https://graph.facebook.com/10207592487314245/picture?type=large", "display_name": "Jimi Olugboyega", "link": "https://stackoverflow.com/users/5357269/jimi-olugboyega"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 247, "favorite_count": 0, "closed_date": 1442822165, "answer_count": 1, "score": 0, "last_activity_date": 1442796839, "creation_date": 1442794786, "last_edit_date": 1442794937, "question_id": 32685682, "link": "https://stackoverflow.com/questions/32685682/i-keep-getting-solution-hs91-parse-error-on-input-main-i-am-trying-to-pri", "closed_reason": "Duplicate", "title": "I keep getting solution.hs:9:1: parse error on input `main&#39; . I am trying to print hello world n times recursively", "body": "<pre><code>hello_worlds n =    if n &gt; 0\n                    then do putStrLn \"Hello World\"                            \n                            hello_worlds (n-1)              \n\n\nmain = do\n   n &lt;- readLn :: IO Int\n   hello_worlds n\n</code></pre>\n"}, {"tags": ["haskell", "higher-order-functions"], "answers": [{"tags": [], "owner": {"reputation": 6215, "user_id": 388182, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/TqkIS.jpg?s=128&g=1", "display_name": "RageD", "link": "https://stackoverflow.com/users/388182/raged"}, "is_accepted": false, "score": 5, "last_activity_date": 1442793725, "last_edit_date": 1442793725, "creation_date": 1442793263, "answer_id": 32685529, "question_id": 32685395, "link": "https://stackoverflow.com/questions/32685395/get-elements-with-odd-length-in-a-haskell-list-of-strings/32685529#32685529", "title": "Get elements with odd length in a Haskell list of strings", "body": "<p>It seems that you are aware that <code>filter</code> exists (since you've mentioned), but perhaps are uncertain how it works. If you're trying to extract a specific subset of a list, this seems to be the right path. If you look at its type-signature, you'll find it's pretty straight-forward:</p>\n\n<pre><code>(a -&gt; Bool) -&gt; [a] -&gt; [a]\n</code></pre>\n\n<p>That is, it takes a function that returns True or False (i.e. true to contain in the new set, false otherwise) and produces a new list. Similarly, Haskell provides a function called <code>odd</code> in Prelude. It's signature looks as follows:</p>\n\n<pre><code>Integral a =&gt; a -&gt; Bool\n</code></pre>\n\n<p>That is, it can take any <code>Integral</code> type and returns True if it is odd, false otherwise.</p>\n\n<p>Now, let's consider a solution:</p>\n\n<pre><code>filter odd [1..10]\n</code></pre>\n\n<p>This will extract all the odd numbers between [1,10].</p>\n\n<p>I noticed you mentioned list comprehensions. You probably do not want to use this if you are already given a list and you are simply filtering it. However, a list comprehension would be a perfectly acceptable solution:</p>\n\n<pre><code>[x | x &lt;- [1..10], odd x]\n</code></pre>\n\n<p>In general, list comprehensions are used to express the generation of lists with more complicated constraints.</p>\n\n<p>Now, to actually answer your question. Since we know we can filter numbers, and if we're using Hoogle searching for the following type (notice that <code>String</code> is simply <code>[Char]</code>):</p>\n\n<pre><code>[a] -&gt; Int\n</code></pre>\n\n<p>You will see a <code>length</code> function. With some function composition, we can quickly see how to create a function which filters odd length. In summary, we have <code>odd</code> which is type <code>Int -&gt; Bool</code> (in this case) and we have <code>length</code> which is <code>[a] -&gt; Int</code> or-- specifically-- <code>String -&gt; Int</code>. Our solution now looks like this:</p>\n\n<pre><code>filter (odd . length) [\"abc\",\"def\",\"eh\",\"123\",\"hm\",\"even\"]\n</code></pre>\n"}, {"comments": [{"owner": {"reputation": 25144, "user_id": 477476, "user_type": "registered", "accept_rate": 85, "profile_image": "https://i.stack.imgur.com/Qf4TT.png?s=128&g=1", "display_name": "Cactus", "link": "https://stackoverflow.com/users/477476/cactus"}, "edited": false, "score": 0, "creation_date": 1442829280, "post_id": 32685886, "comment_id": 53227752, "body": "While cute, your <code>isOddLength</code> part is needlessly complicated. A much more straitghtforward solution along the same lines would be <code>getOddOnes = filter $ foldr (const not) False</code>"}, {"owner": {"reputation": 44013, "user_id": 1477667, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/trgKM.jpg?s=128&g=1", "display_name": "dfeuer", "link": "https://stackoverflow.com/users/1477667/dfeuer"}, "reply_to_user": {"reputation": 25144, "user_id": 477476, "user_type": "registered", "accept_rate": 85, "profile_image": "https://i.stack.imgur.com/Qf4TT.png?s=128&g=1", "display_name": "Cactus", "link": "https://stackoverflow.com/users/477476/cactus"}, "edited": false, "score": 0, "creation_date": 1442839213, "post_id": 32685886, "comment_id": 53233954, "body": "@Cactus, there are reasons to prefer the left fold, I think, and this answer is intended to match the character of the question in a certain sense."}], "tags": [], "owner": {"reputation": 44013, "user_id": 1477667, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/trgKM.jpg?s=128&g=1", "display_name": "dfeuer", "link": "https://stackoverflow.com/users/1477667/dfeuer"}, "is_accepted": false, "score": 1, "last_activity_date": 1442797027, "creation_date": 1442797027, "answer_id": 32685886, "question_id": 32685395, "link": "https://stackoverflow.com/questions/32685395/get-elements-with-odd-length-in-a-haskell-list-of-strings/32685886#32685886", "title": "Get elements with odd length in a Haskell list of strings", "body": "<p>Here ya go.</p>\n\n<pre><code>getOddOnes = filter . flip (foldr (const (. not)) id) $ False\n</code></pre>\n\n<p>Note: if you turn this in for your homework, you'd best be prepared to explain it!</p>\n"}], "owner": {"reputation": 353, "user_id": 3059248, "user_type": "registered", "accept_rate": 8, "profile_image": "https://www.gravatar.com/avatar/4de3c6781428dec365cc468a0badbd9a?s=128&d=identicon&r=PG&f=1", "display_name": "user3059248", "link": "https://stackoverflow.com/users/3059248/user3059248"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 1716, "favorite_count": 0, "answer_count": 2, "score": 0, "last_activity_date": 1442797027, "creation_date": 1442792037, "question_id": 32685395, "link": "https://stackoverflow.com/questions/32685395/get-elements-with-odd-length-in-a-haskell-list-of-strings", "title": "Get elements with odd length in a Haskell list of strings", "body": "<p>I have a list of strings in Haskell and I need to get those elements with odd length in another list. How can this be done using higher order functions like foldr, foldl, foldr1, foldl1, filter, map, and so on? I will very much appreciate your help. Can list comprehension be used in this case?</p>\n"}, {"tags": ["haskell", "syntax", "monads"], "comments": [{"owner": {"reputation": 866, "user_id": 2872507, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/49ebde219395d677c399d8e950f5a48c?s=128&d=identicon&r=PG&f=1", "display_name": "Alexander Vieth", "link": "https://stackoverflow.com/users/2872507/alexander-vieth"}, "edited": false, "score": 1, "creation_date": 1442777455, "post_id": 32683341, "comment_id": 53211480, "body": "You&#39;re missing the <code>num</code> binding. You need to name it at the first <code>&gt;&gt;=</code> so that you can reuse it in subsequent terms."}, {"owner": {"reputation": 153048, "user_id": 9204, "user_type": "registered", "accept_rate": 82, "profile_image": "https://www.gravatar.com/avatar/c79937a093ff9e963c563e22cd385f30?s=128&d=identicon&r=PG", "display_name": "Alexey Romanov", "link": "https://stackoverflow.com/users/9204/alexey-romanov"}, "edited": false, "score": 0, "creation_date": 1442777566, "post_id": 32683341, "comment_id": 53211525, "body": "Also note that <code>&gt;&gt;</code> is used instead of <code>&gt;&gt;=</code> for lines which don&#39;t have <code>&lt;-</code>."}, {"owner": {"reputation": 153048, "user_id": 9204, "user_type": "registered", "accept_rate": 82, "profile_image": "https://www.gravatar.com/avatar/c79937a093ff9e963c563e22cd385f30?s=128&d=identicon&r=PG", "display_name": "Alexey Romanov", "link": "https://stackoverflow.com/users/9204/alexey-romanov"}, "edited": false, "score": 2, "creation_date": 1442777703, "post_id": 32683341, "comment_id": 53211568, "body": "The code you wrote is the translation for <code>do { num &lt;- [1..20]; x &lt;- guard (even num); r &lt;- guard (x `mod` 3 == 0); return r }</code>."}, {"owner": {"reputation": 44013, "user_id": 1477667, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/trgKM.jpg?s=128&g=1", "display_name": "dfeuer", "link": "https://stackoverflow.com/users/1477667/dfeuer"}, "edited": false, "score": 0, "creation_date": 1442781598, "post_id": 32683341, "comment_id": 53212846, "body": "Any time you have two guards in a row, you can collapse them into one. Can you see how? Can you see a way to combine the underlying mathematical questions?"}], "answers": [{"tags": [], "owner": {"reputation": 133611, "user_id": 152602, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/7f370b4bd787fc68f9f62d9c6781cb79?s=128&d=identicon&r=PG", "display_name": "Lee", "link": "https://stackoverflow.com/users/152602/lee"}, "is_accepted": true, "score": 4, "last_activity_date": 1442777699, "creation_date": 1442777699, "answer_id": 32683450, "question_id": 32683341, "link": "https://stackoverflow.com/questions/32683341/desugaring-do-blocks/32683450#32683450", "title": "Desugaring &#39;do&#39; blocks", "body": "<p><code>guard</code> has type <code>MonadPlus m =&gt; Bool -&gt; m ()</code> so your third segment</p>\n\n<pre><code>(guard . (==0) . (mod 3))\n</code></pre>\n\n<p>receives a value of type <code>()</code> which is not what you want. In <code>do</code> notation</p>\n\n<pre><code>do\n  guard (even num)\n  guard (num `mod` 3 == 0)\n</code></pre>\n\n<p>is desugarded into something like</p>\n\n<pre><code>guard (even num) &gt;&gt; guard (num `mod` 3 == 0)\n</code></pre>\n\n<p>so you can implement <code>ex10'</code> as</p>\n\n<pre><code> ex10' = [1..20] &gt;&gt;= (\\num -&gt; (guard $ even num) &gt;&gt; (guard $ num `mod` 3 == 0) &gt;&gt; return num)\n</code></pre>\n"}], "owner": {"reputation": 1084, "user_id": 3893319, "user_type": "registered", "accept_rate": 79, "profile_image": "https://i.stack.imgur.com/wd9aa.jpg?s=128&g=1", "display_name": "Reygoch", "link": "https://stackoverflow.com/users/3893319/reygoch"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 257, "favorite_count": 0, "accepted_answer_id": 32683450, "answer_count": 1, "score": 3, "last_activity_date": 1442779317, "creation_date": 1442777068, "last_edit_date": 1442779317, "question_id": 32683341, "link": "https://stackoverflow.com/questions/32683341/desugaring-do-blocks", "title": "Desugaring &#39;do&#39; blocks", "body": "<p>I'm having little trouble translating this <code>do</code> statement :</p>\n\n<pre><code>ex10 :: [Int]\nex10 = do\n    num &lt;- [1..20]\n    guard (even num)\n    guard (num `mod` 3 == 0)\n    return num\n</code></pre>\n\n<p>into some kind of <code>monad</code> syntax like this :</p>\n\n<pre><code>ex10' :: [Int]\nex10' = [1..20] &gt;&gt;= (guard . even) &gt;&gt;= (guard . (==0) . (mod 3)) &gt;&gt;= \\r -&gt; return r\n</code></pre>\n\n<p>This doesn't work, and I'm not quite sure why. I think I might have misunderstood <code>guard</code> but am not sure in what way.</p>\n"}, {"tags": ["haskell"], "comments": [{"owner": {"reputation": 44013, "user_id": 1477667, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/trgKM.jpg?s=128&g=1", "display_name": "dfeuer", "link": "https://stackoverflow.com/users/1477667/dfeuer"}, "edited": false, "score": 2, "creation_date": 1442772966, "post_id": 32682669, "comment_id": 53209973, "body": "What do those angle brackets mean?"}, {"owner": {"reputation": 343, "user_id": 5066328, "user_type": "registered", "accept_rate": 57, "profile_image": "https://lh4.googleusercontent.com/-Sc93ZNN8dbo/AAAAAAAAAAI/AAAAAAAABVM/HfCPP8bagsM/photo.jpg?sz=128", "display_name": "christian russo", "link": "https://stackoverflow.com/users/5066328/christian-russo"}, "reply_to_user": {"reputation": 44013, "user_id": 1477667, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/trgKM.jpg?s=128&g=1", "display_name": "dfeuer", "link": "https://stackoverflow.com/users/1477667/dfeuer"}, "edited": false, "score": 0, "creation_date": 1442773173, "post_id": 32682669, "comment_id": 53210041, "body": "Its an example, you must thinks only in a duplicate data"}, {"owner": {"reputation": 23444, "user_id": 414413, "user_type": "registered", "accept_rate": 79, "profile_image": "https://www.gravatar.com/avatar/6de2113f01432aa844dc85070ff33e89?s=128&d=identicon&r=PG", "display_name": "Cirdec", "link": "https://stackoverflow.com/users/414413/cirdec"}, "edited": false, "score": 0, "creation_date": 1442774455, "post_id": 32682669, "comment_id": 53210462, "body": "Your most recent edit changed the question completely. Perhaps you should leave the first problem, your solution to it, and ask what it has to do with the second problem."}, {"owner": {"reputation": 44013, "user_id": 1477667, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/trgKM.jpg?s=128&g=1", "display_name": "dfeuer", "link": "https://stackoverflow.com/users/1477667/dfeuer"}, "edited": false, "score": 0, "creation_date": 1442776515, "post_id": 32682669, "comment_id": 53211140, "body": "I&#39;ve rolled the question back to its original form. If you need help understanding why, you can ask on <a href=\"http://meta.stackoverflow.com/\">meta</a>."}, {"owner": {"reputation": 44013, "user_id": 1477667, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/trgKM.jpg?s=128&g=1", "display_name": "dfeuer", "link": "https://stackoverflow.com/users/1477667/dfeuer"}, "edited": false, "score": 1, "creation_date": 1442781030, "post_id": 32682669, "comment_id": 53212668, "body": "Your most recent edit makes it impossible even to guess what you are asking."}], "answers": [{"tags": [], "owner": {"reputation": 44013, "user_id": 1477667, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/trgKM.jpg?s=128&g=1", "display_name": "dfeuer", "link": "https://stackoverflow.com/users/1477667/dfeuer"}, "is_accepted": false, "score": 3, "last_activity_date": 1442773259, "creation_date": 1442773259, "answer_id": 32682760, "question_id": 32682669, "link": "https://stackoverflow.com/questions/32682669/function-double-in-haskell/32682760#32682760", "title": "Function double in haskell", "body": "<p>You're trying to write a function</p>\n\n<pre><code>double :: AEB2 a -&gt; AEB2 a\ndouble = foldAEB2 fnil fsin fcon\n</code></pre>\n\n<p>You can think of <code>foldAEB2</code> as replacing each <code>Nil</code> with <code>fnil</code>, each <code>Un</code> with <code>fsin</code> and each <code>Conc</code> with <code>fcon</code>. Can you draw a picture of the data structure before and after and figure out what what should replace each constructor?</p>\n"}, {"comments": [{"owner": {"reputation": 343, "user_id": 5066328, "user_type": "registered", "accept_rate": 57, "profile_image": "https://lh4.googleusercontent.com/-Sc93ZNN8dbo/AAAAAAAAAAI/AAAAAAAABVM/HfCPP8bagsM/photo.jpg?sz=128", "display_name": "christian russo", "link": "https://stackoverflow.com/users/5066328/christian-russo"}, "edited": false, "score": 0, "creation_date": 1442773924, "post_id": 32682802, "comment_id": 53210272, "body": "some more help please?"}, {"owner": {"reputation": 23444, "user_id": 414413, "user_type": "registered", "accept_rate": 79, "profile_image": "https://www.gravatar.com/avatar/6de2113f01432aa844dc85070ff33e89?s=128&d=identicon&r=PG", "display_name": "Cirdec", "link": "https://stackoverflow.com/users/414413/cirdec"}, "reply_to_user": {"reputation": 343, "user_id": 5066328, "user_type": "registered", "accept_rate": 57, "profile_image": "https://lh4.googleusercontent.com/-Sc93ZNN8dbo/AAAAAAAAAAI/AAAAAAAABVM/HfCPP8bagsM/photo.jpg?sz=128", "display_name": "christian russo", "link": "https://stackoverflow.com/users/5066328/christian-russo"}, "edited": false, "score": 2, "creation_date": 1442774180, "post_id": 32682802, "comment_id": 53210364, "body": "I think that between dfeuer&#39;s answer and mine we have already given you more help than we probably should."}, {"owner": {"reputation": 44013, "user_id": 1477667, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/trgKM.jpg?s=128&g=1", "display_name": "dfeuer", "link": "https://stackoverflow.com/users/1477667/dfeuer"}, "reply_to_user": {"reputation": 343, "user_id": 5066328, "user_type": "registered", "accept_rate": 57, "profile_image": "https://lh4.googleusercontent.com/-Sc93ZNN8dbo/AAAAAAAAAAI/AAAAAAAABVM/HfCPP8bagsM/photo.jpg?sz=128", "display_name": "christian russo", "link": "https://stackoverflow.com/users/5066328/christian-russo"}, "edited": false, "score": 1, "creation_date": 1442775572, "post_id": 32682802, "comment_id": 53210826, "body": "@christianrusso, you&#39;re being made to wait before asking another question because this one attracted a lot of down votes. The way to fix that is to <i>improve</i> the question so people cancel their down votes or other people vote it up. Changing it to a completely different question makes the answers nonsense and attracts even more down votes by making people angry at you. Go back to the original question, add more information on what you need,"}, {"owner": {"reputation": 44013, "user_id": 1477667, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/trgKM.jpg?s=128&g=1", "display_name": "dfeuer", "link": "https://stackoverflow.com/users/1477667/dfeuer"}, "edited": false, "score": 0, "creation_date": 1442775597, "post_id": 32682802, "comment_id": 53210833, "body": "what your thoughts are, where you got stuck, etc."}], "tags": [], "owner": {"reputation": 23444, "user_id": 414413, "user_type": "registered", "accept_rate": 79, "profile_image": "https://www.gravatar.com/avatar/6de2113f01432aa844dc85070ff33e89?s=128&d=identicon&r=PG", "display_name": "Cirdec", "link": "https://stackoverflow.com/users/414413/cirdec"}, "is_accepted": true, "score": 3, "last_activity_date": 1442774217, "last_edit_date": 1442774217, "creation_date": 1442773535, "answer_id": 32682802, "question_id": 32682669, "link": "https://stackoverflow.com/questions/32682669/function-double-in-haskell/32682802#32682802", "title": "Function double in haskell", "body": "<p>Here are a few hints</p>\n\n<p><code>foldAEB2 Nil Un Conc</code> is the identity function</p>\n\n<p><code>foldAEB2 Nil Un Conc :: AEB2 a -&gt; AEB2 a</code></p>\n\n<pre><code>Un                       :: a -&gt; AEB2 a\n\\a -&gt; Conc (Un a) (Un a) :: a -&gt; AEB2 a\n</code></pre>\n"}], "owner": {"reputation": 343, "user_id": 5066328, "user_type": "registered", "accept_rate": 57, "profile_image": "https://lh4.googleusercontent.com/-Sc93ZNN8dbo/AAAAAAAAAAI/AAAAAAAABVM/HfCPP8bagsM/photo.jpg?sz=128", "display_name": "christian russo", "link": "https://stackoverflow.com/users/5066328/christian-russo"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 175, "favorite_count": 0, "accepted_answer_id": 32682802, "answer_count": 2, "score": -7, "last_activity_date": 1442776842, "creation_date": 1442772720, "last_edit_date": 1442776842, "question_id": 32682669, "link": "https://stackoverflow.com/questions/32682669/function-double-in-haskell", "title": "Function double in haskell", "body": "<p>I have this definition:</p>\n\n<pre><code>data AEB2 a = Nil | Un a | Conc (AEB2 a) (AEB2 a) deriving (Eq, Show)\n</code></pre>\n\n<p>and I have:</p>\n\n<pre><code>foldAEB2 :: b -&gt; (a-&gt;b) -&gt; (b-&gt;b-&gt;b) -&gt; (AEB2 a) -&gt; b\nfoldAEB2 fnil fsin fcon t = case t of\n                                       Nil -&gt; fnil\n                                       Un s -&gt; fsin s\n                                       Conc u v -&gt; fcon (rec u) (rec v)                                   \n                                       where rec = foldAEB2 fnil fsin fcon\n</code></pre>\n\n<p>I need do one function \"double\" using foldAEB2. One example is </p>\n\n<p>I need help doing this function. Thanks</p>\n"}, {"tags": ["haskell", "opengl", "plugins", "gstreamer"], "comments": [{"owner": {"reputation": 31243, "user_id": 2751851, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/4ddc0.png?s=128&g=1", "display_name": "duplode", "link": "https://stackoverflow.com/users/2751851/duplode"}, "edited": false, "score": 0, "creation_date": 1442789994, "post_id": 32682317, "comment_id": 53215102, "body": "@ElleGnrd and potential answerers: Note that C answers <i>might</i> be helpful here. The <i>gstreamer</i> Haskell library appears to be a thin wrapper over the <a href=\"http://gstreamer.freedesktop.org/data/doc/gstreamer/head/gstreamer-libs/html/\" rel=\"nofollow noreferrer\">core GStreamer library</a>. If there are no Haskell bindings for the GStreamer plugin Elle needs, and if there is a way of answering the question using only the core libraries, a (largely) direct translation from C to Haskell should be possible. I unfortunately can&#39;t help much further, as I know very little about the GStreamer libraries in either language."}, {"owner": {"reputation": 1771, "user_id": 3040948, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/2e165e48a46079440f8ae438b0a3ed88?s=128&d=identicon&r=PG", "display_name": "Sebastian Dr&#246;ge", "link": "https://stackoverflow.com/users/3040948/sebastian-dr%c3%b6ge"}, "edited": false, "score": 0, "creation_date": 1443257853, "post_id": 32682317, "comment_id": 53428893, "body": "It&#39;s not part of the Haskell bindings it seems, and dynamic GLib action signal usage does not seem possible (correct me if I&#39;m wrong please). It would have to be added to the bindings first.  But independent of that, the Haskell GStreamer bindings are for the old 0.10 release series of GStreamer, which is no longer maintained since 3 years. And especially for anything OpenGL related, the latest 1.6 version should be used."}, {"owner": {"reputation": 1771, "user_id": 3040948, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/2e165e48a46079440f8ae438b0a3ed88?s=128&d=identicon&r=PG", "display_name": "Sebastian Dr&#246;ge", "link": "https://stackoverflow.com/users/3040948/sebastian-dr%c3%b6ge"}, "edited": false, "score": 0, "creation_date": 1443257916, "post_id": 32682317, "comment_id": 53428906, "body": "For a C example, see here <a href=\"http://cgit.freedesktop.org/gstreamer/gst-plugins-base/tree/tests/examples/app/appsink-src.c#n52\" rel=\"nofollow noreferrer\">cgit.freedesktop.org/gstreamer/gst-plugins-base/tree/tests/&hellip;</a> . But that&#39;s probably not very useful for you as you seem to know how to do it from C :)"}, {"owner": {"reputation": 1593, "user_id": 2287402, "user_type": "registered", "accept_rate": 78, "profile_image": "https://i.stack.imgur.com/Q5Rvg.png?s=128&g=1", "display_name": "Elie G&#233;nard", "link": "https://stackoverflow.com/users/2287402/elie-g%c3%a9nard"}, "edited": false, "score": 0, "creation_date": 1443380438, "post_id": 32682317, "comment_id": 53459979, "body": "I think it&#39;s possible to use <a href=\"https://hackage.haskell.org/package/glib-0.13.2.1/docs/System-Glib-Signals.html\" rel=\"nofollow noreferrer\">GLib</a> signals with the GStreamer Haskell library but I have no idea how to do this. The signal concept is quite new to me and I don&#39;t really know where to start. Any suggestion? Thanks for your insight anyway."}, {"owner": {"reputation": 1771, "user_id": 3040948, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/2e165e48a46079440f8ae438b0a3ed88?s=128&d=identicon&r=PG", "display_name": "Sebastian Dr&#246;ge", "link": "https://stackoverflow.com/users/3040948/sebastian-dr%c3%b6ge"}, "edited": false, "score": 0, "creation_date": 1443383039, "post_id": 32682317, "comment_id": 53460740, "body": "There&#39;s only API to connect to signals as far as I can see, what you need here is to be able to emit signals."}], "owner": {"reputation": 1593, "user_id": 2287402, "user_type": "registered", "accept_rate": 78, "profile_image": "https://i.stack.imgur.com/Q5Rvg.png?s=128&g=1", "display_name": "Elie G&#233;nard", "link": "https://stackoverflow.com/users/2287402/elie-g%c3%a9nard"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 246, "favorite_count": 0, "answer_count": 0, "score": 1, "last_activity_date": 1442771225, "creation_date": 1442770488, "last_edit_date": 1442771225, "question_id": 32682317, "link": "https://stackoverflow.com/questions/32682317/gstreamer-plugin-usage-in-haskell", "title": "GStreamer plugin usage in Haskell", "body": "<p>I'm trying to get the image from a webcam with GStreamer and load it to an OpenGL texture. </p>\n\n<p>I'm using the <a href=\"https://hackage.haskell.org/package/gstreamer-0.12.5.0\" rel=\"nofollow\">gstreamer</a> haskell library. I managed to simply display the webcam output in a window with <code>v4l2src</code> as a source and <code>xvimagesink</code> as a sink. Now I'd like to load this in an OpenGL texture. I saw you can do this in C with the <a href=\"http://gstreamer.freedesktop.org/data/doc/gstreamer/head/gst-plugins-base-libs/html/gst-plugins-base-libs-appsink.html#gst-app-sink-pull-sample\" rel=\"nofollow\">appsink</a> GStreamer plugin that allows you to extract samples from the pipeline by calling <code>gst_app_sink_pull_sample ()</code>.</p>\n\n<p>I think I managed to load the <code>app</code> plugin and the <code>appsink</code> feature but I don't know what is the equivalent of <code>gst_app_sink_pull_sample ()</code> in Haskell.</p>\n\n<p>This is how I load the <code>app</code> plugin and the <code>appsink</code> feature:</p>\n\n<pre><code>import qualified Media.Streaming.GStreamer as GS\n\nmain = do\n    GS.init\n    appPlugin &lt;- GS.pluginLoadByName \"app\"\n    appsinkFeature &lt;- GS.registryLookupFeature GS.defaultRegistry \"appsink\"\n</code></pre>\n\n<p>Should I create an <code>Element</code> like this:</p>\n\n<pre><code>appSink &lt;- GS.elementFactoryMake \"appsink\" (Just \"app-sink\")\n</code></pre>\n\n<p>But what do I do with it after to sample the pipeline?</p>\n"}, {"tags": ["haskell", "factory-pattern"], "answers": [{"tags": [], "owner": {"reputation": 49959, "user_id": 866915, "user_type": "registered", "accept_rate": 70, "profile_image": "https://www.gravatar.com/avatar/09242131d6e17cbbe31e8547514da6e5?s=128&d=identicon&r=PG", "display_name": "ErikR", "link": "https://stackoverflow.com/users/866915/erikr"}, "is_accepted": true, "score": 6, "last_activity_date": 1442766611, "creation_date": 1442766611, "answer_id": 32681692, "question_id": 32681608, "link": "https://stackoverflow.com/questions/32681608/guards-in-a-haskell-constructor-or-factory-methods-with-visibility-constraints/32681692#32681692", "title": "Guards in a Haskell constructor or factory methods with visibility constraints", "body": "<p>To make a constructor private, just don't export it, e.g.:</p>\n\n<pre><code>module Foo (Bar, mkBar) where\n\ndata Bar = Zero | Some a | ...\n\nmkBar :: Int -&gt; Bar  -- exported smart constructor\nmkBar a = ...\n</code></pre>\n\n<p>Users of the library can use the <code>mkBar</code> function to create a <code>Bar</code>, but not <code>Zero</code> or <code>Some ...</code>.</p>\n\n<p>The key is the <code>Bar</code> in the export list. If you had specified:</p>\n\n<pre><code>module Foo (Bar(..), ...) where\n</code></pre>\n\n<p>then the constructors for <code>Bar</code> would also be exported.</p>\n"}, {"tags": [], "owner": {"reputation": 31243, "user_id": 2751851, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/4ddc0.png?s=128&g=1", "display_name": "duplode", "link": "https://stackoverflow.com/users/2751851/duplode"}, "is_accepted": false, "score": 1, "last_activity_date": 1442768291, "last_edit_date": 1495540308, "creation_date": 1442768291, "answer_id": 32681962, "question_id": 32681608, "link": "https://stackoverflow.com/questions/32681608/guards-in-a-haskell-constructor-or-factory-methods-with-visibility-constraints/32681962#32681962", "title": "Guards in a Haskell constructor or factory methods with visibility constraints", "body": "<blockquote>\n  <p>In Java I would just make the two constructors private and provide factory methods to create either one or the other</p>\n</blockquote>\n\n<p><a href=\"https://stackoverflow.com/a/32681692\">user5402's answer</a> covers how you can solve your problem by doing something analogous in Haskell. I just want to point out one easy to make mix-up in your question. In your pseudo-Haskell snippet...</p>\n\n<pre><code>data X a = Zero\n   | a==0 = Zero\n   | otherwise = Some a\n</code></pre>\n\n<p>... you are treating the <code>a</code> in <code>data X a</code> as it was a parameter for a constructor of <code>X</code> values, so that you would be able to e.g. test whether <code>a == 0</code>. However, that <code>a</code> is a <em>type</em> parameter. It can be substituted by different types, so that <code>X a</code> actually corresponds to a range of types such as <code>X Int</code>, <code>X Double</code>, <code>X String</code> and so forth. That is rather similar to how you can use Java generics to parametrise a class, as in a declaration such as <code>class X&lt;A&gt;</code>.</p>\n\n<hr>\n\n<p>Using the common terminology, <code>X</code> is a <em>type constructor</em>, which takes a type and produces another type (e.g. from <code>Int</code> to <code>X Int</code>). The <em>value</em> (or <em>data</em>) constructors are the ones you specify after the equals sign. As you know, you can use them as regular values, that may or may not be functions depending on whether they take arguments. So if we do...</p>\n\n<pre><code>GHCi&gt; data X a = Zero | Some a\n</code></pre>\n\n<p>... then <code>Zero</code> is a value of type <code>X a</code> for arbitrary <code>a</code>...</p>\n\n<pre><code>GHCi&gt; :t Zero\nZero :: X a\n</code></pre>\n\n<p>... while <code>Some</code> is a function from <code>a</code> to <code>X a</code>:</p>\n\n<pre><code>GHCi&gt; :t Some\nSome :: a -&gt; X a\n</code></pre>\n\n<hr>\n\n<p>As for the type constructor <code>X</code>, we do not speak of its type, but rather of its <em>kind</em>. Types and type constructors have kinds analogously to how values have types. The <code>:kind</code> (or <code>:k</code>) command in GHCi allows you to check kinds:</p>\n\n<pre><code>GHCi&gt; :k Int\nInt :: *\nGHCi&gt; :k X\nX :: * -&gt; *\n</code></pre>\n\n<p><code>* -&gt; *</code> means <code>X</code> takes a type and produces a type, as described above.</p>\n"}], "owner": {"reputation": 3612, "user_id": 2954288, "user_type": "registered", "accept_rate": 48, "profile_image": "https://i.stack.imgur.com/t9KSc.png?s=128&g=1", "display_name": "Harald", "link": "https://stackoverflow.com/users/2954288/harald"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 378, "favorite_count": 0, "accepted_answer_id": 32681692, "answer_count": 2, "score": 1, "last_activity_date": 1442768568, "creation_date": 1442766095, "last_edit_date": 1442768568, "question_id": 32681608, "link": "https://stackoverflow.com/questions/32681608/guards-in-a-haskell-constructor-or-factory-methods-with-visibility-constraints", "title": "Guards in a Haskell constructor or factory methods with visibility constraints", "body": "<p>Rather new to Haskell and experimenting I came across a problem which looks like I would want to use guards in a constructor. My real experiment is a bit more involved, but it comes down to something like</p>\n\n<pre><code>data X a = Zero\n   | a==0 = Zero\n   | otherwise = Some a\n</code></pre>\n\n<p>I know <strong>this is wrong syntax</strong>, in particular because <code>a</code> is a type variable, not a value variable, so <code>a==0</code> is nonsensical anyway.</p>\n\n<p>The background is that the values <code>Zero</code> and <code>Some 0</code> shall be equal in all regards, I would even say <em>identical</em>. In fact I never want to construct a <code>Some 0</code>, this should be forbidden or, as drafted above, silently converted to <code>Zero</code> already in the constructor.</p>\n\n<p>I would think there is a common idiom in Haskell for this. In Java I would just make the two constructors <code>private</code> and provide factory methods to create either one or the other with <code>some(0)</code> returning <code>Zero</code> instead of <code>Some(0)</code>. Is this how you would to this in Haskell too?</p>\n\n<p>EDIT: Ok, googling some more I finally found the Haskell <a href=\"https://wiki.haskell.org/Factory_function\" rel=\"nofollow\">Factory Function entry</a>, which seems to be part of the answer. </p>\n"}, {"tags": ["haskell", "functional-programming", "functor"], "answers": [{"comments": [{"owner": {"reputation": 2282, "user_id": 1035792, "user_type": "registered", "accept_rate": 81, "profile_image": "https://i.stack.imgur.com/cQjEY.png?s=128&g=1", "display_name": "gsscoder", "link": "https://stackoverflow.com/users/1035792/gsscoder"}, "edited": false, "score": 0, "creation_date": 1442766710, "post_id": 32681635, "comment_id": 53207865, "body": "Have you tried in GHCi your first proposal? I too tried removing type argument but compiler still refuse to accept change (to be honest I&#39;ve tried it also before posting the question). :("}, {"owner": {"reputation": 11366, "user_id": 3922954, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/76ba47d2fdd24ab56b0b273cce2075e5?s=128&d=identicon&r=PG&f=1", "display_name": "AJF", "link": "https://stackoverflow.com/users/3922954/ajf"}, "reply_to_user": {"reputation": 2282, "user_id": 1035792, "user_type": "registered", "accept_rate": 81, "profile_image": "https://i.stack.imgur.com/cQjEY.png?s=128&g=1", "display_name": "gsscoder", "link": "https://stackoverflow.com/users/1035792/gsscoder"}, "edited": false, "score": 1, "creation_date": 1442766846, "post_id": 32681635, "comment_id": 53207912, "body": "@gsscoder That&#39;s because you constrained the types in your datatype to <code>Num</code> and <code>Show</code>. That&#39;s a bad thing: you&#39;re using constraints incorrectly. <a href=\"http://book.realworldhaskell.org/read/using-typeclasses.html\" rel=\"nofollow noreferrer\">This</a> might explain why, but for now, <b>remove the constraints in your data declaration.</b> I&#39;ll add this into the answer."}, {"owner": {"reputation": 2282, "user_id": 1035792, "user_type": "registered", "accept_rate": 81, "profile_image": "https://i.stack.imgur.com/cQjEY.png?s=128&g=1", "display_name": "gsscoder", "link": "https://stackoverflow.com/users/1035792/gsscoder"}, "edited": false, "score": 0, "creation_date": 1442767017, "post_id": 32681635, "comment_id": 53207969, "body": "Yes now I see, removing constraint it works; but I think that <code>DeriveFunctor</code> is a simplier path."}, {"owner": {"reputation": 11366, "user_id": 3922954, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/76ba47d2fdd24ab56b0b273cce2075e5?s=128&d=identicon&r=PG&f=1", "display_name": "AJF", "link": "https://stackoverflow.com/users/3922954/ajf"}, "reply_to_user": {"reputation": 2282, "user_id": 1035792, "user_type": "registered", "accept_rate": 81, "profile_image": "https://i.stack.imgur.com/cQjEY.png?s=128&g=1", "display_name": "gsscoder", "link": "https://stackoverflow.com/users/1035792/gsscoder"}, "edited": false, "score": 1, "creation_date": 1442767147, "post_id": 32681635, "comment_id": 53208007, "body": "@gsscoder Certainly, but I would recommend working with typeclasses, at least as an exercise for the future."}, {"owner": {"reputation": 2282, "user_id": 1035792, "user_type": "registered", "accept_rate": 81, "profile_image": "https://i.stack.imgur.com/cQjEY.png?s=128&g=1", "display_name": "gsscoder", "link": "https://stackoverflow.com/users/1035792/gsscoder"}, "edited": false, "score": 0, "creation_date": 1442767463, "post_id": 32681635, "comment_id": 53208131, "body": "excellent suggestion. After all HKT is what make Haskell type system different from most functional languages."}, {"owner": {"reputation": 44013, "user_id": 1477667, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/trgKM.jpg?s=128&g=1", "display_name": "dfeuer", "link": "https://stackoverflow.com/users/1477667/dfeuer"}, "edited": false, "score": 1, "creation_date": 1442770563, "post_id": 32681635, "comment_id": 53209081, "body": "Is this really a datatype context? The position looks more like an existential. Aren&#39;t datatype contexts further to the left?"}, {"owner": {"reputation": 11366, "user_id": 3922954, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/76ba47d2fdd24ab56b0b273cce2075e5?s=128&d=identicon&r=PG&f=1", "display_name": "AJF", "link": "https://stackoverflow.com/users/3922954/ajf"}, "reply_to_user": {"reputation": 44013, "user_id": 1477667, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/trgKM.jpg?s=128&g=1", "display_name": "dfeuer", "link": "https://stackoverflow.com/users/1477667/dfeuer"}, "edited": false, "score": 0, "creation_date": 1442775216, "post_id": 32681635, "comment_id": 53210710, "body": "@dfeuer You might be right. I&#39;m certainly not so sure myself, though this works for the explanation."}], "tags": [], "owner": {"reputation": 11366, "user_id": 3922954, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/76ba47d2fdd24ab56b0b273cce2075e5?s=128&d=identicon&r=PG&f=1", "display_name": "AJF", "link": "https://stackoverflow.com/users/3922954/ajf"}, "is_accepted": true, "score": 8, "last_activity_date": 1500816138, "last_edit_date": 1500816138, "creation_date": 1442766249, "answer_id": 32681635, "question_id": 32681585, "link": "https://stackoverflow.com/questions/32681585/implementing-functor-for-a-parametric-type/32681635#32681635", "title": "Implementing Functor for a parametric type", "body": "<p>Your <code>Functor</code> instance shouldn't have a type argument:</p>\n\n<pre><code>instance Functor Rgb where\n  fmap f (Rgb r g b) = Rgb (f r) (f g) (f b)\n</code></pre>\n\n<p>If you want to derive instances, including <code>Functor</code>, use the <code>DeriveFunctor</code> pragma:</p>\n\n<pre><code>{-# LANGUAGE DeriveFunctor #-}\n\ndata Rgb a = Rgb a a a                   -- NOTE: DO NOT CONSTRAIN DATA!\n    deriving (Show, Eq, Ord, Functor)\n</code></pre>\n\n<p>Also, type constraints on a datatype declarations are almost always useless. Constrain the <em>functions</em> that need those constraints.</p>\n\n<hr>\n\n<p>The problem you've discovered is due to the type of types: <em>kinds</em>. We write kinds with <code>*</code>, and the <code>:kind</code> command in GHCi can help:</p>\n\n<pre><code>\u03bb&gt; :kind Int\nInt :: *\n\u03bb&gt; :kind Char\nChar :: *\n\u03bb&gt; :kind Maybe Int\nMaybe Int :: *\n</code></pre>\n\n<p>All <code>Functor</code>s take a type argument, so they all look like this:</p>\n\n<pre><code>\u03bb&gt; :kind Maybe\nMaybe :: * -&gt; *\n\u03bb&gt; :kind IO\nIO :: * -&gt; *\n</code></pre>\n\n<p><code>RGB</code> is of kind <code>* -&gt; *</code>, but when you write <code>RGB a</code>, you apply <code>a :: *</code> to it, it becomes <code>RGB a :: *</code>, which doesn't make sense to the compiler.</p>\n\n<p>This should now make sense to you:</p>\n\n<pre><code>The first argument of \u2018Functor\u2019 should have kind \u2018* &gt; *\u2019,\n  but \u2018Rgb a\u2019 has kind \u2018*\u2019\n</code></pre>\n\n<hr>\n\n<p>The reason it failed before when you tried to implement the functor instance is because of these constraints on your datatype:</p>\n\n<pre><code>-- Do not do this. This is poor Haskell.\ndata Rgb a = (Num a, Show a) =&gt; Rgb a a a\n</code></pre>\n\n<p>You should have written:</p>\n\n<pre><code>data Rgb a = Rgb a a a\n</code></pre>\n\n<p>And then added constraints on each instance:</p>\n\n<pre><code>instance (Show a) =&gt; Show (RGB a) where\n    ...\n\ninstance (Num a) =&gt; Num (RGB a) where\n    ...\n</code></pre>\n\n<p>And then your functor instance would have been fine.</p>\n"}], "owner": {"reputation": 2282, "user_id": 1035792, "user_type": "registered", "accept_rate": 81, "profile_image": "https://i.stack.imgur.com/cQjEY.png?s=128&g=1", "display_name": "gsscoder", "link": "https://stackoverflow.com/users/1035792/gsscoder"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 368, "favorite_count": 0, "accepted_answer_id": 32681635, "answer_count": 1, "score": 2, "last_activity_date": 1500816138, "creation_date": 1442765921, "last_edit_date": 1442766053, "question_id": 32681585, "link": "https://stackoverflow.com/questions/32681585/implementing-functor-for-a-parametric-type", "title": "Implementing Functor for a parametric type", "body": "<p>Having this type:</p>\n\n<pre><code>{-# LANGUAGE GADTs #-}\n\ndata Rgb a = (Num a, Show a) =&gt; Rgb a a a\n</code></pre>\n\n<p>I'm perfectly able to implement <code>Show</code> typeclass:</p>\n\n<pre><code>instance Show (Rgb a) where\n  show (Rgb r g b) = \"Rgb (\" ++ show r ++ \",\" ++ show g ++ \",\" ++ show b ++ \")\"\n</code></pre>\n\n<p>But if I try to do the same with <code>Functor</code>:</p>\n\n<pre><code>instance Functor (Rgb a) where\n  fmap f (Rgb r g b) = Rgb (f r) (f g) (f b)\n</code></pre>\n\n<p>I got the following output on <strong>GHCi</strong> REPL:</p>\n\n<pre><code>&lt;interactive&gt;;:1093:19:\n  The first argument of \u2018Functor\u2019 should have kind \u2018* &gt; *\u2019,\n    but \u2018Rgb a\u2019 has kind \u2018*\u2019\n  In the instance declaration for \u2018Functor (Rgb a)\u2019\n</code></pre>\n\n<p>I will certainly be happy with solution and explanation, but also a link to deepen theory tied to this question.</p>\n\n<p>To overcome this problem I've (temporarly) wrote this function:</p>\n\n<pre><code>mapRgb :: (Num a, Num b, Show a, Show b) =&gt; (a -&gt; b) -&gt; Rgb a -&gt; Rgb b\nmapRgb f (Rgb r g b) = Rgb (f r) (f g) (f b)\n</code></pre>\n\n<p>But I really prefer have <code>fmap</code> implemented for <code>Rgb</code> type.</p>\n"}, {"tags": ["haskell", "functor", "algebraic-data-types", "bifunctor"], "comments": [{"owner": {"reputation": 28873, "user_id": 1068232, "user_type": "registered", "accept_rate": 79, "profile_image": "https://www.gravatar.com/avatar/2a0a145ce58c20013969fe3f203531da?s=128&d=identicon&r=PG", "display_name": "Andr&#225;s Kov&#225;cs", "link": "https://stackoverflow.com/users/1068232/andr%c3%a1s-kov%c3%a1cs"}, "edited": false, "score": 2, "creation_date": 1442761880, "post_id": 32680771, "comment_id": 53206241, "body": "You can&#39;t declare them <code>Functor</code>, because there are already instances for <code>(,)</code> and <code>Either</code>. If you instead use <code>newtype</code>, the instances are derivable using <a href=\"https://downloads.haskell.org/~ghc/latest/docs/html/users_guide/deriving.html#newtype-deriving\" rel=\"nofollow noreferrer\"><code>GeneralizedNewtypeDeriving</code></a>."}, {"owner": {"reputation": 51584, "user_id": 839246, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/9b0573c2b936b12828dd1e4cc04206dc?s=128&d=identicon&r=PG&f=1", "display_name": "bheklilr", "link": "https://stackoverflow.com/users/839246/bheklilr"}, "edited": false, "score": 0, "creation_date": 1442762012, "post_id": 32680771, "comment_id": 53206293, "body": "You can use <code>fmap fmap fmap</code> to map a function over the inner Functor."}], "answers": [{"comments": [{"owner": {"reputation": 27351, "user_id": 559827, "user_type": "registered", "accept_rate": 72, "profile_image": "https://www.gravatar.com/avatar/4aa6db921795b84b986eb4aac8ffd569?s=128&d=identicon&r=PG", "display_name": "kjo", "link": "https://stackoverflow.com/users/559827/kjo"}, "edited": false, "score": 0, "creation_date": 1442762732, "post_id": 32680903, "comment_id": 53206517, "body": "Thanks!  BTW, sorry for the invalid Haskell.  I took the code I posted from an exposition of category theory that uses Haskell for many examples, but the author does not always make clear when he&#39;s actually a Haskell-like-looking pseudo-code instead of bona fide Haskell.  I&#39;ll know better next time."}, {"owner": {"reputation": 17809, "user_id": 1088108, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/63781cd38e91aa346a3849bc3ef3e550?s=128&d=identicon&r=PG&f=1", "display_name": "&#216;rjan Johansen", "link": "https://stackoverflow.com/users/1088108/%c3%98rjan-johansen"}, "reply_to_user": {"reputation": 27351, "user_id": 559827, "user_type": "registered", "accept_rate": 72, "profile_image": "https://www.gravatar.com/avatar/4aa6db921795b84b986eb4aac8ffd569?s=128&d=identicon&r=PG", "display_name": "kjo", "link": "https://stackoverflow.com/users/559827/kjo"}, "edited": false, "score": 0, "creation_date": 1442762863, "post_id": 32680903, "comment_id": 53206576, "body": "@kjo Your code with <code>type</code> was actually fine Haskell, it just doesn&#39;t work to add instances to those."}, {"owner": {"reputation": 27351, "user_id": 559827, "user_type": "registered", "accept_rate": 72, "profile_image": "https://www.gravatar.com/avatar/4aa6db921795b84b986eb4aac8ffd569?s=128&d=identicon&r=PG", "display_name": "kjo", "link": "https://stackoverflow.com/users/559827/kjo"}, "edited": false, "score": 0, "creation_date": 1442762939, "post_id": 32680903, "comment_id": 53206603, "body": "Ah!  I see.  Thanks for the clarification."}], "tags": [], "owner": {"reputation": 17809, "user_id": 1088108, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/63781cd38e91aa346a3849bc3ef3e550?s=128&d=identicon&r=PG&f=1", "display_name": "&#216;rjan Johansen", "link": "https://stackoverflow.com/users/1088108/%c3%98rjan-johansen"}, "is_accepted": true, "score": 6, "last_activity_date": 1442762563, "last_edit_date": 1442762563, "creation_date": 1442762039, "answer_id": 32680903, "question_id": 32680771, "link": "https://stackoverflow.com/questions/32680771/on-inferring-fmap-for-adts/32680903#32680903", "title": "On inferring fmap for ADTs", "body": "<p>First, you cannot generally define new instances for <code>type</code> synonyms, especially not partially applied ones as you would need in your case. I think you meant to define a <code>newtype</code> or <code>data</code> instead:</p>\n\n<pre><code>newtype MyProductType a = MP (FType1 a, FType2 a)\nnewtype MyCoproductType a = MC (Either (FType1 a) (FType2 a))\n</code></pre>\n\n<p>Standard Haskell says nothing about deriving <code>Functor</code> automatically at all, that is only possible with GHC's <code>DeriveFunctor</code> extension. (Or sometimes <code>GeneralizedNewtypeDeriving</code>, but that doesn't apply in your examples because you're not using <code>a</code> just as the last argument inside the constructor.)</p>\n\n<p>So let's try that:</p>\n\n<pre><code>{-# LANGUAGE DeriveFunctor #-}\ndata FType1 a = FType1 a deriving Functor\ndata FType2 a = FType2 a deriving Functor\nnewtype MyProductType a = MP (FType1 a, FType2 a) deriving Functor\nnewtype MyCoproductType a = MC (Either (FType1 a) (FType2 a)) deriving Functor\n</code></pre>\n\n<p>We get the error message:</p>\n\n<pre><code>Test.hs:6:76:\n    Can't make a derived instance of \u2018Functor MyCoproductType\u2019:\n      Constructor \u2018MC\u2019 must use the type variable only as the last argument of a data type\n    In the newtype declaration for \u2018MyCoproductType\u2019\n</code></pre>\n\n<p>It turns out that GHC can derive the <em>first</em> three, but not the last one.  I believe the third one only works because tuples are special cased. <code>Either</code> doesn't work though, because GHC doesn't keep any special knowledge about how <code>Either</code> treats its <em>first</em> argument. It's nominally a <em>mathematical functor</em> in that argument, but not a <em>Haskell</em> <code>Functor</code>.</p>\n\n<p>Note that GHC is smarter about using variables only as last argument of types known to be <code>Functor</code>s. The following works fine:</p>\n\n<pre><code>newtype MyWrappedType a = MW (Either (FType1 Int) (FType2 (Maybe a))) deriving Functor\n</code></pre>\n\n<p>So to sum up: It depends, GHC has an extension for this but it's not always smart enough to do what you want.</p>\n"}], "owner": {"reputation": 27351, "user_id": 559827, "user_type": "registered", "accept_rate": 72, "profile_image": "https://www.gravatar.com/avatar/4aa6db921795b84b986eb4aac8ffd569?s=128&d=identicon&r=PG", "display_name": "kjo", "link": "https://stackoverflow.com/users/559827/kjo"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 91, "favorite_count": 0, "accepted_answer_id": 32680903, "answer_count": 1, "score": 1, "last_activity_date": 1442764586, "creation_date": 1442761191, "last_edit_date": 1442764586, "question_id": 32680771, "link": "https://stackoverflow.com/questions/32680771/on-inferring-fmap-for-adts", "title": "On inferring fmap for ADTs", "body": "<p>Suppose that two new types are defined like this</p>\n\n<pre><code>type MyProductType a = (FType1 a, FType2 a)\n\ntype MyCoproductType a = Either (FType1 a) (FType2 a)\n</code></pre>\n\n<p>...and that <code>FType1</code> and <code>Ftype2</code> are both instances of <code>Functor</code>.</p>\n\n<p>If one now were to declare <code>MyProductType</code> and <code>MyCoproductType</code> as instances of <code>Functor</code>, would the compiler <em>require</em> explicit definitions for their respective <code>fmap</code>'s, or can it infer these definitions from the previous ones?</p>\n\n<p>Also, is the answer to this question implementation-dependent, or does it follow from the Haskell spec?</p>\n\n<hr>\n\n<p>By way of background, this question was motivated by trying to make sense of a remark in <a href=\"http://bartoszmilewski.com/2015/02/03/functoriality/\" rel=\"nofollow\">something I'm reading</a>.  The author first defines</p>\n\n<pre><code>type Writer a = (a, String)\n</code></pre>\n\n<p>...and later writes (my emphasis)</p>\n\n<blockquote>\n  <p>...the <code>Writer</code> type constructor is functorial in <code>a</code>.  <em>We don't even have to implement <code>fmap</code> for it, because it's just a simple product type.</em></p>\n</blockquote>\n\n<p>The emphasized text is the remark I'm trying to make sense of.  I <em>thought</em> it meant that Haskell could infer <code>fmap</code>'s for <em>any</em> ADT based on functorial types, and, in particular, it could infer the <code>fmap</code> for a \"simple product type\" like <code>Writer</code>, but now I think this interpretation is not right (at least if I'm reading \u00d8rjan Johansen's answer correctly).</p>\n\n<p>As for what the author meant by that sentence, now I really have no clue.  Maybe all he meant is that it's not worth the trouble to re-define <code>Writer</code> in such a way that its functoriality can be made explicit, since it's such a \"simple ... type\".  (Grasping at straws here.)</p>\n"}, {"tags": ["haskell", "aws-lambda"], "comments": [{"owner": {"reputation": 2387, "user_id": 54024, "user_type": "registered", "accept_rate": 36, "profile_image": "https://www.gravatar.com/avatar/5b42865e660a167f7021ba5ff2d9b8c9?s=128&d=identicon&r=PG", "display_name": "Chad Brewbaker", "link": "https://stackoverflow.com/users/54024/chad-brewbaker"}, "edited": false, "score": 0, "creation_date": 1442758947, "post_id": 32680393, "comment_id": 53205293, "body": "My best stab so far is to use the C++ template abuse solution and FFI to it. Complete hack, I would rather do this all in Hask."}, {"owner": {"reputation": 51584, "user_id": 839246, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/9b0573c2b936b12828dd1e4cc04206dc?s=128&d=identicon&r=PG&f=1", "display_name": "bheklilr", "link": "https://stackoverflow.com/users/839246/bheklilr"}, "edited": false, "score": 0, "creation_date": 1442759409, "post_id": 32680393, "comment_id": 53205445, "body": "I don&#39;t believe this is really possible, since even if you have access to the constructors of a type you have to deal with lazy evaluation.  If I put a list literal in a source file and load it into GHCi, <code>:sprint</code> shows that it hasn&#39;t been evaluated yet.  The data is still stored in the binary, but the structure itself hasn&#39;t been &quot;put together&quot; yet."}, {"owner": {"reputation": 2221, "user_id": 448591, "user_type": "registered", "accept_rate": 93, "profile_image": "https://www.gravatar.com/avatar/5520f21f2e367d78c29d08d3b30b954f?s=128&d=identicon&r=PG", "display_name": "Jakob Runge", "link": "https://stackoverflow.com/users/448591/jakob-runge"}, "edited": false, "score": 1, "creation_date": 1442760229, "post_id": 32680393, "comment_id": 53205656, "body": "I think it should be possible to achieve this with template-haskell."}, {"owner": {"reputation": 44013, "user_id": 1477667, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/trgKM.jpg?s=128&g=1", "display_name": "dfeuer", "link": "https://stackoverflow.com/users/1477667/dfeuer"}, "edited": false, "score": 0, "creation_date": 1442760429, "post_id": 32680393, "comment_id": 53205718, "body": "There are some tricks you can play if you want unboxed vectors, where you use the fact that string literals are actually C strings. I don&#39;t remember the trick exactly, but I think it involves <code>Addr#</code> or some such. If you want anything with pointers in it, you&#39;re going to have much more trouble because of the linker and such, and at that point you should probably give up."}, {"owner": {"reputation": 44013, "user_id": 1477667, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/trgKM.jpg?s=128&g=1", "display_name": "dfeuer", "link": "https://stackoverflow.com/users/1477667/dfeuer"}, "edited": false, "score": 2, "creation_date": 1442760527, "post_id": 32680393, "comment_id": 53205755, "body": "BTW, &quot;Hask&quot; is normally not used as shorthand for the name Haskell, but rather as the name of the mathematical almost-category of Haskell types and functions."}, {"owner": {"reputation": 11366, "user_id": 3922954, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/76ba47d2fdd24ab56b0b273cce2075e5?s=128&d=identicon&r=PG&f=1", "display_name": "AJF", "link": "https://stackoverflow.com/users/3922954/ajf"}, "edited": false, "score": 1, "creation_date": 1442768005, "post_id": 32680393, "comment_id": 53208298, "body": "Can you be more specific about your problem? I could write a satisfactory answer if you showed me what exactly you needed doing."}, {"owner": {"reputation": 2387, "user_id": 54024, "user_type": "registered", "accept_rate": 36, "profile_image": "https://www.gravatar.com/avatar/5b42865e660a167f7021ba5ff2d9b8c9?s=128&d=identicon&r=PG", "display_name": "Chad Brewbaker", "link": "https://stackoverflow.com/users/54024/chad-brewbaker"}, "edited": false, "score": 0, "creation_date": 1442979279, "post_id": 32680393, "comment_id": 53302916, "body": "Key value pair hash map. Keys could be either 64 bit ints or small strings."}], "owner": {"reputation": 2387, "user_id": 54024, "user_type": "registered", "accept_rate": 36, "profile_image": "https://www.gravatar.com/avatar/5b42865e660a167f7021ba5ff2d9b8c9?s=128&d=identicon&r=PG", "display_name": "Chad Brewbaker", "link": "https://stackoverflow.com/users/54024/chad-brewbaker"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 173, "favorite_count": 1, "answer_count": 0, "score": 8, "last_activity_date": 1442772067, "creation_date": 1442758758, "last_edit_date": 1495542577, "question_id": 32680393, "link": "https://stackoverflow.com/questions/32680393/compile-time-population-of-data-structures-in-haskell", "title": "Compile time population of data structures in Haskell?", "body": "<p>The use case is an AWS Lambda function I want some data pre-loaded into it at compile time. How does one go about pre-populating data structures at compile time in Haskell? Analogous <a href=\"https://stackoverflow.com/questions/15490498/compile-time-population-of-data-structures-other-than-arrays\">C++ discussion</a>.</p>\n"}, {"tags": ["list", "haskell", "filter"], "comments": [{"owner": {"reputation": 24266, "user_id": 946226, "user_type": "registered", "accept_rate": 59, "profile_image": "https://www.gravatar.com/avatar/5823d09208b1e4b63bbfcd189492032c?s=128&d=identicon&r=PG", "display_name": "Joachim Breitner", "link": "https://stackoverflow.com/users/946226/joachim-breitner"}, "edited": false, "score": 0, "creation_date": 1442752330, "post_id": 32679436, "comment_id": 53203330, "body": "You say <code>the Int</code> \u2013 but with Int?"}, {"owner": {"reputation": 73, "user_id": 5355979, "user_type": "registered", "accept_rate": 40, "profile_image": "https://lh4.googleusercontent.com/-C48LDiHIcMg/AAAAAAAAAAI/AAAAAAAAABY/DLBILPMP7Zo/photo.jpg?sz=128", "display_name": "tbpotn", "link": "https://stackoverflow.com/users/5355979/tbpotn"}, "reply_to_user": {"reputation": 24266, "user_id": 946226, "user_type": "registered", "accept_rate": 59, "profile_image": "https://www.gravatar.com/avatar/5823d09208b1e4b63bbfcd189492032c?s=128&d=identicon&r=PG", "display_name": "Joachim Breitner", "link": "https://stackoverflow.com/users/946226/joachim-breitner"}, "edited": false, "score": 0, "creation_date": 1442752492, "post_id": 32679436, "comment_id": 53203367, "body": "I&#39;m not sure I understand your question"}, {"owner": {"reputation": 44013, "user_id": 1477667, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/trgKM.jpg?s=128&g=1", "display_name": "dfeuer", "link": "https://stackoverflow.com/users/1477667/dfeuer"}, "edited": false, "score": 0, "creation_date": 1442772777, "post_id": 32679436, "comment_id": 53209928, "body": "It&#39;s often best to start by using explicit lambdas to make sure every function and operator is fully applied, then, if you wish, working to remove them one at a time."}], "answers": [{"comments": [{"owner": {"reputation": 73, "user_id": 5355979, "user_type": "registered", "accept_rate": 40, "profile_image": "https://lh4.googleusercontent.com/-C48LDiHIcMg/AAAAAAAAAAI/AAAAAAAAABY/DLBILPMP7Zo/photo.jpg?sz=128", "display_name": "tbpotn", "link": "https://stackoverflow.com/users/5355979/tbpotn"}, "edited": false, "score": 0, "creation_date": 1442753029, "post_id": 32679498, "comment_id": 53203500, "body": "This works indeed. Glad to see my idea was correct, but it was my formulation that was lacking."}, {"owner": {"reputation": 11366, "user_id": 3922954, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/76ba47d2fdd24ab56b0b273cce2075e5?s=128&d=identicon&r=PG&f=1", "display_name": "AJF", "link": "https://stackoverflow.com/users/3922954/ajf"}, "reply_to_user": {"reputation": 73, "user_id": 5355979, "user_type": "registered", "accept_rate": 40, "profile_image": "https://lh4.googleusercontent.com/-C48LDiHIcMg/AAAAAAAAAAI/AAAAAAAAABY/DLBILPMP7Zo/photo.jpg?sz=128", "display_name": "tbpotn", "link": "https://stackoverflow.com/users/5355979/tbpotn"}, "edited": false, "score": 0, "creation_date": 1442767335, "post_id": 32679498, "comment_id": 53208077, "body": "@tbpotn  I would recommend reading up on <a href=\"https://wiki.haskell.org/Pointfree\" rel=\"nofollow noreferrer\">pointfree style</a>, to avoid future problems such as this."}], "tags": [], "owner": {"reputation": 78982, "user_id": 1848654, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/84180c0f3c9c04f8b8f0613fc0129dac?s=128&d=identicon&r=PG", "display_name": "melpomene", "link": "https://stackoverflow.com/users/1848654/melpomene"}, "is_accepted": false, "score": 3, "last_activity_date": 1442752635, "creation_date": 1442752635, "answer_id": 32679498, "question_id": 32679436, "link": "https://stackoverflow.com/questions/32679436/filtering-a-list-of-lists-in-haskell/32679498#32679498", "title": "Filtering a list of lists in Haskell", "body": "<p><code>(!! (== value))</code> is invalid because the right operand of <code>!!</code> must be an <code>Int</code>. <code>(== value)</code> is a function.</p>\n\n<p>Your options are</p>\n\n<pre><code>\\n -&gt; filter (\\xs -&gt; xs !! n == value) rows\n</code></pre>\n\n<p>or without the explicit lambda</p>\n\n<pre><code>\\n -&gt; filter ((== value) . (!! n)) rows\n</code></pre>\n"}], "owner": {"reputation": 73, "user_id": 5355979, "user_type": "registered", "accept_rate": 40, "profile_image": "https://lh4.googleusercontent.com/-C48LDiHIcMg/AAAAAAAAAAI/AAAAAAAAABY/DLBILPMP7Zo/photo.jpg?sz=128", "display_name": "tbpotn", "link": "https://stackoverflow.com/users/5355979/tbpotn"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 947, "favorite_count": 0, "answer_count": 1, "score": 0, "last_activity_date": 1442752635, "creation_date": 1442752259, "last_edit_date": 1442752499, "question_id": 32679436, "link": "https://stackoverflow.com/questions/32679436/filtering-a-list-of-lists-in-haskell", "title": "Filtering a list of lists in Haskell", "body": "<p>I want a function <code>Int -&gt; [[String]]</code>, trying to filter out the elements that have a specific value on the Inth spot. I thought I could combine <code>filter</code> and <code>!!</code> but I can't get it to work. So far I have:</p>\n\n<pre><code>filter (!! (== value)) rows\n</code></pre>\n\n<p>where <code>value</code> is a <code>String</code> and <code>rows</code> is a <code>[[String]]</code>. I thought it would take the <code>Int</code> combined with a <code>[String]</code> from <code>rows</code> and check if that particular entry equals <code>value</code> and then keep those rows, but it gets interpreted differently. Any help would be appreciated.</p>\n"}, {"tags": ["list", "haskell", "output"], "comments": [{"owner": {"reputation": 34086, "user_id": 787480, "user_type": "registered", "accept_rate": 69, "profile_image": "https://i.stack.imgur.com/91cDR.png?s=128&g=1", "display_name": "Sneftel", "link": "https://stackoverflow.com/users/787480/sneftel"}, "edited": false, "score": 4, "creation_date": 1442750869, "post_id": 32679115, "comment_id": 53202939, "body": "Put your code in the question, not in a link. See <a href=\"http://stackoverflow.com/help/mcve\">stackoverflow.com/help/mcve</a> ."}], "answers": [{"tags": [], "owner": {"reputation": 49959, "user_id": 866915, "user_type": "registered", "accept_rate": 70, "profile_image": "https://www.gravatar.com/avatar/09242131d6e17cbbe31e8547514da6e5?s=128&d=identicon&r=PG", "display_name": "ErikR", "link": "https://stackoverflow.com/users/866915/erikr"}, "is_accepted": false, "score": 1, "last_activity_date": 1442756371, "creation_date": 1442756371, "answer_id": 32680036, "question_id": 32679115, "link": "https://stackoverflow.com/questions/32679115/i-am-unable-to-get-output-with-this-uni-exercise-all-functions-individually-wor/32680036#32680036", "title": "I am unable to get output with this uni exercise, all functions individually work but together give empty output", "body": "<p>This doesn't look right:</p>\n\n<pre><code>select :: Field -&gt; Field -&gt; Table -&gt; Table\nselect _ _ [] = []\nselect column _ table = table\nselect column value table@(header:rows)\n    = maybe table (\\x -&gt; filter (\\y -&gt; (!!) y x == value) rows) (elemIndex column header)\n...\n</code></pre>\n\n<p>The result of <code>select x y table</code> will <em>always</em> be <code>table</code> - i.e. it always returns the entire table.</p>\n\n<p>Besides, if you run <code>ghc -Wall program.hs</code> you'll get this morning:</p>\n\n<pre><code>db.hs:108:1: Warning:\n    Pattern match(es) are overlapped\n    In an equation for \u2018select\u2019:\n        select column value table@(header : rows) = ...\n</code></pre>\n\n<p>which basically says that the last clause for <code>select</code> will never be used.</p>\n"}], "owner": {"reputation": 29, "user_id": 4367208, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/79eb74985e0237fea106c148b773c8e7?s=128&d=identicon&r=PG&f=1", "display_name": "PhantomDot1", "link": "https://stackoverflow.com/users/4367208/phantomdot1"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 117, "favorite_count": 0, "answer_count": 1, "score": -2, "last_activity_date": 1442756371, "creation_date": 1442750288, "question_id": 32679115, "link": "https://stackoverflow.com/questions/32679115/i-am-unable-to-get-output-with-this-uni-exercise-all-functions-individually-wor", "title": "I am unable to get output with this uni exercise, all functions individually work but together give empty output", "body": "<p>So, I have this uni exercise, which works all fine, untill I hand it in through domjudge. Then I get a run error on run 1, 3 and 4, while run 2 works fine. The error info says it has to do with a non exhaustive pattern in function printTable : []</p>\n\n<p>But when I add in printTable [] = [] in an attempt to fix it, runs 1, 3 and 4 have no output, probably due to going through the function with the above rule.</p>\n\n<p>I know you guys don't have much information on the runs, but what I find so weird is that in run 2 it is fine, while having problems in all other runs. Help me please ?</p>\n\n<p>Code: <a href=\"http://pastebin.com/gAyWWQJJ\" rel=\"nofollow\">http://pastebin.com/gAyWWQJJ</a></p>\n\n<p>EDIT: Some more information on the input and output:</p>\n\n<p>in and output: <a href=\"http://pastebin.com/TLJ5MfjL\" rel=\"nofollow\">http://pastebin.com/TLJ5MfjL</a></p>\n\n<p>gotten output:\n[]</p>\n\n<p>yes, an empty list.</p>\n\n<p>as you might have seen in the code, it maps words to the [String] it reads from this, so you get [[String]]. then Field = String, Row = [Field] and Table = [Row] = [[Field]] - [[String]].</p>\n\n<p>The input for run 2 should be similar to the one of run 1, but for some reason which I cannot for the love of god find out, run 2 works fine and run 1 doesn't.</p>\n\n<p>I hope to have supplied enough information, because this is really all I have.</p>\n"}, {"tags": ["haskell", "jpeg", "exif"], "answers": [{"comments": [{"owner": {"reputation": 3, "user_id": 5355751, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/js4Ey.jpg?s=128&g=1", "display_name": "Nokeya", "link": "https://stackoverflow.com/users/5355751/nokeya"}, "edited": false, "score": 0, "creation_date": 1442750001, "post_id": 32678648, "comment_id": 53202701, "body": "Tried to wrap into the function <code>getTimeDigitized image = do     img &lt;- parseFileExif image     case img of         Right value -&gt; return $ lookup dateTimeDigitized value         Left msg -&gt; return Nothing</code> and now getting <code>Couldn&#39;t match expected type </code>[(ExifTag, b0)]&#39;                 with actual type <code>containers-0.5.0.0:Data.Map.Base.Map                                     ExifTag ExifValue&#39;     In the second argument of </code>lookup&#39;, namely <code>value&#39;     In the second argument of </code>($)&#39;, namely       <code>lookup dateTimeDigitized value&#39;     In the expression: return $ lookup dateTimeDigitized value</code>"}, {"owner": {"reputation": 84731, "user_id": 510937, "user_type": "registered", "accept_rate": 80, "profile_image": "https://www.gravatar.com/avatar/70b13a9ae1aae1ca1aa6ac8dab4643f2?s=128&d=identicon&r=PG", "display_name": "Bakuriu", "link": "https://stackoverflow.com/users/510937/bakuriu"}, "reply_to_user": {"reputation": 3, "user_id": 5355751, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/js4Ey.jpg?s=128&g=1", "display_name": "Nokeya", "link": "https://stackoverflow.com/users/5355751/nokeya"}, "edited": false, "score": 0, "creation_date": 1442752443, "post_id": 32678648, "comment_id": 53203354, "body": "@Nokeya Please add the code you used and the error message to the question. They are pretty much unreadable in a comment. Anyway I believe the issue is that you are using the wrong lookup. You probably have to use this <a href=\"https://hackage.haskell.org/package/containers-0.5.6.3/docs/Data-Map-Lazy.html#v:lookup\" rel=\"nofollow noreferrer\"><code>lookup</code></a> which is defined for <code>Map</code>s."}], "tags": [], "owner": {"reputation": 84731, "user_id": 510937, "user_type": "registered", "accept_rate": 80, "profile_image": "https://www.gravatar.com/avatar/70b13a9ae1aae1ca1aa6ac8dab4643f2?s=128&d=identicon&r=PG", "display_name": "Bakuriu", "link": "https://stackoverflow.com/users/510937/bakuriu"}, "is_accepted": true, "score": 1, "last_activity_date": 1442752596, "last_edit_date": 1442752596, "creation_date": 1442747177, "answer_id": 32678648, "question_id": 32678426, "link": "https://stackoverflow.com/questions/32678426/get-specific-exif-tag-from-hsexif-parsefileexif/32678648#32678648", "title": "Get specific EXIF tag from HsExif.parseFileExif", "body": "<p>The error is pretty simple:</p>\n\n<pre class=\"lang-none prettyprint-override\"><code>Couldn't match expected type `[(ExifTag, b0)]'\n            with actual type `Either\n                                String (containers-0.5.0.0:Data.Map.Base.Map ExifTag ExifValue)'\nIn the second argument of `lookup', namely `img'\n</code></pre>\n\n<p>This is telling you: the <code>lookup</code> function wants a value of type <code>[(ExifTag, b0)]</code> as second argument but you gave <code>Either String (...Map ExifTag ExifValue)</code>.</p>\n\n<p>In fact the value returned by <code>parseFileExif</code> is <strong>not</strong> the list on which you can call <code>lookup</code>. It's an <code>Either String (...Map ExifTag ExifValue)</code>.\nAlso note that the documentation doesn't say that you can use <code>lookup</code> on the return value of <code>parseFileExif</code>. Only that you can use <code>lookup</code> in some way (which is obvious if you know what <a href=\"http://hackage.haskell.org/package/base-4.8.1.0/docs/Prelude.html#t:Either\" rel=\"nofollow\"><code>Either</code></a> is) to obtain the field you want.</p>\n\n<p>You have to use a <code>case</code> to extra the <code>Right</code> value. For example:</p>\n\n<pre><code>img &lt;- parseFileExif image\nlet time = case img of\n     Left errorMessage -&gt; ... handle error\n     Right value -&gt; lookup dateTimeDigitized value\n</code></pre>\n\n<p>Note that, although the documentation of the package links to <code>Data.List.lookup</code> they probably mean <code>Data.Map.lookup</code> since the value is a <code>Map</code>.</p>\n\n<p>Moreover note that <code>lookup</code> returns a <code>Maybe a</code>. So you probably want to use the <code>fromMaybe</code> function from <code>Data.Maybe</code>:</p>\n\n<pre><code>img &lt;- parseFileExif image\nlet time = fromMaybe 0 $ case img of\n     Left errorMessage -&gt; ... handle error\n     Right value -&gt; lookup dateTimeDigitized value\n</code></pre>\n\n<p>or the <em>unsafe</em> <code>fromJust</code> function:</p>\n\n<pre><code>img &lt;- parseFileExif image\nlet time = case img of\n     Left errorMessage -&gt; ... handle error\n     Right value -&gt; fromJust $ lookup dateTimeDigitized value\n</code></pre>\n\n<p>(again from the <code>Data.Maybe</code> module).</p>\n\n<p>So the whole program would look like</p>\n\n<pre><code>import Data.Maybe(fromJust)\nimport qualified Data.Map as Map\n\nmain = do\n    img &lt;- parseFileExif image\n    let time = case img of\n            Left _ -&gt; error \"unable to parse data\"\n            Right val -&gt; fromJust $ Map.lookup dateTimeDigitized val\n</code></pre>\n"}], "owner": {"reputation": 3, "user_id": 5355751, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/js4Ey.jpg?s=128&g=1", "display_name": "Nokeya", "link": "https://stackoverflow.com/users/5355751/nokeya"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 49, "favorite_count": 0, "accepted_answer_id": 32678648, "answer_count": 1, "score": 0, "last_activity_date": 1442752596, "creation_date": 1442745809, "last_edit_date": 1442747011, "question_id": 32678426, "link": "https://stackoverflow.com/questions/32678426/get-specific-exif-tag-from-hsexif-parsefileexif", "title": "Get specific EXIF tag from HsExif.parseFileExif", "body": "<p>I'm trying to get a specific tag (e.g. <code>dateTimeDigitized</code>) from <code>HsExif</code>.\n<a href=\"https://hackage.haskell.org/package/hsexif-0.6.0.5/docs/Graphics-HsExif.html\" rel=\"nofollow\">Documentation</a> says I can do it using <a href=\"https://hackage.haskell.org/package/base-4.8.1.0/docs/Data-List.html#v:lookup\" rel=\"nofollow\"><code>lookup</code></a> function.<br>\nTrying this:</p>\n\n<pre><code>img &lt;- parseFileExif image\nlet time = lookup dateTimeDigitized img \n</code></pre>\n\n<p>leads to this error:</p>\n\n<pre><code>Couldn't match expected type `[(ExifTag, b0)]'\n                with actual type `Either\n                                    String (containers-0.5.0.0:Data.Map.Base.Map ExifTag ExifValue)'\n    In the second argument of `lookup', namely `img'\n    In the expression: lookup dateTimeDigitized img\n    In an equation for `time': time = lookup dateTimeDigitized img\n</code></pre>\n\n<p>How can this be fixed?</p>\n"}, {"tags": ["haskell", "dependency-management", "cabal", "cabal-install"], "answers": [{"tags": [], "owner": {"reputation": 49959, "user_id": 866915, "user_type": "registered", "accept_rate": 70, "profile_image": "https://www.gravatar.com/avatar/09242131d6e17cbbe31e8547514da6e5?s=128&d=identicon&r=PG", "display_name": "ErikR", "link": "https://stackoverflow.com/users/866915/erikr"}, "is_accepted": false, "score": 1, "last_activity_date": 1442753782, "last_edit_date": 1442753782, "creation_date": 1442753470, "answer_id": 32679607, "question_id": 32676638, "link": "https://stackoverflow.com/questions/32676638/how-can-i-pin-a-version-of-a-haskell-dependency-to-a-version-of-an-underlying-na/32679607#32679607", "title": "How can I pin a version of a Haskell dependency to a version of an underlying native dependency with Cabal?", "body": "<p>I think the way to do this is with a custom <code>Setup.hs</code> file (specify <code>build-type: Custom</code> in the .cabal file.)</p>\n\n<p>You can override specific stages of the build process by using a <code>main</code> like this:</p>\n\n<pre><code>main = defaultMainWithHooks $ simpleUserHooks { preConf = myPreConf }\n\nmyPreConf :: Args -&gt; ConfigFlags -&gt; IO HookedBuildInfo\nmyPreConf args configFlags = ...\n</code></pre>\n\n<p>It is also likely that overriding the <code>confHook</code> is what you want.</p>\n\n<p>Some links:</p>\n\n<ul>\n<li>all cabal hooks: <a href=\"http://hackage.haskell.org/package/Cabal-1.22.4.0/docs/Distribution-Simple.html#t:UserHooks\" rel=\"nofollow\"><code>data UserHooks</code></a></li>\n<li>standard sets of hooks: <a href=\"http://hackage.haskell.org/package/Cabal-1.22.4.0/docs/Distribution-Simple.html#v:simpleUserHooks\" rel=\"nofollow\">(link)</a></li>\n</ul>\n\n<p>Examples of custom Setup.hs files overriding <code>confHook</code>:</p>\n\n<p><a href=\"https://hackage.haskell.org/package/abcBridge-0.12/src/Setup.hs\" rel=\"nofollow\">abcBridge</a>\n<a href=\"https://hackage.haskell.org/package/arb-fft-0.2.0.2/src/Setup.hs\" rel=\"nofollow\">arb-fft</a>\n<a href=\"https://hackage.haskell.org/package/cabalmdvrpm-0.0.1/src/Setup.hs\" rel=\"nofollow\">cabalmdvrpm</a>\n<a href=\"https://hackage.haskell.org/package/darkplaces-text-0.2.1/src/Setup.hs\" rel=\"nofollow\">darkplaces-text</a>\n<a href=\"https://hackage.haskell.org/package/GLFW-0.5.2.2/src/Setup.hs\" rel=\"nofollow\">GLFW</a>\n<a href=\"https://hackage.haskell.org/package/happybara-webkit-server-0.0.1/src/Setup.hs\" rel=\"nofollow\">happybara-webkit-server</a>\n<a href=\"https://hackage.haskell.org/package/haskeline-0.7.2.1/src/Setup.hs\" rel=\"nofollow\">haskeline</a>\n<a href=\"https://hackage.haskell.org/package/HDBC-postgresql-2.3.2.3/src/Setup.hs\" rel=\"nofollow\">HDBC-postgresql</a>\n<a href=\"https://hackage.haskell.org/package/helics-0.5.1/src/Setup.hs\" rel=\"nofollow\">helics</a>\n<a href=\"https://hackage.haskell.org/package/hlbfgsb-0.0.1.0/src/Setup.hs\" rel=\"nofollow\">hlbfgsb</a>\n<a href=\"https://hackage.haskell.org/package/hlibsass-0.1.3.0/src/Setup.hs\" rel=\"nofollow\">hlibsass</a>\n<a href=\"https://hackage.haskell.org/package/hpqtypes-1.4.2/src/Setup.hs\" rel=\"nofollow\">hpqtypes</a>\n<a href=\"https://hackage.haskell.org/package/hruby-0.3.1.4/src/Setup.hs\" rel=\"nofollow\">hruby</a>\n<a href=\"https://hackage.haskell.org/package/hsqml-0.3.3.0/src/Setup.hs\" rel=\"nofollow\">hsqml</a>\n<a href=\"https://hackage.haskell.org/package/hubris-0.0.3/src/Setup.hs\" rel=\"nofollow\">hubris</a>\n<a href=\"https://hackage.haskell.org/package/illuminate-0.1/src/Setup.hs\" rel=\"nofollow\">illuminate</a>\n<a href=\"https://hackage.haskell.org/package/intel-aes-0.2.1.1/src/Setup.hs\" rel=\"nofollow\">intel-aes</a>\n<a href=\"https://hackage.haskell.org/package/keera-posture-0.1.4.4/src/Setup.hs\" rel=\"nofollow\">keera-posture</a>\n<a href=\"https://hackage.haskell.org/package/KiCS-debugger-0.1.1/src/Setup.hs\" rel=\"nofollow\">KiCS-debugger</a>\n<a href=\"https://hackage.haskell.org/package/libpq-0.4.1/src/Setup.hs\" rel=\"nofollow\">libpq</a>\n<a href=\"https://hackage.haskell.org/package/llvm-general-3.4.5.3/src/Setup.hs\" rel=\"nofollow\">llvm-general</a>\n<a href=\"https://hackage.haskell.org/package/morfeusz-0.4.2/src/Setup.hs\" rel=\"nofollow\">morfeusz</a>\n<a href=\"https://hackage.haskell.org/package/postgresql-libpq-0.9.0.2/src/Setup.hs\" rel=\"nofollow\">postgresql-libpq</a>\n<a href=\"https://hackage.haskell.org/package/tamarin-prover-0.8.6.1/src/Setup.hs\" rel=\"nofollow\">tamarin-prover</a>\n<a href=\"https://hackage.haskell.org/package/tamarin-prover-term-0.8.5.1/src/Setup.hs\" rel=\"nofollow\">tamarin-prover-term</a>\n<a href=\"https://hackage.haskell.org/package/tamarin-prover-theory-0.8.6.0/src/Setup.hs\" rel=\"nofollow\">tamarin-prover-theory</a>\n<a href=\"https://hackage.haskell.org/package/tamarin-prover-utils-0.8.5.1/src/Setup.hs\" rel=\"nofollow\">tamarin-prover-utils</a>\n<a href=\"https://hackage.haskell.org/package/voyeur-0.1.0.1/src/Setup.hs\" rel=\"nofollow\">voyeur</a>\n<a href=\"https://hackage.haskell.org/package/wxc-0.91.0.0/src/Setup.hs\" rel=\"nofollow\">wxc</a>\n<a href=\"https://hackage.haskell.org/package/wxcore-0.91.0.0/src/Setup.hs\" rel=\"nofollow\">wxcore</a></p>\n\n<p>In particular, the <a href=\"https://hackage.haskell.org/package/hruby-0.3.1.4/src/Setup.hs\" rel=\"nofollow\">hruby Setup.hs</a> looks like it is doing something like what you want to do.</p>\n"}, {"tags": [], "owner": {"reputation": 49959, "user_id": 866915, "user_type": "registered", "accept_rate": 70, "profile_image": "https://www.gravatar.com/avatar/09242131d6e17cbbe31e8547514da6e5?s=128&d=identicon&r=PG", "display_name": "ErikR", "link": "https://stackoverflow.com/users/866915/erikr"}, "is_accepted": true, "score": 2, "last_activity_date": 1442763227, "creation_date": 1442763227, "answer_id": 32681101, "question_id": 32676638, "link": "https://stackoverflow.com/questions/32676638/how-can-i-pin-a-version-of-a-haskell-dependency-to-a-version-of-an-underlying-na/32681101#32681101", "title": "How can I pin a version of a Haskell dependency to a version of an underlying native dependency with Cabal?", "body": "<p>I'm submitting another answer because this uses another idea...</p>\n\n<p>Using a custom Setup.hs with <code>defaultMainWithHooksArgs</code> allows you to inspect and modify the args to the <code>cabal configure</code> command.</p>\n\n<p>This is a Setup.hs which does no modification:</p>\n\n<pre><code>import Distribution.Simple\nimport Distribution.Simple.Configure\nimport System.Environment\n\nmain = do\n  args &lt;- getArgs\n  defaultMainWithHooksArgs simpleUserHooks args\n</code></pre>\n\n<p>If your .cabal file has a flag defined, e.g.:</p>\n\n<pre><code>Flag Foo\n  Default:  False\n</code></pre>\n\n<p>then in the args you will see <code>\"--flags=-foo\"</code>. So the idea is:</p>\n\n<ol>\n<li>Define two flags in the .cabal file - <code>use10</code> and <code>use11</code> to select which version of <code>bindings-libzip</code> to use.</li>\n<li>In your custom Setup.hs determine which version to use.</li>\n<li>Find the <code>\"--flags=...\"</code> arg and modify it appropriately before passing it along to <code>defaultMainWithHooksArgs</code>.</li>\n</ol>\n"}], "owner": {"reputation": 3609, "user_id": 2565354, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/590ed3229d95cdcaa05a96028c586165?s=128&d=identicon&r=PG", "display_name": "badcook", "link": "https://stackoverflow.com/users/2565354/badcook"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 188, "favorite_count": 1, "accepted_answer_id": 32681101, "answer_count": 2, "score": 3, "last_activity_date": 1442763227, "creation_date": 1442731637, "question_id": 32676638, "link": "https://stackoverflow.com/questions/32676638/how-can-i-pin-a-version-of-a-haskell-dependency-to-a-version-of-an-underlying-na", "title": "How can I pin a version of a Haskell dependency to a version of an underlying native dependency with Cabal?", "body": "<p>In my particuar case, I have a dependency in my Cabal file on the Haskell package <code>bindings-libzip</code>. In particular, I could accept several different versions of <code>libzip</code>, e.g. <code>bindings-libzip-0.11</code> or <code>bindings-libzip-0.10</code>. These in turn have a dependency on the respective native C <code>libzip</code> libraries versions <code>0.11</code> and <code>0.10</code>.</p>\n\n<p>Therefore I have <code>bindings-libzip &gt;= 0.10 &lt; 0.12</code> in my <code>.cabal</code> file.</p>\n\n<p>The Haskell package <code>bindings-libzip-x</code> specifies with <code>PkgConfig-Depends</code> that <code>libzip</code> version <code>x</code> must be present on a client machine. Let's say a downstream user has version <code>0.10</code> of <code>libzip</code> installed. However, when pulling down my package, this user pulls down the latest dependencies possible and transitively pulls down version <code>0.11</code> of <code>bindings-libzip</code>. This causes the build process to error out with a message about an incorrect version of <code>libzip</code> installed. </p>\n\n<p>Is there any way I can specify in my .cabal file to use <code>bindings-libzip-0.11</code> if and only if <code>pkg-config</code> detects version <code>0.11</code> of <code>libzip</code> and to use <code>bindings-libzip-0.10</code> if and only if <code>pkg-config</code> detects version <code>0.10</code> of <code>libzip</code>?</p>\n"}, {"tags": ["haskell", "equality"], "answers": [{"comments": [{"owner": {"reputation": 37991, "user_id": 409976, "user_type": "registered", "accept_rate": 68, "profile_image": "https://www.gravatar.com/avatar/9ccda0b49cc974197399eae01ebd6850?s=128&d=identicon&r=PG", "display_name": "Kevin Meredith", "link": "https://stackoverflow.com/users/409976/kevin-meredith"}, "edited": false, "score": 0, "creation_date": 1442803418, "post_id": 32675520, "comment_id": 53217639, "body": "Now I&#39;m seeing: <code>Variable \u2018f\u2019 occurs more often than in the instance head  in the constraint: Eq (f (Free f a)). (Use UndecidableInstances to permit this)</code>. OK to add that too?"}, {"owner": {"reputation": 31243, "user_id": 2751851, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/4ddc0.png?s=128&g=1", "display_name": "duplode", "link": "https://stackoverflow.com/users/2751851/duplode"}, "reply_to_user": {"reputation": 37991, "user_id": 409976, "user_type": "registered", "accept_rate": 68, "profile_image": "https://www.gravatar.com/avatar/9ccda0b49cc974197399eae01ebd6850?s=128&d=identicon&r=PG", "display_name": "Kevin Meredith", "link": "https://stackoverflow.com/users/409976/kevin-meredith"}, "edited": false, "score": 0, "creation_date": 1442805383, "post_id": 32675520, "comment_id": 53218019, "body": "@KevinMeredith It is OK too. The worst thing that might happen with UndecidableInstances is compilation failing if you e.g. lead the type checker to an infinite loop, but that won&#39;t happen here. The main nasty extensions that you generally should not turn on even when GHC suggests them are <a href=\"http://stackoverflow.com/q/1064232\">OverlappingInstances</a> and <a href=\"http://stackoverflow.com/q/16050566\">IncoherentInstances</a> -- those two open the doors to nonsense. You did the right thing by asking, BTW: most extensions are harmless, but you should know what they do and whether you need them before enabling."}], "tags": [], "owner": {"reputation": 31243, "user_id": 2751851, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/4ddc0.png?s=128&g=1", "display_name": "duplode", "link": "https://stackoverflow.com/users/2751851/duplode"}, "is_accepted": true, "score": 11, "last_activity_date": 1442720054, "creation_date": 1442720054, "answer_id": 32675520, "question_id": 32675175, "link": "https://stackoverflow.com/questions/32675175/define-equality-instance-for-free-monad/32675520#32675520", "title": "Define Equality Instance for Free Monad", "body": "<p>There is nothing wrong with having a constraint like <code>Eq (f a)</code>. As the error message says, you will need to enable the (harmless) <code>FlexibleContexts</code> GHC extension to do that, so add...</p>\n\n<pre><code>{-# LANGUAGE FlexibleContexts #-}\n</code></pre>\n\n<p>... to the top of your source file.</p>\n\n<p>Do note, however, that <code>(Functor f, Eq (f a))</code> doesn't really reflect what you are doing in your implementation of <code>(==)</code>. Firstly, you don't need the supposition that <code>f</code> is a <code>Functor</code> here, so you can safely drop the <code>Functor f</code> constraint. Secondly, the constraints should match what you need to write the different cases. In the first case, you do <code>x == y</code>. <code>x</code> and <code>y</code> are both of type <code>a</code>, and so you need <code>Eq a</code>. For analogous reasons, the second case requires <code>Eq (f (Free f a))</code> rather than <code>Eq (f a)</code>. That means you will end up with...</p>\n\n<pre><code>(Eq (f (Free f a)), Eq a) =&gt; Eq (Free f a)\n</code></pre>\n\n<p>... which matches reference implementations such as the one in <a href=\"https://hackage.haskell.org/package/free-4.12.1/docs/Control-Monad-Free.html#t:Free\"><code>Control.Monad.Free</code></a>.</p>\n"}, {"tags": [], "owner": {"reputation": 44013, "user_id": 1477667, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/trgKM.jpg?s=128&g=1", "display_name": "dfeuer", "link": "https://stackoverflow.com/users/1477667/dfeuer"}, "is_accepted": false, "score": 2, "last_activity_date": 1442764876, "last_edit_date": 1442764876, "creation_date": 1442759374, "answer_id": 32680476, "question_id": 32675175, "link": "https://stackoverflow.com/questions/32675175/define-equality-instance-for-free-monad/32680476#32680476", "title": "Define Equality Instance for Free Monad", "body": "<p>duplode shows how to do it with flexible contexts. If you want Haskell 2010, the usual approach is to use the <code>Eq1</code> class from <code>Prelude.Extras</code> or similar.</p>\n\n<pre><code>class Eq1 f where\n  (==#) :: Eq a =&gt; f a -&gt; f a -&gt; Bool\n</code></pre>\n\n<p>Then you'd use</p>\n\n<pre><code>instance (Eq1 f, Eq a) =&gt; Eq (Free f a) where ...\ninstance Eq1 f =&gt; Eq1 (Free f) -- default instance is fine.\n</code></pre>\n\n<p>I'm not at my computer right now, so I can't test this until later.</p>\n"}], "owner": {"reputation": 37991, "user_id": 409976, "user_type": "registered", "accept_rate": 68, "profile_image": "https://www.gravatar.com/avatar/9ccda0b49cc974197399eae01ebd6850?s=128&d=identicon&r=PG", "display_name": "Kevin Meredith", "link": "https://stackoverflow.com/users/409976/kevin-meredith"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 236, "favorite_count": 1, "accepted_answer_id": 32675520, "answer_count": 2, "score": 4, "last_activity_date": 1442764876, "creation_date": 1442716490, "question_id": 32675175, "link": "https://stackoverflow.com/questions/32675175/define-equality-instance-for-free-monad", "title": "Define Equality Instance for Free Monad", "body": "<p>Given the <code>Free Monad</code>:</p>\n\n<pre><code>data Free f a = Var a\n               | Node (f (Free f a)) \n</code></pre>\n\n<p>I tried to define an <code>Eq</code> instance for it:</p>\n\n<pre><code>instance (Functor f, Eq (f a)) =&gt; Eq (Free f a) where\n    (==) (Var x) (Var y)       = x == y\n    (==) (Node fu1) (Node fu2) = fu1 == fu2\n    (==) _ _                   = False\n</code></pre>\n\n<p>But that fails to compile:</p>\n\n<pre><code>FreeMonad.hs:17:10:\n    Non type-variable argument in the constraint: Eq (f a)\n    (Use FlexibleContexts to permit this)\n    In the context: (Functor f, Eq (f a))\n    While checking an instance declaration\n    In the instance declaration for \u2018Eq (Free f a)\u2019\nFailed, modules loaded: none.\n</code></pre>\n\n<p>Specifying a constraint/pre-condition of <code>(Functor f, Eq (f a))</code> seems odd to me (at least I don't think that I've seen it as a beginner before).</p>\n\n<p>How can I define an <code>Eq</code> instance for <code>Free f a</code>?</p>\n"}, {"tags": ["haskell", "ghc", "ghc-mod"], "comments": [{"owner": {"reputation": 2313, "user_id": 5276520, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/dbaa9803983597167dbb65d52c24a3da?s=128&d=identicon&r=PG", "display_name": "dkasak", "link": "https://stackoverflow.com/users/5276520/dkasak"}, "edited": false, "score": 3, "creation_date": 1476479215, "post_id": 32674883, "comment_id": 67380120, "body": "This isn&#39;t the observed behaviour for me. Is this still happening for you? Which versions of <code>ghc</code> and <code>ghc-mod</code> are you using?"}, {"owner": {"reputation": 29444, "user_id": 3072788, "user_type": "registered", "accept_rate": 82, "profile_image": "https://www.gravatar.com/avatar/220a45c2fcff7e7358d144551b116205?s=128&d=identicon&r=PG&f=1", "display_name": "Alec", "link": "https://stackoverflow.com/users/3072788/alec"}, "edited": false, "score": 3, "creation_date": 1480855113, "post_id": 32674883, "comment_id": 69126626, "body": "Do you have a self contained example (imports included) that generates output like the above? I think I have an idea what the problem might be, but it is a bit hard to tell only from the output..."}], "answers": [{"tags": [], "owner": {"reputation": 388, "user_id": 893354, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/44587b900c2a3acfc902fc07c35e6822?s=128&d=identicon&r=PG", "display_name": "sergv", "link": "https://stackoverflow.com/users/893354/sergv"}, "is_accepted": false, "score": 0, "last_activity_date": 1495996229, "creation_date": 1495996229, "answer_id": 44230656, "question_id": 32674883, "link": "https://stackoverflow.com/questions/32674883/does-ghc-mod-have-to-use-full-names-for-types/44230656#44230656", "title": "Does GHC-mod have to use full names for types?", "body": "<p>You can try passing <code>-dsuppress-module-prefixes</code> as a GHC option. At some point, it did help me to get rid of module qualifiers in names.</p>\n"}, {"tags": [], "owner": {"reputation": 1630, "user_id": 8030861, "user_type": "registered", "profile_image": "https://lh5.googleusercontent.com/-3kG7Pj-6XvQ/AAAAAAAAAAI/AAAAAAAABJI/52Ip5hpbDvE/photo.jpg?sz=128", "display_name": "Kronos", "link": "https://stackoverflow.com/users/8030861/kronos"}, "is_accepted": false, "score": 1, "last_activity_date": 1505495215, "creation_date": 1505495215, "answer_id": 46244531, "question_id": 32674883, "link": "https://stackoverflow.com/questions/32674883/does-ghc-mod-have-to-use-full-names-for-types/46244531#46244531", "title": "Does GHC-mod have to use full names for types?", "body": "<p>You can pass the argument to ghc from ghc-mod as:</p>\n\n<pre><code>$ ghc-mod lint *.hs -g -dsuppress-module-prefixes\n</code></pre>\n\n<p>This will send the argument <code>-dsuppress-module-prefixes</code> to ghc.</p>\n"}], "owner": {"reputation": 5447, "user_id": 667027, "user_type": "registered", "accept_rate": 60, "profile_image": "https://www.gravatar.com/avatar/2cc242c4ce73c7e429f9f86f262d1844?s=128&d=identicon&r=PG", "display_name": "xzhu", "link": "https://stackoverflow.com/users/667027/xzhu"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 1669, "favorite_count": 4, "answer_count": 2, "score": 143, "last_activity_date": 1505495215, "creation_date": 1442712860, "last_edit_date": 1478464994, "question_id": 32674883, "link": "https://stackoverflow.com/questions/32674883/does-ghc-mod-have-to-use-full-names-for-types", "title": "Does GHC-mod have to use full names for types?", "body": "<p>I'm trying to use the <code>ghc-mod</code> vim plugin to do type/syntax checking etc. However, I found that <code>ghc-mod</code> always uses full paths of types in the error messages, for example:</p>\n\n<pre><code>test.hs|71 col 13 error| Couldn't match type \u2018Data.Text.Internal.Text\u2019                                                                                   \n||                with \u2018[GHC.Types.Char]\u2019\n|| Expected type: containers-0.5.6.2:Data.Map.Base.Map\n||                  [GHC.Types.Char]\n||                  ([(integer-gmp-1.0.0.0:GHC.Integer.Type.Integer,\n||                     integer-gmp-1.0.0.0:GHC.Integer.Type.Integer)],\n||                   containers-0.5.6.2:Data.Set.Base.Set\n||                     integer-gmp-1.0.0.0:GHC.Integer.Type.Integer)\n||   Actual type: containers-0.5.6.2:Data.Map.Base.Map\n||                  Data.Text.Internal.Text\n||                  ([(integer-gmp-1.0.0.0:GHC.Integer.Type.Integer,\n||                     integer-gmp-1.0.0.0:GHC.Integer.Type.Integer)],\n||                   containers-0.5.6.2:Data.Set.Base.Set\n||                     integer-gmp-1.0.0.0:GHC.Integer.Type.Integer)\n|| In the second argument of \u2018containers-0.5.6.2:Data.Map.Base.map\u2019, namely\n||   \u2018zippedMap\u2019\n|| In the second argument of \u2018(GHC.Base.$)\u2019, namely\n||   \u2018containers-0.5.6.2:Data.Map.Base.map\n...\n</code></pre>\n\n<p>which clutters the screen and it's very hard for me to find out where went wrong. As comparison, this is the error message for the same file using <code>ghci</code>:</p>\n\n<pre><code>test.hs:71:13:\n    Couldn't match type \u2018T.Text\u2019 with \u2018[Char]\u2019\n    Expected type: M.Map [Char] ([(Integer, Integer)], S.Set Integer)\n      Actual type: M.Map T.Text ([(Integer, Integer)], S.Set Integer)\n    In the second argument of \u2018M.map\u2019, namely \u2018zippedMap\u2019\n    In the second argument of \u2018($)\u2019, namely\n      \u2018M.map\n...\n</code></pre>\n\n<p>which is much cleaner. Is there a way to make <code>ghc-mod</code> use short names for the types?</p>\n"}, {"tags": ["haskell"], "comments": [{"owner": {"reputation": 51584, "user_id": 839246, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/9b0573c2b936b12828dd1e4cc04206dc?s=128&d=identicon&r=PG&f=1", "display_name": "bheklilr", "link": "https://stackoverflow.com/users/839246/bheklilr"}, "edited": false, "score": 0, "creation_date": 1442698584, "post_id": 32673410, "comment_id": 53192565, "body": "From what I can see you aren&#39;t even using <code>coordenadas</code>, but it seems as if Haskell has inferred that <code>num_col</code> should be a <code>Float</code> rather than an <code>Integer</code>.  Try doing <code>(num_lin, num_col)  = (5, 5) :: (Integer, Integer)</code> and seeing if it gives you a new error."}, {"owner": {"reputation": 2302, "user_id": 2054434, "user_type": "registered", "accept_rate": 51, "profile_image": "https://www.gravatar.com/avatar/e8f5c753d781ce498b857ec9b7ce366f?s=128&d=identicon&r=PG&f=1", "display_name": "PlayHardGoPro", "link": "https://stackoverflow.com/users/2054434/playhardgopro"}, "reply_to_user": {"reputation": 51584, "user_id": 839246, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/9b0573c2b936b12828dd1e4cc04206dc?s=128&d=identicon&r=PG&f=1", "display_name": "bheklilr", "link": "https://stackoverflow.com/users/839246/bheklilr"}, "edited": false, "score": 0, "creation_date": 1442698696, "post_id": 32673410, "comment_id": 53192582, "body": "@bheklilr Yes, now when I try to use <code>num_col</code> it says I can&#39;t use it because it was expecting <code>Float</code> and it&#39;s an <code>Integer</code> ... o.o"}, {"owner": {"reputation": 51584, "user_id": 839246, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/9b0573c2b936b12828dd1e4cc04206dc?s=128&d=identicon&r=PG&f=1", "display_name": "bheklilr", "link": "https://stackoverflow.com/users/839246/bheklilr"}, "edited": false, "score": 0, "creation_date": 1442698785, "post_id": 32673410, "comment_id": 53192609, "body": "@PlayHardGoPro If I assume <code>type Point = (Float, Float)</code> and just set <code>writeRects = undefined</code> since you haven&#39;t given the type for it this code compiles just fine without me adding any type signatures.  I will point out that you have a slight indentation error in your <code>main</code> function, the <code>writeFile</code> function should be indented less so it doesn&#39;t fall under the <code>let</code> bindings."}, {"owner": {"reputation": 2302, "user_id": 2054434, "user_type": "registered", "accept_rate": 51, "profile_image": "https://www.gravatar.com/avatar/e8f5c753d781ce498b857ec9b7ce366f?s=128&d=identicon&r=PG&f=1", "display_name": "PlayHardGoPro", "link": "https://stackoverflow.com/users/2054434/playhardgopro"}, "edited": false, "score": 0, "creation_date": 1442698908, "post_id": 32673410, "comment_id": 53192641, "body": "Just updated with full code guys."}, {"owner": {"reputation": 100185, "user_id": 3234959, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/93bb12ca0f93dfddb33880316f7e66c2?s=128&d=identicon&r=PG&f=1", "display_name": "chi", "link": "https://stackoverflow.com/users/3234959/chi"}, "edited": false, "score": 0, "creation_date": 1442699063, "post_id": 32673410, "comment_id": 53192677, "body": "You are using <code>width</code>/<code>height</code> inside a <code>Rect</code> (<code>writeRects ...</code>), and that requires <code>Float</code>s. But you also use them as <code>Integer</code>s."}, {"owner": {"reputation": 78982, "user_id": 1848654, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/84180c0f3c9c04f8b8f0613fc0129dac?s=128&d=identicon&r=PG", "display_name": "melpomene", "link": "https://stackoverflow.com/users/1848654/melpomene"}, "edited": false, "score": 1, "creation_date": 1442699078, "post_id": 32673410, "comment_id": 53192679, "body": "You need to figure out whether you want <code>num_col</code>, <code>width</code>, etc to be <code>Integer</code> or <code>Float</code>. <code>criaCoordenada</code> requires them to be <code>Integer</code>s, <code>writeRects</code> requires them to be <code>Float</code>s."}], "answers": [{"comments": [{"owner": {"reputation": 2302, "user_id": 2054434, "user_type": "registered", "accept_rate": 51, "profile_image": "https://www.gravatar.com/avatar/e8f5c753d781ce498b857ec9b7ce366f?s=128&d=identicon&r=PG&f=1", "display_name": "PlayHardGoPro", "link": "https://stackoverflow.com/users/2054434/playhardgopro"}, "edited": false, "score": 0, "creation_date": 1442699360, "post_id": 32673532, "comment_id": 53192755, "body": "omg e.e how may I fix that ? I mean, the compiler thinks its a float becuase of a math that I did... WoW. I removed <code>width</code> &amp; <code>height</code> from the calculation and wrote true number value. The error still the same"}, {"owner": {"reputation": 2801, "user_id": 2877058, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/fMUyx.jpg?s=128&g=1", "display_name": "WhiteViking", "link": "https://stackoverflow.com/users/2877058/whiteviking"}, "reply_to_user": {"reputation": 2302, "user_id": 2054434, "user_type": "registered", "accept_rate": 51, "profile_image": "https://www.gravatar.com/avatar/e8f5c753d781ce498b857ec9b7ce366f?s=128&d=identicon&r=PG&f=1", "display_name": "PlayHardGoPro", "link": "https://stackoverflow.com/users/2054434/playhardgopro"}, "edited": false, "score": 1, "creation_date": 1442699890, "post_id": 32673532, "comment_id": 53192910, "body": "Can you try <code>(w, h) = ( (width * num_col), (height * num_col) ) :: (Integer, Integer)</code> and <code>writeFile &quot;colors.svg&quot; $ writeRects (fromInteger w) (fromInteger h) rects</code>? My Haskell is a bit rusty..."}], "tags": [], "owner": {"reputation": 2801, "user_id": 2877058, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/fMUyx.jpg?s=128&g=1", "display_name": "WhiteViking", "link": "https://stackoverflow.com/users/2877058/whiteviking"}, "is_accepted": true, "score": 3, "last_activity_date": 1442699392, "last_edit_date": 1442699392, "creation_date": 1442699089, "answer_id": 32673532, "question_id": 32673410, "link": "https://stackoverflow.com/questions/32673410/cant-match-expected-type/32673532#32673532", "title": "Can&#39;t match expected type", "body": "<p>The compiler inferred <code>w</code> and <code>h</code> to be <code>Float</code> because <code>writeRects</code> says they are. So also <code>width</code>, <code>num_col</code> and <code>height</code> are inferred to be <code>Float</code> because of <code>(w, h) = ( (width * num_col), (height * num_col) )</code>. That results in a type conflict in <code>criaCoordenada(num_col, width, height)</code> because <code>Float</code>s are passed to <code>criaCoordenada</code> which says it expects <code>Integer</code>s.</p>\n"}], "owner": {"reputation": 2302, "user_id": 2054434, "user_type": "registered", "accept_rate": 51, "profile_image": "https://www.gravatar.com/avatar/e8f5c753d781ce498b857ec9b7ce366f?s=128&d=identicon&r=PG&f=1", "display_name": "PlayHardGoPro", "link": "https://stackoverflow.com/users/2054434/playhardgopro"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 77, "favorite_count": 0, "accepted_answer_id": 32673532, "answer_count": 1, "score": 0, "last_activity_date": 1442699392, "creation_date": 1442698074, "last_edit_date": 1442698896, "question_id": 32673410, "link": "https://stackoverflow.com/questions/32673410/cant-match-expected-type", "title": "Can&#39;t match expected type", "body": "<p>On the call of  <code>coordenadas = criaCoordenada(num_col, width, height)</code> I'm getting the error for the 3 variables: </p>\n\n<blockquote>\n<pre><code>Couldn't match expected type `Integer' with actual type `Float'\nIn the expression: num_col\nIn the first argument of `criaCoordenada', namely\n  `(num_col, width, height)'\n</code></pre>\n</blockquote>\n\n<pre><code>type Point = (Float,Float)\ntype Rect = (Point,Float,Float)\n\nwriteRect :: (String,Rect) -&gt; String\nwriteRect (style,((x,y),w,h)) = \n  printf \"&lt;rect x='%.3f' y='%.3f' width='%.2f' height='%.2f' style='%s' /&gt;\\n\" x y w h style\n\n\nwriteRects :: Float -&gt; Float -&gt; [(String,Rect)] -&gt; String \nwriteRects w h rs =  \n  printf \"&lt;svg width='%.3f' height='%.2f' xmlns='http://www.w3.org/2000/svg'&gt;\\n\" w h \n      ++ (concatMap writeRect rs) ++ \"&lt;/svg&gt;\"\n\ncriaPosicoes :: (Integer, Integer) -&gt; [Float]\ncriaPosicoes (num_col, x) = [fromIntegral x | x &lt;-[0,x..(x*num_col)] ]\n\n\ncriaCoordenada :: (Integer, Integer, Integer) -&gt; [Point]\ncriaCoordenada (col, w, h) = \n   let \n      lx = criaPosicoes (col, w)\n      ly = criaPosicoes (col, h)\n   in\n      [(x,y) | y &lt;- ly, x &lt;- lx]\n\n\n\nmain :: IO ()\nmain = do\n   let\n      (num_lin, num_col) = (5, 5) -- N\u00famero de linha / coluna do ret\u00e2ngulo maior.\n      (width, height) = ( 41,19 )   -- Width / Height do ret\u00e2ngulo colorido.\n      (w, h) = ( (width * num_col), (height * num_col) ) -- Width / Height do SVG.\n      coordenadas = criaCoordenada(num_col, width, height) --Error here\n\n\n      style = \"fill:hsl(20, 20%, 30%);stroke:rgb(156,156,139)\"\n      rects = [ (style, ((  0, 0), width, height))\n              , (style, (( 41, 0), width, height))\n              , (style, (( 82, 0), width, height))\n              , (style, ((123, 0), width, height))\n              , (style, ((164, 0), width, height))\n              ]\n\n      writeFile \"colors.svg\" $ writeRects w h rects  \n</code></pre>\n\n<p>I know what the error means but I have no idea why...</p>\n"}, {"tags": ["haskell", "types", "interpreter", "free-monad"], "comments": [{"owner": {"reputation": 13807, "user_id": 2407038, "user_type": "registered", "accept_rate": 64, "profile_image": "https://www.gravatar.com/avatar/538f6f4a9aa43841841de7d8e8b169fc?s=128&d=identicon&r=PG&f=1", "display_name": "user2407038", "link": "https://stackoverflow.com/users/2407038/user2407038"}, "edited": false, "score": 1, "creation_date": 1442703729, "post_id": 32673144, "comment_id": 53193602, "body": "It seems like <code>expect</code> should be a function inside a type class, and the various <code>Prompt</code>, <code>Display</code>, etc, correspond to different type class instances. But it isn&#39;t exactly a good thing to have one identifier be some magic function that does everything, depending on the context - it will make readers of your code very confused."}, {"owner": {"reputation": 1407, "user_id": 4930992, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/108ce448671bef8443fcd64efb3012fa?s=128&d=identicon&r=PG&f=1", "display_name": "Christopher Armstrong", "link": "https://stackoverflow.com/users/4930992/christopher-armstrong"}, "reply_to_user": {"reputation": 13807, "user_id": 2407038, "user_type": "registered", "accept_rate": 64, "profile_image": "https://www.gravatar.com/avatar/538f6f4a9aa43841841de7d8e8b169fc?s=128&d=identicon&r=PG&f=1", "display_name": "user2407038", "link": "https://stackoverflow.com/users/2407038/user2407038"}, "edited": false, "score": 0, "creation_date": 1442706053, "post_id": 32673144, "comment_id": 53194009, "body": "1. you can ignore the <code>expect</code> stuff, it&#39;s not the main part of my question 2. I&#39;m not sure why <code>expect</code> would be in a typeclass, as I&#39;m not sure what multiple instances it would have. 3. I actually do have <code>prompt</code> and <code>display</code> in a typeclass, but it&#39;s for reasons unrelated to this question 4. <code>expect</code> is specifically in the context of testing code -- since it&#39;s specifically a way to write test assertions, I don&#39;t think it will be unclear."}, {"owner": {"reputation": 1407, "user_id": 4930992, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/108ce448671bef8443fcd64efb3012fa?s=128&d=identicon&r=PG&f=1", "display_name": "Christopher Armstrong", "link": "https://stackoverflow.com/users/4930992/christopher-armstrong"}, "reply_to_user": {"reputation": 13807, "user_id": 2407038, "user_type": "registered", "accept_rate": 64, "profile_image": "https://www.gravatar.com/avatar/538f6f4a9aa43841841de7d8e8b169fc?s=128&d=identicon&r=PG&f=1", "display_name": "user2407038", "link": "https://stackoverflow.com/users/2407038/user2407038"}, "edited": false, "score": 0, "creation_date": 1442716318, "post_id": 32673144, "comment_id": 53195721, "body": "update: I&#39;m messing around with the <code>operational</code> package which at least is allowing me to describe my data types in a nice way, and I&#39;m pretty happy about that... it let me basically unify my <code>Intent</code> and <code>DSL</code> data types. I think I might be getting closer."}, {"owner": {"reputation": 2271, "user_id": 4994500, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/233389523330bec1d6e95f4c480d5741?s=128&d=identicon&r=PG&f=1", "display_name": "Sam van Herwaarden", "link": "https://stackoverflow.com/users/4994500/sam-van-herwaarden"}, "edited": false, "score": 1, "creation_date": 1442733376, "post_id": 32673144, "comment_id": 53198647, "body": "You might be interested in <a href=\"http://dlaing.org/cofun/posts/free_and_cofree.html\" rel=\"nofollow noreferrer\">this post</a>, it defines a DSL and an interpreter datatype and pairs these datatypes. I get the impression your main problem is that the second element in your expect tuples is of variable type - if you get around this by wrapping the expected effects in a new datatype (i.e. <code>data ExpEffect = StrEffect ... | VoidEffect ...</code>) I think you can use any kind of list for holding these values as your language is linear."}, {"owner": {"reputation": 1407, "user_id": 4930992, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/108ce448671bef8443fcd64efb3012fa?s=128&d=identicon&r=PG&f=1", "display_name": "Christopher Armstrong", "link": "https://stackoverflow.com/users/4930992/christopher-armstrong"}, "edited": false, "score": 0, "creation_date": 1442767780, "post_id": 32673144, "comment_id": 53208228, "body": "Thanks for the link, Sam. Actually, my problem isn&#39;t just the second value in each tuple -- the first one has a varying type as well (either <code>Intent String</code> or <code>Intent ()</code>, depending on the constructor used). I&#39;ll check out that article to see if I can learn anything."}], "answers": [{"comments": [{"owner": {"reputation": 1407, "user_id": 4930992, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/108ce448671bef8443fcd64efb3012fa?s=128&d=identicon&r=PG&f=1", "display_name": "Christopher Armstrong", "link": "https://stackoverflow.com/users/4930992/christopher-armstrong"}, "edited": false, "score": 0, "creation_date": 1442771552, "post_id": 32682445, "comment_id": 53209464, "body": "I&#39;m working through reading/understanding this answer, but for onlookers who may be confused: I have changed my question to use Control.Monad.Operational <code>MyEffect a</code>, but previously it was using a plain free monad from Control.Monad.Free, <code>Free DSL a</code>, so that&#39;s why Cirdec&#39;s answer is talking about <code>Free DSL a</code>."}, {"owner": {"reputation": 1407, "user_id": 4930992, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/108ce448671bef8443fcd64efb3012fa?s=128&d=identicon&r=PG&f=1", "display_name": "Christopher Armstrong", "link": "https://stackoverflow.com/users/4930992/christopher-armstrong"}, "edited": false, "score": 0, "creation_date": 1442771818, "post_id": 32682445, "comment_id": 53209589, "body": "I&#39;m so excited about your answer, Cirdec! I think I get it -- I was trying to shoehorn my &quot;expect&quot; sequence into a plain data structure when I really should have made it a &quot;program&quot;! So, basically, <code>expect</code> is an ad-hoc test interpreter for a specific program. I&#39;m going to try adapting this to my Operational-based program now."}, {"owner": {"reputation": 1407, "user_id": 4930992, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/108ce448671bef8443fcd64efb3012fa?s=128&d=identicon&r=PG&f=1", "display_name": "Christopher Armstrong", "link": "https://stackoverflow.com/users/4930992/christopher-armstrong"}, "edited": false, "score": 0, "creation_date": 1442772547, "post_id": 32682445, "comment_id": 53209864, "body": "I think you forgot a call to <code>pure&#39; &quot;blacrg&quot;</code> in your <code>expect</code> definition at the end?"}, {"owner": {"reputation": 23444, "user_id": 414413, "user_type": "registered", "accept_rate": 79, "profile_image": "https://www.gravatar.com/avatar/6de2113f01432aa844dc85070ff33e89?s=128&d=identicon&r=PG", "display_name": "Cirdec", "link": "https://stackoverflow.com/users/414413/cirdec"}, "reply_to_user": {"reputation": 1407, "user_id": 4930992, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/108ce448671bef8443fcd64efb3012fa?s=128&d=identicon&r=PG&f=1", "display_name": "Christopher Armstrong", "link": "https://stackoverflow.com/users/4930992/christopher-armstrong"}, "edited": false, "score": 0, "creation_date": 1442773033, "post_id": 32682445, "comment_id": 53209997, "body": "I left it off since it wasn&#39;t part of your <code>expect</code> definition. If you add it, the type of <code>expect</code> changes to <code>expect :: Free DSL String -&gt; Either String ()</code>."}, {"owner": {"reputation": 1407, "user_id": 4930992, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/108ce448671bef8443fcd64efb3012fa?s=128&d=identicon&r=PG&f=1", "display_name": "Christopher Armstrong", "link": "https://stackoverflow.com/users/4930992/christopher-armstrong"}, "edited": false, "score": 0, "creation_date": 1442781237, "post_id": 32682445, "comment_id": 53212733, "body": "Sorry, I realized that I didn&#39;t have that return statement in the original version of the question."}, {"owner": {"reputation": 1407, "user_id": 4930992, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/108ce448671bef8443fcd64efb3012fa?s=128&d=identicon&r=PG&f=1", "display_name": "Christopher Armstrong", "link": "https://stackoverflow.com/users/4930992/christopher-armstrong"}, "edited": false, "score": 0, "creation_date": 1442781946, "post_id": 32682445, "comment_id": 53212964, "body": "Cirdec - I&#39;ve got your solution basically working against my Operational-based monad. I&#39;m currently wroking on polishing it up to include the error messages etc. To make this Q/A more sensible, would you prefer that I revert the question to have the Free DSL version, or do you want to update your answer with the Operational-based code I&#39;m working on? I can post a Gist shortly with the working code and you can copy whatever bits you want into your answer."}, {"owner": {"reputation": 1407, "user_id": 4930992, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/108ce448671bef8443fcd64efb3012fa?s=128&d=identicon&r=PG&f=1", "display_name": "Christopher Armstrong", "link": "https://stackoverflow.com/users/4930992/christopher-armstrong"}, "edited": false, "score": 0, "creation_date": 1442783312, "post_id": 32682445, "comment_id": 53213361, "body": "Here&#39;s the gist of the updated solution: <a href=\"https://gist.github.com/radix/44bbeb2e472f119b1c69\" rel=\"nofollow noreferrer\">gist.github.com/radix/44bbeb2e472f119b1c69</a> I&#39;ll let you decide if you want to copy it into your answer. If you don&#39;t want to update your answer, let me know and I&#39;ll revert the question to the Free DSL version. :)"}, {"owner": {"reputation": 23444, "user_id": 414413, "user_type": "registered", "accept_rate": 79, "profile_image": "https://www.gravatar.com/avatar/6de2113f01432aa844dc85070ff33e89?s=128&d=identicon&r=PG", "display_name": "Cirdec", "link": "https://stackoverflow.com/users/414413/cirdec"}, "reply_to_user": {"reputation": 1407, "user_id": 4930992, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/108ce448671bef8443fcd64efb3012fa?s=128&d=identicon&r=PG&f=1", "display_name": "Christopher Armstrong", "link": "https://stackoverflow.com/users/4930992/christopher-armstrong"}, "edited": false, "score": 0, "creation_date": 1442785324, "post_id": 32682445, "comment_id": 53213966, "body": "You can always add your own <code>Operational</code> answer."}, {"owner": {"reputation": 1407, "user_id": 4930992, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/108ce448671bef8443fcd64efb3012fa?s=128&d=identicon&r=PG&f=1", "display_name": "Christopher Armstrong", "link": "https://stackoverflow.com/users/4930992/christopher-armstrong"}, "edited": false, "score": 0, "creation_date": 1442785413, "post_id": 32682445, "comment_id": 53213995, "body": "I know, but I would rather give you the credit for accepted answer, since it was all your work :)"}, {"owner": {"reputation": 17809, "user_id": 1088108, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/63781cd38e91aa346a3849bc3ef3e550?s=128&d=identicon&r=PG&f=1", "display_name": "&#216;rjan Johansen", "link": "https://stackoverflow.com/users/1088108/%c3%98rjan-johansen"}, "edited": false, "score": 1, "creation_date": 1442796755, "post_id": 32682445, "comment_id": 53216331, "body": "There&#39;s one potential advantage to a <code>Free</code> solution: with that, you can share a lot of code by using automatically generated <code>Prism</code>s from the <code>lens</code> library, which might help when you get more constructors (With a few other changes to give the constructors more similar structure, I managed to write an <code>ex</code> function such that <code>prompt&#39; = ex _Prompt</code> and <code>display&#39; = ex _Display `flip` ()</code>). With a GADT solution like <code>operational</code>, this fails because of existential types."}, {"owner": {"reputation": 17809, "user_id": 1088108, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/63781cd38e91aa346a3849bc3ef3e550?s=128&d=identicon&r=PG&f=1", "display_name": "&#216;rjan Johansen", "link": "https://stackoverflow.com/users/1088108/%c3%98rjan-johansen"}, "edited": false, "score": 1, "creation_date": 1442797455, "post_id": 32682445, "comment_id": 53216444, "body": "If you&#39;d like to use this (or edit it into the answer), here it is: <code>ex :: (Show e, Eq e) =&gt; Prism&#39; (DSL (Free DSL a)) (e, r -&gt; Free DSL a) -&gt; e -&gt; r -&gt; Free DSL a -&gt; Either String (Free DSL a); ex prism expected response f =     case preview (_Free.prism) f of         Just (p, cont) | p == expected -&gt; return (cont response);         otherwise -&gt;             Left $ &quot;Expected (&quot; ++ show (review prism (expected, undefined)) ++ &quot;) but got &quot; ++ abbreviate f</code>"}, {"owner": {"reputation": 23444, "user_id": 414413, "user_type": "registered", "accept_rate": 79, "profile_image": "https://www.gravatar.com/avatar/6de2113f01432aa844dc85070ff33e89?s=128&d=identicon&r=PG", "display_name": "Cirdec", "link": "https://stackoverflow.com/users/414413/cirdec"}, "reply_to_user": {"reputation": 17809, "user_id": 1088108, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/63781cd38e91aa346a3849bc3ef3e550?s=128&d=identicon&r=PG&f=1", "display_name": "&#216;rjan Johansen", "link": "https://stackoverflow.com/users/1088108/%c3%98rjan-johansen"}, "edited": false, "score": 0, "creation_date": 1442801283, "post_id": 32682445, "comment_id": 53217193, "body": "@&#216;rjanJohansen That&#39;s a great idea, but without some typeclass machinery it won&#39;t generalize to constructors like <code>Repeat Int String next</code> and even with typeclass machinery probably can&#39;t handle constructors like <code>Fork next next</code> (neither can the current answer)."}, {"owner": {"reputation": 17809, "user_id": 1088108, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/63781cd38e91aa346a3849bc3ef3e550?s=128&d=identicon&r=PG&f=1", "display_name": "&#216;rjan Johansen", "link": "https://stackoverflow.com/users/1088108/%c3%98rjan-johansen"}, "edited": false, "score": 0, "creation_date": 1442805786, "post_id": 32682445, "comment_id": 53218104, "body": "Well I imagined the constructors needed to be tweaked a bit for the structure of the prisms to match; I already had to tweak <code>Display</code> to include the <code>()</code> result argument. Perhaps you can get enough flexibility with something like <code>Constructor EffectData (ResultFunctor next)</code>, where you have a typeclass for each necessary <code>ResultFunctor</code>? the <code>(-&gt;) r</code> instance would behave as the ones already given, while <code>Fork</code> could get something like <code>data Pair a = Pair a a</code>. Presumably this would only be worth it if there are much fewer functors than constructors."}, {"owner": {"reputation": 1407, "user_id": 4930992, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/108ce448671bef8443fcd64efb3012fa?s=128&d=identicon&r=PG&f=1", "display_name": "Christopher Armstrong", "link": "https://stackoverflow.com/users/4930992/christopher-armstrong"}, "edited": false, "score": 0, "creation_date": 1442943176, "post_id": 32682445, "comment_id": 53289036, "body": "Okay, so I reverted the question to the Free DSL form and marked your answer as accepted. Thanks very much for the help, Cirdec!"}], "tags": [], "owner": {"reputation": 23444, "user_id": 414413, "user_type": "registered", "accept_rate": 79, "profile_image": "https://www.gravatar.com/avatar/6de2113f01432aa844dc85070ff33e89?s=128&d=identicon&r=PG", "display_name": "Cirdec", "link": "https://stackoverflow.com/users/414413/cirdec"}, "is_accepted": true, "score": 11, "last_activity_date": 1442771338, "creation_date": 1442771338, "answer_id": 32682445, "question_id": 32673144, "link": "https://stackoverflow.com/questions/32673144/how-do-i-compare-a-program-specified-as-a-free-monad-against-a-description-of-ex/32682445#32682445", "title": "How do I compare a program specified as a free monad against a description of expected instructions?", "body": "<p>A test for a program <code>Free f a</code> is just an interpreter for the program <code>Free f a -&gt; r</code> producing some result <code>r</code></p>\n\n<p>What you are looking for is an easy way to build interpreters for the program that assert that the outcome of the program is what you expected. Each step of the interpreter will either unwrap a <code>Free f</code> instruction from the program or describe some error. They'll have the type</p>\n\n<pre><code>Free DSL a -&gt; Either String (Free DSL a)\n|                    |       ^ the remaining program after this step\n|                    ^ a descriptive error\n^ the remaining program before this step\n</code></pre>\n\n<p>We'll make a test for each of the constructors in the <code>DSL</code>. <code>prompt'</code> expects a <code>Prompt</code> with a specific value and provides the response value to the function to find what's next.</p>\n\n<pre><code>prompt' :: String -&gt; String -&gt; Free DSL a -&gt; Either String (Free DSL a)\nprompt' expected response f =\n    case f of\n        Free (Prompt p cont) | p == expected -&gt; return (cont response)\n        otherwise                            -&gt; Left $ \"Expected (Prompt \" ++ show expected ++ \" ...) but got \" ++ abbreviate f\n\nabbreviate :: Free DSL a -&gt; String\nabbreviate (Free (Prompt  p _)) = \"(Free (Prompt \"  ++ show p ++ \" ...))\"\nabbreviate (Free (Display p _)) = \"(Free (Display \" ++ show p ++ \" ...))\"\nabbreviate (Pure _)             = \"(Pure ...)\"\n</code></pre>\n\n<p><code>display'</code> expects a <code>Display</code> with a specific value.</p>\n\n<pre><code>display' :: String -&gt; Free DSL a -&gt; Either String (Free DSL a)\ndisplay' expected f =\n    case f of\n        Free (Display p next) | p == expected -&gt; return next\n        otherwise                             -&gt; Left $ \"Expected (Display \" ++ show expected ++ \" ...) but got \" ++ abbreviate f\n</code></pre>\n\n<p><code>pure'</code> expects a <code>Pure</code> with a specific value</p>\n\n<pre><code>pure' :: (Eq a, Show a) =&gt; a -&gt; Free DSL a -&gt; Either String ()\npure' expected f = \n    case f of\n        Pure a | a == expected -&gt; return ()\n        otherwise              -&gt; Left $ \"Expected \" ++ abbreviate' (Pure expected) ++ \" but got \" ++ abbreviate' f\n\nabbreviate' :: Show a =&gt; Free DSL a -&gt; String\nabbreviate' (Pure a) = \"(Pure \" ++ showsPrec 10 a \")\"\nabbreviate' f        = abbreviate f\n</code></pre>\n\n<p>With <code>prompt'</code> and <code>display'</code> we can easily build an interpreter in the style of <code>expect</code>.</p>\n\n<pre><code>expect :: Free DSL a -&gt; Either String (Free DSL a)\nexpect f = return f &gt;&gt;=\n           prompt' \"Enter your name:\" \"radix\" &gt;&gt;=\n           display' \"Why hello there, radix.\" &gt;&gt;=\n           prompt' \"And what is your friend's name?\" \"Bob\" &gt;&gt;=\n           display' \"It's good to meet you too, Bob.\"\n</code></pre>\n\n<p>Running this test</p>\n\n<pre><code>main = either putStrLn (putStrLn . const \"Passed\") $ expect greet\n</code></pre>\n\n<p>Results in a failure</p>\n\n<pre><code>Expected (Prompt \"Enter your name:\" ...) but got (Free (Prompt \"Enter your name: \" ...))\n</code></pre>\n\n<p>Once we change the test to expect spaces at the end of the prompts</p>\n\n<pre><code>expect :: Free DSL a -&gt; Either String (Free DSL a)\nexpect f = return f &gt;&gt;=\n           prompt' \"Enter your name: \" \"radix\" &gt;&gt;=\n           display' \"Why hello there, radix.\" &gt;&gt;=\n           prompt' \"And what is your friend's name? \" \"Bob\" &gt;&gt;=\n           display' \"It's good to meet you too, Bob.\"\n</code></pre>\n\n<p>Running it results in</p>\n\n<pre><code>Passed\n</code></pre>\n"}], "owner": {"reputation": 1407, "user_id": 4930992, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/108ce448671bef8443fcd64efb3012fa?s=128&d=identicon&r=PG&f=1", "display_name": "Christopher Armstrong", "link": "https://stackoverflow.com/users/4930992/christopher-armstrong"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 226, "favorite_count": 5, "accepted_answer_id": 32682445, "answer_count": 1, "score": 11, "last_activity_date": 1442929718, "creation_date": 1442696121, "last_edit_date": 1442929718, "question_id": 32673144, "link": "https://stackoverflow.com/questions/32673144/how-do-i-compare-a-program-specified-as-a-free-monad-against-a-description-of-ex", "title": "How do I compare a program specified as a free monad against a description of expected instructions?", "body": "<p>So I'm trying to do something that's kind of novel (I think), but I'm not\nexperienced enough with Haskell type-level programming to work it out myself.</p>\n\n<p>I've got a free monad describing some effects to perform (an AST, if that's the\nway you roll), and I want to interpret it against some description of the\neffects that are expected.</p>\n\n<p>Here's my code so far::</p>\n\n<pre><code>{-# LANGUAGE DeriveFunctor, FlexibleInstances, GADTs, FlexibleContexts #-}\nimport Control.Monad.Free -- from package 'free'\n\ndata DSL next\n    = Prompt String (String -&gt; next)\n    | Display String next\n    deriving (Show, Functor)\n\nprompt p = liftF (Prompt p id)\ndisplay o = liftF (Display o ())\n\n-- |Just to make sure my stuff works interactively\nrunIO :: (Free DSL a) -&gt; IO a\nrunIO (Free (Prompt p cont)) = do\n    putStr p\n    line &lt;- getLine\n    runIO (cont line)\nrunIO (Free (Display o cont)) = do putStrLn o; runIO cont\nrunIO (Pure x) = return x\n</code></pre>\n\n<p>That's the \"core\" code. Here's an example program:</p>\n\n<pre><code>greet :: (Free DSL ())\ngreet = do\n    name &lt;- prompt \"Enter your name: \"\n    let greeting = \"Why hello there, \" ++ name ++ \".\"\n    display greeting\n    friendName &lt;- prompt \"And what is your friend's name? \"\n    display (\"It's good to meet you too, \" ++ friendName ++ \".\")\n</code></pre>\n\n<p>To test this program, I want to use a function <code>runTest :: Free DSL a -&gt; _ -&gt; Maybe a</code>, which should take a program and some specification of \"expected effects\" vaguely like this:</p>\n\n<pre><code>expect = (\n    (Prompt' \"Enter your name:\", \"radix\"),\n    (Display' \"Why hello there, radix.\", ()),\n    (Prompt' \"And what is your friend's name?\", \"Bob\"),\n    (Display' \"It's good to meet you too, Bob.\", ()))\n</code></pre>\n\n<p>and interpret the program by matching each effect that it performs against the next item in the <code>expect</code> list. Then the associated value (the second item in each pair) should be returned as the result of that effect to the program. If all the effects match, the final result of the program should be returned as a <code>Just</code>. If something doesn't match, <code>Nothing</code> should be returned (later I'll expand this so that it returns an informative error message).</p>\n\n<p>Of course this <code>expect</code> tuple is useless, since its type is a big giant thing that I can't write a generic <code>runTest</code> function over. The main problem I'm having is how I should represent this sequence of expected intents in a way that I can write a function that works with any sequence against any program <code>Free DSL a</code>.</p>\n\n<ol>\n<li>I'm vaguely aware of various advanced type-level features in Haskell, but I'm not yet experienced to know which things I should try to use.</li>\n<li>Should I be using an HList or something for my <code>expected</code> sequence?</li>\n</ol>\n\n<p>Any hints for things to look into are greatly appreciated.</p>\n"}, {"tags": ["haskell", "ghc"], "comments": [{"owner": {"reputation": 44013, "user_id": 1477667, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/trgKM.jpg?s=128&g=1", "display_name": "dfeuer", "link": "https://stackoverflow.com/users/1477667/dfeuer"}, "edited": false, "score": 0, "creation_date": 1442760917, "post_id": 32672814, "comment_id": 53205894, "body": "<code>realWorld#</code> and the models of <code>IO</code> and <code>ST</code> it supports are a terrible hack that almost certainly wouldn&#39;t exist if GHC were being designed today. It was the best the designers could come up with at the time, but now we know better ways. It&#39;s usually best to pretend those don&#39;t exist."}], "answers": [{"tags": [], "owner": {"reputation": 14582, "user_id": 2225384, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/f30b04ed4d0b3fc4bc791a28815f34ca?s=128&d=identicon&r=PG", "display_name": "Rein Henrichs", "link": "https://stackoverflow.com/users/2225384/rein-henrichs"}, "is_accepted": true, "score": 7, "last_activity_date": 1442737752, "last_edit_date": 1442737752, "creation_date": 1442695610, "answer_id": 32673064, "question_id": 32672814, "link": "https://stackoverflow.com/questions/32672814/where-is-the-realworld-defined/32673064#32673064", "title": "Where is the realWorld# defined?", "body": "<p><code>realWorld#</code> is a value of type <code>State# RealWorld</code> which is a token that acts as a reference to \"the real world\". (Interestingly, it is of size 0 and does not occupy any space on the stack or heap.)</p>\n\n<p>A bit of background information. <code>State# RealWorld</code> values represent the entire external runtime state of the program. The \"real world\", as it were. The <code>main</code> value in your program receives a <code>State# RealWorld</code> value that is threaded through the <code>IO</code> actions that compose it. <code>realWorld#</code> is that value at the time the <code>unsafeDupablePerformIO</code> value is evaluated.</p>\n\n<p>As to where it's defined, it's <a href=\"https://github.com/ghc/ghc/blob/master/compiler/basicTypes/MkId.hs#L1061\" rel=\"nofollow\">here</a>, for whatever good that will do you. :)</p>\n"}], "owner": {"reputation": 6159, "user_id": 754705, "user_type": "registered", "accept_rate": 60, "profile_image": "https://www.gravatar.com/avatar/942fe51aac5dc523f0305439fa9a6e3d?s=128&d=identicon&r=PG&f=1", "display_name": "Michael", "link": "https://stackoverflow.com/users/754705/michael"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 673, "favorite_count": 2, "accepted_answer_id": 32673064, "answer_count": 1, "score": 2, "last_activity_date": 1442737752, "creation_date": 1442694060, "question_id": 32672814, "link": "https://stackoverflow.com/questions/32672814/where-is-the-realworld-defined", "title": "Where is the realWorld# defined?", "body": "<p>In the definition of <code>unsafeDupablePerformIO</code> (<a href=\"http://hackage.haskell.org/package/base-4.8.1.0/docs/src/GHC.IO.html#unsafeDupablePerformIO\" rel=\"nofollow\">source</a>, <a href=\"http://hackage.haskell.org/package/base-4.8.1.0/docs/System-IO-Unsafe.html#v:unsafePerformIO\" rel=\"nofollow\">docs</a>) I found a reference to the one and only <code>realWorld#</code>. So I wondered where all these functions or values that end with a <code>#</code> are defined? I already found the <a href=\"https://ghc.haskell.org/trac/ghc/browser/ghc/compiler/prelude/primops.txt.pp\" rel=\"nofollow\">GHC primops</a> of course: they include <code>seq#</code>, <code>catch#</code>, <code>retry#</code>, and all other kinds of interesting functions. It also contains a <code>RealWorld</code> type. But the primops don't seem to contain the actual value <code>realWorld#</code>.</p>\n\n<pre><code>{-# NOINLINE unsafeDupablePerformIO #-}\n    -- See Note [unsafeDupablePerformIO is NOINLINE]\nunsafeDupablePerformIO  :: IO a -&gt; a\nunsafeDupablePerformIO (IO m) = lazy (case m realWorld# of (# _, r #) -&gt; r)\n     -- See Note [unsafeDupablePerformIO has a lazy RHS]\n</code></pre>\n\n<p>(please don't mix <code>RealWorld</code> and <code>realWorld#</code>: the first is a type, the second is a value.)</p>\n\n<p>Are there other undocumented primops in GHC? Or maybe all of this is documented somewhere, and I just haven't found it yet? Where in the GHC source can I look at the implementation of these things?</p>\n"}, {"tags": ["haskell", "haddock"], "answers": [{"tags": [], "owner": {"reputation": 49959, "user_id": 866915, "user_type": "registered", "accept_rate": 70, "profile_image": "https://www.gravatar.com/avatar/09242131d6e17cbbe31e8547514da6e5?s=128&d=identicon&r=PG", "display_name": "ErikR", "link": "https://stackoverflow.com/users/866915/erikr"}, "is_accepted": true, "score": 4, "last_activity_date": 1442750049, "last_edit_date": 1442750049, "creation_date": 1442691150, "answer_id": 32672379, "question_id": 32672127, "link": "https://stackoverflow.com/questions/32672127/how-do-i-incorporate-a-blank-line-into-a-haddock-example/32672379#32672379", "title": "How do I incorporate a blank line into a Haddock example?", "body": "<p>Simply using</p>\n\n<pre><code>&lt;BLANKLINE&gt;\n</code></pre>\n\n<p><a href=\"https://www.haskell.org/haddock/doc/html/ch03s08.html#idm140354810775744\" rel=\"nofollow\">should work</a>.</p>\n"}], "owner": {"reputation": 35444, "user_id": 656912, "user_type": "registered", "accept_rate": 66, "profile_image": "https://www.gravatar.com/avatar/ce95c01cbd4f90f014d988ae5c8a422d?s=128&d=identicon&r=PG", "display_name": "orome", "link": "https://stackoverflow.com/users/656912/orome"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 59, "favorite_count": 0, "accepted_answer_id": 32672379, "answer_count": 1, "score": 4, "last_activity_date": 1442750049, "creation_date": 1442689384, "last_edit_date": 1495540689, "question_id": 32672127, "link": "https://stackoverflow.com/questions/32672127/how-do-i-incorporate-a-blank-line-into-a-haddock-example", "title": "How do I incorporate a blank line into a Haddock example?", "body": "<p>Haddock supports <a href=\"https://stackoverflow.com/a/8424442/656912\">blank lines</a>, and supports <a href=\"https://www.haskell.org/haddock/doc/html/ch03s08.html#idm140354810775744\" rel=\"nofollow noreferrer\">REPL examples</a>. But I can't figure out how to show a blank line in an example.</p>\n\n<p>For example, if 'f' prints out two lines separated by a blank line</p>\n\n<pre><code>ghci&gt; f\nLine1\n\nLine 2\n</code></pre>\n\n<p>The corresponding Haddock example </p>\n\n<pre><code>-- &gt;&gt;&gt; f\n-- Line1\n-- \n-- Line 2\n</code></pre>\n\n<p>only generates</p>\n\n<blockquote>\n<pre><code>&gt;&gt;&gt; f\nLine1 \n</code></pre>\n  \n  <p>Line2</p>\n</blockquote>\n\n<p>In other words, it ends the example at the first blank line and treats what follows as a regular comment.</p>\n\n<p>Is there a way to show blank likes in Haddock REPL examples? </p>\n"}, {"tags": ["haskell", "functional-programming"], "comments": [{"owner": {"reputation": 44013, "user_id": 1477667, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/trgKM.jpg?s=128&g=1", "display_name": "dfeuer", "link": "https://stackoverflow.com/users/1477667/dfeuer"}, "edited": false, "score": 1, "creation_date": 1442698645, "post_id": 32671988, "comment_id": 53192578, "body": "Using <code>Float</code> is <i>usually</i> a mistake. For most purposes, you&#39;re more likely to want <code>Double</code>. In a financial context, on the other hand, you will sometimes need fixed point instead."}, {"owner": {"reputation": 9225, "user_id": 3248346, "user_type": "registered", "accept_rate": 68, "profile_image": "https://www.gravatar.com/avatar/377f7423a286949201e0aa8cb2257fcc?s=128&d=identicon&r=PG&f=1", "display_name": "M.K.", "link": "https://stackoverflow.com/users/3248346/m-k"}, "reply_to_user": {"reputation": 44013, "user_id": 1477667, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/trgKM.jpg?s=128&g=1", "display_name": "dfeuer", "link": "https://stackoverflow.com/users/1477667/dfeuer"}, "edited": false, "score": 0, "creation_date": 1442736992, "post_id": 32671988, "comment_id": 53199397, "body": "@dfeuer, yes I know it&#39;s just a dummy example to illustrate the main design problem."}], "answers": [{"comments": [{"owner": {"reputation": 20862, "user_id": 376113, "user_type": "registered", "accept_rate": 72, "profile_image": "https://www.gravatar.com/avatar/d3a5bd12fe6d876527a3cf4ac0de5fc6?s=128&d=identicon&r=PG", "display_name": "mb14", "link": "https://stackoverflow.com/users/376113/mb14"}, "edited": false, "score": 0, "creation_date": 1442691953, "post_id": 32672099, "comment_id": 53190628, "body": "In that case you are probably right, but what do you do when you have that + one parameter on on of the constructor."}, {"owner": {"reputation": 41209, "user_id": 485115, "user_type": "registered", "accept_rate": 87, "profile_image": "https://www.gravatar.com/avatar/59693d66b96ca17ca9d2fdb2393e2be3?s=128&d=identicon&r=PG", "display_name": "Nikita Volkov", "link": "https://stackoverflow.com/users/485115/nikita-volkov"}, "reply_to_user": {"reputation": 20862, "user_id": 376113, "user_type": "registered", "accept_rate": 72, "profile_image": "https://www.gravatar.com/avatar/d3a5bd12fe6d876527a3cf4ac0de5fc6?s=128&d=identicon&r=PG", "display_name": "mb14", "link": "https://stackoverflow.com/users/376113/mb14"}, "edited": false, "score": 0, "creation_date": 1442692246, "post_id": 32672099, "comment_id": 53190726, "body": "@mb14 That probably is a sign that you have another smaller entity wrapped there and you need to decompose more."}], "tags": [], "owner": {"reputation": 41209, "user_id": 485115, "user_type": "registered", "accept_rate": 87, "profile_image": "https://www.gravatar.com/avatar/59693d66b96ca17ca9d2fdb2393e2be3?s=128&d=identicon&r=PG", "display_name": "Nikita Volkov", "link": "https://stackoverflow.com/users/485115/nikita-volkov"}, "is_accepted": true, "score": 6, "last_activity_date": 1442689890, "last_edit_date": 1442689890, "creation_date": 1442689196, "answer_id": 32672099, "question_id": 32671988, "link": "https://stackoverflow.com/questions/32671988/avoiding-boilerplate-code-due-to-equivalent-constructors/32672099#32672099", "title": "Avoiding boilerplate code due to equivalent constructors", "body": "<p>You're correct. This is a code smell, and it's actually a very common modelling mistake. All you need to do is just factor the rate-type out. E.g.,</p>\n\n<pre><code>data RateType = Fixed | Floating\n\ndata Bond = Bond RateType Float Float\n</code></pre>\n\n<p>Then you'll have</p>\n\n<pre><code>foo :: Bond -&gt; Float\nfoo (Bond _ a b) = a + b\n</code></pre>\n\n<p>atop of other benefits like <code>RateType</code> now actually being a type, which you can have <code>Enum</code> and <code>Bounded</code> instances for.</p>\n\n<p>Basically, the rule of thumb here is: if you have multiple constructors implementing the same thing, there must be an enum asking to be factored out.</p>\n"}], "owner": {"reputation": 9225, "user_id": 3248346, "user_type": "registered", "accept_rate": 68, "profile_image": "https://www.gravatar.com/avatar/377f7423a286949201e0aa8cb2257fcc?s=128&d=identicon&r=PG&f=1", "display_name": "M.K.", "link": "https://stackoverflow.com/users/3248346/m-k"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 84, "favorite_count": 0, "accepted_answer_id": 32672099, "answer_count": 1, "score": 3, "last_activity_date": 1442690584, "creation_date": 1442688577, "last_edit_date": 1442690584, "question_id": 32671988, "link": "https://stackoverflow.com/questions/32671988/avoiding-boilerplate-code-due-to-equivalent-constructors", "title": "Avoiding boilerplate code due to equivalent constructors", "body": "<p>I have an ADT as follows:</p>\n\n<pre><code>Prelude&gt; data Bond = FixedRateBond Float Float | FloatingRateBond Float Float\n</code></pre>\n\n<p>I want to do an operation on every value constructors of this ADT as follows:</p>\n\n<pre><code>Prelude&gt; let foo :: Bond -&gt; Float\nPrelude|     foo (FixedRateBond a b) = a + b\nPrelude|     foo (FloatingRateBond a b) = a + b\n</code></pre>\n\n<p>As you can see I have code duplication here; for every value I have <code>a + b</code>. I will have more value constructors so this is going to be repeated even more. To me this is code smell, but I don't know how I would refactor it to eliminate the duplicated code. Is there a functional way to avoid this repeated code? This is a trivial example as I have stripped down the real problem to bare essentials to explain the problem.</p>\n"}, {"tags": ["haskell", "state", "monads"], "comments": [{"owner": {"reputation": 94553, "user_id": 775806, "user_type": "registered", "accept_rate": 96, "profile_image": "https://i.stack.imgur.com/XNd2C.png?s=128&g=1", "display_name": "n. &#39;pronouns&#39; m.", "link": "https://stackoverflow.com/users/775806/n-pronouns-m"}, "edited": false, "score": 2, "creation_date": 1442682464, "post_id": 32670948, "comment_id": 53187635, "body": "In Haskell you normally use recursion in such situations."}, {"owner": {"reputation": 641, "user_id": 3861396, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/7c5461c6b9136f38ca27541a6b45a6cc?s=128&d=identicon&r=PG&f=1", "display_name": "2016rshah", "link": "https://stackoverflow.com/users/3861396/2016rshah"}, "reply_to_user": {"reputation": 94553, "user_id": 775806, "user_type": "registered", "accept_rate": 96, "profile_image": "https://i.stack.imgur.com/XNd2C.png?s=128&g=1", "display_name": "n. &#39;pronouns&#39; m.", "link": "https://stackoverflow.com/users/775806/n-pronouns-m"}, "edited": false, "score": 0, "creation_date": 1442682753, "post_id": 32670948, "comment_id": 53187742, "body": "How do I pass the game board along the recursion? And how does the recursion work within the <code>main</code> function?"}, {"owner": {"reputation": 11366, "user_id": 3922954, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/76ba47d2fdd24ab56b0b273cce2075e5?s=128&d=identicon&r=PG&f=1", "display_name": "AJF", "link": "https://stackoverflow.com/users/3922954/ajf"}, "edited": false, "score": 0, "creation_date": 1442684663, "post_id": 32670948, "comment_id": 53188379, "body": "@2016rshah Recursion can be value-based. Write a function that produces an IO action that calls itself, or just refer back to <code>main</code> again."}], "answers": [{"comments": [{"owner": {"reputation": 641, "user_id": 3861396, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/7c5461c6b9136f38ca27541a6b45a6cc?s=128&d=identicon&r=PG&f=1", "display_name": "2016rshah", "link": "https://stackoverflow.com/users/3861396/2016rshah"}, "edited": false, "score": 0, "creation_date": 1442689385, "post_id": 32671373, "comment_id": 53189859, "body": "The solution makes perfect sense now, thank you so much!"}], "tags": [], "owner": {"reputation": 23444, "user_id": 414413, "user_type": "registered", "accept_rate": 79, "profile_image": "https://www.gravatar.com/avatar/6de2113f01432aa844dc85070ff33e89?s=128&d=identicon&r=PG", "display_name": "Cirdec", "link": "https://stackoverflow.com/users/414413/cirdec"}, "is_accepted": true, "score": 4, "last_activity_date": 1442685327, "last_edit_date": 1442685327, "creation_date": 1442684665, "answer_id": 32671373, "question_id": 32670948, "link": "https://stackoverflow.com/questions/32670948/take-input-from-user-until-tic-tac-toe-game-ends/32671373#32671373", "title": "Take input from user until tic-tac-toe game ends", "body": "<p>You pass the board along into the recursive call</p>\n\n<pre><code>player :: Board -&gt; IO ()\nplayer board1 = do\n    putStrLn (show board1)\n    loc1 &lt;- getLine\n    let moveLoc1 = read loc1\n    let board2 = findAndReplace board1 (Left moveLoc1) (Right O)\n    if over board2                    -- check to see if the game is over and we should stop recursing\n    then putStrLn (outcome board2)    -- what to do when the game is over\n    else computer board2              -- recurse for the other player if the game isn't over\n--       |        ^-- the state of the board being passed to the recursive call\n--       ^----------- the recursive call to the other player\n\n\ncomputer :: Board -&gt; IO ()\ncomputer board1 = do\n    let board2 = makeXMove board1\n    if over board2                    -- check to see if the game is over and we should stop recursing\n    then putStrLn (outcome board2)    -- what to do when the game is over\n    else player board2                -- recurse for the other player if the game isn't over\n--       |        ^-- the state of the board being passed to the recursive call\n--       ^----------- the recursive call to the other player\n</code></pre>\n\n<p>You will need to fill in the functions <code>over :: Board -&gt; Bool</code> that detects when the game is over and <code>outcome :: Board -&gt; String</code> that describes the outcome of the game. You'd start the game with the player going first with</p>\n\n<pre><code>main = do\n    putStrLn \"Welcome to tic tac toe. Where do you want to move first?\"\n    player emptyBoard\n</code></pre>\n\n<p>There's a lot of code repeated in <code>player</code> and <code>computer</code>. A good challenge for yourself would be to figure out how to get rid of that duplicated code. Can you change <code>player</code> so that it doesn't know about <code>computer</code> and vice-versa and then make two <code>player</code>s play against each other (possibly slightly modified to tell which one's <code>X</code> and which one's <code>O</code>)?</p>\n"}], "owner": {"reputation": 641, "user_id": 3861396, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/7c5461c6b9136f38ca27541a6b45a6cc?s=128&d=identicon&r=PG&f=1", "display_name": "2016rshah", "link": "https://stackoverflow.com/users/3861396/2016rshah"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 203, "favorite_count": 0, "accepted_answer_id": 32671373, "answer_count": 1, "score": 1, "last_activity_date": 1442685327, "creation_date": 1442682298, "question_id": 32670948, "link": "https://stackoverflow.com/questions/32670948/take-input-from-user-until-tic-tac-toe-game-ends", "title": "Take input from user until tic-tac-toe game ends", "body": "<p>So I'm about eight weeks through <a href=\"http://www.seas.upenn.edu/~cis194/spring13/lectures.html\" rel=\"nofollow\">CIS194</a>, and I'm making a super simple tic-tac-toe game in Haskell. I've got most of the game logic down, but I am stumped at the user input part. </p>\n\n<p>As of right now just to check everything out I have this awful system of hardcoding the moves of the user and the computer. </p>\n\n<pre><code>putStrLn \"Welcome to tic tac toe. Where do you want to move first?\"\n\nlet board1 = emptyBoard\nputStrLn (show board1)\nloc1 &lt;- getLine\nlet moveLoc1 = read loc1\nlet board2 = findAndReplace board1 (Left moveLoc1) (Right O)\n\n...\n\nlet board7 = makeXMove board6\nputStrLn (show board7)\nloc4 &lt;- getLine\nlet moveLoc4 = read loc4\nlet board8 = findAndReplace board7 (Left moveLoc4) (Right O)\n\n\nputStrLn (show board8)\n</code></pre>\n\n<p>What I am aiming for, though, is that it will take user input, check if the game has ended, make the computer move, check if the game is over and repeat if not. In an imperative language I would wrap something like this in a while loop, but I am not sure how to approach the problem in Haskell.  </p>\n\n<p>From what I've looked at online, there are a lot of things that sound like they might help, but I don't know where to start with them. For example, I'm also looking at <a href=\"http://projects.haskell.org/operational/examples/TicTacToe.hs.html\" rel=\"nofollow\">this example</a>, and I've heard a lot about <code>Monad</code>s and <code>State</code> but is there any introductory literature I can take a look at to wrap my head around the whole thing?</p>\n\n<p>All the code I have so far can be found <a href=\"https://github.com/2016rshah/TicTacToe\" rel=\"nofollow\">on github</a>.</p>\n\n<p>Basically my question is how can I ask the user for input until the game ends and stop asking them when it does?</p>\n"}, {"tags": ["haskell", "type-level-computation"], "answers": [{"comments": [{"owner": {"reputation": 14485, "user_id": 190376, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/cd8280c5e1491b8cf55760750ed97dec?s=128&d=identicon&r=PG", "display_name": "Reid Barton", "link": "https://stackoverflow.com/users/190376/reid-barton"}, "edited": false, "score": 4, "creation_date": 1442681364, "post_id": 32670506, "comment_id": 53187249, "body": "It&#39;s somewhat unsatisfying that we can&#39;t eliminate the constraint (without cheating) even though it seems like we really don&#39;t need the dictionary at runtime. Is there a fundamental reason for this? Or what kind of improvement to GHC would be needed to avoid the constraint?"}, {"owner": {"reputation": 64094, "user_id": 476408, "user_type": "registered", "accept_rate": 70, "profile_image": "https://www.gravatar.com/avatar/2bc1bffafe7aa29ef900b98d1fd1e94e?s=128&d=identicon&r=PG", "display_name": "J. Abrahamson", "link": "https://stackoverflow.com/users/476408/j-abrahamson"}, "edited": false, "score": 0, "creation_date": 1442682877, "post_id": 32670506, "comment_id": 53187783, "body": "It&#39;s a propositional equality so it still requires (trivial) proof."}, {"owner": {"reputation": 13807, "user_id": 2407038, "user_type": "registered", "accept_rate": 64, "profile_image": "https://www.gravatar.com/avatar/538f6f4a9aa43841841de7d8e8b169fc?s=128&d=identicon&r=PG&f=1", "display_name": "user2407038", "link": "https://stackoverflow.com/users/2407038/user2407038"}, "reply_to_user": {"reputation": 14485, "user_id": 190376, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/cd8280c5e1491b8cf55760750ed97dec?s=128&d=identicon&r=PG", "display_name": "Reid Barton", "link": "https://stackoverflow.com/users/190376/reid-barton"}, "edited": false, "score": 0, "creation_date": 1442687291, "post_id": 32670506, "comment_id": 53189150, "body": "@ReidBarton GHC erases types at runtime - so a function that only has a <code>Proxy (x :: Bool)</code> can&#39;t actually inspect it the <code>Bool</code> at runtime, unless of course, you have a typeclass to inspect it, but then you get the constraint."}, {"owner": {"reputation": 14485, "user_id": 190376, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/cd8280c5e1491b8cf55760750ed97dec?s=128&d=identicon&r=PG", "display_name": "Reid Barton", "link": "https://stackoverflow.com/users/190376/reid-barton"}, "edited": false, "score": 0, "creation_date": 1442693069, "post_id": 32670506, "comment_id": 53190963, "body": "I understand that, but <code>norm</code> doesn&#39;t seem to really need to inspect the Bool <code>isCol</code> at runtime. Case analysis on <code>isCol</code> is needed only at compile time to check that <code>norm</code> is type-correct."}, {"owner": {"reputation": 100185, "user_id": 3234959, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/93bb12ca0f93dfddb33880316f7e66c2?s=128&d=identicon&r=PG&f=1", "display_name": "chi", "link": "https://stackoverflow.com/users/3234959/chi"}, "reply_to_user": {"reputation": 14485, "user_id": 190376, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/cd8280c5e1491b8cf55760750ed97dec?s=128&d=identicon&r=PG", "display_name": "Reid Barton", "link": "https://stackoverflow.com/users/190376/reid-barton"}, "edited": false, "score": 3, "creation_date": 1442693202, "post_id": 32670506, "comment_id": 53190999, "body": "@ReidBarton I&#39;d love GHC to be that smart. One could use a termination checker so to guarantee that the &quot;proof&quot; is indeed non-bottom. Then, since there&#39;s only one possible value for <code>:~:</code> (let&#39;s believe in axiom K), GHC could completely skip the evaluation at runtime and craft/coerce <code>Refl</code> directly. Since that is immediately eliminated, the proof could even be optimized away. Further, the constraint is now unneeded, so at runtime no dictionary really needs to be passed. This can trigger more optimizations e.g. generating a specialization sans-dictionary."}, {"owner": {"reputation": 14485, "user_id": 190376, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/cd8280c5e1491b8cf55760750ed97dec?s=128&d=identicon&r=PG", "display_name": "Reid Barton", "link": "https://stackoverflow.com/users/190376/reid-barton"}, "edited": false, "score": 2, "creation_date": 1442700467, "post_id": 32670506, "comment_id": 53193040, "body": "Oh right, totality checking was the main ingredient I was looking for. Evaluating proofs at runtime, ugh... I guess that is the proof obligation that the user of <code>unsafeCoerce</code> incurs here."}, {"owner": {"reputation": 44013, "user_id": 1477667, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/trgKM.jpg?s=128&g=1", "display_name": "dfeuer", "link": "https://stackoverflow.com/users/1477667/dfeuer"}, "reply_to_user": {"reputation": 14485, "user_id": 190376, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/cd8280c5e1491b8cf55760750ed97dec?s=128&d=identicon&r=PG", "display_name": "Reid Barton", "link": "https://stackoverflow.com/users/190376/reid-barton"}, "edited": false, "score": 1, "creation_date": 1442701017, "post_id": 32670506, "comment_id": 53193158, "body": "@ReidBarton, I suspect other potential sources of inconsistency in GHC&#39;s type system render totality checking insufficient. Oleg wrote a big gripe about that a few years ago, and I can&#39;t imagine that Richard&#39;s <code>* :: *</code> will help matters in that regard. :-/"}], "tags": [], "owner": {"reputation": 13807, "user_id": 2407038, "user_type": "registered", "accept_rate": 64, "profile_image": "https://www.gravatar.com/avatar/538f6f4a9aa43841841de7d8e8b169fc?s=128&d=identicon&r=PG&f=1", "display_name": "user2407038", "link": "https://stackoverflow.com/users/2407038/user2407038"}, "is_accepted": true, "score": 5, "last_activity_date": 1442679710, "creation_date": 1442679710, "answer_id": 32670506, "question_id": 32670108, "link": "https://stackoverflow.com/questions/32670108/how-to-prove-double-negation-for-type-level-booleans/32670506#32670506", "title": "How to prove double negation for type level booleans?", "body": "<p>The answer: yes, it is. The proof is quite trivial if you have the correct datatypes: </p>\n\n<pre><code>data family Sing (x :: k) \n\nclass SingI (x :: k) where \n  sing :: Sing x \n\ndata instance Sing (x :: Bool) where \n  STrue :: Sing True \n  SFalse :: Sing False \n\ntype SBool x = Sing (x :: Bool)\n\ndata (:~:) x y where \n  Refl :: x :~: x \n\ndouble_neg :: SBool x -&gt; x :~: Not (Not x) \ndouble_neg x = case x of \n                 STrue -&gt; Refl \n                 SFalse -&gt; Refl \n</code></pre>\n\n<p>As you can see, the compiler will see that the proof is trivial upon inspection of the different cases. You'll find all of these data definitions in several packages, for example <code>singletons</code>. You use the proof like so:</p>\n\n<pre><code>instance Sing True where sing = STrue \ninstance Sing False where sing = SFalse\n\nnorm :: forall isCol . SingI isCol =&gt; Vector isCol -&gt; Double\nnorm v = case double_neg (sing :: Sing isCol) of \n           Refl -&gt; sqrt (flipVec v `sprod` v)\n</code></pre>\n\n<p>Of course this a lot of work for such a trivial thing. If you are really sure you know what you're doing, you can \"cheat\": </p>\n\n<pre><code>import Unsafe.Coerce\nimport Data.Proxy \n\ndouble_neg' :: Proxy x -&gt; x :~: Not (Not x) \ndouble_neg' _ = unsafeCoerce (Refl :: () :~: ())\n</code></pre>\n\n<p>This allows you to get rid of the <code>SingI</code> constraint:</p>\n\n<pre><code>norm' :: forall isCol . Vector isCol -&gt; Double\nnorm' v = case double_neg' (Proxy :: Proxy isCol) of \n           Refl -&gt; sqrt (flipVec v `sprod` v)\n</code></pre>\n"}], "owner": {"reputation": 3291, "user_id": 1456761, "user_type": "registered", "accept_rate": 97, "profile_image": "https://i.stack.imgur.com/gvNnG.png?s=128&g=1", "display_name": "Tobias Brandt", "link": "https://stackoverflow.com/users/1456761/tobias-brandt"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 194, "favorite_count": 1, "accepted_answer_id": 32670506, "answer_count": 1, "score": 10, "last_activity_date": 1442679710, "creation_date": 1442677446, "question_id": 32670108, "link": "https://stackoverflow.com/questions/32670108/how-to-prove-double-negation-for-type-level-booleans", "title": "How to prove double negation for type level booleans?", "body": "<p>I have the following module:</p>\n\n<pre><code>{-# LANGUAGE DataKinds, KindSignatures, TypeFamilies, RoleAnnotations #-}\nmodule Main where\n\nimport Data.Coerce (coerce)\n\n-- logical negation for type level booleans\ntype family Not (x :: Bool) where\n    Not True = False\n    Not False = True\n\n-- a 3D vector with a phantom parameter that determines whether this is a\n-- column or row vector\ndata Vector (isCol :: Bool) = Vector Double Double Double\n\ntype role Vector phantom\n\n-- convert column to row vector or row to column vector\nflipVec :: Vector isCol -&gt; Vector (Not isCol)\nflipVec = coerce\n\n-- scalar product is only defined for vectors of different types\n-- (row times column or column times row vector)\nsprod :: Vector isCol -&gt; Vector (Not isCol) -&gt; Double\nsprod (Vector x1 y1 z1) (Vector x2 y2 z2) = x1*x2 + y1*y2 + z1*z2\n\n-- vector norm defined in terms of sprod\nnorm :: Vector isCol -&gt; Double\n-- this definition compiles\nnorm v = sqrt (v `sprod` flipVec v)\n-- this does not (without an additional constraint, see below)\nnorm v = sqrt (flipVec v `sprod` v)\n\nmain = undefined\n</code></pre>\n\n<p>The second definition of <code>norm</code> does not compile, because <code>flipVec v</code> returns <code>Vector (Not isCol)</code> and hence <code>sprod</code> wants a <code>Vector (Not (Not isCol))</code> as second argument:</p>\n\n<pre><code>Main.hs:22:34:                                                                                                                      \n    Couldn't match type \u2018isCol\u2019 with \u2018Not (Not isCol)\u2019                                                                              \n      \u2018isCol\u2019 is a rigid type variable bound by                                                                                     \n              the type signature for norm :: Vector isCol -&gt; Double                                                                 \n              at Main.hs:20:9                                                                                                       \n    Expected type: Vector (Not (Not isCol))                                                                                         \n      Actual type: Vector isCol                                                                                                     \n    Relevant bindings include                                                                                                       \n      v :: Vector isCol (bound at Main.hs:22:6)                                                                                     \n      norm :: Vector isCol -&gt; Double (bound at Main.hs:22:1)                                                                        \n    In the second argument of \u2018sprod\u2019, namely \u2018v\u2019                                                                                   \n    In the first argument of \u2018sqrt\u2019, namely \u2018(flipVec v `sprod` v)\u2019\n</code></pre>\n\n<p>I could of course add the constraint <code>isCol ~ Not (Not isCol)</code> to the type of <code>norm</code>:</p>\n\n<pre><code>norm :: isCol ~ Not (Not isCol) =&gt; Vector isCol -&gt; Double\n</code></pre>\n\n<p>At the call site, the actual value of <code>isCol</code> is known and the compiler will see that this constraint is indeed satisfied. But it seems weird that the implementation details of <code>norm</code> are leaking into the type signature.</p>\n\n<p><strong>My question</strong>: is it possible to somehow convince the compiler that <code>isCol ~ Not (Not isCol)</code> is always true, so that the superfluous constraint is not necessary? </p>\n"}, {"tags": ["haskell", "pattern-guards"], "comments": [{"owner": {"reputation": 23444, "user_id": 414413, "user_type": "registered", "accept_rate": 79, "profile_image": "https://www.gravatar.com/avatar/6de2113f01432aa844dc85070ff33e89?s=128&d=identicon&r=PG", "display_name": "Cirdec", "link": "https://stackoverflow.com/users/414413/cirdec"}, "edited": false, "score": 3, "creation_date": 1442677350, "post_id": 32670047, "comment_id": 53185889, "body": "Can you include the context above the <code>fibo</code> definition? Why is it indented?"}, {"owner": {"reputation": 44013, "user_id": 1477667, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/trgKM.jpg?s=128&g=1", "display_name": "dfeuer", "link": "https://stackoverflow.com/users/1477667/dfeuer"}, "edited": false, "score": 1, "creation_date": 1442681514, "post_id": 32670047, "comment_id": 53187296, "body": "In GHC before 7.10, use <code>-fwarn-tabs</code>. In more recent GHC, pay attention to this warning, which is now enabled by default. And don&#39;t use tabs."}, {"owner": {"reputation": 44013, "user_id": 1477667, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/trgKM.jpg?s=128&g=1", "display_name": "dfeuer", "link": "https://stackoverflow.com/users/1477667/dfeuer"}, "edited": false, "score": 0, "creation_date": 1442698775, "post_id": 32670047, "comment_id": 53192605, "body": "BTW, you should probably enable <code>ScopedTypeVariables</code> anyway, and learn to use it. It&#39;s a very helpful and friendly extension."}], "answers": [{"tags": [], "owner": {"reputation": 14485, "user_id": 190376, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/cd8280c5e1491b8cf55760750ed97dec?s=128&d=identicon&r=PG", "display_name": "Reid Barton", "link": "https://stackoverflow.com/users/190376/reid-barton"}, "is_accepted": true, "score": 9, "last_activity_date": 1442679922, "creation_date": 1442679922, "answer_id": 32670545, "question_id": 32670047, "link": "https://stackoverflow.com/questions/32670047/suggested-scopedtypevariables-in-a-pattern-type-signature/32670545#32670545", "title": "Suggested ScopedTypeVariables In a pattern type-signature", "body": "<p>The indentation in your program is wrong and StackOverflow's weird treatment of tabs made the indentation in your question wrong in a different way.</p>\n\n<ol>\n<li><p>Your program should be indented like this:</p>\n\n<pre><code>fibo :: (Num z, Ord z) =&gt; z -&gt; z\nfibo d\n  | d &lt;= 0 = 0\n  | ...\n</code></pre>\n\n<p>The first two lines should start in the same column and the lines with guards should be more indented than those lines.</p></li>\n<li><p>The program as displayed in your question is wrong in a different way than the error you mentioned: the lines with guards must be more indented than the preceding lines. This happened because StackOverflow has a nonstandard treatment of tab characters. Don't use tabs.</p></li>\n<li><p>Your error is consistent with GHC viewing your program as indented like this:</p>\n\n<pre><code>fibo :: (Num z, Ord z) =&gt; z -&gt; z\n  fibo d               -- wrong, must start in same column as previous line\n  | d &lt;= 0 = 0\n  | ...\n</code></pre>\n\n<p>We can reconstruct that your original program must have been</p>\n\n<pre><code>&lt;sp&gt;&lt;sp&gt;&lt;sp&gt;&lt;sp&gt;fibo :: (Num z, Ord z) =&gt; z -&gt; z\n&lt;tab&gt;           fibo d\n&lt;tab&gt;           | d &lt;= 0 = 0\n&lt;tab&gt;           | ...\n</code></pre>\n\n<p>Don't use tabs.</p></li>\n</ol>\n"}], "owner": {"reputation": 71, "user_id": 4997619, "user_type": "registered", "accept_rate": 67, "profile_image": "https://www.gravatar.com/avatar/928d254f7c433745785d1e6bd10a63f1?s=128&d=identicon&r=PG&f=1", "display_name": "New_coder", "link": "https://stackoverflow.com/users/4997619/new-coder"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 4505, "favorite_count": 1, "accepted_answer_id": 32670545, "answer_count": 1, "score": 1, "last_activity_date": 1442684697, "creation_date": 1442677030, "last_edit_date": 1442684697, "question_id": 32670047, "link": "https://stackoverflow.com/questions/32670047/suggested-scopedtypevariables-in-a-pattern-type-signature", "title": "Suggested ScopedTypeVariables In a pattern type-signature", "body": "<p>I Started writing Haskell code . \nI tried to write a fibonacci function using Guards - </p>\n\n<pre><code>    fibo :: (Num z, Ord z) =&gt; z -&gt; z\n    fibo d\n    | d &lt;= 0 = 0\n    | d == 1 = 1\n    | otherwise = fibo (d-1) + fibo (d-2)\n</code></pre>\n\n<p>I got this error :-</p>\n\n<p>Illegal type signature: \u2018(Num z, Ord z) => z -> z fibo d\u2019\n Perhaps you intended to use ScopedTypeVariables\nIn a pattern type-signature</p>\n\n<p>However another function - replicate i have written in a similar way which compiled and worked fine . \nI can write fibonacci in another way , but I want to know what the error was </p>\n"}, {"tags": ["haskell"], "comments": [{"owner": {"reputation": 23444, "user_id": 414413, "user_type": "registered", "accept_rate": 79, "profile_image": "https://www.gravatar.com/avatar/6de2113f01432aa844dc85070ff33e89?s=128&d=identicon&r=PG", "display_name": "Cirdec", "link": "https://stackoverflow.com/users/414413/cirdec"}, "edited": false, "score": 1, "creation_date": 1442679193, "post_id": 32670032, "comment_id": 53186539, "body": "This question probably belongs on <a href=\"http://codereview.stackexchange.com/\">codereview.stackexchange.com</a>."}, {"owner": {"reputation": 44013, "user_id": 1477667, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/trgKM.jpg?s=128&g=1", "display_name": "dfeuer", "link": "https://stackoverflow.com/users/1477667/dfeuer"}, "edited": false, "score": 4, "creation_date": 1442681969, "post_id": 32670032, "comment_id": 53187463, "body": "The bigger problem is that &quot;do something to a file if it exists&quot; is an invitation to race conditions and security holes. The correct approach is almost always to do something to the file and catch the exception that is thrown if it doesn&#39;t already exist. This is true regardless of programming language."}], "answers": [{"tags": [], "owner": {"reputation": 23444, "user_id": 414413, "user_type": "registered", "accept_rate": 79, "profile_image": "https://www.gravatar.com/avatar/6de2113f01432aa844dc85070ff33e89?s=128&d=identicon&r=PG", "display_name": "Cirdec", "link": "https://stackoverflow.com/users/414413/cirdec"}, "is_accepted": true, "score": 6, "last_activity_date": 1442681374, "creation_date": 1442681374, "answer_id": 32670753, "question_id": 32670032, "link": "https://stackoverflow.com/questions/32670032/apply-a-function-to-a-file-if-it-exists/32670753#32670753", "title": "Apply a function to a file if it exists", "body": "<p><code>applyToFileIf</code> can be given a more generic type and a more generic name</p>\n\n<pre><code>applyToIf :: Monad m =&gt; (a -&gt; m Bool) -&gt; (a -&gt; m b) -&gt; a -&gt; m (Maybe b)\napplyToIf f g p = f p &gt;&gt;= apply\n  where \n    apply True  = g p &gt;&gt;= (return . Just)\n    apply False = return Nothing\n</code></pre>\n\n<p>In the type of <code>applyToIf</code> we see the composition of two Monads</p>\n\n<pre><code>                                           Maybe is a monad ---v \napplyToIf :: Monad m =&gt; (a -&gt; m Bool) -&gt; (a -&gt; m b) -&gt; a -&gt; m (Maybe b)\n                   ^------------- m is a monad -------------^\n</code></pre>\n\n<p>When we see the composition of two monads, we can expect that it could be replaced with a monad transformer stack and some class describing what that monad transformer adds. The <a href=\"http://hackage.haskell.org/package/transformers/docs/Control-Monad-Trans-Maybe.html#v:MaybeT\"><code>MaybeT</code></a> transformer replaces <code>m (Maybe a)</code></p>\n\n<pre><code>newtype MaybeT m a = MaybeT { runMaybeT :: m (Maybe a) }\n</code></pre>\n\n<p>And adds <code>MonadPlus</code> to what an <code>m</code> can do.</p>\n\n<pre><code>instance (Monad m) =&gt; MonadPlus (MaybeT m) where ...\n</code></pre>\n\n<p>We'll change the type of <code>applyToIf</code> to not have a composition of two monads and instead have a <code>MonadPlus</code> constraint on a single monad</p>\n\n<pre><code>import Control.Monad\n\napplyToIf :: MonadPlus m =&gt; (a -&gt; m Bool) -&gt; (a -&gt; m b) -&gt; a -&gt; m b\napplyToIf f g p = f p &gt;&gt;= apply\n  where \n    apply True  = g p\n    apply False = mzero\n</code></pre>\n\n<p>This could be rewritten in terms of <a href=\"http://hackage.haskell.org/packages/archive/base/latest/doc/html/Control-Monad.html#v:guard\"><code>guard</code></a> from <code>Control.Monad</code> and given a more generic name.</p>\n\n<pre><code>guardBy :: MonadPlus m =&gt; (a -&gt; m Bool) -&gt; (a -&gt; m b) -&gt; a -&gt; m b\nguardBy f g p = f p &gt;&gt;= apply\n  where \n    apply b = guard b &gt;&gt; g p\n</code></pre>\n\n<p>The second <code>g</code> argument adds nothing to what <code>guardBy</code> can do. <code>guardBy f g p</code> can be replaced by <code>guardBy f return p &gt;&gt;= g</code>. We will drop the second argument.</p>\n\n<pre><code>guardBy :: MonadPlus m =&gt; (a -&gt; m Bool) -&gt; a -&gt; m a\nguardBy f p = f p &gt;&gt;= \\b -&gt; guard b &gt;&gt; return p\n</code></pre>\n\n<p>The <code>MaybeT</code> transformer adds possible failure to any computation. We can use it to recreate <code>applyToIf</code> or use it more generally to handle failure through complete programs.</p>\n\n<pre><code>import Control.Monad.Trans.Class\nimport Control.Monad.Trans.Maybe\n\napplyToIf ::  Monad m =&gt; (a -&gt; m Bool) -&gt; (a -&gt; m b) -&gt; a -&gt; m (Maybe b)\napplyToIf f g = runMaybeT . (&gt;&gt;= lift . g) . guardBy (lift . f)\n</code></pre>\n\n<p>If you instead rework the program to use monad style classes, it might include a snippet like</p>\n\n<pre><code>import Control.Monad.IO.Class\n\n(MonadPlus m, MonadIO m) =&gt;\n    ...\n    guardBy (liftIO . doesFileExist) filename &gt;&gt;= liftIO . readFile\n</code></pre>\n"}], "owner": {"reputation": 2464, "user_id": 1076715, "user_type": "registered", "accept_rate": 94, "profile_image": "https://www.gravatar.com/avatar/cf07aa4cdf24f3a770c21cb26e61bc7f?s=128&d=identicon&r=PG", "display_name": "Eric", "link": "https://stackoverflow.com/users/1076715/eric"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 90, "favorite_count": 0, "accepted_answer_id": 32670753, "answer_count": 1, "score": 4, "last_activity_date": 1442681374, "creation_date": 1442676961, "question_id": 32670032, "link": "https://stackoverflow.com/questions/32670032/apply-a-function-to-a-file-if-it-exists", "title": "Apply a function to a file if it exists", "body": "<p>I have a function that apply a function to a file if it exists:</p>\n\n<pre><code>import System.Directory\nimport Data.Maybe\n\napplyToFile :: (FilePath -&gt; IO a) -&gt; FilePath -&gt; IO (Maybe a)\napplyToFile f p = doesFileExist p &gt;&gt;= apply\n  where \n    apply True  = f p &gt;&gt;= (pure . Just)\n    apply False = pure Nothing\n</code></pre>\n\n<p>Usage example:</p>\n\n<pre><code>applyToFile readFile \"/tmp/foo\"\napplyToFile (\\p -&gt; writeFile p \"bar\") \"/tmp/foo\"\n</code></pre>\n\n<p>A level of abstraction can be added with:</p>\n\n<pre><code>import System.Directory\nimport Data.Maybe\n\napplyToFileIf :: (FilePath -&gt; IO Bool) -&gt; (FilePath -&gt; IO a) -&gt;  FilePath -&gt; IO (Maybe a)\napplyToFileIf f g p = f p &gt;&gt;= apply\n  where \n    apply True  = g p &gt;&gt;= (pure . Just)\n    apply False = pure Nothing\n\napplyToFile :: (FilePath -&gt; IO a) -&gt; FilePath -&gt; IO (Maybe a)\napplyToFile f p = applyToFileIf doesFileExist f p \n</code></pre>\n\n<p>That allow usages like:</p>\n\n<pre><code>applyToFileIf (\\p -&gt; doesFileExist p &gt;&gt;= (pure . not)) (\\p -&gt; writeFile p \"baz\") \"/tmp/baz\"\n</code></pre>\n\n<p>I have the feeling that I just scratched the surface and there is a more generic pattern hiding.<br>\nAre there better abstractions or more idiomatic ways to do this?</p>\n"}, {"tags": ["haskell", "vector", "monads", "ghc", "mutable"], "answers": [{"comments": [{"owner": {"reputation": 11, "user_id": 5353860, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/e95b9e94b14a09b5b217f7fcadbcbdf8?s=128&d=identicon&r=PG&f=1", "display_name": "HaskellEnthusiast", "link": "https://stackoverflow.com/users/5353860/haskellenthusiast"}, "edited": false, "score": 0, "creation_date": 1442688317, "post_id": 32670283, "comment_id": 53189502, "body": "Thank you that is exactly what I needed."}, {"owner": {"reputation": 44013, "user_id": 1477667, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/trgKM.jpg?s=128&g=1", "display_name": "dfeuer", "link": "https://stackoverflow.com/users/1477667/dfeuer"}, "edited": false, "score": 0, "creation_date": 1442708004, "post_id": 32670283, "comment_id": 53194384, "body": "What&#39;s hard about <code>ST</code>?"}], "tags": [], "owner": {"reputation": 49959, "user_id": 866915, "user_type": "registered", "accept_rate": 70, "profile_image": "https://www.gravatar.com/avatar/09242131d6e17cbbe31e8547514da6e5?s=128&d=identicon&r=PG", "display_name": "ErikR", "link": "https://stackoverflow.com/users/866915/erikr"}, "is_accepted": false, "score": 2, "last_activity_date": 1442678413, "creation_date": 1442678413, "answer_id": 32670283, "question_id": 32669586, "link": "https://stackoverflow.com/questions/32669586/using-par-monad-parmapm-on-mutable-vector/32670283#32670283", "title": "Using par monad (parMapM) on mutable vector", "body": "<p>Try this:</p>\n\n<pre><code>import qualified Data.Vector as V\nimport qualified Data.Vector.Mutable as M\nimport Control.Monad.Par as Par\nimport Control.Monad\nimport Control.Monad.Par.IO as ParIO\nimport Control.Monad.Trans (liftIO)\n\na = V.fromList [1,2,3,4,5,6]\n\nfoo = do\n  mv &lt;- V.unsafeThaw a\n  ParIO.runParIO $ parMapM (\\i -&gt; liftIO $ M.write mv i 100) [0..5]\n  V.unsafeFreeze mv\n</code></pre>\n\n<p>Note that you can only perform <code>M.write</code> in the IO or ST monads. IO is certainly the easier of the two to handle.</p>\n"}], "owner": {"reputation": 11, "user_id": 5353860, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/e95b9e94b14a09b5b217f7fcadbcbdf8?s=128&d=identicon&r=PG&f=1", "display_name": "HaskellEnthusiast", "link": "https://stackoverflow.com/users/5353860/haskellenthusiast"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 162, "favorite_count": 0, "answer_count": 1, "score": 1, "last_activity_date": 1442678413, "creation_date": 1442674209, "question_id": 32669586, "link": "https://stackoverflow.com/questions/32669586/using-par-monad-parmapm-on-mutable-vector", "title": "Using par monad (parMapM) on mutable vector", "body": "<p>I've been trying for hours but can't seem to get this to compile. I'm trying to do a simple operation in parallel to a mutable vector, but I get compile errors. </p>\n\n<pre><code>import qualified Data.Vector as V\nimport qualified Data.Vector.Mutable as M\nimport Control.Monad.Par as Par\nimport Control.Monad\n\na = V.fromList [1,2,3,4,5,6]\n\nb = do\n    c &lt;- V.unsafeThaw a\n    runPar $ parMapM\n        (liftM (\\i -&gt; M.write c i 100))\n        [0..5]\n    return $ V.unsafeFreeze c\n</code></pre>\n\n<p>On the line \"c &lt;- V.unsafeThaw a\" I get the compile error</p>\n\n<blockquote>\n<pre><code> Couldn't match type `primitive-0.5.2.1:Control.Monad.Primitive.PrimState     []'\n                 with `primitive-0.5.2.1:Control.Monad.Primitive.PrimState m0'\n   NB: `primitive-0.5.2.1:Control.Monad.Primitive.PrimState' is a type function, and may not be injective\n   The type variable `m0' is ambiguous\n   Expected type: [M.MVector\n                     (primitive-0.5.2.1:Control.Monad.Primitive.PrimState m0) Integer]\n     Actual type: [M.MVector\n                     (primitive-0.5.2.1:Control.Monad.Primitive.PrimState []) Integer]\n   In a stmt of a 'do' block: c &lt;- V.unsafeThaw a\n   In the expression:\n     do { c &lt;- V.unsafeThaw a;\n          runPar $ parMapM (liftM (\\ i -&gt; M.write c i 100)) [0 .. 5];\n          return $ V.unsafeFreeze c }\n</code></pre>\n</blockquote>\n\n<p>On the line \"return $ V.unsafeFreeze c\" I get error</p>\n\n<blockquote>\n<pre><code>   Couldn't match type `primitive-0.5.2.1:Control.Monad.Primitive.PrimState m1'\n                 with `primitive-0.5.2.1:Control.Monad.Primitive.PrimState m0'\n   NB: `primitive-0.5.2.1:Control.Monad.Primitive.PrimState' is a type function, and may not be injective\n   The type variables `m0', `m1' are ambiguous\n   Expected type: M.MVector\n                    (primitive-0.5.2.1:Control.Monad.Primitive.PrimState m1) Integer\n     Actual type: M.MVector\n                    (primitive-0.5.2.1:Control.Monad.Primitive.PrimState m0) Integer\n   Relevant bindings include\n     c :: M.MVector\n            (primitive-0.5.2.1:Control.Monad.Primitive.PrimState m0) Integer\n       (bound at C:\\Users\\Administrator\\workspace\\test\\src\\Main.hs:11:5)\n     b :: [m1 (V.Vector Integer)]\n       (bound at C:\\Users\\Administrator\\workspace\\test\\src\\Main.hs:10:1)\n   In the first argument of `V.unsafeFreeze', namely `c'\n   In the second argument of `($)', namely `V.unsafeFreeze c'\n</code></pre>\n</blockquote>\n\n<p>Could you help me find out what I'm doing wrong?</p>\n"}, {"tags": ["haskell"], "comments": [{"owner": {"reputation": 10378, "user_id": 2476735, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/39e9447bbc32246fcd23b76b5e946618?s=128&d=identicon&r=PG&f=1", "display_name": "David Young", "link": "https://stackoverflow.com/users/2476735/david-young"}, "edited": false, "score": 0, "creation_date": 1442673964, "post_id": 32668969, "comment_id": 53184673, "body": "The diagrams in <a href=\"http://stackoverflow.com/a/2169743/2476735\">this answer</a> might help."}], "answers": [{"tags": [], "owner": {"reputation": 49959, "user_id": 866915, "user_type": "registered", "accept_rate": 70, "profile_image": "https://www.gravatar.com/avatar/09242131d6e17cbbe31e8547514da6e5?s=128&d=identicon&r=PG", "display_name": "ErikR", "link": "https://stackoverflow.com/users/866915/erikr"}, "is_accepted": false, "score": 5, "last_activity_date": 1442674600, "last_edit_date": 1442674600, "creation_date": 1442673899, "answer_id": 32669531, "question_id": 32668969, "link": "https://stackoverflow.com/questions/32668969/trace-can-give-inversion-of-processing-in-folds/32669531#32669531", "title": "trace can give &#39;inversion&#39; of processing in folds", "body": "<p>The expression <code>foldl (+) 0 [1..3]</code> creates the following expression tree:</p>\n\n<pre><code>              +\n             / \\\n            +   3\n           / \\\n          +   2\n         / \\\n        0   1\n</code></pre>\n\n<p>In your case both <code>_sum</code> and <code>_sum2</code> build a tree like this:</p>\n\n<pre><code>              tr\n             / \\\n            tr  3\n           / \\\n          tr   2\n         / \\\n        0   1\n</code></pre>\n\n<p>Here <code>tr</code> is the function in the fold which does the accumulation\nand tracing.</p>\n\n<h1>_sum2</h1>\n\n<p>The first operation to be visited is the <code>tr ___ 3</code> at top of the tree.\nThe 3 is <code>x</code> and ___ is <code>acc</code> in the <code>tr</code> function.</p>\n\n<p>When this happens in <code>_sum2</code> the 3 is printed.</p>\n\n<p>Then <code>acc</code> is evaluated, so <code>tr ___ 2</code> is evaluated which results in 2 getting displayed.</p>\n\n<p>Then <code>tr ___ 1</code> is evaluated, so 1 is printed.</p>\n\n<h1>_sum</h1>\n\n<p>However, in <code>_sum</code> a difference course of events unfolds (no pun intended).</p>\n\n<p>We again start at the top of the tree: <code>tr ___ 3</code>.</p>\n\n<p><strong>Step 1)</strong>\nSince in <code>_sum</code> you are also printing out <code>acc</code>, Haskell needs to\nevaluate it, i.e. <code>tr ___ 2</code>.\nWhen this evaluation is complete it will print out <code>acc</code> and then 3.</p>\n\n<p><strong>Step 2)</strong>\nTo evaluate <code>tr ___ 2</code>, since you are printing out the <code>acc</code>, Haskell needs to evaluate it, i.e. the tree to the left of the 2 - namely <code>tr ___ 1</code>.\nWhen this evaluation is complete it will print out <code>acc</code> and then 2.</p>\n\n<p><strong>Step 3)</strong>\nTo evaluate <code>tr ___ 1</code>, since you are printing out the <code>acc</code>, Haskell needs to evaluate the tree to the left of the 1, i.e. 0.\nWhen this evaluation is complete it will print out <code>acc</code> and then 1.\nIn this case 0 is already evaluated, so it prints out 0 and then 1.</p>\n\n<p>Control then transfers back to step 2 and <code>acc</code> is displayed (1) and then 2.</p>\n\n<p>Control then transfers back to step 1 and <code>acc</code> is displayed (3) and the 3.</p>\n"}], "owner": {"reputation": 71, "user_id": 5353578, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/30fb3bbfb2c4cd7927021dc1784f0ce8?s=128&d=identicon&r=PG&f=1", "display_name": "Mike JAMES", "link": "https://stackoverflow.com/users/5353578/mike-james"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 77, "favorite_count": 0, "answer_count": 1, "score": 7, "last_activity_date": 1442737974, "creation_date": 1442670512, "last_edit_date": 1442671166, "question_id": 32668969, "link": "https://stackoverflow.com/questions/32668969/trace-can-give-inversion-of-processing-in-folds", "title": "trace can give &#39;inversion&#39; of processing in folds", "body": "<p>When I compile the \"modified sum\" (\u00ab _sum_folds.hs \u00bb) file :</p>\n\n<pre><code>*--------------------------- [\n\nimport Debug.Trace \n\n_sum = \n    foldl ( \\ acc x -&gt; \n            trace (\n              show x\n              ++ \" - \" ++ show acc\n              )\n          acc + x\n        ) \n        0\n\n*--------------------------- ]\n\n[1 of 1] Compiling Main             ( _sum_folds .hs, interpreted )\nOk, modules loaded: Main.\n</code></pre>\n\n<p>... and apply it to '[1..5]', I get :</p>\n\n<pre><code>*Main &gt; _sum ([1..5])\n\n* 1 - 0\n* 2 - 1\n* 3 - 3\n* 4 - 6\n* 5 - 10\n* 15\n* it :: Integer\n</code></pre>\n\n<p>(order for a 'foldl' process is OK ...)</p>\n\n<p>If I remove the &lt; ++ \" - \" ++ show acc > ,\nI get :</p>\n\n<p>( we have only &lt; trace (show x) > ) </p>\n\n<pre><code>*Main &gt; _sum ([1..5])\n\n* 5\n* 4\n* 3\n* 2\n* 1\n* 15\n* it :: Integer\n</code></pre>\n\n<p>... : the order of processing of the elements inside &lt; [1..5] > (the 'x's) seems have been inverted (it is a 'foldl')...!?</p>\n\n<p>What does it mean ?</p>\n"}, {"tags": ["performance", "haskell", "vector", "bytestring"], "comments": [{"owner": {"reputation": 33184, "user_id": 247623, "user_type": "registered", "accept_rate": 72, "profile_image": "https://www.gravatar.com/avatar/bb9e67348d3e0e93ef12dd97c41a6c22?s=128&d=identicon&r=PG&f=1", "display_name": "Erik Kaplun", "link": "https://stackoverflow.com/users/247623/erik-kaplun"}, "edited": false, "score": 3, "creation_date": 1442669449, "post_id": 32668144, "comment_id": 53183048, "body": "you shouldn&#39;t <i>demand</i> a complete working solution as answer. SO is a learning and problem understanding site not a crowd sourced coding service."}, {"owner": {"reputation": 845, "user_id": 4725700, "user_type": "registered", "accept_rate": 72, "profile_image": "https://www.gravatar.com/avatar/b517b68a2f6eee6dc160661a0e78e4ce?s=128&d=identicon&r=PG&f=1", "display_name": "mntk123", "link": "https://stackoverflow.com/users/4725700/mntk123"}, "reply_to_user": {"reputation": 33184, "user_id": 247623, "user_type": "registered", "accept_rate": 72, "profile_image": "https://www.gravatar.com/avatar/bb9e67348d3e0e93ef12dd97c41a6c22?s=128&d=identicon&r=PG&f=1", "display_name": "Erik Kaplun", "link": "https://stackoverflow.com/users/247623/erik-kaplun"}, "edited": false, "score": 1, "creation_date": 1442671865, "post_id": 32668144, "comment_id": 53183864, "body": "@ErikAllik I am demanding complete working solution in the same spirit of Smallest Complete Working Example. Also I do give minimum working example. Another reason is the rarity of working examples on the Haskell sites. The problems I ask solutions for are generally very small snippets, hardly sufficient to accusing me of crowd sourcing code. The SO is great and Haskell docuemntation is poor is why I need to make that <i>demand</i>. I apologize if it has hurt/offended or caused undue distress to someone."}, {"owner": {"reputation": 44013, "user_id": 1477667, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/trgKM.jpg?s=128&g=1", "display_name": "dfeuer", "link": "https://stackoverflow.com/users/1477667/dfeuer"}, "edited": false, "score": 0, "creation_date": 1442674434, "post_id": 32668144, "comment_id": 53184864, "body": "Yes, this is slow because <code>V.cons</code> is O(n). What did you expect? A million times a million is a lot! <code>vector</code> has perfectly good documentation. Note that the documentation for a Hackage module generally has a table of contents in the upper right. Check out the section on constructing vectors."}, {"owner": {"reputation": 845, "user_id": 4725700, "user_type": "registered", "accept_rate": 72, "profile_image": "https://www.gravatar.com/avatar/b517b68a2f6eee6dc160661a0e78e4ce?s=128&d=identicon&r=PG&f=1", "display_name": "mntk123", "link": "https://stackoverflow.com/users/4725700/mntk123"}, "reply_to_user": {"reputation": 44013, "user_id": 1477667, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/trgKM.jpg?s=128&g=1", "display_name": "dfeuer", "link": "https://stackoverflow.com/users/1477667/dfeuer"}, "edited": false, "score": 0, "creation_date": 1442679528, "post_id": 32668144, "comment_id": 53186652, "body": "@dfeuer I expected it to be slow. But I didn&#39;t know any other method to construct the vector by incrementally adding elements to it as I go on reading values from the bytestring. As for why did I ask the question: I didn&#39;t understand any other method given on the hackage that can allow me to incrementally construct the vector as desired."}, {"owner": {"reputation": 44013, "user_id": 1477667, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/trgKM.jpg?s=128&g=1", "display_name": "dfeuer", "link": "https://stackoverflow.com/users/1477667/dfeuer"}, "edited": false, "score": 1, "creation_date": 1442681243, "post_id": 32668144, "comment_id": 53187215, "body": "Well, you basically <i>can&#39;t</i> construct a vector by incrementally adding to it! They&#39;re more like C or C++ arrays or FORTRAN vectors than like the flexible things some other environments call vectors. You can get such flexible things in Haskell if you like; the traditional one is <code>Data.Sequence</code>, but Ed Kmett&#39;s been working on some faster ones lately."}], "answers": [{"comments": [{"owner": {"reputation": 49959, "user_id": 866915, "user_type": "registered", "accept_rate": 70, "profile_image": "https://www.gravatar.com/avatar/09242131d6e17cbbe31e8547514da6e5?s=128&d=identicon&r=PG", "display_name": "ErikR", "link": "https://stackoverflow.com/users/866915/erikr"}, "edited": false, "score": 0, "creation_date": 1442669067, "post_id": 32668618, "comment_id": 53182921, "body": "Note that using <code>size &lt;- hFileSize h</code> might be a more portable way to get a file&#39;s size and doesn&#39;t require <code>System.Posix</code>"}, {"owner": {"reputation": 845, "user_id": 4725700, "user_type": "registered", "accept_rate": 72, "profile_image": "https://www.gravatar.com/avatar/b517b68a2f6eee6dc160661a0e78e4ce?s=128&d=identicon&r=PG&f=1", "display_name": "mntk123", "link": "https://stackoverflow.com/users/4725700/mntk123"}, "edited": false, "score": 0, "creation_date": 1442669480, "post_id": 32668618, "comment_id": 53183062, "body": "the <code>readVector2</code> function uses lists and <code>readVector1</code> is too much work in IO."}, {"owner": {"reputation": 49959, "user_id": 866915, "user_type": "registered", "accept_rate": 70, "profile_image": "https://www.gravatar.com/avatar/09242131d6e17cbbe31e8547514da6e5?s=128&d=identicon&r=PG", "display_name": "ErikR", "link": "https://stackoverflow.com/users/866915/erikr"}, "reply_to_user": {"reputation": 845, "user_id": 4725700, "user_type": "registered", "accept_rate": 72, "profile_image": "https://www.gravatar.com/avatar/b517b68a2f6eee6dc160661a0e78e4ce?s=128&d=identicon&r=PG&f=1", "display_name": "mntk123", "link": "https://stackoverflow.com/users/4725700/mntk123"}, "edited": false, "score": 0, "creation_date": 1442669714, "post_id": 32668618, "comment_id": 53183129, "body": "Both run in less than a second when compiled on my machine. How long does it take on yours?"}, {"owner": {"reputation": 2271, "user_id": 4994500, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/233389523330bec1d6e95f4c480d5741?s=128&d=identicon&r=PG&f=1", "display_name": "Sam van Herwaarden", "link": "https://stackoverflow.com/users/4994500/sam-van-herwaarden"}, "edited": false, "score": 0, "creation_date": 1442671092, "post_id": 32668618, "comment_id": 53183624, "body": "@user5402: You changed quite a bit about the code - would you mind explaining what the most important change(s) was/were for improving the performance? (I&#39;m curious)"}, {"owner": {"reputation": 49959, "user_id": 866915, "user_type": "registered", "accept_rate": 70, "profile_image": "https://www.gravatar.com/avatar/09242131d6e17cbbe31e8547514da6e5?s=128&d=identicon&r=PG", "display_name": "ErikR", "link": "https://stackoverflow.com/users/866915/erikr"}, "edited": false, "score": 1, "creation_date": 1442674269, "post_id": 32668618, "comment_id": 53184806, "body": "I think the main takeaway is that Vec.cons is probably inefficient. At first I though you should tell Vector the length you need - hence the first version. However, <code>unfold</code> also works pretty well. The main difference between <code>unfoldr</code> and <code>cons</code> is that <code>unfoldr</code> appends to a vector which is a more natural operation and thus I think more efficient. <code>cons</code>, however, I believe has to prepend to a vector which is not the natural way for vectors to grow."}, {"owner": {"reputation": 44013, "user_id": 1477667, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/trgKM.jpg?s=128&g=1", "display_name": "dfeuer", "link": "https://stackoverflow.com/users/1477667/dfeuer"}, "edited": false, "score": 0, "creation_date": 1442675600, "post_id": 32668618, "comment_id": 53185278, "body": "No. unfoldr just uses the traditional array doubling trick to achieve O(1) amortized time per <code>snoc</code> even though it may have to double the size of the array several times, copying the whole thing each time."}, {"owner": {"reputation": 49959, "user_id": 866915, "user_type": "registered", "accept_rate": 70, "profile_image": "https://www.gravatar.com/avatar/09242131d6e17cbbe31e8547514da6e5?s=128&d=identicon&r=PG", "display_name": "ErikR", "link": "https://stackoverflow.com/users/866915/erikr"}, "edited": false, "score": 0, "creation_date": 1442676067, "post_id": 32668618, "comment_id": 53185420, "body": "Yeah - but my point it that it seems to be a <i>lot</i> better than using <code>cons</code>."}, {"owner": {"reputation": 44013, "user_id": 1477667, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/trgKM.jpg?s=128&g=1", "display_name": "dfeuer", "link": "https://stackoverflow.com/users/1477667/dfeuer"}, "edited": false, "score": 1, "creation_date": 1442680835, "post_id": 32668618, "comment_id": 53187082, "body": "Well yes, certainly it is! But the same technique could be applied to fill a vector from back to front instead. <code>cons</code> has to copy the whole vector each time. <code>unfoldr</code> saves itself some wiggle room so it can afford the occasional copy without blowing the asymptotic bound. Prepend vs. append has nothing to do with it."}, {"owner": {"reputation": 845, "user_id": 4725700, "user_type": "registered", "accept_rate": 72, "profile_image": "https://www.gravatar.com/avatar/b517b68a2f6eee6dc160661a0e78e4ce?s=128&d=identicon&r=PG&f=1", "display_name": "mntk123", "link": "https://stackoverflow.com/users/4725700/mntk123"}, "edited": false, "score": 0, "creation_date": 1442681070, "post_id": 32668618, "comment_id": 53187160, "body": "@user5402 I liked and upvoted your answer but what bothers me is the IO part in the <code>readVector1</code>. If you give the code for reading vector that just takes ByteString (you can find its size) and then returns a vector filled in with the values I will accept it. I am struggling myself to get that type of code using your code but unable to remove the IO from it."}, {"owner": {"reputation": 49959, "user_id": 866915, "user_type": "registered", "accept_rate": 70, "profile_image": "https://www.gravatar.com/avatar/09242131d6e17cbbe31e8547514da6e5?s=128&d=identicon&r=PG", "display_name": "ErikR", "link": "https://stackoverflow.com/users/866915/erikr"}, "edited": false, "score": 0, "creation_date": 1442682160, "post_id": 32668618, "comment_id": 53187532, "body": "Ok - watch this space."}, {"owner": {"reputation": 49959, "user_id": 866915, "user_type": "registered", "accept_rate": 70, "profile_image": "https://www.gravatar.com/avatar/09242131d6e17cbbe31e8547514da6e5?s=128&d=identicon&r=PG", "display_name": "ErikR", "link": "https://stackoverflow.com/users/866915/erikr"}, "edited": false, "score": 0, "creation_date": 1442682558, "post_id": 32668618, "comment_id": 53187677, "body": "Have a look at <code>readVector3</code>. Adjust the offset formulas <code>2*i</code>, <code>2*i+1</code> and the length determination <code>div size 2</code> to account for any header bytes you want to skip over."}, {"owner": {"reputation": 845, "user_id": 4725700, "user_type": "registered", "accept_rate": 72, "profile_image": "https://www.gravatar.com/avatar/b517b68a2f6eee6dc160661a0e78e4ce?s=128&d=identicon&r=PG&f=1", "display_name": "mntk123", "link": "https://stackoverflow.com/users/4725700/mntk123"}, "edited": false, "score": 0, "creation_date": 1442683886, "post_id": 32668618, "comment_id": 53188141, "body": "@user5402 I accept this answer. I cannot upvote it more than once. You have taught me many things thru the answer."}], "tags": [], "owner": {"reputation": 49959, "user_id": 866915, "user_type": "registered", "accept_rate": 70, "profile_image": "https://www.gravatar.com/avatar/09242131d6e17cbbe31e8547514da6e5?s=128&d=identicon&r=PG", "display_name": "ErikR", "link": "https://stackoverflow.com/users/866915/erikr"}, "is_accepted": true, "score": 2, "last_activity_date": 1442682443, "last_edit_date": 1442682443, "creation_date": 1442668249, "answer_id": 32668618, "question_id": 32668144, "link": "https://stackoverflow.com/questions/32668144/haskell-reading-a-vector-of-pairs-from-bytestring-very-slow-how-to-make-it-fast/32668618#32668618", "title": "haskell reading a vector of pairs from bytestring very slow, how to make it faster?", "body": "<p>Here are a couple of examples of creating Vectors from files. They are not the most efficient, but both run in just a couple of seconds in ghci.</p>\n\n<pre><code>module Main where\n\nimport qualified Data.ByteString.Lazy as BIN\nimport qualified Data.ByteString as BS\nimport qualified Data.Vector.Unboxed as Vec\nimport System.IO\nimport System.Posix\n\ngetFileSize :: String -&gt; IO Int\ngetFileSize path = do\n    stat &lt;- getFileStatus path\n    return (fromEnum $ fileSize stat)\n\nreadVector1 path = do\n  size &lt;- getFileSize path\n  withBinaryFile path ReadMode $ \\h -&gt; do\n    -- can also use: size &lt;- hFileSize h\n    let go _ = do bs &lt;- BS.hGet h 2 \n                  return (BS.index bs 0, BS.index bs 1)\n    Vec.generateM (div size 2) go\n\npairs (a:b:rest) = (a,b) : pairs rest\npairs _          = []\n\nreadVector2 path = do\n  contents &lt;- BIN.readFile path\n  -- unfoldr :: Unbox a =&gt; (b -&gt; Maybe (a, b)) -&gt; b -&gt; Vector a\n  let v = Vec.unfoldr go (pairs $ BIN.unpack contents)\n        where go [] = Nothing\n              go (p:ps) = Just (p, ps)\n  return v\n\nmain = do\n  v &lt;- readVector1 \"rand\" -- large file\n  print $ Vec.length v\n  v &lt;- readVector2 \"rand\"\n  print $ Vec.length v\n</code></pre>\n\n<p>A third alternative:</p>\n\n<pre><code>readVector3 path = do\n  contents &lt;- BS.readFile path\n  let size = BS.length contents\n      v = Vec.generate (div (fromIntegral size) 2) go\n            where go i = let a = BS.index contents (2*i)\n                             b = BS.index contents (2*i+1)\n                         in (a,b)\n  return v\n</code></pre>\n\n<p>This one turns out to be the fastest of the three.</p>\n"}, {"comments": [{"owner": {"reputation": 49959, "user_id": 866915, "user_type": "registered", "accept_rate": 70, "profile_image": "https://www.gravatar.com/avatar/09242131d6e17cbbe31e8547514da6e5?s=128&d=identicon&r=PG", "display_name": "ErikR", "link": "https://stackoverflow.com/users/866915/erikr"}, "edited": false, "score": 0, "creation_date": 1442681877, "post_id": 32669650, "comment_id": 53187429, "body": "It&#39;s an elegant solution - I really like it, but when I benchmark it takes about 2 secs to consume a 1 MB file whereas the reading two bytes at a time method takes about about 0.1 secs. Is that what you&#39;re seeing?"}], "tags": [], "owner": {"reputation": 24211, "user_id": 1364288, "user_type": "registered", "accept_rate": 88, "profile_image": "https://i.stack.imgur.com/JVtNl.png?s=128&g=1", "display_name": "danidiaz", "link": "https://stackoverflow.com/users/1364288/danidiaz"}, "is_accepted": false, "score": 2, "last_activity_date": 1442675570, "last_edit_date": 1442675570, "creation_date": 1442674632, "answer_id": 32669650, "question_id": 32668144, "link": "https://stackoverflow.com/questions/32668144/haskell-reading-a-vector-of-pairs-from-bytestring-very-slow-how-to-make-it-fast/32669650#32669650", "title": "haskell reading a vector of pairs from bytestring very slow, how to make it faster?", "body": "<p>Here's an alternative approach for loading the vector, that uses <code>pipes</code> and <code>pipes-bytestring</code> to stream the file, and the <a href=\"http://hackage.haskell.org/package/foldl-1.1.1/docs/Control-Foldl.html#v:vector\" rel=\"nofollow\"><code>vector</code></a> function from <code>foldl</code> to create the vector:</p>\n\n<pre><code>{-# LANGUAGE PackageImports #-}\nimport Data.Functor (void)\nimport \"pipes\" Pipes\nimport qualified \"pipes\" Pipes.Prelude as P\nimport qualified \"pipes-bytestring\" Pipes.ByteString as B\nimport qualified \"pipes-binary\" Pipes.Binary as B\nimport qualified \"vector\" Data.Vector.Unboxed as V\nimport qualified \"foldl\" Control.Foldl as L\nimport \"lens-family-core\" Lens.Family (view)\nimport System.IO\n\nmain :: IO ()\nmain = do\n    v &lt;- withBinaryFile \"somefile\" ReadMode (\\h -&gt;\n        -- for simplicity, errors are ignored with \"void\"\n        L.impurely P.foldM L.vector (void (view B.decoded (B.drop 1 (B.fromHandle h)))))\n    print (V.length (v::V.Vector (B.Word8,B.Word8)))\n</code></pre>\n\n<p><code>cons</code> is inefficient. The approach taken by <code>foldl</code>'s <code>vector</code> is to progressively double the vector's capacity using <a href=\"http://hackage.haskell.org/package/vector-0.11.0.0/docs/Data-Vector-Generic-Mutable.html#v:unsafeGrow\" rel=\"nofollow\"><code>unsafeGrow</code></a>, in order to accomodate incoming values, and at the end \"trim\" any excess capacity with <a href=\"http://hackage.haskell.org/package/vector-0.11.0.0/docs/Data-Vector-Mutable.html#v:unsafeTake\" rel=\"nofollow\"><code>unsafeTake</code></a>. </p>\n"}], "owner": {"reputation": 845, "user_id": 4725700, "user_type": "registered", "accept_rate": 72, "profile_image": "https://www.gravatar.com/avatar/b517b68a2f6eee6dc160661a0e78e4ce?s=128&d=identicon&r=PG&f=1", "display_name": "mntk123", "link": "https://stackoverflow.com/users/4725700/mntk123"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 211, "favorite_count": 0, "accepted_answer_id": 32668618, "answer_count": 2, "score": 3, "last_activity_date": 1442682443, "creation_date": 1442665209, "question_id": 32668144, "link": "https://stackoverflow.com/questions/32668144/haskell-reading-a-vector-of-pairs-from-bytestring-very-slow-how-to-make-it-fast", "title": "haskell reading a vector of pairs from bytestring very slow, how to make it faster?", "body": "<p>I am trying to read a large vector of custom data type from a binary file. I tried to use the <a href=\"https://hackage.haskell.org/package/binary-0.7.6.1/docs/Data-Binary-Get.html\" rel=\"nofollow\">example given here</a>.</p>\n\n<p>The trouble with the example code is, it uses lists and I want to use vectors.\nSo I adapted that code as below, but it takes very long time (more than a minute, I gave up after that) to read even 1 MB file. </p>\n\n<pre><code>module Main where\n\nimport Data.Word\nimport qualified Data.ByteString.Lazy as BIN\nimport Data.Binary.Get\nimport qualified Data.Vector.Unboxed as Vec\n\nmain = do\n  b &lt;- BIN.readFile \"dat.bin\" -- about 1 MB size file\n  let v = runGet getPairs (BIN.tail b) -- skip the first byte\n  putStrLn $ show $ Vec.length v\n\ngetPair :: Get (Word8, Word8)\ngetPair = do\n  price &lt;- getWord8\n  qty &lt;- getWord8\n  return (price, qty)\n\ngetPairs :: Get (Vec.Vector (Word8, Word8))\ngetPairs = do\n empty &lt;- isEmpty\n if empty\n   then return Vec.empty\n   else do pair  &lt;- getPair\n           pairs &lt;- getPairs\n           return (Vec.cons pair pairs) -- is it slow because V.cons is O(n)?\n</code></pre>\n\n<p>When I tried to run it with <code>ghc --make -O2 pairs.hs</code> I got the error <code>Stack space overflow: current size ...</code></p>\n\n<p>How to efficiently read pairs of values from bytestring into vector?</p>\n\n<p>Again, I wish to get complete working code not just only pointers to Haskell site or RWH nor a just list of function/module names.</p>\n"}, {"tags": ["haskell", "module", "cabal", "hsdev"], "comments": [{"owner": {"reputation": 49959, "user_id": 866915, "user_type": "registered", "accept_rate": 70, "profile_image": "https://www.gravatar.com/avatar/09242131d6e17cbbe31e8547514da6e5?s=128&d=identicon&r=PG", "display_name": "ErikR", "link": "https://stackoverflow.com/users/866915/erikr"}, "edited": false, "score": 0, "creation_date": 1442669501, "post_id": 32665903, "comment_id": 53183069, "body": "What version of GHC are you using? And did you try compiling it in a sandbox?"}], "answers": [{"tags": [], "owner": {"reputation": 1084, "user_id": 3893319, "user_type": "registered", "accept_rate": 79, "profile_image": "https://i.stack.imgur.com/wd9aa.jpg?s=128&g=1", "display_name": "Reygoch", "link": "https://stackoverflow.com/users/3893319/reygoch"}, "is_accepted": false, "score": 3, "last_activity_date": 1442675775, "creation_date": 1442675775, "answer_id": 32669852, "question_id": 32665903, "link": "https://stackoverflow.com/questions/32665903/cant-install-hsdev-with-cabal/32669852#32669852", "title": "Can&#39;t install hsdev with cabal", "body": "<p>Ok, I have figured it out. Latest version of ghc-mod is not compatible with hsdev, so I had to add constraint for it:</p>\n\n<pre><code>ghc-mod &gt;= 5.3.0.0 &amp;&amp; &lt; 5.4.0.0\n</code></pre>\n"}], "owner": {"reputation": 1084, "user_id": 3893319, "user_type": "registered", "accept_rate": 79, "profile_image": "https://i.stack.imgur.com/wd9aa.jpg?s=128&g=1", "display_name": "Reygoch", "link": "https://stackoverflow.com/users/3893319/reygoch"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 1072, "favorite_count": 0, "answer_count": 1, "score": 1, "last_activity_date": 1460311627, "creation_date": 1442650416, "last_edit_date": 1460311627, "question_id": 32665903, "link": "https://stackoverflow.com/questions/32665903/cant-install-hsdev-with-cabal", "title": "Can&#39;t install hsdev with cabal", "body": "<p>I'm on Arch, and I'm trying to install <code>hsdev</code> with cabal (<code>cabal install hsdev</code>), but when it starts compiling and it gets to compiling <code>HsDev.Tools.GhcMod</code> I get following message :</p>\n\n<pre><code>[46 of 58] Compiling HsDev.Tools.GhcMod ( src/HsDev/Tools/GhcMod.hs, dist/build/HsDev/Tools/GhcMod.o )\n\nsrc/HsDev/Tools/GhcMod.hs:64:54:\n    \u2018GhcMod.ghcUserOptions\u2019 is not a (visible) constructor field name\n\nsrc/HsDev/Tools/GhcMod.hs:73:34:\n    \u2018GhcMod.detailed\u2019 is not a (visible) constructor field name\n\nsrc/HsDev/Tools/GhcMod.hs:73:58:\n    \u2018GhcMod.qualified\u2019 is not a (visible) constructor field name\n\nsrc/HsDev/Tools/GhcMod.hs:73:83:\n    \u2018GhcMod.ghcUserOptions\u2019 is not a (visible) constructor field name\n\nsrc/HsDev/Tools/GhcMod.hs:118:38:\n    \u2018GhcMod.ghcUserOptions\u2019 is not a (visible) constructor field name\n\nsrc/HsDev/Tools/GhcMod.hs:176:58:\n    \u2018GhcMod.ghcUserOptions\u2019 is not a (visible) constructor field name\n\nsrc/HsDev/Tools/GhcMod.hs:221:32:\n    \u2018GhcMod.ghcUserOptions\u2019 is not a (visible) constructor field name\n\nsrc/HsDev/Tools/GhcMod.hs:228:32:\n    \u2018GhcMod.hlintOpts\u2019 is not a (visible) constructor field name\ncabal: Error: some packages failed to install:\nhsdev-0.1.4.3 failed during the building phase. The exception was:\nExitFailure 1\n</code></pre>\n"}, {"tags": ["haskell"], "answers": [{"comments": [{"owner": {"reputation": 19, "user_id": 4705110, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/ada610300cd4d32b87025c8c879cf3df?s=128&d=identicon&r=PG", "display_name": "monalisa", "link": "https://stackoverflow.com/users/4705110/monalisa"}, "edited": false, "score": 0, "creation_date": 1442632503, "post_id": 32663780, "comment_id": 53173741, "body": "So simple! Thank you!"}], "tags": [], "owner": {"reputation": 67060, "user_id": 783743, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/835bdcdab3e4bf466f0d59f809c50035?s=128&d=identicon&r=PG", "display_name": "Aadit M Shah", "link": "https://stackoverflow.com/users/783743/aadit-m-shah"}, "is_accepted": false, "score": 3, "last_activity_date": 1442632395, "creation_date": 1442632395, "answer_id": 32663780, "question_id": 32663746, "link": "https://stackoverflow.com/questions/32663746/match-a-list-of-functions-against-a-list-of-parameters/32663780#32663780", "title": "match a list of functions against a list of parameters", "body": "<p>What you want is <a href=\"http://hackage.haskell.org/package/base-4.8.1.0/docs/Control-Applicative.html#t:ZipList\" rel=\"nofollow\"><code>zipWith</code></a>:</p>\n\n<pre class=\"lang-hs prettyprint-override\"><code>zipWith ($) fs xs -- fs is the list of functions, xs is the list of values\n</code></pre>\n\n<p>Simple simon. Hope that helps.</p>\n"}], "owner": {"reputation": 19, "user_id": 4705110, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/ada610300cd4d32b87025c8c879cf3df?s=128&d=identicon&r=PG", "display_name": "monalisa", "link": "https://stackoverflow.com/users/4705110/monalisa"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 45, "favorite_count": 0, "closed_date": 1442632485, "answer_count": 1, "score": 1, "last_activity_date": 1442632395, "creation_date": 1442631974, "question_id": 32663746, "link": "https://stackoverflow.com/questions/32663746/match-a-list-of-functions-against-a-list-of-parameters", "closed_reason": "Duplicate", "title": "match a list of functions against a list of parameters", "body": "<p>If we have a list of functions <code>[f1,...fn]</code> and a list of parameters <code>[a1,...,an]</code>, is there a simple way (in Haskell) to produce something like <code>[fn a1, ..., fn an]</code>? I have been looking and only found a function called <code>sequenceA</code>, but it returns all posible matchings, and in the case I'm considering each f is only necessarily defined for the corresponding parameter. Thanks.</p>\n"}, {"tags": ["function", "haskell", "boolean", "permutation"], "answers": [{"comments": [{"owner": {"reputation": 62421, "user_id": 216164, "user_type": "registered", "accept_rate": 89, "profile_image": "https://www.gravatar.com/avatar/786f224adbe0784cdf7d0f15476061fe?s=128&d=identicon&r=PG", "display_name": "Thomas M. DuBuisson", "link": "https://stackoverflow.com/users/216164/thomas-m-dubuisson"}, "edited": false, "score": 4, "creation_date": 1442643265, "post_id": 32663844, "comment_id": 53175785, "body": "And you can make this more efficient (if that&#39;s a concern) by adding an <code>Ord</code> constraint and using sets instead of <code>nub</code>."}, {"owner": {"reputation": 115, "user_id": 2988976, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/e0de8873d53ab7d127bd80f0c566c490?s=128&d=identicon&r=PG&f=1", "display_name": "Corey", "link": "https://stackoverflow.com/users/2988976/corey"}, "edited": false, "score": 0, "creation_date": 1442681200, "post_id": 32663844, "comment_id": 53187202, "body": "Would I need to put that &quot;checkPermutation f = (== length cities) . length . nub . map f $ cities&quot; in an if statement somehow so I can return either true or false?  Also, ghci isn&#39;t liking the &quot;cities = [Baltimore..Toronto]&quot;, saying section must be enclosed by parentheses, and not in scope"}, {"owner": {"reputation": 67060, "user_id": 783743, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/835bdcdab3e4bf466f0d59f809c50035?s=128&d=identicon&r=PG", "display_name": "Aadit M Shah", "link": "https://stackoverflow.com/users/783743/aadit-m-shah"}, "reply_to_user": {"reputation": 115, "user_id": 2988976, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/e0de8873d53ab7d127bd80f0c566c490?s=128&d=identicon&r=PG&f=1", "display_name": "Corey", "link": "https://stackoverflow.com/users/2988976/corey"}, "edited": false, "score": 0, "creation_date": 1442683979, "post_id": 32663844, "comment_id": 53188176, "body": "@user2988976 No, the <code>(== length cities)</code> function itself returns a boolean. Also, you need to type <code>let cities = [Baltimore..Toronto]</code> if you&#39;re using GHCi."}], "tags": [], "owner": {"reputation": 67060, "user_id": 783743, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/835bdcdab3e4bf466f0d59f809c50035?s=128&d=identicon&r=PG", "display_name": "Aadit M Shah", "link": "https://stackoverflow.com/users/783743/aadit-m-shah"}, "is_accepted": true, "score": 5, "last_activity_date": 1442684031, "last_edit_date": 1442684031, "creation_date": 1442633117, "answer_id": 32663844, "question_id": 32663739, "link": "https://stackoverflow.com/questions/32663739/haskell-function-to-check-permutation/32663844#32663844", "title": "Haskell function to check permutation", "body": "<p>Try this:</p>\n\n<pre class=\"lang-hs prettyprint-override\"><code>import Data.List (nub)\n\ncities :: [City]\ncities = [Baltimore..Toronto]\n\ncheckPermutation :: (City -&gt; Name) -&gt; Bool\ncheckPermutation f = (== length cities) . length . nub . map f $ cities\n</code></pre>\n\n<p>This basically checks whether the function <code>f :: City -&gt; Name</code> is <a href=\"https://en.wikipedia.org/wiki/Injective_function\" rel=\"nofollow\">injective</a>.</p>\n\n<p>In fact, we can create a more general <code>injective</code> predicate:</p>\n\n<pre class=\"lang-hs prettyprint-override\"><code>import Data.Set as Set\n\ntypeSet :: (Bounded a, Enum a, Ord a) =&gt; Set a\ntypeSet = fromList $ enumFrom minBound\n\ninjective :: (Enum a, Bounded a, Ord a, Ord b) =&gt; (a -&gt; b) -&gt; Bool\ninjective f = let xs = typeSet in (== size xs) . size . Set.map f $ xs\n</code></pre>\n\n<p>Hope that helps.</p>\n"}], "owner": {"reputation": 115, "user_id": 2988976, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/e0de8873d53ab7d127bd80f0c566c490?s=128&d=identicon&r=PG&f=1", "display_name": "Corey", "link": "https://stackoverflow.com/users/2988976/corey"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 435, "favorite_count": 0, "accepted_answer_id": 32663844, "answer_count": 1, "score": 4, "last_activity_date": 1442684031, "creation_date": 1442631936, "last_edit_date": 1442674360, "question_id": 32663739, "link": "https://stackoverflow.com/questions/32663739/haskell-function-to-check-permutation", "title": "Haskell function to check permutation", "body": "<p>If I declare data constructors such as</p>\n\n<pre><code>data City = Baltimore | Chicago | Seattle | Miami | Toronto\n        deriving (Bounded, Enum, Eq, Ord, Show)\n\ndata Name = Orioles | Cubs | Mariners | Marlins | BlueJays\n        deriving (Bounded, Enum, Eq, Ord, Show)\n</code></pre>\n\n<p>How can I make a function</p>\n\n<pre><code>checkPermutation :: (City -&gt; Name) -&gt; Bool\n</code></pre>\n\n<p>to check that no two cities are assigned the same team name. For example, the following would return True but if any \"Name\" is assigned to more than one city it would return False.</p>\n\n<pre><code>test1 :: City -&gt; Name\ntest1 c = case c of\n    Baltimore  -&gt; Orioles\n    Chicago    -&gt; Cubs\n    Seattle    -&gt; Mariners\n    Miami      -&gt; Marlins\n    Toronto    -&gt; Blue Jays\n</code></pre>\n"}, {"tags": ["parsing", "haskell", "left-recursion"], "comments": [{"owner": {"reputation": 44013, "user_id": 1477667, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/trgKM.jpg?s=128&g=1", "display_name": "dfeuer", "link": "https://stackoverflow.com/users/1477667/dfeuer"}, "edited": false, "score": 0, "creation_date": 1442630907, "post_id": 32663551, "comment_id": 53173477, "body": "You may want to look at <a href=\"https://en.m.wikipedia.org/wiki/Operator-precedence_parser\" rel=\"nofollow noreferrer\">en.m.wikipedia.org/wiki/Operator-precedence_parser</a>"}, {"owner": {"reputation": 44013, "user_id": 1477667, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/trgKM.jpg?s=128&g=1", "display_name": "dfeuer", "link": "https://stackoverflow.com/users/1477667/dfeuer"}, "edited": false, "score": 0, "creation_date": 1442630971, "post_id": 32663551, "comment_id": 53173489, "body": "Also, you might consider using <code>attoparsec</code> instead of rolling your own parsing framework."}, {"owner": {"user_type": "does_not_exist", "display_name": "user3594595"}, "reply_to_user": {"reputation": 44013, "user_id": 1477667, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/trgKM.jpg?s=128&g=1", "display_name": "dfeuer", "link": "https://stackoverflow.com/users/1477667/dfeuer"}, "edited": false, "score": 1, "creation_date": 1442631030, "post_id": 32663551, "comment_id": 53173498, "body": "@dfeuer, but then we&#39;d be missing the purpose of the exercise! That operator precedence looks like a faily good solution though.. Ideally we can get it to work with this recursive descent parser."}, {"owner": {"reputation": 44013, "user_id": 1477667, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/trgKM.jpg?s=128&g=1", "display_name": "dfeuer", "link": "https://stackoverflow.com/users/1477667/dfeuer"}, "edited": false, "score": 1, "creation_date": 1442631445, "post_id": 32663551, "comment_id": 53173558, "body": "Also note that <code>mplus</code> is generally expected to match <code>&lt;|&gt;</code>."}, {"owner": {"reputation": 44013, "user_id": 1477667, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/trgKM.jpg?s=128&g=1", "display_name": "dfeuer", "link": "https://stackoverflow.com/users/1477667/dfeuer"}, "edited": false, "score": 0, "creation_date": 1442631523, "post_id": 32663551, "comment_id": 53173571, "body": "Fair about the point! However, you might consider testing parsers with <code>attoparsec</code> to make sure they&#39;re the problem and not your framework. Just a thought."}, {"owner": {"reputation": 44013, "user_id": 1477667, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/trgKM.jpg?s=128&g=1", "display_name": "dfeuer", "link": "https://stackoverflow.com/users/1477667/dfeuer"}, "edited": false, "score": 0, "creation_date": 1442631788, "post_id": 32663551, "comment_id": 53173613, "body": "As for the immediate problem, I think you probably want to parse in a &quot;right-associative&quot; fashion. When parsing a sum, don&#39;t allow the left operand to be a sum."}], "answers": [{"tags": [], "owner": {"reputation": 44013, "user_id": 1477667, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/trgKM.jpg?s=128&g=1", "display_name": "dfeuer", "link": "https://stackoverflow.com/users/1477667/dfeuer"}, "is_accepted": true, "score": 3, "last_activity_date": 1442650773, "last_edit_date": 1442650773, "creation_date": 1442633119, "answer_id": 32663845, "question_id": 32663551, "link": "https://stackoverflow.com/questions/32663551/removing-left-recursion-in-a-basic-expression-parser/32663845#32663845", "title": "Removing Left Recursion in a Basic Expression Parser", "body": "<p>Suppose you want to parse non-parenthesized expressions involving literals, addition, and multiplication. You can do this by cutting down the list by precedence. Here's one way to do it in <code>attoparsec</code>, which should be pretty similar to what you'd do with your parser. I'm no parsing expert, so there might be some errors or infelicities.</p>\n\n<pre><code>import Data.Attoparsec.ByteString.Char8\nimport Control.Applicative\n\nexpr :: Parser (Expr Int)\nexpr = choice [add, mul, lit] &lt;* skipSpace\n-- choice is in Data.Attoparsec.Combinators, but is\n-- actually a general Alternative operator.\n\nadd :: Parser (Expr Int)\nadd = Add &lt;$&gt; addList\n\naddList :: Parser [Expr Int]\naddList = (:) &lt;$&gt; addend &lt;* skipSpace &lt;* char '+' &lt;*&gt; (addList &lt;|&gt; ((:[]) &lt;$&gt; addend))\n\naddend :: Parser (Expr Int)\naddend = mul &lt;|&gt; multiplicand\n\nmul :: Parser (Expr Int)\nmul = Mul &lt;$&gt; mulList\n\nmulList :: Parser [Expr Int]\nmulList = (:) &lt;$&gt; multiplicand &lt;* skipSpace &lt;* char '*' &lt;*&gt; (mulList &lt;|&gt; ((:[]) &lt;$&gt; multiplicand))\n\nmultiplicand :: Parser (Expr Int)\nmultiplicand = lit\n\nlit :: Parser (Expr Int)\nlit = I &lt;$&gt; (skipSpace *&gt; decimal)\n</code></pre>\n"}], "owner": {"user_type": "does_not_exist", "display_name": "user3594595"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 833, "favorite_count": 1, "accepted_answer_id": 32663845, "answer_count": 1, "score": 7, "last_activity_date": 1442650773, "creation_date": 1442629974, "question_id": 32663551, "link": "https://stackoverflow.com/questions/32663551/removing-left-recursion-in-a-basic-expression-parser", "title": "Removing Left Recursion in a Basic Expression Parser", "body": "<p>As an exercise, I'm implementing a parser for an exceedingly simple language defined in Haskell using the following GADT (the real grammar for my project involves many more expressions, but this extract is sufficient for the question):</p>\n\n<pre><code>data Expr a where\n    I   :: Int -&gt; Expr Int\n    Add :: [Expr Int] -&gt; Expr Int\n</code></pre>\n\n<p>The parsing functions are as follows:</p>\n\n<pre><code>expr :: Parser (Expr Int)\nexpr = foldl1 mplus\n    [ lit \n    , add \n    ]   \n\nlit :: Parser (Expr Int)\nlit = I . read &lt;$&gt; some digit\n\nadd :: Parser (Expr Int)\nadd = do\n  i0 &lt;- expr\n  is (== '+')\n  i1 &lt;- expr\n  is &lt;- many (is (== '+') *&gt; expr)\n  pure (Add (i0:i1:is))\n</code></pre>\n\n<p>Due to the left-recursive nature of the expression grammar, when I attempt to parse something as simple as <code>1+1</code> using the <code>expr</code> parser, the parser get stuck in an infinite loop. </p>\n\n<p>I've seen examples of how to factor out left recursion across the web using a transformation from something like:</p>\n\n<pre><code>S -&gt; S a | b\n</code></pre>\n\n<p>Into something like:</p>\n\n<pre><code>S -&gt; b T\nT -&gt; a T\n</code></pre>\n\n<p>But I'm struggling with how to apply this to my parser.</p>\n\n<p>For completeness, here is the code that actually implements the parser:</p>\n\n<pre><code>newtype Parser a = Parser\n    { runParser :: String -&gt; [(a, String)]\n    }   \n\ninstance Functor Parser where\n    fmap f (Parser p) = Parser $ \\s -&gt;\n      fmap (\\(a, r) -&gt; (f a, r)) (p s)\n\ninstance Applicative Parser where\n    pure a = Parser $ \\s -&gt; [(a, s)] \n    (&lt;*&gt;) (Parser f) (Parser p) = Parser $ \\s -&gt;\n      concat $ fmap (\\(f', r) -&gt; fmap (\\(a, r') -&gt; (f' a, r')) (p r)) (f &gt;\n\ninstance Alternative Parser where\n    empty = Parser $ \\s -&gt; []\n    (&lt;|&gt;) (Parser a) (Parser b) = Parser $ \\s -&gt;\n      case a s of\n        (r:rs) -&gt; (r:rs)\n        []     -&gt; case b s of\n                    (r:rs) -&gt; (r:rs)\n                    []     -&gt; []\n\ninstance Monad Parser where\n    return = pure\n    (&gt;&gt;=) (Parser a) f = Parser $ \\s -&gt;\n      concat $ fmap (\\(r, rs) -&gt; runParser (f r) rs) (a s)\n\ninstance MonadPlus Parser where\n    mzero = empty\n    mplus (Parser a) (Parser b) = Parser $ \\s -&gt; a s ++ b s \n\nchar  = Parser $ \\case (c:cs) -&gt; [(c, cs)]; [] -&gt; []\nis p  = char &gt;&gt;= \\c -&gt; if p c then pure c else empty\ndigit = is isDigit\n</code></pre>\n"}, {"tags": ["haskell"], "comments": [{"owner": {"reputation": 15757, "user_id": 176841, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/45a168cb9eb8454d66c78f18e29d9342?s=128&d=identicon&r=PG", "display_name": "jberryman", "link": "https://stackoverflow.com/users/176841/jberryman"}, "edited": false, "score": 4, "creation_date": 1442630261, "post_id": 32663500, "comment_id": 53173354, "body": "I would suggest defining a working recursive solution, with a type signature to make sure your thinking on the problem is clear. And then from there I would suggest trying to use <a href=\"http://hackage.haskell.org/package/base-4.8.1.0/docs/Data-List.html#v:mapAccumL\" rel=\"nofollow noreferrer\"><code>mapAccumL</code></a> which is like a combination of a map and a fold. Then try to see if you can make <code>foldr</code> work here (hint: consider how <code>foldr (:) [] xs == xs</code>)."}], "answers": [{"comments": [{"owner": {"reputation": 1443, "user_id": 3742750, "user_type": "registered", "accept_rate": 59, "profile_image": "https://www.gravatar.com/avatar/15f53fbbfc39fbfcbec14bf8693dff5c?s=128&d=identicon&r=PG&f=1", "display_name": "KMC", "link": "https://stackoverflow.com/users/3742750/kmc"}, "edited": false, "score": 0, "creation_date": 1442635733, "post_id": 32663896, "comment_id": 53174271, "body": "Yes, but the substitution list is random. So it can be like [&quot;x&quot;, &quot;xxx&quot;, &quot;abc&quot;]"}, {"owner": {"reputation": 49959, "user_id": 866915, "user_type": "registered", "accept_rate": 70, "profile_image": "https://www.gravatar.com/avatar/09242131d6e17cbbe31e8547514da6e5?s=128&d=identicon&r=PG", "display_name": "ErikR", "link": "https://stackoverflow.com/users/866915/erikr"}, "reply_to_user": {"reputation": 1443, "user_id": 3742750, "user_type": "registered", "accept_rate": 59, "profile_image": "https://www.gravatar.com/avatar/15f53fbbfc39fbfcbec14bf8693dff5c?s=128&d=identicon&r=PG&f=1", "display_name": "KMC", "link": "https://stackoverflow.com/users/3742750/kmc"}, "edited": false, "score": 3, "creation_date": 1442636827, "post_id": 32663896, "comment_id": 53174487, "body": "Have a look at each of the four cases I mention at the end. Which ones are you having trouble with? For instance, is it clear to you that <code>subs [] [] = []</code>?"}], "tags": [], "owner": {"reputation": 49959, "user_id": 866915, "user_type": "registered", "accept_rate": 70, "profile_image": "https://www.gravatar.com/avatar/09242131d6e17cbbe31e8547514da6e5?s=128&d=identicon&r=PG", "display_name": "ErikR", "link": "https://stackoverflow.com/users/866915/erikr"}, "is_accepted": true, "score": 2, "last_activity_date": 1442633556, "creation_date": 1442633556, "answer_id": 32663896, "question_id": 32663500, "link": "https://stackoverflow.com/questions/32663500/iterate-through-two-lists-for-substitution/32663896#32663896", "title": "Iterate through two lists for substitution", "body": "<p>Am I'm correct in understanding that <code>subs</code> only replaces occurrences of <code>\"the\"</code> in the input word list? So:</p>\n\n<pre><code>subs xs [\"a\", \"dog\"]\n</code></pre>\n\n<p>means to substitute the first occurrence of <code>\"the\"</code> in <code>xs</code> with <code>\"a\"</code> and the second occurrence with <code>\"dog\"</code>?</p>\n\n<p>If so, you should try something along these lines:</p>\n\n<pre><code>subs xs [] = ...  -- no more substitutions - the easy case\n\nsubs xs (a:as) =\n  -- we have a substitution\n  -- if xs begins with \"the\" then substitute with `a` and continue\n  -- otherwise ... some sort of recursion ...\n</code></pre>\n\n<p>Here are the four cases you need to cover:</p>\n\n<pre><code>subs []     [] = ...     -- input is empty and no more subs to make\nsubs [] (a:as) = ...     -- input is empty and some extra subs left over\nsubs (x:xs) [] = ...     -- input not empty and no more subs to make\nsubs (x:xs) (a:as) = ... -- input not empty and still some subs left\n</code></pre>\n\n<p>If you can provide definitions for all of these cases you are done!</p>\n"}], "owner": {"reputation": 1443, "user_id": 3742750, "user_type": "registered", "accept_rate": 59, "profile_image": "https://www.gravatar.com/avatar/15f53fbbfc39fbfcbec14bf8693dff5c?s=128&d=identicon&r=PG&f=1", "display_name": "KMC", "link": "https://stackoverflow.com/users/3742750/kmc"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 353, "favorite_count": 0, "accepted_answer_id": 32663896, "answer_count": 1, "score": 1, "last_activity_date": 1442633556, "creation_date": 1442629495, "question_id": 32663500, "link": "https://stackoverflow.com/questions/32663500/iterate-through-two-lists-for-substitution", "title": "Iterate through two lists for substitution", "body": "<p>I need to create a function that takes two parameters. Both of them are list of strings and one is used as a substitution list for the other. So the function would be called like this - </p>\n\n<pre><code>subs [\"the\",\"quick\",\"brown\",\"the\"] [\"a\",\"dog\"] \n</code></pre>\n\n<p>The output would be - \"a quick brown dog\". So whenever there's is \"the\" element in the list, the first \"the\" is replaced with the first element of the substitution list and the second \"the\" will be substituted with the second element from the substation list. I can use foldr to iterate through the first list but I don't know how to keep track of substitution list so that the element that is already used won't be used again. Any suggestion?</p>\n"}, {"tags": ["haskell", "type-inference"], "comments": [{"owner": {"reputation": 11366, "user_id": 3922954, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/76ba47d2fdd24ab56b0b273cce2075e5?s=128&d=identicon&r=PG&f=1", "display_name": "AJF", "link": "https://stackoverflow.com/users/3922954/ajf"}, "edited": false, "score": 3, "creation_date": 1442617347, "post_id": 32662237, "comment_id": 53170842, "body": "<code>snake_case</code> is not usually used in Haskell, <code>camelCase</code> is the most adhered to naming style."}, {"owner": {"reputation": 44013, "user_id": 1477667, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/trgKM.jpg?s=128&g=1", "display_name": "dfeuer", "link": "https://stackoverflow.com/users/1477667/dfeuer"}, "edited": false, "score": 2, "creation_date": 1442618630, "post_id": 32662237, "comment_id": 53171165, "body": "I highly recommend breaking all those local functions out to the top level and giving each a type signature. You don&#39;t need to export them from your module, but the whole mess will be a lot easier to read and work with."}, {"owner": {"reputation": 44013, "user_id": 1477667, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/trgKM.jpg?s=128&g=1", "display_name": "dfeuer", "link": "https://stackoverflow.com/users/1477667/dfeuer"}, "edited": false, "score": 0, "creation_date": 1442618957, "post_id": 32662237, "comment_id": 53171248, "body": "More generally, when you have a type error and don&#39;t know where the problem is, adding some type signatures will often help you get more useful error messages. The <code>ScopedTypeVariables</code> extension is necessary in some cases to give a type signature to a local binding. I don&#39;t think that&#39;s the case here, but I suspect your function would be better broken in pieces anyway."}, {"owner": {"reputation": 35578, "user_id": 3000206, "user_type": "registered", "accept_rate": 98, "profile_image": "https://i.stack.imgur.com/BK1fo.jpg?s=128&g=1", "display_name": "Carcigenicate", "link": "https://stackoverflow.com/users/3000206/carcigenicate"}, "edited": false, "score": 4, "creation_date": 1442619312, "post_id": 32662237, "comment_id": 53171340, "body": "One thing I learned when writing Haskell (and this mirrors the above comment): When in doubt, add signatures! Tell it exactly what you want to limit its guessing. It may be pretty good guessing types most of the time, but giving it help will always benefit you!"}, {"owner": {"reputation": 44013, "user_id": 1477667, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/trgKM.jpg?s=128&g=1", "display_name": "dfeuer", "link": "https://stackoverflow.com/users/1477667/dfeuer"}, "edited": false, "score": 6, "creation_date": 1442619435, "post_id": 32662237, "comment_id": 53171365, "body": "By the way, <code>foldl (++) &quot;&quot;</code> is a really inefficient way to concatenate strings. The fast way is <code>foldr (++) &quot;&quot;</code>, or, generalizing to lists, <code>foldr (++) []</code>, better known as <code>concat</code>."}], "answers": [{"tags": [], "owner": {"reputation": 2231, "user_id": 1027321, "user_type": "registered", "accept_rate": 70, "profile_image": "https://i.stack.imgur.com/KkFZC.jpg?s=128&g=1", "display_name": "jakubdaniel", "link": "https://stackoverflow.com/users/1027321/jakubdaniel"}, "is_accepted": false, "score": 0, "last_activity_date": 1442619082, "last_edit_date": 1442619082, "creation_date": 1442618720, "answer_id": 32662459, "question_id": 32662237, "link": "https://stackoverflow.com/questions/32662237/haskell-deduced-too-strict-type/32662459#32662459", "title": "Haskell deduced too strict type", "body": "<p>Well I suppose you expect <code>[0..]</code> to be considered a <code>[Int]</code> while it seems not to be the case. And that would be probably because <code>show_node</code> for <code>JObject</code> passes <code>[(String, JNode)]</code> as the same parameter as <code>JArray</code> passes <code>[(SOMETHING_UNKNOWN, JNode)]</code> into <code>show_sect</code>.</p>\n\n<p>Try forcing the type just on the expression <code>[0..]</code> that you zip together with the array elements: <code>zip ([0..] :: [Int]) xs</code>. I am confident that the problem is the inferred type of <code>show_sect</code>.</p>\n\n<p>I would highly recommend to provide some type annotations, I think it is a good practice to do so. I am not too familiar with type inference in Haskell though.</p>\n"}, {"comments": [{"owner": {"reputation": 44013, "user_id": 1477667, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/trgKM.jpg?s=128&g=1", "display_name": "dfeuer", "link": "https://stackoverflow.com/users/1477667/dfeuer"}, "edited": false, "score": 2, "creation_date": 1442619697, "post_id": 32662551, "comment_id": 53171410, "body": "Why doesn&#39;t let generalization catch this?"}, {"owner": {"reputation": 100185, "user_id": 3234959, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/93bb12ca0f93dfddb33880316f7e66c2?s=128&d=identicon&r=PG&f=1", "display_name": "chi", "link": "https://stackoverflow.com/users/3234959/chi"}, "reply_to_user": {"reputation": 44013, "user_id": 1477667, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/trgKM.jpg?s=128&g=1", "display_name": "dfeuer", "link": "https://stackoverflow.com/users/1477667/dfeuer"}, "edited": false, "score": 2, "creation_date": 1442619839, "post_id": 32662551, "comment_id": 53171445, "body": "@dfeuer I guess it&#39;s because of mutual recursion. Generalization happens for the whole group of mutually recursive definitions, but then it&#39;s too late."}, {"owner": {"reputation": 44013, "user_id": 1477667, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/trgKM.jpg?s=128&g=1", "display_name": "dfeuer", "link": "https://stackoverflow.com/users/1477667/dfeuer"}, "reply_to_user": {"reputation": 100185, "user_id": 3234959, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/93bb12ca0f93dfddb33880316f7e66c2?s=128&d=identicon&r=PG&f=1", "display_name": "chi", "link": "https://stackoverflow.com/users/3234959/chi"}, "edited": false, "score": 1, "creation_date": 1442619975, "post_id": 32662551, "comment_id": 53171480, "body": "@chi, I guess that&#39;s what the <code>RelaxedPolyRec</code> or whatever it&#39;s called is about? Or is that also top level only? It seems the standard is a bit too fussy here. In any case, I&#39;m in the obsessive type signature writing camp, and terrified of libraries that make that painful."}, {"owner": {"reputation": 17809, "user_id": 1088108, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/63781cd38e91aa346a3849bc3ef3e550?s=128&d=identicon&r=PG&f=1", "display_name": "&#216;rjan Johansen", "link": "https://stackoverflow.com/users/1088108/%c3%98rjan-johansen"}, "edited": false, "score": 1, "creation_date": 1442620495, "post_id": 32662551, "comment_id": 53171589, "body": "Pretty sure it&#39;s because of polymorphic recursion, and it would be worse without <code>RelaxedPolyRec</code>: then <i>all</i> the functions would need signatures. The local bindings thing is <code>MonoLocalBinds</code>, and if you enable that this code won&#39;t work even with the signature on <code>show_pair</code>."}, {"owner": {"reputation": 14485, "user_id": 190376, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/cd8280c5e1491b8cf55760750ed97dec?s=128&d=identicon&r=PG", "display_name": "Reid Barton", "link": "https://stackoverflow.com/users/190376/reid-barton"}, "edited": false, "score": 1, "creation_date": 1442622831, "post_id": 32662551, "comment_id": 53172029, "body": "The last paragraph of this answer is misleading or wrong: as already alluded to by other comments, let generalization is on by default in the absence of certain other language extensions and its exact purpose is to make local bindings polymorphic."}, {"owner": {"reputation": 100892, "user_id": 745903, "user_type": "registered", "accept_rate": 74, "profile_image": "https://www.gravatar.com/avatar/50933f6638836741e620669b3940410e?s=128&d=identicon&r=PG", "display_name": "leftaroundabout", "link": "https://stackoverflow.com/users/745903/leftaroundabout"}, "reply_to_user": {"reputation": 14485, "user_id": 190376, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/cd8280c5e1491b8cf55760750ed97dec?s=128&d=identicon&r=PG", "display_name": "Reid Barton", "link": "https://stackoverflow.com/users/190376/reid-barton"}, "edited": false, "score": 0, "creation_date": 1442623641, "post_id": 32662551, "comment_id": 53172192, "body": "@ReidBarton: right you are, and it means my answer isn&#39;t really correct. Hopefully someone&#39;d write a proper one..."}, {"owner": {"reputation": 44013, "user_id": 1477667, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/trgKM.jpg?s=128&g=1", "display_name": "dfeuer", "link": "https://stackoverflow.com/users/1477667/dfeuer"}, "edited": false, "score": 1, "creation_date": 1442630261, "post_id": 32662551, "comment_id": 53173355, "body": "Let generalization is already in Hindley Milner, and was included in Haskell from the get go. The tricky bit here is really the polymorphic recursion, which H-M prohibits outright."}], "tags": [], "owner": {"reputation": 100892, "user_id": 745903, "user_type": "registered", "accept_rate": 74, "profile_image": "https://www.gravatar.com/avatar/50933f6638836741e620669b3940410e?s=128&d=identicon&r=PG", "display_name": "leftaroundabout", "link": "https://stackoverflow.com/users/745903/leftaroundabout"}, "is_accepted": false, "score": 9, "last_activity_date": 1442623485, "last_edit_date": 1442623485, "creation_date": 1442619335, "answer_id": 32662551, "question_id": 32662237, "link": "https://stackoverflow.com/questions/32662237/haskell-deduced-too-strict-type/32662551#32662551", "title": "Haskell deduced too strict type", "body": "<p><strong>tl;dr</strong>: always use explicit signatures when you want something to be polymorphic.</p>\n\n<hr>\n\n<p>In <a href=\"https://en.wikipedia.org/wiki/System_F\" rel=\"noreferrer\">System F</a> (which is what Haskell's type system is based on) every type variable that's used for polymorphism needs to be explicitly quantified into scope by a type-level-lambda / for-all (&forall;). So in fact you'd need to have</p>\n\n<pre><code>show_pair :: \u2200 a. (Show a) =&gt; Int -&gt; (a, JNode) -&gt; String\n</code></pre>\n\n<p>It could be argued that Haskell should require this too, but it doesn't. It just quantifies any variable that you mention in an explicit signature<sup>&dagger;</sup>, so you can simply write</p>\n\n<pre><code>show_pair :: (Show a) =&gt; Int -&gt; (a, JNode) -&gt; String\n</code></pre>\n\n<p>Also, it tries to introduce as many type variables as possible into <em>top-level bindings</em> without signature<sup>&ddagger;</sup>.</p>\n\n<p><del>However, it does not automatically introduce any type variables into <em>local</em> bindings. Since the compiler knows exactly where <code>show_pair</code> is used, it has a full context of at least one type instantiation that you will need to have. What it assumes is that you <em>only</em> need one instantiation. With that it tries to infer some type for a <em>monomorphic</em> <code>show_pair</code>, and fails. Only by adding an explicit signature do you force the compiler to consider a polymorphic signature.</del> <sup>As remarked in the comments, this isn't actually true because already since GHC-7.0, there's a thing called <a href=\"https://ghc.haskell.org/trac/ghc/blog/LetGeneralisationInGhc7\" rel=\"noreferrer\">let generalisation</a> which does make local bindings polymorphic even without signature. I wasn't aware that this is on by default. &mdash; Even if it's <em>possible</em> to omit the signatures, polymorphic functions should still better have them IMO.</sup></p>\n\n<hr>\n\n<p><sup>&dagger;</sup><sub>Provided you've not already introduced that variable in a higher scope, with the <code>-XScopedTypeVariables</code> extension.</sub></p>\n\n<p><sup>&ddagger;</sup><sub>Unfortunately, the <a href=\"https://wiki.haskell.org/MonomorphismRestriction\" rel=\"noreferrer\">monomorphism restriction</a> makes this awfully hard to rely on.</sub></p>\n"}], "owner": {"reputation": 399, "user_id": 3608068, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/1db7bfad7cf00ce607f6f385923e6dc9?s=128&d=identicon&r=PG&f=1", "display_name": "user3608068", "link": "https://stackoverflow.com/users/3608068/user3608068"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 243, "favorite_count": 0, "answer_count": 2, "score": 9, "last_activity_date": 1458482687, "creation_date": 1442617043, "last_edit_date": 1458482687, "question_id": 32662237, "link": "https://stackoverflow.com/questions/32662237/haskell-deduced-too-strict-type", "title": "Haskell deduced too strict type", "body": "<p><em>Disclaimer: I\u2019m just starting to learn Haskell and I\u2019m not sure \u201cstrict\u201d is the right word here.</em></p>\n\n<p>I was trying to narrow down my problem but I couldn\u2019t really find the issue, so here is my code that <strong>doesn\u2019t compile</strong>:</p>\n\n<pre><code>module Json where\nimport Data.List (intersperse)\n\ndata JNode = \n    JObject [(String, JNode)]\n  | JArray  [JNode]\n  | JString String\n  | JNumber Double\n  | JBool   Bool\n  | JNull\n\ninstance Show JNode where\n  show = show_node 0 where\n    glue = foldl (++) \"\"\n    show_tabs n              = glue $ take n $ repeat \"  \"\n    show_list n              = glue . intersperse \",\\n\" . map (show_pair (n + 1))\n    show_sect n l r xs       = glue [\"\\n\", tabs, l, \"\\n\", show_list n xs, \"\\n\", tabs, r] where tabs = show_tabs n\n    -- show_pair :: (Show a) =&gt; Int -&gt; (a, JNode) -&gt; String -- works when uncommented\n    show_pair n (name,  val) = glue [show_tabs n, show name, \" : \", show_node n val]\n    show_node n (JObject xs) = show_sect n \"{\" \"}\" xs\n    show_node n (JArray  xs) = show_sect n \"[\" \"]\" $ zip [0..] xs\n    show_node n (JString x ) = show x\n    show_node n (JNumber x ) = show x\n    show_node n (JBool   x ) = show x\n    show_node n (JNull     ) = \"null\"\n</code></pre>\n\n<p>The error is:</p>\n\n<pre class=\"lang-none prettyprint-override\"><code>Prelude&gt; :l scripts\\json.hs\n[1 of 1] Compiling Json             ( scripts\\json.hs, interpreted )\n\nscripts\\json.hs:21:59:\n    No instance for (Enum String)\n      arising from the arithmetic sequence `0 .. '\n    In the first argument of `zip', namely `([0 .. ])'\n    In the second argument of `($)', namely `zip ([0 .. ]) xs'\n    In the expression: show_sect n \"[\" \"]\" $ zip ([0 .. ]) xs\n\nscripts\\json.hs:21:60:\n    No instance for (Num String) arising from the literal `0'\n    In the expression: 0\n    In the first argument of `zip', namely `[0 .. ]'\n    In the second argument of `($)', namely `zip [0 .. ] xs'\nFailed, modules loaded: none.\n</code></pre>\n\n<p><strong>Take a look at the line of code with the comment.</strong> Apparently, when there is no type declaration, it requires me to pass <code>String</code> instead of just <code>Show a</code>. Funny enough, it still requires <code>name</code> to be a <code>String</code> when I don\u2019t even use it, e.g. when replacing <code>show_pair</code> implementation with this:</p>\n\n<pre><code>show_pair n (name,  val) = show_node n val\n</code></pre>\n\n<p>Can someone explain to me why it works the way it does?</p>\n\n<hr>\n\n<p><strong>Simplified version</strong> of my code with the same issue in case anyone was going to improve the answer:</p>\n\n<pre><code>data TFoo = \n    FooStr (String, TFoo)\n  | FooNum (Int,    TFoo)\n\n-- show_pair :: (a, TFoo) -&gt; String\nshow_pair (_,    val) = show_node val\nshow_node (FooStr  x) = show_pair x\nshow_node (FooNum  x) = show_pair x\n</code></pre>\n"}, {"tags": ["haskell", "project"], "comments": [{"owner": {"reputation": 51584, "user_id": 839246, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/9b0573c2b936b12828dd1e4cc04206dc?s=128&d=identicon&r=PG&f=1", "display_name": "bheklilr", "link": "https://stackoverflow.com/users/839246/bheklilr"}, "edited": false, "score": 4, "creation_date": 1442605355, "post_id": 32659718, "comment_id": 53166145, "body": "This is actually a sore spot for Haskell, I believe there is an extension in the works for GHC that is either in 7.10 or will be in 8.0 that allows for overloaded record fields.  The best I can say is to use the <code>lens</code> library (it looks like you are already) and make <code>HasId</code> and <code>HasAttribute</code> typeclasses with your types implementing them as necessary with <code>_clientId</code>, <code>_videoClubId</code> etc.  It&#39;s gross, I know, but there may be some handy template haskell in <code>lens</code> for generating that if you use the right naming scheme."}, {"owner": {"reputation": 51584, "user_id": 839246, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/9b0573c2b936b12828dd1e4cc04206dc?s=128&d=identicon&r=PG&f=1", "display_name": "bheklilr", "link": "https://stackoverflow.com/users/839246/bheklilr"}, "edited": false, "score": 4, "creation_date": 1442605483, "post_id": 32659718, "comment_id": 53166205, "body": "<a href=\"http://hackage.haskell.org/package/lens-4.13/docs/Control-Lens-TH.html#v:makeFields\" rel=\"nofollow noreferrer\">Found it</a>, if you use <code>makeFields</code> (so long as your types are all declared in the same module) then it&#39;ll take care of that boilerplate for you."}, {"owner": {"reputation": 2271, "user_id": 4994500, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/233389523330bec1d6e95f4c480d5741?s=128&d=identicon&r=PG&f=1", "display_name": "Sam van Herwaarden", "link": "https://stackoverflow.com/users/4994500/sam-van-herwaarden"}, "edited": false, "score": 0, "creation_date": 1442606487, "post_id": 32659718, "comment_id": 53166702, "body": "You&#39;re right it can be annoying that you can&#39;t use names twice. But at the same time, using different names makes it very explicit that the functions are also different. I tend to prefix my field names with something referring to the type, i.e. <code>clId</code>, <code>clName</code>, <code>vcId</code>, <code>vcName</code>,<code>movId</code>,<code>movName</code> etc. It&#39;s not pretty but I do actually feel like it makes more explicit which type your functions work on etc."}, {"owner": {"reputation": 31, "user_id": 5348130, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/02e0eec9f46dc7a07780160d2e3bc510?s=128&d=identicon&r=PG&f=1", "display_name": "Ale Maier", "link": "https://stackoverflow.com/users/5348130/ale-maier"}, "edited": false, "score": 0, "creation_date": 1442607303, "post_id": 32659718, "comment_id": 53167116, "body": "Thank you both, i already did it (rename the attributes). But there&#39;s another problem, im trying to do a function: movieCopies -&gt; this function return a list of movies with how much copies has the videoclub. i.e : &quot;Figth Club&quot; 3 copies. I need so much help with this project."}, {"owner": {"reputation": 14582, "user_id": 2225384, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/f30b04ed4d0b3fc4bc791a28815f34ca?s=128&d=identicon&r=PG", "display_name": "Rein Henrichs", "link": "https://stackoverflow.com/users/2225384/rein-henrichs"}, "edited": false, "score": 0, "creation_date": 1442616209, "post_id": 32659718, "comment_id": 53170504, "body": "Then you should ask that as well, as a separate question."}], "answers": [{"comments": [{"owner": {"reputation": 14582, "user_id": 2225384, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/f30b04ed4d0b3fc4bc791a28815f34ca?s=128&d=identicon&r=PG", "display_name": "Rein Henrichs", "link": "https://stackoverflow.com/users/2225384/rein-henrichs"}, "edited": false, "score": 1, "creation_date": 1442609340, "post_id": 32660662, "comment_id": 53168007, "body": "This is a great strategy, especially for dealing with cases where you don&#39;t know the identifier a priori, like creating a record in a database with an auto-incremented PK or POSTing to create a RESTful resource that will be assigned an id by the server. That said, I&#39;m not sure what the <code>Comonad</code> interface buys you aside from <code>extract</code>? Is there a use case for <code>duplicate</code> or working with coKleisli arrows via cobind?"}, {"owner": {"reputation": 126897, "user_id": 791604, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/ce991df7a056248d5e4f6fc3659ba733?s=128&d=identicon&r=PG", "display_name": "Daniel Wagner", "link": "https://stackoverflow.com/users/791604/daniel-wagner"}, "reply_to_user": {"reputation": 14582, "user_id": 2225384, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/f30b04ed4d0b3fc4bc791a28815f34ca?s=128&d=identicon&r=PG", "display_name": "Rein Henrichs", "link": "https://stackoverflow.com/users/2225384/rein-henrichs"}, "edited": false, "score": 0, "creation_date": 1442609870, "post_id": 32660662, "comment_id": 53168263, "body": "I vaguely recall reading a blog post some time ago that claimed to get some leverage from dealing with a database IDs in a comonadic way, though my Google-fu seems to be lacking -- I can&#39;t find it again -- and I don&#39;t recall the details of the leverage well enough to reproduce them here, either. So I guess this is the encouraging version of FUD."}, {"owner": {"reputation": 31, "user_id": 5348130, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/02e0eec9f46dc7a07780160d2e3bc510?s=128&d=identicon&r=PG&f=1", "display_name": "Ale Maier", "link": "https://stackoverflow.com/users/5348130/ale-maier"}, "edited": false, "score": 0, "creation_date": 1442612038, "post_id": 32660662, "comment_id": 53169106, "body": "Thanks great answer, but how can i implement this ?. I need to import some libs rigth ? (i havent worked with monads or comonads)"}, {"owner": {"reputation": 14582, "user_id": 2225384, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/f30b04ed4d0b3fc4bc791a28815f34ca?s=128&d=identicon&r=PG", "display_name": "Rein Henrichs", "link": "https://stackoverflow.com/users/2225384/rein-henrichs"}, "edited": false, "score": 0, "creation_date": 1442612044, "post_id": 32660662, "comment_id": 53169108, "body": "I&#39;ll buy it for a dollar :)"}, {"owner": {"reputation": 14582, "user_id": 2225384, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/f30b04ed4d0b3fc4bc791a28815f34ca?s=128&d=identicon&r=PG", "display_name": "Rein Henrichs", "link": "https://stackoverflow.com/users/2225384/rein-henrichs"}, "reply_to_user": {"reputation": 31, "user_id": 5348130, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/02e0eec9f46dc7a07780160d2e3bc510?s=128&d=identicon&r=PG&f=1", "display_name": "Ale Maier", "link": "https://stackoverflow.com/users/5348130/ale-maier"}, "edited": false, "score": 1, "creation_date": 1442612108, "post_id": 32660662, "comment_id": 53169124, "body": "@AleMaier The <code>Comonad</code> interface is a nice-to-have. You can just use the <code>_id</code> and <code>_val</code> fields like any other record. With it, you have <code>extract :: Identified Client -&gt; Client</code> to extract the Client from its Identified wrapper. As the definition shows, this is equivalent to <code>_val</code>."}, {"owner": {"reputation": 14582, "user_id": 2225384, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/f30b04ed4d0b3fc4bc791a28815f34ca?s=128&d=identicon&r=PG", "display_name": "Rein Henrichs", "link": "https://stackoverflow.com/users/2225384/rein-henrichs"}, "edited": false, "score": 1, "creation_date": 1442612193, "post_id": 32660662, "comment_id": 53169160, "body": "@DanielWagner btw with lenses and <code>makeClassy</code>, you can use the same lenses to interact with both <code>Identified Client</code> and <code>Client</code>, so you can just say <code>view name</code> in either case, which seems very nice."}, {"owner": {"reputation": 31, "user_id": 5348130, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/02e0eec9f46dc7a07780160d2e3bc510?s=128&d=identicon&r=PG&f=1", "display_name": "Ale Maier", "link": "https://stackoverflow.com/users/5348130/ale-maier"}, "reply_to_user": {"reputation": 14582, "user_id": 2225384, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/f30b04ed4d0b3fc4bc791a28815f34ca?s=128&d=identicon&r=PG", "display_name": "Rein Henrichs", "link": "https://stackoverflow.com/users/2225384/rein-henrichs"}, "edited": false, "score": 0, "creation_date": 1442612677, "post_id": 32660662, "comment_id": 53169338, "body": "@ReinHenrichs so with this how can i do this :  &quot;Movie number 1: Fight Club&quot;  &quot;Movie number 2: Inception&quot;  .. I need to display the number from the movie, that number i took it from its id, the only way i found."}, {"owner": {"reputation": 14582, "user_id": 2225384, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/f30b04ed4d0b3fc4bc791a28815f34ca?s=128&d=identicon&r=PG", "display_name": "Rein Henrichs", "link": "https://stackoverflow.com/users/2225384/rein-henrichs"}, "edited": false, "score": 0, "creation_date": 1442612774, "post_id": 32660662, "comment_id": 53169364, "body": "<code>data Movie = Movie String; [Identified 1 (Movie &quot;Fight Club&quot;), Identified 2 (Movie &quot;Inception&quot;)]</code>"}, {"owner": {"reputation": 31, "user_id": 5348130, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/02e0eec9f46dc7a07780160d2e3bc510?s=128&d=identicon&r=PG&f=1", "display_name": "Ale Maier", "link": "https://stackoverflow.com/users/5348130/ale-maier"}, "edited": false, "score": 0, "creation_date": 1442613605, "post_id": 32660662, "comment_id": 53169662, "body": "I&#39;ll try that, thanks."}], "tags": [], "owner": {"reputation": 126897, "user_id": 791604, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/ce991df7a056248d5e4f6fc3659ba733?s=128&d=identicon&r=PG", "display_name": "Daniel Wagner", "link": "https://stackoverflow.com/users/791604/daniel-wagner"}, "is_accepted": true, "score": 5, "last_activity_date": 1442608733, "creation_date": 1442608733, "answer_id": 32660662, "question_id": 32659718, "link": "https://stackoverflow.com/questions/32659718/how-to-declare-multiple-attributes-in-haskell/32660662#32660662", "title": "How to declare multiple &quot;attributes&quot; in haskell?", "body": "<p>Another option to consider is to have an <code>Identified</code> type:</p>\n\n<pre><code>data Identified a = Identified\n  { _id  :: Int\n  , _val :: a\n  } deriving (Functor, Show)\n\ninstance Comonad Identified where\n  extract = _val\n  duplicate v = Identified (_id v) v\n\ndata Client = Client\n  { _name      :: String\n  , _lastname  :: String\n  , _age       :: Int\n  , _movies    :: [Movie]\n  } deriving Show\n</code></pre>\n\n<p>Then you can choose to use <code>Client</code> or <code>Identified Client</code> as appropriate throughout your source (and similarly for your other types). This also makes things like <code>IntMap Client</code> more sane: one need not preserve the invariant that the <code>Client</code>'s <code>_id</code> match its key in the map.</p>\n"}], "owner": {"reputation": 31, "user_id": 5348130, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/02e0eec9f46dc7a07780160d2e3bc510?s=128&d=identicon&r=PG&f=1", "display_name": "Ale Maier", "link": "https://stackoverflow.com/users/5348130/ale-maier"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 168, "favorite_count": 0, "closed_date": 1442639350, "accepted_answer_id": 32660662, "answer_count": 1, "score": 1, "last_activity_date": 1442608733, "creation_date": 1442604769, "question_id": 32659718, "link": "https://stackoverflow.com/questions/32659718/how-to-declare-multiple-attributes-in-haskell", "closed_reason": "Duplicate", "title": "How to declare multiple &quot;attributes&quot; in haskell?", "body": "<p>i have to do a videclub project. My problem: when i create the data structures i cant declare more than 1 id,name or any \"attribute\"\n.\nHere is my code:</p>\n\n<pre><code>data Client = Client\n  { _id        :: Int\n  , _name      :: String\n  , _lastname  :: String\n  , _age       :: Int\n  , _movies    :: [Movie]\n  } deriving Show\n\ndata VideoClub = VideoClub\n  { _id        :: Int\n  , _name      :: String\n  , _direccion :: String\n  } deriving Show\n\ndata Movie= Movie\n  { _id          :: Int\n  , _title       :: String\n  , _rented      :: Bool\n  , _videoclub   :: VideoClub\n  , _category    :: String\n  } deriving Show\n</code></pre>\n\n<p>This is one of many problems that i have. Hope you can help me and give me some advices. Thank you.</p>\n"}, {"tags": ["haskell", "cabal"], "comments": [{"owner": {"reputation": 44013, "user_id": 1477667, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/trgKM.jpg?s=128&g=1", "display_name": "dfeuer", "link": "https://stackoverflow.com/users/1477667/dfeuer"}, "edited": false, "score": 1, "creation_date": 1442598068, "post_id": 32657782, "comment_id": 53162318, "body": "Yeah, you have two different versions of <code>bytestring</code> installed, and two packages you have installed each depends on a different version. This is why cabal warns you that &quot;reinstalls are always dangerous&quot;. There is light at the end of the tunnel (<a href=\"http://blog.ezyang.com/2015/08/help-us-beta-test-no-reinstall-cabal/\" rel=\"nofollow noreferrer\">&quot;no-reinstall cabal&quot;</a>), but you may want to nuke your sandbox or <code>.ghc</code> and try again."}, {"owner": {"reputation": 14485, "user_id": 190376, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/cd8280c5e1491b8cf55760750ed97dec?s=128&d=identicon&r=PG", "display_name": "Reid Barton", "link": "https://stackoverflow.com/users/190376/reid-barton"}, "edited": false, "score": 0, "creation_date": 1442600368, "post_id": 32657782, "comment_id": 53163482, "body": "Yes, you should remove the <code>bytestring</code> that did not come with your GHC and anything that depends on it."}], "answers": [{"tags": [], "owner": {"reputation": 126897, "user_id": 791604, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/ce991df7a056248d5e4f6fc3659ba733?s=128&d=identicon&r=PG", "display_name": "Daniel Wagner", "link": "https://stackoverflow.com/users/791604/daniel-wagner"}, "is_accepted": true, "score": 2, "last_activity_date": 1442609422, "creation_date": 1442609422, "answer_id": 32660813, "question_id": 32657782, "link": "https://stackoverflow.com/questions/32657782/type-mismatch-after-cabal-update/32660813#32660813", "title": "Type mismatch after cabal update?", "body": "<p>Assuming your program is built with cabal, you should re-configure it. This may highlight other problems, such as dependencies which would require re-installing or breaking other parts of the dependency tree. The \"old way\" to solve this is to progressively <code>cabal install</code> more and more things until the dependency solver agrees it's possible, e.g.</p>\n\n<pre><code>$ cabal install .\n# complains that reinstalls might break lens\n$ cabal install . lens\n# complains that reinstalls might break bytestring\n$ cabal install . lens bytestring\n# complains that reinstalls might break X\n$ cabal install . lens bytestring X\n</code></pre>\n\n<p>...etc. The \"new way\" is to use <a href=\"http://blog.ezyang.com/2015/08/help-us-beta-test-no-reinstall-cabal/\" rel=\"nofollow\">no-reinstall cabal</a>. You will still need to reconfigure before you build, and may need to install some dependencies again to transition properly.</p>\n"}], "owner": {"reputation": 5184, "user_id": 1935631, "user_type": "registered", "accept_rate": 87, "profile_image": "https://www.gravatar.com/avatar/0e4d0d6c5ce5e9350cacc818ee350347?s=128&d=identicon&r=PG", "display_name": "Sassa NF", "link": "https://stackoverflow.com/users/1935631/sassa-nf"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 46, "favorite_count": 0, "accepted_answer_id": 32660813, "answer_count": 1, "score": 1, "last_activity_date": 1442609422, "creation_date": 1442597192, "question_id": 32657782, "link": "https://stackoverflow.com/questions/32657782/type-mismatch-after-cabal-update", "title": "Type mismatch after cabal update?", "body": "<p>Program has the following import:</p>\n\n<pre><code>import Pipes.Network.TCP\nimport Pipes\nimport Pipes.Core\nimport qualified Data.ByteString.Char8 as C\n</code></pre>\n\n<p>Compilation fails like so:</p>\n\n<pre><code>Couldn't match expected type `bytestring-0.9.2.1:Data.ByteString.Internal.ByteString'\n            with actual type `C.ByteString'\nExpected type: Proxy\n                 Int\n                 bytestring-0.9.2.1:Data.ByteString.Internal.ByteString\n                 ()\n                 b0\n                 m0\n                 ()\n  Actual type: Proxy Int C.ByteString () C.ByteString IO ()\n</code></pre>\n\n<p>I can be more specific about the code, but it looks like this is not related to code - rather some cabal whim. Perhaps, <code>Pipes</code> that I import are considered to use a different <code>ByteString</code> than the one imported with qualified name.</p>\n\n<p>The program used to compile some time ago (I have its working executable), but now it stopped, and I suspect there could have been some cabal update or package installation. How to debug and fix this?</p>\n"}, {"tags": ["haskell", "typeclass"], "answers": [{"comments": [{"owner": {"reputation": 1669, "user_id": 2668681, "user_type": "registered", "accept_rate": 90, "profile_image": "https://i.stack.imgur.com/A1Taq.png?s=128&g=1", "display_name": "Cubi73", "link": "https://stackoverflow.com/users/2668681/cubi73"}, "edited": false, "score": 1, "creation_date": 1442594716, "post_id": 32656894, "comment_id": 53160625, "body": "Before this I actually tried the same syntax, but only wrote <code>instance Stack (List a)</code>. And I forgot to append <code>FlexibleInstances</code> to the pragma. Now it works, thank you :)"}, {"owner": {"reputation": 100185, "user_id": 3234959, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/93bb12ca0f93dfddb33880316f7e66c2?s=128&d=identicon&r=PG&f=1", "display_name": "chi", "link": "https://stackoverflow.com/users/3234959/chi"}, "edited": false, "score": 0, "creation_date": 1442595978, "post_id": 32656894, "comment_id": 53161305, "body": "If every <code>a</code> admits at most a single <code>b</code> such that <code>Stack a b</code> has an instance, a functional dependency <code>a-&gt;b</code> can help the type inference machinery significantly. Otherwise, each call to <code>pop :: a -&gt; a</code> is ambiguous: <code>b</code> can not be determined from the context of <code>pop</code>. (Type families could also be used, of course.)"}, {"owner": {"reputation": 314794, "user_id": 67579, "user_type": "registered", "accept_rate": 81, "profile_image": "https://i.stack.imgur.com/BJXub.png?s=128&g=1", "display_name": "Willem Van Onsem", "link": "https://stackoverflow.com/users/67579/willem-van-onsem"}, "reply_to_user": {"reputation": 100185, "user_id": 3234959, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/93bb12ca0f93dfddb33880316f7e66c2?s=128&d=identicon&r=PG&f=1", "display_name": "chi", "link": "https://stackoverflow.com/users/3234959/chi"}, "edited": false, "score": 0, "creation_date": 1442596362, "post_id": 32656894, "comment_id": 53161492, "body": "@chi: IIRC you can add restrictions, such that there will be only one such <code>b</code> for an <code>a</code>. Will look it up later."}], "tags": [], "owner": {"reputation": 314794, "user_id": 67579, "user_type": "registered", "accept_rate": 81, "profile_image": "https://i.stack.imgur.com/BJXub.png?s=128&g=1", "display_name": "Willem Van Onsem", "link": "https://stackoverflow.com/users/67579/willem-van-onsem"}, "is_accepted": true, "score": 7, "last_activity_date": 1442594227, "last_edit_date": 1442594227, "creation_date": 1442593861, "answer_id": 32656894, "question_id": 32656822, "link": "https://stackoverflow.com/questions/32656822/multiple-type-parameters-in-type-class/32656894#32656894", "title": "Multiple type parameters in type class?", "body": "<p>In that case you can make a multiparameter class:</p>\n\n<pre><code>class Stack a b where\n    push :: a -&gt; b -&gt; a\n    pop :: a -&gt; a\n    last :: a -&gt; b\n</code></pre>\n\n<p>and define it with:</p>\n\n<pre><code>instance Stack (List b) b where --You don't need to use `b`, but this make it easier to understand\n    push list value = Element value list\n    pop Empty = error \"No elements\"\n    pop (Element _ list) = list\n    last Empty = error \"No elements\"\n    last (Element value _) = value\n</code></pre>\n\n<p>Note that this is not a default (standardized) Haskell feature, and that you will need to turn it on. Either by passing <code>-XMultiParamTypeClasses</code> and <code>-XFlexibleInstances</code> to the compiler.</p>\n\n<p>Or you can write:</p>\n\n<pre><code>{-# LANGUAGE MultiParamTypeClasses, FlexibleInstances #-}\n</code></pre>\n\n<p>in the header of your source file.</p>\n\n<hr>\n\n<p>Note that there can be several <code>b</code>'s for one <code>a</code> for which you define an instance (and vice versa). This can make it hard to work with such classes. Say for instance you write a <code>Dummy</code> type:</p>\n\n<pre><code>data Dummy = Dummy\n</code></pre>\n\n<p>you can define:</p>\n\n<pre><code>instance Stack Dummy b where\n    push x = const x\n    pop = id\n    last = const $ error \"Dummy object\"\n</code></pre>\n\n<p>Now it means that you have <code>Stack</code> instance for every possible <code>b</code>, so that you can <code>push</code> and <code>pop</code> all kinds of stuff to <code>Dummy</code> objects.</p>\n"}, {"comments": [{"owner": {"reputation": 1669, "user_id": 2668681, "user_type": "registered", "accept_rate": 90, "profile_image": "https://i.stack.imgur.com/A1Taq.png?s=128&g=1", "display_name": "Cubi73", "link": "https://stackoverflow.com/users/2668681/cubi73"}, "edited": false, "score": 0, "creation_date": 1442595408, "post_id": 32657199, "comment_id": 53161017, "body": "This looks also like a great approach to me. And I&#39;m definitely trying <code>Maybe</code> :)"}, {"owner": {"reputation": 44013, "user_id": 1477667, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/trgKM.jpg?s=128&g=1", "display_name": "dfeuer", "link": "https://stackoverflow.com/users/1477667/dfeuer"}, "reply_to_user": {"reputation": 1669, "user_id": 2668681, "user_type": "registered", "accept_rate": 90, "profile_image": "https://i.stack.imgur.com/A1Taq.png?s=128&g=1", "display_name": "Cubi73", "link": "https://stackoverflow.com/users/2668681/cubi73"}, "edited": false, "score": 0, "creation_date": 1442598768, "post_id": 32657199, "comment_id": 53162649, "body": "@Cubinator73 This is <i>usually</i> the way to go. The multiparameter typeclass approach with a functional dependency (or a single parameter typeclass with an associated type) makes sense if you&#39;re considering multiple monomorphic stack types."}], "tags": [], "owner": {"reputation": 126897, "user_id": 791604, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/ce991df7a056248d5e4f6fc3659ba733?s=128&d=identicon&r=PG", "display_name": "Daniel Wagner", "link": "https://stackoverflow.com/users/791604/daniel-wagner"}, "is_accepted": false, "score": 9, "last_activity_date": 1442594914, "creation_date": 1442594914, "answer_id": 32657199, "question_id": 32656822, "link": "https://stackoverflow.com/questions/32656822/multiple-type-parameters-in-type-class/32657199#32657199", "title": "Multiple type parameters in type class?", "body": "<p>Consider using a higher-kinded class variable. Thus:</p>\n\n<pre><code>class Stack s where\n    push :: s a -&gt; a -&gt; s a\n    pop  :: s a -&gt; s a\n    last :: s a -&gt; a\n\ndata List a = Empty | Element a (List a)\n</code></pre>\n\n<p>The instance remains exactly as you wrote it (though <code>List</code> now has kind <code>* -&gt; *</code> instead of <code>*</code>):</p>\n\n<pre><code>instance Stack List where\n    push list value = Element value list\n    pop Empty = error \"No elements\"\n    pop (Element _ list) = list\n    last Empty = error \"No elements\"\n    last (Element value _) = value\n</code></pre>\n\n<p>This approach is pure Haskell 2010 -- it requires no extensions.</p>\n\n<p>Also, consider making your failures observable; for instance by changing the type of <code>pop</code> and <code>last</code> to return <code>Maybe (s a)</code> and <code>Maybe a</code>, respectively.</p>\n"}], "owner": {"reputation": 1669, "user_id": 2668681, "user_type": "registered", "accept_rate": 90, "profile_image": "https://i.stack.imgur.com/A1Taq.png?s=128&g=1", "display_name": "Cubi73", "link": "https://stackoverflow.com/users/2668681/cubi73"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 457, "favorite_count": 1, "accepted_answer_id": 32656894, "answer_count": 2, "score": 9, "last_activity_date": 1442594914, "creation_date": 1442593619, "question_id": 32656822, "link": "https://stackoverflow.com/questions/32656822/multiple-type-parameters-in-type-class", "title": "Multiple type parameters in type class?", "body": "<p>Lets assume I have a type class <code>Stack</code> with one instance <code>List</code>:</p>\n\n<pre><code>class Stack a where\n    push :: a -&gt; Integer -&gt; a\n    pop :: a -&gt; a\n    last :: a -&gt; Integer\n\ndata List = Empty | Element Integer List\ninstance Stack List where\n    push list value = Element value list\n    pop Empty = error \"No elements\"\n    pop (Element _ list) = list\n    last Empty = error \"No elements\"\n    last (Element value _) = value\n</code></pre>\n\n<p>How <code>Stack</code> has to be defined in order for <code>List</code> to not be limited to <code>Integer</code> values?</p>\n\n<pre><code>-- class Stack (?) where ...\ndata List a = Empty | Element a (List a)\n-- instance Show (List a) where ...\n</code></pre>\n"}, {"tags": ["haskell", "types"], "comments": [{"owner": {"reputation": 33184, "user_id": 247623, "user_type": "registered", "accept_rate": 72, "profile_image": "https://www.gravatar.com/avatar/bb9e67348d3e0e93ef12dd97c41a6c22?s=128&d=identicon&r=PG&f=1", "display_name": "Erik Kaplun", "link": "https://stackoverflow.com/users/247623/erik-kaplun"}, "edited": false, "score": 0, "creation_date": 1442595606, "post_id": 32656321, "comment_id": 53161117, "body": "<code>Num a =&gt; a -&gt; a</code> is not the type of <code>(1+)</code>."}, {"owner": {"reputation": 6159, "user_id": 754705, "user_type": "registered", "accept_rate": 60, "profile_image": "https://www.gravatar.com/avatar/942fe51aac5dc523f0305439fa9a6e3d?s=128&d=identicon&r=PG&f=1", "display_name": "Michael", "link": "https://stackoverflow.com/users/754705/michael"}, "reply_to_user": {"reputation": 33184, "user_id": 247623, "user_type": "registered", "accept_rate": 72, "profile_image": "https://www.gravatar.com/avatar/bb9e67348d3e0e93ef12dd97c41a6c22?s=128&d=identicon&r=PG&f=1", "display_name": "Erik Kaplun", "link": "https://stackoverflow.com/users/247623/erik-kaplun"}, "edited": false, "score": 0, "creation_date": 1442595742, "post_id": 32656321, "comment_id": 53161184, "body": "@ErikAllik: yes it is. If I type <code>:t (1+)</code> into ghci, it tells me <code>(1+) :: Num a =&gt; a -&gt; a</code> - exactly that."}, {"owner": {"reputation": 6159, "user_id": 754705, "user_type": "registered", "accept_rate": 60, "profile_image": "https://www.gravatar.com/avatar/942fe51aac5dc523f0305439fa9a6e3d?s=128&d=identicon&r=PG&f=1", "display_name": "Michael", "link": "https://stackoverflow.com/users/754705/michael"}, "edited": false, "score": 1, "creation_date": 1442600420, "post_id": 32656321, "comment_id": 53163512, "body": "(but that is, of course, not the same as <code>Num a =&gt; Num (a -&gt; a)</code>)"}], "answers": [{"tags": [], "owner": {"reputation": 11366, "user_id": 3922954, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/76ba47d2fdd24ab56b0b273cce2075e5?s=128&d=identicon&r=PG&f=1", "display_name": "AJF", "link": "https://stackoverflow.com/users/3922954/ajf"}, "is_accepted": true, "score": 9, "last_activity_date": 1442592400, "creation_date": 1442592400, "answer_id": 32656493, "question_id": 32656321, "link": "https://stackoverflow.com/questions/32656321/why-isnt-composing-two-functions-working/32656493#32656493", "title": "Why isn&#39;t composing two functions working?", "body": "<p>Let's inspect the individual types:</p>\n\n<pre><code>max :: (Ord a) =&gt; a -&gt; a -&gt; a\n</code></pre>\n\n<p>Okay, this takes an <code>a</code>, and returns a function that takes an <code>a</code> and returns an <code>a</code>.</p>\n\n<pre><code>(1 +) :: (Num a) =&gt; a -&gt; a\n</code></pre>\n\n<p>This is simple enough. It takes a number <code>a</code> and adds one to it.</p>\n\n<p>If we recall that <code>a . b</code> is equivalent to <code>\\q -&gt; a (b q)</code> we get this from your definition:</p>\n\n<pre><code>(1 +) . max   ==   \\q -&gt; 1 + (max q)\n</code></pre>\n\n<p>Can you see the problem? You're passing a type <code>a -&gt; a</code> to <code>(1 +)</code>, <strong>because <code>max</code> is only getting one argument.</strong></p>\n\n<hr>\n\n<p>This is how to fix it, whilst keeping pointfree style.</p>\n\n<pre><code>maxPlusOne = (.) (1 +) . max\n</code></pre>\n\n<p>This expands to</p>\n\n<pre><code>maxPlusOne = \\q -&gt; (1 +) . max q\n</code></pre>\n\n<p>which expands to</p>\n\n<pre><code>maxPlusOne = \\q1 -&gt; \\q2 -&gt; 1 + (max q1 q2)\n</code></pre>\n\n<p>Which is your desired function.</p>\n\n<hr>\n\n<p>You could also define another type of composition:</p>\n\n<pre><code>(.:) :: (c -&gt; d) -&gt; (a -&gt; b -&gt; c) -&gt; (a -&gt; b -&gt; d)\n(.:) f g a b = f (g a b)\n</code></pre>\n\n<p>and then define</p>\n\n<pre><code>maxPlusOne = (+ 1) .: max\n</code></pre>\n"}, {"comments": [{"owner": {"reputation": 31243, "user_id": 2751851, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/4ddc0.png?s=128&g=1", "display_name": "duplode", "link": "https://stackoverflow.com/users/2751851/duplode"}, "edited": false, "score": 2, "creation_date": 1442593315, "post_id": 32656514, "comment_id": 53159919, "body": "It is not wrong to understand <code>(.)</code> as <code>f</code> after <code>g</code>. It&#39;s just that, in <code>f . g</code>, <code>f</code> and <code>g</code> take just one argument -- and indeed <i>all</i> Haskell functions take just one argument."}, {"owner": {"reputation": 11366, "user_id": 3922954, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/76ba47d2fdd24ab56b0b273cce2075e5?s=128&d=identicon&r=PG&f=1", "display_name": "AJF", "link": "https://stackoverflow.com/users/3922954/ajf"}, "reply_to_user": {"reputation": 31243, "user_id": 2751851, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/4ddc0.png?s=128&g=1", "display_name": "duplode", "link": "https://stackoverflow.com/users/2751851/duplode"}, "edited": false, "score": 0, "creation_date": 1442597687, "post_id": 32656514, "comment_id": 53162136, "body": "@duplode I think that&#39;s what many beginners have trouble with: the idea that all Haskell functions take one argument, and that seems to be the case here."}, {"owner": {"reputation": 14582, "user_id": 2225384, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/f30b04ed4d0b3fc4bc791a28815f34ca?s=128&d=identicon&r=PG", "display_name": "Rein Henrichs", "link": "https://stackoverflow.com/users/2225384/rein-henrichs"}, "edited": false, "score": 0, "creation_date": 1442597884, "post_id": 32656514, "comment_id": 53162238, "body": "To which &quot;extensions on <code>(.)</code>&quot; do you refer?"}, {"owner": {"reputation": 314794, "user_id": 67579, "user_type": "registered", "accept_rate": 81, "profile_image": "https://i.stack.imgur.com/BJXub.png?s=128&g=1", "display_name": "Willem Van Onsem", "link": "https://stackoverflow.com/users/67579/willem-van-onsem"}, "reply_to_user": {"reputation": 31243, "user_id": 2751851, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/4ddc0.png?s=128&g=1", "display_name": "duplode", "link": "https://stackoverflow.com/users/2751851/duplode"}, "edited": false, "score": 0, "creation_date": 1442598301, "post_id": 32656514, "comment_id": 53162426, "body": "@duplode: but in mathematics, in general that is regardless of the number of arguments to <code>g</code>. As AJFarmar says, because of the currying aspect of Haskell, <code>. max</code> ouputs a function Int -&gt; Int"}, {"owner": {"reputation": 314794, "user_id": 67579, "user_type": "registered", "accept_rate": 81, "profile_image": "https://i.stack.imgur.com/BJXub.png?s=128&g=1", "display_name": "Willem Van Onsem", "link": "https://stackoverflow.com/users/67579/willem-van-onsem"}, "reply_to_user": {"reputation": 14582, "user_id": 2225384, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/f30b04ed4d0b3fc4bc791a28815f34ca?s=128&d=identicon&r=PG", "display_name": "Rein Henrichs", "link": "https://stackoverflow.com/users/2225384/rein-henrichs"}, "edited": false, "score": 0, "creation_date": 1442598528, "post_id": 32656514, "comment_id": 53162537, "body": "@ReinHenrichs: see <a href=\"http://stackoverflow.com/q/28532836/67579\">my question</a> on the subject. The implementation can be found <a href=\"http://jaspervdj.be/posts/2014-10-17-generalizing-function-composition.html\" rel=\"nofollow noreferrer\">here</a>."}, {"owner": {"reputation": 14582, "user_id": 2225384, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/f30b04ed4d0b3fc4bc791a28815f34ca?s=128&d=identicon&r=PG", "display_name": "Rein Henrichs", "link": "https://stackoverflow.com/users/2225384/rein-henrichs"}, "edited": false, "score": 0, "creation_date": 1442598829, "post_id": 32656514, "comment_id": 53162674, "body": "&quot;but in mathematics, in general that is regardless of the number of arguments to g.&quot; That doesn&#39;t make sense. Mathematical functions have a single domain and codomain. They always &quot;take one argument&quot;. Composition is defined for <code>f . g</code> when <code>g : X -&gt; Y</code> and <code>f : Y -&gt; Z</code>, just like in Haskell."}, {"owner": {"reputation": 14582, "user_id": 2225384, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/f30b04ed4d0b3fc4bc791a28815f34ca?s=128&d=identicon&r=PG", "display_name": "Rein Henrichs", "link": "https://stackoverflow.com/users/2225384/rein-henrichs"}, "edited": false, "score": 0, "creation_date": 1442598980, "post_id": 32656514, "comment_id": 53162761, "body": "@CommuSoft That isn&#39;t a &quot;Haskell extension&quot;. It&#39;s just normal Haskell code."}, {"owner": {"reputation": 314794, "user_id": 67579, "user_type": "registered", "accept_rate": 81, "profile_image": "https://i.stack.imgur.com/BJXub.png?s=128&g=1", "display_name": "Willem Van Onsem", "link": "https://stackoverflow.com/users/67579/willem-van-onsem"}, "reply_to_user": {"reputation": 14582, "user_id": 2225384, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/f30b04ed4d0b3fc4bc791a28815f34ca?s=128&d=identicon&r=PG", "display_name": "Rein Henrichs", "link": "https://stackoverflow.com/users/2225384/rein-henrichs"}, "edited": false, "score": 0, "creation_date": 1442599086, "post_id": 32656514, "comment_id": 53162816, "body": "@ReinHenrichs: indeed, and <i>f(x,y)</i> as far as I have always interpreted it is a tuple as input. Anyway given the question it seems the OP was confused about the <code>.</code>. Furthermore I don&#39;t see why to make a distinction between libraries and extensions. People have already enough on their minds. But no problem if you want to do so."}, {"owner": {"reputation": 14582, "user_id": 2225384, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/f30b04ed4d0b3fc4bc791a28815f34ca?s=128&d=identicon&r=PG", "display_name": "Rein Henrichs", "link": "https://stackoverflow.com/users/2225384/rein-henrichs"}, "edited": false, "score": 0, "creation_date": 1442599244, "post_id": 32656514, "comment_id": 53162887, "body": "<code>f(x,y)</code> is, but <code>f(x)(y)</code> is not. I don&#39;t make the distinction. Libraries and extensions are two different, well defined things. I merely point out the distinction."}, {"owner": {"reputation": 314794, "user_id": 67579, "user_type": "registered", "accept_rate": 81, "profile_image": "https://i.stack.imgur.com/BJXub.png?s=128&g=1", "display_name": "Willem Van Onsem", "link": "https://stackoverflow.com/users/67579/willem-van-onsem"}, "reply_to_user": {"reputation": 14582, "user_id": 2225384, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/f30b04ed4d0b3fc4bc791a28815f34ca?s=128&d=identicon&r=PG", "display_name": "Rein Henrichs", "link": "https://stackoverflow.com/users/2225384/rein-henrichs"}, "edited": false, "score": 0, "creation_date": 1442599278, "post_id": 32656514, "comment_id": 53162904, "body": "@ReinHenrichs: yes, that&#39;s the currying principle. And your point is... Furthermore why do we have this waste-of-energy discussion anyway. As said before, it looks like the OP (and a lot of people had a slightly different view on the <code>(.)</code> operator)."}, {"owner": {"reputation": 14582, "user_id": 2225384, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/f30b04ed4d0b3fc4bc791a28815f34ca?s=128&d=identicon&r=PG", "display_name": "Rein Henrichs", "link": "https://stackoverflow.com/users/2225384/rein-henrichs"}, "edited": false, "score": 1, "creation_date": 1442599346, "post_id": 32656514, "comment_id": 53162945, "body": "My point is that you are making incorrect statements that might further confuse the OP."}, {"owner": {"reputation": 314794, "user_id": 67579, "user_type": "registered", "accept_rate": 81, "profile_image": "https://i.stack.imgur.com/BJXub.png?s=128&g=1", "display_name": "Willem Van Onsem", "link": "https://stackoverflow.com/users/67579/willem-van-onsem"}, "edited": false, "score": 0, "creation_date": 1442599435, "post_id": 32656514, "comment_id": 53163002, "body": "That&#39;s why stack overflow made sure one can add multiple answers to a question, and nature made sure there are enough people with no lives to give answers (and comments) on SO ;). Most people (probably including the OP) seem to have problems with the fact that in Haskell (although it looks syntactically that way), have no functions with more than one parameter while some mathematical books seem to suggest these (and work with these)."}, {"owner": {"reputation": 31243, "user_id": 2751851, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/4ddc0.png?s=128&g=1", "display_name": "duplode", "link": "https://stackoverflow.com/users/2751851/duplode"}, "edited": false, "score": 0, "creation_date": 1442616109, "post_id": 32656514, "comment_id": 53170467, "body": "&quot;I don&#39;t see why to make a distinction between libraries and extensions. People have already enough on their minds.&quot; -- Because if you don&#39;t people will be even more confused when they meet <a href=\"https://downloads.haskell.org/~ghc/latest/docs/html/users_guide/ghc-language-features.html\" rel=\"nofollow noreferrer\">actual extensions</a>."}, {"owner": {"reputation": 314794, "user_id": 67579, "user_type": "registered", "accept_rate": 81, "profile_image": "https://i.stack.imgur.com/BJXub.png?s=128&g=1", "display_name": "Willem Van Onsem", "link": "https://stackoverflow.com/users/67579/willem-van-onsem"}, "reply_to_user": {"reputation": 31243, "user_id": 2751851, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/4ddc0.png?s=128&g=1", "display_name": "duplode", "link": "https://stackoverflow.com/users/2751851/duplode"}, "edited": false, "score": 0, "creation_date": 1442616285, "post_id": 32656514, "comment_id": 53170534, "body": "@duplode: from the moment a language supports (Turing complete) metaprogramming, you can turn almost all extensions into libraries and vice versa."}, {"owner": {"reputation": 31243, "user_id": 2751851, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/4ddc0.png?s=128&g=1", "display_name": "duplode", "link": "https://stackoverflow.com/users/2751851/duplode"}, "edited": false, "score": 0, "creation_date": 1442616452, "post_id": 32656514, "comment_id": 53170586, "body": "@CommuSoft But we aren&#39;t talking abstractly about an arbitrary language; we are talking about Haskell, in which those terms mean different things."}, {"owner": {"reputation": 314794, "user_id": 67579, "user_type": "registered", "accept_rate": 81, "profile_image": "https://i.stack.imgur.com/BJXub.png?s=128&g=1", "display_name": "Willem Van Onsem", "link": "https://stackoverflow.com/users/67579/willem-van-onsem"}, "reply_to_user": {"reputation": 31243, "user_id": 2751851, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/4ddc0.png?s=128&g=1", "display_name": "duplode", "link": "https://stackoverflow.com/users/2751851/duplode"}, "edited": false, "score": 0, "creation_date": 1442616557, "post_id": 32656514, "comment_id": 53170618, "body": "@duplode: and there comes in the part that Haskell has its own <a href=\"https://wiki.haskell.org/Template_Haskell\" rel=\"nofollow noreferrer\">template programming</a> which facilitates thus meta programming..."}, {"owner": {"reputation": 31243, "user_id": 2751851, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/4ddc0.png?s=128&g=1", "display_name": "duplode", "link": "https://stackoverflow.com/users/2751851/duplode"}, "edited": false, "score": 0, "creation_date": 1442616716, "post_id": 32656514, "comment_id": 53170662, "body": "@CommuSoft ... which has no bearing on the fact that &quot;library&quot; and &quot;extension&quot; mean different things when talking about Haskell."}, {"owner": {"reputation": 314794, "user_id": 67579, "user_type": "registered", "accept_rate": 81, "profile_image": "https://i.stack.imgur.com/BJXub.png?s=128&g=1", "display_name": "Willem Van Onsem", "link": "https://stackoverflow.com/users/67579/willem-van-onsem"}, "reply_to_user": {"reputation": 31243, "user_id": 2751851, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/4ddc0.png?s=128&g=1", "display_name": "duplode", "link": "https://stackoverflow.com/users/2751851/duplode"}, "edited": false, "score": 0, "creation_date": 1442616854, "post_id": 32656514, "comment_id": 53170696, "body": "@duplode: No, an extension means that the compiler will accept &quot;more&quot; than the grammar originally defined by the programming language so to speak. With template programming, you can instruct your compiler to do this. Furthermore it is the same as the data/programming tradeoff. Because of Rice&#39;s theorem a lot of concepts in computer science are rather &quot;unstrictly defined&quot;. Furthermore as said before this is a non-discussion (it&#39;s already a comment about a comment). Please invest your energy in something more useful than this discussion ;)."}, {"owner": {"reputation": 31243, "user_id": 2751851, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/4ddc0.png?s=128&g=1", "display_name": "duplode", "link": "https://stackoverflow.com/users/2751851/duplode"}, "edited": false, "score": 0, "creation_date": 1442617356, "post_id": 32656514, "comment_id": 53170849, "body": "@CommuSoft &quot;Please invest your energy in something more useful than this discussion&quot; -- Funny how I was about to say exactly the same. If you think that lecturing me on a topic that is wholly unrelated to the issue at hand somehow frees you from conceding the point, I guess you should consider ways of making the discussions you engage in more useful."}], "tags": [], "owner": {"reputation": 314794, "user_id": 67579, "user_type": "registered", "accept_rate": 81, "profile_image": "https://i.stack.imgur.com/BJXub.png?s=128&g=1", "display_name": "Willem Van Onsem", "link": "https://stackoverflow.com/users/67579/willem-van-onsem"}, "is_accepted": false, "score": -2, "last_activity_date": 1442598541, "last_edit_date": 1442598541, "creation_date": 1442592482, "answer_id": 32656514, "question_id": 32656321, "link": "https://stackoverflow.com/questions/32656321/why-isnt-composing-two-functions-working/32656514#32656514", "title": "Why isn&#39;t composing two functions working?", "body": "<p>I think you interpret the <code>.</code> too mathematically (as in <code>f</code> \"after\" <code>g</code>). The <code>.</code> is simply:</p>\n\n<pre><code>(.) :: (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c\n</code></pre>\n\n<p>So its semantical meaning is that it takes one parameter <code>a</code>, then calls <code>g</code> on <code>a</code>, and then call <code>f</code> on <code>g</code>. You can define it as:</p>\n\n<pre><code>(.) f g x = f $ g x\n</code></pre>\n\n<p>Although Haskell extensions are proposed (like <a href=\"http://jaspervdj.be/posts/2014-10-17-generalizing-function-composition.html\" rel=\"nofollow\">this one</a>) that use the type system to derive how much \"parameters\" to transport, and some have written this in template Haskell, it is not a standard feature.</p>\n\n<p><strong>How can you solve it?</strong></p>\n\n<p>Simply query at least one parameter <code>x</code> in the head of your function:</p>\n\n<pre><code>maxPlusOne :: (Ord a, Num a) =&gt; a -&gt; a -&gt; a\nmaxPlusOne x = (1+) . max x\n</code></pre>\n\n<p>or specify it fully:</p>\n\n<pre><code>maxPlusOne :: (Ord a, Num a) =&gt; a -&gt; a -&gt; a\nmaxPlusOne x y = (1+) $ max x y\n</code></pre>\n\n<p>or use extensions on <code>(.)</code>.</p>\n\n<p>If you use <a href=\"http://jaspervdj.be/posts/2014-10-17-generalizing-function-composition.html\" rel=\"nofollow\">jaspervdj's extension</a></p>\n\n<pre><code>maxPlusOne :: (Ord a, Num a) =&gt; a -&gt; a -&gt; a\nmaxPlusOne = (1+) $.$ max\n</code></pre>\n"}], "owner": {"reputation": 307, "user_id": 651597, "user_type": "registered", "accept_rate": 56, "profile_image": "https://www.gravatar.com/avatar/e1262c61afa9a921562281559f282c17?s=128&d=identicon&r=PG", "display_name": "Bladt", "link": "https://stackoverflow.com/users/651597/bladt"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 98, "favorite_count": 0, "accepted_answer_id": 32656493, "answer_count": 2, "score": 2, "last_activity_date": 1442598541, "creation_date": 1442591830, "last_edit_date": 1442597571, "question_id": 32656321, "link": "https://stackoverflow.com/questions/32656321/why-isnt-composing-two-functions-working", "title": "Why isn&#39;t composing two functions working?", "body": "<p>Apart from readability and loss of generality, what is wrong with the following definition:</p>\n\n<pre><code>maxPlusOne :: (Ord a, Num a) =&gt; a -&gt; a -&gt; a\nmaxPlusOne = (1+) . max\n</code></pre>\n\n<p>The compiler will complain that it can't deduce <code>Num (a -&gt; a)</code> from <code>+</code>.\nBut it seems to me what it needs is <code>Num a =&gt; a -&gt; a</code>, which is precisely the type of <code>(1+)</code>.</p>\n\n<p>Here's the error:</p>\n\n<pre><code>&lt;interactive&gt;:5:52:\n    Could not deduce (Num (a -&gt; a)) arising from a use of \u2018+\u2019\n    from the context (Ord a, Num a)\n</code></pre>\n"}, {"tags": ["haskell", "data-structures", "functional-programming"], "comments": [{"owner": {"reputation": 64805, "user_id": 286871, "user_type": "registered", "accept_rate": 77, "profile_image": "https://i.stack.imgur.com/xNBpr.png?s=128&g=1", "display_name": "Tikhon Jelvis", "link": "https://stackoverflow.com/users/286871/tikhon-jelvis"}, "edited": false, "score": 2, "creation_date": 1442630396, "post_id": 32656293, "comment_id": 53173384, "body": "Recommending a <i>data structure</i> is fundamentally different from recommending a library or external resource. This question is fine and should not be closed."}, {"owner": {"reputation": 9262, "user_id": 124951, "user_type": "registered", "accept_rate": 20, "profile_image": "https://www.gravatar.com/avatar/c46d5911a8fb4ffd5fb8523d56a60de0?s=128&d=identicon&r=PG", "display_name": "salva", "link": "https://stackoverflow.com/users/124951/salva"}, "edited": false, "score": 0, "creation_date": 1442645185, "post_id": 32656293, "comment_id": 53176283, "body": "A k-d tree works well if the number of dimensions is not to high."}, {"owner": {"reputation": 44680, "user_id": 1031791, "user_type": "registered", "accept_rate": 54, "profile_image": "https://www.gravatar.com/avatar/fb710534fda446d2286074bb7692e65a?s=128&d=identicon&r=PG", "display_name": "MaiaVictor", "link": "https://stackoverflow.com/users/1031791/maiavictor"}, "edited": false, "score": 0, "creation_date": 1442676330, "post_id": 32656293, "comment_id": 53185511, "body": "I was wondering if there is a structure specialized for that operation, quadtrees/k-d trees are more powerful in general."}], "answers": [{"tags": [], "owner": {"reputation": 126897, "user_id": 791604, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/ce991df7a056248d5e4f6fc3659ba733?s=128&d=identicon&r=PG", "display_name": "Daniel Wagner", "link": "https://stackoverflow.com/users/791604/daniel-wagner"}, "is_accepted": true, "score": 4, "last_activity_date": 1442594691, "creation_date": 1442594691, "answer_id": 32657140, "question_id": 32656293, "link": "https://stackoverflow.com/questions/32656293/what-is-a-purely-functional-data-structure-for-fast-nearest-neighbor-search-on-n/32657140#32657140", "title": "What is a purely functional data structure for fast nearest neighbor search on n-dimensional space?", "body": "<p>There is a natural generalization of <a href=\"https://en.wikipedia.org/wiki/Quadtree\" rel=\"nofollow\">quadtrees</a> from two dimensions to n.</p>\n"}, {"tags": [], "owner": {"reputation": 612, "user_id": 1418884, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/ce482326fc0c90444d3ae1d355717ebf?s=128&d=identicon&r=PG", "display_name": "Andreas", "link": "https://stackoverflow.com/users/1418884/andreas"}, "is_accepted": false, "score": 3, "last_activity_date": 1442648725, "creation_date": 1442648725, "answer_id": 32665697, "question_id": 32656293, "link": "https://stackoverflow.com/questions/32656293/what-is-a-purely-functional-data-structure-for-fast-nearest-neighbor-search-on-n/32665697#32665697", "title": "What is a purely functional data structure for fast nearest neighbor search on n-dimensional space?", "body": "<p>For an n-dimensional space, there is also the <a href=\"https://en.wikipedia.org/wiki/K-d_tree\" rel=\"nofollow\">k-d tree</a>.</p>\n"}], "owner": {"reputation": 44680, "user_id": 1031791, "user_type": "registered", "accept_rate": 54, "profile_image": "https://www.gravatar.com/avatar/fb710534fda446d2286074bb7692e65a?s=128&d=identicon&r=PG", "display_name": "MaiaVictor", "link": "https://stackoverflow.com/users/1031791/maiavictor"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 107, "favorite_count": 0, "accepted_answer_id": 32657140, "answer_count": 2, "score": 6, "last_activity_date": 1442648725, "creation_date": 1442591722, "question_id": 32656293, "link": "https://stackoverflow.com/questions/32656293/what-is-a-purely-functional-data-structure-for-fast-nearest-neighbor-search-on-n", "title": "What is a purely functional data structure for fast nearest neighbor search on n-dimensional space?", "body": "<p>I'm looking for a purely functional data structure with an API such as:</p>\n\n<pre><code>insert  :: Vector n Int -&gt; Struct n -&gt; Struct n\nremove  :: Vector n Int -&gt; Struct n -&gt; Struct n\nnearest :: Vector n Int -&gt; Struct n -&gt; Vector n Int\n</code></pre>\n\n<p>Or some variation of that, providing fast insertion, removal and query for the nearest element in an n-dimensional space. What is that data-structure?</p>\n"}, {"tags": ["haskell", "types", "monad-transformers"], "comments": [{"owner": {"reputation": 100185, "user_id": 3234959, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/93bb12ca0f93dfddb33880316f7e66c2?s=128&d=identicon&r=PG&f=1", "display_name": "chi", "link": "https://stackoverflow.com/users/3234959/chi"}, "edited": false, "score": 2, "creation_date": 1442589781, "post_id": 32654814, "comment_id": 53157753, "body": "<code>ST</code> uses RankN types, and type inference with those does not really work well. For instance <code>runST action</code> could be OK while <code>runST $ action</code> errors out. GHC devs have added a <i>hack</i> in ithe inference engine to treat the latter as the former, but this only applies to <code>$</code>. If you use <code>.</code> or even a redefinition of <code>$</code>, things stop working."}], "answers": [{"tags": [], "owner": {"reputation": 2271, "user_id": 4994500, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/233389523330bec1d6e95f4c480d5741?s=128&d=identicon&r=PG&f=1", "display_name": "Sam van Herwaarden", "link": "https://stackoverflow.com/users/4994500/sam-van-herwaarden"}, "is_accepted": true, "score": 4, "last_activity_date": 1442589135, "last_edit_date": 1495542146, "creation_date": 1442589135, "answer_id": 32655417, "question_id": 32654814, "link": "https://stackoverflow.com/questions/32654814/trouble-with-sts-type-in-a-transformer-stack/32655417#32655417", "title": "Trouble with ST&#39;s type in a transformer stack", "body": "<p>All you need to do is replace the <code>.</code> behind <code>runST</code> by <code>$</code>, and then you can use ordinary <code>return</code> instead of <code>return'</code> as well.</p>\n\n<pre><code>import Control.Monad\nimport Control.Monad.ST\nimport Control.Monad.Except\n\nfunction :: a -&gt; Either String a\nfunction x = runST $ runExceptT $ do\n               return x\n\nmain = return ()\n</code></pre>\n\n<p>(At least for me this compiles, without problems.)</p>\n\n<p>See <a href=\"https://stackoverflow.com/questions/9468963/runst-and-function-composition\">this answer</a> for the theory behind the error. </p>\n"}], "owner": {"reputation": 22377, "user_id": 2288659, "user_type": "registered", "accept_rate": 90, "profile_image": "https://i.stack.imgur.com/bBg8v.png?s=128&g=1", "display_name": "Silvio Mayolo", "link": "https://stackoverflow.com/users/2288659/silvio-mayolo"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 84, "favorite_count": 0, "accepted_answer_id": 32655417, "answer_count": 1, "score": 2, "last_activity_date": 1442589135, "creation_date": 1442587484, "question_id": 32654814, "link": "https://stackoverflow.com/questions/32654814/trouble-with-sts-type-in-a-transformer-stack", "title": "Trouble with ST&#39;s type in a transformer stack", "body": "<p>I am having some trouble dealing with the <code>forall</code> quantifier in <code>ST</code>'s type. The following (simplified) code sample works fine, producing the expected result.</p>\n\n<pre><code>import Control.Monad\nimport Control.Monad.ST\n\nreturn' :: a -&gt; ST s a\nreturn' = return\n\nfunction :: a -&gt; a\nfunction x = runST $ do\n               -- Some complicated expression eventually producing a result\n               return' x\n</code></pre>\n\n<p>This is fine, if all I want to do is have <code>ST</code>. But in my computation, I want a state transformer computation that might also fail, so I attempt to add <code>ExceptT</code> to the stack.</p>\n\n<pre><code>import Control.Monad\nimport Control.Monad.ST\nimport Control.Monad.Except\n\nreturn' :: a -&gt; ExceptT String (ST s) a\nreturn' = return\n\nfunction :: a -&gt; Either String a\nfunction x = runST . runExceptT $ do\n               -- Some complicated expression that might fail\n               return' x\n</code></pre>\n\n<p>Unfortunately, I get a rather bizarre error message.</p>\n\n<pre><code>example.hs:9:14:\n    Couldn't match type `ST s0 (Either String a)'\n                   with `forall s. ST s (Either String a)'\n    Expected type: ST s0 (Either String a) -&gt; Either String a\n      Actual type: (forall s. ST s (Either String a))\n                   -&gt; Either String a\n    Relevant bindings include\n      x :: a (bound at example.hs:9:10)\n      function :: a -&gt; Either String a (bound at example.hs:9:1)\n    In the first argument of `(.)', namely `runST'\n    In the expression: runST . runExceptT\n</code></pre>\n\n<p>I have only a vague understanding of the rank-2 type used by <code>ST</code>, so I'm not really sure how to approach this error. How can I safely put <code>ST</code> at the bottom of a monad transformer stack without getting problems with the <code>forall</code>?</p>\n\n<p>(For those curious, I'm using <code>ST</code> because I want my computation to use a mutable array and then freeze it at the end. That shouldn't be relevant to this problem, but this is why I can't simply use <code>State</code> instead)</p>\n"}, {"tags": ["windows", "haskell", "haskell-stack"], "answers": [{"comments": [{"owner": {"reputation": 60956, "user_id": 8922, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/f1634a09333f7b391db92e1d2bea6253?s=128&d=identicon&r=PG", "display_name": "Sebastian Redl", "link": "https://stackoverflow.com/users/8922/sebastian-redl"}, "edited": false, "score": 0, "creation_date": 1468571756, "post_id": 32654494, "comment_id": 64191732, "body": "This solution worked for me on Windows 10 with Stack 1.1.2 64-bit."}, {"owner": {"reputation": 3411, "user_id": 69663, "user_type": "registered", "accept_rate": 33, "profile_image": "https://i.stack.imgur.com/aiMZN.png?s=128&g=1", "display_name": "unhammer", "link": "https://stackoverflow.com/users/69663/unhammer"}, "edited": false, "score": 0, "creation_date": 1566904489, "post_id": 32654494, "comment_id": 101793859, "body": "Is there a way to do this without IE installed?"}], "tags": [], "owner": {"reputation": 1141, "user_id": 2646248, "user_type": "registered", "accept_rate": 62, "profile_image": "https://i.stack.imgur.com/bZslk.jpg?s=128&g=1", "display_name": "Dominique Unruh", "link": "https://stackoverflow.com/users/2646248/dominique-unruh"}, "is_accepted": false, "score": 12, "last_activity_date": 1442586451, "creation_date": 1442586451, "answer_id": 32654494, "question_id": 32654493, "link": "https://stackoverflow.com/questions/32654493/stack-haskell-throws-tlsexception-in-windows/32654494#32654494", "title": "Stack (Haskell) throws TlsException in Windows", "body": "<p>This is due to a certificates not being found by <code>stack</code> when accessing various website. It can be fixed by opening the correct webpage in Internet Explorer (which automatically adds the certificate), and then starting stack again.</p>\n\n<p>To find out which webpage stack accesses, run stack with the verbose option (-v) to see the last attempted download before the failure. E.g.:</p>\n\n<pre><code>C:\\&gt; stack -v setup\n... some output ...\n2015-09-18 14:19:14.9807056: [debug] Downloading from https://www.haskell.org/ghc/dist/7.10.1/ghc-7.10.1-i386-unknown-mingw32.tar.xz to C:\\... @(stack_GXibO6avQtx8ez3M6BHFie:Stack.Setup src/Stack\\Setup.hs:845:5)\nTlsException (HandshakeFailed (Error_Protocol (\"certificate has unknown CA\",True,UnknownCa)))\n</code></pre>\n\n<p>(Note: The exact messages may differ. Because the problem is solved on my computer now, I cannot reproduce the exact error without reinstalling Windows.)</p>\n\n<p>So stack is downloading from <a href=\"https://www.haskell.org/\" rel=\"noreferrer\">https://www.haskell.org/</a>, so we need to open <a href=\"https://www.haskell.org/\" rel=\"noreferrer\">https://www.haskell.org/</a> in Internet explorer. Afterwards stack should work (possibly you need to repeat this step to add different certificates).</p>\n\n<p>Other webpages which stack seems to access are: <a href=\"https://github.com\" rel=\"noreferrer\">https://github.com</a>, <a href=\"https://www.stackage.org\" rel=\"noreferrer\">https://www.stackage.org</a>.</p>\n\n<p>This solution is verified on Win 7 32-bit with Stack 0.1.4.0.</p>\n"}], "owner": {"reputation": 1141, "user_id": 2646248, "user_type": "registered", "accept_rate": 62, "profile_image": "https://i.stack.imgur.com/bZslk.jpg?s=128&g=1", "display_name": "Dominique Unruh", "link": "https://stackoverflow.com/users/2646248/dominique-unruh"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 1140, "favorite_count": 3, "answer_count": 1, "score": 11, "last_activity_date": 1442708210, "creation_date": 1442586451, "last_edit_date": 1442708210, "question_id": 32654493, "link": "https://stackoverflow.com/questions/32654493/stack-haskell-throws-tlsexception-in-windows", "title": "Stack (Haskell) throws TlsException in Windows", "body": "<p><a href=\"https://github.com/commercialhaskell/stack/\">Stack</a> (under Windows) sometimes throws the following exception when trying to download files (e.g., during <code>stack setup</code> or while downloading a build plan):</p>\n\n<pre><code>TlsException (HandshakeFailed (Error_Protocol (\"certificate has unknown CA\",True,UnknownCa))).\n</code></pre>\n\n<p>How to get around this error if it occurs?</p>\n\n<p>(This was discussed and solved on <a href=\"https://github.com/commercialhaskell/stack/issues/234\">https://github.com/commercialhaskell/stack/issues/234</a>, I am reposting the question to make the solution more available.)</p>\n"}, {"tags": ["haskell", "authentication", "registration", "scotty"], "owner": {"reputation": 1084, "user_id": 3893319, "user_type": "registered", "accept_rate": 79, "profile_image": "https://i.stack.imgur.com/wd9aa.jpg?s=128&g=1", "display_name": "Reygoch", "link": "https://stackoverflow.com/users/3893319/reygoch"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 318, "favorite_count": 2, "answer_count": 0, "score": 7, "last_activity_date": 1442573542, "creation_date": 1442573542, "question_id": 32650193, "link": "https://stackoverflow.com/questions/32650193/user-registration-in-scotty", "title": "User registration in Scotty", "body": "<p>While learning Haskell I've made a small web app in <a href=\"https://github.com/scotty-web/scotty\" rel=\"noreferrer\">Scotty</a> framework. Next I'd like to add user registration.</p>\n\n<p>Registration should support email/password and Google/FaceBook login options. If user registers \"on site\" he should also be able to login with G/FB account and vice versa.</p>\n\n<p>Is there some standard/easy way of achieving this with <a href=\"https://github.com/scotty-web/scotty\" rel=\"noreferrer\">Scotty</a>?</p>\n\n<p>I don't really like doing registration and authentication my self, but I guess just some pointers on how to implement standard email/password reg/auth would be helpful.</p>\n"}, {"tags": ["haskell", "maybe"], "comments": [{"owner": {"reputation": 33184, "user_id": 247623, "user_type": "registered", "accept_rate": 72, "profile_image": "https://www.gravatar.com/avatar/bb9e67348d3e0e93ef12dd97c41a6c22?s=128&d=identicon&r=PG&f=1", "display_name": "Erik Kaplun", "link": "https://stackoverflow.com/users/247623/erik-kaplun"}, "edited": false, "score": 1, "creation_date": 1442571651, "post_id": 32649446, "comment_id": 53146069, "body": "use the <code>String</code> type alias not <code>[Char]</code>. also I suspect thr 2nd pattern match is redundant."}, {"owner": {"reputation": 100185, "user_id": 3234959, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/93bb12ca0f93dfddb33880316f7e66c2?s=128&d=identicon&r=PG&f=1", "display_name": "chi", "link": "https://stackoverflow.com/users/3234959/chi"}, "edited": false, "score": 2, "creation_date": 1442576299, "post_id": 32649446, "comment_id": 53148771, "body": "Note that <code>fromMaybe</code> is fine, but <code>fromJust</code> is dangerous since it is partial: it will crash your program if it is ever applied to <code>Nothing</code>."}], "answers": [{"tags": [], "owner": {"reputation": 84157, "user_id": 238978, "user_type": "registered", "accept_rate": 50, "profile_image": "https://www.gravatar.com/avatar/a633afaf19e6d4bb53ee50b62e3b5397?s=128&d=identicon&r=PG", "display_name": "Emil Vikstr&#246;m", "link": "https://stackoverflow.com/users/238978/emil-vikstr%c3%b6m"}, "is_accepted": true, "score": 17, "last_activity_date": 1442571339, "creation_date": 1442571339, "answer_id": 32649507, "question_id": 32649446, "link": "https://stackoverflow.com/questions/32649446/not-in-scope-frommaybe-haskell/32649507#32649507", "title": "Not in scope: `fromMaybe&#39; - haskell", "body": "<p>You need to import the Data.Maybe module:</p>\n\n<pre><code>import Data.Maybe\n</code></pre>\n"}], "owner": {"reputation": 173, "user_id": 5326168, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/4658a9f434eb19c3e1fb7984a22c52b7?s=128&d=identicon&r=PG&f=1", "display_name": "kam kimo", "link": "https://stackoverflow.com/users/5326168/kam-kimo"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 3814, "favorite_count": 0, "accepted_answer_id": 32649507, "answer_count": 1, "score": 5, "last_activity_date": 1442571339, "creation_date": 1442571137, "question_id": 32649446, "link": "https://stackoverflow.com/questions/32649446/not-in-scope-frommaybe-haskell", "title": "Not in scope: `fromMaybe&#39; - haskell", "body": "<p>I have a string and a list lst of string  and I should return  nothing if the lst  does not contains the given string  or just list' where list' is identic to the lst except that the first occurene of the given string removed.</p>\n\n<pre><code>allExcept :: [Char] -&gt; [[Char]] -&gt; Maybe [[Char]]\n\nallExcept ch1 chars \n   | ch1  `notElem` chars = Nothing\n\nallExcept ch [] = []      \nallExcept ch (x:xs)\n  | ch /= x = Just(x:(fromJust(allExcept ch xs)))\n  | otherwise = Just(xs)  \n</code></pre>\n\n<p>the result of my code is : \n                Not in scope: `fromMaybe'</p>\n"}, {"tags": ["haskell", "functional-programming", "do-notation"], "comments": [{"owner": {"reputation": 33184, "user_id": 247623, "user_type": "registered", "accept_rate": 72, "profile_image": "https://www.gravatar.com/avatar/bb9e67348d3e0e93ef12dd97c41a6c22?s=128&d=identicon&r=PG&f=1", "display_name": "Erik Kaplun", "link": "https://stackoverflow.com/users/247623/erik-kaplun"}, "edited": false, "score": 0, "creation_date": 1442570078, "post_id": 32646857, "comment_id": 53145168, "body": "monadic operations work on <code>m (a,b)</code>, nothing suggests they should work on <code>(m a, m b)</code> values too \u2014 tuples are regular values of tuple types; whereas there&#39;s some special, non-generic syntactic sugar for constructing them, tuples are <i>not</i> syntactic structures, so there&#39;s not reason why <code>(m a, m b)</code> could be directly used with <code>&gt;&gt;=</code>."}], "answers": [{"comments": [{"owner": {"reputation": 14781, "user_id": 630160, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/4445f21326af525a8ad19af7e3ae41a8?s=128&d=identicon&r=PG", "display_name": "epsilonhalbe", "link": "https://stackoverflow.com/users/630160/epsilonhalbe"}, "edited": false, "score": 0, "creation_date": 1442564310, "post_id": 32647106, "comment_id": 53141611, "body": "for just extracting the second component of the tuple you can also use <code>snd</code>"}], "tags": [], "owner": {"reputation": 14781, "user_id": 630160, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/4445f21326af525a8ad19af7e3ae41a8?s=128&d=identicon&r=PG", "display_name": "epsilonhalbe", "link": "https://stackoverflow.com/users/630160/epsilonhalbe"}, "is_accepted": false, "score": 1, "last_activity_date": 1442564155, "creation_date": 1442564155, "answer_id": 32647106, "question_id": 32646857, "link": "https://stackoverflow.com/questions/32646857/store-result-of-function-applications-in-a-tuple-inside-a-do-block/32647106#32647106", "title": "Store result of function applications in a tuple inside a DO-block", "body": "<p>you will need a helper function to lift the <code>IO</code> from inside the tuple\nfor brevity's sake I will use <code>Int</code> instead of  <code>Num a =&gt; a</code></p>\n\n<pre><code>(bar 1, bar 2) :: (IO Int, IO Int)\n</code></pre>\n\n<p>thus you need something with signature</p>\n\n<pre><code>liftTuple :: (IO x, IO y) -&gt; IO (x, y)\nliftTuple (mx, my) = ...\n</code></pre>\n\n<p>then you can do the <code>(x,y) &lt;- liftTuple (bar 1, bar 2)</code></p>\n"}, {"comments": [{"owner": {"reputation": 2282, "user_id": 1035792, "user_type": "registered", "accept_rate": 81, "profile_image": "https://i.stack.imgur.com/cQjEY.png?s=128&g=1", "display_name": "gsscoder", "link": "https://stackoverflow.com/users/1035792/gsscoder"}, "edited": false, "score": 0, "creation_date": 1442572920, "post_id": 32647335, "comment_id": 53146802, "body": "+1 and this answers. I&#39;m learning Haskell and sometimes I forgot that also tuple constructor <code>(,)</code> is a function. Thanks for terse sample. Yes in my question <code>x</code> is thrown away, but not in real code."}], "tags": [], "owner": {"reputation": 100892, "user_id": 745903, "user_type": "registered", "accept_rate": 74, "profile_image": "https://www.gravatar.com/avatar/50933f6638836741e620669b3940410e?s=128&d=identicon&r=PG", "display_name": "leftaroundabout", "link": "https://stackoverflow.com/users/745903/leftaroundabout"}, "is_accepted": true, "score": 7, "last_activity_date": 1442564910, "creation_date": 1442564910, "answer_id": 32647335, "question_id": 32646857, "link": "https://stackoverflow.com/questions/32646857/store-result-of-function-applications-in-a-tuple-inside-a-do-block/32647335#32647335", "title": "Store result of function applications in a tuple inside a DO-block", "body": "<pre><code>import Control.Applicative\n\ntest = do (x,y) &lt;- (,) &lt;$&gt; bar 10 &lt;*&gt; bar 20\n          return y\n</code></pre>\n\n<p>Aka <code>(x,y) &lt;- liftA2(,) (bar 10) (bar 20)</code>.</p>\n\n<p>Of course, for this specific example (where <code>x</code> is just thrown away) it would be equivalent and much better to just write</p>\n\n<pre><code>test = bar 20\n</code></pre>\n"}, {"comments": [{"owner": {"reputation": 2282, "user_id": 1035792, "user_type": "registered", "accept_rate": 81, "profile_image": "https://i.stack.imgur.com/cQjEY.png?s=128&g=1", "display_name": "gsscoder", "link": "https://stackoverflow.com/users/1035792/gsscoder"}, "edited": false, "score": 0, "creation_date": 1442573139, "post_id": 32647352, "comment_id": 53146938, "body": "+1: thanks for rewriting <code>bar</code> and further explanations. Functions in question are just a excuse to simplifiy the post, I&#39;m obviously don&#39;t put stuff in <code>IO</code> monad if not necessary... :)"}], "tags": [], "owner": {"reputation": 2271, "user_id": 4994500, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/233389523330bec1d6e95f4c480d5741?s=128&d=identicon&r=PG&f=1", "display_name": "Sam van Herwaarden", "link": "https://stackoverflow.com/users/4994500/sam-van-herwaarden"}, "is_accepted": false, "score": 6, "last_activity_date": 1442566174, "last_edit_date": 1442566174, "creation_date": 1442564979, "answer_id": 32647352, "question_id": 32646857, "link": "https://stackoverflow.com/questions/32646857/store-result-of-function-applications-in-a-tuple-inside-a-do-block/32647352#32647352", "title": "Store result of function applications in a tuple inside a DO-block", "body": "<p>I will take the freedom to suggest a few changes to your code. Here is my version:</p>\n\n<pre><code>import Control.Monad\n\n-- no need for the do and let\nbar :: Num a =&gt; a -&gt; IO a\nbar x = return $ x + 1 -- or: bar = return . (1+)\n\n-- liftM2 to make (,) work on IO values\ntest :: Num a =&gt; IO a\ntest = do (x,y) &lt;- liftM2 (,) (bar 10) (bar 20) -- or: (,) &lt;$&gt; bar 10 &lt;*&gt; bar 20\n          return y\n\n-- show that this actually works\nmain :: IO ()\nmain = test &gt;&gt;= print\n</code></pre>\n\n<p>Your types did not match: your <code>(bar 10, bar 20)</code> evaluates to type <code>Num a =&gt; (IO a, IO a)</code> but you're treating it as <code>Num a =&gt; IO (a, a)</code>. By lifting <code>(,)</code> we're making it work on <code>IO</code> values, and returning an <code>IO</code> value.</p>\n\n<p>Look at this (GHCi, <code>import Control.Monad</code> to get <code>liftM2</code>):</p>\n\n<pre><code>:t (,)\n-- type is :: a -&gt; b -&gt; (a, b)\n\n:t liftM2 (,)\n-- type is :: Monad m =&gt; m a -&gt; m b -&gt; m (a, b)\n</code></pre>\n\n<p>in our case the <code>Monad</code> is the <code>IO</code> monad. Thus, the final output of <code>liftM2 (,)</code> will work nicely inside the <code>IO</code> do-block because it returns a proper <code>IO</code> value.</p>\n\n<p>And, of course you could solve this particular problem with the less verbose:</p>\n\n<pre><code>test'' = bar 20\n</code></pre>\n\n<p><em>PS: Please don't return stuff into the <code>IO</code> monad without any reason. You're making perfectly pure operations look unpure and there's no reasonable way back.</em></p>\n"}], "owner": {"reputation": 2282, "user_id": 1035792, "user_type": "registered", "accept_rate": 81, "profile_image": "https://i.stack.imgur.com/cQjEY.png?s=128&g=1", "display_name": "gsscoder", "link": "https://stackoverflow.com/users/1035792/gsscoder"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 286, "favorite_count": 0, "accepted_answer_id": 32647335, "answer_count": 3, "score": 1, "last_activity_date": 1442566174, "creation_date": 1442563376, "question_id": 32646857, "link": "https://stackoverflow.com/questions/32646857/store-result-of-function-applications-in-a-tuple-inside-a-do-block", "title": "Store result of function applications in a tuple inside a DO-block", "body": "<p>While I can apply a function two times and bind result in a tuple:</p>\n\n<pre><code>\n  let foo :: Num a => a -> a\n      foo x = x + 1\n\n  let (x,y) = (foo 10, foo 20)\n</code></pre>\n\n<p>This can't be done (ar at least I don't know how to do it properly) within a <code>do</code> block:</p>\n\n<pre><code>\n  let bar :: Num a => a -> IO a\n      bar x = do\n                  let y = x + 1\n                  return y\n\n  let test :: Num a => IO a\n      test = do\n                 (x,y) &lt;- (bar 10, bar 20)\n                 return y\n</code></pre>\n\n<p>I got the following error when typing it GHCI REPL:</p>\n\n<pre><code>\n:29:15:\n    Couldn't match expected type \u2018IO a1\u2019 with actual type \u2018(t0, a)\u2019\n    Relevant bindings include\n      test :: IO a (bound at :28:5)\n    In the pattern: (x, y)\n    In a stmt of a 'do' block: (x, y) &lt;- (bar 10, bar 20)\n    In the expression:\n      do { (x, y) &lt;- (bar 10, bar 20);\n           return y }\n\n:29:24:\n    Couldn't match type \u2018(,) (IO a0)\u2019 with \u2018IO\u2019\n    Expected type: IO (IO a1)\n      Actual type: (IO a0, IO a1)\n    In a stmt of a 'do' block: (x, y) &lt;- (bar 10, bar 20)\n    In the expression:\n      do { (x, y) &lt;- (bar 10, bar 20);\n           return y }\n    In an equation for \u2018test\u2019:\n        test\n          = do { (x, y) &lt;- (bar 10, bar 20);\n                 return y }\n</code></pre>\n\n<p>I can obviously solve it with a more verbose:</p>\n\n<pre><code>\n  let test' :: Num a => IO a\n      test' = do\n                 x &lt;- bar 10\n                 y &lt;- bar 20\n                 return y\n</code></pre>\n\n<p>Is there a correct way to express <code>test</code> without making it like <code>test'</code>?</p>\n"}, {"tags": ["haskell"], "comments": [{"owner": {"reputation": 43759, "user_id": 1651941, "user_type": "registered", "accept_rate": 97, "profile_image": "https://www.gravatar.com/avatar/a513bc1fa519d2fcf5e4e0d9b5500101?s=128&d=identicon&r=PG", "display_name": "Sibi", "link": "https://stackoverflow.com/users/1651941/sibi"}, "edited": false, "score": 0, "creation_date": 1442558477, "post_id": 32645089, "comment_id": 53138496, "body": "<code>free -m</code> would be more readable."}, {"owner": {"reputation": 84731, "user_id": 510937, "user_type": "registered", "accept_rate": 80, "profile_image": "https://www.gravatar.com/avatar/70b13a9ae1aae1ca1aa6ac8dab4643f2?s=128&d=identicon&r=PG", "display_name": "Bakuriu", "link": "https://stackoverflow.com/users/510937/bakuriu"}, "edited": false, "score": 0, "creation_date": 1442559803, "post_id": 32645089, "comment_id": 53139171, "body": "If you change <code>n</code> to be small does it still yield a segmentation fault?"}, {"owner": {"reputation": 94713, "user_id": 1139697, "user_type": "registered", "accept_rate": 86, "profile_image": "https://www.gravatar.com/avatar/5f136ddb684f39aaee1c028ee1950f6f?s=128&d=identicon&r=PG", "display_name": "Zeta", "link": "https://stackoverflow.com/users/1139697/zeta"}, "reply_to_user": {"reputation": 84731, "user_id": 510937, "user_type": "registered", "accept_rate": 80, "profile_image": "https://www.gravatar.com/avatar/70b13a9ae1aae1ca1aa6ac8dab4643f2?s=128&d=identicon&r=PG", "display_name": "Bakuriu", "link": "https://stackoverflow.com/users/510937/bakuriu"}, "edited": false, "score": 0, "creation_date": 1442559814, "post_id": 32645089, "comment_id": 53139180, "body": "@Bakuriu: No, at least not on my machine."}, {"owner": {"reputation": 49959, "user_id": 866915, "user_type": "registered", "accept_rate": 70, "profile_image": "https://www.gravatar.com/avatar/09242131d6e17cbbe31e8547514da6e5?s=128&d=identicon&r=PG", "display_name": "ErikR", "link": "https://stackoverflow.com/users/866915/erikr"}, "edited": false, "score": 1, "creation_date": 1442559918, "post_id": 32645089, "comment_id": 53139250, "body": "I would report it as a bug. FWIW <code>n = 536870912</code> is the smallest value for which the program segfaults on my machine (OS X - 64bit GHC 7.10.2)."}, {"owner": {"reputation": 84731, "user_id": 510937, "user_type": "registered", "accept_rate": 80, "profile_image": "https://www.gravatar.com/avatar/70b13a9ae1aae1ca1aa6ac8dab4643f2?s=128&d=identicon&r=PG", "display_name": "Bakuriu", "link": "https://stackoverflow.com/users/510937/bakuriu"}, "reply_to_user": {"reputation": 49959, "user_id": 866915, "user_type": "registered", "accept_rate": 70, "profile_image": "https://www.gravatar.com/avatar/09242131d6e17cbbe31e8547514da6e5?s=128&d=identicon&r=PG", "display_name": "ErikR", "link": "https://stackoverflow.com/users/866915/erikr"}, "edited": false, "score": 0, "creation_date": 1442560153, "post_id": 32645089, "comment_id": 53139361, "body": "@user5402 Which is exactly <code>2**29</code>. Looks like the package cannot handle vectors bigger than that."}, {"owner": {"reputation": 94553, "user_id": 775806, "user_type": "registered", "accept_rate": 96, "profile_image": "https://i.stack.imgur.com/XNd2C.png?s=128&g=1", "display_name": "n. &#39;pronouns&#39; m.", "link": "https://stackoverflow.com/users/775806/n-pronouns-m"}, "edited": false, "score": 1, "creation_date": 1442560442, "post_id": 32645089, "comment_id": 53139495, "body": "Not reproducible here. OS-specific?"}, {"owner": {"reputation": 10230, "user_id": 2427222, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/4h1qN.png?s=128&g=1", "display_name": "ymonad", "link": "https://stackoverflow.com/users/2427222/ymonad"}, "edited": false, "score": 0, "creation_date": 1442561157, "post_id": 32645089, "comment_id": 53139865, "body": "vector seems to hold index in <code>Int</code>: <a href=\"http://stackoverflow.com/questions/3429291/haskell-int-and-integer\" title=\"haskell int and integer\">stackoverflow.com/questions/3429291/haskell-int-and-integer</a>"}, {"owner": {"reputation": 100185, "user_id": 3234959, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/93bb12ca0f93dfddb33880316f7e66c2?s=128&d=identicon&r=PG&f=1", "display_name": "chi", "link": "https://stackoverflow.com/users/3234959/chi"}, "edited": false, "score": 0, "creation_date": 1442565518, "post_id": 32645089, "comment_id": 53142335, "body": "On the machine I am on right now, <code>maxBounds :: Int</code> gives 9223372036854775807, so here <code>Int</code> is 64 bits. Maybe the OP has installed a 32 bit version of GHC on a 64 bit OS?"}, {"owner": {"reputation": 100892, "user_id": 745903, "user_type": "registered", "accept_rate": 74, "profile_image": "https://www.gravatar.com/avatar/50933f6638836741e620669b3940410e?s=128&d=identicon&r=PG", "display_name": "leftaroundabout", "link": "https://stackoverflow.com/users/745903/leftaroundabout"}, "edited": false, "score": 1, "creation_date": 1442570602, "post_id": 32645089, "comment_id": 53145466, "body": "Interesting, I get the Segfault on Ubuntu 14.04 when compiled with GHC-7.10.1, but not with GHC-7.8.2."}, {"owner": {"reputation": 84731, "user_id": 510937, "user_type": "registered", "accept_rate": 80, "profile_image": "https://www.gravatar.com/avatar/70b13a9ae1aae1ca1aa6ac8dab4643f2?s=128&d=identicon&r=PG", "display_name": "Bakuriu", "link": "https://stackoverflow.com/users/510937/bakuriu"}, "edited": false, "score": 3, "creation_date": 1442583139, "post_id": 32645089, "comment_id": 53153180, "body": "Could you un-accept my answer? It&#39;s clearly wrong, though it was the first explanation that came to my mind, so I want to delete it (cannot if it is accepted...). I did some testing and I can reproduce leftaroundabout behaviour: ghc 7.8 doesn&#39;t segfault.  You should provide specific details about the versions of ghc you are using. Also if you can try to install a different ghc versions and see if that segfaults too."}, {"owner": {"reputation": 84731, "user_id": 510937, "user_type": "registered", "accept_rate": 80, "profile_image": "https://www.gravatar.com/avatar/70b13a9ae1aae1ca1aa6ac8dab4643f2?s=128&d=identicon&r=PG", "display_name": "Bakuriu", "link": "https://stackoverflow.com/users/510937/bakuriu"}, "edited": false, "score": 0, "creation_date": 1442583379, "post_id": 32645089, "comment_id": 53153350, "body": "No idea whether this is related but it looks like ghc 7.10.1 <i>did</i> change <i>something</i> in vector. See <a href=\"https://ghc.haskell.org/trac/ghc/ticket/10800\" rel=\"nofollow noreferrer\">this issue</a> for example. Maybe the time for compilation wasn&#39;t the only thing that changed."}, {"owner": {"reputation": 14485, "user_id": 190376, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/cd8280c5e1491b8cf55760750ed97dec?s=128&d=identicon&r=PG", "display_name": "Reid Barton", "link": "https://stackoverflow.com/users/190376/reid-barton"}, "edited": false, "score": 1, "creation_date": 1442586418, "post_id": 32645089, "comment_id": 53155419, "body": "The version of GHC doesn&#39;t matter for me, only the version of vector. vector-0.11.0.0 crashes under either 7.8.4 or 7.10.1, vector-0.10.12.2 works under either. I reported it at <a href=\"https://github.com/haskell/vector/issues/98\" rel=\"nofollow noreferrer\">github.com/haskell/vector/issues/98</a>"}], "answers": [{"tags": [], "owner": {"reputation": 14485, "user_id": 190376, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/cd8280c5e1491b8cf55760750ed97dec?s=128&d=identicon&r=PG", "display_name": "Reid Barton", "link": "https://stackoverflow.com/users/190376/reid-barton"}, "is_accepted": true, "score": 3, "last_activity_date": 1442936711, "creation_date": 1442936711, "answer_id": 32721269, "question_id": 32645089, "link": "https://stackoverflow.com/questions/32645089/how-come-haskell-got-a-segmentation-fault-when-the-vector-is-very-large-but-unde/32721269#32721269", "title": "How come Haskell got a segmentation fault when the vector is very large but under memory limit?", "body": "<p>This is <a href=\"https://github.com/haskell/vector/issues/98\" rel=\"nofollow\">due to a bug in primitive</a> that is apparently fixed in the recently-released primitive-0.6.1.0. I suggest you add a lower bound on primitive to your project accordingly.</p>\n"}], "owner": {"reputation": 5447, "user_id": 667027, "user_type": "registered", "accept_rate": 60, "profile_image": "https://www.gravatar.com/avatar/2cc242c4ce73c7e429f9f86f262d1844?s=128&d=identicon&r=PG", "display_name": "xzhu", "link": "https://stackoverflow.com/users/667027/xzhu"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 402, "favorite_count": 1, "accepted_answer_id": 32721269, "answer_count": 1, "score": 17, "last_activity_date": 1442936711, "creation_date": 1442557115, "last_edit_date": 1442604597, "question_id": 32645089, "link": "https://stackoverflow.com/questions/32645089/how-come-haskell-got-a-segmentation-fault-when-the-vector-is-very-large-but-unde", "title": "How come Haskell got a segmentation fault when the vector is very large but under memory limit?", "body": "<p>I wanted to write a program that operates on a really large array, and does a lot of random access read/write operations. I figured <code>vector</code> is the most suitable way of doing it in Haskell, so I wrote a simple program to test its performance:</p>\n\n<pre><code>import Data.Int\nimport qualified Data.Vector.Unboxed.Mutable as UM\n\nn = 1000000000\n\nmain = do\n    a &lt;- UM.new n\n    UM.read a 42 :: IO Int32\n</code></pre>\n\n<p>However, when I ran it, it failed with <code>segmentation fault</code>:</p>\n\n<pre><code>$ ghc -O2 test.hs\n$ ./test\nSegmentation fault (core dumped)\n</code></pre>\n\n<p>This machine has more than enough memory for the array. Here is the output of <code>free -h</code>:</p>\n\n<pre><code>             total       used       free     shared    buffers     cached\nMem:          251G       150G       100G       672K       419M       141G\n-/+ buffers/cache:       9.2G       242G\nSwap:         255G       870M       255G\n</code></pre>\n\n<p>Was it because Haskell's <code>vector</code> package cannot handle very large arrays? Can I modify my code so that it can work on large arrays without too much performance compromise?</p>\n\n<hr>\n\n<p><strong>Edit</strong>: My GHC version is 7.10.2.20150906, and my <code>vector</code> version is 0.11.0.0. This is on a 64-bit linux machine, with</p>\n\n<pre><code>&gt; maxBound :: Int\n9223372036854775807\n</code></pre>\n"}, {"tags": ["haskell", "free-monad"], "comments": [{"owner": {"reputation": 44013, "user_id": 1477667, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/trgKM.jpg?s=128&g=1", "display_name": "dfeuer", "link": "https://stackoverflow.com/users/1477667/dfeuer"}, "edited": false, "score": 0, "creation_date": 1442557700, "post_id": 32643847, "comment_id": 53138150, "body": "I suspect you&#39;ll be able to do this fairly easily for dags, but other structures will be bad."}, {"owner": {"reputation": 3113, "user_id": 1193741, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/be1d97fc244eaa2bfd3d7d64c1717f9f?s=128&d=identicon&r=PG", "display_name": "jtobin", "link": "https://stackoverflow.com/users/1193741/jtobin"}, "reply_to_user": {"reputation": 44013, "user_id": 1477667, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/trgKM.jpg?s=128&g=1", "display_name": "dfeuer", "link": "https://stackoverflow.com/users/1477667/dfeuer"}, "edited": false, "score": 0, "creation_date": 1442714161, "post_id": 32643847, "comment_id": 53195392, "body": "@dfeuer I&#39;m believing less and less that this is easy.  But I would love to be proved wrong! :)"}, {"owner": {"reputation": 44013, "user_id": 1477667, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/trgKM.jpg?s=128&g=1", "display_name": "dfeuer", "link": "https://stackoverflow.com/users/1477667/dfeuer"}, "edited": false, "score": 0, "creation_date": 1442716901, "post_id": 32643847, "comment_id": 53195813, "body": "I think the question could stand to be a bit clearer."}, {"owner": {"reputation": 64094, "user_id": 476408, "user_type": "registered", "accept_rate": 70, "profile_image": "https://www.gravatar.com/avatar/2bc1bffafe7aa29ef900b98d1fd1e94e?s=128&d=identicon&r=PG", "display_name": "J. Abrahamson", "link": "https://stackoverflow.com/users/476408/j-abrahamson"}, "edited": false, "score": 0, "creation_date": 1442939132, "post_id": 32643847, "comment_id": 53286557, "body": "You&#39;re going to face difficulty since your AST has, essentially, infinite branching which will preclude a lot of traversable tricks."}], "answers": [{"tags": [], "owner": {"reputation": 3113, "user_id": 1193741, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/be1d97fc244eaa2bfd3d7d64c1717f9f?s=128&d=identicon&r=PG", "display_name": "jtobin", "link": "https://stackoverflow.com/users/1193741/jtobin"}, "is_accepted": true, "score": 1, "last_activity_date": 1447662012, "creation_date": 1447662012, "answer_id": 33730952, "question_id": 32643847, "link": "https://stackoverflow.com/questions/32643847/examining-the-binding-structure-in-a-free-monad-ast/33730952#33730952", "title": "Examining the binding structure in a free monad AST", "body": "<p>I'm satisfied that this is not possible to do by any 'sane' ad-hoc method, for much the same reason that it's not possible to examine the binding structure of e.g. <code>\\a -&gt; \\b -&gt; \\c -&gt; b + a</code>.</p>\n"}], "owner": {"reputation": 3113, "user_id": 1193741, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/be1d97fc244eaa2bfd3d7d64c1717f9f?s=128&d=identicon&r=PG", "display_name": "jtobin", "link": "https://stackoverflow.com/users/1193741/jtobin"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 171, "favorite_count": 0, "accepted_answer_id": 33730952, "answer_count": 1, "score": 6, "last_activity_date": 1447662012, "creation_date": 1442550257, "last_edit_date": 1442551791, "question_id": 32643847, "link": "https://stackoverflow.com/questions/32643847/examining-the-binding-structure-in-a-free-monad-ast", "title": "Examining the binding structure in a free monad AST", "body": "<p>Take this simple base functor and other machinery for a free monad with binding terms:</p>\n\n<pre><code>{-# LANGUAGE DeriveFunctor #-}\n\nimport Control.Monad.Free\n\ndata ProgF r =\n    FooF (Double -&gt; r)\n  | BarF Double (Int -&gt; r)\n  | EndF\n  deriving Functor\n\ntype Program = Free ProgF\n\nfoo   = liftF (FooF id)\nbar a = liftF (BarF a id)\n</code></pre>\n\n<p>And here's a simple program</p>\n\n<pre><code>prog :: Program Int\nprog = do\n  a &lt;- foo\n  bar a\n</code></pre>\n\n<p>It has the following (hand-crafted) AST:</p>\n\n<pre><code>prog =\n  Free (FooF (\\p0 -&gt;\n    Free (BarF p0 (\\p1 -&gt;\n      Pure p1))\n</code></pre>\n\n<p>What I'd like to be able to do is reason about bound terms in the following way:</p>\n\n<ul>\n<li>look at the <code>Pure</code> term in the AST</li>\n<li>note the bound variables that occur there</li>\n<li>annotate the corresponding binding nodes in the AST</li>\n</ul>\n\n<p>Annotating a free monad AST directly via a cofree comonad seems to be impossible without doing <a href=\"http://dlaing.org/cofun/posts/free_and_cofree.html\">some kind of pairing</a>, but you could imagine getting to something like the following annotated AST (via, say, <code>Fix</code>) in which nodes binding variables that appear in <code>Pure</code> are annotated with <code>Just True</code>:</p>\n\n<pre><code>annotatedProg =\n  Just False :&lt; FooF (\\p0 -&gt;\n    Just True :&lt; BarF p0 (\\p1 -&gt;\n      Nothing  :&lt; EndF))\n</code></pre>\n\n<p>So: is there a way to inspect the bindings in a program like this in such an ad-hoc way?  I.e., without introducing a distinct variable type \u00e0 la <a href=\"https://stackoverflow.com/questions/14904048/printing-an-ast-with-variable-names\">this question</a>, for example.</p>\n\n<p>I suspect that this might be impossible to do.  Options like <a href=\"https://www.haskell.org/hoogle/?hoogle=data-reify\"><code>data-reify</code></a> are attractive but it seems to be extremely difficult or impossible to make <code>ProgF</code> an instance of the requisite typeclasses (<code>Foldable</code>, <code>Traversable</code>, <code>MuRef</code>).</p>\n\n<p>Is that intuition correct, or is there some means to do this that I haven't considered?  Note that I'm happy to entertain any gruesomely unsafe or dynamic means.</p>\n"}, {"tags": ["haskell", "cabal"], "comments": [{"owner": {"reputation": 44013, "user_id": 1477667, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/trgKM.jpg?s=128&g=1", "display_name": "dfeuer", "link": "https://stackoverflow.com/users/1477667/dfeuer"}, "edited": false, "score": 0, "creation_date": 1442540448, "post_id": 32642453, "comment_id": 53133382, "body": "You may need to dig down deep. <a href=\"https://www.haskell.org/cabal/users-guide/developing-packages.html#more-complex-packages\" rel=\"nofollow noreferrer\">haskell.org/cabal/users-guide/&hellip;</a>"}, {"owner": {"reputation": 126897, "user_id": 791604, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/ce991df7a056248d5e4f6fc3659ba733?s=128&d=identicon&r=PG", "display_name": "Daniel Wagner", "link": "https://stackoverflow.com/users/791604/daniel-wagner"}, "edited": false, "score": 1, "creation_date": 1442542070, "post_id": 32642453, "comment_id": 53133725, "body": "Name your program file <code>Setup.hs</code> and set your build type to <code>Custom</code>."}, {"owner": {"reputation": 635, "user_id": 1491175, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/f177296d0d463cc65452a12ca72ed0e8?s=128&d=identicon&r=PG", "display_name": "Sherwood Wang", "link": "https://stackoverflow.com/users/1491175/sherwood-wang"}, "reply_to_user": {"reputation": 126897, "user_id": 791604, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/ce991df7a056248d5e4f6fc3659ba733?s=128&d=identicon&r=PG", "display_name": "Daniel Wagner", "link": "https://stackoverflow.com/users/791604/daniel-wagner"}, "edited": false, "score": 0, "creation_date": 1442543237, "post_id": 32642453, "comment_id": 53133967, "body": "@DanielWagner That would cause dependency resolving not to work if <code>Setup.hs</code> depends on some modules not presenting."}, {"owner": {"reputation": 126897, "user_id": 791604, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/ce991df7a056248d5e4f6fc3659ba733?s=128&d=identicon&r=PG", "display_name": "Daniel Wagner", "link": "https://stackoverflow.com/users/791604/daniel-wagner"}, "edited": false, "score": 1, "creation_date": 1442549670, "post_id": 32642453, "comment_id": 53135489, "body": "@SherwoodWang Correct. See also gtk2hs, which has a gtk2hs-buildtools package for just this reason."}], "answers": [{"tags": [], "owner": {"reputation": 37486, "user_id": 371753, "user_type": "registered", "accept_rate": 83, "profile_image": "https://i.stack.imgur.com/znFEK.jpg?s=128&g=1", "display_name": "sclv", "link": "https://stackoverflow.com/users/371753/sclv"}, "is_accepted": false, "score": 0, "last_activity_date": 1517909383, "creation_date": 1517909383, "answer_id": 48639606, "question_id": 32642453, "link": "https://stackoverflow.com/questions/32642453/build-binary-to-generate-configuration-with-cabal/48639606#48639606", "title": "Build binary to generate configuration with Cabal", "body": "<p>Modern cabal now has a <code>setup-depends</code> field that lets you specify custom dependencies to your setup script (see: <a href=\"http://cabal.readthedocs.io/en/latest/developing-packages.html?highlight=setup-depends#custom-setup-scripts\" rel=\"nofollow noreferrer\">http://cabal.readthedocs.io/en/latest/developing-packages.html?highlight=setup-depends#custom-setup-scripts</a>)</p>\n\n<p>As such, your setup script can now use whatever libraries you want to import.</p>\n"}], "owner": {"reputation": 635, "user_id": 1491175, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/f177296d0d463cc65452a12ca72ed0e8?s=128&d=identicon&r=PG", "display_name": "Sherwood Wang", "link": "https://stackoverflow.com/users/1491175/sherwood-wang"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 61, "favorite_count": 1, "answer_count": 1, "score": 2, "last_activity_date": 1517909383, "creation_date": 1442539652, "question_id": 32642453, "link": "https://stackoverflow.com/questions/32642453/build-binary-to-generate-configuration-with-cabal", "title": "Build binary to generate configuration with Cabal", "body": "<p>I need to build an executable to test the environment and generate configuration for the following steps of building process. How can I tell Cabal to build such an executable during the configuration stage and not to install it as a part of the distribution?</p>\n"}, {"tags": ["haskell"], "comments": [{"owner": {"reputation": 44013, "user_id": 1477667, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/trgKM.jpg?s=128&g=1", "display_name": "dfeuer", "link": "https://stackoverflow.com/users/1477667/dfeuer"}, "edited": false, "score": 3, "creation_date": 1442534953, "post_id": 32641463, "comment_id": 53132202, "body": "Fortunately, taking off the <code>Const</code> constructor and putting it back on are free, since <code>Const</code> is a newtype. The situation is much sadder for <code>Either</code>, where memory may need to be allocated to change the type even if the representation stays the same."}], "answers": [{"comments": [{"owner": {"reputation": 57219, "user_id": 33796, "user_type": "registered", "accept_rate": 70, "profile_image": "https://www.gravatar.com/avatar/08727b23ba62e634b32988cdff082663?s=128&d=identicon&r=PG", "display_name": "luqui", "link": "https://stackoverflow.com/users/33796/luqui"}, "edited": false, "score": 1, "creation_date": 1442532530, "post_id": 32641489, "comment_id": 53131589, "body": "Yet another way of looking at it is that haskell syntax makes type parameters implicit, and infers them from context.  The full form of the definition is <code>fmap _ (Const {c a} v) = Const {c b} v</code> (where <code>{}</code> denotes type application), which makes it clear that the two sides of the equation are different."}, {"owner": {"reputation": 27351, "user_id": 559827, "user_type": "registered", "accept_rate": 72, "profile_image": "https://www.gravatar.com/avatar/4aa6db921795b84b986eb4aac8ffd569?s=128&d=identicon&r=PG", "display_name": "kjo", "link": "https://stackoverflow.com/users/559827/kjo"}, "reply_to_user": {"reputation": 57219, "user_id": 33796, "user_type": "registered", "accept_rate": 70, "profile_image": "https://www.gravatar.com/avatar/08727b23ba62e634b32988cdff082663?s=128&d=identicon&r=PG", "display_name": "luqui", "link": "https://stackoverflow.com/users/33796/luqui"}, "edited": false, "score": 0, "creation_date": 1442533029, "post_id": 32641489, "comment_id": 53131726, "body": "@luqui:  Is there a way to write the full form of the definition that the compiler will accept?  I&#39;ve tried several variants of what you showed, but the compiler rejects all of them."}, {"owner": {"reputation": 14582, "user_id": 2225384, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/f30b04ed4d0b3fc4bc791a28815f34ca?s=128&d=identicon&r=PG", "display_name": "Rein Henrichs", "link": "https://stackoverflow.com/users/2225384/rein-henrichs"}, "reply_to_user": {"reputation": 27351, "user_id": 559827, "user_type": "registered", "accept_rate": 72, "profile_image": "https://www.gravatar.com/avatar/4aa6db921795b84b986eb4aac8ffd569?s=128&d=identicon&r=PG", "display_name": "kjo", "link": "https://stackoverflow.com/users/559827/kjo"}, "edited": false, "score": 0, "creation_date": 1442533349, "post_id": 32641489, "comment_id": 53131819, "body": "@kjo What luqui showed is not real syntax. You can&#39;t use it in Haskell programs."}, {"owner": {"reputation": 57219, "user_id": 33796, "user_type": "registered", "accept_rate": 70, "profile_image": "https://www.gravatar.com/avatar/08727b23ba62e634b32988cdff082663?s=128&d=identicon&r=PG", "display_name": "luqui", "link": "https://stackoverflow.com/users/33796/luqui"}, "reply_to_user": {"reputation": 27351, "user_id": 559827, "user_type": "registered", "accept_rate": 72, "profile_image": "https://www.gravatar.com/avatar/4aa6db921795b84b986eb4aac8ffd569?s=128&d=identicon&r=PG", "display_name": "kjo", "link": "https://stackoverflow.com/users/559827/kjo"}, "edited": false, "score": 1, "creation_date": 1442533546, "post_id": 32641489, "comment_id": 53131872, "body": "@kjo, I added an answer with the most explicit form I know"}, {"owner": {"reputation": 27351, "user_id": 559827, "user_type": "registered", "accept_rate": 72, "profile_image": "https://www.gravatar.com/avatar/4aa6db921795b84b986eb4aac8ffd569?s=128&d=identicon&r=PG", "display_name": "kjo", "link": "https://stackoverflow.com/users/559827/kjo"}, "edited": false, "score": 0, "creation_date": 1442533713, "post_id": 32641489, "comment_id": 53131910, "body": "@ReinHenrichs: I got that, but I thought that he meant that the form <code>fmap _ (Const v) = Const v</code> was a shorthand (for a &quot;full form&quot;) allowed by the compiler.  If this interpretation is correct, I figure that there must indeed be a &quot;full form&quot;, one that does not rely on any compiler-allowed shortcuts, and if so, I&#39;d like to know what this full form is."}, {"owner": {"reputation": 14582, "user_id": 2225384, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/f30b04ed4d0b3fc4bc791a28815f34ca?s=128&d=identicon&r=PG", "display_name": "Rein Henrichs", "link": "https://stackoverflow.com/users/2225384/rein-henrichs"}, "edited": false, "score": 0, "creation_date": 1442533841, "post_id": 32641489, "comment_id": 53131948, "body": "No, there&#39;s no other &quot;full form&quot; (aside from explicit type annotations), and I&#39;m not sure why you think any &quot;compiler-allowed shortcuts&quot; are being used."}, {"owner": {"reputation": 15683, "user_id": 46571, "user_type": "registered", "accept_rate": 94, "profile_image": "https://www.gravatar.com/avatar/79eede5b02caa81db17f34026b24a734?s=128&d=identicon&r=PG", "display_name": "pyon", "link": "https://stackoverflow.com/users/46571/pyon"}, "reply_to_user": {"reputation": 27351, "user_id": 559827, "user_type": "registered", "accept_rate": 72, "profile_image": "https://www.gravatar.com/avatar/4aa6db921795b84b986eb4aac8ffd569?s=128&d=identicon&r=PG", "display_name": "kjo", "link": "https://stackoverflow.com/users/559827/kjo"}, "edited": false, "score": 1, "creation_date": 1442533883, "post_id": 32641489, "comment_id": 53131953, "body": "@kjo: Type application - instantiating a polymorphic definition at a monomorphic type - is always implicit in Haskell. If I understand correctly, internally, GHC elaborates Haskell code into a Core language based on (an extension of) System F\u03c9, where type application is explicit."}], "tags": [], "owner": {"reputation": 14582, "user_id": 2225384, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/f30b04ed4d0b3fc4bc791a28815f34ca?s=128&d=identicon&r=PG", "display_name": "Rein Henrichs", "link": "https://stackoverflow.com/users/2225384/rein-henrichs"}, "is_accepted": false, "score": 7, "last_activity_date": 1442534615, "last_edit_date": 1442534615, "creation_date": 1442532139, "answer_id": 32641489, "question_id": 32641463, "link": "https://stackoverflow.com/questions/32641463/on-a-functor-instance-declaration/32641489#32641489", "title": "On a Functor instance declaration", "body": "<p><code>cv</code> is of type <code>Const' c a</code>, so it can't also be of type <code>Const' c b</code> (unless <code>a ~ b</code>). <code>Const v</code> and <code>Const v</code>, however, can be of different types.</p>\n\n<p>Another way of looking at it is that <code>fmap _ cv = cv</code> is equivalent to <code>fmap _ = id</code>, which would be of type <code>Const' c a -&gt; Const' c a</code>, but <code>fmap _</code> must be of type <code>Const' c a -&gt; Const' c b</code>.</p>\n"}, {"comments": [{"owner": {"reputation": 15683, "user_id": 46571, "user_type": "registered", "accept_rate": 94, "profile_image": "https://www.gravatar.com/avatar/79eede5b02caa81db17f34026b24a734?s=128&d=identicon&r=PG", "display_name": "pyon", "link": "https://stackoverflow.com/users/46571/pyon"}, "edited": false, "score": 2, "creation_date": 1442533677, "post_id": 32641694, "comment_id": 53131898, "body": "Are you sure <code>c</code> should be quantified there? It seems to me that <code>c</code> should be the one implicitly bound by the instance head."}, {"owner": {"reputation": 57219, "user_id": 33796, "user_type": "registered", "accept_rate": 70, "profile_image": "https://www.gravatar.com/avatar/08727b23ba62e634b32988cdff082663?s=128&d=identicon&r=PG", "display_name": "luqui", "link": "https://stackoverflow.com/users/33796/luqui"}, "edited": false, "score": 2, "creation_date": 1442534080, "post_id": 32641694, "comment_id": 53132016, "body": "You are right. I quantified c at the last minute but it is incorrect. Fixed"}, {"owner": {"reputation": 27351, "user_id": 559827, "user_type": "registered", "accept_rate": 72, "profile_image": "https://www.gravatar.com/avatar/4aa6db921795b84b986eb4aac8ffd569?s=128&d=identicon&r=PG", "display_name": "kjo", "link": "https://stackoverflow.com/users/559827/kjo"}, "edited": false, "score": 0, "creation_date": 1442535013, "post_id": 32641694, "comment_id": 53132224, "body": "(Deleted my earlier comment, since it&#39;s now obsolete.  Will delete this one as well, in a few minutes.)"}], "tags": [], "owner": {"reputation": 57219, "user_id": 33796, "user_type": "registered", "accept_rate": 70, "profile_image": "https://www.gravatar.com/avatar/08727b23ba62e634b32988cdff082663?s=128&d=identicon&r=PG", "display_name": "luqui", "link": "https://stackoverflow.com/users/33796/luqui"}, "is_accepted": true, "score": 9, "last_activity_date": 1442534096, "last_edit_date": 1442534096, "creation_date": 1442533520, "answer_id": 32641694, "question_id": 32641463, "link": "https://stackoverflow.com/questions/32641463/on-a-functor-instance-declaration/32641694#32641694", "title": "On a Functor instance declaration", "body": "<p>If you want to be fully explicit, you can write</p>\n\n<pre><code>{-# LANGUAGE ScopedTypeVariables, InstanceSigs #-}\n\ndata Const c a = Const c\n\ninstance Functor (Const c) where\n    fmap :: forall a b. (a -&gt; b) -&gt; Const c a -&gt; Const c b\n    fmap _ (Const v :: Const c a) = Const v :: Const c b\n</code></pre>\n\n<p>Which is a bit of a mouthful. :-)</p>\n\n<p><code>forall a b.</code> brings <code>a</code> and <code>b</code> into scope so they can be referred to in the definition.  This is enabled by <code>ScopedTypeVariables</code>.  <code>InstanceSigs</code> allows us to write the signature of <code>fmap</code> in the first place (normally it <em>must</em> be inferred from the class, so we have nowhere to get the type variable names from).</p>\n"}], "owner": {"reputation": 27351, "user_id": 559827, "user_type": "registered", "accept_rate": 72, "profile_image": "https://www.gravatar.com/avatar/4aa6db921795b84b986eb4aac8ffd569?s=128&d=identicon&r=PG", "display_name": "kjo", "link": "https://stackoverflow.com/users/559827/kjo"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 221, "favorite_count": 0, "accepted_answer_id": 32641694, "answer_count": 2, "score": 7, "last_activity_date": 1442534615, "creation_date": 1442531980, "question_id": 32641463, "link": "https://stackoverflow.com/questions/32641463/on-a-functor-instance-declaration", "title": "On a Functor instance declaration", "body": "<p>This loads without error:</p>\n\n<pre><code>data Const c a = Const c\n\ninstance Functor (Const c) where\n    fmap _ (Const v) = Const v\n</code></pre>\n\n<p>...but this</p>\n\n<pre><code>data Const' c a = Const' c\n\ninstance Functor (Const' c) where\n    fmap _ cv = cv\n</code></pre>\n\n<p>...fails with:</p>\n\n<pre><code>    Couldn't match type `a' with `b'\n      `a' is a rigid type variable bound by\n          the type signature for fmap :: (a -&gt; b) -&gt; Const' c a -&gt; Const' c b\n          at test.hs:4:5\n      `b' is a rigid type variable bound by\n          the type signature for fmap :: (a -&gt; b) -&gt; Const' c a -&gt; Const' c b\n          at test.hs:4:5\n    Expected type: Const' c b\n      Actual type: Const' c a\n    In the expression: cv\n    In an equation for `fmap': fmap _ cv = cv\n    In the instance declaration for `Functor (Const' c)'\n</code></pre>\n\n<p>I don't understand the error.  Why can't the compiler infer that the type of <code>cv</code> is <code>Const' c</code>?  What else could it be, given the rest of the declaration, and the definition of <code>fmap</code>?</p>\n"}]