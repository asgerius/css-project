[{"tags": ["json", "haskell", "functional-programming", "scotty"], "answers": [{"comments": [{"owner": {"reputation": 311, "user_id": 8176014, "user_type": "registered", "accept_rate": 75, "profile_image": "https://i.stack.imgur.com/xsF5G.png?s=128&g=1", "display_name": "itepifanio", "link": "https://stackoverflow.com/users/8176014/itepifanio"}, "edited": false, "score": 0, "creation_date": 1530838489, "post_id": 51198732, "comment_id": 89384771, "body": "Thanks a lot for the didactic explanation. I&#39;m still learning haskell, but I had to begin this project with just the knowledge from list, recursion and others basic things. Just right now I&#39;m really learning how the Monads works. Furthermore, thanks for the tip too."}], "tags": [], "owner": {"reputation": 1435, "user_id": 6676199, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/21f60cb3880bf43a7c74ffeecbf996e1?s=128&d=identicon&r=PG&f=1", "display_name": "Peter Amidon", "link": "https://stackoverflow.com/users/6676199/peter-amidon"}, "is_accepted": true, "score": 1, "last_activity_date": 1530819499, "creation_date": 1530819499, "answer_id": 51198732, "question_id": 51071871, "link": "https://stackoverflow.com/questions/51071871/how-to-get-data-from-sqlite-and-response-json-using-scotty/51198732#51198732", "title": "How to get data from sqlite and response json using scotty?", "body": "<p>In Haskell, all functions are pure---so something like <code>selectPosts</code>, which needs to go out and do IO to talk to a database, can't just do that and return the value from the database. Instead, these kinds of functions return something of type <code>IO a</code>, which you can think of as basically a description of how to go out and do IO to get a value of type <code>a</code>.  These \"IO actions\" can be composed together, and one of them can be assigned to <code>main</code>; at runtime, the RTS will execute these IO actions.</p>\n\n<p>However, you aren't composing the <code>IO a</code> value that you get back from <code>selectPosts</code> to be part of the larger <code>IO</code> value that eventually becomes <code>main</code>; you are trying to directly use it by feeding it into <code>json</code>.  This won't work, because there's no (good/easy) way to convert a description of how to do IO into a JSON string.</p>\n\n<p>The way that Haskell deals with composing these values is through an abstraction known as a \"monad\", which is useful in a lot of other cases as well. <code>do</code> notation can be used to write this monadic sequencing in a very natural style. You can't just write <code>posts &lt;- withTestConnection S.selectPosts</code> here because Scotty's <code>get</code> function takes a value of the monadic <code>ActionM</code> type, not <code>IO</code>. However, it turns out that <code>ActionM</code> is basically a bunch of other useful stuff layered on top of <code>IO</code>, so it should be possible to \"lift\" the IO action from <code>selectPosts</code> into Scotty's <code>ActionM</code> monad:</p>\n\n<pre><code>get \"/posts\" $ do\n  posts &lt;- liftIO $ withTestConnection S.selectPosts\n  json posts\n</code></pre>\n\n<p>Side note: You may have noticed that I wrote <code>withTestConnection S.selectPosts</code> instead of <code>withTestConnection $ \\conn -&gt; do S.selectPosts conn</code>.  Generally, if you have a <code>do</code> block with only one expression in it (not of the form <code>x &lt;- act</code>), this is the same as the single expression outside of a <code>do</code> block: <code>\\conn -&gt; S.selectPosts conn</code>.  Furthermore, Haskell tends to encourage partial application: you have <code>S.selectPosts</code>, which is a function <code>Sql.Connection -&gt; IO [M.Post]</code>. <code>\\conn -&gt; S.selectPosts conn</code> is another function, of the same type, which passes the connection into <code>selectPosts</code> and then returns the same result as <code>selectPosts</code>---this function is indistinguishable from <code>selectPosts</code> itself! So if this is all that you need inside your <code>withTestConnection</code>, you should be able to simplify the whole lambda and <code>do</code> block to just <code>S.selectPosts</code>. </p>\n"}], "owner": {"reputation": 311, "user_id": 8176014, "user_type": "registered", "accept_rate": 75, "profile_image": "https://i.stack.imgur.com/xsF5G.png?s=128&g=1", "display_name": "itepifanio", "link": "https://stackoverflow.com/users/8176014/itepifanio"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 207, "favorite_count": 0, "accepted_answer_id": 51198732, "answer_count": 1, "score": 0, "last_activity_date": 1530819499, "creation_date": 1530135985, "question_id": 51071871, "link": "https://stackoverflow.com/questions/51071871/how-to-get-data-from-sqlite-and-response-json-using-scotty", "title": "How to get data from sqlite and response json using scotty?", "body": "<p>I'm trying to build a simple blog using Haskell and the Framework Scotty. Using a Model.hs I have:</p>\n\n<pre><code>data Post = Post\n    { id :: Int\n    , tipo :: String\n    , titulo :: String\n    , conteudo :: String\n    } deriving (Show, Generic)\n</code></pre>\n\n<p>I've already create a schema using sqlite and populate with some data, right now I'm trying to get this data using this method in my Storage.hs</p>\n\n<pre><code>selectPosts :: Sql.Connection -&gt; IO [M.Post]\nselectPosts conn =\n    Sql.query_ conn \"select * from post\" :: IO [M.Post]\n</code></pre>\n\n<p>My intent is get the data format as json in my Main.hs:</p>\n\n<pre><code>instance ToJSON M.Post\ninstance FromJSON M.Post\n\nmain :: IO ()\nmain = do\n    putStrLn \"Starting Server...\"\n    scotty 3000 $ do\n        get \"/\" $ file \"templates/index.html\"\n        get \"/posts\" $ do\n            json posts where\n            posts = withTestConnection $ \\conn -&gt; do\n                S.selectPosts conn\n</code></pre>\n\n<p>But I'm getting an IO [Model Post] and I don't know how to render this as json, so its keeping getting this error:</p>\n\n<pre><code>No instance for (ToJSON (IO [Post])) arising from a use of \u2018json\u2019\n</code></pre>\n\n<p>My project is in <a href=\"https://github.com/itepifanio/programacao-funcional/tree/master/fun-blog\" rel=\"nofollow noreferrer\">github</a> to run just use stack build and after stack ghci. In the building I'm already getting this error.</p>\n"}, {"tags": ["haskell", "windows-10", "ghc", "ghci"], "answers": [{"tags": [], "owner": {"reputation": 1, "user_id": 9897669, "user_type": "registered", "profile_image": "https://graph.facebook.com/10216218068113353/picture?type=large", "display_name": "Donya Quick", "link": "https://stackoverflow.com/users/9897669/donya-quick"}, "is_accepted": false, "score": 0, "last_activity_date": 1530712596, "creation_date": 1530712596, "answer_id": 51175437, "question_id": 51071418, "link": "https://stackoverflow.com/questions/51071418/windows-10-ghc-8-4-3-add-library-search-path-error/51175437#51175437", "title": "Windows 10 ghc 8.4.3 Add Library Search Path Error", "body": "<p>Well, it seems I found the answer.</p>\n\n<p>After additional testing on two more machines, the error messages are due to something in the full version of Haskell Platform, since it is not possible to reproduce with the core option for the same versions. There is now an issue related to it on the Haskell Platform GitHub issues page: </p>\n\n<p><a href=\"https://github.com/haskell/haskell-platform/issues/312#issuecomment-402349871\" rel=\"nofollow noreferrer\">https://github.com/haskell/haskell-platform/issues/312#issuecomment-402349871</a></p>\n\n<p>So, if anyone else has addLibrarySearchPath errors referencing a D:/GitHub/... folder, you can avoid it by using the core version instead of full and manually installing extra libraries. Of course, most people on Windows use core anyway, but I was using full because I wanted the network library (for which the manual installation process is tedious). </p>\n"}], "owner": {"reputation": 1, "user_id": 9897669, "user_type": "registered", "profile_image": "https://graph.facebook.com/10216218068113353/picture?type=large", "display_name": "Donya Quick", "link": "https://stackoverflow.com/users/9897669/donya-quick"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 348, "favorite_count": 0, "answer_count": 1, "score": 0, "last_activity_date": 1530712596, "creation_date": 1530133647, "last_edit_date": 1530144635, "question_id": 51071418, "link": "https://stackoverflow.com/questions/51071418/windows-10-ghc-8-4-3-add-library-search-path-error", "title": "Windows 10 ghc 8.4.3 Add Library Search Path Error", "body": "<p>I have run into a strange ghci addLibrarySearchPath error message with Haskell Platform 8.4.2 and 8.4.3 full on a Windows 10 Pro version 1803 machine. Here is an example transcript on a fresh installation of Haskell Platform 8.4.3, where ghci was started immediately after the installation finished:</p>\n\n<pre><code>C:\\Users\\Admin&gt;ghci\nGHCi, version 8.4.3: http://www.haskell.org/ghc/  :? for help\nPrelude&gt; import System.Random\nPrelude System.Random&gt; randomIO\nghc.exe: addLibrarySearchPath: D:\\GitHub\\haskell-platform\\build\\ghc-bindist\\local\\mingw\\lib (Win32 error 3): The system cannot find the path specified.\n-7101299332192590302\n</code></pre>\n\n<p>The message pops up the first time certain IO actions happen in a ghci session (it's not just those from System.Random). I have read of similar errors when ghc is looking for paths in an older Haskell Platform location, such as the error described in <a href=\"https://ghc.haskell.org/trac/ghc/ticket/14183\" rel=\"nofollow noreferrer\">https://ghc.haskell.org/trac/ghc/ticket/14183</a>. However, in my case, that D:\\GitHub folder has never existed at all - it's a removal drive that has nothing installed on it. The fixes I've read for the similar addLibrarySearchPath errors involved redoing cabal sandboxes or reinstalling; no sandbox has been made in this case and reinstalling made no difference. Between uninstalling and reinstalling, I cleared away the local, cabal, and ghc folders that always get left behind in AppData\\Roaming. While the error message technically doesn't stop ghci from working after it shows up, I would really like to know what's causing it. </p>\n\n<p>Any insight on this would be greatly appreciated. The problem does not happen with Haskell Platform either 8.2.1 or 8.2.2 full. It's only the two later platform versions that exhibit the behavior.</p>\n"}, {"tags": ["haskell", "io"], "answers": [{"comments": [{"owner": {"reputation": 12213, "user_id": 671703, "user_type": "registered", "accept_rate": 92, "profile_image": "https://www.gravatar.com/avatar/96ac349a9c65277e304401ea92a62ff4?s=128&d=identicon&r=PG", "display_name": "pat", "link": "https://stackoverflow.com/users/671703/pat"}, "edited": false, "score": 0, "creation_date": 1530257817, "post_id": 51070653, "comment_id": 89180829, "body": "Except for <code>unsafePerformIO :: IO a -&gt; a</code>"}, {"owner": {"reputation": 100892, "user_id": 745903, "user_type": "registered", "accept_rate": 74, "profile_image": "https://www.gravatar.com/avatar/50933f6638836741e620669b3940410e?s=128&d=identicon&r=PG", "display_name": "leftaroundabout", "link": "https://stackoverflow.com/users/745903/leftaroundabout"}, "reply_to_user": {"reputation": 12213, "user_id": 671703, "user_type": "registered", "accept_rate": 92, "profile_image": "https://www.gravatar.com/avatar/96ac349a9c65277e304401ea92a62ff4?s=128&d=identicon&r=PG", "display_name": "pat", "link": "https://stackoverflow.com/users/671703/pat"}, "edited": false, "score": 0, "creation_date": 1530276663, "post_id": 51070653, "comment_id": 89191534, "body": "@pat drawing attention to <code>unsafePerformIO</code> here is about as sensible as drawing attention to the possibility that you can access private elements of a C++ class through rogue pointer arithmetic, or another user&#39;s data through a side-channel attack on a CPU. Yeah, it turns out this can be done, but it&#39;s strictly undefined/implementation-specific behaviour (because <code>simOuNao</code> does have an observable side-effect) and nothing a beginner should even remotely consider."}], "tags": [], "owner": {"reputation": 126897, "user_id": 791604, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/ce991df7a056248d5e4f6fc3659ba733?s=128&d=identicon&r=PG", "display_name": "Daniel Wagner", "link": "https://stackoverflow.com/users/791604/daniel-wagner"}, "is_accepted": false, "score": 5, "last_activity_date": 1530130155, "creation_date": 1530130155, "answer_id": 51070653, "question_id": 51070576, "link": "https://stackoverflow.com/questions/51070576/how-to-return-true-or-false-in-a-do-expression-haskell/51070653#51070653", "title": "How to return True or False in a do expression - Haskell", "body": "<p>Once in <code>IO</code>, always in <code>IO</code> -- there is no escape.</p>\n\n<pre><code>simOuNao :: String -&gt; IO Bool\n</code></pre>\n"}, {"tags": [], "owner": {"reputation": 100185, "user_id": 3234959, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/93bb12ca0f93dfddb33880316f7e66c2?s=128&d=identicon&r=PG&f=1", "display_name": "chi", "link": "https://stackoverflow.com/users/3234959/chi"}, "is_accepted": false, "score": 2, "last_activity_date": 1530130328, "creation_date": 1530130328, "answer_id": 51070697, "question_id": 51070576, "link": "https://stackoverflow.com/questions/51070576/how-to-return-true-or-false-in-a-do-expression-haskell/51070697#51070697", "title": "How to return True or False in a do expression - Haskell", "body": "<p>If your function does I/O, you have to declare it in the type by returning <code>IO Bool</code> instead.</p>\n\n<pre><code>simOuNao :: String -&gt; IO Bool\nsimOuNao frase = do putStrLn frase\n                    ans &lt;- readLn\n                    if ans == 'y' || ans =='Y'\n                      then return True\n                      else return False\n</code></pre>\n\n<p>The user of <code>simOuNao</code> will have to use something like</p>\n\n<pre><code>do ...\n   b &lt;- simOuNao frase\n   ... -- here b is a Bool\n</code></pre>\n\n<p>and, of course, the type of this <code>do</code> expression will have to be <code>IO someType</code> once again.</p>\n"}, {"tags": [], "owner": {"reputation": 13772, "user_id": 379311, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/c993f4f111e6ff3211ccda1b98828253?s=128&d=identicon&r=PG", "display_name": "Yann Vernier", "link": "https://stackoverflow.com/users/379311/yann-vernier"}, "is_accepted": false, "score": 2, "last_activity_date": 1530278799, "last_edit_date": 1530278799, "creation_date": 1530275005, "answer_id": 51101682, "question_id": 51070576, "link": "https://stackoverflow.com/questions/51070576/how-to-return-true-or-false-in-a-do-expression-haskell/51101682#51101682", "title": "How to return True or False in a do expression - Haskell", "body": "<p>A <a href=\"https://www.haskell.org/onlinereport/haskell2010/haskellch3.html#x8-470003.14\" rel=\"nofollow noreferrer\"><code>do</code> expression</a> is a way to write monadic code in sequence, using lines, <code>let</code> and <code>&lt;-</code>. <code>True</code> and <code>False</code> are <a href=\"https://hackage.haskell.org/package/base-4.11.1.0/docs/Prelude.html#t:Bool\" rel=\"nofollow noreferrer\"><code>Bool</code></a> constructors, and there is no <a href=\"https://hackage.haskell.org/package/base-4.11.1.0/docs/Prelude.html#t:Monad\" rel=\"nofollow noreferrer\">Monad</a> instance for that. There are homomorphic types such as <code>Identity Bool</code> or <code>Maybe ()</code>. </p>\n\n<p>Therefore, given the type declaration <code>simOuNao :: String -&gt; Bool</code>, <code>simOuNao</code> cannot be defined as a <code>do</code> expression. Given that you're using <code>putStrLn</code> inside, it has to return something with the <code>IO</code> monad. So you've given conflicting goals. <a href=\"https://hackage.haskell.org/package/base-4.11.1.0/docs/Prelude.html#v:return\" rel=\"nofollow noreferrer\"><code>return</code></a> lifts values into a monadic type. So the <code>simOuNao</code> version you've written requires specifically the <code>IO</code> monad, and the type becomes <code>simOuNao :: String -&gt; IO Bool</code>. </p>\n\n<p>An additional complication is that you've used <a href=\"https://hackage.haskell.org/package/base-4.11.1.0/docs/Prelude.html#v:readLn\" rel=\"nofollow noreferrer\"><code>readLn</code></a>. I suspect you meant to use <a href=\"https://hackage.haskell.org/package/base-4.11.1.0/docs/Prelude.html#v:getLine\" rel=\"nofollow noreferrer\"><code>getLine</code></a> and checking for strings starting with <code>'y'</code>, because as it is the user will need to enter <code>'y'</code> complete with quotes as <code>readLn</code> will expect a character literal. </p>\n\n<p>It is also possible to use monads within a function that has a non-monadic type, including monads like <code>Identity</code>, <code>Maybe</code> and <code>State</code>, typically using some <code>run</code> function to extract the result. This isn't possible with the <code>IO</code> monad in particular, because its state is not deterministic (it represents the outside world, so all <code>IO</code> that is performed must be delegated from <a href=\"https://www.haskell.org/onlinereport/haskell2010/haskellch5.html#x11-980005\" rel=\"nofollow noreferrer\"><code>main</code></a>). </p>\n"}], "owner": {"reputation": 189, "user_id": 5013644, "user_type": "registered", "profile_image": "https://graph.facebook.com/852470824827684/picture?type=large", "display_name": "Matheus Vin&#237;cius de Andrade", "link": "https://stackoverflow.com/users/5013644/matheus-vin%c3%adcius-de-andrade"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 2850, "favorite_count": 0, "answer_count": 3, "score": 0, "last_activity_date": 1530278799, "creation_date": 1530129805, "question_id": 51070576, "link": "https://stackoverflow.com/questions/51070576/how-to-return-true-or-false-in-a-do-expression-haskell", "title": "How to return True or False in a do expression - Haskell", "body": "<p>I'm try to return True or False in this expression, but i'm getting this error, can someone tell me what i'm doing wrong? Thanks.</p>\n\n<pre><code>module Main (main) where\nimport System.IO (stdout, hSetBuffering, BufferMode(NoBuffering))\n\nmain::IO()\nsimOuNao::String -&gt; Bool\n\nmain = do hSetBuffering stdout NoBuffering\n      putStrLn \"Guess Number v1.0\"\n      putStrLn \"======================\"\n\nsimOuNao frase = do putStrLn frase\n                ans &lt;- readLn\n                if ans == 'y' || ans =='Y'\n                  then return True\n                  else return False\n</code></pre>\n\n<p>Error message:</p>\n\n<pre><code>\u2022 Couldn't match expected type \u2018Bool\u2019 with actual type \u2018IO Bool\u2019\n\u2022 In a stmt of a 'do' block: putStrLn frase\n  In the expression:\n    do { putStrLn frase;\n         ans &lt;- readLn;\n         if ans == 'y' || ans == 'Y' then return True else return False }\n  In an equation for \u2018simOuNao\u2019:\n      simOuNao frase\n        = do { putStrLn frase;\n               ans &lt;- readLn;\n               if ans == 'y' || ans == 'Y' then return True else return False }\n</code></pre>\n\n<p>Failed, modules loaded: none.</p>\n"}, {"tags": ["haskell", "persistence", "scotty"], "answers": [{"tags": [], "owner": {"reputation": 1318, "user_id": 1348270, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/757f10851f286bde771d7f690252c4e5?s=128&d=identicon&r=PG", "display_name": "JNLK", "link": "https://stackoverflow.com/users/1348270/jnlk"}, "is_accepted": false, "score": 0, "last_activity_date": 1530250480, "last_edit_date": 1530250480, "creation_date": 1530134124, "answer_id": 51071521, "question_id": 51070009, "link": "https://stackoverflow.com/questions/51070009/haskell-scotty-and-persistence-rest-api/51071521#51071521", "title": "Haskell scotty and persistence rest API", "body": "<p>It looks like compiler accused you of having a bad conversion between the list of Entity ToDo-s and Data.Text.Lazy.</p>\n\n<p>Please try to convert it by hand using <em>pack</em> function:</p>\n\n<pre><code>import Data.Text.Lazy (pack)\n...\nroutes = do\n  S.get \"/hello\" $ do\n    text \"hello world!\"\n  S.get \"/hello/:name\" $ do\n    name &lt;- param \"name\"\n    text (\"hello\" &lt;&gt; name &lt;&gt; \"!\")\n  S.get \"/todos\" $ do\n    _ToDo &lt;- liftIO readToDo\n    text(pack . show $ _ToDo)   -- explicit conversion\n...\n</code></pre>\n"}], "owner": {"reputation": 2999, "user_id": 3193748, "user_type": "registered", "accept_rate": 96, "profile_image": "https://www.gravatar.com/avatar/fd86bcbfef66aee8ab33ed1c39e8cdb5?s=128&d=identicon&r=PG&f=1", "display_name": "lukassz", "link": "https://stackoverflow.com/users/3193748/lukassz"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 176, "favorite_count": 0, "answer_count": 1, "score": 1, "last_activity_date": 1530250480, "creation_date": 1530127228, "question_id": 51070009, "link": "https://stackoverflow.com/questions/51070009/haskell-scotty-and-persistence-rest-api", "title": "Haskell scotty and persistence rest API", "body": "<p>I'm new in Haskell. I woudl like to create simple crud rest api with scotty and persistence. I'm using sqlite with one table <code>todo</code> <code>(title text, description text)</code>, I have some records in table. My point is to show all records on enpoint <code>/todos</code> in json format. When I print it I gets an error </p>\n\n<pre><code>  \u2022 Couldn't match expected type \u2018Data.Text.Internal.Lazy.Text\u2019\n                  with actual type \u2018[Entity ToDo]\u2019\n    \u2022 In the first argument of \u2018text\u2019, namely \u2018(_ToDo)\u2019\n      In a stmt of a 'do' block: text (_ToDo)\n      In the second argument of \u2018($)\u2019, namely\n        \u2018do _ToDo &lt;- liftIO readToDo\n            text (_ToDo)\u2019\n   |\n69 |     text(_ToDo)\n   |          ^^^^^\n</code></pre>\n\n<p>My code:</p>\n\n<pre><code>{-# LANGUAGE GeneralizedNewtypeDeriving #-}\n{-# LANGUAGE OverloadedStrings #-}\n{-# LANGUAGE DeriveGeneric #-}\n{-# LANGUAGE DeriveGeneric #-}\n{-# LANGUAGE EmptyDataDecls       #-}\n{-# LANGUAGE FlexibleContexts     #-}\n{-# LANGUAGE FlexibleInstances    #-}\n{-# LANGUAGE GADTs                #-}\n{-# LANGUAGE OverloadedStrings    #-}\n{-# LANGUAGE QuasiQuotes          #-}\n{-# LANGUAGE TemplateHaskell      #-}\n{-# LANGUAGE TypeFamilies         #-}\n{-# LANGUAGE TypeSynonymInstances #-}\n{-# OPTIONS_GHC -fno-warn-orphans #-}\n{-# LANGUAGE MultiParamTypeClasses #-}\nmodule Main where\nimport Data.Monoid ((&lt;&gt;))\nimport Web.Scotty\nimport qualified Web.Scotty as S\nimport Database.Persist\nimport Database.Persist.Sqlite\nimport Database.Persist.TH \nimport Data.Text (Text)\nimport Data.Time (UTCTime, getCurrentTime)\nimport qualified Data.Text as T\nimport Control.Monad.IO.Class (liftIO)\nimport Control.Monad.Trans.Resource (runResourceT, ResourceT)\nimport Database.Persist.Sql\nimport Control.Monad (forM_)\nimport Control.Applicative\nimport Control.Monad.Logger\nimport Data.Aeson \nimport Data.Default.Class\nimport GHC.Generics\nimport Control.Monad.IO.Class (liftIO)\n\nshare [mkPersist sqlSettings, mkMigrate \"migrateAll\"] [persistLowerCase|\nToDo\n  title String\n  description String\n  deriving Show\n|]\n\n\nrunDb :: SqlPersist (ResourceT (NoLoggingT IO)) a -&gt; IO a\nrunDb = runNoLoggingT\n    . runResourceT\n    . withSqliteConn \"todo.db\"\n    . runSqlConn\n\n\ninstance ToJSON ToDo where\n  toJSON(ToDo title description) = object [\"title\" .= title, \"description\" .= description]\n\n\n\nreadToDo :: IO [Entity ToDo]\nreadToDo = (runDb $ selectList [] [LimitTo 10] )\n\nroutes :: ScottyM()\nroutes = do\n  S.get \"/hello\" $ do\n    text \"hello world!\"\n  S.get \"/hello/:name\" $ do\n    name &lt;- param \"name\"\n    text (\"hello\" &lt;&gt; name &lt;&gt; \"!\")\n  S.get \"/todos\" $ do\n    _ToDo &lt;- liftIO readToDo\n    text(_ToDo)\n\nmain = do\n  putStrLn \"Starting server....\"\n  scotty 7777 routes\n</code></pre>\n\n<p>How to correct this? </p>\n"}, {"tags": ["haskell"], "comments": [{"owner": {"reputation": 66224, "user_id": 180286, "user_type": "registered", "accept_rate": 69, "profile_image": "https://i.stack.imgur.com/tAXU2.jpg?s=128&g=1", "display_name": "Fyodor Soikin", "link": "https://stackoverflow.com/users/180286/fyodor-soikin"}, "edited": false, "score": 0, "creation_date": 1530127985, "post_id": 51069951, "comment_id": 89130214, "body": "How about overlapping type classes with associated types?"}], "answers": [{"tags": [], "owner": {"reputation": 8556, "user_id": 4892417, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/NaBTj.jpg?s=128&g=1", "display_name": "oisdk", "link": "https://stackoverflow.com/users/4892417/oisdk"}, "is_accepted": true, "score": 2, "last_activity_date": 1530128720, "creation_date": 1530128720, "answer_id": 51070338, "question_id": 51069951, "link": "https://stackoverflow.com/questions/51069951/using-closed-type-families-to-write-functions-if-type-a-then-x-else-type-y/51070338#51070338", "title": "Using closed type families to write functions &quot;if type A, then X, else type Y&quot;", "body": "<p>You can accomplish it with overlapping classes. Here's an example for writing <a href=\"https://hackage.haskell.org/package/base-4.11.1.0/docs/Data-List.html#v:nub\" rel=\"nofollow noreferrer\"><code>nub</code></a> which chooses a more efficient container type when the list is a list of ints:</p>\n\n<pre><code>{-# LANGUAGE TypeFamilies         #-}\n{-# LANGUAGE FlexibleInstances    #-}\n{-# LANGUAGE UndecidableInstances #-}\n{-# LANGUAGE FlexibleContexts     #-}\n\nimport           Data.IntSet (IntSet)\nimport qualified Data.IntSet as IntSet\nimport           Data.Set (Set)\nimport qualified Data.Set as Set\n\ntype family Container a where\n  Container Int = IntSet\n  Container a = Set a\n\nclass Monoid (Container a) =&gt; Uniqable a where\n  insert :: a -&gt; Container a -&gt; Container a\n  member :: a -&gt; Container a -&gt; Bool\n\ninstance Uniqable Int where\n  insert = IntSet.insert\n  member = IntSet.member\n\ninstance {-# OVERLAPPABLE #-} (Ord a, Container a ~ Set a) =&gt; Uniqable a where\n  insert = Set.insert\n  member = Set.member\n\nuniq :: Uniqable a =&gt; [a] -&gt; [a]\nuniq xs = foldr f (const []) xs mempty\n  where\n    f x a s\n      | member x s = a s\n      | otherwise = x : a (insert x s)\n</code></pre>\n"}], "owner": {"reputation": 171740, "user_id": 869736, "user_type": "registered", "accept_rate": 82, "profile_image": "https://www.gravatar.com/avatar/671f732e3c68c387c702112a30e5ebd8?s=128&d=identicon&r=PG&f=1", "display_name": "Louis Wasserman", "link": "https://stackoverflow.com/users/869736/louis-wasserman"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 64, "favorite_count": 0, "accepted_answer_id": 51070338, "answer_count": 1, "score": 2, "last_activity_date": 1530128720, "creation_date": 1530126938, "last_edit_date": 1530127922, "question_id": 51069951, "link": "https://stackoverflow.com/questions/51069951/using-closed-type-families-to-write-functions-if-type-a-then-x-else-type-y", "title": "Using closed type families to write functions &quot;if type A, then X, else type Y&quot;", "body": "<p>I want to define a function that has a specialized implementation for some types and a general implementation for all other types, with more magic than {-# SPECIALIZE #-} or rewrite rules can get me.  (Roughly, I want to switch from <code>IORef</code> to <code>Ptr</code> when possible.)</p>\n\n<p>Closed type families look like they might provide a solution:</p>\n\n<pre><code>type family Specialized a where\n   Specialized Foo = Bar\n   Specialized a = Baz\n</code></pre>\n\n<p>...but it's unclear how, from here, to build a function <code>special :: Specialized a</code>, or something more or less equivalent.  Closed type families seem to work on the type level, but I can't figure out how to do the appropriate thing on the data level.</p>\n\n<p>If I were willing to explicitly list all types I didn't want to specialize for, I could write a type class and make an <code>instance</code> for all the other types, but I want to write something that specializes a finite list of types and then does something else for <em>all</em> other types.</p>\n\n<p>How can I accomplish something like this?</p>\n"}, {"tags": ["haskell"], "comments": [{"owner": {"reputation": 75362, "user_id": 625403, "user_type": "registered", "accept_rate": 82, "profile_image": "https://www.gravatar.com/avatar/786eed7da67079cb5d63a49d469af25b?s=128&d=identicon&r=PG", "display_name": "amalloy", "link": "https://stackoverflow.com/users/625403/amalloy"}, "edited": false, "score": 0, "creation_date": 1530128664, "post_id": 51069604, "comment_id": 89130497, "body": "I&#39;m sure there are many good duplicate to point this question to, but I can&#39;t find any of them. Anyone else have an idea?"}, {"owner": {"reputation": 11366, "user_id": 3922954, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/76ba47d2fdd24ab56b0b273cce2075e5?s=128&d=identicon&r=PG&f=1", "display_name": "AJF", "link": "https://stackoverflow.com/users/3922954/ajf"}, "edited": false, "score": 0, "creation_date": 1530132707, "post_id": 51069604, "comment_id": 89132242, "body": "Haskell does not have variables, only constants!"}], "answers": [{"tags": [], "owner": {"reputation": 384463, "user_id": 1126841, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/fa05233b2357f8d11c22ef4cfc7bb85c?s=128&d=identicon&r=PG", "display_name": "chepner", "link": "https://stackoverflow.com/users/1126841/chepner"}, "is_accepted": true, "score": 7, "last_activity_date": 1530127061, "creation_date": 1530127061, "answer_id": 51069971, "question_id": 51069604, "link": "https://stackoverflow.com/questions/51069604/self-referential-definition-not-working-in-haskell/51069971#51069971", "title": "Self-Referential Definition Not Working in Haskell", "body": "<p><code>=</code> doesn't perform assignment; it <em>equates</em> two things. You are creating a recursive definition by saying that <code>otherpoint</code> and <code>move otherpoint 5 5</code> are the same thing and are interchangeable. That means when you try to evaluate the call to <code>move</code>, it tries to evaluate <code>otherpoint</code>, which leads to the next call to <code>move</code>, etc.</p>\n\n<p>You can't simply \"rebind\" a variable in Haskell. Instead, use a different name.</p>\n\n<pre><code>nextpoint = move otherpoint 5 5\n</code></pre>\n"}, {"tags": [], "owner": {"reputation": 12194, "user_id": 4474419, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/04ce27f0ebe4713b51911cd8475c3b42?s=128&d=identicon&r=PG", "display_name": "Davislor", "link": "https://stackoverflow.com/users/4474419/davislor"}, "is_accepted": false, "score": 3, "last_activity_date": 1530131701, "last_edit_date": 1530131701, "creation_date": 1530128696, "answer_id": 51070331, "question_id": 51069604, "link": "https://stackoverflow.com/questions/51069604/self-referential-definition-not-working-in-haskell/51070331#51070331", "title": "Self-Referential Definition Not Working in Haskell", "body": "<p>Let\u2019s look at an example of a self-referential definition that does work:</p>\n\n<pre><code>Prelude&gt; let a = 1:a\nPrelude&gt; take 10 a\n[1,1,1,1,1,1,1,1,1,1]\n</code></pre>\n\n<p>As chepner mentioned, an equals sign in Haskell is is not an assignment, but a definition.  It has very different semantics than an equals sign in, for example, C or Java.  In general, each variable in Haskell can only be given one definition, not changed.  So the example above works because it defines <code>a</code> as the list whose head is <code>1</code> and whose tail is <code>a</code>.  When <code>take 10 a</code> tries to find the second element of <code>a</code>, that\u2019s the head of the tail of <code>a</code>.  The tail of <code>a</code> is <code>a</code>, so the head of the tail of <code>a</code> is <code>1</code>.  Because Haskell lazily evaluates only the elements of <code>a</code> that it needs, it computes a finite number of recursions and then stops, but if you tried to compute <code>length a</code>, it would go into an infinite loop.</p>\n\n<p>What you wrote is the equivalent of <code>a = a + 1</code>.  That is, the definition of <code>point</code> at the bottom of your post is well-typed, but infinitely recursive.  The recursive computation never reduces to anything simpler; it is not well-founded.</p>\n"}], "owner": {"reputation": 4756, "user_id": 10001688, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/kvhzK.jpg?s=128&g=1", "display_name": "Michael Bianconi", "link": "https://stackoverflow.com/users/10001688/michael-bianconi"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 65, "favorite_count": 0, "accepted_answer_id": 51069971, "answer_count": 2, "score": 1, "last_activity_date": 1530131701, "creation_date": 1530125403, "last_edit_date": 1530127876, "question_id": 51069604, "link": "https://stackoverflow.com/questions/51069604/self-referential-definition-not-working-in-haskell", "title": "Self-Referential Definition Not Working in Haskell", "body": "<p>New to Haskell, but I've run into something that's confusing to me, and I can't explain it or find any documentation.</p>\n\n<p>If I have the following code:</p>\n\n<pre><code>-- Simple 2D Coordinate Data Structure\ndata Point = Point\n   { x :: !Float\n   , y :: !Float }\n   deriving (Show)\n\n-- Constant origin (always at (0,0) unless otherwise specified)\norigin = Point 0 0\n\n-- Return a Point that has been shifted by the specified amounts\nmove :: Point -&gt; Float -&gt; Float -&gt; Point\nmove p dx dy = Point { x=xs+dx, y=ys+dy }\n    where\n        xs = x p\n        ys = y p\n</code></pre>\n\n<p>Now, this code works perfectly well</p>\n\n<pre><code>*Main&gt; origin\nPoint {x = 0.0, y = 0.0}\n*Main&gt; move origin 1 3\nPoint {x = 1.0, y = 3.0}\n*main&gt; otherpoint = move origin 4 4\n*main&gt; origin\nPoint {x = 0.0, y = 0.0}\n*main&gt; otherpoint\nPoint {x = 4.0, y = 4.0}\n*main&gt; :t otherpoint\notherpoint :: Point\n</code></pre>\n\n<p>The issue comes if I attempt to move a point and assign it to itself</p>\n\n<pre><code>*main&gt; otherpoint = move otherpoint 5 5\n*main&gt; otherpoint\n^CInterrupted --Freezes\n*main&gt; otherpoint = move otherpoint 6 6\n^CInterrupted --Freezes\n</code></pre>\n"}, {"tags": ["haskell", "megaparsec"], "comments": [{"owner": {"reputation": 37219, "user_id": 1523776, "user_type": "moderator", "accept_rate": 87, "profile_image": "https://www.gravatar.com/avatar/b3e0b5c8e42a8c38009ef2d969f8dabb?s=128&d=identicon&r=PG", "display_name": "Benjamin Hodgson", "link": "https://stackoverflow.com/users/1523776/benjamin-hodgson"}, "edited": false, "score": 3, "creation_date": 1530121536, "post_id": 51068265, "comment_id": 89127162, "body": "Haskell&#39;s designers made this tractable by using a separate alphabet for prefix functions (whose names are alphanumeric) and infix operators (whose names are symbolic). GHC implements associativity and precedence in the renaming step, ie, after parsing. So the parser never has to dynamically update itself"}, {"owner": {"reputation": 37219, "user_id": 1523776, "user_type": "moderator", "accept_rate": 87, "profile_image": "https://www.gravatar.com/avatar/b3e0b5c8e42a8c38009ef2d969f8dabb?s=128&d=identicon&r=PG", "display_name": "Benjamin Hodgson", "link": "https://stackoverflow.com/users/1523776/benjamin-hodgson"}, "edited": false, "score": 4, "creation_date": 1530121845, "post_id": 51068265, "comment_id": 89127308, "body": "See also <a href=\"http://www.cse.chalmers.se/~nad/publications/danielsson-norell-mixfix.pdf\" rel=\"nofollow noreferrer\">this report</a> on how Agda handles its &quot;mixfix&quot; operators. They build a &quot;precedence graph&quot; of operators, again doing all the hard work in the renaming phase"}, {"owner": {"reputation": 4234, "user_id": 4942760, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/f322d06b4f3e34278f29a954e0f38cb1?s=128&d=identicon&r=PG&f=1", "display_name": "Dan Robertson", "link": "https://stackoverflow.com/users/4942760/dan-robertson"}, "edited": false, "score": 1, "creation_date": 1530122132, "post_id": 51068265, "comment_id": 89127450, "body": "You probably want to split up parsing into a sort-of-tokenisation step and a later step when you have available the ability to look up precedence and associativity you can use a more standard algorithm for expressions made out of operators. E.g. have a variant for expressions of <code>OperatorExpression Expression [(Operator, Expression)]</code>. If you want to support prefix and post script expressions as well then have fun."}], "owner": {"reputation": 759, "user_id": 3368561, "user_type": "registered", "accept_rate": 42, "profile_image": "https://www.gravatar.com/avatar/e982eee26ab62e30ac026a9479e6228d?s=128&d=identicon&r=PG&f=1", "display_name": "user3368561", "link": "https://stackoverflow.com/users/3368561/user3368561"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 122, "favorite_count": 0, "answer_count": 0, "score": 4, "last_activity_date": 1530119824, "creation_date": 1530119824, "question_id": 51068265, "link": "https://stackoverflow.com/questions/51068265/parser-library-for-haskell-like-expression-syntax", "title": "Parser library for Haskell-like expression syntax", "body": "<p>I want to extend an toy functional programming language to accept Haskell-like infix operators. Here are the characteristics I am interested in:</p>\n\n<ul>\n<li>Parser dynamically updates itself to accept newly defined operators.</li>\n<li>Infix operators can be converted to functions surrounding them in parenthesis.</li>\n<li>Functions can be converted to infix operators surrounding them in graves.</li>\n<li>Function calls with Haskell syntax (optional parenthesis with space separated arguments).</li>\n</ul>\n\n<p>Is there any existing library that implements it?</p>\n\n<p>My current parser is written in <a href=\"https://hackage.haskell.org/package/megaparsec\" rel=\"nofollow noreferrer\">Megaparsec</a> so i will appreciate a solution compatible with it. </p>\n"}, {"tags": ["haskell", "hugs"], "comments": [{"owner": {"reputation": 126897, "user_id": 791604, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/ce991df7a056248d5e4f6fc3659ba733?s=128&d=identicon&r=PG", "display_name": "Daniel Wagner", "link": "https://stackoverflow.com/users/791604/daniel-wagner"}, "edited": false, "score": 1, "creation_date": 1530120298, "post_id": 51068258, "comment_id": 89126564, "body": "Unrelated to your problem: <code>many</code> and <code>many1</code> probably don&#39;t need the <code>Eq a</code> constraint. Related to your problem: what are the definitions of <code>Parser</code>, <code>parse</code>, <code>items</code>, <code>(+++)</code>, <code>returns</code>, and <code>(&gt;&gt;=)</code>?"}, {"owner": {"reputation": 157, "user_id": 6419129, "user_type": "registered", "accept_rate": 14, "profile_image": "https://www.gravatar.com/avatar/53b266a52d0441492fd5fd551d37c650?s=128&d=identicon&r=PG&f=1", "display_name": "Jt1995", "link": "https://stackoverflow.com/users/6419129/jt1995"}, "reply_to_user": {"reputation": 126897, "user_id": 791604, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/ce991df7a056248d5e4f6fc3659ba733?s=128&d=identicon&r=PG", "display_name": "Daniel Wagner", "link": "https://stackoverflow.com/users/791604/daniel-wagner"}, "edited": false, "score": 0, "creation_date": 1530120484, "post_id": 51068258, "comment_id": 89126658, "body": "@DanielWagner updated, it was item not items , wrong sorry"}, {"owner": {"reputation": 4234, "user_id": 4942760, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/f322d06b4f3e34278f29a954e0f38cb1?s=128&d=identicon&r=PG&f=1", "display_name": "Dan Robertson", "link": "https://stackoverflow.com/users/4942760/dan-robertson"}, "edited": false, "score": 1, "creation_date": 1530121379, "post_id": 51068258, "comment_id": 89127087, "body": "You should get rid of the <code>Eq</code> constraint in <code>(+++)</code> and use <code>null :: [a] -&gt; Bool</code> or a <code>case</code> expression instead."}], "answers": [{"tags": [], "owner": {"reputation": 100768, "user_id": 1899640, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/47374ccb28e4b0d2454b64f7b975bc66?s=128&d=identicon&r=PG", "display_name": "that other guy", "link": "https://stackoverflow.com/users/1899640/that-other-guy"}, "is_accepted": false, "score": 1, "last_activity_date": 1530121523, "creation_date": 1530121523, "answer_id": 51068678, "question_id": 51068258, "link": "https://stackoverflow.com/questions/51068258/function-loop-in-string-too-long/51068678#51068678", "title": "Function Loop in string too long", "body": "<p>Your code works fine, it's just that you've written your parser to have infinite backtracking and therefore <code>O(2^n)</code> runtime. Every character you add doubles the time it takes to complete:</p>\n\n<pre><code>$ time hugs foo.hs &lt;&lt;&lt; 'parse (many item) \"if x=0 then x:=0 els\"'\n[...]\nMain&gt; [(\"if x=0 then x:=0 els\",\"\")]\nMain&gt; [Leaving Hugs]\n\nreal    0m11.076s\nuser    0m10.578s\nsys     0m0.016s\n</code></pre>\n\n<p>vs</p>\n\n<pre><code>$ time hugs foo.hs &lt;&lt;&lt; 'parse (many item) \"if x=0 then x:=0 else\"'\n[...]\nMain&gt; [(\"if x=0 then x:=0 else\",\"\")]\nMain&gt; [Leaving Hugs]\n\nreal    0m22.346s\nuser    0m22.048s\nsys     0m0.036s\n</code></pre>\n"}, {"comments": [{"owner": {"reputation": 157, "user_id": 6419129, "user_type": "registered", "accept_rate": 14, "profile_image": "https://www.gravatar.com/avatar/53b266a52d0441492fd5fd551d37c650?s=128&d=identicon&r=PG&f=1", "display_name": "Jt1995", "link": "https://stackoverflow.com/users/6419129/jt1995"}, "edited": false, "score": 0, "creation_date": 1530122160, "post_id": 51068696, "comment_id": 89127467, "body": "yes it works, but i have a lot of duplicates as u said"}, {"owner": {"reputation": 4234, "user_id": 4942760, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/f322d06b4f3e34278f29a954e0f38cb1?s=128&d=identicon&r=PG&f=1", "display_name": "Dan Robertson", "link": "https://stackoverflow.com/users/4942760/dan-robertson"}, "reply_to_user": {"reputation": 157, "user_id": 6419129, "user_type": "registered", "accept_rate": 14, "profile_image": "https://www.gravatar.com/avatar/53b266a52d0441492fd5fd551d37c650?s=128&d=identicon&r=PG&f=1", "display_name": "Jt1995", "link": "https://stackoverflow.com/users/6419129/jt1995"}, "edited": false, "score": 0, "creation_date": 1530152204, "post_id": 51068696, "comment_id": 89137029, "body": "One solution could be to only have <code>(+++)</code> work for <code>Parser a</code> when <code>Ord a</code>, and use sets to remove duplicates. But this would involve comparing strings over their length when actually you only need to compare them physically (ie strings are equal iff they are in the same memory location, but as things can move this type of equality can\u2019t become an order). Another thing to consider would be changing the type of parse to return indexes instead of strings."}], "tags": [], "owner": {"reputation": 4234, "user_id": 4942760, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/f322d06b4f3e34278f29a954e0f38cb1?s=128&d=identicon&r=PG&f=1", "display_name": "Dan Robertson", "link": "https://stackoverflow.com/users/4942760/dan-robertson"}, "is_accepted": true, "score": 0, "last_activity_date": 1530121584, "creation_date": 1530121584, "answer_id": 51068696, "question_id": 51068258, "link": "https://stackoverflow.com/questions/51068258/function-loop-in-string-too-long/51068696#51068696", "title": "Function Loop in string too long", "body": "<p>Your implementation of <code>(+++)</code> doesn\u2019t do what you think it does. In particular, it will only return successful parsed from one of its arguments, rather than from both. Here is how to do what you want:</p>\n\n<pre><code>(+++) :: Parser a -&gt; Parser a -&gt; Parser a\np +++ q = Parser $ \\s -&gt; parse p s ++ parse q s\n</code></pre>\n\n<p>Although this doesn\u2019t remove duplicates so be warned that you can end up with an explosion of parses by doing eg <code>many (many item)</code>.</p>\n"}], "owner": {"reputation": 157, "user_id": 6419129, "user_type": "registered", "accept_rate": 14, "profile_image": "https://www.gravatar.com/avatar/53b266a52d0441492fd5fd551d37c650?s=128&d=identicon&r=PG&f=1", "display_name": "Jt1995", "link": "https://stackoverflow.com/users/6419129/jt1995"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 52, "favorite_count": 0, "accepted_answer_id": 51068696, "answer_count": 2, "score": 1, "last_activity_date": 1530121584, "creation_date": 1530119792, "last_edit_date": 1530121121, "question_id": 51068258, "link": "https://stackoverflow.com/questions/51068258/function-loop-in-string-too-long", "title": "Function Loop in string too long", "body": "<p>i have these functions:</p>\n\n<pre><code>item :: Parser Char\nitem  = Parser i\n        where i []     = []\n              i (x:xs) = [(x,xs)] \n\nmany  :: Eq a=&gt; Parser a -&gt; Parser [a]\nmany p = many1 p +++ return []\n\nmany1  :: Eq a=&gt; Parser a -&gt; Parser [a]\nmany1 p = do v  &lt;- p\n             vs &lt;- many p\n             returns (v:vs)\n</code></pre>\n\n<p>Im getting strange results applying differents strings. If i execute:</p>\n\n<pre><code>parse (many item) \"x:=0\"\n</code></pre>\n\n<p>i get </p>\n\n<pre><code>[('x',0)]\n</code></pre>\n\n<p>while if i use another string longer like \"if x=0 then x:=0 else x:=1\" it looks like go in loop. Doing some attempts it seems that if the string is longer more than 19 chars the function doesnt end. It's strange because on other string long less 19 chars it works good. What it could be?</p>\n\n<p>Other definitions:</p>\n\n<pre><code>newtype Parser a = Parser { parse :: String -&gt; [(a, String)] }\n\n\ninstance Monad Parser where\n    return t = Parser $ \\s -&gt; [(t, s)]\n    m &gt;&gt;= k  = Parser $ \\s -&gt; [(x, y) | (u, v) &lt;- parse m s, (x, y) &lt;- parse (k u) v]\n\n(+++) :: Eq a =&gt; Parser a -&gt; Parser a -&gt; Parser a\np +++ q = Parser $ \\s -&gt; if((parse p s)==[]) then parse q s else parse p s\n</code></pre>\n"}, {"tags": ["haskell"], "comments": [{"owner": {"reputation": 126897, "user_id": 791604, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/ce991df7a056248d5e4f6fc3659ba733?s=128&d=identicon&r=PG", "display_name": "Daniel Wagner", "link": "https://stackoverflow.com/users/791604/daniel-wagner"}, "edited": false, "score": 0, "creation_date": 1530119069, "post_id": 51067151, "comment_id": 89125986, "body": "For this particular use, you could write <code>[1..4]</code>. (Not an answer to the question, just another way of forming lists that you may not have known about.)"}, {"owner": {"reputation": 2360, "user_id": 367332, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/6D0rd.png?s=128&g=1", "display_name": "DarthFennec", "link": "https://stackoverflow.com/users/367332/darthfennec"}, "edited": false, "score": 1, "creation_date": 1530120466, "post_id": 51067151, "comment_id": 89126642, "body": "Even if GHC did realize at compile time that none of the remaining items were going to pass the predicate, it wouldn&#39;t behave any differently (it might throw an exception instead of hanging, but it wouldn&#39;t give you a terminated list). The value of your expression is <code>1:2:3:4:\u22a5</code>, which is not the same value as <code>1:2:3:4:[]</code>. That doesn&#39;t mean you <i>couldn&#39;t</i> use former list; just don&#39;t try to look at items past the fourth one."}], "answers": [{"comments": [{"owner": {"reputation": 11366, "user_id": 3922954, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/76ba47d2fdd24ab56b0b273cce2075e5?s=128&d=identicon&r=PG&f=1", "display_name": "AJF", "link": "https://stackoverflow.com/users/3922954/ajf"}, "edited": false, "score": 1, "creation_date": 1530118935, "post_id": 51067212, "comment_id": 89125912, "body": "Just for reference <a href=\"http://hackage.haskell.org/package/base-4.11.1.0/docs/Prelude.html#v:takeWhile\" rel=\"nofollow noreferrer\">here is the definition of <code>takeWhile</code> on Hackage</a>."}], "tags": [], "owner": {"reputation": 12194, "user_id": 4474419, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/04ce27f0ebe4713b51911cd8475c3b42?s=128&d=identicon&r=PG", "display_name": "Davislor", "link": "https://stackoverflow.com/users/4474419/davislor"}, "is_accepted": true, "score": 5, "last_activity_date": 1530124200, "last_edit_date": 1530124200, "creation_date": 1530115723, "answer_id": 51067212, "question_id": 51067151, "link": "https://stackoverflow.com/questions/51067151/guards-in-list-comprehensions-dont-terminate-infinite-lists/51067212#51067212", "title": "Guards in list comprehensions don&#39;t terminate infinite lists?", "body": "<p>You literally told the program to check every element of the infinite list and include only the ones that are less than 5.  As you say, the compiler doesn\u2019t realize that no remaining element of the list will ever satisfy the condition.  Nor could it, even in theory, create such a proof at runtime if passed an arbitrary list.  It just does what you said, and keeps checking every element.</p>\n\n<p>This is not necessarily a bug if the program does not try to evaluate <code>xs</code> in the result <code>1:2:3:4:xs</code>, due to lazy evaluation.  Taking the <code>head</code> should work just fine.  If you tell it to find the length of the list or something like that, though, it\u2019s an infinite loop.</p>\n\n<p>One way to do what you (probably?) want is <a href=\"https://hackage.haskell.org/package/base-4.11.1.0/docs/Prelude.html#v:takeWhile\" rel=\"nofollow noreferrer\"><code>takeWhile</code></a>, which stops when the condition is no longer true.</p>\n"}], "owner": {"reputation": 479, "user_id": 4496701, "user_type": "registered", "accept_rate": 25, "profile_image": "https://lh5.googleusercontent.com/-SST61v329Q0/AAAAAAAAAAI/AAAAAAAAAFM/ihwdZ1nZE7Q/photo.jpg?sz=128", "display_name": "Cliff Stamp", "link": "https://stackoverflow.com/users/4496701/cliff-stamp"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 168, "favorite_count": 0, "closed_date": 1530223904, "accepted_answer_id": 51067212, "answer_count": 1, "score": 1, "last_activity_date": 1530124200, "creation_date": 1530115502, "last_edit_date": 1530115658, "question_id": 51067151, "link": "https://stackoverflow.com/questions/51067151/guards-in-list-comprehensions-dont-terminate-infinite-lists", "closed_reason": "Duplicate", "title": "Guards in list comprehensions don&#39;t terminate infinite lists?", "body": "<p>I thought this :</p>\n\n<pre><code>[i | i &lt;- [1..], i &lt; 5]\n</code></pre>\n\n<p>would produce </p>\n\n<pre><code>[1, 2, 3, 4]\n</code></pre>\n\n<p>just like</p>\n\n<pre><code>take 4 [i | i &lt;- [1..]]\n</code></pre>\n\n<p>A finite length list. </p>\n\n<p>But it doesn't, it seems to be infinite because any attempt to treat it as a finite list just causes hang (ghci). </p>\n\n<p>I am not sure how to understand this exactly. Is it some kind of infinite generator which simply produces nothing after the fourth item but never stops?</p>\n\n<p>Basically the code keeps generating new items because it doesn't know they can never satisfy the criterion?</p>\n"}, {"tags": ["haskell", "overloaded-strings"], "comments": [{"owner": {"reputation": 78982, "user_id": 1848654, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/84180c0f3c9c04f8b8f0613fc0129dac?s=128&d=identicon&r=PG", "display_name": "melpomene", "link": "https://stackoverflow.com/users/1848654/melpomene"}, "edited": false, "score": 0, "creation_date": 1530118229, "post_id": 51067056, "comment_id": 89125558, "body": "Your code specifically says <code>dropTableeIfExistsQuery :: ... -&gt; String</code>, so it returns a string. No overloading is involved."}, {"owner": {"reputation": 4113, "user_id": 4601931, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/4785004388498e25bc6794fe1d9d4a38?s=128&d=identicon&r=PG&f=1", "display_name": "user4601931", "link": "https://stackoverflow.com/users/4601931/user4601931"}, "reply_to_user": {"reputation": 78982, "user_id": 1848654, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/84180c0f3c9c04f8b8f0613fc0129dac?s=128&d=identicon&r=PG", "display_name": "melpomene", "link": "https://stackoverflow.com/users/1848654/melpomene"}, "edited": false, "score": 0, "creation_date": 1530118425, "post_id": 51067056, "comment_id": 89125669, "body": "@melpomene The <code>execute_</code>/<code>query_</code> families of functions have a signature like <code>Connection -&gt; Query -&gt; IO Int64</code>, where <code>Query</code> is a type that has an instance of <code>IsString</code>.  My understanding is that I can pass a <code>String</code> as a <code>Query</code> and the <code>OverloadedStrings</code> extension will take care of the coercion.  But that appears to not be the case, in spite of what the documentation says.  My question is, why?"}, {"owner": {"reputation": 78982, "user_id": 1848654, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/84180c0f3c9c04f8b8f0613fc0129dac?s=128&d=identicon&r=PG", "display_name": "melpomene", "link": "https://stackoverflow.com/users/1848654/melpomene"}, "edited": false, "score": 1, "creation_date": 1530118502, "post_id": 51067056, "comment_id": 89125720, "body": "<code>OverloadedStrings</code> changes the type of string literals (i.e. <code>&quot;double-quoted stuff like this&quot;</code>) from <code>String</code> to <code>IsString a =&gt; a</code>. That&#39;s all."}, {"owner": {"reputation": 384463, "user_id": 1126841, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/fa05233b2357f8d11c22ef4cfc7bb85c?s=128&d=identicon&r=PG", "display_name": "chepner", "link": "https://stackoverflow.com/users/1126841/chepner"}, "edited": false, "score": 0, "creation_date": 1530119397, "post_id": 51067056, "comment_id": 89126132, "body": "You are also subject to a SQL injection attack if you don&#39;t have control over the value of <code>tbl</code>."}], "answers": [{"tags": [], "owner": {"reputation": 126897, "user_id": 791604, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/ce991df7a056248d5e4f6fc3659ba733?s=128&d=identicon&r=PG", "display_name": "Daniel Wagner", "link": "https://stackoverflow.com/users/791604/daniel-wagner"}, "is_accepted": true, "score": 1, "last_activity_date": 1530119259, "creation_date": 1530119259, "answer_id": 51068128, "question_id": 51067056, "link": "https://stackoverflow.com/questions/51067056/type-error-for-query-string-with-postgresql-simple/51068128#51068128", "title": "Type error for Query string with postgresql-simple", "body": "<p><code>OverloadedStrings</code> only affects string literals, not all terms of type <code>String</code>. If you have a <code>String</code> which is not a literal, you may explicitly convert it to any instance of <code>IsString</code> (e.g. <code>Query</code>) using:</p>\n\n<pre><code>fromString :: IsString a =&gt; String -&gt; a\n</code></pre>\n\n<p>N.B. I don't know enough about <code>Query</code> and the other libraries you're using to say whether <code>fromString</code> has the behavior you need; I claim only that it has the type you need.</p>\n"}], "owner": {"reputation": 4113, "user_id": 4601931, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/4785004388498e25bc6794fe1d9d4a38?s=128&d=identicon&r=PG&f=1", "display_name": "user4601931", "link": "https://stackoverflow.com/users/4601931/user4601931"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 77, "favorite_count": 0, "accepted_answer_id": 51068128, "answer_count": 1, "score": 0, "last_activity_date": 1530119259, "creation_date": 1530115133, "last_edit_date": 1530118015, "question_id": 51067056, "link": "https://stackoverflow.com/questions/51067056/type-error-for-query-string-with-postgresql-simple", "title": "Type error for Query string with postgresql-simple", "body": "<p>Related to <a href=\"https://stackoverflow.com/questions/51013242/figuring-out-the-source-of-a-database-error-using-haskell-postgresql-simple\">this question</a>, I have a query template that I've constructed using the <a href=\"https://hackage.haskell.org/package/interpolate-0.2.0/docs/Data-String-Interpolate.html\" rel=\"nofollow noreferrer\"><code>interpolate</code></a> package, which I'm then trying to pass to the <code>query_</code>/<code>execute_</code> functions from <a href=\"http://hackage.haskell.org/package/postgresql-simple-0.5.4.0/docs/Database-PostgreSQL-Simple.html\" rel=\"nofollow noreferrer\"><code>postgresql-simple</code></a>.  But the compiler refuses, with the the error</p>\n\n<pre><code>    \u2022 Couldn't match type \u2018[Char]\u2019 with \u2018Query\u2019\n      Expected type: Query\n      Actual type: String\n</code></pre>\n\n<p>The notable passage from the doc pages for postgresql-simple is, \"To most easily construct a query, enable GHC's <code>OverloadedStrings</code> language extension and write your query as a normal literal string.\"  So, it would appear that the following should work:</p>\n\n<pre><code>{-# LANGUAGE QuasiQuotes       #-}\n{-# LANGUAGE OverloadedStrings #-}\n\nimport Control.Monad (void)\nimport Database.PostgreSQL.Simple\nimport Data.String.Interpolate (i)\n\n-- schema_name.table_name\ntype Table = String\n\ndropTableIfExistsQuery :: Table -&gt; String\ndropTableIfExistsQuery tbl = [i| DROP TABLE IF EXISTS #{tbl} |]\n\ndropTableIfExists :: Connection -&gt; Table -&gt; IO ()\ndropTableIfExists conn tbl = void $ execute_ conn $ dropTableIfExistsQuery tbl\n</code></pre>\n\n<p>But this won't compile, as above:</p>\n\n<pre><code>    \u2022 Couldn't match type \u2018[Char]\u2019 with \u2018Query\u2019\n  Expected type: Query\n    Actual type: String\n\u2022 In the second argument of \u2018($)\u2019, namely\n    \u2018dropTableIfExistsQuery tbl\u2019\n  In the second argument of \u2018($)\u2019, namely\n    \u2018execute_ conn $ dropTableIfExistsQuery tbl\u2019\n  In the expression:\n    void $ execute_ conn $ dropTableIfExistsQuery tbl\n</code></pre>\n\n<p>What gives?  Why isn't <code>OverloadedStrings</code> working here?</p>\n"}, {"tags": ["haskell", "web-hosting", "happstack"], "comments": [{"owner": {"reputation": 507, "user_id": 4966887, "user_type": "registered", "accept_rate": 71, "profile_image": "https://www.gravatar.com/avatar/2b2d9b78341809c8b9b01ac9ae3f3c72?s=128&d=identicon&r=PG&f=1", "display_name": "Chirs", "link": "https://stackoverflow.com/users/4966887/chirs"}, "edited": false, "score": 0, "creation_date": 1530136368, "post_id": 51064865, "comment_id": 89133642, "body": "Well, in general, you&#39;ll end up with a binary and a bunch of files (html, js etc.). One option is to just host it on a virtual private server -- if you&#39;re comfortable with managing a linux server. Alternatively, you might want to check out a Heroku or similar services."}, {"owner": {"reputation": 140, "user_id": 6213184, "user_type": "registered", "profile_image": "https://graph.facebook.com/1211992672147158/picture?type=large", "display_name": "Hilton Pintor", "link": "https://stackoverflow.com/users/6213184/hilton-pintor"}, "reply_to_user": {"reputation": 507, "user_id": 4966887, "user_type": "registered", "accept_rate": 71, "profile_image": "https://www.gravatar.com/avatar/2b2d9b78341809c8b9b01ac9ae3f3c72?s=128&d=identicon&r=PG&f=1", "display_name": "Chirs", "link": "https://stackoverflow.com/users/4966887/chirs"}, "edited": false, "score": 0, "creation_date": 1530203456, "post_id": 51064865, "comment_id": 89163839, "body": "@Chirs actually I don&#39;t have what you said: a binary and a bunch of files (html, js etc). What I have is a bunch of .hs files since I used Happstack."}, {"owner": {"reputation": 507, "user_id": 4966887, "user_type": "registered", "accept_rate": 71, "profile_image": "https://www.gravatar.com/avatar/2b2d9b78341809c8b9b01ac9ae3f3c72?s=128&d=identicon&r=PG&f=1", "display_name": "Chirs", "link": "https://stackoverflow.com/users/4966887/chirs"}, "edited": false, "score": 0, "creation_date": 1530260716, "post_id": 51064865, "comment_id": 89182306, "body": "Then your first step will be to compile your happstack application. E.g. with <code>stack build</code> (if you use stack) or <code>cabal build</code> (if you use cabal)."}, {"owner": {"reputation": 1057, "user_id": 146560, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/fe6db7ea5f961fbaabca0c0d7a364217?s=128&d=identicon&r=PG", "display_name": "Ro.", "link": "https://stackoverflow.com/users/146560/ro"}, "edited": false, "score": 0, "creation_date": 1545139574, "post_id": 51064865, "comment_id": 94516120, "body": "One of the easiest way is to put your code on a Docker maybe more than one, i.e. one for your app, other for your db. Most of the cloud services accept docker instances."}], "answers": [{"tags": [], "owner": {"reputation": 493, "user_id": 6889286, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/76d9b8a4d03d0de0a49eac62a5569c9e?s=128&d=identicon&r=PG&f=1", "display_name": "Kartik Sabharwal", "link": "https://stackoverflow.com/users/6889286/kartik-sabharwal"}, "is_accepted": false, "score": 2, "last_activity_date": 1533644933, "last_edit_date": 1533644933, "creation_date": 1533634477, "answer_id": 51723483, "question_id": 51064865, "link": "https://stackoverflow.com/questions/51064865/how-to-host-a-happstack-website/51723483#51723483", "title": "How to host a Happstack website?", "body": "<p>Here's a short overview of the hosting process I followed to get a website running using Haskell server software.</p>\n\n<h1>Get a Server</h1>\n\n<p>The first thing you need when you're hosting is a device to run the server code.</p>\n\n<p>You can either rent a \"virtual computer\" from a company\n(a Virtual Private Server or VPS) or you can use a computer you have lying\nabout at home.</p>\n\n<h2>Virtual Private Server</h2>\n\n<p>Choose a VPS provider from among the huge number of companies that offer this\nkind of service. The provider should allow you to install software on the VPS\nand attach a static IP address to it.  I have used AWS Lightsail and Cloud9\nin the past. </p>\n\n<p>Once you have decided on a provider you need to subscribe to a plan.\nWhat's important here is to pick an OS that you can install stack on.\nYou should also choose enough RAM, storage space and clock speed to allow\nstack to work without problems.</p>\n\n<p>When your VPS is ready for use attach a static IP address to it and then\ninstall stack on it.</p>\n\n<p>If you're done with all this you can ignore the \"Home Server\" section and\njump straight to \"Set Up Happstack\"</p>\n\n<h2>Home Server</h2>\n\n<h3>Static IP (Home Network)</h3>\n\n<p>Have your home router assign a fixed IP to the device you intend to use\nas a server. Note that this only applies to your home network.</p>\n\n<p>The way to make this work varies a lot across operating systems.\nYou're better off running a web search for the steps specific to your OS.</p>\n\n<h3>Port Forwarding</h3>\n\n<p>Your home router's settings page should have a section called \"Port Forwarding\"\nor something similar.</p>\n\n<p>The goal is to forward all connections made to port 80 of your home router to\nthe port of your device that you have configured happstack to listen on.\nThe IP address that you'll want to forward it to will be the fixed IP address\nof your device.</p>\n\n<p>Again, the process varies quite a bit based on your router's manufacturer.\nYou can always look up the steps to perform port forwarding on a router \nof a specific make and model.</p>\n\n<h3>Static IP (Internet)</h3>\n\n<p>Contact your internet service provider to get a fixed IP address for your\nrouter on the internet.</p>\n\n<h1>Set Up Happstack</h1>\n\n<p>Suppose you want to run happstack on port 81 of your device.</p>\n\n<p>Perform the following steps:</p>\n\n<ol>\n<li><p><code>stack new happstack-hosting</code></p></li>\n<li><p>Add <code>happstack-server</code> to the list of dependencies inside the project's\npackage.yaml file.</p></li>\n<li><p>Put the following code in the project's app/Main.hs file</p>\n\n<pre><code>module Main where\n\nimport Happstack.Server (nullConf, simpleHTTP, toResponse, ok, port)\n\nmain :: IO ()\nmain = simpleHTTP (nullConf { port = 81 }) $ ok \"Hello, World!\"\n</code></pre></li>\n<li><p>Run <code>stack build</code></p></li>\n<li><p>Run <code>sudo stack exec happstack-hosting --allow-different-user</code></p></li>\n</ol>\n\n<p>Of course, you'll have to substitute this Main.hs with your own server code once you've verified that you can access the website from the internet.</p>\n\n<h1>Use a Domain Name</h1>\n\n<p>Get a domain name from a registrar. I have used Google Domains, Namecheap and GoDaddy before but there are a lot of others out there.</p>\n\n<p>If you're using a VPS follow your registrar's instructions to redirect the domain name to port 81 of your VPS's IP address.</p>\n\n<p>Otherwise redirect the domain name to port 80\nof your router's static IP address.</p>\n"}, {"tags": [], "owner": {"reputation": 140, "user_id": 6213184, "user_type": "registered", "profile_image": "https://graph.facebook.com/1211992672147158/picture?type=large", "display_name": "Hilton Pintor", "link": "https://stackoverflow.com/users/6213184/hilton-pintor"}, "is_accepted": true, "score": 0, "last_activity_date": 1559403321, "creation_date": 1559403321, "answer_id": 56408070, "question_id": 51064865, "link": "https://stackoverflow.com/questions/51064865/how-to-host-a-happstack-website/56408070#56408070", "title": "How to host a Happstack website?", "body": "<p>Thanks for everyone who answered. I ended up using a docker image alongside heroku for deployment. If you want to see how the docker file looks check <a href=\"https://github.com/hpbl/haskellkoans\" rel=\"nofollow noreferrer\">https://github.com/hpbl/haskellkoans</a></p>\n"}], "owner": {"reputation": 140, "user_id": 6213184, "user_type": "registered", "profile_image": "https://graph.facebook.com/1211992672147158/picture?type=large", "display_name": "Hilton Pintor", "link": "https://stackoverflow.com/users/6213184/hilton-pintor"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 193, "favorite_count": 0, "accepted_answer_id": 56408070, "answer_count": 2, "score": 1, "last_activity_date": 1559403321, "creation_date": 1530108224, "question_id": 51064865, "link": "https://stackoverflow.com/questions/51064865/how-to-host-a-happstack-website", "title": "How to host a Happstack website?", "body": "<p>I've built a website using Happstack, but I have no experience in hosting. Everything I found online was either outdated or too complex for me. Is there an easy way, or tutorial I can follow to publish my Happstack website?</p>\n\n<p>Thanks</p>\n"}, {"tags": ["haskell", "haskell-stack", "hint"], "comments": [{"owner": {"reputation": 11366, "user_id": 3922954, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/76ba47d2fdd24ab56b0b273cce2075e5?s=128&d=identicon&r=PG&f=1", "display_name": "AJF", "link": "https://stackoverflow.com/users/3922954/ajf"}, "edited": false, "score": 0, "creation_date": 1530111851, "post_id": 51064855, "comment_id": 89121998, "body": "I can&#39;t find the <code>Data.Finite</code> module on hackage, hoogle, or hayoo. It looks like you&#39;re using a package that doesn&#39;t exist, as the error says. Where do you think the <code>Data.Finite</code> module comes from?"}, {"owner": {"reputation": 7817, "user_id": 7345298, "user_type": "registered", "accept_rate": 50, "profile_image": "https://www.gravatar.com/avatar/9477d048c5c29b16307b3356146d497a?s=128&d=identicon&r=PG&f=1", "display_name": "bradrn", "link": "https://stackoverflow.com/users/7345298/bradrn"}, "reply_to_user": {"reputation": 11366, "user_id": 3922954, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/76ba47d2fdd24ab56b0b273cce2075e5?s=128&d=identicon&r=PG&f=1", "display_name": "AJF", "link": "https://stackoverflow.com/users/3922954/ajf"}, "edited": false, "score": 0, "creation_date": 1530139190, "post_id": 51064855, "comment_id": 89134456, "body": "It&#39;s at <a href=\"https://www.stackage.org/haddock/lts-11.13/finite-typelits-0.1.3.0/Data-Finite.html\" rel=\"nofollow noreferrer\">stackage.org/haddock/lts-11.13/finite-typelits-0.1.3.0/&hellip;</a> - I just used it as a dependency in the linked example to illustrate my problem"}], "owner": {"reputation": 7817, "user_id": 7345298, "user_type": "registered", "accept_rate": 50, "profile_image": "https://www.gravatar.com/avatar/9477d048c5c29b16307b3356146d497a?s=128&d=identicon&r=PG&f=1", "display_name": "bradrn", "link": "https://stackoverflow.com/users/7345298/bradrn"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 133, "favorite_count": 0, "answer_count": 0, "score": 2, "last_activity_date": 1530108198, "creation_date": 1530108198, "question_id": 51064855, "link": "https://stackoverflow.com/questions/51064855/use-dependencies-in-hint-when-installing", "title": "Use dependencies in Hint when Installing", "body": "<p>I'm writing a project using Haskell, <code>stack</code> and <code>hint</code>. I'm using <code>hint</code> to interpret a user-supplied module. The catch is that this module uses types and functions from a dependency. When I run my program using <code>stack exec</code>, everything works fine. However, when I install my program (using <code>stack install --local-bin-path bin</code>) and try to run the executable generated, the GHC interpreter fails with an error: <code>Could not find module &lt;module&gt;</code>. This is because (I think) it can't find the files needed for it to interpret source code referring to this dependency. Does anyone know how to fix this? I'm using Windows 10.</p>\n\n<p>I've uploaded a minimal not-working example at <a href=\"https://github.com/bradrn/stack-overflow-hint-dependencies\" rel=\"nofollow noreferrer\">https://github.com/bradrn/stack-overflow-hint-dependencies</a>. It works fine if you do <code>stack exec stack-overflow-hint-dependencies</code>, but if you do <code>stack install --local-bin-path bin</code> it fails with <code>Could not find module 'Data.Finite'</code> when you try to interpret something.</p>\n"}, {"tags": ["haskell"], "comments": [{"owner": {"reputation": 384463, "user_id": 1126841, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/fa05233b2357f8d11c22ef4cfc7bb85c?s=128&d=identicon&r=PG", "display_name": "chepner", "link": "https://stackoverflow.com/users/1126841/chepner"}, "edited": false, "score": 1, "creation_date": 1530106024, "post_id": 51062960, "comment_id": 89117950, "body": "<code>negate</code> is already defined by the <code>Num</code> class; any reason you aren&#39;t making a <code>Num Weight</code> instance?"}], "answers": [{"comments": [{"owner": {"reputation": 1377, "user_id": 8314628, "user_type": "registered", "accept_rate": 88, "profile_image": "https://www.gravatar.com/avatar/0eefa2c64f533d21e1d8f58e4252a1e9?s=128&d=identicon&r=PG&f=1", "display_name": "user8314628", "link": "https://stackoverflow.com/users/8314628/user8314628"}, "edited": false, "score": 0, "creation_date": 1530104192, "post_id": 51063011, "comment_id": 89116560, "body": "Yeah, I tried <code>negate Fin x = 0 - x</code>. But this is obviously wrong."}], "tags": [], "owner": {"reputation": 11366, "user_id": 3922954, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/76ba47d2fdd24ab56b0b273cce2075e5?s=128&d=identicon&r=PG&f=1", "display_name": "AJF", "link": "https://stackoverflow.com/users/3922954/ajf"}, "is_accepted": true, "score": 3, "last_activity_date": 1530103090, "creation_date": 1530103090, "answer_id": 51063011, "question_id": 51062960, "link": "https://stackoverflow.com/questions/51062960/how-can-i-negate-a-user-defined-integer/51063011#51063011", "title": "How can I negate a user defined Integer?", "body": "<p>You need brackets for pattern matches:</p>\n\n<pre><code>negate (Fin x) = Fin (0 - x)\n</code></pre>\n\n<p>Otherwise, it looks like you've got two arguments.</p>\n\n<p>This is reflected in the error: \"Equations for \u2018negate\u2019 have <strong>different numbers of arguments</strong>\". </p>\n\n<p>This doesn't apply for <code>Inf</code>, because it takes no arguments.</p>\n"}], "owner": {"reputation": 1377, "user_id": 8314628, "user_type": "registered", "accept_rate": 88, "profile_image": "https://www.gravatar.com/avatar/0eefa2c64f533d21e1d8f58e4252a1e9?s=128&d=identicon&r=PG&f=1", "display_name": "user8314628", "link": "https://stackoverflow.com/users/8314628/user8314628"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 252, "favorite_count": 0, "accepted_answer_id": 51063011, "answer_count": 1, "score": 0, "last_activity_date": 1530103090, "creation_date": 1530102936, "question_id": 51062960, "link": "https://stackoverflow.com/questions/51062960/how-can-i-negate-a-user-defined-integer", "title": "How can I negate a user defined Integer?", "body": "<p>I have</p>\n\n<pre><code>data Weight = Fin Integer | Inf\n    deriving (Eq, Ord, Show)\n\nnegate :: Weight -&gt; Weight\nnegate Inf = error \"negative infinity not supported\"\n</code></pre>\n\n<p>I want <code>negate Fin (-1) =  Fin 1</code>. So I further define</p>\n\n<pre><code>negate Fin x = Fin (0 - x)\n</code></pre>\n\n<p>But this gives error</p>\n\n<pre><code>? Equations for \u2018negate\u2019 have different numbers of arguments\n</code></pre>\n\n<p>How can I fix it? Thank you!</p>\n"}, {"tags": ["haskell", "typeclass", "subtype", "subtyping"], "comments": [{"owner": {"reputation": 208473, "user_id": 126014, "user_type": "registered", "accept_rate": 86, "profile_image": "https://www.gravatar.com/avatar/33526616d4a11f1630d4939b769cfbf9?s=128&d=identicon&r=PG", "display_name": "Mark Seemann", "link": "https://stackoverflow.com/users/126014/mark-seemann"}, "edited": false, "score": 0, "creation_date": 1530079273, "post_id": 51055359, "comment_id": 89101571, "body": "I don&#39;t think it&#39;s a question of what sub-typing can do that type classes can&#39;t, but rather the other way around. Haskell&#39;s type classes can express relationships that I wouldn&#39;t know how to do with OOP, although that&#39;d clearly be language-dependent. How would you, for example, define <code>Functor</code> in OOP?"}], "answers": [{"tags": [], "owner": {"reputation": 48938, "user_id": 246886, "user_type": "registered", "accept_rate": 94, "profile_image": "https://www.gravatar.com/avatar/dd1ebaade6623fc538fb8af3338e730d?s=128&d=identicon&r=PG", "display_name": "Jon Purdy", "link": "https://stackoverflow.com/users/246886/jon-purdy"}, "is_accepted": false, "score": 19, "last_activity_date": 1530224663, "last_edit_date": 1530224663, "creation_date": 1530083521, "answer_id": 51056617, "question_id": 51055359, "link": "https://stackoverflow.com/questions/51055359/what-is-the-difference-between-type-class-dependence-in-haskell-and-sub-typing-i/51056617#51056617", "title": "What is the difference between type class dependence in haskell and sub typing in OOP?", "body": "<p>A typeclass with one parameter is a <em>class of types</em>, which you can think of as a <em>set</em> of types. If <code>Sub</code> is a subclass (sub-typeclass) of <code>Super</code>, then the set of types implementing <code>Sub</code> is a <em>subset</em> of (or equal to) the set of types implementing <code>Super</code>. All <code>Monad</code>s are <code>Applicative</code>s, and all <code>Applicative</code>s are <code>Functor</code>s.</p>\n\n<p>Everything you can do with subclassing, you can do with existentially quantified, typeclass-constrained types in Haskell. This is because they\u2019re essentially the same thing: in a typical OOP language, every object with virtual methods includes a <em>vtable</em> pointer, which is the same as the \u201cdictionary\u201d pointer that\u2019s stored in an existentially quantified value with a typeclass constraint. Vtables are existentials! When someone gives you a superclass reference, you don\u2019t know whether it\u2019s an instance of the superclass or a subclass, you only know that it has a certain interface (either from the class or from an OOP \u201cinterface\u201d).</p>\n\n<p>In fact you can do <em>more</em> with Haskell\u2019s generalised existentials. An example I like is packing an action returning a value of some type <code>a</code> along with a variable where the result will be written once the action completes; the source returns a value of the same type as the variable, but this is hidden from the outside:</p>\n\n<pre><code>data Request = forall a. Request (IO a) (MVar a)\n</code></pre>\n\n<p>Because <code>Request</code> hides the type <code>a</code>, you can store multiple requests of different types in the same container. Because <code>a</code> is completely opaque, the <em>only</em> thing that a caller can do with a <code>Request</code> is run the action (synchronously or asynchronously) and write the result into the <code>MVar</code>. It\u2019s hard to use it wrong!</p>\n\n<p>The difference is that in OOP languages you can typically:</p>\n\n<ol>\n<li><p><em>Implicitly upcast</em>\u2014use a subclass reference where a superclass reference is expected, which must be done explicitly in Haskell (e.g. by packing in an existential)</p></li>\n<li><p><em>Attempt to downcast</em>, which is not allowed in Haskell unless you add an extra <code>Typeable</code> constraint that stores the runtime type information</p></li>\n</ol>\n\n<p>Typeclasses can model more things than OOP interfaces and subclassing, however, for a few reasons. For one thing, since they\u2019re constraints on <em>types</em>, not <em>objects</em>, you can have constants associated with a type, such as <code>mempty</code> in the <code>Monoid</code> typeclass:</p>\n\n<pre><code>class Semigroup m where\n  (&lt;&gt;) :: m -&gt; m -&gt; m\n\nclass (Semigroup m) =&gt; Monoid m where\n  mempty :: m\n</code></pre>\n\n<p>In OOP languages there\u2019s typically no notion of a \u201cstatic interface\u201d that would let you express this. The future \u201cconcepts\u201d feature in C++ is the nearest equivalent.</p>\n\n<p>The other thing is that subtyping and interfaces are predicated on a single type, whereas you can have a typeclass with <em>multiple</em> parameters, which denotes a set of <em>tuples</em> of types. You can think of this as a <em>relation</em>. For example, the set of pairs of types where one can be coerced to the other:</p>\n\n<pre><code>class Coercible a b where\n  coerce :: a -&gt; b\n</code></pre>\n\n<p>With <em>functional dependencies</em>, you can inform the compiler of various properties of this relation:</p>\n\n<pre><code>class Ref ref m | ref -&gt; m where\n  new :: a -&gt; m (ref a)\n  get :: ref a -&gt; m a\n  put :: ref a -&gt; a -&gt; m ()\n\ninstance Ref IORef IO where\n  new = newIORef\n  get = readIORef\n  put = writeIORef\n</code></pre>\n\n<p>Here the compiler knows that the relation is <em>single-valued</em>, or a <em>function</em>: each value of the \u201cinput\u201d (<code>ref</code>) maps to exactly one value of the \u201coutput\u201d (<code>m</code>). In other words, if the <code>ref</code> parameter of a <code>Ref</code> constraint is determined to be <code>IORef</code>, then the <code>m</code> parameter <em>must</em> be <code>IO</code>\u2014you cannot have this functional dependency and also a separate instance mapping <code>IORef</code> to a different monad, like <code>instance Ref IORef DifferentIO</code>. This type of functional relation between types can also be expressed with <em>associated types</em> or the more modern <em>type families</em> (which are usually clearer, in my opinion).</p>\n\n<p>Of course, it\u2019s not idiomatic to translate an OOP subclass hierarchy directly to Haskell using the \u201cexistential typeclass antipattern\u201d, which is usually overkill. There\u2019s often a far simpler translation, such as ADTs/GADTs/records/functions\u2014roughly this corresponds to the OOP advice of \u201cprefer composition over inheritance\u201d.</p>\n\n<p>Most of the time, when you would write a class in OOP, in Haskell you shouldn\u2019t generally reach for a <em>typeclass</em>, but rather a <em>module</em>. A module that exports a type and some functions operating on it is essentially the same thing as the public interface of a class, when it comes to encapsulation and code organisation. For dynamic behaviour, typically the best solution isn\u2019t type-based dispatch; instead, just use a higher-order function. It is functional programming, after all. :)</p>\n"}], "owner": {"reputation": 3074, "user_id": 1608276, "user_type": "registered", "accept_rate": 28, "profile_image": "https://i.stack.imgur.com/XiZ2q.jpg?s=128&g=1", "display_name": "luochen1990", "link": "https://stackoverflow.com/users/1608276/luochen1990"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 498, "favorite_count": 5, "answer_count": 1, "score": 9, "last_activity_date": 1530224663, "creation_date": 1530078550, "question_id": 51055359, "link": "https://stackoverflow.com/questions/51055359/what-is-the-difference-between-type-class-dependence-in-haskell-and-sub-typing-i", "title": "What is the difference between type class dependence in haskell and sub typing in OOP?", "body": "<p>We often use type class dependence to emulate the sub typing relationship.</p>\n\n<p>e.g:</p>\n\n<p>when we want to express the sub typing relationship between Animal, Reptile and Aves in OOP:</p>\n\n<pre><code>abstract class Animal {\n    abstract Animal move();\n    abstract Animal hunt();\n    abstract Animal sleep();\n}\n\nabstract class Reptile extends Animal {\n    abstract Reptile crawl();\n}\n\nabstract class Aves extends Animal {\n    abstract Aves fly();\n}\n</code></pre>\n\n<p>we can translate each abstract class above into a type class in Haskell:</p>\n\n<pre><code>class Animal a where\n    move :: a -&gt; a\n    hunt :: a -&gt; a\n    sleep :: a -&gt; a\n\nclass Animal a =&gt; Reptile a where\n    crawl :: a -&gt; a\n\nclass Animal a =&gt; Aves a where\n    fly :: a -&gt; a\n</code></pre>\n\n<p>And even when we want a heterogeneous list, we have <a href=\"https://stackoverflow.com/questions/20997745/how-do-i-make-an-heterogeneous-list-in-haskell-originally-in-java\">ExistentialQuantification</a> .</p>\n\n<p>So I'm wondering, why we still say that Haskell doesn't have sub-typing, is there still something which sub-typing can do but type class cannot?  What is the relationship and difference between them?</p>\n"}, {"tags": ["haskell"], "answers": [{"comments": [{"owner": {"reputation": 81794, "user_id": 9859, "user_type": "registered", "accept_rate": 89, "profile_image": "https://i.stack.imgur.com/KEZOL.jpg?s=128&g=1", "display_name": "rampion", "link": "https://stackoverflow.com/users/9859/rampion"}, "edited": false, "score": 2, "creation_date": 1530077543, "post_id": 51053697, "comment_id": 89100932, "body": "or <code>:cd K:\\lab7</code> from within <code>ghci</code>"}], "tags": [], "owner": {"reputation": 24509, "user_id": 6863749, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/UyoQv.jpg?s=128&g=1", "display_name": "Li-yao Xia", "link": "https://stackoverflow.com/users/6863749/li-yao-xia"}, "is_accepted": true, "score": 3, "last_activity_date": 1530066358, "creation_date": 1530066358, "answer_id": 51053697, "question_id": 51053628, "link": "https://stackoverflow.com/questions/51053628/haskell-could-not-find-user-defined-module/51053697#51053697", "title": "Haskell could not find user defined module", "body": "<p>Add <code>K:\\lab7</code> to the import search path, with the <code>-iPATH</code> option.</p>\n\n<pre><code>ghci -iK:\\lab7\n</code></pre>\n\n<p>or launch <code>ghci</code> from under <code>lab7</code>.</p>\n"}], "owner": {"reputation": 1377, "user_id": 8314628, "user_type": "registered", "accept_rate": 88, "profile_image": "https://www.gravatar.com/avatar/0eefa2c64f533d21e1d8f58e4252a1e9?s=128&d=identicon&r=PG&f=1", "display_name": "user8314628", "link": "https://stackoverflow.com/users/8314628/user8314628"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 81, "favorite_count": 0, "accepted_answer_id": 51053697, "answer_count": 1, "score": 0, "last_activity_date": 1530066358, "creation_date": 1530065898, "question_id": 51053628, "link": "https://stackoverflow.com/questions/51053628/haskell-could-not-find-user-defined-module", "title": "Haskell could not find user defined module", "body": "<p>I put the files <em>Lab07</em> and <em>Lab07def</em> in the same path. But when I tried to load Lab07 in ghci, it returns <code>Could not find module \u2018Lab07def\u2019</code></p>\n\n<pre><code>Prelude&gt; :l K:\\lab7\\Lab07def.hs\n[1 of 1] Compiling Lab07def         ( K:\\lab7\\Lab07def.hs, interpreted )\nOk, one module loaded.\nPrelude&gt; :l K:\\lab7\\Lab07.hs\n[1 of 1] Compiling Lab07            ( K:\\lab7\\Lab07.hs, interpreted )\n\nK:\\lab7\\Lab07.hs:9:1: error:\n    Could not find module \u2018Lab07def\u2019\n    Use -v to see a list of the files searched for.\n  |\n9 | import Lab07def\n  | ^^^^^^^^^^^^^^^\nFailed, no modules loaded.\n</code></pre>\n\n<p>This is the first line in <em>Lab07def</em></p>\n\n<pre><code>module Lab07def where\n</code></pre>\n\n<p>These are the first two lines in <em>Lab07</em></p>\n\n<pre><code>module Lab07 where\n\nimport Lab07def\n</code></pre>\n\n<p>They both look good. So what's the problem? Thank you!</p>\n"}, {"tags": ["haskell", "type-systems", "type-families", "type-level-computation"], "comments": [{"owner": {"reputation": 24509, "user_id": 6863749, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/UyoQv.jpg?s=128&g=1", "display_name": "Li-yao Xia", "link": "https://stackoverflow.com/users/6863749/li-yao-xia"}, "edited": false, "score": 0, "creation_date": 1530061774, "post_id": 51053098, "comment_id": 89097483, "body": "Side question: the isomorphism laws seem to only allow you to pull one element to the head of the row, but does not represent arbitrary permutations. In particular, isomorphism is not transitive, or am I missing something?"}, {"owner": {"reputation": 48938, "user_id": 246886, "user_type": "registered", "accept_rate": 94, "profile_image": "https://www.gravatar.com/avatar/dd1ebaade6623fc538fb8af3338e730d?s=128&d=identicon&r=PG", "display_name": "Jon Purdy", "link": "https://stackoverflow.com/users/246886/jon-purdy"}, "reply_to_user": {"reputation": 24509, "user_id": 6863749, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/UyoQv.jpg?s=128&g=1", "display_name": "Li-yao Xia", "link": "https://stackoverflow.com/users/6863749/li-yao-xia"}, "edited": false, "score": 0, "creation_date": 1530063014, "post_id": 51053098, "comment_id": 89097688, "body": "@Li-yaoXia: They\u2019re not arbitrary permutations, but the intent is that you can pull an element to the head of a row <i>provided</i> it doesn\u2019t cross an element with the same label. That\u2019s meant to implement the \u201cscoping\u201d of labels: <code>{x=1, x=&quot;foo&quot;}</code> matches <code>{x:Int | {x:String | s}}</code> but not <code>{x:String | {x:Int | s}}</code> because <code>{x=1, x=&quot;foo&quot;}.x : Int</code>\u2014it selects the <i>first</i> <code>x</code>; swapping would change the type. In the paper they say these unification rules implement these equality rules: <code>[eq-head]</code> = <code>(r \u2245 s) \u21d2 { l | r } \u2245 { l | s }</code>, <code>[eq-swap]</code> = <code>l \u2260 l\u2032 \u21d2 { l | { l\u2032 | r } } \u2245 { l\u2032 | { l | r } }</code>."}, {"owner": {"reputation": 48938, "user_id": 246886, "user_type": "registered", "accept_rate": 94, "profile_image": "https://www.gravatar.com/avatar/dd1ebaade6623fc538fb8af3338e730d?s=128&d=identicon&r=PG", "display_name": "Jon Purdy", "link": "https://stackoverflow.com/users/246886/jon-purdy"}, "reply_to_user": {"reputation": 24509, "user_id": 6863749, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/UyoQv.jpg?s=128&g=1", "display_name": "Li-yao Xia", "link": "https://stackoverflow.com/users/6863749/li-yao-xia"}, "edited": false, "score": 0, "creation_date": 1530084419, "post_id": 51053098, "comment_id": 89104134, "body": "I tried translating it more literally by splitting it into a <code>type family RowEqual (a :: [*]) (b :: [*]) :: Bool</code> which invokes a <code>type family RowIso (l :: *) (s :: [*]) (rt :: [*]) :: [*]</code> but it proved unfruitful for the same reason: I don\u2019t know what to do about <code>[row-var]</code>."}], "answers": [{"comments": [{"owner": {"reputation": 48938, "user_id": 246886, "user_type": "registered", "accept_rate": 94, "profile_image": "https://www.gravatar.com/avatar/dd1ebaade6623fc538fb8af3338e730d?s=128&d=identicon&r=PG", "display_name": "Jon Purdy", "link": "https://stackoverflow.com/users/246886/jon-purdy"}, "edited": false, "score": 0, "creation_date": 1530234667, "post_id": 51053371, "comment_id": 89174152, "body": "So, more generally, is there no way to write a verified typechecker (a function of type <code>UntypedTerm -&gt; Either TypeError SomeTypedTerm</code> given the existential <code>data SomeTypedTerm = forall t. TypedTerm t `As` TypedType t</code>) that can infer polymorphic types? All the examples I\u2019ve seen are either strictly monomorphic type <i>checking</i> (like Lennart\u2019s blog post that I linked in the question), or include <i>inference</i> but require the language to be embedded in Haskell (e.g., Oleg\u2019s \u201cTyped Tagless Final Interpreters\u201d). If that\u2019s not possible then this question is moot."}], "tags": [], "owner": {"reputation": 24509, "user_id": 6863749, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/UyoQv.jpg?s=128&g=1", "display_name": "Li-yao Xia", "link": "https://stackoverflow.com/users/6863749/li-yao-xia"}, "is_accepted": false, "score": 1, "last_activity_date": 1530063330, "creation_date": 1530063330, "answer_id": 51053371, "question_id": 51053098, "link": "https://stackoverflow.com/questions/51053098/row-polymorphic-equality-of-type-level-lists/51053371#51053371", "title": "Row polymorphic equality of type-level lists", "body": "<blockquote>\n  <p>Is it possible to introduce a fresh variable with forall or something</p>\n</blockquote>\n\n<p>Unfortunately not. That way lies impredicativity and there is no good story for it in Haskell.</p>\n\n<p>Computation via type families will get stuck as soon as it inspects a variable. You will have to encode (row) variables of your guest language as concrete types to do anything with them.</p>\n"}], "owner": {"reputation": 48938, "user_id": 246886, "user_type": "registered", "accept_rate": 94, "profile_image": "https://www.gravatar.com/avatar/dd1ebaade6623fc538fb8af3338e730d?s=128&d=identicon&r=PG", "display_name": "Jon Purdy", "link": "https://stackoverflow.com/users/246886/jon-purdy"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 150, "favorite_count": 0, "answer_count": 1, "score": 6, "last_activity_date": 1530092697, "creation_date": 1530060522, "last_edit_date": 1530092697, "question_id": 51053098, "link": "https://stackoverflow.com/questions/51053098/row-polymorphic-equality-of-type-level-lists", "title": "Row polymorphic equality of type-level lists", "body": "<p><strong>TL;DR:</strong> I want to implement unification for row polymorphism, using a <code>type family RIso (a :: [*]) (b :: [*]) :: Bool</code>, but have gotten stuck.</p>\n\n<hr>\n\n<h2>Background</h2>\n\n<p>I\u2019m writing a compiler for a language that has an effect system which uses row polymorphism, as in <a href=\"https://www.microsoft.com/en-us/research/publication/extensible-records-with-scoped-labels/\" rel=\"nofollow noreferrer\">Extensible Records with Scoped Labels</a>, to represent sets of effects attached to function types. That is, in this language, the kind of the function arrow is:</p>\n\n<pre><code>(-&gt;) :: * -&gt; * -&gt; Effect -&gt; *\n</code></pre>\n\n<p>Where <code>Effect</code> is a sequence of effect labels such as <code>IO</code> or <code>Unsafe</code>\u2014either a \u201ccons\u201d of a label with another effect row, an effect type variable, or the \u201cpure\u201d effect (an empty row). A simple example is the type of <code>map</code>:</p>\n\n<pre><code>&lt;A, B, +E&gt; (List&lt;A&gt;, (A -&gt; B +E) -&gt; List&lt;B&gt; +E)\n</code></pre>\n\n<p>In hypothetical Haskell syntax:</p>\n\n<pre><code>forall (a :: *) (b :: *) (e :: Effect).\n  (a -&gt; Eff e b) -&gt; [a] -&gt; Eff e [b]\n</code></pre>\n\n<p>This means <code>map</code> takes a <code>List</code> of values of type <code>A</code>, and a function from <code>A</code> to <code>B</code> with a set of effects <code>+E</code>, and returns a <code>List</code> of <code>B</code>s, also requiring the effects <code>+E</code>. A pure function is fully polymorphic in its effect, which is defaulted to an empty row; so <code>map</code> is pure if its functional argument is pure; otherwise it requires the same effects as its argument.</p>\n\n<p>I\u2019m experimenting with representing the type system of this language within Haskell\u2019s type system, so that I can lean on Haskell\u2019s typechecker to write a verified typechecker in the manner of <a href=\"http://augustss.blogspot.com/2009/06/more-llvm-recently-someone-asked-me-on.html\" rel=\"nofollow noreferrer\">this blog post</a>.</p>\n\n<p>However, when I get to unifying function types, I need to unify the inputs and outputs by regular unification (equality), but I need to unify the effects by <em>row unification</em>, which is defined like so:</p>\n\n<pre><code>s \u2243 { l | s\u2032 } : \u03b8\u2081\ntail(r) \u2209 dom(\u03b8\u2081)    -- \u2020\n\u03b8\u2081(r) ~ \u03b8\u2081(s\u2032) : \u03b8\u2082\n---------------------------------------- [uni-row]\n{ l | r } ~ s : \u03b8\u2082 \u2218 \u03b8\u2081\n</code></pre>\n\n<p>This says \u201cif <code>s</code> can be rewritten into <code>{ l | s\u2032 }</code> under substitution <code>\u03b8\u2081</code>, and <code>r</code> and <code>s\u2032</code> unify under substitution <code>\u03b8\u2082</code>, then <code>{ l | r }</code> unifies with <code>s</code> under substitution <code>\u03b8\u2082 \u2218 \u03b8\u2081</code>, plus a side condition marked with a dagger (\u2020) that I\u2019ll explain momentarily.</p>\n\n<p>The (\u2243) relation means that two rows are <em>isomorphic</em> according to the following three rules:</p>\n\n<pre><code>-------------------------- [row-head]\n{ l | r } \u2243 { l | r } : []\n\nl \u2260 l\u2032\nr \u2243 { l | r\u2032 } : \u03b8\n-------------------------------- [row-swap]\n{ l\u2032 | r } \u2243 { l | l\u2032 | r\u2032 } : \u03b8\n\nfresh(\u03b2)\n----------------------------- [row-var]\n\u03b1 \u2243 { l | \u03b2 } : [\u03b1 \u21a6 {l | \u03b2}]\n</code></pre>\n\n<p>In my current <em>unverified</em> typechecker, these two functions look like this in Haskell:</p>\n\n<pre><code>unify typeEnv0 (Row l r) s = do\n\n  -- Attempt to rewrite.\n  maybeSubstitution &lt;- isomorphicRows typeEnv0 l s (rowLast r)\n  case maybeSubstitution of\n\n    -- If rows are isomorphic:\n    Just (s', substitution, typeEnv1) -&gt; case substitution of\n\n      -- Apply substitution, if any, and unify the tails.\n      Just (x, t) -&gt; let\n        typeEnv2 = typeEnv1\n          { typeEnvVars = Map.insert x t $ typeEnvVars typeEnv1 }\n        in unify typeEnv2 r s'\n      Nothing -&gt; unify typeEnv1 r s'\n\n    -- Non-isomorphic rows do not unify.\n    Nothing -&gt; reportTypeMismatch (Row l r) s\n\n-- Gets the last element in a row.\nrowLast :: Type -&gt; Type\nrowLast (Row _ r) = rowLast r\nrowLast t = t\n</code></pre>\n\n<p><code>isomorphicRows</code> implements the rule described in the paper:</p>\n\n<blockquote>\n  <p>When a row <code>{ l | r }</code> is unified with some row <code>s</code>, we first try to rewrite <code>s</code> in the form <code>{ l | s\u2032 }</code> [\u2026] If this succeeds, the unification proceeds by unifying\u2026the tail of the rows.</p>\n</blockquote>\n\n<p>So given <code>l</code>, <code>r</code>, and <code>s</code>, along with the unification rule, <code>isomorphicRows</code> is used to assert that <code>s</code> can be rewritten into <code>{ l | r }</code> under some substitution, failing (<code>Nothing</code>) or returning (<code>Just</code>) the tail of the rewritten row, the substitution (<code>Maybe</code> because it\u2019s always empty or a singleton), and the updated type environment. We don\u2019t actually pass <code>r</code> because we only need its last element <code>rt</code>.</p>\n\n<pre><code>isomorphicRows\n  :: TypeEnv    -- Type environment\n  -&gt; Type       -- Effect label l\n  -&gt; Type       -- Effect row s\n  -&gt; Type       -- Effect row rt\n  -&gt; Typecheck\n    (Maybe\n      ( Type\n      , Maybe (TypeId, Type)\n      , TypeEnv\n      ))\n</code></pre>\n\n<p>The <code>[row-head]</code> rule: a row which already begins with the given label is trivially rewritten by the identity substitution.</p>\n\n<pre><code>isomorphicRows typeEnv0 l (Row l' r') _rt\n  | l == l'\n  = pure $ Just (r', Nothing, typeEnv0)\n</code></pre>\n\n<p>The <code>[row-swap]</code> rule: a row that contains a label somewhere within it can be rewritten to place that label at the head.</p>\n\n<pre><code>isomorphicRows typeEnv0 l (Row l' r') rt\n  | l /= l' = do\n  maybeSubstitution &lt;- isomorphicRows typeEnv0 l r' rt\n  pure $ case maybeSubstitution of\n    Just (r'', substitution, typeEnv1) -&gt; Just\n      (Row l r'', substitution, typeEnv1)\n    Nothing -&gt; Nothing\n</code></pre>\n\n<p>The <code>[row-var]</code> rule: when unifying with a type variable, no label is present, so we can\u2019t directly test for equality, and must return a fresh variable for the row tail.</p>\n\n<blockquote>\n  <p>\u2020 This enforces the side condition that prevents unifying rows with a common tail but distinct prefixes, thereby ensuring termination even though we\u2019re adding fresh type variables.</p>\n</blockquote>\n\n<pre><code>isomorphicRows typeEnv0 l r@(TypeVar a) rt\n  | r /= rt = do\n  (b, typeEnv1) &lt;- freshTypeVar typeEnv0\n  pure $ Just (b, Just (a, Row l b), typeEnv1)\n</code></pre>\n\n<p>In any other case, the rows are not isomorphic.</p>\n\n<pre><code>isomorphicRows _ _ _ _ = Nothing\n</code></pre>\n\n<hr>\n\n<h2>What I\u2019ve Tried</h2>\n\n<p>I\u2019m attempting to translate row unification with <code>isomorphicRows</code> to the type level, using a type family operating on type-level lists of types:</p>\n\n<pre><code>type family RIso (ra :: [*]) (rb :: [*]) :: Bool where\n\n  -- [row-head]\n  RIso ((l) ': r) ((l) ': s) = RIso r s\n\n  -- [row-swap]\n  RIso ((l) ': (l') ': r) ((l') ': (l) ': r)\n    = TNot (TEq l l')\n\n  RIso r r = 'True\n\n  RIso _ _ = 'False\n\ntype family TNot (a :: Bool) :: Bool where\n  TNot 'False = 'True\n  TNot 'True = 'False\n\ntype family TEq (a :: Bool) (b :: Bool) :: Bool where\n  TEq a a = 'True\n  TEq _ _ = 'False\n</code></pre>\n\n<p>That seems to work for basic cases:</p>\n\n<pre><code>&gt; :kind! RIso '[] '[]\n'True\n\n&gt; :kind! RIso '[Int] '[Int]\n'True\n\n&gt; :kind! RIso '[Int, Char] '[Char, Int]\n'True\n\n&gt; :kind! RIso '[Int, Char] '[Int, String]\n'False\n\n&gt; :kind! RIso '[Int, Char, String] '[Char, Int, String]\n'True\n</code></pre>\n\n<p>But fails on more complex cases:</p>\n\n<pre><code>&gt; :kind! RIso '[Int, String, Char] '[Char, Int, String]\n'False\n</code></pre>\n\n<p>I believe it\u2019s because I may have implemented the <code>[row-swap]</code> rule incorrectly (the <code>TNot</code> seems suspicious), and I\u2019m missing the <code>[row-var]</code> rule. I\u2019m stuck on the implementation of <code>[row-var]</code> because I don\u2019t know how to bring a fresh type variable into scope (or whether that\u2019s even the right approach). I tried this:</p>\n\n<pre><code>type family REq (ra :: [*]) (rb :: [*]) :: Bool where\n  \u2026\n  -- [row-var]\n  REq (l ': r) rt = TAnd (TNot (TEq r rt)) (TEq r (Row l b))\n  \u2026\n\ntype family TAnd (a :: Bool) (b :: Bool) :: Bool where\n  TAnd 'True 'True = 'True\n  TAnd _ _ = 'False\n</code></pre>\n\n<p>But I wasn\u2019t surprised to see that the free <code>b</code> generates a type error:</p>\n\n<pre><code>error: Not in scope: type variable \u2018b\u2019\n</code></pre>\n\n<hr>\n\n<h2>Question</h2>\n\n<ul>\n<li><p>Is it possible to introduce a fresh variable with <code>forall</code> or something, or should I give up on trying to implement the typing rules directly and take a different approach?</p></li>\n<li><p>Alternatively, is there some existing extensible-record library that specifically uses row unification (not some other method) so I can use the library or learn the technique from it?</p></li>\n</ul>\n\n<p>Note that this is <em>not</em> the same as simple set equality, because there may be duplicate labels, and they are \u201cscoped\u201d in the sense described in the paper I linked at the top of this question. This is important for two reasons: first, I intend to extend this in the future so that an effect label may have type parameters, e.g., <code>ST s</code>; and second, I intend to use this machinery to implement extensible records and variants in the language.</p>\n"}, {"tags": ["haskell", "type-inference"], "answers": [{"comments": [{"owner": {"reputation": 1, "user_id": 9402218, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/8d5af6e58698c9db5b27429e15b640a1?s=128&d=identicon&r=PG&f=1", "display_name": "Quentin Preguntino", "link": "https://stackoverflow.com/users/9402218/quentin-preguntino"}, "edited": false, "score": 0, "creation_date": 1530060416, "post_id": 51052878, "comment_id": 89097222, "body": "Many thanks @DanRobertson Just one thing, which one was the criteria used to parse the expression that way?"}, {"owner": {"reputation": 4234, "user_id": 4942760, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/f322d06b4f3e34278f29a954e0f38cb1?s=128&d=identicon&r=PG&f=1", "display_name": "Dan Robertson", "link": "https://stackoverflow.com/users/4942760/dan-robertson"}, "reply_to_user": {"reputation": 1, "user_id": 9402218, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/8d5af6e58698c9db5b27429e15b640a1?s=128&d=identicon&r=PG&f=1", "display_name": "Quentin Preguntino", "link": "https://stackoverflow.com/users/9402218/quentin-preguntino"}, "edited": false, "score": 0, "creation_date": 1530060696, "post_id": 51052878, "comment_id": 89097286, "body": "Every operator has a defined precedence and associativity."}, {"owner": {"reputation": 75362, "user_id": 625403, "user_type": "registered", "accept_rate": 82, "profile_image": "https://www.gravatar.com/avatar/786eed7da67079cb5d63a49d469af25b?s=128&d=identicon&r=PG", "display_name": "amalloy", "link": "https://stackoverflow.com/users/625403/amalloy"}, "edited": false, "score": 0, "creation_date": 1530060823, "post_id": 51052878, "comment_id": 89097314, "body": "@DanRobertson Operator precedence and associativity both don&#39;t matter here, as there&#39;s only one operator, <code>.</code>. The rule at play is just &quot;function application binds more tightly than any operator&quot;."}], "tags": [], "owner": {"reputation": 4234, "user_id": 4942760, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/f322d06b4f3e34278f29a954e0f38cb1?s=128&d=identicon&r=PG&f=1", "display_name": "Dan Robertson", "link": "https://stackoverflow.com/users/4942760/dan-robertson"}, "is_accepted": true, "score": 1, "last_activity_date": 1530060709, "last_edit_date": 1530060709, "creation_date": 1530058165, "answer_id": 51052878, "question_id": 51052605, "link": "https://stackoverflow.com/questions/51052605/haskell-manual-type-inference-of-this-function/51052878#51052878", "title": "Haskell manual type inference of this function", "body": "<p>Step 1. parse:</p>\n\n<pre><code>f = (map (.)) . ((:) even)\n</code></pre>\n\n<p>Step 2. infer some types:</p>\n\n<pre><code>(.) :: (b -&gt; c) -&gt; (a -&gt; b) -&gt; (a -&gt; c)\nmap (.) :: [b -&gt; c] -&gt; [(a -&gt; b) -&gt; (a -&gt; c)]\n(:) :: d -&gt; [d] -&gt; [d]\n(:) even :: Integral e =&gt; [e -&gt; Bool] -&gt; [e -&gt; Bool]\n</code></pre>\n\n<p>Step 3. Derive some equations:</p>\n\n<pre><code>x = [e -&gt; Bool] -- the output of (:) even\nx = [b -&gt; c] -- the input to map (.)\ne = b\nc = Bool\n</code></pre>\n\n<p>Step 4. Write down the type of <code>f</code>:</p>\n\n<pre><code>f :: [(a -&gt; b) -&gt; (a -&gt; c)]\nf :: Integral e =&gt; [(a -&gt; e) -&gt; (a -&gt; Bool)]\n</code></pre>\n"}], "owner": {"reputation": 1, "user_id": 9402218, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/8d5af6e58698c9db5b27429e15b640a1?s=128&d=identicon&r=PG&f=1", "display_name": "Quentin Preguntino", "link": "https://stackoverflow.com/users/9402218/quentin-preguntino"}, "delete_vote_count": 1, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 106, "favorite_count": 0, "closed_date": 1530080493, "accepted_answer_id": 51052878, "answer_count": 1, "score": -6, "last_activity_date": 1573099055, "creation_date": 1530055388, "last_edit_date": 1573099055, "question_id": 51052605, "link": "https://stackoverflow.com/questions/51052605/haskell-manual-type-inference-of-this-function", "closed_reason": "Needs details or clarity", "title": "Haskell manual type inference of this function", "body": "<p>Can someone explain to me how to manually deduce the type of this function <code>f</code>?</p>\n\n<pre><code>f = map (.) . (:) even\n</code></pre>\n\n<p>I would like to know a step by step solution explaining the things related to precedence and stuff.</p>\n\n<p>Thanks in advance!</p>\n"}, {"tags": ["parsing", "haskell"], "answers": [{"tags": [], "owner": {"reputation": 759, "user_id": 3368561, "user_type": "registered", "accept_rate": 42, "profile_image": "https://www.gravatar.com/avatar/e982eee26ab62e30ac026a9479e6228d?s=128&d=identicon&r=PG&f=1", "display_name": "user3368561", "link": "https://stackoverflow.com/users/3368561/user3368561"}, "is_accepted": true, "score": 1, "last_activity_date": 1530054639, "last_edit_date": 1530054639, "creation_date": 1530053971, "answer_id": 51052424, "question_id": 51052230, "link": "https://stackoverflow.com/questions/51052230/recursive-descent-parser-for-calculus-of-constructions/51052424#51052424", "title": "Recursive descent parser for calculus of constructions", "body": "<p>The answer has been evident after a short break. Use exactly the same trick that we did on <code>&lt;appl&gt;</code> and extend it as follows:</p>\n\n<pre><code>&lt;expr&gt;\n    = \"(\" &lt;appl&gt; \")\"\n    | \"\u03bb\" \"(\" &lt;name&gt; \":\" &lt;appl&gt; \")\" \"\u2192\" &lt;appl&gt;\n    | \"\u2200\" \"(\" &lt;name&gt; \":\" &lt;appl&gt; \")\" \"\u2192\" &lt;appl&gt;\n    | &lt;name&gt;\n    | \"*\"\n\n&lt;appl&gt; = &lt;expr&gt;+ (\"\u2192\" &lt;appl&gt;)?\n\n&lt;name&gt; = [_A-Za-z][_0-9A-Za-z]*\n</code></pre>\n\n<p>I will leave the question open in case it helps somebody.</p>\n"}], "owner": {"reputation": 759, "user_id": 3368561, "user_type": "registered", "accept_rate": 42, "profile_image": "https://www.gravatar.com/avatar/e982eee26ab62e30ac026a9479e6228d?s=128&d=identicon&r=PG&f=1", "display_name": "user3368561", "link": "https://stackoverflow.com/users/3368561/user3368561"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 84, "favorite_count": 2, "accepted_answer_id": 51052424, "answer_count": 1, "score": 1, "last_activity_date": 1530054653, "creation_date": 1530052541, "last_edit_date": 1530054653, "question_id": 51052230, "link": "https://stackoverflow.com/questions/51052230/recursive-descent-parser-for-calculus-of-constructions", "title": "Recursive descent parser for calculus of constructions", "body": "<p>I implemented a type-checker and reducer of calculus of constructions in Haskell with a simple monadic parser using <a href=\"http://hackage.haskell.org/package/megaparsec\" rel=\"nofollow noreferrer\">Megaparsec</a>. Now I want to improve it so it can recognize this syntactic shortcut:</p>\n\n<pre><code>\u2200(x:A)-&gt;B (with x not free in B)  =  A -&gt; B\n</code></pre>\n\n<p>The grammar for this syntax is as follows:</p>\n\n<pre><code>&lt;expr&gt;\n    = \"(\" &lt;expr&gt; \")\"\n    | &lt;expr&gt; &lt;expr&gt;\n    | \"\u03bb\" \"(\" &lt;name&gt; \":\" &lt;expr&gt; \")\" \"\u2192\" &lt;expr&gt;\n    | \"\u2200\" \"(\" &lt;name&gt; \":\" &lt;expr&gt; \")\" \"\u2192\" &lt;expr&gt;\n    | &lt;expr&gt; \"\u2192\" &lt;expr&gt;\n    | &lt;name&gt;\n    | \"*\"\n\n&lt;name&gt; = [_A-Za-z][_0-9A-Za-z]*\n</code></pre>\n\n<p>My current parser uses this variation with left recursion eliminated (without the shortcut):</p>\n\n<pre><code>&lt;expr&gt;\n    = \"(\" &lt;appl&gt; \")\"\n    | \"\u03bb\" \"(\" &lt;name&gt; \":\" &lt;appl&gt; \")\" \"\u2192\" &lt;appl&gt;\n    | \"\u2200\" \"(\" &lt;name&gt; \":\" &lt;appl&gt; \")\" \"\u2192\" &lt;appl&gt;\n    | &lt;name&gt;\n    | \"*\"\n\n&lt;appl&gt; = &lt;expr&gt;+\n\n&lt;name&gt; = [_A-Za-z][_0-9A-Za-z]*\n</code></pre>\n\n<p>The previously mentioned shortcut is left-recursive. I have no idea how to convert it to a right-recursive grammar so it can be handled by a conventional recursive descent parser.</p>\n\n<p>I know there exist more powerful parsing techniques that can handle left-recursive grammars, but I want to keep it right-recursive to left open the possibility of implementing a parser by hand in the near future.</p>\n"}, {"tags": ["haskell", "functional-programming", "category-theory", "recursion-schemes", "catamorphism"], "comments": [{"owner": {"reputation": 1030, "user_id": 521806, "user_type": "registered", "accept_rate": 80, "profile_image": "https://i.stack.imgur.com/PaOw7.jpg?s=128&g=1", "display_name": "Juan Pablo Santos", "link": "https://stackoverflow.com/users/521806/juan-pablo-santos"}, "edited": false, "score": 0, "creation_date": 1530039821, "post_id": 51049314, "comment_id": 89090655, "body": "In order to use <code>cata</code> for this, you need to write an algebra from the pattern functor of <code>Cofree</code> (that is, <code>CofreeF</code>) to <code>Fix ExprF</code>. Looks like <code>tailF</code> would be helpful for this:  <a href=\"https://hackage.haskell.org/package/free-4.12.4/docs/src/Control-Comonad-Trans-Cofree.html#tailF\" rel=\"nofollow noreferrer\">hackage.haskell.org/package/free-4.12.4/docs/src/&hellip;</a>  If nobody else responds before, I&#39;ll answer with more details soon."}], "answers": [{"comments": [{"owner": {"reputation": 117, "user_id": 9644760, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/9cFg0.png?s=128&g=1", "display_name": "xal", "link": "https://stackoverflow.com/users/9644760/xal"}, "edited": false, "score": 1, "creation_date": 1530043344, "post_id": 51050171, "comment_id": 89092128, "body": "I knew I&#39;d gotten something wrong with the <code>Cofree</code> vs. <code>CofreeF</code> situation!  All I needed to do was change the pattern match on <code>:&lt;</code> to a pattern match on <code>:&lt;</code> from the <code>Control.Comonad.Trans.Cofree</code> module.  Thank you!"}, {"owner": {"reputation": 24509, "user_id": 6863749, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/UyoQv.jpg?s=128&g=1", "display_name": "Li-yao Xia", "link": "https://stackoverflow.com/users/6863749/li-yao-xia"}, "reply_to_user": {"reputation": 117, "user_id": 9644760, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/9cFg0.png?s=128&g=1", "display_name": "xal", "link": "https://stackoverflow.com/users/9644760/xal"}, "edited": false, "score": 0, "creation_date": 1530045879, "post_id": 51050171, "comment_id": 89093171, "body": "Indeed, you were very close!"}], "tags": [], "owner": {"reputation": 24509, "user_id": 6863749, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/UyoQv.jpg?s=128&g=1", "display_name": "Li-yao Xia", "link": "https://stackoverflow.com/users/6863749/li-yao-xia"}, "is_accepted": true, "score": 6, "last_activity_date": 1598478144, "last_edit_date": 1598478144, "creation_date": 1530041408, "answer_id": 51050171, "question_id": 51049314, "link": "https://stackoverflow.com/questions/51049314/forgetting-cofree-annotations-using-a-catamorphism/51050171#51050171", "title": "Forgetting Cofree annotations using a catamorphism", "body": "<pre><code>forget :: Functor f =&gt; Cofree f a -&gt; Fix f\nforget = cata (\\(_ :&lt; z) -&gt; Fix z)\n-- (Control.Comonad.Trans.Cofree.:&lt;)\n-- not to be confused with\n-- (Control.Comonad.Cofree.:&lt;)\n</code></pre>\n<h3>Explanation</h3>\n<p>Looking only at the types, we can show that there is really only one way to implement <code>forget</code>. Let's start with the type of <code>cata</code>:</p>\n<pre><code>cata :: Recursive t =&gt; (Base t b -&gt; b) -&gt; t -&gt; b\n</code></pre>\n<p>Here <code>t ~ Cofree f a</code> and the <a href=\"https://hackage.haskell.org/package/recursion-schemes-5.0.2/docs/src/Data-Functor-Foldable.html#line-347\" rel=\"nofollow noreferrer\">type instance of <code>Base</code> for <code>Cofree</code></a> gives:</p>\n<pre><code>type instance Base (Cofree f a) = CofreeF f a\n</code></pre>\n<p>Where <a href=\"https://hackage.haskell.org/package/free-4.12.4/docs/Control-Comonad-Trans-Cofree.html#t:CofreeF\" rel=\"nofollow noreferrer\"><code>CofreeF</code></a> is:</p>\n<pre><code>data CoFreeF f a b = a :&lt; f b\n-- N.B.: CoFree also defines a (:&lt;) constructor so you have to be\n-- careful with imports.\n</code></pre>\n<p>i.e., a fancy pair type. Let's replace it with an actual pair type to make things clearer:</p>\n<pre><code>cata :: Functor f =&gt; ((a, f b) -&gt; b) -&gt; Cofree f a -&gt; b\n</code></pre>\n<p>Now we're really specializing <code>cata</code> with a more concrete <code>b</code>, namely <code>Fix f</code>:</p>\n<pre><code>-- expected type of `cata` in `forget`\ncata :: Functor f =&gt; ((a, f (Fix f)) -&gt; Fix f) -&gt; Cofree f a -&gt; Fix f\n</code></pre>\n<p><code>forget</code> is parametric in <code>a</code> and <code>f</code>, so the function we give <code>cata</code> can do nothing with the <code>a</code> in the pair, and the only sensible way to implement the remaining <code>f (Fix f) -&gt; Fix f</code> is the <code>Fix</code> wrapper.</p>\n<p>Operationally, <code>Fix</code> is the identity, so <code>(\\(_ :&lt; z) -&gt; Fix z)</code> is really <code>(\\(_ :&lt; z) -&gt; z)</code> which corresponds to the intuition of removing the annotation, i.e., the first component of the pair <code>(_ :&lt; z)</code>.</p>\n"}], "owner": {"reputation": 117, "user_id": 9644760, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/9cFg0.png?s=128&g=1", "display_name": "xal", "link": "https://stackoverflow.com/users/9644760/xal"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 251, "favorite_count": 1, "accepted_answer_id": 51050171, "answer_count": 1, "score": 3, "last_activity_date": 1598478144, "creation_date": 1530037436, "last_edit_date": 1530054090, "question_id": 51049314, "link": "https://stackoverflow.com/questions/51049314/forgetting-cofree-annotations-using-a-catamorphism", "title": "Forgetting Cofree annotations using a catamorphism", "body": "<p>I have an AST that I'm annotating using <code>Cofree</code>:</p>\n\n<pre><code>data ExprF a\n  = Const Int\n  | Add a\n        a\n  | Mul a\n        a\n  deriving (Show, Eq, Functor)\n</code></pre>\n\n<p>I use <code>type Expr = Fix ExprF</code> to represent untagged ASTs, and <code>type AnnExpr a = Cofree ExprF a</code> to represent tagged ones.  I've figured out a function to transform tagged ASTs into untagged ones by throwing away all the annotations:</p>\n\n<pre><code>forget :: Functor f =&gt; Cofree f a -&gt; Fix f\nforget = Fix . fmap uncofree . unwrap\n</code></pre>\n\n<p>This looks like it might be some sort of catamorphism (I'm using the definition from Kmett's <a href=\"http://hackage.haskell.org/package/recursion-schemes-5.0.2/docs/Data-Functor-Foldable.html#v:cata\" rel=\"nofollow noreferrer\">recursion-schemes</a> package).</p>\n\n<pre><code>cata :: (Base t a -&gt; a) -&gt; t -&gt; a\ncata f = c where c = f . fmap c . project\n</code></pre>\n\n<p>I'd think the above rewritten using a catamorphism would look something like this, but I can't figure out what to put for <code>alg</code> to make it typecheck.</p>\n\n<pre><code>forget :: Functor f =&gt; Cofree f a -&gt; Fix f\nforget = cata alg where\n  alg = ???\n</code></pre>\n\n<p>Any help figuring out if this really is a cata/anamorphism, and some intuition for why it is/isn't would be greatly appreciated.</p>\n"}, {"tags": ["swift", "haskell", "functional-programming", "monads"], "comments": [{"owner": {"reputation": 384463, "user_id": 1126841, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/fa05233b2357f8d11c22ef4cfc7bb85c?s=128&d=identicon&r=PG", "display_name": "chepner", "link": "https://stackoverflow.com/users/1126841/chepner"}, "edited": false, "score": 5, "creation_date": 1530022749, "post_id": 51044581, "comment_id": 89081405, "body": "Monads are built around type <i>constructors</i>, not types. In Haskell, for example, <code>[Int]</code> is not a monad, but <code>[]</code> is, since you can define <code>return :: a -&gt; [a]</code> and <code>(&gt;&gt;=) :: [a] -&gt; (a -&gt; [b]) -&gt; [b]</code>. So strictly speaking, <code>Result</code> is probably not a monad."}, {"owner": {"reputation": 384463, "user_id": 1126841, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/fa05233b2357f8d11c22ef4cfc7bb85c?s=128&d=identicon&r=PG", "display_name": "chepner", "link": "https://stackoverflow.com/users/1126841/chepner"}, "edited": false, "score": 1, "creation_date": 1530028059, "post_id": 51044581, "comment_id": 89084815, "body": "What does <code>Result</code> implement other than a boolean result of applying a rule? Note that your <code>fullHouse</code> rule doesn&#39;t indicate how it would handle the requirement that the three-of-a-kind and the pair cannot overlap."}, {"owner": {"reputation": 543, "user_id": 558299, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/b1ee04f165c178fb42b2ad7327d1990a?s=128&d=identicon&r=PG", "display_name": "Sergio", "link": "https://stackoverflow.com/users/558299/sergio"}, "reply_to_user": {"reputation": 384463, "user_id": 1126841, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/fa05233b2357f8d11c22ef4cfc7bb85c?s=128&d=identicon&r=PG", "display_name": "chepner", "link": "https://stackoverflow.com/users/1126841/chepner"}, "edited": false, "score": 0, "creation_date": 1530028455, "post_id": 51044581, "comment_id": 89085069, "body": "Thanks! It keeps two extra information: a subset of cards not yet evaluated (ex: the two remaining cards of the three-of-a-kind rule, hat could or could not be a pair) and the ranks found (ex: a three-of-a-kind, a higher card and another higher card that could be used to compare hands). There is also a boolean to chain the rules..."}, {"owner": {"reputation": 384463, "user_id": 1126841, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/fa05233b2357f8d11c22ef4cfc7bb85c?s=128&d=identicon&r=PG", "display_name": "chepner", "link": "https://stackoverflow.com/users/1126841/chepner"}, "edited": false, "score": 0, "creation_date": 1530030278, "post_id": 51044581, "comment_id": 89086118, "body": "OK, then I imagine something like <code>type Result v = State HandInfo v</code> and <code>andThen :: Rule -&gt; Bool -&gt; ResultBool</code>, so that  <code>fullHouse h = threeOfAKind h &gt;&gt;= andThen pair</code> and <code>evaluate h = royalFlush &gt;&gt;= otherwise straightFlush &gt;&gt;= ... &gt;&gt;= otherwise pair &gt;&gt;= otherwise highCard</code>. <code>andThen</code>, <code>otherWise</code>, et al. aren&#39;t binding functions so much as factories to create functions to bind with <code>&gt;&gt;=</code>."}, {"owner": {"reputation": 543, "user_id": 558299, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/b1ee04f165c178fb42b2ad7327d1990a?s=128&d=identicon&r=PG", "display_name": "Sergio", "link": "https://stackoverflow.com/users/558299/sergio"}, "reply_to_user": {"reputation": 384463, "user_id": 1126841, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/fa05233b2357f8d11c22ef4cfc7bb85c?s=128&d=identicon&r=PG", "display_name": "chepner", "link": "https://stackoverflow.com/users/1126841/chepner"}, "edited": false, "score": 0, "creation_date": 1530031494, "post_id": 51044581, "comment_id": 89086716, "body": "I think I dind&#39;t get this last one , chepner..."}, {"owner": {"reputation": 384463, "user_id": 1126841, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/fa05233b2357f8d11c22ef4cfc7bb85c?s=128&d=identicon&r=PG", "display_name": "chepner", "link": "https://stackoverflow.com/users/1126841/chepner"}, "edited": false, "score": 0, "creation_date": 1530033076, "post_id": 51044581, "comment_id": 89087560, "body": "It&#39;s a too-terse example of how you might adapt <code>Result</code> from a type to a type constructor in Haskell, and how it might subsequently be used as a monad. I don&#39;t know enough Swift to suggest anything comparable in that language."}], "answers": [{"tags": [], "owner": {"reputation": 1731, "user_id": 780350, "user_type": "registered", "accept_rate": 86, "profile_image": "https://www.gravatar.com/avatar/afaa8b1a1e2fe1b53755564e5fa34568?s=128&d=identicon&r=PG", "display_name": "melston", "link": "https://stackoverflow.com/users/780350/melston"}, "is_accepted": false, "score": 0, "last_activity_date": 1530136978, "creation_date": 1530136978, "answer_id": 51072053, "question_id": 51044581, "link": "https://stackoverflow.com/questions/51044581/is-it-an-example-of-a-monad-if-not-why/51072053#51072053", "title": "Is it an example of a Monad? If not, why?", "body": "<p>Monads have to obey the three Monad Laws:</p>\n\n<ul>\n<li>Left identity:  <code>return a &gt;&gt;= f \u2261 f a</code></li>\n<li>Right identity: <code>m &gt;&gt;= return \u2261 m</code></li>\n<li>Associativity:  <code>(m &gt;&gt;= f) &gt;&gt;= g \u2261 m &gt;&gt;= (\\x -&gt; f x &gt;&gt;= g)</code></li>\n</ul>\n\n<p>This also implies the implementation of <code>return</code> (or equivalent) and <code>&gt;&gt;=</code> (variously called bind, flatmap, etc.) for your monad..  Haskell (and other languages) also adds the map function (<code>&gt;&gt;</code>) even though it can be implemented in terms of <code>&gt;&gt;=</code>.</p>\n\n<p>In addition, as @chepner points out, monads are abstractions that are not concrete types in themselves.  They are generic and can only be instantiated via a type constructor.  <code>List</code> is a monad but you cannot instantiate a <code>List</code>.  You can, however, instantiate a <code>List[Int]</code>.</p>\n\n<p>If you want to get a good conceptual picture of what makes a monad a monad, take a look at Brian Beckman's video <a href=\"https://www.youtube.com/watch?v=ZhuHCtR3xq8&amp;feature=kp\" rel=\"nofollow noreferrer\">Don't Fear the Monad</a>.  Also, there is a good series of blog posts, <a href=\"http://james-iry.blogspot.com/2007/09/monads-are-elephants-part-1.html\" rel=\"nofollow noreferrer\">Monads are Elephants</a>.</p>\n"}], "owner": {"reputation": 543, "user_id": 558299, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/b1ee04f165c178fb42b2ad7327d1990a?s=128&d=identicon&r=PG", "display_name": "Sergio", "link": "https://stackoverflow.com/users/558299/sergio"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 267, "favorite_count": 1, "answer_count": 1, "score": 2, "last_activity_date": 1530136978, "creation_date": 1530021136, "last_edit_date": 1530021480, "question_id": 51044581, "link": "https://stackoverflow.com/questions/51044581/is-it-an-example-of-a-monad-if-not-why", "title": "Is it an example of a Monad? If not, why?", "body": "<p>I am trying to study functional programming applied to Swift (a multi-paradigm language). One of the exercises I proposed to myself was trying to do a declarative Poker Hand evaluator.</p>\n\n<p>Here are some code excerpts and my question at the end:</p>\n\n<pre><code>typealias Rule = ([Card]) -&gt; Result\n</code></pre>\n\n<p>Where Result is a type that holds the current evaluation state (cards already evaluated on a rank, remaining cards, if the last rule evaluation was successful or not and the evaluated ranks). The input is an array (could be a set of) cards to be evaluated.</p>\n\n<p>I also created this function:</p>\n\n<pre><code>func id(_ hand:[Card]) -&gt; Result ...\n</code></pre>\n\n<p>That creates a mininum Result from a card set.</p>\n\n<p>Result also have a set of functions to chain rule evaluations (simplified here):</p>\n\n<pre><code>func apply(_ rule:Rule) -&gt; Result\nfunc andThen(_ rule:Rule) -&gt; Result\nfunc andAlso(_ rule:Rule) -&gt; Result\nfunc otherwise(_ rule:Rule) -&gt; Result\nfunc continueWith(_ rule:Rule) -&gt; Result\n</code></pre>\n\n<p>Whats allowed me to declare the poker rank rules as:</p>\n\n<pre><code>let fullHouse = { (hand) in\n   threeOfAKind(hand).andThen(pair)\n}\n</code></pre>\n\n<p>or</p>\n\n<pre><code>let royalStraightFlush = { (hand)  in\n  straightFlush(hand).andAlso(straightAceHigh)\n}\n</code></pre>\n\n<p>and chaining all rank rules as:</p>\n\n<pre><code>let evaluate = { (hand) in\n//id(hand)\n    royalStraightFlush(hand)\n    .otherwise(straightFlush)\n    .otherwise(fourOfAKind)\n    .otherwise(fullHouse)\n    .otherwise(flush)\n    .otherwise(straight)\n    .otherwise(threeOfAKind)\n    .otherwise(twoPair)\n    .otherwise(pair)\n    .continueWith(highCard) }\n</code></pre>\n\n<p><code>Result</code>, as it is:</p>\n\n<ul>\n<li>Encompasses a type ([Card]) into a broader context (R a)</li>\n<li>Has an id (result) function that put an object of type a into a minimum \"result\" context (a -> R a)</li>\n</ul>\n\n<p>But...</p>\n\n<ul>\n<li><p>It has not just one generic >>= bind function, but several specific ones, that takes R a -> (a -> R a) -> R a that could chain rules and get the card set to be evaluated from the previous partial result state.</p></li>\n<li><p>It is not (as it is implemented) generic enough to handle other types instead of Card or [Card]. In the other hand I think the same chaining logic could be used on other rule systems with some changes...</p></li>\n</ul>\n\n<p>My question is: is <code>Result</code> a monad? Otherwise, why it is not? My two concerns are those presented above. </p>\n\n<p>I think understanding these points (or knowing that are some other blind spots) on this concrete example will clarify a little bit the monad concept to me.</p>\n\n<p>Thanks!</p>\n"}, {"tags": ["haskell", "typeclass"], "comments": [{"owner": {"reputation": 27561, "user_id": 214446, "user_type": "registered", "accept_rate": 74, "profile_image": "https://www.gravatar.com/avatar/5deb6b87326686b1f2e9fdb37ceac210?s=128&d=identicon&r=PG", "display_name": "mb21", "link": "https://stackoverflow.com/users/214446/mb21"}, "edited": false, "score": 0, "creation_date": 1530019860, "post_id": 51044102, "comment_id": 89079328, "body": "if <code>func3</code> ends up calling <code>sum&#39;</code>, and <code>sum&#39;</code> expects an <code>Int</code>, <code>func3</code> will have to take an <code>Int</code> as well..."}, {"owner": {"reputation": 100185, "user_id": 3234959, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/93bb12ca0f93dfddb33880316f7e66c2?s=128&d=identicon&r=PG&f=1", "display_name": "chi", "link": "https://stackoverflow.com/users/3234959/chi"}, "edited": false, "score": 1, "creation_date": 1530020050, "post_id": 51044102, "comment_id": 89079463, "body": "<code>a</code> might be an <code>Int</code> but does not have to. Types won&#39;t prevent one to call <code>func3 (2.45 :: Dboule)</code> since the type of <code>func3</code> claims to be accepting all numeric types."}], "answers": [{"tags": [], "owner": {"reputation": 22377, "user_id": 2288659, "user_type": "registered", "accept_rate": 90, "profile_image": "https://i.stack.imgur.com/bBg8v.png?s=128&g=1", "display_name": "Silvio Mayolo", "link": "https://stackoverflow.com/users/2288659/silvio-mayolo"}, "is_accepted": true, "score": 4, "last_activity_date": 1530034767, "last_edit_date": 1530034767, "creation_date": 1530034458, "answer_id": 51048620, "question_id": 51044102, "link": "https://stackoverflow.com/questions/51044102/couldnt-match-expected-type-int-when-parametrizing-function-with-num-a/51048620#51048620", "title": "Couldn&#39;t match expected type \u2018Int\u2019 when parametrizing function with Num a", "body": "<p>I think your confusion arises from how universal quantifiers work.</p>\n\n<pre><code>x :: Num a =&gt; a\nx = 1000\n</code></pre>\n\n<p>This is a promise. It says \"For any numerical type <code>a</code> you can give me, I can give you a value <code>x</code> of that type\".</p>\n\n<pre><code>func3 :: Num a =&gt; a -&gt; String\nfunc3 p = ...\n</code></pre>\n\n<p>This is a different promise. It says \"For any numerical type <code>a</code> you can give me, I can give you a function which takes <code>a</code> and returns a <code>String</code>\". So <code>func3</code> must be able to act like a <code>Int -&gt; String</code> or a <code>Double -&gt; String</code> or any other numerical function, such as <code>Matrix -&gt; String</code> or <code>Vector -&gt; String</code>. So you can't assume the argument is an <code>Int</code>.</p>\n\n<h1>The Easy Fix</h1>\n\n<p><code>sum'</code> only uses <code>+</code>, so it should be able to take any numerical type as well. Simply change the arguments to <code>sum'</code> and your <code>func3</code> will start to work.</p>\n\n<pre><code>sum' :: Num a =&gt; a -&gt; a -&gt; a\nsum' x y = x + y\n</code></pre>\n\n<p>Using the analogy above, the type signature here makes a promise: \"If you give me any numerical type <code>a</code>, I can make a function which takes two <code>a</code>, adds them together, and returns an <code>a</code>\".</p>\n\n<p>This is <em>probably</em> the fix you want. 99% of the time, this is going to be the better solution. Alternatively, you could alter <code>func3</code> so that it only takes an <code>Int</code>, and then you'll have working (albeit less abstract) functions.</p>\n\n<p>Sometimes, if you think a function can have a more general type but aren't sure, you can comment out the type signature and ask GHCi what the inferred signature is. Example GHCi usage:</p>\n\n<pre><code>&gt; let sum' x y = x + y\n&gt; :t sum'\nsum' :: Num a =&gt; a -&gt; a -&gt; a\n</code></pre>\n\n<p>So the interpreter gave you the most general type for <code>sum'</code>, which you can then put into your code to make it more general and abstract.</p>\n\n<h1>The Long Answer</h1>\n\n<p>Let's take another look at your code.</p>\n\n<pre><code>y :: Num a =&gt; a\ny = 1000\n\nfunc3 :: Num a =&gt; a -&gt; String\nfunc3 p = show (1 + sum' p y)\n\nsum' :: Int -&gt; Int -&gt; Int\nsum' x y = x + y\n</code></pre>\n\n<p>Now, the signature <code>Num a =&gt; a -&gt; String</code> associates like so: <code>Num a =&gt; (a -&gt; String)</code>. Based on your comments, I believe you interpreted it as <code>(Num a =&gt; a) -&gt; String</code>, which would mean \"This function takes an argument which can be interpreted as any numerical type and returns a string\". Now, this isn't actually valid Haskell code. However, if you're using GHC (which you likely are), you can enable a compiler extension <code>Rank2Types</code> to get this behavior.</p>\n\n<pre><code>{-# LANGUAGE Rank2Types #-}\n\ny :: Num a =&gt; a\ny = 1000\n\nfunc3 :: (forall a. Num a =&gt; a) -&gt; String\nfunc3 p = show (1 + sum' p y)\n\nsum' :: Int -&gt; Int -&gt; Int\nsum' x y = x + y\n</code></pre>\n\n<p>The <code>forall</code> at the beginning of the argument's type essentially says \"Yes, I know that what I'm doing is not the usual Haskell interpretation, but do it anyway\". Now <code>func3</code> is actually promising: \"Give me an argument which can be interpreted as any numerical type <code>a</code> and I'll output a string\". So when <code>func3</code> calls <code>sum'</code>, it can simply interpret that argument as an <code>Int</code>, like you originally intended.</p>\n\n<p>This sort of code is non-idiomatic. <code>Rank2Types</code> (and its general form <code>RankNTypes</code>) is rarely needed in standard Haskell code. So unless you're doing something really fun with type theory, I suggest going with the short, easy approach. That being said, I wanted to include this just to show that the interpretation you were going for is actually possible, albeit with a compiler extension.</p>\n"}], "owner": {"reputation": 2966, "user_id": 3014199, "user_type": "registered", "accept_rate": 79, "profile_image": "https://www.gravatar.com/avatar/72332b0ac6ee78bc829c378c6c747e0e?s=128&d=identicon&r=PG", "display_name": "peer", "link": "https://stackoverflow.com/users/3014199/peer"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 61, "favorite_count": 0, "accepted_answer_id": 51048620, "answer_count": 1, "score": 2, "last_activity_date": 1530034767, "creation_date": 1530019687, "last_edit_date": 1530033416, "question_id": 51044102, "link": "https://stackoverflow.com/questions/51044102/couldnt-match-expected-type-int-when-parametrizing-function-with-num-a", "title": "Couldn&#39;t match expected type \u2018Int\u2019 when parametrizing function with Num a", "body": "<p>I have code like this </p>\n\n<pre><code>main :: IO ()\nmain = putStrLn (show func1)\n\nx,y :: Num a =&gt; a\nx = 1000\ny = 1000\n\nfunc1 :: String\nfunc1 = func3  ++ \"!\"\n\nfunc3 :: String\nfunc3 = show (1 + sum' x y)\n\nsum' :: Int -&gt; Int -&gt; Int\nsum' a b = a+b\n</code></pre>\n\n<p>and I want to make <code>x</code> a parameter. So I figured I'd rewrite it like this:</p>\n\n<pre><code>func1 :: String\nfunc1 = func3 x ++ \"!\"\n\nfunc3 :: Num a =&gt; a -&gt; String\nfunc3 p = show (1 + sum' p y)\n</code></pre>\n\n<p>I'd expect this to be fine since I'm not modifying any constraints, but I get</p>\n\n<pre><code>file:21:27: error:\n    \u2022 Couldn't match expected type \u2018Int\u2019 with actual type \u2018a\u2019\n      \u2018a\u2019 is a rigid type variable bound by\n        the type signature for:\n          func3 :: forall a. Num a =&gt; a -&gt; String\n        at file.hs:20:1-29\n    \u2022 In the first argument of \u2018sum'\u2019, namely \u2018p\u2019\n      In the second argument of \u2018(+)\u2019, namely \u2018sum' p y\u2019\n      In the first argument of \u2018show\u2019, namely\n        \u2018(1 + sum' p y)\u2019\n    \u2022 Relevant bindings include\n        p :: a (bound at file.hs:21:7)\n        func3 :: a -&gt; String (bound at file.hs:21:1)\n   |\n21 | func3 p = show (1 + sum' p y)\n   |      \n</code></pre>\n\n<p>I can solve this with  <code>x :: Int</code> and <code>func3 :: Int -&gt; String</code>, but why do I have to? After all <code>a</code> might be an <code>Int</code> and there are no other calls expecting it to be anything other than an <code>Int</code>.</p>\n"}, {"tags": ["swift", "haskell", "functional-programming"], "comments": [{"owner": {"reputation": 11366, "user_id": 3922954, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/76ba47d2fdd24ab56b0b273cce2075e5?s=128&d=identicon&r=PG&f=1", "display_name": "AJF", "link": "https://stackoverflow.com/users/3922954/ajf"}, "edited": false, "score": 2, "creation_date": 1530016857, "post_id": 51043053, "comment_id": 89077237, "body": "Possible duplicate of <a href=\"https://stackoverflow.com/questions/44965/what-is-a-monad\">What is a monad?</a>"}], "answers": [{"tags": [], "owner": {"reputation": 16362, "user_id": 49220, "user_type": "registered", "accept_rate": 56, "profile_image": "https://www.gravatar.com/avatar/431cd43aaf713caa80316e852a87a840?s=128&d=identicon&r=PG", "display_name": "Paul Johnson", "link": "https://stackoverflow.com/users/49220/paul-johnson"}, "is_accepted": false, "score": 3, "last_activity_date": 1530019091, "creation_date": 1530019091, "answer_id": 51043907, "question_id": 51043053, "link": "https://stackoverflow.com/questions/51043053/monads-and-aop-correlation/51043907#51043907", "title": "Monads and AOP correlation?", "body": "<p>Monads are a unification of several things in computing that were previously treated as being separate. When I say \"unification\" I mean it in the same sense that a physicist would: just as Newtonian gravity unified planetary orbits with terrestrial ballistics, and Maxwell's equations unified electrical and magnetic fields, so monads unify the following:</p>\n\n<ul>\n<li>Seqencing (do A, then B, then C).</li>\n<li>Exception handling (Do A. If it fails then do B).</li>\n<li>Parallel processing (do A and B in parallel, then combine their results).</li>\n<li><a href=\"https://www.schoolofhaskell.com/school/starting-with-haskell/basics-of-haskell/13-the-list-monad\" rel=\"nofollow noreferrer\">Non-determinism</a> (Do A. For each possible result, do B. For each possible result, do C).</li>\n<li><a href=\"https://stackoverflow.com/questions/31358856/continuation-monad-for-a-yield-await-function-in-haskell\">State machines</a>.</li>\n<li><a href=\"http://hackage.haskell.org/package/logict-0.4.2/docs/Control-Monad-Logic.html\" rel=\"nofollow noreferrer\">Logic programming</a>, a la Prolog.</li>\n</ul>\n\n<p>And probably some more that I've forgotten about. Once you understand the general theory of monads you realise that it applies to lots of things, just like Maxewll's equations opened up the whole electromagnetic spectrum instead of us thinking that light and radio were two separate phenomena and hence not realising there was some really interesting stuff in between them.</p>\n\n<p>One side effect of this generality is that you can write your own control-flow constructs. Haskell versions of \"while\" and \"for\" are not built in, they are part of the standard library. If you want something different then you can write it.</p>\n\n<p>The core concepts in monads are \"bind\" (i.e. the (>>=) operator) and \"return\" (which is a really dumb name, but we are stuck with it). There are some basic laws which these have to obey. Roughly speaking, the two operations aren't allowed to do anything underhand. So \"return\" isn't allowed to have any side effects, and rearranging the brackets in a daisy chain of \"bind\" operations isn't allowed to change the meaning of the program.</p>\n\n<p>This is really abstract stuff, which is why it looks weird to programmers raised on conventional imperative languages. Only when you have understood half a dozen different monads do you appreciate the fundamental unity of the concept. People learning Haskell first encounter the IO monad because you need it for \"Hello World\". At that point it just looks like a strange way of doing what every other programming does. This is because the IO monad is a model of the way that every other programming language (except Prolog) works; a sequence of actions that have effects on the real world, including named locations in physical memory.</p>\n\n<p>The big advantage of Haskell monads is that, unlike every other programming language, it is not trapped in the IO monad. You can sort-of define monads in other languages, but they still get executed in what Haskell would see as the IO monad. Because Haskell is pure it lets you escape the constraints of IO and define new monads as true abstractions.</p>\n"}, {"comments": [{"owner": {"reputation": 384463, "user_id": 1126841, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/fa05233b2357f8d11c22ef4cfc7bb85c?s=128&d=identicon&r=PG", "display_name": "chepner", "link": "https://stackoverflow.com/users/1126841/chepner"}, "edited": false, "score": 1, "creation_date": 1530040312, "post_id": 51045977, "comment_id": 89090875, "body": "<a href=\"https://stackoverflow.com/questions/3870088/a-monad-is-just-a-monoid-in-the-category-of-endofunctors-whats-the-proble%E2%85%BF\">Coming up with a succinct definition is easy</a>; <i>understanding</i> it may be a problem :)"}], "tags": [], "owner": {"reputation": 1731, "user_id": 780350, "user_type": "registered", "accept_rate": 86, "profile_image": "https://www.gravatar.com/avatar/afaa8b1a1e2fe1b53755564e5fa34568?s=128&d=identicon&r=PG", "display_name": "melston", "link": "https://stackoverflow.com/users/780350/melston"}, "is_accepted": false, "score": 1, "last_activity_date": 1530025204, "creation_date": 1530025204, "answer_id": 51045977, "question_id": 51043053, "link": "https://stackoverflow.com/questions/51043053/monads-and-aop-correlation/51045977#51045977", "title": "Monads and AOP correlation?", "body": "<p>It is difficult to come up with a succinct description of monads.  I have a slightly different take on the question than @PaulJohnson does.</p>\n\n<p>In a sense, yes, you are right about monads.  They do allow for chaining operations and managing complexity.  But other mechanisms exist to do that as well.  Monads go further.</p>\n\n<p>Monads provide a \"context\" in which calculations can be performed.  They provide a structure and follow some specific rules.  These rules are common but the way individual monads follow them is specific to that monad.</p>\n\n<p>For example:</p>\n\n<ul>\n<li><p>the Option monad defines the context in which the data to be operated on may or may not exist.  It obeys the monadic rules based on how they apply to this particular context.</p></li>\n<li><p>The List monad defines a context in which their may be zero or more elements of data to be operated on.  An alternative view of the List monad is that it provides zero or more <em>possible</em> values to operate on.  This is why it is usually easy to create a \"cross product\" of multiple lists in most functional languages.</p></li>\n<li><p>The Future monad (called different things in different languages) defines a context in which the data to be operated on may not be available yet.</p></li>\n</ul>\n\n<p>There are many other monads, each defining its own context for operations to occur.</p>\n\n<p>The rules that monads follow are what allow us to use them as abstractions that hide the complexities of the contexts so effectively while chaining simple operations together inside those contexts.</p>\n\n<p>This is really a large topic.  It has been suggested that there is no single (simple) answer that will give someone the 'aha' moment they need to really understand monads.  You have to go through the struggle yourself to finally 'get' it.  Don't worry about it.  You can use monads using 'cookbook' recipes while you work to better understand them.  At some point it will click and you will see what the fuss is all about. </p>\n\n<p>The you will find yourself unable to explain them to anyone else. :)</p>\n\n<p>BTW, there are a couple of really good resources that I have gone back to multiple times when dealing with monads.  The first is a wonderful video called <a href=\"https://www.youtube.com/watch?v=ZhuHCtR3xq8&amp;feature=kp/\" rel=\"nofollow noreferrer\">Don't Fear the Monad</a> by Brian Beckman.  The second is a series of blog posts: <a href=\"http://james-iry.blogspot.com/2007/09/monads-are-elephants-part-1.html\" rel=\"nofollow noreferrer\">Monads are Elephants</a>.</p>\n"}, {"tags": [], "owner": {"reputation": 126, "user_id": 363894, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/sabXk.jpg?s=128&g=1", "display_name": "Rodolfo Hansen", "link": "https://stackoverflow.com/users/363894/rodolfo-hansen"}, "is_accepted": false, "score": 0, "last_activity_date": 1559301556, "creation_date": 1559301556, "answer_id": 56394115, "question_id": 51043053, "link": "https://stackoverflow.com/questions/51043053/monads-and-aop-correlation/56394115#56394115", "title": "Monads and AOP correlation?", "body": "<p>At the risk of being overly simplistic; in the <code>world of Monads</code> you are expected to declare your Aspects via the type system. So aspects are tracked explicitly by the compiler, since you can write a <code>Monad</code> which handles Transactions or Logging concerns for you. </p>\n\n<p>With <code>monads</code> you are able to statically (at compile time) declare your effects separately from your core logic, with aop you do this dynamically (at run time) with a much weaker ability to reason algebraically about aspects you have threaded into your codebase.</p>\n"}], "owner": {"reputation": 543, "user_id": 558299, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/b1ee04f165c178fb42b2ad7327d1990a?s=128&d=identicon&r=PG", "display_name": "Sergio", "link": "https://stackoverflow.com/users/558299/sergio"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 308, "favorite_count": 0, "answer_count": 3, "score": 1, "last_activity_date": 1559301556, "creation_date": 1530016444, "last_edit_date": 1530017342, "question_id": 51043053, "link": "https://stackoverflow.com/questions/51043053/monads-and-aop-correlation", "title": "Monads and AOP correlation?", "body": "<p>I'm struggling to try to understand monads in functional programming and how it applies on the language I work (Swift, a multi-paradigm language).</p>\n\n<p>As far as I could understand Monad is a pattern to deal mainly with two programming problems: chaining operations while isolating state complexity from it (IO, log, error, uncertainty). Is it correct?</p>\n\n<p>Thinking of that, it seems that Monads could be used to handle transactional/atomic operations in a functional solution. And it seemed to me (on this point) some similarities with Aspect-Oriented Programming: separate the managing of cross-cuting concerns and its complexity from the regular business logic. </p>\n\n<p>Does it make sense?</p>\n\n<p>Thanks!</p>\n\n<p>PS: The question is not as as broad as \"What is a Monad?\". </p>\n"}, {"tags": ["haskell", "typeclass"], "comments": [{"owner": {"reputation": 100892, "user_id": 745903, "user_type": "registered", "accept_rate": 74, "profile_image": "https://www.gravatar.com/avatar/50933f6638836741e620669b3940410e?s=128&d=identicon&r=PG", "display_name": "leftaroundabout", "link": "https://stackoverflow.com/users/745903/leftaroundabout"}, "edited": false, "score": 0, "creation_date": 1530018054, "post_id": 51042183, "comment_id": 89078083, "body": "<code>putStrLn . show</code> should always be replaced by <code>print</code>."}], "answers": [{"comments": [{"owner": {"reputation": 6267, "user_id": 1913744, "user_type": "registered", "accept_rate": 92, "profile_image": "https://i.stack.imgur.com/5bAQS.jpg?s=128&g=1", "display_name": "Bercovici Adrian", "link": "https://stackoverflow.com/users/1913744/bercovici-adrian"}, "edited": false, "score": 0, "creation_date": 1530014864, "post_id": 51042389, "comment_id": 89075995, "body": "I do not understand the following: Shouldn&#39;t the <code>readLine</code> method return an <code>Int</code> when used by another method since the only <code>IO</code> part was finished with <code>a&lt;-getLine</code> ,so after this line shouldn&#39;t the returning result be a pure one?So if i have a method <code>mymethod::IO Char</code>  that is used by another method <code>secondMethod</code> i still need to access the <code>mymethod</code> result with <code>&lt;-</code> inside the <code>secondMethod</code>?"}, {"owner": {"reputation": 6267, "user_id": 1913744, "user_type": "registered", "accept_rate": 92, "profile_image": "https://i.stack.imgur.com/5bAQS.jpg?s=128&g=1", "display_name": "Bercovici Adrian", "link": "https://stackoverflow.com/users/1913744/bercovici-adrian"}, "edited": false, "score": 0, "creation_date": 1530015239, "post_id": 51042389, "comment_id": 89076228, "body": "So a correct compact way it should be:  <code>useInt::IO()     useInt =putStrLn . show $ ((2::Int)+(&lt;-readLine))</code> ? Can you oneline the (&lt;-) operator?"}, {"owner": {"reputation": 100892, "user_id": 745903, "user_type": "registered", "accept_rate": 74, "profile_image": "https://www.gravatar.com/avatar/50933f6638836741e620669b3940410e?s=128&d=identicon&r=PG", "display_name": "leftaroundabout", "link": "https://stackoverflow.com/users/745903/leftaroundabout"}, "reply_to_user": {"reputation": 6267, "user_id": 1913744, "user_type": "registered", "accept_rate": 92, "profile_image": "https://i.stack.imgur.com/5bAQS.jpg?s=128&g=1", "display_name": "Bercovici Adrian", "link": "https://stackoverflow.com/users/1913744/bercovici-adrian"}, "edited": false, "score": 1, "creation_date": 1530018006, "post_id": 51042389, "comment_id": 89078053, "body": "@BercoviciAdrian <code>&lt;-</code> is not an operator itself but syntactic sugar. What you need here is the <i>monadic chaining combinator</i> <a href=\"http://hackage.haskell.org/package/base-4.11.1.0/docs/Control-Monad.html#v:-61--60--60-\" rel=\"nofollow noreferrer\"><code>=&lt;&lt;</code></a>. <code>useInt = print . ((2::Int)+) =&lt;&lt; readLine</code>. (That&#39;s indeed also what <code>do {i&lt;-readLine; print (2+i::Int)}</code> desugars to.)"}, {"owner": {"reputation": 100185, "user_id": 3234959, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/93bb12ca0f93dfddb33880316f7e66c2?s=128&d=identicon&r=PG&f=1", "display_name": "chi", "link": "https://stackoverflow.com/users/3234959/chi"}, "reply_to_user": {"reputation": 6267, "user_id": 1913744, "user_type": "registered", "accept_rate": 92, "profile_image": "https://i.stack.imgur.com/5bAQS.jpg?s=128&g=1", "display_name": "Bercovici Adrian", "link": "https://stackoverflow.com/users/1913744/bercovici-adrian"}, "edited": false, "score": 2, "creation_date": 1530019630, "post_id": 51042389, "comment_id": 89079150, "body": "@BercoviciAdrian <code>readLine</code> is an <code>IO Int</code>, not an <code>Int</code>. The former type says &quot;you could have an int, if you let me do I/O&quot;, the latter says &quot;you can have an int (without I/O)&quot;. The <code>.. &lt;- ..</code> syntax in <code>do</code> blocks lets you run the IO action and get its result (which is now I/O-free). However, the whole <code>do</code> expression will have an IO type (since it did I/O after all!). Note that <code>do x &lt;- readLine ; f x</code> runs <code>getLine</code> once, while <code>g readLine</code> passes the whole IO action <code>readLine</code> to <code>g</code> which might use it twice e.g. <code>g act = do x&lt;-act; y&lt;-act; ...</code>"}, {"owner": {"reputation": 100185, "user_id": 3234959, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/93bb12ca0f93dfddb33880316f7e66c2?s=128&d=identicon&r=PG&f=1", "display_name": "chi", "link": "https://stackoverflow.com/users/3234959/chi"}, "reply_to_user": {"reputation": 6267, "user_id": 1913744, "user_type": "registered", "accept_rate": 92, "profile_image": "https://i.stack.imgur.com/5bAQS.jpg?s=128&g=1", "display_name": "Bercovici Adrian", "link": "https://stackoverflow.com/users/1913744/bercovici-adrian"}, "edited": false, "score": 1, "creation_date": 1530019712, "post_id": 51042389, "comment_id": 89079217, "body": "@BercoviciAdrian Maybe you should read a monad tutorial to know more about the IO monad, and/or have a look at <a href=\"https://stackoverflow.com/a/28625714/3234959\">this answer of mine</a> which could clarify some aspects."}, {"owner": {"reputation": 6267, "user_id": 1913744, "user_type": "registered", "accept_rate": 92, "profile_image": "https://i.stack.imgur.com/5bAQS.jpg?s=128&g=1", "display_name": "Bercovici Adrian", "link": "https://stackoverflow.com/users/1913744/bercovici-adrian"}, "edited": false, "score": 0, "creation_date": 1530020554, "post_id": 51042389, "comment_id": 89079822, "body": "But this means that if i have a hierarchy of 3 methods <code>m0</code> ,<code>m1</code>,<code>m2</code> where <code>m0::IO a</code> and <code>m1</code> uses <code>m0</code> , and  <code>m2</code> uses <code>m1</code> , then i have to always get the value  &quot;out of the monad bind&quot; am i right? <code>m2=&lt;&lt;m1=&lt;&lt;m0</code>. I thought that somewhere in the hierarchy you can obtain the pure value and continue with that without &quot;tainting&quot; all your methods."}], "tags": [], "owner": {"reputation": 100185, "user_id": 3234959, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/93bb12ca0f93dfddb33880316f7e66c2?s=128&d=identicon&r=PG&f=1", "display_name": "chi", "link": "https://stackoverflow.com/users/3234959/chi"}, "is_accepted": true, "score": 3, "last_activity_date": 1530014338, "creation_date": 1530014338, "answer_id": 51042389, "question_id": 51042183, "link": "https://stackoverflow.com/questions/51042183/ambigous-type-variable-that-prevents-the-constraint/51042389#51042389", "title": "Ambigous type variable that prevents the constraint", "body": "<p><code>2</code> is not only an <code>Int</code> in Haskell but it is of any numeric type, including <code>Float,Double,Integer,...</code>. Its type is <code>Num a =&gt; a</code> -- a polymorphic type fitting each numeric type.</p>\n\n<p>So, you could use <code>(2::Int)</code> instead. Then you'll discover that <code>(2::Int) + readLine</code> is a type error, since <code>readLine :: Int</code> is wrong, we only get <code>readLine :: IO Int</code>.</p>\n\n<p>You can try this, instead</p>\n\n<pre><code>useInt :: IO ()\nuseInt = do\n   i &lt;- readLine\n   putStrLn . show (2 + i :: Int)\n</code></pre>\n"}], "owner": {"reputation": 6267, "user_id": 1913744, "user_type": "registered", "accept_rate": 92, "profile_image": "https://i.stack.imgur.com/5bAQS.jpg?s=128&g=1", "display_name": "Bercovici Adrian", "link": "https://stackoverflow.com/users/1913744/bercovici-adrian"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 198, "favorite_count": 0, "accepted_answer_id": 51042389, "answer_count": 1, "score": 0, "last_activity_date": 1530014338, "creation_date": 1530013683, "question_id": 51042183, "link": "https://stackoverflow.com/questions/51042183/ambigous-type-variable-that-prevents-the-constraint", "title": "Ambigous type variable that prevents the constraint", "body": "<p>I am fiddling around with IO and i do not understand the following <strong>error</strong> :</p>\n\n<pre><code>* Ambiguous type variable `a0' arising from a use of `readLine'\n      prevents the constraint `(Console a0)' from being solved.\n      Probable fix: use a type annotation to specify what `a0' should be.\n      These potential instance exist:\n        instance Console Int -- Defined at Tclass.hs:8:14\n    * In the second argument of `(+)', namely `readLine'\n      In the second argument of `($)', namely `(2 + readLine)'\n      In the expression: putStrLn . show $ (2 + readLine)\n   |\n17 |     useInt =putStrLn . show $ (2+readLine)\n</code></pre>\n\n<p><strong>Code</strong></p>\n\n<pre><code>module Tclass where\n    import System.Environment\n\n    class Console a where\n        writeLine::a-&gt;IO()\n        readLine::IO a\n\n    instance Console Int where\n        writeLine= putStrLn . show \n\n        readLine = do\n            a &lt;- getLine\n            let b= (read  a)::Int\n            return b\n\n    useInt::IO()\n    useInt =putStrLn . show $ (2+readLine)  \n</code></pre>\n\n<p><strong>P.S</strong> i do not understand shouldn't the compiler infer the type of the  instance for <code>readLine</code> and make the addition with <code>2</code> in the <code>useInt</code> method ?</p>\n"}, {"tags": ["haskell", "recursion", "io-monad"], "comments": [{"owner": {"reputation": 57219, "user_id": 33796, "user_type": "registered", "accept_rate": 70, "profile_image": "https://www.gravatar.com/avatar/08727b23ba62e634b32988cdff082663?s=128&d=identicon&r=PG", "display_name": "luqui", "link": "https://stackoverflow.com/users/33796/luqui"}, "edited": false, "score": 2, "creation_date": 1529988357, "post_id": 51034995, "comment_id": 89061977, "body": "Until you get the hang of the combinators <code>(&gt;&gt;=)</code>, <code>(&lt;$&gt;)</code>, <code>liftA2</code>, etc., make sure that you <i>always bind</i> the result of an <code>IO</code> action.  You&#39;re on the right track with <code>rs &lt;- goo xs ys</code>, but you must do the same with <code>hoo&#39;</code>."}, {"owner": {"reputation": 78982, "user_id": 1848654, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/84180c0f3c9c04f8b8f0613fc0129dac?s=128&d=identicon&r=PG", "display_name": "melpomene", "link": "https://stackoverflow.com/users/1848654/melpomene"}, "edited": false, "score": 1, "creation_date": 1529988603, "post_id": 51034995, "comment_id": 89062039, "body": "A note on terminology: There&#39;s no such thing as &quot;an IO monad&quot;. <code>IO</code> (the type) <i>is</i> the monad."}, {"owner": {"reputation": 57219, "user_id": 33796, "user_type": "registered", "accept_rate": 70, "profile_image": "https://www.gravatar.com/avatar/08727b23ba62e634b32988cdff082663?s=128&d=identicon&r=PG", "display_name": "luqui", "link": "https://stackoverflow.com/users/33796/luqui"}, "reply_to_user": {"reputation": 78982, "user_id": 1848654, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/84180c0f3c9c04f8b8f0613fc0129dac?s=128&d=identicon&r=PG", "display_name": "melpomene", "link": "https://stackoverflow.com/users/1848654/melpomene"}, "edited": false, "score": 3, "creation_date": 1529988791, "post_id": 51034995, "comment_id": 89062090, "body": "To expand on @melpomene, what you are calling an IO monad, I would call &quot;an IO action&quot; (= a value whose type is <code>IO something</code>)."}, {"owner": {"reputation": 94553, "user_id": 775806, "user_type": "registered", "accept_rate": 96, "profile_image": "https://i.stack.imgur.com/XNd2C.png?s=128&g=1", "display_name": "n. &#39;pronouns&#39; m.", "link": "https://stackoverflow.com/users/775806/n-pronouns-m"}, "edited": false, "score": 0, "creation_date": 1529992390, "post_id": 51034995, "comment_id": 89063199, "body": "<i>apologies for the gibberish</i> perhaps trying a simple real world problem, like reading a file and returning its content as a list of strings, would be more productive."}], "answers": [{"comments": [{"owner": {"reputation": 61, "user_id": 7113047, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/c20756957eeff77779fbfb97ccf63df1?s=128&d=identicon&r=PG&f=1", "display_name": "Eric Flaten", "link": "https://stackoverflow.com/users/7113047/eric-flaten"}, "edited": false, "score": 0, "creation_date": 1530061490, "post_id": 51035300, "comment_id": 89097433, "body": "I just confirmed that your first remake of my <code>hoo</code> function works after adding a line <code>mk20 [] = return ([])</code> to handle the empty list in the recursion process."}], "tags": [], "owner": {"reputation": 78982, "user_id": 1848654, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/84180c0f3c9c04f8b8f0613fc0129dac?s=128&d=identicon&r=PG", "display_name": "melpomene", "link": "https://stackoverflow.com/users/1848654/melpomene"}, "is_accepted": false, "score": 5, "last_activity_date": 1529990041, "creation_date": 1529990041, "answer_id": 51035300, "question_id": 51034995, "link": "https://stackoverflow.com/questions/51034995/doing-recursion-within-an-io-monad/51035300#51035300", "title": "Doing recursion within an IO monad", "body": "<p>If you find <code>do</code> notation confusing, my recommendation would be to not use it at all. You can do everything you need with <code>&gt;&gt;=</code>. Just pretend its type is</p>\n\n<pre><code>(&gt;&gt;=) :: IO a -&gt; (a -&gt; IO b) -&gt; IO b\n</code></pre>\n\n<p>That said, let's look at your code.</p>\n\n<p><code>let</code> in a <code>do</code> block gives a name to some value. That's the same thing it does outside of <code>do</code>, so that's not helpful here (it gives you no additional power).</p>\n\n<p><code>&lt;-</code> is more interesting: It acts as an \"extract a value from IO locally\" construct (if you squint a bit).</p>\n\n<pre><code>hoo :: [String] -&gt; IO [String]\nhoo (xs:ys:yss) = do\n    -- The right-hand side (goo xs ys) has type IO [String], ...\n    rs &lt;- goo xs ys\n    -- ... so rs :: [String].\n\n    -- We can apply the same construct to our recursive call:\n    hs &lt;- hoo yss\n    -- hoo yss :: IO [String], so hs :: [String].\n\n    let gs = rs ++ hs\n    return gs\n</code></pre>\n\n<p>As mentioned above, <code>let</code> just binds a name to a value, so we don't really need it here:</p>\n\n<pre><code>hoo :: [String] -&gt; IO [String]\nhoo (xs:ys:yss) = do\n    rs &lt;- goo xs ys\n    hs &lt;- hoo yss\n    return (rs ++ hs)\n</code></pre>\n\n<hr>\n\n<p>Alternatively, without <code>do</code> notation and <code>&lt;-</code> we'd do it as follows.</p>\n\n<pre><code>(&gt;&gt;=) :: IO a -&gt; (a -&gt; IO b) -&gt; IO b\n</code></pre>\n\n<p><code>&gt;&gt;=</code> takes an <code>IO</code> value and a callback function, and it runs the function on the \"unwrapped\" value (<code>a</code>). That means within the function we get local access to the value as long as the result of the whole thing is <code>IO b</code> again (for some arbitrary type <code>b</code>).</p>\n\n<pre><code>hoo :: [String] -&gt; IO [String]\nhoo (xs : ys : yss) =\n    goo xs ys -- :: IO [String]\n    ...\n</code></pre>\n\n<p>We have an <code>IO [String]</code> and we need to do something with <code>[String]</code>, so we use <code>&gt;&gt;=</code>:</p>\n\n<pre><code>hoo :: [String] -&gt; IO [String]\nhoo (xs : ys : yss) =\n    goo xs ys &gt;&gt;= (\\rs -&gt; ...)\n</code></pre>\n\n<p>If you look at <code>&gt;&gt;=</code>'s type signature, the role of <code>a</code> is played by <code>[String]</code> here\n(<code>rs :: [String]</code>) and <code>b</code> is also <code>[String]</code> (because <code>hoo</code> as a whole needs to return <code>IO [String]</code>).</p>\n\n<p>So what do we do in the <code>...</code> part? We need to make a recursive call to <code>hoo</code>, which again results in an <code>IO [String]</code> value, so we use <code>&gt;&gt;=</code> again:</p>\n\n<pre><code>hoo :: [String] -&gt; IO [String]\nhoo (xs : ys : yss) =\n    goo xs ys &gt;&gt;= (\\rs -&gt; hoo yss &gt;&gt;= (\\hs -&gt; ...))\n</code></pre>\n\n<p>Again, <code>hs :: [String]</code> and <code>...</code> better have type <code>IO [String]</code> to make the whole thing typecheck.</p>\n\n<p>Now that we have <code>rs :: [String]</code> and <code>hs :: [String]</code>, we can simply concatenate them:</p>\n\n<pre><code>hoo :: [String] -&gt; IO [String]\nhoo (xs : ys : yss) =\n    goo xs ys &gt;&gt;= (\\rs -&gt; hoo yss &gt;&gt;= (\\hs -&gt; rs ++ hs))  -- !\n</code></pre>\n\n<p>This is a type error. <code>rs ++ hs :: [String]</code>, but the context requires <code>IO [String]</code>. Fortunately there's a function that can help us out:</p>\n\n<pre><code>return :: a -&gt; IO a\n</code></pre>\n\n<p>Now it typechecks:</p>\n\n<pre><code>hoo :: [String] -&gt; IO [String]\nhoo (xs : ys : yss) =\n    goo xs ys &gt;&gt;= (\\rs -&gt; hoo yss &gt;&gt;= (\\hs -&gt; return (rs ++ hs)))\n</code></pre>\n\n<p>Due to the way Haskell syntax works (function bodies extend as far to the right as possible), most parens here are actually optional:</p>\n\n<pre><code>hoo :: [String] -&gt; IO [String]\nhoo (xs : ys : yss) =\n    goo xs ys &gt;&gt;= \\rs -&gt; hoo yss &gt;&gt;= \\hs -&gt; return (rs ++ hs)\n</code></pre>\n\n<p>And with a bit of reformatting the whole thing can be made to look pretty suggestive:</p>\n\n<pre><code>hoo :: [String] -&gt; IO [String]\nhoo (xs : ys : yss) =\n    goo xs ys &gt;&gt;= \\rs -&gt;\n    hoo yss   &gt;&gt;= \\hs -&gt;\n    return (rs ++ hs)\n</code></pre>\n"}, {"tags": [], "owner": {"reputation": 61419, "user_id": 849891, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/MbEO3.png?s=128&g=1", "display_name": "Will Ness", "link": "https://stackoverflow.com/users/849891/will-ness"}, "is_accepted": false, "score": 2, "last_activity_date": 1530031555, "last_edit_date": 1530031555, "creation_date": 1530020460, "answer_id": 51044354, "question_id": 51034995, "link": "https://stackoverflow.com/questions/51034995/doing-recursion-within-an-io-monad/51044354#51044354", "title": "Doing recursion within an IO monad", "body": "<p><code>do</code> notation is very handy. Use it, it's your friend. We just need to follow its rules, were each thing going into its place must have a correct type, correspondingly.</p>\n\n<p>You were very close:</p>\n\n<pre><code>goo :: String -&gt; String -&gt; IO [String]\n\n{- hoo' :: [String] -&gt; IO [String]\nhoo' (xs:ys:yss) = do\n                  rs &lt;- goo xs ys \n                  let gs = rs ++ hoo' yss\n                  return gs -}\n\nhoo'' :: [String] -&gt; IO [String]\nhoo'' (xs:ys:yss) = do\n                  rs &lt;- goo xs ys     -- goo xs ys :: IO [String] -- rs :: [String]\n                  qs &lt;- hoo'' yss     -- hoo'' yss :: IO [String] -- qs :: [String]\n                  let gs = rs ++ qs                               -- gs :: [String]\n                  return gs           -- return gs :: IO [String]\n</code></pre>\n\n<p>In <code>do</code> notation, with <code>x &lt;- foo</code>, when <code>foo :: IO a</code>, we have <code>x :: a</code>. That's it. (Some more explanations are e.g. <a href=\"https://stackoverflow.com/a/50815136/849891\">here</a>).</p>\n\n<p>As for recursion, it is achieved with <code>do</code> notation just as it is achieved in pure code: by naming things, and referring to the same name from inside the expression defining that name, whether it is a pure expression or a <code>do</code> notation.</p>\n\n<p>Recursion is a leap of faith. We don't care how the thing is defined -- we assume it is defined correctly so we can just refer to it by its name. As long as the types fit.</p>\n"}, {"tags": [], "owner": {"reputation": 48938, "user_id": 246886, "user_type": "registered", "accept_rate": 94, "profile_image": "https://www.gravatar.com/avatar/dd1ebaade6623fc538fb8af3338e730d?s=128&d=identicon&r=PG", "display_name": "Jon Purdy", "link": "https://stackoverflow.com/users/246886/jon-purdy"}, "is_accepted": false, "score": 1, "last_activity_date": 1530050060, "creation_date": 1530050060, "answer_id": 51051848, "question_id": 51034995, "link": "https://stackoverflow.com/questions/51034995/doing-recursion-within-an-io-monad/51051848#51051848", "title": "Doing recursion within an IO monad", "body": "<p>To do this with <code>do</code> notation, you need to <em>bind</em> the results of every <code>IO</code> action in order to use those results in pure expressions such as <code>let rs =</code>\u2026<code>++</code>\u2026, like so:</p>\n\n<pre><code>hoo :: [String] -&gt; IO [String]\nhoo (xs:ys:yss) = do\n  g &lt;- goo xs ys\n  h &lt;- hoo yss\n  let rs = g ++ h\n  return rs\n</code></pre>\n\n<p>However, often you don\u2019t want to introduce a temporary name for the result of every action, so in typical Haskell code, there are a few combinators that make this kind of thing more compact. Here you can use <code>liftA2</code>:</p>\n\n<pre><code>liftA2\n  :: Applicative f\n\n  -- Given a pure function to combine an \u2018a\u2019 and a \u2018b\u2019 into a \u2018c\u2019\u2026\n  =&gt; (a -&gt; b -&gt; c)\n\n  -- An action that produces an \u2018a\u2019\u2026\n  -&gt; f a\n\n  -- And an action that produces a \u2018b\u2019\u2026\n  -&gt; f b\n\n  -- Make an action that produces a \u2018c\u2019.\n  -&gt; f c\n</code></pre>\n\n<p>Like this:</p>\n\n<pre><code>hoo (xs:ys:yss) = liftA2 (++) (goo xs ys) (hoo yss)\n</code></pre>\n\n<p><code>liftA2</code> only works for functions of two arguments, though; for applying functions of other numbers of arguments, you can use the <code>Functor</code> operator <code>&lt;$&gt;</code> (an alias of <code>fmap</code>) and the <code>Applicative</code> operator <code>&lt;*&gt;</code>:</p>\n\n<pre><code>(&lt;$&gt;)\n  :: Functor f\n\n  -- Given a pure function to transform an \u2018a\u2019 into a \u2018b\u2019\u2026\n  =&gt; (a -&gt; b)\n\n  -- And an action that produces an \u2018a\u2019\u2026\n  -&gt; f a\n\n  -- Make an action that produces a \u2018b\u2019.\n  -&gt; f b\n\n(&lt;*&gt;)\n  :: Applicative f\n\n  -- Given an action that produces a function from \u2018a\u2019 to \u2018b\u2019\u2026\n  =&gt; f (a -&gt; b)\n\n  -- And an action that produces an \u2018a\u2019\u2026\n  -&gt; f a\n\n  -- Make an action that produces a \u2018b\u2019.\n  -&gt; f b\n</code></pre>\n\n<p>These can be combined like so:</p>\n\n<pre><code>(++) &lt;$&gt; goo xs ys :: IO ([String] -&gt; [String])\n--                    f  (a        -&gt; b)\n\nhoo yss :: IO [String]\n--         f a\n\nhoo (xs:ys:yss) = (++) &lt;$&gt; goo xs ys &lt;*&gt; hoo yss :: IO [String]\n--                                                  f  b\n</code></pre>\n\n<p>That is, fmapping <code>(++)</code> over the result of <code>goo xs ys</code> using <code>&lt;$&gt;</code> is an action that returns a partially applied function, and <code>&lt;*&gt;</code> produces an action that applies this function to the result of <code>hoo yss</code>.</p>\n\n<p>(There is a law which states that <code>f &lt;$&gt; x</code> is equivalent to <code>pure f &lt;*&gt; x</code>\u2014that is, if you have an action <code>pure f</code> that just returns a function <code>f</code>, unwrap that action and apply it to the result of <code>x</code> using <code>&lt;*&gt;</code>, then that\u2019s the same as just applying the pure function to the action with <code>&lt;$&gt;</code>.)</p>\n\n<p>Another example of using this with a function of 3 arguments:</p>\n\n<pre><code>cat3 a b c = a ++ b ++ c\n\nmain = do\n  -- Concatenate 3 lines of input\n  result &lt;- cat3 &lt;$&gt; getLine &lt;*&gt; getLine &lt;*&gt; getLine\n  putStrLn result\n</code></pre>\n\n<p>You can think of all of these combinators as different kinds of application operators, like <code>($)</code>:</p>\n\n<pre><code> ($)  ::   (a -&gt;   b) -&gt;   a -&gt;   b\n(&lt;$&gt;) ::   (a -&gt;   b) -&gt; f a -&gt; f b\n(&lt;*&gt;) :: f (a -&gt;   b) -&gt; f a -&gt; f b\n(=&lt;&lt;) ::   (a -&gt; f b) -&gt; f a -&gt; f b\n</code></pre>\n\n<ul>\n<li><code>($)</code> applies a <em>pure</em> function to a <em>pure</em> argument</li>\n<li><code>(&lt;$&gt;)</code> applies a <em>pure</em> function to the result of an <em>action</em></li>\n<li><code>(&lt;*&gt;)</code> applies a <em>pure</em> function <em>resulting</em> from an action to the result of another <em>action</em></li>\n<li><code>(=&lt;&lt;)</code> (the flipped version of <code>(&gt;&gt;=)</code>) applies a function <em>returning</em> an <em>action</em> to the result of an <em>action</em></li>\n</ul>\n"}], "owner": {"reputation": 61, "user_id": 7113047, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/c20756957eeff77779fbfb97ccf63df1?s=128&d=identicon&r=PG&f=1", "display_name": "Eric Flaten", "link": "https://stackoverflow.com/users/7113047/eric-flaten"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 471, "favorite_count": 1, "answer_count": 3, "score": 4, "last_activity_date": 1530050060, "creation_date": 1529988018, "question_id": 51034995, "link": "https://stackoverflow.com/questions/51034995/doing-recursion-within-an-io-monad", "title": "Doing recursion within an IO monad", "body": "<p>I have been trying to figure out how to do recursion within an IO monad.\nI am familiar with doing recursion with pure functions, but have not been able to transfer this knowledge to IO monads. </p>\n\n<p><em>Recursion with pure functions</em><br>\nI'm comfortable with doing recursion with pure functions such as the <code>foo</code> function below.</p>\n\n<pre><code>foo (x:y:ys) = foo' x y ++ foo ys\n</code></pre>\n\n<p><em>A function with IO [String] output</em><br>\nI made a function like <code>goo</code> below that does what I need and has an IO output. </p>\n\n<pre><code>goo :: String -&gt; String -&gt; IO [String]\ngoo xs ys = goo' xs ys \n</code></pre>\n\n<p><em>Trying to get recursion inside an IO monad</em><br>\nWhen I try to do recursion within an IO monad (e.g., a \"main\" function) I cannot. I've looked up <code>liftM</code>, <code>replicateM</code>, and the undo-the-IO <code>&lt;-</code> operator or function. I want an IO monad like <code>hoo</code> or <code>hoo'</code> (apologies for the gibberish that follows).</p>\n\n<pre><code>hoo :: [String] -&gt; IO [String]\nhoo (xs:ys:yss) = do\n                  let rs = goo xs ys ++ hoo yss\n                  return rs\n</code></pre>\n\n<p>or</p>\n\n<pre><code>hoo' :: [String] -&gt; IO [String]\nhoo' (xs:ys:yss) = do\n                  rs &lt;- goo xs ys \n                  let gs = rs ++ hoo' yss\n                  return gs\n</code></pre>\n\n<p>(BTW, in case you are wondering what my project is, I'm writing a Genetic Algorithm program from scratch for a course. My <code>goo</code> function takes two parents and breeds two offspring, which are returned as an IO because <code>goo</code> uses a random number generator. What I need to do is to to use a recursive <code>hoo</code> function to use <code>goo</code> to breed 20 offspring from a list of 20 parents. The idea I have is to take the first two parents in the list, breed two offspring, take the next two parents on the list, breed another pair of offspring, so on and so forth.) </p>\n"}, {"tags": ["haskell"], "comments": [{"owner": {"reputation": 16233, "user_id": 4253229, "user_type": "registered", "accept_rate": 83, "profile_image": "https://lh4.googleusercontent.com/-e2FAQvlj5CQ/AAAAAAAAAAI/AAAAAAAAAqM/TlSnekirgNE/photo.jpg?sz=128", "display_name": "Eugene Sh.", "link": "https://stackoverflow.com/users/4253229/eugene-sh"}, "edited": false, "score": 2, "creation_date": 1529947777, "post_id": 51028736, "comment_id": 89050247, "body": "<code>1&#47;(k!)</code> is not an integer anyway. So even if you had your exponent, it wouldn&#39;t work."}], "answers": [{"comments": [{"owner": {"reputation": 11, "user_id": 9990239, "user_type": "registered", "profile_image": "https://lh6.googleusercontent.com/-UcjsXc_CcmQ/AAAAAAAAAAI/AAAAAAAAAD0/VfnzTX2C00M/photo.jpg?sz=128", "display_name": "ViB", "link": "https://stackoverflow.com/users/9990239/vib"}, "edited": false, "score": 0, "creation_date": 1530066483, "post_id": 51029973, "comment_id": 89098320, "body": "You were right! I convert the factorial first and it worked! Thank you very much! I changed the last line:         n &gt; 0 = (fromInteger (factorial n))^^(-1) + eaprox (n-1)"}], "tags": [], "owner": {"reputation": 13772, "user_id": 379311, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/c993f4f111e6ff3211ccda1b98828253?s=128&d=identicon&r=PG", "display_name": "Yann Vernier", "link": "https://stackoverflow.com/users/379311/yann-vernier"}, "is_accepted": false, "score": 4, "last_activity_date": 1529952501, "last_edit_date": 1529952501, "creation_date": 1529952043, "answer_id": 51029973, "question_id": 51028736, "link": "https://stackoverflow.com/questions/51028736/haskell-frominteger-function-negative-exponent/51029973#51029973", "title": "Haskell fromInteger function negative exponent", "body": "<p>Factorial produces a positive integer, and the reciprocal <code>^(-1)</code> of that (once past 1) is a fraction from 0 to 1; never an integer. So you need to perform the conversion before you take the reciprocal, something like:</p>\n\n<pre><code>factorial n = product [1..n]\n\neaprox n = sum [recip . fromInteger . factorial $ x | x &lt;- [0..n]]\n</code></pre>\n\n<p>With this version, <code>eaprox 17</code> is approximately equal to <code>exp 1</code>. </p>\n"}], "owner": {"reputation": 11, "user_id": 9990239, "user_type": "registered", "profile_image": "https://lh6.googleusercontent.com/-UcjsXc_CcmQ/AAAAAAAAAAI/AAAAAAAAAD0/VfnzTX2C00M/photo.jpg?sz=128", "display_name": "ViB", "link": "https://stackoverflow.com/users/9990239/vib"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 470, "favorite_count": 0, "answer_count": 1, "score": 1, "last_activity_date": 1529952501, "creation_date": 1529946927, "last_edit_date": 1529947441, "question_id": 51028736, "link": "https://stackoverflow.com/questions/51028736/haskell-frominteger-function-negative-exponent", "title": "Haskell fromInteger function negative exponent", "body": "<p>I'm new with Haskell, and I'm trying to define a function <code>eAprox :: Integer -&gt; Float</code> with recursion. The function is the next <a href=\"https://i.stack.imgur.com/XlRI9.png\" rel=\"nofollow noreferrer\">summation of 1/(k!) with k from 0 to inf</a></p>\n\n<p>And what I got so far is</p>\n\n<pre><code>eaprox :: Integer -&gt; Float\n\neaprox n | n == 0 = 1\n\n         | n &gt; 0 = fromInteger ((factorial n)^(-1)) + eaprox (n-1)\n</code></pre>\n\n<p>Haskell accepts this, but with any number (except 0) it gives me the message <strong>* Exception: Negative exponent.</strong> I changed the (^) for (^^) or (**), but then I can't even load the function.. I'm guessing there's a mistake with the fromInteger function because I don't quite understand how it works.. Any thoughts?</p>\n"}, {"tags": ["haskell"], "comments": [{"owner": {"reputation": 75362, "user_id": 625403, "user_type": "registered", "accept_rate": 82, "profile_image": "https://www.gravatar.com/avatar/786eed7da67079cb5d63a49d469af25b?s=128&d=identicon&r=PG", "display_name": "amalloy", "link": "https://stackoverflow.com/users/625403/amalloy"}, "edited": false, "score": 3, "creation_date": 1529956075, "post_id": 51027906, "comment_id": 89053956, "body": "All of your <code>&#47;=</code> checks could be removed. You already know, because the first check failed, that the three numbers are not all equal. Therefore, if (for example) <code>x == y</code>, then you already know that <code>x &#47;= z</code> and do not need to test it."}, {"owner": {"reputation": 48938, "user_id": 246886, "user_type": "registered", "accept_rate": 94, "profile_image": "https://www.gravatar.com/avatar/dd1ebaade6623fc538fb8af3338e730d?s=128&d=identicon&r=PG", "display_name": "Jon Purdy", "link": "https://stackoverflow.com/users/246886/jon-purdy"}, "edited": false, "score": 0, "creation_date": 1529968652, "post_id": 51027906, "comment_id": 89058106, "body": "You could also use something more compact by counting equalities regardless of order: <code>howManyEqual x y z | and xyz = 3 | or xyz = 2 | otherwise = 0 where xyz = [x == y, x == z, y == z]</code>\u2014that is, if <i>all</i> of them compare equal, then 3 are equal; if only <i>some</i> of them compare equal, then 2 are equal; otherwise 0 are equal."}], "answers": [{"comments": [{"owner": {"reputation": 695, "user_id": 4172497, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/af7408df6d2d0c38a8f98d29a63243b2?s=128&d=identicon&r=PG&f=1", "display_name": "divinesense", "link": "https://stackoverflow.com/users/4172497/divinesense"}, "edited": false, "score": 0, "creation_date": 1529955485, "post_id": 51028017, "comment_id": 89053696, "body": "Ah, that makes sense. Also thanks for the type declaration sample, that looks more usable"}], "tags": [], "owner": {"reputation": 208473, "user_id": 126014, "user_type": "registered", "accept_rate": 86, "profile_image": "https://www.gravatar.com/avatar/33526616d4a11f1630d4939b769cfbf9?s=128&d=identicon&r=PG", "display_name": "Mark Seemann", "link": "https://stackoverflow.com/users/126014/mark-seemann"}, "is_accepted": true, "score": 8, "last_activity_date": 1529944057, "creation_date": 1529944057, "answer_id": 51028017, "question_id": 51027906, "link": "https://stackoverflow.com/questions/51027906/couldnt-match-expected-type-integer-with-actual-type-m0-integer/51028017#51028017", "title": "Couldn&#39;t match expected type \u2018Integer\u2019 with actual type \u2018m0 Integer\u2019", "body": "<p>Delete all the <code>return</code> keywords:</p>\n\n<pre><code>howManyEqual :: Int -&gt; Int -&gt; Int -&gt; Integer\nhowManyEqual x y z =  \n  if x == y &amp;&amp; x == z then 3\n  else if x == y &amp;&amp; x /= z then 2\n  else if x == z &amp;&amp; x /= y then 2\n  else if y == z &amp;&amp; y /= x then 2\n  else 0\n</code></pre>\n\n<p>In Haskell, <code>return</code> isn't a keyword, but a function with the type <code>Monad m =&gt; a -&gt; m a</code>. It's mainly used from within code blocks in <code>do</code> notation to return values 'wrapped' in a <code>Monad</code> instance.</p>\n\n<p>The <code>howManyEqual</code> method doesn't return a monadic value, but rather a normal, scalar <code>Integer</code>, so <code>return</code> isn't required. When you use <code>return</code> anyway, the compiler expects the returned value to be part of some <code>Monad</code> instance that it calls <code>m0</code> in the error message, but since the function has the explicitly declared return type <code>Integer</code>, there's no way to reconcile these.</p>\n\n<p>By the way, you can relax the type declaration to:</p>\n\n<pre><code>howManyEqual :: (Eq a, Num t) =&gt; a -&gt; a -&gt; a -&gt; t\n</code></pre>\n"}, {"comments": [{"owner": {"reputation": 695, "user_id": 4172497, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/af7408df6d2d0c38a8f98d29a63243b2?s=128&d=identicon&r=PG&f=1", "display_name": "divinesense", "link": "https://stackoverflow.com/users/4172497/divinesense"}, "edited": false, "score": 0, "creation_date": 1529955787, "post_id": 51028778, "comment_id": 89053813, "body": "Right, I&#39;ll keep that in mind. Thanks for the heads up"}], "tags": [], "owner": {"reputation": 619, "user_id": 8514005, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/318a3ae487b2140f9d08079450b6903d?s=128&d=identicon&r=PG&f=1", "display_name": "JohEker", "link": "https://stackoverflow.com/users/8514005/joheker"}, "is_accepted": false, "score": 5, "last_activity_date": 1529947119, "creation_date": 1529947119, "answer_id": 51028778, "question_id": 51027906, "link": "https://stackoverflow.com/questions/51027906/couldnt-match-expected-type-integer-with-actual-type-m0-integer/51028778#51028778", "title": "Couldn&#39;t match expected type \u2018Integer\u2019 with actual type \u2018m0 Integer\u2019", "body": "<p>Some further off topic information about the haskell syntax:</p>\n\n<p>There is nothing wrong with using <code>else if</code> in haskell, but it's not common. Haskell supports guards <code>|</code> which is some what equivalent to <code>else if</code>. However, <code>if x then y else z</code> is mosty used for a binary condition, not to gather several different conditions. </p>\n\n<p><code>| x == y = 5</code> = <code>if x ==y then 5</code> </p>\n\n<p>Therefore your code could be expressed in the following and more preferable way</p>\n\n<pre><code> howManyEqual :: Int -&gt; Int -&gt; Int -&gt; Integer\n howManyEqual x y z   \n   | x == y &amp;&amp; x == z = 3\n   | x == y &amp;&amp; x /= z = 2\n   | x == z &amp;&amp; x /= y = 2\n   | y == z &amp;&amp; y /= x = 2\n   | otherwise        = 0\n</code></pre>\n"}], "owner": {"reputation": 695, "user_id": 4172497, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/af7408df6d2d0c38a8f98d29a63243b2?s=128&d=identicon&r=PG&f=1", "display_name": "divinesense", "link": "https://stackoverflow.com/users/4172497/divinesense"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 1549, "favorite_count": 0, "accepted_answer_id": 51028017, "answer_count": 2, "score": 5, "last_activity_date": 1529947119, "creation_date": 1529943585, "last_edit_date": 1529944336, "question_id": 51027906, "link": "https://stackoverflow.com/questions/51027906/couldnt-match-expected-type-integer-with-actual-type-m0-integer", "title": "Couldn&#39;t match expected type \u2018Integer\u2019 with actual type \u2018m0 Integer\u2019", "body": "<p>So I'm new to Haskell and I'm writing a basic function which takes 3 integers as arguments and returns how many are equal.</p>\n\n<pre><code>howManyEqual :: Int-&gt;Int-&gt;Int-&gt;Integer\n\nhowManyEqual x y z =  \n        if x == y &amp;&amp; x == z then return 3\n        else if x == y &amp;&amp; x /= z then return 2\n        else if x == z &amp;&amp; x /= y then return 2\n        else if y == z &amp;&amp; y /= x then return 2\n        else return 0\n</code></pre>\n\n<p>But Im getting the following error:</p>\n\n<pre><code>Prelude&gt; :load ex4.1_2.hs \n[1 of 1] Compiling Main             ( ex4.1_2.hs, interpreted )\n\nex4.1_2.hs:11:34:\n    Couldn't match expected type \u2018Integer\u2019\n                with actual type \u2018m0 Integer\u2019\n    In the expression: return 3\n    In the expression:\n      if x == y &amp;&amp; x == z then\n          return 3\n      else\n          if x == y &amp;&amp; x /= z then\n              return 2\n          else\n              if x == z &amp;&amp; x /= y then\n                  return 2\n              else\n                  if y == z &amp;&amp; y /= x then return 2 else return 0\n</code></pre>\n\n<p>I have same error at <code>return 2</code> and <code>return 0</code> as well.\nWhat kind of data type is <code>m0 Integer</code> and what do I need to do to fix this? \nAny help would be appreciated. Cheers!!</p>\n"}, {"tags": ["haskell"], "comments": [{"owner": {"reputation": 66224, "user_id": 180286, "user_type": "registered", "accept_rate": 69, "profile_image": "https://i.stack.imgur.com/tAXU2.jpg?s=128&g=1", "display_name": "Fyodor Soikin", "link": "https://stackoverflow.com/users/180286/fyodor-soikin"}, "edited": false, "score": 4, "creation_date": 1529941299, "post_id": 51026886, "comment_id": 89046859, "body": "It&#39;s in general <a href=\"https://en.wikipedia.org/wiki/Halting_problem\" rel=\"nofollow noreferrer\">impossible to determine if a program will ever terminate</a>, so the compiler can&#39;t really help you with this. Your best bet is to notice that it has hung up and terminate it forcefully."}, {"owner": {"reputation": 208473, "user_id": 126014, "user_type": "registered", "accept_rate": 86, "profile_image": "https://www.gravatar.com/avatar/33526616d4a11f1630d4939b769cfbf9?s=128&d=identicon&r=PG", "display_name": "Mark Seemann", "link": "https://stackoverflow.com/users/126014/mark-seemann"}, "edited": false, "score": 4, "creation_date": 1529941710, "post_id": 51026886, "comment_id": 89047100, "body": "When you experiment with Haskell code, you could run it in GHCi until you feel confident that it works. In GHCi, you can <i>break</i> execution if it seems to hang. <a href=\"https://stackoverflow.com/a/50095413/126014\">Here&#39;s how to do it on Windows</a>."}, {"owner": {"reputation": 14582, "user_id": 2225384, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/f30b04ed4d0b3fc4bc791a28815f34ca?s=128&d=identicon&r=PG", "display_name": "Rein Henrichs", "link": "https://stackoverflow.com/users/2225384/rein-henrichs"}, "edited": false, "score": 10, "creation_date": 1529941854, "post_id": 51026886, "comment_id": 89047177, "body": "It might be useful to set the maximum heap size using RTS options, e.g., <code>+RTS -M128m -RTS</code>. See <a href=\"http://downloads.haskell.org/~ghc/latest/docs/html/users_guide/runtime_control.html\" rel=\"nofollow noreferrer\">the manual</a> for info on how to set this at compile-time."}, {"owner": {"reputation": 209, "user_id": 7658944, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/197708885c5d718abd5711f49b17c6e0?s=128&d=identicon&r=PG&f=1", "display_name": "Robert", "link": "https://stackoverflow.com/users/7658944/robert"}, "edited": false, "score": 0, "creation_date": 1529993245, "post_id": 51026886, "comment_id": 89063537, "body": "Not sure how to help, but try to think of what your functions actually do to the list. <code>reverse</code> naturally needs the entire list before it can terminate, so does <code>sort</code>. <code>take 5</code> only needs to inspect the first five elements."}, {"owner": {"reputation": 57219, "user_id": 33796, "user_type": "registered", "accept_rate": 70, "profile_image": "https://www.gravatar.com/avatar/08727b23ba62e634b32988cdff082663?s=128&d=identicon&r=PG", "display_name": "luqui", "link": "https://stackoverflow.com/users/33796/luqui"}, "reply_to_user": {"reputation": 209, "user_id": 7658944, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/197708885c5d718abd5711f49b17c6e0?s=128&d=identicon&r=PG&f=1", "display_name": "Robert", "link": "https://stackoverflow.com/users/7658944/robert"}, "edited": false, "score": 1, "creation_date": 1530000064, "post_id": 51026886, "comment_id": 89067049, "body": "@RobertK, understanding a Haskell list as a &quot;singly linked list whose tail is possibly a generator&quot; is essential if such thought is to be productive."}, {"owner": {"reputation": 209, "user_id": 7658944, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/197708885c5d718abd5711f49b17c6e0?s=128&d=identicon&r=PG&f=1", "display_name": "Robert", "link": "https://stackoverflow.com/users/7658944/robert"}, "reply_to_user": {"reputation": 57219, "user_id": 33796, "user_type": "registered", "accept_rate": 70, "profile_image": "https://www.gravatar.com/avatar/08727b23ba62e634b32988cdff082663?s=128&d=identicon&r=PG", "display_name": "luqui", "link": "https://stackoverflow.com/users/33796/luqui"}, "edited": false, "score": 0, "creation_date": 1530006142, "post_id": 51026886, "comment_id": 89070628, "body": "@luqui yes ofcourse, thanks for adding that. I forgot that it is not clear to newcomers how haskell lists are defined."}], "answers": [{"comments": [{"owner": {"reputation": 479, "user_id": 4496701, "user_type": "registered", "accept_rate": 25, "profile_image": "https://lh5.googleusercontent.com/-SST61v329Q0/AAAAAAAAAAI/AAAAAAAAAFM/ihwdZ1nZE7Q/photo.jpg?sz=128", "display_name": "Cliff Stamp", "link": "https://stackoverflow.com/users/4496701/cliff-stamp"}, "edited": false, "score": 0, "creation_date": 1530115577, "post_id": 51038066, "comment_id": 89124164, "body": "Thanks, I have started a combination of using ghci, setting limits in the compiler, and just really trying to understand how to work with infinite lists."}], "tags": [], "owner": {"reputation": 58792, "user_id": 1006010, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/f683d229f3673c9dcc3f3f2796d75c09?s=128&d=identicon&r=PG", "display_name": "MathematicalOrchid", "link": "https://stackoverflow.com/users/1006010/mathematicalorchid"}, "is_accepted": false, "score": 1, "last_activity_date": 1530000966, "creation_date": 1530000966, "answer_id": 51038066, "question_id": 51026886, "link": "https://stackoverflow.com/questions/51026886/haskell-infinite-lists-hang/51038066#51038066", "title": "Haskell + Infinite lists = Hang", "body": "<p>As noted in the comments, you can run your executable with the <code>-M</code> switch, which allows you to specify a maximum memory size. (Default is unlimited.) That way, if your program tries to use more than X amount of memory, it will crash with an exception rather than just consume all available RAM.</p>\n\n<p>Note that this <em>won't help</em> if your program is doing lots of processing but not trying to actually <em>keep</em> the results in RAM. E.g., if you try to print out the first item that matches a condition, but no item will ever match the condition, in all likelihood your program will loop forever, but not actually consume any RAM. In that case, you'll just have to kill it.</p>\n\n<p>You might also try running your code in GHCi, where you can just jab Ctrl+C to halt your code without killing GHCi itself.</p>\n"}], "owner": {"reputation": 479, "user_id": 4496701, "user_type": "registered", "accept_rate": 25, "profile_image": "https://lh5.googleusercontent.com/-SST61v329Q0/AAAAAAAAAAI/AAAAAAAAAFM/ihwdZ1nZE7Q/photo.jpg?sz=128", "display_name": "Cliff Stamp", "link": "https://stackoverflow.com/users/4496701/cliff-stamp"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 146, "favorite_count": 0, "answer_count": 1, "score": 2, "last_activity_date": 1530000966, "creation_date": 1529940035, "last_edit_date": 1529945479, "question_id": 51026886, "link": "https://stackoverflow.com/questions/51026886/haskell-infinite-lists-hang", "title": "Haskell + Infinite lists = Hang", "body": "<p>I am learning Haskell, have read a few references, and am working on various challenges (mainly codewars). However at times I will attempt to generate an infinite list for some math algorithm and then pick from it (like get the first n numbers which match some pattern). </p>\n\n<p>However because my syntax isn't perfect I often mix up parts and while I want to ask Haskell to define (lazy) an infinite list and pick the first 5 elements (or whatever) I end up actually asking it to do something with the full infinite list and when I build-test it, the program just hangs.</p>\n\n<p>I managed (once) to call up the Windows process manager and what is happening is that in Visual Studio Code when it build and executes the executable it just grows extremely fast absorbing all memory and processor until the computer becomes non-responsive. </p>\n\n<p>Is there some kind of compiler flag that can prevent this?</p>\n"}, {"tags": ["haskell"], "answers": [{"tags": [], "owner": {"reputation": 4071, "user_id": 3806046, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/5fedf50ce7cd2659bca902e9a2969158?s=128&d=identicon&r=PG&f=1", "display_name": "jkeuhlen", "link": "https://stackoverflow.com/users/3806046/jkeuhlen"}, "is_accepted": true, "score": 6, "last_activity_date": 1529936833, "creation_date": 1529936833, "answer_id": 51025848, "question_id": 51025709, "link": "https://stackoverflow.com/questions/51025709/reexport-a-function-from-a-module/51025848#51025848", "title": "reexport a function from a module", "body": "<p>Yes, you can selectively re-export functions: </p>\n\n<pre><code>module A (\n  module A,\n  Maybe.fromMaybe ) where \n\nimport qualified Data.Maybe as Maybe\n</code></pre>\n\n<p>The piece in <code>()</code> after the module definition defines what you are exporting. Here we say \"export all of <code>module A</code> along with the function <code>Maybe.fromMaybe</code>.\"</p>\n"}], "owner": {"reputation": 2740, "user_id": 832847, "user_type": "registered", "accept_rate": 40, "profile_image": "https://www.gravatar.com/avatar/8d537be713ae7b9be79f446de62e61f7?s=128&d=identicon&r=PG", "display_name": "Leo Zhang", "link": "https://stackoverflow.com/users/832847/leo-zhang"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 536, "favorite_count": 0, "accepted_answer_id": 51025848, "answer_count": 1, "score": 4, "last_activity_date": 1529936833, "creation_date": 1529936400, "question_id": 51025709, "link": "https://stackoverflow.com/questions/51025709/reexport-a-function-from-a-module", "title": "reexport a function from a module", "body": "<p>I have a module like this</p>\n\n<pre><code>module A where\n\nimport qualified Data.Maybe as Maybe\n\nfromMaybe = Maybe.fromMaybe\n</code></pre>\n\n<p>Is it possible to re-export just some functions from <code>Data.Maybe</code>? I don't want to re-export the entire <code>Data.Maybe</code> module, but just some functions, like <code>fromMaybe</code>.</p>\n"}, {"tags": ["haskell", "random", "io", "int"], "answers": [{"tags": [], "owner": {"reputation": 126897, "user_id": 791604, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/ce991df7a056248d5e4f6fc3659ba733?s=128&d=identicon&r=PG", "display_name": "Daniel Wagner", "link": "https://stackoverflow.com/users/791604/daniel-wagner"}, "is_accepted": false, "score": 2, "last_activity_date": 1529930189, "creation_date": 1529930189, "answer_id": 51023654, "question_id": 51023368, "link": "https://stackoverflow.com/questions/51023368/how-to-generate-random-int-in-haskell/51023654#51023654", "title": "How to generate random Int in Haskell?", "body": "<p>You can't convert an <code>IO a</code> to an <code>a</code>; but you can convert a function which consumes an <code>a</code> into one that consumes an <code>IO a</code> instead. The two most important conversions are these:</p>\n\n<pre><code>(&lt;$&gt;) :: (a -&gt;    b) -&gt; (IO a -&gt; IO b)\n(=&lt;&lt;) :: (a -&gt; IO b) -&gt; (IO a -&gt; IO b)\n</code></pre>\n\n<p>Since the function you want to use, namely, <code>\\index -&gt; [1,2,3] !! index</code>, does not have an <code>IO</code> return type, <code>(&lt;$&gt;)</code> is the more appropriate one for you. So:</p>\n\n<pre><code>System.Random&gt; (\\index -&gt; [1,2,3] !! index) &lt;$&gt; randomRIO (0, 2)\n1\n</code></pre>\n"}, {"comments": [{"owner": {"reputation": 126897, "user_id": 791604, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/ce991df7a056248d5e4f6fc3659ba733?s=128&d=identicon&r=PG", "display_name": "Daniel Wagner", "link": "https://stackoverflow.com/users/791604/daniel-wagner"}, "edited": false, "score": 0, "creation_date": 1529931763, "post_id": 51023992, "comment_id": 89040674, "body": "I have often wondered whether it is possible for beginners to make good use of <code>do</code> notation without first having a firm grasp of <code>(&gt;&gt;=)</code> or similar. sigfpe&#39;s <a href=\"http://blog.sigfpe.com/2007/11/io-monad-for-people-who-simply-dont.html\" rel=\"nofollow noreferrer\">The IO Monad for People who Simply Don&#39;t Care</a> article is the closest I&#39;ve seen to a tutorial that takes that possibility seriously, so if you like this answer, I highly recommend it as a next step for understanding how to use <code>do</code> blocks properly."}, {"owner": {"reputation": 29, "user_id": 4357757, "user_type": "registered", "profile_image": "https://lh3.googleusercontent.com/-_afv_t9QQh8/AAAAAAAAAAI/AAAAAAAAADY/y3mMz-6eIwM/photo.jpg?sz=128", "display_name": "Felipe Emerson", "link": "https://stackoverflow.com/users/4357757/felipe-emerson"}, "edited": false, "score": 0, "creation_date": 1529943809, "post_id": 51023992, "comment_id": 89048223, "body": "but my real code is: <code>newCard:: Card newCard = do   index &lt;- randomRIO(0,7)   return  (getCards deck) !! index</code> i want to return a Card, but it is IO Card"}, {"owner": {"reputation": 100892, "user_id": 745903, "user_type": "registered", "accept_rate": 74, "profile_image": "https://www.gravatar.com/avatar/50933f6638836741e620669b3940410e?s=128&d=identicon&r=PG", "display_name": "leftaroundabout", "link": "https://stackoverflow.com/users/745903/leftaroundabout"}, "edited": false, "score": 1, "creation_date": 1529958431, "post_id": 51023992, "comment_id": 89054979, "body": "\u201ci want to return a Card\u201d \u2013 no you don&#39;t. Unless you want that every card in every game is the same."}, {"owner": {"reputation": 29, "user_id": 4357757, "user_type": "registered", "profile_image": "https://lh3.googleusercontent.com/-_afv_t9QQh8/AAAAAAAAAAI/AAAAAAAAADY/y3mMz-6eIwM/photo.jpg?sz=128", "display_name": "Felipe Emerson", "link": "https://stackoverflow.com/users/4357757/felipe-emerson"}, "edited": false, "score": 0, "creation_date": 1529966142, "post_id": 51023992, "comment_id": 89057519, "body": "@leftaroundabout so it&#39;s only possible to generate random numbers in the output? Thanks for your help. Is that I saw this System.Random package and thought I could use it to do things like this that I wanted ..."}], "tags": [], "owner": {"reputation": 100892, "user_id": 745903, "user_type": "registered", "accept_rate": 74, "profile_image": "https://www.gravatar.com/avatar/50933f6638836741e620669b3940410e?s=128&d=identicon&r=PG", "display_name": "leftaroundabout", "link": "https://stackoverflow.com/users/745903/leftaroundabout"}, "is_accepted": true, "score": 6, "last_activity_date": 1529931979, "last_edit_date": 1529931979, "creation_date": 1529931260, "answer_id": 51023992, "question_id": 51023368, "link": "https://stackoverflow.com/questions/51023368/how-to-generate-random-int-in-haskell/51023992#51023992", "title": "How to generate random Int in Haskell?", "body": "<blockquote>\n  <p>...this code: <code>randomRIO (0, 2 :: Int)</code>. But its generate a <code>IO Int</code>...</p>\n</blockquote>\n\n<p>no, it <strong>is</strong> an <code>IO Int</code> value. Such a value is similar to a \u201cfunction\u201d <code>int f()</code> in a procedural language. If this were, say, Python, then you could also not just write</p>\n\n<pre class=\"lang-py prettyprint-override\"><code>Python 3.5.2 (default, Nov 23 2017, 16:37:01) \nType 'copyright', 'credits' or 'license' for more information\nIPython 6.1.0 -- An enhanced Interactive Python. Type '?' for help.\n\nIn [1]: import random\n\nIn [2]: def f():\n   ...:     return random.randint(0,2)\n   ...: \n\nIn [3]: [1,2,3][f]\n---------------------------------------------------------------------------\nTypeError                                 Traceback (most recent call last)\n&lt;ipython-input-3-74d3c2a164a4&gt; in &lt;module&gt;()\n----&gt; 1 [1,2,3][f]\n\nTypeError: list indices must be integers or slices, not function\n</code></pre>\n\n<p>Instead, you need to <em>invoke</em> the action. Only that will in fact yield an <code>Int</code> number. In most languages, this is done simply by supplying arguments, in this case just the empty tuple <code>()</code>:</p>\n\n<pre><code>In [4]: [1,2,3][f()]\nOut[4]: 2\n</code></pre>\n\n<p>But that's mingling two different concepts, namely supplying arguments and causing side-effects. (The side-effect is in this case the modification of the built-in random generator's state, so you won't get every time the same number.)</p>\n\n<p>Haskell does it better, it has dedicated operators for sorting out the order of side-effects. As Daniel Wagner said, these are <code>fmap</code> and <code>&gt;&gt;=</code>. But if those infix-operators and higher-order type signatures look cryptic to you, you can also use Haskell's <code>do</code> notation, which is actually just syntactic sugar for the same thing:</p>\n\n<pre><code>main :: IO ()\nmain = do\n   randomIndex &lt;- randomRIO (0,2)\n   print $ [1,2,3] !! randomIndex\n</code></pre>\n\n<p>or, at the ghci prompt (which is essentially one big <code>IO</code>-<code>do</code>-block)</p>\n\n<pre><code>GHCi, version 8.2.1: http://www.haskell.org/ghc/  :? for help\nLoaded GHCi configuration from /home/sagemuej/.ghci\nLoaded GHCi configuration from /home/sagemuej/.ghc/ghci.conf\nPrelude&gt; :m +System.Random\nPrelude System.Random&gt; randomIndex &lt;- randomRIO (0,2 :: Int)\nPrelude System.Random&gt; [1,2,3] !! randomIndex\n1\n</code></pre>\n\n<p>The difference between <code>foo &lt;- action</code> and <code>let foo = action</code> is similar as in Python the difference between <code>foo = action()</code> and <code>foo = action</code>.</p>\n"}], "owner": {"reputation": 29, "user_id": 4357757, "user_type": "registered", "profile_image": "https://lh3.googleusercontent.com/-_afv_t9QQh8/AAAAAAAAAAI/AAAAAAAAADY/y3mMz-6eIwM/photo.jpg?sz=128", "display_name": "Felipe Emerson", "link": "https://stackoverflow.com/users/4357757/felipe-emerson"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 2178, "favorite_count": 0, "closed_date": 1529937996, "accepted_answer_id": 51023992, "answer_count": 2, "score": 1, "last_activity_date": 1529938011, "creation_date": 1529929242, "question_id": 51023368, "link": "https://stackoverflow.com/questions/51023368/how-to-generate-random-int-in-haskell", "closed_reason": "Duplicate", "title": "How to generate random Int in Haskell?", "body": "<p>i'm trying to generate a random index (Int), with this code: <code>randomRIO (0, 2 :: Int)</code>. But its generate a IO Int, so i cant do something like this: <code>[1,2,3] !! randomIndex</code>. What does it have to be done to convert the IO Int to Int? Thanks.</p>\n"}, {"tags": ["haskell"], "comments": [{"owner": {"reputation": 3248, "user_id": 5707684, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/wrGFn.jpg?s=128&g=1", "display_name": "Elmex80s", "link": "https://stackoverflow.com/users/5707684/elmex80s"}, "edited": false, "score": 1, "creation_date": 1529918069, "post_id": 51017223, "comment_id": 89032413, "body": "Little tip: you can put them right below the <code>where</code> without additional indentation. This saves you horizontal (screen) space."}, {"owner": {"reputation": 384463, "user_id": 1126841, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/fa05233b2357f8d11c22ef4cfc7bb85c?s=128&d=identicon&r=PG", "display_name": "chepner", "link": "https://stackoverflow.com/users/1126841/chepner"}, "edited": false, "score": 1, "creation_date": 1530042540, "post_id": 51017223, "comment_id": 89091797, "body": "Off-topic, but instead of explicitly defining an uncurried version of <code>(&lt;=)</code> and using <code>map</code>, you can use <code>zipWith</code>: <code>nondec xs = and (zipWith (&lt;=) xs (tail xs))</code>."}], "answers": [{"comments": [{"owner": {"reputation": 10378, "user_id": 2476735, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/39e9447bbc32246fcd23b76b5e946618?s=128&d=identicon&r=PG&f=1", "display_name": "David Young", "link": "https://stackoverflow.com/users/2476735/david-young"}, "edited": false, "score": 3, "creation_date": 1529913394, "post_id": 51017299, "comment_id": 89029835, "body": "It might be worth pointing out that this is significantly more indented than necessary. I usually would just indent 2 spaces there (and some people like 4 spaces)."}, {"owner": {"reputation": 11096, "user_id": 2749717, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/46af1ef54856d737d52b7667afd240ee?s=128&d=identicon&r=PG&f=1", "display_name": "bipll", "link": "https://stackoverflow.com/users/2749717/bipll"}, "reply_to_user": {"reputation": 10378, "user_id": 2476735, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/39e9447bbc32246fcd23b76b5e946618?s=128&d=identicon&r=PG&f=1", "display_name": "David Young", "link": "https://stackoverflow.com/users/2476735/david-young"}, "edited": false, "score": 1, "creation_date": 1529915966, "post_id": 51017299, "comment_id": 89031172, "body": "@DavidYoung Sure, it is merely to emphasize that both statements belong to the where block."}, {"owner": {"reputation": 126499, "user_id": 1531124, "user_type": "registered", "accept_rate": 96, "profile_image": "https://i.stack.imgur.com/zw18i.png?s=128&g=1", "display_name": "GhostCat", "link": "https://stackoverflow.com/users/1531124/ghostcat"}, "edited": false, "score": 0, "creation_date": 1529926537, "post_id": 51017299, "comment_id": 89037438, "body": "Unreleated: you put the java tag on <a href=\"https://stackoverflow.com/questions/51022476/why-foreach-loop-iterates-more-than-the-no-of-items\" title=\"why foreach loop iterates more than the no of items\">stackoverflow.com/questions/51022476/&hellip;</a> ... that is for sure NOT java. Please be a bit more careful with such edits! I think this would rather be C# ?!"}], "tags": [], "owner": {"reputation": 11096, "user_id": 2749717, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/46af1ef54856d737d52b7667afd240ee?s=128&d=identicon&r=PG&f=1", "display_name": "bipll", "link": "https://stackoverflow.com/users/2749717/bipll"}, "is_accepted": false, "score": 2, "last_activity_date": 1529907434, "creation_date": 1529907434, "answer_id": 51017299, "question_id": 51017223, "link": "https://stackoverflow.com/questions/51017223/can-i-define-more-than-one-function-under-the-where-syntax/51017299#51017299", "title": "Can I define more than one function under the where syntax?", "body": "<p>Indent, as usual:</p>\n\n<pre><code>nondec :: Ord a =&gt; [a] -&gt; String\nnondec as = map leq as where\n                          leq = id\n                          map _ _ = \"Hi!\"\n</code></pre>\n"}, {"tags": [], "owner": {"reputation": 153048, "user_id": 9204, "user_type": "registered", "accept_rate": 82, "profile_image": "https://www.gravatar.com/avatar/c79937a093ff9e963c563e22cd385f30?s=128&d=identicon&r=PG", "display_name": "Alexey Romanov", "link": "https://stackoverflow.com/users/9204/alexey-romanov"}, "is_accepted": true, "score": 3, "last_activity_date": 1529912175, "creation_date": 1529912175, "answer_id": 51018353, "question_id": 51017223, "link": "https://stackoverflow.com/questions/51017223/can-i-define-more-than-one-function-under-the-where-syntax/51018353#51018353", "title": "Can I define more than one function under the where syntax?", "body": "<blockquote>\n  <p>can I define it as this</p>\n</blockquote>\n\n<p>Why not try it? Because yes, you can do it exactly like this. <code>leq</code> and <code>map</code> just need to start in the same column and to the right of the column where the line with <code>where</code> starts (not necessarily to the right of <code>where</code> itself). </p>\n\n<p>I think the Wikibook <a href=\"https://en.wikibooks.org/wiki/Haskell/Indentation#The_golden_rule_of_indentation\" rel=\"nofollow noreferrer\">explains the rules for indentation</a> quite well.</p>\n"}], "owner": {"reputation": 1377, "user_id": 8314628, "user_type": "registered", "accept_rate": 88, "profile_image": "https://www.gravatar.com/avatar/0eefa2c64f533d21e1d8f58e4252a1e9?s=128&d=identicon&r=PG&f=1", "display_name": "user8314628", "link": "https://stackoverflow.com/users/8314628/user8314628"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 75, "favorite_count": 0, "accepted_answer_id": 51018353, "answer_count": 2, "score": 0, "last_activity_date": 1529912175, "creation_date": 1529907023, "question_id": 51017223, "link": "https://stackoverflow.com/questions/51017223/can-i-define-more-than-one-function-under-the-where-syntax", "title": "Can I define more than one function under the where syntax?", "body": "<p>I just see an example, which is checking if a list is nondescendant</p>\n\n<pre><code>nondec :: Ord a =&gt; [a] -&gt; Bool\nnondec xs = and (map leq (zip xs (tail xs)))\n            where leq (x, y) = x &lt;= y\n</code></pre>\n\n<p>I'm wondering can I define more than one function under the where syntax.</p>\n\n<p>For example, if the map function is undefined, can I define it as this</p>\n\n<pre><code>where leq (x, y) = x &lt;= y\n      map(...)\n</code></pre>\n"}, {"tags": ["haskell"], "comments": [{"owner": {"reputation": 57219, "user_id": 33796, "user_type": "registered", "accept_rate": 70, "profile_image": "https://www.gravatar.com/avatar/08727b23ba62e634b32988cdff082663?s=128&d=identicon&r=PG", "display_name": "luqui", "link": "https://stackoverflow.com/users/33796/luqui"}, "edited": false, "score": 2, "creation_date": 1529897880, "post_id": 51015937, "comment_id": 89024470, "body": "<code>|</code> is called a <i>guard</i>, btw"}, {"owner": {"reputation": 57219, "user_id": 33796, "user_type": "registered", "accept_rate": 70, "profile_image": "https://www.gravatar.com/avatar/08727b23ba62e634b32988cdff082663?s=128&d=identicon&r=PG", "display_name": "luqui", "link": "https://stackoverflow.com/users/33796/luqui"}, "edited": false, "score": 0, "creation_date": 1529897938, "post_id": 51015937, "comment_id": 89024479, "body": "Perhaps the <a href=\"http://hackage.haskell.org/package/base-4.11.1.0/docs/Data-Bool.html#v:bool\" rel=\"nofollow noreferrer\"><code>bool</code></a> function counts (because of laziness)"}, {"owner": {"reputation": 78982, "user_id": 1848654, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/84180c0f3c9c04f8b8f0613fc0129dac?s=128&d=identicon&r=PG", "display_name": "melpomene", "link": "https://stackoverflow.com/users/1848654/melpomene"}, "edited": false, "score": 1, "creation_date": 1529899527, "post_id": 51015937, "comment_id": 89024770, "body": "<code>[e, t] !! fromEnum c</code>"}, {"owner": {"reputation": 57219, "user_id": 33796, "user_type": "registered", "accept_rate": 70, "profile_image": "https://www.gravatar.com/avatar/08727b23ba62e634b32988cdff082663?s=128&d=identicon&r=PG", "display_name": "luqui", "link": "https://stackoverflow.com/users/33796/luqui"}, "reply_to_user": {"reputation": 78982, "user_id": 1848654, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/84180c0f3c9c04f8b8f0613fc0129dac?s=128&d=identicon&r=PG", "display_name": "melpomene", "link": "https://stackoverflow.com/users/1848654/melpomene"}, "edited": false, "score": 0, "creation_date": 1529905703, "post_id": 51015937, "comment_id": 89026424, "body": "<a href=\"http://hackage.haskell.org/package/comonad-5.0.3/docs/Control-Comonad.html#v:extract\" rel=\"nofollow noreferrer\"><code>extract</code></a><code>(getMax (</code><a href=\"http://hackage.haskell.org/package/base-4.11.1.0/docs/Data-Semigroup.html#t:Max\" rel=\"nofollow noreferrer\"><code>Max</code></a><code>(</code><a href=\"http://hackage.haskell.org/package/base-4.11.1.0/docs/Data-Semigroup.html#t:Arg\" rel=\"nofollow noreferrer\"><code>Arg</code></a><code>False f) &lt;&gt; Max (Arg c t)))</code> @melpomene"}, {"owner": {"reputation": 189, "user_id": 8179137, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/46b43fe26a1b6191280614f56683525d?s=128&d=identicon&r=PG&f=1", "display_name": "Potato44", "link": "https://stackoverflow.com/users/8179137/potato44"}, "edited": false, "score": 0, "creation_date": 1529979063, "post_id": 51015937, "comment_id": 89060020, "body": "<code>last$e:[t|c]</code> is a well known code golf spelling of if-then-else"}], "answers": [{"comments": [{"owner": {"reputation": 14582, "user_id": 2225384, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/f30b04ed4d0b3fc4bc791a28815f34ca?s=128&d=identicon&r=PG", "display_name": "Rein Henrichs", "link": "https://stackoverflow.com/users/2225384/rein-henrichs"}, "edited": false, "score": 0, "creation_date": 1529954199, "post_id": 51016909, "comment_id": 89053120, "body": "This is also a handy illustration of <code>($) = id</code>."}], "tags": [], "owner": {"reputation": 208473, "user_id": 126014, "user_type": "registered", "accept_rate": 86, "profile_image": "https://www.gravatar.com/avatar/33526616d4a11f1630d4939b769cfbf9?s=128&d=identicon&r=PG", "display_name": "Mark Seemann", "link": "https://stackoverflow.com/users/126014/mark-seemann"}, "is_accepted": true, "score": 5, "last_activity_date": 1529905204, "creation_date": 1529905204, "answer_id": 51016909, "question_id": 51015937, "link": "https://stackoverflow.com/questions/51015937/how-many-ways-we-can-use-to-represent-if-else-statement-in-haskell/51016909#51016909", "title": "How many ways we can use to represent if else statement in Haskell?", "body": "<p>You can use <a href=\"http://programmable.computer/posts/church_encoding.html\" rel=\"noreferrer\">Church-encoded Booleans</a>:</p>\n\n<pre><code>Prelude&gt; true = \\t f -&gt; t\nPrelude&gt; false = \\t f -&gt; f\nPrelude&gt; iff = id\nPrelude&gt; iff true \"foo\" \"bar\"\n\"foo\"\nPrelude&gt; iff false 42 1337\n1337\n</code></pre>\n\n<p>The <code>iff</code> function works like an <code>if..then..else</code> expression, enabling you to choose between two values, like <code>\"foo\"</code> and <code>\"bar\"</code>, or <code>42</code> and <code>1337</code>. Rooted in lambda calculus, this is essentially the foundation of logical branching. See the linked article for more details.</p>\n\n<p>Not that I know why you'd do this, but you can...</p>\n"}], "owner": {"reputation": 1377, "user_id": 8314628, "user_type": "registered", "accept_rate": 88, "profile_image": "https://www.gravatar.com/avatar/0eefa2c64f533d21e1d8f58e4252a1e9?s=128&d=identicon&r=PG&f=1", "display_name": "user8314628", "link": "https://stackoverflow.com/users/8314628/user8314628"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 96, "favorite_count": 0, "accepted_answer_id": 51016909, "answer_count": 1, "score": 0, "last_activity_date": 1529905236, "creation_date": 1529897350, "last_edit_date": 1529905236, "question_id": 51015937, "link": "https://stackoverflow.com/questions/51015937/how-many-ways-we-can-use-to-represent-if-else-statement-in-haskell", "title": "How many ways we can use to represent if else statement in Haskell?", "body": "<p>So far I can only find 3 ways.</p>\n\n<p>First, <code>if-then-else</code></p>\n\n<p>Second, pattern matching</p>\n\n<p>Third, using <code>|</code>. I don't know what this called.</p>\n\n<p>Is there any other method to present <em>if else</em> statement in Haskell?</p>\n"}, {"tags": ["user-interface", "haskell", "gtk", "glade"], "answers": [{"tags": [], "owner": {"reputation": 24266, "user_id": 946226, "user_type": "registered", "accept_rate": 59, "profile_image": "https://www.gravatar.com/avatar/5823d09208b1e4b63bbfcd189492032c?s=128&d=identicon&r=PG", "display_name": "Joachim Breitner", "link": "https://stackoverflow.com/users/946226/joachim-breitner"}, "is_accepted": true, "score": 6, "last_activity_date": 1529934805, "last_edit_date": 1529934805, "creation_date": 1529890212, "answer_id": 51015264, "question_id": 51015178, "link": "https://stackoverflow.com/questions/51015178/how-to-get-rid-of-the-black-console-window-for-a-compiled-haskell-gui-applicatio/51015264#51015264", "title": "How to get rid of the black console window for a compiled Haskell GUI application", "body": "<p>Add this to your <code>.cabal</code> file:</p>\n\n<pre><code>if os(windows)\n    ghc-options: -optl-mwindows\n</code></pre>\n\n<p>If you don't use <code>cabal</code> for building your project, simply pass <code>-optl-mwindows</code> to <code>ghc</code>.</p>\n"}], "owner": {"reputation": 1270, "user_id": 2383766, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/bc13aeb9c9f89e097f48d815b81541d5?s=128&d=identicon&r=PG", "display_name": "Z-Y.L", "link": "https://stackoverflow.com/users/2383766/z-y-l"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 90, "favorite_count": 0, "accepted_answer_id": 51015264, "answer_count": 1, "score": 8, "last_activity_date": 1529934805, "creation_date": 1529889032, "question_id": 51015178, "link": "https://stackoverflow.com/questions/51015178/how-to-get-rid-of-the-black-console-window-for-a-compiled-haskell-gui-applicatio", "title": "How to get rid of the black console window for a compiled Haskell GUI application", "body": "<p>I have compiled a Haskell GUI application with <code>stack-1.7.1</code>, <code>ghc-8.2.2</code>, <code>gtk+-2.24.28</code> and <code>glade-3.8</code>. When I run the executable, a black console window always follows the GUI window. I want to get rid of it, but I don't find any tips about Haskell GUI application. I'm still new to Haskell, especially to the Haskell compilation. So I'm sorry if this is an easy task, but I appreciate it if anybody could give me some tips. </p>\n"}, {"tags": ["haskell", "lazy-evaluation", "state-monad", "io-monad"], "comments": [{"owner": {"reputation": 11366, "user_id": 3922954, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/76ba47d2fdd24ab56b0b273cce2075e5?s=128&d=identicon&r=PG&f=1", "display_name": "AJF", "link": "https://stackoverflow.com/users/3922954/ajf"}, "edited": false, "score": 1, "creation_date": 1529873413, "post_id": 51013774, "comment_id": 89020340, "body": "Your assumption here is incorrect: <code>IO [WArticle]</code> is still lazy in the evaluation each element of the list. <code>IO</code> does not force strictness. An example of this would be executing the code <code>do {a &lt;- return [undefined,1]; print (a !! 1)}</code>. Long story short, using <code>[IO Article]</code>s just makes life harder for yourself."}, {"owner": {"reputation": 24266, "user_id": 946226, "user_type": "registered", "accept_rate": 59, "profile_image": "https://www.gravatar.com/avatar/5823d09208b1e4b63bbfcd189492032c?s=128&d=identicon&r=PG", "display_name": "Joachim Breitner", "link": "https://stackoverflow.com/users/946226/joachim-breitner"}, "edited": false, "score": 0, "creation_date": 1529883817, "post_id": 51013774, "comment_id": 89022351, "body": "Not a direct answer, but <a href=\"http://hackage.haskell.org/package/conduit\" rel=\"nofollow noreferrer\">conduit</a> and similar libraries provide precisely that feature: Process large \u201clists\u201d of data with more explicit resource control."}, {"owner": {"reputation": 55, "user_id": 8894406, "user_type": "registered", "profile_image": "https://lh3.googleusercontent.com/-vASk_Ko7zO0/AAAAAAAAAAI/AAAAAAAAArM/sSAnt1v1xL8/photo.jpg?sz=128", "display_name": "Mattias Bermell Rudfeldt", "link": "https://stackoverflow.com/users/8894406/mattias-bermell-rudfeldt"}, "reply_to_user": {"reputation": 11366, "user_id": 3922954, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/76ba47d2fdd24ab56b0b273cce2075e5?s=128&d=identicon&r=PG&f=1", "display_name": "AJF", "link": "https://stackoverflow.com/users/3922954/ajf"}, "edited": false, "score": 0, "creation_date": 1529907477, "post_id": 51013774, "comment_id": 89027073, "body": "@AJFarmar, thank you for your answer. So the question should be rephrased to &quot;Why is laziness broken?&quot;? As <code>do {db &lt;- buildDB url 3}</code> prints out trace messages for downloading all articles right away (trace messages are printed in <code>getArticle</code> which is not cited here)."}], "answers": [{"comments": [{"owner": {"reputation": 55, "user_id": 8894406, "user_type": "registered", "profile_image": "https://lh3.googleusercontent.com/-vASk_Ko7zO0/AAAAAAAAAAI/AAAAAAAAArM/sSAnt1v1xL8/photo.jpg?sz=128", "display_name": "Mattias Bermell Rudfeldt", "link": "https://stackoverflow.com/users/8894406/mattias-bermell-rudfeldt"}, "edited": false, "score": 0, "creation_date": 1529961373, "post_id": 51031803, "comment_id": 89056142, "body": "Cheers! I&#39;ll look into this. I must have updated the question while you were typing the your answer. Sorry! I&#39;ll suggest an edit to improve readability for future readers."}, {"owner": {"reputation": 55, "user_id": 8894406, "user_type": "registered", "profile_image": "https://lh3.googleusercontent.com/-vASk_Ko7zO0/AAAAAAAAAAI/AAAAAAAAArM/sSAnt1v1xL8/photo.jpg?sz=128", "display_name": "Mattias Bermell Rudfeldt", "link": "https://stackoverflow.com/users/8894406/mattias-bermell-rudfeldt"}, "edited": false, "score": 0, "creation_date": 1530098636, "post_id": 51031803, "comment_id": 89112879, "body": "<code>Streaming.Prelude.toHandle</code> seemed appropriate for writing to file. So with <code>db :: Stream (Of WArticle) IO ()</code> i did <code>main = do {handle &lt;- System.IO.openFile &quot;outfile.txt&quot; WriteMode; S.toHandle handle $ S.show db</code>. It still consumes A LOT of RAM but never reaches above ~450 MB no matter how many articles it downloads. I guess that&#39;s because I have RAM to spare."}], "tags": [], "owner": {"reputation": 24211, "user_id": 1364288, "user_type": "registered", "accept_rate": 88, "profile_image": "https://i.stack.imgur.com/JVtNl.png?s=128&g=1", "display_name": "danidiaz", "link": "https://stackoverflow.com/users/1364288/danidiaz"}, "is_accepted": true, "score": 2, "last_activity_date": 1529961815, "last_edit_date": 1529961815, "creation_date": 1529960849, "answer_id": 51031803, "question_id": 51013774, "link": "https://stackoverflow.com/questions/51013774/where-is-the-memory-leak-in-using-statet-s-io-a/51031803#51031803", "title": "Where is the memory leak in using StateT s IO a?", "body": "<blockquote>\n  <p>2) Is [IO WArticle] want I want in this case?</p>\n</blockquote>\n\n<p>Not quite. The problem is that some of the <code>IO WArticle</code> actions depend on the result of a previous action: the links to future pages reside in previously obtained pages. <code>[IO Warticle]</code> can't provide that: it is pure in the sense that you can always find an action in the list without executing the previous actions.</p>\n\n<p>What we need is a kind of \"effectful list\" that lets us extract articles one by one, progressively performing the neccessary effects, but not forcing us to completely generate the list in one go.</p>\n\n<p>There are several libraries that provide these kinds of \"effectful lists\": <a href=\"http://hackage.haskell.org/package/streaming-0.2.1.0\" rel=\"nofollow noreferrer\">streaming</a>, <a href=\"http://hackage.haskell.org/package/pipes\" rel=\"nofollow noreferrer\">pipes</a>, <a href=\"http://hackage.haskell.org/package/conduit\" rel=\"nofollow noreferrer\">conduit</a>. They define monad transformers that extend a base monad with the ability to <a href=\"http://hackage.haskell.org/package/streaming-0.2.1.0/docs/Streaming-Prelude.html#v:yield\" rel=\"nofollow noreferrer\">yield</a> intermediate values before returning a final result. Usually the final result is of a type different from the values that are yielded; it might be simply unit <code>()</code>.</p>\n\n<p><strong>Note:</strong> The <code>Functor</code>, <code>Applicative</code> and <code>Monad</code> instances for these libraries differ from the corresponding instances for pure lists. The <a href=\"http://hackage.haskell.org/package/streaming-0.2.1.0/docs/Streaming.html#t:Stream\" rel=\"nofollow noreferrer\"><code>Functor</code></a> <a href=\"http://hackage.haskell.org/package/conduit-1.3.0.3/docs/Data-Conduit.html\" rel=\"nofollow noreferrer\">instances</a> map over the <em>resulting</em> final value, not over the intermediate values which are yielded. To map over the yielded values, they provide <a href=\"http://hackage.haskell.org/package/streaming-0.2.1.0/docs/Streaming-Prelude.html#v:map\" rel=\"nofollow noreferrer\">separate functions</a>. And The <code>Monad</code> instances <em>sequence</em> effectful lists, instead of trying all combinations. To try all combinations, they provide <a href=\"http://hackage.haskell.org/package/streaming-0.2.1.0/docs/Streaming-Prelude.html#v:for\" rel=\"nofollow noreferrer\">separate functions</a>.</p>\n\n<p>Using the <a href=\"http://hackage.haskell.org/package/streaming-0.2.1.0\" rel=\"nofollow noreferrer\">streaming</a> library, we could modify <code>buildHelper</code> to something like this:</p>\n\n<pre><code>import Streaming\nimport qualified Streaming.Prelude as S\n\nbuildHelper :: CrawlState -&gt; Stream (Of WArticle) IO ()\nbuildHelper !cs@(CrawlState _ queue) = \n  if null queue\n    then return []\n    else do (article, cs') &lt;- liftIO (runStateT getNextNode cs)\n            S.yield article\n            buildHelper cs'\n</code></pre>\n\n<p>And then we could use functions like <a href=\"http://hackage.haskell.org/package/streaming-0.2.1.0/docs/Streaming-Prelude.html#v:mapM_\" rel=\"nofollow noreferrer\"><code>mapM_</code></a> (from <code>Streaming.Prelude</code>, not the one from <code>Control.Monad</code>!) to process the articles one by one, as  they are generated.</p>\n"}, {"comments": [{"owner": {"reputation": 24211, "user_id": 1364288, "user_type": "registered", "accept_rate": 88, "profile_image": "https://i.stack.imgur.com/JVtNl.png?s=128&g=1", "display_name": "danidiaz", "link": "https://stackoverflow.com/users/1364288/danidiaz"}, "edited": false, "score": 1, "creation_date": 1530123540, "post_id": 51068328, "comment_id": 89128131, "body": "You can use <code>System.IO.withFile</code> instead of <code>openFile</code>/<code>hClose</code>; it frees you from having to remember to close the handle. Working with <code>String</code>\u2014which is a linked list of characters\u2014can be inefficient, for some uses a packed representation like <code>Bytestring</code> or <code>Text</code> is better. Also, you can pass the <code>-M</code> option to the runtime to set the maximum heap size: <a href=\"http://downloads.haskell.org/~ghc/latest/docs/html/users_guide/runtime_control.html\" rel=\"nofollow noreferrer\">downloads.haskell.org/~ghc/latest/docs/html/users_guide/&hellip;</a>"}], "tags": [], "owner": {"reputation": 55, "user_id": 8894406, "user_type": "registered", "profile_image": "https://lh3.googleusercontent.com/-vASk_Ko7zO0/AAAAAAAAAAI/AAAAAAAAArM/sSAnt1v1xL8/photo.jpg?sz=128", "display_name": "Mattias Bermell Rudfeldt", "link": "https://stackoverflow.com/users/8894406/mattias-bermell-rudfeldt"}, "is_accepted": false, "score": 1, "last_activity_date": 1530120081, "creation_date": 1530120081, "answer_id": 51068328, "question_id": 51013774, "link": "https://stackoverflow.com/questions/51013774/where-is-the-memory-leak-in-using-statet-s-io-a/51068328#51068328", "title": "Where is the memory leak in using StateT s IO a?", "body": "<p>Adding a further explaination and code building upon the answer of danidiaz. Here's the final code: </p>\n\n<pre><code>import Streaming\nimport qualified Streaming.Prelude as S\nimport System.IO (IOMode (WriteMode), hClose, openFile)\n\nbuildHelper :: CrawlState -&gt; Stream (Of WArticle) IO ()\nbuildHelper cs@( CrawlState _ queue ) = \n  if null queue\n    then return ()\n    else do\n      (article, cs') &lt;- liftIO (runStateT getNextNode cs)\n      S.yield article\n      buildHelper cs'\n\nmain :: IO ()\nmain = do outFileHandle &lt;- openFile filename WriteMode\n          S.toHandle outFileHandle  . S.show . buildHelper $\n              CrawlState [] [(startUrl, recursionDepth)]\n          hClose outFileHandle\n</code></pre>\n\n<p><code>outFileHandle</code> is a usual file output handle. </p>\n\n<p><code>S.toHandle</code> takes a stream of String and writes them to the specified handle. </p>\n\n<p><code>S.show</code> maps <code>show :: WArticle -&gt; String</code> over the stream. </p>\n\n<p>An elegant solution that creates a lazy stream even though it is produced by a series of IO actions (namely downloading websites) and writes it to a file as results become available. On my machine it still uses a lot of memory (relative to the task) during execution but never exceeds 450 MB. </p>\n"}], "owner": {"reputation": 55, "user_id": 8894406, "user_type": "registered", "profile_image": "https://lh3.googleusercontent.com/-vASk_Ko7zO0/AAAAAAAAAAI/AAAAAAAAArM/sSAnt1v1xL8/photo.jpg?sz=128", "display_name": "Mattias Bermell Rudfeldt", "link": "https://stackoverflow.com/users/8894406/mattias-bermell-rudfeldt"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 667, "favorite_count": 0, "accepted_answer_id": 51031803, "answer_count": 2, "score": 4, "last_activity_date": 1530120081, "creation_date": 1529872860, "last_edit_date": 1529963205, "question_id": 51013774, "link": "https://stackoverflow.com/questions/51013774/where-is-the-memory-leak-in-using-statet-s-io-a", "title": "Where is the memory leak in using StateT s IO a?", "body": "<p><strong>Intention:</strong> Small application to learn Haskell: Downloads a wikipedia-article, then downloads all articles linked from it, then downloads all articles linked from them, and so on... until a specified recursion depth is reached. The result is saved to a file. </p>\n\n<p><strong>Approach:</strong> Use a <code>StateT</code> to keep track of the download queue, to download an article and to update the queue. I build a list <code>IO [WArticle]</code> recursively and then print it.  </p>\n\n<p><strong>Problem:</strong> While profiling I find that <em>total memory in use</em> is proportional to number of articles downloaded. </p>\n\n<p><strong>Analysis:</strong> By literature I'm lead to believe this is a laziness and/or strictness issue. BangPatterns reduced the memory consumed but didn't solve proportionality. Furthermore, I know all articles are downloaded before the file output is started. </p>\n\n<p><strong>Possible solutions:</strong> </p>\n\n<p>1) The function <code>getNextNode :: StateT CrawlState IO WArticle</code> (below) already has IO. One solution would be to just do the file writing in it and only return the state. It would mean the file is written to in very small chunks though. Doesn't feel very Haskell.. </p>\n\n<p>2) Have the function <code>buildHelper :: CrawlState -&gt; IO [WArticle]</code> (below) return <code>[IO WArticle]</code>. Though I wouldn't know how to rewrite that code and have been advised against it in the comments.  </p>\n\n<p>Are any of these proposed solutions better than I think they are or are there better alternatives? </p>\n\n<pre><code>import GetArticle (WArticle, getArticle, wa_links, wiki2File) -- my own\ntype URL = Text\n\ndata CrawlState =\n     CrawlState  ![URL]       ![(URL, Int)]\n          --    [Completed]    [(Queue, depth)]\n-- Called by user\nbuildDB :: URL -&gt; Int -&gt; IO [WArticle]\nbuildDB startURL recursionDepth = buildHelper cs\n    where cs = CrawlState [] [(startURL, recursionDepth)]\n\n-- Builds list recursively\nbuildHelper :: CrawlState -&gt; IO [WArticle]\nbuildHelper !cs@(CrawlState _ queue) = {-# SCC \"buildHelper\" #-}\n  if null queue\n    then return []\n    else do\n      (!article, !cs') &lt;- runStateT getNextNode cs\n      rest &lt;- buildHelper cs'\n      return (article:rest)\n\n-- State manipulation\ngetNextNode :: StateT CrawlState IO WArticle\ngetNextNode = {-# SCC \"getNextNode\" #-} do\n  CrawlState !parsed !queue@( (url, depth):queueTail ) &lt;- get\n  article &lt;- liftIO $ getArticle url\n  put $ CrawlState (url:parsed) (queueTail++ ( if depth &gt; 1\n          then let  !newUrls  = wa_links article \\\\ parsed\n                    !newUrls' = newUrls          \\\\ map fst queue\n                    in zip newUrls' (repeat (depth-1))\n          else []))\n  return article\n\nstartUrl = pack \"https://en.wikipedia.org/wiki/Haskell_(programming_language)\"\nrecursionDepth = 3\n\nmain :: IO ()\nmain =  {-# SCC \"DbMain\" #-}\n  buildDB startUrl recursionDepth\n   &gt;&gt;= return . wiki2File\n   &gt;&gt;= writeFile \"savedArticles.txt\"\n</code></pre>\n\n<p>Full code at <a href=\"https://gitlab.com/mattias.br/sillyWikipediaSpider\" rel=\"nofollow noreferrer\">https://gitlab.com/mattias.br/sillyWikipediaSpider</a>. Current version limited to only download the first eight links from each page to save time. Without changing it download 55 pages at ~600 MB heap usage. </p>\n\n<p>Thanks for any help! </p>\n"}, {"tags": ["haskell", "math", "types"], "comments": [{"owner": {"reputation": 24028, "user_id": 383200, "user_type": "registered", "accept_rate": 60, "profile_image": "https://www.gravatar.com/avatar/a9dc722f936cb1059adaae4fe39c07f0?s=128&d=identicon&r=PG", "display_name": "Carl", "link": "https://stackoverflow.com/users/383200/carl"}, "edited": false, "score": 3, "creation_date": 1529860668, "post_id": 51012153, "comment_id": 89017082, "body": "Dependent types aren&#39;t necessary to express simpler laws like the one you are suggesting.  A proof-checker is.  Nearly all languages that  implement arbitrary proofs are dependently-typed, just because when you&#39;re going that far you might as well expand the universe of proofs allowed by also allowing dependent types."}, {"owner": {"reputation": 4234, "user_id": 4942760, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/f322d06b4f3e34278f29a954e0f38cb1?s=128&d=identicon&r=PG&f=1", "display_name": "Dan Robertson", "link": "https://stackoverflow.com/users/4942760/dan-robertson"}, "edited": false, "score": 0, "creation_date": 1529868338, "post_id": 51012153, "comment_id": 89019180, "body": "Regarding 1., another thing one might ask is how one should approach python/java to deal with the lack or deficiencies of their type systems."}, {"owner": {"reputation": 24211, "user_id": 1364288, "user_type": "registered", "accept_rate": 88, "profile_image": "https://i.stack.imgur.com/JVtNl.png?s=128&g=1", "display_name": "danidiaz", "link": "https://stackoverflow.com/users/1364288/danidiaz"}, "edited": false, "score": 2, "creation_date": 1529871563, "post_id": 51012153, "comment_id": 89019927, "body": "One approach in to translate the code into a language like Coq <a href=\"https://github.com/antalsz/hs-to-coq\" rel=\"nofollow noreferrer\">github.com/antalsz/hs-to-coq</a> and verify it there. <a href=\"http://hackage.haskell.org/package/containers-verified\" rel=\"nofollow noreferrer\">hackage.haskell.org/package/containers-verified</a> Another approach is to renounce a formal proof and use generative testing to try to find counterexamples to the properties <a href=\"http://austinrochford.com/posts/2014-05-27-quickcheck-laws.html\" rel=\"nofollow noreferrer\">austinrochford.com/posts/2014-05-27-quickcheck-laws.html</a>"}, {"owner": {"reputation": 24266, "user_id": 946226, "user_type": "registered", "accept_rate": 59, "profile_image": "https://www.gravatar.com/avatar/5823d09208b1e4b63bbfcd189492032c?s=128&d=identicon&r=PG", "display_name": "Joachim Breitner", "link": "https://stackoverflow.com/users/946226/joachim-breitner"}, "reply_to_user": {"reputation": 24211, "user_id": 1364288, "user_type": "registered", "accept_rate": 88, "profile_image": "https://i.stack.imgur.com/JVtNl.png?s=128&g=1", "display_name": "danidiaz", "link": "https://stackoverflow.com/users/1364288/danidiaz"}, "edited": false, "score": 1, "creation_date": 1529889740, "post_id": 51012153, "comment_id": 89023194, "body": "To expand on @danidiaz comment: the <code>hs-to-coq</code> project actually defines what it means for a <code>Monoid</code> to be lawful, and later proves that for the <code>Set</code> instances: <a href=\"https://github.com/antalsz/hs-to-coq/blob/d875d8ffe59b62e453dc8dd8b45af1842d03bdc5/base-thy/GHC/Base.v#L309\" rel=\"nofollow noreferrer\">github.com/antalsz/hs-to-coq/blob/&hellip;</a>"}], "answers": [{"comments": [{"owner": {"reputation": 225, "user_id": 2352867, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/sNljI.png?s=128&g=1", "display_name": "Tim", "link": "https://stackoverflow.com/users/2352867/tim"}, "edited": false, "score": 0, "creation_date": 1529867930, "post_id": 51012939, "comment_id": 89019083, "body": "This answer is great, thank you ! So is this example code that you give for Monoid something that you can actually compile in Haskell using <code>DataKinds</code>, or is it subtler than that ? I&#39;m really interested in HoTT but it&#39;s very much not my field of study, so am still getting to grips with a lot of the basics."}, {"owner": {"reputation": 4234, "user_id": 4942760, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/f322d06b4f3e34278f29a954e0f38cb1?s=128&d=identicon&r=PG&f=1", "display_name": "Dan Robertson", "link": "https://stackoverflow.com/users/4942760/dan-robertson"}, "reply_to_user": {"reputation": 225, "user_id": 2352867, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/sNljI.png?s=128&g=1", "display_name": "Tim", "link": "https://stackoverflow.com/users/2352867/tim"}, "edited": false, "score": 1, "creation_date": 1529868244, "post_id": 51012939, "comment_id": 89019162, "body": "The code I give is made up in the style of Haskell. I think if you want to prove things then I think you need something like idris or agda or coq. I vaguely recall there was some way to ask ghc to try to prove that two things are equal. It isn\u2019t perfect (it will apply the inliner and optimiser to both sides so only works for simple things)  but maybe someone will mention it."}, {"owner": {"reputation": 48938, "user_id": 246886, "user_type": "registered", "accept_rate": 94, "profile_image": "https://www.gravatar.com/avatar/dd1ebaade6623fc538fb8af3338e730d?s=128&d=identicon&r=PG", "display_name": "Jon Purdy", "link": "https://stackoverflow.com/users/246886/jon-purdy"}, "edited": false, "score": 1, "creation_date": 1529875379, "post_id": 51012939, "comment_id": 89020853, "body": "The type of <code>Refl</code> should be just <code>Eq a a</code>, not <code>a -&gt; a -&gt; Eq a a</code>, no? Also worth noting that the <code>a</code> in <code>data Eq a b</code> is distinct from that in <code>Eq a a</code>; you could just as well write <code>Refl :: Eq x x</code>. When I first encountered this I thought \u201cDoesn\u2019t that mean <code>Eq a b</code> is a proof that <code>a ~ a</code>, ignoring <code>b</code>?\u201d when in fact it is a proof of <code>a ~ b</code> as claimed."}, {"owner": {"reputation": 4234, "user_id": 4942760, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/f322d06b4f3e34278f29a954e0f38cb1?s=128&d=identicon&r=PG&f=1", "display_name": "Dan Robertson", "link": "https://stackoverflow.com/users/4942760/dan-robertson"}, "reply_to_user": {"reputation": 48938, "user_id": 246886, "user_type": "registered", "accept_rate": 94, "profile_image": "https://www.gravatar.com/avatar/dd1ebaade6623fc538fb8af3338e730d?s=128&d=identicon&r=PG", "display_name": "Jon Purdy", "link": "https://stackoverflow.com/users/246886/jon-purdy"}, "edited": false, "score": 0, "creation_date": 1529875494, "post_id": 51012939, "comment_id": 89020885, "body": "@JonPurdy yes you\u2019re right. I\u2019ve edited to correct that"}], "tags": [], "owner": {"reputation": 4234, "user_id": 4942760, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/f322d06b4f3e34278f29a954e0f38cb1?s=128&d=identicon&r=PG&f=1", "display_name": "Dan Robertson", "link": "https://stackoverflow.com/users/4942760/dan-robertson"}, "is_accepted": true, "score": 7, "last_activity_date": 1590539585, "last_edit_date": 1590539585, "creation_date": 1529865970, "answer_id": 51012939, "question_id": 51012153, "link": "https://stackoverflow.com/questions/51012153/how-to-think-about-the-lack-of-laws/51012939#51012939", "title": "How to think about the lack of laws", "body": "<p>You want to require that:</p>\n\n<pre><code>m (m x y) z = m x (m y z)        -- (1)\n</code></pre>\n\n<p>But to require this you need a way to check it. So you, or your compiler (or proof assistant), need to construct a proof of this. And the question is, what type is a proof of (1)?</p>\n\n<p>One could imagine some <code>Proof</code> type but then maybe you could just construct a proof that <code>0 = 0</code> instead of a proof of (1) and both would have type <code>Proof</code>. So you\u2019d need a more general type. I can\u2019t decide how to break up the rest of the question so I\u2019ll go for a super brief explanation of the Curry-Howard isomorphism followed by an explanation of how to prove two things are equal and then how dependent types are relevant. </p>\n\n<hr>\n\n<p>The Curry-Howard isomorphism says that propositions are isomorphic to types and proofs are isomorphic to programs: a type corresponds to a proposition and a proof of that proposition corresponds to a program constructing a value inhabiting that type. Ignoring how many propositions might be expressed as types, an example would be that the type <code>A  * B</code> (written <code>(A, B)</code> in Haskell) corresponds to the proposition \u201c<code>A</code> and <code>B</code>,\u201d while the type <code>A + B</code> (written <code>Either A B</code> in Haskell) corresponds to the proposition \u201c<code>A</code> or <code>B</code>.\u201d Finally the type <code>A -&gt; B</code> corresponds to \u201c<code>A</code> implies <code>B</code>,\u201d as a proof of this is a program which takes evidence of <code>A</code> and gives you evidence of <code>B</code>. One should note that there isn\u2019t a way to express <code>not A</code> but one could imagine adding a type <code>Not A</code> with builtins of type <code>Either a (Not a)</code>  for the law of the excluded middle as well as <code>Not (Not a) -&gt; a</code>, and <code>a * Not a -&gt; Void</code> (where <code>Void</code> is a type which cannot be inhabited and therefore corresponds to false), but then one can\u2019t really run these programs to get constructivist proofs.</p>\n\n<p>Now we will ignore some realities of Haskell and imagine that there aren\u2019t ways round these rules (in particular <code>undefined :: a</code> says everything is true, and <code>unsafeCoerce :: a -&gt; b</code> says that anything implies anything else, or just other functions that don\u2019t return where their existence does not imply the corresponding proof).</p>\n\n<p>So we know how to combine propositions but what might a proposition be? Well one could be to say that two types are equal. In Haskell this corresponds to the GADT</p>\n\n<pre><code>data Eq a b where Refl :: Eq c c\n</code></pre>\n\n<p>Where this constructor corresponds to the reflexive property of equality.</p>\n\n<p>[side note: if you\u2019re still interested so far, you may be interested to look up Voevodsky\u2019s univalent foundations, depending on how much the idea of \u201cHomotopy type theory\u201d interests you]</p>\n\n<p>So can we prove something now? How about the transitive property of equality:</p>\n\n<pre><code>trans :: Eq a b -&gt; Eq b c -&gt; Eq a c\ntrans x y =\n  case x of\n  Refl -&gt; -- by this match being successful, the compiler now knows that a = b\n    case y of\n    Refl -&gt; -- and now b = c and so the compiler knows a = c\n      Refl -- the compiler knows that this is of type Eq d d, and as it knows a = c, this typechecks as Eq a c\n</code></pre>\n\n<p>This feels like one hasn\u2019t really proven anything (especially as this mainly relies on the compiler knowing the transitive and symmetric properties), but one gets a similar feeling when proving simple things in logic as well.</p>\n\n<hr>\n\n<p>So now how might you prove the original proposition (1)? Well let\u2019s imagine we want a type <code>c</code> to be a monoid then we should also prove that $\\forall x,y,z:c, m (m x y) z = m x (m y z).$ So we need a way to express <code>m (m x y) z</code> as a type. Strictly speaking this isn\u2019t dependent types (this can be done with <code>DataKinds</code> to promote values and type families instead of functions). But you do need dependent types to have types depend on values. Specifically if you have a type <code>Nat</code> of natural numbers and a type family <code>Vec :: Nat -&gt; *</code> (<code>*</code> is the kind (read type) of all types) of fixed length vectors, you could define a dependently typed function <code>mkVec :: (n::Nat) -&gt; Vec n</code>. Observe how the type of the output depends on the <em>value</em> of the input.</p>\n\n<p>So your law needs to have functions promoted to type level (skipping the questions about how one defines type equality and value equality), as well as dependent types (made up syntax):</p>\n\n<pre><code>class Monoid c where\n  e :: c\n  (*) :: c -&gt; c -&gt; c\n  idl :: (x::c) -&gt; Eq x (e * x)\n  idr :: (x::c) -&gt; Eq x (x * e)\n  assoc :: (x::c) -&gt; (y::c) -&gt; (z::c) -&gt; Eq ((x * y) * z) (x * (y * z))\n</code></pre>\n\n<p>Observe how types tend to become large with dependent types and proofs. In a language missing typeclasses one could put such values into a record.</p>\n\n<hr>\n\n<p>Final note on the theory of dependent types and how these correspond to the curry Howard isomorphism.</p>\n\n<p>Dependent types can be considered an answer to the question: what types correspond to the propositions $\\forall x\\in S\\quad P(x)$ and $\\exists y\\in T\\quad Q(y)?$</p>\n\n<p>The answer is that you create new ways to make types: the dependent product and the dependent sum (coproduct). The dependent product expresses \u201cfor all values $x$ of type $S,$ there is a value of type $P(x).$\u201d A normal product would be a dependent product with $S=2,$ a type inhabited by two values. A dependent product might be written <code>(x:T) -&gt; P x</code>. A dependent sum says \u201csome value $y$ of type $T$, paired with a value of type $Q(y).$\u201d this might be written <code>(y:T) * Q y</code>.</p>\n\n<p>One can think of these as a generalisation of arbitrarily indexed (co)products from Set to general categories, where one might sensibly write e.g. $\\prod_\\Lambda X(\\lambda),$ and sometimes such notation is used in type theory.</p>\n"}], "owner": {"reputation": 225, "user_id": 2352867, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/sNljI.png?s=128&g=1", "display_name": "Tim", "link": "https://stackoverflow.com/users/2352867/tim"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 245, "favorite_count": 0, "accepted_answer_id": 51012939, "answer_count": 1, "score": 8, "last_activity_date": 1590539585, "creation_date": 1529860065, "question_id": 51012153, "link": "https://stackoverflow.com/questions/51012153/how-to-think-about-the-lack-of-laws", "title": "How to think about the lack of laws", "body": "<p>I am a mathematician who works a lot with category theory, and I've been using Haskell for a while to perform certain computations etc., but I am definitely not a programmer. I really love Haskell and want to become much more fluent in it, and the type system is something that I find especially great to have in place when writing programs.</p>\n\n<p>However, I've recently been trying to implement category theoretic things, and am running into problems concerning the fact that you seemingly can't have class method laws in Haskell. In case my terminology here is wrong, what I mean is that I can write</p>\n\n<pre><code>class Monoid c where\n    id :: c -&gt; c\n    m :: c -&gt; c -&gt; c\n</code></pre>\n\n<p>but I <em>can't</em> write some law along the lines of</p>\n\n<pre><code>m (m x y) z ==  m x $ m y z\n</code></pre>\n\n<p>From what I gather, this is due to the lack of dependent types in Haskell, but I'm not sure how exactly this is the case (having now read a bit about dependent types). It also seems that the convention is just to include laws like this in comments and hope that you don't accidentally cook up some instance that doesn't satisfy them.</p>\n\n<ol>\n<li>How should I change my approach to Haskell to deal with this problem? Is there a nice mathematical/type-theoretic solution (for example, require the existence of an associator that is an isomorphism (though then the question is, how do we encode isomorphisms without a law?)); is there some 'hack' (using extensions such as <code>DataKinds</code>); should I be drastic and switch to using something like Idris instead; or is the best response to just change the way I think about using Haskell (i.e. accept that these laws can't be implemented in a Haskelly way)?</li>\n<li>(bonus) How exactly does the lack of laws come from not supporting dependent types?</li>\n</ol>\n"}, {"tags": ["haskell", "zip"], "comments": [{"owner": {"reputation": 66224, "user_id": 180286, "user_type": "registered", "accept_rate": 69, "profile_image": "https://i.stack.imgur.com/tAXU2.jpg?s=128&g=1", "display_name": "Fyodor Soikin", "link": "https://stackoverflow.com/users/180286/fyodor-soikin"}, "edited": false, "score": 0, "creation_date": 1529841211, "post_id": 51009624, "comment_id": 89011941, "body": "How are you running this function? GHCi or as part of the bigger program? Can you post the code that calls the function and the result it produces?"}, {"owner": {"reputation": 11366, "user_id": 3922954, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/76ba47d2fdd24ab56b0b273cce2075e5?s=128&d=identicon&r=PG&f=1", "display_name": "AJF", "link": "https://stackoverflow.com/users/3922954/ajf"}, "edited": false, "score": 1, "creation_date": 1529841260, "post_id": 51009624, "comment_id": 89011955, "body": "This function works the way you expected on GHCi version 8.0.1: <code>separarPorPosicion [1,2,3,4] = ([2,4],[1,3])</code>. What&#39;s the problem?"}, {"owner": {"reputation": 19, "user_id": 6498905, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/a33e5cd1946ca1c47b0f543bdbf4b3c3?s=128&d=identicon&r=PG&f=1", "display_name": "Diego F.", "link": "https://stackoverflow.com/users/6498905/diego-f"}, "edited": false, "score": 0, "creation_date": 1529841320, "post_id": 51009624, "comment_id": 89011967, "body": "It&#39;s all the code I have. Im just learning and begginning at a very low level. I&#39;m running GHCi. Thanks!"}, {"owner": {"reputation": 19, "user_id": 6498905, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/a33e5cd1946ca1c47b0f543bdbf4b3c3?s=128&d=identicon&r=PG&f=1", "display_name": "Diego F.", "link": "https://stackoverflow.com/users/6498905/diego-f"}, "reply_to_user": {"reputation": 11366, "user_id": 3922954, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/76ba47d2fdd24ab56b0b273cce2075e5?s=128&d=identicon&r=PG&f=1", "display_name": "AJF", "link": "https://stackoverflow.com/users/3922954/ajf"}, "edited": false, "score": 0, "creation_date": 1529841400, "post_id": 51009624, "comment_id": 89011993, "body": "@AJFarmar i don&#39;t know what&#39;s going on then, cause the way im trying it doesn&#39;t work D:"}, {"owner": {"reputation": 11366, "user_id": 3922954, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/76ba47d2fdd24ab56b0b273cce2075e5?s=128&d=identicon&r=PG&f=1", "display_name": "AJF", "link": "https://stackoverflow.com/users/3922954/ajf"}, "edited": false, "score": 0, "creation_date": 1529841434, "post_id": 51009624, "comment_id": 89012002, "body": "@DiegoFerrari Then post the way you&#39;re trying it in your question. If we don&#39;t know what the problem is then we can&#39;t help. Use the &#39;edit&#39; button to add information."}, {"owner": {"reputation": 19, "user_id": 6498905, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/a33e5cd1946ca1c47b0f543bdbf4b3c3?s=128&d=identicon&r=PG&f=1", "display_name": "Diego F.", "link": "https://stackoverflow.com/users/6498905/diego-f"}, "edited": false, "score": 0, "creation_date": 1529841654, "post_id": 51009624, "comment_id": 89012083, "body": "<a href=\"https://ibb.co/jddRpo\" rel=\"nofollow noreferrer\">ibb.co/jddRpo</a> here is the environment and the code running in a screenshot"}, {"owner": {"reputation": 11366, "user_id": 3922954, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/76ba47d2fdd24ab56b0b273cce2075e5?s=128&d=identicon&r=PG&f=1", "display_name": "AJF", "link": "https://stackoverflow.com/users/3922954/ajf"}, "edited": false, "score": 0, "creation_date": 1529841741, "post_id": 51009624, "comment_id": 89012107, "body": "@DiegoFerrari Please <i>write</i> that in the <i>question</i>, not in a screenshot. What you&#39;re writing in the REPL is the issue, and if you write that in your question, I&#39;ll answer it."}, {"owner": {"reputation": 11366, "user_id": 3922954, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/76ba47d2fdd24ab56b0b273cce2075e5?s=128&d=identicon&r=PG&f=1", "display_name": "AJF", "link": "https://stackoverflow.com/users/3922954/ajf"}, "edited": false, "score": 0, "creation_date": 1529842485, "post_id": 51009624, "comment_id": 89012317, "body": "@DiegoFerrari Since you haven&#39;t done so, I&#39;ve edited your question for you to include the text in the screenshot. Please do not use screenshots in future questions."}, {"owner": {"reputation": 208473, "user_id": 126014, "user_type": "registered", "accept_rate": 86, "profile_image": "https://www.gravatar.com/avatar/33526616d4a11f1630d4939b769cfbf9?s=128&d=identicon&r=PG", "display_name": "Mark Seemann", "link": "https://stackoverflow.com/users/126014/mark-seemann"}, "edited": false, "score": 0, "creation_date": 1529846931, "post_id": 51009624, "comment_id": 89013419, "body": "It&#39;s possible to define this function by composing two functions from the standard library: <code>partition even</code>"}, {"owner": {"reputation": 48938, "user_id": 246886, "user_type": "registered", "accept_rate": 94, "profile_image": "https://www.gravatar.com/avatar/dd1ebaade6623fc538fb8af3338e730d?s=128&d=identicon&r=PG", "display_name": "Jon Purdy", "link": "https://stackoverflow.com/users/246886/jon-purdy"}, "reply_to_user": {"reputation": 208473, "user_id": 126014, "user_type": "registered", "accept_rate": 86, "profile_image": "https://www.gravatar.com/avatar/33526616d4a11f1630d4939b769cfbf9?s=128&d=identicon&r=PG", "display_name": "Mark Seemann", "link": "https://stackoverflow.com/users/126014/mark-seemann"}, "edited": false, "score": 0, "creation_date": 1529878270, "post_id": 51009624, "comment_id": 89021467, "body": "@MarkSeemann: That partitions into even and odd <i>elements</i>; this function partitions by even and odd <i>indices</i>. You could still use <code>partition</code> of course, like: <code>(fmap snd *** fmap snd) . partition (even . fst) . zip [1..]</code>"}], "answers": [{"comments": [{"owner": {"reputation": 126897, "user_id": 791604, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/ce991df7a056248d5e4f6fc3659ba733?s=128&d=identicon&r=PG", "display_name": "Daniel Wagner", "link": "https://stackoverflow.com/users/791604/daniel-wagner"}, "edited": false, "score": 0, "creation_date": 1529848883, "post_id": 51009831, "comment_id": 89013885, "body": "Your alternate solution can have one fewer cases with a bit of cleverness: <code>case xs of y:ys -&gt; let (os, es) = separarPorPosicion ys in (y:es, os); [] -&gt; ([], [])</code>. The even positions in a list are the odd positions in its tail and vice versa."}, {"owner": {"reputation": 4234, "user_id": 4942760, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/f322d06b4f3e34278f29a954e0f38cb1?s=128&d=identicon&r=PG&f=1", "display_name": "Dan Robertson", "link": "https://stackoverflow.com/users/4942760/dan-robertson"}, "reply_to_user": {"reputation": 126897, "user_id": 791604, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/ce991df7a056248d5e4f6fc3659ba733?s=128&d=identicon&r=PG", "display_name": "Daniel Wagner", "link": "https://stackoverflow.com/users/791604/daniel-wagner"}, "edited": false, "score": 0, "creation_date": 1529849456, "post_id": 51009831, "comment_id": 89014024, "body": "@DanielWagner that\u2019s certainly true. One can also replace the second case with <code>os -&gt; ([],os)</code> but I thought that stepping through the list two-at-a-time would make things more obvious, even if it means a bit more work and loc are necessary."}, {"owner": {"reputation": 19, "user_id": 6498905, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/a33e5cd1946ca1c47b0f543bdbf4b3c3?s=128&d=identicon&r=PG&f=1", "display_name": "Diego F.", "link": "https://stackoverflow.com/users/6498905/diego-f"}, "edited": false, "score": 0, "creation_date": 1529855133, "post_id": 51009831, "comment_id": 89015632, "body": "thank you very much for your help! I was completely stubborn in the code and didnt pay attention to the call."}], "tags": [], "owner": {"reputation": 4234, "user_id": 4942760, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/f322d06b4f3e34278f29a954e0f38cb1?s=128&d=identicon&r=PG&f=1", "display_name": "Dan Robertson", "link": "https://stackoverflow.com/users/4942760/dan-robertson"}, "is_accepted": false, "score": 2, "last_activity_date": 1529842663, "last_edit_date": 1529842663, "creation_date": 1529842272, "answer_id": 51009831, "question_id": 51009624, "link": "https://stackoverflow.com/questions/51009624/haskell-dividing-a-list-in-two-even-and-odd-numbers/51009831#51009831", "title": "Haskell Dividing a list in two: even and odd numbers", "body": "<p>You say</p>\n\n<blockquote>\n  <p>if I enter [1,2,3,4,5,6], the result will be [1,2,3,4,5,6] the same way</p>\n</blockquote>\n\n<p>But what you should enter is a function call:</p>\n\n<pre><code>ghci&gt; separarPorPosicion [1,2,3,4,5,6]\n([2,4,6],[1,3,5])\n</code></pre>\n\n<p>Another way to write your function could be:</p>\n\n<pre><code>separarPorPosicion xs = case xs of\n  o:e:ys -&gt; let (es,os) = separarPorPosicion ys in (e:es,o:os)\n  [o] -&gt; ([],[o])\n  [] -&gt; ([],[])\n</code></pre>\n"}, {"comments": [{"owner": {"reputation": 19, "user_id": 6498905, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/a33e5cd1946ca1c47b0f543bdbf4b3c3?s=128&d=identicon&r=PG&f=1", "display_name": "Diego F.", "link": "https://stackoverflow.com/users/6498905/diego-f"}, "edited": false, "score": 1, "creation_date": 1529854990, "post_id": 51009835, "comment_id": 89015596, "body": "i know about the tuple of type int, but i was so tired of trying everything came in my mind... How can I be so clueless? Thank you very much for all your help!"}], "tags": [], "owner": {"reputation": 11366, "user_id": 3922954, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/76ba47d2fdd24ab56b0b273cce2075e5?s=128&d=identicon&r=PG&f=1", "display_name": "AJF", "link": "https://stackoverflow.com/users/3922954/ajf"}, "is_accepted": false, "score": 5, "last_activity_date": 1529842301, "creation_date": 1529842301, "answer_id": 51009835, "question_id": 51009624, "link": "https://stackoverflow.com/questions/51009624/haskell-dividing-a-list-in-two-even-and-odd-numbers/51009835#51009835", "title": "Haskell Dividing a list in two: even and odd numbers", "body": "<p>Your code is absolutely correct, well done. It's how you're calling it. Let's have a look at your GHCi:</p>\n\n<pre><code>*Proyecto1&gt; (1,2,3,4,5,6)\n(1,2,3,4,5,6)\n*Proyecto1&gt; [1,2,3,4,5,6,7]\n[1,2,3,4,5,6,7]\n</code></pre>\n\n<p>When you write something in GHCi, you're asking it to evaluate that. So, when you write <code>[1,2,3,4,5,6,7]</code> you're just saying, \"What is the value of <code>[1,2,3,4,5,6,7]</code>?\" <strong>You're not using your function!</strong></p>\n\n<p>You should write this:</p>\n\n<pre><code>*Proyecto1&gt; separarPorPosicion [1,2,3,4,5,6,7]\n([2,4,6], [1,3,5,7])\n</code></pre>\n\n<p>This is telling GHCi to use the function <code>separarPorPosicion</code> on the value <code>[1,2,3,4,5,6,7]</code>. Before, you were not doing this. </p>\n\n<hr>\n\n<p>A side note: You also wrote <code>(1,2,3,4,5,6)</code>. It's important to know that this is not a <strong>list</strong>, of type <code>[Int]</code>, but a <strong>tuple</strong>, of type <code>(Int, Int, Int, Int, Int, Int)</code>. You cannot therefore write <code>separarPorPosicion (1,2,3,4,5,6)</code>. This will not work.</p>\n"}], "owner": {"reputation": 19, "user_id": 6498905, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/a33e5cd1946ca1c47b0f543bdbf4b3c3?s=128&d=identicon&r=PG&f=1", "display_name": "Diego F.", "link": "https://stackoverflow.com/users/6498905/diego-f"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 346, "favorite_count": 0, "answer_count": 2, "score": 1, "last_activity_date": 1529842663, "creation_date": 1529840827, "last_edit_date": 1529842179, "question_id": 51009624, "link": "https://stackoverflow.com/questions/51009624/haskell-dividing-a-list-in-two-even-and-odd-numbers", "title": "Haskell Dividing a list in two: even and odd numbers", "body": "<p>I'm driving myself crazy with this simple exercice. I just want to divide a list by two, separating even and odd numbers. My code is the following:</p>\n\n<pre><code>module Proyecto1 where\n\nsepararPorPosicion :: [a] -&gt;([a],[a])\nsepararPorPosicion xs= (pares,impares) where\n    pares = [x | (x,y)&lt;- zip xs [1..], even y]\n    impares = [x | (x,y)&lt;- zip xs [1..], odd y]\n</code></pre>\n\n<p>The only result I get is the same list I write, the same way I wrote.\nI.E, if I enter [1,2,3,4,5,6], the result will be [1,2,3,4,5,6] the same way.</p>\n\n<p>This is what I'm writing in GHCi:</p>\n\n<pre><code>*Proyecto1&gt; (1,2,3,4,5,6)\n(1,2,3,4,5,6)\n*Proyecto1&gt; [1,2,3,4,5,6,7]\n[1,2,3,4,5,6,7]\n</code></pre>\n\n<p>What am I doing wrong.</p>\n"}, {"tags": ["haskell", "functor", "foldable"], "comments": [{"owner": {"reputation": 11366, "user_id": 3922954, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/76ba47d2fdd24ab56b0b273cce2075e5?s=128&d=identicon&r=PG&f=1", "display_name": "AJF", "link": "https://stackoverflow.com/users/3922954/ajf"}, "edited": false, "score": 1, "creation_date": 1529839018, "post_id": 51009307, "comment_id": 89011391, "body": "Remember that <code>Bits a</code> is equivalent to <code>[a]</code> where <code>Add = (:)</code> and <code>End = []</code>, and inspect the functor instance for lists."}, {"owner": {"reputation": 1341, "user_id": 1036044, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/PzcQL.jpg?s=128&g=1", "display_name": "Probie", "link": "https://stackoverflow.com/users/1036044/probie"}, "edited": false, "score": 2, "creation_date": 1529839179, "post_id": 51009307, "comment_id": 89011428, "body": "Turn on language extensions and just derive them? :p"}, {"owner": {"reputation": 4234, "user_id": 4942760, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/f322d06b4f3e34278f29a954e0f38cb1?s=128&d=identicon&r=PG&f=1", "display_name": "Dan Robertson", "link": "https://stackoverflow.com/users/4942760/dan-robertson"}, "edited": false, "score": 0, "creation_date": 1529842918, "post_id": 51009307, "comment_id": 89012429, "body": "For <code>Bits</code> you are matching too deeply. Try <code>fmap f (Bits l r) = Bits (fmap f l) (fmap f r)</code>. See if you can come up with a foldable instance now?"}, {"owner": {"reputation": 33, "user_id": 9822565, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/24055406a3aac5022cef22d2718573d1?s=128&d=identicon&r=PG&f=1", "display_name": "Alutri", "link": "https://stackoverflow.com/users/9822565/alutri"}, "edited": false, "score": 0, "creation_date": 1529844192, "post_id": 51009307, "comment_id": 89012743, "body": "For foldr i have tried <code>foldr _ z (Bits (End) (End)) = z </code> and <code>foldr f z (Bits (Add x (y)) (Add l (r))) = f x $ foldr f z y $ f l $ foldr f z r </code> , but i receive an error saying it couldnt match the expected type b -&gt; b with actual type b. Not really sure how to solve this now :/"}], "answers": [{"comments": [{"owner": {"reputation": 33, "user_id": 9822565, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/24055406a3aac5022cef22d2718573d1?s=128&d=identicon&r=PG&f=1", "display_name": "Alutri", "link": "https://stackoverflow.com/users/9822565/alutri"}, "edited": false, "score": 0, "creation_date": 1529858930, "post_id": 51011169, "comment_id": 89016693, "body": "Took me some time so understand the code but ill definitely use,never knew you could do it like that, thank you very much!"}], "tags": [], "owner": {"reputation": 208473, "user_id": 126014, "user_type": "registered", "accept_rate": 86, "profile_image": "https://www.gravatar.com/avatar/33526616d4a11f1630d4939b769cfbf9?s=128&d=identicon&r=PG", "display_name": "Mark Seemann", "link": "https://stackoverflow.com/users/126014/mark-seemann"}, "is_accepted": true, "score": 2, "last_activity_date": 1529852906, "creation_date": 1529852906, "answer_id": 51011169, "question_id": 51009307, "link": "https://stackoverflow.com/questions/51009307/haskell-creating-map-and-foldr-function-for-new-datatype/51011169#51011169", "title": "Haskell creating map and foldr function for new datatype", "body": "<p>Perhaps it's easier to implement the <code>Foldable</code> instances via <code>foldMap</code>:</p>\n\n<pre><code>import Data.Monoid\n\ndata Bit a = Add a (Bit a) | End deriving (Show,Eq)\ndata Bits a = Bits (Bit a) (Bit a) deriving (Show,Eq)\n\ninstance Functor Bit where\n  fmap _ End = End\n  fmap f (Add x b) = Add (f x) $ fmap f b\n\ninstance Foldable Bit where\n  foldMap _ End = mempty\n  foldMap f (Add x b) = f x &lt;&gt; foldMap f b\n\ninstance Functor Bits where\n  fmap f (Bits l r) = Bits (fmap f l) (fmap f r)\n\ninstance Foldable Bits where\n  foldMap f (Bits l r) = foldMap f l &lt;&gt; foldMap f r\n</code></pre>\n\n<p>Here's some GHCi examples:</p>\n\n<pre><code>*Q51009307&gt; foldr (\\x a -&gt; show x ++ a) \"\" $ End\n\"\"\n*Q51009307&gt; foldr (\\x a -&gt; show x ++ a) \"\" $ Add 1 $ End\n\"1\"\n*Q51009307&gt; foldr (\\x a -&gt; show x ++ a) \"\" $ Add 1 $ Add 2 $ End\n\"12\"\n*Q51009307&gt; foldr (\\x a -&gt; show x ++ a) \"\" $ Add 1 $ Add 2 $ Add 3 $ End\n\"123\"\n*Q51009307&gt; foldMap Sum $ Bits (Add 1 $ End) End\nSum {getSum = 1}\n*Q51009307&gt; foldMap Sum $ Bits (Add 1 $ Add 2 $ End) (Add 1 $ End)\nSum {getSum = 4}\n*Q51009307&gt; foldr (+) 0 $ Bits (Add 1 $ Add 2 $ End) (Add 1 $ End)\n4\n</code></pre>\n"}], "owner": {"reputation": 33, "user_id": 9822565, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/24055406a3aac5022cef22d2718573d1?s=128&d=identicon&r=PG&f=1", "display_name": "Alutri", "link": "https://stackoverflow.com/users/9822565/alutri"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 149, "favorite_count": 0, "accepted_answer_id": 51011169, "answer_count": 1, "score": 2, "last_activity_date": 1529852957, "creation_date": 1529838308, "last_edit_date": 1529852957, "question_id": 51009307, "link": "https://stackoverflow.com/questions/51009307/haskell-creating-map-and-foldr-function-for-new-datatype", "title": "Haskell creating map and foldr function for new datatype", "body": "<p>I have written a data structure,</p>\n\n<pre><code>data Bit a = Add a (Bit a) | End deriving (Show,Eq)\ndata Bits a = Bits (Bit a) (Bit a) deriving (Show,Eq)\n</code></pre>\n\n<p>but am struggling to create a map and foldr function for them.</p>\n\n<p>So far I have this: </p>\n\n<pre><code>instance Functor Bit \n    where\n       fmap _ (End) = End\n       fmap f (Add x (y)) = Add (f x) $ (fmap f y)\n\ninstance Foldable Bit\n    where \n       foldr _ z (End) = z \n       foldr f z (Add x (y)) = f x $ foldr f z y\n\ninstance Functor Bits \n    where \n       fmap _ (Bits (End) (End)) = Bits (End) (End)\n       fmap f (Bits (Add x (y)) (End)) = error \"dont know what to put here\"\n\ninstance Foldable Bits\n    where \n       foldr _ z (Bits (End) (End)) = z\n       foldr f z (Bits (Add x (y)) (End) = Bits (f x $ f y) (End)\n       foldr f z (Bits (Add x (y)) (Add a (b)) = error \"dont know\"\n</code></pre>\n\n<p>Any idea on how to implement them? Also not sure if I am missing anything so please let me know if that is also the case.</p>\n"}, {"tags": ["haskell", "haskell-stack", "hft"], "comments": [{"owner": {"reputation": 208473, "user_id": 126014, "user_type": "registered", "accept_rate": 86, "profile_image": "https://www.gravatar.com/avatar/33526616d4a11f1630d4939b769cfbf9?s=128&d=identicon&r=PG", "display_name": "Mark Seemann", "link": "https://stackoverflow.com/users/126014/mark-seemann"}, "edited": false, "score": 0, "creation_date": 1529835091, "post_id": 51008765, "comment_id": 89010572, "body": "Do you have a <code>.cabal</code> file? You may need to add the package to <code>build-depends</code> there."}, {"owner": {"reputation": 1414, "user_id": 6564029, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/WxyK5.jpg?s=128&g=1", "display_name": "Michail", "link": "https://stackoverflow.com/users/6564029/michail"}, "reply_to_user": {"reputation": 208473, "user_id": 126014, "user_type": "registered", "accept_rate": 86, "profile_image": "https://www.gravatar.com/avatar/33526616d4a11f1630d4939b769cfbf9?s=128&d=identicon&r=PG", "display_name": "Mark Seemann", "link": "https://stackoverflow.com/users/126014/mark-seemann"}, "edited": false, "score": 0, "creation_date": 1529835781, "post_id": 51008765, "comment_id": 89010725, "body": "@MarkSeemann Added the contents of the cabal file."}, {"owner": {"reputation": 24509, "user_id": 6863749, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/UyoQv.jpg?s=128&g=1", "display_name": "Li-yao Xia", "link": "https://stackoverflow.com/users/6863749/li-yao-xia"}, "edited": false, "score": 0, "creation_date": 1529842254, "post_id": 51008765, "comment_id": 89012260, "body": "What if you remove the two occurences of <code>other-modules: Path_schemer</code>?"}, {"owner": {"reputation": 1414, "user_id": 6564029, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/WxyK5.jpg?s=128&g=1", "display_name": "Michail", "link": "https://stackoverflow.com/users/6564029/michail"}, "reply_to_user": {"reputation": 24509, "user_id": 6863749, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/UyoQv.jpg?s=128&g=1", "display_name": "Li-yao Xia", "link": "https://stackoverflow.com/users/6863749/li-yao-xia"}, "edited": false, "score": 0, "creation_date": 1529846571, "post_id": 51008765, "comment_id": 89013327, "body": "@Li-yaoXia It compiles. Odd. One would expect generated by stack stuff to be valid. Maybe you have an idea how to instruct stack to not generate this?"}, {"owner": {"reputation": 1414, "user_id": 6564029, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/WxyK5.jpg?s=128&g=1", "display_name": "Michail", "link": "https://stackoverflow.com/users/6564029/michail"}, "reply_to_user": {"reputation": 24509, "user_id": 6863749, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/UyoQv.jpg?s=128&g=1", "display_name": "Li-yao Xia", "link": "https://stackoverflow.com/users/6863749/li-yao-xia"}, "edited": false, "score": 0, "creation_date": 1529847436, "post_id": 51008765, "comment_id": 89013532, "body": "@Li-yaoXia Tried setting <code>other-modules</code> setting in the <code>package.yaml</code> to an empty list, worked like a charm. Not sure what was going on with that, maybe some weird default? If you write up an answer from this, I&#39;ll accept. It was yours intuition, after all."}], "answers": [{"tags": [], "owner": {"reputation": 24509, "user_id": 6863749, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/UyoQv.jpg?s=128&g=1", "display_name": "Li-yao Xia", "link": "https://stackoverflow.com/users/6863749/li-yao-xia"}, "is_accepted": true, "score": 1, "last_activity_date": 1529954362, "last_edit_date": 1529954362, "creation_date": 1529931046, "answer_id": 51023916, "question_id": 51008765, "link": "https://stackoverflow.com/questions/51008765/not-in-scope-type-constructor-or-class-test-framework-testsuite-when-trying-t/51023916#51023916", "title": "Not in scope: type constructor or class \u2018Test.Framework.TestSuite\u2019 when trying to create unit tests", "body": "<p>The options <code>-F -pgmF htfpp</code> are switched on globally. This applies the HTF preprocessor to all the files of the test suite, including the autogenerated <code>Paths_schemer</code>.</p>\n\n<p>The more scalable solution is to enable the preprocessor only on files that import <code>Test.Framework</code>, using the <code>OPTIONS_GHC</code> pragma in each one:</p>\n\n<pre><code>{-# OPTIONS_GHC -F -pgmF htfpp #-}\n</code></pre>\n\n<p>Another way is to set <code>other-modules: []</code> in the test-suite section in <code>package.yaml</code> to avoid generating <code>Paths_schemer</code>, although that only solves the problem for this one module.</p>\n"}], "owner": {"reputation": 1414, "user_id": 6564029, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/WxyK5.jpg?s=128&g=1", "display_name": "Michail", "link": "https://stackoverflow.com/users/6564029/michail"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 147, "favorite_count": 0, "accepted_answer_id": 51023916, "answer_count": 1, "score": 1, "last_activity_date": 1529954362, "creation_date": 1529833930, "last_edit_date": 1529929440, "question_id": 51008765, "link": "https://stackoverflow.com/questions/51008765/not-in-scope-type-constructor-or-class-test-framework-testsuite-when-trying-t", "title": "Not in scope: type constructor or class \u2018Test.Framework.TestSuite\u2019 when trying to create unit tests", "body": "<p>I'm writing a small library in Haskell, and want to have tests to accompany it. For testing I intend to use HFT, and the project as a whole is managed by stack. <code>stack test</code> fails for some reason with the following output:</p>\n\n<pre><code>[1 of 2] Compiling Main             ( test/Ini.hs, .stack-work/dist/x86_64-linux-tinfo6/Cabal-2.0.1.0/build/ini-tests/ini-tests-tmp/Main.o )                                                                      \u2502\u00b7\u00b7\u00b7\u00b7\u00b7\u00b7\u00b7\u00b7\u00b7\u00b7\u00b7\u00b7\u00b7\u00b7\u00b7\u00b7\u00b7\u00b7\u00b7\u00b7\u00b7\u00b7\u00b7\u00b7\u00b7\u00b7\u00b7\u00b7\n[2 of 2] Compiling Paths_schemer    ( .stack-work/dist/x86_64-linux-tinfo6/Cabal-2.0.1.0/build/ini-tests/autogen/Paths_schemer.hs, .stack-work/dist/x86_64-linux-tinfo6/Cabal-2.0.1.0/build/ini-tests/ini-tests-tm\u2502\u00b7\u00b7\u00b7\u00b7\u00b7\u00b7\u00b7\u00b7\u00b7\u00b7\u00b7\u00b7\u00b7\u00b7\u00b7\u00b7\u00b7\u00b7\u00b7\u00b7\u00b7\u00b7\u00b7\u00b7\u00b7\u00b7\u00b7\u00b7\np/Paths_schemer.o )                                                                                                                                                                                               \u2502\u00b7\u00b7\u00b7\u00b7\u00b7\u00b7\u00b7\u00b7\u00b7\u00b7\u00b7\u00b7\u00b7\u00b7\u00b7\u00b7\u00b7\u00b7\u00b7\u00b7\u00b7\u00b7\u00b7\u00b7\u00b7\u00b7\u00b7\u00b7\n                                                                                                                                                                                                                  \u2502\u00b7\u00b7\u00b7\u00b7\u00b7\u00b7\u00b7\u00b7\u00b7\u00b7\u00b7\u00b7\u00b7\u00b7\u00b7\u00b7\u00b7\u00b7\u00b7\u00b7\u00b7\u00b7\u00b7\u00b7\u00b7\u00b7\u00b7\u00b7\n/stuff/projects/schemer/.stack-work/dist/x86_64-linux-tinfo6/Cabal-2.0.1.0/build/ini-tests/autogen/Paths_schemer.hs:54:39: error:                                                                                 \u2502\u00b7\u00b7\u00b7\u00b7\u00b7\u00b7\u00b7\u00b7\u00b7\u00b7\u00b7\u00b7\u00b7\u00b7\u00b7\u00b7\u00b7\u00b7\u00b7\u00b7\u00b7\u00b7\u00b7\u00b7\u00b7\u00b7\u00b7\u00b7\n    Not in scope: type constructor or class \u2018Test.Framework.TestSuite\u2019                                                                                                                                            \u2502\u00b7\u00b7\u00b7\u00b7\u00b7\u00b7\u00b7\u00b7\u00b7\u00b7\u00b7\u00b7\u00b7\u00b7\u00b7\u00b7\u00b7\u00b7\u00b7\u00b7\u00b7\u00b7\u00b7\u00b7\u00b7\u00b7\u00b7\u00b7\n    No module named \u2018Test.Framework\u2019 is imported.                                                                                                                                                                 \u2502\u00b7\u00b7\u00b7\u00b7\u00b7\u00b7\u00b7\u00b7\u00b7\u00b7\u00b7\u00b7\u00b7\u00b7\u00b7\u00b7\u00b7\u00b7\u00b7\u00b7\u00b7\u00b7\u00b7\u00b7\u00b7\u00b7\u00b7\u00b7\n                                                                                                                                                                                                                  \u2502\u00b7\u00b7\u00b7\u00b7\u00b7\u00b7\u00b7\u00b7\u00b7\u00b7\u00b7\u00b7\u00b7\u00b7\u00b7\u00b7\u00b7\u00b7\u00b7\u00b7\u00b7\u00b7\u00b7\u00b7\u00b7\u00b7\u00b7\u00b7\n/stuff/projects/schemer/.stack-work/dist/x86_64-linux-tinfo6/Cabal-2.0.1.0/build/ini-tests/autogen/Paths_schemer.hs:55:38: error:                                                                                 \u2502\u00b7\u00b7\u00b7\u00b7\u00b7\u00b7\u00b7\u00b7\u00b7\u00b7\u00b7\u00b7\u00b7\u00b7\u00b7\u00b7\u00b7\u00b7\u00b7\u00b7\u00b7\u00b7\u00b7\u00b7\u00b7\u00b7\u00b7\u00b7\n    Not in scope: \u2018Test.Framework.makeTestSuite\u2019                                                                                                                                                                  \u2502\u00b7\u00b7\u00b7\u00b7\u00b7\u00b7\u00b7\u00b7\u00b7\u00b7\u00b7\u00b7\u00b7\u00b7\u00b7\u00b7\u00b7\u00b7\u00b7\u00b7\u00b7\u00b7\u00b7\u00b7\u00b7\u00b7\u00b7\u00b7\n    No module named \u2018Test.Framework\u2019 is imported.                                                                                                                                                                 \u2502\u00b7\u00b7\u00b7\u00b7\u00b7\u00b7\u00b7\u00b7\u00b7\u00b7\u00b7\u00b7\u00b7\u00b7\u00b7\u00b7\u00b7\u00b7\u00b7\u00b7\u00b7\u00b7\u00b7\u00b7\u00b7\u00b7\u00b7\u00b7\n</code></pre>\n\n<p>My Ini.hs file that will later contain the tests is very bare-bone, just</p>\n\n<pre><code>import Test.Framework\n\nmain :: IO ()\nmain = htfMain htf_thisModulesTests\n</code></pre>\n\n<p>My <code>package.yaml</code> is </p>\n\n<pre><code>name:                schemer\nversion:             0.1.0.0\ngithub:              \"mpevnev/schemer\"\nlicense:             BSD3\nauthor:              \"Michail Pevnev\"\nmaintainer:          \"mpevnev@gmail.com\"\ncopyright:           \"\"\n\nextra-source-files: []\n\n# Metadata used when publishing your package\n# synopsis:            Short description of your package\n# category:            Web\n\n# To avoid duplicated efforts in documentation and dealing with the\n# complications of embedding Haddock markup inside cabal files, it is\n# common to point users to the README.md file.\ndescription:         Please see the README on GitHub at &lt;https://github.com/mpevnev/schemer#readme&gt;\n\ndependencies:\n- attoparsec\n- base &gt;= 4.7 &amp;&amp; &lt; 5\n- text\n\n\nlibrary:\n  source-dirs: src\n\ntests:\n  ini-tests:\n    main:                Ini.hs\n    source-dirs:         test\n    ghc-options:\n    - -threaded\n    - -rtsopts\n    - -with-rtsopts=-N\n    - -F\n    - -pgmF htfpp\n    dependencies:\n    - schemer\n    - text\n    - HTF\n</code></pre>\n\n<p>Here's the autogenerated <code>schemer.cabal</code>:</p>\n\n<pre><code>-- This file has been generated from package.yaml by hpack version 0.28.2.\n--\n-- see: https://github.com/sol/hpack\n--\n-- hash: 17ae623236b8f5b101f56373c975656e898efa7506acb143db7375f229509a79\n\nname:           schemer\nversion:        0.1.0.0\ndescription:    Please see the README on GitHub at &lt;https://github.com/mpevnev/schemer#readme&gt;\nhomepage:       https://github.com/mpevnev/schemer#readme\nbug-reports:    https://github.com/mpevnev/schemer/issues\nauthor:         Michail Pevnev\nmaintainer:     mpevnev@gmail.com\nlicense:        BSD3\nlicense-file:   LICENSE\nbuild-type:     Simple\ncabal-version:  &gt;= 1.10\n\nsource-repository head\n  type: git\n  location: https://github.com/mpevnev/schemer\n\nlibrary\n  exposed-modules:\n      Control.Scheme.Ini\n      Control.Schemer\n  other-modules:\n      Paths_schemer\n  hs-source-dirs:\n      src\n  build-depends:\n      attoparsec\n    , base &gt;=4.7 &amp;&amp; &lt;5\n    , text\n  default-language: Haskell2010\n\ntest-suite ini-tests\n  type: exitcode-stdio-1.0\n  main-is: Ini.hs\n  other-modules:\n      Paths_schemer\n  hs-source-dirs:\n      test\n  ghc-options: -threaded -rtsopts -with-rtsopts=-N -F -pgmF htfpp\n  build-depends:\n      HTF\n    , attoparsec\n    , base &gt;=4.7 &amp;&amp; &lt;5\n    , schemer\n    , text\n  default-language: Haskell2010\n</code></pre>\n\n<p>I'm not sure what's wrong and what is this Paths_schemer thing. Help is appreciated.</p>\n"}, {"tags": ["haskell", "functor", "category-theory", "category-abstractions"], "comments": [{"owner": {"reputation": 2585, "user_id": 8491228, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/j5T09.jpg?s=128&g=1", "display_name": "Mor A.", "link": "https://stackoverflow.com/users/8491228/mor-a"}, "edited": false, "score": 6, "creation_date": 1529828688, "post_id": 51008111, "comment_id": 89009313, "body": "That definition doesn&#39;t even type check. remember that <code>(.) :: Category cat =&gt; cat b c -&gt; cat a b -&gt; cat a c</code>, while <code>fmap :: Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b</code>"}], "answers": [{"tags": [], "owner": {"reputation": 100185, "user_id": 3234959, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/93bb12ca0f93dfddb33880316f7e66c2?s=128&d=identicon&r=PG&f=1", "display_name": "chi", "link": "https://stackoverflow.com/users/3234959/chi"}, "is_accepted": true, "score": 2, "last_activity_date": 1529828693, "creation_date": 1529828693, "answer_id": 51008160, "question_id": 51008111, "link": "https://stackoverflow.com/questions/51008111/is-there-a-reason-that-functor-is-not-a-superclass-of-category/51008160#51008160", "title": "Is there a reason that `Functor` is not a superclass of `Category`?", "body": "<p>That instance would overlap with many other useful instances, e.g. one could no longer add</p>\n\n<pre><code>instance Functor (State s) where ...\n</code></pre>\n\n<p>for the <code>State s</code> monad.</p>\n"}], "owner": {"reputation": 1474, "user_id": 8025936, "user_type": "registered", "accept_rate": 71, "profile_image": "https://i.stack.imgur.com/Kue08.png?s=128&g=1", "display_name": "schuelermine", "link": "https://stackoverflow.com/users/8025936/schuelermine"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 77, "favorite_count": 0, "accepted_answer_id": 51008160, "answer_count": 1, "score": 0, "last_activity_date": 1559484339, "creation_date": 1529828178, "last_edit_date": 1559484339, "question_id": 51008111, "link": "https://stackoverflow.com/questions/51008111/is-there-a-reason-that-functor-is-not-a-superclass-of-category", "title": "Is there a reason that `Functor` is not a superclass of `Category`?", "body": "<p>It seems you can simply declare:</p>\n\n<pre><code>import qualified Control.Category as Cat\ninstance Cat.Category q =&gt; Functor (q r) where\n     fmap = (Cat..)\n</code></pre>\n\n<p>Is there anything speaking against this?</p>\n"}, {"tags": ["haskell"], "comments": [{"owner": {"reputation": 69207, "user_id": 1440565, "user_type": "registered", "accept_rate": 59, "profile_image": "https://www.gravatar.com/avatar/ec430cc01ef4cf4ae63ebbe9e8596f72?s=128&d=identicon&r=PG", "display_name": "Code-Apprentice", "link": "https://stackoverflow.com/users/1440565/code-apprentice"}, "edited": false, "score": 0, "creation_date": 1529808947, "post_id": 51006590, "comment_id": 89006488, "body": "Where did you see the first line you are quoting? Please provide more context."}, {"owner": {"reputation": 69207, "user_id": 1440565, "user_type": "registered", "accept_rate": 59, "profile_image": "https://www.gravatar.com/avatar/ec430cc01ef4cf4ae63ebbe9e8596f72?s=128&d=identicon&r=PG", "display_name": "Code-Apprentice", "link": "https://stackoverflow.com/users/1440565/code-apprentice"}, "edited": false, "score": 0, "creation_date": 1529809031, "post_id": 51006590, "comment_id": 89006496, "body": "From the notation after &quot;reduces to&quot; it appears to be in some meta language. It isn&#39;t Haskell, so don&#39;t apply the same rules to it."}, {"owner": {"reputation": 28376, "user_id": 5743988, "user_type": "registered", "accept_rate": 67, "profile_image": "https://i.stack.imgur.com/IeSSM.jpg?s=128&g=1", "display_name": "4castle", "link": "https://stackoverflow.com/users/5743988/4castle"}, "edited": false, "score": 1, "creation_date": 1529809139, "post_id": 51006590, "comment_id": 89006510, "body": "I googled &quot;ZF expressions&quot; and found the article the OP is quoting from: <a href=\"http://www.cantab.net/users/antoni.diller/haskell/units/unit04.html\" rel=\"nofollow noreferrer\">cantab.net/users/antoni.diller/haskell/units/unit04.html</a> (see ZF2 in the reduction rules)"}, {"owner": {"reputation": 1377, "user_id": 8314628, "user_type": "registered", "accept_rate": 88, "profile_image": "https://www.gravatar.com/avatar/0eefa2c64f533d21e1d8f58e4252a1e9?s=128&d=identicon&r=PG&f=1", "display_name": "user8314628", "link": "https://stackoverflow.com/users/8314628/user8314628"}, "edited": false, "score": 0, "creation_date": 1529809215, "post_id": 51006590, "comment_id": 89006517, "body": "Sorry, I don&#39;t have more context. I have the other 4 rules, but they won&#39;t help. For example, rule number 1, <code>[ e | v &lt;- [], q ]</code> reduces to <code>[]</code>, where <code>q</code> is a sequence of zero or more qualifiers."}, {"owner": {"reputation": 31243, "user_id": 2751851, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/4ddc0.png?s=128&g=1", "display_name": "duplode", "link": "https://stackoverflow.com/users/2751851/duplode"}, "reply_to_user": {"reputation": 28376, "user_id": 5743988, "user_type": "registered", "accept_rate": 67, "profile_image": "https://i.stack.imgur.com/IeSSM.jpg?s=128&g=1", "display_name": "4castle", "link": "https://stackoverflow.com/users/5743988/4castle"}, "edited": false, "score": 2, "creation_date": 1529809505, "post_id": 51006590, "comment_id": 89006545, "body": "Assuming that you are quoting from the page @4castle linked to, an explanation can be found in the part of the rule you haven&#39;t quoted here: &quot;where <code>h [ v := f ]</code> represents [...]&quot;."}, {"owner": {"reputation": 1377, "user_id": 8314628, "user_type": "registered", "accept_rate": 88, "profile_image": "https://www.gravatar.com/avatar/0eefa2c64f533d21e1d8f58e4252a1e9?s=128&d=identicon&r=PG&f=1", "display_name": "user8314628", "link": "https://stackoverflow.com/users/8314628/user8314628"}, "edited": false, "score": 0, "creation_date": 1529809629, "post_id": 51006590, "comment_id": 89006555, "body": "I found it in some pdf file and it doesn&#39;t have such explanation."}], "answers": [{"comments": [{"owner": {"reputation": 1377, "user_id": 8314628, "user_type": "registered", "accept_rate": 88, "profile_image": "https://www.gravatar.com/avatar/0eefa2c64f533d21e1d8f58e4252a1e9?s=128&d=identicon&r=PG&f=1", "display_name": "user8314628", "link": "https://stackoverflow.com/users/8314628/user8314628"}, "edited": false, "score": 0, "creation_date": 1529810513, "post_id": 51006635, "comment_id": 89006665, "body": "I think I know what it means now.  Does <code>[ e | v &lt;- f:fs, q ]</code> reduces to <code>[e | v = f || v &lt;- fs, q]</code> make sense?"}, {"owner": {"reputation": 126897, "user_id": 791604, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/ce991df7a056248d5e4f6fc3659ba733?s=128&d=identicon&r=PG", "display_name": "Daniel Wagner", "link": "https://stackoverflow.com/users/791604/daniel-wagner"}, "reply_to_user": {"reputation": 1377, "user_id": 8314628, "user_type": "registered", "accept_rate": 88, "profile_image": "https://www.gravatar.com/avatar/0eefa2c64f533d21e1d8f58e4252a1e9?s=128&d=identicon&r=PG&f=1", "display_name": "user8314628", "link": "https://stackoverflow.com/users/8314628/user8314628"}, "edited": false, "score": 0, "creation_date": 1529816516, "post_id": 51006635, "comment_id": 89007333, "body": "@user8314628 Doesn&#39;t make sense to me. What&#39;s a double pipe supposed to mean?"}, {"owner": {"reputation": 1377, "user_id": 8314628, "user_type": "registered", "accept_rate": 88, "profile_image": "https://www.gravatar.com/avatar/0eefa2c64f533d21e1d8f58e4252a1e9?s=128&d=identicon&r=PG&f=1", "display_name": "user8314628", "link": "https://stackoverflow.com/users/8314628/user8314628"}, "edited": false, "score": 0, "creation_date": 1529816950, "post_id": 51006635, "comment_id": 89007390, "body": "<code>||</code> means or in Haskell?"}, {"owner": {"reputation": 61419, "user_id": 849891, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/MbEO3.png?s=128&g=1", "display_name": "Will Ness", "link": "https://stackoverflow.com/users/849891/will-ness"}, "reply_to_user": {"reputation": 1377, "user_id": 8314628, "user_type": "registered", "accept_rate": 88, "profile_image": "https://www.gravatar.com/avatar/0eefa2c64f533d21e1d8f58e4252a1e9?s=128&d=identicon&r=PG&f=1", "display_name": "user8314628", "link": "https://stackoverflow.com/users/8314628/user8314628"}, "edited": false, "score": 0, "creation_date": 1529830971, "post_id": 51006635, "comment_id": 89009753, "body": "@user8314628 yes, <code>||</code> means &quot;or&quot;, and no, <code>[e | v = f || v &lt;- fs, q]</code> does not make any sense and is not Valid Haskell (I can&#39;t even guess the intent of it). the answer gives you the translation: <code>[ e | v &lt;- (f:fs), q ]</code> =&gt; <code>[let v = f in e | let v = f in q] ++ [e | v &lt;- fs, q ]</code>."}], "tags": [], "owner": {"reputation": 1341, "user_id": 1036044, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/PzcQL.jpg?s=128&g=1", "display_name": "Probie", "link": "https://stackoverflow.com/users/1036044/probie"}, "is_accepted": false, "score": 3, "last_activity_date": 1529809397, "creation_date": 1529809397, "answer_id": 51006635, "question_id": 51006590, "link": "https://stackoverflow.com/questions/51006590/can-anyone-explain-the-second-reduction-rule-for-zf-expressions/51006635#51006635", "title": "Can anyone explain the second reduction rule for ZF-expressions?", "body": "<p>Without knowing where you've seen this it's hard to know for certain what is meant.\n<code>[e | q][v := f]</code> is <em>not</em> valid Haskell code (barring some creative use of language extensions).</p>\n\n<p>What is probably meant is something more like </p>\n\n<pre><code>[e' | q'] ++ [e | v &lt;- fs, q]\n</code></pre>\n\n<p>where <code>e'</code> is <code>e</code> with all instances of <code>v</code> in replaced with <code>f</code>, and <code>q'</code> is <code>q</code> with all instances of <code>v</code> replaced with <code>f</code></p>\n\n<p>So, for example if <code>f</code> was 5, <code>e</code> was <code>v*2</code> and <code>q</code> was <code>odd v</code> we'd have</p>\n\n<pre><code>[v*2 | v &lt;- 5:fs, odd v]\n</code></pre>\n\n<p>Which would reduce to</p>\n\n<pre><code>[5*2|odd 5] ++ [v*2 | v &lt;- fs, odd v]\n</code></pre>\n\n<p>Since <code>odd 5</code> reduces to <code>True</code> we end up with</p>\n\n<pre><code>[5*2] ++ [v*2 | f&lt;- fs, odd v]\n</code></pre>\n"}, {"tags": [], "owner": {"reputation": 100185, "user_id": 3234959, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/93bb12ca0f93dfddb33880316f7e66c2?s=128&d=identicon&r=PG&f=1", "display_name": "chi", "link": "https://stackoverflow.com/users/3234959/chi"}, "is_accepted": true, "score": 2, "last_activity_date": 1529827171, "creation_date": 1529827171, "answer_id": 51008009, "question_id": 51006590, "link": "https://stackoverflow.com/questions/51006590/can-anyone-explain-the-second-reduction-rule-for-zf-expressions/51008009#51008009", "title": "Can anyone explain the second reduction rule for ZF-expressions?", "body": "<p>The notation you mention is not Haskell code, but a meta-notation for <em>substitution</em> which is frequently used in programming languages theory.</p>\n\n<p>If <code>e</code> and <code>t</code> are Haskell expressions, and <code>x</code> is a Haskell variable, we write <code>e [x := t]</code> to denote the expression <code>e</code> where all the free occurrences of <code>x</code> have been replaced with <code>t</code> (and avoiding captures). For example</p>\n\n<pre><code>x [x := t]                       ===&gt; t\nx+3 [x := t]                     ===&gt; t+3\nf x + (\\x -&gt; x + 32) x [x := t]  ===&gt; f t + (\\x -&gt; x + 32) t\n[ f x y | y &lt;- [1..x] ] [x := t] ===&gt; [ f t y | y &lt;- [1..t] ]\n</code></pre>\n\n<p>Again, this is not a Haskell operator, but a \"mathematical\" meta-level operator which takes as input Haskell code (syntax) and produces as output Haskell code (syntax).</p>\n\n<p>It is usually exploited to define beta reduction on lambdas:</p>\n\n<pre><code>(\\x -&gt; e) t ---beta---&gt; e [x := t]\n</code></pre>\n\n<p>Anyway, in the posted expression</p>\n\n<pre><code>[ e | q ] [ v := f ] ++ [ e | v &lt;- fs, q ]\n</code></pre>\n\n<p>the first <code>[...]</code> and the last are Haskell list comprehensions, while <code>[v := f]</code> is the meta-notation for substitution. For instance, here's a fully evaluated example</p>\n\n<pre class=\"lang-none prettyprint-override\"><code>[ f x y | x &lt;- 1:2:[] , y &lt;- [0..x] ]\n===&gt; definition of list comprehension\n[ f x y | y &lt;- [0..x] ] [x := 1] ++ [ f x y | x &lt;- 2:[] , y &lt;- [0..x] ]\n===&gt; substitution\n[ f 1 y | y &lt;- [0..1] ] ++ [ f x y | x &lt;- 2:[] , y &lt;- [0..x] ]\n===&gt; definition of list comprehension\n[ f 1 y | y &lt;- [0..1] ] \n      ++ [ f x y | y &lt;- [0..x] ] [x := 2] \n      ++ [ f x y | x &lt;- [] , y &lt;- [0..x] ]\n===&gt; substitution\n[ f 1 y | y &lt;- [0..1] ] ++ [ f 2 y | y &lt;- [0..2] ] ++ [ f x y | x &lt;- [] , y &lt;- [0..x] ]\n===&gt; definition of list comprehension\n[ f 1 y | y &lt;- [0..1] ] ++ [ f 2 y | y &lt;- [0..2] ] ++ []\n===&gt; many other steps here\n[ f 1 0, f 1 1 ] ++ [ f 2 0, f 2 1, f 2 2 ] ++ []\n===&gt; concatenation\n[ f 1 0, f 1 1, f 2 0, f 2 1, f 2 2 ]\n</code></pre>\n"}], "owner": {"reputation": 1377, "user_id": 8314628, "user_type": "registered", "accept_rate": 88, "profile_image": "https://www.gravatar.com/avatar/0eefa2c64f533d21e1d8f58e4252a1e9?s=128&d=identicon&r=PG&f=1", "display_name": "user8314628", "link": "https://stackoverflow.com/users/8314628/user8314628"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 96, "favorite_count": 0, "accepted_answer_id": 51008009, "answer_count": 2, "score": 0, "last_activity_date": 1529827171, "creation_date": 1529808593, "last_edit_date": 1529808941, "question_id": 51006590, "link": "https://stackoverflow.com/questions/51006590/can-anyone-explain-the-second-reduction-rule-for-zf-expressions", "title": "Can anyone explain the second reduction rule for ZF-expressions?", "body": "<p><code>[ e | v &lt;- f:fs, q ]</code> reduces to <code>[ e | q ] [ v := f ] ++ [ e | v &lt;- fs, q ]</code></p>\n\n<p>The output of <code>[ e | v &lt;- f:fs, q ]</code> should be a single list. What does it mean to put two lists together in the reduction? I mean you can't just put two lists together like this <code>[\"a\"][\"b\"]</code>.</p>\n\n<p>Also, is the symbol <code>:=</code> the same as <code>=</code>?</p>\n"}, {"tags": ["haskell"], "comments": [{"owner": {"reputation": 24028, "user_id": 383200, "user_type": "registered", "accept_rate": 60, "profile_image": "https://www.gravatar.com/avatar/a9dc722f936cb1059adaae4fe39c07f0?s=128&d=identicon&r=PG", "display_name": "Carl", "link": "https://stackoverflow.com/users/383200/carl"}, "edited": false, "score": 6, "creation_date": 1529806513, "post_id": 51006442, "comment_id": 89006190, "body": "Why would you want to?  What&#39;s your actual goal?"}, {"owner": {"user_type": "does_not_exist", "display_name": "user7650973"}, "reply_to_user": {"reputation": 24028, "user_id": 383200, "user_type": "registered", "accept_rate": 60, "profile_image": "https://www.gravatar.com/avatar/a9dc722f936cb1059adaae4fe39c07f0?s=128&d=identicon&r=PG", "display_name": "Carl", "link": "https://stackoverflow.com/users/383200/carl"}, "edited": false, "score": 0, "creation_date": 1529806586, "post_id": 51006442, "comment_id": 89006199, "body": "Like if you had to do a recursive function with String -&gt; String or Int -&gt; Int.  Cons changes them to a list so I wanted to know if it was possible to change cons"}, {"owner": {"reputation": 384463, "user_id": 1126841, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/fa05233b2357f8d11c22ef4cfc7bb85c?s=128&d=identicon&r=PG", "display_name": "chepner", "link": "https://stackoverflow.com/users/1126841/chepner"}, "edited": false, "score": 3, "creation_date": 1529806708, "post_id": 51006442, "comment_id": 89006212, "body": "<code>(:)</code> doesn&#39;t <i>change</i> anything; it&#39;s a data constructor that creates a new list given an existing list and another item of the appropriate type. What would you expect something like <code>3 : 4</code> to create, anyway?"}, {"owner": {"reputation": 171740, "user_id": 869736, "user_type": "registered", "accept_rate": 82, "profile_image": "https://www.gravatar.com/avatar/671f732e3c68c387c702112a30e5ebd8?s=128&d=identicon&r=PG&f=1", "display_name": "Louis Wasserman", "link": "https://stackoverflow.com/users/869736/louis-wasserman"}, "edited": false, "score": 1, "creation_date": 1529819774, "post_id": 51006442, "comment_id": 89007760, "body": "You can&#39;t change cons, but you can use a different function."}, {"owner": {"reputation": 100185, "user_id": 3234959, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/93bb12ca0f93dfddb33880316f7e66c2?s=128&d=identicon&r=PG&f=1", "display_name": "chi", "link": "https://stackoverflow.com/users/3234959/chi"}, "edited": false, "score": 0, "creation_date": 1529826208, "post_id": 51006442, "comment_id": 89008805, "body": "If we had <code>(:) :: a -&gt; a -&gt; a</code> then <code>1 : [2,3,4]</code> would not type check - why would one like that? Also, by parametricity, a function of type <code>a -&gt; a -&gt; a</code> can only be one of the two projections <code>\\x y -&gt; x</code> and <code>\\x y -&gt; y</code>. We don&#39;t want cons to behave like any of those (not to break parametricity)."}], "answers": [{"tags": [], "owner": {"reputation": 69207, "user_id": 1440565, "user_type": "registered", "accept_rate": 59, "profile_image": "https://www.gravatar.com/avatar/ec430cc01ef4cf4ae63ebbe9e8596f72?s=128&d=identicon&r=PG", "display_name": "Code-Apprentice", "link": "https://stackoverflow.com/users/1440565/code-apprentice"}, "is_accepted": true, "score": 1, "last_activity_date": 1529824266, "creation_date": 1529824266, "answer_id": 51007717, "question_id": 51006442, "link": "https://stackoverflow.com/questions/51006442/can-you-change-the-type-of-cons-in-haskell/51007717#51007717", "title": "Can you change the type of cons (:) in haskell", "body": "<p>No, you cannot change the type of <code>(:)</code>. It is defined in Prelude. If you want a function with a different type, you just need to write that function yourself and give it an appropriate name.</p>\n"}], "owner": {"user_type": "does_not_exist", "display_name": "user7650973"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 84, "favorite_count": 0, "closed_date": 1529825768, "accepted_answer_id": 51007717, "answer_count": 1, "score": 0, "last_activity_date": 1529824266, "creation_date": 1529806437, "question_id": 51006442, "link": "https://stackoverflow.com/questions/51006442/can-you-change-the-type-of-cons-in-haskell", "closed_reason": "Needs details or clarity", "title": "Can you change the type of cons (:) in haskell", "body": "<p>Cons has the input as a -> [a] -> [a]</p>\n\n<p>Can you change cons to be </p>\n\n<p>a -> a -> a</p>\n\n<p>without a list type?</p>\n"}, {"tags": ["haskell", "typeclass"], "comments": [{"owner": {"reputation": 45741, "user_id": 744178, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/a3193139ea494c45e63752504f5ff1f2?s=128&d=identicon&r=PG", "display_name": "jwodder", "link": "https://stackoverflow.com/users/744178/jwodder"}, "edited": false, "score": 0, "creation_date": 1529802385, "post_id": 51006108, "comment_id": 89005792, "body": "&quot;Firstly, I don&#39;t know what Eq represent.&quot; \u2014 In order to remove elements from a list, the compiler has to be able to tell whether two elements are the same.  How would it do that if they don&#39;t belong to <code>Eq</code>?"}, {"owner": {"reputation": 1377, "user_id": 8314628, "user_type": "registered", "accept_rate": 88, "profile_image": "https://www.gravatar.com/avatar/0eefa2c64f533d21e1d8f58e4252a1e9?s=128&d=identicon&r=PG&f=1", "display_name": "user8314628", "link": "https://stackoverflow.com/users/8314628/user8314628"}, "reply_to_user": {"reputation": 45741, "user_id": 744178, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/a3193139ea494c45e63752504f5ff1f2?s=128&d=identicon&r=PG", "display_name": "jwodder", "link": "https://stackoverflow.com/users/744178/jwodder"}, "edited": false, "score": 0, "creation_date": 1529802952, "post_id": 51006108, "comment_id": 89005842, "body": "Ok, so typeclass constraints could have more than one condition."}, {"owner": {"reputation": 1377, "user_id": 8314628, "user_type": "registered", "accept_rate": 88, "profile_image": "https://www.gravatar.com/avatar/0eefa2c64f533d21e1d8f58e4252a1e9?s=128&d=identicon&r=PG&f=1", "display_name": "user8314628", "link": "https://stackoverflow.com/users/8314628/user8314628"}, "reply_to_user": {"reputation": 45741, "user_id": 744178, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/a3193139ea494c45e63752504f5ff1f2?s=128&d=identicon&r=PG", "display_name": "jwodder", "link": "https://stackoverflow.com/users/744178/jwodder"}, "edited": false, "score": 0, "creation_date": 1529803812, "post_id": 51006108, "comment_id": 89005923, "body": "Oh, no. <code>Eq a</code> should be together as one condition."}], "answers": [{"tags": [], "owner": {"reputation": 339851, "user_id": 149392, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/7a561ec0875fcbbe3066ea8fe288ec77?s=128&d=identicon&r=PG", "display_name": "sepp2k", "link": "https://stackoverflow.com/users/149392/sepp2k"}, "is_accepted": true, "score": 5, "last_activity_date": 1529805573, "creation_date": 1529805573, "answer_id": 51006381, "question_id": 51006108, "link": "https://stackoverflow.com/questions/51006108/i-dont-understand-the-typeclass-constraints-in-the-list-subtraction/51006381#51006381", "title": "I don&#39;t understand the typeclass constraints in the list subtraction", "body": "<p><code>Eq</code> is the type class containing <code>==</code>. So the constraint <code>Eq a</code> says that <code>a</code> must be a type that can be compared using <code>==</code>.</p>\n\n<p>It's <code>Eq a</code> and not <code>Eq [a]</code> because we want to be able to compare elements of the lists, not the lists themselves (though if we did, we could still do that because <code>Eq a</code> implies <code>Eq [a]</code>).</p>\n"}], "owner": {"reputation": 1377, "user_id": 8314628, "user_type": "registered", "accept_rate": 88, "profile_image": "https://www.gravatar.com/avatar/0eefa2c64f533d21e1d8f58e4252a1e9?s=128&d=identicon&r=PG&f=1", "display_name": "user8314628", "link": "https://stackoverflow.com/users/8314628/user8314628"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 63, "favorite_count": 0, "accepted_answer_id": 51006381, "answer_count": 1, "score": 2, "last_activity_date": 1529805594, "creation_date": 1529800806, "question_id": 51006108, "link": "https://stackoverflow.com/questions/51006108/i-dont-understand-the-typeclass-constraints-in-the-list-subtraction", "title": "I don&#39;t understand the typeclass constraints in the list subtraction", "body": "<p>This is a list subtraction example.</p>\n\n<pre><code>(\\\\) :: Eq a =&gt; [a] -&gt; [a] -&gt; [a]\n[] \\\\ _  = []\nxs \\\\ [] = xs\n(x:xs) \\\\ (y:ys)\n  | x == y    = xs \\\\ ys\n  | otherwise = (x : (xs \\\\ [y])) \\\\ ys\n</code></pre>\n\n<p>Firstly, I don't know what Eq represent.</p>\n\n<p>Secondly, should <code>a</code> be <code>[a]</code> instead in the typeclass constraints? Because the input must be lists.</p>\n"}, {"tags": ["haskell", "types", "casting", "complex-numbers"], "answers": [{"comments": [{"owner": {"reputation": 25321, "user_id": 163177, "user_type": "registered", "accept_rate": 86, "profile_image": "https://www.gravatar.com/avatar/e811b5337bcad19d52c8fed3a0ea0075?s=128&d=identicon&r=PG", "display_name": "John F. Miller", "link": "https://stackoverflow.com/users/163177/john-f-miller"}, "edited": false, "score": 1, "creation_date": 1529909133, "post_id": 51006174, "comment_id": 89027768, "body": "Now you might ask why not <code>instance Num a =&gt; Num (Complex a)</code>?  The answer is that <code>abs x</code> and <code>signum x</code> as defined for complex numbers use the magnitude of <code>x</code> which requires <code>sqrt</code> from the <code>RealFloat</code> instance.  E.g. <code>abs (1 :+ 2)</code> = <code>sqrt 5</code> which is not an integer."}], "tags": [], "owner": {"reputation": 45741, "user_id": 744178, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/a3193139ea494c45e63752504f5ff1f2?s=128&d=identicon&r=PG", "display_name": "jwodder", "link": "https://stackoverflow.com/users/744178/jwodder"}, "is_accepted": true, "score": 5, "last_activity_date": 1529802054, "creation_date": 1529802054, "answer_id": 51006174, "question_id": 51006072, "link": "https://stackoverflow.com/questions/51006072/cannot-raise-complex-int-to-power/51006174#51006174", "title": "Cannot raise Complex Int to power", "body": "<p><code>(^)</code> is a method of <code>Num</code>.  <a href=\"https://www.haskell.org/onlinereport/haskell2010/haskellch17.html#x25-21800017\" rel=\"noreferrer\">The <code>Complex</code> type's instantiation of <code>Num</code></a> is declared as:</p>\n\n<pre><code>instance RealFloat a =&gt; Num (Complex a)\n</code></pre>\n\n<p>That is, you can't treat a <code>Complex a</code> as a <code>Num</code> unless <code>a</code> is a <code>RealFloat</code>, which an <code>Int</code> is not.  Use <code>Complex Double</code> or the like instead.</p>\n"}], "owner": {"reputation": 43, "user_id": 6215217, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/24d84583a04987e4e62d709840f59094?s=128&d=identicon&r=PG&f=1", "display_name": "Potrimpo", "link": "https://stackoverflow.com/users/6215217/potrimpo"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 46, "favorite_count": 0, "accepted_answer_id": 51006174, "answer_count": 1, "score": 1, "last_activity_date": 1529802054, "creation_date": 1529800183, "question_id": 51006072, "link": "https://stackoverflow.com/questions/51006072/cannot-raise-complex-int-to-power", "title": "Cannot raise Complex Int to power", "body": "<p>It seems that raising a <code>Complex Int</code> to a power violates some contract in its instances. Am I wrong on this?</p>\n\n<p>minimal example below</p>\n\n<pre><code>compl :: Complex Int -&gt; Maybe (Complex Int)\ncompl d = (d^) &lt;$&gt; Just 3\n</code></pre>\n\n<p>And the error message:</p>\n\n<pre><code>No instance for (RealFloat Int) arising from an operator section\n      In the first argument of \u2018(&lt;$&gt;)\u2019, namely \u2018(d ^)\u2019\n      In the expression: (d ^) &lt;$&gt; Just 3\n      In an equation for \u2018compl\u2019: compl d = (d ^) &lt;$&gt; Just 3\n</code></pre>\n\n<p>Is there any way around this? Allowing this type to be a float doesn't make any sense in my program.</p>\n"}, {"tags": ["list", "haskell", "recursion"], "answers": [{"comments": [{"owner": {"reputation": 2179, "user_id": 412549, "user_type": "registered", "accept_rate": 50, "profile_image": "https://www.gravatar.com/avatar/a194a155579e30bda0926705aeb9d165?s=128&d=identicon&r=PG&f=1", "display_name": "Franky", "link": "https://stackoverflow.com/users/412549/franky"}, "edited": false, "score": 2, "creation_date": 1529861599, "post_id": 51006561, "comment_id": 89017331, "body": "You do not need the second line <code>obtainValues [x]...</code>. When you pattern match <code>[]</code> and <code>(x:xs)</code>, you already match all contructors of lists."}, {"owner": {"reputation": 311, "user_id": 7841675, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/dAmAX.png?s=128&g=1", "display_name": "AtilioA", "link": "https://stackoverflow.com/users/7841675/atilioa"}, "edited": false, "score": 0, "creation_date": 1529928959, "post_id": 51006561, "comment_id": 89038940, "body": "How about integrating this obtainValues with results from other functions, though? I have a function that takes a triple and outputs a list. Like this: <code>portInfoX (3, 1, 20) = [0, 2, 5, 4, 6]</code>. But when I put it in I&#39;m getting type errors everywhere."}, {"owner": {"reputation": 4533, "user_id": 1342581, "user_type": "registered", "accept_rate": 67, "profile_image": "https://i.stack.imgur.com/3UuMS.jpg?s=128&g=1", "display_name": "Victoria Ruiz", "link": "https://stackoverflow.com/users/1342581/victoria-ruiz"}, "edited": false, "score": 0, "creation_date": 1529931191, "post_id": 51006561, "comment_id": 89040328, "body": "I&#39;m not sure where you&#39;re using obtainValues there. The result of that function, that is a list, can be used as a parameter in obtainValues, but you would not be able to use the tuple. You should probably open a new question for this tho."}], "tags": [], "owner": {"reputation": 4533, "user_id": 1342581, "user_type": "registered", "accept_rate": 67, "profile_image": "https://i.stack.imgur.com/3UuMS.jpg?s=128&g=1", "display_name": "Victoria Ruiz", "link": "https://stackoverflow.com/users/1342581/victoria-ruiz"}, "is_accepted": true, "score": 1, "last_activity_date": 1529866072, "last_edit_date": 1529866072, "creation_date": 1529808171, "answer_id": 51006561, "question_id": 51005662, "link": "https://stackoverflow.com/questions/51005662/extract-element-from-one-list-with-elements-from-another-list-recursively/51006561#51006561", "title": "Extract element from one list with elements from another list, recursively", "body": "<p>What you can do here is apply the same function for every element in a list, which is what <code>map</code> is for. </p>\n\n<p>Assuming you have: </p>\n\n<pre><code>indexes = [1, 2, 4] \nvalues = [1, 0, 2, 5, 1, 0]\n</code></pre>\n\n<p>What you need to do is </p>\n\n<pre><code>map (values!!) indexes\n</code></pre>\n\n<p>This will return the desired <code>[0,2,1]</code>. You're using partial application to do <code>values!!index</code> for each of the values in the list of <code>indexes</code>, and then you save it to a list that will have the same length as <code>indexes</code>.</p>\n\n<p>If you wanted to do this recursively in a way that is actually visible from the code, you could do this:</p>\n\n<pre><code>obtainValues [] values = []\nobtainValues (x:xs) values = [values !! x] ++ (obtainValues xs values)\n</code></pre>\n\n<p>Notice the pattern matching in <code>(x:xs)</code>, where x is the first element of the list (let's say an Int, in this case), and xs represents the rest of the list ([Int]).</p>\n"}], "owner": {"reputation": 311, "user_id": 7841675, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/dAmAX.png?s=128&g=1", "display_name": "AtilioA", "link": "https://stackoverflow.com/users/7841675/atilioa"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 607, "favorite_count": 0, "accepted_answer_id": 51006561, "answer_count": 1, "score": 1, "last_activity_date": 1579194790, "creation_date": 1529794290, "last_edit_date": 1579194790, "question_id": 51005662, "link": "https://stackoverflow.com/questions/51005662/extract-element-from-one-list-with-elements-from-another-list-recursively", "title": "Extract element from one list with elements from another list, recursively", "body": "<p>I want to use one list e.g. <code>[1, 2, 4]</code> to get elements from another list e.g. <code>[1, 0, 2, 5, 1, 0]</code> using recursion so that the results are stored in a third list, as if the first list denotes the position of each element wanted from the second list, like this:</p>\n\n<pre><code>[1, 0, 2, 5, 1, 0]!!1 = 1\n[1, 0, 2, 5, 1, 0]!!2 = 0\n[1, 0, 2, 5, 1, 0]!!4 = 5\n</code></pre>\n"}, {"tags": ["haskell", "random", "polymorphism"], "answers": [{"tags": [], "owner": {"reputation": 40537, "user_id": 465378, "user_type": "registered", "accept_rate": 85, "profile_image": "https://www.gravatar.com/avatar/c03b8d34978563858020eff0d14cc17b?s=128&d=identicon&r=PG", "display_name": "Alexis King", "link": "https://stackoverflow.com/users/465378/alexis-king"}, "is_accepted": true, "score": 5, "last_activity_date": 1529793261, "creation_date": 1529793261, "answer_id": 51005577, "question_id": 51005460, "link": "https://stackoverflow.com/questions/51005460/haskell-rigid-type-variable-error/51005577#51005577", "title": "Haskell rigid type variable error", "body": "<p>The issue with your code is on the last line, the one with the <code>:: (Double, g)</code> type annotation. As written, you clearly expect the <code>g</code> in that annotation to refer to the same <code>g</code> as the one in your type signature for <code>simulator</code>. This is a completely reasonable expectation, but unfortunately, it isn\u2019t true\u2014by default, two type variables with the same name in different type annotations are distinct. (This is why, in the error message, GHC implicitly renames your second <code>g</code> to <code>g1</code>.)</p>\n\n<p>Fortunately, you can fix this. GHC comes with a language extension you can turn on called <code>ScopedTypeVariables</code>. If you add <code>{-# LANGUAGE ScopedTypeVariables #-}</code> to the top of your module, this will enable the extension. However, this <em>still</em> won\u2019t fix your program, since <code>ScopedTypeVariables</code> only applies to variables <em>explicitly</em> bound using <code>forall</code>. Therefore, you need to both add the <code>LANGUAGE</code> pragma <em>and</em> introduce an explicit use of <code>forall</code>:</p>\n\n<pre><code>{-# LANGUAGE ScopedTypeVariables #-}\n\nimport System.Random\n\nsimulator :: forall g. (RandomGen g) =&gt; g -&gt; Double -&gt; (Bool, g)\nsimulator gen p = (x &lt;= p, gen2)\n  where (x, gen2) = random gen :: (Double, g)\n</code></pre>\n\n<p>These incantations are enough to get GHC to do what you initially intended.</p>\n\n<p>That said, your original program would actually also compile if you just dropped the second type signature and left <code>ScopedTypeVariables</code> disabled, since GHC would infer the appropriate type for <code>gen2</code> based on how it\u2019s used. Whether you want the type signature or not is personal preference, but it\u2019s still useful to understand what\u2019s going on and how to fix it for situations where you decide you really do want the signature, or where the signature is actually necessary.</p>\n"}], "owner": {"reputation": 53, "user_id": 9983429, "user_type": "registered", "profile_image": "https://graph.facebook.com/10212619753992033/picture?type=large", "display_name": "Jeremy Silver", "link": "https://stackoverflow.com/users/9983429/jeremy-silver"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 710, "favorite_count": 0, "accepted_answer_id": 51005577, "answer_count": 1, "score": 2, "last_activity_date": 1529793261, "creation_date": 1529791848, "question_id": 51005460, "link": "https://stackoverflow.com/questions/51005460/haskell-rigid-type-variable-error", "title": "Haskell rigid type variable error", "body": "<p>I'm something of a Haskell beginner. I'd like to know why the following isn't working:</p>\n\n<pre><code>import System.Random\n\nsimulator :: (RandomGen g) =&gt; g -&gt; Double -&gt; (Bool, g)\nsimulator gen p = (x &lt;= p, gen2)\n    where (x, gen2) = random gen :: (Double, g)\n</code></pre>\n\n<p>The error I get is:</p>\n\n<pre><code>\u2022 Couldn't match type \u2018g\u2019 with \u2018g1\u2019\n  \u2018g\u2019 is a rigid type variable bound by\n    the type signature for:\n      simulator :: forall g. RandomGen g =&gt; g -&gt; Double -&gt; (Bool, g)\n    at simulate.hs:10:1-54\n  \u2018g1\u2019 is a rigid type variable bound by\n    an expression type signature:\n      forall g1. (Double, g1)\n    at simulate.hs:12:37-47\n  Expected type: (Double, g1)\n    Actual type: (Double, g)\n\u2022 In the expression: random gen :: (Double, g)\n  In a pattern binding: (x, gen2) = random gen :: (Double, g)\n  In an equation for \u2018simulator\u2019:\n      simulator gen p\n        = (x &lt;= p, gen2)\n        where\n            (x, gen2) = random gen :: (Double, g)\n\u2022 Relevant bindings include\n    gen :: g (bound at simulate.hs:11:11)\n    simulator :: g -&gt; Double -&gt; (Bool, g) (bound at simulate.hs:11:1)\n\n     where (x, gen2) = random gen :: (Double, g)\n</code></pre>\n\n<p>It seems Haskell is unable to match the separate instances of the type variable <code>g</code>. Any clues?</p>\n"}, {"tags": ["haskell", "aeson"], "comments": [{"owner": {"reputation": 57219, "user_id": 33796, "user_type": "registered", "accept_rate": 70, "profile_image": "https://www.gravatar.com/avatar/08727b23ba62e634b32988cdff082663?s=128&d=identicon&r=PG", "display_name": "luqui", "link": "https://stackoverflow.com/users/33796/luqui"}, "edited": false, "score": 0, "creation_date": 1529789824, "post_id": 51005138, "comment_id": 89003999, "body": "Looks like you need to know <code>forall a. ToJSON a =&gt; ToJSON (f a)</code>.  Perhaps a <a href=\"http://hackage.haskell.org/package/constraints-0.10/docs/Data-Constraint-Lifting.html\" rel=\"nofollow noreferrer\"><code>Lifting ToJSON f</code></a> constraint will fit the bill?"}, {"owner": {"reputation": 617, "user_id": 2036930, "user_type": "registered", "accept_rate": 83, "profile_image": "https://www.gravatar.com/avatar/5611c46bb33e051bf692b69cf4411377?s=128&d=identicon&r=PG", "display_name": "statusfailed", "link": "https://stackoverflow.com/users/2036930/statusfailed"}, "reply_to_user": {"reputation": 57219, "user_id": 33796, "user_type": "registered", "accept_rate": 70, "profile_image": "https://www.gravatar.com/avatar/08727b23ba62e634b32988cdff082663?s=128&d=identicon&r=PG", "display_name": "luqui", "link": "https://stackoverflow.com/users/33796/luqui"}, "edited": false, "score": 0, "creation_date": 1529832724, "post_id": 51005138, "comment_id": 89010054, "body": "I&#39;m not familiar with Constraint - could you point me at some reading material, or show me how adding that constraint looks in syntax? (or both!)"}, {"owner": {"reputation": 48938, "user_id": 246886, "user_type": "registered", "accept_rate": 94, "profile_image": "https://www.gravatar.com/avatar/dd1ebaade6623fc538fb8af3338e730d?s=128&d=identicon&r=PG", "display_name": "Jon Purdy", "link": "https://stackoverflow.com/users/246886/jon-purdy"}, "reply_to_user": {"reputation": 57219, "user_id": 33796, "user_type": "registered", "accept_rate": 70, "profile_image": "https://www.gravatar.com/avatar/08727b23ba62e634b32988cdff082663?s=128&d=identicon&r=PG", "display_name": "luqui", "link": "https://stackoverflow.com/users/33796/luqui"}, "edited": false, "score": 0, "creation_date": 1529885920, "post_id": 51005138, "comment_id": 89022640, "body": "@luqui: Couldn\u2019t you also use <code>QuantifiedConstraints</code> to express that directly in GHC 8.6?"}, {"owner": {"reputation": 57219, "user_id": 33796, "user_type": "registered", "accept_rate": 70, "profile_image": "https://www.gravatar.com/avatar/08727b23ba62e634b32988cdff082663?s=128&d=identicon&r=PG", "display_name": "luqui", "link": "https://stackoverflow.com/users/33796/luqui"}, "reply_to_user": {"reputation": 48938, "user_id": 246886, "user_type": "registered", "accept_rate": 94, "profile_image": "https://www.gravatar.com/avatar/dd1ebaade6623fc538fb8af3338e730d?s=128&d=identicon&r=PG", "display_name": "Jon Purdy", "link": "https://stackoverflow.com/users/246886/jon-purdy"}, "edited": false, "score": 0, "creation_date": 1529892085, "post_id": 51005138, "comment_id": 89023561, "body": "@JonPurdy maybe? Haven&#39;t played with them yet."}], "answers": [{"comments": [{"owner": {"reputation": 617, "user_id": 2036930, "user_type": "registered", "accept_rate": 83, "profile_image": "https://www.gravatar.com/avatar/5611c46bb33e051bf692b69cf4411377?s=128&d=identicon&r=PG", "display_name": "statusfailed", "link": "https://stackoverflow.com/users/2036930/statusfailed"}, "edited": false, "score": 0, "creation_date": 1529958268, "post_id": 51012769, "comment_id": 89054907, "body": "This looks pretty spot on - I&#39;ll have to do some reading though! Thanks."}], "tags": [], "owner": {"reputation": 57219, "user_id": 33796, "user_type": "registered", "accept_rate": 70, "profile_image": "https://www.gravatar.com/avatar/08727b23ba62e634b32988cdff082663?s=128&d=identicon&r=PG", "display_name": "luqui", "link": "https://stackoverflow.com/users/33796/luqui"}, "is_accepted": true, "score": 2, "last_activity_date": 1529959312, "last_edit_date": 1529959312, "creation_date": 1529864670, "answer_id": 51012769, "question_id": 51005138, "link": "https://stackoverflow.com/questions/51005138/how-do-i-write-aeson-tojson-instances-for-types-with-kind/51012769#51012769", "title": "How do I write aeson ToJSON instances for types with kind (* -&gt; *) -&gt; *", "body": "<p>Using my idea in the comment of exploiting the <a href=\"http://hackage.haskell.org/package/constraints-0.10/docs/Data-Constraint-Lifting.html\" rel=\"nofollow noreferrer\"><code>Lifting</code></a> class, and after some tinkering I arrived at this</p>\n\n<pre><code>{-# LANGUAGE DeriveGeneric\n           , FlexibleContexts   \n           , MultiParamTypeClasses\n           , ScopedTypeVariables\n           , TypeApplications\n           , UndecidableInstances \n           #-}\nmodule Main where\n\nimport GHC.Generics\nimport Data.Aeson\nimport Data.Constraint\nimport Data.Constraint.Lifting\n\ndata MyType f = MyType\n  { age  :: f Int\n  , name :: f String\n  } deriving(Generic)\n\ninstance (Lifting ToJSON f) =&gt; ToJSON (MyType f) where\n    toJSON mt\n        | Sub Dict &lt;- lifting @ToJSON @f @Int\n        , Sub Dict &lt;- lifting @ToJSON @f @String\n            = genericToJSON defaultOptions mt\n\ninstance Lifting ToJSON Maybe where\n    lifting = Sub Dict\n\nmain :: IO ()\nmain = print . encode $ MyType (Just 1) (Just \"hi\")\n</code></pre>\n\n<p>Notes:</p>\n\n<ul>\n<li><a href=\"http://hackage.haskell.org/package/constraints-0.10/docs/Data-Constraint.html#t:Dict\" rel=\"nofollow noreferrer\"><code>Dict</code></a> converts back and forth between constraints (such as <code>ToJSON Int</code>) and values.  <a href=\"http://hackage.haskell.org/package/constraints-0.10/docs/Data-Constraint.html#t::-45-\" rel=\"nofollow noreferrer\"><code>Sub</code></a> is just the constructor for constraint entailment.</li>\n<li><code>lifting @ToJSON @f @Int</code> is <a href=\"https://downloads.haskell.org/~ghc/latest/docs/html/users_guide/glasgow_exts.html#extension-TypeApplications\" rel=\"nofollow noreferrer\">type application syntax</a>.</li>\n<li>I used <code>genericToJSON defaultOptions</code> by looking up the <a href=\"http://hackage.haskell.org/package/aeson-1.4.0.0/docs/src/Data.Aeson.Types.ToJSON.html#ToJSON\" rel=\"nofollow noreferrer\">default implementation</a> for <code>toJSON</code>.  We just needed to manually bring some instances into scope with <code>lifting</code> first.</li>\n</ul>\n\n<p>I hope this helps.</p>\n"}], "owner": {"reputation": 617, "user_id": 2036930, "user_type": "registered", "accept_rate": 83, "profile_image": "https://www.gravatar.com/avatar/5611c46bb33e051bf692b69cf4411377?s=128&d=identicon&r=PG", "display_name": "statusfailed", "link": "https://stackoverflow.com/users/2036930/statusfailed"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 299, "favorite_count": 1, "accepted_answer_id": 51012769, "answer_count": 1, "score": 3, "last_activity_date": 1529959312, "creation_date": 1529788814, "question_id": 51005138, "link": "https://stackoverflow.com/questions/51005138/how-do-i-write-aeson-tojson-instances-for-types-with-kind", "title": "How do I write aeson ToJSON instances for types with kind (* -&gt; *) -&gt; *", "body": "<h1>Motivation</h1>\n\n<p>I have a type, <code>MyType</code>, which is parametrised by a functor, <code>f</code>.</p>\n\n<p>I want to use <code>MyType Identity</code> to represent \"my view\" of the data, and <code>MyType Maybe</code> to represent the type of <em>updates</em> to the data.</p>\n\n<h1>Problem</h1>\n\n<p>Is it possible to write an aeson <code>ToJSON</code> instance for <code>MyType</code>? I tried to use the <code>ToJSON</code> class, but I get an error (see bottom of post).</p>\n\n<pre><code>{-# LANGUAGE DeriveGeneric #-}\nmodule Main where\n\nimport GHC.Generics\nimport Data.Aeson\n\ndata MyType f = MyType\n  { age  :: f Int\n  , name :: f String\n  } deriving(Generic)\n\ninstance ToJSON1 f =&gt; ToJSON (MyType f)\n\nmain :: IO ()\nmain = print . encode $ MyType (Just 1) (Just \"hi\")\n</code></pre>\n\n<p>How can I get a ToJSON instance for <code>MyType f</code>, for an arbitrary <code>f</code>?</p>\n\n<h1>Compilation error</h1>\n\n<pre><code>Main.hs:12:10: error:\n    \u2022 Could not deduce (ToJSON (f String))\n        arising from a use of \u2018aeson-1.2.4.0:Data.Aeson.Types.ToJSON.$dmtoJSON\u2019\n      from the context: ToJSON1 f\n        bound by the instance declaration\n        at Main.hs:12:10-39\n    \u2022 In the expression:\n        aeson-1.2.4.0:Data.Aeson.Types.ToJSON.$dmtoJSON @MyType f\n      In an equation for \u2018toJSON\u2019:\n          toJSON = aeson-1.2.4.0:Data.Aeson.Types.ToJSON.$dmtoJSON @MyType f\n      In the instance declaration for \u2018ToJSON (MyType f)\u2019\n   |\n12 | instance ToJSON1 f =&gt; ToJSON (MyType f)\n   |          ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\nFailed, no modules loaded.\n</code></pre>\n"}, {"tags": ["haskell"], "answers": [{"comments": [{"owner": {"reputation": 1069, "user_id": 2153280, "user_type": "registered", "accept_rate": 82, "profile_image": "https://i.stack.imgur.com/zkQvQ.jpg?s=128&g=1", "display_name": "Alberto Capitani", "link": "https://stackoverflow.com/users/2153280/alberto-capitani"}, "edited": false, "score": 0, "creation_date": 1529789040, "post_id": 51005048, "comment_id": 89003812, "body": "The real goal of my post was to verify the possibility of using Semigroup and Monoid with complex ADTs. TimeDuration is just an example. Anyway, thanks for the suggestions."}, {"owner": {"reputation": 100892, "user_id": 745903, "user_type": "registered", "accept_rate": 74, "profile_image": "https://www.gravatar.com/avatar/50933f6638836741e620669b3940410e?s=128&d=identicon&r=PG", "display_name": "leftaroundabout", "link": "https://stackoverflow.com/users/745903/leftaroundabout"}, "reply_to_user": {"reputation": 1069, "user_id": 2153280, "user_type": "registered", "accept_rate": 82, "profile_image": "https://i.stack.imgur.com/zkQvQ.jpg?s=128&g=1", "display_name": "Alberto Capitani", "link": "https://stackoverflow.com/users/2153280/alberto-capitani"}, "edited": false, "score": 0, "creation_date": 1529789350, "post_id": 51005048, "comment_id": 89003884, "body": "If it&#39;s actually for <i>complex</i> ADTs (not sure what that&#39;s supposed to mean), then your question was perhaps not very much to the point. You may want to ask a new one that depicts the use case more accurately. At least for physical-quantity types, it&#39;s generally best to keep the implementation simple to one conventional unit, and expose only conversion-safe combinators / constructors."}, {"owner": {"reputation": 1069, "user_id": 2153280, "user_type": "registered", "accept_rate": 82, "profile_image": "https://i.stack.imgur.com/zkQvQ.jpg?s=128&g=1", "display_name": "Alberto Capitani", "link": "https://stackoverflow.com/users/2153280/alberto-capitani"}, "edited": false, "score": 0, "creation_date": 1529789615, "post_id": 51005048, "comment_id": 89003950, "body": "For the moment, I do not have very clear ideas. When I have formulated some more significant examples, I will publish them. Thanks anyway for your answer."}, {"owner": {"reputation": 1069, "user_id": 2153280, "user_type": "registered", "accept_rate": 82, "profile_image": "https://i.stack.imgur.com/zkQvQ.jpg?s=128&g=1", "display_name": "Alberto Capitani", "link": "https://stackoverflow.com/users/2153280/alberto-capitani"}, "edited": false, "score": 0, "creation_date": 1529793093, "post_id": 51005048, "comment_id": 89004630, "body": "An example that implies a complex ADT is that of a set of personal profiles related to a single person but coming from different and more or less complete information sources. The operation (&lt;&gt;) would indicate the &quot;merging&quot; of two profiles."}, {"owner": {"reputation": 100892, "user_id": 745903, "user_type": "registered", "accept_rate": 74, "profile_image": "https://www.gravatar.com/avatar/50933f6638836741e620669b3940410e?s=128&d=identicon&r=PG", "display_name": "leftaroundabout", "link": "https://stackoverflow.com/users/745903/leftaroundabout"}, "reply_to_user": {"reputation": 1069, "user_id": 2153280, "user_type": "registered", "accept_rate": 82, "profile_image": "https://i.stack.imgur.com/zkQvQ.jpg?s=128&g=1", "display_name": "Alberto Capitani", "link": "https://stackoverflow.com/users/2153280/alberto-capitani"}, "edited": false, "score": 0, "creation_date": 1529799891, "post_id": 51005048, "comment_id": 89005545, "body": "That sounds like it would be isomorphic to <code>Data.Map</code> (which is already a monad)."}], "tags": [], "owner": {"reputation": 100892, "user_id": 745903, "user_type": "registered", "accept_rate": 74, "profile_image": "https://www.gravatar.com/avatar/50933f6638836741e620669b3940410e?s=128&d=identicon&r=PG", "display_name": "leftaroundabout", "link": "https://stackoverflow.com/users/745903/leftaroundabout"}, "is_accepted": true, "score": 3, "last_activity_date": 1529788725, "last_edit_date": 1529788725, "creation_date": 1529788007, "answer_id": 51005048, "question_id": 51005015, "link": "https://stackoverflow.com/questions/51005015/can-timeduration-type-be-an-instance-of-semigroup-and-monoid/51005048#51005048", "title": "Can TimeDuration type be an instance of Semigroup and Monoid?", "body": "<p>Yeah, that's fine. It's basically equivalent to</p>\n\n<pre><code>{-# LANGUAGE DeriveGeneric, DeriveAnyClass #-}\n\nimport Data.AdditiveGroup\nimport GHC.Generics\n\nnewtype TimeDuration = TimeDuration {getDurationInSeconds :: Integer}\n  deriving (Generic, AdditiveGroup)\n</code></pre>\n\n<p>...with extra constructors for the special cases <code>TimeDuration 60</code>, <code>TimeDuration 180</code>... <code>TimeDuration 3600</code> etc. (which in your construction are actually redundant; you could better make simple builder-functions to do the same job).</p>\n\n<p>The <a href=\"http://hackage.haskell.org/package/vector-space-0.13/docs/Data-AdditiveGroup.html\" rel=\"nofollow noreferrer\"><code>AdditiveGroup</code> typeclass</a> is a specialised monoid typeclass, that avoids any confusion that it might be a <em>multiplication monoid</em> instead \u2013 which wouldn't actually make any sense because dimension-wise, <em>time</em> \u00d7 <em>time</em> doesn't match <em>time</em>, but for dimensionless number types like <code>Int</code> or <code>Double</code> the multiplication monoid is just as sensible as the addition one.</p>\n\n<p>Because these still have an unambiguous <code>AdditiveGroup</code> instance, the <code>AdditiveGroup TimeDuration</code> instance can just be derived. It could also be written by hand</p>\n\n<pre><code>instance AdditiveGroup TimeDuration where\n  zeroV = TimeDuration 0\n  TimeDuration \u03b4t\u2080 ^+^ TimeDuration \u03b4t\u2081 = TimeDuration $ \u03b4t\u2080 + \u03b4t\u2081\n</code></pre>\n\n<p>One particularly nice thing about <code>AdditiveGroup</code>: it's a precursor to <a href=\"http://hackage.haskell.org/package/vector-space-0.13/docs/Data-VectorSpace.html\" rel=\"nofollow noreferrer\"><code>VectorSpace</code></a> which gives you a multiplication that <em>does</em> make sense, namely</p>\n\n<pre><code>instance VectorSpace TimeDuration where\n  type Scalar TimeDuration = Integer\n  factor *^ TimeDuration \u03b4t = TimeDuration $ factor * \u03b4t\n</code></pre>\n"}, {"comments": [{"owner": {"reputation": 1069, "user_id": 2153280, "user_type": "registered", "accept_rate": 82, "profile_image": "https://i.stack.imgur.com/zkQvQ.jpg?s=128&g=1", "display_name": "Alberto Capitani", "link": "https://stackoverflow.com/users/2153280/alberto-capitani"}, "edited": false, "score": 0, "creation_date": 1529788874, "post_id": 51005099, "comment_id": 89003776, "body": "The real goal of my post was to verify the possibility of using Semigroup and Monoid with complex ADTs. TimeDuration is just an example. Anyway, thanks for the suggestions."}], "tags": [], "owner": {"reputation": 4234, "user_id": 4942760, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/f322d06b4f3e34278f29a954e0f38cb1?s=128&d=identicon&r=PG&f=1", "display_name": "Dan Robertson", "link": "https://stackoverflow.com/users/4942760/dan-robertson"}, "is_accepted": false, "score": 1, "last_activity_date": 1529841981, "last_edit_date": 1529841981, "creation_date": 1529788507, "answer_id": 51005099, "question_id": 51005015, "link": "https://stackoverflow.com/questions/51005015/can-timeduration-type-be-an-instance-of-semigroup-and-monoid/51005099#51005099", "title": "Can TimeDuration type be an instance of Semigroup and Monoid?", "body": "<p>This looks ok but why not just do this?</p>\n\n<pre><code>newtype TimeDuration = Seconds (Sum Integer) deriving (Show, Eq, Monoid, Semigroup)\n</code></pre>\n\n<p>I think you need extensions to derive semigroup and monoid through the newtype, and you need to import <code>Sum</code> from <code>Data.Foldable</code></p>\n\n<p>You can have functions for the rest:</p>\n\n<pre><code>seconds = Seconds\nminutes = seconds . (*60)\nhours = minutes . (*60)\n</code></pre>\n\n<p>Another thing you might want would be:</p>\n\n<pre><code>data TimDuration = Duration { seconds :: Int, minutes :: Int, hours :: Integer }\n</code></pre>\n\n<p>And define a function to normalise this. But here\u2019s a question to demonstrate that actually adding durations and times is difficult: is adding a minute the same as adding 60s? One would think so but what if say the time is 23:59:00 and the last minute has a leap second? In such a case if you add 60 seconds you get to 23:59:60. If you add a minute should you get 23:59:60 or 00:00:00 for the next day? In this case I think saying a minute is 60s is sensible. But how long is a day or a month? What happens if you add a day to 12:00 the day before the clocks change. Should you get 12:00 the next day or 13:00/11:00? And if you add a month to 29 January should you get 28 February or 1 March? And what about on leap years? Time is hard once things aren\u2019t always seconds.</p>\n"}, {"comments": [{"owner": {"reputation": 1069, "user_id": 2153280, "user_type": "registered", "accept_rate": 82, "profile_image": "https://i.stack.imgur.com/zkQvQ.jpg?s=128&g=1", "display_name": "Alberto Capitani", "link": "https://stackoverflow.com/users/2153280/alberto-capitani"}, "edited": false, "score": 0, "creation_date": 1529812851, "post_id": 51006435, "comment_id": 89006909, "body": "The difference consists in the intentions of H (hours) and S (seconds) and in the easiness of human understanding of the two quantities. As a 20! is different from 2432902008176640000, intensionally and cognitively speaking. Thanks anyway for the articulated answer."}], "tags": [], "owner": {"reputation": 31243, "user_id": 2751851, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/4ddc0.png?s=128&g=1", "display_name": "duplode", "link": "https://stackoverflow.com/users/2751851/duplode"}, "is_accepted": false, "score": 2, "last_activity_date": 1529812718, "last_edit_date": 1529812718, "creation_date": 1529806375, "answer_id": 51006435, "question_id": 51005015, "link": "https://stackoverflow.com/questions/51005015/can-timeduration-type-be-an-instance-of-semigroup-and-monoid/51006435#51006435", "title": "Can TimeDuration type be an instance of Semigroup and Monoid?", "body": "<p>If we are writing an instance for a class with laws, the first sanity check should, in general, be whether the instance follows them. For <code>Semigroup</code>, there is the associativity law...</p>\n\n<pre><code>(x &lt;&gt; y) &lt;&gt; z = x &lt;&gt; (y &lt;&gt; z)\n</code></pre>\n\n<p>... while <code>Monoid</code> adds the identity laws:</p>\n\n<pre><code>mempty &lt;&gt; x = x\nx &lt;&gt; mempty = x\n</code></pre>\n\n<p>Your instance follows the laws as long as only <code>S</code> values are involved (as it boils down to adding seconds). However, the identity laws are broken once the other constructors are brought into play, as in:</p>\n\n<pre><code>mempty &lt;&gt; H 2 = S 7200\n</code></pre>\n\n<p>We might be tempted to argue that <code>H 2</code> and <code>S 7200</code> are morally the same, and the difference between them is merely a presentation issue (cf. how <code>show . read</code> is, strictly speaking, not <code>id</code> as it normalises formatting). The question, then, would become why are <code>H</code> and <code>M</code> necessary if they aren't meant to be used for any relevant distinctions (cf. the other answers).</p>\n"}], "owner": {"reputation": 1069, "user_id": 2153280, "user_type": "registered", "accept_rate": 82, "profile_image": "https://i.stack.imgur.com/zkQvQ.jpg?s=128&g=1", "display_name": "Alberto Capitani", "link": "https://stackoverflow.com/users/2153280/alberto-capitani"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 51, "favorite_count": 0, "accepted_answer_id": 51005048, "answer_count": 3, "score": 0, "last_activity_date": 1529848687, "creation_date": 1529787672, "last_edit_date": 1529848687, "question_id": 51005015, "link": "https://stackoverflow.com/questions/51005015/can-timeduration-type-be-an-instance-of-semigroup-and-monoid", "title": "Can TimeDuration type be an instance of Semigroup and Monoid?", "body": "<p>In an attempt to find a quick and easy way to add different time periods, it occurred to me that I could declare them instances of Semigroup and Monoid. Are the following instantiations valid?</p>\n\n<pre><code>data TimeDuration = S Int | M Int | H Int deriving (Show, Eq)\n\ninstance Semigroup TimeDuration where\n    S n1 &lt;&gt; S n2 = S (n1 + n2)\n    M n1 &lt;&gt; M n2 = S (60 * (n1 + n2))\n    H n1 &lt;&gt; H n2 = S (3600 * (n1 + n2))\n    S n1 &lt;&gt; M n2 = S (n1 + 60 * n2)\n    S n1 &lt;&gt; H n2 = S (n1 + 3600 * n2)\n    M n1 &lt;&gt; S n2 = S (60 * n1 + n2)\n    M n1 &lt;&gt; H n2 = S (60 * n1 + 3600 * n2)\n    H n1 &lt;&gt; S n2 = S (3600 * n1 + n2)\n    H n1 &lt;&gt; M n2 = S (3600 * n1 + 60 * n2)\n\ninstance Monoid TimeDuration where\n    mempty = S 0\n</code></pre>\n\n<p>Example:  mconcat [S 1, M 2, M 3, S 2, H 1] == S 3903</p>\n\n<p>User <em>leftaroundabout</em> ask me to produce more significative example. So this is a new implementation and some examples that I hope will show better the possible variety of the results of the operation (&lt;>)</p>\n\n<pre><code>instance Semigroup TimeDuration where\n    S n1 &lt;&gt; S n2 = S (n1 + n2)\n    M n1 &lt;&gt; M n2 = M (n1 + n2)\n    H n1 &lt;&gt; H n2 = H (n1 + n2)\n    S n1 &lt;&gt; M n2 = S (n1 + 60 * n2)\n    M n1 &lt;&gt; S n2 = S n2 &lt;&gt; M n1\n    S n1 &lt;&gt; H n2 = S (n1 + 3600 * n2)\n    H n1 &lt;&gt; S n2 = S n2 &lt;&gt; H n1\n    M n1 &lt;&gt; H n2 = M (n1 + 60 * n2)\n    H n1 &lt;&gt; M n2 = M n1 &lt;&gt; H n1 \n\n\ninstance Monoid TimeDuration where\n    mempty = S 0\n    mconcat [] = S 0\n    mconcat xs = foldr1 (\\y acc -&gt; y &lt;&gt; acc) xs\n\n-- ex. mconcat [M 2, M 3] == M 5\n-- ex. mconcat [H 2, H 3] == H 5\n-- ex. mconcat [M 2, M 3, S 1] == S 301\n-- ex. mconcat [H 2, H 3, M 1] == M 301\n-- ex. mconcat [H 2, H 3, S 1] == S 18001\n</code></pre>\n"}, {"tags": ["haskell", "haskell-stack", "nixos"], "answers": [{"comments": [{"owner": {"reputation": 5821, "user_id": 1770201, "user_type": "registered", "accept_rate": 45, "profile_image": "https://www.gravatar.com/avatar/46bcb5d2018194c9beb884b6797e57e0?s=128&d=identicon&r=PG", "display_name": "George", "link": "https://stackoverflow.com/users/1770201/george"}, "edited": false, "score": 0, "creation_date": 1531337092, "post_id": 51020457, "comment_id": 89563340, "body": "I get the error &quot;attribute &#39;Cabal_2_2_0_1&#39; missing&quot; when building."}, {"owner": {"reputation": 5821, "user_id": 1770201, "user_type": "registered", "accept_rate": 45, "profile_image": "https://www.gravatar.com/avatar/46bcb5d2018194c9beb884b6797e57e0?s=128&d=identicon&r=PG", "display_name": "George", "link": "https://stackoverflow.com/users/1770201/george"}, "edited": false, "score": 0, "creation_date": 1531337365, "post_id": 51020457, "comment_id": 89563435, "body": "Also I&#39;ve modified it to stack version &quot;1.8.0&quot; (the new bleeding edge from <code>stack update --git</code>), and I&#39;m getting &quot;tar: */stack/1.8.0/stack.json: Not found in archive&quot;."}, {"owner": {"reputation": 4232, "user_id": 428586, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/yHNYS.jpg?s=128&g=1", "display_name": "Robert Hensing", "link": "https://stackoverflow.com/users/428586/robert-hensing"}, "reply_to_user": {"reputation": 5821, "user_id": 1770201, "user_type": "registered", "accept_rate": 45, "profile_image": "https://www.gravatar.com/avatar/46bcb5d2018194c9beb884b6797e57e0?s=128&d=identicon&r=PG", "display_name": "George", "link": "https://stackoverflow.com/users/1770201/george"}, "edited": false, "score": 0, "creation_date": 1531491686, "post_id": 51020457, "comment_id": 89629751, "body": "You may need a newer version of Nixpkgs, because even the <code>callHackage</code> versions are pinned by Nixpkgs. If it doesn&#39;t resolve the missing Cabal attribute error, you may be able to find the right version of the Cabal library using <code>nix repl</code>."}], "tags": [], "owner": {"reputation": 4232, "user_id": 428586, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/yHNYS.jpg?s=128&g=1", "display_name": "Robert Hensing", "link": "https://stackoverflow.com/users/428586/robert-hensing"}, "is_accepted": false, "score": 1, "last_activity_date": 1529919749, "creation_date": 1529919749, "answer_id": 51020457, "question_id": 51004458, "link": "https://stackoverflow.com/questions/51004458/forcing-haskell-stack-to-be-version-1-7-on-nixos/51020457#51020457", "title": "Forcing Haskell Stack to be Version 1.7.* on NixOS", "body": "<p>Adding this overlay should do the trick:</p>\n\n<pre><code>(self: super: {\n  haskellPackages = super.haskellPackages.extend\n    (hself: hsuper: {\n      stack = (hsuper.callHackage \"stack\" \"1.7.1\" {})\n              .overrideScope (hself2: hsuper2: {\n        Cabal = hself2.Cabal_2_2_0_1;\n        hpack = hself2.hpack_0_28_2;\n      });\n    });\n})\n</code></pre>\n\n<p>This successfully builds <code>stack</code> on Nixpkgs master. It will be available as the <code>stack</code> attribute or <code>haskellPackages.stack</code> attribute.</p>\n"}], "owner": {"reputation": 5821, "user_id": 1770201, "user_type": "registered", "accept_rate": 45, "profile_image": "https://www.gravatar.com/avatar/46bcb5d2018194c9beb884b6797e57e0?s=128&d=identicon&r=PG", "display_name": "George", "link": "https://stackoverflow.com/users/1770201/george"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 103, "favorite_count": 0, "answer_count": 1, "score": 3, "last_activity_date": 1529919749, "creation_date": 1529782464, "last_edit_date": 1529787928, "question_id": 51004458, "link": "https://stackoverflow.com/questions/51004458/forcing-haskell-stack-to-be-version-1-7-on-nixos", "title": "Forcing Haskell Stack to be Version 1.7.* on NixOS", "body": "<p><strong>Context.</strong> </p>\n\n<ol>\n<li>I'm running NixOS, with <code>stack</code> included in my <code>configuration.nix</code>.</li>\n<li>Running <code>stack --version</code> yields <code>Version 1.6.3 x86_64</code>.</li>\n<li>But I need Version <code>&gt;=1.7</code> in order to compile a bleeding edge Haskell package that my team is working on.</li>\n<li>The current version on nixpkgs search is <code>1.6.5</code>, which is too old anyway.</li>\n<li>I think normally on non-NixOS you could just run \"stack upgrade\" in your home folder, but that doesn't seem to work.</li>\n</ol>\n\n<p><strong>Question:</strong> Does anyone know how to force stack on NixOS to compile to version, i.e., <code>1.7.1</code>?</p>\n"}, {"tags": ["haskell", "functional-programming", "purely-functional"], "comments": [{"owner": {"reputation": 14543, "user_id": 235908, "user_type": "registered", "accept_rate": 83, "profile_image": "https://i.stack.imgur.com/rTstt.jpg?s=128&g=1", "display_name": "Simon Shine", "link": "https://stackoverflow.com/users/235908/simon-shine"}, "edited": false, "score": 2, "creation_date": 1529778453, "post_id": 51003850, "comment_id": 89001480, "body": "<a href=\"https://en.wikipedia.org/wiki/Purely_functional_programming\" rel=\"nofollow noreferrer\">Pure</a> means that functions are modelled as mathematical functions and have no side-effects. Safe in the context of Haskell can mean <a href=\"https://stackoverflow.com/questions/32804032/what-is-an-unsafe-function-in-haskell\">many things</a>, e.g. type safety. <a href=\"https://en.wikipedia.org/wiki/Referential_transparency\" rel=\"nofollow noreferrer\">Referential transparency</a> is a consequence of the use of pure functions."}, {"owner": {"reputation": 3074, "user_id": 1608276, "user_type": "registered", "accept_rate": 28, "profile_image": "https://i.stack.imgur.com/XiZ2q.jpg?s=128&g=1", "display_name": "luochen1990", "link": "https://stackoverflow.com/users/1608276/luochen1990"}, "reply_to_user": {"reputation": 14543, "user_id": 235908, "user_type": "registered", "accept_rate": 83, "profile_image": "https://i.stack.imgur.com/rTstt.jpg?s=128&g=1", "display_name": "Simon Shine", "link": "https://stackoverflow.com/users/235908/simon-shine"}, "edited": false, "score": 0, "creation_date": 1529778622, "post_id": 51003850, "comment_id": 89001519, "body": "@SimonShine Thanks for your comment, why not post an answer?  And why people here doesn&#39;t accept this question?  can I get any suggestion from you?"}, {"owner": {"reputation": 18055, "user_id": 936310, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/302ec54987694b9746abf8e2e0ad8caf?s=128&d=identicon&r=PG&f=1", "display_name": "alias", "link": "https://stackoverflow.com/users/936310/alias"}, "edited": false, "score": 1, "creation_date": 1529779152, "post_id": 51003850, "comment_id": 89001645, "body": "I&#39;ve always been fond of Amr&#39;s 1998 paper that explored a similar question with the rigor it deserved: <a href=\"https://www.cs.indiana.edu/~sabry/papers/purelyFunctional.ps\" rel=\"nofollow noreferrer\">cs.indiana.edu/~sabry/papers/purelyFunctional.ps</a>"}, {"owner": {"reputation": 44043, "user_id": 1565698, "user_type": "registered", "accept_rate": 38, "profile_image": "https://www.gravatar.com/avatar/7dace33805b9dcdec5aa63308daf88dc?s=128&d=identicon&r=PG", "display_name": "Sylwester", "link": "https://stackoverflow.com/users/1565698/sylwester"}, "edited": false, "score": 0, "creation_date": 1529787346, "post_id": 51003850, "comment_id": 89003405, "body": "You know you are comparing noe language with a whole family of languages that have different capabilities on this matter? It&#39;s like saying Algol-family doesn&#39;t do tail recursion, but it does since JavaScript got it last year, Scala has it so then you cannot talk about Algol as it only had one set of features."}, {"owner": {"reputation": 14543, "user_id": 235908, "user_type": "registered", "accept_rate": 83, "profile_image": "https://i.stack.imgur.com/rTstt.jpg?s=128&g=1", "display_name": "Simon Shine", "link": "https://stackoverflow.com/users/235908/simon-shine"}, "edited": false, "score": 0, "creation_date": 1529799362, "post_id": 51003850, "comment_id": 89005486, "body": "@luochen1990: I just googled and summarized the first results. The reason given for closing the question is mainly that it&#39;s too broad, but I would say that it shows very little effort, happens to be slightly opinionated (which you probably didn&#39;t know) and essentially comes down to finding encyclopedic definitions (asking for references to resources)."}], "answers": [{"tags": [], "owner": {"reputation": 18055, "user_id": 936310, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/302ec54987694b9746abf8e2e0ad8caf?s=128&d=identicon&r=PG&f=1", "display_name": "alias", "link": "https://stackoverflow.com/users/936310/alias"}, "is_accepted": false, "score": 4, "last_activity_date": 1529793359, "last_edit_date": 1529793359, "creation_date": 1529779413, "answer_id": 51004099, "question_id": 51003850, "link": "https://stackoverflow.com/questions/51003850/what-is-the-relationship-between-safe-pure-referential-transparency-in-funct/51004099#51004099", "title": "what is the relationship between safe &amp; pure &amp; referential transparency in functional programming?", "body": "<p>I've always been fond of Amr Sabry's 1998 paper that explored a similar question with the rigor it deserved: <a href=\"https://www.cs.indiana.edu/~sabry/papers/purelyFunctional.ps\" rel=\"nofollow noreferrer\">https://www.cs.indiana.edu/~sabry/papers/purelyFunctional.ps</a></p>\n\n<p>A sample quote:</p>\n\n<blockquote>\n  <p>A language is purely functional if (i) it includes every simply typed\n  lambda-calculus term, and (ii) its call-by-name, call-by-need, and\n  call-by-value implementations are equivalent modulo divergence and\n  errors.</p>\n</blockquote>\n\n<p>While this question can generate a lot of \"opinion\" based answers (which I am carefully avoiding!), reading through Amr's paper can put you in the right mindset about how to think about this question; regardless whether you end up agreeing with him or not.</p>\n"}], "owner": {"reputation": 3074, "user_id": 1608276, "user_type": "registered", "accept_rate": 28, "profile_image": "https://i.stack.imgur.com/XiZ2q.jpg?s=128&g=1", "display_name": "luochen1990", "link": "https://stackoverflow.com/users/1608276/luochen1990"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 101, "favorite_count": 0, "closed_date": 1529780433, "answer_count": 1, "score": -1, "last_activity_date": 1529793359, "creation_date": 1529777557, "question_id": 51003850, "link": "https://stackoverflow.com/questions/51003850/what-is-the-relationship-between-safe-pure-referential-transparency-in-funct", "closed_reason": "Needs more focus", "title": "what is the relationship between safe &amp; pure &amp; referential transparency in functional programming?", "body": "<ol>\n<li>pure / impure: appears when we talk about the different between Haskell and lisp-family.</li>\n<li>safe / unsafe: appears when we name functions like unsafePerformIO, unsafeCoerce.</li>\n<li>referential transparency / referential opacity: appears when we emphasize the benefit of purely functional programming.</li>\n</ol>\n\n<p>The difference between these words are very subtle, I find there is some post talking about them individually, but I'm still hoping there is a clear comparison between them, and I can't find such a post here yet.</p>\n"}, {"tags": ["haskell", "generator", "generalization"], "comments": [{"owner": {"reputation": 11366, "user_id": 3922954, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/76ba47d2fdd24ab56b0b273cce2075e5?s=128&d=identicon&r=PG&f=1", "display_name": "AJF", "link": "https://stackoverflow.com/users/3922954/ajf"}, "edited": false, "score": 0, "creation_date": 1529758473, "post_id": 50998219, "comment_id": 88996432, "body": "<a href=\"https://www.haskell.org/hoogle/?hoogle=Int+-%3E+m+a+-%3E+m+%5Ba%5D\" rel=\"nofollow noreferrer\">hint</a>."}], "answers": [{"tags": [], "owner": {"reputation": 11096, "user_id": 2749717, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/46af1ef54856d737d52b7667afd240ee?s=128&d=identicon&r=PG&f=1", "display_name": "bipll", "link": "https://stackoverflow.com/users/2749717/bipll"}, "is_accepted": false, "score": 0, "last_activity_date": 1529732484, "creation_date": 1529732484, "answer_id": 50998302, "question_id": 50998219, "link": "https://stackoverflow.com/questions/50998219/is-there-a-way-to-generalise-multiple-generators-and-randoms-in-haskell/50998302#50998302", "title": "Is there a way to generalise multiple generators and randoms in haskell", "body": "<p>Currently as it is formulated, you only need to sum up k*N <em>individual</em> die rolls and divide them by N, where k is amount of dice you want to roll \"simultaneously\", N amount of trials. Summing all dice in a single roll then summing all rolls is the same as summing all dice overall.</p>\n\n<p>If you want it complicated, well, make single multiroll a list of random values of specified length, sum it (you can use plain <code>sum</code> even with no optimization when k is not too large), compute the average of results.</p>\n"}, {"tags": [], "owner": {"reputation": 100185, "user_id": 3234959, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/93bb12ca0f93dfddb33880316f7e66c2?s=128&d=identicon&r=PG&f=1", "display_name": "chi", "link": "https://stackoverflow.com/users/3234959/chi"}, "is_accepted": true, "score": 4, "last_activity_date": 1529758934, "last_edit_date": 1529758934, "creation_date": 1529744957, "answer_id": 50999652, "question_id": 50998219, "link": "https://stackoverflow.com/questions/50998219/is-there-a-way-to-generalise-multiple-generators-and-randoms-in-haskell/50999652#50999652", "title": "Is there a way to generalise multiple generators and randoms in haskell", "body": "<p>The <code>System.Random</code> module offers some basic primitive, but (in my opinion) it lacks a proper monadic interface. More precisely, it offers an IO-based monadic interface, but lacks a State-based monadic interface. The latter is however <a href=\"https://en.wikibooks.org/wiki/Haskell/Understanding_monads/State\" rel=\"nofollow noreferrer\">easy to define </a>, though.</p>\n\n<p>Anyway, if one wants to stick with IO and the standard generator, one could write:</p>\n\n<pre><code>-- (untested code)\n\nrollDie :: Int -&gt; IO Int\nrollDie n = randomIO (1,n) -- implicitly uses the global generator\n\nrollManyDice :: Int -&gt; Int -&gt; IO [Int]\nrollManyDice howMany n = replicateM howMany (rollDie n)\n\nmain :: IO ()\nmain = do\n   dice &lt;- rollManyDice 20 6\n   putStrLn $ \"Here's 20 6-sides dice : \" ++ show dice\n</code></pre>\n\n<p>where <code>replicateM</code> executes <code>howMany</code> times a monadic action, collecting all the results in a list. Here the monad is <code>IO</code>, but it could be anything.</p>\n\n<p>This is a fine and simple approach, but the <code>IO</code> type above is a bit too much, preventing us to call <code>rollDie</code> from non-IO code. A <code>State</code>-based solution would not have this limination</p>\n\n<pre><code>type R a = State StdGen a\n\nrollDie :: Int -&gt; R Int\nrollDie n = state $ randomR (1,n) -- uses the generator inside the State monad\n\nrollManyDice :: Int -&gt; Int -&gt; R [Int]\nrollManyDice howMany n = replicateM howMany (rollDie n)\n\nmain :: IO ()\nmain = do\n   g &lt;- getStdGen\n   let dice = evalState (rollManyDice 20 6) g\n   putStrLn $ \"Here's 20 6-sides dice : \" ++ show dice\n</code></pre>\n"}, {"tags": [], "owner": {"reputation": 889, "user_id": 1163153, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/cda8bb97c45f51587474460f34d90b8a?s=128&d=identicon&r=PG", "display_name": "Curious", "link": "https://stackoverflow.com/users/1163153/curious"}, "is_accepted": false, "score": 0, "last_activity_date": 1529752080, "creation_date": 1529752080, "answer_id": 51000579, "question_id": 50998219, "link": "https://stackoverflow.com/questions/50998219/is-there-a-way-to-generalise-multiple-generators-and-randoms-in-haskell/51000579#51000579", "title": "Is there a way to generalise multiple generators and randoms in haskell", "body": "<pre><code>module Dice where\nimport System.Random\nimport Data.List\nimport Control.Applicative\nimport Control.Monad\n\nrollDie :: Int -&gt; IO Int\nrollDie n = randomRIO (1,n)\n\nrollManyDice :: Int -&gt; Int -&gt; IO [Int]\nrollManyDice howMany n = replicateM howMany (rollDie n)\n\ndice2 = do\n    dice &lt;- rollManyDice 8 6\n    putStrLn $ \"Here's 20 -6 sided dice: \" ++show dice\n</code></pre>\n"}], "owner": {"reputation": 889, "user_id": 1163153, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/cda8bb97c45f51587474460f34d90b8a?s=128&d=identicon&r=PG", "display_name": "Curious", "link": "https://stackoverflow.com/users/1163153/curious"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 119, "favorite_count": 0, "accepted_answer_id": 50999652, "answer_count": 3, "score": 1, "last_activity_date": 1529758934, "creation_date": 1529731473, "question_id": 50998219, "link": "https://stackoverflow.com/questions/50998219/is-there-a-way-to-generalise-multiple-generators-and-randoms-in-haskell", "title": "Is there a way to generalise multiple generators and randoms in haskell", "body": "<p>I'm learning Haskell. \n<a href=\"https://stackoverflow.com/questions/7144590/average-of-large-number-of-dice-rolls-in-haskell\">Average of large number of Dice Rolls in Haskell</a>\nHow shall I make the below code work with multiple dices say 8 dices) instead of repeatedly creating let rolls..3,4,5...etc...</p>\n\n<pre><code>module Dice where\nimport System.Random\nimport Data.List\n\ndice = do\n    g &lt;- getStdGen\n    b &lt;- newStdGen\n    let trials = 1000\n    let rolls1 = take trials (randomRs (1,6) g :: [Int])\n    let rolls2 = take trials (randomRs (1,6) b::[Int])\n    let rolls = zipWith (+) rolls1 rolls2\n    let average = div (foldl' (+) 0 rolls) trials\n    print average\n</code></pre>\n"}, {"tags": ["algorithm", "haskell", "recursion", "functional-programming", "ocaml"], "comments": [{"owner": {"reputation": 126897, "user_id": 791604, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/ce991df7a056248d5e4f6fc3659ba733?s=128&d=identicon&r=PG", "display_name": "Daniel Wagner", "link": "https://stackoverflow.com/users/791604/daniel-wagner"}, "edited": false, "score": 3, "creation_date": 1529727731, "post_id": 50997903, "comment_id": 88989844, "body": "Okay, you don&#39;t want to use <code>(==)</code> for equality. What do you want to use instead?"}, {"owner": {"reputation": 123, "user_id": 9778550, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/65bae29e588931ecb123cd767d6cb745?s=128&d=identicon&r=PG", "display_name": "CuriousKid7", "link": "https://stackoverflow.com/users/9778550/curiouskid7"}, "reply_to_user": {"reputation": 126897, "user_id": 791604, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/ce991df7a056248d5e4f6fc3659ba733?s=128&d=identicon&r=PG", "display_name": "Daniel Wagner", "link": "https://stackoverflow.com/users/791604/daniel-wagner"}, "edited": false, "score": 0, "creation_date": 1529728102, "post_id": 50997903, "comment_id": 88989892, "body": "@DanielWagner I&#39;m not sure. I&#39;m asking for a program that works for lists whose elements can&#39;t be compared by equality."}, {"owner": {"reputation": 14543, "user_id": 235908, "user_type": "registered", "accept_rate": 83, "profile_image": "https://i.stack.imgur.com/rTstt.jpg?s=128&g=1", "display_name": "Simon Shine", "link": "https://stackoverflow.com/users/235908/simon-shine"}, "edited": false, "score": 5, "creation_date": 1529731432, "post_id": 50997903, "comment_id": 88990435, "body": "@CuriousKid7: In general, that&#39;d be equivalent to solving the Halting problem, since arbitrary lists may contain function values, and comparing functions for equality is undecidable."}, {"owner": {"reputation": 54864, "user_id": 404970, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/o6X94.jpg?s=128&g=1", "display_name": "molbdnilo", "link": "https://stackoverflow.com/users/404970/molbdnilo"}, "edited": false, "score": 9, "creation_date": 1529744124, "post_id": 50997903, "comment_id": 88993062, "body": "Can you write down what &quot;sublist&quot; <i>means</i> without using equality between elements?"}], "answers": [{"tags": [], "owner": {"reputation": 8613, "user_id": 7369366, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/7e6fa5d3c56da8e000423e79b5dbf682?s=128&d=identicon&r=PG&f=1", "display_name": "octachron", "link": "https://stackoverflow.com/users/7369366/octachron"}, "is_accepted": true, "score": 9, "last_activity_date": 1529756666, "creation_date": 1529756666, "answer_id": 51001129, "question_id": 50997903, "link": "https://stackoverflow.com/questions/50997903/testing-if-one-list-is-a-sublist-of-another-without-testing-equality-between-ele/51001129#51001129", "title": "Testing if one list is a sublist of another without testing equality between elements", "body": "<p>Without an equality, the relation <code>is_sublist</code> is non-sensical: <code>[x] `is_sublist` [y]</code> ought to be true if and only if <code>x</code> = <code>y</code>. Conversely, if such function <code>is_sublist</code> existed, it would define an equality function as <code>eq x y = [x] `is_sublist` [y]</code> . </p>\n"}], "owner": {"reputation": 123, "user_id": 9778550, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/65bae29e588931ecb123cd767d6cb745?s=128&d=identicon&r=PG", "display_name": "CuriousKid7", "link": "https://stackoverflow.com/users/9778550/curiouskid7"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 319, "favorite_count": 0, "accepted_answer_id": 51001129, "answer_count": 1, "score": 0, "last_activity_date": 1529756666, "creation_date": 1529727410, "last_edit_date": 1529729261, "question_id": 50997903, "link": "https://stackoverflow.com/questions/50997903/testing-if-one-list-is-a-sublist-of-another-without-testing-equality-between-ele", "title": "Testing if one list is a sublist of another without testing equality between elements", "body": "<p>I am wondering if one can write a functional program (as in Haskell or OCaml) that takes two lists and determines if the first is a sublist of the second, with the property that the program cannot invoke equality between elements of the list.</p>\n\n<p><strong>More generally, is there such a program that works for lists of elements of arbitrary type?</strong> That is, (in Haskell terms) the type does not have to be constrained by Eq, Ord, or something else.</p>\n\n<p>The reason I ask this is that when dealing with lists of elements of arbitrary type, standard equality (as for ints, strings, etc.) is sometimes not supported for these elements. It would be helpful, however, to test for sublists.</p>\n\n<p>I have been unable to think of an implementation that meets this condition. Is it possible to create one?</p>\n"}, {"tags": ["haskell"], "comments": [{"owner": {"reputation": 62252, "user_id": 1435869, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/TrEd9.jpg?s=128&g=1", "display_name": "karakfa", "link": "https://stackoverflow.com/users/1435869/karakfa"}, "edited": false, "score": 2, "creation_date": 1529714948, "post_id": 50997039, "comment_id": 88988344, "body": "hint: <code>[] ++ [] == []</code>"}, {"owner": {"reputation": 1889, "user_id": 4540658, "user_type": "registered", "accept_rate": 88, "profile_image": "https://i.stack.imgur.com/9vCJz.jpg?s=128&g=1", "display_name": "Dannyu NDos", "link": "https://stackoverflow.com/users/4540658/dannyu-ndos"}, "edited": false, "score": 1, "creation_date": 1529715659, "post_id": 50997039, "comment_id": 88988440, "body": "Hint 2: <code>[x1,x2,x3,x4,...,xn] = x1 : x2 : x3 : x4 : ... : xn : []</code>"}], "answers": [{"tags": [], "owner": {"reputation": 126897, "user_id": 791604, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/ce991df7a056248d5e4f6fc3659ba733?s=128&d=identicon&r=PG", "display_name": "Daniel Wagner", "link": "https://stackoverflow.com/users/791604/daniel-wagner"}, "is_accepted": true, "score": 5, "last_activity_date": 1529716734, "creation_date": 1529716734, "answer_id": 50997171, "question_id": 50997039, "link": "https://stackoverflow.com/questions/50997039/defining-my-own-concat/50997171#50997171", "title": "Defining my own concat", "body": "<blockquote>\n  <p>If I'm right and it goes to the 2nd definition, what are the values of <code>xs</code> and <code>xss</code>?</p>\n</blockquote>\n\n<p>Let's ask:</p>\n\n<pre><code>&gt; f (xs:xss) = (xs, xss)\n&gt; f [[]]\n([],[])\n</code></pre>\n\n<p>So now try substituting these values into your definition:</p>\n\n<pre><code>concat (xs:xss) = xs ++ (Main.concat xss)\n                = [] ++ (Main.concat [] )\n                = [] ++ []\n                = []\n</code></pre>\n"}, {"tags": [], "owner": {"reputation": 16263, "user_id": 814761, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/030202f384a132247f144ee2b8f809ae?s=128&d=identicon&r=PG", "display_name": "Purag", "link": "https://stackoverflow.com/users/814761/purag"}, "is_accepted": false, "score": 3, "last_activity_date": 1529716800, "creation_date": 1529716800, "answer_id": 50997176, "question_id": 50997039, "link": "https://stackoverflow.com/questions/50997039/defining-my-own-concat/50997176#50997176", "title": "Defining my own concat", "body": "<p><code>[[]]</code> can also be written as <code>[] : []</code> (using the <code>(:)</code> constructor) -- that is, the list whose head is the empty list and whose tail is the empty list. So this can successfully pattern match against <code>xs:xss</code>.</p>\n\n<p>So after matching <code>xs</code> with <code>[]</code> and <code>xss</code> with <code>[]</code>, we effectively get the following behavior:</p>\n\n<pre><code>let xs = [] in\n  let xss = [] in\n    xs ++ (Main.concat xss)\n</code></pre>\n\n<p>And with substitution, we get</p>\n\n<pre><code>[] ++ (Main.concat [])\n</code></pre>\n\n<p>That recursive call will hit the base case and thus return <code>[]</code>, giving <code>[] ++ []</code> and eventually <code>[]</code>.</p>\n"}, {"tags": [], "owner": {"reputation": 11366, "user_id": 3922954, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/76ba47d2fdd24ab56b0b273cce2075e5?s=128&d=identicon&r=PG&f=1", "display_name": "AJF", "link": "https://stackoverflow.com/users/3922954/ajf"}, "is_accepted": false, "score": 1, "last_activity_date": 1529757995, "creation_date": 1529757995, "answer_id": 51001301, "question_id": 50997039, "link": "https://stackoverflow.com/questions/50997039/defining-my-own-concat/51001301#51001301", "title": "Defining my own concat", "body": "<p><strong>TL/DR:</strong> <code>[[]] = [] : []</code> just as <code>[1] = 1 : []</code>, so it matches the <code>x:xs</code> pattern.</p>\n\n<p>In Haskell a list is defined as so:</p>\n\n<pre><code>data [a]    -- a list of `a`s is...\n  = []      -- an empty list...\n  | a : [a] -- or an `a`, then a list of `a`s.\n</code></pre>\n\n<p>When we write <code>[1,2,3]</code>, this is just syntactic sugar for <code>1 : (2 : (3 : []))</code>, and since <code>:</code> is what we call <em>right-associative</em>, we can also just write <code>1:2:3:[]</code>.</p>\n\n<p>For this reason there are only two cases that are normally required when pattern matching on lists: <code>[]</code> and <code>(x:xs)</code>. <code>[]</code> is obviously the empty list, and <code>(x:xs)</code> is a non-empty list, where <code>x</code> is the first element and <code>xs</code> is the rest of the list.</p>\n\n<p>Let's examine that definition, ignoring the commented line. I've removed some unnecessary brackets, by the way:</p>\n\n<pre><code>concat :: [[a]] -&gt; [a]\nconcat []     = []                  -- The empty list case\nconcat (x:xs) = x ++ Main.concat xs -- The nonempty list case\n</code></pre>\n\n<p>We see that you've actually covered all the cases: this is now defined for all lists, so at least in theory the case <code>concat [[]] = []</code> is redundant. </p>\n\n<p>In practice this is also true, because <code>concat [[]] = [] ++ concat [] = []</code> anyway, which falls into the second line's case, since <code>[[]] = [] : []</code> which matches the <code>(x:xs)</code> pattern.</p>\n"}], "owner": {"reputation": 54004, "user_id": 61624, "user_type": "registered", "accept_rate": 60, "profile_image": "https://www.gravatar.com/avatar/1e011d13433f12be7dc754180cb38ca8?s=128&d=identicon&r=PG", "display_name": "Daniel Kaplan", "link": "https://stackoverflow.com/users/61624/daniel-kaplan"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 79, "favorite_count": 0, "accepted_answer_id": 50997171, "answer_count": 3, "score": 0, "last_activity_date": 1529757995, "creation_date": 1529714641, "question_id": 50997039, "link": "https://stackoverflow.com/questions/50997039/defining-my-own-concat", "title": "Defining my own concat", "body": "<p>I'm reading a book and it asked me to define my own <code>concat</code> function.  I defined it correctly here:</p>\n\n<pre><code>concat :: [[a]] -&gt; [a]\nconcat [] = []\n-- concat [[]] = []\nconcat (xs:xss) = xs ++ (Main.concat xss)\n</code></pre>\n\n<p>I have two questions about this.</p>\n\n<ol>\n<li>Why don't I need that line I commented out?</li>\n<li>When I call this with <code>Main.concat [[]]</code>, step by step, how is it evaluated?  The way I think about it, it goes into the 2nd definition, but I can't make sense of that.  If I'm right and it goes to the 2nd definition, what are the values of <code>xs</code> and <code>xss</code>?</li>\n</ol>\n"}, {"tags": ["haskell", "category-theory", "nix"], "comments": [{"owner": {"reputation": 384463, "user_id": 1126841, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/fa05233b2357f8d11c22ef4cfc7bb85c?s=128&d=identicon&r=PG", "display_name": "chepner", "link": "https://stackoverflow.com/users/1126841/chepner"}, "edited": false, "score": 1, "creation_date": 1529698403, "post_id": 50994791, "comment_id": 88984547, "body": "Yes, it&#39;s a curried function. <code>__functor</code> is just the function to actually call if the set is &quot;called&quot; (with the set itself implicitly passed as the first argument), so <code>inc 1</code> is the same as <code>inc.__functor inc 1</code>."}, {"owner": {"reputation": 7711, "user_id": 3096687, "user_type": "registered", "accept_rate": 67, "profile_image": "https://www.gravatar.com/avatar/31c95c0c159392d4c16fca6b55b5848d?s=128&d=identicon&r=PG", "display_name": "bbarker", "link": "https://stackoverflow.com/users/3096687/bbarker"}, "reply_to_user": {"reputation": 384463, "user_id": 1126841, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/fa05233b2357f8d11c22ef4cfc7bb85c?s=128&d=identicon&r=PG", "display_name": "chepner", "link": "https://stackoverflow.com/users/1126841/chepner"}, "edited": false, "score": 0, "creation_date": 1529701062, "post_id": 50994791, "comment_id": 88985487, "body": "Ah, right, I botched that a bit. I guess I haven&#39;t thought of Sets as being functors much so far, but rather as objects, in a category. Maybe there are some better examples, but I guess in the loose analogy of Functors being a form of container, a Set can feel like a container."}, {"owner": {"reputation": 7711, "user_id": 3096687, "user_type": "registered", "accept_rate": 67, "profile_image": "https://www.gravatar.com/avatar/31c95c0c159392d4c16fca6b55b5848d?s=128&d=identicon&r=PG", "display_name": "bbarker", "link": "https://stackoverflow.com/users/3096687/bbarker"}, "reply_to_user": {"reputation": 384463, "user_id": 1126841, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/fa05233b2357f8d11c22ef4cfc7bb85c?s=128&d=identicon&r=PG", "display_name": "chepner", "link": "https://stackoverflow.com/users/1126841/chepner"}, "edited": false, "score": 0, "creation_date": 1529710414, "post_id": 50994791, "comment_id": 88987716, "body": "Some interesting discussion on Sets as Functors in Haskell: <a href=\"https://www.reddit.com/r/haskell/comments/2090x3/ask_rhaskell_why_is_there_no_functor_instance_for/\" rel=\"nofollow noreferrer\">reddit.com/r/haskell/comments/2090x3/&hellip;</a>"}, {"owner": {"reputation": 384463, "user_id": 1126841, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/fa05233b2357f8d11c22ef4cfc7bb85c?s=128&d=identicon&r=PG", "display_name": "chepner", "link": "https://stackoverflow.com/users/1126841/chepner"}, "edited": false, "score": 2, "creation_date": 1529764140, "post_id": 50994791, "comment_id": 88997966, "body": "Nix sets are not Haskell sets. <code>__functor</code> here is being used in the C++ sense (a callable object), rather than a mapping between two categories."}], "answers": [{"tags": [], "owner": {"reputation": 3016, "user_id": 3190654, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/c321c5241605255cae9ecf3fb2dffc0b?s=128&d=identicon&r=PG", "display_name": "bergey", "link": "https://stackoverflow.com/users/3190654/bergey"}, "is_accepted": true, "score": 2, "last_activity_date": 1530036974, "creation_date": 1530036974, "answer_id": 51049194, "question_id": 50994791, "link": "https://stackoverflow.com/questions/50994791/how-to-undestand-functors-in-the-nix-expression-language/51049194#51049194", "title": "How to undestand functors in the Nix expression language?", "body": "<p><code>self</code> is not a keyword, just an ordinary parameter name.  You are correct that the right-hand side of <code>__functor</code> is a curried function of two arguments.  The Nix interpreter ensures that <code>__functor</code> is passed the appropriate value for <code>self</code>, at the call site <code>inc 1</code>; <code>__functor</code> is handled specially, even though it's not a keyword per se.</p>\n\n<p>Your example is nearly the same as:\n<code>\nlet add = a: b: a + b\n    inc = add 1\nin inc 1\n</code>\nIn a larger program it might be useful to be able to override <code>add.x</code> elsewhere.</p>\n\n<p>As noted in the comments, Nix uses \"functor\" in the sense of an object (here, set) that can be used syntactically like a function. </p>\n\n<p>Passing <code>self</code> this way is Nix's version of \"Objects are closures\".  The technique is used many places in Nixpkgs, with &amp; without the <code>__functor</code> feature, to get the usual benefits of Objects, including extension (~ structural subtyping) &amp; late binding.</p>\n"}], "owner": {"reputation": 7711, "user_id": 3096687, "user_type": "registered", "accept_rate": 67, "profile_image": "https://www.gravatar.com/avatar/31c95c0c159392d4c16fca6b55b5848d?s=128&d=identicon&r=PG", "display_name": "bbarker", "link": "https://stackoverflow.com/users/3096687/bbarker"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 254, "favorite_count": 1, "accepted_answer_id": 51049194, "answer_count": 1, "score": 1, "last_activity_date": 1530036974, "creation_date": 1529697332, "question_id": 50994791, "link": "https://stackoverflow.com/questions/50994791/how-to-undestand-functors-in-the-nix-expression-language", "title": "How to undestand functors in the Nix expression language?", "body": "<p>I'm having a bit of trouble parsing this. But as I write it out, I think I may have it.</p>\n\n<pre><code>let add = { __functor = self: x: x + self.x; };\n    inc = add // { x = 1; };\nin inc 1\n</code></pre>\n\n<p>First, is <code>self</code> a keyword like in many OO languages or is this just a regular name?</p>\n\n<p>Secondly, I'm trying to understand what the multiple <code>:</code> are doing in the definition of <code>__functor</code>, but this is probably a failing of my basic familiarity with Nix expressions, but I guess what is happening is that both <code>self</code> and <code>x</code> are arguments to <code>__functor</code>, i.e., it looks like it is probably a curried function.</p>\n\n<p>So really, <code>__functor</code> here is what <code>fmap</code> would be in Haskell, I think, and <code>self</code> (<code>add</code>) is the functor itself, and <code>x: x + self.x</code> is what the function mapped by <code>fmap</code> would be in Haskell.</p>\n"}, {"tags": ["json", "haskell", "haskell-stack", "aeson"], "comments": [{"owner": {"reputation": 4113, "user_id": 4601931, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/4785004388498e25bc6794fe1d9d4a38?s=128&d=identicon&r=PG&f=1", "display_name": "user4601931", "link": "https://stackoverflow.com/users/4601931/user4601931"}, "edited": false, "score": 5, "creation_date": 1529685140, "post_id": 50992133, "comment_id": 88979020, "body": "&quot;This question does not show any research effort.&quot;"}], "answers": [{"tags": [], "owner": {"reputation": 3075, "user_id": 1164871, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/4d6a54a3752ab47170d790085935988f?s=128&d=identicon&r=PG", "display_name": "mgsloan", "link": "https://stackoverflow.com/users/1164871/mgsloan"}, "is_accepted": false, "score": 0, "last_activity_date": 1529692468, "creation_date": 1529692468, "answer_id": 50993840, "question_id": 50992133, "link": "https://stackoverflow.com/questions/50992133/how-to-extract-list-from-json-file-with-aeson/50993840#50993840", "title": "How to extract list [] from Json file with AESON", "body": "<p>You probably want <code>list :: [ListWeatherInfo]</code>.  Currently it expects that <code>list</code> will be a record, but in the example data it is a json array.</p>\n"}], "owner": {"reputation": 31, "user_id": 8109702, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/d46bbf7a408772a1409342f01f864d00?s=128&d=identicon&r=PG&f=1", "display_name": "Ashot Bes", "link": "https://stackoverflow.com/users/8109702/ashot-bes"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 82, "favorite_count": 0, "answer_count": 1, "score": -4, "last_activity_date": 1529692468, "creation_date": 1529684899, "last_edit_date": 1529688804, "question_id": 50992133, "link": "https://stackoverflow.com/questions/50992133/how-to-extract-list-from-json-file-with-aeson", "title": "How to extract list [] from Json file with AESON", "body": "<p>I have this JSON code </p>\n\n<pre><code>{\n      \"cod\": \"200\",\n\"message\": 0.0205,\n\"cnt\": 40,\n\"list\": [{\n    \"dt\": 1529690400,\n    \"main\": {\n        \"temp\": 294.89,\n        \"temp_min\": 289.889,\n        \"temp_max\": 294.89,\n        \"pressure\": 875.6,\n        \"sea_level\": 1022.36,\n        \"grnd_level\": 875.6,\n        \"humidity\": 73,\n        \"temp_kf\": 5\n    },\n    \"weather\": [{\n        \"id\": 500,\n        \"main\": \"Rain\",\n        \"description\": \"light rain\",\n        \"icon\": \"10n\"\n    }],\n    \"clouds\": {\n        \"all\": 32\n    },\n    \"wind\": {\n        \"speed\": 0.76,\n        \"deg\": 355\n    },\n    \"rain\": {\n        \"3h\": 0.0625\n    },\n    \"sys\": {\n        \"pod\": \"n\"\n    },\n    \"dt_txt\": \"2018-06-22 18:00:00\"\n}, {\n    \"dt\": 1529701200,\n    \"main\": {\n        \"temp\": 291.2,\n        \"temp_min\": 287.449,\n        \"temp_max\": 291.2,\n        \"pressure\": 875.14,\n        \"sea_level\": 1022.14,\n        \"grnd_level\": 875.14,\n        \"humidity\": 82,\n        \"temp_kf\": 3.75\n    },\n    \"weather\": [{\n        \"id\": 800,\n        \"main\": \"Clear\",\n        \"description\": \"clear sky\",\n        \"icon\": \"02n\"\n    }],\n    \"clouds\": {\n        \"all\": 8\n    },\n    \"wind\": {\n        \"speed\": 0.76,\n        \"deg\": 7.00244\n    },\n    \"rain\": {},\n    \"sys\": {\n        \"pod\": \"n\"\n    },\n    \"dt_txt\": \"2018-06-22 21:00:00\"\n}, {\n    \"dt\": 1529712000,\n    \"main\": {\n        \"temp\": 288.19,\n        \"temp_min\": 285.69,\n        \"temp_max\": 288.19,\n        \"pressure\": 874.94,\n        \"sea_level\": 1022.29,\n        \"grnd_level\": 874.94,\n        \"humidity\": 88,\n        \"temp_kf\": 2.5\n    },\n    \"weather\": [{\n        \"id\": 800,\n        \"main\": \"Clear\",\n        \"description\": \"clear sky\",\n        \"icon\": \"01n\"\n    }],\n    \"clouds\": {\n        \"all\": 0\n    },\n    \"wind\": {\n        \"speed\": 0.26,\n        \"deg\": 237\n    },\n    \"rain\": {},\n    \"sys\": {\n        \"pod\": \"n\"\n    },\n    \"dt_txt\": \"2018-06-23 00:00:00\"\n}, {\n    \"dt\": 1529722800,\n    \"main\": {\n        \"temp\": 288.65,\n        \"temp_min\": 287.398,\n        \"temp_max\": 288.65,\n        \"pressure\": 875.18,\n        \"sea_level\": 1022.74,\n        \"grnd_level\": 875.18,\n        \"humidity\": 86,\n        \"temp_kf\": 1.25\n    },\n    \"weather\": [{\n        \"id\": 800,\n        \"main\": \"Clear\",\n        \"description\": \"clear sky\",\n        \"icon\": \"01d\"\n    }],\n    \"clouds\": {\n        \"all\": 0\n    },\n    \"wind\": {\n        \"speed\": 0.37,\n        \"deg\": 91.5048\n    },\n    \"rain\": {},\n    \"sys\": {\n        \"pod\": \"d\"\n    },\n    \"dt_txt\": \"2018-06-23 03:00:00\"\n}, {\n    \"dt\": 1529733600,\n    \"main\": {\n        \"temp\": 294.069,\n        \"temp_min\": 294.069,\n        \"temp_max\": 294.069,\n        \"pressure\": 874.97,\n        \"sea_level\": 1021.62,\n        \"grnd_level\": 874.97,\n        \"humidity\": 73,\n        \"temp_kf\": 0\n    },\n    \"weather\": [{\n        \"id\": 800,\n        \"main\": \"Clear\",\n        \"description\": \"clear sky\",\n        \"icon\": \"01d\"\n    }],\n    \"clouds\": {\n        \"all\": 0\n    },\n    \"wind\": {\n        \"speed\": 1.6,\n        \"deg\": 237.003\n    },\n    \"rain\": {},\n    \"sys\": {\n        \"pod\": \"d\"\n    },\n    \"dt_txt\": \"2018-06-23 06:00:00\"\n}, {\n    \"dt\": 1529744400,\n    \"main\": {\n        \"temp\": 297.09,\n        \"temp_min\": 297.09,\n        \"temp_max\": 297.09,\n        \"pressure\": 874.08,\n        \"sea_level\": 1020,\n        \"grnd_level\": 874.08,\n        \"humidity\": 70,\n        \"temp_kf\": 0\n    },\n    \"weather\": [{\n        \"id\": 500,\n        \"main\": \"Rain\",\n        \"description\": \"light rain\",\n        \"icon\": \"10d\"\n    }],\n    \"clouds\": {\n        \"all\": 0\n    },\n    \"wind\": {\n        \"speed\": 0.85,\n        \"deg\": 306.003\n    },\n    \"rain\": {\n        \"3h\": 0.255\n    },\n    \"sys\": {\n        \"pod\": \"d\"\n    },\n    \"dt_txt\": \"2018-06-23 09:00:00\"\n}, {\n    \"dt\": 1529755200,\n    \"main\": {\n        \"temp\": 298.961,\n        \"temp_min\": 298.961,\n        \"temp_max\": 298.961,\n        \"pressure\": 873.46,\n        \"sea_level\": 1019.23,\n        \"grnd_level\": 873.46,\n        \"humidity\": 53,\n        \"temp_kf\": 0\n    },\n    \"weather\": [{\n        \"id\": 500,\n        \"main\": \"Rain\",\n        \"description\": \"light rain\",\n        \"icon\": \"10d\"\n    }],\n    \"clouds\": {\n        \"all\": 48\n    },\n    \"wind\": {\n        \"speed\": 0.76,\n        \"deg\": 251.002\n    },\n    \"rain\": {\n        \"3h\": 0.04\n    },\n    \"sys\": {\n        \"pod\": \"d\"\n    },\n    \"dt_txt\": \"2018-06-23 12:00:00\"\n}, {\n    \"dt\": 1529766000,\n    \"main\": {\n        \"temp\": 294.815,\n        \"temp_min\": 294.815,\n        \"temp_max\": 294.815,\n        \"pressure\": 874.28,\n        \"sea_level\": 1020.19,\n        \"grnd_level\": 874.28,\n        \"humidity\": 58,\n        \"temp_kf\": 0\n    },\n    \"weather\": [{\n        \"id\": 500,\n        \"main\": \"Rain\",\n        \"description\": \"light rain\",\n        \"icon\": \"10d\"\n    }],\n    \"clouds\": {\n        \"all\": 76\n    },\n    \"wind\": {\n        \"speed\": 1.86,\n        \"deg\": 352.501\n    },\n    \"rain\": {\n        \"3h\": 0.185\n    },\n    \"sys\": {\n        \"pod\": \"d\"\n    },\n    \"dt_txt\": \"2018-06-23 15:00:00\"\n}, {\n    \"dt\": 1529776800,\n    \"main\": {\n        \"temp\": 290.337,\n        \"temp_min\": 290.337,\n        \"temp_max\": 290.337,\n        \"pressure\": 875.08,\n        \"sea_level\": 1021.69,\n        \"grnd_level\": 875.08,\n        \"humidity\": 73,\n        \"temp_kf\": 0\n    },\n    \"weather\": [{\n        \"id\": 500,\n        \"main\": \"Rain\",\n        \"description\": \"light rain\",\n        \"icon\": \"10n\"\n    }],\n    \"clouds\": {\n        \"all\": 36\n    },\n    \"wind\": {\n        \"speed\": 0.76,\n        \"deg\": 313.509\n    },\n    \"rain\": {\n        \"3h\": 0.02\n    },\n    \"sys\": {\n        \"pod\": \"n\"\n    },\n    \"dt_txt\": \"2018-06-23 18:00:00\"\n}, {\n    \"dt\": 1529787600,\n    \"main\": {\n        \"temp\": 288.89,\n        \"temp_min\": 288.89,\n        \"temp_max\": 288.89,\n        \"pressure\": 875.39,\n        \"sea_level\": 1022.49,\n        \"grnd_level\": 875.39,\n        \"humidity\": 81,\n        \"temp_kf\": 0\n    },\n    \"weather\": [{\n        \"id\": 500,\n        \"main\": \"Rain\",\n        \"description\": \"light rain\",\n        \"icon\": \"10n\"\n    }],\n    \"clouds\": {\n        \"all\": 56\n    },\n    \"wind\": {\n        \"speed\": 1.01,\n        \"deg\": 40.0106\n    },\n    \"rain\": {\n        \"3h\": 0.055\n    },\n    \"sys\": {\n        \"pod\": \"n\"\n    },\n    \"dt_txt\": \"2018-06-23 21:00:00\"\n}, {\n    \"dt\": 1529798400,\n    \"main\": {\n        \"temp\": 287.14,\n        \"temp_min\": 287.14,\n        \"temp_max\": 287.14,\n        \"pressure\": 875.88,\n        \"sea_level\": 1023.4,\n        \"grnd_level\": 875.88,\n        \"humidity\": 88,\n        \"temp_kf\": 0\n    },\n    \"weather\": [{\n        \"id\": 500,\n        \"main\": \"Rain\",\n        \"description\": \"light rain\",\n        \"icon\": \"10n\"\n    }],\n    \"clouds\": {\n        \"all\": 0\n    },\n    \"wind\": {\n        \"speed\": 0.56,\n        \"deg\": 269.504\n    },\n    \"rain\": {\n        \"3h\": 0.0050000000000001\n    },\n    \"sys\": {\n        \"pod\": \"n\"\n    },\n    \"dt_txt\": \"2018-06-24 00:00:00\"\n}, {\n    \"dt\": 1529809200,\n    \"main\": {\n        \"temp\": 287.812,\n        \"temp_min\": 287.812,\n        \"temp_max\": 287.812,\n        \"pressure\": 876.56,\n        \"sea_level\": 1024.3,\n        \"grnd_level\": 876.56,\n        \"humidity\": 86,\n        \"temp_kf\": 0\n    },\n    \"weather\": [{\n        \"id\": 800,\n        \"main\": \"Clear\",\n        \"description\": \"clear sky\",\n        \"icon\": \"01d\"\n    }],\n    \"clouds\": {\n        \"all\": 0\n    },\n    \"wind\": {\n        \"speed\": 0.71,\n        \"deg\": 277.505\n    },\n    \"rain\": {},\n    \"sys\": {\n        \"pod\": \"d\"\n    },\n    \"dt_txt\": \"2018-06-24 03:00:00\"\n}, {\n    \"dt\": 1529820000,\n    \"main\": {\n        \"temp\": 293.984,\n        \"temp_min\": 293.984,\n        \"temp_max\": 293.984,\n        \"pressure\": 876.57,\n        \"sea_level\": 1023.26,\n        \"grnd_level\": 876.57,\n        \"humidity\": 71,\n        \"temp_kf\": 0\n    },\n    \"weather\": [{\n        \"id\": 800,\n        \"main\": \"Clear\",\n        \"description\": \"clear sky\",\n        \"icon\": \"01d\"\n    }],\n    \"clouds\": {\n        \"all\": 0\n    },\n    \"wind\": {\n        \"speed\": 1.41,\n        \"deg\": 234.503\n    },\n    \"rain\": {},\n    \"sys\": {\n        \"pod\": \"d\"\n    },\n    \"dt_txt\": \"2018-06-24 06:00:00\"\n}, {\n    \"dt\": 1529830800,\n    \"main\": {\n        \"temp\": 298.045,\n        \"temp_min\": 298.045,\n        \"temp_max\": 298.045,\n        \"pressure\": 875.39,\n        \"sea_level\": 1021.2,\n        \"grnd_level\": 875.39,\n        \"humidity\": 63,\n        \"temp_kf\": 0\n    },\n    \"weather\": [{\n        \"id\": 800,\n        \"main\": \"Clear\",\n        \"description\": \"clear sky\",\n        \"icon\": \"01d\"\n    }],\n    \"clouds\": {\n        \"all\": 0\n    },\n    \"wind\": {\n        \"speed\": 1.62,\n        \"deg\": 244.502\n    },\n    \"rain\": {},\n    \"sys\": {\n        \"pod\": \"d\"\n    },\n    \"dt_txt\": \"2018-06-24 09:00:00\"\n}, {\n    \"dt\": 1529841600,\n    \"main\": {\n        \"temp\": 299.666,\n        \"temp_min\": 299.666,\n        \"temp_max\": 299.666,\n        \"pressure\": 874.25,\n        \"sea_level\": 1019.85,\n        \"grnd_level\": 874.25,\n        \"humidity\": 54,\n        \"temp_kf\": 0\n    },\n    \"weather\": [{\n        \"id\": 500,\n        \"main\": \"Rain\",\n        \"description\": \"light rain\",\n        \"icon\": \"10d\"\n    }],\n    \"clouds\": {\n        \"all\": 0\n    },\n    \"wind\": {\n        \"speed\": 0.77,\n        \"deg\": 13.5015\n    },\n    \"rain\": {\n        \"3h\": 0.11\n    },\n    \"sys\": {\n        \"pod\": \"d\"\n    },\n    \"dt_txt\": \"2018-06-24 12:00:00\"\n}, {\n    \"dt\": 1529852400,\n    \"main\": {\n        \"temp\": 295.301,\n        \"temp_min\": 295.301,\n        \"temp_max\": 295.301,\n        \"pressure\": 874.92,\n        \"sea_level\": 1021.12,\n        \"grnd_level\": 874.92,\n        \"humidity\": 60,\n        \"temp_kf\": 0\n    },\n    \"weather\": [{\n        \"id\": 500,\n        \"main\": \"Rain\",\n        \"description\": \"light rain\",\n        \"icon\": \"10d\"\n    }],\n    \"clouds\": {\n        \"all\": 80\n    },\n    \"wind\": {\n        \"speed\": 1.51,\n        \"deg\": 352.5\n    },\n    \"rain\": {\n        \"3h\": 0.41\n    },\n    \"sys\": {\n        \"pod\": \"d\"\n    },\n    \"dt_txt\": \"2018-06-24 15:00:00\"\n}, {\n    \"dt\": 1529863200,\n    \"main\": {\n        \"temp\": 291.351,\n        \"temp_min\": 291.351,\n        \"temp_max\": 291.351,\n        \"pressure\": 877.27,\n        \"sea_level\": 1024.08,\n        \"grnd_level\": 877.27,\n        \"humidity\": 69,\n        \"temp_kf\": 0\n    },\n    \"weather\": [{\n        \"id\": 500,\n        \"main\": \"Rain\",\n        \"description\": \"light rain\",\n        \"icon\": \"10n\"\n    }],\n    \"clouds\": {\n        \"all\": 88\n    },\n    \"wind\": {\n        \"speed\": 0.96,\n        \"deg\": 202.001\n    },\n    \"rain\": {\n        \"3h\": 0.16\n    },\n    \"sys\": {\n        \"pod\": \"n\"\n    },\n    \"dt_txt\": \"2018-06-24 18:00:00\"\n}, {\n    \"dt\": 1529874000,\n    \"main\": {\n        \"temp\": 289.244,\n        \"temp_min\": 289.244,\n        \"temp_max\": 289.244,\n        \"pressure\": 877.29,\n        \"sea_level\": 1024.89,\n        \"grnd_level\": 877.29,\n        \"humidity\": 83,\n        \"temp_kf\": 0\n    },\n    \"weather\": [{\n        \"id\": 500,\n        \"main\": \"Rain\",\n        \"description\": \"light rain\",\n        \"icon\": \"10n\"\n    }],\n    \"clouds\": {\n        \"all\": 12\n    },\n    \"wind\": {\n        \"speed\": 0.86,\n        \"deg\": 2.00073\n    },\n    \"rain\": {\n        \"3h\": 0.245\n    },\n    \"sys\": {\n        \"pod\": \"n\"\n    },\n    \"dt_txt\": \"2018-06-24 21:00:00\"\n}, {\n    \"dt\": 1529884800,\n    \"main\": {\n        \"temp\": 287.522,\n        \"temp_min\": 287.522,\n        \"temp_max\": 287.522,\n        \"pressure\": 877.08,\n        \"sea_level\": 1024.9,\n        \"grnd_level\": 877.08,\n        \"humidity\": 88,\n        \"temp_kf\": 0\n    },\n    \"weather\": [{\n        \"id\": 500,\n        \"main\": \"Rain\",\n        \"description\": \"light rain\",\n        \"icon\": \"10n\"\n    }],\n    \"clouds\": {\n        \"all\": 80\n    },\n    \"wind\": {\n        \"speed\": 0.75,\n        \"deg\": 318.504\n    },\n    \"rain\": {\n        \"3h\": 0.075\n    },\n    \"sys\": {\n        \"pod\": \"n\"\n    },\n    \"dt_txt\": \"2018-06-25 00:00:00\"\n}, {\n    \"dt\": 1529895600,\n    \"main\": {\n        \"temp\": 288.908,\n        \"temp_min\": 288.908,\n        \"temp_max\": 288.908,\n        \"pressure\": 877.54,\n        \"sea_level\": 1025.36,\n        \"grnd_level\": 877.54,\n        \"humidity\": 83,\n        \"temp_kf\": 0\n    },\n    \"weather\": [{\n        \"id\": 800,\n        \"main\": \"Clear\",\n        \"description\": \"clear sky\",\n        \"icon\": \"01d\"\n    }],\n    \"clouds\": {\n        \"all\": 0\n    },\n    \"wind\": {\n        \"speed\": 0.05,\n        \"deg\": 262.003\n    },\n    \"rain\": {},\n    \"sys\": {\n        \"pod\": \"d\"\n    },\n    \"dt_txt\": \"2018-06-25 03:00:00\"\n}, {\n    \"dt\": 1529906400,\n    \"main\": {\n        \"temp\": 294.535,\n        \"temp_min\": 294.535,\n        \"temp_max\": 294.535,\n        \"pressure\": 877.28,\n        \"sea_level\": 1024.11,\n        \"grnd_level\": 877.28,\n        \"humidity\": 69,\n        \"temp_kf\": 0\n    },\n    \"weather\": [{\n        \"id\": 800,\n        \"main\": \"Clear\",\n        \"description\": \"clear sky\",\n        \"icon\": \"01d\"\n    }],\n    \"clouds\": {\n        \"all\": 0\n    },\n    \"wind\": {\n        \"speed\": 1.13,\n        \"deg\": 219.503\n    },\n    \"rain\": {},\n    \"sys\": {\n        \"pod\": \"d\"\n    },\n    \"dt_txt\": \"2018-06-25 06:00:00\"\n}, {\n    \"dt\": 1529917200,\n    \"main\": {\n        \"temp\": 298.43,\n        \"temp_min\": 298.43,\n        \"temp_max\": 298.43,\n        \"pressure\": 876.1,\n        \"sea_level\": 1022.05,\n        \"grnd_level\": 876.1,\n        \"humidity\": 62,\n        \"temp_kf\": 0\n    },\n    \"weather\": [{\n        \"id\": 800,\n        \"main\": \"Clear\",\n        \"description\": \"clear sky\",\n        \"icon\": \"01d\"\n    }],\n    \"clouds\": {\n        \"all\": 0\n    },\n    \"wind\": {\n        \"speed\": 0.47,\n        \"deg\": 209.002\n    },\n    \"rain\": {},\n    \"sys\": {\n        \"pod\": \"d\"\n    },\n    \"dt_txt\": \"2018-06-25 09:00:00\"\n}, {\n    \"dt\": 1529928000,\n    \"main\": {\n        \"temp\": 300.707,\n        \"temp_min\": 300.707,\n        \"temp_max\": 300.707,\n        \"pressure\": 874.91,\n        \"sea_level\": 1020.42,\n        \"grnd_level\": 874.91,\n        \"humidity\": 53,\n        \"temp_kf\": 0\n    },\n    \"weather\": [{\n        \"id\": 500,\n        \"main\": \"Rain\",\n        \"description\": \"light rain\",\n        \"icon\": \"10d\"\n    }],\n    \"clouds\": {\n        \"all\": 8\n    },\n    \"wind\": {\n        \"speed\": 1.12,\n        \"deg\": 91.0061\n    },\n    \"rain\": {\n        \"3h\": 0.085\n    },\n    \"sys\": {\n        \"pod\": \"d\"\n    },\n    \"dt_txt\": \"2018-06-25 12:00:00\"\n}, {\n    \"dt\": 1529938800,\n    \"main\": {\n        \"temp\": 300.111,\n        \"temp_min\": 300.111,\n        \"temp_max\": 300.111,\n        \"pressure\": 874.29,\n        \"sea_level\": 1020.03,\n        \"grnd_level\": 874.29,\n        \"humidity\": 45,\n        \"temp_kf\": 0\n    },\n    \"weather\": [{\n        \"id\": 500,\n        \"main\": \"Rain\",\n        \"description\": \"light rain\",\n        \"icon\": \"10d\"\n    }],\n    \"clouds\": {\n        \"all\": 8\n    },\n    \"wind\": {\n        \"speed\": 1.41,\n        \"deg\": 63.0023\n    },\n    \"rain\": {\n        \"3h\": 0.0049999999999999\n    },\n    \"sys\": {\n        \"pod\": \"d\"\n    },\n    \"dt_txt\": \"2018-06-25 15:00:00\"\n}, {\n    \"dt\": 1529949600,\n    \"main\": {\n        \"temp\": 295.261,\n        \"temp_min\": 295.261,\n        \"temp_max\": 295.261,\n        \"pressure\": 874.79,\n        \"sea_level\": 1021.26,\n        \"grnd_level\": 874.79,\n        \"humidity\": 45,\n        \"temp_kf\": 0\n    },\n    \"weather\": [{\n        \"id\": 802,\n        \"main\": \"Clouds\",\n        \"description\": \"scattered clouds\",\n        \"icon\": \"03n\"\n    }],\n    \"clouds\": {\n        \"all\": 48\n    },\n    \"wind\": {\n        \"speed\": 3.2,\n        \"deg\": 35.0003\n    },\n    \"rain\": {},\n    \"sys\": {\n        \"pod\": \"n\"\n    },\n    \"dt_txt\": \"2018-06-25 18:00:00\"\n}, {\n    \"dt\": 1529960400,\n    \"main\": {\n        \"temp\": 291.742,\n        \"temp_min\": 291.742,\n        \"temp_max\": 291.742,\n        \"pressure\": 874.55,\n        \"sea_level\": 1021.47,\n        \"grnd_level\": 874.55,\n        \"humidity\": 52,\n        \"temp_kf\": 0\n    },\n    \"weather\": [{\n        \"id\": 800,\n        \"main\": \"Clear\",\n        \"description\": \"clear sky\",\n        \"icon\": \"01n\"\n    }],\n    \"clouds\": {\n        \"all\": 0\n    },\n    \"wind\": {\n        \"speed\": 1.66,\n        \"deg\": 32.0015\n    },\n    \"rain\": {},\n    \"sys\": {\n        \"pod\": \"n\"\n    },\n    \"dt_txt\": \"2018-06-25 21:00:00\"\n}, {\n    \"dt\": 1529971200,\n    \"main\": {\n        \"temp\": 289.406,\n        \"temp_min\": 289.406,\n        \"temp_max\": 289.406,\n        \"pressure\": 874.74,\n        \"sea_level\": 1021.87,\n        \"grnd_level\": 874.74,\n        \"humidity\": 60,\n        \"temp_kf\": 0\n    },\n    \"weather\": [{\n        \"id\": 802,\n        \"main\": \"Clouds\",\n        \"description\": \"scattered clouds\",\n        \"icon\": \"03n\"\n    }],\n    \"clouds\": {\n        \"all\": 36\n    },\n    \"wind\": {\n        \"speed\": 1.36,\n        \"deg\": 11.5036\n    },\n    \"rain\": {},\n    \"sys\": {\n        \"pod\": \"n\"\n    },\n    \"dt_txt\": \"2018-06-26 00:00:00\"\n}, {\n    \"dt\": 1529982000,\n    \"main\": {\n        \"temp\": 290.344,\n        \"temp_min\": 290.344,\n        \"temp_max\": 290.344,\n        \"pressure\": 875.24,\n        \"sea_level\": 1022.61,\n        \"grnd_level\": 875.24,\n        \"humidity\": 68,\n        \"temp_kf\": 0\n    },\n    \"weather\": [{\n        \"id\": 800,\n        \"main\": \"Clear\",\n        \"description\": \"clear sky\",\n        \"icon\": \"01d\"\n    }],\n    \"clouds\": {\n        \"all\": 0\n    },\n    \"wind\": {\n        \"speed\": 1.07,\n        \"deg\": 25.501\n    },\n    \"rain\": {},\n    \"sys\": {\n        \"pod\": \"d\"\n    },\n    \"dt_txt\": \"2018-06-26 03:00:00\"\n}, {\n    \"dt\": 1529992800,\n    \"main\": {\n        \"temp\": 296.669,\n        \"temp_min\": 296.669,\n        \"temp_max\": 296.669,\n        \"pressure\": 875.14,\n        \"sea_level\": 1021.37,\n        \"grnd_level\": 875.14,\n        \"humidity\": 58,\n        \"temp_kf\": 0\n    },\n    \"weather\": [{\n        \"id\": 800,\n        \"main\": \"Clear\",\n        \"description\": \"clear sky\",\n        \"icon\": \"01d\"\n    }],\n    \"clouds\": {\n        \"all\": 0\n    },\n    \"wind\": {\n        \"speed\": 1.11,\n        \"deg\": 225.5\n    },\n    \"rain\": {},\n    \"sys\": {\n        \"pod\": \"d\"\n    },\n    \"dt_txt\": \"2018-06-26 06:00:00\"\n}, {\n    \"dt\": 1530003600,\n    \"main\": {\n        \"temp\": 300.4,\n        \"temp_min\": 300.4,\n        \"temp_max\": 300.4,\n        \"pressure\": 873.55,\n        \"sea_level\": 1019,\n        \"grnd_level\": 873.55,\n        \"humidity\": 52,\n        \"temp_kf\": 0\n    },\n    \"weather\": [{\n        \"id\": 800,\n        \"main\": \"Clear\",\n        \"description\": \"clear sky\",\n        \"icon\": \"01d\"\n    }],\n    \"clouds\": {\n        \"all\": 0\n    },\n    \"wind\": {\n        \"speed\": 1.12,\n        \"deg\": 237.501\n    },\n    \"rain\": {},\n    \"sys\": {\n        \"pod\": \"d\"\n    },\n    \"dt_txt\": \"2018-06-26 09:00:00\"\n}, {\n    \"dt\": 1530014400,\n    \"main\": {\n        \"temp\": 302.474,\n        \"temp_min\": 302.474,\n        \"temp_max\": 302.474,\n        \"pressure\": 872.27,\n        \"sea_level\": 1017.3,\n        \"grnd_level\": 872.27,\n        \"humidity\": 42,\n        \"temp_kf\": 0\n    },\n    \"weather\": [{\n        \"id\": 800,\n        \"main\": \"Clear\",\n        \"description\": \"clear sky\",\n        \"icon\": \"01d\"\n    }],\n    \"clouds\": {\n        \"all\": 0\n    },\n    \"wind\": {\n        \"speed\": 1.52,\n        \"deg\": 234\n    },\n    \"rain\": {},\n    \"sys\": {\n        \"pod\": \"d\"\n    },\n    \"dt_txt\": \"2018-06-26 12:00:00\"\n}, {\n    \"dt\": 1530025200,\n    \"main\": {\n        \"temp\": 300.919,\n        \"temp_min\": 300.919,\n        \"temp_max\": 300.919,\n        \"pressure\": 872.19,\n        \"sea_level\": 1017.17,\n        \"grnd_level\": 872.19,\n        \"humidity\": 37,\n        \"temp_kf\": 0\n    },\n    \"weather\": [{\n        \"id\": 800,\n        \"main\": \"Clear\",\n        \"description\": \"clear sky\",\n        \"icon\": \"02d\"\n    }],\n    \"clouds\": {\n        \"all\": 8\n    },\n    \"wind\": {\n        \"speed\": 1.65,\n        \"deg\": 266.501\n    },\n    \"rain\": {},\n    \"sys\": {\n        \"pod\": \"d\"\n    },\n    \"dt_txt\": \"2018-06-26 15:00:00\"\n}, {\n    \"dt\": 1530036000,\n    \"main\": {\n        \"temp\": 294.477,\n        \"temp_min\": 294.477,\n        \"temp_max\": 294.477,\n        \"pressure\": 872.56,\n        \"sea_level\": 1018.52,\n        \"grnd_level\": 872.56,\n        \"humidity\": 55,\n        \"temp_kf\": 0\n    },\n    \"weather\": [{\n        \"id\": 800,\n        \"main\": \"Clear\",\n        \"description\": \"clear sky\",\n        \"icon\": \"01n\"\n    }],\n    \"clouds\": {\n        \"all\": 0\n    },\n    \"wind\": {\n        \"speed\": 0.92,\n        \"deg\": 342.504\n    },\n    \"rain\": {},\n    \"sys\": {\n        \"pod\": \"n\"\n    },\n    \"dt_txt\": \"2018-06-26 18:00:00\"\n}, {\n    \"dt\": 1530046800,\n    \"main\": {\n        \"temp\": 290.615,\n        \"temp_min\": 290.615,\n        \"temp_max\": 290.615,\n        \"pressure\": 873.13,\n        \"sea_level\": 1019.46,\n        \"grnd_level\": 873.13,\n        \"humidity\": 51,\n        \"temp_kf\": 0\n    },\n    \"weather\": [{\n        \"id\": 800,\n        \"main\": \"Clear\",\n        \"description\": \"clear sky\",\n        \"icon\": \"01n\"\n    }],\n    \"clouds\": {\n        \"all\": 0\n    },\n    \"wind\": {\n        \"speed\": 1.81,\n        \"deg\": 20.505\n    },\n    \"rain\": {},\n    \"sys\": {\n        \"pod\": \"n\"\n    },\n    \"dt_txt\": \"2018-06-26 21:00:00\"\n}, {\n    \"dt\": 1530057600,\n    \"main\": {\n        \"temp\": 288.302,\n        \"temp_min\": 288.302,\n        \"temp_max\": 288.302,\n        \"pressure\": 873.42,\n        \"sea_level\": 1020.19,\n        \"grnd_level\": 873.42,\n        \"humidity\": 68,\n        \"temp_kf\": 0\n    },\n    \"weather\": [{\n        \"id\": 800,\n        \"main\": \"Clear\",\n        \"description\": \"clear sky\",\n        \"icon\": \"01n\"\n    }],\n    \"clouds\": {\n        \"all\": 0\n    },\n    \"wind\": {\n        \"speed\": 1.42,\n        \"deg\": 10.0019\n    },\n    \"rain\": {},\n    \"sys\": {\n        \"pod\": \"n\"\n    },\n    \"dt_txt\": \"2018-06-27 00:00:00\"\n}, {\n    \"dt\": 1530068400,\n    \"main\": {\n        \"temp\": 290.209,\n        \"temp_min\": 290.209,\n        \"temp_max\": 290.209,\n        \"pressure\": 873.93,\n        \"sea_level\": 1020.72,\n        \"grnd_level\": 873.93,\n        \"humidity\": 65,\n        \"temp_kf\": 0\n    },\n    \"weather\": [{\n        \"id\": 800,\n        \"main\": \"Clear\",\n        \"description\": \"clear sky\",\n        \"icon\": \"01d\"\n    }],\n    \"clouds\": {\n        \"all\": 0\n    },\n    \"wind\": {\n        \"speed\": 1.66,\n        \"deg\": 36\n    },\n    \"rain\": {},\n    \"sys\": {\n        \"pod\": \"d\"\n    },\n    \"dt_txt\": \"2018-06-27 03:00:00\"\n}, {\n    \"dt\": 1530079200,\n    \"main\": {\n        \"temp\": 297.644,\n        \"temp_min\": 297.644,\n        \"temp_max\": 297.644,\n        \"pressure\": 873.95,\n        \"sea_level\": 1019.72,\n        \"grnd_level\": 873.95,\n        \"humidity\": 52,\n        \"temp_kf\": 0\n    },\n    \"weather\": [{\n        \"id\": 800,\n        \"main\": \"Clear\",\n        \"description\": \"clear sky\",\n        \"icon\": \"01d\"\n    }],\n    \"clouds\": {\n        \"all\": 0\n    },\n    \"wind\": {\n        \"speed\": 1.61,\n        \"deg\": 230\n    },\n    \"rain\": {},\n    \"sys\": {\n        \"pod\": \"d\"\n    },\n    \"dt_txt\": \"2018-06-27 06:00:00\"\n}, {\n    \"dt\": 1530090000,\n    \"main\": {\n        \"temp\": 301.518,\n        \"temp_min\": 301.518,\n        \"temp_max\": 301.518,\n        \"pressure\": 873.16,\n        \"sea_level\": 1018.11,\n        \"grnd_level\": 873.16,\n        \"humidity\": 45,\n        \"temp_kf\": 0\n    },\n    \"weather\": [{\n        \"id\": 800,\n        \"main\": \"Clear\",\n        \"description\": \"clear sky\",\n        \"icon\": \"01d\"\n    }],\n    \"clouds\": {\n        \"all\": 0\n    },\n    \"wind\": {\n        \"speed\": 0.51,\n        \"deg\": 309.5\n    },\n    \"rain\": {},\n    \"sys\": {\n        \"pod\": \"d\"\n    },\n    \"dt_txt\": \"2018-06-27 09:00:00\"\n}, {\n    \"dt\": 1530100800,\n    \"main\": {\n        \"temp\": 303.24,\n        \"temp_min\": 303.24,\n        \"temp_max\": 303.24,\n        \"pressure\": 872.25,\n        \"sea_level\": 1016.8,\n        \"grnd_level\": 872.25,\n        \"humidity\": 32,\n        \"temp_kf\": 0\n    },\n    \"weather\": [{\n        \"id\": 800,\n        \"main\": \"Clear\",\n        \"description\": \"clear sky\",\n        \"icon\": \"01d\"\n    }],\n    \"clouds\": {\n        \"all\": 0\n    },\n    \"wind\": {\n        \"speed\": 1.32,\n        \"deg\": 304.5\n    },\n    \"rain\": {},\n    \"sys\": {\n        \"pod\": \"d\"\n    },\n    \"dt_txt\": \"2018-06-27 12:00:00\"\n}, {\n    \"dt\": 1530111600,\n    \"main\": {\n        \"temp\": 302.008,\n        \"temp_min\": 302.008,\n        \"temp_max\": 302.008,\n        \"pressure\": 871.75,\n        \"sea_level\": 1016.41,\n        \"grnd_level\": 871.75,\n        \"humidity\": 33,\n        \"temp_kf\": 0\n    },\n    \"weather\": [{\n        \"id\": 800,\n        \"main\": \"Clear\",\n        \"description\": \"clear sky\",\n        \"icon\": \"01d\"\n    }],\n    \"clouds\": {\n        \"all\": 0\n    },\n    \"wind\": {\n        \"speed\": 0.75,\n        \"deg\": 260.003\n    },\n    \"rain\": {},\n    \"sys\": {\n        \"pod\": \"d\"\n    },\n    \"dt_txt\": \"2018-06-27 15:00:00\"\n}],\n\"city\": {\n    \"id\": 616052,\n    \"name\": \"Yerevan\",\n    \"coord\": {\n        \"lat\": 40.1776,\n        \"lon\": 44.5126\n    },\n    \"country\": \"AM\",\n    \"population\": 1093485\n}\n\n}\n</code></pre>\n\n<p>How do I extract an item from this list?\nI need to use AESON.\nfor example, how do I extract this?<br>\n    {\"temp\":288.89,\"temp_min\":288.89,\"temp_max\":288.89,\"pressure\":875.39,\"sea_level\":1022.49,\"grnd_level\":875.39,\"humidity\":81,\"temp_kf\":0},\"weather\":[{\"id\":500,\"main\":\"Rain\",\"description\":\"light rain\",\"icon\":\"10n\"}],\"clouds\":{\"all\":56},\"wind\":{\"speed\":1.01,\"deg\":40.0106},\"rain\":{\"3h\":0.055},\"sys\":{\"pod\":\"n\"},\"dt_txt\":\"2018-06-23 21:00:00\"},{\"dt\":1529798400,\"main\":</p>\n\n<p>My code:</p>\n\n<pre><code>{-# LANGUAGE DeriveAnyClass    #-}\n{-# LANGUAGE DeriveGeneric     #-}\n{-# LANGUAGE OverloadedStrings #-}\n\nmodule PrepareAnswer where\n\nimport           Data.Aeson\nimport qualified Data.ByteString.Lazy as BSL\nimport           Data.Maybe           (fromMaybe)\nimport           Data.Text\nimport           Data.Time.Clock\nimport           GHC.Generics \nimport           Network.HTTP.Client\n\ndata MainWeatherInfo = MainWeatherInfo\n  { mainInfo :: MainInfo\n  , list     :: ListWeatherInfo\n  } deriving (Show, Generic)\n\ndata ListWeatherInfo = ListWeatherInfo\n{ temper     :: Double\n,  temp_min  :: Double\n, temp_max   :: Double\n, pressure1  :: Double\n, sea_level  :: Double\n, grnd_level :: Double\n, humidity   :: Int\n, temp_kf    :: Double\n, dt_txt     :: UTCTime\n} deriving (Show, Generic)\n\ninstance ToJSON MainWeatherInfo where\n  toJSON = genericToJSON defaultOptions { fieldLabelModifier = Prelude.take 4 }\n\ninstance FromJSON MainWeatherInfo where\n  parseJSON = genericParseJSON defaultOptions { fieldLabelModifier = Prelude.take 4 }\n\ninstance ToJSON   ListWeatherInfo\ninstance FromJSON ListWeatherInfo\n\ndata MainInfo = MainInfo\n  { temp     :: Double\n  , pressure :: Int\n  } deriving ( Show\n             , Generic\n             , ToJSON\n             , FromJSON\n             )\n\nprepareAnswer :: Response BSL.ByteString -&gt; Text\nprepareAnswer response = Data.Text.pack finalPhrase\n    where\n        finalPhrase   = prepareValues weatherValues\n        weatherValues = extractValues . responseBody $ response\n\nextractValues :: BSL.ByteString -&gt; MainWeatherInfo\nextractValues rawJSON =\n    let result  = decode rawJSON :: Maybe MainWeatherInfo\n    in fromMaybe (error \"Invalid JSON!\") result\n\nprepareValues :: MainWeatherInfo -&gt; String\nprepareValues (MainWeatherInfo dataWeNeed forecastList) =\n    \"The expected temperature is: \"\n    ++ show (temp dataWeNeed )\n    ++ \" degrees Celsius, atmospheric pressure is \"\n    ++ show (pressure dataWeNeed)\n    ++ \" mm/hg\"\n</code></pre>\n"}, {"tags": ["haskell", "monads", "typechecking"], "comments": [{"owner": {"reputation": 11366, "user_id": 3922954, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/76ba47d2fdd24ab56b0b273cce2075e5?s=128&d=identicon&r=PG&f=1", "display_name": "AJF", "link": "https://stackoverflow.com/users/3922954/ajf"}, "edited": false, "score": 0, "creation_date": 1529675853, "post_id": 50989541, "comment_id": 88973752, "body": "AFAIK, <code>fail</code> is deprecated since it is not suitable for use in all monads. Use <code>mzero</code> from <code>Control.Monad</code>&#39;s <code>MonadPlus</code> typeclass."}, {"owner": {"reputation": 2930, "user_id": 211280, "user_type": "registered", "accept_rate": 87, "profile_image": "https://www.gravatar.com/avatar/30d93884d1d9fefdc8f93d4ed9079d04?s=128&d=identicon&r=PG", "display_name": "manu", "link": "https://stackoverflow.com/users/211280/manu"}, "reply_to_user": {"reputation": 11366, "user_id": 3922954, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/76ba47d2fdd24ab56b0b273cce2075e5?s=128&d=identicon&r=PG&f=1", "display_name": "AJF", "link": "https://stackoverflow.com/users/3922954/ajf"}, "edited": false, "score": 0, "creation_date": 1529676198, "post_id": 50989541, "comment_id": 88973962, "body": "@AJFarmar indeed RWH recommend not using fail because, unless you know how it&#39;s implemented in all the monads your code touches, it can fail.  Yet, my question is more about type-checking: notice that <code>fail &quot;...&quot;</code> appears to type-check with both <code>Monad m =&gt; m a</code> and <code>Monad m =&gt; m a -&gt; m a</code>."}, {"owner": {"reputation": 2585, "user_id": 8491228, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/j5T09.jpg?s=128&g=1", "display_name": "Mor A.", "link": "https://stackoverflow.com/users/8491228/mor-a"}, "edited": false, "score": 4, "creation_date": 1529676438, "post_id": 50989541, "comment_id": 88974125, "body": "It&#39;s using the monad instance for <code>(-&gt;) r</code>, in this case with <code>r ~ m a</code>."}], "answers": [{"tags": [], "owner": {"reputation": 100892, "user_id": 745903, "user_type": "registered", "accept_rate": 74, "profile_image": "https://www.gravatar.com/avatar/50933f6638836741e620669b3940410e?s=128&d=identicon&r=PG", "display_name": "leftaroundabout", "link": "https://stackoverflow.com/users/745903/leftaroundabout"}, "is_accepted": true, "score": 7, "last_activity_date": 1529677171, "last_edit_date": 1529677171, "creation_date": 1529676495, "answer_id": 50989805, "question_id": 50989541, "link": "https://stackoverflow.com/questions/50989541/why-does-guarded-false-fail-skipped-type-checks/50989805#50989805", "title": "Why does `guarded False = fail &quot;skipped&quot;` type-checks?", "body": "<p>You're being tripped up by the controversial <em>function monad instance</em> (actually this is not that controversial in the Haskell community, but I personally think we might have been better off if it didn't exist) together with the uncontroversially broken <code>fail</code> method.</p>\n\n<p>Look at the types:</p>\n\n<pre><code>guarded False\n   = fail \"skipped\" :: m a -&gt; m a\n   \u2261 (fail :: String -&gt; (m a -&gt; m a)) \"skipped\"\n   \u2261 (fail :: String -&gt; F (m a)) \"skipped\"    -- with `type F x = m a -&gt; x`\n</code></pre>\n\n<p>I.e., you calling <code>fail</code> on the <code>(-&gt;) (m a)</code> monad, and that <a href=\"http://hackage.haskell.org/package/base-4.11.1.0/docs/src/GHC.Base.html#line-804\" rel=\"noreferrer\">does not define a custom <code>fail</code> implementation</a>, so it <a href=\"http://hackage.haskell.org/package/base-4.11.1.0/docs/src/GHC.Base.html#fail\" rel=\"noreferrer\">defaults to the error one</a></p>\n\n<pre><code>  fail        :: String -&gt; ((-&gt;) r) a\n  fail s      = errorWithoutStackTrace s\n</code></pre>\n\n<p>Note how this even typechecks if you remove the <code>Monad m</code> constraint from your function, because <em>the <code>fail</code> doesn't use that monad</em>.</p>\n\n<p>The correct generalisation of your function is</p>\n\n<pre><code>guarded :: Alternative f =&gt; Bool -&gt; f a -&gt; f a\nguarded True = id\nguarded False = const empty\n</code></pre>\n\n<p>This does <em>not</em> typecheck if I erronously forget the <code>const</code>, because functions are not an instance of <code>Alternative</code>.</p>\n"}], "owner": {"reputation": 2930, "user_id": 211280, "user_type": "registered", "accept_rate": 87, "profile_image": "https://www.gravatar.com/avatar/30d93884d1d9fefdc8f93d4ed9079d04?s=128&d=identicon&r=PG", "display_name": "manu", "link": "https://stackoverflow.com/users/211280/manu"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 79, "favorite_count": 1, "accepted_answer_id": 50989805, "answer_count": 1, "score": 3, "last_activity_date": 1529677171, "creation_date": 1529675600, "question_id": 50989541, "link": "https://stackoverflow.com/questions/50989541/why-does-guarded-false-fail-skipped-type-checks", "title": "Why does `guarded False = fail &quot;skipped&quot;` type-checks?", "body": "<p>I'm following the Real World Haskell book.  In the chapter about Monads, they give a simple example using the list monad to compute all pairs of numbers (x, y) that such that <code>x * y == n</code>.</p>\n\n<p>Their solution is:</p>\n\n<pre><code>multiplyTo :: Int -&gt; [(Int, Int)]\nmultiplyTo n = do\n  x &lt;- [1..n]\n  y &lt;- [x..n]\n  guarded (x * y == n) $\n    return (x, y)\n\nguarded :: Bool -&gt; [a] -&gt; [a]\nguarded True xs = xs\nguarded False _ = []\n</code></pre>\n\n<p>But I was wondering if I could restate <code>guarded</code> for any monad.  </p>\n\n<p>Since <code>fail</code> in the list monad is <code>fail _ = []</code>, I though I could do:</p>\n\n<pre><code>guarded :: (Monad m) =&gt; Bool -&gt; m a -&gt; m a\nguarded True = id\nguarded False = fail \"skipped\"\n</code></pre>\n\n<p>However, this actually fails in ghci:</p>\n\n<pre><code>*Main&gt; multiplyTo 24\n*** Exception: skipped\n</code></pre>\n\n<p>I had a hunch which I cannot fully explain.  These two version work:</p>\n\n<pre><code>guarded :: (Monad m) =&gt; Bool -&gt; m a -&gt; m a\nguarded True = id\nguarded False = \\s -&gt; fail \"skipped\"\n\nguarded :: (Monad m) =&gt; Bool -&gt; m a -&gt; m a\nguarded True xs = xs\nguarded False _ = fail \"skipped\"\n</code></pre>\n\n<p>The type of <code>fail \"skipped\"</code> is <code>Monad m =&gt; m a</code>, whereas the type of <code>guarded False</code> is <code>Monad m =&gt; m a -&gt; m a</code>.  Then how is it possible that my first definition of <code>guarded</code> type-checks?</p>\n"}, {"tags": ["haskell", "infix-notation", "infix-operator"], "answers": [{"comments": [{"owner": {"reputation": 11366, "user_id": 3922954, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/76ba47d2fdd24ab56b0b273cce2075e5?s=128&d=identicon&r=PG&f=1", "display_name": "AJF", "link": "https://stackoverflow.com/users/3922954/ajf"}, "edited": false, "score": 1, "creation_date": 1529674138, "post_id": 50988762, "comment_id": 88972591, "body": "<code>x `g` y = \\x y -&gt; g x y</code> is incorrect; it is actually <code>x `g` y = g x y</code>"}, {"owner": {"reputation": 579, "user_id": 2310837, "user_type": "registered", "accept_rate": 92, "profile_image": "https://www.gravatar.com/avatar/31dd98bf2d532f8d0addfcb5665c3134?s=128&d=identicon&r=PG", "display_name": "joelfischerr", "link": "https://stackoverflow.com/users/2310837/joelfischerr"}, "reply_to_user": {"reputation": 11366, "user_id": 3922954, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/76ba47d2fdd24ab56b0b273cce2075e5?s=128&d=identicon&r=PG&f=1", "display_name": "AJF", "link": "https://stackoverflow.com/users/3922954/ajf"}, "edited": false, "score": 0, "creation_date": 1529675148, "post_id": 50988762, "comment_id": 88973267, "body": "Is <code>\\x y -&gt; g x y</code> not equivalent to <code>g x y</code>?"}, {"owner": {"reputation": 705, "user_id": 2648019, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/wBjZ5.jpg?s=128&g=1", "display_name": "Daiwen", "link": "https://stackoverflow.com/users/2648019/daiwen"}, "edited": false, "score": 1, "creation_date": 1529675879, "post_id": 50988762, "comment_id": 88973772, "body": "@joelfischerr If <code>g</code> takes two arguments, I think the first one is a function the second is a value."}, {"owner": {"reputation": 11366, "user_id": 3922954, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/76ba47d2fdd24ab56b0b273cce2075e5?s=128&d=identicon&r=PG&f=1", "display_name": "AJF", "link": "https://stackoverflow.com/users/3922954/ajf"}, "edited": false, "score": 0, "creation_date": 1529675981, "post_id": 50988762, "comment_id": 88973824, "body": "@joelfischerr It is not equivalent. If <code>g :: A -&gt; B -&gt; C</code>, then <code>x `g` y :: C</code>, and <code>(\\x y -&gt; x `g` y) :: A -&gt; B -&gt; C</code>."}, {"owner": {"reputation": 10378, "user_id": 2476735, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/39e9447bbc32246fcd23b76b5e946618?s=128&d=identicon&r=PG&f=1", "display_name": "David Young", "link": "https://stackoverflow.com/users/2476735/david-young"}, "edited": false, "score": 0, "creation_date": 1529694596, "post_id": 50988762, "comment_id": 88983068, "body": "@joelfischerr No. <code>\\x y -&gt; g x y</code> is the same as (for example) <code>\\a b -&gt; g a b</code>, which is not equivalent to <code>g x y</code> for the same reason."}, {"owner": {"reputation": 57219, "user_id": 33796, "user_type": "registered", "accept_rate": 70, "profile_image": "https://www.gravatar.com/avatar/08727b23ba62e634b32988cdff082663?s=128&d=identicon&r=PG", "display_name": "luqui", "link": "https://stackoverflow.com/users/33796/luqui"}, "edited": false, "score": 2, "creation_date": 1529716818, "post_id": 50988762, "comment_id": 88988588, "body": "@joelfischerr, However, <code>\\x y -&gt; g x y</code> <i>is</i> equivalent to <code>g</code>   (if you ignore that nasty <code>seq</code> pedantry).  Maybe that is what you were thinking of."}, {"owner": {"reputation": 579, "user_id": 2310837, "user_type": "registered", "accept_rate": 92, "profile_image": "https://www.gravatar.com/avatar/31dd98bf2d532f8d0addfcb5665c3134?s=128&d=identicon&r=PG", "display_name": "joelfischerr", "link": "https://stackoverflow.com/users/2310837/joelfischerr"}, "reply_to_user": {"reputation": 57219, "user_id": 33796, "user_type": "registered", "accept_rate": 70, "profile_image": "https://www.gravatar.com/avatar/08727b23ba62e634b32988cdff082663?s=128&d=identicon&r=PG", "display_name": "luqui", "link": "https://stackoverflow.com/users/33796/luqui"}, "edited": false, "score": 0, "creation_date": 1529733206, "post_id": 50988762, "comment_id": 88990761, "body": "@luqui Yes that is what I was thinking of. Thanks!"}], "tags": [], "owner": {"reputation": 579, "user_id": 2310837, "user_type": "registered", "accept_rate": 92, "profile_image": "https://www.gravatar.com/avatar/31dd98bf2d532f8d0addfcb5665c3134?s=128&d=identicon&r=PG", "display_name": "joelfischerr", "link": "https://stackoverflow.com/users/2310837/joelfischerr"}, "is_accepted": false, "score": 1, "last_activity_date": 1529781674, "last_edit_date": 1529781674, "creation_date": 1529673217, "answer_id": 50988762, "question_id": 50988761, "link": "https://stackoverflow.com/questions/50988761/partially-apply-the-infix-operator-with-map/50988762#50988762", "title": "Partially apply the infix operator with map", "body": "<pre><code>x `g` y\n</code></pre>\n\n<p>is defined on <a href=\"https://www.haskell.org/onlinereport/exps.html#sections\" rel=\"nofollow noreferrer\">haskell.org</a> as</p>\n\n<pre><code>x `g` y = g x y\n</code></pre>\n\n<p>This results in the following for</p>\n\n<pre><code>-- 1\nmap (g 10) [1,2,3,4,5] ==\nmap (\\x -&gt; g 10 x) [1,2,3,4,5]\n\n-- 2\nmap (10 `g`) [1,2,3,4,5] ==\nmap (\\x -&gt; g 10 x) [1,2,3,4,5]\n\n-- 3\nmap (`g` 10) [1,2,3,4,5] ==\nmap (\\x -&gt; g x 10) [1,2,3,4,5]\n</code></pre>\n\n<p>I hope this made it a bit more clear.</p>\n"}], "owner": {"reputation": 579, "user_id": 2310837, "user_type": "registered", "accept_rate": 92, "profile_image": "https://www.gravatar.com/avatar/31dd98bf2d532f8d0addfcb5665c3134?s=128&d=identicon&r=PG", "display_name": "joelfischerr", "link": "https://stackoverflow.com/users/2310837/joelfischerr"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 101, "favorite_count": 0, "answer_count": 1, "score": 0, "last_activity_date": 1529781674, "creation_date": 1529673217, "question_id": 50988761, "link": "https://stackoverflow.com/questions/50988761/partially-apply-the-infix-operator-with-map", "title": "Partially apply the infix operator with map", "body": "<p>I have the following function g</p>\n\n<pre><code>g :: Int -&gt; Int -&gt; Int \ng x y = x + y * y\n</code></pre>\n\n<p>I use g in the following three ways but don't quite understand what they each do.</p>\n\n<pre><code>map (g 10)  [1,2,3,4,5] -- 1\n\nmap (10 \u2018g\u2018) [1,2,3,4,5] -- 2\n\nmap (\u2018g\u2018 10) [1,2,3,4,5] -- 3\n</code></pre>\n"}, {"tags": ["haskell", "haskell-lens"], "answers": [{"tags": [], "owner": {"reputation": 37219, "user_id": 1523776, "user_type": "moderator", "accept_rate": 87, "profile_image": "https://www.gravatar.com/avatar/b3e0b5c8e42a8c38009ef2d969f8dabb?s=128&d=identicon&r=PG", "display_name": "Benjamin Hodgson", "link": "https://stackoverflow.com/users/1523776/benjamin-hodgson"}, "is_accepted": true, "score": 4, "last_activity_date": 1529687367, "last_edit_date": 1529687367, "creation_date": 1529669394, "answer_id": 50987648, "question_id": 50987442, "link": "https://stackoverflow.com/questions/50987442/lens-what-happened-to-traverseinit/50987648#50987648", "title": "Lens - What happened to traverseInit?", "body": "<p><code>traverseInit</code> got replaced with the more general <a href=\"https://hackage.haskell.org/package/lens-4.16.1/docs/Control-Lens-Cons.html#v:_init\" rel=\"nofollow noreferrer\"><code>_init :: Snoc s s a a =&gt; Traversal' s s</code></a> from <a href=\"https://hackage.haskell.org/package/lens-4.16.1/docs/Control-Lens-Cons.html\" rel=\"nofollow noreferrer\"><code>Control.Lens.Cons</code></a>, so now it works with any sequence-like type which allows access to its right-hand end.</p>\n\n<pre><code>ghci&gt; [1,2,3] &amp; _init.traverse +~ 1\n[2,3,3]\n</code></pre>\n\n<p>Note that <code>_init</code> returns a <code>Traversal' s s</code>, not a <code>Traversal' s a</code>, allowing you to replace the whole sublist, possibly changing its length. In the example I had to <code>traverse</code> again to look at the elements. (<code>_init</code> happens to be an <em>affine</em> traversal, meaning it'll never return more than one sublist, but that is not expressible in <code>lens</code>'s vocabulary.)</p>\n\n<p><code>Control.Lens.Cons</code> includes an analogous traversal of a list's <a href=\"https://hackage.haskell.org/package/lens-4.16.1/docs/Control-Lens-Cons.html#v:_tail\" rel=\"nofollow noreferrer\"><code>_tail</code></a>, as well as traversals of a list's <a href=\"https://hackage.haskell.org/package/lens-4.16.1/docs/Control-Lens-Cons.html#v:_head\" rel=\"nofollow noreferrer\"><code>_head</code></a> and <a href=\"https://hackage.haskell.org/package/lens-4.16.1/docs/Control-Lens-Cons.html#v:_last\" rel=\"nofollow noreferrer\"><code>_last</code></a>.</p>\n"}], "owner": {"reputation": 1376, "user_id": 5200466, "user_type": "registered", "accept_rate": 81, "profile_image": "https://www.gravatar.com/avatar/abb1362cec6e1f0a2416a6d98a93cd6c?s=128&d=identicon&r=PG&f=1", "display_name": "matt", "link": "https://stackoverflow.com/users/5200466/matt"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 92, "favorite_count": 0, "accepted_answer_id": 50987648, "answer_count": 1, "score": 2, "last_activity_date": 1529687367, "creation_date": 1529668691, "last_edit_date": 1529687221, "question_id": 50987442, "link": "https://stackoverflow.com/questions/50987442/lens-what-happened-to-traverseinit", "title": "Lens - What happened to traverseInit?", "body": "<p>In early versions <a href=\"https://hackage.haskell.org/package/lens-3.3/docs/Data-List-Lens.html\" rel=\"nofollow noreferrer\"><code>Data.List.Lens</code></a> there was a function <code>traverseInit</code> that was used to manipulate parts of lists. It has been removed, and I assume there is an alternative to this now but I can't quite find it?</p>\n\n<p>how would I do something like</p>\n\n<pre><code>&gt;&gt;&gt; traverseInit +~ 1 $ [1,2,3]\n[2,3,3]\n</code></pre>\n"}, {"tags": ["haskell", "fold"], "comments": [{"owner": {"reputation": 94553, "user_id": 775806, "user_type": "registered", "accept_rate": 96, "profile_image": "https://i.stack.imgur.com/XNd2C.png?s=128&g=1", "display_name": "n. &#39;pronouns&#39; m.", "link": "https://stackoverflow.com/users/775806/n-pronouns-m"}, "edited": false, "score": 1, "creation_date": 1529662139, "post_id": 50984485, "comment_id": 88965974, "body": "Try <code>lengthFoldl [42]</code>."}, {"owner": {"reputation": 61419, "user_id": 849891, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/MbEO3.png?s=128&g=1", "display_name": "Will Ness", "link": "https://stackoverflow.com/users/849891/will-ness"}, "reply_to_user": {"reputation": 94553, "user_id": 775806, "user_type": "registered", "accept_rate": 96, "profile_image": "https://i.stack.imgur.com/XNd2C.png?s=128&g=1", "display_name": "n. &#39;pronouns&#39; m.", "link": "https://stackoverflow.com/users/775806/n-pronouns-m"}, "edited": false, "score": 1, "creation_date": 1529678909, "post_id": 50984485, "comment_id": 88975610, "body": "@n.m. you meant <code>lengthFoldl [41]</code>. 42 is supposed to be the <i>answer</i>. :) :)"}], "answers": [{"comments": [{"owner": {"reputation": 61419, "user_id": 849891, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/MbEO3.png?s=128&g=1", "display_name": "Will Ness", "link": "https://stackoverflow.com/users/849891/will-ness"}, "edited": false, "score": 1, "creation_date": 1529658995, "post_id": 50984486, "comment_id": 88964027, "body": "for me, it&#39;s easier to handle these things mentally by <i>always</i> using <code>\\acc a -&gt; ...</code> with <code>foldl</code>, and <code>\\a r -&gt; ...</code> with <code>foldr</code>. BTW you almost always want to use <code>foldl&#39;</code> (instead of <code>foldl</code>)."}, {"owner": {"reputation": 579, "user_id": 2310837, "user_type": "registered", "accept_rate": 92, "profile_image": "https://www.gravatar.com/avatar/31dd98bf2d532f8d0addfcb5665c3134?s=128&d=identicon&r=PG", "display_name": "joelfischerr", "link": "https://stackoverflow.com/users/2310837/joelfischerr"}, "reply_to_user": {"reputation": 61419, "user_id": 849891, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/MbEO3.png?s=128&g=1", "display_name": "Will Ness", "link": "https://stackoverflow.com/users/849891/will-ness"}, "edited": false, "score": 0, "creation_date": 1529659033, "post_id": 50984486, "comment_id": 88964046, "body": "Why should I use foldl ?"}, {"owner": {"reputation": 61419, "user_id": 849891, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/MbEO3.png?s=128&g=1", "display_name": "Will Ness", "link": "https://stackoverflow.com/users/849891/will-ness"}, "edited": false, "score": 3, "creation_date": 1529659152, "post_id": 50984486, "comment_id": 88964134, "body": "<code>foldl&#39;</code> (instead of <code>foldl</code>). it is stricter. your foldl won&#39;t actually compute the sums as it goes along the list, just store away the future additions. this leads to bloated memory and even stack overflows if the list was long enough, when those nested future additions must be retraced and actually calculated. I&#39;ll find the canonical link and add it here shortly. <a href=\"https://stackoverflow.com/a/13052612/849891\">here it is</a>."}], "tags": [], "owner": {"reputation": 579, "user_id": 2310837, "user_type": "registered", "accept_rate": 92, "profile_image": "https://www.gravatar.com/avatar/31dd98bf2d532f8d0addfcb5665c3134?s=128&d=identicon&r=PG", "display_name": "joelfischerr", "link": "https://stackoverflow.com/users/2310837/joelfischerr"}, "is_accepted": true, "score": 3, "last_activity_date": 1529661460, "last_edit_date": 1529661460, "creation_date": 1529658466, "answer_id": 50984486, "question_id": 50984485, "link": "https://stackoverflow.com/questions/50984485/length-with-foldl-and-foldr/50984486#50984486", "title": "Length with foldl and foldr", "body": "<p>Looking at the type definitions of foldl and foldr it becomes clear what the issue is.</p>\n\n<pre><code>:t foldr\nfoldr :: Foldable t =&gt; (a -&gt; b -&gt; b) -&gt; b -&gt; t a -&gt; b\n</code></pre>\n\n<p>and </p>\n\n<pre><code>:t foldl\nfoldl :: Foldable t =&gt; (b -&gt; a -&gt; b) -&gt; b -&gt; t a -&gt; b\n</code></pre>\n\n<p>One can see that the foldr takes the item of the list and the second argument into the function and foldl takes the second argument and the item of the list into the function.</p>\n\n<p>Changing <code>lengthFoldl</code> to this solves the problem</p>\n\n<pre><code>lengthFoldl :: [Int] -&gt; Int\nlengthFoldl xs = foldl (\\y _ -&gt; y+1) 0 xs\n</code></pre>\n\n<p>Edit: Using <code>foldl</code> instead of <code>foldl'</code> is a bad idea: <a href=\"https://wiki.haskell.org/Foldr_Foldl_Foldl\" rel=\"nofollow noreferrer\">https://wiki.haskell.org/Foldr_Foldl_Foldl</a>'</p>\n"}, {"comments": [{"owner": {"reputation": 579, "user_id": 2310837, "user_type": "registered", "accept_rate": 92, "profile_image": "https://www.gravatar.com/avatar/31dd98bf2d532f8d0addfcb5665c3134?s=128&d=identicon&r=PG", "display_name": "joelfischerr", "link": "https://stackoverflow.com/users/2310837/joelfischerr"}, "edited": false, "score": 0, "creation_date": 1529665081, "post_id": 50985907, "comment_id": 88967496, "body": "Thanks! That is a great way to think about it."}], "tags": [], "owner": {"reputation": 100185, "user_id": 3234959, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/93bb12ca0f93dfddb33880316f7e66c2?s=128&d=identicon&r=PG&f=1", "display_name": "chi", "link": "https://stackoverflow.com/users/3234959/chi"}, "is_accepted": false, "score": 5, "last_activity_date": 1529669339, "last_edit_date": 1529669339, "creation_date": 1529663159, "answer_id": 50985907, "question_id": 50984485, "link": "https://stackoverflow.com/questions/50984485/length-with-foldl-and-foldr/50985907#50985907", "title": "Length with foldl and foldr", "body": "<p>To complement joelfischerr's answer, I'd like to point out that a hint is given by the types of your functions.</p>\n\n<pre><code>lengthFoldl :: [Int] -&gt; Int\nlengthFold :: [a] -&gt; Int\n</code></pre>\n\n<p>Why are they different? I guess you might had to change the first one to take an <code>[Int]</code> since with <code>[a]</code> it did not compile. This is however a big warning sign!</p>\n\n<p>If it is indeed computing the length, why should <code>lengthFoldl</code> care about what is the type of the list elements? Why do we need the elements to be <code>Int</code>s? There is only one possible explanation for <code>Int</code> being needed: looking at the code </p>\n\n<pre><code>lengthFoldl xs = foldl (\\_ y -&gt; y+1) 0 xs\n</code></pre>\n\n<p>we can see that the only numeric variable here is <code>y</code>. If <code>y</code> is forced to be a number, and list elements are also forced to be numbers, it seems as if <code>y</code> is taken to be a list element!</p>\n\n<p>And indeed that is the case: <code>foldl</code> passes to the function the accumulator first, the list element second, unlike <code>foldr</code>.</p>\n\n<p>The general thumb rule is: when type and code do not agree, one should think carefully about which one is right. I'd say that most Haskellers would think that, in most cases, it is easier to get the type right than the code right. So, one should not just adapt the type to the code to force it to compile: a type error can instead witness a bug in the code.</p>\n"}], "owner": {"reputation": 579, "user_id": 2310837, "user_type": "registered", "accept_rate": 92, "profile_image": "https://www.gravatar.com/avatar/31dd98bf2d532f8d0addfcb5665c3134?s=128&d=identicon&r=PG", "display_name": "joelfischerr", "link": "https://stackoverflow.com/users/2310837/joelfischerr"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 1251, "favorite_count": 0, "accepted_answer_id": 50984486, "answer_count": 2, "score": 2, "last_activity_date": 1529669339, "creation_date": 1529658466, "question_id": 50984485, "link": "https://stackoverflow.com/questions/50984485/length-with-foldl-and-foldr", "title": "Length with foldl and foldr", "body": "<p>I have two functions computing the length of a list of integers</p>\n\n<pre><code>lengthFoldl :: [Int] -&gt; Int\nlengthFoldl xs = (foldl (\\_ y -&gt; y+1) 0 xs)\n</code></pre>\n\n<p>and</p>\n\n<pre><code>lengthFold :: [a] -&gt; Int\nlengthFold xs = foldr (\\_ y -&gt; y+1) 0 xs\n</code></pre>\n\n<p>they are the same except one uses foldr and one foldl.</p>\n\n<p>But when trying to compute the length of any list <code>[1 .. n]</code> I get a wrong result (one too big) from lengthFoldl.</p>\n"}, {"tags": ["haskell"], "comments": [{"owner": {"reputation": 5335, "user_id": 6920962, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/6e62cd73355fc90d37429f9443df38da?s=128&d=identicon&r=PG&f=1", "display_name": "user28434", "link": "https://stackoverflow.com/users/6920962/user28434"}, "edited": false, "score": 2, "creation_date": 1529658710, "post_id": 50984449, "comment_id": 88963878, "body": "Like <a href=\"https://hackage.haskell.org/package/unordered-containers-0.2.9.0/docs/Data-HashMap-Strict.html\" rel=\"nofollow noreferrer\">this</a>?"}, {"owner": {"reputation": 1377, "user_id": 8314628, "user_type": "registered", "accept_rate": 88, "profile_image": "https://www.gravatar.com/avatar/0eefa2c64f533d21e1d8f58e4252a1e9?s=128&d=identicon&r=PG&f=1", "display_name": "user8314628", "link": "https://stackoverflow.com/users/8314628/user8314628"}, "reply_to_user": {"reputation": 5335, "user_id": 6920962, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/6e62cd73355fc90d37429f9443df38da?s=128&d=identicon&r=PG&f=1", "display_name": "user28434", "link": "https://stackoverflow.com/users/6920962/user28434"}, "edited": false, "score": 1, "creation_date": 1529659334, "post_id": 50984449, "comment_id": 88964246, "body": "Yes. But there are lots of cases. I&#39;m not sure how to use it."}, {"owner": {"reputation": 23600, "user_id": 1695172, "user_type": "registered", "accept_rate": 91, "profile_image": "https://www.gravatar.com/avatar/6319d7eafca7852cf04c88598ca31e75?s=128&d=identicon&r=PG", "display_name": "Netwave", "link": "https://stackoverflow.com/users/1695172/netwave"}, "edited": false, "score": 4, "creation_date": 1529661735, "post_id": 50984449, "comment_id": 88965749, "body": "<code>: convert (head xs : tail xs)</code> same as simply <code>: convert xs</code>"}, {"owner": {"reputation": 100892, "user_id": 745903, "user_type": "registered", "accept_rate": 74, "profile_image": "https://www.gravatar.com/avatar/50933f6638836741e620669b3940410e?s=128&d=identicon&r=PG", "display_name": "leftaroundabout", "link": "https://stackoverflow.com/users/745903/leftaroundabout"}, "edited": false, "score": 3, "creation_date": 1529664353, "post_id": 50984449, "comment_id": 88967122, "body": "I don&#39;t understand your description of what the function is supposed to do. Why don&#39;t you post the result that you <i>expect</i>? And, side comment: why is this function called <code>convert</code>? That&#39;s a horrible name, conversion should always be something that essentially preserves the value, just representing it in another way."}, {"owner": {"reputation": 7268, "user_id": 2303202, "user_type": "registered", "accept_rate": 75, "profile_image": "https://i.stack.imgur.com/iT9aU.png?s=128&g=1", "display_name": "max630", "link": "https://stackoverflow.com/users/2303202/max630"}, "edited": false, "score": 1, "creation_date": 1529671354, "post_id": 50984449, "comment_id": 88970896, "body": "how do title of your question and the actual question relate? How you would like a dictionary would help you?"}], "answers": [{"tags": [], "owner": {"reputation": 521, "user_id": 7126380, "user_type": "registered", "accept_rate": 100, "profile_image": "https://graph.facebook.com/10207438513426512/picture?type=large", "display_name": "Johnny Liao", "link": "https://stackoverflow.com/users/7126380/johnny-liao"}, "is_accepted": true, "score": 3, "last_activity_date": 1529669361, "creation_date": 1529669361, "answer_id": 50987637, "question_id": 50984449, "link": "https://stackoverflow.com/questions/50984449/is-there-something-like-dictionary-in-haskell/50987637#50987637", "title": "Is there something like dictionary in Haskell?", "body": "<p>In your code:</p>\n\n<pre><code>convert :: [String] -&gt; [[String]]\nconvert [] = []\nconvert [x] = [[]]\nconvert (x:xs) = [u | u &lt;- xs, last x == head u] : convert (head xs : tail xs)\n</code></pre>\n\n<p>The list comprehension only leaves the other word <code>u</code>. <code>[x,u]</code> leaves a combination you want.</p>\n\n<p>And since a list comprehension leaves the possible combinations, it will be a list of two-element list. <code>[[x,u],...]</code></p>\n\n<pre><code>(:) :: a -&gt; [a] -&gt; [a]\n(++) :: [a] -&gt; [a] -&gt; [a]\n</code></pre>\n\n<p>So <code>(++)</code> is more suitable for this case.</p>\n\n<p>and <code>( head xs : tail xs )</code> is just <code>xs</code>. No need to tell your convert to separate them ahead. Pattern match <code>(x:xs)</code> will do the trick. While it matches the case <code>x:[]</code>, next time it will <code>convert []</code>, so you need only one case to stop.</p>\n\n<pre><code>convert :: [String] -&gt; [[String]]\nconvert [] = []\nconvert (x:xs) = [[x,u] | u &lt;- xs, last x == head u] ++ convert xs\n\nprompt&gt; convert([\"apple\",\"elephant\",\"eraser\", \"tower\",\"rank\"])\n[[\"apple\",\"elephant\"],[\"apple\",\"eraser\"],[\"elephant\",\"tower\"],[\"eraser\",\"rank\"],[\"tower\",\"rank\"]]\n</code></pre>\n"}], "owner": {"reputation": 1377, "user_id": 8314628, "user_type": "registered", "accept_rate": 88, "profile_image": "https://www.gravatar.com/avatar/0eefa2c64f533d21e1d8f58e4252a1e9?s=128&d=identicon&r=PG&f=1", "display_name": "user8314628", "link": "https://stackoverflow.com/users/8314628/user8314628"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 123, "favorite_count": 0, "accepted_answer_id": 50987637, "answer_count": 1, "score": 0, "last_activity_date": 1529669361, "creation_date": 1529658363, "question_id": 50984449, "link": "https://stackoverflow.com/questions/50984449/is-there-something-like-dictionary-in-haskell", "title": "Is there something like dictionary in Haskell?", "body": "<p>Input is a list of words. If a word's last letter is the same as the first letter of another word, then we connect them and output a list of lists, which contain all possible connections.</p>\n\n<p>I convert the input into adjacency lists. But this will lose some elements from the input. </p>\n\n<p>For example: </p>\n\n<p><code>convert([\"apple\",\"elephant\",\"eraser\", \"tower\",\"rank\"])</code> </p>\n\n<p>will give</p>\n\n<p><code>[[\"elephant\", \"eraser\"], [\"tower\"], [\"rank\"], [\"rank\"], []]</code></p>\n\n<p>\"apple\" connects to \"elephant\" and \"eraser\". But \"apple\" is lost in the result.\nHow can I fix my code to have elements in the result?</p>\n\n<pre><code>convert :: [String] -&gt; [[String]]\nconvert [] = []\nconvert [x] = [[]]\nconvert (x:xs) = [u | u &lt;- xs, last x == head u] : convert (head xs : tail xs)\n</code></pre>\n"}, {"tags": ["haskell", "graphviz", "haskell-diagrams"], "answers": [{"comments": [{"owner": {"reputation": 77, "user_id": 1280647, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/1d9c18afb26d5fef542bcfb74d89722d?s=128&d=identicon&r=PG", "display_name": "sarva", "link": "https://stackoverflow.com/users/1280647/sarva"}, "edited": false, "score": 0, "creation_date": 1529688200, "post_id": 50990105, "comment_id": 88980401, "body": "That worked! Thanks. I have pushed the change to the github repo."}], "tags": [], "owner": {"reputation": 24266, "user_id": 946226, "user_type": "registered", "accept_rate": 59, "profile_image": "https://www.gravatar.com/avatar/5823d09208b1e4b63bbfcd189492032c?s=128&d=identicon&r=PG", "display_name": "Joachim Breitner", "link": "https://stackoverflow.com/users/946226/joachim-breitner"}, "is_accepted": true, "score": 1, "last_activity_date": 1529677492, "creation_date": 1529677492, "answer_id": 50990105, "question_id": 50982628, "link": "https://stackoverflow.com/questions/50982628/haskell-diagrams-graphviz-gtk-display-alignment-and-scaling/50990105#50990105", "title": "Haskell Diagrams Graphviz Gtk Display alignment and scaling", "body": "<p>This is a guess, but I assume that the circle is centered on the origin <code>(0,0)</code>, and the diagram is put in the unit square (between <code>(0,0)</code> and <code>(1,1)</code>).</p>\n\n<p>I would guess that if you remove the line</p>\n\n<pre><code>GRC.translate (w/2) (h/2)\n</code></pre>\n\n<p>in <code>Main.hs</code> it will work.</p>\n"}], "owner": {"reputation": 77, "user_id": 1280647, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/1d9c18afb26d5fef542bcfb74d89722d?s=128&d=identicon&r=PG", "display_name": "sarva", "link": "https://stackoverflow.com/users/1280647/sarva"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 160, "favorite_count": 0, "accepted_answer_id": 50990105, "answer_count": 1, "score": 2, "last_activity_date": 1529688379, "creation_date": 1529651789, "last_edit_date": 1529688379, "question_id": 50982628, "link": "https://stackoverflow.com/questions/50982628/haskell-diagrams-graphviz-gtk-display-alignment-and-scaling", "title": "Haskell Diagrams Graphviz Gtk Display alignment and scaling", "body": "<p>I want to display a graph layed out by <code>graphviz</code> (via <code>Data.GraphViz</code>) in a Gtk window. The code I have does not automatically center the graph or size the diagram. I have setup a github repo with an example (see <code>src/Main.hs</code> at <a href=\"https://github.com/avras/diagrams-gtk-graphviz-example\" rel=\"nofollow noreferrer\">https://github.com/avras/diagrams-gtk-graphviz-example</a>. I get the following output.</p>\n\n<p><a href=\"https://i.stack.imgur.com/kWnUZ.png\" rel=\"nofollow noreferrer\"><img src=\"https://i.stack.imgur.com/kWnUZ.png\" alt=\"enter image description here\"></a></p>\n\n<p>If I try showing a circle of radius one, I get the following output (which is expected). The code for this example is at <code>src/Circle.hs</code> in the same github repository. <code>Main.hs</code> and <code>Circle.hs</code> differ only in the diagram which is rendered (afaict).</p>\n\n<p><a href=\"https://i.stack.imgur.com/5QoDZ.png\" rel=\"nofollow noreferrer\"><img src=\"https://i.stack.imgur.com/5QoDZ.png\" alt=\"enter image description here\"></a></p>\n\n<p><strong>How can I get the graph to be centered in the window with the right width automatically calculated?</strong> </p>\n\n<p>I had to play around with the argument to <code>mkWidth</code> to get this picture. Also without setting <code>lw 0.005</code> the result was the following. The line width seems to be very large.</p>\n\n<p><a href=\"https://i.stack.imgur.com/S6bh8.png\" rel=\"nofollow noreferrer\"><img src=\"https://i.stack.imgur.com/S6bh8.png\" alt=\"enter image description here\"></a></p>\n\n<p><strong>EDIT</strong> Here is the result after the fix suggested by Joachim Breitner.\n<a href=\"https://i.stack.imgur.com/s0zJJ.png\" rel=\"nofollow noreferrer\"><img src=\"https://i.stack.imgur.com/s0zJJ.png\" alt=\"enter image description here\"></a></p>\n"}, {"tags": ["haskell"], "comments": [{"owner": {"reputation": 45534, "user_id": 106104, "user_type": "registered", "accept_rate": 62, "profile_image": "https://www.gravatar.com/avatar/c88b9310b92a937108ec4336c2832f92?s=128&d=identicon&r=PG", "display_name": "user253751", "link": "https://stackoverflow.com/users/106104/user253751"}, "edited": false, "score": 4, "creation_date": 1529647344, "post_id": 50981501, "comment_id": 88958411, "body": "{-hi-} is a comment, if this is from a book or wiki page, it could be a broken formatting instruction - the person who wrote the page probably thought it was going to highlight the word &quot;Eq&quot;"}, {"owner": {"reputation": 208473, "user_id": 126014, "user_type": "registered", "accept_rate": 86, "profile_image": "https://www.gravatar.com/avatar/33526616d4a11f1630d4939b769cfbf9?s=128&d=identicon&r=PG", "display_name": "Mark Seemann", "link": "https://stackoverflow.com/users/126014/mark-seemann"}, "edited": false, "score": 4, "creation_date": 1529647974, "post_id": 50981501, "comment_id": 88958640, "body": "<code>case ... of</code> are <a href=\"https://wiki.haskell.org/Keywords#case.2C_of\" rel=\"nofollow noreferrer\">Haskell keywords</a>."}], "answers": [{"tags": [], "owner": {"reputation": 48938, "user_id": 246886, "user_type": "registered", "accept_rate": 94, "profile_image": "https://www.gravatar.com/avatar/dd1ebaade6623fc538fb8af3338e730d?s=128&d=identicon&r=PG", "display_name": "Jon Purdy", "link": "https://stackoverflow.com/users/246886/jon-purdy"}, "is_accepted": true, "score": 6, "last_activity_date": 1529650909, "creation_date": 1529650909, "answer_id": 50982387, "question_id": 50981501, "link": "https://stackoverflow.com/questions/50981501/understanding-haskell-random-coin-generating-code/50982387#50982387", "title": "understanding haskell random coin generating code", "body": "<p><code>Coin</code> is an algebraic data type with two constructors, <code>Heads</code> and <code>Tails</code>, representing an enumeration with two values. It\u2019s isomorphic to (has the same structure as) <code>Bool</code> but is a distinct type.</p>\n\n<p><code>deriving (Eq, Show, Enum, Bounded)</code> automatically generates implementations of the typeclasses:</p>\n\n<ul>\n<li><p><code>Eq</code>, the class of types that support testing for equality with <code>==</code></p></li>\n<li><p><code>Show</code>, for converting values to strings for debugging</p></li>\n<li><p><code>Enum</code>, for enumerating values with the predecessor and successor functions <code>pred</code> and <code>succ</code></p></li>\n<li><p><code>Bounded</code>, types that have a <code>minBound</code> (here <code>Heads</code>) and <code>maxBound</code> (<code>Tails</code>)</p></li>\n<li><p><code>{-</code>\u2026<code>-}</code> is just a comment, which is ignored by the compiler; it appears the author intended to use some kind of non-Haskell formatting notation that didn\u2019t work properly.</p></li>\n</ul>\n\n<p><code>instance Random Coin where</code> begins an implementation of the <code>Random</code> typeclass for the <code>Coin</code> type, enabling random generation of coins. It has implementations for two methods:</p>\n\n<ul>\n<li><p><code>randomR (a, b) g</code> describes how to generate a random value in the range <code>a</code> to <code>b</code> using the random generator <code>g</code>. The implementation calls <code>randomR</code> to generate a random <em>integer</em> in the range of the parameters <code>a</code> and <code>b</code> using the <code>Enum</code> class. If <code>a</code> is <code>Heads</code> then <code>fromEnum a</code> is <code>0</code>; if <code>b</code> is <code>Tails</code> then <code>fromEnum b</code> is <code>1</code>. The <code>case</code>\u2026<code>of</code> notation performs a <em>pattern match</em> on the result of this function, getting a pair of a random value <code>x</code> and an updated random generator <code>g'</code> (pronounced \u201cG prime\u201d). It then converts <code>x</code> from an integer back into a <code>Coin</code> using <code>toEnum</code>, and returns the coin value along with the updated generator.</p></li>\n<li><p><code>random</code> describes how to generate a random coin from just a generator, without taking the range as input. It generates a coin toss between <code>minBound</code> (<code>Heads</code>) and <code>maxBound</code> (<code>Tails</code>) using the given generator <code>g</code>.</p></li>\n</ul>\n\n<p><code>coins</code> is an <code>IO</code> action that creates a new standard random generator with <code>newStdGen</code>, then generates an infinite list (stream) of random coin tosses from that generator with <code>randoms g :: [Coin]</code>. It uses <code>take</code> to grab the first 10 elements of that list and outputs them with <code>print</code>.</p>\n\n<p><code>r</code> is similar to <code>coins</code>, but also runs the coin tosses through the <code>process</code> function, which returns a pair of the number of coins it was given (<code>length cs</code>) and the number of those that are <code>Heads</code> (<code>length (filter (== Heads) cs)</code>); and the <code>display</code> function which formats the result as a string percentage.</p>\n"}, {"tags": [], "owner": {"reputation": 14543, "user_id": 235908, "user_type": "registered", "accept_rate": 83, "profile_image": "https://i.stack.imgur.com/rTstt.jpg?s=128&g=1", "display_name": "Simon Shine", "link": "https://stackoverflow.com/users/235908/simon-shine"}, "is_accepted": false, "score": 2, "last_activity_date": 1529661326, "last_edit_date": 1529661326, "creation_date": 1529660212, "answer_id": 50985040, "question_id": 50981501, "link": "https://stackoverflow.com/questions/50981501/understanding-haskell-random-coin-generating-code/50985040#50985040", "title": "understanding haskell random coin generating code", "body": "<p>Here's a rewritten version with some unnecessary things removed:</p>\n\n<pre><code>module Coin where\n\nimport System.Random\n\ndata Coin = Tails | Heads deriving (Eq)\n</code></pre>\n\n<p>Here the <code>Coin</code> data type is defined. The derived <code>Eq</code> type class instance means that you can compare two coins for equality using <code>==</code>, useful for counting how many <code>Heads</code> you got. I've removed <code>Show</code> because it was never used in this snippet, although it's quite neat. I've removed <code>Enum</code> and <code>Bounded</code> for demonstrative purposes.</p>\n\n<pre><code>instance Enum Coin where\n  toEnum 0 = Tails\n  toEnum 1 = Heads\n  fromEnum Tails = 0\n  fromEnum Heads = 1\n</code></pre>\n\n<p>In your code, this was achieved by adding <code>Enum</code> to the list of derived type class instances: It means that from now on, you can take any coin and convert it to an <code>Int</code> (0 or 1), and you can take an <code>Int</code> (0 or 1) and convert it to a <code>Coin</code>. Automatic derivation is neater, but this spells out what exactly that <code>Enum</code> means.</p>\n\n<pre><code>instance Bounded Coin where\n  minBound = Tails\n  maxBound = Heads\n</code></pre>\n\n<p>In your code, this was achieved by adding <code>Bounded</code> to the list of derived type class instances: It means that the \"smallest\" <code>Coin</code> value is <code>Tails</code>, and the \"greatest\" <code>Coin</code> value is <code>Heads</code>. This might not make any sense except when generating random coins.</p>\n\n<pre><code>instance Random Coin where\n  randomR (coin1, coin2) gen =\n    case randomR (fromEnum coin1, fromEnum coin2) gen of\n      (x, gen') -&gt; (toEnum x, gen')\n  random gen = randomR (minBound, maxBound) gen\n</code></pre>\n\n<p>Here we say that we can generate random <code>Coin</code>s using the standard random value generator library. According to <a href=\"http://hackage.haskell.org/package/random-1.1/docs/System-Random.html\" rel=\"nofollow noreferrer\">the <code>Random</code> type class definition</a>, the <em>minimal complete definition</em> is <code>randomR</code> and <code>random</code>, meaning that you can use all the random functions in relation to generating random coins if you define only these two. (The remaining random functions are defined in terms of these two.)</p>\n\n<ul>\n<li><p><code>randomR</code> takes two things: A range <code>(coin1, coin2)</code> and a random generator <code>gen</code> and returns a tuple <code>(toEnum x, gen')</code> meaning: a random coin <code>toEnum x</code> and an updated random generator <code>gen'</code>. The random coin should be in the range of <code>coin1</code> and <code>coin2</code>, which sounds kind of weird because there are only two values. (If you didn't want the full range of <code>(Tails, Heads)</code>, you'd know exactly which coin you got.) But for integers, generating a random value in a range makes sense, and the random generator library is intended for data types with any number of constructors, not just two.</p>\n\n<p>The actual random generation is performed by relying on the existing random number generator for <code>Int</code>s by saying: Generating a random <code>Heads</code>/<code>Tails</code> is just like generating a random <code>Int</code> (0 or 1) and then mapping that back to coins. This is where the <code>Enum</code> type class comes handy.</p></li>\n<li><p><code>random</code> takes only one thing: A random generator <code>gen</code>. It then does the same as <code>randomR</code> except it supplies the full range of values. <code>minBound</code> and <code>maxBound</code> are fancy ways of saying <code>Tails</code> and <code>Heads</code> because <a href=\"http://hackage.haskell.org/package/base-4.11.1.0/docs/Prelude.html#t:Bounded\" rel=\"nofollow noreferrer\">the <code>Bounded</code> type class</a> instance provides names for the minimum and the maximum values. But we could just have written <code>Tails</code> and <code>Heads</code>.</p>\n\n<p>The advantage og using a derived <code>Bounded</code> class and write <code>minBound</code> and <code>maxBound</code> instead is that you can extend the data type with a third option without having to change the <code>Random</code> instance -- if you forgot (there would be no warning), your random generator would just never generate all three options.</p></li>\n</ul>\n\n<p>If you didn't want the <code>Enum</code> and <code>Bounded</code> type class instances, you could write <code>Random</code> in a much simpler, less maintainable way, in which the conversion between <code>Coin</code> and <code>Int</code> happens inside the definition for <code>randomR</code>, and the minimum and maximum bounds for the type are just hardcoded as <code>Tails</code> and <code>Heads</code> respectively:</p>\n\n<pre><code>instance Random Coin where\n  randomR (Tails, Heads) gen =\n    case randomR (0, 1) gen of\n      (0, gen') -&gt; (Tails, gen')\n      (1, gen') -&gt; (Heads, gen')\n  randomR (someCoin, _) gen = (someCoin, gen)\n  random gen = randomR (Tails, Heads) gen\n</code></pre>\n\n<p>Here we don't rely on <code>toEnum</code>, <code>fromEnum</code>, <code>minBound</code> or <code>maxBound</code>, and we abuse the wording in the <code>randomR</code> documentation: <em>It is unspecified what happens if lo>hi,</em> meaning if we're not generating a random coin in exactly the interval <code>(Tails, Heads)</code>, then we're either in the <em>lo=hi</em> cases of <code>(Heads, Heads)</code> or <code>(Tails, Tails)</code> in which case we don't need randomness, because there's only one value to draw from, or we're in the unspecified case of <em>lo>hi</em> in which case we also just return the first value in the interval. (In the code using <code>Enum</code> and <code>Bounded</code>, the responsibility of dealing with a nonsensical range was just passed on to the random <code>Int</code> number generator which does much the same thing.)</p>\n"}], "owner": {"reputation": 889, "user_id": 1163153, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/cda8bb97c45f51587474460f34d90b8a?s=128&d=identicon&r=PG", "display_name": "Curious", "link": "https://stackoverflow.com/users/1163153/curious"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 168, "favorite_count": 0, "accepted_answer_id": 50982387, "answer_count": 2, "score": 1, "last_activity_date": 1529661326, "creation_date": 1529646947, "last_edit_date": 1529647475, "question_id": 50981501, "link": "https://stackoverflow.com/questions/50981501/understanding-haskell-random-coin-generating-code", "title": "understanding haskell random coin generating code", "body": "<p>Please help me understand the below haskell code.</p>\n\n<pre><code>data Coin = Heads | Tails deriving ({-hi-}Eq, {-/hi-} Show,Enum,Bounded)\n\ninstance Random Coin where\n    randomR (a,b) g =\n        case randomR (fromEnum a, fromEnum b) g of\n          (x,g') -&gt; (toEnum x,g')\n    random g = randomR (minBound,maxBound) g\n\ncoins = do\n    g &lt;- newStdGen\n    print . take 10 $ (randoms g::[Coin])\n\ncount = 10000\n\nprocess :: [Coin] -&gt; (Int,Int)\nprocess cs = (length cs,length (filter (== Heads) cs))\n\ndisplay::(Int,Int) -&gt; String\ndisplay (coins,heads) = \"We got \" ++ (show $ 100.0 * fromIntegral heads / fromIntegral coins) ++ \"% heads. \"\n\nr = do\n    g &lt;- newStdGen\n    putStrLn . display .process . take count $ randoms g\n</code></pre>\n\n<ol>\n<li><p>I could'nt get what does <code>{-hi-}Eq, {-/hi-} Show</code>do mean.</p></li>\n<li><p>and the below, What's the significance of \"of\" and the next part.</p></li>\n</ol>\n\n<p>case randomR (fromEnum a, fromEnum b) g of\n          (x,g') -> (toEnum x,g')</p>\n"}, {"tags": ["haskell", "ghc", "functional-dependencies"], "comments": [{"owner": {"reputation": 66224, "user_id": 180286, "user_type": "registered", "accept_rate": 69, "profile_image": "https://i.stack.imgur.com/tAXU2.jpg?s=128&g=1", "display_name": "Fyodor Soikin", "link": "https://stackoverflow.com/users/180286/fyodor-soikin"}, "edited": false, "score": 1, "creation_date": 1529641055, "post_id": 50980399, "comment_id": 88956674, "body": "You know, this actually compiles and runs just fine for me. Which compiler are you using?"}, {"owner": {"reputation": 3085, "user_id": 4040600, "user_type": "registered", "accept_rate": 55, "profile_image": "https://i.stack.imgur.com/B4ER6.png?s=128&g=1", "display_name": "&#201;amonn Olive", "link": "https://stackoverflow.com/users/4040600/%c3%89amonn-olive"}, "reply_to_user": {"reputation": 66224, "user_id": 180286, "user_type": "registered", "accept_rate": 69, "profile_image": "https://i.stack.imgur.com/tAXU2.jpg?s=128&g=1", "display_name": "Fyodor Soikin", "link": "https://stackoverflow.com/users/180286/fyodor-soikin"}, "edited": false, "score": 1, "creation_date": 1529641176, "post_id": 50980399, "comment_id": 88956702, "body": "@FyodorSoikin As it says, I am using 8.4.2."}, {"owner": {"reputation": 100185, "user_id": 3234959, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/93bb12ca0f93dfddb33880316f7e66c2?s=128&d=identicon&r=PG&f=1", "display_name": "chi", "link": "https://stackoverflow.com/users/3234959/chi"}, "edited": false, "score": 2, "creation_date": 1529654197, "post_id": 50980399, "comment_id": 88961421, "body": "If it suggests turning on flexible contexts, you haven&#39;t turned those on. You could add the extension to those at the beginning of the file, for instance."}], "answers": [{"tags": [], "owner": {"reputation": 24028, "user_id": 383200, "user_type": "registered", "accept_rate": 60, "profile_image": "https://www.gravatar.com/avatar/a9dc722f936cb1059adaae4fe39c07f0?s=128&d=identicon&r=PG", "display_name": "Carl", "link": "https://stackoverflow.com/users/383200/carl"}, "is_accepted": false, "score": 4, "last_activity_date": 1577308123, "last_edit_date": 1577308123, "creation_date": 1529640925, "answer_id": 50980592, "question_id": 50980399, "link": "https://stackoverflow.com/questions/50980399/why-does-expanding-my-functional-dependency-eliminate-non-type-variable-argument/50980592#50980592", "title": "Why does expanding my functional dependency eliminate non-type variable arguments?", "body": "<p>You need to turn on <code>FlexibleContexts</code> in ghci.  ghci does not enable extensions interactively just because they were used in a file you have loaded.  It's a bit awkward sometimes, but I understand why.  You can load multiple files at once, which can each specify different extensions - and you probably don't want the union of all the extensions, as some extensions don't play well with others.</p>\n\n<p>You can either invoke ghci with <code>-XFlexibleContexts</code> at the command line, or use <code>:set -XFlexibleContexts</code> within ghci to enable it.</p>\n\n<p>As for why you're being asked to enable it in the first place?  Haskell has very restrictive rules on the forms of contexts.  The restrictive rules came from historical fears that it might add significant implementation complexity to relax them.  It turns out there's no harm in relaxing them, which is what that extension does.  It's reached the point that I don't even remember what it was supposed to protect against - if the compiler asks, I turn that extension on.</p>\n"}, {"tags": [], "owner": {"reputation": 48938, "user_id": 246886, "user_type": "registered", "accept_rate": 94, "profile_image": "https://www.gravatar.com/avatar/dd1ebaade6623fc538fb8af3338e730d?s=128&d=identicon&r=PG", "display_name": "Jon Purdy", "link": "https://stackoverflow.com/users/246886/jon-purdy"}, "is_accepted": false, "score": 6, "last_activity_date": 1529640976, "creation_date": 1529640976, "answer_id": 50980596, "question_id": 50980399, "link": "https://stackoverflow.com/questions/50980399/why-does-expanding-my-functional-dependency-eliminate-non-type-variable-argument/50980596#50980596", "title": "Why does expanding my functional dependency eliminate non-type variable arguments?", "body": "<p>With the fundep <code>a b -&gt; c</code>, you\u2019re saying that the function type (<code>a</code>) and the argument type (<code>b</code>) determine the result type (<code>c</code>). Changing this to <code>a -&gt; b c</code> means that the function type determines both the argument and result types, which is what you want: if <code>a</code> is replaced with <code>a' -&gt; b'</code>, <code>b</code> with <code>a'</code>, and <code>c</code> with <code>b'</code>, then indeed the function type is what contains the information you need to remove the ambiguity.</p>\n"}], "owner": {"reputation": 3085, "user_id": 4040600, "user_type": "registered", "accept_rate": 55, "profile_image": "https://i.stack.imgur.com/B4ER6.png?s=128&g=1", "display_name": "&#201;amonn Olive", "link": "https://stackoverflow.com/users/4040600/%c3%89amonn-olive"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 82, "favorite_count": 0, "answer_count": 2, "score": 3, "last_activity_date": 1577308123, "creation_date": 1529639409, "last_edit_date": 1532421643, "question_id": 50980399, "link": "https://stackoverflow.com/questions/50980399/why-does-expanding-my-functional-dependency-eliminate-non-type-variable-argument", "title": "Why does expanding my functional dependency eliminate non-type variable arguments?", "body": "\n\n<p>I've been doing some work building my own custom prelude and I wanted to build a <code>Callable</code> type class that would implement function application (<code>($)</code>) for types other than functions.  So I built a type class using multi-parameter type classes:</p>\n\n<pre class=\"lang-hs prettyprint-override\"><code>{-# Language MultiParamTypeClasses #-}\n\nimport Prelude ()\n\nclass Callable a b c where\n  ($) :: a -&gt; b -&gt; c\n</code></pre>\n\n<p>Now I went ahead and made functions an instance of the <code>Callable</code> type class which required me to enable flexible instances.</p>\n\n<pre class=\"lang-hs prettyprint-override\"><code>{-# Language MultiParamTypeClasses, FlexibleInstances #-}\n\nimport Prelude ()\n\nid :: a -&gt; a\nid x = x\n\nclass Callable a b c where\n  ($) :: a -&gt; b -&gt; c\n\ninstance Callable (a -&gt; b) a b where\n  ($) = id\n</code></pre>\n\n<p>This is nice and now I can use <code>($)</code> on functions.  So the next logical step for me was to implement function composition (<code>(.)</code>) as well.  After a bit of fiddling I realized that in order to do so I was going to need to make <code>Callable</code> functionally dependent so I turned on functional dependencies.</p>\n\n<pre class=\"lang-hs prettyprint-override\"><code>{-# Language MultiParamTypeClasses, FlexibleInstances, FunctionalDependencies #-}\n\nimport Prelude ()\n\nid :: a -&gt; a\nid x = x\n\nclass Callable a b c | a b -&gt; c where\n  ($) :: a -&gt; b -&gt; c\n\ninstance Callable (a -&gt; b) a b where\n  ($) = id\n\n(.) :: (Callable f1 intype intermediate, Callable f2 intermediate outtype) =&gt; f2 -&gt; f1 -&gt; intype -&gt; outtype\n(.) a b c = a $ (b $ c)\n</code></pre>\n\n<p>This does in fact compile fine. In fact if I can use my <code>(.)</code> to make functions.  However if I attempt to use my new functions (at least in any way I have attempted) it fails to typecheck with a rather cryptic error.</p>\n\n<pre class=\"lang-hs prettyprint-override\"><code> ~/p/dynamo &gt; ghci callable.hs\nGHCi, version 8.4.2: http://www.haskell.org/ghc/  :? for help\n[1 of 1] Compiling Main             ( callable.hs, interpreted )\nOk, one module loaded.\n*Main&gt; :t (id).(id)\n(id).(id)\n  :: (Callable (a1 -&gt; a1) c e, Callable (a2 -&gt; a2) e d) =&gt; c -&gt; d\n*Main&gt; ((id).(id)) $ ()\n\n&lt;interactive&gt;:2:1: error:\n    \u2022 Non type-variable argument\n        in the constraint: Callable (c1 -&gt; d) () c2\n      (Use FlexibleContexts to permit this)\n    \u2022 When checking the inferred type\n        it :: forall c1 d c2 a1 e a2.\n              (Callable (c1 -&gt; d) () c2, Callable (a1 -&gt; a1) c1 e,\n               Callable (a2 -&gt; a2) e d) =&gt;\n              c2\n*Main&gt;\n</code></pre>\n\n<p>I am not really able to understand what this error is trying to convey.  But it suggests I turn on flexible contexts so I thought I'd give it a whirl, if it fixes the issue that's great, and if it changes the error I might get at the problem.  However if I turn on flexible contexts, the error does not change, in fact it even still suggests that I turn on flexible contexts.</p>\n\n<p>At this point I thought I would do some reading. I read around a few questions about <code>Non type-variable argument</code>, but I didn't really feel like I was gaining any insight into my particular problem.  It is at this point that something in the back of my mind made me think to make <code>b</code> a functional dependency as well.  I have no idea why, but this does, in fact, fix my problem.  Here is what the working code looks like:</p>\n\n<pre class=\"lang-hs prettyprint-override\"><code>{-# Language MultiParamTypeClasses, FlexibleInstances, FunctionalDependencies #-}\n\nimport Prelude ()\n\nid :: a -&gt; a\nid x = x\n\nclass Callable a b c | a -&gt; b c where\n  ($) :: a -&gt; b -&gt; c\n\ninstance Callable (a -&gt; b) a b where\n  ($) = id\n\n(.) :: (Callable f1 intype intermediate, Callable f2 intermediate outtype) =&gt; f2 -&gt; f1 -&gt; intype -&gt; outtype\n(.) a b c = a $ (b $ c)\n</code></pre>\n\n<p>So my question of course is why the heck does this work?  What was I doing wrong and how did the change fix it?</p>\n"}, {"tags": ["haskell", "haskell-stack"], "comments": [{"owner": {"reputation": 7268, "user_id": 2303202, "user_type": "registered", "accept_rate": 75, "profile_image": "https://i.stack.imgur.com/iT9aU.png?s=128&g=1", "display_name": "max630", "link": "https://stackoverflow.com/users/2303202/max630"}, "edited": false, "score": 1, "creation_date": 1529637925, "post_id": 50979942, "comment_id": 88956034, "body": "as you are importing ClassyPrelude, you should checking its changes"}], "answers": [{"comments": [{"owner": {"reputation": 159, "user_id": 8360867, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/676a624d4c047520a1031c56c1fea344?s=128&d=identicon&r=PG&f=1", "display_name": "BD107", "link": "https://stackoverflow.com/users/8360867/bd107"}, "edited": false, "score": 1, "creation_date": 1529683149, "post_id": 50980212, "comment_id": 88978025, "body": "Thanks, yes, <i>and</i> <code>exceptions &gt;= 0.8.3</code> must be added to the <code>.cabal</code> file (this was not necessary for LTS &lt;= 10.10)."}], "tags": [], "owner": {"reputation": 30377, "user_id": 369198, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/71596bb1ca3ba3aa4400c3f407baec9f?s=128&d=identicon&r=PG", "display_name": "Michael Snoyman", "link": "https://stackoverflow.com/users/369198/michael-snoyman"}, "is_accepted": true, "score": 4, "last_activity_date": 1529637920, "creation_date": 1529637920, "answer_id": 50980212, "question_id": 50979942, "link": "https://stackoverflow.com/questions/50979942/monadthrow-not-in-scope-beginning-at-lts-11-0/50980212#50980212", "title": "`MonadThrow` Not in scope beginning at LTS 11.0", "body": "<p>It's no longer exported from ClassyPrelude, you'd need to import it from Control.Monad.Catch.</p>\n"}], "owner": {"reputation": 159, "user_id": 8360867, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/676a624d4c047520a1031c56c1fea344?s=128&d=identicon&r=PG&f=1", "display_name": "BD107", "link": "https://stackoverflow.com/users/8360867/bd107"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 116, "favorite_count": 0, "accepted_answer_id": 50980212, "answer_count": 1, "score": 1, "last_activity_date": 1529637920, "creation_date": 1529635487, "question_id": 50979942, "link": "https://stackoverflow.com/questions/50979942/monadthrow-not-in-scope-beginning-at-lts-11-0", "title": "`MonadThrow` Not in scope beginning at LTS 11.0", "body": "<p>I've found that using </p>\n\n<p><code>me$ stack install --resolver lts-11.0</code> on the snippet</p>\n\n<pre><code>{-# LANGUAGE NoImplicitPrelude #-}\n{-# LANGUAGE OverloadedStrings #-}\nmodule Main where\n\nimport ClassyPrelude\nimport Network.HTTP.Conduit (host)\n\nhostnameFromUrl :: MonadThrow m =&gt; Text -&gt; m Text\nhostnameFromUrl url = do\n    return $ decodeUtf8 $ host \"helloworld.com\"\n</code></pre>\n\n<p>fails with message</p>\n\n<pre><code>/Users/me/.../temp/Main.hs:8:20: error:\n    Not in scope: type constructor or class \u2018MonadThrow\u2019\n  |\n8 | hostnameFromUrl :: MonadThrow m =&gt; Text -&gt; m Text\n  |                    ^^^^^^^^^^\n</code></pre>\n\n<p>when any lts >= 11.0 is used. No error is raised for lts &lt;= 10.10.</p>\n\n<p>This seems strange, as the relevant package (<a href=\"https://www.stackage.org/lts-11.14/package/exceptions-0.8.3\" rel=\"nofollow noreferrer\"><code>exceptions-0.8.3</code></a>) <a href=\"https://www.stackage.org/diff/lts-10.10/lts-11.0\" rel=\"nofollow noreferrer\">does not change</a> between these two LTSs.</p>\n\n<p>I have <code>stack.yaml</code> file</p>\n\n<pre><code>resolver: lts-11.0\npackages:\n  - '.'\nflags: {}\nextra-package-dbs: []\n</code></pre>\n\n<p>and <code>temp.cabal</code> file</p>\n\n<pre><code>name:                temp\nversion:             0.0\nbuild-type:          Simple\n-- extra-source-files:\ncabal-version:       &gt;=1.10\n\nlibrary\n  hs-source-dirs:      .\n  exposed-modules:     Main\n  ghc-options:         -Wall\n  build-depends:       classy-prelude &gt;= 1.0.0.2\n                     , http-conduit &gt;= 2.1\n  default-language:    Haskell2010\n</code></pre>\n\n<p>Pardon the specific setup; I've tried to make this as easily replicable as possible.</p>\n\n<p>Any insight would be greatly appreciated! Thank you.</p>\n"}, {"tags": ["haskell"], "comments": [{"owner": {"reputation": 126897, "user_id": 791604, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/ce991df7a056248d5e4f6fc3659ba733?s=128&d=identicon&r=PG", "display_name": "Daniel Wagner", "link": "https://stackoverflow.com/users/791604/daniel-wagner"}, "edited": false, "score": 1, "creation_date": 1529632270, "post_id": 50979508, "comment_id": 88955002, "body": "Hint: <a href=\"https://hackage.haskell.org/package/base-4.11.1.0/docs/Data-List.html#v:tails\" rel=\"nofollow noreferrer\">tails</a>, <a href=\"https://hackage.haskell.org/package/base-4.11.1.0/docs/Prelude.html#v:map\" rel=\"nofollow noreferrer\">map</a>. You might also like to check what happens if you include an empty <code>String</code> in your list when calling <code>convert</code>."}, {"owner": {"reputation": 1377, "user_id": 8314628, "user_type": "registered", "accept_rate": 88, "profile_image": "https://www.gravatar.com/avatar/0eefa2c64f533d21e1d8f58e4252a1e9?s=128&d=identicon&r=PG&f=1", "display_name": "user8314628", "link": "https://stackoverflow.com/users/8314628/user8314628"}, "reply_to_user": {"reputation": 126897, "user_id": 791604, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/ce991df7a056248d5e4f6fc3659ba733?s=128&d=identicon&r=PG", "display_name": "Daniel Wagner", "link": "https://stackoverflow.com/users/791604/daniel-wagner"}, "edited": false, "score": 1, "creation_date": 1529632413, "post_id": 50979508, "comment_id": 88955034, "body": "The input must be a list of words. So I don&#39;t worry about empty string. Unless the input is an empty list."}, {"owner": {"reputation": 48938, "user_id": 246886, "user_type": "registered", "accept_rate": 94, "profile_image": "https://www.gravatar.com/avatar/dd1ebaade6623fc538fb8af3338e730d?s=128&d=identicon&r=PG", "display_name": "Jon Purdy", "link": "https://stackoverflow.com/users/246886/jon-purdy"}, "edited": false, "score": 2, "creation_date": 1529638095, "post_id": 50979508, "comment_id": 88956075, "body": "Could you provide a sample input &amp; expected output? E.g., should <code>convert [&quot;AB&quot;,&quot;Bx&quot;,&quot;By&quot;] == [[&quot;ABx&quot;,&quot;ABy&quot;],[],[]]</code>? (I.e., the value at each index of the output is the list of all words that matched that index in the input, even if there are 0.) It may be helpful to break the problem down into smaller steps\u2014first write a function <code>merge :: String -&gt; String -&gt; Maybe String</code> where <code>merge &quot;abc&quot; &quot;cde&quot; == Just &quot;abcde&quot;</code> and <code>merge &quot;abc&quot; &quot;xyz&quot; == Nothing</code>. Then you can apply <code>merge</code> to each pair of words &amp; collect the results, in various ways\u2014<code>map</code>, list comprehensions, <code>do</code> notation, or recursion."}, {"owner": {"reputation": 1377, "user_id": 8314628, "user_type": "registered", "accept_rate": 88, "profile_image": "https://www.gravatar.com/avatar/0eefa2c64f533d21e1d8f58e4252a1e9?s=128&d=identicon&r=PG&f=1", "display_name": "user8314628", "link": "https://stackoverflow.com/users/8314628/user8314628"}, "edited": false, "score": 1, "creation_date": 1529638739, "post_id": 50979508, "comment_id": 88956191, "body": "Sorry, I forget to give an example. <code>convert [&quot;apple&quot;,&quot;elephant&quot;,&quot;eraser&quot;, &quot;tower&quot;,&quot;rank&quot;]</code> will give <code>[[&quot;elephant&quot;, &quot;eraser&quot;], [&quot;tower&quot;], [&quot;rank&quot;], [&quot;rank&quot;], []]</code>. I know it&#39;s easier to break the function into little pieces. But I&#39;m learning Haskell. I want to do it in a single function for practicing the syntax."}, {"owner": {"reputation": 100185, "user_id": 3234959, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/93bb12ca0f93dfddb33880316f7e66c2?s=128&d=identicon&r=PG&f=1", "display_name": "chi", "link": "https://stackoverflow.com/users/3234959/chi"}, "edited": false, "score": 2, "creation_date": 1529653856, "post_id": 50979508, "comment_id": 88961269, "body": "In your last case, <code>(head xs : tail xs)</code> is a complex way of writing <code>xs</code>"}, {"owner": {"reputation": 1377, "user_id": 8314628, "user_type": "registered", "accept_rate": 88, "profile_image": "https://www.gravatar.com/avatar/0eefa2c64f533d21e1d8f58e4252a1e9?s=128&d=identicon&r=PG&f=1", "display_name": "user8314628", "link": "https://stackoverflow.com/users/8314628/user8314628"}, "edited": false, "score": 0, "creation_date": 1529655752, "post_id": 50979508, "comment_id": 88962220, "body": "I know. I want to break it as the form convert(x:xs). I don&#39;t know if it does matter to concatenate them together"}, {"owner": {"reputation": 1889, "user_id": 4540658, "user_type": "registered", "accept_rate": 88, "profile_image": "https://i.stack.imgur.com/9vCJz.jpg?s=128&g=1", "display_name": "Dannyu NDos", "link": "https://stackoverflow.com/users/4540658/dannyu-ndos"}, "edited": false, "score": 0, "creation_date": 1531052538, "post_id": 50979508, "comment_id": 89442971, "body": "As you got the answer by yourself, please post the answer as an answer. Don&#39;t put it in the question post."}], "owner": {"reputation": 1377, "user_id": 8314628, "user_type": "registered", "accept_rate": 88, "profile_image": "https://www.gravatar.com/avatar/0eefa2c64f533d21e1d8f58e4252a1e9?s=128&d=identicon&r=PG&f=1", "display_name": "user8314628", "link": "https://stackoverflow.com/users/8314628/user8314628"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 135, "favorite_count": 0, "answer_count": 0, "score": 1, "last_activity_date": 1529702202, "creation_date": 1529631517, "last_edit_date": 1529702202, "question_id": 50979508, "link": "https://stackoverflow.com/questions/50979508/how-to-loop-through-a-list-of-string", "title": "How to loop through a list of string?", "body": "<p>I suppose to input a list of words. If a word's last letter is the same as the first letter of another word, then we connect them and output a list of lists, which contain all possible connections.</p>\n\n<p>Example: <code>convert([\"apple\",\"elephant\",\"eraser\", \"tower\",\"rank\"])</code> will give </p>\n\n<pre><code>[[\"elephant\", \"eraser\"], [\"tower\"], [\"rank\"], [\"rank\"], []]\n</code></pre>\n\n<p>I implemented my code as following:</p>\n\n<pre><code>convert :: [String] -&gt; [[String]]\nconvert [] = []\nconvert [x] = []\nconvert (x : xs) = if last x == head (head xs)\n    then [head xs] : [] : convert (x : (tail xs))\n    else convert (x : (tail xs))\n</code></pre>\n\n<p>But this can only check the first element. How can I loop through the whole list and check each word?</p>\n\n<p>===========================================================================</p>\n\n<p>Ok. I have it done.</p>\n\n<pre><code>convert :: [String] -&gt; [[String]]\nconvert [] = []\nconvert (x:xs) = [u | u &lt;- xs, last x == head u] : convert (xs)\n</code></pre>\n"}, {"tags": ["haskell", "containers"], "answers": [{"tags": [], "owner": {"reputation": 1290, "user_id": 5499871, "user_type": "registered", "profile_image": "https://graph.facebook.com/10206799318615183/picture?type=large", "display_name": "Izaak Weiss", "link": "https://stackoverflow.com/users/5499871/izaak-weiss"}, "is_accepted": false, "score": 2, "last_activity_date": 1529613569, "creation_date": 1529613569, "answer_id": 50977087, "question_id": 50977051, "link": "https://stackoverflow.com/questions/50977051/nonempty-set-in-haskell/50977087#50977087", "title": "NonEmpty set in Haskell", "body": "<p>Not in base, but there does seem to be a package that includes nonempty versions of a few data structures, such as Maps and Sets.</p>\n\n<p><a href=\"http://hackage.haskell.org/package/non-empty-0.3\" rel=\"nofollow noreferrer\">http://hackage.haskell.org/package/non-empty-0.3</a></p>\n"}], "owner": {"reputation": 163, "user_id": 2537744, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/80bcd13f968da3e4454a59c41cd3c658?s=128&d=identicon&r=PG", "display_name": "cheshircat", "link": "https://stackoverflow.com/users/2537744/cheshircat"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 142, "favorite_count": 0, "closed_date": 1529698369, "answer_count": 1, "score": 2, "last_activity_date": 1529613569, "creation_date": 1529613346, "question_id": 50977051, "link": "https://stackoverflow.com/questions/50977051/nonempty-set-in-haskell", "closed_reason": "Not suitable for this site", "title": "NonEmpty set in Haskell", "body": "<p>Is there an equivalent of Data.Lists.NonEmpty for sets?</p>\n\n<p>I know there is NonNull from mono-traversable, but I'm wondering if there's anything else out there.</p>\n"}, {"tags": ["haskell", "functional-programming", "lazy-evaluation", "evaluation", "declarative"], "comments": [{"owner": {"reputation": 126897, "user_id": 791604, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/ce991df7a056248d5e4f6fc3659ba733?s=128&d=identicon&r=PG", "display_name": "Daniel Wagner", "link": "https://stackoverflow.com/users/791604/daniel-wagner"}, "edited": false, "score": 4, "creation_date": 1529610442, "post_id": 50975063, "comment_id": 88948886, "body": "Why do you believe the first fold looks like <code>undefined || True</code>? Because that is incorrect, so if you can explain why you believe that, we may be able to point to the error in your reasoning that led to that conclusion."}, {"owner": {"reputation": 24028, "user_id": 383200, "user_type": "registered", "accept_rate": 60, "profile_image": "https://www.gravatar.com/avatar/a9dc722f936cb1059adaae4fe39c07f0?s=128&d=identicon&r=PG", "display_name": "Carl", "link": "https://stackoverflow.com/users/383200/carl"}, "reply_to_user": {"reputation": 126897, "user_id": 791604, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/ce991df7a056248d5e4f6fc3659ba733?s=128&d=identicon&r=PG", "display_name": "Daniel Wagner", "link": "https://stackoverflow.com/users/791604/daniel-wagner"}, "edited": false, "score": 1, "creation_date": 1529612603, "post_id": 50975063, "comment_id": 88949788, "body": "@DanielWagner it would be the first use of <code>(||)</code> evaluated if <code>foldr</code> actually folded from the right, the way it often does in strict languages."}, {"owner": {"reputation": 100185, "user_id": 3234959, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/93bb12ca0f93dfddb33880316f7e66c2?s=128&d=identicon&r=PG&f=1", "display_name": "chi", "link": "https://stackoverflow.com/users/3234959/chi"}, "reply_to_user": {"reputation": 24028, "user_id": 383200, "user_type": "registered", "accept_rate": 60, "profile_image": "https://www.gravatar.com/avatar/a9dc722f936cb1059adaae4fe39c07f0?s=128&d=identicon&r=PG", "display_name": "Carl", "link": "https://stackoverflow.com/users/383200/carl"}, "edited": false, "score": 1, "creation_date": 1529612865, "post_id": 50975063, "comment_id": 88949902, "body": "@Carl One could argue that <code>foldr</code> does fold from the right, denotationally. Its &quot;first&quot; fold is <code>undefined || False</code> which is <code>undefined</code>. The &quot;second&quot; is <code>True || undefined</code> which is <code>True</code> since OR is lazy (as it would also be in Java,C,etc.)."}, {"owner": {"reputation": 22377, "user_id": 2288659, "user_type": "registered", "accept_rate": 90, "profile_image": "https://i.stack.imgur.com/bBg8v.png?s=128&g=1", "display_name": "Silvio Mayolo", "link": "https://stackoverflow.com/users/2288659/silvio-mayolo"}, "edited": false, "score": 4, "creation_date": 1529615415, "post_id": 50975063, "comment_id": 88950910, "body": "Comparing &quot;folds from the right&quot; to &quot;iterates right-to-left&quot; is a sign that you&#39;re still thinking too imperatively. &quot;folds from the right&quot; is a statement about associativity, nothing more."}, {"owner": {"reputation": 126897, "user_id": 791604, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/ce991df7a056248d5e4f6fc3659ba733?s=128&d=identicon&r=PG", "display_name": "Daniel Wagner", "link": "https://stackoverflow.com/users/791604/daniel-wagner"}, "reply_to_user": {"reputation": 24028, "user_id": 383200, "user_type": "registered", "accept_rate": 60, "profile_image": "https://www.gravatar.com/avatar/a9dc722f936cb1059adaae4fe39c07f0?s=128&d=identicon&r=PG", "display_name": "Carl", "link": "https://stackoverflow.com/users/383200/carl"}, "edited": false, "score": 1, "creation_date": 1529618698, "post_id": 50975063, "comment_id": 88952018, "body": "@Carl It does fold from the right in some sense; but in that sense, the &quot;first&quot; fold is actually <code>undefined || False</code>, not <code>undefined || True</code>! This does (would) become <code>undefined</code>, as you observed, but unlike in a lazy language, it turns out that just because some part of the computation has <code>undefined</code> doesn&#39;t mean the whole thing is <code>undefined</code>..."}], "answers": [{"tags": [], "owner": {"reputation": 61419, "user_id": 849891, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/MbEO3.png?s=128&g=1", "display_name": "Will Ness", "link": "https://stackoverflow.com/users/849891/will-ness"}, "is_accepted": true, "score": 12, "last_activity_date": 1586638737, "last_edit_date": 1586638737, "creation_date": 1529605862, "answer_id": 50975397, "question_id": 50975063, "link": "https://stackoverflow.com/questions/50975063/mixing-foldr-with-or-in-haskell-laziness/50975397#50975397", "title": "mixing foldr with OR in Haskell (laziness?)", "body": "<p>According to the definition of <code>foldr</code>, </p>\n\n<pre><code>foldr (||) False [True,undefined]\n=\nTrue || foldr (||) False [undefined]\n</code></pre>\n\n<p>According to the definition of <code>(||)</code>,</p>\n\n<pre><code>True || _ = True\n</code></pre>\n\n<p>so there's no need to know the value of the right hand expression to know the answer.</p>\n\n<p><code>foldr</code> does <em>not</em> do steps on its own. The process is driven by the demands of the reducer function.</p>\n\n<p><em>edit:</em> Nothing funny's going on. Each evaluation step is straightforwardly done according to the definitions involved. </p>\n"}], "owner": {"reputation": 85, "user_id": 9969128, "user_type": "registered", "profile_image": "https://lh5.googleusercontent.com/-DDwYKHYQEjA/AAAAAAAAAAI/AAAAAAAAAAA/AB6qoq2LrtXu7gHuhynaqs9gbMun2p8gdg/mo/photo.jpg?sz=128", "display_name": "pepe22", "link": "https://stackoverflow.com/users/9969128/pepe22"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 117, "favorite_count": 0, "accepted_answer_id": 50975397, "answer_count": 1, "score": 6, "last_activity_date": 1586638737, "creation_date": 1529604440, "last_edit_date": 1529612134, "question_id": 50975063, "link": "https://stackoverflow.com/questions/50975063/mixing-foldr-with-or-in-haskell-laziness", "title": "mixing foldr with OR in Haskell (laziness?)", "body": "<p>How can this function return true?</p>\n\n<pre><code>foldr (||) False [True,undefined] \n\n=&gt; True\n</code></pre>\n\n<p>The first fold looks like this:</p>\n\n<pre><code>undefined || True \n</code></pre>\n\n<p>, which should return an error</p>\n\n<p>So im guessing haskell gives priority to the lazyness of the OR function over doing the folds step by step. Finds a <code>True</code> on the way and returns that before starting the fold</p>\n\n<p>Is this correct? In that case, does haskell always give priority to a lazy function over the non lazy ones? I believe that is the definition for being lazy but it seems like that can change the answer to make it wrong</p>\n"}, {"tags": ["java", "haskell", "java-8", "functional-programming", "monads"], "comments": [{"owner": {"reputation": 11366, "user_id": 3922954, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/76ba47d2fdd24ab56b0b273cce2075e5?s=128&d=identicon&r=PG&f=1", "display_name": "AJF", "link": "https://stackoverflow.com/users/3922954/ajf"}, "edited": false, "score": 2, "creation_date": 1529581222, "post_id": 50967383, "comment_id": 88931591, "body": "Why not just use exceptions in your Java code? Furthermore, the Haskell code doesn&#39;t actually handle division by zero. If you&#39;re translating directly I don&#39;t see why you&#39;d handle that."}, {"owner": {"reputation": 539, "user_id": 6572357, "user_type": "registered", "profile_image": "https://graph.facebook.com/1209368569096442/picture?type=large", "display_name": "D&#225;niel Somogyi", "link": "https://stackoverflow.com/users/6572357/d%c3%a1niel-somogyi"}, "edited": false, "score": 2, "creation_date": 1529582020, "post_id": 50967383, "comment_id": 88932067, "body": "If you want to go functional: There is an <code>Optional</code> class in java"}, {"owner": {"reputation": 14537, "user_id": 7128034, "user_type": "registered", "accept_rate": 85, "profile_image": "https://i.stack.imgur.com/T8aRg.jpg?s=128&g=1", "display_name": "Dami&#225;n Rafael Lattenero", "link": "https://stackoverflow.com/users/7128034/dami%c3%a1n-rafael-lattenero"}, "reply_to_user": {"reputation": 539, "user_id": 6572357, "user_type": "registered", "profile_image": "https://graph.facebook.com/1209368569096442/picture?type=large", "display_name": "D&#225;niel Somogyi", "link": "https://stackoverflow.com/users/6572357/d%c3%a1niel-somogyi"}, "edited": false, "score": 1, "creation_date": 1529582900, "post_id": 50967383, "comment_id": 88932640, "body": "@D&#225;nielSomogyi thanks for the comment you made me understand better the problem here"}, {"owner": {"reputation": 100185, "user_id": 3234959, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/93bb12ca0f93dfddb33880316f7e66c2?s=128&d=identicon&r=PG&f=1", "display_name": "chi", "link": "https://stackoverflow.com/users/3234959/chi"}, "edited": false, "score": 4, "creation_date": 1529587623, "post_id": 50967383, "comment_id": 88935742, "body": "I&#39;d use a Java interface instead of an abstract class. Also know that, in theory, any algebraic data type (like Haskell&#39;s <code>data</code>s) could be faithfully represented in Java using a &quot;visitor pattern&quot; / &quot;impredicative encoding&quot; / &quot;Church encoding&quot;. Using inheritance as you do above is close, but not the same, since classes are open (new subclasses can be added). Also, it&#39;s a bit inconvenient to have to spread pattern matching over all subclasses (the visitor pattern avoids that). The main downside is that the visitor pattern is not as simple as the above approach."}], "answers": [{"tags": [], "owner": {"reputation": 17647, "user_id": 5515060, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/BXWsz.png?s=128&g=1", "display_name": "Lino", "link": "https://stackoverflow.com/users/5515060/lino"}, "is_accepted": false, "score": 5, "last_activity_date": 1529580593, "creation_date": 1529580593, "answer_id": 50967497, "question_id": 50967383, "link": "https://stackoverflow.com/questions/50967383/what-is-the-java-equivalent-of-this-haskell-function/50967497#50967497", "title": "What is the Java equivalent of this Haskell function?", "body": "<p>You could evaluate both <code>x</code> and <code>y</code> before the division:</p>\n\n<pre><code>Integer xE = x.evaluate(), yE = y.evaluate();\n</code></pre>\n\n<p>And then see if <code>yE</code> is equal to <code>0</code>:</p>\n\n<pre><code>if(yE == 0){\n    // your logic here if it is a division by 0\n}\n</code></pre>\n\n<p>Which would yield you with the following function:</p>\n\n<pre><code>public Integer evaluate() {        \n    Integer xE = x.evaluate(), yE = y.evaluate();\n\n    if(yE == 0){\n        // your logic here if it is a division by 0\n    }\n    return xE / yE;  \n}\n</code></pre>\n"}, {"comments": [{"owner": {"reputation": 205, "user_id": 9972614, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/ad56cd82437e2fb4da8e169ab0269653?s=128&d=identicon&r=PG&f=1", "display_name": "Nemo", "link": "https://stackoverflow.com/users/9972614/nemo"}, "edited": false, "score": 1, "creation_date": 1529594845, "post_id": 50967830, "comment_id": 88940900, "body": "Thanks, you&#39;ve given me more help than I expected.  I knew that the problem I had was that I hadn&#39;t chosen the correct pattern to be equivalent to the Haskell data type but you&#39;ve also included an example of the use of the monad in your answer."}, {"owner": {"reputation": 14537, "user_id": 7128034, "user_type": "registered", "accept_rate": 85, "profile_image": "https://i.stack.imgur.com/T8aRg.jpg?s=128&g=1", "display_name": "Dami&#225;n Rafael Lattenero", "link": "https://stackoverflow.com/users/7128034/dami%c3%a1n-rafael-lattenero"}, "reply_to_user": {"reputation": 205, "user_id": 9972614, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/ad56cd82437e2fb4da8e169ab0269653?s=128&d=identicon&r=PG&f=1", "display_name": "Nemo", "link": "https://stackoverflow.com/users/9972614/nemo"}, "edited": false, "score": 1, "creation_date": 1529597499, "post_id": 50967830, "comment_id": 88942568, "body": "@Nemo thanks so much, I have always loved to help, and this kind of issues are my favorites ones. If you have more dubts don&#39;t hesitate to write to me"}], "tags": [], "owner": {"reputation": 14537, "user_id": 7128034, "user_type": "registered", "accept_rate": 85, "profile_image": "https://i.stack.imgur.com/T8aRg.jpg?s=128&g=1", "display_name": "Dami&#225;n Rafael Lattenero", "link": "https://stackoverflow.com/users/7128034/dami%c3%a1n-rafael-lattenero"}, "is_accepted": true, "score": 15, "last_activity_date": 1566259195, "last_edit_date": 1566259195, "creation_date": 1529581579, "answer_id": 50967830, "question_id": 50967383, "link": "https://stackoverflow.com/questions/50967383/what-is-the-java-equivalent-of-this-haskell-function/50967830#50967830", "title": "What is the Java equivalent of this Haskell function?", "body": "<p>Edit: a workaround to failures in this kind of cases is the use of the <code>Maybe Monad</code>, and his cousin in Java is the <code>Optional</code> class, where <code>Option.of</code> would be <code>return</code> and <code>flatMap</code> would be <code>bind</code>. On the other hand in Java and others O.O. languages there is a common pattern to use in this kind of cases called composite, basically your data type <code>Expr</code> will be an interface or abstract class, and the type constructors will be the leaves:\nSo, with all of that in mind, a simple example working would be:</p>\n\n<p>In haskell:</p>\n\n<pre><code>data Expr = Val Int | Div Expr Expr\n\neval :: Expr -&gt; Maybe Int\neval (Val n) = Just n\neval (Div x y) = do\n                  v1 &lt;- eval x\n                  v2 &lt;- eval y\n                  if v2 == 0 \n                  then Nothing\n                  else return (div v1 v2)\nn1 = Val 8\nn2 = Val 4\nn3 = Val 0 \nd1 = Div n1 n2\nd2 = Div d1 d1\nd3 = Div d2 n3\n\nmain = do\n  putStrLn $ show (eval d2)\n  putStrLn $ show (eval d3)\n</code></pre>\n\n<p>Equivalent approach in Java:</p>\n\n<pre><code>import java.util.Optional;\n\npublic interface Expr {\n\n    public Optional&lt;Integer&gt; eval();\n\n}\n</code></pre>\n\n<p>Then the leaves implementing Expr:</p>\n\n<pre><code>import java.util.Optional;\n\npublic class Val implements Expr{\n\n    Optional&lt;Integer&gt; value;\n\n    public Val(int value) {\n        this.value = Optional.of(value);\n    }\n\n    @Override\n    public Optional&lt;Integer&gt; eval() {\n        return value;\n    }\n}\n</code></pre>\n\n<p>Then the recursive case:</p>\n\n<pre><code>import java.util.Optional;\n\npublic class Div implements Expr {\n\n    Expr expr1;\n    Expr expr2;\n\n    public Div(Expr expr1, Expr expr2) {\n        this.expr1 = expr1;\n        this.expr2 = expr2;\n    }\n\n    @Override\n    public Optional&lt;Integer&gt; eval() {\n        return expr1.eval().flatMap(v1 -&gt;\n                expr2.eval().flatMap(v2 -&gt;\n                    (v2 == 0) ? Optional.empty() : Optional.of(v1 / v2)\n                )\n               );\n    }\n\n    public static void main(String[] args) {\n        Expr iv1 = new Val(6);\n        Expr iv2 = new Val(3);\n        Expr iv3 = new Val(2);\n        Expr iv4 = new Val(0);\n        Expr div1 = new Div(iv1, iv2);\n        Expr div2 = new Div(div1, iv3);\n        Expr div3 = new Div(div2, iv4);\n\n        System.out.println(div2.eval());\n        System.out.println(div3.eval());\n\n    }\n}\n</code></pre>\n\n<p>The main function output will be:</p>\n\n<pre><code>Optional[1]\nOptional.empty\n</code></pre>\n"}, {"comments": [{"owner": {"reputation": 205, "user_id": 9972614, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/ad56cd82437e2fb4da8e169ab0269653?s=128&d=identicon&r=PG&f=1", "display_name": "Nemo", "link": "https://stackoverflow.com/users/9972614/nemo"}, "edited": false, "score": 3, "creation_date": 1529690592, "post_id": 50980488, "comment_id": 88981440, "body": "This is fairly easily adapted to use Optional&lt;Integer&gt; and flatmap() thanks!"}], "tags": [], "owner": {"reputation": 48938, "user_id": 246886, "user_type": "registered", "accept_rate": 94, "profile_image": "https://www.gravatar.com/avatar/dd1ebaade6623fc538fb8af3338e730d?s=128&d=identicon&r=PG", "display_name": "Jon Purdy", "link": "https://stackoverflow.com/users/246886/jon-purdy"}, "is_accepted": false, "score": 12, "last_activity_date": 1529809728, "last_edit_date": 1529809728, "creation_date": 1529640092, "answer_id": 50980488, "question_id": 50967383, "link": "https://stackoverflow.com/questions/50967383/what-is-the-java-equivalent-of-this-haskell-function/50980488#50980488", "title": "What is the Java equivalent of this Haskell function?", "body": "<p>Other answers have covered a more idiomatic way of implementing this in Java, and described how to use <code>Optional</code> to handle errors. But here I\u2019d like to give the direct equivalent of Haskell pattern matching in Java, with the <em>visitor pattern</em>:</p>\n\n<pre><code>public class ExprTest {\n    public static void main(String[] arguments) {\n\n        // expr :: Expr\n        // expr = Div\n        //   (Div\n        //     (Div (Val 100) (Val 5))\n        //     (Val 2))\n        //   (Div (Val 10) (Val 2))\n        Expr two = new Val(2);\n        Expr twenty = new Div(new Val(100), new Val(5));\n        Expr ten = new Div(twenty, new Val(2));\n        Expr five = new Div(new Val(10), two);\n        Expr expr = new Div(ten, five);\n\n        // eval :: Expr -&gt; Int\n        // eval expr = case expr of\n        ExprVisitor&lt;Integer&gt; eval = new ExprVisitor&lt;Integer&gt;() {\n\n            // Val value -&gt; value\n            public Integer visit(Val val) {\n                return val.value;\n            }\n\n            // Div left right -&gt; eval left `div` eval right\n            public Integer visit(Div div) {\n                return div.left.match(this) / div.right.match(this);\n            }\n\n        };\n\n        // main = print (eval expr)\n        System.out.println(expr.match(eval));\n    }\n}\n\n// data Expr\nabstract class Expr {\n    abstract &lt;T&gt; T match(ExprVisitor&lt;T&gt; visitor);\n}\n\n// = Val Int\nclass Val extends Expr {\n\n    public final int value;\n\n    public Val(int value) {\n        this.value = value;\n    }\n\n    &lt;T&gt; T match(ExprVisitor&lt;T&gt; visitor) {\n        return visitor.visit(this);\n    }\n\n}\n\n// | Div Expr Expr\nclass Div extends Expr {\n\n    public final Expr left, right;\n\n    public Div(Expr left, Expr right) {\n        this.left = left;\n        this.right = right;\n    }\n\n    &lt;T&gt; T match(ExprVisitor&lt;T&gt; visitor) {\n        return visitor.visit(this);\n    }\n\n}\n\nabstract class ExprVisitor&lt;T&gt; {\n    abstract T visit(Val val);\n    abstract T visit(Div div);\n}\n</code></pre>\n\n<p>In the land of functional programming, this is called B\u00f6hm\u2013Berarducci encoding\u2014sometimes referred to as Church encoding, although they\u2019re different things. This is a fancy-sounding way of saying \u201crepresenting data types and pattern matching with functions\u201d. You can of course use this encoding of matching in Haskell:</p>\n\n<pre><code>match\n  :: (Int -&gt; t)           -- visit(Val)\n  -&gt; (Expr -&gt; Expr -&gt; t)  -- visit(Div)\n  -&gt; Expr\n  -&gt; t\nmatch val div expr = case expr of\n  Val x -&gt; val x\n  Div left right -&gt; div left right\n\neval :: Expr -&gt; Int\neval = match id (\\ left right -&gt; eval left `div` eval right)\n</code></pre>\n\n<p>Since <code>eval</code> is recursive, you can also write it using the <em>fixed point combinator</em> <code>fix</code>\u2014and then the use of <code>this</code> in the <code>ExprVisitor</code> in the Java version may become more clear: it\u2019s how you make <code>eval</code> recursive!</p>\n\n<pre><code>import Data.Function (fix)\n\neval :: Expr -&gt; Int\neval = fix $ \\ this -&gt; match\n  (\\ value -&gt; value)\n  (\\ left right -&gt; this left `div` this right)\n</code></pre>\n\n<p>And here\u2019s the other half of the encoding: we can do away with the data type altogether and just use functions:</p>\n\n<pre><code>{-# LANGUAGE RankNTypes #-}\n\nnewtype Expr = Expr\n  { visit\n    :: forall a.\n       (Int -&gt; a)     -- Val\n    -&gt; (a -&gt; a -&gt; a)  -- Div\n    -&gt; a }\n\nvalE :: Int -&gt; Expr\nvalE x = Expr $ \\ v _d -&gt; v x\n\ndivE :: Expr -&gt; Expr -&gt; Expr\ndivE left right = Expr $ \\ v d\n  -&gt; d (visit left v d) (visit right v d)\n\neval :: Expr -&gt; Int\neval expr = visit expr\n  (\\ val -&gt; val)\n  (\\ left right -&gt; left `div` right)\n\neval (divE\n  (divE (divE (valE 100) (valE 5)) (valE 2))\n  (divE (valE 10) (valE 2)))\n  == 2\n</code></pre>\n\n<p>And that implementation of <code>eval</code> can of course be written as just this:</p>\n\n<pre><code>eval = visit expr id div\n</code></pre>\n"}], "owner": {"reputation": 205, "user_id": 9972614, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/ad56cd82437e2fb4da8e169ab0269653?s=128&d=identicon&r=PG&f=1", "display_name": "Nemo", "link": "https://stackoverflow.com/users/9972614/nemo"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 989, "favorite_count": 2, "accepted_answer_id": 50967830, "answer_count": 3, "score": 18, "last_activity_date": 1597768208, "creation_date": 1529580264, "last_edit_date": 1566851823, "question_id": 50967383, "link": "https://stackoverflow.com/questions/50967383/what-is-the-java-equivalent-of-this-haskell-function", "title": "What is the Java equivalent of this Haskell function?", "body": "<p>Philip Wadler's paper \"Monads for functional programming\" has an example of a function eval which performs division written in Haskell.</p>\n\n<p>Here it is as adapted in \"Programming in Haskell\" by Graham Hutton:</p>\n\n<pre class=\"lang-hs prettyprint-override\"><code>data Expr = Val Int | Div Expr Expr\n\neval :: Expr -&gt; Int\neval (Val n) = n\neval (Div x y) = eval x `div` eval y\n</code></pre>\n\n<p>My Java equivalent of this is:</p>\n\n<pre><code>abstract class IntegerExpression {\n    abstract Integer evaluate();\n}\n\nclass Value extends IntegerExpression {\n\n    Integer value;\n\n    public Value(Integer x) {\n       value = x;\n    }\n\n    public  Integer evaluate() {\n        return value;\n    }\n}\n\nclass DivisionExpression extends IntegerExpression {\n\n    IntegerExpression x, y;\n\n    public DivisionExpression(IntegerExpression a, IntegerExpression b) {\n        x = a;\n        y = b;\n    }\n\n    public Integer evaluate() {        \n        return x.evaluate() / y.evaluate();\n    }\n\n}\n\n   public class DivisionExample {\n\n    public static void main(String[] args) {\n        IntegerExpression two = new Value(2);\n        IntegerExpression twenty = new DivisionExpression (new Value(100), new Value(5));\n        IntegerExpression ten = new DivisionExpression(twenty, new Value(2));\n        IntegerExpression five = new DivisionExpression(new Value(10), two);\n        IntegerExpression expr = new DivisionExpression(ten, five);\n\n        System.out.println(expr.evaluate());\n    }\n}\n</code></pre>\n\n<p>This seems fine but how do I develop this code so that I can demonstrate a Try monad (to catch division by zero) in Java? </p>\n"}, {"tags": ["haskell", "functional-programming", "abstract-syntax-tree", "structured-text"], "comments": [{"owner": {"reputation": 27561, "user_id": 214446, "user_type": "registered", "accept_rate": 74, "profile_image": "https://www.gravatar.com/avatar/5deb6b87326686b1f2e9fdb37ceac210?s=128&d=identicon&r=PG", "display_name": "mb21", "link": "https://stackoverflow.com/users/214446/mb21"}, "edited": false, "score": 1, "creation_date": 1529572303, "post_id": 50961817, "comment_id": 88925820, "body": "you might want to have a look at <a href=\"http://www.purescript.org/\" rel=\"nofollow noreferrer\">purescript.org</a>"}], "answers": [{"comments": [{"owner": {"reputation": 3074, "user_id": 1608276, "user_type": "registered", "accept_rate": 28, "profile_image": "https://i.stack.imgur.com/XiZ2q.jpg?s=128&g=1", "display_name": "luochen1990", "link": "https://stackoverflow.com/users/1608276/luochen1990"}, "edited": false, "score": 0, "creation_date": 1529595580, "post_id": 50962490, "comment_id": 88941397, "body": "Sorry for the unclear, Now I added more description trying to make it more clear."}, {"owner": {"reputation": 14543, "user_id": 235908, "user_type": "registered", "accept_rate": 83, "profile_image": "https://i.stack.imgur.com/rTstt.jpg?s=128&g=1", "display_name": "Simon Shine", "link": "https://stackoverflow.com/users/235908/simon-shine"}, "reply_to_user": {"reputation": 3074, "user_id": 1608276, "user_type": "registered", "accept_rate": 28, "profile_image": "https://i.stack.imgur.com/XiZ2q.jpg?s=128&g=1", "display_name": "luochen1990", "link": "https://stackoverflow.com/users/1608276/luochen1990"}, "edited": false, "score": 0, "creation_date": 1529655399, "post_id": 50962490, "comment_id": 88962027, "body": "@luochen1990: I&#39;m not sure what else to say. You could read <a href=\"https://github.com/dmjio/miso/blob/master/ghcjs-src/Miso/Html/Internal.hs\" rel=\"nofollow noreferrer\">how Miso does it</a> using GHCJS."}], "tags": [], "owner": {"reputation": 14543, "user_id": 235908, "user_type": "registered", "accept_rate": 83, "profile_image": "https://i.stack.imgur.com/rTstt.jpg?s=128&g=1", "display_name": "Simon Shine", "link": "https://stackoverflow.com/users/235908/simon-shine"}, "is_accepted": false, "score": 2, "last_activity_date": 1529565150, "creation_date": 1529565150, "answer_id": 50962490, "question_id": 50961817, "link": "https://stackoverflow.com/questions/50961817/how-to-sync-operations-between-ast-and-dom-in-haskell/50962490#50962490", "title": "How to sync operations between AST and DOM in haskell?", "body": "<p>I'm not sure if you're mainly looking for a general way to synchronise two things both ways (across what interface? Is this in a browser, or in a pure Haskell function?), or for a way to do front-end web programming. For the former, consider <a href=\"https://wiki.haskell.org/Reactive-banana/Examples\" rel=\"nofollow noreferrer\">FRP and reactive-banana</a> which will let you express bi-directional events. For the latter, consider something like <a href=\"https://github.com/dmjio/miso\" rel=\"nofollow noreferrer\">Miso</a> which uses GHCJS to produce front-end web-browser code that interacts efficiently with the DOM. (Miso resembles <a href=\"http://elm-lang.org/\" rel=\"nofollow noreferrer\">Elm</a>.)</p>\n"}], "owner": {"reputation": 3074, "user_id": 1608276, "user_type": "registered", "accept_rate": 28, "profile_image": "https://i.stack.imgur.com/XiZ2q.jpg?s=128&g=1", "display_name": "luochen1990", "link": "https://stackoverflow.com/users/1608276/luochen1990"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 112, "favorite_count": 0, "answer_count": 1, "score": 1, "last_activity_date": 1529595458, "creation_date": 1529562765, "last_edit_date": 1529595458, "question_id": 50961817, "link": "https://stackoverflow.com/questions/50961817/how-to-sync-operations-between-ast-and-dom-in-haskell", "title": "How to sync operations between AST and DOM in haskell?", "body": "<p>To implement a visualized arithmetic expression editor in Haskell, I defined the following things:</p>\n\n<pre><code>data AST = Lit Int\n         | Add AST AST\n         | Neg AST\n\neval :: AST -&gt; Int\n\ntype TagName = String\ntype Attrs = M.Map String String\ndata DOM = Tag TagName Attrs [SubDOM]\ndata SubDOM = SubNode DOM | Text String\n\ntoDOM :: AST -&gt; DOM\nfromDOM :: DOM -&gt; AST\n</code></pre>\n\n<p>I want to make it possible for user to edit both the AST and the DOM, and sync the user operations (such as substitute a child node into another) between them, and further more, I want to sync operations efficiently (which means only the modified child node should be reconstructed), how should I approach this?</p>\n\n<p>One solution is allocate each AST node and DOM node an id, and when an operation happens on one side, we sync this operation to the other side node with the same id, but this step seem tricky in functional programming, and I asked this question separatly: <a href=\"https://stackoverflow.com/questions/50960866/how-to-generate-stable-id-for-ast-nodes-in-functional-programming\">How to generate stable id for AST nodes in functional programming?</a> .</p>\n\n<p>Another solution is redefine the data structure, so that one side keep an IORef of the other side, and when an operation happens, we can sync the operation to the other side via the reference. But this approach seems not functional.</p>\n\n<p>So, is there a best practice for this problem in functional programming?</p>\n"}, {"tags": ["haskell"], "answers": [{"comments": [{"owner": {"reputation": 100892, "user_id": 745903, "user_type": "registered", "accept_rate": 74, "profile_image": "https://www.gravatar.com/avatar/50933f6638836741e620669b3940410e?s=128&d=identicon&r=PG", "display_name": "leftaroundabout", "link": "https://stackoverflow.com/users/745903/leftaroundabout"}, "edited": false, "score": 1, "creation_date": 1529572838, "post_id": 50962249, "comment_id": 88926118, "body": "Is there any situation where it doesn&#39;t behave as it were <code>infix (-1) ::</code>?"}, {"owner": {"reputation": 7033, "user_id": 288201, "user_type": "registered", "accept_rate": 57, "profile_image": "https://www.gravatar.com/avatar/b4b21f0f66f55fe614e7eeac6807f7f4?s=128&d=identicon&r=PG", "display_name": "Koterpillar", "link": "https://stackoverflow.com/users/288201/koterpillar"}, "reply_to_user": {"reputation": 100892, "user_id": 745903, "user_type": "registered", "accept_rate": 74, "profile_image": "https://www.gravatar.com/avatar/50933f6638836741e620669b3940410e?s=128&d=identicon&r=PG", "display_name": "leftaroundabout", "link": "https://stackoverflow.com/users/745903/leftaroundabout"}, "edited": false, "score": 0, "creation_date": 1529577754, "post_id": 50962249, "comment_id": 88929305, "body": "I don&#39;t think so, the second example in that message seems to work exactly the same way with <code>$</code>."}], "tags": [], "owner": {"reputation": 7033, "user_id": 288201, "user_type": "registered", "accept_rate": 57, "profile_image": "https://www.gravatar.com/avatar/b4b21f0f66f55fe614e7eeac6807f7f4?s=128&d=identicon&r=PG", "display_name": "Koterpillar", "link": "https://stackoverflow.com/users/288201/koterpillar"}, "is_accepted": true, "score": 18, "last_activity_date": 1529567153, "last_edit_date": 1529567153, "creation_date": 1529564290, "answer_id": 50962249, "question_id": 50961184, "link": "https://stackoverflow.com/questions/50961184/whats-the-infix-priority-of-type-annotation/50962249#50962249", "title": "what&#39;s the infix priority of type annotation (::)", "body": "<p>The <code>::</code> part is called a type annotation.</p>\n\n<p>A message on the mailing list points to exactly the same conclusion, supported by the grammar:</p>\n\n<p><a href=\"https://mail.haskell.org/pipermail/beginners/2012-December/011017.html\" rel=\"noreferrer\">https://mail.haskell.org/pipermail/beginners/2012-December/011017.html</a></p>\n\n<blockquote>\n  <p>It's not really a binary operator.</p>\n  \n  <p>It's part of the syntax, so it has no exact precedence, but since you're \n  asking about it, I presume you're not interested in type declarations</p>\n\n<pre><code>foo :: Int -&gt; Double  \nfoo = sin . fromIntegral\n</code></pre>\n  \n  <p>but rather in expression type signatures. The production in the context-free \n  syntax is</p>\n\n<pre><code>exp \u2192 infixexp :: [context =&gt;] type\n</code></pre>\n  \n  <p>so the signature is for the entire infix expression:</p>\n\n<pre><code>Prelude&gt; toEnum . floor $ 12.7 + toEnum 73 :: Char\n'U'\n</code></pre>\n  \n  <p>hence if it had a precedence, it would be below 0 (the precedence of ($)).</p>\n  \n  <p>But be aware that</p>\n  \n  <p>\"The grammar is ambiguous regarding the extent of lambda abstractions,\n  let  expressions, and conditionals. The ambiguity is resolved by the\n  meta-rule that  each of these constructs extends as far to the right\n  as possible.\"</p>\n  \n  <p>thus</p>\n\n<pre><code>Prelude&gt; (\\x -&gt; x + x :: Int -&gt; Int) 2\n\n&lt;interactive&gt;:16:10:\n    No instance for (Num (Int -&gt; Int)) arising from a use of `+'\n    Possible fix: add an instance declaration for (Num (Int -&gt; Int))\n    In the expression: x + x :: Int -&gt; Int\n    In the expression: \\ x -&gt; x + x :: Int -&gt; Int\n    In the expression: (\\ x -&gt; x + x :: Int -&gt; Int) 2\n</code></pre>\n  \n  <p>the type signature here extends only over the <code>x + x</code>, since it is\n  parsed as a  part of the lambda abstraction</p>\n  \n  <p>[ <code>\\x -&gt; (x + x :: Int -&gt; Int)</code> extends farther to the right than just \n  <code>\\x -&gt; x + x</code> ]</p>\n  \n  <p>So if you want to give a type signature to a lambda abstraction, you\n  need  explicit parentheses:</p>\n\n<pre><code>Prelude&gt; ((\\x -&gt; x + x) :: Int -&gt; Int) 2 4\n</code></pre>\n</blockquote>\n"}], "owner": {"reputation": 2740, "user_id": 832847, "user_type": "registered", "accept_rate": 40, "profile_image": "https://www.gravatar.com/avatar/8d537be713ae7b9be79f446de62e61f7?s=128&d=identicon&r=PG", "display_name": "Leo Zhang", "link": "https://stackoverflow.com/users/832847/leo-zhang"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 296, "favorite_count": 0, "accepted_answer_id": 50962249, "answer_count": 1, "score": 21, "last_activity_date": 1529567153, "creation_date": 1529560106, "last_edit_date": 1529564358, "question_id": 50961184, "link": "https://stackoverflow.com/questions/50961184/whats-the-infix-priority-of-type-annotation", "title": "what&#39;s the infix priority of type annotation (::)", "body": "<p>What's the priority of <code>::</code>, is there any operator has even lower priority than it?</p>\n\n<p>It seems the priority of <code>::</code> is lower than <code>$</code>, because both of the expression below returns <code>\"ab\"</code></p>\n\n<pre><code>map head $ [\"alice\", \"bob\"] :: String\nmap head [\"alice\", \"bob\"] :: String\n</code></pre>\n"}, {"tags": ["haskell", "functional-programming", "immutability", "abstract-syntax-tree"], "comments": [{"owner": {"reputation": 8237, "user_id": 2900502, "user_type": "registered", "accept_rate": 73, "profile_image": "https://i.stack.imgur.com/R1OjD.jpg?s=128&g=1", "display_name": "Shersh", "link": "https://stackoverflow.com/users/2900502/shersh"}, "edited": false, "score": 0, "creation_date": 1529561020, "post_id": 50960866, "comment_id": 88919530, "body": "Instead of <code>IORef</code> you can just use <code>STRef</code>."}, {"owner": {"reputation": 3074, "user_id": 1608276, "user_type": "registered", "accept_rate": 28, "profile_image": "https://i.stack.imgur.com/XiZ2q.jpg?s=128&g=1", "display_name": "luochen1990", "link": "https://stackoverflow.com/users/1608276/luochen1990"}, "reply_to_user": {"reputation": 8237, "user_id": 2900502, "user_type": "registered", "accept_rate": 73, "profile_image": "https://i.stack.imgur.com/R1OjD.jpg?s=128&g=1", "display_name": "Shersh", "link": "https://stackoverflow.com/users/2900502/shersh"}, "edited": false, "score": 0, "creation_date": 1529561130, "post_id": 50960866, "comment_id": 88919588, "body": "@Shersh thx, but I&#39;m still wondering is there any more pretty and functional approach?"}, {"owner": {"reputation": 4234, "user_id": 4942760, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/f322d06b4f3e34278f29a954e0f38cb1?s=128&d=identicon&r=PG&f=1", "display_name": "Dan Robertson", "link": "https://stackoverflow.com/users/4942760/dan-robertson"}, "edited": false, "score": 2, "creation_date": 1529571818, "post_id": 50960866, "comment_id": 88925512, "body": "So I think what you\u2019re trying to do is a poor mans reference, where you have some mapping of id to node and a reference is an id that you can look up in the mapping? The functional way is to not have circular references on things you want to change. One way to be able to generate ids is to use a state monad: read the state and put back state*1 whenever you want a new id."}, {"owner": {"reputation": 37219, "user_id": 1523776, "user_type": "moderator", "accept_rate": 87, "profile_image": "https://www.gravatar.com/avatar/b3e0b5c8e42a8c38009ef2d969f8dabb?s=128&d=identicon&r=PG", "display_name": "Benjamin Hodgson", "link": "https://stackoverflow.com/users/1523776/benjamin-hodgson"}, "edited": false, "score": 0, "creation_date": 1529684238, "post_id": 50960866, "comment_id": 88978585, "body": "&quot;interactively editing a tree&quot; is what zippers were invented for"}, {"owner": {"reputation": 24211, "user_id": 1364288, "user_type": "registered", "accept_rate": 88, "profile_image": "https://i.stack.imgur.com/JVtNl.png?s=128&g=1", "display_name": "danidiaz", "link": "https://stackoverflow.com/users/1364288/danidiaz"}, "reply_to_user": {"reputation": 37219, "user_id": 1523776, "user_type": "moderator", "accept_rate": 87, "profile_image": "https://www.gravatar.com/avatar/b3e0b5c8e42a8c38009ef2d969f8dabb?s=128&d=identicon&r=PG", "display_name": "Benjamin Hodgson", "link": "https://stackoverflow.com/users/1523776/benjamin-hodgson"}, "edited": false, "score": 0, "creation_date": 1529692548, "post_id": 50960866, "comment_id": 88982237, "body": "@BenjaminHodgson Only if the edits are always &quot;localized&quot;, always defined in relation to the previous one. But for &quot;random&quot; arbitrary edits, I&#39;m not sure maintaining zipper would help."}], "answers": [{"tags": [], "owner": {"reputation": 24211, "user_id": 1364288, "user_type": "registered", "accept_rate": 88, "profile_image": "https://i.stack.imgur.com/JVtNl.png?s=128&g=1", "display_name": "danidiaz", "link": "https://stackoverflow.com/users/1364288/danidiaz"}, "is_accepted": false, "score": 2, "last_activity_date": 1529606093, "creation_date": 1529606093, "answer_id": 50975446, "question_id": 50960866, "link": "https://stackoverflow.com/questions/50960866/how-to-generate-stable-id-for-ast-nodes-in-functional-programming/50975446#50975446", "title": "How to generate stable id for AST nodes in functional programming?", "body": "<p>Perhaps you could use the path from the root to the node as the id of that node. For example, for the datatype</p>\n\n<pre><code>data AST = Lit Int\n         | Add AST AST\n         | Neg AST\n</code></pre>\n\n<p>You could have something like</p>\n\n<pre><code>data ASTPathPiece = AddGoLeft\n                  | AddGoRight\n                  | NegGoDown\n\ntype ASTPath = [ASTPathPiece]\n</code></pre>\n\n<p>This satisfies conditions 2 and 3 but, alas, it doesn't satisfy 1 in general. The index into a list will change if you insert a node in a previous position, for example.</p>\n\n<p>If you are rendering the AST into another format, perhaps you could add hidden attributes in the result nodes that identified which <code>ASTPathPiece</code> led to them. Traversing the result nodes upwards to the root would let you reconstruct the <code>ASTPath</code>.</p>\n"}], "owner": {"reputation": 3074, "user_id": 1608276, "user_type": "registered", "accept_rate": 28, "profile_image": "https://i.stack.imgur.com/XiZ2q.jpg?s=128&g=1", "display_name": "luochen1990", "link": "https://stackoverflow.com/users/1608276/luochen1990"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 159, "favorite_count": 0, "answer_count": 1, "score": 3, "last_activity_date": 1529606093, "creation_date": 1529558342, "question_id": 50960866, "link": "https://stackoverflow.com/questions/50960866/how-to-generate-stable-id-for-ast-nodes-in-functional-programming", "title": "How to generate stable id for AST nodes in functional programming?", "body": "<p>I want to substitute a specific AST node into another, and this substituted node is specified by interactive user input.</p>\n\n<p>In non-functional programming, you can use mutable data structure, and each AST node have a object reference, so when I need to reference to a specific node, I can use this reference.</p>\n\n<p>But in functional programming, use <code>IORef</code> is not recommended, so I need to generate id for each AST node, and I want this id to be <strong>stable</strong>, which means:</p>\n\n<ol>\n<li>when a node is not changed, the generated id will also not change.</li>\n<li>when a child node is changed, it's parent's id will not change.</li>\n</ol>\n\n<p>And, to make it clear that it is an id instead of a hash value:</p>\n\n<ol start=\"3\">\n<li>for two different sub nodes, which are compared equal, but corresponding to different part of an expression, they should have different id.</li>\n</ol>\n\n<p>So, what should I do to approach this?</p>\n"}, {"tags": ["haskell"], "comments": [{"owner": {"user_type": "does_not_exist", "display_name": "user7650973"}, "reply_to_user": {"reputation": 31243, "user_id": 2751851, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/4ddc0.png?s=128&g=1", "display_name": "duplode", "link": "https://stackoverflow.com/users/2751851/duplode"}, "edited": false, "score": 0, "creation_date": 1529543611, "post_id": 50958979, "comment_id": 88915288, "body": "@duplode what do you mean by missing line breaks?"}, {"owner": {"reputation": 31243, "user_id": 2751851, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/4ddc0.png?s=128&g=1", "display_name": "duplode", "link": "https://stackoverflow.com/users/2751851/duplode"}, "edited": false, "score": 0, "creation_date": 1529543687, "post_id": 50958979, "comment_id": 88915300, "body": "That you might have put the signature and the definition in the same line."}, {"owner": {"user_type": "does_not_exist", "display_name": "user7650973"}, "reply_to_user": {"reputation": 31243, "user_id": 2751851, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/4ddc0.png?s=128&g=1", "display_name": "duplode", "link": "https://stackoverflow.com/users/2751851/duplode"}, "edited": false, "score": 0, "creation_date": 1529544080, "post_id": 50958979, "comment_id": 88915380, "body": "@duplode What do you mean by signature and definition in same line?  See Edit"}, {"owner": {"reputation": 31243, "user_id": 2751851, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/4ddc0.png?s=128&g=1", "display_name": "duplode", "link": "https://stackoverflow.com/users/2751851/duplode"}, "edited": false, "score": 0, "creation_date": 1529544873, "post_id": 50958979, "comment_id": 88915546, "body": "Compare the code you are running with the code you have posted here. Are they exactly the same? (If not, and if comparing them doesn&#39;t show what is wrong, please <a href=\"https://stackoverflow.com/posts/50958979/edit\">edit</a> your question so that the code here is <i>exactly</i> what you are trying to run.)"}, {"owner": {"user_type": "does_not_exist", "display_name": "user7650973"}, "reply_to_user": {"reputation": 31243, "user_id": 2751851, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/4ddc0.png?s=128&g=1", "display_name": "duplode", "link": "https://stackoverflow.com/users/2751851/duplode"}, "edited": false, "score": 0, "creation_date": 1529545181, "post_id": 50958979, "comment_id": 88915607, "body": "@duplode edit above"}, {"owner": {"reputation": 31243, "user_id": 2751851, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/4ddc0.png?s=128&g=1", "display_name": "duplode", "link": "https://stackoverflow.com/users/2751851/duplode"}, "edited": false, "score": 0, "creation_date": 1529547173, "post_id": 50958979, "comment_id": 88915996, "body": "The code you have added still does not produce the error message in your question. (Code-Apprentice&#39;s answer addresses the code as posted here, and not the error.)"}], "answers": [{"comments": [{"owner": {"user_type": "does_not_exist", "display_name": "user7650973"}, "edited": false, "score": 0, "creation_date": 1529546300, "post_id": 50959235, "comment_id": 88915840, "body": "What would I even put for (a -&gt; b) as a function.  Do I make a type defintion then make a new function"}, {"owner": {"user_type": "does_not_exist", "display_name": "user7650973"}, "edited": false, "score": 0, "creation_date": 1529547168, "post_id": 50959235, "comment_id": 88915995, "body": "replaceEmptyStr :: String -&gt; String         replaceEmptyStr = &quot;&quot;   replaceEmpty1 = &quot;-1&quot;       replaceEmptyStr x = map replaceEmpty1 x                                                                                This didn&#39;t work but I don&#39;t know what you mean by using if and else with map"}, {"owner": {"reputation": 69207, "user_id": 1440565, "user_type": "registered", "accept_rate": 59, "profile_image": "https://www.gravatar.com/avatar/ec430cc01ef4cf4ae63ebbe9e8596f72?s=128&d=identicon&r=PG", "display_name": "Code-Apprentice", "link": "https://stackoverflow.com/users/1440565/code-apprentice"}, "edited": false, "score": 0, "creation_date": 1529549116, "post_id": 50959235, "comment_id": 88916355, "body": "@MartinVadakara Okay, let&#39;s back up a minute then. You need a <b>function</b> to use with <code>map</code>. That function takes an element from the input list and returns a single element for the output list. Can you describe in words what this function should do? How does it decide the result for the corresponding element in the output?"}, {"owner": {"user_type": "does_not_exist", "display_name": "user7650973"}, "edited": false, "score": 0, "creation_date": 1529549323, "post_id": 50959235, "comment_id": 88916391, "body": "I know that a function is f * g that sort of from math.  But I&#39;m not sure what exactly I&#39;m supposed to do to get (a -&gt; b) part of the equation"}, {"owner": {"reputation": 69207, "user_id": 1440565, "user_type": "registered", "accept_rate": 59, "profile_image": "https://www.gravatar.com/avatar/ec430cc01ef4cf4ae63ebbe9e8596f72?s=128&d=identicon&r=PG", "display_name": "Code-Apprentice", "link": "https://stackoverflow.com/users/1440565/code-apprentice"}, "edited": false, "score": 0, "creation_date": 1529549860, "post_id": 50959235, "comment_id": 88916499, "body": "@MartinVadakara what is the type of an element of your input list?"}], "tags": [], "owner": {"reputation": 69207, "user_id": 1440565, "user_type": "registered", "accept_rate": 59, "profile_image": "https://www.gravatar.com/avatar/ec430cc01ef4cf4ae63ebbe9e8596f72?s=128&d=identicon&r=PG", "display_name": "Code-Apprentice", "link": "https://stackoverflow.com/users/1440565/code-apprentice"}, "is_accepted": false, "score": 1, "last_activity_date": 1529824097, "last_edit_date": 1529824097, "creation_date": 1529545628, "answer_id": 50959235, "question_id": 50958979, "link": "https://stackoverflow.com/questions/50958979/how-do-you-to-use-an-input-with-map-and-filter-in-haskell/50959235#50959235", "title": "How do you to use an input with map and filter in haskell", "body": "<p>In GHCi, you can use the <code>:t</code> command to get the type of an object. Let's try this for <code>map</code>:</p>\n\n<pre><code>Prelude&gt; :t map\nmap :: (a -&gt; b) -&gt; [a] -&gt; [b]\n</code></pre>\n\n<p>This tells us that <code>map</code> takes two parameters. The first has type <code>(a -&gt; b)</code> which  is a function. The second has type <code>[a]</code> which is a list. The return value has type <code>[b]</code> which is also a list. The letters show us that the function given as the first parameter must take an argument with the same type as the elements of the list given as the second parameter. The return type of this function is the same as the elements of the list returned by <code>map</code>.</p>\n\n<p>Now with that information, we can see why <code>map [\"-1\"][\"\"]</code> is incorrect. This is trying to pass two lists to <code>map</code>. So how do we fix this?</p>\n\n<p>Well, we need a function that takes an element from the input list and returns an element of the output list. So given a <strong>single</strong> element of the input, how do you create the correct corresponding element in the output? I leave this as an exercise to the reader. (Hint: You can do it with an <code>if...else</code> expression.)</p>\n\n<p>Once you figure out this function, you pass the input list from <code>replaceEmptyString</code> directly as the second parameter of <code>map</code>.</p>\n\n<p>You should use <code>:t filter</code> to see what the signature for this function is. Then you can break down the solution in the same way as we did here for <code>map</code>.</p>\n"}, {"comments": [{"owner": {"user_type": "does_not_exist", "display_name": "user7650973"}, "edited": false, "score": 0, "creation_date": 1529551096, "post_id": 50959797, "comment_id": 88916766, "body": "I want to remove empty strings"}, {"owner": {"reputation": 4755, "user_id": 400277, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/ea12da4fb5d06d2e5da1c53b272f5ccd?s=128&d=identicon&r=PG", "display_name": "Nowhere man", "link": "https://stackoverflow.com/users/400277/nowhere-man"}, "edited": false, "score": 0, "creation_date": 1529552230, "post_id": 50959797, "comment_id": 88916973, "body": "It&#39;s obviously an assignment, so I won&#39;t just do your homework for you."}, {"owner": {"user_type": "does_not_exist", "display_name": "user7650973"}, "edited": false, "score": 0, "creation_date": 1529593717, "post_id": 50959797, "comment_id": 88940193, "body": "Thank for your answer.  It was for an assignment which I should have clarified.  I was kind of freaking out yesterday."}], "tags": [], "owner": {"reputation": 4755, "user_id": 400277, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/ea12da4fb5d06d2e5da1c53b272f5ccd?s=128&d=identicon&r=PG", "display_name": "Nowhere man", "link": "https://stackoverflow.com/users/400277/nowhere-man"}, "is_accepted": false, "score": 0, "last_activity_date": 1529551816, "last_edit_date": 1529551816, "creation_date": 1529550473, "answer_id": 50959797, "question_id": 50958979, "link": "https://stackoverflow.com/questions/50958979/how-do-you-to-use-an-input-with-map-and-filter-in-haskell/50959797#50959797", "title": "How do you to use an input with map and filter in haskell", "body": "<h1>Currying</h1>\n\n<p>First off, if you want to use currying to write in a pointfree style (which is a good thing, if you ask me), you must remove the argument after the function name</p>\n\n<p>Instead of writing</p>\n\n<pre><code>sum numbers = foldl1 (+) numbers\n</code></pre>\n\n<p>you would write</p>\n\n<pre><code>sum = foldl1 (+)\n</code></pre>\n\n<p>But not</p>\n\n<pre><code>sum numbers = foldl1 (+)\n</code></pre>\n\n<h1>Function arguments</h1>\n\n<p>The first arguments to <code>map</code> and <code>filter</code> need to be functions. The elements of the list that will be the second argument to them will be applied to those functions.</p>\n\n<p>Either you define a function somewhere else and pass it to <code>map</code>/<code>filter</code>:</p>\n\n<pre><code>greaterThanTwo x = 2 &lt; x\nremoveSmallNumbers = filter greaterThanTwo\n</code></pre>\n\n<p>or you use currying to create an anonymous function in-place:</p>\n\n<pre><code>removeSmallNumbers = filter ((&lt;) 2)\n</code></pre>\n\n<p><code>(\" \")</code> isn't a function that returns False when passed an empty string, it is just a string containing a single space.</p>\n\n<p>(BTW, do you want to remove empty strings or to remove strings containing a single space? Your example at the beginning points to the former\u2026).</p>\n"}], "owner": {"user_type": "does_not_exist", "display_name": "user7650973"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 164, "favorite_count": 0, "answer_count": 2, "score": -2, "last_activity_date": 1529824097, "creation_date": 1529543014, "last_edit_date": 1529602440, "question_id": 50958979, "link": "https://stackoverflow.com/questions/50958979/how-do-you-to-use-an-input-with-map-and-filter-in-haskell", "title": "How do you to use an input with map and filter in haskell", "body": "<p>I have two functions replaceEmptyStr and  nonEmptyStr.</p>\n\n<p>For replaceEmptyStr I want to use a map to replace blank strings in my input with -1s</p>\n\n<pre><code>[\"2\", \"\", \"4\", \"\"] -&gt; [\"2\", \"-1\", \"4\", \"-1\"]\n</code></pre>\n\n<p>For nonEmptyStr I want to filter out the blank spaces in my input</p>\n\n<pre><code>[\"2\", \"\", \"3\"] -&gt; [\"2\", \"3\"]\n</code></pre>\n\n<p>This is my code for both functions </p>\n\n<pre><code>replaceEmptyStr :: String -&gt; String\nreplaceEmptyStr x = map [\"-1\"][\"\"]\n\nnonEmptyStr :: String -&gt; Bool\nnonEmptyStr x =  filter (\" \") nonEmptyStr x \n</code></pre>\n\n\n\n<pre><code>   assignment3.hs:32:16:\n    Illegal type signature: \u2018String -&gt; Bool nonEmptyStr x\u2019\n      Perhaps you intended to use ScopedTypeVariables\n    In a pattern type-signature\n\nassignment3.hs:34:44: Not in scope: \u2018x\u2019\n\nassignment3.hs:37:20:\n    Illegal type signature: \u2018String -&gt; String replaceEmptyStr x\u2019\n      Perhaps you intended to use ScopedTypeVariables\n    In a pattern type-signature\nFailed, modules loaded: none.\n</code></pre>\n\n<p>I don't understand why this isn't working but in other examples online through the GCHI people were able to call it without the input.  Why doesn't this work with the input involved?</p>\n\n<p>Edit: </p>\n\n<p>Fixed the error with Not in Scope \"x\" for nonEmptyStr by removing the x and the call to nonEmptyStr but it still says  </p>\n\n<p>assignment3.hs:32:16:</p>\n\n<p>Illegal type signature: \u2018String -> Bool nonEmptyStr x\u2019</p>\n\n<p>Perhaps you intended to use ScopedTypeVariables</p>\n\n<p>In a pattern type-signature</p>\n\n<p>assignment3.hs:36:20:</p>\n\n<p>Illegal type signature: \u2018String -> String replaceEmptyStr x\u2019</p>\n\n<p>Perhaps you intended to use ScopedTypeVariables</p>\n\n<p>In a pattern type-signature</p>\n\n<p>Edit :</p>\n\n<pre><code>nonEmptyStr :: String -&gt; Bool\n\nnonEmptyStr x =  filter (\" \") \n</code></pre>\n\n<p>-- 6</p>\n\n<pre><code>replaceEmptyStr :: String -&gt; String\n\nreplaceEmptyStr x = map [\"-1\"][\"\"]\n</code></pre>\n"}]