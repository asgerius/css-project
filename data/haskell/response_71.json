[{"tags": ["haskell"], "answers": [{"comments": [{"owner": {"reputation": 2831, "user_id": 183792, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/9ddcfbc6c31012fd25384f6301363347?s=128&d=identicon&r=PG&f=1", "display_name": "Michael", "link": "https://stackoverflow.com/users/183792/michael"}, "edited": false, "score": 0, "creation_date": 1463662004, "post_id": 37311050, "comment_id": 62166560, "body": "I was wondering about that and moved the /test/Bench directory to /Bench and made it a cabal bench. These are the results <a href=\"http://lpaste.net/163848\" rel=\"nofollow noreferrer\">lpaste.net/163848</a> The first figure is Data.List, the second Data.List.Stream.  GHC doesn&#39;t use any of this, it just improved its own build/foldr machinery, I think."}, {"owner": {"reputation": 2831, "user_id": 183792, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/9ddcfbc6c31012fd25384f6301363347?s=128&d=identicon&r=PG&f=1", "display_name": "Michael", "link": "https://stackoverflow.com/users/183792/michael"}, "edited": false, "score": 0, "creation_date": 1463664113, "post_id": 37311050, "comment_id": 62168228, "body": "I put your emendation plus the cabalized bench up here git@gitlab.com:michaelt1/stream-fusion.git for what it&#39;s worth."}], "tags": [], "owner": {"reputation": 14781, "user_id": 630160, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/4445f21326af525a8ad19af7e3ae41a8?s=128&d=identicon&r=PG", "display_name": "epsilonhalbe", "link": "https://stackoverflow.com/users/630160/epsilonhalbe"}, "is_accepted": false, "score": 2, "last_activity_date": 1463610112, "creation_date": 1463610112, "answer_id": 37311050, "question_id": 37310232, "link": "https://stackoverflow.com/questions/37310232/how-to-resolve-issue-with-building-stream-fusion/37311050#37311050", "title": "How to resolve issue with building stream-fusion", "body": "<p>you need to change the following imports in <code>Control.Monad.Stream</code> (line 80)</p>\n\n<pre><code>- import GHC.Base\n+ import           GHC.Base hiding ( MonadPlus\n+                                 , (=&lt;&lt;)\n+                                 , ap\n+                                 , join\n+                                 , liftM\n+                                 , liftM2\n+                                 , liftM3\n+                                 , liftM4\n+                                 , liftM5\n+                                 , mapM\n+                                 , mplus\n+                                 , mzero\n+                                 , sequence\n+                                 , when\n+                                 )\n</code></pre>\n\n<p>Then it compiles - I don't know wether it will work as expected, this library is quite old (3 years as of now) and the <em>tested-with</em> section in the cabal file says 7.6.1. - I recommend using benchmarks to ensure that the benefits you hope to get from this library are real. I would guess that a lot of the ideas of this library have made it into base by now.</p>\n\n<p>Could you leave a comment after you have done these benchmarks I would really be interested in them.</p>\n"}], "owner": {"reputation": 9225, "user_id": 3248346, "user_type": "registered", "accept_rate": 68, "profile_image": "https://www.gravatar.com/avatar/377f7423a286949201e0aa8cb2257fcc?s=128&d=identicon&r=PG&f=1", "display_name": "M.K.", "link": "https://stackoverflow.com/users/3248346/m-k"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 65, "favorite_count": 0, "answer_count": 1, "score": 1, "last_activity_date": 1463610112, "creation_date": 1463606166, "question_id": 37310232, "link": "https://stackoverflow.com/questions/37310232/how-to-resolve-issue-with-building-stream-fusion", "title": "How to resolve issue with building stream-fusion", "body": "<p>I'm trying to bring in the stream-fusion library into my project. I am using Stack (LTS 5.16). I added the stream-fusion-0.1.2.5 version to my project's cabal file and also as an extra-dependency in my stack.yaml.</p>\n\n<p>However, when I try to build the project I now get the following:</p>\n\n<pre><code>stream-fusion-0.1.2.5: configure\nstream-fusion-0.1.2.5: build\n\n--  While building package stream-fusion-0.1.2.5 using:\n      /Users/me/.stack/setup-exe-cache/x86_64-osx/setup-Simple-Cabal-1.22.5.0-ghc-7.10.3 --builddir=.stack-work/dist/x86_64-osx/Cabal-1.22.5.0 build --ghc-options \" -ddump-hi -ddump-to-file\"\n    Process exited with code: ExitFailure 1\n    Logs have been written to: /Users/me/Haskell/hqfl/.stack-work/logs/stream-fusion-0.1.2.5.log\n\n    Configuring stream-fusion-0.1.2.5...\n    Building stream-fusion-0.1.2.5...\n    Preprocessing library stream-fusion-0.1.2.5...\n    [1 of 3] Compiling Data.Stream      ( Data/Stream.hs, .stack-work/dist/x86_64-osx/Cabal-1.22.5.0/build/Data/Stream.o )\n\n    /private/var/folders/q_/qbq9bct96jj8p_c9kqbhmt840000gn/T/stack6002/stream-fusion-0.1.2.5/Data/Stream.hs:591:5: Warning:\n        Pattern match(es) are non-exhaustive\n        In an equation for \u2018next\u2019:\n            Patterns not matched: (_ :!: (Just (L _))) :!: S2\n    [2 of 3] Compiling Data.List.Stream ( Data/List/Stream.hs, .stack-work/dist/x86_64-osx/Cabal-1.22.5.0/build/Data/List/Stream.o )\n\n    /private/var/folders/q_/qbq9bct96jj8p_c9kqbhmt840000gn/T/stack6002/stream-fusion-0.1.2.5/Data/List/Stream.hs:235:1: Warning:\n        The import of \u2018seq, Int\u2019 from module \u2018Prelude\u2019 is redundant\n\n    /private/var/folders/q_/qbq9bct96jj8p_c9kqbhmt840000gn/T/stack6002/stream-fusion-0.1.2.5/Data/List/Stream.hs:1703:10: Warning: Tab character\n\n    /private/var/folders/q_/qbq9bct96jj8p_c9kqbhmt840000gn/T/stack6002/stream-fusion-0.1.2.5/Data/List/Stream.hs:2496:1: Warning:\n        Rule \"genericSplitAt -&gt; fusible\" may never fire\n          because \u2018genericSplitAt\u2019 might inline first\n        Probable fix: add an INLINE[n] or NOINLINE[n] pragma on \u2018genericSplitAt\u2019\n\n    /private/var/folders/q_/qbq9bct96jj8p_c9kqbhmt840000gn/T/stack6002/stream-fusion-0.1.2.5/Data/List/Stream.hs:2504:1: Warning:\n        Rule \"genericSplitAt -&gt; splitAt/Int\" may never fire\n          because \u2018genericSplitAt\u2019 might inline first\n        Probable fix: add an INLINE[n] or NOINLINE[n] pragma on \u2018genericSplitAt\u2019\n\n    /private/var/folders/q_/qbq9bct96jj8p_c9kqbhmt840000gn/T/stack6002/stream-fusion-0.1.2.5/Data/List/Stream.hs:2516:1: Warning:\n        Rule \"genericReplicate -&gt; replicate/Int\" may never fire\n          because \u2018genericReplicate\u2019 might inline first\n        Probable fix: add an INLINE[n] or NOINLINE[n] pragma on \u2018genericReplicate\u2019\n    [3 of 3] Compiling Control.Monad.Stream ( Control/Monad/Stream.hs, .stack-work/dist/x86_64-osx/Cabal-1.22.5.0/build/Control/Monad/Stream.o )\n\n    /private/var/folders/q_/qbq9bct96jj8p_c9kqbhmt840000gn/T/stack6002/stream-fusion-0.1.2.5/Control/Monad/Stream.hs:136:10:\n        Ambiguous occurrence \u2018MonadPlus\u2019\n        It could refer to either \u2018Control.Monad.Stream.MonadPlus\u2019,\n                                 defined at Control/Monad/Stream.hs:124:1\n                              or \u2018GHC.Base.MonadPlus\u2019,\n                                 imported from \u2018GHC.Base\u2019 at Control/Monad/Stream.hs:80:1-15\n\n    /private/var/folders/q_/qbq9bct96jj8p_c9kqbhmt840000gn/T/stack6002/stream-fusion-0.1.2.5/Control/Monad/Stream.hs:140:10:\n        Ambiguous occurrence \u2018MonadPlus\u2019\n        It could refer to either \u2018Control.Monad.Stream.MonadPlus\u2019,\n                                 defined at Control/Monad/Stream.hs:124:1\n                              or \u2018GHC.Base.MonadPlus\u2019,\n                                 imported from \u2018GHC.Base\u2019 at Control/Monad/Stream.hs:80:1-15\n</code></pre>\n\n<p>How can I resolve the ambiguity here?</p>\n"}, {"tags": ["regex", "function", "haskell", "sqlite"], "answers": [{"comments": [{"owner": {"reputation": 729, "user_id": 2181977, "user_type": "registered", "accept_rate": 86, "profile_image": "https://www.gravatar.com/avatar/0b84fe9137990458c9a91dcadd10579c?s=128&d=identicon&r=PG", "display_name": "Fredrik Karlsson", "link": "https://stackoverflow.com/users/2181977/fredrik-karlsson"}, "edited": false, "score": 0, "creation_date": 1463644432, "post_id": 37310712, "comment_id": 62154015, "body": "Excellent! Very helpful! Thanks!"}], "tags": [], "owner": {"reputation": 49959, "user_id": 866915, "user_type": "registered", "accept_rate": 70, "profile_image": "https://www.gravatar.com/avatar/09242131d6e17cbbe31e8547514da6e5?s=128&d=identicon&r=PG", "display_name": "ErikR", "link": "https://stackoverflow.com/users/866915/erikr"}, "is_accepted": true, "score": 1, "last_activity_date": 1463608348, "creation_date": 1463608348, "answer_id": 37310712, "question_id": 37309404, "link": "https://stackoverflow.com/questions/37309404/inserting-a-regexp-sqlite-function-in-haskell-database-sqlite3-direct-sqlite/37310712#37310712", "title": "Inserting a regexp() SQLite function in Haskell (Database.SQLite3,&quot;direct-sqlite&quot;)", "body": "<p>There is an example in the github repo:</p>\n\n<p><a href=\"https://github.com/IreneKnapp/direct-sqlite/blob/master/test/Main.hs#L743-757\" rel=\"nofollow\">https://github.com/IreneKnapp/direct-sqlite/blob/master/test/Main.hs#L743-757</a></p>\n\n<pre><code>-- implements repeat(n,str)\nrepeatString ctx args = do\n    n &lt;- funcArgInt64 args 0\n    s &lt;- funcArgText args 1\n    funcResultText ctx $ T.concat $ replicate (fromIntegral n) s\n</code></pre>\n\n<p>You use the functions <code>funcArg...</code> to get the arguments and functions like <code>funcResult...</code> to return them.</p>\n\n<p>Links to the docs:</p>\n\n<ul>\n<li><a href=\"https://hackage.haskell.org/package/direct-sqlite-2.3.17/docs/Database-SQLite3-Direct.html#g:10\" rel=\"nofollow\">Extract Function Arguments</a></li>\n<li><a href=\"https://hackage.haskell.org/package/direct-sqlite-2.3.17/docs/Database-SQLite3-Direct.html#g:11\" rel=\"nofollow\">Set the Result of a Function</a></li>\n</ul>\n"}], "owner": {"reputation": 729, "user_id": 2181977, "user_type": "registered", "accept_rate": 86, "profile_image": "https://www.gravatar.com/avatar/0b84fe9137990458c9a91dcadd10579c?s=128&d=identicon&r=PG", "display_name": "Fredrik Karlsson", "link": "https://stackoverflow.com/users/2181977/fredrik-karlsson"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 93, "favorite_count": 0, "accepted_answer_id": 37310712, "answer_count": 1, "score": 2, "last_activity_date": 1463608348, "creation_date": 1463602897, "last_edit_date": 1463604129, "question_id": 37309404, "link": "https://stackoverflow.com/questions/37309404/inserting-a-regexp-sqlite-function-in-haskell-database-sqlite3-direct-sqlite", "title": "Inserting a regexp() SQLite function in Haskell (Database.SQLite3,&quot;direct-sqlite&quot;)", "body": "<p>I need to create an implementation of the <code>regex()</code> SQLite function in a Haskell database connection so that I can use the \"REGEX\" operator in queries.</p>\n\n<p>Now, I have an implementation of a regex matching function that uses PCRE:</p>\n\n<pre><code>import Text.Regex.Base.RegexLike\nimport qualified Text.Regex.PCRE.ByteString as PCRE\nimport qualified Data.ByteString as BS\n\nsqlRegex :: BS.ByteString -&gt; BS.ByteString -&gt; IO Bool\nsqlRegex reg b = do\n    reC &lt;- pcreCompile reg\n    re &lt;- case reC of\n        (Right r) -&gt; return r\n    reE &lt;- PCRE.execute re b\n    case reE of\n        (Right (Just _)) -&gt; return True\n        (Right (Nothing)) -&gt; return False\n    where pcreCompile = PCRE.compile defaultCompOpt defaultExecOpt\n</code></pre>\n\n<p>which works well (please excuse the very explicit calls)</p>\n\n<pre><code>&gt; sqlRegex (Data.ByteString.Char8.pack \".*\") (Data.ByteString.Char8.pack \"hello\")\nTrue\n&gt; sqlRegex (Data.ByteString.Char8.pack \"H.*\") (Data.ByteString.Char8.pack \"hello\")\nFalse\n</code></pre>\n\n<p>Now, how do I create the SQLite function??</p>\n\n<pre><code>conn &lt;- open $ pack dbFile\ncreateFunction conn \"regexp\" (Just 2) True [..... and what should go here?]\n</code></pre>\n\n<p>The <a href=\"http://hackage.haskell.org/package/direct-sqlite-2.3.17/docs/Database-SQLite3.html#createFunction\" rel=\"nofollow noreferrer\">docs</a> for <code>createFunction</code> \n<a href=\"https://i.stack.imgur.com/0q87Z.png\" rel=\"nofollow noreferrer\"><img src=\"https://i.stack.imgur.com/0q87Z.png\" alt=\"createFunction API docs\"></a>\nhelps me as far as making me understand that I need to make the function take a context and some arguments, but the refs for those data does not help me at all!\n<a href=\"https://i.stack.imgur.com/ETSb7.png\" rel=\"nofollow noreferrer\"><img src=\"https://i.stack.imgur.com/ETSb7.png\" alt=\"FuncContext and FuncArgs API docs\"></a></p>\n\n<p>How should make my function take a <code>FuncContext</code> and <code>FuncArgs</code>??</p>\n"}, {"tags": ["haskell"], "answers": [{"comments": [{"owner": {"reputation": 4071, "user_id": 3806046, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/5fedf50ce7cd2659bca902e9a2969158?s=128&d=identicon&r=PG&f=1", "display_name": "jkeuhlen", "link": "https://stackoverflow.com/users/3806046/jkeuhlen"}, "edited": false, "score": 0, "creation_date": 1463584948, "post_id": 37303807, "comment_id": 62129578, "body": "Thanks for the help! I&#39;m not sure what you mean by &quot;If there are separate constructors for the different statuses, then you should use those.&quot; I&#39;m fairly new to haskell and still learning. Am I looking for an upper-case type class (say Ok200 instead of ok200)? As far as I can tell, what i&#39;m using are the constructors for the various <code>Status</code> objects."}, {"owner": {"reputation": 44013, "user_id": 1477667, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/trgKM.jpg?s=128&g=1", "display_name": "dfeuer", "link": "https://stackoverflow.com/users/1477667/dfeuer"}, "reply_to_user": {"reputation": 4071, "user_id": 3806046, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/5fedf50ce7cd2659bca902e9a2969158?s=128&d=identicon&r=PG&f=1", "display_name": "jkeuhlen", "link": "https://stackoverflow.com/users/3806046/jkeuhlen"}, "edited": false, "score": 0, "creation_date": 1463585079, "post_id": 37303807, "comment_id": 62129662, "body": "Type classes have nothing to do with this. In Haskell, constructors always start with an upper case letter, while variables always start with a lower case one. This is true for both values and types. Operator syntax is a bit different, but don&#39;t worry about its details yet. Yes, there may be a constructor with a name like <code>Ok200</code>. It&#39;s also possible that these statuses are just numbers you need to compare with <code>==</code>. I&#39;m not familiar with that particular library."}, {"owner": {"reputation": 4071, "user_id": 3806046, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/5fedf50ce7cd2659bca902e9a2969158?s=128&d=identicon&r=PG&f=1", "display_name": "jkeuhlen", "link": "https://stackoverflow.com/users/3806046/jkeuhlen"}, "edited": false, "score": 2, "creation_date": 1463585336, "post_id": 37303807, "comment_id": 62129860, "body": "Ahh okay so if I wanted to continue with the case match, I would do something like matching on <code>Status { statusCode = 200}</code> then? I think guards are better for what I&#39;m doing like you suggested but I&#39;m just trying to understand the whole picture better."}, {"owner": {"reputation": 44013, "user_id": 1477667, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/trgKM.jpg?s=128&g=1", "display_name": "dfeuer", "link": "https://stackoverflow.com/users/1477667/dfeuer"}, "reply_to_user": {"reputation": 4071, "user_id": 3806046, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/5fedf50ce7cd2659bca902e9a2969158?s=128&d=identicon&r=PG&f=1", "display_name": "jkeuhlen", "link": "https://stackoverflow.com/users/3806046/jkeuhlen"}, "edited": false, "score": 1, "creation_date": 1463594146, "post_id": 37303807, "comment_id": 62135207, "body": "@jkeuhlen, yes, or if you want to match on many you can pull out the number and case match on it. However, having now looked at the module, I&#39;m quite convinced that you should use guards instead."}], "tags": [], "owner": {"reputation": 44013, "user_id": 1477667, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/trgKM.jpg?s=128&g=1", "display_name": "dfeuer", "link": "https://stackoverflow.com/users/1477667/dfeuer"}, "is_accepted": true, "score": 6, "last_activity_date": 1463584693, "creation_date": 1463584693, "answer_id": 37303807, "question_id": 37303254, "link": "https://stackoverflow.com/questions/37303254/why-are-my-http-status-types-overlapping/37303807#37303807", "title": "Why are my HTTP status types overlapping?", "body": "<p>The problem is that <code>ok203</code> and <code>status203</code> are <em>lower case</em>. So they're interpreted in patterns as variables to bind rather than constructors to match. If there are separate constructors for the different statuses, then you should use those. Otherwise, you should use guards and <code>==</code> to inspect statuses rather than trying to match on their values. This could look like</p>\n\n<pre><code>case responseStatus r of\n  stat\n    | stat == ok203 -&gt; ...\n    | stat == ... -&gt; ...\n    | otherwise -&gt; ...\n</code></pre>\n"}], "owner": {"reputation": 4071, "user_id": 3806046, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/5fedf50ce7cd2659bca902e9a2969158?s=128&d=identicon&r=PG&f=1", "display_name": "jkeuhlen", "link": "https://stackoverflow.com/users/3806046/jkeuhlen"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 87, "favorite_count": 0, "accepted_answer_id": 37303807, "answer_count": 1, "score": 2, "last_activity_date": 1463584693, "creation_date": 1463583322, "question_id": 37303254, "link": "https://stackoverflow.com/questions/37303254/why-are-my-http-status-types-overlapping", "title": "Why are my HTTP status types overlapping?", "body": "<p>I'm working with some HTTP code and getting a compiler warning when I build (using <code>stack build</code>) that warns of overlapping pattern matches in my cases that handle different HTTP responses. I'm using the packages </p>\n\n<pre><code> import Network.HTTP.Types.Status (ok200, status203, Status)\n import Network.HTTP.Conduit\n import Network.HTTP.Types.Header\n</code></pre>\n\n<p>The code in question is:</p>\n\n<pre><code> ... -- setup stuff for other functions.\n -- getHttpResponse just uses \"httpLbs req mngr\" with some additional error wrapping\n resp &lt;- liftIO $ getHttpResponse mngr req\n    case resp of\n      Nothing -&gt; ExceptT $ return $ Left $ create $ \"could not get a response from \" &lt;&gt; uri\n      Just r -&gt; case responseStatus r of\n              ok200 -&gt; do \n                  case decode (responseBody r) of\n                    Nothing -&gt; throwIOError $ \"could not decode object from \" &lt;&gt; uri\n                    Just xx -&gt; return $ Right (xx, responseStatus r)\n              status203 -&gt; do \n                  case decode (responseBody r) of\n                    Nothing -&gt; throwIOError $ \"could not decode object from \" &lt;&gt; uri \n                    Just xx -&gt; return $ Left (xx, responseStatus r)   \n              _ -&gt; (throwIOError $ \"non 200 server response \"\n                                  &lt;&gt; T.pack (show $ responseStatus r)\n                                  &lt;&gt; \" from \" &lt;&gt; uri)\n</code></pre>\n\n<p>The warning that GHC gives me is:</p>\n\n<blockquote>\n<pre><code>Pattern match(es) are overlapped\nIn a case alternative:\n    status203 -&gt; ...\n    _ -&gt; ...\n</code></pre>\n</blockquote>\n\n<p>Both my 200 and 203 responses seem to be following the first route (returning a <code>Right</code>) and matching to <code>ok200</code>. To add to my confusion, I originally had a typo in my code where I had put <code>ok203</code> in place of <code>status203</code>. I'm not sure why, but that code still compiled and simply gave a similar warning message:</p>\n\n<blockquote>\n<pre><code>Pattern match(es) are overlapped\nIn a case alternative:\n    ok203-&gt; ...\n    _ -&gt; ...\n</code></pre>\n</blockquote>\n\n<p>despite ok203 not being defined in my code base or in any of the packages I'm using (at least that I could find). </p>\n\n<p>Could anyone explain what is happening here? Why are these patterns overlapping? And, as a bonus, why did my code even compile with <code>ok203</code>?</p>\n"}, {"tags": ["haskell", "template-haskell"], "answers": [{"comments": [{"owner": {"reputation": 2293, "user_id": 8071, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/31db2d66a0dbd7ad11c0946051eebb10?s=128&d=identicon&r=PG", "display_name": "Erik Hesselink", "link": "https://stackoverflow.com/users/8071/erik-hesselink"}, "edited": false, "score": 0, "creation_date": 1463680444, "post_id": 37324343, "comment_id": 62179895, "body": "Thanks, that works great! The two problems you mention might not actually be problematic in my case, since: 1) The identifiers are generated by TH as well, from the same inputs, and 2) The definitions are exported. Thinking about 1 some more, it occurs to me that I might merge the two pieces of TH and get rid of the problem altogether though..."}], "tags": [], "owner": {"reputation": 14485, "user_id": 190376, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/cd8280c5e1491b8cf55760750ed97dec?s=128&d=identicon&r=PG", "display_name": "Reid Barton", "link": "https://stackoverflow.com/users/190376/reid-barton"}, "is_accepted": true, "score": 1, "last_activity_date": 1463663699, "creation_date": 1463663699, "answer_id": 37324343, "question_id": 37302342, "link": "https://stackoverflow.com/questions/37302342/generate-dynamic-name-in-template-haskell-using-the-current-scope/37324343#37324343", "title": "Generate dynamic Name in template haskell using the current scope", "body": "<p>I imagine you can do this by extracting the package name from a particular <code>Name</code> <code>'f0</code>, then passing it to <code>mkNameG_v</code>. This might not be a good idea for two reasons:</p>\n\n<ul>\n<li><p>Writing <code>'f</code> checks that the identifier <code>f</code> really is in scope, whereas you can pass anything to <code>mkNameG</code> and not get an error until you try to use the <code>Name</code> in some way. You'll have to ensure in some other way that you only build <code>Name</code>s for identifiers that actually exist, or <code>recover</code> from the error when you use the <code>Name</code> (unless you just want to let GHC fail with the error you saw).</p></li>\n<li><p>Writing <code>'f</code> also counts as a use of <code>f</code>. Unused unexported definitions are simply discarded, so you will not be able to refer to them with <code>mkNameG</code>. You will have to find some other way to ensure that your <code>\"f\" ++ show n</code> identifiers are used.</p></li>\n</ul>\n"}], "owner": {"reputation": 2293, "user_id": 8071, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/31db2d66a0dbd7ad11c0946051eebb10?s=128&d=identicon&r=PG", "display_name": "Erik Hesselink", "link": "https://stackoverflow.com/users/8071/erik-hesselink"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 163, "favorite_count": 0, "accepted_answer_id": 37324343, "answer_count": 1, "score": 6, "last_activity_date": 1463663699, "creation_date": 1463581072, "question_id": 37302342, "link": "https://stackoverflow.com/questions/37302342/generate-dynamic-name-in-template-haskell-using-the-current-scope", "title": "Generate dynamic Name in template haskell using the current scope", "body": "<p>I'm writing a template haskell splice, and am struggling to generate the right kind of <code>Name</code>s. If I want to generate a known name (say, a function <code>f</code>), I can use <code>'f</code>. This requires <code>f</code> to be in scope where I'm defining the splice, not where it's used, which is exactly what I want.</p>\n\n<p>Now I want the same thing, but for a dynamic name. For example, say my splice takes an <code>n :: Int</code> as an argument. I want to generate <code>\"f\" ++ show n</code> as a <code>Name</code>, looked up at the splice definition site, not the use site.</p>\n\n<p>I've tried a couple of options: <code>mkName</code> and <code>lookupValueName</code> both require the name to be in scope at the use site. The single quote syntax needs a literal name, not a dynamic one.</p>\n\n<p>Finally I started experimenting with <code>mkNameG</code>. Since the functions come from the same package as I'm using them in, I started with the package name, but that gave errors <code>Can't find interface-file declaration for variable the-package-name:Some.Module.f0</code>. After some source reading I found places where the package name <code>\"main\"</code> was used. That seems to work in GHCi, but when compiling I still get the same error.</p>\n\n<p>Is there any way to do this? I could enumerate all the options of course, but I'd like to avoid that, since the whole point of this exercise is to make the code more dynamic.</p>\n"}, {"tags": ["haskell", "cryptography", "libraries"], "comments": [{"owner": {"reputation": 58084, "user_id": 1816580, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/f30e6b41f1e2bd48b058e8e72c1f0f57?s=128&d=identicon&r=PG", "display_name": "Artjom B.", "link": "https://stackoverflow.com/users/1816580/artjom-b"}, "edited": false, "score": 0, "creation_date": 1463593890, "post_id": 37302240, "comment_id": 62135082, "body": "Without any criteria for assessment, this question is utterly useless. If the criteria is activity, then you&#39;ve answered the question yourself."}], "answers": [{"comments": [{"owner": {"reputation": 1979, "user_id": 1757268, "user_type": "registered", "accept_rate": 88, "profile_image": "https://www.gravatar.com/avatar/1001c187fb680a13c262b47d9e7aa9bd?s=128&d=identicon&r=PG", "display_name": "NatureShade", "link": "https://stackoverflow.com/users/1757268/natureshade"}, "edited": false, "score": 0, "creation_date": 1463583102, "post_id": 37302726, "comment_id": 62128154, "body": "That was what I was thinking, however cryptonite doesn&#39;t seem to have any production-ready versions."}, {"owner": {"reputation": 62421, "user_id": 216164, "user_type": "registered", "accept_rate": 89, "profile_image": "https://www.gravatar.com/avatar/786f224adbe0784cdf7d0f15476061fe?s=128&d=identicon&r=PG", "display_name": "Thomas M. DuBuisson", "link": "https://stackoverflow.com/users/216164/thomas-m-dubuisson"}, "reply_to_user": {"reputation": 1979, "user_id": 1757268, "user_type": "registered", "accept_rate": 88, "profile_image": "https://www.gravatar.com/avatar/1001c187fb680a13c262b47d9e7aa9bd?s=128&d=identicon&r=PG", "display_name": "NatureShade", "link": "https://stackoverflow.com/users/1757268/natureshade"}, "edited": false, "score": 1, "creation_date": 1463612674, "post_id": 37302726, "comment_id": 62143806, "body": "@NatureShade Define &quot;production-ready&quot;"}], "tags": [], "owner": {"reputation": 30377, "user_id": 369198, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/71596bb1ca3ba3aa4400c3f407baec9f?s=128&d=identicon&r=PG", "display_name": "Michael Snoyman", "link": "https://stackoverflow.com/users/369198/michael-snoyman"}, "is_accepted": true, "score": 2, "last_activity_date": 1463582082, "creation_date": 1463582082, "answer_id": 37302726, "question_id": 37302240, "link": "https://stackoverflow.com/questions/37302240/which-library-to-use-for-cryptographic-functions/37302726#37302726", "title": "Which library to use for cryptographic functions", "body": "<p>I'd definitely recommend cryptonite. It's a newer library consolidating a number of older libraries, and the ecosystem hasn't moved over yet.</p>\n"}], "owner": {"reputation": 1979, "user_id": 1757268, "user_type": "registered", "accept_rate": 88, "profile_image": "https://www.gravatar.com/avatar/1001c187fb680a13c262b47d9e7aa9bd?s=128&d=identicon&r=PG", "display_name": "NatureShade", "link": "https://stackoverflow.com/users/1757268/natureshade"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 109, "favorite_count": 0, "closed_date": 1463636813, "accepted_answer_id": 37302726, "answer_count": 1, "score": 1, "last_activity_date": 1463582082, "creation_date": 1463580830, "question_id": 37302240, "link": "https://stackoverflow.com/questions/37302240/which-library-to-use-for-cryptographic-functions", "closed_reason": "Opinion-based", "title": "Which library to use for cryptographic functions", "body": "<blockquote>\n  <p>Note: this is not asking for a personal viewpoint on what is the better library, but rather what is the \"safest\" library or what is a good indication of a \"safe\" library.</p>\n</blockquote>\n\n<p>I was looking for a Haskell library with AES256 encryption/decryption capabilities and found quite a few.</p>\n\n<ul>\n<li><a href=\"https://hackage.haskell.org/package/cryptocipher\" rel=\"nofollow\">cryptocipher</a></li>\n<li><a href=\"https://hackage.haskell.org/package/cryptonite\" rel=\"nofollow\">cryptonite</a></li>\n<li><a href=\"http://hackage.haskell.org/package/AES\" rel=\"nofollow\">AES</a></li>\n</ul>\n\n<p>The problem is that most of these seem abandoned, except cryptonite who again seems like the least popular library (the one with the least amount of downloads).</p>\n\n<p>I was wondering if using a library that seems outdated could be a problem (should I worry about possible security flaws, etc.) or if I should simply go with the one that seems most popular? </p>\n"}, {"tags": ["haskell", "vector"], "answers": [{"tags": [], "owner": {"reputation": 30377, "user_id": 369198, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/71596bb1ca3ba3aa4400c3f407baec9f?s=128&d=identicon&r=PG", "display_name": "Michael Snoyman", "link": "https://stackoverflow.com/users/369198/michael-snoyman"}, "is_accepted": true, "score": 1, "last_activity_date": 1463582222, "creation_date": 1463582222, "answer_id": 37302784, "question_id": 37302197, "link": "https://stackoverflow.com/questions/37302197/using-the-data-vector-generic-interface/37302784#37302784", "title": "Using the Data.Vector.Generic interface", "body": "<p>In the <code>Generic</code> module, <code>Vector</code> is a type class and needs to be used as a constraint, e.g.:</p>\n\n<pre><code>mySwap2 :: VG.Vector v a =&gt; v a -&gt; v a\n</code></pre>\n\n<p>This means: <code>v</code> is some kind of vector which is capable of holding <code>a</code>s.</p>\n"}, {"comments": [{"owner": {"reputation": 49959, "user_id": 866915, "user_type": "registered", "accept_rate": 70, "profile_image": "https://www.gravatar.com/avatar/09242131d6e17cbbe31e8547514da6e5?s=128&d=identicon&r=PG", "display_name": "ErikR", "link": "https://stackoverflow.com/users/866915/erikr"}, "reply_to_user": {"reputation": 2185, "user_id": 4129091, "user_type": "registered", "accept_rate": 80, "profile_image": "https://www.gravatar.com/avatar/0f8076e78a95ed50b9ffbed42849d80e?s=128&d=identicon&r=PG&f=1", "display_name": "tsorn", "link": "https://stackoverflow.com/users/4129091/tsorn"}, "edited": false, "score": 2, "creation_date": 1463583475, "post_id": 37303018, "comment_id": 62128474, "body": "Let GHC be your friend. Also look up <a href=\"https://ghc.haskell.org/trac/ghc/wiki/PartialTypeSignatures\" rel=\"nofollow noreferrer\">partial type signatures</a> to have GHC tell you what part of a type signature should be."}], "tags": [], "owner": {"reputation": 49959, "user_id": 866915, "user_type": "registered", "accept_rate": 70, "profile_image": "https://www.gravatar.com/avatar/09242131d6e17cbbe31e8547514da6e5?s=128&d=identicon&r=PG", "display_name": "ErikR", "link": "https://stackoverflow.com/users/866915/erikr"}, "is_accepted": false, "score": 2, "last_activity_date": 1463585001, "last_edit_date": 1463585001, "creation_date": 1463582715, "answer_id": 37303018, "question_id": 37302197, "link": "https://stackoverflow.com/questions/37302197/using-the-data-vector-generic-interface/37303018#37303018", "title": "Using the Data.Vector.Generic interface", "body": "<p>I just removed the type signature and let GHC guide me:</p>\n\n<pre><code>gswap v = runST $ do\n  vmut &lt;- VG.thaw v\n  VGM.swap vmut 0 1\n  VG.unsafeFreeze vmut\n</code></pre>\n\n<p>At first this yielded:</p>\n\n<pre><code>Illegal equational constraint Mutable v ~ Mutable v\n(Use GADTs or TypeFamilies to permit this)\n</code></pre>\n\n<p>After adding <code>LANGUAGE TypeFamilies</code> it compiled and <code>:t gswap</code> returned:</p>\n\n<pre><code>gswap\n  :: (VG.Vector v a, VG.Vector v1 a, Mutable v1 ~ Mutable v) =&gt;\n     v a -&gt; v1 a\n</code></pre>\n\n<p>But if <code>v</code> and <code>v1</code> are the same type the mutable constraint is trivially satisfied and you don't need the TypeFamilies extension.</p>\n"}], "owner": {"reputation": 2185, "user_id": 4129091, "user_type": "registered", "accept_rate": 80, "profile_image": "https://www.gravatar.com/avatar/0f8076e78a95ed50b9ffbed42849d80e?s=128&d=identicon&r=PG&f=1", "display_name": "tsorn", "link": "https://stackoverflow.com/users/4129091/tsorn"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 140, "favorite_count": 0, "accepted_answer_id": 37302784, "answer_count": 2, "score": 1, "last_activity_date": 1463585001, "creation_date": 1463580724, "last_edit_date": 1463581286, "question_id": 37302197, "link": "https://stackoverflow.com/questions/37302197/using-the-data-vector-generic-interface", "title": "Using the Data.Vector.Generic interface", "body": "<p>I'm having some trouble defining the type signature when using the generic vector interface. I want to construct a method that can work on both boxed and unboxed vectors.</p>\n\n<p>This works, but is constrained to boxed vectors:</p>\n\n<pre><code>import           Control.Monad.ST\nimport           Data.Vector                 as V\nimport           Data.Vector.Generic         as VG\nimport           Data.Vector.Generic.Mutable as VGM\nimport           Data.Vector.Mutable         as VM\nimport           Data.Vector.Unboxed         as VU\nimport           Data.Vector.Unboxed.Mutable as VUM\n\nmySwap :: V.Vector a -&gt; V.Vector a\nmySwap vec = runST $ do\n  vec_mut &lt;- V.thaw vec\n  VM.swap vec_mut 0 1\n  V.unsafeFreeze vec_mut\n</code></pre>\n\n<p>If I change <code>V</code> to <code>VG</code> in order to use the generic interface, then two arguments are needed for the vector in the type signature, but I'm not sure how to constrain the first argument:</p>\n\n<pre><code>mySwap2 :: VG.Vector v a -&gt; VG.Vector v a\nmySwap2 vec = runST $ do\n  vec_mut &lt;- VG.thaw vec\n  VGM.swap vec_mut 0 1\n  VG.unsafeFreeze vec_mut\n</code></pre>\n\n<blockquote>\n  <p>Expected a type, but <code>VG.Vector v a</code> has kind\n  <code>ghc-prim-.4.0.0:GHC.Prim.Constraint</code></p>\n</blockquote>\n"}, {"tags": ["haskell", "functional-programming"], "comments": [{"owner": {"reputation": 31218, "user_id": 211160, "user_type": "registered", "accept_rate": 92, "profile_image": "https://i.stack.imgur.com/Z2fk7.png?s=128&g=1", "display_name": "HostileFork says dont trust SE", "link": "https://stackoverflow.com/users/211160/hostilefork-says-dont-trust-se"}, "edited": false, "score": 1, "creation_date": 1463570169, "post_id": 37297574, "comment_id": 62118595, "body": "If you&#39;re working on &quot;textbook&quot; problems, then it&#39;s good to become familiar with <a href=\"https://wiki.haskell.org/H-99:_Ninety-Nine_Haskell_Problems\" rel=\"nofollow noreferrer\">99 Haskell problems</a>.  This is problem 9, and the solutions page shows <a href=\"https://wiki.haskell.org/99_questions/Solutions/9\" rel=\"nofollow noreferrer\">several ways to do it</a> (as it does for each)."}], "answers": [{"tags": [], "owner": {"reputation": 35543, "user_id": 149530, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/9b6c8b04130af49735de5be666d67c00?s=128&d=identicon&r=PG", "display_name": "Michael Foukarakis", "link": "https://stackoverflow.com/users/149530/michael-foukarakis"}, "is_accepted": false, "score": 1, "last_activity_date": 1463569330, "creation_date": 1463569330, "answer_id": 37297681, "question_id": 37297574, "link": "https://stackoverflow.com/questions/37297574/how-to-pack-some-strings-in-a-list-on-haskell/37297681#37297681", "title": "How to &quot;pack&quot; some strings in a list on Haskell?", "body": "<p>Here's something off the top of my head:</p>\n\n<pre><code>pack :: (Eq a) =&gt; [a] -&gt; [[a]]\npack [] = []\n-- We split elements of a list recursively into those which are equal to the first one,\n-- and those that are not. Then do the same for the latter:\npack (x:xs) = let (first, rest) = span (==x) xs\n              in (x:first) : pack rest\n</code></pre>\n\n<p><a href=\"http://hackage.haskell.org/package/base-4.8.2.0/docs/src/Data.OldList.html#group\" rel=\"nofollow\">Data.List</a> already has what you're looking for, though.</p>\n"}, {"tags": [], "owner": {"reputation": 1404, "user_id": 5559663, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/sQiE2.gif?s=128&g=1", "display_name": "baxbaxwalanuksiwe", "link": "https://stackoverflow.com/users/5559663/baxbaxwalanuksiwe"}, "is_accepted": false, "score": 2, "last_activity_date": 1463569724, "last_edit_date": 1495540364, "creation_date": 1463569724, "answer_id": 37297814, "question_id": 37297574, "link": "https://stackoverflow.com/questions/37297574/how-to-pack-some-strings-in-a-list-on-haskell/37297814#37297814", "title": "How to &quot;pack&quot; some strings in a list on Haskell?", "body": "<p>Use <a href=\"http://hackage.haskell.org/package/base-4.8.2.0/docs/Data-List.html#v:group\" rel=\"nofollow noreferrer\"><code>Data.List.group</code></a>:</p>\n\n<pre><code>\u03bb&gt; import Data.List (group)\n\u03bb&gt; :t group\ngroup :: Eq a =&gt; [a] -&gt; [[a]]\n\u03bb&gt; group\u00a0['a','a','a','b','c','c','a','a','d','e','e','e']\n[\"aaa\",\"b\",\"cc\",\"aa\",\"d\",\"eee\"]\n</code></pre>\n\n<p>Unless you want to write the function yourself (see <a href=\"https://stackoverflow.com/a/37297681/5559663\">Michael Foukarakis answer</a>)</p>\n"}, {"tags": [], "owner": {"reputation": 685, "user_id": 3222117, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/uEbIs.jpg?s=128&g=1", "display_name": "Alexandre Lucchesi", "link": "https://stackoverflow.com/users/3222117/alexandre-lucchesi"}, "is_accepted": false, "score": 1, "last_activity_date": 1463734911, "creation_date": 1463734911, "answer_id": 37342423, "question_id": 37297574, "link": "https://stackoverflow.com/questions/37297574/how-to-pack-some-strings-in-a-list-on-haskell/37342423#37342423", "title": "How to &quot;pack&quot; some strings in a list on Haskell?", "body": "<p>I think it's worth adding a more explicit/beginner version:</p>\n\n<pre><code>pack :: [Char] -&gt; [String]\npack [] = []\npack (c:cs) =\n    let (v, s) = findConsecutive [c] cs\n    in v : pack s\n  where\n    findConsecutive ds [] = (ds, [])\n    findConsecutive s@(d:ds) t@(e:es)\n        | d /= e = (s, t)\n        | otherwise = findConsecutive (e:s) es\n</code></pre>\n\n<p>If the input is an empty list, the outcome is also an empty list. Otherwise, we find the next consecutive <code>Char</code>s that are equal and group them together into a <code>String</code>, which is returned in the result list. In order to do that we use the  <code>findConsecutive</code> auxiliary function. This function's behavior resembles the <a href=\"https://hackage.haskell.org/package/base-4.8.2.0/docs/Prelude.html#v:takeWhile\" rel=\"nofollow\"><code>takeWhile</code></a> function, with the difference that we know in advance the predicate to use (equality comparison) and that we return both the consumed and the remaining list.</p>\n\n<p>In other words, the signature of <code>findConsecutive</code> could be written as:</p>\n\n<pre><code>findConsecutive :: String -&gt; [Char] -&gt; (String, String)\n</code></pre>\n\n<p>which means that it takes a string containing only repeated characters to be used as an accumulator and a list whose characters are \"extracted\" from. It returns a tuple containing the current sequence of elements and the remaining list. Its body should be intuitive to follow: while the characters list is not empty and the current element is equal to the ones in the accumulator, we add the character to the accumulator and recursive into the function. The function returns when we reach the end of the list or a different character is encountered.</p>\n\n<p>The same rationale can be used to understand the body of <code>pack</code>.</p>\n"}], "owner": {"reputation": 285, "user_id": 5661795, "user_type": "registered", "accept_rate": 21, "profile_image": "https://graph.facebook.com/10206951151289259/picture?type=large", "display_name": "HJGBAUM", "link": "https://stackoverflow.com/users/5661795/hjgbaum"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 704, "favorite_count": 0, "answer_count": 3, "score": 2, "last_activity_date": 1463734911, "creation_date": 1463569093, "question_id": 37297574, "link": "https://stackoverflow.com/questions/37297574/how-to-pack-some-strings-in-a-list-on-haskell", "title": "How to &quot;pack&quot; some strings in a list on Haskell?", "body": "<p>I want to write a function pack such that</p>\n\n<pre><code>pack ['a','a','a','b','c','c','a','a','d','e','e','e'] \n= [\"aaa\",\"b\",\"cc\",\"aa\",\"d\",\"eee\"]\n</code></pre>\n\n<p>How can I do this? I'm stuck...</p>\n"}, {"tags": ["haskell", "random", "random-sample"], "answers": [{"comments": [{"owner": {"reputation": 2185, "user_id": 4129091, "user_type": "registered", "accept_rate": 80, "profile_image": "https://www.gravatar.com/avatar/0f8076e78a95ed50b9ffbed42849d80e?s=128&d=identicon&r=PG&f=1", "display_name": "tsorn", "link": "https://stackoverflow.com/users/4129091/tsorn"}, "edited": false, "score": 0, "creation_date": 1463568656, "post_id": 37297256, "comment_id": 62117568, "body": "I thought that any changes in <code>runST</code> could not &quot;escape&quot; unless explicitly returned. Should not <code>shuffle</code> have no side effects, since everything is done inside <code>runST</code>?"}, {"owner": {"reputation": 49959, "user_id": 866915, "user_type": "registered", "accept_rate": 70, "profile_image": "https://www.gravatar.com/avatar/09242131d6e17cbbe31e8547514da6e5?s=128&d=identicon&r=PG", "display_name": "ErikR", "link": "https://stackoverflow.com/users/866915/erikr"}, "reply_to_user": {"reputation": 2185, "user_id": 4129091, "user_type": "registered", "accept_rate": 80, "profile_image": "https://www.gravatar.com/avatar/0f8076e78a95ed50b9ffbed42849d80e?s=128&d=identicon&r=PG&f=1", "display_name": "tsorn", "link": "https://stackoverflow.com/users/4129091/tsorn"}, "edited": false, "score": 2, "creation_date": 1463570009, "post_id": 37297256, "comment_id": 62118491, "body": "It would be helpful if you could provide an example of what you mean by this. The problem here is that you&#39;re using unsafe operations which violate the underlying assumptions of the ST monad."}, {"owner": {"reputation": 2185, "user_id": 4129091, "user_type": "registered", "accept_rate": 80, "profile_image": "https://www.gravatar.com/avatar/0f8076e78a95ed50b9ffbed42849d80e?s=128&d=identicon&r=PG&f=1", "display_name": "tsorn", "link": "https://stackoverflow.com/users/4129091/tsorn"}, "edited": false, "score": 0, "creation_date": 1463570510, "post_id": 37297256, "comment_id": 62118798, "body": "That explains it! By changing <code>VU.unsafeThaw</code> to <code>VU.thaw</code>, the random samples are equal. If I don&#39;t use any unsafe operations in <code>runST</code> then the operations should not have any side effects, right?"}, {"owner": {"reputation": 2185, "user_id": 4129091, "user_type": "registered", "accept_rate": 80, "profile_image": "https://www.gravatar.com/avatar/0f8076e78a95ed50b9ffbed42849d80e?s=128&d=identicon&r=PG&f=1", "display_name": "tsorn", "link": "https://stackoverflow.com/users/4129091/tsorn"}, "edited": false, "score": 0, "creation_date": 1463570816, "post_id": 37297256, "comment_id": 62119011, "body": "Also, for this particular sample, is it safe to only use the safe version <code>thaw</code> and the unsafe version of <code>freeze</code>, since the mutable vector is not returned?"}, {"owner": {"reputation": 49959, "user_id": 866915, "user_type": "registered", "accept_rate": 70, "profile_image": "https://www.gravatar.com/avatar/09242131d6e17cbbe31e8547514da6e5?s=128&d=identicon&r=PG", "display_name": "ErikR", "link": "https://stackoverflow.com/users/866915/erikr"}, "reply_to_user": {"reputation": 2185, "user_id": 4129091, "user_type": "registered", "accept_rate": 80, "profile_image": "https://www.gravatar.com/avatar/0f8076e78a95ed50b9ffbed42849d80e?s=128&d=identicon&r=PG&f=1", "display_name": "tsorn", "link": "https://stackoverflow.com/users/4129091/tsorn"}, "edited": false, "score": 0, "creation_date": 1463571010, "post_id": 37297256, "comment_id": 62119138, "body": "Probably will work. I&#39;m still looking for the vector equivalent to <code>runSTArray</code> to avoid copying on both the thaw and freeze operations."}, {"owner": {"reputation": 49959, "user_id": 866915, "user_type": "registered", "accept_rate": 70, "profile_image": "https://www.gravatar.com/avatar/09242131d6e17cbbe31e8547514da6e5?s=128&d=identicon&r=PG", "display_name": "ErikR", "link": "https://stackoverflow.com/users/866915/erikr"}, "reply_to_user": {"reputation": 2185, "user_id": 4129091, "user_type": "registered", "accept_rate": 80, "profile_image": "https://www.gravatar.com/avatar/0f8076e78a95ed50b9ffbed42849d80e?s=128&d=identicon&r=PG&f=1", "display_name": "tsorn", "link": "https://stackoverflow.com/users/4129091/tsorn"}, "edited": false, "score": 0, "creation_date": 1463571321, "post_id": 37297256, "comment_id": 62119345, "body": "Try using <code>create</code> - this should avoid a copy."}, {"owner": {"reputation": 2185, "user_id": 4129091, "user_type": "registered", "accept_rate": 80, "profile_image": "https://www.gravatar.com/avatar/0f8076e78a95ed50b9ffbed42849d80e?s=128&d=identicon&r=PG&f=1", "display_name": "tsorn", "link": "https://stackoverflow.com/users/4129091/tsorn"}, "edited": false, "score": 0, "creation_date": 1463571473, "post_id": 37297256, "comment_id": 62119451, "body": "But it must be necessary to create at least one copy? If so then would not safe thaw + unsafe freeze be equivalent?"}, {"owner": {"reputation": 49959, "user_id": 866915, "user_type": "registered", "accept_rate": 70, "profile_image": "https://www.gravatar.com/avatar/09242131d6e17cbbe31e8547514da6e5?s=128&d=identicon&r=PG", "display_name": "ErikR", "link": "https://stackoverflow.com/users/866915/erikr"}, "reply_to_user": {"reputation": 2185, "user_id": 4129091, "user_type": "registered", "accept_rate": 80, "profile_image": "https://www.gravatar.com/avatar/0f8076e78a95ed50b9ffbed42849d80e?s=128&d=identicon&r=PG&f=1", "display_name": "tsorn", "link": "https://stackoverflow.com/users/4129091/tsorn"}, "edited": false, "score": 0, "creation_date": 1463571918, "post_id": 37297256, "comment_id": 62119764, "body": "safe thaw + unsafe freeze should be fine"}], "tags": [], "owner": {"reputation": 49959, "user_id": 866915, "user_type": "registered", "accept_rate": 70, "profile_image": "https://www.gravatar.com/avatar/09242131d6e17cbbe31e8547514da6e5?s=128&d=identicon&r=PG", "display_name": "ErikR", "link": "https://stackoverflow.com/users/866915/erikr"}, "is_accepted": true, "score": 2, "last_activity_date": 1463569513, "last_edit_date": 1463569513, "creation_date": 1463568278, "answer_id": 37297256, "question_id": 37296825, "link": "https://stackoverflow.com/questions/37296825/random-generator-unexpected-behavior/37297256#37297256", "title": "Random generator unexpected behavior", "body": "<p>Because <code>shuffle</code> is using <code>unsafeThaw/Freeze</code> it is actually modifying the input vector, i.e. <code>rand_vec1</code> in this case.</p>\n\n<p>Try running this:</p>\n\n<pre><code>go = do\n  g &lt;- newStdGen\n  let (rand_vec1, g1) = randVector 10 g\n  print rand_vec1\n  let (rand_vec2, g2) = randVector 10 g\n  print rand_vec2\n  let (rand_sample1, g3) = shuffle rand_vec1 2 g\n  print rand_sample1\n  print (\"rand_vec1: \", rand_vec1)\n  let (rand_sample2, g4) = shuffle rand_vec1 2 g\n  print rand_sample2\n  print (\"rand_vec1: \", rand_vec1)\n</code></pre>\n\n<p>And here is the output:</p>\n\n<pre><code>*Main&gt; go\n[7,0,3,5,2,6,9,8,1,4]\n[7,0,3,5,2,6,9,8,1,4]\n[0,3]\n(\"rand_vec1: \", [0,3,7,5,2,6,9,8,1,4])\n[3,7]\n(\"rand_vec1: \", [3,7,0,5,2,6,9,8,1,4])\n</code></pre>\n\n<p>To answer your second question, the short answer is that the vector returned by <code>shuffle</code> shares the same memory as the (modified) input vector.</p>\n"}], "owner": {"reputation": 2185, "user_id": 4129091, "user_type": "registered", "accept_rate": 80, "profile_image": "https://www.gravatar.com/avatar/0f8076e78a95ed50b9ffbed42849d80e?s=128&d=identicon&r=PG&f=1", "display_name": "tsorn", "link": "https://stackoverflow.com/users/4129091/tsorn"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 83, "favorite_count": 0, "accepted_answer_id": 37297256, "answer_count": 1, "score": 3, "last_activity_date": 1463569513, "creation_date": 1463567108, "last_edit_date": 1463567918, "question_id": 37296825, "link": "https://stackoverflow.com/questions/37296825/random-generator-unexpected-behavior", "title": "Random generator unexpected behavior", "body": "<p>I'm working with the <code>System.Random</code> library and I've come across some behavior that I don't fully understand. The <code>shuffle</code> function below is an implementation of the <a href=\"https://en.wikipedia.org/wiki/Fisher%E2%80%93Yates_shuffle\" rel=\"nofollow\">Fischer-Yates shuffle</a> that also works as a random sample without replacement. E.g. calling <code>shuffle</code> with a list and the length of the list will shuffle the whole list, but calling it with a list and the number 2 should extract a random sample of length 2. </p>\n\n<pre><code>import           Control.Monad               as M\nimport           Control.Monad.ST\nimport           Data.Vector.Unboxed         as VU\nimport           Data.Vector.Unboxed.Mutable as VUM\nimport           System.Random\n\ngo = do\n  g &lt;- newStdGen\n  let (rand_vec1, g1) = randVector 10 g\n  let (rand_vec2, g2) = randVector 10 g\n  let (rand_sample1, g3) = shuffle rand_vec1 2 g\n  let (rand_sample2, g4) = shuffle rand_vec1 2 g\n  print rand_vec1\n  print rand_vec2\n  print rand_sample1\n  print rand_sample2\n\nrandVector :: (RandomGen g) =&gt; Int -&gt; g -&gt; (VU.Vector Int, g)\nrandVector n = shuffle vector (VU.length vector) where\n  vector = VU.enumFromN 0 n\n\nshuffle :: (RandomGen g, Unbox a) =&gt; VU.Vector a -&gt; Int -&gt; g -&gt; (VU.Vector a, g)\nshuffle li size g = runST $ do\n  vector &lt;- VU.unsafeThaw li\n  let n = VUM.length vector - 1\n  let step g i = do\n              let (j,g') = randomR (0,n) g\n              VUM.swap vector i j\n              return g'\n  g' &lt;- M.foldM step g [0..size-1]\n  v' &lt;- VU.unsafeFreeze vector\n  let vec = VU.take size v'\n  return (vec, g')\n</code></pre>\n\n<p>I notice that <code>rand_vec1</code> and <code>rand_vec2</code> are always identical, which is to be expected, since the same random number generator is used. </p>\n\n<p>However, <code>rand_sample1</code> and <code>rand_sample2</code> differs even though they both use the same random generator. Even stranger, more than half the time, but not always, <code>rand_sample2</code> just contains the two first numbers of the vector being sampled from (like in the example below). How come?\nExample output:</p>\n\n<blockquote>\n  <p>[3,0,4,9,7,2,1,8,5,6] </p>\n  \n  <p>[3,0,4,9,7,2,1,8,5,6]</p>\n  \n  <p>[9,2] </p>\n  \n  <p>[3,0]</p>\n</blockquote>\n\n<p>(Also, code review is appreciated)</p>\n"}, {"tags": ["haskell", "coercion"], "comments": [{"owner": {"reputation": 94713, "user_id": 1139697, "user_type": "registered", "accept_rate": 86, "profile_image": "https://www.gravatar.com/avatar/5f136ddb684f39aaee1c028ee1950f6f?s=128&d=identicon&r=PG", "display_name": "Zeta", "link": "https://stackoverflow.com/users/1139697/zeta"}, "edited": false, "score": 0, "creation_date": 1463552360, "post_id": 37290405, "comment_id": 62107307, "body": "GHC 7.10 throws a lot of errors due to missing <code>LANGUAGE</code> annotations in your original code. Could you add them?"}, {"owner": {"reputation": 44013, "user_id": 1477667, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/trgKM.jpg?s=128&g=1", "display_name": "dfeuer", "link": "https://stackoverflow.com/users/1477667/dfeuer"}, "edited": false, "score": 0, "creation_date": 1463553464, "post_id": 37290405, "comment_id": 62107855, "body": "Have you checked what happens if you do it in a <code>.hs</code> file? GHCi can be weird about module boundaries. I&#39;m quite sure <code>hyperloglog</code> has a role declaration of its own."}, {"owner": {"reputation": 100185, "user_id": 3234959, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/93bb12ca0f93dfddb33880316f7e66c2?s=128&d=identicon&r=PG&f=1", "display_name": "chi", "link": "https://stackoverflow.com/users/3234959/chi"}, "edited": false, "score": 0, "creation_date": 1463558224, "post_id": 37290405, "comment_id": 62110615, "body": "Weird... the role annotation should indeed prevent these coercions."}, {"owner": {"reputation": 100892, "user_id": 745903, "user_type": "registered", "accept_rate": 74, "profile_image": "https://www.gravatar.com/avatar/50933f6638836741e620669b3940410e?s=128&d=identicon&r=PG", "display_name": "leftaroundabout", "link": "https://stackoverflow.com/users/745903/leftaroundabout"}, "edited": false, "score": 2, "creation_date": 1463563290, "post_id": 37290405, "comment_id": 62113867, "body": "Not relevant here and you probably know already, but I&#39;d remark that this is not a valid monoid instance because <code>(mempty&lt;&gt;mempty) :: Container 1</code> gives <code>Container [0,0] \u2260 mempty</code>. You could make it valid with e.g. <code>mappend \u221d zipWith (+)</code>."}, {"owner": {"reputation": 9429, "user_id": 1177991, "user_type": "registered", "accept_rate": 58, "profile_image": "https://www.gravatar.com/avatar/b0990b7faeb18a884412bed7e0b3b422?s=128&d=identicon&r=PG", "display_name": "Eugene Zhulenev", "link": "https://stackoverflow.com/users/1177991/eugene-zhulenev"}, "reply_to_user": {"reputation": 94713, "user_id": 1139697, "user_type": "registered", "accept_rate": 86, "profile_image": "https://www.gravatar.com/avatar/5f136ddb684f39aaee1c028ee1950f6f?s=128&d=identicon&r=PG", "display_name": "Zeta", "link": "https://stackoverflow.com/users/1139697/zeta"}, "edited": false, "score": 0, "creation_date": 1463581920, "post_id": 37290405, "comment_id": 62127198, "body": "@Zeta <a href=\"https://gist.github.com/ezhulenev/f7913740e8971f9a60ce4c5677a0f3f3\" rel=\"nofollow noreferrer\">gist.github.com/ezhulenev/f7913740e8971f9a60ce4c5677a0f3f3</a> - it&#39;s a lot there, not all of them relevant to this particular question though"}, {"owner": {"reputation": 9429, "user_id": 1177991, "user_type": "registered", "accept_rate": 58, "profile_image": "https://www.gravatar.com/avatar/b0990b7faeb18a884412bed7e0b3b422?s=128&d=identicon&r=PG", "display_name": "Eugene Zhulenev", "link": "https://stackoverflow.com/users/1177991/eugene-zhulenev"}, "reply_to_user": {"reputation": 100892, "user_id": 745903, "user_type": "registered", "accept_rate": 74, "profile_image": "https://www.gravatar.com/avatar/50933f6638836741e620669b3940410e?s=128&d=identicon&r=PG", "display_name": "leftaroundabout", "link": "https://stackoverflow.com/users/745903/leftaroundabout"}, "edited": false, "score": 0, "creation_date": 1463581974, "post_id": 37290405, "comment_id": 62127248, "body": "@leftaroundabout oh yeah, I should better put undefined there"}, {"owner": {"reputation": 9429, "user_id": 1177991, "user_type": "registered", "accept_rate": 58, "profile_image": "https://www.gravatar.com/avatar/b0990b7faeb18a884412bed7e0b3b422?s=128&d=identicon&r=PG", "display_name": "Eugene Zhulenev", "link": "https://stackoverflow.com/users/1177991/eugene-zhulenev"}, "reply_to_user": {"reputation": 44013, "user_id": 1477667, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/trgKM.jpg?s=128&g=1", "display_name": "dfeuer", "link": "https://stackoverflow.com/users/1477667/dfeuer"}, "edited": false, "score": 0, "creation_date": 1463582181, "post_id": 37290405, "comment_id": 62127404, "body": "@dfeuer yeah, I can do the same trick in .hs file and compile it"}, {"owner": {"reputation": 44013, "user_id": 1477667, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/trgKM.jpg?s=128&g=1", "display_name": "dfeuer", "link": "https://stackoverflow.com/users/1477667/dfeuer"}, "edited": false, "score": 0, "creation_date": 1463583252, "post_id": 37290405, "comment_id": 62128277, "body": "Oh, I missed the fact that your example is <i>based on</i> <code>hyperloglog</code> rather than <i>using</i> it. Ha. Side note to Antal&#39;s answer: you can conditionally expose a <code>Coercible</code> instance, packaged as a <code>Coercion</code>, from a module that defines an abstract type. <code>hyperloglog</code>, for example, offers a function that checks whether two distribution types reflect the same configuration and, if so, gives you a <code>Coercion</code> between them."}], "answers": [{"tags": [], "owner": {"reputation": 34864, "user_id": 237428, "user_type": "registered", "accept_rate": 78, "profile_image": "https://i.stack.imgur.com/ThNhZ.jpg?s=128&g=1", "display_name": "Antal Spector-Zabusky", "link": "https://stackoverflow.com/users/237428/antal-spector-zabusky"}, "is_accepted": true, "score": 11, "last_activity_date": 1463569204, "creation_date": 1463569204, "answer_id": 37297625, "question_id": 37290405, "link": "https://stackoverflow.com/questions/37290405/disable-haskell-type-coercion/37297625#37297625", "title": "Disable Haskell type coercion", "body": "<p>The issue is that <code>newtype</code>s are coercible to their representation as long as the constructor is in scope \u2013 indeed, this is a big part of the motivation for <code>Coercible</code>.  And <code>Coercible</code> constraints are like any other type class constraint, and are automatically searched and put together for you, only even more so.  Thus, <code>coerce c3</code> is finding that you have</p>\n\n<pre><code>instance Coercible (Container p) [Int]\ninstance Coercible [Int] (Container p')\n</code></pre>\n\n<p>for all <code>p</code> and <code>p'</code>, and happily building the composite coercion for you via</p>\n\n<pre><code>instance (Coercible a b, Coercible b c) =&gt; Coercible a c\n</code></pre>\n\n<p>If you don't export the <code>Container</code> constructor \u2013 as you probably want to do anyway! \u2013 then it's no longer known that the <code>newtype</code> is equal to its representation (you lose the first two instances above), and you get the desired error in other modules:</p>\n\n<pre><code>ContainerClient.hs:13:6:\n    Couldn't match type \u20184\u2019 with \u20183\u2019\n    arising from trying to show that the representations of\n      \u2018Container 3\u2019 and\n      \u2018Container 4\u2019 are the same\n    Relevant role signatures: type role Container nominal nominal\n    In the expression: coerce c3\n    In an equation for \u2018c4\u2019: c4 = coerce c3\n</code></pre>\n\n<p>However, you'll always be able to break your invariants in the module where you define the <code>newtype</code> (via <code>coerce</code> or otherwise).</p>\n\n<hr>\n\n<p>As a side note, you probably <em>don't</em> want to use a record-style accessor here and export it; that lets users use record-update syntax to change out code from under you, so</p>\n\n<pre><code>c3 :: Container 3\nc3 = mempty\n\nc3' :: Container 3\nc3' = c3{runContainer = []}\n</code></pre>\n\n<p>becomes valid.  Make <code>runContainer</code> a free-standing function instead.</p>\n\n<hr>\n\n<p>We can verify that we're getting the composition of the two <code>newtype</code>-representation constraints by looking at the Core (via <code>-ddump-simpl</code>): within the module that defines <code>Container</code> (which I've also called <code>Container</code>), the output is (if we remove the export list)</p>\n\n<pre><code>c4 :: Container 4\n[GblId, Str=DmdType]\nc4 =\n  c3\n  `cast` (Container.NTCo:Container[0] &lt;GHC.TypeLits.Nat&gt;_N &lt;3&gt;_N\n          ; Sym (Container.NTCo:Container[0] &lt;GHC.TypeLits.Nat&gt;_N &lt;4&gt;_N)\n          :: Container 3 ~R# Container 4)\n</code></pre>\n\n<p>It's a bit hard to read, but the important thing to see is <code>Container.NTCo:Container[0]</code>: the <code>NTCo</code> is a <code>newtype</code> coercion between the <code>newtype</code> <code>Container p</code> and its representation type.  <code>Sym</code> turns this around, and <code>;</code> composes two constraints.</p>\n\n<p>Call the final constraint <code>\u03b3\u2093</code>; then the whole typing derivation is</p>\n\n<pre><code>Sym :: (a ~ b) -&gt; (b ~ a)\n-- Sym is built-in\n\n(;) :: (a ~ b) -&gt; (b ~ c) -&gt; (a ~ c)\n-- (;) is built-in\n\n\u03b3\u2099 :: k -&gt; (p :: k) -&gt; Container p ~ [Int]\n\u03b3\u2099 k p = Container.NTCo:Container[0] &lt;k&gt;_N &lt;p&gt;_N\n\n\u03b3\u2083 :: Container 3 ~ [Int]\n\u03b3\u2083 = \u03b3\u2099 GHC.TypeLits.Nat 3\n\n\u03b3\u2084 :: Container 4 ~ [Int]\n\u03b3\u2084 = \u03b3\u2099 GHC.TypeLits.Nat 4\n\n\u03b3\u2084\u2032 :: [Int] ~ Container 4\n\u03b3\u2084\u2032 = Sym \u03b3\u2084\n\n\u03b3\u2093 :: Container 3 ~ Container 4\n\u03b3\u2093 = \u03b3\u2083 ; \u03b3\u2084\u2032\n</code></pre>\n\n<hr>\n\n<p>Here are the source files I used:</p>\n\n<p>Container.hs:</p>\n\n<pre><code>{-# LANGUAGE FlexibleContexts, UndecidableInstances, ScopedTypeVariables,\n             RoleAnnotations, PolyKinds, DataKinds #-}\n\nmodule Container (Container(), runContainer) where\n\nimport Data.Proxy\nimport Data.Reflection\nimport Data.Coerce\n\nnewtype Container p = Container { runContainer :: [Int] }\n    deriving (Eq, Show)\ntype role Container nominal\n\ninstance Reifies p Integer =&gt; Monoid (Container p) where\n  mempty = Container $ replicate (fromIntegral (reflect (Proxy :: Proxy p))) 0\n  mappend (Container l) (Container r) = Container $ l ++ r\n\nc3 :: Container 3\nc3 = mempty\n\n-- Works\nc4 :: Container 4\nc4 = coerce c3\n</code></pre>\n\n<p>ContainerClient.hs:</p>\n\n<pre><code>{-# LANGUAGE DataKinds #-}\n\nmodule ContainerClient where\n\nimport Container\nimport Data.Coerce\n\nc3 :: Container 3\nc3 = mempty\n\n-- Doesn't work :-)\nc4 :: Container 4\nc4 = coerce c3\n</code></pre>\n"}], "owner": {"reputation": 9429, "user_id": 1177991, "user_type": "registered", "accept_rate": 58, "profile_image": "https://www.gravatar.com/avatar/b0990b7faeb18a884412bed7e0b3b422?s=128&d=identicon&r=PG", "display_name": "Eugene Zhulenev", "link": "https://stackoverflow.com/users/1177991/eugene-zhulenev"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 341, "favorite_count": 1, "accepted_answer_id": 37297625, "answer_count": 1, "score": 6, "last_activity_date": 1463631492, "creation_date": 1463546239, "last_edit_date": 1463631492, "question_id": 37290405, "link": "https://stackoverflow.com/questions/37290405/disable-haskell-type-coercion", "title": "Disable Haskell type coercion", "body": "<p>I have example based on <a href=\"https://github.com/ekmett/hyperloglog\" rel=\"nofollow\">hyperloglog</a>. I'm trying to parametrize my <code>Container</code> with size, and use <a href=\"https://hackage.haskell.org/package/reflection-2.1.2/docs/Data-Reflection.html\" rel=\"nofollow\">reflection</a> to use this parameter in functions on containers.</p>\n\n<pre><code>import           Data.Proxy\nimport           Data.Reflection\n\nnewtype Container p = Container { runContainer :: [Int] }\n    deriving (Eq, Show)\n\ninstance Reifies p Integer =&gt; Monoid (Container p) where\n  mempty = Container $ replicate (fromIntegral (reflect (Proxy :: Proxy p))) 0\n  mappend (Container l) (Container r) = undefined\n</code></pre>\n\n<p>My lame Monoid instance defines <code>mempty</code> based on reified parameter, and doing some \"type-safe\" <code>mappend</code>. It works perfectly when I'm trying to sum containers of different size, failing with type error.</p>\n\n<p>However it's still can be tricked with <code>coerce</code>, and I'm looking for way to block it at compile time:</p>\n\n<pre><code>ghci&gt; :set -XDataKinds\nghci&gt; :m +Data.Coerce\nghci&gt; let c3 = mempty :: Container 3\nghci&gt; c3\nghci&gt; Container {runContaner: [0,0,0]}\nghci&gt; let c4 = coerce c3 :: Container 4\nghci&gt; :t c4\nghci&gt; c4 :: Container 4\nghci&gt; c4\nghci&gt; Container {runContainer: [0,0,0]} \n</code></pre>\n\n<p>Adding type role doesn't help</p>\n\n<pre><code>type role Container nominal\n</code></pre>\n"}, {"tags": ["haskell"], "comments": [{"owner": {"reputation": 40537, "user_id": 465378, "user_type": "registered", "accept_rate": 85, "profile_image": "https://www.gravatar.com/avatar/c03b8d34978563858020eff0d14cc17b?s=128&d=identicon&r=PG", "display_name": "Alexis King", "link": "https://stackoverflow.com/users/465378/alexis-king"}, "edited": false, "score": 1, "creation_date": 1463543048, "post_id": 37289747, "comment_id": 62104150, "body": "Note that, in the future, you can try using <a href=\"https://www.haskell.org/hoogle/?hoogle=(b%20-%3E%20b%20-%3E%20c)%20-%3E%20(a%20-%3E%20b)%20-%3E%20a%20-%3E%20a%20-%3E%20c\" rel=\"nofollow noreferrer\">Hoogle</a> to search for a function you want, which actually gives a useful answer here. :)"}], "answers": [{"comments": [{"owner": {"reputation": 31218, "user_id": 211160, "user_type": "registered", "accept_rate": 92, "profile_image": "https://i.stack.imgur.com/Z2fk7.png?s=128&g=1", "display_name": "HostileFork says dont trust SE", "link": "https://stackoverflow.com/users/211160/hostilefork-says-dont-trust-se"}, "edited": false, "score": 0, "creation_date": 1463609880, "post_id": 37289866, "comment_id": 62142962, "body": "While this is useful thing to know, my feeling is that the &quot;spirit&quot; of the question was much broader than this.  The original question was about--if you might--the &quot;joy and convenience of composition&quot;.  In my imagination, it would have been an equivalent question if the request was for <b>foo (bar x) (bar y) (bar z)</b>.  That is to say I don&#39;t think it was a question about &quot;arity 2&quot;-ness.  As your answer is factual I withheld a downvote...but...it is disappointing to me (in my quest to learn Haskell myself) that this is considered a great answer to what was asked."}, {"owner": {"reputation": 40537, "user_id": 465378, "user_type": "registered", "accept_rate": 85, "profile_image": "https://www.gravatar.com/avatar/c03b8d34978563858020eff0d14cc17b?s=128&d=identicon&r=PG", "display_name": "Alexis King", "link": "https://stackoverflow.com/users/465378/alexis-king"}, "reply_to_user": {"reputation": 31218, "user_id": 211160, "user_type": "registered", "accept_rate": 92, "profile_image": "https://i.stack.imgur.com/Z2fk7.png?s=128&g=1", "display_name": "HostileFork says dont trust SE", "link": "https://stackoverflow.com/users/211160/hostilefork-says-dont-trust-se"}, "edited": false, "score": 0, "creation_date": 1463635917, "post_id": 37289866, "comment_id": 62149527, "body": "@HostileFork The question used both <code>(.)</code> and <code>($)</code> as examples of \u201ccomposition\u201d, so it seems quite likely to me that that question was asked with a more general understanding of \u201ccomposition\u201d in mind that the simple function composition operator. Haskell has many tools in its toolbox for combining functions, and being able to find the right one for the job is often more important than using the most general possible pattern. That said, your interpretation of the question seems interesting, and I would not mind trying to answer it if you posted it separately, with slightly more specifics."}, {"owner": {"reputation": 31218, "user_id": 211160, "user_type": "registered", "accept_rate": 92, "profile_image": "https://i.stack.imgur.com/Z2fk7.png?s=128&g=1", "display_name": "HostileFork says dont trust SE", "link": "https://stackoverflow.com/users/211160/hostilefork-says-dont-trust-se"}, "reply_to_user": {"reputation": 40537, "user_id": 465378, "user_type": "registered", "accept_rate": 85, "profile_image": "https://www.gravatar.com/avatar/c03b8d34978563858020eff0d14cc17b?s=128&d=identicon&r=PG", "display_name": "Alexis King", "link": "https://stackoverflow.com/users/465378/alexis-king"}, "edited": false, "score": 1, "creation_date": 1463641670, "post_id": 37289866, "comment_id": 62152225, "body": "@AlexisKing <i>&quot;so it seems quite likely to me that that question was asked with a more general understanding of \u201ccomposition\u201d in mind&quot;</i> - Perhaps just seeing it through a language learner&#39;s eyes, I&#39;d argue the opposite--that it indicates a lack of understanding of the distinction of what mathematical composition is.  Really I guess my complaint is just that it&#39;s a very hard language to learn, and I don&#39;t think it gets easier if you ask something like this and wind up getting <code>curry (uncurry f . (g *** g))</code> as an answer, sans explanation.  Just seems like people didn&#39;t &quot;hear what was asked&quot;"}, {"owner": {"reputation": 40537, "user_id": 465378, "user_type": "registered", "accept_rate": 85, "profile_image": "https://www.gravatar.com/avatar/c03b8d34978563858020eff0d14cc17b?s=128&d=identicon&r=PG", "display_name": "Alexis King", "link": "https://stackoverflow.com/users/465378/alexis-king"}, "reply_to_user": {"reputation": 31218, "user_id": 211160, "user_type": "registered", "accept_rate": 92, "profile_image": "https://i.stack.imgur.com/Z2fk7.png?s=128&g=1", "display_name": "HostileFork says dont trust SE", "link": "https://stackoverflow.com/users/211160/hostilefork-says-dont-trust-se"}, "edited": false, "score": 0, "creation_date": 1463641836, "post_id": 37289866, "comment_id": 62152334, "body": "@HostileFork For what it\u2019s worth, when I read the question, I thought of the solution using <code>Control.Arrow</code>, myself. However, I think a particularly good answer in that vein would use that to demonstrate that sometimes composition is not the clearest tool for the job, and instead it\u2019s better to just write things out in pointful style. This is actually something I\u2019ve very interested in (making Haskell more accessible), so if you\u2019d like to take this conversation to chat, I\u2019d love to! As it is, it\u2019s a bit off-topic here, though, I\u2019m afraid. :)"}, {"owner": {"reputation": 40537, "user_id": 465378, "user_type": "registered", "accept_rate": 85, "profile_image": "https://www.gravatar.com/avatar/c03b8d34978563858020eff0d14cc17b?s=128&d=identicon&r=PG", "display_name": "Alexis King", "link": "https://stackoverflow.com/users/465378/alexis-king"}, "reply_to_user": {"reputation": 31218, "user_id": 211160, "user_type": "registered", "accept_rate": 92, "profile_image": "https://i.stack.imgur.com/Z2fk7.png?s=128&g=1", "display_name": "HostileFork says dont trust SE", "link": "https://stackoverflow.com/users/211160/hostilefork-says-dont-trust-se"}, "edited": false, "score": 0, "creation_date": 1463642000, "post_id": 37289866, "comment_id": 62152449, "body": "@HostileFork I\u2019ve made a room here, if you\u2019d like to chat. <a href=\"http://chat.stackoverflow.com/rooms/112357/haskell-conversation-for-alexis-king-and-hostilefork\">chat.stackoverflow.com/rooms/112357/&hellip;</a>"}], "tags": [], "owner": {"reputation": 11780, "user_id": 2827654, "user_type": "registered", "accept_rate": 57, "profile_image": "https://www.gravatar.com/avatar/a171742e9c31a541d4d2031af932e94a?s=128&d=identicon&r=PG&f=1", "display_name": "jamshidh", "link": "https://stackoverflow.com/users/2827654/jamshidh"}, "is_accepted": false, "score": 13, "last_activity_date": 1463542851, "creation_date": 1463542851, "answer_id": 37289866, "question_id": 37289747, "link": "https://stackoverflow.com/questions/37289747/how-to-use-function-composition-for-foo-bar-x-bar-y-in-haskell/37289866#37289866", "title": "How to use function composition for `foo (bar x) (bar y)` in Haskell?", "body": "<p>You can use the <code>on</code> function for this, for instance</p>\n\n<pre><code>import Data.Function\n\ndata Person = Person{name::String, age::Int}\n\ncompare `on` age --same as `\\x y -&gt; compare (age x) (age y)`\n</code></pre>\n"}, {"tags": [], "owner": {"reputation": 109, "user_id": 3014612, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/44751bab986933e4405394fb32d6b91d?s=128&d=identicon&r=PG", "display_name": "ilyavf", "link": "https://stackoverflow.com/users/3014612/ilyavf"}, "is_accepted": false, "score": 4, "last_activity_date": 1463558950, "last_edit_date": 1463558950, "creation_date": 1463548555, "answer_id": 37290817, "question_id": 37289747, "link": "https://stackoverflow.com/questions/37289747/how-to-use-function-composition-for-foo-bar-x-bar-y-in-haskell/37290817#37290817", "title": "How to use function composition for `foo (bar x) (bar y)` in Haskell?", "body": "<p>Define it yourself! Just a new infix function:</p>\n\n<pre><code>-- foo (bar x) (bar y) === foo $.$ bar (x y)\n($.$) :: (b -&gt; b -&gt; c) -&gt; (a -&gt; b) -&gt; (a -&gt; a -&gt; c)\nf $.$ g = \\x y -&gt; f (g x) (g y)\n\n-- test 3 5 = 3*3 + 5*5\ntest = (\\x y -&gt; x + y) $.$ (\\z -&gt; z * z)\n</code></pre>\n\n<p>Then in ghci:</p>\n\n<pre><code>ghci&gt; test 3 5\n34\n</code></pre>\n"}, {"comments": [{"owner": {"reputation": 31218, "user_id": 211160, "user_type": "registered", "accept_rate": 92, "profile_image": "https://i.stack.imgur.com/Z2fk7.png?s=128&g=1", "display_name": "HostileFork says dont trust SE", "link": "https://stackoverflow.com/users/211160/hostilefork-says-dont-trust-se"}, "reply_to_user": {"reputation": 976, "user_id": 1274282, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/nBRxs.png?s=128&g=1", "display_name": "Taylor Fausak", "link": "https://stackoverflow.com/users/1274282/taylor-fausak"}, "edited": false, "score": 3, "creation_date": 1463581256, "post_id": 37291204, "comment_id": 62126704, "body": "@TaylorFausak I&#39;m just learning <i>(and trying to start learning-by-answering)</i> so you&#39;ll have to explain to me what you mean.  Because I&#39;m just trying things like <code>concat [show 10, show 20] =&gt; &quot;1020&quot;</code> and then <code>(concat . map show) [10, 20] =&gt; &quot;1020&quot;</code> and conclude it must work.  But I&#39;m quite ready to be wrong wherever anything Haskelly is concerned."}, {"owner": {"reputation": 44013, "user_id": 1477667, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/trgKM.jpg?s=128&g=1", "display_name": "dfeuer", "link": "https://stackoverflow.com/users/1477667/dfeuer"}, "edited": false, "score": 0, "creation_date": 1463590582, "post_id": 37291204, "comment_id": 62133227, "body": "I would say a list is too specific. If your function takes exactly two (or three, or four) arguments, then using an intermediate list will inject partiality. You can instead use an arbitrary <code>Functor</code>, which will allow lists, custom tuple types, length-indexed lists (i.e., dependent vectors), etc."}, {"owner": {"reputation": 31218, "user_id": 211160, "user_type": "registered", "accept_rate": 92, "profile_image": "https://i.stack.imgur.com/Z2fk7.png?s=128&g=1", "display_name": "HostileFork says dont trust SE", "link": "https://stackoverflow.com/users/211160/hostilefork-says-dont-trust-se"}, "reply_to_user": {"reputation": 44013, "user_id": 1477667, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/trgKM.jpg?s=128&g=1", "display_name": "dfeuer", "link": "https://stackoverflow.com/users/1477667/dfeuer"}, "edited": false, "score": 2, "creation_date": 1463611080, "post_id": 37291204, "comment_id": 62143347, "body": "@dfeuer &quot;inject partiality&quot; is a bit opaque to a self-proclaimed beginner.  I already am trying to understand <i>&quot;That won&#39;t work if <code>bar</code> is, say, <code>show</code>&quot;</i>.  So I can&#39;t tell if you&#39;re just saying &quot;use fmap instead of map&quot; (which I didn&#39;t do deliberately for didactic purposes, as it would introduce functors and Fness, and be tangential, though I&#39;m in the &quot;map should be fmap camp&quot;--I think--still new, so I could be wrong).  If you&#39;re saying something more than that, you&#39;d have to walk through it more carefully."}, {"owner": {"reputation": 976, "user_id": 1274282, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/nBRxs.png?s=128&g=1", "display_name": "Taylor Fausak", "link": "https://stackoverflow.com/users/1274282/taylor-fausak"}, "edited": false, "score": 0, "creation_date": 1463659858, "post_id": 37291204, "comment_id": 62164871, "body": "@HostileFork I meant that you can&#39;t pull the <code>show</code> out of the list if you&#39;re applying it to different data types. <code>[show 1, show &quot;two&quot;]</code> works fine, but <code>map show [1, &quot;two&quot;]</code> is an error."}, {"owner": {"reputation": 31218, "user_id": 211160, "user_type": "registered", "accept_rate": 92, "profile_image": "https://i.stack.imgur.com/Z2fk7.png?s=128&g=1", "display_name": "HostileFork says dont trust SE", "link": "https://stackoverflow.com/users/211160/hostilefork-says-dont-trust-se"}, "reply_to_user": {"reputation": 976, "user_id": 1274282, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/nBRxs.png?s=128&g=1", "display_name": "Taylor Fausak", "link": "https://stackoverflow.com/users/1274282/taylor-fausak"}, "edited": false, "score": 0, "creation_date": 1463659950, "post_id": 37291204, "comment_id": 62164938, "body": "@TaylorFausak Ok, so <b>on</b> fixes this?"}, {"owner": {"reputation": 976, "user_id": 1274282, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/nBRxs.png?s=128&g=1", "display_name": "Taylor Fausak", "link": "https://stackoverflow.com/users/1274282/taylor-fausak"}, "edited": false, "score": 0, "creation_date": 1463660482, "post_id": 37291204, "comment_id": 62165327, "body": "No, <code>on</code> requires both arguments to be the same type."}, {"owner": {"reputation": 31218, "user_id": 211160, "user_type": "registered", "accept_rate": 92, "profile_image": "https://i.stack.imgur.com/Z2fk7.png?s=128&g=1", "display_name": "HostileFork says dont trust SE", "link": "https://stackoverflow.com/users/211160/hostilefork-says-dont-trust-se"}, "reply_to_user": {"reputation": 976, "user_id": 1274282, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/nBRxs.png?s=128&g=1", "display_name": "Taylor Fausak", "link": "https://stackoverflow.com/users/1274282/taylor-fausak"}, "edited": false, "score": 0, "creation_date": 1463660509, "post_id": 37291204, "comment_id": 62165352, "body": "@TaylorFausak Ok, so why is the comment on my answer?"}, {"owner": {"reputation": 976, "user_id": 1274282, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/nBRxs.png?s=128&g=1", "display_name": "Taylor Fausak", "link": "https://stackoverflow.com/users/1274282/taylor-fausak"}, "edited": false, "score": 1, "creation_date": 1463660896, "post_id": 37291204, "comment_id": 62165657, "body": "No reason other than that&#39;s when I realized it was a problem. If you want to apply a type class function to multiple data types, you&#39;ll have to do it manually. None of these solutions will work."}, {"owner": {"reputation": 44013, "user_id": 1477667, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/trgKM.jpg?s=128&g=1", "display_name": "dfeuer", "link": "https://stackoverflow.com/users/1477667/dfeuer"}, "reply_to_user": {"reputation": 976, "user_id": 1274282, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/nBRxs.png?s=128&g=1", "display_name": "Taylor Fausak", "link": "https://stackoverflow.com/users/1274282/taylor-fausak"}, "edited": false, "score": 0, "creation_date": 1463663531, "post_id": 37291204, "comment_id": 62167740, "body": "@TaylorFausak, I bet you could do it with <code>HList</code> and a helper class, probably using <code>MultiParamTypeClasses</code> and <code>ConstraintKinds</code> for generality."}], "tags": [], "owner": {"reputation": 31218, "user_id": 211160, "user_type": "registered", "accept_rate": 92, "profile_image": "https://i.stack.imgur.com/Z2fk7.png?s=128&g=1", "display_name": "HostileFork says dont trust SE", "link": "https://stackoverflow.com/users/211160/hostilefork-says-dont-trust-se"}, "is_accepted": false, "score": 2, "last_activity_date": 1463550814, "last_edit_date": 1463550814, "creation_date": 1463550252, "answer_id": 37291204, "question_id": 37289747, "link": "https://stackoverflow.com/questions/37289747/how-to-use-function-composition-for-foo-bar-x-bar-y-in-haskell/37291204#37291204", "title": "How to use function composition for `foo (bar x) (bar y)` in Haskell?", "body": "<blockquote>\n  <p>is it possible that we could use function composition for <code>foo (bar x) (bar y)</code></p>\n</blockquote>\n\n<p>@ilyavf has given an answer, for a function definition such that <code>(foo $.$ bar) x y</code> will act like <code>foo (bar x) (bar y)</code>.  And @jamshidh offers that it exists as <code>on</code> in Data.Function.</p>\n\n<p>But notice the type signature of is kind of a specific shape:</p>\n\n<pre><code>(b -&gt; b -&gt; c) -&gt; (a -&gt; b) -&gt; (a -&gt; a -&gt; c)\n</code></pre>\n\n<p>As a function, though, it's \"shaped funny\" due to an assumption it has to make.  That assumption is that both of <code>foo</code>'s arguments are of the same type.  <em>(otherwise, how could it be correct to use the result of bar for both?)</em></p>\n\n<p>The \"more pleasing shape\" to which Haskell gravitates doesn't call out the special case of working with functions that have two arguments of the same type.  Because what is so special about 2?  Much more interesting is \"N\", and if your function takes N arguments of the same type, then a list is nicer...and can compose as you would like, with a map operation that could work with any number of arguments:</p>\n\n<p><code>foo [bar x, bar y]</code> => <code>(foo . map bar) [x, y]</code></p>\n"}, {"comments": [{"owner": {"reputation": 11986, "user_id": 3237465, "user_type": "registered", "accept_rate": 76, "profile_image": "https://i.stack.imgur.com/vOArX.png?s=128&g=1", "display_name": "user3237465", "link": "https://stackoverflow.com/users/3237465/user3237465"}, "edited": false, "score": 1, "creation_date": 1463559878, "post_id": 37293295, "comment_id": 62111644, "body": "<code>on g f = (. f) . g . f</code>"}, {"owner": {"reputation": 44013, "user_id": 1477667, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/trgKM.jpg?s=128&g=1", "display_name": "dfeuer", "link": "https://stackoverflow.com/users/1477667/dfeuer"}, "edited": false, "score": 0, "creation_date": 1463584197, "post_id": 37293295, "comment_id": 62129042, "body": "Why would you do something so horrible? Ewww!"}, {"owner": {"reputation": 61419, "user_id": 849891, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/MbEO3.png?s=128&g=1", "display_name": "Will Ness", "link": "https://stackoverflow.com/users/849891/will-ness"}, "reply_to_user": {"reputation": 11986, "user_id": 3237465, "user_type": "registered", "accept_rate": 76, "profile_image": "https://i.stack.imgur.com/vOArX.png?s=128&g=1", "display_name": "user3237465", "link": "https://stackoverflow.com/users/3237465/user3237465"}, "edited": false, "score": 0, "creation_date": 1463695196, "post_id": 37293295, "comment_id": 62187277, "body": "@user3237465 I like this one the most."}], "tags": [], "owner": {"reputation": 100185, "user_id": 3234959, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/93bb12ca0f93dfddb33880316f7e66c2?s=128&d=identicon&r=PG&f=1", "display_name": "chi", "link": "https://stackoverflow.com/users/3234959/chi"}, "is_accepted": false, "score": 2, "last_activity_date": 1463557619, "creation_date": 1463557619, "answer_id": 37293295, "question_id": 37289747, "link": "https://stackoverflow.com/questions/37289747/how-to-use-function-composition-for-foo-bar-x-bar-y-in-haskell/37293295#37293295", "title": "How to use function composition for `foo (bar x) (bar y)` in Haskell?", "body": "<p>A <code>Control.Arrow</code> alternative:</p>\n\n<pre><code>curry (uncurry f . (g *** g))\n</code></pre>\n\n<p>Not as readable as the previously posted solutions.</p>\n"}, {"comments": [{"owner": {"reputation": 31218, "user_id": 211160, "user_type": "registered", "accept_rate": 92, "profile_image": "https://i.stack.imgur.com/Z2fk7.png?s=128&g=1", "display_name": "HostileFork says dont trust SE", "link": "https://stackoverflow.com/users/211160/hostilefork-says-dont-trust-se"}, "edited": false, "score": 0, "creation_date": 1463688264, "post_id": 37329756, "comment_id": 62184120, "body": "That&#39;s interesting (and yet another distinct interpretation of the OP&#39;s intent with the question...which may be the right one, though it would suggest the framing should have been <b>foo (bar x) (baz y)</b>)"}], "tags": [], "owner": {"reputation": 13362, "user_id": 260584, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/63f9744d1d903eef5f9954fa31d25a26?s=128&d=identicon&r=PG", "display_name": "erisco", "link": "https://stackoverflow.com/users/260584/erisco"}, "is_accepted": false, "score": 2, "last_activity_date": 1464744542, "last_edit_date": 1464744542, "creation_date": 1463677402, "answer_id": 37329756, "question_id": 37289747, "link": "https://stackoverflow.com/questions/37289747/how-to-use-function-composition-for-foo-bar-x-bar-y-in-haskell/37329756#37329756", "title": "How to use function composition for `foo (bar x) (bar y)` in Haskell?", "body": "<p>Pointless equivalences for <code>\\x y -&gt; foo (bar x) (bar y)</code>:</p>\n\n<ul>\n<li><p><a href=\"http://hackage.haskell.org/package/data-function-meld-0.1.1.0\" rel=\"nofollow\">Data.Function.Meld</a></p>\n\n<pre><code>foo $* bar $$ bar *$ id\n</code></pre></li>\n<li><p><a href=\"http://hackage.haskell.org/package/TypeCompose-0.9.11/docs/Control-Compose.html\" rel=\"nofollow\">Control.Compose</a></p>\n\n<pre><code>(bar ~&gt; bar ~&gt; id) foo\n</code></pre></li>\n<li><p><a href=\"http://hackage.haskell.org/package/data-function-tacit-0.1.0.0\" rel=\"nofollow\">Data.Function.Tacit</a> (uses -XTypeApplications)</p>\n\n<pre><code>lurryA @N2 (foo &lt;$&gt; (bar &lt;$&gt; _1) &lt;*&gt; (bar &lt;$&gt; _2))\nlurryA @N4 (_1 &lt;*&gt; (_2 &lt;*&gt; _3) &lt;*&gt; (_2 &lt;*&gt; _4)) foo bar\n</code></pre></li>\n</ul>\n"}], "owner": {"reputation": 204, "user_id": 4230967, "user_type": "registered", "accept_rate": 0, "profile_image": "https://i.stack.imgur.com/ofBwN.png?s=128&g=1", "display_name": "Jasin Yip", "link": "https://stackoverflow.com/users/4230967/jasin-yip"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 520, "favorite_count": 2, "answer_count": 5, "score": 7, "last_activity_date": 1464744542, "creation_date": 1463541984, "last_edit_date": 1463545418, "question_id": 37289747, "link": "https://stackoverflow.com/questions/37289747/how-to-use-function-composition-for-foo-bar-x-bar-y-in-haskell", "title": "How to use function composition for `foo (bar x) (bar y)` in Haskell?", "body": "<p>I know that in Haskell, there is a awesome feature called <strong>function composition</strong> so that we could make our Haskell code pithier, like:</p>\n\n<ul>\n<li>use <code>(f . g) x</code> instead of <code>f (g x)</code>, </li>\n<li>use <code>foo x $ bar y z</code> instead of <code>foo x (bar y z)</code></li>\n</ul>\n\n<p>But is it possible that we could use function composition for <code>foo (bar x) (bar y)</code>?</p>\n"}, {"tags": ["haskell", "functional-programming"], "comments": [{"owner": {"reputation": 9772, "user_id": 3963, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/9pDQ8.png?s=128&g=1", "display_name": "hao", "link": "https://stackoverflow.com/users/3963/hao"}, "edited": false, "score": 2, "creation_date": 1463527938, "post_id": 37287749, "comment_id": 62100618, "body": "1. You have <code>FilePath -&gt; IO (Digest MD5)</code>. Get a <code>FilePath -&gt; IO (Digest MD5, FilePath)</code> // 2. Next, build up a <code>[IO (Digest MD5, FilePath)]</code> list // 3. Use the Traversable class to get a <code>IO [(Digest MD5, FilePath)]</code> // 4. Use Functor and <code>categorize</code> to get the desired <code>IO (Map (Digest MD5) [FilePath])</code>"}], "answers": [{"comments": [{"owner": {"reputation": 25144, "user_id": 477476, "user_type": "registered", "accept_rate": 85, "profile_image": "https://i.stack.imgur.com/Qf4TT.png?s=128&g=1", "display_name": "Cactus", "link": "https://stackoverflow.com/users/477476/cactus"}, "reply_to_user": {"reputation": 137, "user_id": 6347234, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/f1c5fa9b06d9a75bead47c20bac81cff?s=128&d=identicon&r=PG&f=1", "display_name": "And Pos", "link": "https://stackoverflow.com/users/6347234/and-pos"}, "edited": false, "score": 0, "creation_date": 1463536803, "post_id": 37287869, "comment_id": 62102650, "body": "@AndPos: &quot;it helped me understand how to work with monads&quot; but one of the important points here should be that you do <i>not</i> need a monad for this, an applicative functor suffices."}, {"owner": {"reputation": 126897, "user_id": 791604, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/ce991df7a056248d5e4f6fc3659ba733?s=128&d=identicon&r=PG", "display_name": "Daniel Wagner", "link": "https://stackoverflow.com/users/791604/daniel-wagner"}, "reply_to_user": {"reputation": 25144, "user_id": 477476, "user_type": "registered", "accept_rate": 85, "profile_image": "https://i.stack.imgur.com/Qf4TT.png?s=128&g=1", "display_name": "Cactus", "link": "https://stackoverflow.com/users/477476/cactus"}, "edited": false, "score": 0, "creation_date": 1463537253, "post_id": 37287869, "comment_id": 62102753, "body": "@Cactus I disagree that this is an important point. It is a point, but it is a subtle one and probably not important at all for 99% of applications, compared to the importance of understanding how to use the <code>Monad</code>-related interfaces to use <code>IO</code>, which needs to be done in 100% of useful applications."}, {"owner": {"reputation": 25144, "user_id": 477476, "user_type": "registered", "accept_rate": 85, "profile_image": "https://i.stack.imgur.com/Qf4TT.png?s=128&g=1", "display_name": "Cactus", "link": "https://stackoverflow.com/users/477476/cactus"}, "reply_to_user": {"reputation": 126897, "user_id": 791604, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/ce991df7a056248d5e4f6fc3659ba733?s=128&d=identicon&r=PG", "display_name": "Daniel Wagner", "link": "https://stackoverflow.com/users/791604/daniel-wagner"}, "edited": false, "score": 2, "creation_date": 1463537333, "post_id": 37287869, "comment_id": 62102772, "body": "@DanielWagner: I think monadic interfaces are overrepresented in beginner&#39;s materials so I never pass up an opportunity to advocate for applicative ones."}], "tags": [], "owner": {"reputation": 37219, "user_id": 1523776, "user_type": "moderator", "accept_rate": 87, "profile_image": "https://www.gravatar.com/avatar/b3e0b5c8e42a8c38009ef2d969f8dabb?s=128&d=identicon&r=PG", "display_name": "Benjamin Hodgson", "link": "https://stackoverflow.com/users/1523776/benjamin-hodgson"}, "is_accepted": true, "score": 6, "last_activity_date": 1463562682, "last_edit_date": 1463562682, "creation_date": 1463528196, "answer_id": 37287869, "question_id": 37287749, "link": "https://stackoverflow.com/questions/37287749/how-to-compose-function-and-monad-action-in-haskell/37287869#37287869", "title": "How to compose function and monad action in Haskell", "body": "<p>Let's carefully compare the types of <code>hashFile</code> with the type of <code>categorize</code>, bearing in mind that we want to pass <code>hashFile</code> as an argument to <code>categorize</code></p>\n\n<pre><code>hashFile ::             FilePath -&gt; IO (Digest MD5)  -- I simplified the MonadIO constraint\ncategorize :: Ord k =&gt; (    a    -&gt;        k       ) -&gt; [a] -&gt; M.Map k [a]\n</code></pre>\n\n<p><code>categorize hashFile</code> won't type-check because GHC will try to match <code>k</code> with <code>IO (Digest MD5)</code>, but <code>IO</code> has no <code>Ord</code> instance. To put it another way, <code>IO (Digest MD5)</code> is useless as a key to a <code>Map</code>: what you need is <code>Digest MD5</code>s, not computations which will eventually produce <code>Digest MD5</code>s when you execute them.</p>\n\n<p>What you really want to do is run all the <code>IO</code> computations and put their results (of type <code>Digest MD5</code>) into the <code>Map</code>. The resulting function would return <code>IO (Map (Digest MD5) FilePath)</code> - an <code>IO</code> computation which will return a <code>Map (Digest MD5) FilePath</code> when you run it.</p>\n\n<hr>\n\n<p>The easiest way to do this is to adjust <code>categorize</code> to fit the type we need.</p>\n\n<pre><code>categorize :: (Applicative f, Ord k) =&gt; (a -&gt; f k) -&gt; [a] -&gt; f (M.Map k a)\ncategorize f = fmap M.fromList . traverse (\\x -&gt; fmap (, x) (f x))\n</code></pre>\n\n<p>(I'm using <a href=\"https://downloads.haskell.org/~ghc/latest/docs/html/users_guide/syntax-extns.html#tuple-sections\" rel=\"nofollow\"><code>TupleSections</code></a>.) First let's look at the type. Since <code>IO</code> is an instance of <code>Applicative</code>, <code>(a -&gt; f k)</code> unifies with <code>FilePath -&gt; IO (Digest MD5)</code> under the following constraints:</p>\n\n<pre><code>a ~ FilePath\nf ~ IO\nk ~ Digest MD5\n</code></pre>\n\n<p>So <code>categorize hashFile :: [FilePath] -&gt; IO (M.Map (Digest MD5) FilePath)</code>, which is the type we want.</p>\n\n<p>Now let's look at the implementation. <a href=\"https://hackage.haskell.org/package/base-4.8.2.0/docs/Data-Traversable.html#v:traverse\" rel=\"nofollow\"><code>traverse :: Applicative f =&gt; (a -&gt; f b) -&gt; [a] -&gt; f [b]</code></a>* (n\u00e9e <a href=\"http://hackage.haskell.org/package/base-4.8.2.0/docs/Prelude.html#v:mapM\" rel=\"nofollow\"><code>mapM</code></a>) takes an <code>Applicative</code> function, maps it over the list, and smashes the results together into a list. We're using it to turn each item into an <code>(result, item)</code> tuple. This'll produce an <code>f [(k, a)]</code> value. Then I <code>fmap</code> <code>M.fromList</code> over the result to produce <code>f (M.Map k a)</code>.</p>\n\n<p><sub>*Technically, <code>traverse</code> has the more general type of <code>(Applicative f, Traversable t) =&gt; (a -&gt; f b) -&gt; t a -&gt; f (t b)</code>. I arrived at this version by taking <code>t ~ []</code>.</sub></p>\n\n<p>Because this implementation uses <code>M.fromList</code>, duplicate items will be thrown away. In practice, if you're not expecting any of the files to have the same contents, the MD5 hashes will be different so this won't be a problem. Exercise: how does this change if we want to keep duplicates?</p>\n"}], "owner": {"reputation": 137, "user_id": 6347234, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/f1c5fa9b06d9a75bead47c20bac81cff?s=128&d=identicon&r=PG&f=1", "display_name": "And Pos", "link": "https://stackoverflow.com/users/6347234/and-pos"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 205, "favorite_count": 1, "accepted_answer_id": 37287869, "answer_count": 1, "score": 4, "last_activity_date": 1463562682, "creation_date": 1463527296, "question_id": 37287749, "link": "https://stackoverflow.com/questions/37287749/how-to-compose-function-and-monad-action-in-haskell", "title": "How to compose function and monad action in Haskell", "body": "<p>I've just started learning Haskell.</p>\n\n<p>I'm creating a program that find duplicate files. I have created the following functions:</p>\n\n<pre><code>hashFile :: (MonadIO m) =&gt; FilePath -&gt; m (Digest MD5)\ncategorize :: Ord k =&gt; (a -&gt; k) -&gt; [a] -&gt; Map.Map k [a]\n</code></pre>\n\n<p>And I want to compose them in a function that return </p>\n\n<pre><code>Map.Map (Digest MD5) [FilePath]</code></pre>\n\n<p>My questions are:</p>\n\n<p>I can't find a way to deal with the IO monad to get what I want. So my questions are:</p>\n\n<ol>\n<li><p>Is what I'm trying to do correct, or should the return type would\nreally be <code>Map.Map (IO (Digest MD5)) [FilePath]</code>.</p></li>\n<li><p>How do I compose these functions together to get the list of files grouped by hash?</p></li>\n</ol>\n"}, {"tags": ["haskell"], "comments": [{"owner": {"reputation": 46235, "user_id": 2541573, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/Z1qtP.png?s=128&g=1", "display_name": "jub0bs", "link": "https://stackoverflow.com/users/2541573/jub0bs"}, "edited": false, "score": 13, "creation_date": 1463520797, "post_id": 37286376, "comment_id": 62098190, "body": "This isn&#39;t the last &quot;weird Haskell symbol&quot; you will come across :)"}, {"owner": {"reputation": 9119, "user_id": 180258, "user_type": "registered", "accept_rate": 92, "profile_image": "https://www.gravatar.com/avatar/8b3779ca7c73166d7016272086c6282f?s=128&d=identicon&r=PG", "display_name": "ron", "link": "https://stackoverflow.com/users/180258/ron"}, "edited": false, "score": 3, "creation_date": 1463549201, "post_id": 37286376, "comment_id": 62106080, "body": "FYI symbolhound (<a href=\"http://symbolhound.com/?q=%3C%24%3E+haskell\" rel=\"nofollow noreferrer\">symbolhound.com/?q=%3C%24%3E+haskell</a>) or more specifically hoogle (<a href=\"https://www.haskell.org/hoogle/?hoogle=%3C%24%3E\" rel=\"nofollow noreferrer\">haskell.org/hoogle/?hoogle=%3C%24%3E</a>) are useful in this situation."}, {"owner": {"reputation": 44013, "user_id": 1477667, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/trgKM.jpg?s=128&g=1", "display_name": "dfeuer", "link": "https://stackoverflow.com/users/1477667/dfeuer"}, "edited": false, "score": 2, "creation_date": 1568132975, "post_id": 37286376, "comment_id": 102174664, "body": "It means money, more or less!"}], "answers": [{"comments": [{"owner": {"reputation": 42755, "user_id": 116639, "user_type": "registered", "accept_rate": 25, "profile_image": "https://www.gravatar.com/avatar/30700279c97553494d9479ec7d667483?s=128&d=identicon&r=PG", "display_name": "Tom Anderson", "link": "https://stackoverflow.com/users/116639/tom-anderson"}, "edited": false, "score": 36, "creation_date": 1542643556, "post_id": 37286470, "comment_id": 93632607, "body": "The top result for &quot;Haskell &lt;$&gt;&quot; on Google is now this page, so in a sense, Google is now a perfectly good search engine in this case!"}, {"owner": {"reputation": 5662, "user_id": 4121347, "user_type": "registered", "accept_rate": 82, "profile_image": "https://i.stack.imgur.com/g5Fn4.jpg?s=128&g=1", "display_name": "dryairship", "link": "https://stackoverflow.com/users/4121347/dryairship"}, "edited": false, "score": 4, "creation_date": 1589049998, "post_id": 37286470, "comment_id": 109140744, "body": "I like that you used the dagger symbol to denote that Hayoo has been dead for some time."}], "tags": [], "owner": {"reputation": 100892, "user_id": 745903, "user_type": "registered", "accept_rate": 74, "profile_image": "https://www.gravatar.com/avatar/50933f6638836741e620669b3940410e?s=128&d=identicon&r=PG", "display_name": "leftaroundabout", "link": "https://stackoverflow.com/users/745903/leftaroundabout"}, "is_accepted": true, "score": 84, "last_activity_date": 1568043358, "last_edit_date": 1568043358, "creation_date": 1463520241, "answer_id": 37286470, "question_id": 37286376, "link": "https://stackoverflow.com/questions/37286376/what-does-mean-in-haskell/37286470#37286470", "title": "What does &lt;$&gt; mean in Haskell?", "body": "<p>Google is not the best search engine for Haskell. Try <a href=\"https://www.haskell.org/hoogle/?hoogle=%3C%24%3E\" rel=\"noreferrer\">Hoogle</a> <del>or <a href=\"http://hayoo.fh-wedel.de/?query=%3C%24%3E\" rel=\"noreferrer\">Hayoo</a></del><sup>\u2020</sup>, both will point you right away <a href=\"http://hackage.haskell.org/package/base-4.8.2.0/docs/Data-Functor.html#v:-60--36--62-\" rel=\"noreferrer\">to this:</a></p>\n\n<pre><code>(&lt;$&gt;) :: Functor f =&gt; (a-&gt;b) -&gt; f a -&gt; f b\n</code></pre>\n\n<p>It's merely an infix synonym for <a href=\"http://hackage.haskell.org/package/base-4.8.2.0/docs/Data-Functor.html#v:fmap\" rel=\"noreferrer\"><code>fmap</code></a>, so you can write e.g.</p>\n\n<pre><code>Prelude&gt; (*2) &lt;$&gt; [1..3]\n[2,4,6]\nPrelude&gt; show &lt;$&gt; Just 11\nJust \"11\"\n</code></pre>\n\n<p>Like most infix functions, it is <em>not</em> built-in syntax, just a function definition. But functors are such a fundamental tool that <code>&lt;$&gt;</code> is found pretty much everywhere.</p>\n\n<hr>\n\n<p><sup>\u2020</sup><sub>Hayoo has been offline for quite a while now.</sub></p>\n"}], "owner": {"reputation": 799, "user_id": 5622573, "user_type": "registered", "accept_rate": 83, "profile_image": "https://www.gravatar.com/avatar/a84daeca68163b07118fc0cef7776efb?s=128&d=identicon&r=PG&f=1", "display_name": "prometheus21", "link": "https://stackoverflow.com/users/5622573/prometheus21"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 23433, "favorite_count": 9, "accepted_answer_id": 37286470, "answer_count": 1, "score": 59, "last_activity_date": 1568043358, "creation_date": 1463519783, "last_edit_date": 1464485007, "question_id": 37286376, "link": "https://stackoverflow.com/questions/37286376/what-does-mean-in-haskell", "title": "What does &lt;$&gt; mean in Haskell?", "body": "<p>While reading a piece of Haskell code I came upon this: <code>&lt;$&gt;</code>. What does it mean in Haskell? After some google searches I remain in the dark.</p>\n"}, {"tags": ["haskell"], "comments": [{"owner": {"reputation": 126897, "user_id": 791604, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/ce991df7a056248d5e4f6fc3659ba733?s=128&d=identicon&r=PG", "display_name": "Daniel Wagner", "link": "https://stackoverflow.com/users/791604/daniel-wagner"}, "edited": false, "score": 3, "creation_date": 1463519392, "post_id": 37284703, "comment_id": 62097517, "body": "You are going to <i>love</i> the paper <a href=\"http://citeseerx.ist.psu.edu/viewdoc/summary?doi=10.1.1.46.2207\" rel=\"nofollow noreferrer\">&quot;Manufacturing Datatypes&quot;</a> by Ralf Hinze. The first two sentences of the abstract are &quot;This paper describes a general framework for designing purely functional datatypes that automatically satisfy given size or structural constraints. Using the framework we develop implementations of different matrix types.&quot;."}], "answers": [{"comments": [{"owner": {"reputation": 355, "user_id": 4348117, "user_type": "registered", "accept_rate": 70, "profile_image": "https://www.gravatar.com/avatar/a88d7b140a8c1fec328e9d7ea4c0d0fa?s=128&d=identicon&r=PG&f=1", "display_name": "Mark Anastos", "link": "https://stackoverflow.com/users/4348117/mark-anastos"}, "edited": false, "score": 0, "creation_date": 1463519739, "post_id": 37285064, "comment_id": 62097705, "body": "Thanks! Does the line <code>( UInt</code> import only the data type <code>UInt</code> and not the constructor <code>UInt</code>?"}, {"owner": {"reputation": 51584, "user_id": 839246, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/9b0573c2b936b12828dd1e4cc04206dc?s=128&d=identicon&r=PG&f=1", "display_name": "bheklilr", "link": "https://stackoverflow.com/users/839246/bheklilr"}, "reply_to_user": {"reputation": 355, "user_id": 4348117, "user_type": "registered", "accept_rate": 70, "profile_image": "https://www.gravatar.com/avatar/a88d7b140a8c1fec328e9d7ea4c0d0fa?s=128&d=identicon&r=PG&f=1", "display_name": "Mark Anastos", "link": "https://stackoverflow.com/users/4348117/mark-anastos"}, "edited": false, "score": 2, "creation_date": 1463520003, "post_id": 37285064, "comment_id": 62097820, "body": "@MarkAnastos it only exports the type, allowing other modules to import it. You would have to specify it as UInt(UInt) or UInt(..) to export the specific constructor or all constructors respectively."}], "tags": [], "owner": {"reputation": 51584, "user_id": 839246, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/9b0573c2b936b12828dd1e4cc04206dc?s=128&d=identicon&r=PG&f=1", "display_name": "bheklilr", "link": "https://stackoverflow.com/users/839246/bheklilr"}, "is_accepted": true, "score": 8, "last_activity_date": 1463514551, "creation_date": 1463514551, "answer_id": 37285064, "question_id": 37284703, "link": "https://stackoverflow.com/questions/37284703/how-to-perform-checks-on-data-type-construction/37285064#37285064", "title": "How to perform checks on data type construction", "body": "<p>No, there is no way to enforce what values a user passes to a constructor.</p>\n\n<p>However, there is a common practice in the community and standard library of creating <em>smart constructors</em>.  You see these in modules like <code>Data.Map</code>, <code>Data.Ratio</code>, and many more.  Simply put, you don't export the constructor itself, just the type, and you export a function which vets the arguments:</p>\n\n<pre><code>module UInt\n    ( UInt\n    , uint\n    ) where\n\ndata UInt = UInt Int\n\nuint :: Int -&gt; Maybe UInt\nuint x | x &gt;= 0 = Just (UInt x)\n       | otherwise = Nothing\n</code></pre>\n"}], "owner": {"reputation": 355, "user_id": 4348117, "user_type": "registered", "accept_rate": 70, "profile_image": "https://www.gravatar.com/avatar/a88d7b140a8c1fec328e9d7ea4c0d0fa?s=128&d=identicon&r=PG&f=1", "display_name": "Mark Anastos", "link": "https://stackoverflow.com/users/4348117/mark-anastos"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 66, "favorite_count": 0, "accepted_answer_id": 37285064, "answer_count": 1, "score": 5, "last_activity_date": 1463514551, "creation_date": 1463513198, "question_id": 37284703, "link": "https://stackoverflow.com/questions/37284703/how-to-perform-checks-on-data-type-construction", "title": "How to perform checks on data type construction", "body": "<p>For a data type constructor, is there any way to limit the creation of the \"object\" (I don't know the proper term) based on criteria other than the types of the arguments to the constructor?</p>\n\n<p>For instance:</p>\n\n<pre><code>data UInt = UInt Int --the int must be &gt;= 0\n</code></pre>\n\n<p>Truly, I would like to create a data type for rectangular multidimensional lists (in which all the sublists have the same length). Would a class or some other technique be better suited for this?</p>\n"}, {"tags": ["haskell", "dependent-type", "type-level-computation"], "answers": [{"tags": [], "owner": {"reputation": 28873, "user_id": 1068232, "user_type": "registered", "accept_rate": 79, "profile_image": "https://www.gravatar.com/avatar/2a0a145ce58c20013969fe3f203531da?s=128&d=identicon&r=PG", "display_name": "Andr&#225;s Kov&#225;cs", "link": "https://stackoverflow.com/users/1068232/andr%c3%a1s-kov%c3%a1cs"}, "is_accepted": true, "score": 4, "last_activity_date": 1463509615, "creation_date": 1463509615, "answer_id": 37283716, "question_id": 37283403, "link": "https://stackoverflow.com/questions/37283403/type-level-environment-in-haskell/37283716#37283716", "title": "Type level environment in Haskell", "body": "<p><code>In</code> generates impossible constraints:</p>\n\n<pre><code>In \"b\" Char '['(\"a\", Bool), '(\"b\", Char)] =\n(\"b\" ~ \"a\", (\"b\" ~ \"b\", ())\n</code></pre>\n\n<p>It's a conjunction and it has an impossible element <code>\"a\" ~ \"b\"</code>, so it's impossible overall. </p>\n\n<p>Moreover, the constraint doesn't tell us anything about <code>Char</code> which I assume is the looked-up value. </p>\n\n<p>The simplest way would be directly using a lookup function:</p>\n\n<pre><code>type family Lookup (s :: Symbol) (env :: [(Symbol, *)]) :: * where\n  Lookup s ('(s  , v) ': env) = v\n  Lookup s ('(s' , v) ': env) = Lookup s env\n</code></pre>\n\n<p>We can use <code>Lookup k xs ~ val</code> to put constraints on the looked-up types.</p>\n\n<p>We could also return <code>Maybe *</code>. Indeed, the <code>Lookup</code> in <code>Data.Singletons.Prelude.List</code> does that, so that can be used too. However, on the type level we can often get by with partial functions, since type family applications without a matching case get stuck instead of throwing errors, so having a value of type <code>Lookup k xs :: *</code> is already sufficient evidence that <code>k</code> is really a key contained in <code>xs</code>. </p>\n"}, {"comments": [{"owner": {"reputation": 44013, "user_id": 1477667, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/trgKM.jpg?s=128&g=1", "display_name": "dfeuer", "link": "https://stackoverflow.com/users/1477667/dfeuer"}, "edited": false, "score": 1, "creation_date": 1463540794, "post_id": 37286382, "comment_id": 62103602, "body": "You&#39;re going to get a lot of angry Forth programmers!"}], "tags": [], "owner": {"reputation": 37219, "user_id": 1523776, "user_type": "moderator", "accept_rate": 87, "profile_image": "https://www.gravatar.com/avatar/b3e0b5c8e42a8c38009ef2d969f8dabb?s=128&d=identicon&r=PG", "display_name": "Benjamin Hodgson", "link": "https://stackoverflow.com/users/1523776/benjamin-hodgson"}, "is_accepted": false, "score": 6, "last_activity_date": 1463759228, "last_edit_date": 1495541279, "creation_date": 1463519822, "answer_id": 37286382, "question_id": 37283403, "link": "https://stackoverflow.com/questions/37283403/type-level-environment-in-haskell/37286382#37286382", "title": "Type level environment in Haskell", "body": "<p>Your <code>In</code> is not what you think - it's actually more like <code>All</code>. A value of type <code>In x t xs</code> is a proof that <em>every</em> element of the (type-level) list <code>xs</code> is equal to <code>'(x,t)</code>.</p>\n\n<p>The following GADT is a more usual proof of membership:</p>\n\n<pre><code>data Elem x xs where\n    Here :: Elem x (x ': xs)\n    There :: Elem x xs -&gt; Elem y (x ': xs)\n</code></pre>\n\n<p><code>Elem</code> is like a natural number but with more types: compare the shape of <code>There (There Here)</code> with that of <code>S (S Z)</code>. You prove an item is in the list by giving its index.</p>\n\n<p>For the purposes of writing a lambda calculus type checker, <code>Elem</code> is useful as a <a href=\"https://en.m.wikipedia.org/wiki/De_Bruijn_index\" rel=\"nofollow noreferrer\">de Bruijn index</a> into a (type-level) list of types.</p>\n\n<pre><code>data Ty = NatTy | Ty ~&gt; Ty\n\ndata Term env ty where\n    Lit :: Nat -&gt; Term env NatTy\n    Var :: Elem t env -&gt; Term env t\n    Lam :: Term (u ': env) t -&gt; Term env (u ~&gt; t)\n    ($$) :: Term env (u ~&gt; t) -&gt; Term env u -&gt; Term env t\n</code></pre>\n\n<p>de Bruijn indices have great advantages for compiler writers: they're simple, you needn't worry about <a href=\"https://en.wikipedia.org/wiki/Lambda_calculus#Alpha_equivalence\" rel=\"nofollow noreferrer\">alpha-equivalence</a>, and in this example you don't have to mess around with type-level lookup tables or <code>Symbol</code>s. But no one in their right mind would ever program in a language with de Bruijn indices, even with a type checker to help. This makes them a good choice for an intermediate language in a compiler, to which you'd translate a surface language with explicit variable names.</p>\n\n<p>Type-level environments and de Bruijn indices are both rather complicated, so you should ask yourself: <em>who is the target audience for this language?</em> (and: <em>is a type-level environment worth the costs?</em>) Is it an embedded DSL with expectations of familiarity, simplicity, and performance? If so I'd consider a deeper embedding using <a href=\"http://www.cs.cmu.edu/afs/cs/Web/People/fp/papers/pldi88.pdf\" rel=\"nofollow noreferrer\">higher-order abstract syntax</a>. Or is it to be used as an intermediate language, for whom the primary audience is yourself, the compiler writer? Then I'd use a library like Kmett's <a href=\"https://www.schoolofhaskell.com/user/edwardk/bound\" rel=\"nofollow noreferrer\"><code>bound</code></a> to take care of variable binding and suck up the possibility of type errors because they could happen anyway.</p>\n\n<p>For more on type-level environments <em>et al</em>, see <a href=\"http://strictlypositive.org/vfl.pdf\" rel=\"nofollow noreferrer\">The View from the Left</a> for (as far as I know) the first example of a statically-checked lambda calculus type-checker embedded in a dependently-typed programming language. Norell gives an Agda-flavoured exposition of the same program in <a href=\"http://www.cse.chalmers.se/~ulfn/papers/afp08/tutorial.pdf\" rel=\"nofollow noreferrer\">the Agda tutorial</a> and <a href=\"https://www.youtube.com/watch?v=NrSW7YsneVg\" rel=\"nofollow noreferrer\">a series of lectures</a>. See also <a href=\"https://stackoverflow.com/q/33975270/1523776\">this question</a> which seems relevant to your use-case.</p>\n"}], "owner": {"reputation": 2970, "user_id": 2928766, "user_type": "registered", "accept_rate": 89, "profile_image": "https://www.gravatar.com/avatar/3c5d36ca80eccb125ee34991165d481e?s=128&d=identicon&r=PG", "display_name": "Rodrigo Ribeiro", "link": "https://stackoverflow.com/users/2928766/rodrigo-ribeiro"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 349, "favorite_count": 0, "accepted_answer_id": 37283716, "answer_count": 2, "score": 2, "last_activity_date": 1463759228, "creation_date": 1463508527, "question_id": 37283403, "link": "https://stackoverflow.com/questions/37283403/type-level-environment-in-haskell", "title": "Type level environment in Haskell", "body": "<p>I'm trying to use some Haskell extensions to implement a simple DSL. A feature that I'd like is to have a type level context for variables. \nI know that this kind of thing is common place in languages like Agda or Idris. But I'd like to know if is possible to achieve the same results in Haskell.</p>\n\n<p>My idea to this is to use type level association lists. The code is as follows:</p>\n\n<pre><code>{-# LANGUAGE GADTs, \n         DataKinds, \n         PolyKinds, \n         TypeOperators, \n         TypeFamilies, \n         ScopedTypeVariables, \n         ConstraintKinds, \n         UndecidableInstances #-}\n\nimport Data.Proxy    \nimport Data.Singletons.Prelude   \nimport Data.Singletons.Prelude.List\n\nimport GHC.Exts    \nimport GHC.TypeLits\n\ntype family In (s :: Symbol)(a :: *)(env :: [(Symbol, *)]) :: Constraint where\n     In x t '[] = ()\n     In x t ('(y,t) ': env) = (x ~ y , In x t env)\n\n\ndata Exp (env :: [(Symbol, *)]) (a :: *) where\n     Pure :: a -&gt; Exp env a\n     Map  :: (a -&gt; b) -&gt; Exp env a -&gt; Exp env b        \n     App  :: Exp env (a -&gt; b) -&gt; Exp env a -&gt; Exp env b        \n     Set :: (KnownSymbol s, In s t env) =&gt; proxy s -&gt; t -&gt; Exp env ()\n     Get :: (KnownSymbol s, In s t env) =&gt; proxy s -&gt; Exp env t\n\n\ntest :: Exp '[ '(\"a\", Bool), '(\"b\", Char) ]  Char\ntest = Get (Proxy :: Proxy \"b\")        \n</code></pre>\n\n<p>Type family <code>In</code> models a type level list membership constraint that is used to ensure that a variable can only be used if it is on a given environment <code>env</code>.</p>\n\n<p>The problem is that GHC constraint solver isn't able to entail the constraint\n<code>In \"b\" Char [(\"a\",Bool), (\"b\",Char)]</code> for <code>test</code> function, giving the following error message:</p>\n\n<pre><code>Could not deduce (In \"b\" Char '['(\"a\", Bool), '(\"b\", Char)])\n   arising from a use of \u2018Get\u2019\nIn the expression: Get (Proxy :: Proxy \"b\")\nIn an equation for \u2018test\u2019: test = Get (Proxy :: Proxy \"b\")\nFailed, modules loaded: Main.\n</code></pre>\n\n<p>I'm using GHC 7.10.3. Any tip on how can I solve this or an explanation of why this isn't possible is highly welcome. </p>\n"}, {"tags": ["haskell"], "comments": [{"owner": {"reputation": 659, "user_id": 6067119, "user_type": "registered", "accept_rate": 20, "profile_image": "https://www.gravatar.com/avatar/893dbce2becf20ee2a3dcb6dee6ea5f2?s=128&d=identicon&r=PG&f=1", "display_name": "Qwertford", "link": "https://stackoverflow.com/users/6067119/qwertford"}, "edited": false, "score": 0, "creation_date": 1463503107, "post_id": 37281847, "comment_id": 62089034, "body": "I know i could do it like, look at list, remove element, then add it to the front with two functions, but Id like to do it with one."}, {"owner": {"reputation": 126897, "user_id": 791604, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/ce991df7a056248d5e4f6fc3659ba733?s=128&d=identicon&r=PG", "display_name": "Daniel Wagner", "link": "https://stackoverflow.com/users/791604/daniel-wagner"}, "edited": false, "score": 0, "creation_date": 1463506838, "post_id": 37281847, "comment_id": 62091036, "body": "<code>putfront x xs = x:delete x xs</code>? I put this as a comment rather than an answer because, while it demonstrates an alternate approach that I strongly encourage, it does not answer the question of &quot;what is wrong?&quot;."}], "answers": [{"tags": [], "owner": {"reputation": 34669, "user_id": 34409, "user_type": "registered", "accept_rate": 64, "profile_image": "https://www.gravatar.com/avatar/4dfdadcd9bb62300eb1a54f02fe5dc18?s=128&d=identicon&r=PG", "display_name": "Chad Gilbert", "link": "https://stackoverflow.com/users/34409/chad-gilbert"}, "is_accepted": false, "score": 2, "last_activity_date": 1463503631, "last_edit_date": 1463503631, "creation_date": 1463503238, "answer_id": 37281977, "question_id": 37281847, "link": "https://stackoverflow.com/questions/37281847/find-element-from-list-and-put-to-front-while-preserving-order/37281977#37281977", "title": "find element from list and put to front, while preserving order", "body": "<blockquote>\n  <p>But Haskell doesn't seem to be too happy with:</p>\n\n<pre><code>thecolour:leftofcurrent:rightofcurrent\n</code></pre>\n</blockquote>\n\n<p>That's because <code>leftofcurrent</code> is a List. If you want to combine those lists, it needs to be:</p>\n\n\n\n<pre class=\"lang-haskell prettyprint-override\"><code>(thecolour:leftofcurrent) ++ rightofcurrent\n</code></pre>\n\n<p>Likewise, <code>(leftofcurrent:current:[])</code> is impossible because <code>leftofcurrent</code> is a List, but this is probably what you're after:</p>\n\n<pre class=\"lang-haskell prettyprint-override\"><code>leftofcurrent ++ [current]\n</code></pre>\n\n<p>The cons operator <code>:</code> expects a single element on the left and a list on the right. But because of its fixity, you can chain them together so that a bunch of single items are separated by <code>:</code> and ended with a list. That is,</p>\n\n<pre class=\"lang-haskell prettyprint-override\"><code>item1:item2:item3:[]\n-- is the same as\nitem1:(item2:(item3:[]))\n</code></pre>\n\n<p>Also, your pattern matching is non-exhaustive. You need to handle the case where the second list parameter is empty.</p>\n\n<pre class=\"lang-haskell prettyprint-override\"><code>putfront leftofcurrent [] thecolour = ...\n</code></pre>\n"}, {"comments": [{"owner": {"reputation": 659, "user_id": 6067119, "user_type": "registered", "accept_rate": 20, "profile_image": "https://www.gravatar.com/avatar/893dbce2becf20ee2a3dcb6dee6ea5f2?s=128&d=identicon&r=PG&f=1", "display_name": "Qwertford", "link": "https://stackoverflow.com/users/6067119/qwertford"}, "edited": false, "score": 0, "creation_date": 1463516278, "post_id": 37282096, "comment_id": 62095923, "body": "I was told that, even though not by much, it is better to do things in single functions because it takes the computer time to match higher order functions."}], "tags": [], "owner": {"reputation": 11780, "user_id": 2827654, "user_type": "registered", "accept_rate": 57, "profile_image": "https://www.gravatar.com/avatar/a171742e9c31a541d4d2031af932e94a?s=128&d=identicon&r=PG&f=1", "display_name": "jamshidh", "link": "https://stackoverflow.com/users/2827654/jamshidh"}, "is_accepted": false, "score": 0, "last_activity_date": 1463503723, "creation_date": 1463503723, "answer_id": 37282096, "question_id": 37281847, "link": "https://stackoverflow.com/questions/37281847/find-element-from-list-and-put-to-front-while-preserving-order/37282096#37282096", "title": "find element from list and put to front, while preserving order", "body": "<p>I actually think that your best soln is to remove the item and put it at the front of the list, as you mention in the comment.  Given that you don't like this, may I suggest the following</p>\n\n<pre><code>sortBy (\\x y -&gt; case (x, y) of (_, theColour) -&gt; GT; (x, y) -&gt;LT) listOfColours\n</code></pre>\n"}, {"tags": [], "owner": {"reputation": 62252, "user_id": 1435869, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/TrEd9.jpg?s=128&g=1", "display_name": "karakfa", "link": "https://stackoverflow.com/users/1435869/karakfa"}, "is_accepted": false, "score": 1, "last_activity_date": 1463510834, "last_edit_date": 1463510834, "creation_date": 1463504163, "answer_id": 37282211, "question_id": 37281847, "link": "https://stackoverflow.com/questions/37281847/find-element-from-list-and-put-to-front-while-preserving-order/37282211#37282211", "title": "find element from list and put to front, while preserving order", "body": "<p>I would write it as follows</p>\n\n<pre><code>putfront :: (Eq a) =&gt; a -&gt; [a] -&gt; [a]\nputfront a x | a `elem` x = a: filter (not . (==a)) x\n             | otherwise = x\n\n&gt; putfront 4 [1..8]\n[4,1,2,3,5,6,7,8]\n</code></pre>\n\n<p>you can recursively write it as well</p>\n\n<pre><code>putfront a x = bubble [] x\n         where bubble p [] = p\n               bubble p (s:ss) | a==s = a:p++ss\n                               | otherwise = bubble (p++[s]) ss\n&gt; putfront 3 [1..5]\n[3,1,2,4,5]\n\n&gt; putfront 7 [1..5]\n[1,2,3,4,5]\n</code></pre>\n"}], "owner": {"reputation": 659, "user_id": 6067119, "user_type": "registered", "accept_rate": 20, "profile_image": "https://www.gravatar.com/avatar/893dbce2becf20ee2a3dcb6dee6ea5f2?s=128&d=identicon&r=PG&f=1", "display_name": "Qwertford", "link": "https://stackoverflow.com/users/6067119/qwertford"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 69, "favorite_count": 0, "answer_count": 3, "score": 0, "last_activity_date": 1463510834, "creation_date": 1463502874, "question_id": 37281847, "link": "https://stackoverflow.com/questions/37281847/find-element-from-list-and-put-to-front-while-preserving-order", "title": "find element from list and put to front, while preserving order", "body": "<p>Im trying to make a function that takes a list of colours and a specific colour as input. It will look through the list of colours until it finds the specific colour and put it in the front. I want to do this all while perserving the order of the rest of the numbers. </p>\n\n<p>So for example:</p>\n\n<pre><code>putfront [] (red:blue:green:yellow:white:pink:orange:[]) yellow\n</code></pre>\n\n<p>returns</p>\n\n<pre><code>yellow:red:blue:green:white:pink:orange:[]\n</code></pre>\n\n<p>This is my attempt:</p>\n\n<pre><code>putfront::[Colour]-&gt;[Colour]-&gt;Colour-&gt; [Colour]\nputfront leftofcurrent (current:rightofcurrent) thecolour\n    |current==thecolour = thecolour:leftofcurrent:rightofcurrent\n    |otherwise= putfront (leftofcurrent:current:[]) rightofcurrent thecolour\n</code></pre>\n\n<p>But Haskell doesn't seem to be too happy with:</p>\n\n<pre><code>thecolour:leftofcurrent:rightofcurrent\n</code></pre>\n\n<p>and</p>\n\n<pre><code>(leftofcurrent:current:[])\n</code></pre>\n\n<p>saying:</p>\n\n<blockquote>\n  <p>Expected type: Pond_Ix\n        Actual type: [Pond_Ix]</p>\n</blockquote>\n\n<p>What is wrong?</p>\n"}, {"tags": ["haskell"], "comments": [{"owner": {"reputation": 126897, "user_id": 791604, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/ce991df7a056248d5e4f6fc3659ba733?s=128&d=identicon&r=PG", "display_name": "Daniel Wagner", "link": "https://stackoverflow.com/users/791604/daniel-wagner"}, "edited": false, "score": 0, "creation_date": 1463516825, "post_id": 37279777, "comment_id": 62096209, "body": "Given the type of <code>myCmp1</code>, the type of <code>mySort</code> looks a bit odd -- are you sure the input and output should be <code>[Int]</code> rather than <code>[[Int]]</code>?"}, {"owner": {"reputation": 2185, "user_id": 4129091, "user_type": "registered", "accept_rate": 80, "profile_image": "https://www.gravatar.com/avatar/0f8076e78a95ed50b9ffbed42849d80e?s=128&d=identicon&r=PG&f=1", "display_name": "tsorn", "link": "https://stackoverflow.com/users/4129091/tsorn"}, "reply_to_user": {"reputation": 126897, "user_id": 791604, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/ce991df7a056248d5e4f6fc3659ba733?s=128&d=identicon&r=PG", "display_name": "Daniel Wagner", "link": "https://stackoverflow.com/users/791604/daniel-wagner"}, "edited": false, "score": 0, "creation_date": 1463519666, "post_id": 37279777, "comment_id": 62097668, "body": "Thanks, fixed. Easy to miss when constructing a generic example."}], "answers": [{"tags": [], "owner": {"reputation": 126897, "user_id": 791604, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/ce991df7a056248d5e4f6fc3659ba733?s=128&d=identicon&r=PG", "display_name": "Daniel Wagner", "link": "https://stackoverflow.com/users/791604/daniel-wagner"}, "is_accepted": true, "score": 12, "last_activity_date": 1463516795, "last_edit_date": 1463516795, "creation_date": 1463497546, "answer_id": 37279873, "question_id": 37279777, "link": "https://stackoverflow.com/questions/37279777/assigning-type-signature-as-variable/37279873#37279873", "title": "Assigning type signature as variable", "body": "<p>This is what type aliases do:</p>\n\n<pre><code>type Comparator = [Int] -&gt; [Int] -&gt; Ordering\n</code></pre>\n\n<p>They can also take arguments:</p>\n\n<pre><code>type Comparator a = a -&gt; a -&gt; Ordering\n</code></pre>\n\n<p>Then you could write, e.g.</p>\n\n<pre><code>mySort :: Comparator a -&gt; [a] -&gt; [a]\n</code></pre>\n"}], "owner": {"reputation": 2185, "user_id": 4129091, "user_type": "registered", "accept_rate": 80, "profile_image": "https://www.gravatar.com/avatar/0f8076e78a95ed50b9ffbed42849d80e?s=128&d=identicon&r=PG&f=1", "display_name": "tsorn", "link": "https://stackoverflow.com/users/4129091/tsorn"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 112, "favorite_count": 0, "accepted_answer_id": 37279873, "answer_count": 1, "score": 6, "last_activity_date": 1463519542, "creation_date": 1463497319, "last_edit_date": 1463519542, "question_id": 37279777, "link": "https://stackoverflow.com/questions/37279777/assigning-type-signature-as-variable", "title": "Assigning type signature as variable", "body": "<p>Let's say I have a sorting algorithm and two custom comparators: </p>\n\n<pre><code>mySort :: [[Int]] -&gt; ([Int] -&gt; [Int] -&gt; Ordering) -&gt; [[Int]]\nmySort = undefined\n\nmyCmp1 :: [Int] -&gt; [Int] -&gt; Ordering\nmyCmp1 xs ys\n  | a0 &lt; b0 = LT\n  | a0 &gt; b0 = GT\n  | a1 &lt; b1 = LT\n  | a1 &gt; b1 = GT\n  | a1 == b1 = EQ where\n    a0 = head xs\n    b0 = head ys\n    a1 = last xs\n    b1 = last ys\n\nmyCmp2 :: [Int] -&gt; [Int] -&gt; Ordering\nmyCmp2 xs ys\n  | a0 &gt; b0 = LT\n  | a0 &lt; b0 = GT\n  | a1 &gt; b1 = LT\n  | a1 &lt; b1 = GT\n  | a1 == b1 = EQ where\n    a0 = head xs\n    b0 = head ys\n    a1 = last xs\n    b1 = last ys\n</code></pre>\n\n<p>Is there any way to define the type signature <code>[Int] -&gt; [Int] -&gt; Ordering</code> so that I can use it like this?</p>\n\n<pre><code>comparator = [Int] -&gt; [Int] -&gt; Ordering\n\nmySort :: [[Int]] -&gt; comparator -&gt; [[Int]]\nmySort = undefined\n</code></pre>\n"}, {"tags": ["parsing", "haskell", "indentation", "parser-combinators", "megaparsec"], "answers": [{"tags": [], "owner": {"reputation": 7134, "user_id": 3687048, "user_type": "registered", "accept_rate": 96, "profile_image": "https://i.stack.imgur.com/i0GDr.jpg?s=128&g=1", "display_name": "Mark Karpov", "link": "https://stackoverflow.com/users/3687048/mark-karpov"}, "is_accepted": false, "score": 1, "last_activity_date": 1480855248, "creation_date": 1480855248, "answer_id": 40958726, "question_id": 37279101, "link": "https://stackoverflow.com/questions/37279101/indentation-aware-parsing-of-expression-trees/40958726#40958726", "title": "Indentation-aware parsing of expression trees", "body": "<p>I'm answering since I promised to take a look at this. This problem represents a rather difficult problem for Parsec-like parsers in their current state. I probably could make it work after spending much more time that I have available, but in the slot of time I can spend answering this, I only got this far:</p>\n\n\n\n<pre class=\"lang-hs prettyprint-override\"><code>module Main (main) where\n\nimport Control.Applicative\nimport Control.Monad (void)\nimport Text.Megaparsec\nimport Text.Megaparsec.String\nimport qualified Data.List.NonEmpty    as NE\nimport qualified Text.Megaparsec.Lexer as L\n\ndata Term = Var String\n          | App [Term]\n          | Case Term [(String, Term)]\n          deriving Show\n\nscn :: Parser ()\nscn = L.space (void spaceChar) empty empty\n\nsc :: Parser ()\nsc = L.space (void $ oneOf \" \\t\") empty empty\n\nname :: Parser String\nname = try $ do\n  s &lt;- some letterChar\n  if s `elem` [\"case\", \"of\"]\n    then (unexpected . Label . NE.fromList) (\"reserved word \\\"\" ++ s ++ \"\\\"\")\n    else return s\n\nmanyTerms :: Parser [Term]\nmanyTerms = many pTerm\n\npTerm :: Parser Term\npTerm = caseBlock &lt;|&gt; app -- parse a term first\n\ncaseBlock :: Parser Term\ncaseBlock = L.indentBlock scn $ do\n  void (L.symbol sc \"case\")\n  t &lt;- Var &lt;$&gt; L.lexeme sc name -- not sure what sort of syntax case of\n       -- case expressions should have, so simplified to vars for now\n  void (L.symbol sc \"of\")\n  return (L.IndentSome Nothing (return . Case t) alt)\n\nalt :: Parser (String, Term)\nalt = L.lineFold scn $ \\sc' -&gt;\n  (,) &lt;$&gt; L.lexeme sc' name &lt;* L.symbol sc' \"-&gt;\" &lt;*&gt; pTerm -- (1)\n\napp :: Parser Term\napp = L.lineFold scn $ \\sc' -&gt;\n  App &lt;$&gt; ((Var &lt;$&gt; name) `sepBy1` try sc' &lt;* scn)\n  -- simplified here, with some effort should be possible to go from Var to\n  -- more general Term in applications\n</code></pre>\n\n<p>Your original grammar is left-recursive because every term can be either a case expression or an application and if it's an application, then the first part of it again can be either case expression or application, etc. You'll need to deal with that somehow.</p>\n\n<p>Here is a session:</p>\n\n<pre class=\"lang-hs prettyprint-override\"><code>\u03bb&gt; parseTest pTerm \"x y\\n z\"\nApp [Var \"x\",Var \"y\",Var \"z\"]\n\u03bb&gt; parseTest pTerm \"x\\n y\\nz\"\nApp [Var \"x\",Var \"y\"]\n\u03bb&gt; parseTest manyTerms \"x\\n y\\nz\"\n[App [Var \"x\",Var \"y\"],App [Var \"z\"]]\n\u03bb&gt; parseTest pTerm \"case x of\\n C -&gt; y\\n D -&gt; z\"\nCase (Var \"x\") [(\"C\",App [Var \"y\"]),(\"D\",App [Var \"z\"])]\n\u03bb&gt; parseTest pTerm \"case x of\\n C -&gt; y\\n  z\"\n3:3:\nincorrect indentation (got 3, should be equal to 2)\n</code></pre>\n\n<p>This last result is because of <code>(1)</code> in the code. Introducing a parameter to <code>app</code> makes it impossible to use it without thinking of context (it would be no longer stand-alone expression, but factored-out part of something). We can see that if you indent <code>z</code> with respect to start of <code>y</code> application, not the entire alternative, it works:</p>\n\n<pre class=\"lang-hs prettyprint-override\"><code>\u03bb&gt; parseTest pTerm \"case x of\\n C -&gt; y\\n           z\"\nCase (Var \"x\") [(\"C\",App [Var \"y\",Var \"z\"])]\n</code></pre>\n\n<p>Finally, case expression works:</p>\n\n<pre class=\"lang-hs prettyprint-override\"><code>\u03bb&gt; parseTest pTerm \"case x of\\n C -&gt; y\\n D -&gt; z\"\nCase (Var \"x\") [(\"C\",App [Var \"y\"]),(\"D\",App [Var \"z\"])]\n</code></pre>\n\n<p>My advice here would be to take a look at some pre-processor and use Megaparsec on top of that. The tools in <code>Text.Megaparsec.Lexer</code> are not that easy to apply in this case, but they are the best we could come up with and they work fine for simple indentation-sensitive grammars.</p>\n"}], "owner": {"reputation": 25144, "user_id": 477476, "user_type": "registered", "accept_rate": 85, "profile_image": "https://i.stack.imgur.com/Qf4TT.png?s=128&g=1", "display_name": "Cactus", "link": "https://stackoverflow.com/users/477476/cactus"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 241, "favorite_count": 0, "answer_count": 1, "score": 4, "last_activity_date": 1480855248, "creation_date": 1463495517, "last_edit_date": 1495541629, "question_id": 37279101, "link": "https://stackoverflow.com/questions/37279101/indentation-aware-parsing-of-expression-trees", "title": "Indentation-aware parsing of expression trees", "body": "<p>As a follow-up to <a href=\"https://stackoverflow.com/q/37256316/477476\">this question</a>, I am now trying to parse an expression language that has variables and <code>case ... of ...</code> expressions. The syntax should be indentation-based:</p>\n\n<ul>\n<li><p>Expressions can span multiple lines, as long as every line is indented relative to the first one; i.e. this should be parsed as a single application:</p>\n\n<pre><code>f x y\n  z\n q\n</code></pre></li>\n<li><p>Each alternative of a <code>case</code> expression needs to be on its own line, indented relative to the <code>case</code> keyword. Right-hand sides can span multiple lines.</p>\n\n<pre><code>case E of\n  C -&gt; x\n  D -&gt; f x\n   y\n</code></pre>\n\n<p>should be parsed into a single <code>case</code> with two alternatives, with <code>x</code> and <code>f x y</code> as the right-hand sides</p></li>\n</ul>\n\n<p>I've simplified my code into the following:</p>\n\n<pre><code>import qualified Text.Megaparsec.Lexer as L\nimport Text.Megaparsec hiding (space)\nimport Text.Megaparsec.Char hiding (space)\nimport Text.Megaparsec.String\nimport Control.Monad (void)\nimport Control.Applicative\n\ndata Term = Var String\n          | App [Term]\n          | Case Term [(String, Term)]\n          deriving Show\n\nspace :: Parser ()\nspace = L.space (void spaceChar) empty empty\n\nname :: Parser String\nname = try $ do\n    s &lt;- some letterChar\n    if s `elem` [\"case\", \"of\"]\n      then fail $ unwords [\"Unexpected: reserved word\", show s]\n      else return s\n\nterm :: Parser () -&gt; Parser Term\nterm sp = App &lt;$&gt; atom `sepBy1` try sp\n  where\n    atom = choice [ caseBlock\n                  , Var &lt;$&gt; L.lexeme sp name\n                  ]\n\n    caseBlock = L.lineFold sp $ \\sp' -&gt;\n        Case &lt;$&gt;\n        (L.symbol sp \"case\" *&gt; L.lexeme sp (term sp) &lt;* L.symbol sp' \"of\") &lt;*&gt;\n        alt sp' `sepBy` try sp' &lt;* sp\n\n    alt sp' = L.lineFold sp' $ \\sp'' -&gt;\n        (,) &lt;$&gt; L.lexeme sp' name &lt;* L.symbol sp' \"-&gt;\" &lt;*&gt; term sp'' \n</code></pre>\n\n<p>As you can see, I am trying to use the technique from <a href=\"https://stackoverflow.com/a/37260599/477476\">this answer</a> to separate <code>alt</code>ernatives with <code>sp'</code>aces that are more indented than the <code>case</code> keyword. </p>\n\n<p><strong>Problems</strong></p>\n\n<p>This seems to work for single expressions made up of application only:</p>\n\n<pre><code>\u03bb\u00bb parseTest (L.lineFold space term) \"x y\\n z\"\nApp [Var \"x\",Var \"y\",Var \"z\"]\n</code></pre>\n\n<p>It doesn't work for list of such expressions using the technique from the linked answer:</p>\n\n<pre><code>\u03bb\u00bb parseTest (L.lineFold space $ \\sp -&gt; (term sp `sepBy` try sp)) \"x\\n y\\nz\"\n3:1:\nincorrect indentation (got 1, should be greater than 1)\n</code></pre>\n\n<p><code>case</code> expressions fail out of the gate when trying to use line-folding:</p>\n\n<pre><code>\u03bb\u00bb parseTest (L.lineFold space term) \"case x of\\n C -&gt; y\\n D -&gt; z\"\n1:5:\nUnexpected: reserved word \"case\"\n</code></pre>\n\n<p><code>case</code> works without line folding for the outermost expression, for one alternative only:</p>\n\n<pre><code>\u03bb\u00bb parseTest (term space) \"case x of\\n C -&gt; y\\n  z\"\nApp [Case (App [Var \"x\"]) [(\"C\",App [Var \"y\",Var \"z\"])]]\n</code></pre>\n\n<p>But <code>case</code> fails as soon as I have multiple <code>alt</code>ernatives:</p>\n\n<pre><code>\u03bb\u00bb parseTest (term space) \"case x of\\n C -&gt; y\\n D -&gt; z\"\n3:2:\nincorrect indentation (got 2, should be greater than 2)\n</code></pre>\n\n<p>What am I doing wrong?</p>\n"}, {"tags": ["multithreading", "haskell", "reactive-banana"], "comments": [{"owner": {"reputation": 4071, "user_id": 3806046, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/5fedf50ce7cd2659bca902e9a2969158?s=128&d=identicon&r=PG&f=1", "display_name": "jkeuhlen", "link": "https://stackoverflow.com/users/3806046/jkeuhlen"}, "edited": false, "score": 0, "creation_date": 1463498127, "post_id": 37277881, "comment_id": 62085583, "body": "This may be helpful: <a href=\"https://wiki.haskell.org/Haskell_for_multicores#Message_passing_channels\" rel=\"nofollow noreferrer\">wiki.haskell.org/&hellip;</a>"}, {"owner": {"reputation": 2231, "user_id": 1027321, "user_type": "registered", "accept_rate": 70, "profile_image": "https://i.stack.imgur.com/KkFZC.jpg?s=128&g=1", "display_name": "jakubdaniel", "link": "https://stackoverflow.com/users/1027321/jakubdaniel"}, "reply_to_user": {"reputation": 4071, "user_id": 3806046, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/5fedf50ce7cd2659bca902e9a2969158?s=128&d=identicon&r=PG&f=1", "display_name": "jkeuhlen", "link": "https://stackoverflow.com/users/3806046/jkeuhlen"}, "edited": false, "score": 0, "creation_date": 1463498278, "post_id": 37277881, "comment_id": 62085677, "body": "Thanks, I am more puzzled with the FRP part rather than channels though."}], "answers": [{"tags": [], "owner": {"reputation": 11293, "user_id": 981855, "user_type": "registered", "accept_rate": 88, "profile_image": "https://www.gravatar.com/avatar/44e220c5150326866af030a7c9d944b3?s=128&d=identicon&r=PG", "display_name": "madjar", "link": "https://stackoverflow.com/users/981855/madjar"}, "is_accepted": true, "score": 2, "last_activity_date": 1463498935, "creation_date": 1463498935, "answer_id": 37280452, "question_id": 37277881, "link": "https://stackoverflow.com/questions/37277881/events-from-shared-communication-channel-between-threads/37280452#37280452", "title": "Events from shared communication channel between threads", "body": "<p>The documentation for <code>fromPoll</code> states</p>\n\n<blockquote>\n  <p>The resulting Behavior will be updated on whenever the event network processes an input event.</p>\n</blockquote>\n\n<p>Since there is no event, it is never updated. <code>fromPoll</code> is intented as a quick-and-dirty way to read mutable data, but not to update the network. Rather, the documentation recommends we use <code>fromChanges</code>. But since we or, because we want <code>Event</code> anyway, let's use <a href=\"http://hackage.haskell.org/package/reactive-banana-1.1.0.0/docs/Reactive-Banana-Frameworks.html#v:newEvent\" rel=\"nofollow\"><code>newEvent</code></a>, which seems quite appropriate: it allows us to create an <code>Event</code> to which we add values by calling a <code>Handler</code> (which is an alias for <code>a -&gt; IO ()</code>).</p>\n\n<pre><code>import Control.Concurrent\nimport Control.Monad\n\nimport Reactive.Banana\nimport Reactive.Banana.Frameworks\n\nmain = do\n\n    c &lt;- newChan\n\n    network &lt;- compile $ do\n      (event, handler) &lt;- newEvent\n      liftIO $ forkIO $ forever (readChan c &gt;&gt;= handler)\n      reactimate event\n\n    forkIO $ actuate network\n\n    forever $ do\n        threadDelay 3000000\n        putStrLn \"sending msg\"\n        writeChan c $ putStrLn \"receiving msg\"\n</code></pre>\n"}], "owner": {"reputation": 2231, "user_id": 1027321, "user_type": "registered", "accept_rate": 70, "profile_image": "https://i.stack.imgur.com/KkFZC.jpg?s=128&g=1", "display_name": "jakubdaniel", "link": "https://stackoverflow.com/users/1027321/jakubdaniel"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 121, "favorite_count": 1, "accepted_answer_id": 37280452, "answer_count": 1, "score": 1, "last_activity_date": 1463516751, "creation_date": 1463492458, "last_edit_date": 1463516751, "question_id": 37277881, "link": "https://stackoverflow.com/questions/37277881/events-from-shared-communication-channel-between-threads", "title": "Events from shared communication channel between threads", "body": "<p>I have a program that solves some problem and I decided I would like to monitor in a nice GUI what it does. For GUI I chose <code>Gtk</code> which means that I need to run <code>mainGUI</code> loop in a dedicated thread and the rest of my program will occupy a different thread. I thought the communication between my program and the other thread would flow in one direction using <code>Chan</code>. I further decided to use FRP for updating the GUI on notification from the worker (the original program's logic in its separate thread). So I tried writing a simple threaded example where one thread sends <code>IO</code> actions to the monitoring thread which performs the actions (displays them). Here is my attempt:</p>\n\n<pre><code>import Control.Concurrent\nimport Control.Monad\n\nimport Reactive.Banana\nimport Reactive.Banana.Frameworks\n\nmain = do\n    c &lt;- newChan\n\n    forkIO $ do\n        actuate &lt;=&lt; compile $ reactimate'\n                            &lt;=&lt; changes\n                            &lt;=&lt; fromPoll\n                            $ readChan c\n\n    forever $ do\n        threadDelay 3000000\n        putStrLn \"sending msg\"\n        writeChan c $ putStrLn \"receiving msg\"\n</code></pre>\n\n<p>This obviously doesn't work (it only prints <code>sending msg</code>) otherwise I wouldn't be here. What am I doing wrong? Do I need a different event that times the polling? How to do it?</p>\n\n<p>I expected some interleaving of copies of the texts: <code>sending msg</code> and <code>receiving msg</code>.</p>\n\n<hr>\n\n<p>To clarify I want to move from</p>\n\n<pre><code>main = do\n    c &lt;- newChan\n\n    forkIO . forever . join . readChan $ c\n\n    forever $ do\n        threadDelay 3000000\n        putStrLn \"sending msg\"\n        writeChan c $ putStrLn \"receiving msg\"\n</code></pre>\n\n<p>where each message in <code>c :: Chan (IO ())</code> is read in the thread explicitly (possibly blocking), to reactive handling of the messages, i.e. describing a network of events/behaviours interconnected with GUI elements and then let the thread perform GUI loop. The network would need to take care of polling values in the channel and firing events.</p>\n\n<hr>\n\n<p>The solution I was seeking (or something like it):</p>\n\n<pre><code>main = do\n    (msgHandler, msgFire) &lt;- newAddHandler\n\n    forkIO $ do\n        actuate &lt;=&lt; compile $ do\n            eMsg &lt;- fromAddHandler msgHandler\n\n            reactimate $ putStrLn &lt;$&gt; eMsg\n\n    forever $ do\n        threadDelay 3000000\n        putStrLn \"sending msg\"\n        msgFire \"receiving msg\"\n</code></pre>\n"}, {"tags": ["haskell", "tree", "functional-programming"], "comments": [{"owner": {"reputation": 126897, "user_id": 791604, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/ce991df7a056248d5e4f6fc3659ba733?s=128&d=identicon&r=PG", "display_name": "Daniel Wagner", "link": "https://stackoverflow.com/users/791604/daniel-wagner"}, "edited": false, "score": 1, "creation_date": 1463496094, "post_id": 37276498, "comment_id": 62083967, "body": "You might like <a href=\"http://hackage.haskell.org/package/dual-tree\" rel=\"nofollow noreferrer\">dual-tree</a> (using the <a href=\"https://hackage.haskell.org/package/base-4.8.2.0/docs/Data-Monoid.html#t:Sum\" rel=\"nofollow noreferrer\"><code>Sum</code></a> monoid as the upward-traveling annotation)."}], "answers": [{"comments": [{"owner": {"reputation": 126897, "user_id": 791604, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/ce991df7a056248d5e4f6fc3659ba733?s=128&d=identicon&r=PG", "display_name": "Daniel Wagner", "link": "https://stackoverflow.com/users/791604/daniel-wagner"}, "edited": false, "score": 1, "creation_date": 1463495986, "post_id": 37277374, "comment_id": 62083862, "body": "...but this is incredibly inefficient, as it will recompute sums of deep subtrees very often."}, {"owner": {"reputation": 6942, "user_id": 1540749, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/dd6c24a0bc5c0a59a456aa8b08a78b6a?s=128&d=identicon&r=PG", "display_name": "josejuan", "link": "https://stackoverflow.com/users/1540749/josejuan"}, "reply_to_user": {"reputation": 126897, "user_id": 791604, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/ce991df7a056248d5e4f6fc3659ba733?s=128&d=identicon&r=PG", "display_name": "Daniel Wagner", "link": "https://stackoverflow.com/users/791604/daniel-wagner"}, "edited": false, "score": 0, "creation_date": 1463507470, "post_id": 37277374, "comment_id": 62091362, "body": "@DanielWagner I think that your assumption about <code>f</code> is wrong, &quot;The problem is that I can&#39;t access the children of a node&quot;, the sum problem is an example, not the general case. You can optimize tail computations (the sum case) but then ignore preffix computations. I only have solved the suggested general problem."}], "tags": [], "owner": {"reputation": 6942, "user_id": 1540749, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/dd6c24a0bc5c0a59a456aa8b08a78b6a?s=128&d=identicon&r=PG", "display_name": "josejuan", "link": "https://stackoverflow.com/users/1540749/josejuan"}, "is_accepted": false, "score": 1, "last_activity_date": 1463509807, "last_edit_date": 1463509807, "creation_date": 1463491162, "answer_id": 37277374, "question_id": 37276498, "link": "https://stackoverflow.com/questions/37276498/propagate-values-up-a-data-tree-in-haskell/37277374#37277374", "title": "Propagate values up a Data.Tree in Haskell", "body": "<p>You wish operate, for each node, with all subtree (node label included) then, one usefull function may be</p>\n\n<pre><code>subtrees :: Tree a -&gt; Tree (Tree a)\nsubtrees n@(Node _ xs) = Node n (map subtrees xs)\n</code></pre>\n\n<p>now, you can apply any tree function to any tree of trees</p>\n\n<pre><code>sumSubtree :: Num a =&gt; Tree a -&gt; Tree a\nsumSubtree = fmap sum . subtrees\n</code></pre>\n\n<p>with the desired result.</p>\n\n<p>As Daniel say, this <code>sumSubtree</code> is inefficient since sum from leafs to root have optimal substructure.</p>\n\n<p>But then, not unique solution exists, look to the next fold version</p>\n\n<pre><code>foldTree :: (a \u2192 Forest b \u2192 b) \u2192 Tree a \u2192 Tree b\nfoldTree f (Node x xs) = Node (f x xs') xs'\n                         where xs' = foldTree f \u21a5 xs\n</code></pre>\n\n<p>now is optimal only if <code>f</code> not need the root and previous branchs to compute some branch value (e.g. the sum problem). But (e.g.) if some key is stored on each node this sum implementation will be inefficient too.</p>\n\n<p>(Using the previous fold, the sum problem may be written <code>foldTree (\u03bbx xs \u2192 \u2211(x: map rootLabel xs))</code>)</p>\n"}, {"comments": [{"owner": {"reputation": 44013, "user_id": 1477667, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/trgKM.jpg?s=128&g=1", "display_name": "dfeuer", "link": "https://stackoverflow.com/users/1477667/dfeuer"}, "edited": false, "score": 0, "creation_date": 1463499122, "post_id": 37279548, "comment_id": 62086324, "body": "<code>Traversable</code> is definitely not sufficient. I think there&#39;s stuff for this in <code>uniplate</code>, but I&#39;ve never used it. Your approach looks perfectly sensible."}, {"owner": {"reputation": 44013, "user_id": 1477667, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/trgKM.jpg?s=128&g=1", "display_name": "dfeuer", "link": "https://stackoverflow.com/users/1477667/dfeuer"}, "edited": false, "score": 0, "creation_date": 1463499266, "post_id": 37279548, "comment_id": 62086416, "body": "Would you mind writing to libraries@haskell.org to propose adding that to <code>Data.Tree</code>? It&#39;s conspicuously missing."}, {"owner": {"reputation": 126897, "user_id": 791604, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/ce991df7a056248d5e4f6fc3659ba733?s=128&d=identicon&r=PG", "display_name": "Daniel Wagner", "link": "https://stackoverflow.com/users/791604/daniel-wagner"}, "reply_to_user": {"reputation": 44013, "user_id": 1477667, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/trgKM.jpg?s=128&g=1", "display_name": "dfeuer", "link": "https://stackoverflow.com/users/1477667/dfeuer"}, "edited": false, "score": 0, "creation_date": 1463505801, "post_id": 37279548, "comment_id": 62090463, "body": "@dfeuer It seems that <code>containers</code> is not maintained by libraries@; at least it isn&#39;t mentioned <a href=\"https://wiki.haskell.org/Library_submissions\" rel=\"nofollow noreferrer\">on the wiki page about core libraries</a> and the listed maintainer on Hackage changed away from libraries@ several major versions ago. That said, I&#39;ve <a href=\"https://github.com/haskell/containers/pull/232\" rel=\"nofollow noreferrer\">filed a pull request</a>."}, {"owner": {"reputation": 44013, "user_id": 1477667, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/trgKM.jpg?s=128&g=1", "display_name": "dfeuer", "link": "https://stackoverflow.com/users/1477667/dfeuer"}, "edited": false, "score": 0, "creation_date": 1463513751, "post_id": 37279548, "comment_id": 62094663, "body": "As of a few weeks ago, I co-maintain <code>containers</code> with Wren Romano. Because of its privileged place in the package hierarchy, and its tremendous number of reverse dependencies, the previous maintainers of the package have established a tradition of consulting the libraries list about API changes. Some additions that particularly fit the rest of the API might get a pass, but this is the exception rather than the rule."}], "tags": [], "owner": {"reputation": 126897, "user_id": 791604, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/ce991df7a056248d5e4f6fc3659ba733?s=128&d=identicon&r=PG", "display_name": "Daniel Wagner", "link": "https://stackoverflow.com/users/791604/daniel-wagner"}, "is_accepted": true, "score": 3, "last_activity_date": 1463496735, "creation_date": 1463496735, "answer_id": 37279548, "question_id": 37276498, "link": "https://stackoverflow.com/questions/37276498/propagate-values-up-a-data-tree-in-haskell/37279548#37279548", "title": "Propagate values up a Data.Tree in Haskell", "body": "<p>I don't think <code>Foldable</code> exposes enough of a <code>Tree</code>'s structure to do what you want. <code>Traversable</code> might, but it seems relatively tricky to get right; I think I would prefer implementing a recursion pattern like this one:</p>\n\n<pre><code>foldTree :: (a -&gt; [b] -&gt; b) -&gt; Tree a -&gt; b\nfoldTree f = go where\n    go (Node value children) = f value (map go children)\n</code></pre>\n\n<p>Then you can implement your summing operation as</p>\n\n<pre><code>sums :: Num a =&gt; Tree a -&gt; Tree a\nsums = foldTree (\\val children -&gt; Node (sum (val:map rootLabel children)) children)\n</code></pre>\n\n<p>or even generalize from <code>Num</code> to <code>Semigroup</code> using <code>sconcat</code> and <code>(:|)</code> in place of <code>sum</code> and <code>(:)</code>.</p>\n"}], "owner": {"reputation": 1143, "user_id": 1233615, "user_type": "registered", "accept_rate": 84, "profile_image": "https://www.gravatar.com/avatar/b941941886b3fdc1e8a3596ff5cd3f0a?s=128&d=identicon&r=PG", "display_name": "fuji", "link": "https://stackoverflow.com/users/1233615/fuji"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 169, "favorite_count": 1, "accepted_answer_id": 37279548, "answer_count": 2, "score": 1, "last_activity_date": 1463509807, "creation_date": 1463488817, "question_id": 37276498, "link": "https://stackoverflow.com/questions/37276498/propagate-values-up-a-data-tree-in-haskell", "title": "Propagate values up a Data.Tree in Haskell", "body": "<p>Using <code>Data.Tree</code> I can define a tree like this:</p>\n\n<pre><code>mkTree :: T.Tree Double\nmkTree = T.Node 0 [ T.Node 4 []\n                  , T.Node 0 [T.Node 5 [], T.Node 4 []]\n                  , T.Node 0 [T.Node 2 [], T.Node 1 []]\n                  ]\n</code></pre>\n\n<p>Which would transfer to this:</p>\n\n<pre><code>0.0\n|\n+- 4.0\n|\n+- 0.0\n|  |\n|  +- 5.0\n|  |\n|  `- 4.0\n|\n`- 0.0\n   |\n   +- 2.0\n   |\n   `- 1.0\n</code></pre>\n\n<p>I now want to transform the tree so that each <code>T.Node</code> now contains the sum (or some other function) of its children:</p>\n\n<pre><code>16.0\n|\n+- 4.0\n|\n+- 9.0\n|  |\n|  +- 5.0\n|  |\n|  `- 4.0\n|\n`- 3.0\n   |\n   +- 2.0\n   |\n   `- 1.0\n</code></pre>\n\n<p>The problem is that I can't access the children of a node using <code>fmap</code>. What I have so far is these to functions:</p>\n\n<pre><code>propagate :: Num a =&gt; T.Tree a -&gt; T.Tree a\npropagate (T.Node x []) = T.Node x []\npropagate (T.Node _ ts) = T.Node (sum $ map gather ts) (map propagate ts)\n\ngather :: Num a =&gt; T.Tree a -&gt; a\ngather (T.Node n []) = n\ngather (T.Node _ ts) = sum $ map gather ts\n</code></pre>\n\n<p>But that seems too complicated, especially if I were to replace <code>sum</code> with another function. Maybe there is a better way to do this using <code>Foldable</code> or <code>Traversable</code>?</p>\n"}, {"tags": ["haskell", "insertion-sort"], "answers": [{"comments": [{"owner": {"reputation": 119, "user_id": 5655543, "user_type": "registered", "accept_rate": 80, "profile_image": "https://i.stack.imgur.com/FjwbY.gif?s=128&g=1", "display_name": "GabbaGandalf", "link": "https://stackoverflow.com/users/5655543/gabbagandalf"}, "edited": false, "score": 0, "creation_date": 1463483797, "post_id": 37273758, "comment_id": 62074488, "body": "Thank you very much! I read that (Ord a), (&gt;) and (a-&gt;a-&gt;Bool) are all equivalent. Is that correct? And if yes, why do you need (insert :: (Ord a) =&gt; (a-&gt;a-&gt;Bool) -&gt; a ...) instead of (insert :: (a-&gt;a-&gt;Bool) -&gt; a ...)?"}, {"owner": {"reputation": 816, "user_id": 4153209, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/14bd54eebccc6829e45b653c41b217bd?s=128&d=identicon&r=PG", "display_name": "Thomas Francois", "link": "https://stackoverflow.com/users/4153209/thomas-francois"}, "reply_to_user": {"reputation": 119, "user_id": 5655543, "user_type": "registered", "accept_rate": 80, "profile_image": "https://i.stack.imgur.com/FjwbY.gif?s=128&g=1", "display_name": "GabbaGandalf", "link": "https://stackoverflow.com/users/5655543/gabbagandalf"}, "edited": false, "score": 3, "creation_date": 1463484334, "post_id": 37273758, "comment_id": 62074851, "body": "@GabbaGandalf None of them are equivalent. <code>(Ord a) =&gt; ...</code> states that a needs to be an orderable datatype. <code>(&gt;)</code> is a function. It is the same than writing <code>(\\a b -&gt; a &gt; b)</code>. Finally <code>(a -&gt; a -&gt; Bool)</code> is a type description: it describes a function that takes 2 values of type <code>a</code> and returns a <code>Bool</code>."}, {"owner": {"reputation": 119, "user_id": 5655543, "user_type": "registered", "accept_rate": 80, "profile_image": "https://i.stack.imgur.com/FjwbY.gif?s=128&g=1", "display_name": "GabbaGandalf", "link": "https://stackoverflow.com/users/5655543/gabbagandalf"}, "edited": false, "score": 0, "creation_date": 1463484930, "post_id": 37273758, "comment_id": 62075268, "body": "Thanks, good to know. So the statement (Ord a) =&gt; ... just prevents runtime errors?"}, {"owner": {"reputation": 816, "user_id": 4153209, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/14bd54eebccc6829e45b653c41b217bd?s=128&d=identicon&r=PG", "display_name": "Thomas Francois", "link": "https://stackoverflow.com/users/4153209/thomas-francois"}, "reply_to_user": {"reputation": 119, "user_id": 5655543, "user_type": "registered", "accept_rate": 80, "profile_image": "https://i.stack.imgur.com/FjwbY.gif?s=128&g=1", "display_name": "GabbaGandalf", "link": "https://stackoverflow.com/users/5655543/gabbagandalf"}, "edited": false, "score": 2, "creation_date": 1463486399, "post_id": 37273758, "comment_id": 62076437, "body": "@GabbaGandalf The statement <code>(Ord a) =&gt;</code> specifies that the type <code>a</code> needs to be orderable. The function is a sort, so it makes sense to put that restriction (or rather it wouldn&#39;t make sense to sort something that is not sortable). Thanks to this statement, both the developers and the compiler know that they need a sortable list when they call <code>insertionSort</code>. I am not sure this explication is very clear, don&#39;t hesitate to post a comment requesting clarification (Please use @ so I can be notified of your reply)."}, {"owner": {"reputation": 119, "user_id": 5655543, "user_type": "registered", "accept_rate": 80, "profile_image": "https://i.stack.imgur.com/FjwbY.gif?s=128&g=1", "display_name": "GabbaGandalf", "link": "https://stackoverflow.com/users/5655543/gabbagandalf"}, "reply_to_user": {"reputation": 816, "user_id": 4153209, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/14bd54eebccc6829e45b653c41b217bd?s=128&d=identicon&r=PG", "display_name": "Thomas Francois", "link": "https://stackoverflow.com/users/4153209/thomas-francois"}, "edited": false, "score": 0, "creation_date": 1463494107, "post_id": 37273758, "comment_id": 62082438, "body": "@ThomasFrancois This explication makes sense to me, thank you!"}], "tags": [], "owner": {"reputation": 19480, "user_id": 2491900, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/W8FMW.jpg?s=128&g=1", "display_name": "shree.pat18", "link": "https://stackoverflow.com/users/2491900/shree-pat18"}, "is_accepted": true, "score": 2, "last_activity_date": 1463481521, "creation_date": 1463481521, "answer_id": 37273758, "question_id": 37273653, "link": "https://stackoverflow.com/questions/37273653/insertionsort-in-haskell-with-specified-order/37273758#37273758", "title": "Insertionsort in Haskell with specified order", "body": "<p>All you need to do is use the result of the boolean function parameter instead of a fixed comparison, like so:</p>\n\n<pre><code>insert :: (Ord a) =&gt; (a -&gt; a -&gt; Bool) -&gt; a -&gt; [a] -&gt; [a]\ninsert _ a [] = [a]\ninsert f a (a':as)\n     | f a a'   = a:a':as\n     | otherwise = a':insert f a as\n</code></pre>\n\n<p>Similarly for the other function.</p>\n\n<pre><code>insertionSort :: (Ord a) =&gt; (a -&gt; a -&gt; Bool) -&gt; [a] -&gt; [a]\ninsertionSort _  []      = []\ninsertionSort f (a:as) = insert f a (insertionSort f as) \n</code></pre>\n\n<p><a href=\"http://rextester.com/CFR38690\" rel=\"nofollow\">Demo</a></p>\n"}], "owner": {"reputation": 119, "user_id": 5655543, "user_type": "registered", "accept_rate": 80, "profile_image": "https://i.stack.imgur.com/FjwbY.gif?s=128&g=1", "display_name": "GabbaGandalf", "link": "https://stackoverflow.com/users/5655543/gabbagandalf"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 236, "favorite_count": 1, "accepted_answer_id": 37273758, "answer_count": 1, "score": 1, "last_activity_date": 1463493706, "creation_date": 1463481242, "last_edit_date": 1463493706, "question_id": 37273653, "link": "https://stackoverflow.com/questions/37273653/insertionsort-in-haskell-with-specified-order", "title": "Insertionsort in Haskell with specified order", "body": "<p>i am trying to implement insertion sort in haskell for my weekly university assignment. This is my insert and sort function:</p>\n\n<pre><code>  insert :: (Ord a) =&gt; a -&gt; [a] -&gt; [a]\n  insert a [] = [a]\n  insert a (a':as)\n       | a &lt;= a'   = a:a':as\n       | otherwise = a':insert a as\n\n\n  insertionSort :: (Ord a) =&gt; [a] -&gt; [a]\n  insertionSort   []      = []\n  insertionSort (a:as) = insert a (insertionSort as)\n</code></pre>\n\n<p>This works but my tutor specified the signature like so:</p>\n\n<pre><code>insert :: (a -&gt; a -&gt; Bool) -&gt; a -&gt; [a] -&gt; [a]\ninsertionSort :: (a -&gt; a -&gt; Bool) -&gt; [a] -&gt; [a]\n</code></pre>\n\n<p>Everything i tried by now failed and the compiler errors aren't really helpfull either. Hope you guys can help me with this!</p>\n\n<p>Edit:</p>\n\n<p>The given example by my tutor looks like so:</p>\n\n<pre><code>Main&gt; insert (&lt;) 3 [1,2,5,7,9]\n[1,2,3,5,7,9]\nMain&gt; insSort (&gt;) [7,9,1,2,5]\n[9,7,5,2,1]\n</code></pre>\n"}, {"tags": ["xml", "haskell"], "comments": [{"owner": {"reputation": 14781, "user_id": 630160, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/4445f21326af525a8ad19af7e3ae41a8?s=128&d=identicon&r=PG", "display_name": "epsilonhalbe", "link": "https://stackoverflow.com/users/630160/epsilonhalbe"}, "edited": false, "score": 1, "creation_date": 1463483653, "post_id": 37269316, "comment_id": 62074394, "body": "Hi welcome to stackoverflow - this is a platform, where people answer questions and help each other for free. So please put <b>at least</b> as much effort into your question as you would expect someone answering it. You can show us what you have tried, what the great search engine has told you or not. You can reference documentation you do not understand or where you are stuck in general. Right now the effort I would put into an answer based on your effort is: &quot;I think it is possible to do that.&quot;"}], "answers": [{"tags": [], "owner": {"reputation": 2831, "user_id": 183792, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/9ddcfbc6c31012fd25384f6301363347?s=128&d=identicon&r=PG&f=1", "display_name": "Michael", "link": "https://stackoverflow.com/users/183792/michael"}, "is_accepted": true, "score": 2, "last_activity_date": 1463508257, "last_edit_date": 1463508257, "creation_date": 1463506381, "answer_id": 37282865, "question_id": 37269316, "link": "https://stackoverflow.com/questions/37269316/haskell-xml-update-text-using-hxt-library/37282865#37282865", "title": "haskell xml update text using HXT library", "body": "<p>The natural answer is a lens library; I don't think <code>hxt</code> has such a thing associated with it.  But there is <code>xml-lens</code> which uses <code>xml-conduit</code> (but not conduits in fact) </p>\n\n<p>The examples in the readme <a href=\"https://github.com/fumieval/xml-lens\" rel=\"nofollow\">https://github.com/fumieval/xml-lens</a> are fairly straightforward, but maybe a bit operator-clogged, if you aren't familiar with lenses. But here is less dense version of one of the examples. It modifies each page number in a book list by adding \"  pages\" to it, changing </p>\n\n<pre><code>  &lt;pages&gt;360&lt;/pages&gt;\n</code></pre>\n\n<p>to </p>\n\n<pre><code>  &lt;pages&gt;360 pages&lt;/pages&gt;\n</code></pre>\n\n<p>starting with an XML like this:</p>\n\n<pre><code>&lt;?xml version=\"1.0\" encoding=\"ISO-8859-1\"?&gt;\n&lt;books&gt;\n&lt;book category=\"Textbooks\"&gt;\n    &lt;title&gt;Learn You a Haskell for Great Good!&lt;/title&gt;\n    &lt;author year=\"2011\"&gt;Miran Lipovaca&lt;/author&gt;\n    &lt;pages&gt;360&lt;/pages&gt;\n&lt;/book&gt;\n&lt;book category=\"Textbooks\"&gt;\n    &lt;title&gt;Programming in Haskell&lt;/title&gt;\n    &lt;author year=\"2007\"&gt;Graham Hutton&lt;/author&gt;\n    &lt;pages&gt;200&lt;/pages&gt;\n&lt;/book&gt;\n&lt;/books&gt;\n</code></pre>\n\n<p>We need imports like these</p>\n\n<pre><code>  &gt;&gt;&gt; import Text.XML.Lens        -- from the lens-xml package\n  &gt;&gt;&gt; import Control.Lens         -- from the lens package\n  &gt;&gt;&gt; import Text.XML             -- from the xml-conduit package\n  &gt;&gt;&gt; import Data.Monoid ((&lt;&gt;))\n  &gt;&gt;&gt; import qualified Data.Text as T\n  &gt;&gt;&gt; import qualified Data.ByteString.Lazy.Char8 as BL\n  &gt;&gt;&gt; :set -XOverloadedStrings    -- for Text literals\n</code></pre>\n\n<p>First I define the traversal that targets what I want to change:</p>\n\n<pre><code>  &gt;&gt;&gt; let my_focus = root . el \"books\" ./ el \"book\" ./ el \"pages\" . text\n</code></pre>\n\n<p>then I define an ordinary Haskell function in terms of it, using <code>over some_traversal some_function</code></p>\n\n<pre><code>  &gt;&gt;&gt; let my_transformation = over my_focus (&lt;&gt; \" pages\") -- i.e. apply (&lt;&gt; \" pages\") to\n  &gt;&gt;&gt; :t my_transformation                                -- all the focused positions\n  my_transformation :: Document -&gt; Document\n</code></pre>\n\n<p>read the document:</p>\n\n<pre><code>  &gt;&gt;&gt; doc &lt;- Text.XML.readFile def \"book.xml\" \n  &gt;&gt;&gt; :t doc\n  doc :: Document\n</code></pre>\n\n<p>and then transform and render it:</p>\n\n<pre><code>  &gt;&gt;&gt; BL.putStrLn $ renderLBS def (my_transformation doc)\n  &lt;?xml version=\"1.0\" encoding=\"UTF-8\"?&gt;&lt;books&gt;\n  &lt;book category=\"Textbooks\"&gt;\n      &lt;title&gt;Learn You a Haskell for Great Good!&lt;/title&gt;\n      &lt;author year=\"2011\"&gt;Miran Lipovaca&lt;/author&gt;\n      &lt;pages&gt;360 pages&lt;/pages&gt;\n  &lt;/book&gt;\n  &lt;book category=\"Textbooks\"&gt;\n      &lt;title&gt;Programming in Haskell&lt;/title&gt;\n      &lt;author year=\"2007\"&gt;Graham Hutton&lt;/author&gt;\n      &lt;pages&gt;200 pages&lt;/pages&gt;\n  &lt;/book&gt;\n  &lt;/books&gt;\n</code></pre>\n\n<p>This might be a little slow given the fancy apparatus it is using below the surface, but is plainly crazy powerful.</p>\n"}], "owner": {"reputation": 23, "user_id": 4476237, "user_type": "registered", "profile_image": "https://graph.facebook.com/100007082344163/picture?type=large", "display_name": "Sergey  Yakovlev", "link": "https://stackoverflow.com/users/4476237/sergey-yakovlev"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 116, "favorite_count": 0, "accepted_answer_id": 37282865, "answer_count": 1, "score": 2, "last_activity_date": 1463512223, "creation_date": 1463468727, "last_edit_date": 1463512223, "question_id": 37269316, "link": "https://stackoverflow.com/questions/37269316/haskell-xml-update-text-using-hxt-library", "title": "haskell xml update text using HXT library", "body": "<p>I need to have a possibility to update text in structure like this <code>&lt;node&gt;&lt;data key=\"attr\"&gt;text&lt;/data&gt;&lt;/node&gt;</code>. Is there any way to do this by using HXT library in haskell?</p>\n"}, {"tags": ["haskell", "mutual-recursion", "hspec"], "comments": [{"owner": {"reputation": 48129, "user_id": 76051, "user_type": "registered", "accept_rate": 91, "profile_image": "https://i.stack.imgur.com/AGDxz.jpg?s=128&g=1", "display_name": "Carsten", "link": "https://stackoverflow.com/users/76051/carsten"}, "edited": false, "score": 0, "creation_date": 1463460197, "post_id": 37267158, "comment_id": 62060920, "body": "the problem is your <code>Eq</code> instance (laziness does not matter - <code>shouldBe</code> is of course forcing them to the <code>Bool</code> result) (and <code>Show</code> too for that matter) those will loop forever - so you should implement those yourself - either with some form of <i>loop</i>-detection or without using the recursive values at all"}], "answers": [{"tags": [], "owner": {"reputation": 100185, "user_id": 3234959, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/93bb12ca0f93dfddb33880316f7e66c2?s=128&d=identicon&r=PG&f=1", "display_name": "chi", "link": "https://stackoverflow.com/users/3234959/chi"}, "is_accepted": false, "score": 1, "last_activity_date": 1463469841, "creation_date": 1463469841, "answer_id": 37269650, "question_id": 37267158, "link": "https://stackoverflow.com/questions/37267158/comparing-two-mutually-recursive-values-for-equality-in-hspec-is-causing-problem/37269650#37269650", "title": "Comparing Two Mutually Recursive Values for Equality in HSpec is Causing Problems", "body": "<p>You can't compare infinite values in finite time. </p>\n\n<p>Indeed, comparing infinite values is undecidable in general, so it's impossible for the compiler to generate an <code>Eq</code> instance which works on those.</p>\n\n<p>To stress the point, consider this code:</p>\n\n<pre><code>complexCondition :: Integer -&gt; Bool\ncomplexCondition = ...\n\nfoo :: Integer -&gt; T\nfoo n | complexCondition n = T { f1 = \"found!\", f2 = foo (n+1) }\n      | otherwise          = T { f1 = \"not yet\", f2 = foo (n+1) }\n\nreference :: T\nreference = T { f1 = \"not yet\", f2 = reference }\n</code></pre>\n\n<p>We would have <code>foo 0 == reference</code> is and only if <code>complexCondition n</code> is false <em>for all</em> values <code>n</code>. This is unfeasible to check.</p>\n\n<p>However, since the comparison problem on <code>T</code> is coRE (its complement is recursively enumerable), then we can semi-decide the complement. Indeed, the generated <code>Eq</code> instance will return <code>False</code> in finite time for different <code>T</code>s. This is feasible since only a finite prefix of such values need to be inspected to be able to state <code>False</code>.</p>\n"}], "owner": {"reputation": 5821, "user_id": 1770201, "user_type": "registered", "accept_rate": 45, "profile_image": "https://www.gravatar.com/avatar/46bcb5d2018194c9beb884b6797e57e0?s=128&d=identicon&r=PG", "display_name": "George", "link": "https://stackoverflow.com/users/1770201/george"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 80, "favorite_count": 1, "answer_count": 1, "score": 0, "last_activity_date": 1463469841, "creation_date": 1463459462, "question_id": 37267158, "link": "https://stackoverflow.com/questions/37267158/comparing-two-mutually-recursive-values-for-equality-in-hspec-is-causing-problem", "title": "Comparing Two Mutually Recursive Values for Equality in HSpec is Causing Problems", "body": "<h3>1 The Context</h3>\n\n<p>Consider the following snippet of Haskell:</p>\n\n<pre><code>data T = T { f1 :: String \n           , f2 :: T\n           } deriving (Eq, Show)\n\nr1 = T { f1 = \"val1\"\n       , f2 = r2 \n       } :: T\n\nr2 = T { f1 = \"val2\"\n       , f2 = r1\n       } :: T\n</code></pre>\n\n<p>Notice how <code>r1</code> is mutually recursive with respect to <code>r2</code>. AFAIK, this is totally fine in Haskell (as long as you don't use these two values in such a way that results in a mutually recursive calling loop that never terminates).  For example, a user of <code>r2</code> might want to access the value <code>f1 r1</code> via <code>f1 (f2 r2)</code>(which in this case \"val1\"). (In fact, this is how I'm trying to use these sorts of data structures in my own code.)</p>\n\n<h3>2 The Problem</h3>\n\n<p>Now consider the following HSpec unit test:</p>\n\n<pre><code>describe \"A mutually recursive value should be equal to itself\" $ do\n    r1 `shouldBe` r1\n</code></pre>\n\n<p><strong>This causes the test compiler to stall for a while and then eventually fail.</strong>  Does this mean that there is something wrong with my code, or is this just a quirk of the way <code>shouldBe</code> is defined (I'm assuming the way it's checking for equality isn't lazy, and involves a mutually recursive, non-terminating call)? If this is just a quirk of HSpec's <code>shouldBe</code> function, then is there a way to check for equality between mutually recursive values? What I ultimately want to be able to do is something like the following:</p>\n\n<pre><code>r3 = T { f1 = \"val1\"\n       , f2 = r2 \n       } :: T\n\ndescribe \"A mutually recursive value should be equal to itself\" $ do\n    r1 `shouldBe` r3\n</code></pre>\n"}, {"tags": ["haskell", "alternative-functor", "monadplus"], "answers": [{"comments": [{"owner": {"reputation": 49959, "user_id": 866915, "user_type": "registered", "accept_rate": 70, "profile_image": "https://www.gravatar.com/avatar/09242131d6e17cbbe31e8547514da6e5?s=128&d=identicon&r=PG", "display_name": "ErikR", "link": "https://stackoverflow.com/users/866915/erikr"}, "edited": false, "score": 2, "creation_date": 1463451855, "post_id": 37266056, "comment_id": 62058965, "body": "I was wondering if the community has come around to a consensus as to what it should be called. Seems like a candidate for inclusion in <code>base</code> somewhere."}, {"owner": {"reputation": 44013, "user_id": 1477667, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/trgKM.jpg?s=128&g=1", "display_name": "dfeuer", "link": "https://stackoverflow.com/users/1477667/dfeuer"}, "reply_to_user": {"reputation": 49959, "user_id": 866915, "user_type": "registered", "accept_rate": 70, "profile_image": "https://www.gravatar.com/avatar/09242131d6e17cbbe31e8547514da6e5?s=128&d=identicon&r=PG", "display_name": "ErikR", "link": "https://stackoverflow.com/users/866915/erikr"}, "edited": false, "score": 0, "creation_date": 1463452165, "post_id": 37266056, "comment_id": 62059038, "body": "@ErikR, I don&#39;t know about that. Sorry."}, {"owner": {"reputation": 126897, "user_id": 791604, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/ce991df7a056248d5e4f6fc3659ba733?s=128&d=identicon&r=PG", "display_name": "Daniel Wagner", "link": "https://stackoverflow.com/users/791604/daniel-wagner"}, "edited": false, "score": 0, "creation_date": 1463452508, "post_id": 37266056, "comment_id": 62059114, "body": "@dfeuer Perhaps <code>foldAlt = asum . fmap pure</code> makes it more clear exactly how it is similar to <code>asum</code>."}, {"owner": {"reputation": 44013, "user_id": 1477667, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/trgKM.jpg?s=128&g=1", "display_name": "dfeuer", "link": "https://stackoverflow.com/users/1477667/dfeuer"}, "reply_to_user": {"reputation": 126897, "user_id": 791604, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/ce991df7a056248d5e4f6fc3659ba733?s=128&d=identicon&r=PG", "display_name": "Daniel Wagner", "link": "https://stackoverflow.com/users/791604/daniel-wagner"}, "edited": false, "score": 0, "creation_date": 1463452922, "post_id": 37266056, "comment_id": 62059205, "body": "@DanielWagner, that has a rather more restrictive type. Can that be fixed? There&#39;s also an operational difference; I imagine the <code>asum</code> way is often (usually?) better, but I don&#39;t know if it always is. One option is <code>foldAlt = foldr (\\x r -&gt; pure x &lt;|&gt; r) empty</code>."}], "tags": [], "owner": {"reputation": 44013, "user_id": 1477667, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/trgKM.jpg?s=128&g=1", "display_name": "dfeuer", "link": "https://stackoverflow.com/users/1477667/dfeuer"}, "is_accepted": false, "score": 8, "last_activity_date": 1463496949, "last_edit_date": 1463496949, "creation_date": 1463451385, "answer_id": 37266056, "question_id": 37265877, "link": "https://stackoverflow.com/questions/37265877/is-there-a-name-for-maybe-mzero-return/37266056#37266056", "title": "Is there a name for &quot;maybe mzero return&quot;?", "body": "<ul>\n<li><p><code>optparse-applicative</code> has <a href=\"http://haddock.stackage.org/lts-5.17/optparse-applicative-0.12.1.0/src/Options-Applicative-Internal.html#hoistMaybe\" rel=\"nofollow\"><code>hoistMaybe</code></a>.</p></li>\n<li><p><code>monad-extras</code> has <a href=\"http://haddock.stackage.org/lts-5.17/monad-extras-0.5.11/src/Control-Monad-Extra.html#liftMaybe\" rel=\"nofollow\"><code>liftMaybe</code></a>.</p></li>\n<li><p><code>errors</code> has <a href=\"http://haddock.stackage.org/lts-5.17/errors-2.1.2/src/Control-Error-Safe.html#justZ\" rel=\"nofollow\"><code>justZ</code></a>.</p></li>\n<li><p><code>IfElse</code> has <a href=\"http://haddock.stackage.org/lts-5.17/IfElse-0.85/src/Control-Monad-IfElse.html#maybeMP\" rel=\"nofollow\"><code>maybeMP</code></a></p></li>\n</ul>\n\n<p>All of the above are the same.</p>\n\n<p>An obvious variant would be</p>\n\n<pre><code>maybeAlt :: Alternative f =&gt; Maybe a -&gt; f a\nmaybeAlt = maybe empty pure\n</code></pre>\n\n<p>And this is a special case of the following, similar to <code>asum</code>.</p>\n\n<pre><code>import Data.Monoid\nimport Control.Applicative\n\nfoldAlt :: (Foldable f, Alternative m) =&gt; f a -&gt; m a\nfoldAlt = getAlt . foldMap (Alt . pure)\n</code></pre>\n\n<p>The reason you won't find this anywhere is that <code>pure a &lt;|&gt; x === pure a</code>. So it's good for this and not much else. It could be improved to</p>\n\n<pre><code>foldAltMap f = getAlt . foldMap (Alt . f)\n</code></pre>\n\n<p>or</p>\n\n<pre><code>foldrAltMap f = foldr (\\x r -&gt; f x &lt;|&gt; r) empty\n</code></pre>\n\n<p>but it's probably clearer just to write it out.</p>\n"}], "owner": {"reputation": 49959, "user_id": 866915, "user_type": "registered", "accept_rate": 70, "profile_image": "https://www.gravatar.com/avatar/09242131d6e17cbbe31e8547514da6e5?s=128&d=identicon&r=PG", "display_name": "ErikR", "link": "https://stackoverflow.com/users/866915/erikr"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 168, "favorite_count": 1, "answer_count": 1, "score": 5, "last_activity_date": 1613796636, "creation_date": 1463449974, "last_edit_date": 1613796636, "question_id": 37265877, "link": "https://stackoverflow.com/questions/37265877/is-there-a-name-for-maybe-mzero-return", "title": "Is there a name for &quot;maybe mzero return&quot;?", "body": "<p>Is there an established name for <code>maybe mzero return</code>?</p>\n\n<p>It has the type:</p>\n\n<pre><code>MonadPlus m =&gt; Maybe a -&gt; m a\n</code></pre>\n\n<p>and converts <code>Nothing</code> to failure and <code>Just a</code> to <code>return a</code>.</p>\n"}, {"tags": ["haskell", "functional-programming"], "comments": [{"owner": {"reputation": 49959, "user_id": 866915, "user_type": "registered", "accept_rate": 70, "profile_image": "https://www.gravatar.com/avatar/09242131d6e17cbbe31e8547514da6e5?s=128&d=identicon&r=PG", "display_name": "ErikR", "link": "https://stackoverflow.com/users/866915/erikr"}, "edited": false, "score": 0, "creation_date": 1463447580, "post_id": 37265446, "comment_id": 62057918, "body": "Works for me: <a href=\"http://ideone.com/oiDu42\" rel=\"nofollow noreferrer\">ideone.com/oiDu42</a> What version of GHC are you using?"}, {"owner": {"reputation": 145, "user_id": 3404325, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/7f3c207f41ff6a694ae6611550989ef6?s=128&d=identicon&r=PG", "display_name": "wwayne", "link": "https://stackoverflow.com/users/3404325/wwayne"}, "reply_to_user": {"reputation": 49959, "user_id": 866915, "user_type": "registered", "accept_rate": 70, "profile_image": "https://www.gravatar.com/avatar/09242131d6e17cbbe31e8547514da6e5?s=128&d=identicon&r=PG", "display_name": "ErikR", "link": "https://stackoverflow.com/users/866915/erikr"}, "edited": false, "score": 0, "creation_date": 1463448004, "post_id": 37265446, "comment_id": 62058014, "body": "@ErikR I&#39;m using 7.10.3"}, {"owner": {"reputation": 49959, "user_id": 866915, "user_type": "registered", "accept_rate": 70, "profile_image": "https://www.gravatar.com/avatar/09242131d6e17cbbe31e8547514da6e5?s=128&d=identicon&r=PG", "display_name": "ErikR", "link": "https://stackoverflow.com/users/866915/erikr"}, "edited": false, "score": 0, "creation_date": 1463448452, "post_id": 37265446, "comment_id": 62058117, "body": "Also verified to work with 7.10.3. Create an input file to just those six lines and check."}, {"owner": {"reputation": 145, "user_id": 3404325, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/7f3c207f41ff6a694ae6611550989ef6?s=128&d=identicon&r=PG", "display_name": "wwayne", "link": "https://stackoverflow.com/users/3404325/wwayne"}, "reply_to_user": {"reputation": 49959, "user_id": 866915, "user_type": "registered", "accept_rate": 70, "profile_image": "https://www.gravatar.com/avatar/09242131d6e17cbbe31e8547514da6e5?s=128&d=identicon&r=PG", "display_name": "ErikR", "link": "https://stackoverflow.com/users/866915/erikr"}, "edited": false, "score": 0, "creation_date": 1463451337, "post_id": 37265446, "comment_id": 62058819, "body": "@ErikR yeah I saw it in ideone.com, I got this error when I try to execute :l xx.hs, I don&#39;t know if there are something to do with"}], "answers": [{"comments": [{"owner": {"reputation": 145, "user_id": 3404325, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/7f3c207f41ff6a694ae6611550989ef6?s=128&d=identicon&r=PG", "display_name": "wwayne", "link": "https://stackoverflow.com/users/3404325/wwayne"}, "edited": false, "score": 0, "creation_date": 1463459462, "post_id": 37266256, "comment_id": 62060758, "body": "Yeah you&#39;re right, and I posted the completed code, I didn&#39;t do it because I don&#39;t want to confuse others. And why here I have to add constraints on encodeModified&#39;, it shouldn&#39;t inherit from encodeModified? or I misunderstand something here? thanks"}, {"owner": {"reputation": 126897, "user_id": 791604, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/ce991df7a056248d5e4f6fc3659ba733?s=128&d=identicon&r=PG", "display_name": "Daniel Wagner", "link": "https://stackoverflow.com/users/791604/daniel-wagner"}, "reply_to_user": {"reputation": 145, "user_id": 3404325, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/7f3c207f41ff6a694ae6611550989ef6?s=128&d=identicon&r=PG", "display_name": "wwayne", "link": "https://stackoverflow.com/users/3404325/wwayne"}, "edited": false, "score": 0, "creation_date": 1463460455, "post_id": 37266256, "comment_id": 62060997, "body": "@wwayne What do you mean by &quot;inherit&quot;? Certainly there is no inheritance in the OO sense in Haskell."}, {"owner": {"reputation": 145, "user_id": 3404325, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/7f3c207f41ff6a694ae6611550989ef6?s=128&d=identicon&r=PG", "display_name": "wwayne", "link": "https://stackoverflow.com/users/3404325/wwayne"}, "edited": false, "score": 0, "creation_date": 1463461663, "post_id": 37266256, "comment_id": 62061401, "body": "My bad, I re-check what &#39; is in Haskell, it doesn&#39;t have special meaning, I misunderstood of it. Anyway, thanks for your patience and answer."}], "tags": [], "owner": {"reputation": 126897, "user_id": 791604, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/ce991df7a056248d5e4f6fc3659ba733?s=128&d=identicon&r=PG", "display_name": "Daniel Wagner", "link": "https://stackoverflow.com/users/791604/daniel-wagner"}, "is_accepted": true, "score": 3, "last_activity_date": 1463452961, "creation_date": 1463452961, "answer_id": 37266256, "question_id": 37265446, "link": "https://stackoverflow.com/questions/37265446/the-type-variable-is-ambiguous-in-haskell/37266256#37266256", "title": "The type variable is ambiguous in Haskell", "body": "<p>Your code here includes an <code>Eq a</code> constraint in the type of <code>encodeModified</code>, but from the error you posted, I can see that the type you actually have in your file for <code>encodeModified'</code> (note the prime!) does not have that constraint. Add the constraint and you should be good to go.</p>\n\n<p>In the future, it is polite to post the code you are <em>actually</em> having a problem with.</p>\n"}], "owner": {"reputation": 145, "user_id": 3404325, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/7f3c207f41ff6a694ae6611550989ef6?s=128&d=identicon&r=PG", "display_name": "wwayne", "link": "https://stackoverflow.com/users/3404325/wwayne"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 456, "favorite_count": 1, "closed_date": 1463470435, "accepted_answer_id": 37266256, "answer_count": 1, "score": 0, "last_activity_date": 1463459298, "creation_date": 1463446533, "last_edit_date": 1463459298, "question_id": 37265446, "link": "https://stackoverflow.com/questions/37265446/the-type-variable-is-ambiguous-in-haskell", "closed_reason": "Duplicate", "title": "The type variable is ambiguous in Haskell", "body": "<p><strong>This is the original question:</strong></p>\n\n<p>Modify the result of problem 10 in such a way that if an element has no duplicates it is simply copied into the result list. Only elements with duplicates are transferred as (N E) lists.</p>\n\n<p>Example:</p>\n\n<pre><code>* (encode-modified '(a a a a b c c a a d e e e e))\n((4 A) B (2 C) (2 A) D (4 E))\n</code></pre>\n\n<p>Example in Haskell:</p>\n\n<pre><code>ghci&gt; encodeModified \"aaaabccaadeeee\"\n[Multiple 4 'a',Single 'b',Multiple 2 'c',\nMultiple 2 'a',Single 'd',Multiple 4 'e']\n</code></pre>\n\n<p><strong>This is my solution:</strong></p>\n\n<pre><code>import Data.List\n\ndata Encode a = Single a | Multiple Int a deriving (Show)\n\nencodeModified :: (Eq a) =&gt; [a] -&gt; [Encode a]\nencodeModified xs = [y | x &lt;- group xs, let y = if (length x) == 1   then Single (head x) else Multiple (length x) (head x)]\n\nencodeModified' = map (\\xs -&gt; if (length xs == 1) then Single (head xs) else Multiple (length xs) (head xs)) . group\n</code></pre>\n\n<p>My GHCI is 7.10.3, when I execute :l xx.hs, it gives me:</p>\n\n<pre><code>No instance for (Eq a0) arising from a use of \u2018group\u2019\n    The type variable \u2018a0\u2019 is ambiguous\n    Relevant bindings include\n      encodeModified' :: [a0] -&gt; [Encode a0] (bound at 11.hs:8:1)\n    Note: there are several potential instances:\n      instance (Eq a, Eq b) =&gt; Eq (Either a b)\n        -- Defined in \u2018Data.Either\u2019\n      instance forall (k :: BOX) (s :: k). Eq (Data.Proxy.Proxy s)\n        -- Defined in \u2018Data.Proxy\u2019\n      instance (GHC.Arr.Ix i, Eq e) =&gt; Eq (GHC.Arr.Array i e)\n        -- Defined in \u2018GHC.Arr\u2019\n      ...plus 27 others\n    In the second argument of \u2018(.)\u2019, namely \u2018group\u2019\n    In the expression:\n      map\n        (\\ xs\n           -&gt; if (length xs == 1) then\n                  Single (head xs)\n              else\n                  Multiple (length xs) (head xs))\n      . group\n    In an equation for \u2018encodeModified'\u2019:\n        encodeModified'\n          = map\n              (\\ xs\n                 -&gt; if (length xs == 1) then\n                        Single (head xs)\n                    else\n                        Multiple (length xs) (head xs))\n            . group\n</code></pre>\n\n<p>I can't figure out what's the error by its feedback and I didn't find anything wrong with my method, if someone can help me? thanks.</p>\n"}, {"tags": ["haskell", "yesod", "keter"], "comments": [{"owner": {"reputation": 48129, "user_id": 76051, "user_type": "registered", "accept_rate": 91, "profile_image": "https://i.stack.imgur.com/AGDxz.jpg?s=128&g=1", "display_name": "Carsten", "link": "https://stackoverflow.com/users/76051/carsten"}, "edited": false, "score": 0, "creation_date": 1463457504, "post_id": 37265378, "comment_id": 62060205, "body": "is keter running? What do the log files say?"}, {"owner": {"reputation": 1336, "user_id": 2801316, "user_type": "registered", "accept_rate": 87, "profile_image": "https://i.stack.imgur.com/cqx1a.jpg?s=128&g=1", "display_name": "FtheBuilder", "link": "https://stackoverflow.com/users/2801316/fthebuilder"}, "reply_to_user": {"reputation": 48129, "user_id": 76051, "user_type": "registered", "accept_rate": 91, "profile_image": "https://i.stack.imgur.com/AGDxz.jpg?s=128&g=1", "display_name": "Carsten", "link": "https://stackoverflow.com/users/76051/carsten"}, "edited": false, "score": 0, "creation_date": 1463493256, "post_id": 37265378, "comment_id": 62081739, "body": "I copied an updated version of my project to <code>keter&#47;incoming</code> to know if any log would change, but neither <code>log&#47;keter&#47;current.log</code> nor <code>log&#47;app-MyProject&#47;current.log</code> changed."}, {"owner": {"reputation": 48129, "user_id": 76051, "user_type": "registered", "accept_rate": 91, "profile_image": "https://i.stack.imgur.com/AGDxz.jpg?s=128&g=1", "display_name": "Carsten", "link": "https://stackoverflow.com/users/76051/carsten"}, "edited": false, "score": 0, "creation_date": 1463494326, "post_id": 37265378, "comment_id": 62082602, "body": "well what does the log say and is keter running?"}, {"owner": {"reputation": 1336, "user_id": 2801316, "user_type": "registered", "accept_rate": 87, "profile_image": "https://i.stack.imgur.com/cqx1a.jpg?s=128&g=1", "display_name": "FtheBuilder", "link": "https://stackoverflow.com/users/2801316/fthebuilder"}, "reply_to_user": {"reputation": 48129, "user_id": 76051, "user_type": "registered", "accept_rate": 91, "profile_image": "https://i.stack.imgur.com/AGDxz.jpg?s=128&g=1", "display_name": "Carsten", "link": "https://stackoverflow.com/users/76051/carsten"}, "edited": false, "score": 0, "creation_date": 1463495242, "post_id": 37265378, "comment_id": 62083277, "body": "ketter is not running as a service. When I try the keter command it shows: <code>keter: Usage: keter &lt;config file&gt;</code>. nginx is installed and running."}, {"owner": {"reputation": 48129, "user_id": 76051, "user_type": "registered", "accept_rate": 91, "profile_image": "https://i.stack.imgur.com/AGDxz.jpg?s=128&g=1", "display_name": "Carsten", "link": "https://stackoverflow.com/users/76051/carsten"}, "edited": false, "score": 0, "creation_date": 1463496017, "post_id": 37265378, "comment_id": 62083896, "body": "well if it is not running it will not process the files"}, {"owner": {"reputation": 1336, "user_id": 2801316, "user_type": "registered", "accept_rate": 87, "profile_image": "https://i.stack.imgur.com/cqx1a.jpg?s=128&g=1", "display_name": "FtheBuilder", "link": "https://stackoverflow.com/users/2801316/fthebuilder"}, "reply_to_user": {"reputation": 48129, "user_id": 76051, "user_type": "registered", "accept_rate": 91, "profile_image": "https://i.stack.imgur.com/AGDxz.jpg?s=128&g=1", "display_name": "Carsten", "link": "https://stackoverflow.com/users/76051/carsten"}, "edited": false, "score": 0, "creation_date": 1463530845, "post_id": 37265378, "comment_id": 62101263, "body": "I was able to make keter run, but I am getting this in my log: <code>Error occured when launching bundle Fastwork: Codec.Compression.Zlib: premature end of compressed data stream</code>"}, {"owner": {"reputation": 1336, "user_id": 2801316, "user_type": "registered", "accept_rate": 87, "profile_image": "https://i.stack.imgur.com/cqx1a.jpg?s=128&g=1", "display_name": "FtheBuilder", "link": "https://stackoverflow.com/users/2801316/fthebuilder"}, "reply_to_user": {"reputation": 48129, "user_id": 76051, "user_type": "registered", "accept_rate": 91, "profile_image": "https://i.stack.imgur.com/AGDxz.jpg?s=128&g=1", "display_name": "Carsten", "link": "https://stackoverflow.com/users/76051/carsten"}, "edited": false, "score": 0, "creation_date": 1463532285, "post_id": 37265378, "comment_id": 62101571, "body": "There is a Welcome keter saying: <code>The hostname you have provided, localhost, is not recognized.</code> I think there is something missing..."}, {"owner": {"reputation": 48129, "user_id": 76051, "user_type": "registered", "accept_rate": 91, "profile_image": "https://i.stack.imgur.com/AGDxz.jpg?s=128&g=1", "display_name": "Carsten", "link": "https://stackoverflow.com/users/76051/carsten"}, "edited": false, "score": 0, "creation_date": 1463543492, "post_id": 37265378, "comment_id": 62104305, "body": "the first one looks like your archive is corrupted (I would suggest trying <code>yesod keter</code> instead of packing it yourself) - for the second one we would need to see your settings/config file but you can try <code>127.0.0.1</code> or your actual hostname instead"}, {"owner": {"reputation": 48129, "user_id": 76051, "user_type": "registered", "accept_rate": 91, "profile_image": "https://i.stack.imgur.com/AGDxz.jpg?s=128&g=1", "display_name": "Carsten", "link": "https://stackoverflow.com/users/76051/carsten"}, "edited": false, "score": 0, "creation_date": 1463543709, "post_id": 37265378, "comment_id": 62104369, "body": "there is a good intro here: <a href=\"https://pbrisbin.com/posts/yesod_deployments_with_keter/\" rel=\"nofollow noreferrer\">pbrisbin.com/posts/yesod_deployments_with_keter</a> - maybe it helps you"}], "owner": {"reputation": 1336, "user_id": 2801316, "user_type": "registered", "accept_rate": 87, "profile_image": "https://i.stack.imgur.com/cqx1a.jpg?s=128&g=1", "display_name": "FtheBuilder", "link": "https://stackoverflow.com/users/2801316/fthebuilder"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 192, "favorite_count": 0, "answer_count": 0, "score": 1, "last_activity_date": 1463445957, "creation_date": 1463445957, "question_id": 37265378, "link": "https://stackoverflow.com/questions/37265378/deploying-yesod-project-using-keter-at-localhost", "title": "Deploying Yesod project using keter at localhost", "body": "<p>I installed <code>Keter</code> and compiled my project using <code>stack exec -- yesod keter</code>, and then I copied the compiled <code>keter</code> file to <code>/opt/keter/incoming</code>. this is my <code>config/keter.yml</code> file:</p>\n\n<pre><code>exec: ../dist/build/MyProject/MyProject\nhost: localhost\n</code></pre>\n\n<p>and this is my <code>config/settings.yml</code>:</p>\n\n<pre><code># Values formatted like \"_env:ENV_VAR_NAME:default_value\" can be overridden by the specified environment variable.\n# See https://github.com/yesodweb/yesod/wiki/Configuration#overriding-configuration-values-with-environment-variables\n\nstatic-dir:     \"_env:STATIC_DIR:static\"\nhost:           \"_env:HOST:*4\" # any IPv4 host\nport:           \"_env:PORT:80\" # NB: The port `yesod devel` uses is distinct from this value. Set the `yesod devel` port from the command line.\nip-from-header: \"_env:IP_FROM_HEADER:false\"\n\n# Default behavior: determine the application root from the request headers.\n# Uncomment to set an explicit approot\n#approot:        \"_env:APPROOT:http://localhost:3000\"\n\n# Optional values with the following production defaults.\n# In development, they default to the inverse.\n#\n# development: false\n# detailed-logging: false\n# should-log-all: false\n# reload-templates: false\n# mutable-static: false\n# skip-combining: false\n\n# NB: If you need a numeric value (e.g. 123) to parse as a String, wrap it in single quotes (e.g. \"_env:PGPASS:'123'\")\n# See https://github.com/yesodweb/yesod/wiki/Configuration#parsing-numeric-values-as-strings\n\ndatabase:\n  user:     \"_env:MYSQL_USER:root\"\n  password: \"_env:MYSQL_PASSWORD:#123\"\n  host:     \"_env:MYSQL_HOST:localhost\"\n  port:     \"_env:MYSQL_PORT:3306\"\n  # See config/test-settings.yml for an override during tests\n  database: \"_env:MYSQL_DATABASE:mydatabase\"\n  poolsize: \"_env:MYSQL_POOLSIZE:2\"\n\ncopyright: Insert copyright statement here\n#analytics: UA-YOURCODE\n</code></pre>\n\n<p>Is something wrong or missing? I tried to access <code>localhost</code> at port 80 but it wasn't successful.</p>\n\n<p>I installed keter using a script:</p>\n\n<pre><code>wget -O - https://raw.githubusercontent.com/snoyberg/keter/master/setup-keter.sh | bash\n</code></pre>\n"}, {"tags": ["haskell", "profiling", "ghc"], "answers": [{"tags": [], "owner": {"reputation": 343, "user_id": 5085294, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/TOFvi.png?s=128&g=1", "display_name": "Christof Schramm", "link": "https://stackoverflow.com/users/5085294/christof-schramm"}, "is_accepted": false, "score": 3, "last_activity_date": 1499839823, "last_edit_date": 1499839823, "creation_date": 1495655227, "answer_id": 44167262, "question_id": 37263009, "link": "https://stackoverflow.com/questions/37263009/profile-only-a-single-function-or-cost-center-with-ghc/44167262#44167262", "title": "Profile only a single function (or cost center) with GHC", "body": "<p>According to the <a href=\"https://downloads.haskell.org/~ghc/latest/docs/html/users_guide/profiling.html#rts-options-for-heap-profiling\" rel=\"nofollow noreferrer\">ghc manual</a> you can do heap profiling on certain cost centers by e.g. using  -hc\u27e8name\u27e9 or  -hy\u27e8type\u27e9.</p>\n\n<p>I couldn't find a solution that does something similar for time profiling though.</p>\n\n<p><strong>EDIT:</strong></p>\n\n<p>I did actuall manage to find a way to conveniently do what you need for both allocation and time profiling. If you use the <a href=\"https://github.com/jaspervdj/profiteur\" rel=\"nofollow noreferrer\">profiteur</a> visualizer for <code>.prof</code> files you can look at the performance profile of just a certain cost centre as a nicely formatted tree-map.</p>\n"}], "owner": {"reputation": 1073, "user_id": 570693, "user_type": "registered", "accept_rate": 82, "profile_image": "https://www.gravatar.com/avatar/116541a9a982bab83135291c70eb914b?s=128&d=identicon&r=PG&f=1", "display_name": "Karl", "link": "https://stackoverflow.com/users/570693/karl"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 263, "favorite_count": 1, "answer_count": 1, "score": 11, "last_activity_date": 1499839823, "creation_date": 1463431627, "last_edit_date": 1463434633, "question_id": 37263009, "link": "https://stackoverflow.com/questions/37263009/profile-only-a-single-function-or-cost-center-with-ghc", "title": "Profile only a single function (or cost center) with GHC", "body": "<p>I am trying to profile some Haskell code using the GHC profiling tools.  The cost center I am most interested in, however, is dominated currently by a bunch of initialization code that I don't really care about.</p>\n\n<p>My code looks roughly, like this:</p>\n\n<pre><code>main = do\n  x &lt;- lotsOfInitialization\n  print $ {-# SCC \"myCostCenter\" #-} interestingPart x\n</code></pre>\n\n<p>In my actual code, the <code>lotsOfInitialization</code> part is taking ~98% of the time and so it's difficult to see with any granularity what is happening inside <code>interestingPart</code>.  </p>\n\n<p>I thought that only annotating in one place (and not using <code>-fprof-auto</code>) would be enough, but the report I'm getting still shows all the function calls.</p>\n\n<p>I also tried a strictness annotation on <code>x</code>, but that didn't seem to change anything.</p>\n\n<p>Is there some way to tell GHC to ignore the initialization code, or to only focus on the parts I want?</p>\n"}, {"tags": ["haskell", "types"], "comments": [{"owner": {"reputation": 62421, "user_id": 216164, "user_type": "registered", "accept_rate": 89, "profile_image": "https://www.gravatar.com/avatar/786f224adbe0784cdf7d0f15476061fe?s=128&d=identicon&r=PG", "display_name": "Thomas M. DuBuisson", "link": "https://stackoverflow.com/users/216164/thomas-m-dubuisson"}, "edited": false, "score": 5, "creation_date": 1463430283, "post_id": 37261593, "comment_id": 62051889, "body": "I first saw Proxy in Edward&#39;s <a href=\"http://hackage.haskell.org/package/tagged-0.1.0/docs/Data-Tagged.html\" rel=\"nofollow noreferrer\">tagged</a> package, fwiw.  It wasn&#39;t in 0.0 but was in 0.1."}, {"owner": {"reputation": 100185, "user_id": 3234959, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/93bb12ca0f93dfddb33880316f7e66c2?s=128&d=identicon&r=PG&f=1", "display_name": "chi", "link": "https://stackoverflow.com/users/3234959/chi"}, "edited": false, "score": 0, "creation_date": 1463479783, "post_id": 37261593, "comment_id": 62071897, "body": "Interesting question. On other news, I just saw the <i>history</i> tag remark &quot;DO NOT use this tag for questions about the history of a programming concept or feature; those questions are off-topic.&quot;. Sometimes SO policies are surprising. (And yes, this comment is also a bit OT here)."}], "answers": [{"comments": [{"owner": {"reputation": 44013, "user_id": 1477667, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/trgKM.jpg?s=128&g=1", "display_name": "dfeuer", "link": "https://stackoverflow.com/users/1477667/dfeuer"}, "edited": false, "score": 4, "creation_date": 1463447144, "post_id": 37265452, "comment_id": 62057801, "body": "<i>Fantastic</i> research!"}, {"owner": {"reputation": 23444, "user_id": 414413, "user_type": "registered", "accept_rate": 79, "profile_image": "https://www.gravatar.com/avatar/6de2113f01432aa844dc85070ff33e89?s=128&d=identicon&r=PG", "display_name": "Cirdec", "link": "https://stackoverflow.com/users/414413/cirdec"}, "edited": false, "score": 2, "creation_date": 1463448611, "post_id": 37265452, "comment_id": 62058161, "body": "Universally quantifying proxy is useful when users of a library are probably already in possession of an <code>f a</code> for some <code>f</code>. For example <code>datatypeName :: Datatype d =&gt; t d (f :: * -&gt; *) a -&gt; [Char]</code> <a href=\"https://hackage.haskell.org/package/base/docs/GHC-Generics.html#t:Datatype\" rel=\"nofollow noreferrer\">from Generics</a> is a funny-kinded <code>Datatype d =&gt; proxy d -&gt; [Char]</code> that&#39;s convenient for someone who is holding an <code>M1 D d f p</code> meta node of a generic representation."}, {"owner": {"reputation": 44013, "user_id": 1477667, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/trgKM.jpg?s=128&g=1", "display_name": "dfeuer", "link": "https://stackoverflow.com/users/1477667/dfeuer"}, "edited": false, "score": 1, "creation_date": 1463469286, "post_id": 37265452, "comment_id": 62065004, "body": "Interestingly, Lammel and Jones describe their technique as standard. Also interestingly, it is definitely <i>not</i> the modern proxy technique. Their <code>Proxy a</code> is uninhabited, for vague reasons that don&#39;t really seem sensible."}, {"owner": {"reputation": 44013, "user_id": 1477667, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/trgKM.jpg?s=128&g=1", "display_name": "dfeuer", "link": "https://stackoverflow.com/users/1477667/dfeuer"}, "edited": false, "score": 1, "creation_date": 1463469578, "post_id": 37265452, "comment_id": 62065147, "body": "<a href=\"http://stackoverflow.com/questions/33112439/what-does-mean-in-haskell/33115522#33115522\">pigworker&#39;s explanation of <code>()</code></a> gets at the heart of why Lammel and Jones were wrong about that, and why the modern <code>Proxy</code> is right."}, {"owner": {"reputation": 44013, "user_id": 1477667, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/trgKM.jpg?s=128&g=1", "display_name": "dfeuer", "link": "https://stackoverflow.com/users/1477667/dfeuer"}, "reply_to_user": {"reputation": 23444, "user_id": 414413, "user_type": "registered", "accept_rate": 79, "profile_image": "https://www.gravatar.com/avatar/6de2113f01432aa844dc85070ff33e89?s=128&d=identicon&r=PG", "display_name": "Cirdec", "link": "https://stackoverflow.com/users/414413/cirdec"}, "edited": false, "score": 1, "creation_date": 1463547399, "post_id": 37265452, "comment_id": 62105461, "body": "@Cirdec, it&#39;s also sometimes convenient to be able to pass a singleton as a proxy."}], "tags": [], "owner": {"reputation": 9772, "user_id": 3963, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/9pDQ8.png?s=128&g=1", "display_name": "hao", "link": "https://stackoverflow.com/users/3963/hao"}, "is_accepted": false, "score": 21, "last_activity_date": 1463460560, "last_edit_date": 1463460560, "creation_date": 1463446568, "answer_id": 37265452, "question_id": 37261593, "link": "https://stackoverflow.com/questions/37261593/who-invented-proxy-passing-and-when/37265452#37265452", "title": "Who invented proxy passing and when?", "body": "<p>A <em>fantastic</em> question. <a href=\"https://ghc.haskell.org/trac/ghc/wiki/TypeLevelReasoning\" rel=\"noreferrer\">TypeLevelReasoning</a>, an early GHC proposal from April 2013, references the <code>libraries</code> thread <a href=\"https://mail.haskell.org/pipermail/libraries/2013-April/019653.html\" rel=\"noreferrer\">\"Proxy, new Typeable, and type-level equality\"</a> (original poster Richard Eisenberg, the driving force behind many of the recent dependent Haskell work). That thread references another <code>libraries</code> thread <a href=\"https://mail.haskell.org/pipermail/libraries/2013-January/019343.html\" rel=\"noreferrer\">\"Proxy and new-typeable\"</a> (original poster Shachaf Ben-Kiki), which was started in response to a patch from the <code>new-typeable</code> branch. It is difficult to find a record of old branch names and which commits they pointed at, but <a href=\"https://github.com/ghc/ghc/commit/3d53407f9c6e87bcff30d51f0a048e92b2745a32\" rel=\"noreferrer\">commit 3d53407 by Jos\u00e9 Pedro Magalh\u00e3es</a> seems to be the squashed version of that branch. Indeed it appears to be the first commit landing in GHC to introduce a <code>data Proxy t = Proxy</code> type. Eisenberg would later move that type to <code>Data.Proxy</code> in <a href=\"https://github.com/ghc/ghc/commits/master/libraries/base/Data/Proxy.hs\" rel=\"noreferrer\">commit 01aa22b</a> in February 2013. The final design of <code>Proxy</code> seems to be collective synthesis of ideas from many people. However, we can find academic references to <code>Proxy</code> in Magalh\u00e3es' work, such as his presentation <a href=\"https://web.archive.org/save/_embed/http://foswiki.cs.uu.nl/foswiki/pub/GP/Schedule/LieweVanBinsbergen.pdf\" rel=\"noreferrer\">\"The right Kind of Generic Programming\"</a> (October 2012) and his blog post <a href=\"https://web.archive.org/save/http://hauptwerk.blogspot.com/2012/11/coming-soon-in-ghc-head-poly-kinded.html\" rel=\"noreferrer\">\"Coming soon in GHC HEAD: poly-kinded Typeable\"</a> (November 2012). We can probably attribute the inclusion of <code>Proxy</code> in base to him.</p>\n\n<p>However, the idea of a <code>Proxy</code> type seems much older:</p>\n\n<ul>\n<li><p><a href=\"https://web.archive.org/save/http://research.microsoft.com/en-us/people/dimitris/fc-kind-poly.pdf\" rel=\"noreferrer\">\"Giving Haskell a promotion\"</a> by Yorgey, Cretin, SPJ (October 2011)</p></li>\n<li><p><a href=\"https://web.archive.org/save/http://research.microsoft.com/en-us/um/people/simonpj/papers/hmap/gmap3.pdf\" rel=\"noreferrer\">\"Scrap your boilerplate with class\"</a> by Lammel, Jones (ICFP 2005)</p></li>\n</ul>\n\n<p>It is here that my Google searches turn up dry. I cannot seem to find an antecedent to that 2005 paper.</p>\n\n<p>Coda: Shachaf's proposal in that thread, of universally quantifying the proxy type by using <code>forall proxy a. proxy a</code> (which the base libraries still use to this day) instead of <code>forall a. Proxy a</code> is itself interesting, as that and other emails in the thread suggest there at one point might have been multiple instances of <code>Proxy</code> floating around the Haskell ecosystem. As mentioned in the comments, <a href=\"https://github.com/ekmett/tagged/commit/4f08e84c78ea3a77f6c270ddf169588e99b67dc2\" rel=\"noreferrer\">Kmett's tagged library had it back in June 2010</a>.</p>\n"}], "owner": {"reputation": 44013, "user_id": 1477667, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/trgKM.jpg?s=128&g=1", "display_name": "dfeuer", "link": "https://stackoverflow.com/users/1477667/dfeuer"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 554, "favorite_count": 1, "answer_count": 1, "score": 29, "last_activity_date": 1463496488, "creation_date": 1463426364, "last_edit_date": 1463496488, "question_id": 37261593, "link": "https://stackoverflow.com/questions/37261593/who-invented-proxy-passing-and-when", "title": "Who invented proxy passing and when?", "body": "<p>It seems that until recent years, the usual way to pass an extra type to a function was to do something like</p>\n\n<pre><code>f (undefined :: T)\n</code></pre>\n\n<p>Kiselyov and Shan even used this approach in their classic paper on class-based reflection that inspired the <code>reflection</code> package. They excused the obvious ugliness by noting that the bogus value is never inspected. And an only slightly less ugly incarnation appears in <code>Data.Bits.finiteBitSize</code>, which takes a value it ignores to get its type.</p>\n\n<p>Then <em>someone</em> figured out the proxy idiom, and everything changed. Now we always see the much more satisfactory</p>\n\n<pre><code>f (Proxy :: Proxy T)\n</code></pre>\n\n<p>(in standard code&mdash;GHC type application is another story).</p>\n\n<p>Who figured it out? Did this first appear in code somewhere, or a paper?</p>\n"}, {"tags": ["function", "haskell", "parameters", "pointfree"], "comments": [{"owner": {"reputation": 314794, "user_id": 67579, "user_type": "registered", "accept_rate": 81, "profile_image": "https://i.stack.imgur.com/BJXub.png?s=128&g=1", "display_name": "Willem Van Onsem", "link": "https://stackoverflow.com/users/67579/willem-van-onsem"}, "edited": false, "score": 2, "creation_date": 1463424336, "post_id": 37261030, "comment_id": 62048789, "body": "&quot;<i>I know that if a function takes n parameters then you must provide n parameters in the function definition.</i>&quot; False, you can decide to write <i>n</i> parameters in the function definition and generate a function that takes the remaining arguments. That&#39;s one of the basic concepts of functional programming."}, {"owner": {"reputation": 25, "user_id": 6338205, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/dc04992a7b216cb63dba8bfbccc4856f?s=128&d=identicon&r=PG&f=1", "display_name": "Bill Jobs", "link": "https://stackoverflow.com/users/6338205/bill-jobs"}, "reply_to_user": {"reputation": 314794, "user_id": 67579, "user_type": "registered", "accept_rate": 81, "profile_image": "https://i.stack.imgur.com/BJXub.png?s=128&g=1", "display_name": "Willem Van Onsem", "link": "https://stackoverflow.com/users/67579/willem-van-onsem"}, "edited": false, "score": 0, "creation_date": 1463424461, "post_id": 37261030, "comment_id": 62048866, "body": "What do you mean by the remaining arguments?"}, {"owner": {"reputation": 55059, "user_id": 212858, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/1166c87b6f3fc2e6746da96b60fefb46?s=128&d=identicon&r=PG", "display_name": "Useless", "link": "https://stackoverflow.com/users/212858/useless"}, "edited": false, "score": 0, "creation_date": 1463424644, "post_id": 37261030, "comment_id": 62048988, "body": "If the expression <code>flip $ M.findWithDefault Blank</code> yields a function of the desired type, calling <code>getMarker</code> will call <i>that</i> function directly, and <code>getMarker</code> doesn&#39;t have to touch the arguments to pass them through."}, {"owner": {"reputation": 100185, "user_id": 3234959, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/93bb12ca0f93dfddb33880316f7e66c2?s=128&d=identicon&r=PG&f=1", "display_name": "chi", "link": "https://stackoverflow.com/users/3234959/chi"}, "edited": false, "score": 1, "creation_date": 1463427481, "post_id": 37261030, "comment_id": 62050422, "body": "<code>f = (+)</code> defines a 2-argument function, and is equivalent to <code>f x y = (+) x y</code>. What is really weird is that, in some cases, there is no clear notion of &quot;number of arguments&quot;. Consider <code>f x = x</code>. It has one argument. But is also has 5: <code>f f f f f 1</code> evaluates to <code>1</code>. Function <code>f</code> has N parameters for any <code>N</code>."}, {"owner": {"reputation": 384463, "user_id": 1126841, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/fa05233b2357f8d11c22ef4cfc7bb85c?s=128&d=identicon&r=PG", "display_name": "chepner", "link": "https://stackoverflow.com/users/1126841/chepner"}, "edited": false, "score": 1, "creation_date": 1463429229, "post_id": 37261030, "comment_id": 62051331, "body": "In reality, <i>all</i> functions in Haskell take a single argument; a &quot;two-argument&quot; function really just returns another function. The left associativity of function application allows something like <code>f x y</code> (which is explicitly parenthesized as <code>(f x) y</code>) <i>look</i> like <code>f</code> is being applied to two arguments."}], "answers": [{"tags": [], "owner": {"reputation": 55059, "user_id": 212858, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/1166c87b6f3fc2e6746da96b60fefb46?s=128&d=identicon&r=PG", "display_name": "Useless", "link": "https://stackoverflow.com/users/212858/useless"}, "is_accepted": true, "score": 4, "last_activity_date": 1463449221, "last_edit_date": 1463449221, "creation_date": 1463425030, "answer_id": 37261247, "question_id": 37261030, "link": "https://stackoverflow.com/questions/37261030/haskell-function-takes-2-parameters-but-in-the-definition-none/37261247#37261247", "title": "Haskell function takes 2 parameters but in the definition none", "body": "<p>The misconception is here:</p>\n\n<blockquote>\n  <p>... (you can see that <code>getMarker</code> takes 0 parameters at the last line) ...</p>\n</blockquote>\n\n<p>and the thing that's puzzling you is <a href=\"https://wiki.haskell.org/Partial_application\" rel=\"nofollow\">partial application</a>.</p>\n\n<hr>\n\n<pre><code>getMarker :: Board -&gt; (Int, Int) -&gt; Marker\ngetMarker = flip $ M.findWithDefault Blank\n</code></pre>\n\n<p>What that last line <em>actually</em> tells you is that the <code>getMarker</code> doesn't <em>do</em> anything with its arguments - but they still get passed to the function created by <code>flip $ M.findWithDefault Blank</code>.</p>\n\n<p>Or, more accurately, <code>getMarker</code> evaluates to a function of the declared type which is <em>applied to</em> <code>getMarker</code>'s arguments.</p>\n"}, {"tags": [], "owner": {"reputation": 4565, "user_id": 1134885, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/7c428466054762cf7d4b5fb5f4396fa2?s=128&d=identicon&r=PG", "display_name": "NovaDenizen", "link": "https://stackoverflow.com/users/1134885/novadenizen"}, "is_accepted": false, "score": 1, "last_activity_date": 1463435975, "creation_date": 1463435975, "answer_id": 37263944, "question_id": 37261030, "link": "https://stackoverflow.com/questions/37261030/haskell-function-takes-2-parameters-but-in-the-definition-none/37263944#37263944", "title": "Haskell function takes 2 parameters but in the definition none", "body": "<p>You have <code>getMarker :: Board -&gt; (Int, Int) -&gt; Marker</code>, so it's called like</p>\n\n<pre><code>getMarker board pos\n</code></pre>\n\n<p>Since you have <code>getMarker = flip $ M.findWithDefault Blank</code>, this is equivalent to:</p>\n\n<pre><code>(flip $ M.findWithDefault Blank) board pos\n</code></pre>\n\n<p>Expanding <code>$</code>:</p>\n\n<pre><code>(flip (M.findWithDefault Blank)) board pos\n</code></pre>\n\n<p>Function application is left associative, so <code>(f x) y</code> is equivalent to <code>f x y</code>.</p>\n\n<pre><code>flip (M.findWithDefault Blank) board pos\n</code></pre>\n\n<p><code>flip f x y</code> is equivalent to <code>f y x</code>, so the expression is equal to:</p>\n\n<pre><code>(M.findWithDefault Blank) pos board\n</code></pre>\n\n<p>Again, thanks to left associativity of function application:</p>\n\n<pre><code>M.findWithDefault Blank pos board\n</code></pre>\n\n<p>And this is sensible.</p>\n"}], "owner": {"reputation": 25, "user_id": 6338205, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/dc04992a7b216cb63dba8bfbccc4856f?s=128&d=identicon&r=PG&f=1", "display_name": "Bill Jobs", "link": "https://stackoverflow.com/users/6338205/bill-jobs"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 855, "favorite_count": 0, "accepted_answer_id": 37261247, "answer_count": 2, "score": 1, "last_activity_date": 1463449221, "creation_date": 1463424222, "last_edit_date": 1463449204, "question_id": 37261030, "link": "https://stackoverflow.com/questions/37261030/haskell-function-takes-2-parameters-but-in-the-definition-none", "title": "Haskell function takes 2 parameters but in the definition none", "body": "<p>I am new to Haskell and I am trying to understand a game created in Haskell (tic tac toe). I know that if a function takes n parameters then you must provide n parameters in the function definition. Example:</p>\n\n<pre><code>f :: Int -&gt; Int -&gt; String\nf a b = \"This function makes no sense\" \n</code></pre>\n\n<p>However in this Haskell script there is a function that takes two arguments but in the definition it has none. And of course, it's working but I can't seem to figure out why.</p>\n\n<pre><code>import Data.Map qualified as M\ntype Board = M.Map (Int, Int) Marker\ndata Marker = X | O | Blank deriving Eq\n\ngetMarker :: Board -&gt; (Int, Int) -&gt; Marker\ngetMarker = flip $ M.findWithDefault Blank\n</code></pre>\n\n<p>Any ideas on what this function does and more importantly, why it's working (you can see that <code>getMarker</code> takes 0 parameters at the last line) ?</p>\n"}, {"tags": ["database", "haskell", "sqlite", "sql-update"], "comments": [{"owner": {"reputation": 49959, "user_id": 866915, "user_type": "registered", "accept_rate": 70, "profile_image": "https://www.gravatar.com/avatar/09242131d6e17cbbe31e8547514da6e5?s=128&d=identicon&r=PG", "display_name": "ErikR", "link": "https://stackoverflow.com/users/866915/erikr"}, "edited": false, "score": 0, "creation_date": 1463421783, "post_id": 37259445, "comment_id": 62047401, "body": "What is the error message? Is it a compiler error or a run-time error?"}, {"owner": {"reputation": 13, "user_id": 6341915, "user_type": "registered", "profile_image": "https://graph.facebook.com/897359897039651/picture?type=large", "display_name": "Relu", "link": "https://stackoverflow.com/users/6341915/relu"}, "reply_to_user": {"reputation": 49959, "user_id": 866915, "user_type": "registered", "accept_rate": 70, "profile_image": "https://www.gravatar.com/avatar/09242131d6e17cbbe31e8547514da6e5?s=128&d=identicon&r=PG", "display_name": "ErikR", "link": "https://stackoverflow.com/users/866915/erikr"}, "edited": false, "score": 0, "creation_date": 1463423201, "post_id": 37259445, "comment_id": 62048150, "body": "It is a run-time error : SQLite3 returned ErrorMisuse while attempting to perform prepare &quot;UPDATE test SET v = ?&quot;: library routine called out of sequence"}], "answers": [{"comments": [{"owner": {"reputation": 13, "user_id": 6341915, "user_type": "registered", "profile_image": "https://graph.facebook.com/897359897039651/picture?type=large", "display_name": "Relu", "link": "https://stackoverflow.com/users/6341915/relu"}, "edited": false, "score": 0, "creation_date": 1463424114, "post_id": 37260819, "comment_id": 62048666, "body": "Yes, i was using the connection in 3 threads since the purpose of my program was to test whether sqlite is single-threaded or not. If this was the cause of the error, then my test seems to prove that sqlite is not multi-threaded. Thank you :D"}, {"owner": {"reputation": 49959, "user_id": 866915, "user_type": "registered", "accept_rate": 70, "profile_image": "https://www.gravatar.com/avatar/09242131d6e17cbbe31e8547514da6e5?s=128&d=identicon&r=PG", "display_name": "ErikR", "link": "https://stackoverflow.com/users/866915/erikr"}, "reply_to_user": {"reputation": 13, "user_id": 6341915, "user_type": "registered", "profile_image": "https://graph.facebook.com/897359897039651/picture?type=large", "display_name": "Relu", "link": "https://stackoverflow.com/users/6341915/relu"}, "edited": false, "score": 0, "creation_date": 1463424480, "post_id": 37260819, "comment_id": 62048884, "body": "Each connection is single threaded, but sqlite allows concurrent access and updates, so just open up a new connection for each thread."}, {"owner": {"reputation": 49959, "user_id": 866915, "user_type": "registered", "accept_rate": 70, "profile_image": "https://www.gravatar.com/avatar/09242131d6e17cbbe31e8547514da6e5?s=128&d=identicon&r=PG", "display_name": "ErikR", "link": "https://stackoverflow.com/users/866915/erikr"}, "reply_to_user": {"reputation": 13, "user_id": 6341915, "user_type": "registered", "profile_image": "https://graph.facebook.com/897359897039651/picture?type=large", "display_name": "Relu", "link": "https://stackoverflow.com/users/6341915/relu"}, "edited": false, "score": 0, "creation_date": 1463424524, "post_id": 37260819, "comment_id": 62048912, "body": "For instance - see this SO answer: <a href=\"http://stackoverflow.com/questions/4060772/sqlite3-concurrent-access\" title=\"sqlite3 concurrent access\">stackoverflow.com/questions/4060772/sqlite3-concurrent-acces&zwnj;&#8203;s</a>"}], "tags": [], "owner": {"reputation": 49959, "user_id": 866915, "user_type": "registered", "accept_rate": 70, "profile_image": "https://www.gravatar.com/avatar/09242131d6e17cbbe31e8547514da6e5?s=128&d=identicon&r=PG", "display_name": "ErikR", "link": "https://stackoverflow.com/users/866915/erikr"}, "is_accepted": true, "score": 0, "last_activity_date": 1463423501, "creation_date": 1463423501, "answer_id": 37260819, "question_id": 37259445, "link": "https://stackoverflow.com/questions/37259445/sqlite3-update-with-parameter-in-haskell/37260819#37260819", "title": "Sqlite3 Update with parameter in Haskell", "body": "<p>Here is the info on the ErrorMisuse error:</p>\n\n<p><a href=\"https://www.sqlite.org/cvstrac/wiki?p=LibraryRoutineCalledOutOfSequence\" rel=\"nofollow\">https://www.sqlite.org/cvstrac/wiki?p=LibraryRoutineCalledOutOfSequence</a></p>\n\n<p>Perhaps the connection has already been closed? Or are you using the same connection in two different threads?</p>\n\n<p>Here is some sample code which works:</p>\n\n<pre><code>{-# LANGUAGE OverloadedStrings #-}\n\nimport           Control.Applicative\nimport qualified Data.Text as T\nimport           Database.SQLite.Simple\nimport           Database.SQLite.Simple.FromRow\n\ndumpTable conn table = do\n  r &lt;- query_ conn \"SELECT * from test\" :: IO [(Int,String,Int)]\n  mapM_ print r\n\nmain :: IO ()\nmain = do\n  conn &lt;- open \"test.db\"\n  execute_ conn \"CREATE TABLE IF NOT EXISTS test (id INTEGER PRIMARY KEY, firstname TEXT, pets INTEGER)\"\n  execute conn \"INSERT INTO test (firstname, pets) VALUES (?,?)\"\n               (\"Alice\" :: String, 2 :: Int)\n  execute conn \"INSERT INTO test (firstname, pets) VALUES (?,?)\"\n               (\"Bob\" :: String, 3 :: Int) \n  putStrLn \"before:\"\n  dumpTable conn \"test\"\n  execute conn \"UPDATE TEST SET pets = pets + ?\" (Only (4 :: Int))\n  putStrLn \"after:\"\n  dumpTable conn \"test\"\n  close conn\n</code></pre>\n"}], "owner": {"reputation": 13, "user_id": 6341915, "user_type": "registered", "profile_image": "https://graph.facebook.com/897359897039651/picture?type=large", "display_name": "Relu", "link": "https://stackoverflow.com/users/6341915/relu"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 246, "favorite_count": 0, "accepted_answer_id": 37260819, "answer_count": 1, "score": 1, "last_activity_date": 1463423501, "creation_date": 1463418593, "last_edit_date": 1463419246, "question_id": 37259445, "link": "https://stackoverflow.com/questions/37259445/sqlite3-update-with-parameter-in-haskell", "title": "Sqlite3 Update with parameter in Haskell", "body": "<p>Recently I have started working with sqlite3 in haskell and I was wondering how I can modify a variable in a table with a parameter as offset?</p>\n\n<p>I would like to do something like this:</p>\n\n<pre><code>execute_ conn \"CREATE TABLE IF NOT EXISTS test (id INTEGER PRIMARY KEY, v INTEGER)\"\n\nexecute conn \"INSERT INTO test (v) VALUES (?)\" (Only (\"1\" :: String))\n\nexecute conn \"UPDATE test SET v = v + ?\" (Only modifyingValue) &lt;--- this is not working\n</code></pre>\n\n<p>Thank you.</p>\n"}, {"tags": ["haskell", "recursion"], "comments": [{"owner": {"reputation": 49959, "user_id": 866915, "user_type": "registered", "accept_rate": 70, "profile_image": "https://www.gravatar.com/avatar/09242131d6e17cbbe31e8547514da6e5?s=128&d=identicon&r=PG", "display_name": "ErikR", "link": "https://stackoverflow.com/users/866915/erikr"}, "edited": false, "score": 1, "creation_date": 1463417222, "post_id": 37258744, "comment_id": 62044918, "body": "Have a look at how <code>factorial</code> is presented in the Haskell Wikibook: here:<a href=\"https://en.wikibooks.org/wiki/Haskell/Recursion\" rel=\"nofollow noreferrer\">en.wikibooks.org/wiki/Haskell/Recursion</a>"}], "answers": [{"comments": [{"owner": {"reputation": 153, "user_id": 6257689, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/qsD2H.jpg?s=128&g=1", "display_name": "jrs", "link": "https://stackoverflow.com/users/6257689/jrs"}, "edited": false, "score": 0, "creation_date": 1463416909, "post_id": 37258918, "comment_id": 62044762, "body": "Sorry, I didn&#39;t provide enough context. This is part of an algebra workshop and we haven&#39;t seen functions such as take and sum. I need a way to solve it only with recursion. I will edit the question. Thanks for the answer anyway is useful."}], "tags": [], "owner": {"reputation": 49959, "user_id": 866915, "user_type": "registered", "accept_rate": 70, "profile_image": "https://www.gravatar.com/avatar/09242131d6e17cbbe31e8547514da6e5?s=128&d=identicon&r=PG", "display_name": "ErikR", "link": "https://stackoverflow.com/users/866915/erikr"}, "is_accepted": false, "score": 9, "last_activity_date": 1463416722, "creation_date": 1463416722, "answer_id": 37258918, "question_id": 37258744, "link": "https://stackoverflow.com/questions/37258744/summing-the-first-n-odd-numbers-in-haskell/37258918#37258918", "title": "Summing the first n odd numbers in Haskell", "body": "<pre><code>-- the odd numbers (all of them!)\n[ 1,3.. ]\n\n-- the first N odd numbers:\ntake n [1,3..]\n\n-- the sum of the first N odd numbers\nsum (take n [1,3..])\n</code></pre>\n\n<p>Put it in a function:</p>\n\n<pre><code>sumOddNumbers n = sum (take n [1,3..])\n</code></pre>\n"}, {"tags": [], "owner": {"reputation": 44013, "user_id": 1477667, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/trgKM.jpg?s=128&g=1", "display_name": "dfeuer", "link": "https://stackoverflow.com/users/1477667/dfeuer"}, "is_accepted": false, "score": 2, "last_activity_date": 1463419809, "creation_date": 1463419809, "answer_id": 37259765, "question_id": 37258744, "link": "https://stackoverflow.com/questions/37258744/summing-the-first-n-odd-numbers-in-haskell/37259765#37259765", "title": "Summing the first n odd numbers in Haskell", "body": "<p>Since you should always sum the odd numbers by squaring, I think it would be fun to do <em>that</em> by recursion. Since it's silly to do it that way for <code>Int</code> or <code>Integer</code>, you should work at the type level instead. This is actually just as slow as summing them the naive way, but it's more fun!</p>\n\n<pre><code>{-# LANGUAGE DataKinds, KindSignatures, TypeFamilies, TypeOperators, GADTs, UndecidableInstances #-}\n\ndata Nat = Z | S Nat\n\ninfixr 6 :+\ntype family (:+) (x :: Nat) (y :: Nat) :: Nat where\n  'Z :+ n = n\n  'S m :+ n = 'S (m :+ n)\n\ninfixr 7 :*\ntype family (:*) (x :: Nat) (y :: Nat) :: Nat where\n  'Z :* n = 'Z\n  'S m :* n = n :+ m :* n\n</code></pre>\n\n<p>Now to make this usable, you can bring it down to the term level with singletons.</p>\n\n<pre><code>data Natty :: Nat -&gt; * where\n  Zy :: Natty 'Z\n  Sy :: Natty n -&gt; Natty ('S n)\n\nplus :: Natty m -&gt; Natty n -&gt; Natty (m :+ n)\nplus Zy n = n\nplus (Sy m) n = Sy (plus m n)\n\ntimes :: Natty m -&gt; Natty n -&gt; Natty (m :* n)\ntimes Zy _ = Zy\ntimes (Sy m) n = n `plus` (m `times` n)\n\nsquare :: Natty n -&gt; Natty (n :* n)\nsquare n = times n n\n</code></pre>\n"}, {"tags": [], "owner": {"reputation": 34669, "user_id": 34409, "user_type": "registered", "accept_rate": 64, "profile_image": "https://www.gravatar.com/avatar/4dfdadcd9bb62300eb1a54f02fe5dc18?s=128&d=identicon&r=PG", "display_name": "Chad Gilbert", "link": "https://stackoverflow.com/users/34409/chad-gilbert"}, "is_accepted": true, "score": 5, "last_activity_date": 1463419857, "creation_date": 1463419857, "answer_id": 37259782, "question_id": 37258744, "link": "https://stackoverflow.com/questions/37258744/summing-the-first-n-odd-numbers-in-haskell/37259782#37259782", "title": "Summing the first n odd numbers in Haskell", "body": "<p>First off, you'll need to describe your function.</p>\n\n\n\n<pre class=\"lang-haskell prettyprint-override\"><code>sumFirstOdds :: Int -&gt; Int\n</code></pre>\n\n<p>When you think about recursion, you're going to need a stopping point. In this case, a good stopping point is the sum of the first zero odd numbers, which is zero. You can define your base case like this:</p>\n\n<pre class=\"lang-haskell prettyprint-override\"><code>sumFirstOdds 0 = 0\n</code></pre>\n\n<p>It's good to get in the habit of declaring the stopping point first when you're writing a recursive function. Otherwise you can easily end up with infinite loops.</p>\n\n<p>Now we need to define what happens when we want to find the sum of the first <code>n</code> odd numbers when <code>n &gt; 0</code>.</p>\n\n<p>You'll first need to find a way to get the value of the nth odd number: <code>(n * 2) - 1</code>.</p>\n\n<p>Now for the recursive portion. It can help you to think about the problem by walking through a few simple examples. If we wanted to get the sum of the first 3 odd numbers, we would use that formula like this:</p>\n\n<pre class=\"lang-haskell prettyprint-override\"><code>((3 * 2) - 1) + ((2 * 2) - 1) + ((1 * 2) - 1) + 0\n  ^               ^               ^             ^\n  |               |               |             |\nn == 3          n == 2          n == 1        n == 0 (base case)\n</code></pre>\n\n<p>The same algorithm is used starting at the requested number of 3, and adding it to the result of the same algorithm run against 2, then doing the same thing for 1 and again for 0, which is where we hit our base case and stop.</p>\n\n<p>Put into Haskell code, you could write this out as:</p>\n\n<pre class=\"lang-haskell prettyprint-override\"><code>sumFirstOdds n = ((n * 2) - 1) + (sumFirstOdds (n-1))\n</code></pre>\n\n<p>The calculation is performed against the current <code>n</code> value, and that value is added to the result of the same function used against that <code>n-1</code> value.</p>\n\n<p>To reiterate what the final function looks like, it is this:</p>\n\n<pre class=\"lang-haskell prettyprint-override\"><code>sumFirstOdds :: Int -&gt; Int\nsumFirstOdds 0 = 0\nsumFirstOdds n = ((n * 2) - 1) + (sumFirstOdds (n-1))\n</code></pre>\n\n<p><em>Note: this doesn't handle negative input well but I've left that out for the sake of simplicity</em></p>\n"}, {"tags": [], "owner": {"reputation": 62252, "user_id": 1435869, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/TrEd9.jpg?s=128&g=1", "display_name": "karakfa", "link": "https://stackoverflow.com/users/1435869/karakfa"}, "is_accepted": false, "score": 1, "last_activity_date": 1463421309, "creation_date": 1463421309, "answer_id": 37260202, "question_id": 37258744, "link": "https://stackoverflow.com/questions/37258744/summing-the-first-n-odd-numbers-in-haskell/37260202#37260202", "title": "Summing the first n odd numbers in Haskell", "body": "<p>Here it is not needed, but in general you can use an accumulator for recursive computations in a helper function. </p>\n\n<pre><code>sumodds n = go n 0\n   where go 0 a = a\n         go k a = go (k-1) (a + 2*k-1)\n\n&gt; map sumodds [0..9]\n[0,1,4,9,16,25,36,49,64,81]\n</code></pre>\n"}], "owner": {"reputation": 153, "user_id": 6257689, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/qsD2H.jpg?s=128&g=1", "display_name": "jrs", "link": "https://stackoverflow.com/users/6257689/jrs"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 1627, "favorite_count": 0, "accepted_answer_id": 37259782, "answer_count": 4, "score": 1, "last_activity_date": 1463421309, "creation_date": 1463416105, "last_edit_date": 1463416973, "question_id": 37258744, "link": "https://stackoverflow.com/questions/37258744/summing-the-first-n-odd-numbers-in-haskell", "title": "Summing the first n odd numbers in Haskell", "body": "<p>I'm new to Haskell -and functional programming altogether- and I wanted to know how would you write such a function in Haskell. I'm used to imperative languages but handling recursion in haskell is elusive to me right now. Note that I know that the sum of odd numbers could be done with n^2 (i.e. sum of the 3 first odd numbers 1 + 3 + 5 = 9 = 3^2) but the idea is to learn recursion with functional programming. </p>\n\n<p>Also, I'm doing this is as part of an algebra workshop and we haven't seen much yet. I need a way to solve it only with recursion.</p>\n\n<p>Any hints? Thanks!</p>\n"}, {"tags": ["haskell", "aeson"], "comments": [{"owner": {"reputation": 4071, "user_id": 3806046, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/5fedf50ce7cd2659bca902e9a2969158?s=128&d=identicon&r=PG&f=1", "display_name": "jkeuhlen", "link": "https://stackoverflow.com/users/3806046/jkeuhlen"}, "edited": false, "score": 1, "creation_date": 1463413006, "post_id": 37257514, "comment_id": 62042425, "body": "Can you not use a different type for each distinct request object?"}, {"owner": {"reputation": 16362, "user_id": 49220, "user_type": "registered", "accept_rate": 56, "profile_image": "https://www.gravatar.com/avatar/431cd43aaf713caa80316e852a87a840?s=128&d=identicon&r=PG", "display_name": "Paul Johnson", "link": "https://stackoverflow.com/users/49220/paul-johnson"}, "edited": false, "score": 0, "creation_date": 1463431468, "post_id": 37257514, "comment_id": 62052512, "body": "Also see <a href=\"http://stackoverflow.com/questions/32421836/aeson-parsing-dynamic-keys-as-type-field?rq=1\" title=\"aeson parsing dynamic keys as type field\">stackoverflow.com/questions/32421836/&hellip;</a>"}], "answers": [{"tags": [], "owner": {"reputation": 49959, "user_id": 866915, "user_type": "registered", "accept_rate": 70, "profile_image": "https://www.gravatar.com/avatar/09242131d6e17cbbe31e8547514da6e5?s=128&d=identicon&r=PG", "display_name": "ErikR", "link": "https://stackoverflow.com/users/866915/erikr"}, "is_accepted": true, "score": 4, "last_activity_date": 1463416931, "last_edit_date": 1463416931, "creation_date": 1463414601, "answer_id": 37258272, "question_id": 37257514, "link": "https://stackoverflow.com/questions/37257514/aeson-parsing-into-multiple-constructors/37258272#37258272", "title": "Aeson parsing into multiple constructors", "body": "<p>Here's how to manually inspect an Object:</p>\n\n<pre><code>{-# LANGUAGE OverloadedStrings #-}\n\nimport Data.Aeson\nimport Data.Time.Clock\nimport qualified Data.HashMap.Strict as H\nimport Control.Monad\n\ntype Val = Int\n\ndata Request = Req1 { id :: String, properties :: Val }\n             | Req2 { id :: String, properties :: Val }\n             | Req3 { id :: String, time :: UTCTime }\n\ninstance FromJSON Request where\n  parseJSON (Object v) =\n    case H.lookup \"req1\" v of\n      Just (Object h) -&gt; Req1 &lt;$&gt; h .: \"id\" &lt;*&gt; h .: \"properties\"\n      Nothing -&gt; \n        case H.lookup \"req2\" v of\n          Just (Object h) -&gt; Req2 &lt;$&gt; h .: \"id\" &lt;*&gt; h .: \"properies\"\n          Nothing -&gt;\n            case H.lookup \"req3\" v of\n              Just (Object h) -&gt; Req3 &lt;$&gt; h .: \"id\" &lt;*&gt; h .: \"time\"\n              Nothing -&gt; mzero\n</code></pre>\n\n<p>If the key <code>req1</code> exists it will assume it is a Req1 value; else if the key <code>req2</code> exists it will try to parse it as a Req2 value; etc. for <code>req3</code>. If none of those keys exist it will fail.</p>\n\n<p>Instead of <code>mzero</code> you can also use <code>fail \"...\"</code> to display a custom error message.</p>\n"}], "owner": {"reputation": 29647, "user_id": 4999, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/ae995fa03b218e7c27a608b5f14e68ae?s=128&d=identicon&r=PG", "display_name": "\u0141ukasz", "link": "https://stackoverflow.com/users/4999/%c5%81ukasz"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 346, "favorite_count": 1, "accepted_answer_id": 37258272, "answer_count": 1, "score": 3, "last_activity_date": 1463416931, "creation_date": 1463412294, "question_id": 37257514, "link": "https://stackoverflow.com/questions/37257514/aeson-parsing-into-multiple-constructors", "title": "Aeson parsing into multiple constructors", "body": "<p>I'm trying to parse JSON to produce a type with multiple constructors. The challenge is that the type is encoded in the name of a key which contains the required data. In theory I could use a bunch of <code>.:?</code> calls and then check if given key returns <code>Just</code> but I think there must be a better way. I looked at <code>asum</code> but this didn't help me much (probably because of my unfamiliarity with it).</p>\n\n<pre><code>import Data.Aeson\nimport Data.Time.Clock\n\ndata Request = Req1 { id :: String, properties :: Value }\n             | Req2 { id :: String, properties :: Value }\n             | Req3 { id :: String, time :: UTCTime }\n\ninstance FromJSON Request where\n  parseJSON = withObject \"message\" $ \\o -&gt;\n    -- ???\n</code></pre>\n\n<p>Example requests:</p>\n\n<pre><code>{\"req1\": {\"id\": \"345\", \"p1\": \"v1\", \"p2\": \"v2\"}}\n\n{\"req2\": {\"id\": \"654\", \"p3\", \"v3\"}}\n\n{\"req3\": {\"id\": \"876\", \"time\": 1234567890}}\n</code></pre>\n"}, {"tags": ["parsing", "haskell", "indentation", "megaparsec"], "comments": [{"owner": {"reputation": 94713, "user_id": 1139697, "user_type": "registered", "accept_rate": 86, "profile_image": "https://www.gravatar.com/avatar/5f136ddb684f39aaee1c028ee1950f6f?s=128&d=identicon&r=PG", "display_name": "Zeta", "link": "https://stackoverflow.com/users/1139697/zeta"}, "reply_to_user": {"reputation": 9119, "user_id": 180258, "user_type": "registered", "accept_rate": 92, "profile_image": "https://www.gravatar.com/avatar/8b3779ca7c73166d7016272086c6282f?s=128&d=identicon&r=PG", "display_name": "ron", "link": "https://stackoverflow.com/users/180258/ron"}, "edited": false, "score": 3, "creation_date": 1463411130, "post_id": 37256316, "comment_id": 62041219, "body": "@ron: <code>parsec</code> does not backtrack by default, you have to use <code>try</code>, otherwise already consumed characters/tokens are &quot;gone&quot;. You&#39;re thinking of <code>attoparsec</code>."}], "answers": [{"comments": [{"owner": {"reputation": 25144, "user_id": 477476, "user_type": "registered", "accept_rate": 85, "profile_image": "https://i.stack.imgur.com/Qf4TT.png?s=128&g=1", "display_name": "Cactus", "link": "https://stackoverflow.com/users/477476/cactus"}, "edited": false, "score": 0, "creation_date": 1463469670, "post_id": 37260599, "comment_id": 62065185, "body": "In my real parser, <code>item</code> is much more complicated (and can contain further <code>foldLine</code> blocks) . How would I externalize the consumption of whitespace in that case?"}, {"owner": {"reputation": 25144, "user_id": 477476, "user_type": "registered", "accept_rate": 85, "profile_image": "https://i.stack.imgur.com/Qf4TT.png?s=128&g=1", "display_name": "Cactus", "link": "https://stackoverflow.com/users/477476/cactus"}, "edited": false, "score": 0, "creation_date": 1463469715, "post_id": 37260599, "comment_id": 62065208, "body": "To put it in more concrete terms, do you have examples of parsing e.g. Haskell 98 with Megaparsec?"}, {"owner": {"reputation": 7134, "user_id": 3687048, "user_type": "registered", "accept_rate": 96, "profile_image": "https://i.stack.imgur.com/i0GDr.jpg?s=128&g=1", "display_name": "Mark Karpov", "link": "https://stackoverflow.com/users/3687048/mark-karpov"}, "reply_to_user": {"reputation": 25144, "user_id": 477476, "user_type": "registered", "accept_rate": 85, "profile_image": "https://i.stack.imgur.com/Qf4TT.png?s=128&g=1", "display_name": "Cactus", "link": "https://stackoverflow.com/users/477476/cactus"}, "edited": false, "score": 0, "creation_date": 1463470428, "post_id": 37260599, "comment_id": 62065657, "body": "@Cactus, I don&#39;t have examples that parse entire languages like Haskell98. I don&#39;t know if there are examples of that coded with Parsec which has been around for long time. <code>Text.Parsec.Token</code> certainly cannot parse Haskell. Megaparsec 5 is two days old, we have a tutorial about indentation-sensitive parsing on our site, and Haddocks but that&#39;s about it. Without seeing your code it&#39;s hard to advise but if your problem is solvable via use of monadic parser combinators, Megaparsec won&#39;t get in your way. You just need to find how to express it."}, {"owner": {"reputation": 7134, "user_id": 3687048, "user_type": "registered", "accept_rate": 96, "profile_image": "https://i.stack.imgur.com/i0GDr.jpg?s=128&g=1", "display_name": "Mark Karpov", "link": "https://stackoverflow.com/users/3687048/mark-karpov"}, "reply_to_user": {"reputation": 25144, "user_id": 477476, "user_type": "registered", "accept_rate": 85, "profile_image": "https://i.stack.imgur.com/Qf4TT.png?s=128&g=1", "display_name": "Cactus", "link": "https://stackoverflow.com/users/477476/cactus"}, "edited": false, "score": 0, "creation_date": 1463470506, "post_id": 37260599, "comment_id": 62065712, "body": "@Cactus, remember <code>Text.Megaparsec.Lexer</code> is just a collection of useful sortcuts that seem to make sense."}, {"owner": {"reputation": 25144, "user_id": 477476, "user_type": "registered", "accept_rate": 85, "profile_image": "https://i.stack.imgur.com/Qf4TT.png?s=128&g=1", "display_name": "Cactus", "link": "https://stackoverflow.com/users/477476/cactus"}, "edited": false, "score": 0, "creation_date": 1463470552, "post_id": 37260599, "comment_id": 62065735, "body": "Fair enough. I&#39;m marking this answer as accepted, then, and will post a more detailed example with nested <code>lineFold</code>s later."}, {"owner": {"reputation": 25144, "user_id": 477476, "user_type": "registered", "accept_rate": 85, "profile_image": "https://i.stack.imgur.com/Qf4TT.png?s=128&g=1", "display_name": "Cactus", "link": "https://stackoverflow.com/users/477476/cactus"}, "edited": false, "score": 0, "creation_date": 1463483251, "post_id": 37260599, "comment_id": 62074143, "body": "Isn&#39;t <code>items sp</code> equivalent to <code>L.lexeme sp $ L.lineFold $ \\sp&#39; -&gt; item `sepBy1` try sp&#39;</code>?"}, {"owner": {"reputation": 7134, "user_id": 3687048, "user_type": "registered", "accept_rate": 96, "profile_image": "https://i.stack.imgur.com/i0GDr.jpg?s=128&g=1", "display_name": "Mark Karpov", "link": "https://stackoverflow.com/users/3687048/mark-karpov"}, "reply_to_user": {"reputation": 25144, "user_id": 477476, "user_type": "registered", "accept_rate": 85, "profile_image": "https://i.stack.imgur.com/Qf4TT.png?s=128&g=1", "display_name": "Cactus", "link": "https://stackoverflow.com/users/477476/cactus"}, "edited": false, "score": 0, "creation_date": 1463487240, "post_id": 37260599, "comment_id": 62077064, "body": "@Cactus, looks like it is. This is nice, isn&#39;t it?"}], "tags": [], "owner": {"reputation": 7134, "user_id": 3687048, "user_type": "registered", "accept_rate": 96, "profile_image": "https://i.stack.imgur.com/i0GDr.jpg?s=128&g=1", "display_name": "Mark Karpov", "link": "https://stackoverflow.com/users/3687048/mark-karpov"}, "is_accepted": true, "score": 4, "last_activity_date": 1463469931, "last_edit_date": 1463469931, "creation_date": 1463422766, "answer_id": 37260599, "question_id": 37256316, "link": "https://stackoverflow.com/questions/37256316/parsing-many-blocks-with-foldline/37260599#37260599", "title": "Parsing many blocks with foldLine", "body": "<p>Megaparsec's author is here :-) One thing to remember when you work with\nMegaparsec is that it's lexer module is really \u201clow-level\u201d on purpose. It\ndoes not do anything you cannot build yourself, it doesn't lock you into any\nparticular \u201cframework\u201d. So basicly in your case you have space consumer\n<code>sp'</code> provided for you, but you should use it carefully because it will sure\nfail when you have indentation level less or equal to indentation level of\nstart of the whole fold, that's how your fold ends, by the way.</p>\n\n<p>To quote <a href=\"https://hackage.haskell.org/package/megaparsec-5.0.0/docs/Text-Megaparsec-Lexer.html#v:lineFold\" rel=\"nofollow\">the docs</a>:</p>\n\n<blockquote>\n  <p>Create a parser that supports line-folding. The first argument is used to\n  consume white space between components of line fold, thus it must consume\n  newlines in order to work properly. The second argument is a callback that\n  receives custom space-consuming parser as argument. This parser should be\n  used after separate components of line fold that can be put on different\n  lines.</p>\n</blockquote>\n\n\n\n<pre class=\"lang-hs prettyprint-override\"><code>sc = L.space (void spaceChar) empty empty\n\nmyFold = L.lineFold sc $ \\sc' -&gt; do\n  L.symbol sc' \"foo\"\n  L.symbol sc' \"bar\"\n  L.symbol sc  \"baz\" -- for the last symbol we use normal space consumer\n</code></pre>\n\n<p>Line fold cannot run indefinitely so you should expect it to fail with error\nmessage similar to what you have right now. To succeed, you should think\nabout a way for it to finish. This is usually done via using of \u201cnormal\u201d\nspace consumer at the end of line fold:</p>\n\n<pre class=\"lang-hs prettyprint-override\"><code>space :: Parser ()\nspace = L.space (void spaceChar) empty empty\n\nitem :: Parser String\nitem = some letterChar\n\nitems :: Parser () -&gt; Parser [String]\nitems sp = L.lineFold sp $ \\sp' -&gt;\n  item `sepBy1` try sp' &lt;* sp\n\nitems_ :: Parser [String]\nitems_ = items space\n</code></pre>\n\n<p><code>item `sepBy1` try sp'</code> runs till it fails and then <code>sp</code> grabs the rest, so\nnext fold can be parsed.</p>\n\n<pre class=\"lang-hs prettyprint-override\"><code>\u03bb&gt; parseTest items_ \"foo bar\\n baz quux\\n woo\"\n[\"foo\",\"bar\",\"baz\",\"quux\",\"woo\"]\n\u03bb&gt; parseTest (many items_) \"foo bar\\n baz quux\\n woo\\nhoo xyzzy\\n  glulx\"\n[[\"foo\",\"bar\",\"baz\",\"quux\",\"woo\"],[\"hoo\",\"xyzzy\",\"glulx\"]]\n\u03bb&gt; parseTest (many items_) \"foo bar\\n baz quux\\n woo\\nhoo\\nxyzzy\\n  glulx\"\n[[\"foo\",\"bar\",\"baz\",\"quux\",\"woo\"],[\"hoo\"],[\"xyzzy\",\"glulx\"]]\n</code></pre>\n"}], "owner": {"reputation": 25144, "user_id": 477476, "user_type": "registered", "accept_rate": 85, "profile_image": "https://i.stack.imgur.com/Qf4TT.png?s=128&g=1", "display_name": "Cactus", "link": "https://stackoverflow.com/users/477476/cactus"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 389, "favorite_count": 0, "accepted_answer_id": 37260599, "answer_count": 1, "score": 3, "last_activity_date": 1463469931, "creation_date": 1463408835, "question_id": 37256316, "link": "https://stackoverflow.com/questions/37256316/parsing-many-blocks-with-foldline", "title": "Parsing many blocks with foldLine", "body": "<p>For this simplified problem, I am trying to parse an input that looks like</p>\n\n<pre><code>foo bar\n baz quux \n woo\nhoo xyzzy \n  glulx\n</code></pre>\n\n<p>into </p>\n\n<pre><code>[[\"foo\", \"bar\", \"baz\", \"quux\", \"woo\"], [\"hoo\", \"xyzzy\", \"glulx\"]]\n</code></pre>\n\n<p>The code I've tried is as follows:</p>\n\n<pre><code>import qualified Text.Megaparsec.Lexer as L\nimport Text.Megaparsec hiding (space)\nimport Text.Megaparsec.Char hiding (space)\nimport Text.Megaparsec.String\nimport Control.Monad (void)\nimport Control.Applicative\n\nspace :: Parser ()\nspace = L.space (void spaceChar) empty empty\n\nitem :: Parser () -&gt; Parser String\nitem sp = L.lexeme sp $ some letterChar\n\nitems :: Parser () -&gt; Parser [String]\nitems sp = L.lineFold sp $ \\sp' -&gt; some (item sp')\n\nitems_ :: Parser [String]\nitems_ = items space\n</code></pre>\n\n<p>This works for one block of <code>items</code>:</p>\n\n<pre><code>\u03bb\u00bb parseTest items_ \"foo bar\\n baz quux\\n woo\"\n[\"foo\",\"bar\",\"baz\",\"quux\",\"woo\"]\n</code></pre>\n\n<p>But as soon as I try to parse <code>many items</code>, it fails on the first unindented line:</p>\n\n<pre><code>\u03bb\u00bb parseTest (many items_) \"foo bar\\n baz quux\\n woo\\nhoo xyzzy\\n  glulx\"\n4:1:\nincorrect indentation (got 1, should be greater than 1)\n</code></pre>\n\n<p>or, with an even simpler input:</p>\n\n<pre><code>\u03bb\u00bb parseTest (many items_) \"a\\nb\"\n2:1:\nincorrect indentation (got 1, should be greater than 1)\n</code></pre>\n"}, {"tags": ["haskell", "monads"], "comments": [{"owner": {"reputation": 49959, "user_id": 866915, "user_type": "registered", "accept_rate": 70, "profile_image": "https://www.gravatar.com/avatar/09242131d6e17cbbe31e8547514da6e5?s=128&d=identicon&r=PG", "display_name": "ErikR", "link": "https://stackoverflow.com/users/866915/erikr"}, "edited": false, "score": 2, "creation_date": 1463406343, "post_id": 37255281, "comment_id": 62038101, "body": "In the second fragment, Instead of <code>(_env -&gt; env)</code> do you mean <code>(\\env -&gt; env)</code> ?"}, {"owner": {"reputation": 94713, "user_id": 1139697, "user_type": "registered", "accept_rate": 86, "profile_image": "https://www.gravatar.com/avatar/5f136ddb684f39aaee1c028ee1950f6f?s=128&d=identicon&r=PG", "display_name": "Zeta", "link": "https://stackoverflow.com/users/1139697/zeta"}, "edited": false, "score": 2, "creation_date": 1463406849, "post_id": 37255281, "comment_id": 62038412, "body": "What exactly is your question?"}, {"owner": {"reputation": 9119, "user_id": 180258, "user_type": "registered", "accept_rate": 92, "profile_image": "https://www.gravatar.com/avatar/8b3779ca7c73166d7016272086c6282f?s=128&d=identicon&r=PG", "display_name": "ron", "link": "https://stackoverflow.com/users/180258/ron"}, "edited": false, "score": 0, "creation_date": 1463407227, "post_id": 37255281, "comment_id": 62038660, "body": "The second snippet is very strange. Please rework it to be more meaningful or add comments. The first snippet equals just <code>sth</code>, since you don&#39;t change the environment with <code>local</code> (just return the already set env)."}, {"owner": {"reputation": 3815, "user_id": 5382150, "user_type": "registered", "accept_rate": 86, "profile_image": "https://i.stack.imgur.com/GwGSL.png?s=128&g=1", "display_name": "Gilgamesz", "link": "https://stackoverflow.com/users/5382150/gilgamesz"}, "reply_to_user": {"reputation": 49959, "user_id": 866915, "user_type": "registered", "accept_rate": 70, "profile_image": "https://www.gravatar.com/avatar/09242131d6e17cbbe31e8547514da6e5?s=128&d=identicon&r=PG", "display_name": "ErikR", "link": "https://stackoverflow.com/users/866915/erikr"}, "edited": false, "score": 0, "creation_date": 1463409534, "post_id": 37255281, "comment_id": 62040140, "body": "@ErikR, yes indeed"}, {"owner": {"reputation": 49959, "user_id": 866915, "user_type": "registered", "accept_rate": 70, "profile_image": "https://www.gravatar.com/avatar/09242131d6e17cbbe31e8547514da6e5?s=128&d=identicon&r=PG", "display_name": "ErikR", "link": "https://stackoverflow.com/users/866915/erikr"}, "edited": false, "score": 3, "creation_date": 1463410491, "post_id": 37255281, "comment_id": 62040795, "body": "Both are the same as the computation <code>sth</code>."}], "answers": [{"tags": [], "owner": {"reputation": 499, "user_id": 4629794, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/fb19f570a2d96e68ec79f0af208d23a8?s=128&d=identicon&r=PG", "display_name": "lierdakil", "link": "https://stackoverflow.com/users/4629794/lierdakil"}, "is_accepted": true, "score": 5, "last_activity_date": 1463501644, "creation_date": 1463501644, "answer_id": 37281457, "question_id": 37255281, "link": "https://stackoverflow.com/questions/37255281/function-local-haskell-reader-monad/37281457#37281457", "title": "Function local haskell Reader monad", "body": "<p>Not really sure what your question is about, but let's try.</p>\n\n<p>So you're asking if</p>\n\n<pre><code>ask &gt;&gt;= \\env -&gt; local (const env) sth\n</code></pre>\n\n<p>and</p>\n\n<pre><code>local id sth\n</code></pre>\n\n<p>are equivalent.</p>\n\n<p>In terms of effect -- sure they are. What's more they're both equivalent to just <code>sth</code>. Let us consider an example that's a little bit more complicated:</p>\n\n<pre><code>ask &gt;&gt;= \\env -&gt; local (const (f env)) sth\n</code></pre>\n\n<p>vs</p>\n\n<pre><code>local f sth\n</code></pre>\n\n<p>Let us now try to understand how it works.</p>\n\n<p><code>local</code> is defined as</p>\n\n<pre><code>local :: (r -&gt; r) -&gt; Reader r a -&gt; Reader r a\nlocal f m = Reader $ runReader m . f\n</code></pre>\n\n<p>(I'm simplifying a bit, since it's actually defined for <code>ReaderT</code> via <code>withReaderT</code>, but it gets the idea across)</p>\n\n<p>As a reminder, we can assume</p>\n\n<pre><code>runReader :: Reader r a -&gt; r -&gt; a\n</code></pre>\n\n<p>Also, as a reminder <code>Reader r a</code> is a newtype that wraps <code>r -&gt; a</code>.</p>\n\n<p>Now, what does <code>&gt;&gt;=</code> do here? Simple,</p>\n\n<pre><code>m &gt;&gt;= k  = Reader $ \\r -&gt; runReader (k (runReader m r)) r\n</code></pre>\n\n<p>So, it takes <code>m</code>, extracts value from it, and passes it to <code>k</code>, while keeping actual environment <code>r</code> as a free parameter. As a well-behaved monadic bind should, so no surprise here.</p>\n\n<p>Also bears noting, that <code>ask</code> is just <code>Reader id</code></p>\n\n<p>Now then, let's drop whole <code>Reader</code> thing altogether and just rewrite our expressions as functions.</p>\n\n<pre><code>ask &gt;&gt;= \\env -&gt; local (const (f env)) sth\n</code></pre>\n\n<p>then becomes</p>\n\n<pre><code>\\r -&gt; (\\r' -&gt; runReader sth (const (f r) r')) r\n</code></pre>\n\n<p>and</p>\n\n<pre><code>local f sth\n</code></pre>\n\n<p>becomes</p>\n\n<pre><code>\\r -&gt; runReader sth (f r)\n</code></pre>\n\n<p>Now if you squint a bit, you could see that these two are equivalent in terms of effect. Indeed,</p>\n\n<pre><code>const (f r) r' = f r\n(\\r' -&gt; runReader sth (f r)) r = (\\_ -&gt; runReader sth (f r)) r\n                               = runReader sth (f r)\n</code></pre>\n\n<p>So </p>\n\n<pre><code>\\r -&gt; (\\r' -&gt; runReader sth (const (f r) r')) r\n</code></pre>\n\n<p>turns into</p>\n\n<pre><code>\\r -&gt; runReader sth (f r)\n</code></pre>\n\n<p>Which is exactly the same as <code>local f sth</code>.</p>\n\n<p>Now the question is, is your compiler smart enough to do this transformation on its own? If I had to guess, I would guess GHC <em>is</em> indeed smart enough, since it's all basic algebraic equality. But luckily, I don't <em>have</em> to guess, because I can check.</p>\n\n<p>Using these two sources, <code>test1.hs</code>:</p>\n\n<pre><code>import Control.Monad.Reader\n\nmain :: IO ()\nmain = print $ runReader m \"hello\"\n\nf = (++\"!!!\")\n\nm = ask &gt;&gt;= \\r -&gt; local (const (f r)) ask\n</code></pre>\n\n<p>and <code>test2.hs</code>:</p>\n\n<pre><code>import Control.Monad.Reader\n\nmain :: IO ()\nmain = print $ runReader m \"hello\"\n\nf = (++\"!!!\")\n\nm = local f ask\n</code></pre>\n\n<p>I ran <code>ghc -O2 -ddump-simpl</code> on both of them (using GHC 7.10.3). Guess what, core files differ only in randomized names.</p>\n\n<p>Granted, without <code>-O2</code> output differs quite a bit. But that is expected.</p>\n"}], "owner": {"reputation": 3815, "user_id": 5382150, "user_type": "registered", "accept_rate": 86, "profile_image": "https://i.stack.imgur.com/GwGSL.png?s=128&g=1", "display_name": "Gilgamesz", "link": "https://stackoverflow.com/users/5382150/gilgamesz"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 1022, "favorite_count": 0, "accepted_answer_id": 37281457, "answer_count": 1, "score": 0, "last_activity_date": 1463501644, "creation_date": 1463405834, "last_edit_date": 1463410454, "question_id": 37255281, "link": "https://stackoverflow.com/questions/37255281/function-local-haskell-reader-monad", "title": "Function local haskell Reader monad", "body": "<p>I consider if two below expressions are equivalent:</p>\n\n<pre><code>env &lt;- ask\nlocal (\\_ -&gt; env) sth\n</code></pre>\n\n<p>and:</p>\n\n<pre><code>local (\\env -&gt; env) sth\n</code></pre>\n\n<p>If not, where it is taken to the argument lambda? </p>\n"}, {"tags": ["haskell", "haskell-stack", "ghcjs"], "answers": [{"comments": [{"owner": {"reputation": 6238, "user_id": 737051, "user_type": "registered", "accept_rate": 56, "profile_image": "https://www.gravatar.com/avatar/4cbfcdd51d0ec56844b3540f62d06af3?s=128&d=identicon&r=PG", "display_name": "john mangual", "link": "https://stackoverflow.com/users/737051/john-mangual"}, "edited": false, "score": 1, "creation_date": 1463411416, "post_id": 37255079, "comment_id": 62041403, "body": "I can&#39;t put a check-mark cuz it&#39;s still installing :-)"}, {"owner": {"reputation": 49959, "user_id": 866915, "user_type": "registered", "accept_rate": 70, "profile_image": "https://www.gravatar.com/avatar/09242131d6e17cbbe31e8547514da6e5?s=128&d=identicon&r=PG", "display_name": "ErikR", "link": "https://stackoverflow.com/users/866915/erikr"}, "reply_to_user": {"reputation": 6238, "user_id": 737051, "user_type": "registered", "accept_rate": 56, "profile_image": "https://www.gravatar.com/avatar/4cbfcdd51d0ec56844b3540f62d06af3?s=128&d=identicon&r=PG", "display_name": "john mangual", "link": "https://stackoverflow.com/users/737051/john-mangual"}, "edited": false, "score": 0, "creation_date": 1463411991, "post_id": 37255079, "comment_id": 62041729, "body": "My <code>stack setup</code> just finished so hang in there!"}, {"owner": {"reputation": 857, "user_id": 11684473, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/f75d9637ee85de92c304840bea0b9b4a?s=128&d=identicon&r=PG&f=1", "display_name": "majkrzak", "link": "https://stackoverflow.com/users/11684473/majkrzak"}, "edited": false, "score": 1, "creation_date": 1608807753, "post_id": 37255079, "comment_id": 115690248, "body": "Docs returns 404 currently"}], "tags": [], "owner": {"reputation": 49959, "user_id": 866915, "user_type": "registered", "accept_rate": 70, "profile_image": "https://www.gravatar.com/avatar/09242131d6e17cbbe31e8547514da6e5?s=128&d=identicon&r=PG", "display_name": "ErikR", "link": "https://stackoverflow.com/users/866915/erikr"}, "is_accepted": true, "score": 10, "last_activity_date": 1463405257, "creation_date": 1463405257, "answer_id": 37255079, "question_id": 37254692, "link": "https://stackoverflow.com/questions/37254692/install-ghcjs-from-stack/37255079#37255079", "title": "install ghcjs from stack", "body": "<p>Have a look at this page: <a href=\"http://docs.haskellstack.org/en/stable/ghcjs/\">http://docs.haskellstack.org/en/stable/ghcjs/</a></p>\n\n<p>I would try:</p>\n\n<ol>\n<li><p>Start a new stack project, e.g. <code>stack new js-test</code></p></li>\n<li><p>Modify the stack.yaml file by adding this stanza (taken from the above mentioned link):</p>\n\n<pre><code>compiler: ghcjs-0.2.0.20160414_ghc-7.10.3\ncompiler-check: match-exact\nsetup-info:\n  ghcjs:\n    source:\n      ghcjs-0.2.0.20160414_ghc-7.10.3:\n        url: https://s3.amazonaws.com/ghcjs/ghcjs-0.2.0.20160414_ghc-7.10.3.tar.gz\n        sha1: 6d6f307503be9e94e0c96ef1308c7cf224d06be3\n</code></pre></li>\n<li><p>Change the <code>resolver:</code> to lts-5.12 - this matches the above stanza.</p></li>\n<li><p>Run <code>stack setup</code> to get the compiler installed.</p></li>\n</ol>\n\n<p>Step 4 will take a while.</p>\n"}], "owner": {"reputation": 6238, "user_id": 737051, "user_type": "registered", "accept_rate": 56, "profile_image": "https://www.gravatar.com/avatar/4cbfcdd51d0ec56844b3540f62d06af3?s=128&d=identicon&r=PG", "display_name": "john mangual", "link": "https://stackoverflow.com/users/737051/john-mangual"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 1296, "favorite_count": 0, "accepted_answer_id": 37255079, "answer_count": 1, "score": 6, "last_activity_date": 1463405257, "creation_date": 1463404074, "question_id": 37254692, "link": "https://stackoverflow.com/questions/37254692/install-ghcjs-from-stack", "title": "install ghcjs from stack", "body": "<p>I have GHC installed through stack ( so that <code>stack ghc -- --version</code> shows GHC-7.10.3 ) </p>\n\n<pre><code>$ stack install ghcjs\n\nRun from outside a project, using implicit global project config\nUsing resolver: lts-5.2 from implicit global project's config file: /home/john/.stack/global-project/stack.yaml\nThe following target packages were not found: ghcjs\n</code></pre>\n\n<p>Some resources suggest <strong><code>ghcjs</code></strong> is somewhat experimental (though in the further stages).  </p>\n\n<hr>\n\n<p>Looking at <a href=\"http://docs.haskellstack.org/en/stable/ghcjs/\" rel=\"noreferrer\">http://docs.haskellstack.org/en/stable/ghcjs/</a> I thought maybe I could find <code>stack.yaml</code> and change it.</p>\n\n<blockquote>\n  <p>To use GHCJS with stack >= 0.1.8, place a GHCJS version in the compiler field of stack.yaml ... then <code>stack setup</code></p>\n</blockquote>\n\n<pre><code>$ cat ~/.stack/global-project/stack.yaml\n# This is the implicit global project's config file, which is only used when\n# 'stack' is run outside of a real project.  Settings here do _not_ act as\n# defaults for all projects.  To change stack's default settings, edit\n# '/home/john/.stack/config.yaml' instead.\n#\n# For more information about stack's configuration, see\n# http://docs.haskellstack.org/en/stable/yaml_configuration.html\n#\nflags: {}\nextra-package-dbs: []\npackages: []\nextra-deps: []\nresolver: lts-5.2\n</code></pre>\n\n<p>We are told to look at <code>config.yaml</code> which looks equally blank.  Is this even right, am I going up a dead end?  </p>\n\n<pre><code>$ cat ~/.stack/config.yaml\n# This file contains default non-project-specific settings for 'stack', used\n# in all projects.  For more information about stack's configuration, see\n# http://docs.haskellstack.org/en/stable/yaml_configuration.html\n#\n{}\n</code></pre>\n\n<p>I just want to install <strong><code>ghcjs</code></strong> with stack.</p>\n"}, {"tags": ["haskell", "types", "tree", "pattern-matching"], "comments": [{"owner": {"reputation": 2231, "user_id": 1027321, "user_type": "registered", "accept_rate": 70, "profile_image": "https://i.stack.imgur.com/KkFZC.jpg?s=128&g=1", "display_name": "jakubdaniel", "link": "https://stackoverflow.com/users/1027321/jakubdaniel"}, "edited": false, "score": 1, "creation_date": 1463403328, "post_id": 37254189, "comment_id": 62036193, "body": "sounds a bit like a homework assignment, what have you tried? what worked, what did not? Try approaching your problem from manually converting small trees (1 leaf, 1 node and two leaves ...) to string. See if you can&#39;t use that to recursively define a function that does this for all the trees."}], "answers": [{"tags": [], "owner": {"reputation": 2231, "user_id": 1027321, "user_type": "registered", "accept_rate": 70, "profile_image": "https://i.stack.imgur.com/KkFZC.jpg?s=128&g=1", "display_name": "jakubdaniel", "link": "https://stackoverflow.com/users/1027321/jakubdaniel"}, "is_accepted": true, "score": 1, "last_activity_date": 1463404985, "last_edit_date": 1463404985, "creation_date": 1463403869, "answer_id": 37254620, "question_id": 37254189, "link": "https://stackoverflow.com/questions/37254189/haskell-data-tree-functions-string-output/37254620#37254620", "title": "haskell, data tree functions, string output?", "body": "<pre><code>treeToStr :: (Show a, Show b) =&gt; Tree a b -&gt; String\ntreeToStr (Leaf a) = show a\ntreeToStr (Node a n b) = \"(\" ++ treeToStr a ++ show n ++ treeToStr b ++ \")\"\n</code></pre>\n\n<p>You only need to provide conversion of the operators to output the symbols rather than the implicit implementation of <code>Show</code>. For that you would either want to manually instantiate <code>Show</code> for <code>Op</code> or introduce a new class, or specialize your <code>treeToStr</code>.</p>\n\n<pre><code>data Op = Add | Sub | Mult | Div\n  deriving Eq\n\n-- Be careful about giving non-standard implementations of classes like show, in Haskell there are always laws and rules to follow: Show should output what Read would accept for example.\ninstance Show Op where\n   show Add = ...\n   ...\n</code></pre>\n\n<p>or</p>\n\n<pre><code>data Op = ... deriving Eq\ndata Tree = ... deriving Eq\n\nclass Stringifiable c where\n   toStr :: c -&gt; String\n\ninstance Stringifiable Op where\n   toStr Add = ...\n\ninstance (Show a, Stringifiable b) =&gt; Stringifiable (Tree a b) where\n  toStr (Leaf a) = show a\n  toStr (Node a n b) = \"(\" ++ toStr a ++ toStr n ++ toStr b ++ \")\"\n\n-- You can then stringify your tree:\ntoStr tree\n</code></pre>\n\n<p>or simply</p>\n\n<pre><code>opTreeToStr :: Show a =&gt; Tree a Op -&gt; String\nopTreeToStr (Leaf a) = show a\nopTreeToStr (Node a n b) = \"(\" ++ toStr a ++ opToStr n ++ toStr b ++ \")\"\n\nopToStr :: Op -&gt; String\nopToStr Add = \"+\"\n...\n\n-- Stringify tree, assuming it has the correct type Tree a Op:\nopTreeToStr tree\n</code></pre>\n"}], "owner": {"reputation": 237, "user_id": 5539565, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/e3caea1216cdc02bbed42516c88cde26?s=128&d=identicon&r=PG&f=1", "display_name": "FastBatteryCharger", "link": "https://stackoverflow.com/users/5539565/fastbatterycharger"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 577, "favorite_count": 0, "accepted_answer_id": 37254620, "answer_count": 1, "score": 0, "last_activity_date": 1463404985, "creation_date": 1463402554, "last_edit_date": 1463403810, "question_id": 37254189, "link": "https://stackoverflow.com/questions/37254189/haskell-data-tree-functions-string-output", "title": "haskell, data tree functions, string output?", "body": "<p>i made a data type tree and a data type Op and now i would like to make a function that will generate a string with an operation:</p>\n\n<p>First of all my code:</p>\n\n<pre><code>data Op = Add | Sub | Mult | Div\n  deriving(Eq,Show)\ndata Tree a b = Leaf a | Node (Tree a b) b (Tree a b)\n  deriving(Eq,Show)\n</code></pre>\n\n<p>My Tree</p>\n\n<pre><code>tree = Node (Node (Node (Leaf 20) Add (Leaf 20)) Sub (Leaf 2)) Mult (Node (Leaf 33) Div (Leaf 3))\n\n--                 Node _   Mult   _\n--                     /            \\\n--                    /              \\\n--                   /                \\\n--                  /                  \\\n--                 /                    \\\n--                /                      \\\n--             Node _ Sub _              Node _ Div _ \n--                 /     \\                     /     \\\n--                /       \\                   /       \\\n--               /      Leaf 2            Leaf 33    Leaf 3\n--              /           \n--             /             \n--          Node _ Add _                 \n--              /       \\\n--             /         \\\n--            /           \\\n--         Leaf 20      Leaf 30\n</code></pre>\n\n<p>At the end the output should look like this string <code>\"(((20+30)-2)*(33 <code>div</code> 3))\"</code>.</p>\n"}, {"tags": ["haskell"], "comments": [{"owner": {"reputation": 314794, "user_id": 67579, "user_type": "registered", "accept_rate": 81, "profile_image": "https://i.stack.imgur.com/BJXub.png?s=128&g=1", "display_name": "Willem Van Onsem", "link": "https://stackoverflow.com/users/67579/willem-van-onsem"}, "edited": false, "score": 0, "creation_date": 1463404218, "post_id": 37253878, "comment_id": 62036717, "body": "I&#39;ve edited your question in the hope the question is now syntactically valid. But I still don&#39;t see what a rose tree has to do with this."}], "answers": [{"comments": [{"owner": {"reputation": 183, "user_id": 6133691, "user_type": "registered", "accept_rate": 43, "profile_image": "https://www.gravatar.com/avatar/9d12022bcc552642e8dc3a545df1c42e?s=128&d=identicon&r=PG&f=1", "display_name": "R. Rengold", "link": "https://stackoverflow.com/users/6133691/r-rengold"}, "edited": false, "score": 0, "creation_date": 1463405229, "post_id": 37254765, "comment_id": 62037358, "body": "Willem Van Onsem - apologies for the failed syntax. @ErikR - In hindsight, I think I was trying to do something which you could not. Thank you for your help."}], "tags": [], "owner": {"reputation": 49959, "user_id": 866915, "user_type": "registered", "accept_rate": 70, "profile_image": "https://www.gravatar.com/avatar/09242131d6e17cbbe31e8547514da6e5?s=128&d=identicon&r=PG", "display_name": "ErikR", "link": "https://stackoverflow.com/users/866915/erikr"}, "is_accepted": true, "score": 1, "last_activity_date": 1463404266, "creation_date": 1463404266, "answer_id": 37254765, "question_id": 37253878, "link": "https://stackoverflow.com/questions/37253878/haskell-boolean-rosetree/37254765#37254765", "title": "Haskell - Boolean RoseTree", "body": "<p>Don't know how a Rose tree would work here, but what about this\ndata structure:</p>\n\n<pre><code>checks =\n    [ ((0,0), [ (1, 10, 1) , (2, 11, 2) , (3, 12, 3) , (4, 13, 4) , (5, 14, 5) ])\n    , ((1,..), [ ... ]\n    , ((2,..), [ ... ]\n    , ...\n    , ((5,..), [ ... ]\n    ]\n</code></pre>\n\n<p>Here's how to deconstruct it:</p>\n\n<pre><code>[ ( (0,0) [ (1, 10, 1) , (2, 11, 2) , (3, 12, 3) , (4, 13, 4) , (5, 14, 5) ]\n     i z     x   y  j     x   y  j     x   y  j     ...\n</code></pre>\n\n<p>Each set of values for <strong>i</strong>, <strong>z</strong>, <strong>x</strong>, <strong>y</strong>, and <strong>j</strong> corresponds to\nthe guard:</p>\n\n<pre><code>| ((a !! i) == x || (a !! i) == y) &amp;&amp; (b !! j /= z) = True\n</code></pre>\n\n<p>To perform all of the checks, just use a list comprehension:</p>\n\n<pre><code>func :: [Int] -&gt; [Int] -&gt; Bool\nfunc a b = or $ do ((i,z), triples) &lt;- checks\n                   (x,y,j) &lt;- triples\n                   return $ ((a !! i) == x || (a !! i) == y) &amp;&amp; (b !! j /= z)\n</code></pre>\n\n<p>All of the elements of the list are or-ed together. Due to laziness the function will return with True as soon as the first True check is encountered.</p>\n"}], "owner": {"reputation": 183, "user_id": 6133691, "user_type": "registered", "accept_rate": 43, "profile_image": "https://www.gravatar.com/avatar/9d12022bcc552642e8dc3a545df1c42e?s=128&d=identicon&r=PG&f=1", "display_name": "R. Rengold", "link": "https://stackoverflow.com/users/6133691/r-rengold"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 96, "favorite_count": 0, "accepted_answer_id": 37254765, "answer_count": 1, "score": 0, "last_activity_date": 1463404266, "creation_date": 1463401477, "last_edit_date": 1463404155, "question_id": 37253878, "link": "https://stackoverflow.com/questions/37253878/haskell-boolean-rosetree", "title": "Haskell - Boolean RoseTree", "body": "<p>Hello Haskell community,</p>\n\n<p>Given the usual definition of a Rose Tree:</p>\n\n<pre><code>RoseTree a = Node a [RoseTree a]\n</code></pre>\n\n<p>I've been scratching my head over the implementation of this particular function:</p>\n\n<pre><code>boolRoseTree :: Blocks -&gt; Blocks -&gt; RoseTree a -&gt; Bool\nboolRoseTree blocksA blocksB roseTree\n</code></pre>\n\n<p>Where <code>Blocks</code> is simply a <code>[Int]</code> that is always contains 6 elements which are greater or equal to 0.\nNow the function I wish to implement checks if a certain element of <code>blocksA</code> is a certain value and a certain element of <code>blocksB</code> is also a certain value, and return <code>True</code> if the conditions are met. That is very vague, so allow me to clarify with an example:</p>\n\n<p><code>| (blocksA !! 0 == 1 || blocksA !! 0 == 10) &amp;&amp; blocksB !! 1 /= 0 = True</code></p>\n\n<p>i.e. if the 1st element of <code>blocksA</code> is either <code>1</code> or <code>10</code> and the 2nd element of <code>blocksB</code> is not <code>0</code>, then return <code>True</code>. This I wish to do for all elements of <code>blocksA</code>, however each time, the elements increase by <code>+1</code>. Through that I mean the next guards would be:</p>\n\n<pre><code>| (blocksA !! 1 == 2 || blocksA !! 1 == 11) &amp;&amp; blocksB !! 2 /= 0 = True\n| (blocksA !! 2 == 3 || blocksA !! 2 == 12) &amp;&amp; blocksB !! 3 /= 0 = True\n| (blocksA !! 3 == 4 || blocksA !! 3 == 13) &amp;&amp; blocksB !! 4 /= 0 = True\n| (blocksA !! 4 == 5 || blocksA !! 4 == 14) &amp;&amp; blocksB !! 5 /= 0 = True\n</code></pre>\n\n<p>Obviously, I could code this with a long list of guards, going through all <code>blocksA !! 0</code>,<code>blocksA !! 1</code>,<code>blocksA !! 2</code>,<code>blocksA !! 3</code>,<code>blocksA !! 4</code>,<code>blocksA !! 5</code> eventually reaching an <code>otherwise</code> statement which returns <code>False</code>. However, this could be done significantly more effectively (I think) with a Rose Tree.</p>\n\n<p>I imagine that on the first level of the Rose Tree there would have to be six nodes, 0 to 5, representing the elements of the tree. Each of those nodes would then have to have 2 values, which are the two values I want for <code>blocksA</code> at that particular element of the list - but then I would also somehow have to check if the corresponding element of <code>blocksB</code> is not zero.</p>\n\n<p>I don't really know even where to start on a problem like this... Any help would be greatly appreciated.</p>\n"}, {"tags": ["haskell", "monads"], "answers": [{"tags": [], "owner": {"reputation": 94713, "user_id": 1139697, "user_type": "registered", "accept_rate": 86, "profile_image": "https://www.gravatar.com/avatar/5f136ddb684f39aaee1c028ee1950f6f?s=128&d=identicon&r=PG", "display_name": "Zeta", "link": "https://stackoverflow.com/users/1139697/zeta"}, "is_accepted": false, "score": 2, "last_activity_date": 1463401774, "creation_date": 1463401774, "answer_id": 37253977, "question_id": 37253676, "link": "https://stackoverflow.com/questions/37253676/returning-random-generator-from-runst/37253977#37253977", "title": "Returning random generator from runST", "body": "<p><code>VU.unsafeFreeze vector</code> returns a vector in some monad (in this case <code>ST s</code>). Remember that every action has to be in the same monad in a <code>do</code> expression. Since <code>(VU.unsafeFreeze vector, g')</code> isn't of type <code>ST s &lt;something&gt;</code>, it does not work with <code>runST</code>.</p>\n\n<p>Instead, bind the frozen vector and use <code>return</code> to return a single pair with type <code>ST s (VU.Vector Int, g)</code>:</p>\n\n<pre><code>  g' &lt;- ...\n  v' &lt;- VU.unsafeFreeze vector\n  return (v', g')\n</code></pre>\n"}, {"tags": [], "owner": {"reputation": 37219, "user_id": 1523776, "user_type": "moderator", "accept_rate": 87, "profile_image": "https://www.gravatar.com/avatar/b3e0b5c8e42a8c38009ef2d969f8dabb?s=128&d=identicon&r=PG", "display_name": "Benjamin Hodgson", "link": "https://stackoverflow.com/users/1523776/benjamin-hodgson"}, "is_accepted": true, "score": 2, "last_activity_date": 1463401824, "creation_date": 1463401824, "answer_id": 37253991, "question_id": 37253676, "link": "https://stackoverflow.com/questions/37253676/returning-random-generator-from-runst/37253991#37253991", "title": "Returning random generator from runST", "body": "<p>Look at the type of <a href=\"https://hackage.haskell.org/package/vector-0.11.0.0/docs/Data-Vector-Unboxed.html#v:unsafeFreeze\" rel=\"nofollow\"><code>unsafeFreeze</code></a>.</p>\n\n<pre><code>unsafeFreeze :: (Unbox a, PrimMonad m) =&gt; MVector (PrimState m) a -&gt; m (Vector a)\n</code></pre>\n\n<p>It's a monadic computation which returns <code>m (Vector a)</code>. So the expression <code>(VU.unsafeFreeze vector, g')</code> has a type of <code>(m (Vector Int), g)</code>. The type checker is telling you that it can't unify this type with the type of the <code>do</code> block, which you declared to be <code>ST s (Vector Int, g)</code>.</p>\n\n<p>In order to make these types unify, we need to distribute the <code>m</code> from inside the tuple to outside; then the type checker will infer <code>m ~ ST s</code>. You need to extract the <code>Vector</code> from its monadic computation, and then pack it back up with the generator.</p>\n\n<pre><code>do\n    ...\n    v &lt;- VU.unsafeFreeze vector\n    return (v, g')\n</code></pre>\n"}], "owner": {"reputation": 2185, "user_id": 4129091, "user_type": "registered", "accept_rate": 80, "profile_image": "https://www.gravatar.com/avatar/0f8076e78a95ed50b9ffbed42849d80e?s=128&d=identicon&r=PG&f=1", "display_name": "tsorn", "link": "https://stackoverflow.com/users/4129091/tsorn"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 43, "favorite_count": 0, "accepted_answer_id": 37253991, "answer_count": 2, "score": 2, "last_activity_date": 1463401824, "creation_date": 1463400819, "question_id": 37253676, "link": "https://stackoverflow.com/questions/37253676/returning-random-generator-from-runst", "title": "Returning random generator from runST", "body": "<p>I'm trying to use a random generator inside a <code>runST</code> statement and return the generator after use so it can be used elsewhere. </p>\n\n<p>If I return only a vector, the code compiles, but when adding the generator to the return statement the compilation fails. If I understand the error message correctly, it says that the function passed to the monadic fold does not modify the vector within the same state, but I can't figure out why it then compiles if I omit the random generator from the return statement.</p>\n\n<p>This compiles:</p>\n\n<pre><code>import           Control.Monad\nimport           Control.Monad.ST\nimport qualified Data.Vector.Unboxed         as VU\nimport qualified Data.Vector.Unboxed.Mutable as VUM\nimport           System.Random\n\nrandVector :: (RandomGen g) =&gt; Int -&gt; g -&gt; VU.Vector Int\nrandVector n g = runST $ do\n  vector &lt;- VU.unsafeThaw (VU.enumFromN 1 n)\n  let step g i = do let (j,g') = randomR (1,n) g\n                    VUM.swap vector i j\n                    return g'\n  g' &lt;- foldM step g [1..VUM.length vector-1]\n  VU.unsafeFreeze vector\n</code></pre>\n\n<p>But this does not:</p>\n\n<pre><code>randVector' :: (RandomGen g) =&gt; Int -&gt; g -&gt; (VU.Vector Int, g)\nrandVector' n g = runST $ do\n  vector &lt;- VU.unsafeThaw (VU.enumFromN 1 n) :: ST s (VUM.MVector s Int)\n  let step g i = do let (j,g') = randomR (1,n) g\n                    VUM.swap vector i j\n                    return g'\n  g' &lt;- foldM step g [1..VUM.length vector-1]\n  (VU.unsafeFreeze vector, g')\n</code></pre>\n\n<p>The return statement with the frozen vector and the random generator produces the following error:</p>\n\n<blockquote>\n  <p>Couldn't match expected type <code>ST s (VU.Vector Int, g)</code> with actual\n  type <code>(m0 (VU.Vector Int), g)</code></p>\n</blockquote>\n"}, {"tags": ["function", "haskell"], "comments": [{"owner": {"reputation": 13807, "user_id": 2407038, "user_type": "registered", "accept_rate": 64, "profile_image": "https://www.gravatar.com/avatar/538f6f4a9aa43841841de7d8e8b169fc?s=128&d=identicon&r=PG&f=1", "display_name": "user2407038", "link": "https://stackoverflow.com/users/2407038/user2407038"}, "edited": false, "score": 0, "creation_date": 1463400701, "post_id": 37253590, "comment_id": 62034722, "body": "<code>fun2 (+)</code> is equivalent to <code>\\a b t -&gt; a t + b t</code> by definition. It is really a function of 3 arguments - its type is <code>Num a =&gt; {-1-}(t -&gt; a) -&gt; {-2-}(t -&gt; a) -&gt; {-3-}t -&gt; a</code>"}, {"owner": {"reputation": 59, "user_id": 1576003, "user_type": "registered", "accept_rate": 0, "profile_image": "https://www.gravatar.com/avatar/a948e7e7a1a791e2ac0ba6fa2c9c82e9?s=128&d=identicon&r=PG", "display_name": "DrDecay", "link": "https://stackoverflow.com/users/1576003/drdecay"}, "reply_to_user": {"reputation": 13807, "user_id": 2407038, "user_type": "registered", "accept_rate": 64, "profile_image": "https://www.gravatar.com/avatar/538f6f4a9aa43841841de7d8e8b169fc?s=128&d=identicon&r=PG&f=1", "display_name": "user2407038", "link": "https://stackoverflow.com/users/2407038/user2407038"}, "edited": false, "score": 0, "creation_date": 1463407350, "post_id": 37253590, "comment_id": 62038736, "body": "Thank you for answer. I try to clarify the problem."}, {"owner": {"reputation": 13807, "user_id": 2407038, "user_type": "registered", "accept_rate": 64, "profile_image": "https://www.gravatar.com/avatar/538f6f4a9aa43841841de7d8e8b169fc?s=128&d=identicon&r=PG&f=1", "display_name": "user2407038", "link": "https://stackoverflow.com/users/2407038/user2407038"}, "edited": false, "score": 0, "creation_date": 1463439752, "post_id": 37253590, "comment_id": 62055890, "body": "@ your edit.. <code>t</code> is the variable bound by the lambda. <code>(\\x -&gt; 3) t</code> is just <code>3</code> so <code>\\t -&gt; 3 + 4</code> is the final expression."}, {"owner": {"reputation": 59, "user_id": 1576003, "user_type": "registered", "accept_rate": 0, "profile_image": "https://www.gravatar.com/avatar/a948e7e7a1a791e2ac0ba6fa2c9c82e9?s=128&d=identicon&r=PG", "display_name": "DrDecay", "link": "https://stackoverflow.com/users/1576003/drdecay"}, "reply_to_user": {"reputation": 13807, "user_id": 2407038, "user_type": "registered", "accept_rate": 64, "profile_image": "https://www.gravatar.com/avatar/538f6f4a9aa43841841de7d8e8b169fc?s=128&d=identicon&r=PG&f=1", "display_name": "user2407038", "link": "https://stackoverflow.com/users/2407038/user2407038"}, "edited": false, "score": 0, "creation_date": 1463470244, "post_id": 37253590, "comment_id": 62065539, "body": "But in order to calculate <code>\\t -&gt; 3 + 4</code> we need to pass any t. I mean if we input <code>let f = \\t -&gt; 3 + 4</code> then to get result we need e.g. to enter f 42. I mean if it is correct that we end up with <code>\\t -&gt; (\\x-&gt;3) t + (\\x-&gt;4) t</code> expression we need some extra any t to evaluate it, i.e. <code>(+) 3 4 42</code>. Or not?"}, {"owner": {"reputation": 499, "user_id": 4629794, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/fb19f570a2d96e68ec79f0af208d23a8?s=128&d=identicon&r=PG", "display_name": "lierdakil", "link": "https://stackoverflow.com/users/4629794/lierdakil"}, "edited": false, "score": 0, "creation_date": 1463504532, "post_id": 37253590, "comment_id": 62089814, "body": "<code>(+) 3 4 = (+) (\\x-&gt;3) (\\x-&gt;4)</code> -- this is pretty much wrong. <code>3</code> has type <code>Integer</code>, but <code>\\x -&gt; 3</code> has type <code>a -&gt; Integer</code>. Those two are not equal. As for the rest:"}, {"owner": {"reputation": 499, "user_id": 4629794, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/fb19f570a2d96e68ec79f0af208d23a8?s=128&d=identicon&r=PG", "display_name": "lierdakil", "link": "https://stackoverflow.com/users/4629794/lierdakil"}, "edited": false, "score": 0, "creation_date": 1463504919, "post_id": 37253590, "comment_id": 62090008, "body": "<code>fun2 (+) (\\x-&gt;3) (\\x-&gt;4) = \\t -&gt; (\\x-&gt;3) t + (\\x-&gt;4) t = \\t -&gt; const 3 t + const 4 t = \\_ -&gt; const 3 undefined + const 4 undefined = const (3+4)</code>  Sorry, accidentally submitted and didn&#39;t make an edit in time."}, {"owner": {"reputation": 59, "user_id": 1576003, "user_type": "registered", "accept_rate": 0, "profile_image": "https://www.gravatar.com/avatar/a948e7e7a1a791e2ac0ba6fa2c9c82e9?s=128&d=identicon&r=PG", "display_name": "DrDecay", "link": "https://stackoverflow.com/users/1576003/drdecay"}, "edited": false, "score": 0, "creation_date": 1463556266, "post_id": 37253590, "comment_id": 62109453, "body": "I agree that expressions <code>(+) 3 4 </code> and <code>(+) (\\x-&gt;3) (\\x-&gt;4)</code> are not equivalent. But I think that we can make them so by passing one extra argument."}], "answers": [{"comments": [{"owner": {"reputation": 59, "user_id": 1576003, "user_type": "registered", "accept_rate": 0, "profile_image": "https://www.gravatar.com/avatar/a948e7e7a1a791e2ac0ba6fa2c9c82e9?s=128&d=identicon&r=PG", "display_name": "DrDecay", "link": "https://stackoverflow.com/users/1576003/drdecay"}, "edited": false, "score": 0, "creation_date": 1463407354, "post_id": 37253924, "comment_id": 62038741, "body": "Thank you for answer. I try to clarify the problem."}], "tags": [], "owner": {"reputation": 49959, "user_id": 866915, "user_type": "registered", "accept_rate": 70, "profile_image": "https://www.gravatar.com/avatar/09242131d6e17cbbe31e8547514da6e5?s=128&d=identicon&r=PG", "display_name": "ErikR", "link": "https://stackoverflow.com/users/866915/erikr"}, "is_accepted": false, "score": 0, "last_activity_date": 1463401613, "creation_date": 1463401613, "answer_id": 37253924, "question_id": 37253590, "link": "https://stackoverflow.com/questions/37253590/haskell-functions-in-num-expressions/37253924#37253924", "title": "Haskell. Functions in Num expressions", "body": "<p>In type signatures parentheses associate to the right, so:</p>\n\n<pre><code>f :: a -&gt; (b -&gt; c -&gt; d)\n</code></pre>\n\n<p>is the same as:</p>\n\n<pre><code>f :: a -&gt; b -&gt; c -&gt; d\n</code></pre>\n\n<p>So the parens indicated below are redundant:</p>\n\n<pre><code>fun2 :: (a -&gt; b -&gt; c) -&gt; ((t -&gt; a) -&gt; (t -&gt; b) -&gt; (t -&gt; c))\n                         ^                                ^\n</code></pre>\n\n<p>and removing them leaves:</p>\n\n<pre><code>fun2 :: (a -&gt; b -&gt; c) -&gt; (t -&gt; a) -&gt; (t -&gt; b) -&gt; (t -&gt; c)\n          arg1             arg2        arg3\n</code></pre>\n"}, {"tags": [], "owner": {"reputation": 6415, "user_id": 1416525, "user_type": "registered", "accept_rate": 78, "profile_image": "https://www.gravatar.com/avatar/6f23f148b7241e345a61d193ed205685?s=128&d=identicon&r=PG", "display_name": "cdk", "link": "https://stackoverflow.com/users/1416525/cdk"}, "is_accepted": false, "score": 1, "last_activity_date": 1463417478, "creation_date": 1463417478, "answer_id": 37259155, "question_id": 37253590, "link": "https://stackoverflow.com/questions/37253590/haskell-functions-in-num-expressions/37259155#37259155", "title": "Haskell. Functions in Num expressions", "body": "<p>The type of <code>(+)</code> is <code>Num a =&gt; a -&gt; a -&gt; a</code>. Since you're creating an instance of <code>Num</code> for the type <code>Num a =&gt; t -&gt; a</code>, consider the explicit signature</p>\n\n<p><code>(+) :: Num a =&gt; (t -&gt; a) -&gt; (t -&gt; a) -&gt; (t -&gt; a)</code> (1)</p>\n\n<p>or equivalently (by currying)</p>\n\n<p><code>(+) :: Num a =&gt; (t -&gt; a) -&gt; (t -&gt; a) -&gt; t -&gt; a</code> (2)</p>\n\n<p>What this says is: \"If you give me 2 strategies for producing a <code>Num a =&gt; a</code> from a <code>t</code>, I can create a new strategy for producing a <code>Num a =&gt; a</code> from a <code>t</code> by using the <code>Num.(+)</code> instance of the <code>a</code>'s\"</p>\n\n<p>I think the part that has you confused is that this specific <code>(+)</code> can be viewed as a function of 2 arguments which returns a function (1), or a function of 3 arguments which returns a value (2). Since functions in Haskell are curried, these are really the same thing.</p>\n"}], "owner": {"reputation": 59, "user_id": 1576003, "user_type": "registered", "accept_rate": 0, "profile_image": "https://www.gravatar.com/avatar/a948e7e7a1a791e2ac0ba6fa2c9c82e9?s=128&d=identicon&r=PG", "display_name": "DrDecay", "link": "https://stackoverflow.com/users/1576003/drdecay"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 104, "favorite_count": 0, "answer_count": 2, "score": 0, "last_activity_date": 1463555853, "creation_date": 1463400508, "last_edit_date": 1463555853, "question_id": 37253590, "link": "https://stackoverflow.com/questions/37253590/haskell-functions-in-num-expressions", "title": "Haskell. Functions in Num expressions", "body": "<p>I start to learn Haskell. While studying a tutorial I have found the following example that enables the usage of functions in arithmetic expressions:</p>\n\n<pre><code>module FunNat where\n\n    instance Num a =&gt; Num (t -&gt; a) where\n        (+) = fun2 (+)\n        (*) = fun2 (*)\n        (-) = fun2 (-)\n\n        abs      = fun1 abs\n        signum   = fun1 signum\n\n        fromInteger = const . fromInteger\n\n    fun1 :: (a -&gt; b) -&gt; ((t -&gt; a) -&gt; (t -&gt; b))\n    fun1 = (.)\n\n    fun2 :: (a -&gt; b -&gt; c) -&gt; ((t -&gt; a) -&gt; (t -&gt; b) -&gt; (t -&gt; c))\n    fun2 op a b = \\t -&gt; a t `op` b t\n</code></pre>\n\n<p>The example works. But I can not understand how the <code>(+)</code> function is transformed into the function of two arguments. As I can understand each <code>(+)</code> is substituted with <code>fun2 (+)</code>. And fun2 is equivalent to the function of one argument <code>\\t -&gt; a t 'op' b t</code>, but we should have a function of two arguments (something like <code>(\\t1 t2 -&gt; (\\x -&gt; x ) t1 + (\\x -&gt; x) t2)</code> ). I think that here some basic concepts of Haskell typing should be applied but I do not know what they are.</p>\n\n<p><strong>EDIT 1</strong></p>\n\n<p>I understand that <code>fun2</code> is a function of three arguments. I can't understand internal expression transformation. I'm reasoning in the following way: <code>(+) 3 4</code> = <code>(+) (\\x-&gt;3) (\\x-&gt;4)</code> = <code>fun2 (+) (\\x-&gt;3) (\\x-&gt;4)</code> = <code>\\t -&gt; (\\x-&gt;3) t + (\\x-&gt;4) t</code>\nWhat is this t? Or where am I wrong in my reasoning? May be it is necessary to think another way?</p>\n\n<p><strong>EDIT 2</strong></p>\n\n<p>I think that I have reached some understanding of the issue (thanks you all!). So:</p>\n\n<ol>\n<li><p>When we write <code>(+) 3 4</code> - in this case a simple operation from <code>Num</code> is used, no special features from <code>FunNat</code>. To use <code>(+)</code> from <code>FunNat</code> it is necessary to write <code>fun2 (+) 3 4</code> or <code>fun2 (+) (\\x -&gt; 3) (\\x -&gt; 4)</code>. But these expressions expect any third parameter to be evaluated;</p></li>\n<li><p>To demonstrate specific features from <code>FunNat</code> we may use the following example <code>((*)-(+))</code> (taken from tutorial) or in other form - <code>(-) (*) (+)</code>. Both expressions take two arguments. In this case we have: <code>((*)-(+))</code> = <code>fun2 (-) (*) (+)</code> = <code>\\t -&gt; (*) t - (+) t</code> = <code>\\t -&gt; (\\t1 t2 -&gt; t1 * t2) t - (\\t1 t2 -&gt; t1 + t2) t</code> = <code>(\\t t2 -&gt; t * t2) - (\\t t2 -&gt; t + t2)</code> = <code>\\t t2 -&gt; (t * t2) - (t + t2)</code>. The final expression expects just <code>Num</code>. I hope that all these are correct</p></li>\n<li><p>As it was explained in tutorial, but I can't understand what for, the possibility to use <code>(*)</code> and <code>(+)</code> as parameters for <code>fun2</code> that expects <code>(t-&gt;a)</code> is based on the following (taken from tutorial): <code>t1 -&gt; t2 -&gt; a</code> = <code>t1-&gt;a'</code> where <code>a' = t2 -&gt; a</code>. Here curring is used.</p></li>\n</ol>\n\n<p>So all necessary facts were on the surface but I do not take into consideration the non-trivial mechanism of type inference.</p>\n"}, {"tags": ["list", "haskell", "permutation"], "comments": [{"owner": {"reputation": 27561, "user_id": 214446, "user_type": "registered", "accept_rate": 74, "profile_image": "https://www.gravatar.com/avatar/5deb6b87326686b1f2e9fdb37ceac210?s=128&d=identicon&r=PG", "display_name": "mb21", "link": "https://stackoverflow.com/users/214446/mb21"}, "edited": false, "score": 2, "creation_date": 1463400057, "post_id": 37253317, "comment_id": 62034326, "body": "You could approach this by stripping the string by all its underscores, remembering the count <code>n</code> of underscores and then introducing all permutations of <code>n</code> underscores to the stripped string..."}, {"owner": {"reputation": 601, "user_id": 5503863, "user_type": "registered", "accept_rate": 100, "profile_image": "https://graph.facebook.com/10206801913918392/picture?type=large", "display_name": "Tiziano Coroneo", "link": "https://stackoverflow.com/users/5503863/tiziano-coroneo"}, "reply_to_user": {"reputation": 27561, "user_id": 214446, "user_type": "registered", "accept_rate": 74, "profile_image": "https://www.gravatar.com/avatar/5deb6b87326686b1f2e9fdb37ceac210?s=128&d=identicon&r=PG", "display_name": "mb21", "link": "https://stackoverflow.com/users/214446/mb21"}, "edited": false, "score": 0, "creation_date": 1463400407, "post_id": 37253317, "comment_id": 62034560, "body": "do you mean the permutations of possible positions of underscores in the word?"}, {"owner": {"reputation": 4565, "user_id": 1134885, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/7c428466054762cf7d4b5fb5f4396fa2?s=128&d=identicon&r=PG", "display_name": "NovaDenizen", "link": "https://stackoverflow.com/users/1134885/novadenizen"}, "edited": false, "score": 0, "creation_date": 1463437488, "post_id": 37253317, "comment_id": 62055146, "body": "It&#39;s a lot easier to make a function like <code>allUnderscorePlacements :: Int -&gt; String -&gt; [String]</code>, where your example would be called <code>allUnderscorePlacements 3 &quot;hi&quot;</code>.  Use another function to turn <code>&quot;_h_i_&quot;</code> into the <code>3</code> and <code>&quot;hi&quot;</code> arguments."}], "answers": [{"comments": [{"owner": {"reputation": 601, "user_id": 5503863, "user_type": "registered", "accept_rate": 100, "profile_image": "https://graph.facebook.com/10206801913918392/picture?type=large", "display_name": "Tiziano Coroneo", "link": "https://stackoverflow.com/users/5503863/tiziano-coroneo"}, "edited": false, "score": 0, "creation_date": 1463400864, "post_id": 37253627, "comment_id": 62034816, "body": "nice! but I need it to be <i>somewhat</i> fast"}], "tags": [], "owner": {"reputation": 34669, "user_id": 34409, "user_type": "registered", "accept_rate": 64, "profile_image": "https://www.gravatar.com/avatar/4dfdadcd9bb62300eb1a54f02fe5dc18?s=128&d=identicon&r=PG", "display_name": "Chad Gilbert", "link": "https://stackoverflow.com/users/34409/chad-gilbert"}, "is_accepted": false, "score": 1, "last_activity_date": 1463401206, "last_edit_date": 1463401206, "creation_date": 1463400643, "answer_id": 37253627, "question_id": 37253317, "link": "https://stackoverflow.com/questions/37253317/single-char-permutations/37253627#37253627", "title": "Single char permutations", "body": "<p>One way to perform this is to generate all permutations but only keep those that retain the order of non-underscore characters.</p>\n\n\n\n<pre class=\"lang-haskell prettyprint-override\"><code>import Data.List\n\norderedPermutationsOf :: Char -&gt; String -&gt; [String]\norderedPermutationsOf c s =\n  let except = filter (/= c)\n  in nub $ filter (\\x -&gt; except s == except x) $ permutations s\n</code></pre>\n\n<p>It isn't very performant, but it gets the job done.</p>\n"}, {"tags": [], "owner": {"reputation": 587, "user_id": 1015602, "user_type": "registered", "accept_rate": 58, "profile_image": "https://www.gravatar.com/avatar/ea1629e2c2d1d82ab8c3645d82ecc60d?s=128&d=identicon&r=PG", "display_name": "Free_D", "link": "https://stackoverflow.com/users/1015602/free-d"}, "is_accepted": true, "score": 1, "last_activity_date": 1463515751, "creation_date": 1463515751, "answer_id": 37285378, "question_id": 37253317, "link": "https://stackoverflow.com/questions/37253317/single-char-permutations/37285378#37285378", "title": "Single char permutations", "body": "<pre><code>so :: String -&gt; [String]\nso = takeWhile' notDone . iterate shift . preproccess\n  where    \n    preproccess xs = (replicate (uCount xs) '_') ++ (letters xs)\n    uCount = length . filter (=='_')\n    letters = filter (/='_')\n    notDone = not . and . map (== '_') . dropWhile (/='_')\n\ntakeWhile' :: (a -&gt; Bool) -&gt; [a] -&gt; [a]\ntakeWhile' _ [] = []\ntakeWhile' f (x:xs) \n  | f x = x:(takeWhile' f xs)\n  | otherwise = [x]\n\nshift :: String -&gt; String\nshift [] = []\nshift (x:xs)\n  | x /= '_' = roll lead [] rest\n  | otherwise = roll [] [] (x:xs)\n  where     \n    (lead,rest) = span (/='_') (x:xs)\n    roll _ acc [] = acc\n    roll _ acc [a] = acc++[a]\n    roll ins acc (a:b:bs)\n      | (a == '_') &amp;&amp; (b /= '_') = acc++ins++(b:a:bs)\n      | otherwise = roll ins (acc++[a]) (b:bs)\n</code></pre>\n\n<p>Probably not the prettiest code, but it seems to work.  The algorithm is essentially the same as the one you used to do it by hand, except in reverse.</p>\n\n<p><code>shift</code> works by rolling across the string and shifting the leftmost non-underscore character to the left. This is repeated until all non-underscore characters are on the left.</p>\n\n<p>The preprocess is just to get all of the underscores on he left and all other characters on the right.</p>\n"}, {"tags": [], "owner": {"reputation": 62252, "user_id": 1435869, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/TrEd9.jpg?s=128&g=1", "display_name": "karakfa", "link": "https://stackoverflow.com/users/1435869/karakfa"}, "is_accepted": false, "score": 1, "last_activity_date": 1463523788, "creation_date": 1463523788, "answer_id": 37287180, "question_id": 37253317, "link": "https://stackoverflow.com/questions/37253317/single-char-permutations/37287180#37287180", "title": "Single char permutations", "body": "<p>here is another solution</p>\n\n<pre><code>u='_'\n\nperms :: String -&gt; Int -&gt; [String]\nperms x 0 = [x]\nperms [x] n = rotations $ x: (replicate n u)\nperms (x:xs) n = (map (x:) $ perms xs n) ++ if(x/=u) then perms (u:x:xs) (n-1) else []\n\nrotate xs n = zipWith const (drop n (cycle xs)) xs\nrotations x = map (rotate x) [1..length x]\n</code></pre>\n\n<p>I changed the input signature, use as</p>\n\n<pre><code>&gt; perms \"hi\" 3\n[\"h___i\",\"h__i_\",\"h_i__\",\"hi___\",\"_h__i\",\"_h_i_\",\"_hi__\",\"__h_i\",\"__hi_\",\"___hi\"]\n</code></pre>\n\n<p>I think there is a simpler solution hiding there but don't have enough time now.</p>\n"}], "owner": {"reputation": 601, "user_id": 5503863, "user_type": "registered", "accept_rate": 100, "profile_image": "https://graph.facebook.com/10206801913918392/picture?type=large", "display_name": "Tiziano Coroneo", "link": "https://stackoverflow.com/users/5503863/tiziano-coroneo"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 75, "favorite_count": 0, "accepted_answer_id": 37285378, "answer_count": 3, "score": 0, "last_activity_date": 1463523788, "creation_date": 1463399615, "question_id": 37253317, "link": "https://stackoverflow.com/questions/37253317/single-char-permutations", "title": "Single char permutations", "body": "<p>I've been experimenting with Haskell for quite a while now, and I've found an interesting problem:</p>\n\n<p>I've got to generate all permutations of a string in a <strong>very particular</strong> way:</p>\n\n<p>Let's say I've got this string:</p>\n\n<pre><code>let input = \"_h_i_\"\n</code></pre>\n\n<p>I want to get all the permutations of underscores in <code>input</code> keeping the actual order of the other chars, like this:</p>\n\n<pre><code>let results = [\"hi___\", \"h_i__\", \"h__i_\", \"h___i\", \"_hi__\", \"_h_i_\", \"_h__i\", \"__hi_\", \"__h_i\", \"___hi\"] \n</code></pre>\n\n<p>and I've no idea on how to do that.</p>\n"}, {"tags": ["haskell"], "answers": [{"comments": [{"owner": {"reputation": 3, "user_id": 6340505, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/1ec586581f978ba8dda4286290500d74?s=128&d=identicon&r=PG&f=1", "display_name": "user6340505", "link": "https://stackoverflow.com/users/6340505/user6340505"}, "edited": false, "score": 0, "creation_date": 1463399981, "post_id": 37253019, "comment_id": 62034276, "body": "Compiles ok now. Thanks for your help."}], "tags": [], "owner": {"reputation": 34669, "user_id": 34409, "user_type": "registered", "accept_rate": 64, "profile_image": "https://www.gravatar.com/avatar/4dfdadcd9bb62300eb1a54f02fe5dc18?s=128&d=identicon&r=PG", "display_name": "Chad Gilbert", "link": "https://stackoverflow.com/users/34409/chad-gilbert"}, "is_accepted": true, "score": 1, "last_activity_date": 1463398652, "creation_date": 1463398652, "answer_id": 37253019, "question_id": 37252911, "link": "https://stackoverflow.com/questions/37252911/could-not-match-expected-type/37253019#37253019", "title": "Could not match expected type", "body": "<p>The Class and Instance declarations need spacing for their included functions:</p>\n\n\n\n<pre class=\"lang-haskell prettyprint-override\"><code>class Position a where\n  score :: a -&gt; Int\n  player :: a -&gt; Player\n\ninstance Position Nim where\n  score a = count a\n  player a = turn a\n</code></pre>\n"}], "owner": {"reputation": 3, "user_id": 6340505, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/1ec586581f978ba8dda4286290500d74?s=128&d=identicon&r=PG&f=1", "display_name": "user6340505", "link": "https://stackoverflow.com/users/6340505/user6340505"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 423, "favorite_count": 0, "accepted_answer_id": 37253019, "answer_count": 1, "score": 0, "last_activity_date": 1463398652, "creation_date": 1463398300, "last_edit_date": 1463398491, "question_id": 37252911, "link": "https://stackoverflow.com/questions/37252911/could-not-match-expected-type", "title": "Could not match expected type", "body": "<p>I am learning Haskell.</p>\n\n<p>the following code is not compiling</p>\n\n\n\n<pre class=\"lang-haskell prettyprint-override\"><code>data Player = Max  | Min\n  deriving (Show,Eq)\n\nclass Position a where\nscore :: a -&gt; Int\nplayer :: a -&gt; Player\n\n\ndata Nim = Nim { turn :: Player, count :: Int}\n\ninstance Position Nim where\nscore a = count a\nplayer a = turn a\n</code></pre>\n\n<blockquote>\n  <p>error: Could not match expected type Nim with actual type 'a'.\n  'a' is a rigid type variable bound by the input signature for player :: a -> Player.</p>\n</blockquote>\n\n<p>Any help would be appreciated.</p>\n"}, {"tags": ["performance", "haskell", "optimization", "lazy-evaluation"], "comments": [{"owner": {"reputation": 44013, "user_id": 1477667, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/trgKM.jpg?s=128&g=1", "display_name": "dfeuer", "link": "https://stackoverflow.com/users/1477667/dfeuer"}, "edited": false, "score": 0, "creation_date": 1463387598, "post_id": 37249546, "comment_id": 62027431, "body": "What if you use <code>-O2</code> and no bang patterns at all?"}, {"owner": {"reputation": 2442, "user_id": 3666302, "user_type": "registered", "accept_rate": 71, "profile_image": "https://www.gravatar.com/avatar/e9aed854fcd666aba1316ef908ad5913?s=128&d=identicon&r=PG&f=1", "display_name": "TomTom", "link": "https://stackoverflow.com/users/3666302/tomtom"}, "reply_to_user": {"reputation": 44013, "user_id": 1477667, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/trgKM.jpg?s=128&g=1", "display_name": "dfeuer", "link": "https://stackoverflow.com/users/1477667/dfeuer"}, "edited": false, "score": 0, "creation_date": 1463387990, "post_id": 37249546, "comment_id": 62027641, "body": "@dfeuer just added it. It&#39;s like that badly placed bang at 1.75s"}, {"owner": {"reputation": 44013, "user_id": 1477667, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/trgKM.jpg?s=128&g=1", "display_name": "dfeuer", "link": "https://stackoverflow.com/users/1477667/dfeuer"}, "edited": false, "score": 0, "creation_date": 1463388438, "post_id": 37249546, "comment_id": 62027853, "body": "How are you calling this function, and with what argument? I find the results a bit surprising. I&#39;m guessing that GHC&#39;s strictness analysis isn&#39;t working very well here!"}, {"owner": {"reputation": 2442, "user_id": 3666302, "user_type": "registered", "accept_rate": 71, "profile_image": "https://www.gravatar.com/avatar/e9aed854fcd666aba1316ef908ad5913?s=128&d=identicon&r=PG&f=1", "display_name": "TomTom", "link": "https://stackoverflow.com/users/3666302/tomtom"}, "reply_to_user": {"reputation": 44013, "user_id": 1477667, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/trgKM.jpg?s=128&g=1", "display_name": "dfeuer", "link": "https://stackoverflow.com/users/1477667/dfeuer"}, "edited": false, "score": 0, "creation_date": 1463388576, "post_id": 37249546, "comment_id": 62027922, "body": "@dfeuer I build and run it in the shell with <code>stack build --ghc-options -O2 &amp;&amp; time stack exec &lt;project&gt;</code>"}, {"owner": {"reputation": 44013, "user_id": 1477667, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/trgKM.jpg?s=128&g=1", "display_name": "dfeuer", "link": "https://stackoverflow.com/users/1477667/dfeuer"}, "edited": false, "score": 0, "creation_date": 1463388586, "post_id": 37249546, "comment_id": 62027927, "body": "I&#39;m most surprised that the first one, banging the final result pair, would do anything useful; the final result is obviously strict in that!"}], "answers": [{"comments": [{"owner": {"reputation": 44013, "user_id": 1477667, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/trgKM.jpg?s=128&g=1", "display_name": "dfeuer", "link": "https://stackoverflow.com/users/1477667/dfeuer"}, "edited": false, "score": 0, "creation_date": 1463387877, "post_id": 37249709, "comment_id": 62027572, "body": "It&#39;s often very helpful to have lazy fields. You should generally do so if you want to store functions in them. And lazy structures support some operations much better than strict ones. Generally anything <code>fmap</code>, <code>(&lt;*&gt;)</code>, or <code>traverse</code>-like, including lenses."}, {"owner": {"reputation": 2442, "user_id": 3666302, "user_type": "registered", "accept_rate": 71, "profile_image": "https://www.gravatar.com/avatar/e9aed854fcd666aba1316ef908ad5913?s=128&d=identicon&r=PG&f=1", "display_name": "TomTom", "link": "https://stackoverflow.com/users/3666302/tomtom"}, "edited": false, "score": 0, "creation_date": 1463388254, "post_id": 37249709, "comment_id": 62027771, "body": "Shouldn&#39;t it be the other way around though? Introduce strictness explicitely and lazyiness implicitely?"}, {"owner": {"reputation": 9119, "user_id": 180258, "user_type": "registered", "accept_rate": 92, "profile_image": "https://www.gravatar.com/avatar/8b3779ca7c73166d7016272086c6282f?s=128&d=identicon&r=PG", "display_name": "ron", "link": "https://stackoverflow.com/users/180258/ron"}, "edited": false, "score": 0, "creation_date": 1463395778, "post_id": 37249709, "comment_id": 62031764, "body": "dfeuer: 1) &quot;store functions&quot; - you mean store thunks/delayed computations? Yes, if that is your explicit intent why not. 2) I guess you mean since you can get away with less data copying? But shouldn&#39;t fusion diminish differences a bit (at least with <code>fmap</code>)?"}, {"owner": {"reputation": 9119, "user_id": 180258, "user_type": "registered", "accept_rate": 92, "profile_image": "https://www.gravatar.com/avatar/8b3779ca7c73166d7016272086c6282f?s=128&d=identicon&r=PG", "display_name": "ron", "link": "https://stackoverflow.com/users/180258/ron"}, "edited": false, "score": 0, "creation_date": 1463395828, "post_id": 37249709, "comment_id": 62031793, "body": "TomTom: not sure what you refer to. The way I suggested was explicitly annotating strictness (but doing so by default)."}, {"owner": {"reputation": 1969, "user_id": 3041008, "user_type": "registered", "accept_rate": 86, "profile_image": "https://i.stack.imgur.com/cqLI9.png?s=128&g=1", "display_name": "mucaho", "link": "https://stackoverflow.com/users/3041008/mucaho"}, "edited": false, "score": 0, "creation_date": 1463415371, "post_id": 37249709, "comment_id": 62043884, "body": "I&#39;d include <a href=\"https://github.com/tibbe/haskell-style-guide/blob/master/haskell-style.md#dealing-with-laziness\" rel=\"nofollow noreferrer\">Tibbe&#39;s style guide section on laziness</a>."}, {"owner": {"reputation": 44013, "user_id": 1477667, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/trgKM.jpg?s=128&g=1", "display_name": "dfeuer", "link": "https://stackoverflow.com/users/1477667/dfeuer"}, "edited": false, "score": 0, "creation_date": 1463424990, "post_id": 37249709, "comment_id": 62049180, "body": "@ron, by &quot;store functions&quot; I meant &quot;store functions&quot;. If something is or may be a function, then forcing it is very generally a bad idea. In particular, doing so distinguishes between <code>undefined</code> and <code>const undefined</code>, breaking parametricity and such. For example, <code>base &gt;= 4.8</code> defines (at least approximately) <code>instance Functor Identity where fmap f = coerce f</code>. If you, for some reason, force <code>fmap f</code>, then you can distinguish this clever implementation from the naive <code>fmap f (Identity a) = Identity (f a)</code>."}, {"owner": {"reputation": 9119, "user_id": 180258, "user_type": "registered", "accept_rate": 92, "profile_image": "https://www.gravatar.com/avatar/8b3779ca7c73166d7016272086c6282f?s=128&d=identicon&r=PG", "display_name": "ron", "link": "https://stackoverflow.com/users/180258/ron"}, "reply_to_user": {"reputation": 44013, "user_id": 1477667, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/trgKM.jpg?s=128&g=1", "display_name": "dfeuer", "link": "https://stackoverflow.com/users/1477667/dfeuer"}, "edited": false, "score": 0, "creation_date": 1463431094, "post_id": 37249709, "comment_id": 62052313, "body": "@dfeuer: Could you illustrate the two cases in a gist? Trying to work out if this is practical or only applies if you do weird things. Your second case suggests it&#39;s practical, but I don&#39;t get it exactly."}], "tags": [], "owner": {"reputation": 9119, "user_id": 180258, "user_type": "registered", "accept_rate": 92, "profile_image": "https://www.gravatar.com/avatar/8b3779ca7c73166d7016272086c6282f?s=128&d=identicon&r=PG", "display_name": "ron", "link": "https://stackoverflow.com/users/180258/ron"}, "is_accepted": false, "score": 12, "last_activity_date": 1463406888, "last_edit_date": 1463406888, "creation_date": 1463387604, "answer_id": 37249709, "question_id": 37249546, "link": "https://stackoverflow.com/questions/37249546/when-to-evaluate-strictly-in-haskell/37249709#37249709", "title": "When to evaluate strictly in Haskell?", "body": "<p>Not set in stone, but current best practice is to make all fields in data structures strict, but take function arguments and return results lazily (except accumulators).</p>\n\n<p>The net effect is that as long as you don't touch a piece of return value, nothing is evaluated. As soon as you strictly need a tiny bit from it, the whole structure is evaluated at once, leading to more predictable memory/cpu usage patterns than if they were lazily evaluated throughout execution.</p>\n\n<p>The performance guidelines by Johan Tibell are the best to point out subtleties: <a href=\"http://johantibell.com/files/haskell-performance-patterns.html#(1)\" rel=\"noreferrer\">http://johantibell.com/files/haskell-performance-patterns.html#(1)</a> . Note that recent GHCs perform small strict field unpacking automatically without the need to annotate. Also see the <a href=\"https://ghc.haskell.org/trac/ghc/wiki/StrictPragma\" rel=\"noreferrer\">Strict</a> pragmas.</p>\n\n<p>About when to introduce the strict fields: do it right from the beginning, since it's much harder to bolt it retrospectively. You can still use lazy fields, but only when you explicitly want them.</p>\n\n<p>Note: <code>[]</code> is lazy, and is more used as a control structure that is expected to inline, than as a container. Use <code>vector</code> etc for the latter.</p>\n\n<p>Note 2: there are specialized libs to let you deal with strict folding (see <a href=\"https://hackage.haskell.org/package/foldl\" rel=\"noreferrer\">foldl</a>), or with streaming computations (<a href=\"https://hackage.haskell.org/package/conduit\" rel=\"noreferrer\">conduit</a>, <a href=\"https://hackage.haskell.org/package/pipes\" rel=\"noreferrer\">pipes</a>).</p>\n\n<h2>Update</h2>\n\n<p>A bit of elaboration on the rationale, so that 1) you know this is not just for the rubber duck from the sky 2) know when/why to deviate.</p>\n\n<h3>Why to evaluate strict?</h3>\n\n<p>One case is <strong>strict accumulation</strong>, as outlined in the question. This comes in less obvious forms too - such as keeping count of certain events happening in the state of the app. If you don't store a strict count, you can get a long chain of <code>+1</code> thunks build up, which consumes a lot of memory for no good reason (vs storing just the updated count).</p>\n\n<p>Above is called a <code>memory leak</code> informally, even if it's not technically a leak (no memory is lost, it is just held longer than needed).</p>\n\n<p>An other case is <strong>concurrent computation</strong>, where the work is divided across multiple threads. Now, it is easy to run into situations where you think you forked out a computation to a separate thread (making your program very efficiently concurrent), only to realize later that the concurrent thread only computes the outermost layer of a lazy data structure, and the bulk of the computation still happens on your main thread when the value is forced.</p>\n\n<p>A solution path for this is using <code>NFData</code> from <a href=\"https://hackage.haskell.org/package/deepseq\" rel=\"noreferrer\">deepseq</a>. But imagine having a final data structure layered <code>A (B (C))</code>, where each layer is computed by a separate thread, deep forcing the structure before returning. Now <code>C</code> is deep forced (in effect traversed in memory) three times, <code>B</code> two times. If <code>C</code> is a deep/large structure, this is a waste. At this point you can either add the <a href=\"https://www.schoolofhaskell.com/user/edwardk/snippets/once\" rel=\"noreferrer\">Once trick</a>, or just use a deeply strict data structure, where doing shallow forcing to WHNF (instead of to deep NF) has the same effect of deep forcing, but the Once-trick is taken care by the compiler, so to speak.</p>\n\n<p>Now, if you are consistent and aware, you might be doing ok with deepseq+Once.</p>\n\n<p>Note: a usecase very similar to concurrent evaluation is single-threaded evaluation in the scary case of <strong>pure errors</strong>, such as <code>undefined</code> and <code>error</code>. These are ideally not used, but if are, the ways to attack the problem are very similar to the above outlined (see by the way the <a href=\"https://hackage.haskell.org/package/spoon\" rel=\"noreferrer\">spoon</a> package).</p>\n"}, {"comments": [{"owner": {"reputation": 1376, "user_id": 5200466, "user_type": "registered", "accept_rate": 81, "profile_image": "https://www.gravatar.com/avatar/abb1362cec6e1f0a2416a6d98a93cd6c?s=128&d=identicon&r=PG&f=1", "display_name": "matt", "link": "https://stackoverflow.com/users/5200466/matt"}, "edited": false, "score": 0, "creation_date": 1465591214, "post_id": 37251330, "comment_id": 62982993, "body": "you wrote a long answer to a question of mine earlier, but you deleted it. I tracked you down because I just wanted to say thank you for your effort. It really helped me!"}], "tags": [], "owner": {"reputation": 2831, "user_id": 183792, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/9ddcfbc6c31012fd25384f6301363347?s=128&d=identicon&r=PG&f=1", "display_name": "Michael", "link": "https://stackoverflow.com/users/183792/michael"}, "is_accepted": true, "score": 15, "last_activity_date": 1463474083, "last_edit_date": 1463474083, "creation_date": 1463393123, "answer_id": 37251330, "question_id": 37249546, "link": "https://stackoverflow.com/questions/37249546/when-to-evaluate-strictly-in-haskell/37251330#37251330", "title": "When to evaluate strictly in Haskell?", "body": "<p>In your examples the bang patterns are moving around the final calculation of the average, or rather its ingredients:</p>\n\n<pre><code>where (!len, !acc)   = V.foldl' f (0,0) xs :: (Int, Double)\nwhere !(len, acc)   = V.foldl' f (0,0) xs :: (Int, Double)\n</code></pre>\n\n<p>but (with one apparent exception) not the second item, the folding function itself: </p>\n\n<pre><code>       f (len, acc) x = (len+1, acc+x)\n</code></pre>\n\n<p>But this <code>f</code> is where the action is. In your examples, the different ways you annotate <code>(len,acc)</code> seem to be triggering the compiler to adopt subtly different views of what to do with <code>f</code>. This is why everything seems slightly occult. The thing to do is deal with <code>f</code> directly.</p>\n\n<p>The main bread-and-butter point is that <em>in a left fold or accumulating loop, all accumulated material must be evaluated strictly</em>. Otherwise you are basically just building up a big expression with <code>foldl'</code> and then asking for it to be collapsed when you come finally to do something with the material you accumulated - here, with the final calculation of the average.</p>\n\n<p>In your examples, though, <code>foldl'</code> is never given an explicitly strict function to fold with: the accumulating <code>len</code> and <code>acc</code> are trapped inside a regular lazy Haskell tuple. </p>\n\n<p>The problem of strictness is arising here because you are accumulating more than one thing, but need to tie them together into one argument for the f operation you are passing to <code>foldl'</code>. This a typical case for writing a strict type or record to do the accumulation; this takes one short line</p>\n\n<pre><code>data P = P !Int !Double\n</code></pre>\n\n<p>then you can write </p>\n\n<pre><code>mean0 xs = acc / fromIntegral len\n    where P len acc    = V.foldl' f (P 0 0) xs \n          f (P len acc) !x = P (len+1) (acc+x)\n</code></pre>\n\n<p>Note that I don't mark <code>(P len acc)</code> with a bang since it is visibly in weak head normal form - you can see the P and don't need to ask the compiler to find it with !/seq - and thus <code>f</code> is strict in the first argument. The same is true in the one case where you add strictness to <code>f</code></p>\n\n<pre><code>          f !(len, acc) x = (len+1, acc+x)\n</code></pre>\n\n<p>But the function </p>\n\n<pre><code>          f (len, acc) x = (len+1, acc+x)\n</code></pre>\n\n<p>was already strict in the first argument, the pair, since you can see the outermost constructor <code>(,)</code>, and don't need a strictness annotation (which basically just tells the compiler to find it.) But the constructor just constructs a lazy tuple so it wasn't (explicitly) strict in <code>len</code> and <code>acc</code></p>\n\n<pre><code>$ time ./foldstrict\n5.00000000067109e8\nreal    0m1.495s\n</code></pre>\n\n<p>whereas on my machine your best mean is: </p>\n\n<pre><code>$ time ./foldstrict\n5.00000000067109e8\nreal    0m1.963s\n</code></pre>\n"}], "owner": {"reputation": 2442, "user_id": 3666302, "user_type": "registered", "accept_rate": 71, "profile_image": "https://www.gravatar.com/avatar/e9aed854fcd666aba1316ef908ad5913?s=128&d=identicon&r=PG&f=1", "display_name": "TomTom", "link": "https://stackoverflow.com/users/3666302/tomtom"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 1577, "favorite_count": 5, "accepted_answer_id": 37251330, "answer_count": 2, "score": 18, "last_activity_date": 1463474083, "creation_date": 1463386915, "last_edit_date": 1463387875, "question_id": 37249546, "link": "https://stackoverflow.com/questions/37249546/when-to-evaluate-strictly-in-haskell", "title": "When to evaluate strictly in Haskell?", "body": "<p>As far as I know <code>!</code> (called bangs) are used to signal that an expression should be evaluated strictly. But it isn't that obvious for me where to put them or if at all.</p>\n\n<pre><code>import qualified Data.Vector.Unboxed as V\n\nmain :: IO ()\nmain = print $ mean (V.enumFromTo 1 (10^9))\n\nmean :: V.Vector Double -&gt; Double\n</code></pre>\n\n<p><strong>The different versions of mean:</strong></p>\n\n<pre><code>-- compiled with O2 ~ 1.14s\nmean xs = acc / fromIntegral len\n    where !(len, acc)    = V.foldl' f (0,0) xs :: (Int, Double)\n          f (len, acc) x = (len+1, acc+x)\n\n-- compiled with O2 ~ 1.18s\nmean xs = acc / fromIntegral len\n    where (!len, !acc)   = V.foldl' f (0,0) xs :: (Int, Double)\n          f (len, acc) x = (len+1, acc+x)\n\n-- compiled with O2 ~ 1.75s\nmean xs = acc / fromIntegral len\n    where (len, acc)      = V.foldl' f (0,0) xs :: (Int, Double)\n          f !(len, acc) x = (len+1, acc+x)\n\n-- compiled with O2 ~ 1.75s\nmean xs = acc / fromIntegral len\n    where (len, acc)      = V.foldl' f (0,0) xs :: (Int, Double)\n          f (len, acc) x = (len+1, acc+x)\n\n-- compiled without options ~ 6s\nmean xs = acc / fromIntegral len\n    where (len, acc)     = V.foldl' f (0,0) xs :: (Int, Double)\n          f (len, acc) x = (len+1, acc+x)\n\n-- compiled without options ~ 12s\nmean xs = acc / fromIntegral len\n    where !(len, acc)    = V.foldl' f (0,0) xs :: (Int, Double)\n          f (len, acc) x = (len+1, acc+x)\n</code></pre>\n\n<p>Some of it makes sense intuitively, but I'd like it to be less of a trial and error approach.</p>\n\n<ul>\n<li><p>Is there some way to detect when lazy evaluation will get in the way of performance? Other than testing every rigorously.</p></li>\n<li><p>Does it only make sense for simple functions like <code>mean</code> where everything should be evaluated in one go?</p></li>\n</ul>\n"}, {"tags": ["haskell", "types", "typeclass"], "answers": [{"comments": [{"owner": {"reputation": 100185, "user_id": 3234959, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/93bb12ca0f93dfddb33880316f7e66c2?s=128&d=identicon&r=PG&f=1", "display_name": "chi", "link": "https://stackoverflow.com/users/3234959/chi"}, "edited": false, "score": 1, "creation_date": 1463394289, "post_id": 37245607, "comment_id": 62030909, "body": "This is indeed the idiomatic solution. (+1) Still, I have never fully bought the use of <code>proxy a</code>, even if this has become very popular. I would consider passing e.g. <code>[a]</code> instead of <code>Proxy a</code> to be obfuscating: if the intended value is irrelevant, and only the type matters, I&#39;d rather pass an explicit <code>Proxy a</code>. Hopefully, GHC 8 and explicit type args will wipe proxies away."}, {"owner": {"reputation": 44013, "user_id": 1477667, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/trgKM.jpg?s=128&g=1", "display_name": "dfeuer", "link": "https://stackoverflow.com/users/1477667/dfeuer"}, "reply_to_user": {"reputation": 100185, "user_id": 3234959, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/93bb12ca0f93dfddb33880316f7e66c2?s=128&d=identicon&r=PG&f=1", "display_name": "chi", "link": "https://stackoverflow.com/users/3234959/chi"}, "edited": false, "score": 0, "creation_date": 1463415445, "post_id": 37245607, "comment_id": 62043932, "body": "@chi, I usually agree. However, it can be very convenient to be able to use a singleton as a proxy. If I have <code>assoc :: Natty x -&gt; Natty y -&gt; proxy z -&gt; (x :+ y) :+ z :~: x :+ (y :+ z)</code> and I have singletons representing three natural numbers, I can just pass them in without first converting the third to a proxy."}], "tags": [], "owner": {"reputation": 44013, "user_id": 1477667, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/trgKM.jpg?s=128&g=1", "display_name": "dfeuer", "link": "https://stackoverflow.com/users/1477667/dfeuer"}, "is_accepted": true, "score": 5, "last_activity_date": 1463379990, "last_edit_date": 1463379990, "creation_date": 1463363305, "answer_id": 37245607, "question_id": 37245093, "link": "https://stackoverflow.com/questions/37245093/value-in-typeclass-without-type-variable-constraint/37245607#37245607", "title": "Value in typeclass without type variable constraint", "body": "<p>You have to add the type variable. The easiest way is to use a proxy:</p>\n\n<pre><code>  saveCollection :: proxy a -&gt; Text\n  -- Note the `proxy` is lower case\n\ninstance DatabaseType MyDB where\n  saveCollection _ = \"MyDB\"\n</code></pre>\n\n<p>Now to use it, you'll likely do this:</p>\n\n<pre><code>import Data.Proxy\n\nfoo = saveCollection (Proxy :: Proxy MyDB)\n</code></pre>\n\n<p>The reason for using lower case in the method declaration is convenience: you can use any value whose type has the right form instead of <code>Proxy MyDB</code>, if you happen to have one on hand at the call site.</p>\n\n<hr>\n\n<p>There are some situations where the standard proxy technique can lead to a problematic loss of sharing. This happens because results of function calls are not generally memoized. In this case, you can used a <em>tagged</em> type. <code>Data.Tagged</code> defines</p>\n\n<pre><code>newtype Tagged s b = Tagged {unTagged :: b}\n</code></pre>\n\n<p>Tagged types are much more awkward to work with than proxies, unless you use partial type signatures or explicit type application, two of GHC's most recently added features. If you wanted, though, you could write</p>\n\n<pre><code>saveCollection :: Tagged a Text\n</code></pre>\n\n<p>Then in the instance,</p>\n\n<pre><code>saveCollection = Tagged \"Hi there.\"\n</code></pre>\n\n<p>Using it directly would require something like</p>\n\n<pre><code>unTagged (saveCollection :: Tagged MyDB Text)\n</code></pre>\n\n<p>or, with partial type signatures,</p>\n\n<pre><code>unTagged (saveCollection :: Tagged MyDB _)\n</code></pre>\n\n<p>or with explicit type application <em>I think</em> something like</p>\n\n<pre><code>unTagged (saveCollection@MyDB)\n</code></pre>\n\n<p>Thanks to this awkwardness, the <code>tagged</code> package offers functions for converting between proxy-based and tagged representations.</p>\n"}], "owner": {"reputation": 1979, "user_id": 1757268, "user_type": "registered", "accept_rate": 88, "profile_image": "https://www.gravatar.com/avatar/1001c187fb680a13c262b47d9e7aa9bd?s=128&d=identicon&r=PG", "display_name": "NatureShade", "link": "https://stackoverflow.com/users/1757268/natureshade"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 229, "favorite_count": 0, "accepted_answer_id": 37245607, "answer_count": 1, "score": 2, "last_activity_date": 1463379990, "creation_date": 1463358111, "last_edit_date": 1463362300, "question_id": 37245093, "link": "https://stackoverflow.com/questions/37245093/value-in-typeclass-without-type-variable-constraint", "title": "Value in typeclass without type variable constraint", "body": "<p>I am working on a webapp using Happstack and I am writing some code to store my types in MongoDB. I felt like shortening my code some by putting the code into a typeclass so that I could use the same code to read and write to the database for different types. Something like this:</p>\n\n<pre><code>class DatabaseType a where\n    toDoc           :: a -&gt; Document\n    fromDoc         :: Document -&gt; a\n    saveCollection  :: Text\n    getFromDatabase :: (MonadIO m) =&gt; Pipe -&gt; Text -&gt; Value -&gt; m a\n    getFromDatabase pipe field value = ...\n    ...\n</code></pre>\n\n<p>Now the problem here is the <code>saveCollection</code>, since it doesn't use any of the type variables GHC won't let it compile, however it is very important to the database functions (like <code>getFromDatabase</code>) so that they know which collection to save to.</p>\n\n<p>Question is, how to have a value in a typeclass that is not bonded by the type variables.</p>\n"}, {"tags": ["haskell", "typeclass"], "comments": [{"owner": {"reputation": 14781, "user_id": 630160, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/4445f21326af525a8ad19af7e3ae41a8?s=128&d=identicon&r=PG", "display_name": "epsilonhalbe", "link": "https://stackoverflow.com/users/630160/epsilonhalbe"}, "edited": false, "score": 1, "creation_date": 1463351554, "post_id": 37244341, "comment_id": 62017610, "body": "There is nothing wrong with your solution - it is but one of many possibles solutions to that type signature"}, {"owner": {"reputation": 100892, "user_id": 745903, "user_type": "registered", "accept_rate": 74, "profile_image": "https://www.gravatar.com/avatar/50933f6638836741e620669b3940410e?s=128&d=identicon&r=PG", "display_name": "leftaroundabout", "link": "https://stackoverflow.com/users/745903/leftaroundabout"}, "edited": false, "score": 2, "creation_date": 1463351863, "post_id": 37244341, "comment_id": 62017695, "body": "Well, it is very certainly not <i>the intended solution</i>. Not only do you not use some arithmetic operation, you just completely ignore the integer argument. What the intended solution could actually be I&#39;m less than sure myself; there really are plenty of completely different possible approaches."}, {"owner": {"reputation": 7105, "user_id": 236007, "user_type": "registered", "accept_rate": 90, "profile_image": "https://i.stack.imgur.com/BiYes.jpg?s=128&g=1", "display_name": "Emre Sevin&#231;", "link": "https://stackoverflow.com/users/236007/emre-sevin%c3%a7"}, "edited": false, "score": 0, "creation_date": 1463352454, "post_id": 37244341, "comment_id": 62017840, "body": "The book says &quot;you\u2019re trying to fill in terms (code) which\u2019ll fit the type. The idea with these exercises is that you\u2019ll derive the implementation from the type information. You\u2019ll probably need to use stuff from Prelude.&quot; So my understanding is that the type signature must strongly constrain my solution and guide me towards an implementation, it&#39;s just that I&#39;m a little stuck as to what other concrete implementation I can come up with :("}, {"owner": {"reputation": 100892, "user_id": 745903, "user_type": "registered", "accept_rate": 74, "profile_image": "https://www.gravatar.com/avatar/50933f6638836741e620669b3940410e?s=128&d=identicon&r=PG", "display_name": "leftaroundabout", "link": "https://stackoverflow.com/users/745903/leftaroundabout"}, "edited": false, "score": 3, "creation_date": 1463353628, "post_id": 37244341, "comment_id": 62018098, "body": "Indeed it&#39;s often possible to derive an implementation from type information, but this is not really a good example \u2013 <code>Num</code> is just a way too vague, and with an <code>Integer</code> you can do <i>anything</i>. I really think they should reconsider that exercise."}, {"owner": {"reputation": 384463, "user_id": 1126841, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/fa05233b2357f8d11c22ef4cfc7bb85c?s=128&d=identicon&r=PG", "display_name": "chepner", "link": "https://stackoverflow.com/users/1126841/chepner"}, "edited": false, "score": 2, "creation_date": 1463355201, "post_id": 37244341, "comment_id": 62018425, "body": "As a specific example, you could apply <code>(+)</code> to both the <code>Integer</code> argument and <code>f x</code>, since both values have types that are instances of <code>Num</code>. There isn&#39;t a <i>right</i> answer, just lots and lots of <i>valid</i> answers."}, {"owner": {"reputation": 5171, "user_id": 2718186, "user_type": "registered", "accept_rate": 87, "profile_image": "https://www.gravatar.com/avatar/ca44ca18bf615e74f930d28a89d01508?s=128&d=identicon&r=PG", "display_name": "MicroVirus", "link": "https://stackoverflow.com/users/2718186/microvirus"}, "reply_to_user": {"reputation": 100892, "user_id": 745903, "user_type": "registered", "accept_rate": 74, "profile_image": "https://www.gravatar.com/avatar/50933f6638836741e620669b3940410e?s=128&d=identicon&r=PG", "display_name": "leftaroundabout", "link": "https://stackoverflow.com/users/745903/leftaroundabout"}, "edited": false, "score": 2, "creation_date": 1463355289, "post_id": 37244341, "comment_id": 62018444, "body": "@leftaroundabout I&#39;m not sure I entirely agree that <code>Num</code> is too vague. It&#39;s rather &#39;strong&#39; in a way, namely that what you can do with <code>b</code> just being <code>Num</code> is very limited. <code>Num</code> has a <code>fromInteger</code>, which connects the <code>Integer</code> parameter to <code>b</code>, and then there&#39;s three binary operations, <code>+, -, *</code> that can then be used."}, {"owner": {"reputation": 2831, "user_id": 183792, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/9ddcfbc6c31012fd25384f6301363347?s=128&d=identicon&r=PG&f=1", "display_name": "Michael", "link": "https://stackoverflow.com/users/183792/michael"}, "edited": false, "score": 1, "creation_date": 1463361223, "post_id": 37244341, "comment_id": 62019592, "body": "Emre Here is a clue. Call the function &quot;rescale&quot; and think of the first argument f as somehow eg measuring an &quot;a&quot;"}, {"owner": {"reputation": 126897, "user_id": 791604, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/ce991df7a056248d5e4f6fc3659ba733?s=128&d=identicon&r=PG", "display_name": "Daniel Wagner", "link": "https://stackoverflow.com/users/791604/daniel-wagner"}, "edited": false, "score": 3, "creation_date": 1463367350, "post_id": 37244341, "comment_id": 62020735, "body": "@EmreSevin&#231; You may enjoy making the exercise harder by imposing an extra restriction on yourself: use all the arguments on the right-hand side of the equals sign. (Your current solution ignores the second argument. There are other solutions that ignore other arguments -- a followup exercise might be to try to find some of these as well.) Overall I think this particular exercise is too vague to be a good one -- exactly because of the kind of confusion you&#39;re feeling right now. It&#39;s not you; it&#39;s the book."}], "answers": [{"comments": [{"owner": {"reputation": 7105, "user_id": 236007, "user_type": "registered", "accept_rate": 90, "profile_image": "https://i.stack.imgur.com/BiYes.jpg?s=128&g=1", "display_name": "Emre Sevin&#231;", "link": "https://stackoverflow.com/users/236007/emre-sevin%c3%a7"}, "edited": false, "score": 0, "creation_date": 1463401197, "post_id": 37245215, "comment_id": 62034995, "body": "Thank you and all the other commentators above for shedding light that made my understanding stronger. PS: I&#39;ve also dabbled with <code>fromInteger</code> for sometime while trying to come up with a solution, but somehow was still confused, having spent even more time together with all the comments above was really helpful!"}], "tags": [], "owner": {"reputation": 3946, "user_id": 6231376, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/cea33b55396be93411ade85021f41b01?s=128&d=identicon&r=PG&f=1", "display_name": "TeWu", "link": "https://stackoverflow.com/users/6231376/tewu"}, "is_accepted": true, "score": 7, "last_activity_date": 1500725299, "last_edit_date": 1500725299, "creation_date": 1463359349, "answer_id": 37245215, "question_id": 37244341, "link": "https://stackoverflow.com/questions/37244341/how-to-interpret-this-haskell-code-that-type-checks/37245215#37245215", "title": "How to interpret this Haskell code that type checks?", "body": "<p>I think the <em>intended solution</em> is:</p>\n\n<pre><code>arith f i a = f a + fromInteger i\n</code></pre>\n\n<p>Or one with <code>+</code> replaced by <code>-</code> or <code>*</code>.</p>\n\n<p><strong>To recap the requirements:</strong> In this exercise you have to implement a function that:</p>\n\n<ol>\n<li><p>Matches type signature <code>arith :: Num b =&gt; (a -&gt; b) -&gt; Integer -&gt; a -&gt; b</code>.</p></li>\n<li><p>Uses arithmetic operation to combine values of type <code>b</code>.</p></li>\n</ol>\n\n<p>You are given three values of types <code>(a -&gt; b)</code>, <code>Integer</code> and <code>a</code>. As a first step you need to convert them to two values of type <code>b</code>. You can get first one by applying <code>(a -&gt; b)</code> to <code>a</code>. Then you are left with value of type <code>Integer</code>. When you <a href=\"http://hackage.haskell.org/package/base-4.8.2.0/docs/Prelude.html#t:Num\" rel=\"nofollow noreferrer\">notice</a> that instances of typeclass <code>Num</code> support function <code>fromInteger :: Integer -&gt; a</code> (where type <code>a</code> is type <code>b</code> in context of function we are defining), it becomes clear that you can obtain second value of type <code>b</code> by applying <code>fromInteger</code> to your <code>Integer</code> value. As a second step you combine two values of type <code>b</code> using one of arithmetic operations defined in <code>Num</code> typeclass.</p>\n"}], "owner": {"reputation": 7105, "user_id": 236007, "user_type": "registered", "accept_rate": 90, "profile_image": "https://i.stack.imgur.com/BiYes.jpg?s=128&g=1", "display_name": "Emre Sevin&#231;", "link": "https://stackoverflow.com/users/236007/emre-sevin%c3%a7"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 165, "favorite_count": 0, "accepted_answer_id": 37245215, "answer_count": 1, "score": 4, "last_activity_date": 1500725299, "creation_date": 1463351297, "last_edit_date": 1463352599, "question_id": 37244341, "link": "https://stackoverflow.com/questions/37244341/how-to-interpret-this-haskell-code-that-type-checks", "title": "How to interpret this Haskell code that type checks?", "body": "<p>Studying the book <a href=\"http://www.haskellbook.com/\" rel=\"nofollow\">Haskell Programming from First Principles</a>, I've come across the following exercise in Chapter 6, \"Typeclasses\":</p>\n\n<pre><code>-- Hint: use some arithmetic operation to\n-- combine values of type 'b'. Pick one.\narith :: Num b =&gt; (a -&gt; b) -&gt; Integer -&gt; a -&gt; b\narith = ???\n</code></pre>\n\n<p>I have come up with the following solution, and I call it a 'solution' because it compiles:</p>\n\n<pre><code>arith f _ x = f x\n</code></pre>\n\n<p>But I'm somewhat confused how to 'interpret' what I've just written above. My 'reading' of the type signature of <code>arith</code> is something like the following:</p>\n\n<blockquote>\n  <p><code>arith</code> takes one function, one <code>Integer</code>, a parameter of type <code>a</code>,\n  and returns a result that is of type <code>b</code>; moreover, the function that\n  <code>arith</code> takes as the first parameter is a function that takes a\n  parameter of type <code>a</code> and returns a value of type <code>b</code>, and that value\n  has to be of type <code>b</code> whose typeclass is (or 'constrained') by <code>Num</code>.</p>\n</blockquote>\n\n<p>and after that, I came up with the 'solution' above but I haven't used \"some arithmetic operation to combine values of type 'b'\". Somehow I think either the 'hint' is misleading, or it is perfectly fine, and I'm missing something, if that's the case, then what am I missing?</p>\n"}, {"tags": ["haskell", "vector", "algebraic-data-types"], "comments": [{"owner": {"reputation": 45534, "user_id": 106104, "user_type": "registered", "accept_rate": 62, "profile_image": "https://www.gravatar.com/avatar/c88b9310b92a937108ec4336c2832f92?s=128&d=identicon&r=PG", "display_name": "user253751", "link": "https://stackoverflow.com/users/106104/user253751"}, "edited": false, "score": 2, "creation_date": 1463349579, "post_id": 37243970, "comment_id": 62017107, "body": "<code>data MaybeCharMatrix = Nothing | CharMatrix</code> - here CharMatrix is a constructor AFAIK, <b>not</b> the type that&#39;s also called <code>CharMatrix</code>."}], "answers": [{"comments": [{"owner": {"reputation": 663, "user_id": 2930101, "user_type": "registered", "accept_rate": 52, "profile_image": "https://i.stack.imgur.com/UYXdd.png?s=128&g=1", "display_name": "OneEyeQuestion", "link": "https://stackoverflow.com/users/2930101/oneeyequestion"}, "edited": false, "score": 0, "creation_date": 1463349283, "post_id": 37244012, "comment_id": 62017024, "body": "It&#39;s my fault. The question is a simplified case of what I want. It was just an example of the concept. I would like to be able is to implement the concept behind the question (for learning purposes). Sorry if it wasn&#39;t clear enough."}], "tags": [], "owner": {"reputation": 49959, "user_id": 866915, "user_type": "registered", "accept_rate": 70, "profile_image": "https://www.gravatar.com/avatar/09242131d6e17cbbe31e8547514da6e5?s=128&d=identicon&r=PG", "display_name": "ErikR", "link": "https://stackoverflow.com/users/866915/erikr"}, "is_accepted": true, "score": 3, "last_activity_date": 1463349387, "last_edit_date": 1463349387, "creation_date": 1463348959, "answer_id": 37244012, "question_id": 37243970, "link": "https://stackoverflow.com/questions/37243970/how-to-create-a-a-maybe-equivalent-for-vectors-of-vectors/37244012#37244012", "title": "How to create a a Maybe equivalent for vectors of vectors?", "body": "<p>How about using:</p>\n\n<pre><code>type MaybeCharMatrix = Maybe CharMatrix\n\ntest :: MaybeCharMatrix -&gt; Int\ntest Nothing = -1\ntest (Just matrix) = ...\n</code></pre>\n\n<p>This doesn't allow you to create your own custom Show instance, so here's another option:</p>\n\n<pre><code>newtype MaybeCharMatrix = MCM (Maybe CharMatrix)\n\ntest :: MaybeCharMatrix -&gt; Int\ntest (MCM Nothing) = -1\ntest (MCM (Just matrix)) = ...some function of matrix...\n\ninstance Show (MaybeCharMatrix) where\n    show (MCM Nothing) = \"the nothing string\"\n    show (MCM (Just matrix)) = ... \"Cols: \" ++ show (cols matrix) ++ ...\n</code></pre>\n\n<p>I think you're better off just using the <code>type</code> alias (first option). Then you can use all of the functions which operate on Maybe values directly.</p>\n\n<p><code>show</code> is best used for a Haskell representation of the value - i.e. it should be a valid Haskell expression. If you want a custom rendering of the value, just use a different name for the rendering function - e.g. <code>dumpMatrix</code>.</p>\n\n<p><strong>Update</strong></p>\n\n<p>based on your comment you need something like:</p>\n\n<pre><code>data MaybeCharMatrix = MyNothing | MyJust CharMatrix\n\ntest :: MaybeCharMatrx -&gt; Int\ntest MyNothing = -1\ntest (MyJust matrix) = ... can use matrix here ...\n\ninstance Show MaybeCharMatrix where\n  show MyNothing = \"my nothing\"\n  show (MyJust matrix) = \"... Cols: \" ++ show (cols matrix) ++ ...\n</code></pre>\n"}, {"comments": [{"owner": {"reputation": 663, "user_id": 2930101, "user_type": "registered", "accept_rate": 52, "profile_image": "https://i.stack.imgur.com/UYXdd.png?s=128&g=1", "display_name": "OneEyeQuestion", "link": "https://stackoverflow.com/users/2930101/oneeyequestion"}, "edited": false, "score": 0, "creation_date": 1463350679, "post_id": 37244122, "comment_id": 62017390, "body": "Would also accept your answer but the other guy answered first. Sorry."}], "tags": [], "owner": {"reputation": 2513, "user_id": 4725625, "user_type": "registered", "accept_rate": 70, "profile_image": "https://i.stack.imgur.com/YwH49.png?s=128&g=1", "display_name": "Kwarrtz", "link": "https://stackoverflow.com/users/4725625/kwarrtz"}, "is_accepted": false, "score": 3, "last_activity_date": 1463349634, "creation_date": 1463349634, "answer_id": 37244122, "question_id": 37243970, "link": "https://stackoverflow.com/questions/37243970/how-to-create-a-a-maybe-equivalent-for-vectors-of-vectors/37244122#37244122", "title": "How to create a a Maybe equivalent for vectors of vectors?", "body": "<p>Your issue is with the data type declaration. In general, type declarations are of the form.</p>\n\n<pre><code>data &lt;type&gt; &lt;args&gt; = &lt;constructor 1&gt; &lt;args&gt;\n                   | &lt;constructor 2&gt; &lt;args&gt;\n                   | ...\n                   | &lt;constructor n&gt; &lt;args&gt;\n</code></pre>\n\n<p>In otherwords, the first expression in each clause of the data declaration is taken to be the data constructor. So, when you used your data type.</p>\n\n<pre><code>data MaybeCharMatrix = Nothing | CharMatrix\n</code></pre>\n\n<p>Haskell treats <code>CharMatrix</code> as a data constructor not a type. Your definition of <code>Nothing</code> also conflicts with the standard library defintion, so you should change its name. What you really want is something like this.</p>\n\n<pre><code>data MaybeCharMatrix = NothingCM | JustCM CharMatrix\n</code></pre>\n\n<p>That creates a data constructor <code>JustCM</code> which takes a <code>CharMatrix</code> as its argument. Then, you can pattern match like this.</p>\n\n<pre><code>test :: MaybeCharMatrix -&gt; Int\ntest NothingCM = -1\ntest (JustCM mat) = &lt;code&gt;\n\ninstance Show MaybeCharMatrix where\n    show NothingCM = \"\"\n    show (JustCM mat) = \"Cols: \" ++ cols mat ++ \", Rows: \" ++ rows mat\n</code></pre>\n"}], "owner": {"reputation": 663, "user_id": 2930101, "user_type": "registered", "accept_rate": 52, "profile_image": "https://i.stack.imgur.com/UYXdd.png?s=128&g=1", "display_name": "OneEyeQuestion", "link": "https://stackoverflow.com/users/2930101/oneeyequestion"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 67, "favorite_count": 0, "accepted_answer_id": 37244012, "answer_count": 2, "score": 1, "last_activity_date": 1463349634, "creation_date": 1463348633, "question_id": 37243970, "link": "https://stackoverflow.com/questions/37243970/how-to-create-a-a-maybe-equivalent-for-vectors-of-vectors", "title": "How to create a a Maybe equivalent for vectors of vectors?", "body": "<p>I am trying to get this to work:</p>\n\n<pre><code>type CharVector = V.Vector Char\ntype CharMatrix = V.Vector CharVector\n\ndata MaybeCharMatrix =\n  Nothing\n  | CharMatrix\n</code></pre>\n\n<p>But I am unable to do the following things:</p>\n\n<p>1) Pattern matching</p>\n\n<pre><code>test :: MaybeCharMatrix -&gt; Int\ntest Nothing = -1 -- Doesn't matter, is just to illustrate\ntest &lt;something&gt; = ? -- Somehow be able to do: cols &lt;something&gt; * rows \n</code></pre>\n\n<p></p>\n\n<p>2) Deriving show instance:</p>\n\n<pre><code>instance Show MaybeCharMatrix where\n  show Nothing = \"\"\n  show &lt;something&gt; = \"Cols: \" ++ cols &lt;something&gt; ++ \", Rows: \" ++ rows &lt;something&gt;\n</code></pre>\n\n<p>How can this be achieved? Are there other efficient ways to do it?</p>\n"}, {"tags": ["haskell", "vector"], "answers": [{"tags": [], "owner": {"reputation": 49959, "user_id": 866915, "user_type": "registered", "accept_rate": 70, "profile_image": "https://www.gravatar.com/avatar/09242131d6e17cbbe31e8547514da6e5?s=128&d=identicon&r=PG", "display_name": "ErikR", "link": "https://stackoverflow.com/users/866915/erikr"}, "is_accepted": false, "score": 1, "last_activity_date": 1463346628, "creation_date": 1463346628, "answer_id": 37243713, "question_id": 37243638, "link": "https://stackoverflow.com/questions/37243638/creating-a-random-permutation-of-1-n-with-data-vector-unboxed-mutable/37243713#37243713", "title": "Creating a random permutation of 1..N with Data.Vector.Unboxed.Mutable", "body": "<p>I would try (note update at end):</p>\n\n<pre><code>import Control.Monad\n\nrandVector :: Int -&gt; IO (VU.Vector Int)\nrandVector n = do\n  vector &lt;- VU.unsafeThaw $ VU.enumFromN 1 n\n  forM_ [2..VUM.length vector] $ \\i -&gt; do\n    j &lt;- randomRIO(0, i) :: IO Int\n    VUM.swap vector i j\n  return $ VU.unsafeFreeze vector\n</code></pre>\n\n<p>Edit: as @Andr\u00e1s Kov\u00e1cs pointed out, you don't want the <code>return</code> at the end so the last line should be:</p>\n\n<pre><code>  VU.unsafeFreeze vector\n</code></pre>\n"}, {"comments": [{"owner": {"reputation": 2185, "user_id": 4129091, "user_type": "registered", "accept_rate": 80, "profile_image": "https://www.gravatar.com/avatar/0f8076e78a95ed50b9ffbed42849d80e?s=128&d=identicon&r=PG&f=1", "display_name": "tsorn", "link": "https://stackoverflow.com/users/4129091/tsorn"}, "edited": false, "score": 0, "creation_date": 1463347083, "post_id": 37243718, "comment_id": 62016416, "body": "That did the trick! The return statement was the problem. How come using return nested the vector? I would never have figured that out. I used <code>VU.forM_</code> instead of the plain version because I was unsure where the plain version was to be found. Typical input size is n=50 and building 5000 randVectors, I can&#39;t imagine the different for-loops will be many seconds different."}, {"owner": {"reputation": 28873, "user_id": 1068232, "user_type": "registered", "accept_rate": 79, "profile_image": "https://www.gravatar.com/avatar/2a0a145ce58c20013969fe3f203531da?s=128&d=identicon&r=PG", "display_name": "Andr&#225;s Kov&#225;cs", "link": "https://stackoverflow.com/users/1068232/andr%c3%a1s-kov%c3%a1cs"}, "reply_to_user": {"reputation": 2185, "user_id": 4129091, "user_type": "registered", "accept_rate": 80, "profile_image": "https://www.gravatar.com/avatar/0f8076e78a95ed50b9ffbed42849d80e?s=128&d=identicon&r=PG&f=1", "display_name": "tsorn", "link": "https://stackoverflow.com/users/4129091/tsorn"}, "edited": false, "score": 0, "creation_date": 1463347313, "post_id": 37243718, "comment_id": 62016497, "body": "I added a comment on the <code>forM_</code> bounds and edited the bit on <code>forM_</code> performance."}], "tags": [], "owner": {"reputation": 28873, "user_id": 1068232, "user_type": "registered", "accept_rate": 79, "profile_image": "https://www.gravatar.com/avatar/2a0a145ce58c20013969fe3f203531da?s=128&d=identicon&r=PG", "display_name": "Andr&#225;s Kov&#225;cs", "link": "https://stackoverflow.com/users/1068232/andr%c3%a1s-kov%c3%a1cs"}, "is_accepted": true, "score": 3, "last_activity_date": 1463347565, "last_edit_date": 1463347565, "creation_date": 1463346640, "answer_id": 37243718, "question_id": 37243638, "link": "https://stackoverflow.com/questions/37243638/creating-a-random-permutation-of-1-n-with-data-vector-unboxed-mutable/37243718#37243718", "title": "Creating a random permutation of 1..N with Data.Vector.Unboxed.Mutable", "body": "<p><code>unsafeFreeze vector</code> already returns <code>IO (VU.Vector Int)</code>. Just change the last line to <code>VU.unsafeFreeze vector</code>.</p>\n\n<p>On another note, you should iterate until <code>VUM.length vector - 1</code>, since both <code>[x .. y]</code> and <code>randomRIO</code> use inclusive ranges. Also, you can use plain <code>forM_</code> here for iteration, since you only care about side effects.</p>\n\n<pre><code>import           Control.Monad\nimport qualified Data.Vector.Unboxed         as VU\nimport qualified Data.Vector.Unboxed.Mutable as VUM\nimport           System.Random\n\nrandVector :: Int -&gt; IO (VU.Vector Int)\nrandVector n = do\n  vector &lt;- VU.unsafeThaw $ VU.enumFromN 1 n\n  forM_ [2..VUM.length vector - 1] $ \\i -&gt; do\n    j &lt;- randomRIO(0, i) :: IO Int\n    VUM.swap vector i j\n  VU.unsafeFreeze vector\n</code></pre>\n\n<p>I looked at the generated code, and it seems that with GHC 7.10.3 <code>forM_</code> compiles to an efficient loop while <code>VU.forM_</code> retains the intermediate list and is surely significantly slower (which was my expected outcome for <code>forM_</code>, but I was unsure about <code>VU.forM_</code>).</p>\n"}], "owner": {"reputation": 2185, "user_id": 4129091, "user_type": "registered", "accept_rate": 80, "profile_image": "https://www.gravatar.com/avatar/0f8076e78a95ed50b9ffbed42849d80e?s=128&d=identicon&r=PG&f=1", "display_name": "tsorn", "link": "https://stackoverflow.com/users/4129091/tsorn"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 82, "favorite_count": 0, "accepted_answer_id": 37243718, "answer_count": 2, "score": 3, "last_activity_date": 1463347565, "creation_date": 1463346108, "question_id": 37243638, "link": "https://stackoverflow.com/questions/37243638/creating-a-random-permutation-of-1-n-with-data-vector-unboxed-mutable", "title": "Creating a random permutation of 1..N with Data.Vector.Unboxed.Mutable", "body": "<p>I want to create a list containing a random permutation of the numbers 1 through N. As I understand it, it is possible to use <code>VUM.swap</code> in the runST, but since I need random numbers as well I figured I might do both in the IO monad.</p>\n\n<p>The code below yields: </p>\n\n<blockquote>\n  <p>Expected type: IO (VU.Vector Int), Actual type: IO (VU.Vector\n  (VU.Vector a0))</p>\n</blockquote>\n\n<p>for the return statement. </p>\n\n<pre><code>import qualified Data.Vector.Unboxed         as VU\nimport qualified Data.Vector.Unboxed.Mutable as VUM\nimport           System.Random\n\nrandVector :: Int -&gt; IO (VU.Vector Int)\nrandVector n = do\n  vector &lt;- VU.unsafeThaw $ VU.enumFromN 1 n\n  VU.forM_ (VU.fromList [2..VUM.length vector]) $ \\i -&gt; do\n    j &lt;- randomRIO(0, i) :: IO Int\n    VUM.swap vector i j\n  return $ VU.unsafeFreeze vector\n</code></pre>\n\n<p>I'm not quite sure why the return vector is nested. Do I have to use <code>VU.fold1M_</code> instead?</p>\n"}, {"tags": ["user-interface", "haskell", "cabal", "gloss"], "comments": [{"owner": {"reputation": 8047, "user_id": 565879, "user_type": "registered", "accept_rate": 81, "profile_image": "https://www.gravatar.com/avatar/de9dab7c27809643dc51c5193d58429c?s=128&d=identicon&r=PG", "display_name": "Buttons840", "link": "https://stackoverflow.com/users/565879/buttons840"}, "edited": false, "score": 0, "creation_date": 1476158772, "post_id": 37243467, "comment_id": 67219995, "body": "I am the author of that tic tac toe game. I have updated it so you can build it using stack."}], "answers": [{"comments": [{"owner": {"reputation": 25, "user_id": 6338205, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/dc04992a7b216cb63dba8bfbccc4856f?s=128&d=identicon&r=PG&f=1", "display_name": "Bill Jobs", "link": "https://stackoverflow.com/users/6338205/bill-jobs"}, "edited": false, "score": 0, "creation_date": 1463345518, "post_id": 37243530, "comment_id": 62015966, "body": "This returns the same output as cabal run Package has never been configured. Configuring with default flags. If this fails, please run configure manually. Resolving dependencies... Configuring gloss-tic-tac-toe-0.1.0.0... cabal: At least the following dependencies are missing: base ==4.7.*, gloss &gt;=1.9.2.1 &amp;&amp; &lt;1.10"}, {"owner": {"reputation": 49959, "user_id": 866915, "user_type": "registered", "accept_rate": 70, "profile_image": "https://www.gravatar.com/avatar/09242131d6e17cbbe31e8547514da6e5?s=128&d=identicon&r=PG", "display_name": "ErikR", "link": "https://stackoverflow.com/users/866915/erikr"}, "reply_to_user": {"reputation": 25, "user_id": 6338205, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/dc04992a7b216cb63dba8bfbccc4856f?s=128&d=identicon&r=PG&f=1", "display_name": "Bill Jobs", "link": "https://stackoverflow.com/users/6338205/bill-jobs"}, "edited": false, "score": 0, "creation_date": 1463345743, "post_id": 37243530, "comment_id": 62016031, "body": "What&#39;s your Haskell Platform version? If <code>base</code> cannot be satisfied it usually means that your Haskell Platform version isn&#39;t compatible with the restrictions set forth in the .cabal file."}, {"owner": {"reputation": 25, "user_id": 6338205, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/dc04992a7b216cb63dba8bfbccc4856f?s=128&d=identicon&r=PG&f=1", "display_name": "Bill Jobs", "link": "https://stackoverflow.com/users/6338205/bill-jobs"}, "edited": false, "score": 0, "creation_date": 1463346002, "post_id": 37243530, "comment_id": 62016116, "body": "ghc --version The Glorious Glasgow Haskell Compilation System, version 7.10.3 and in the cabal file:  build-depends:       base       &gt;= 4.7     &amp;&amp; &lt; 4.8,                        gloss      &gt;= 1.9.2.1 &amp;&amp; &lt; 1.10,                        containers &gt;= 0.5.5.1   &amp;&amp; &lt; 5.6"}, {"owner": {"reputation": 62421, "user_id": 216164, "user_type": "registered", "accept_rate": 89, "profile_image": "https://www.gravatar.com/avatar/786f224adbe0784cdf7d0f15476061fe?s=128&d=identicon&r=PG", "display_name": "Thomas M. DuBuisson", "link": "https://stackoverflow.com/users/216164/thomas-m-dubuisson"}, "edited": false, "score": 0, "creation_date": 1463346852, "post_id": 37243530, "comment_id": 62016361, "body": "The &#39;base&#39; package version specified in the .cabal basically says you need an old version of GHC.  This is probably arbitrary and can be safely changes to <code>base &lt; 5</code> then build the package."}], "tags": [], "owner": {"reputation": 49959, "user_id": 866915, "user_type": "registered", "accept_rate": 70, "profile_image": "https://www.gravatar.com/avatar/09242131d6e17cbbe31e8547514da6e5?s=128&d=identicon&r=PG", "display_name": "ErikR", "link": "https://stackoverflow.com/users/866915/erikr"}, "is_accepted": true, "score": 0, "last_activity_date": 1463347054, "last_edit_date": 1463347054, "creation_date": 1463345342, "answer_id": 37243530, "question_id": 37243467, "link": "https://stackoverflow.com/questions/37243467/run-haskell-gloss-gui-using-cabal/37243530#37243530", "title": "Run haskell gloss GUI using cabal", "body": "<p>Update:</p>\n\n<p>Here's what I did to get it to compile:</p>\n\n<ol>\n<li>First run <code>cabal install gloss-examples</code></li>\n</ol>\n\n<p>It will take a while as it will install a lot of dependencies. These dependencies are also needed for the tic-tac-toe program.</p>\n\n<ol start=\"2\">\n<li><p>Then do this:</p>\n\n<p>git clone <a href=\"https://github.com/DevJac/gloss-tic-tac-toe\" rel=\"nofollow\">https://github.com/DevJac/gloss-tic-tac-toe</a>\ncd gloss-tic-tac-toe</p></li>\n</ol>\n\n<p>and change the build-depends stanza in the .cabal file to read:</p>\n\n<pre><code>  build-depends:       base       &gt;= 4.7,\n                       gloss      &gt;= 1.9.2.1,\n                       containers &gt;= 0.5.5.1\n</code></pre>\n\n<p>Basically just remove all upper bounds.</p>\n\n<ol start=\"3\">\n<li><p>Run <code>cabal build</code></p></li>\n<li><p>If the build succeeds, run the executable:</p>\n\n<pre><code>./dist/build/gloss-tic-tac-toe/gloss-tic-tac-toe\n</code></pre></li>\n</ol>\n"}, {"comments": [{"owner": {"reputation": 25, "user_id": 6338205, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/dc04992a7b216cb63dba8bfbccc4856f?s=128&d=identicon&r=PG&f=1", "display_name": "Bill Jobs", "link": "https://stackoverflow.com/users/6338205/bill-jobs"}, "edited": false, "score": 0, "creation_date": 1463347298, "post_id": 37243683, "comment_id": 62016495, "body": "stack exec -- gloss-tic-tac-toe Run from outside a project, using implicit global project config Using resolver: lts-5.17 from implicit global project&#39;s config file: C:\\Users\\Rares\\AppData\\Roaming\\stack\\global-project\\stack.ya&zwnj;&#8203;ml Executable named gloss-tic-tac-toe not found on path: (my system path variable)"}, {"owner": {"reputation": 14781, "user_id": 630160, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/4445f21326af525a8ad19af7e3ae41a8?s=128&d=identicon&r=PG", "display_name": "epsilonhalbe", "link": "https://stackoverflow.com/users/630160/epsilonhalbe"}, "reply_to_user": {"reputation": 25, "user_id": 6338205, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/dc04992a7b216cb63dba8bfbccc4856f?s=128&d=identicon&r=PG&f=1", "display_name": "Bill Jobs", "link": "https://stackoverflow.com/users/6338205/bill-jobs"}, "edited": false, "score": 0, "creation_date": 1463347407, "post_id": 37243683, "comment_id": 62016532, "body": "you are doing the <code>stack exec ..</code> inside the cloned <code>gloss-tic-tac-toe</code> folder?"}], "tags": [], "owner": {"reputation": 14781, "user_id": 630160, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/4445f21326af525a8ad19af7e3ae41a8?s=128&d=identicon&r=PG", "display_name": "epsilonhalbe", "link": "https://stackoverflow.com/users/630160/epsilonhalbe"}, "is_accepted": false, "score": 0, "last_activity_date": 1463346400, "creation_date": 1463346400, "answer_id": 37243683, "question_id": 37243467, "link": "https://stackoverflow.com/questions/37243467/run-haskell-gloss-gui-using-cabal/37243683#37243683", "title": "Run haskell gloss GUI using cabal", "body": "<p>It seems you are quite new to haskell so it is best to install <a href=\"http://docs.haskellstack.org/en/stable/README/\" rel=\"nofollow\">stack</a>.</p>\n\n<p>Then after the <code>git clone https://github.com/DevJac/gloss-tic-tac-toe</code> it is best to make the following changes to the downloaded source:</p>\n\n<p>Delete the <code>libsrc</code> folder you won't need it, replace the build depends section of <code>gloss-tic-tac-toe.cabal</code> file with the following:</p>\n\n<pre><code>  build-depends:       base       &gt;= 4.8     &amp;&amp; &lt; 4.9\n               ,       gloss\n               ,       containers\n</code></pre>\n\n<p>and add the new file <code>stack.yaml</code></p>\n\n<pre><code>resolver: lts-5.17\npackages:\n- '.'\nextra-deps:\n- gloss-1.10.1.1\n- gloss-rendering-1.10.1.1\nflags: {}\nextra-package-dbs: []\n</code></pre>\n\n<p>This is the full configuration you need - then running</p>\n\n<pre><code>$ &gt; stack build\n... (might take some time)\n$ &gt; stack exec -- gloss-tic-tac-toe\n</code></pre>\n\n<p>will run the game and you can play!</p>\n"}], "owner": {"reputation": 25, "user_id": 6338205, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/dc04992a7b216cb63dba8bfbccc4856f?s=128&d=identicon&r=PG&f=1", "display_name": "Bill Jobs", "link": "https://stackoverflow.com/users/6338205/bill-jobs"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 382, "favorite_count": 0, "accepted_answer_id": 37243530, "answer_count": 2, "score": 1, "last_activity_date": 1463347054, "creation_date": 1463344892, "question_id": 37243467, "link": "https://stackoverflow.com/questions/37243467/run-haskell-gloss-gui-using-cabal", "title": "Run haskell gloss GUI using cabal", "body": "<p>I am new to haskell and I want to learn how to create GUIs using the haskell platform. I found this tic tac toe example but I can't seem to figure it out how to run it.</p>\n\n<p><a href=\"https://github.com/DevJac/gloss-tic-tac-toe\" rel=\"nofollow\">https://github.com/DevJac/gloss-tic-tac-toe</a></p>\n\n<p>I runned Setup.hs, it compiled but nothing happend. Tried cabal run and this is the output:</p>\n\n<p>Package has never been configured. Configuring with default flags. If this\nfails, please run configure manually.\nResolving dependencies...\nConfiguring gloss-tic-tac-toe-0.1.0.0...\ncabal: At least the following dependencies are missing:\nbase ==4.7.*, gloss >=1.9.2.1 &amp;&amp; &lt;1.10</p>\n\n<p>Any ideas?</p>\n"}, {"tags": ["list", "haskell", "recursion", "fibonacci", "infinite"], "comments": [{"owner": {"reputation": 314794, "user_id": 67579, "user_type": "registered", "accept_rate": 81, "profile_image": "https://i.stack.imgur.com/BJXub.png?s=128&g=1", "display_name": "Willem Van Onsem", "link": "https://stackoverflow.com/users/67579/willem-van-onsem"}, "edited": false, "score": 0, "creation_date": 1463344819, "post_id": 37243102, "comment_id": 62015767, "body": "In two words <i>lazy programming</i>."}], "answers": [{"comments": [{"owner": {"reputation": 172, "user_id": 4932965, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/30dd676072dec501db6881c9dd4ac970?s=128&d=identicon&r=PG&f=1", "display_name": "Razvan Meriniuc", "link": "https://stackoverflow.com/users/4932965/razvan-meriniuc"}, "edited": false, "score": 0, "creation_date": 1463344102, "post_id": 37243269, "comment_id": 62015540, "body": "Could you please explain how the function I have provided works for the first few calls? When does it decide to stop calling itself and compute the result? What happens to <code>zipWith (+) fib (tail fib)</code> at the last call? The function simply returns 0:1:[]?"}, {"owner": {"reputation": 40537, "user_id": 465378, "user_type": "registered", "accept_rate": 85, "profile_image": "https://www.gravatar.com/avatar/c03b8d34978563858020eff0d14cc17b?s=128&d=identicon&r=PG", "display_name": "Alexis King", "link": "https://stackoverflow.com/users/465378/alexis-king"}, "reply_to_user": {"reputation": 172, "user_id": 4932965, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/30dd676072dec501db6881c9dd4ac970?s=128&d=identicon&r=PG&f=1", "display_name": "Razvan Meriniuc", "link": "https://stackoverflow.com/users/4932965/razvan-meriniuc"}, "edited": false, "score": 3, "creation_date": 1463355485, "post_id": 37243269, "comment_id": 62018487, "body": "@RazvanMeriniuc There is no \u201clast call\u201d, nor does it ever \u201cstop calling itself\u201d. The point is that Haskell is <i>lazy</i>, so computations won\u2019t be evaluated until they are needed. If you take the first 4 numbers from <code>fib</code>, then Haskell will evaluate the expression until it has computed 4 elements, then it will suspend evaluation. If you then take the first 8 numbers, it will <i>resume</i> the computation to get the next four, then re-suspend until things are needed. There is no \u201cend\u201d to this process. If you try to take all the numbers (by folding, for example), it will never finish."}], "tags": [], "owner": {"reputation": 100185, "user_id": 3234959, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/93bb12ca0f93dfddb33880316f7e66c2?s=128&d=identicon&r=PG&f=1", "display_name": "chi", "link": "https://stackoverflow.com/users/3234959/chi"}, "is_accepted": false, "score": 3, "last_activity_date": 1463343684, "creation_date": 1463343684, "answer_id": 37243269, "question_id": 37243102, "link": "https://stackoverflow.com/questions/37243102/haskell-infinite-recursion/37243269#37243269", "title": "Haskell infinite recursion", "body": "<p>In a word: laziness. A list in Haskell is more like a generator: it will only compute values when they are demanded by something else.</p>\n\n<p>For instance <code>head [1 , 2+3]</code> will not perform the addition, since it is not needed. Similarly, if we recursively let <code>ones = 1 : ones</code>, then <code>head ones = head (1 : ones) = 1</code> does not need to evaluate all the tail.</p>\n\n<p>You can try guessing what happens if we print a pair <code>x</code>, defined as follows:</p>\n\n<pre><code>x = (n, fst x + 1)\n</code></pre>\n\n<p>Above we use a (lazy) pair instead of a (lazy) list, but the reasoning is the same. Don't evaluate anything unless is it needed by something else.</p>\n"}, {"tags": [], "owner": {"reputation": 31301, "user_id": 1598537, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/c214754fba6f3a238a93af85a0ab4f58?s=128&d=identicon&r=PG", "display_name": "AndrewC", "link": "https://stackoverflow.com/users/1598537/andrewc"}, "is_accepted": true, "score": 9, "last_activity_date": 1463352676, "last_edit_date": 1463352676, "creation_date": 1463346334, "answer_id": 37243672, "question_id": 37243102, "link": "https://stackoverflow.com/questions/37243102/haskell-infinite-recursion/37243672#37243672", "title": "Haskell infinite recursion", "body": "<p>I've drawn a picture, which you might find helpful.<br>\nNote that <code>zipWtih op (x:xs) (y:xs) = (op x y):zipWith xs ys</code>, which is how <code>zipWtih</code> appears to \"move\" right along the list. It's reading elements and spitting out sums:</p>\n\n<p><a href=\"https://i.stack.imgur.com/VheDF.png\" rel=\"noreferrer\"><img src=\"https://i.stack.imgur.com/VheDF.png\" alt=\"pic with coloured pointers\"></a></p>\n\n<hr>\n\n<p>Here's a more detailed step-by-step evaluation. (Although I'll paste copies of what's there, there's only one copy in memory.) I'll use <code>....</code> for things I can't be bothered to write out.</p>\n\n<pre><code>fib = 0:1:zipWith (+) fib (tail fib)\n    = 0:1:zipWith (+) (0:1: .... ) (tail (0:1: .... )\n    = 0:1:(0+1:zipWith (+) (1:(0+1: .... )) ( 0+1:..... ))\n    = 0:1:1:zipWith (+) (1: ....) (......)\n</code></pre>\n\n<p>notice that now we know that <code>zipWith (+) fib (tail fib) = 1:.....</code>.</p>\n\n<pre><code>    = 0:1:1:zipWith (+) (1:1: ....) (1:......)\n    = 0:1:1:(1+1):zipWith (+) (1:(1+1): .....) ((1+1):....)\n    = 0:1:1:2:zipWith (+) (1:2: .....) (2:....)\n</code></pre>\n\n<p>I'll go a little faster:</p>\n\n<pre><code>    = 0:1:1:2:(1+2):zipWith (+) (2: .....) (....)\n    = 0:1:1:2:3     :zipWith (+) (2:3 .....) (3:....)\n    = 0:1:1:2:3:(2+3):zipWith (+) (3:(2+3):.....) ((2+3):.....)\n    = 0:1:1:2:3:5     :zipWith (+) (3:5:.....) (5:.....)\n    = 0:1:1:2:3:5:8    :zipWith (+) (5:8:....) (8:......)\n    = 0:1:1:2:3:5:8:13  :zipWith (+) (8:13:....) (13:......)\n    = 0:1:1:2:3:5:8:13:21:zipWith (+) (13:21....) (21:......)\n</code></pre>\n\n<p>At each stage, the last two arguments to the <code>zipWith</code> function are like pointers to (one and two positions) further up the <code>fib</code> list than we are at present.</p>\n"}], "owner": {"reputation": 172, "user_id": 4932965, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/30dd676072dec501db6881c9dd4ac970?s=128&d=identicon&r=PG&f=1", "display_name": "Razvan Meriniuc", "link": "https://stackoverflow.com/users/4932965/razvan-meriniuc"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 1208, "favorite_count": 3, "accepted_answer_id": 37243672, "answer_count": 2, "score": 6, "last_activity_date": 1567458234, "creation_date": 1463342610, "last_edit_date": 1567458234, "question_id": 37243102, "link": "https://stackoverflow.com/questions/37243102/haskell-infinite-recursion", "title": "Haskell infinite recursion", "body": "<p>The following function computes the Fibonacci sequence:</p>\n\n<pre><code>fib = 0 : 1 : (zipWith (+) fib (tail fib))\n</code></pre>\n\n<p>If we run it, we will get an infinite list, but how does the recursion work? Why does it get to print numbers on the screen if it the function keeps calling itself? I would appreciate if you could explain how the compiler manages the calls.</p>\n"}, {"tags": ["haskell", "d3.js", "data-visualization"], "answers": [{"comments": [{"owner": {"reputation": 6238, "user_id": 737051, "user_type": "registered", "accept_rate": 56, "profile_image": "https://www.gravatar.com/avatar/4cbfcdd51d0ec56844b3540f62d06af3?s=128&d=identicon&r=PG", "display_name": "john mangual", "link": "https://stackoverflow.com/users/737051/john-mangual"}, "edited": false, "score": 0, "creation_date": 1463357039, "post_id": 37243329, "comment_id": 62018793, "body": "This is great you got it to run.  I wonder what happens when you make charts that aren&#39;t among his examples?"}, {"owner": {"reputation": 930, "user_id": 4387539, "user_type": "registered", "accept_rate": 77, "profile_image": "https://i.stack.imgur.com/xN2AM.png?s=128&g=1", "display_name": "hyiltiz", "link": "https://stackoverflow.com/users/4387539/hyiltiz"}, "edited": false, "score": 0, "creation_date": 1578560840, "post_id": 37243329, "comment_id": 105480621, "body": "@ErikR might as well consider submitting your patch of build rules into the <code>d3js</code> package so people can simply <code>stack install</code> without the tweaks."}], "tags": [], "owner": {"reputation": 49959, "user_id": 866915, "user_type": "registered", "accept_rate": 70, "profile_image": "https://www.gravatar.com/avatar/09242131d6e17cbbe31e8547514da6e5?s=128&d=identicon&r=PG", "display_name": "ErikR", "link": "https://stackoverflow.com/users/866915/erikr"}, "is_accepted": false, "score": 4, "last_activity_date": 1463344093, "creation_date": 1463344093, "answer_id": 37243329, "question_id": 37243002, "link": "https://stackoverflow.com/questions/37243002/bar-charts-in-haskell-d3js/37243329#37243329", "title": "Bar charts in Haskell-d3js", "body": "<p>Not sure exactly what your question is, but here is how to get the d3js demo to run:</p>\n\n<ol>\n<li><p>Run these commands:</p>\n\n<pre><code>stack new demo\ncd demo\ncabal get d3js-0.1.0.0\n</code></pre></li>\n</ol>\n\n<p>Make sure the <code>resolver:</code> setting in stack.yaml is relatively new (e.g. >= 5.0)</p>\n\n<ol start=\"2\">\n<li><p>In the <code>stack.yaml</code> file change the <code>packages</code> stanza to read:</p>\n\n<pre><code>packages:\n- '.'\n- d3js-0.1.0.0\n</code></pre></li>\n<li><p>In the file <code>d3js-0.1.0.0/d3js.cabal</code> modify the <code>build-depends</code> line to read:</p>\n\n<pre><code>  build-depends:       base &gt;=4.6\n</code></pre></li>\n</ol>\n\n<p>(i.e. omit the upper bounds on <code>base</code>)</p>\n\n<ol start=\"4\">\n<li><p>In <code>demo.cabal</code> make the <code>library</code> stanza look like:</p>\n\n<pre><code>library\n  hs-source-dirs:      src\n  exposed-modules:     Lib\n  build-depends:       base &gt;= 4.8 &amp;&amp; &lt; 5, d3js, text\n  default-language:    Haskell2010\n</code></pre></li>\n<li><p>Use this for <code>src/Lib.hs</code>:</p>\n\n<pre><code>{-# LANGUAGE OverloadedStrings #-}\n\nmodule Lib\nwhere\n\nimport Control.Monad\nimport qualified Data.Text as T\nimport qualified Data.Text.IO as T\nimport D3JS\n\nsomeFunc :: IO ()\nsomeFunc = putStrLn \"someFunc\"\n\ntest :: Int -&gt; IO ()\ntest n = T.writeFile \"generated.js\" $ reify (box \"#div1\" (300,300) &gt;&gt;= bars n 300 (Data1D [100,20,80,60,120]))\n</code></pre></li>\n<li><p>Run <code>stack ghci</code> and run something like <code>test 13</code> function. Look at the output in <code>generated.js</code>.</p></li>\n</ol>\n\n<p>The <code>d3js</code> package hasn't been updated for a while, and it imposes a too restrictive upper bound on the <code>base</code> package. It turns out that it will compile fine with the latest <code>base</code> so we're making the d3js source code part of our own project and tweaking it to get it to compile.</p>\n"}], "owner": {"reputation": 6238, "user_id": 737051, "user_type": "registered", "accept_rate": 56, "profile_image": "https://www.gravatar.com/avatar/4cbfcdd51d0ec56844b3540f62d06af3?s=128&d=identicon&r=PG", "display_name": "john mangual", "link": "https://stackoverflow.com/users/737051/john-mangual"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 406, "favorite_count": 0, "answer_count": 1, "score": 0, "last_activity_date": 1463344093, "creation_date": 1463342043, "last_edit_date": 1463343326, "question_id": 37243002, "link": "https://stackoverflow.com/questions/37243002/bar-charts-in-haskell-d3js", "title": "Bar charts in Haskell-d3js", "body": "<p>I decided to poke through the <a href=\"http://hackage.haskell.org/package/d3js\" rel=\"nofollow\">d3js</a> library in Haskell but after it didn't install through Stackage.</p>\n\n<pre><code>$ stack install d3js\n\nRun from outside a project, using implicit global project config\nUsing resolver: lts-5.2 from implicit global project's config file: /home/john/.stack/global-project/stack.yaml\nWhile constructing the BuildPlan the following exceptions were encountered:\n\n--  Failure when adding dependencies:    \n      base: needed (&gt;=4.6 &amp;&amp; &lt;4.7), 4.8.2.0 found (latest applicable is 4.6.0.1)\n    needed for package d3js-0.1.0.0\n</code></pre>\n\n<p>Instead I got the more interestin idea of looking through the source of <a href=\"https://github.com/nebuta/d3js-haskell\" rel=\"nofollow\">d3js-haskell</a>.  If I could install the library this could be one of the simplest examples: a bar chart.</p>\n\n<pre><code> import Control.Monad\n import qualified Data.Text as T\n import D3JS\n\n test :: Int -&gt; IO ()\n test n = T.writeFile \"generated.js\" $ reify (box \"#div1\" (300,300) &gt;&gt;= bars n 300 (Data1D [100,20,80,60,120]))\n</code></pre>\n\n<p>Even with this simple example I have a number of questions.  <strong>How does <code>reify</code> work ?</strong>  I had to look up the word in a dictionary:</p>\n\n<blockquote>\n  <p>to regard (something abstract) as a material or concrete thing</p>\n  \n  <h3>Did you know?</h3>\n  \n  <p><em>Reify</em> is a word that attempts to provide a bridge between what is abstract and what is real. Fittingly, it derives from a word that is an ancestor to \"real\" - the Latin noun <em>res</em>, meaning \"thing.\" Both \"reify\" and the related noun \"reification\" first appeared in English in the mid-19th century, though \"reification\" is a few years older and some dictionaries consider \"reify\" to be a back-formation of the noun. In general use, the words refer to the act of considering or presenting an abstract idea in real or material terms, or of judging something by a concrete example.</p>\n</blockquote>\n\n<p>That having been said the <strong>reify</strong> function in the d3.js library turns Haskell entities representing d3.js objects into actual d3.js code.  Do we have examples of a reifiable object?  We can fine one:</p>\n\n<pre><code>reify (box \"#div1\" (300,300) &gt;&gt;= bars n 300 (Data1D [100,20,80,60,120]))\n</code></pre>\n\n<p>The object in parentheses is a reifiable object.   A tour of the source code is both enlightening and discouraging:</p>\n\n<pre><code>-- |Instances of Reifiable can generate a JavaScript code fragment.\nclass Reifiable a where\n    reify :: a -&gt; Text\n</code></pre>\n\n<p>This was taken from <a href=\"https://github.com/nebuta/d3js-haskell/blob/master/D3JS/Type.hs\" rel=\"nofollow\">d3js/Type.hs</a> Are there examples of reifiable objects? Let's look at <a href=\"https://github.com/nebuta/d3js-haskell/blob/master/D3JS/Reify.hs\" rel=\"nofollow\">d3js/reify.hs</a>:</p>\n\n<pre><code>instance Reifiable Data1D where\n    reify (Data1D ps) = surround $ T.intercalate \",\" $ map show' ps\n\ninstance Reifiable Data2D where\n    reify (Data2D ps) = surround $ T.intercalate \",\" $ map (\\(x,y) -&gt; T.concat [\"[\",show' x,\",\",show' y,\"]\"]) ps\n\ninstance Reifiable (JSFunc params r) where\n    reify (JSFunc name params) = T.concat [name,\"(\",T.intercalate \",\" $ map reify params,\")\"]\n\ninstance Reifiable JSParam where\n    reify (ParamVar name) = name\n    reify (PText t) = T.concat [\"\\\"\",t,\"\\\"\"]\n    reify (PDouble d) = show' d\n    reify (PInt d) = show' d\n    reify (PFunc (FuncTxt t)) = t\n    reify (PFunc (FuncExp f)) = T.concat[\"function(d,i){return \",reify f,\";}\"]\n    reify (PFunc' f) = reify f\n    reify (PArray vs) = T.concat [\"[\",T.intercalate \",\" $ map reify vs,\"]\"]\n    reify (PChainValue v) = reify v\n</code></pre>\n\n<p>These are examples of reifiable types but these don't tell us <strong>how charts are constructed in haskell-d3js?</strong></p>\n\n<pre><code>-- | box parent (w,h) makes an SVG container in a parent element with dimension w x h.\nbox :: Selector -&gt;  (Double,Double) -&gt; St (Var' Selection)\nbox parent (w,h) = do\n    assign\n        $ ((d3Root\n            &gt;&gt;&gt; select parent\n            &gt;&gt;&gt; func \"append\" [PText \"svg\"]\n            &gt;&gt;&gt; width w\n            &gt;&gt;&gt; height h\n            &gt;&gt;&gt; style \"background\" \"#eef\") :: Chain () Selection)\n\nbars :: Int -&gt; Double -&gt; Data1D -&gt; Var' Selection -&gt; St ()\nbars n width ps (Var' elem) = do\n    let bar_w = width / (fromIntegral n)\n    v &lt;- assign $ Val' (mkRectData bar_w ps)\n    execute $\n        (Val elem :: Chain () Selection)\n        &gt;&gt;&gt; addRect v\n        &gt;&gt;&gt; fill' \"red\"\n</code></pre>\n\n<p>These examples supposedly work.  It looks like we are committed to red bars ( I haven't even seen the chart yet).</p>\n\n<hr>\n\n<p>Let me end by some discouraging footnotes in the source code.  This from <a href=\"https://github.com/nebuta/d3js-haskell/blob/master/D3JS/Chart.hs\" rel=\"nofollow\">chart.hs</a></p>\n\n<pre><code>-- This modules provides high-level functions for drawing common charts, such as bar charts and scatter plots.\n-- Those functions also exemplify how to compose primitive functions to achieve complex drawing.\n-- This module will be expanded in the near future.\n</code></pre>\n"}, {"tags": ["haskell", "d3.js", "io"], "answers": [{"tags": [], "owner": {"reputation": 49959, "user_id": 866915, "user_type": "registered", "accept_rate": 70, "profile_image": "https://www.gravatar.com/avatar/09242131d6e17cbbe31e8547514da6e5?s=128&d=identicon&r=PG", "display_name": "ErikR", "link": "https://stackoverflow.com/users/866915/erikr"}, "is_accepted": true, "score": 3, "last_activity_date": 1463341577, "creation_date": 1463341577, "answer_id": 37242936, "question_id": 37242796, "link": "https://stackoverflow.com/questions/37242796/turning-strings-into-text-in-haskell/37242936#37242936", "title": "turning Strings into Text in Haskell", "body": "<p>Use <code>Data.Text.pack</code> to convert a <code>String</code> into <code>Text</code>:</p>\n\n<pre><code>pack :: String -&gt; Text\n</code></pre>\n\n<p>Also, the Text version of <code>writeFile</code> appears in <code>Data.Text.IO</code>, e.g.:</p>\n\n<pre><code>import qualified Data.Text.IO as T\n\nT.writeFile \"helloWorld.txt\" (T.pack \"Hello World!\")\n</code></pre>\n\n<p>It's ok to import both <code>Data.Text</code> and <code>Data.Text.IO</code> as <code>T</code>.</p>\n"}, {"tags": [], "owner": {"reputation": 9119, "user_id": 180258, "user_type": "registered", "accept_rate": 92, "profile_image": "https://www.gravatar.com/avatar/8b3779ca7c73166d7016272086c6282f?s=128&d=identicon&r=PG", "display_name": "ron", "link": "https://stackoverflow.com/users/180258/ron"}, "is_accepted": false, "score": 2, "last_activity_date": 1463350491, "creation_date": 1463350491, "answer_id": 37244247, "question_id": 37242796, "link": "https://stackoverflow.com/questions/37242796/turning-strings-into-text-in-haskell/37244247#37244247", "title": "turning Strings into Text in Haskell", "body": "<p>In addition to the conversion functions mentioned, you might want to use the <code>{-# LANGUAGE OverloadedStrings #-}</code> pragma at the top of your file to enable tho <code>OverloadedStrings</code> extension, which lets you write string literals, but automatically converting them to a compatible type (say <code>Text</code>).</p>\n\n<p>Read more at <a href=\"https://ocharles.org.uk/blog/posts/2014-12-17-overloaded-strings.html\" rel=\"nofollow\">https://ocharles.org.uk/blog/posts/2014-12-17-overloaded-strings.html</a>.</p>\n"}], "owner": {"reputation": 6238, "user_id": 737051, "user_type": "registered", "accept_rate": 56, "profile_image": "https://www.gravatar.com/avatar/4cbfcdd51d0ec56844b3540f62d06af3?s=128&d=identicon&r=PG", "display_name": "john mangual", "link": "https://stackoverflow.com/users/737051/john-mangual"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 399, "favorite_count": 0, "accepted_answer_id": 37242936, "answer_count": 2, "score": 4, "last_activity_date": 1463350491, "creation_date": 1463340758, "question_id": 37242796, "link": "https://stackoverflow.com/questions/37242796/turning-strings-into-text-in-haskell", "title": "turning Strings into Text in Haskell", "body": "<p>Using the Haskell d3.js library I am trying to make a bar chart a bar chart.</p>\n\n<pre><code> import Control.Monad\n import qualified Data.Text as T\n import D3JS\n\n test :: Int -&gt; IO ()\n test n = T.writeFile \"generated.js\" $ reify (box \"#div1\" (300,300) &gt;&gt;= bars n 300 (Data1D [100,20,80,60,120]))\n</code></pre>\n\n<p>Even with this simple example I have a number of questions.</p>\n\n<ul>\n<li><a href=\"https://wiki.haskell.org/Import\" rel=\"nofollow\"><strong><code>import qualified</code></strong></a> seems to require namespaces.  Then instead of <code>Data.Text.writeFile</code> we can write <code>T.writeFile</code></li>\n<li><code>Data.Text.writeFile</code> does not appear listed in <a href=\"http://hackage.haskell.org/package/text-0.11.2.0/docs/Data-Text.html\" rel=\"nofollow\">hackage</a>'s entry on <code>Data.Text</code> but I did find it in relation to <a href=\"http://hackage.haskell.org/package/base-4.8.2.0/docs/Prelude.html#v:writeFile\" rel=\"nofollow\">prelude</a>.</li>\n</ul>\n\n<p>Here is an example of a simple <code>T.writeFile</code> error:</p>\n\n<pre><code>&gt; import qualified Data.Text.IO as T\n&gt; T.writeFile \"helloWorld.txt\" \"Hello World!\"\n\nCouldn't match expected type \u2018Text\u2019 with actual type \u2018String\u2019\n</code></pre>\n\n<p>Hopefully all of this type-casting can be sorted out.  Then I have big question about how <code>reify</code> works.  For now... how do I even changed the String to a Text here?</p>\n"}, {"tags": ["list", "haskell", "recursion"], "comments": [{"owner": {"reputation": 49959, "user_id": 866915, "user_type": "registered", "accept_rate": 70, "profile_image": "https://www.gravatar.com/avatar/09242131d6e17cbbe31e8547514da6e5?s=128&d=identicon&r=PG", "display_name": "ErikR", "link": "https://stackoverflow.com/users/866915/erikr"}, "edited": false, "score": 0, "creation_date": 1463341446, "post_id": 37242547, "comment_id": 62014626, "body": "Hint: Write a function which takes two lists <code>(as,bs)</code> and returns <code>(c,as&#39;,bs&#39;)</code> where <code>c</code> is the number of letters which are in the same and in the same position and <code>as&#39;</code> and <code>bs&#39;</code> are <code>as</code> and <code>bs</code> with those common letters removed."}, {"owner": {"reputation": 9119, "user_id": 180258, "user_type": "registered", "accept_rate": 92, "profile_image": "https://www.gravatar.com/avatar/8b3779ca7c73166d7016272086c6282f?s=128&d=identicon&r=PG", "display_name": "ron", "link": "https://stackoverflow.com/users/180258/ron"}, "edited": false, "score": 0, "creation_date": 1463350230, "post_id": 37242547, "comment_id": 62017268, "body": "In case you would need edit distance as your fitness function: see the <a href=\"https://hackage.haskell.org/package/align\" rel=\"nofollow noreferrer\">hackage.haskell.org/package/align</a> package (disclosure: I&#39;m the author)."}, {"owner": {"reputation": 44013, "user_id": 1477667, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/trgKM.jpg?s=128&g=1", "display_name": "dfeuer", "link": "https://stackoverflow.com/users/1477667/dfeuer"}, "edited": false, "score": 0, "creation_date": 1463359372, "post_id": 37242547, "comment_id": 62019273, "body": "Can you see why the <code>notSamePlace</code> function here will be quite slow for long strings? Can you think of a way to use an auxiliary data structure to help? Hint: you can find two sensible options in the <a href=\"https://hackage.haskell.org/package/containers\" rel=\"nofollow noreferrer\"><code>containers</code></a> package. One of them is more obviously applicable; the other is actually faster."}, {"owner": {"reputation": 2185, "user_id": 4129091, "user_type": "registered", "accept_rate": 80, "profile_image": "https://www.gravatar.com/avatar/0f8076e78a95ed50b9ffbed42849d80e?s=128&d=identicon&r=PG&f=1", "display_name": "tsorn", "link": "https://stackoverflow.com/users/4129091/tsorn"}, "edited": false, "score": 0, "creation_date": 1463533188, "post_id": 37242547, "comment_id": 62101786, "body": "&quot;the same-place function requires to split up the two lists [..], while the not-the-same-place function needs to keep the second list intact without splitting it up in a head and tail.&quot; Tip: you can use the as-pattern, for example <code>list@(x:xs)</code> where <code>list</code> will give you the whole list, <code>x</code> the head and <code>xs</code> the tail"}], "answers": [{"comments": [{"owner": {"reputation": 55, "user_id": 5962100, "user_type": "registered", "profile_image": "https://lh5.googleusercontent.com/-uqHqJMWVxFY/AAAAAAAAAAI/AAAAAAAAADw/QaNJIM01UeM/photo.jpg?sz=128", "display_name": "Martin V", "link": "https://stackoverflow.com/users/5962100/martin-v"}, "edited": false, "score": 0, "creation_date": 1463342850, "post_id": 37243024, "comment_id": 62015083, "body": "Thank you Kapol for your answer! Did not even consider that you could use the zip function for this... Sometimes you just need a new perspective to tackle the problem with. Thanks again! :)"}, {"owner": {"reputation": 11978, "user_id": 774651, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/d174682a9c2469488ac0cd91f0253215?s=128&d=identicon&r=PG&f=1", "display_name": "Lol4t0", "link": "https://stackoverflow.com/users/774651/lol4t0"}, "edited": false, "score": 0, "creation_date": 1463343449, "post_id": 37243024, "comment_id": 62015302, "body": "<code>*Main Data.Map Data.List&gt; places &quot;Hello&quot; &quot;Hel&quot; 7 </code> Doesn&#39;t look clever"}], "tags": [], "owner": {"reputation": 6025, "user_id": 3053082, "user_type": "registered", "accept_rate": 94, "profile_image": "https://www.gravatar.com/avatar/cf7725958a43181e6b2b4c0f5f02b91b?s=128&d=identicon&r=PG&f=1", "display_name": "Kapol", "link": "https://stackoverflow.com/users/3053082/kapol"}, "is_accepted": true, "score": 1, "last_activity_date": 1463342152, "creation_date": 1463342152, "answer_id": 37243024, "question_id": 37242547, "link": "https://stackoverflow.com/questions/37242547/compare-elements-between-two-lists-haskell/37243024#37243024", "title": "Compare elements between two lists - Haskell", "body": "<p>Below function uses <code>zip</code> to index every character, which allows to pass the full second list into recursive calls. </p>\n\n<pre><code>places :: String -&gt; String -&gt; Int\nplaces _ [] = 0\nplaces [] _ = 0\nplaces xs ys = zippedPlaces (zip xs [1..length xs]) (zip ys [1..length ys])\n\nzippedPlaces :: [(Char, Int)] -&gt; [(Char, Int)] -&gt; Int\nzippedPlaces [] _ = 0\nzippedPlaces (x:xs) ys =\n    let match = filter (\\(num, i) -&gt; fst x == num) ys\n    in case match of\n        [] -&gt; zippedPlaces xs ys\n        (a:_) -&gt; (if snd a == snd x then 2 else 1) + zippedPlaces xs ys\n</code></pre>\n"}, {"tags": [], "owner": {"reputation": 2313, "user_id": 5318306, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/897fd4f3b92d28c5c1eb28a8024661a1?s=128&d=identicon&r=PG&f=1", "display_name": "Gurkenglas", "link": "https://stackoverflow.com/users/5318306/gurkenglas"}, "is_accepted": false, "score": 0, "last_activity_date": 1463403452, "creation_date": 1463403452, "answer_id": 37254464, "question_id": 37242547, "link": "https://stackoverflow.com/questions/37242547/compare-elements-between-two-lists-haskell/37254464#37254464", "title": "Compare elements between two lists - Haskell", "body": "<p>Assumes that no list contains duplicates:</p>\n\n<pre><code>place [] _ = 0\nplace _ [] = 0\nplace (x:xs) (y:ys) = place xs ys +\n  if x == y then 1 else (if elem x ys then 2 else 0) + (if elem y xs then 2 else 0)\n</code></pre>\n"}], "owner": {"reputation": 55, "user_id": 5962100, "user_type": "registered", "profile_image": "https://lh5.googleusercontent.com/-uqHqJMWVxFY/AAAAAAAAAAI/AAAAAAAAADw/QaNJIM01UeM/photo.jpg?sz=128", "display_name": "Martin V", "link": "https://stackoverflow.com/users/5962100/martin-v"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 2210, "favorite_count": 0, "accepted_answer_id": 37243024, "answer_count": 2, "score": 1, "last_activity_date": 1463403452, "creation_date": 1463339286, "question_id": 37242547, "link": "https://stackoverflow.com/questions/37242547/compare-elements-between-two-lists-haskell", "title": "Compare elements between two lists - Haskell", "body": "<p>This is probably a stupid question, but I've been stuck on this problem for some hours now.. I have made a genetic algorithm but thought that I could try to improve it a bit. I want to make a fitness function that compare two lists of digits and returns a value. If both lists contains a number that is the same and are in the same \"place\" the function should return + 2. If the lists contains a number that is the same but in the wrong place it should return + 1.</p>\n\n<p>I've made two different functions which both fulfill one of these tasks, but I can't manage to incorperate them into one function. Here are the functions:</p>\n\n<pre><code>samePlace _ [] = 0\nsamePlace [] _ = 0\nsamePlace (x:xs) (y:ys)\n    | x == y = (sP xs ys) + 2\n    | otherwise = sP xs (ys)\n</code></pre>\n\n<p>This function returns +2 for every digit that is the same and is in the right place. </p>\n\n<pre><code>notSamePlace [] _ = 0\nnotSamePlace _ [] = 0\nnotSamePlace (x:xs) (ys)\n    | elem x (ys) = (notSamePlace xs ys) + 1\n    | otherwise = (notSamePlace xs ys)\n</code></pre>\n\n<p>This function returns + 1 is one of the digits in the first list exists in the second list.</p>\n\n<p>The problem I got is that the same-place function requires to split up the two lists and go through them one digit at a time to compare them while the not-the-same-place function needs to keep the second list intact without splitting it up in a head and tail. Would be so thankful if someone could point me in the right direction on how to go about this problem.</p>\n\n<p>Also, my thought was that this function could improve the time it takes to find the solution in the genetic algorithm. If my solution is to find the string \"hello world\", my thought is that an individual with the gene \"leolh owdrl\" should have more fitness than a gene that looks like \"hFz%l r0M/z\". In my program so far the first gene would have a fitness value of 1 (because the 'space' is the only character in the same place as the targets characters) but the second gene has the 'h' and the 'space' right so it would be given a fitness value of 2. Is this a good thought or not?</p>\n\n<p>Thanks!</p>\n"}, {"tags": ["haskell", "memory"], "answers": [{"tags": [], "owner": {"reputation": 48129, "user_id": 76051, "user_type": "registered", "accept_rate": 91, "profile_image": "https://i.stack.imgur.com/AGDxz.jpg?s=128&g=1", "display_name": "Carsten", "link": "https://stackoverflow.com/users/76051/carsten"}, "is_accepted": true, "score": 3, "last_activity_date": 1463317677, "creation_date": 1463317677, "answer_id": 37238678, "question_id": 37238490, "link": "https://stackoverflow.com/questions/37238490/how-to-find-memory-usage-of-a-program-in-haskell/37238678#37238678", "title": "How to find memory usage of a program in Haskell", "body": "<p>one easy way is to compile with <code>-rtsopts</code></p>\n\n<pre><code>ghc -O2 -rtsopts Test.hs -o test\n</code></pre>\n\n<p>and then run it with</p>\n\n<pre><code>./test +RTS -s\n</code></pre>\n\n<hr>\n\n<p>if you need actual profiling you can compile with <code>-prof</code> and run with <code>-p</code> - this will produce a <code>.prof</code> file you can then examine</p>\n\n<p>(see <a href=\"https://downloads.haskell.org/~ghc/latest/docs/html/users_guide/profiling.html\" rel=\"nofollow\">profiling user guide</a>)</p>\n"}], "owner": {"reputation": 29, "user_id": 6327375, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/ebcef980dd98b6652e8ee1b501199610?s=128&d=identicon&r=PG&f=1", "display_name": "stoychos", "link": "https://stackoverflow.com/users/6327375/stoychos"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 641, "favorite_count": 0, "accepted_answer_id": 37238678, "answer_count": 1, "score": 1, "last_activity_date": 1463317677, "creation_date": 1463316488, "question_id": 37238490, "link": "https://stackoverflow.com/questions/37238490/how-to-find-memory-usage-of-a-program-in-haskell", "title": "How to find memory usage of a program in Haskell", "body": "<p>I have some stuff to do and for that I need to find memory usage of a program in Haskell, but I dont know how. Any ideas ? My version of GHC is 7.10.3.</p>\n"}, {"tags": ["haskell", "haskell-stack"], "answers": [{"comments": [{"owner": {"reputation": 30377, "user_id": 369198, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/71596bb1ca3ba3aa4400c3f407baec9f?s=128&d=identicon&r=PG", "display_name": "Michael Snoyman", "link": "https://stackoverflow.com/users/369198/michael-snoyman"}, "edited": false, "score": 3, "creation_date": 1463330446, "post_id": 37237777, "comment_id": 62010778, "body": "You can probably get away with just <code>stack exec -- ghc-pkg unregister pkgname</code>"}, {"owner": {"reputation": 5657, "user_id": 534481, "user_type": "registered", "accept_rate": 31, "profile_image": "https://www.gravatar.com/avatar/60df8c1a366ab1bf4378154e71a93367?s=128&d=identicon&r=PG", "display_name": "Saurabh Nanda", "link": "https://stackoverflow.com/users/534481/saurabh-nanda"}, "reply_to_user": {"reputation": 30377, "user_id": 369198, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/71596bb1ca3ba3aa4400c3f407baec9f?s=128&d=identicon&r=PG", "display_name": "Michael Snoyman", "link": "https://stackoverflow.com/users/369198/michael-snoyman"}, "edited": false, "score": 0, "creation_date": 1589967097, "post_id": 37237777, "comment_id": 109499955, "body": "@MichaelSnoyman @erikR does <code>stack exec -- ghc-pkg unregister pkgname</code> work with the newer versions of stack (the ones which use pantry)?"}, {"owner": {"reputation": 30377, "user_id": 369198, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/71596bb1ca3ba3aa4400c3f407baec9f?s=128&d=identicon&r=PG", "display_name": "Michael Snoyman", "link": "https://stackoverflow.com/users/369198/michael-snoyman"}, "edited": false, "score": 0, "creation_date": 1590024913, "post_id": 37237777, "comment_id": 109527653, "body": "Pantry shouldn&#39;t affect it"}, {"owner": {"reputation": 141, "user_id": 8565175, "user_type": "registered", "profile_image": "https://lh4.googleusercontent.com/-5jYdIxZdMlY/AAAAAAAAAAI/AAAAAAAAACU/e_9FLrZl0Og/photo.jpg?sz=128", "display_name": "Brandon Chinn", "link": "https://stackoverflow.com/users/8565175/brandon-chinn"}, "reply_to_user": {"reputation": 30377, "user_id": 369198, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/71596bb1ca3ba3aa4400c3f407baec9f?s=128&d=identicon&r=PG", "display_name": "Michael Snoyman", "link": "https://stackoverflow.com/users/369198/michael-snoyman"}, "edited": false, "score": 1, "creation_date": 1596130122, "post_id": 37237777, "comment_id": 111720066, "body": "I believe with Stack 2, you now need to manipulate the sqlite file. I got it working like: <code>sqlite3 ~&#47;.stack&#47;stack.sqlite3 &quot;DELETE FROM precompiled_cache WHERE library LIKE &#39;%pkgdb&#47;zlib-%&#39;&quot;</code>.  @MichaelSnoyman do you think we should open an issue on Stack to make the process of unregistering a dependency easier? For some background, we have to do this every time the <code>icu4c</code> package updates on brew, because <code>text-icu</code> will be linked to an old non-existent version of the icu4c dylibs"}], "tags": [], "owner": {"reputation": 49959, "user_id": 866915, "user_type": "registered", "accept_rate": 70, "profile_image": "https://www.gravatar.com/avatar/09242131d6e17cbbe31e8547514da6e5?s=128&d=identicon&r=PG", "display_name": "ErikR", "link": "https://stackoverflow.com/users/866915/erikr"}, "is_accepted": true, "score": 17, "last_activity_date": 1463337637, "last_edit_date": 1463337637, "creation_date": 1463312143, "answer_id": 37237777, "question_id": 37236892, "link": "https://stackoverflow.com/questions/37236892/force-stack-to-rebuild-an-installed-package/37237777#37237777", "title": "Force `stack` to rebuild an installed package", "body": "<p><strong>Update:</strong></p>\n\n<p>Based on @Michael Snoyman's comment just using this command should be enough to remove the package:</p>\n\n<pre><code>stack exec -- ghc-pkg unregister --force regex-pcre\n</code></pre>\n\n<p><strong>Original Answer:</strong></p>\n\n<p>I don't know if it's the sanctioned way to do it, but it seems to work. Here is a synopsis:</p>\n\n<ol>\n<li>Locate the <code>ghc-pkg</code> program for the version of GHC you are using</li>\n<li>Locate the package-db directory for your resolver version</li>\n<li>Run <code>$ghcpkg --package-db $pkgdb unregister --force &lt;package&gt;</code></li>\n<li>Also remove the package file from stack's <code>precompiled</code> directory</li>\n</ol>\n\n<p>Suppose the package we want to remove is <code>zlib-0.5.4.2</code>.</p>\n\n<p><strong>Locating ghc-pkg</strong></p>\n\n<p>Under ~/.stack/programs find the ghc-pkg program appropriate for your compiler version, e.g. <code>~/.stack/programs/x86_64-osx/ghc-7.10.2/bin/ghc-pkg</code>. Call this <code>$ghcpkg</code></p>\n\n<p><strong>Locating the package db</strong></p>\n\n<p>Under ~/.stack/snapshots find the <code>pkgdb</code> directory for the resolver you are using, e.g. <code>~/.stack/snapshots/x86_64-osx/lts-3.1/7.10.2/pkgdb</code>. Call this <code>$pkgdb</code>.</p>\n\n<p><strong>Unregister the package</strong></p>\n\n<p>Run:</p>\n\n<pre><code>$ghcpkg --package-db $pkgdb unregister --force zlib-0.5.4.2\n</code></pre>\n\n<p>Ignore any warnings about broken or breaking packages.</p>\n\n<p>You can check to see if your package is registered or not with this command:</p>\n\n<pre><code>$ghcpkg --package-db $pkgdb list | grep zlib\n</code></pre>\n\n<p><strong>Remove the package from the <code>precompiled</code> directory</strong></p>\n\n<p>Under <code>~/.stack/precompiled</code> locate any directories named <code>zlib-0.5.4.2</code> and remove the one for your the relevant version of GHC:</p>\n\n<pre><code>find ~/.stack/precompiled -name 'zlib-*'\n/bin/rm -rf ...\n</code></pre>\n\n<p><strong>Reinstall the package</strong></p>\n\n<pre><code>stack --resolver=... install zlib\n</code></pre>\n\n<p>Stack should report that it is rebuilding the package.</p>\n"}], "owner": {"reputation": 3295, "user_id": 388010, "user_type": "registered", "accept_rate": 98, "profile_image": "https://www.gravatar.com/avatar/f6c6f0feb5cb53e7023d5d9ecc443767?s=128&d=identicon&r=PG", "display_name": "Sebastian Graf", "link": "https://stackoverflow.com/users/388010/sebastian-graf"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 3418, "favorite_count": 4, "accepted_answer_id": 37237777, "answer_count": 1, "score": 11, "last_activity_date": 1463337637, "creation_date": 1463306417, "question_id": 37236892, "link": "https://stackoverflow.com/questions/37236892/force-stack-to-rebuild-an-installed-package", "title": "Force `stack` to rebuild an installed package", "body": "<p>I often install a package which depends on external libraries and manage to move those external libraries to other locations afterwards, so that compiled programs exit with a loader error.</p>\n\n<p>In those cases I just want stack to rebuild an already installed package, but I don't see how that is possible. <code>stack install --force-dirty</code> doesn't seem to work, as it just tries to rebuild the project in the current working directory.</p>\n\n<hr>\n\n<p>Recent example:</p>\n\n<p>I'd liked to see whether <code>regex-pcre</code> requires a C library not present on Windows systems, so I hit <code>stack install regex-pcre</code>. That went fine, but then I realized I installed <code>mingw-w64-x86_64-pcre</code> via <code>stack</code>s <code>pacman</code> prior to this. I removed it again via <code>pacman -R</code> and tried to run <code>stack install regex-pcre</code> again, which did not rebuild it. Neither did adding <code>--force-dirty</code> work for the above reason.</p>\n"}, {"tags": ["haskell", "template-haskell"], "comments": [{"owner": {"reputation": 49959, "user_id": 866915, "user_type": "registered", "accept_rate": 70, "profile_image": "https://www.gravatar.com/avatar/09242131d6e17cbbe31e8547514da6e5?s=128&d=identicon&r=PG", "display_name": "ErikR", "link": "https://stackoverflow.com/users/866915/erikr"}, "edited": false, "score": 0, "creation_date": 1463310099, "post_id": 37236848, "comment_id": 62003789, "body": "What&#39;s the type signature of <code>foldWithKey&#39;</code>?"}, {"owner": {"reputation": 25, "user_id": 5695808, "user_type": "registered", "accept_rate": 40, "profile_image": "https://www.gravatar.com/avatar/e1a4a97d855f086a7585f5efe4aa4e63?s=128&d=identicon&r=PG&f=1", "display_name": "Ivan", "link": "https://stackoverflow.com/users/5695808/ivan"}, "reply_to_user": {"reputation": 49959, "user_id": 866915, "user_type": "registered", "accept_rate": 70, "profile_image": "https://www.gravatar.com/avatar/09242131d6e17cbbe31e8547514da6e5?s=128&d=identicon&r=PG", "display_name": "ErikR", "link": "https://stackoverflow.com/users/866915/erikr"}, "edited": false, "score": 0, "creation_date": 1463311215, "post_id": 37236848, "comment_id": 62004137, "body": "@ErikR foldlWithKey&#39; :: (a -&gt; k -&gt; v -&gt; a) -&gt; a -&gt; HashMap k v -&gt; a"}], "answers": [{"tags": [], "owner": {"reputation": 49959, "user_id": 866915, "user_type": "registered", "accept_rate": 70, "profile_image": "https://www.gravatar.com/avatar/09242131d6e17cbbe31e8547514da6e5?s=128&d=identicon&r=PG", "display_name": "ErikR", "link": "https://stackoverflow.com/users/866915/erikr"}, "is_accepted": false, "score": 1, "last_activity_date": 1463314923, "creation_date": 1463314923, "answer_id": 37238241, "question_id": 37236848, "link": "https://stackoverflow.com/questions/37236848/using-state-modify-from-another-function/37238241#37238241", "title": "Using State.modify from another function", "body": "<p>Conceptually the problem is that  the\nfirst argument passed to <code>foldWithKey'</code> must be a pure function,\nbut when you use <code>modify</code> you are creating a stateful computation,\nnot a pure function.</p>\n\n<p>Apparently you are trying to iterate through a hashmap while\nmaintaining some state during the traversal. <code>foldWithKey'</code>\nalready gives you that state - it's the first parameter to\nthe accumulation function:</p>\n\n<pre><code>                  v-- current state\nfoldlWithKey' :: (a -&gt; k -&gt; v -&gt; a) -&gt; a -&gt; HashMap k v -&gt; a\n                     new state --^     ^-- initial         ^-- final\n                                           state               state\n</code></pre>\n\n<p>The accumulation function takes the current state, a key and a value\nand returns an updated state. Then if you give <code>foldWithKey'</code> an initial\nstate it will return the final state.</p>\n\n<p>Here's an example using <code>foldWithKey</code> which is the same as\n<code>foldWithKey'</code> except that the arguments are in a slightly\ndifferent order.</p>\n\n<p>The function<code>evenOdds</code> returns two lists - one containing\nthe keys which have even values and those which have odd values.</p>\n\n<p>The state is the pair <code>(even,odds)</code>, and the accumulation function <code>go</code>\nreturns the updated state based on the current key and value.</p>\n\n<pre><code> {-# LANGUAGE NoMonomorphismRestriction #-}\n\n import qualified Data.HashMap as H\n\n myMap = H.fromList [ (\"a\",1), (\"b\",2), (\"c\",3), (\"d\",4) ]\n\n evenOdds :: ([String],[String])\n evenOdds = H.foldWithKey go ([],[]) myMap\n   where  go :: String -&gt; Int -&gt; ([String],[String]) -&gt; ([String],[String])\n          go k a (evens,odds) = \n             if even a then ( evens ++ [k], odds)\n                       else ( evens       , odds ++ [k] )\n</code></pre>\n"}], "owner": {"reputation": 25, "user_id": 5695808, "user_type": "registered", "accept_rate": 40, "profile_image": "https://www.gravatar.com/avatar/e1a4a97d855f086a7585f5efe4aa4e63?s=128&d=identicon&r=PG&f=1", "display_name": "Ivan", "link": "https://stackoverflow.com/users/5695808/ivan"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 81, "favorite_count": 0, "answer_count": 1, "score": 0, "last_activity_date": 1463314923, "creation_date": 1463306118, "question_id": 37236848, "link": "https://stackoverflow.com/questions/37236848/using-state-modify-from-another-function", "title": "Using State.modify from another function", "body": "<p>It is only a skeleton of program. I have main function, that </p>\n\n<pre><code>State [Dec] [Dec]\nmainCon = do\n  acc &lt;- get\n  put []\n  modify $ (++) [some func]\n  return acc\n</code></pre>\n\n<p>On one stage I call function: </p>\n\n<pre><code>foldlWithKey'\n                         (\\list' key' val' -&gt;\n    if (...)\n          then\n                (Control.Monad.State.modify $ (Prelude.++) [elem]) &gt;&gt;\n                some code\n                : list')\n          else\n                (Control.Monad.State.modify $ (Prelude.++) []) &gt;&gt;\n                some code\n                : list')\n                             )\n                             []\n                             (map')\n</code></pre>\n\n<p>and want to modify State in mainCon, but continue traverse map'. The error is:</p>\n\n<pre><code>No instance for (MonadState [Dec] [])\n      arising from a use of \u2018Control.Monad.State.modify\u2019\n    In the expression: Control.Monad.State.modify\n</code></pre>\n\n<p>[Dec] from Template Haskell. How can I simply solve this problem?</p>\n"}, {"tags": ["haskell"], "comments": [{"owner": {"reputation": 94713, "user_id": 1139697, "user_type": "registered", "accept_rate": 86, "profile_image": "https://www.gravatar.com/avatar/5f136ddb684f39aaee1c028ee1950f6f?s=128&d=identicon&r=PG", "display_name": "Zeta", "link": "https://stackoverflow.com/users/1139697/zeta"}, "edited": false, "score": 1, "creation_date": 1463302064, "post_id": 37236085, "comment_id": 62001568, "body": "CSR format for the matrix, <a href=\"https://hackage.haskell.org/package/vector\" rel=\"nofollow noreferrer\"><code>vector</code></a> for the vector."}, {"owner": {"reputation": 3436, "user_id": 4364027, "user_type": "registered", "accept_rate": 64, "profile_image": "https://www.gravatar.com/avatar/e84dbb0e9c838c25bbb70b326fd696aa?s=128&d=identicon&r=PG&f=1", "display_name": "Marko Grdinic", "link": "https://stackoverflow.com/users/4364027/marko-grdinic"}, "reply_to_user": {"reputation": 94713, "user_id": 1139697, "user_type": "registered", "accept_rate": 86, "profile_image": "https://www.gravatar.com/avatar/5f136ddb684f39aaee1c028ee1950f6f?s=128&d=identicon&r=PG", "display_name": "Zeta", "link": "https://stackoverflow.com/users/1139697/zeta"}, "edited": false, "score": 0, "creation_date": 1463303584, "post_id": 37236085, "comment_id": 62001969, "body": "Unfortunately, <code>vector</code> is not a part of the standard library. Ideone does not have it either, so I can&#39;t use that one."}, {"owner": {"reputation": 94713, "user_id": 1139697, "user_type": "registered", "accept_rate": 86, "profile_image": "https://www.gravatar.com/avatar/5f136ddb684f39aaee1c028ee1950f6f?s=128&d=identicon&r=PG", "display_name": "Zeta", "link": "https://stackoverflow.com/users/1139697/zeta"}, "edited": false, "score": 1, "creation_date": 1463303953, "post_id": 37236085, "comment_id": 62002075, "body": "That leaves you with <a href=\"https://downloads.haskell.org/~ghc/latest/docs/html/libraries/\" rel=\"nofollow noreferrer\"><code>Array</code></a>."}, {"owner": {"reputation": 44013, "user_id": 1477667, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/trgKM.jpg?s=128&g=1", "display_name": "dfeuer", "link": "https://stackoverflow.com/users/1477667/dfeuer"}, "edited": false, "score": 1, "creation_date": 1463336697, "post_id": 37236085, "comment_id": 62013033, "body": "@MarkoGrdinic, <code>vector</code> isn&#39;t in the standard, but it&#39;s pretty dang important. Why do you need Ideone?"}, {"owner": {"reputation": 3436, "user_id": 4364027, "user_type": "registered", "accept_rate": 64, "profile_image": "https://www.gravatar.com/avatar/e84dbb0e9c838c25bbb70b326fd696aa?s=128&d=identicon&r=PG&f=1", "display_name": "Marko Grdinic", "link": "https://stackoverflow.com/users/4364027/marko-grdinic"}, "edited": false, "score": 0, "creation_date": 1463336807, "post_id": 37236085, "comment_id": 62013077, "body": "Ideone is the backend HackerRank uses. If Ideone does not support it then probably HackerRank doesn&#39;t either, though I should have checked the import on a HackerRank problem. I am still working on the problem at any rate, so I&#39;ll do so."}, {"owner": {"reputation": 100892, "user_id": 745903, "user_type": "registered", "accept_rate": 74, "profile_image": "https://www.gravatar.com/avatar/50933f6638836741e620669b3940410e?s=128&d=identicon&r=PG", "display_name": "leftaroundabout", "link": "https://stackoverflow.com/users/745903/leftaroundabout"}, "edited": false, "score": 0, "creation_date": 1463347173, "post_id": 37236085, "comment_id": 62016447, "body": "Well, if NumPy is supported then it would certainly be \u201cfair\u201d if <code>vector</code> were too, at the very least; it is basically the Haskell equivalent of NumPy. In fact it&#39;s rather more basic; NumPy is almost like <a href=\"http://hackage.haskell.org/package/hmatrix\" rel=\"nofollow noreferrer\"><code>hmatrix</code></a>."}, {"owner": {"reputation": 3436, "user_id": 4364027, "user_type": "registered", "accept_rate": 64, "profile_image": "https://www.gravatar.com/avatar/e84dbb0e9c838c25bbb70b326fd696aa?s=128&d=identicon&r=PG&f=1", "display_name": "Marko Grdinic", "link": "https://stackoverflow.com/users/4364027/marko-grdinic"}, "edited": false, "score": 0, "creation_date": 1463382823, "post_id": 37236085, "comment_id": 62025317, "body": "I&#39;ve tested it and it seems HackerRank does support <code>vector</code> after all. Sorry for the confusion."}, {"owner": {"reputation": 992, "user_id": 1041518, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/0poCe.jpg?s=128&g=1", "display_name": "erosenin", "link": "https://stackoverflow.com/users/1041518/erosenin"}, "edited": false, "score": 0, "creation_date": 1463404618, "post_id": 37236085, "comment_id": 62036953, "body": "@MarkoGrdinic Hackerrank does not use Ideone to compile and run your code. To know more about the machines and environment you can check this page: <a href=\"https://www.hackerrank.com/environment\" rel=\"nofollow noreferrer\">hackerrank.com/environment</a>"}, {"owner": {"reputation": 992, "user_id": 1041518, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/0poCe.jpg?s=128&g=1", "display_name": "erosenin", "link": "https://stackoverflow.com/users/1041518/erosenin"}, "edited": false, "score": 0, "creation_date": 1463405385, "post_id": 37236085, "comment_id": 62037459, "body": "@MarkoGrdinic Can you self answer this question, now that you have realized it."}], "answers": [{"tags": [], "owner": {"reputation": 3436, "user_id": 4364027, "user_type": "registered", "accept_rate": 64, "profile_image": "https://www.gravatar.com/avatar/e84dbb0e9c838c25bbb70b326fd696aa?s=128&d=identicon&r=PG&f=1", "display_name": "Marko Grdinic", "link": "https://stackoverflow.com/users/4364027/marko-grdinic"}, "is_accepted": false, "score": 1, "last_activity_date": 1463406185, "creation_date": 1463406185, "answer_id": 37255410, "question_id": 37236085, "link": "https://stackoverflow.com/questions/37236085/haskell-what-data-structure-to-use-for-a-sparse-matrix-multiply/37255410#37255410", "title": "Haskell - What data structure to use for a sparse matrix multiply?", "body": "<p>To answer my own question, the goto class in Haskell for plain arrays would be the <a href=\"https://hackage.haskell.org/package/vector-0.11.0.0/docs/Data-Vector-Unboxed.html\" rel=\"nofollow\"><code>Data.Vector.Unboxed</code></a>. Haskell has a distinction between boxed and unboxed arrays, and even though I knew that it still somehow surprised me that in a vector of vectors, the outer vector would have to be a boxed type.</p>\n\n<p>Also regarding tuples, per documentation for efficiency a vector of tuples will get compiled as tuple of vectors which definitely means that the elements will get allocated to a contiguous area on the heap.</p>\n"}], "owner": {"reputation": 3436, "user_id": 4364027, "user_type": "registered", "accept_rate": 64, "profile_image": "https://www.gravatar.com/avatar/e84dbb0e9c838c25bbb70b326fd696aa?s=128&d=identicon&r=PG&f=1", "display_name": "Marko Grdinic", "link": "https://stackoverflow.com/users/4364027/marko-grdinic"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 293, "favorite_count": 0, "answer_count": 1, "score": 3, "last_activity_date": 1463406185, "creation_date": 1463300996, "question_id": 37236085, "link": "https://stackoverflow.com/questions/37236085/haskell-what-data-structure-to-use-for-a-sparse-matrix-multiply", "title": "Haskell - What data structure to use for a sparse matrix multiply?", "body": "<p>Using Haskell, I am doing exercises on HackerRank in order to familiarize myself with the language. For the <a href=\"https://www.hackerrank.com/challenges/stitch-the-torn-wiki\" rel=\"nofollow\">particular problem</a> I am currently doing, I will have to do a matrix multiply. Unlike in Python where I could just use Numpy, I've checked on Ideone and it seems Haskell does not have any linear algebra packages plugged in, so I am going to do it by hand. If I was doing this problem in F# I would just use a plain array, but in Haskell I am not sure as it has various array classes. I am looking for some advice on what I should be looking into here as I have a total of three days experience in the language so far.</p>\n\n<p>I am also wondering whether tuples are stack or heap allocated in Haskell as I might have to use them to encode <code>(index,value)</code> positions.</p>\n"}, {"tags": ["performance", "list", "haskell"], "comments": [{"owner": {"reputation": 40537, "user_id": 465378, "user_type": "registered", "accept_rate": 85, "profile_image": "https://www.gravatar.com/avatar/c03b8d34978563858020eff0d14cc17b?s=128&d=identicon&r=PG", "display_name": "Alexis King", "link": "https://stackoverflow.com/users/465378/alexis-king"}, "edited": false, "score": 0, "creation_date": 1463294207, "post_id": 37235256, "comment_id": 61999731, "body": "Haskell lists are <i>lazy</i>, which makes them closer to Python generators/iterators than Python lists, except that their interface looks like simple lists (because they are; Haskell is just a lazy language)."}, {"owner": {"reputation": 171, "user_id": 4133743, "user_type": "registered", "accept_rate": 86, "profile_image": "https://www.gravatar.com/avatar/2ba4bd0c196057243f4fb27b8ed5792c?s=128&d=identicon&r=PG&f=1", "display_name": "Helix", "link": "https://stackoverflow.com/users/4133743/helix"}, "edited": false, "score": 0, "creation_date": 1463295613, "post_id": 37235256, "comment_id": 62000019, "body": "Compiled with -O2. Sum is implemented using folds in the source code. This sum allocates around 3 gb of memory and takes 1.8 seconds on my machine which is about 3x as long as long as python&#39;s <code>print sum(xrange(100000001))</code> which is why I was surprised. I thought laziness would fix the memory issue and that speed should be around equal. Thanks for the help."}, {"owner": {"reputation": 84731, "user_id": 510937, "user_type": "registered", "accept_rate": 80, "profile_image": "https://www.gravatar.com/avatar/70b13a9ae1aae1ca1aa6ac8dab4643f2?s=128&d=identicon&r=PG", "display_name": "Bakuriu", "link": "https://stackoverflow.com/users/510937/bakuriu"}, "edited": false, "score": 0, "creation_date": 1463296461, "post_id": 37235256, "comment_id": 62000203, "body": "@Helix No lazyness makes it harder to understand space usage. Note that python has a very limited &quot;lazyness&quot;. Sure generators produce one element at a time, however when doing a function call arguments are still evaluated before the call is performed. In Haskell arguments are <i>not</i> evaluated before the function call but only when, during the call, the value is needed. This means that chains of function call create big unevaluated structures."}, {"owner": {"reputation": 48129, "user_id": 76051, "user_type": "registered", "accept_rate": 91, "profile_image": "https://i.stack.imgur.com/AGDxz.jpg?s=128&g=1", "display_name": "Carsten", "link": "https://stackoverflow.com/users/76051/carsten"}, "edited": false, "score": 0, "creation_date": 1463297806, "post_id": 37235256, "comment_id": 62000541, "body": "<i>btw</i>: if compiled with <code>-O2</code> while <code>sum [...]</code> will allocate around 3gb in total yes - but not at the same time (it&#39;s <code>44,312 bytes maximum residency</code> on my system)"}, {"owner": {"reputation": 48129, "user_id": 76051, "user_type": "registered", "accept_rate": 91, "profile_image": "https://i.stack.imgur.com/AGDxz.jpg?s=128&g=1", "display_name": "Carsten", "link": "https://stackoverflow.com/users/76051/carsten"}, "edited": false, "score": 0, "creation_date": 1463297815, "post_id": 37235256, "comment_id": 62000542, "body": "same with <code>foldl&#39;</code> of course"}, {"owner": {"reputation": 48129, "user_id": 76051, "user_type": "registered", "accept_rate": 91, "profile_image": "https://i.stack.imgur.com/AGDxz.jpg?s=128&g=1", "display_name": "Carsten", "link": "https://stackoverflow.com/users/76051/carsten"}, "edited": false, "score": 0, "creation_date": 1463299716, "post_id": 37235256, "comment_id": 62000990, "body": "does someone know how to avoid all the allocations in the back? I had a very quick look/go at it and even strict arguments, forced inlining and using <code>IORef</code> does not stop this"}, {"owner": {"reputation": 94713, "user_id": 1139697, "user_type": "registered", "accept_rate": 86, "profile_image": "https://www.gravatar.com/avatar/5f136ddb684f39aaee1c028ee1950f6f?s=128&d=identicon&r=PG", "display_name": "Zeta", "link": "https://stackoverflow.com/users/1139697/zeta"}, "edited": false, "score": 0, "creation_date": 1463300874, "post_id": 37235256, "comment_id": 62001235, "body": "@Helix: Could you add your test program and your compiling options? Actually, both the python script and the Haskell program would be great. Note that your question &quot;how to write memory efficient code&quot; is rather broad."}, {"owner": {"reputation": 61419, "user_id": 849891, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/MbEO3.png?s=128&g=1", "display_name": "Will Ness", "link": "https://stackoverflow.com/users/849891/will-ness"}, "edited": false, "score": 0, "creation_date": 1463330370, "post_id": 37235256, "comment_id": 62010754, "body": "to be sure, code your loops as recursive functions with <code>BangPatterns</code> and simple types (like <code>Int</code>), like this: <code>f n = go 0 0   where go c !sum | c==n = sum+n | otherwise = go (c+1) (sum+c)</code>, <code>main = print $ f (100000000 :: Int)</code>. <a href=\"http://ideone.com/5hQL3h\" rel=\"nofollow noreferrer\">On 32-bit it will cause integer overflow</a> of couse."}, {"owner": {"reputation": 171, "user_id": 4133743, "user_type": "registered", "accept_rate": 86, "profile_image": "https://www.gravatar.com/avatar/2ba4bd0c196057243f4fb27b8ed5792c?s=128&d=identicon&r=PG&f=1", "display_name": "Helix", "link": "https://stackoverflow.com/users/4133743/helix"}, "reply_to_user": {"reputation": 94713, "user_id": 1139697, "user_type": "registered", "accept_rate": 86, "profile_image": "https://www.gravatar.com/avatar/5f136ddb684f39aaee1c028ee1950f6f?s=128&d=identicon&r=PG", "display_name": "Zeta", "link": "https://stackoverflow.com/users/1139697/zeta"}, "edited": false, "score": 0, "creation_date": 1463378181, "post_id": 37235256, "comment_id": 62023467, "body": "@Zeta Sorry I don&#39;t believe that I can edit my own posts yet. My compiling options are pretty generic. Just <code>ghc --make -O2 $file -fglasgow-exts -fforce-recomp -threaded -rtsopts</code>. The code is <code>main = print $ sum [1..100000000]</code>. Changing to <code>Int</code> provides the best speedup and decreases memory usage. <code>foldl&#39;</code> and <code>foldr</code> don&#39;t do much. The python code testing against is <code>print sum(xrange(100000001))</code> and run using the python command."}, {"owner": {"reputation": 94713, "user_id": 1139697, "user_type": "registered", "accept_rate": 86, "profile_image": "https://www.gravatar.com/avatar/5f136ddb684f39aaee1c028ee1950f6f?s=128&d=identicon&r=PG", "display_name": "Zeta", "link": "https://stackoverflow.com/users/1139697/zeta"}, "edited": false, "score": 0, "creation_date": 1463387647, "post_id": 37235256, "comment_id": 62027458, "body": "@Helix: Are you sure about that? <a href=\"https://stackoverflow.com/posts/37235256/edit\">edit</a>ing is a <a href=\"https://stackoverflow.com/help/privileges/create-posts\">1 point privilege</a>."}], "answers": [{"comments": [{"owner": {"reputation": 48129, "user_id": 76051, "user_type": "registered", "accept_rate": 91, "profile_image": "https://i.stack.imgur.com/AGDxz.jpg?s=128&g=1", "display_name": "Carsten", "link": "https://stackoverflow.com/users/76051/carsten"}, "edited": false, "score": 0, "creation_date": 1463318040, "post_id": 37238202, "comment_id": 62006317, "body": "wow interesting - I can understand the difference in time but the difference in memory consumption is puzzling me"}, {"owner": {"reputation": 14781, "user_id": 630160, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/4445f21326af525a8ad19af7e3ae41a8?s=128&d=identicon&r=PG", "display_name": "epsilonhalbe", "link": "https://stackoverflow.com/users/630160/epsilonhalbe"}, "reply_to_user": {"reputation": 48129, "user_id": 76051, "user_type": "registered", "accept_rate": 91, "profile_image": "https://i.stack.imgur.com/AGDxz.jpg?s=128&g=1", "display_name": "Carsten", "link": "https://stackoverflow.com/users/76051/carsten"}, "edited": false, "score": 0, "creation_date": 1463321834, "post_id": 37238202, "comment_id": 62007640, "body": "@Carsten I tried to answer your question too - but I am not sure if everything is correct, I am by no means expert on that topic"}, {"owner": {"reputation": 94713, "user_id": 1139697, "user_type": "registered", "accept_rate": 86, "profile_image": "https://www.gravatar.com/avatar/5f136ddb684f39aaee1c028ee1950f6f?s=128&d=identicon&r=PG", "display_name": "Zeta", "link": "https://stackoverflow.com/users/1139697/zeta"}, "edited": false, "score": 1, "creation_date": 1463387825, "post_id": 37238202, "comment_id": 62027541, "body": "@epsilonhalbe: IIRC, <code>integer-gmp</code> uses something along <code>data Integer = Positive !ByteStuff# | Negative !ByteStuff# | SmallInt !Int#</code>. So for small integers, it <i>should</i> perform the same as <code>Int</code>, but the checks whether <code>(+)</code> needs more space than <code>Int#</code> provides probably take their additional toll (and I&#39;m not sure of the conditions that switch to <code>Positive</code> from <code>SmallInt</code>)."}], "tags": [], "owner": {"reputation": 14781, "user_id": 630160, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/4445f21326af525a8ad19af7e3ae41a8?s=128&d=identicon&r=PG", "display_name": "epsilonhalbe", "link": "https://stackoverflow.com/users/630160/epsilonhalbe"}, "is_accepted": true, "score": 6, "last_activity_date": 1463321792, "last_edit_date": 1463321792, "creation_date": 1463314704, "answer_id": 37238202, "question_id": 37235256, "link": "https://stackoverflow.com/questions/37235256/using-list-generator-for-memory-efficient-code-in-haskell/37238202#37238202", "title": "Using list generator for memory efficient code in Haskell", "body": "<h2>TL;DR - I think the culprit in this case is - defaulting of GHC to <code>Integer</code>.</h2>\n\n<p>Admittedly I do not know enough about python, but my first guess would be that python switches to \"bigint\" only if necessary - therefore all calculations are done with <code>Int</code> a.k.a. 64-bit integer on my machine.</p>\n\n<p>A first check with</p>\n\n<pre><code>$&gt; ghci\nGHCi, version 7.10.3: http://www.haskell.org/ghc/  :? for help\nPrelude&gt; maxBound :: Int\n9223372036854775807\n</code></pre>\n\n<p>reveals that the result of the sum (<code>5000000050000000</code>) is less than that number so we have no fear of <code>Int</code> overflow.</p>\n\n<p>I have guessed your example programs to look roughly like this</p>\n\n<h2><code>sum.py</code></h2>\n\n<pre><code>print(sum(xrange(100000000)))\n</code></pre>\n\n<h2><code>sum.hs</code></h2>\n\n<pre><code>main :: IO ()\nmain = print $ sum [1..100000000]\n</code></pre>\n\n<p>To make things explicit I added the type annotation <code>(100000000 :: Integer)</code>, compiling it with</p>\n\n<pre><code>$ &gt; stack build --ghc-options=\"-O2 -with-rtsopts=-sstderr\"\n</code></pre>\n\n<p>and ran your example,</p>\n\n<pre><code>$ &gt; stack exec -- time sum\n5000000050000000\n   3,200,051,872 bytes allocated in the heap\n         208,896 bytes copied during GC\n          44,312 bytes maximum residency (2 sample(s))\n          21,224 bytes maximum slop\n               1 MB total memory in use (0 MB lost due to fragmentation)\n\n                                     Tot time (elapsed)  Avg pause  Max pause\n  Gen  0      6102 colls,     0 par    0.013s   0.012s     0.0000s    0.0000s\n  Gen  1         2 colls,     0 par    0.000s   0.000s     0.0001s    0.0001s\n\n  INIT    time    0.000s  (  0.000s elapsed)\n  MUT     time    1.725s  (  1.724s elapsed)\n  GC      time    0.013s  (  0.012s elapsed)\n  EXIT    time    0.000s  (  0.000s elapsed)\n  Total   time    1.739s  (  1.736s elapsed)\n\n  %GC     time       0.7%  (0.7% elapsed)\n\n  Alloc rate    1,855,603,449 bytes per MUT second\n\n  Productivity  99.3% of total user, 99.4% of total elapsed\n\n1.72user 0.00system 0:01.73elapsed 99%CPU (0avgtext+0avgdata 4112maxresident)k\n</code></pre>\n\n<p>and indeed the ~3GB of memory consumption is reproduced.</p>\n\n<p>Changing the annotation to <code>(100000000 :: Int)</code> - altered the behaviour drastically</p>\n\n<pre><code>$ &gt; stack build\n$ &gt; stack exec -- time sum\n5000000050000000\n          51,872 bytes allocated in the heap\n           3,408 bytes copied during GC\n          44,312 bytes maximum residency (1 sample(s))\n          17,128 bytes maximum slop\n               1 MB total memory in use (0 MB lost due to fragmentation)\n\n                                     Tot time (elapsed)  Avg pause  Max pause\n  Gen  0         0 colls,     0 par    0.000s   0.000s     0.0000s    0.0000s\n  Gen  1         1 colls,     0 par    0.000s   0.000s     0.0001s    0.0001s\n\n  INIT    time    0.000s  (  0.000s elapsed)\n  MUT     time    0.034s  (  0.034s elapsed)\n  GC      time    0.000s  (  0.000s elapsed)\n  EXIT    time    0.000s  (  0.000s elapsed)\n  Total   time    0.036s  (  0.035s elapsed)\n\n  %GC     time       0.2%  (0.2% elapsed)\n\n  Alloc rate    1,514,680 bytes per MUT second\n\n  Productivity  99.4% of total user, 102.3% of total elapsed\n\n0.03user 0.00system 0:00.03elapsed 91%CPU (0avgtext+0avgdata 3496maxresident)k\n0inputs+0outputs (0major+176minor)pagefaults 0swaps\n</code></pre>\n\n<h2>For the interested</h2>\n\n<p>The behaviour of the haskell version does not change a lot if you use libraries like <code>conduit</code> or <code>vector</code> (both boxed and unboxed).</p>\n\n<p>sample programs</p>\n\n<p><code>sumC.hs</code></p>\n\n<pre><code>import Data.Conduit\nimport Data.Conduit.List as CL\n\nmain :: IO ()\nmain = do res &lt;- CL.enumFromTo 1 100000000 $$ CL.fold (+) (0 :: Int)\n          print res\n</code></pre>\n\n<p><code>sumV.hs</code></p>\n\n<pre><code>import           Data.Vector.Unboxed as V\n{-import           Data.Vector as V-}\n\nmain :: IO ()\nmain = print $ V.sum $ V.enumFromTo (1::Int) 100000000\n</code></pre>\n\n<p>funny enough the version using</p>\n\n<pre><code>main = print $ V.sum $ V.enumFromN (1::Int) 100000000\n</code></pre>\n\n<p>is doing worse than the above - even though the <a href=\"https://hackage.haskell.org/package/vector-0.11.0.0/docs/Data-Vector-Unboxed.html#g:11\">documentation</a> says otherwise.</p>\n\n<blockquote>\n<pre><code>enumFromN :: (Unbox a, Num a) =&gt; a -&gt; Int -&gt; Vector a\n</code></pre>\n  \n  <p>O(n) Yield a vector of the given length containing the values x, x+1\n  etc. This operation is usually more efficient than enumFromTo.</p>\n</blockquote>\n\n<h2>Update</h2>\n\n<p>@Carsten's comment made me curious - so I had a look into the sources for integer - well <a href=\"https://github.com/ghc/ghc/blob/ghc-7.10/libraries/integer-simple\"><code>integer-simple</code></a> to be precise, because for <code>Integer</code> there exists other versions <code>integer-gmp</code> and <code>integer-gmp2</code> using <code>libgmp</code>.</p>\n\n<pre><code>data Integer = Positive !Positive | Negative !Positive | Naught\n\n-------------------------------------------------------------------\n-- The hard work is done on positive numbers\n\n-- Least significant bit is first\n\n-- Positive's have the property that they contain at least one Bit,\n-- and their last Bit is One.\ntype Positive = Digits\ntype Positives = List Positive\n\ndata Digits = Some !Digit !Digits\n            | None\ntype Digit = Word#\n\ndata List a = Nil | Cons a (List a)\n</code></pre>\n\n<p>so when using <code>Integer</code> there is quite a bit of memory overhead compared to <code>Int</code> or rather unboxed <code>Int#</code> - I guess as this should be optimized, (though I have not confirmed that).</p>\n\n<p>So <code>Integer</code> is (if I calculate correctly)</p>\n\n<ul>\n<li>1 x <code>Word</code> for the sum-type-tag (here <code>Positive</code></li>\n<li>n x (<code>Word + Word</code>) for <code>Some</code> and the <code>Digit</code> part</li>\n<li>1 x <code>Word</code> for the last <code>None</code></li>\n</ul>\n\n<p>a memory overhead of <em>(2 + floor(log_10(n))</em> for each <code>Integer</code> in that calculation + a bit more for the accumulator.</p>\n"}], "owner": {"reputation": 171, "user_id": 4133743, "user_type": "registered", "accept_rate": 86, "profile_image": "https://www.gravatar.com/avatar/2ba4bd0c196057243f4fb27b8ed5792c?s=128&d=identicon&r=PG&f=1", "display_name": "Helix", "link": "https://stackoverflow.com/users/4133743/helix"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 230, "favorite_count": 0, "accepted_answer_id": 37238202, "answer_count": 1, "score": 4, "last_activity_date": 1463321792, "creation_date": 1463293924, "question_id": 37235256, "link": "https://stackoverflow.com/questions/37235256/using-list-generator-for-memory-efficient-code-in-haskell", "title": "Using list generator for memory efficient code in Haskell", "body": "<p>I would like to get a handle on writing memory efficient haskell code. One thing I ran across is that there is no dead easy way to make python style list generators/iterators (that I could find).</p>\n\n<p>Small example:</p>\n\n<p>Finding the sum of the integers from 1 to 100000000 without using the closed form formula. </p>\n\n<p>Python that can be done quickly with minimal use of memory as <code>sum(xrange(100000000)</code>. In Haskell the analogue would be <code>sum [1..100000000]</code>. However this uses up a lot of memory. I thought using <code>foldl</code> or <code>foldr</code> would be fine but even that uses a lot of memory and is slower than python. Any suggestions?</p>\n"}, {"tags": ["haskell"], "comments": [{"owner": {"reputation": 49959, "user_id": 866915, "user_type": "registered", "accept_rate": 70, "profile_image": "https://www.gravatar.com/avatar/09242131d6e17cbbe31e8547514da6e5?s=128&d=identicon&r=PG", "display_name": "ErikR", "link": "https://stackoverflow.com/users/866915/erikr"}, "edited": false, "score": 0, "creation_date": 1463286991, "post_id": 37234234, "comment_id": 61998531, "body": "it would be helpful if you gave an SML example that you would like to implement in Haskell."}, {"owner": {"reputation": 971, "user_id": 2049443, "user_type": "registered", "accept_rate": 65, "profile_image": "https://www.gravatar.com/avatar/9c276d9862277956ce66657db45543e6?s=128&d=identicon&r=PG", "display_name": "vijrox", "link": "https://stackoverflow.com/users/2049443/vijrox"}, "reply_to_user": {"reputation": 49959, "user_id": 866915, "user_type": "registered", "accept_rate": 70, "profile_image": "https://www.gravatar.com/avatar/09242131d6e17cbbe31e8547514da6e5?s=128&d=identicon&r=PG", "display_name": "ErikR", "link": "https://stackoverflow.com/users/866915/erikr"}, "edited": false, "score": 0, "creation_date": 1463287840, "post_id": 37234234, "comment_id": 61998678, "body": "@ErikR That&#39;s a good idea -- I haven&#39;t really thought about how I would implement this in SML, so thinking about that would probably help me figure this out and communicate it better."}], "answers": [{"comments": [{"owner": {"reputation": 971, "user_id": 2049443, "user_type": "registered", "accept_rate": 65, "profile_image": "https://www.gravatar.com/avatar/9c276d9862277956ce66657db45543e6?s=128&d=identicon&r=PG", "display_name": "vijrox", "link": "https://stackoverflow.com/users/2049443/vijrox"}, "edited": false, "score": 0, "creation_date": 1463286650, "post_id": 37234459, "comment_id": 61998473, "body": "Thanks! Just to clarify: would a user of the module see the name/type of the typeclass -- and so should I switch to making all my functions part of the typeclass rather than directly in the module? I guess my main concern is that it seems weird for some functions to be defined directly as part of the module and some to be defined as members of a typeclass exported by the module, when really the user of the module uses both the same way..."}, {"owner": {"reputation": 971, "user_id": 2049443, "user_type": "registered", "accept_rate": 65, "profile_image": "https://www.gravatar.com/avatar/9c276d9862277956ce66657db45543e6?s=128&d=identicon&r=PG", "display_name": "vijrox", "link": "https://stackoverflow.com/users/2049443/vijrox"}, "edited": false, "score": 0, "creation_date": 1463286811, "post_id": 37234459, "comment_id": 61998501, "body": "Would a user of the module see that some functions involve the type <code>C a</code> and some don&#39;t? What should <code>C</code> be in this case -- it&#39;s the name of the typeclass right? I&#39;m assuming it shouldn&#39;t also be <code>Expression</code>?"}, {"owner": {"reputation": 2513, "user_id": 4725625, "user_type": "registered", "accept_rate": 70, "profile_image": "https://i.stack.imgur.com/YwH49.png?s=128&g=1", "display_name": "Kwarrtz", "link": "https://stackoverflow.com/users/4725625/kwarrtz"}, "reply_to_user": {"reputation": 971, "user_id": 2049443, "user_type": "registered", "accept_rate": 65, "profile_image": "https://www.gravatar.com/avatar/9c276d9862277956ce66657db45543e6?s=128&d=identicon&r=PG", "display_name": "vijrox", "link": "https://stackoverflow.com/users/2049443/vijrox"}, "edited": false, "score": 0, "creation_date": 1463286989, "post_id": 37234459, "comment_id": 61998530, "body": "@vijrox I&#39;m not entirely certain what you mean by users seeing the &quot;name/type of the typeclass&quot;. However, defining some things as functions and some things as methods is a very common and accepted practice in Haskell."}, {"owner": {"reputation": 2513, "user_id": 4725625, "user_type": "registered", "accept_rate": 70, "profile_image": "https://i.stack.imgur.com/YwH49.png?s=128&g=1", "display_name": "Kwarrtz", "link": "https://stackoverflow.com/users/4725625/kwarrtz"}, "reply_to_user": {"reputation": 971, "user_id": 2049443, "user_type": "registered", "accept_rate": 65, "profile_image": "https://www.gravatar.com/avatar/9c276d9862277956ce66657db45543e6?s=128&d=identicon&r=PG", "display_name": "vijrox", "link": "https://stackoverflow.com/users/2049443/vijrox"}, "edited": false, "score": 0, "creation_date": 1463287242, "post_id": 37234459, "comment_id": 61998569, "body": "Yes, users of the module would see the constraint <code>C a</code> in some functions and not in others. On the other hand, they would have to see something. I mean, if a function only works for <code>Integrals</code> and <code>Fractionals</code>, then the type <code>Num a =&gt; Expression a -&gt; Expression a</code> is obviously incorrect. You need something to specify that extra restriction. In this case, that would be <code>C a</code>."}, {"owner": {"reputation": 971, "user_id": 2049443, "user_type": "registered", "accept_rate": 65, "profile_image": "https://www.gravatar.com/avatar/9c276d9862277956ce66657db45543e6?s=128&d=identicon&r=PG", "display_name": "vijrox", "link": "https://stackoverflow.com/users/2049443/vijrox"}, "edited": false, "score": 0, "creation_date": 1463287604, "post_id": 37234459, "comment_id": 61998645, "body": "Ah I see what you mean. One thing I was hoping I could do: rather than making the function work <i>only</i> for <code>Integrals</code> and <code>Fractionals</code>, I wanted to make a default behavior for <code>Nums</code>, and then an alternate behavior if the <code>Num</code> happens to be an <code>Integral</code> and a different alternate behavior if the <code>Num</code> happens to be a <code>Fractional</code>. Am I trying to do something reasonable here? This way, the user doesn&#39;t need to see the typeclass <code>C a</code> (and preferably wouldn&#39;t see it, for the sake of abstraction)"}, {"owner": {"reputation": 2513, "user_id": 4725625, "user_type": "registered", "accept_rate": 70, "profile_image": "https://i.stack.imgur.com/YwH49.png?s=128&g=1", "display_name": "Kwarrtz", "link": "https://stackoverflow.com/users/4725625/kwarrtz"}, "reply_to_user": {"reputation": 971, "user_id": 2049443, "user_type": "registered", "accept_rate": 65, "profile_image": "https://www.gravatar.com/avatar/9c276d9862277956ce66657db45543e6?s=128&d=identicon&r=PG", "display_name": "vijrox", "link": "https://stackoverflow.com/users/2049443/vijrox"}, "edited": false, "score": 0, "creation_date": 1463288403, "post_id": 37234459, "comment_id": 61998773, "body": "Sadly, that kind of typeclass overriding isn&#39;t currently supported. You could open a feature request for a GHC language extension, but until then, you&#39;ll have to either take a look at a dependently typed language, like Idris, or find another way to implement it."}, {"owner": {"reputation": 971, "user_id": 2049443, "user_type": "registered", "accept_rate": 65, "profile_image": "https://www.gravatar.com/avatar/9c276d9862277956ce66657db45543e6?s=128&d=identicon&r=PG", "display_name": "vijrox", "link": "https://stackoverflow.com/users/2049443/vijrox"}, "edited": false, "score": 0, "creation_date": 1463288627, "post_id": 37234459, "comment_id": 61998813, "body": "Thanks! That&#39;s exactly what I was looking to have answered."}, {"owner": {"reputation": 10378, "user_id": 2476735, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/39e9447bbc32246fcd23b76b5e946618?s=128&d=identicon&r=PG&f=1", "display_name": "David Young", "link": "https://stackoverflow.com/users/2476735/david-young"}, "edited": false, "score": 1, "creation_date": 1463374477, "post_id": 37234459, "comment_id": 62022290, "body": "@Kwarrtz GHC won&#39;t let you have instances like that because it doesn&#39;t fit with the way instance resolution works. Here, the both of the instance heads are <code>C a</code>, which makes them duplicate instances (which is not allowed with <code>OVERLAPPING</code> pragmas or even the <code>IncoherentInstances</code> extension). The reason is that, when a instance needs to be chosen, it first looks for a matching instance head. That chosen instance is &quot;set in stone&quot; at this point, so to speak (GHC is determined to try to use this instance). Next, it checks the instance constraint. If the constraint fails, the type check fails."}], "tags": [], "owner": {"reputation": 2513, "user_id": 4725625, "user_type": "registered", "accept_rate": 70, "profile_image": "https://i.stack.imgur.com/YwH49.png?s=128&g=1", "display_name": "Kwarrtz", "link": "https://stackoverflow.com/users/4725625/kwarrtz"}, "is_accepted": true, "score": 4, "last_activity_date": 1463285641, "last_edit_date": 1463285641, "creation_date": 1463285283, "answer_id": 37234459, "question_id": 37234234, "link": "https://stackoverflow.com/questions/37234234/typeclass-style-default-methods-with-algebraic-data-types-involved/37234459#37234459", "title": "Typeclass-style default methods with algebraic data types involved?", "body": "<p>First off, what you want to do with the restriction of <code>a</code> to <code>Num</code> doesn't require anything nearly as elaborate as GADTs. If you have your type <code>Expression a</code> and a function <code>exprFunc</code>, you can declare it as follows.</p>\n\n<pre><code>exprFunc :: Num a =&gt; Expression a -&gt; Expression a\n</code></pre>\n\n<p>With this, <code>exprFunc</code> will only except arguments that are <code>Num</code>s. As for your second question, the only (accepted) way to do polymorphic functions in Haskell is through typeclasses. So, for your example with <code>Integral</code> and <code>Fractional</code>, the best way would be to do the following.</p>\n\n<pre><code>class Num a =&gt; C a where\n    exprMethod :: Expression a -&gt; Expression a\n</code></pre>\n\n<p>Now, you can define two separate definitions of <code>exprMethod</code> for <code>Fractional</code>s and <code>Integral</code>s.</p>\n\n<pre><code>instance Fractional a =&gt; C a where\n    exprMethod expr = &lt;some code&gt;\n\ninstance Integral a =&gt; C a where\n    exprMethod expr = &lt;some other code&gt;\n</code></pre>\n"}], "owner": {"reputation": 971, "user_id": 2049443, "user_type": "registered", "accept_rate": 65, "profile_image": "https://www.gravatar.com/avatar/9c276d9862277956ce66657db45543e6?s=128&d=identicon&r=PG", "display_name": "vijrox", "link": "https://stackoverflow.com/users/2049443/vijrox"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 173, "favorite_count": 0, "accepted_answer_id": 37234459, "answer_count": 1, "score": 1, "last_activity_date": 1463287950, "creation_date": 1463282820, "last_edit_date": 1463287950, "question_id": 37234234, "link": "https://stackoverflow.com/questions/37234234/typeclass-style-default-methods-with-algebraic-data-types-involved", "title": "Typeclass-style default methods with algebraic data types involved?", "body": "<p>I'm coming from Standard ML, and am new to Haskell so I'm still trying to wrap my head around the elaborate type system. I want to make a module exposing an algebraic datatype <code>Expression a</code> along with some functions that can be used with values of the type <code>Expression a</code>. That alone isn't too bad. Small caveat: I want to restrict the type <code>a</code> to be in the <code>Num</code> typeclass so the functions can work with <code>a</code> values as numbers. Still not too bad; after some poking around, I believe what I want to use for this is called a \"GADT\".</p>\n\n<p>Bigger caveat: so for the most part, the functions can be defined the same for all types in the <code>Num</code> typeclass. However, I want a few cases of a few of the functions to have some alternate behavior if <code>a</code> is in the <code>Integral</code> type class, and some alternate behavior if <code>a</code> is in the <code>Fractional</code> type class. For the most part though, everything is the same for all <code>Num</code> types so I don't want to have to rewrite everything separately for general case, <code>Integral</code>, and <code>Fractional</code>, as that would result in a lot of duplicate code.</p>\n\n<p>To my understanding this is called \"Ad hoc polymorphism\", which is something Haskell supports through the typeclass system. However, this appears to be more complicated for two reasons: 1, this is an ADT whose constructors must be used in the default functions as well as in the <code>Integral</code>-specific and <code>Fractional</code>-specific alternatives. 2, <code>Integral</code> and <code>Fractional</code> are typeclasses (not types) so I'm not sure if this makes it harder to make specific behavior for them.</p>\n\n<p>Again, I'm new to Haskell, so it's possible I'm thinking about this all wrong.</p>\n\n<p>Edit for clarification. The difficulty all boils down to: I want to make a default behavior for Nums, and then an alternate behavior if the Num happens to be an Integral and a different alternate behavior if the Num happens to be a Fractional.</p>\n"}, {"tags": ["haskell", "parsec"], "answers": [{"comments": [{"owner": {"reputation": 466, "user_id": 4416951, "user_type": "registered", "accept_rate": 93, "profile_image": "https://www.gravatar.com/avatar/643bc59a7a04024d9f6e5fadc8a00b74?s=128&d=identicon&r=PG", "display_name": "MrKickkiller", "link": "https://stackoverflow.com/users/4416951/mrkickkiller"}, "edited": false, "score": 0, "creation_date": 1463247331, "post_id": 37229793, "comment_id": 61989464, "body": "Reading your reply made me quickly realise my &quot;mistake&quot;. Every semicolon makes it so that it needs / wants another line / statement. And because an empty line can&#39;t be converted into a type, it&#39;s erroring. Thank you sir!"}], "tags": [], "owner": {"reputation": 49959, "user_id": 866915, "user_type": "registered", "accept_rate": 70, "profile_image": "https://www.gravatar.com/avatar/09242131d6e17cbbe31e8547514da6e5?s=128&d=identicon&r=PG", "display_name": "ErikR", "link": "https://stackoverflow.com/users/866915/erikr"}, "is_accepted": true, "score": 2, "last_activity_date": 1463247088, "creation_date": 1463247088, "answer_id": 37229793, "question_id": 37229263, "link": "https://stackoverflow.com/questions/37229263/parsec-extending-a-working-parser-gives-odd-results/37229793#37229793", "title": "Parsec: extending a working parser gives odd results", "body": "<p>I'm not convinced that your input parsed correctly before you made the changes. A list of statements is parsed using <code>sepBy1</code>:</p>\n\n<pre><code>sequenceOfStmt =\n  do list &lt;- (sepBy1 statement' semi)\n     -- If there's only one statement return it without using Seq.\n     return $ if length list == 1 then head list else Seq list\n</code></pre>\n\n<p><code>sequenceOfStmt</code> is greedy in that if it sees a semi-colon it will expect to see another <code>statement'</code>. So a semi-colon should be regarded as a statement separator as opposed to a statement terminator.</p>\n\n<p>Try running these tests to see how <code>sepBy1</code> behaves:</p>\n\n<pre><code>import Text.Parsec\nimport Text.Parsec.Combinator\n\np1 = sepBy1 (char 'a') (char ';')\n\ntest1 = parseTest p1 \"a;a\"      -- OK\ntest2 = parseTest p1 \"a;a;\"     -- FAILS\n</code></pre>\n\n<p>To help explore this issue, I've put the source for the ParseWhile language on lpaste.net: <a href=\"http://lpaste.net/163332\" rel=\"nofollow\">http://lpaste.net/163332</a></p>\n"}], "owner": {"reputation": 466, "user_id": 4416951, "user_type": "registered", "accept_rate": 93, "profile_image": "https://www.gravatar.com/avatar/643bc59a7a04024d9f6e5fadc8a00b74?s=128&d=identicon&r=PG", "display_name": "MrKickkiller", "link": "https://stackoverflow.com/users/4416951/mrkickkiller"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 58, "favorite_count": 0, "accepted_answer_id": 37229793, "answer_count": 1, "score": 1, "last_activity_date": 1463247088, "creation_date": 1463243954, "question_id": 37229263, "link": "https://stackoverflow.com/questions/37229263/parsec-extending-a-working-parser-gives-odd-results", "title": "Parsec: extending a working parser gives odd results", "body": "<p>For a project, we are tasked to build a haskell parser / evaluator that controls a tiny arduino robot.</p>\n\n<p>So to start of, I basically did some research on already implemented parser setups, and came across this one: <a href=\"https://wiki.haskell.org/Parsing_a_simple_imperative_language\" rel=\"nofollow\">https://wiki.haskell.org/Parsing_a_simple_imperative_language</a>.</p>\n\n<p>After (admittedly) copy-pasting the code, I started to test it. And it worked \\o/.\nNow it was time to extend it's functionality.</p>\n\n<p>Edited code:</p>\n\n<pre><code>data Stmt = Seq [Stmt]\n     | Assign String AExpr\n     | If BExpr Stmt Stmt\n     | While BExpr Stmt\n     | Motor String AExpr\n     | Skip\n       deriving (Show)\n\nToken.reservedNames   = [ \"if\"\n                                , \"then\"\n                                , \"else\"\n                                , \"while\"\n                                , \"do\"\n                                , \"skip\"\n                                , \"true\"\n                                , \"false\"\n                                , \"not\"\n                                , \"and\"\n                                , \"or\", \"set\" , \"to\"\n                                ]\nstatement' :: Parser Stmt\nstatement' =   ifStmt\n      &lt;|&gt; whileStmt\n      &lt;|&gt; skipStmt\n      &lt;|&gt; assignStmt\n      &lt;|&gt; motorStatement\n\nmotorStatement :: Parser Stmt\nmotorStatement =\n  do reserved \"set\"\n     var &lt;- identifier\n     reserved \"to\"\n     expr &lt;- aExpression\n     return $ Motor var expr\n</code></pre>\n\n<p>These are the only pieces of code I edited.\nTo test it all, I made a small testfile:</p>\n\n<pre><code>x := 4;\nx := 6;\n</code></pre>\n\n<p>The above code parsed beatifully before my changes, but after I added the changes I get the following error</p>\n\n<pre><code>&lt; (line 3, column 1):\n&lt; unexpected end of input\n&lt; expecting \"if\", \"while\", \"skip\", identifier or \"set\"\n</code></pre>\n\n<p>With my limited knowledge of Haskell, i'm unable to figure out why this \"<code>unexpected end of input</code>\" is happening.</p>\n\n<p>Perhaps some Haskeller here is able to point me the error.</p>\n"}, {"tags": ["haskell", "servant"], "comments": [{"owner": {"reputation": 2513, "user_id": 4725625, "user_type": "registered", "accept_rate": 70, "profile_image": "https://i.stack.imgur.com/YwH49.png?s=128&g=1", "display_name": "Kwarrtz", "link": "https://stackoverflow.com/users/4725625/kwarrtz"}, "edited": false, "score": 2, "creation_date": 1463269906, "post_id": 37229098, "comment_id": 61995721, "body": "It might be helpful if you included the actual declaration of <code>AuthMonad</code>. Also, what <code>enter</code> are you talking about? If you aren&#39;t going to provide its type, at least provide a link to the package that it is in."}, {"owner": {"reputation": 253, "user_id": 1574847, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/8fd1196806c87c4732993c77362452f3?s=128&d=identicon&r=PG", "display_name": "ewestern", "link": "https://stackoverflow.com/users/1574847/ewestern"}, "reply_to_user": {"reputation": 2513, "user_id": 4725625, "user_type": "registered", "accept_rate": 70, "profile_image": "https://i.stack.imgur.com/YwH49.png?s=128&g=1", "display_name": "Kwarrtz", "link": "https://stackoverflow.com/users/4725625/kwarrtz"}, "edited": false, "score": 0, "creation_date": 1463323933, "post_id": 37229098, "comment_id": 62008434, "body": "I guess I should have mentioned in the body in addition to the tags, this is a question specific to <a href=\"https://hackage.haskell.org/package/servant\" rel=\"nofollow noreferrer\">haskell-servant</a>"}, {"owner": {"reputation": 9772, "user_id": 3963, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/9pDQ8.png?s=128&g=1", "display_name": "hao", "link": "https://stackoverflow.com/users/3963/hao"}, "edited": false, "score": 0, "creation_date": 1463688959, "post_id": 37229098, "comment_id": 62184492, "body": "I second Kwarrtz: I think the question is hard to answer without more information about <code>AuthMonad</code>. It&#39;s difficult to write the <code>Nat</code>ural transformation required without knowing its definition."}], "answers": [{"tags": [], "owner": {"reputation": 253, "user_id": 1574847, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/8fd1196806c87c4732993c77362452f3?s=128&d=identicon&r=PG", "display_name": "ewestern", "link": "https://stackoverflow.com/users/1574847/ewestern"}, "is_accepted": true, "score": 0, "last_activity_date": 1511727523, "creation_date": 1511727523, "answer_id": 47500631, "question_id": 37229098, "link": "https://stackoverflow.com/questions/37229098/using-authentication-with-a-custom-reader-monad-with-servant/47500631#47500631", "title": "Using Authentication With a Custom Reader Monad With Servant", "body": "<p>Just realized I left this one hanging.</p>\n\n<p>Mostly, was just over-thinking this one -- the answer is pretty obvious.\nIn the above case I made a function that would create the natural transformation:</p>\n\n<pre><code>enterAuth :: AuthData -&gt; AuthMonad :~&gt; Handler\n</code></pre>\n\n<p>Which I then used when constructing the ServerT:</p>\n\n<pre><code>protectedServer :: AuthData -&gt; ServerT ProtectedAPI Handler\nprotectedServer ad = enter (enterAuth ad) protectedServer'\n</code></pre>\n\n<p>where</p>\n\n<pre><code>genAuthServerContext :: Context (AuthHandler Request AuthData ': '[])\n</code></pre>\n"}], "owner": {"reputation": 253, "user_id": 1574847, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/8fd1196806c87c4732993c77362452f3?s=128&d=identicon&r=PG", "display_name": "ewestern", "link": "https://stackoverflow.com/users/1574847/ewestern"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 286, "favorite_count": 2, "accepted_answer_id": 47500631, "answer_count": 1, "score": 6, "last_activity_date": 1511727523, "creation_date": 1463242997, "last_edit_date": 1463323961, "question_id": 37229098, "link": "https://stackoverflow.com/questions/37229098/using-authentication-with-a-custom-reader-monad-with-servant", "title": "Using Authentication With a Custom Reader Monad With Servant", "body": "<p>An API protected with Basic Authentication</p>\n\n<pre><code>type SubApi = API1 :&lt;|&gt; API2 :&lt;|&gt; API3\ntype API = BasicAuth \"foo-realm\" AuthData :&gt; SubApi\n</code></pre>\n\n<p>supports handlers of type <code>AuthData -&gt; Handler a</code>. </p>\n\n<p>I have a set of handlers:</p>\n\n<pre><code>handler1 :: Request1 -&gt; AuthMonad Response\nhandler2 :: Request2 -&gt; AuthMonad Response\n</code></pre>\n\n<p>That run in an AuthMonad, which is a ReaderT whose context is constructed in part from AuthData.\nUsing <code>enter</code> and <code>AuthMonad :~&gt; Handler</code>, I can get a <code>Server API</code> supporting handlers of type <code>AuthData -&gt; AuthMonad</code>, but what I'd really like to do is use the <code>AuthData</code> argument as the environment to runReaderT.</p>\n\n<p>I don't quite grok enough of the type wizardry going on with <code>enter</code> to understand how to do this. Any ideas? </p>\n"}, {"tags": ["haskell", "monad-transformers"], "answers": [{"tags": [], "owner": {"reputation": 24266, "user_id": 946226, "user_type": "registered", "accept_rate": 59, "profile_image": "https://www.gravatar.com/avatar/5823d09208b1e4b63bbfcd189492032c?s=128&d=identicon&r=PG", "display_name": "Joachim Breitner", "link": "https://stackoverflow.com/users/946226/joachim-breitner"}, "is_accepted": false, "score": 3, "last_activity_date": 1463240317, "creation_date": 1463240317, "answer_id": 37228604, "question_id": 37228540, "link": "https://stackoverflow.com/questions/37228540/intuition-for-maybet/37228604#37228604", "title": "Intuition for MaybeT", "body": "<p>You will never get a <code>Left Nothing</code> or <code>Left (Just ..)</code>, as the monad here is <code>Either String \u2026</code>, so that in the left you will always have a <code>String</code>.</p>\n\n<p>Here is what you can get:</p>\n\n<pre><code>&gt; let y = fail \"Failed\" :: MaybeT (Either String) Int\n&gt; runMaybeT y\nRight Nothing\n&gt; let y = lift (Left \"Failed\") :: MaybeT (Either String) Int\n&gt; runMaybeT y\nLeft \"Failed\"\n</code></pre>\n"}, {"tags": [], "owner": {"reputation": 49959, "user_id": 866915, "user_type": "registered", "accept_rate": 70, "profile_image": "https://www.gravatar.com/avatar/09242131d6e17cbbe31e8547514da6e5?s=128&d=identicon&r=PG", "display_name": "ErikR", "link": "https://stackoverflow.com/users/866915/erikr"}, "is_accepted": false, "score": 0, "last_activity_date": 1463284419, "creation_date": 1463284419, "answer_id": 37234385, "question_id": 37228540, "link": "https://stackoverflow.com/questions/37228540/intuition-for-maybet/37234385#37234385", "title": "Intuition for MaybeT", "body": "<p>This might help gain some insight into what's going on underneath the hood with MaybeT...</p>\n\n<p>In the IO monad we have computations, e.g.</p>\n\n<pre><code>putStrLn \"Hello, world!\" :: IO ()\ngetContents :: IO String\n</code></pre>\n\n<p>etc. All of these computations have type <code>IO a</code>, and in fact the type variable <code>a</code> is unrestricted - it can be any type. Using <code>return</code> we can create an IO computation <code>IO a</code> for any type <code>a</code>.</p>\n\n<p><strong><em>You can think of <code>MaybeT IO</code> as being those IO computations which return a Maybe value.</em></strong></p>\n\n<p>For instance, <code>getContents</code> is an <code>IO</code> computation but not a <code>MaybeT IO</code> computation. However, there is a kinda obvious way to convert <code>getContents</code> into a <code>MaybeT IO</code> computation -- simply wrap its output in the <code>Just</code> constructor:</p>\n\n<pre><code>lift getContents   ===   fmap Just getContents\n</code></pre>\n\n<p><code>lift</code> is the way to promote an <code>IO</code> computation to a <code>MaybeT IO</code> computation. Applying this to <code>return_IO</code> (the <code>return</code> function for the <code>IO</code> monad) we have:</p>\n\n<pre><code>return_(MaybeT IO) === lift return_IO === fmap Just return_IO\n</code></pre>\n\n<p>That is, <code>return 3</code> (in the <code>MaybeT IO</code> monad) is the same as <code>return (Just 3)</code> in the <code>IO</code> monad.</p>\n\n<p><strong><em>runMaybeT and MaybeT are inverses of each other</em></strong></p>\n\n<p>Now have a look at the <a href=\"https://hackage.haskell.org/package/transformers-0.5.2.0/docs/src/Control.Monad.Trans.Maybe.html#MaybeT\" rel=\"nofollow\">definition of <code>MaybeT</code></a></p>\n\n<pre><code>newtype MaybeT m a = MaybeT { runMaybeT :: m (Maybe a) }\n</code></pre>\n\n<p>This also describes the idea that computations in <code>MaybeT m</code> are the same as computations in <code>m</code> which return a Maybe value. The functions:</p>\n\n<pre><code>MaybeT    :: m (Maybe a) -&gt; MaybeT m a\nrunMaybeT :: MaybeT m a  -&gt; m (Maybe a)\n</code></pre>\n\n<p>are inverses of each other and don't really do anything except add or remove the newtype wrapper. In the case of the <code>IO</code> monad:</p>\n\n<pre><code>MaybeT    :: IO (Maybe a) -&gt; MaybeT IO a\nrunMaybeT :: MaybeT IO a  -&gt; IO (Maybe a)\n</code></pre>\n\n<p>Considering the example in your question, we see that computations in <code>MaybeT (Either String)</code> are essentially the same as values of type <code>Either String (Maybe a)</code> for any type <code>a</code>. This leads to the following possibilities:</p>\n\n<ul>\n<li><code>Left</code> of some string</li>\n<li><code>Right (Just ...)</code></li>\n<li><code>Right Nothing</code></li>\n</ul>\n\n<p>These all exist in <code>Either String (Maybe a)</code>, and if we apply the constructor <code>MaybeT</code> to each of them we get the corresponding values in <code>MaybeT (Either String) a</code>.</p>\n\n<p>In particular, to find a <code>y</code> s.t.</p>\n\n<pre><code>runMaybeT y == Right Nothing\n</code></pre>\n\n<p>just use:</p>\n\n<pre><code>          y = MaybeT (Right Nothing)\n</code></pre>\n\n<p>Again, <code>runMaybeT</code> and <code>MaybeT</code> are inverses of each other, so you can arrive at the same result by applying <code>MaybeT</code> to both sides.</p>\n"}], "owner": {"reputation": 37991, "user_id": 409976, "user_type": "registered", "accept_rate": 68, "profile_image": "https://www.gravatar.com/avatar/9ccda0b49cc974197399eae01ebd6850?s=128&d=identicon&r=PG", "display_name": "Kevin Meredith", "link": "https://stackoverflow.com/users/409976/kevin-meredith"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 227, "favorite_count": 0, "answer_count": 2, "score": 3, "last_activity_date": 1463284419, "creation_date": 1463239980, "question_id": 37228540, "link": "https://stackoverflow.com/questions/37228540/intuition-for-maybet", "title": "Intuition for MaybeT", "body": "<p>I'm trying to understand <code>MaybeT</code> by running a few examples in <code>ghci</code>:</p>\n\n<pre><code>\u03bb: import Control.Monad.Trans.Maybe\n\u03bb: let x = return $ 42 :: MaybeT (Either String) Int\n\u03bb: :t x\nx :: MaybeT (Either String) Int\n</code></pre>\n\n<p>Then, I ran it:</p>\n\n<pre><code>\u03bb: runMaybeT x\nRight (Just 42)\n</code></pre>\n\n<p>Please give me value, <code>y</code>, such that</p>\n\n<pre><code>runMaybeT y === Left (Just \"...\")\nrunMaybeT y === Left Nothing\nrunMaybeT y === Right Nothing\n</code></pre>\n"}, {"tags": ["haskell", "yesod", "persistent", "scotty", "hspec"], "answers": [{"tags": [], "owner": {"reputation": 49959, "user_id": 866915, "user_type": "registered", "accept_rate": 70, "profile_image": "https://www.gravatar.com/avatar/09242131d6e17cbbe31e8547514da6e5?s=128&d=identicon&r=PG", "display_name": "ErikR", "link": "https://stackoverflow.com/users/866915/erikr"}, "is_accepted": false, "score": 4, "last_activity_date": 1463245451, "creation_date": 1463245451, "answer_id": 37229509, "question_id": 37227090, "link": "https://stackoverflow.com/questions/37227090/scotty-with-persistent-and-hspec-wai/37229509#37229509", "title": "Scotty with Persistent and Hspec-wai", "body": "<p>Here's how you can do it. Basically you open the database before you make the <code>hspec</code> call:</p>\n\n<pre><code>{-# LANGUAGE OverloadedStrings #-}\n\nimport           Test.Hspec\nimport           Test.Hspec.Wai\nimport           Network.Wai (Application)\nimport qualified Web.Scotty as S\n\nallocate_db :: (Int -&gt; IO a) -&gt; IO a\nallocate_db = undefined\n\nhandleSomeRoute :: Int -&gt; S.ScottyM ()\nhandleSomeRoute = undefined\n\nmain2 :: IO ()\nmain2 = allocate_db $ \\pool -&gt; do\n  let app' = handleSomeRoute pool\n  hspec $ with (S.scottyApp app') $ do\n            describe \"GET /\" $ do\n              it \"responds with 200\" $ do\n                get \"/\" `shouldRespondWith` 200\n</code></pre>\n"}], "owner": {"reputation": 2387, "user_id": 54024, "user_type": "registered", "accept_rate": 36, "profile_image": "https://www.gravatar.com/avatar/5b42865e660a167f7021ba5ff2d9b8c9?s=128&d=identicon&r=PG", "display_name": "Chad Brewbaker", "link": "https://stackoverflow.com/users/54024/chad-brewbaker"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 311, "favorite_count": 0, "answer_count": 1, "score": 1, "last_activity_date": 1463245451, "creation_date": 1463231517, "question_id": 37227090, "link": "https://stackoverflow.com/questions/37227090/scotty-with-persistent-and-hspec-wai", "title": "Scotty with Persistent and Hspec-wai", "body": "<p>Problem trying to unit test routes. Scotty, Persistent, and Hspec-WAI.</p>\n\n<p>Unlike Yesod or Spock, Scotty doesn't have a nice place to store database handlers. I've got it working by having one massive \"do\" that starts up the database, keeps the database pool as a local variable, then uses that variable.</p>\n\n<pre><code>app :: IO ()\napp = do\n    -- allocate_database  $ \\pool\n      -- scotty 8080 $do \n      --     handleSomeRoute pool\n</code></pre>\n\n<p>However, Hspec-WAI wants it in the IO Application form.</p>\n\n<pre><code>scottyApp :: ScottyM () -&gt; IO Application\n</code></pre>\n\n<p>Is there a sane way to inject the DB connection pool into a scottyApp ?</p>\n"}, {"tags": ["haskell"], "comments": [{"owner": {"reputation": 48938, "user_id": 246886, "user_type": "registered", "accept_rate": 94, "profile_image": "https://www.gravatar.com/avatar/dd1ebaade6623fc538fb8af3338e730d?s=128&d=identicon&r=PG", "display_name": "Jon Purdy", "link": "https://stackoverflow.com/users/246886/jon-purdy"}, "edited": false, "score": 0, "creation_date": 1463254029, "post_id": 37225909, "comment_id": 61991667, "body": "This is part of the reason I prefer <code>case</code> for most functions: I often want to use a <code>where</code> clause definition in multiple branches, and equational style doesn\u2019t allow it."}], "answers": [{"comments": [{"owner": {"reputation": 2106, "user_id": 916384, "user_type": "registered", "accept_rate": 81, "profile_image": "https://www.gravatar.com/avatar/38055799f271a72b7d50d91c322ce561?s=128&d=identicon&r=PG", "display_name": "franza", "link": "https://stackoverflow.com/users/916384/franza"}, "edited": false, "score": 0, "creation_date": 1463224786, "post_id": 37225940, "comment_id": 61981956, "body": "Yes, I have already mentioned about <code>dropWhile (==1)</code> in question, meaning that this example is only to describe my concern. However, I have never known about this feature, so thank you."}], "tags": [], "owner": {"reputation": 37219, "user_id": 1523776, "user_type": "moderator", "accept_rate": 87, "profile_image": "https://www.gravatar.com/avatar/b3e0b5c8e42a8c38009ef2d969f8dabb?s=128&d=identicon&r=PG", "display_name": "Benjamin Hodgson", "link": "https://stackoverflow.com/users/1523776/benjamin-hodgson"}, "is_accepted": true, "score": 5, "last_activity_date": 1463224480, "creation_date": 1463224480, "answer_id": 37225940, "question_id": 37225909, "link": "https://stackoverflow.com/questions/37225909/haskell-unexpected-not-in-scope-error-for-simple-function/37225940#37225940", "title": "Haskell: unexpected &quot;Not in scope&quot; error for simple function", "body": "<p>Names defined in a <code>where</code> clause are only in scope over the branch that the <code>where</code> clause is attached to.</p>\n\n<p>This version of your definition will compile, because I attached the <code>where</code> clause to the branch of <code>ignoreFirstOnes</code> that uses <code>isOne</code>.</p>\n\n<pre><code>ignoreFirstOnes :: [Int] -&gt; [Int]\nignoreFirstOnes (1:xs) = dropWhile isOne xs\n    where isOne = (== 1)\nignoreFirstOnes xs = xs\n</code></pre>\n\n<p>Though note that this definition is equivalent to <code>ignoreFirstOnes = dropWhile (==1)</code>, which I think is simpler.</p>\n"}], "owner": {"reputation": 2106, "user_id": 916384, "user_type": "registered", "accept_rate": 81, "profile_image": "https://www.gravatar.com/avatar/38055799f271a72b7d50d91c322ce561?s=128&d=identicon&r=PG", "display_name": "franza", "link": "https://stackoverflow.com/users/916384/franza"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 62, "favorite_count": 0, "accepted_answer_id": 37225940, "answer_count": 1, "score": 3, "last_activity_date": 1463224480, "creation_date": 1463224310, "question_id": 37225909, "link": "https://stackoverflow.com/questions/37225909/haskell-unexpected-not-in-scope-error-for-simple-function", "title": "Haskell: unexpected &quot;Not in scope&quot; error for simple function", "body": "<p>This is very ad-hoc example describes <code>Not in scope: isOne</code> error that I have:</p>\n\n<pre><code>ignoreFirstOnes :: [Int] -&gt; [Int]\nignoreFirstOnes (1:xs) = dropWhile isOne xs\nignoreFirstOnes xs     = xs\n  where isOne = (== 1)\n</code></pre>\n\n<p>Strange that <code>isOne</code> function was defined in <code>where</code>, however compiler keeps complaining. I can rewrite that using guards or even to <code>dropWhile (== 1)</code> but I would like to understand how to make work the current example.</p>\n"}, {"tags": ["haskell", "types", "primitive"], "answers": [{"comments": [{"owner": {"reputation": 1666, "user_id": 794779, "user_type": "registered", "accept_rate": 93, "profile_image": "https://www.gravatar.com/avatar/6fcb78bccab141509b0d9f74953dd4c9?s=128&d=identicon&r=PG", "display_name": "fred", "link": "https://stackoverflow.com/users/794779/fred"}, "edited": false, "score": 0, "creation_date": 1463224552, "post_id": 37225816, "comment_id": 61981888, "body": "would you mind elaborating on the differences between do the same thing, use type from Data.Word or the inefficient suggestion? Maybe also Liquid Haskell?"}, {"owner": {"reputation": 30739, "user_id": 1804599, "user_type": "registered", "accept_rate": 84, "profile_image": "https://i.stack.imgur.com/v91P3.jpg?s=128&g=1", "display_name": "rightfold", "link": "https://stackoverflow.com/users/1804599/rightfold"}, "reply_to_user": {"reputation": 1666, "user_id": 794779, "user_type": "registered", "accept_rate": 93, "profile_image": "https://www.gravatar.com/avatar/6fcb78bccab141509b0d9f74953dd4c9?s=128&d=identicon&r=PG", "display_name": "fred", "link": "https://stackoverflow.com/users/794779/fred"}, "edited": false, "score": 0, "creation_date": 1463224885, "post_id": 37225816, "comment_id": 61981990, "body": "Exposing a smart constructor for <code>Age</code> is some work; you have to create a newtype and two functions; but it&#39;s efficient and easy to use. <code>Data.Word</code> is just an unsigned integer, like <code>uint</code> in C#. There&#39;s little benefit to using the <code>Zero</code>/<code>PlusOne</code> representation, really. I know very little about Liquid Haskell, but in F*, which also features refinement types, you would write <code>type Age = i : int { i &gt;= 0 }</code> and the type checker will reject your program when it isn&#39;t 100% sure that the age you pass is greater than or equal to zero."}, {"owner": {"reputation": 44013, "user_id": 1477667, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/trgKM.jpg?s=128&g=1", "display_name": "dfeuer", "link": "https://stackoverflow.com/users/1477667/dfeuer"}, "edited": false, "score": 0, "creation_date": 1510172674, "post_id": 37225816, "comment_id": 81327321, "body": "I know this is just a silly example, but a lot of people make the real-world mistake of setting a length limit for names that&#39;s too short to handle all the names people actually have. Some limits are reasonable to avoid DOS attacks and such, but I&#39;d be very suspicious of a name length limit under 256 characters or so, and if I were designing the system I&#39;d want to consult an expert to make sure that was enough."}], "tags": [], "owner": {"reputation": 30739, "user_id": 1804599, "user_type": "registered", "accept_rate": 84, "profile_image": "https://i.stack.imgur.com/v91P3.jpg?s=128&g=1", "display_name": "rightfold", "link": "https://stackoverflow.com/users/1804599/rightfold"}, "is_accepted": true, "score": 8, "last_activity_date": 1463224074, "last_edit_date": 1463224074, "creation_date": 1463223721, "answer_id": 37225816, "question_id": 37225777, "link": "https://stackoverflow.com/questions/37225777/avoiding-primitive-obsession-in-haskell/37225816#37225816", "title": "Avoiding primitive obsession in Haskell", "body": "<p>Make <code>Name</code> abstract and provide a smart constructor. This means that you do not export the <code>Name</code> data constructor, and provide a <code>Maybe</code>-returning constructor instead:</p>\n\n<pre><code>module Data.Name\n( Name -- note: only export type, not data constructor\n, fromString\n, toString\n) where\n\nnewtype Name = Name String\n\nfromString :: String -&gt; Maybe Name\nfromString n | null n         = Nothing\n             | length n &gt; 100 = Nothing\n             | otherwise      = Just (Name n)\n\ntoString :: Name -&gt; String\ntoString (Name n) = n\n</code></pre>\n\n<p>It is now impossible to construct a <code>Name</code> value of the wrong length outside of this module.</p>\n\n<p>For <code>Age</code>, you could do the same thing, or use a type from <code>Data.Word</code>, or use the following inefficient but guaranteed non-negative representation:</p>\n\n<pre><code>data Age = Zero | PlusOne Age\n</code></pre>\n"}, {"comments": [{"owner": {"reputation": 1666, "user_id": 794779, "user_type": "registered", "accept_rate": 93, "profile_image": "https://www.gravatar.com/avatar/6fcb78bccab141509b0d9f74953dd4c9?s=128&d=identicon&r=PG", "display_name": "fred", "link": "https://stackoverflow.com/users/794779/fred"}, "edited": false, "score": 0, "creation_date": 1463265729, "post_id": 37229683, "comment_id": 61994833, "body": "In my experience, virtually all devs and codebases in all languages prefer primitives for everything, and use variable names and inline validations rather than classes/types to indicate and validate what things are. They&#39;d say my example was class/type obsession and call that a code smell."}, {"owner": {"reputation": 44013, "user_id": 1477667, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/trgKM.jpg?s=128&g=1", "display_name": "dfeuer", "link": "https://stackoverflow.com/users/1477667/dfeuer"}, "reply_to_user": {"reputation": 1666, "user_id": 794779, "user_type": "registered", "accept_rate": 93, "profile_image": "https://www.gravatar.com/avatar/6fcb78bccab141509b0d9f74953dd4c9?s=128&d=identicon&r=PG", "display_name": "fred", "link": "https://stackoverflow.com/users/794779/fred"}, "edited": false, "score": 0, "creation_date": 1463341102, "post_id": 37229683, "comment_id": 62014529, "body": "@fred, it really depends on context and how the program grows. Premature abstraction and premature generalization can waste a lot of time if your initial guesses are wrong. <code>Person</code> seems like a fairly reasonable base abstraction, but again, that depends on the program."}, {"owner": {"reputation": 3683, "user_id": 330242, "user_type": "registered", "accept_rate": 78, "profile_image": "https://www.gravatar.com/avatar/c9f3ffc3e30d25eb64e2e464f0a86bd7?s=128&d=identicon&r=PG", "display_name": "przemo_li", "link": "https://stackoverflow.com/users/330242/przemo-li"}, "edited": false, "score": 0, "creation_date": 1510158684, "post_id": 37229683, "comment_id": 81318848, "body": "Ridiculous. Haskell have phantom types, expressive polymorphism, smart constructors, exposing types without constructors. All the things to effectively deal with primitive obsession!  Primitive obsession - when in memory representation differ in any way from legitimate domain data+behaviour.  (E.g. absolute size and relative size will be represented by the same values in computer memory, however confusing one with other will have dire consequences. Add phantom type. Hakell will point those mistakes out)"}, {"owner": {"reputation": 44013, "user_id": 1477667, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/trgKM.jpg?s=128&g=1", "display_name": "dfeuer", "link": "https://stackoverflow.com/users/1477667/dfeuer"}, "reply_to_user": {"reputation": 3683, "user_id": 330242, "user_type": "registered", "accept_rate": 78, "profile_image": "https://www.gravatar.com/avatar/c9f3ffc3e30d25eb64e2e464f0a86bd7?s=128&d=identicon&r=PG", "display_name": "przemo_li", "link": "https://stackoverflow.com/users/330242/przemo-li"}, "edited": false, "score": 0, "creation_date": 1510172446, "post_id": 37229683, "comment_id": 81327192, "body": "@przemo_li, I don&#39;t understand what point you&#39;re trying to make."}, {"owner": {"reputation": 3683, "user_id": 330242, "user_type": "registered", "accept_rate": 78, "profile_image": "https://www.gravatar.com/avatar/c9f3ffc3e30d25eb64e2e464f0a86bd7?s=128&d=identicon&r=PG", "display_name": "przemo_li", "link": "https://stackoverflow.com/users/330242/przemo-li"}, "edited": false, "score": 0, "creation_date": 1510222245, "post_id": 37229683, "comment_id": 81346622, "body": "It was attempt at hyperbole ;) But I do see your point, one could move validity checks to Person without loosing much.  -- That beeing said, moving validity checks from Person to Name and Age would allow to simplify tests. If Name and Age is always correct, there is nothing to test in Person, because valid Person is a combination of any Name with any Age."}], "tags": [], "owner": {"reputation": 44013, "user_id": 1477667, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/trgKM.jpg?s=128&g=1", "display_name": "dfeuer", "link": "https://stackoverflow.com/users/1477667/dfeuer"}, "is_accepted": false, "score": 2, "last_activity_date": 1463246412, "creation_date": 1463246412, "answer_id": 37229683, "question_id": 37225777, "link": "https://stackoverflow.com/questions/37225777/avoiding-primitive-obsession-in-haskell/37229683#37229683", "title": "Avoiding primitive obsession in Haskell", "body": "<p>This may be code smell in some languages, but it's not usually considered one in Haskell. You have to choose a concrete representation of a name and birth date <em>somewhere</em>, and the datatype declaration of <code>Person</code> is probably the best place to do it. In Haskell, the usual way to keep other code from depending on the name representation would be to make <code>Person</code> abstract. Instead of exposing the <code>Person</code> constructor, expose functions for creating, modifying, and inspecting <code>Person</code> values.</p>\n"}], "owner": {"reputation": 1666, "user_id": 794779, "user_type": "registered", "accept_rate": 93, "profile_image": "https://www.gravatar.com/avatar/6fcb78bccab141509b0d9f74953dd4c9?s=128&d=identicon&r=PG", "display_name": "fred", "link": "https://stackoverflow.com/users/794779/fred"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 238, "favorite_count": 0, "accepted_answer_id": 37225816, "answer_count": 2, "score": 2, "last_activity_date": 1463246412, "creation_date": 1463223458, "question_id": 37225777, "link": "https://stackoverflow.com/questions/37225777/avoiding-primitive-obsession-in-haskell", "title": "Avoiding primitive obsession in Haskell", "body": "<p>From <a href=\"http://learnyouahaskell.com/making-our-own-types-and-typeclasses\" rel=\"nofollow\">http://learnyouahaskell.com/making-our-own-types-and-typeclasses</a></p>\n\n<pre><code>data Person = Person { name :: String  \n                     , age :: Int  \n                     } deriving (Show)   \n</code></pre>\n\n<p>In a real application, using primitives like String and Int for name and age would constitue primitive obsession, a code smell. (also obviously Date born is preferable to Int age but let's ignore that) Instead, one would prefer something like</p>\n\n<pre><code>newtype Person = Person { name :: Name  \n                        , age :: Age  \n                        } deriving (Show)   \n</code></pre>\n\n<p>In an OO language this would look something like</p>\n\n<pre><code>class Person {\n  Name name;\n  Age age;\n  Person(Name name, Age age){\n    if (name == null || age == null)\n      throw IllegalArgumentException();\n    this.name = name;\n    this.age = age;\n  }\n}\n\nclass Name extends String {\n  Name(String name){\n    if (name == null || name.isEmpty() || name.length() &gt; 100)\n      throw IllegalArgumentException();\n    super(name);\n  }\n}\n\nclass Age extends Integer {\n  Age(Integer age){\n    if (age == null || age &lt; 0)\n      throw IllegalArgumentException();\n    super(age);\n  }\n}\n</code></pre>\n\n<p>But how is the same achieved in idiomatic, best practice Haskell?</p>\n"}, {"tags": ["haskell"], "comments": [{"owner": {"reputation": 21417, "user_id": 925978, "user_type": "registered", "accept_rate": 84, "profile_image": "https://www.gravatar.com/avatar/06e4467a5bd1538a92cefb20db07897a?s=128&d=identicon&r=PG&f=1", "display_name": "crockeea", "link": "https://stackoverflow.com/users/925978/crockeea"}, "edited": false, "score": 0, "creation_date": 1463336483, "post_id": 37224366, "comment_id": 62012958, "body": "My 7.10.3 says <code>parse error on input &#39;|&#39;</code>, rather than suggesting the bogus extension. Is your editor using a linter of some sort? The suggestion to add <code>RegularPatterns</code> is a bug in <i>something</i>..."}, {"owner": {"reputation": 3436, "user_id": 4364027, "user_type": "registered", "accept_rate": 64, "profile_image": "https://www.gravatar.com/avatar/e84dbb0e9c838c25bbb70b326fd696aa?s=128&d=identicon&r=PG&f=1", "display_name": "Marko Grdinic", "link": "https://stackoverflow.com/users/4364027/marko-grdinic"}, "reply_to_user": {"reputation": 21417, "user_id": 925978, "user_type": "registered", "accept_rate": 84, "profile_image": "https://www.gravatar.com/avatar/06e4467a5bd1538a92cefb20db07897a?s=128&d=identicon&r=PG&f=1", "display_name": "crockeea", "link": "https://stackoverflow.com/users/925978/crockeea"}, "edited": false, "score": 0, "creation_date": 1463336667, "post_id": 37224366, "comment_id": 62013024, "body": "Actually, when I said that it did not seem like it was added recently, I meant that it was there for a while as it did not have a version number. It is right there in the documentation."}, {"owner": {"reputation": 21417, "user_id": 925978, "user_type": "registered", "accept_rate": 84, "profile_image": "https://www.gravatar.com/avatar/06e4467a5bd1538a92cefb20db07897a?s=128&d=identicon&r=PG&f=1", "display_name": "crockeea", "link": "https://stackoverflow.com/users/925978/crockeea"}, "edited": false, "score": 0, "creation_date": 1463337040, "post_id": 37224366, "comment_id": 62013149, "body": "The link to docs in your post is for GHC 7.4.2, from 2012. <a href=\"https://downloads.haskell.org/~ghc/latest/docs/html/users_guide/flag-reference.html#idp46686514436848\" rel=\"nofollow noreferrer\">This</a> is a list of the latest flags. But this doesn&#39;t address the tool that suggested the extension in the first place."}, {"owner": {"reputation": 3436, "user_id": 4364027, "user_type": "registered", "accept_rate": 64, "profile_image": "https://www.gravatar.com/avatar/e84dbb0e9c838c25bbb70b326fd696aa?s=128&d=identicon&r=PG&f=1", "display_name": "Marko Grdinic", "link": "https://stackoverflow.com/users/4364027/marko-grdinic"}, "reply_to_user": {"reputation": 21417, "user_id": 925978, "user_type": "registered", "accept_rate": 84, "profile_image": "https://www.gravatar.com/avatar/06e4467a5bd1538a92cefb20db07897a?s=128&d=identicon&r=PG&f=1", "display_name": "crockeea", "link": "https://stackoverflow.com/users/925978/crockeea"}, "edited": false, "score": 0, "creation_date": 1463337696, "post_id": 37224366, "comment_id": 62013348, "body": "I see, you are right. It might be worth reporting the bug then. I&#39;ll look into that tomorrow."}, {"owner": {"reputation": 21417, "user_id": 925978, "user_type": "registered", "accept_rate": 84, "profile_image": "https://www.gravatar.com/avatar/06e4467a5bd1538a92cefb20db07897a?s=128&d=identicon&r=PG&f=1", "display_name": "crockeea", "link": "https://stackoverflow.com/users/925978/crockeea"}, "edited": false, "score": 0, "creation_date": 1463338010, "post_id": 37224366, "comment_id": 62013462, "body": "The question is who to report the bug to. It&#39;s doesn&#39;t appear to be GHC&#39;s fault."}, {"owner": {"reputation": 3436, "user_id": 4364027, "user_type": "registered", "accept_rate": 64, "profile_image": "https://www.gravatar.com/avatar/e84dbb0e9c838c25bbb70b326fd696aa?s=128&d=identicon&r=PG&f=1", "display_name": "Marko Grdinic", "link": "https://stackoverflow.com/users/4364027/marko-grdinic"}, "reply_to_user": {"reputation": 21417, "user_id": 925978, "user_type": "registered", "accept_rate": 84, "profile_image": "https://www.gravatar.com/avatar/06e4467a5bd1538a92cefb20db07897a?s=128&d=identicon&r=PG&f=1", "display_name": "crockeea", "link": "https://stackoverflow.com/users/925978/crockeea"}, "edited": false, "score": 0, "creation_date": 1463338123, "post_id": 37224366, "comment_id": 62013503, "body": "The Atom editor and the Haskell extensions have their own Github pages, so I&#39;ll try the later tomorrow."}], "answers": [{"comments": [{"owner": {"reputation": 3436, "user_id": 4364027, "user_type": "registered", "accept_rate": 64, "profile_image": "https://www.gravatar.com/avatar/e84dbb0e9c838c25bbb70b326fd696aa?s=128&d=identicon&r=PG&f=1", "display_name": "Marko Grdinic", "link": "https://stackoverflow.com/users/4364027/marko-grdinic"}, "edited": false, "score": 0, "creation_date": 1463218568, "post_id": 37224677, "comment_id": 61980115, "body": "This is a good answer. I read a bit about the <code>-&gt;</code> operator in this <a href=\"http://dev.stephendiehl.com/hask/\" rel=\"nofollow noreferrer\">tutorial</a>,but it would not have occurred to me to use it for pattern matching even though I know that on the left side there is a lambda. That is pretty clever. Did <code>RegularPatterns</code> get removed or something?"}, {"owner": {"reputation": 100185, "user_id": 3234959, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/93bb12ca0f93dfddb33880316f7e66c2?s=128&d=identicon&r=PG&f=1", "display_name": "chi", "link": "https://stackoverflow.com/users/3234959/chi"}, "reply_to_user": {"reputation": 3436, "user_id": 4364027, "user_type": "registered", "accept_rate": 64, "profile_image": "https://www.gravatar.com/avatar/e84dbb0e9c838c25bbb70b326fd696aa?s=128&d=identicon&r=PG&f=1", "display_name": "Marko Grdinic", "link": "https://stackoverflow.com/users/4364027/marko-grdinic"}, "edited": false, "score": 0, "creation_date": 1463219922, "post_id": 37224677, "comment_id": 61980534, "body": "@MarkoGrdinic I never saw that extension in GHC."}], "tags": [], "owner": {"reputation": 100185, "user_id": 3234959, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/93bb12ca0f93dfddb33880316f7e66c2?s=128&d=identicon&r=PG&f=1", "display_name": "chi", "link": "https://stackoverflow.com/users/3234959/chi"}, "is_accepted": true, "score": 3, "last_activity_date": 1463216122, "creation_date": 1463216122, "answer_id": 37224677, "question_id": 37224366, "link": "https://stackoverflow.com/questions/37224366/how-to-resolve-an-unsupported-extension-regularpatterns-error/37224677#37224677", "title": "How to resolve an &quot;Unsupported extension: RegularPatterns&quot; error?", "body": "<p>As far as I know, you have these options.</p>\n\n<p>Split the pattern. This is the simplest and most common option, unless the right hand side is very large. (When it is large, I'd still consider defining an auxiliary function just for that.)</p>\n\n<pre><code>splitStr ('\\\"':xs) acc SentenceStart  = splitStr xs acc Quoting\nsplitStr ('\\\"':xs) acc SentenceMiddle = splitStr xs acc Quoting\n</code></pre>\n\n<p>Use pattern guards and <code>where</code>.</p>\n\n<pre><code>splitStr ('\\\"':xs) acc s \n   | SentenceStart  &lt;- s = result \n   | SentenceMiddle &lt;- s = result\n   where result = splitStr xs acc Quoting\n</code></pre>\n\n<p>Use view patterns</p>\n\n<pre><code>startOrMiddle SentenceStart  = True\nstartOrMiddle SentenceMiddle = True\nstartOrMiddle _              = False\n\nsplitStr ('\\\"':xs) acc (True &lt;- startOrMiddle) =\n   splitStr xs acc Quoting\n</code></pre>\n\n<p>Use pattern synonyms and view patterns</p>\n\n<pre><code>-- startOrMiddle as above\n\npattern StartOrMiddle = (True &lt;- startOrMiddle)\n\nsplitStr ('\\\"':xs) acc StartOrMiddle = splitStr xs acc Quoting\n</code></pre>\n"}, {"tags": [], "owner": {"reputation": 499, "user_id": 4629794, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/fb19f570a2d96e68ec79f0af208d23a8?s=128&d=identicon&r=PG", "display_name": "lierdakil", "link": "https://stackoverflow.com/users/4629794/lierdakil"}, "is_accepted": false, "score": 0, "last_activity_date": 1463386416, "creation_date": 1463386416, "answer_id": 37249425, "question_id": 37224366, "link": "https://stackoverflow.com/questions/37224366/how-to-resolve-an-unsupported-extension-regularpatterns-error/37249425#37249425", "title": "How to resolve an &quot;Unsupported extension: RegularPatterns&quot; error?", "body": "<p>For anyone wondering, <code>RegularPatterns</code> is an extension provided by HaRP preprocessor. <a href=\"https://hackage.haskell.org/package/harp\" rel=\"nofollow\">https://hackage.haskell.org/package/harp</a></p>\n\n<p>Project was all but abandoned around 2010 I think, but it's still somewhat maintained.</p>\n\n<p>As for message itself, it seems to be a parse error generated by haskell-src-exts, used by hlint.</p>\n"}], "owner": {"reputation": 3436, "user_id": 4364027, "user_type": "registered", "accept_rate": 64, "profile_image": "https://www.gravatar.com/avatar/e84dbb0e9c838c25bbb70b326fd696aa?s=128&d=identicon&r=PG&f=1", "display_name": "Marko Grdinic", "link": "https://stackoverflow.com/users/4364027/marko-grdinic"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 290, "favorite_count": 0, "accepted_answer_id": 37224677, "answer_count": 2, "score": 2, "last_activity_date": 1463386416, "creation_date": 1463213957, "question_id": 37224366, "link": "https://stackoverflow.com/questions/37224366/how-to-resolve-an-unsupported-extension-regularpatterns-error", "title": "How to resolve an &quot;Unsupported extension: RegularPatterns&quot; error?", "body": "<p>New to Haskell, but in F# one can pattern match for the equivalent of the following:</p>\n\n<pre><code>splitStr :: String -&gt; String -&gt; States -&gt; String\nsplitStr ('\\\"':xs) acc (SentenceStart | SentenceMiddle) =\n  splitStr xs acc Quoting\n</code></pre>\n\n<p>The Atom editor tells me to add the <code>{-# LANGUAGE RegularPatterns #-}</code> pragma at the top to make the above work. When I do that it tells me that it can't find the extension. Looking at the list of <a href=\"https://downloads.haskell.org/~ghc/7.4.2/docs/html/libraries/Cabal-1.14.0/Language-Haskell-Extension.html\" rel=\"nofollow\">known</a> extensions, it does not seem like <code>RegularPatterns</code> was added recently. I am using <code>7.10.3</code> version of GHC. I've also tried compiling and it won't work so the Atom editor is not at fault here.</p>\n\n<p>Any ideas how to make this work?</p>\n"}, {"tags": ["haskell", "documentation"], "answers": [{"comments": [{"owner": {"reputation": 5681, "user_id": 3040064, "user_type": "registered", "accept_rate": 59, "profile_image": "https://www.gravatar.com/avatar/02e7081757e69605a91b7f7aea47f4ae?s=128&d=identicon&r=PG&f=1", "display_name": "Jason Hu", "link": "https://stackoverflow.com/users/3040064/jason-hu"}, "edited": false, "score": 0, "creation_date": 1463235129, "post_id": 37223077, "comment_id": 61985234, "body": "will this one generate a centralized index.html page?"}], "tags": [], "owner": {"reputation": 49959, "user_id": 866915, "user_type": "registered", "accept_rate": 70, "profile_image": "https://www.gravatar.com/avatar/09242131d6e17cbbe31e8547514da6e5?s=128&d=identicon&r=PG", "display_name": "ErikR", "link": "https://stackoverflow.com/users/866915/erikr"}, "is_accepted": false, "score": 1, "last_activity_date": 1463204572, "creation_date": 1463204572, "answer_id": 37223077, "question_id": 37221885, "link": "https://stackoverflow.com/questions/37221885/generate-documentation-with-relative-paths/37223077#37223077", "title": "generate documentation with relative paths", "body": "<p>One option is to use <a href=\"http://docs.haskellstack.org/en/stable/README/\" rel=\"nofollow\"><code>stack</code></a> -- it creates HTML docs with relative links like you want.</p>\n\n<p>For each package, just run:</p>\n\n<pre><code>stack build --haddock &lt;package-name&gt;\n</code></pre>\n\n<p>or</p>\n\n<pre><code>stack --resolver ... build --haddock &lt;package-name&gt;\n</code></pre>\n\n<p>to use a specific resolver. Then look in <code>$HOME/.stack/snapshots/&lt;arch&gt;/&lt;resolver&gt;/&lt;ghc-version&gt;/doc/</code></p>\n\n<p>Note - <code>&lt;package-name&gt;</code> is just the package name - not including the version.</p>\n\n<p>The caveat is that stack won't rebuild packages - maybe there's a flag for that - but you can always expunge your snapshots directory before starting.</p>\n"}, {"comments": [{"owner": {"reputation": 5681, "user_id": 3040064, "user_type": "registered", "accept_rate": 59, "profile_image": "https://www.gravatar.com/avatar/02e7081757e69605a91b7f7aea47f4ae?s=128&d=identicon&r=PG&f=1", "display_name": "Jason Hu", "link": "https://stackoverflow.com/users/3040064/jason-hu"}, "edited": false, "score": 0, "creation_date": 1463240571, "post_id": 37228408, "comment_id": 61986994, "body": "one of my concern is the centralized <code>index.html</code> page. that would be very helpful. i haven&#39;t used this tool. will it maintain this index file?"}], "tags": [], "owner": {"reputation": 2501, "user_id": 2868481, "user_type": "registered", "accept_rate": 48, "profile_image": "https://www.gravatar.com/avatar/d32920192c6bebcffb83fffd557b9553?s=128&d=identicon&r=PG&f=1", "display_name": "d8d0d65b3f7cf42", "link": "https://stackoverflow.com/users/2868481/d8d0d65b3f7cf42"}, "is_accepted": false, "score": 0, "last_activity_date": 1463239317, "creation_date": 1463239317, "answer_id": 37228408, "question_id": 37221885, "link": "https://stackoverflow.com/questions/37221885/generate-documentation-with-relative-paths/37228408#37228408", "title": "generate documentation with relative paths", "body": "<p>Perhaps you want this: <a href=\"http://documentup.com/feuerbach/standalone-haddock\" rel=\"nofollow\">http://documentup.com/feuerbach/standalone-haddock</a></p>\n\n<p>Quote: It generates documentation ... with proper links:</p>\n\n<ul>\n<li>links to identifiers inside this package set are relative</li>\n<li>links to identifiers from external packages lead to hackage</li>\n</ul>\n"}, {"tags": [], "owner": {"reputation": 5681, "user_id": 3040064, "user_type": "registered", "accept_rate": 59, "profile_image": "https://www.gravatar.com/avatar/02e7081757e69605a91b7f7aea47f4ae?s=128&d=identicon&r=PG&f=1", "display_name": "Jason Hu", "link": "https://stackoverflow.com/users/3040064/jason-hu"}, "is_accepted": true, "score": 0, "last_activity_date": 1463336999, "creation_date": 1463336999, "answer_id": 37242125, "question_id": 37221885, "link": "https://stackoverflow.com/questions/37221885/generate-documentation-with-relative-paths/37242125#37242125", "title": "generate documentation with relative paths", "body": "<p>I can't really find a solution so i ended up writing my own cgi script that will help me do the transformation. here is the gist:</p>\n\n<p><a href=\"https://gist.github.com/HuStmpHrrr/b7de3c49f77a925dc6cf85da16a1d231\" rel=\"nofollow\">https://gist.github.com/HuStmpHrrr/b7de3c49f77a925dc6cf85da16a1d231</a></p>\n\n<p>where <code>pipeline</code> is the one that will correct the hyperlinks. since it's a quick and dirty scripting, it will be appreciated if one can point out what i can improve from this.</p>\n\n<p>also we will need to setup the http server(in my case, it's apache2):</p>\n\n<ol>\n<li><p>enable cgi</p>\n\n<p>LoadModule cgi_module /usr/lib/apache2/modules/mod_cgi.so</p></li>\n<li><p>config your apache to run cgi:</p>\n\n<pre><code> ScriptAlias /cgis/ $somepath/cgis/\n &lt;Directory \"$somepath/cgis\"&gt;\n     AllowOverride None\n     Options +ExecCGI -MultiViews +SymLinksIfOwnerMatch\n     Require all granted\n &lt;/Directory&gt;\n</code></pre></li>\n<li><p>and place the cgi file over there. it should be able to do the trick.</p></li>\n</ol>\n"}], "owner": {"reputation": 5681, "user_id": 3040064, "user_type": "registered", "accept_rate": 59, "profile_image": "https://www.gravatar.com/avatar/02e7081757e69605a91b7f7aea47f4ae?s=128&d=identicon&r=PG&f=1", "display_name": "Jason Hu", "link": "https://stackoverflow.com/users/3040064/jason-hu"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 102, "favorite_count": 0, "accepted_answer_id": 37242125, "answer_count": 3, "score": 2, "last_activity_date": 1463336999, "creation_date": 1463193300, "question_id": 37221885, "link": "https://stackoverflow.com/questions/37221885/generate-documentation-with-relative-paths", "title": "generate documentation with relative paths", "body": "<p>I am trying to setup cabal config such that it can generate documentation in a form that I can browse it locally or remotely. So one of the requirement is to generate a correct form of html, i.e. a relative path.</p>\n\n<p>I've searched around but it seems there are too many combinations of options so I think it's better to ask over here and see if anybody knows.</p>\n\n<p>my current config:</p>\n\n<pre><code>documentation: True\n</code></pre>\n\n<p>other options are irrelevant. and compiler generate links similar to this one:</p>\n\n<pre><code>file:///home/hu/.cabal/share/doc/x86_64-linux-ghc-7.10.3/lens-4.14/html/Control-Lens.html\n</code></pre>\n\n<p>this makes me only able to read the doc locally. so I would expect in html, it contains the link as:</p>\n\n<pre><code>lens-4.14/html/Control-Lens.html\n</code></pre>\n\n<p>such that in a remote browser, i can see the link as:</p>\n\n<pre><code>http://linux/ghc-doc/lens-4.14/html/Control-Lens.html\n</code></pre>\n\n<p>hope that makes sense.</p>\n\n<p>anyone knows what options i need to set to enable this?</p>\n"}, {"tags": ["haskell", "wildcard"], "comments": [{"owner": {"reputation": 49959, "user_id": 866915, "user_type": "registered", "accept_rate": 70, "profile_image": "https://www.gravatar.com/avatar/09242131d6e17cbbe31e8547514da6e5?s=128&d=identicon&r=PG", "display_name": "ErikR", "link": "https://stackoverflow.com/users/866915/erikr"}, "edited": false, "score": 2, "creation_date": 1463187783, "post_id": 37221301, "comment_id": 61973427, "body": "One way to think about it: It doesn&#39;t matter if you have two brothers named Darryl if you never need to refer to them."}], "answers": [{"comments": [{"owner": {"reputation": 57219, "user_id": 33796, "user_type": "registered", "accept_rate": 70, "profile_image": "https://www.gravatar.com/avatar/08727b23ba62e634b32988cdff082663?s=128&d=identicon&r=PG", "display_name": "luqui", "link": "https://stackoverflow.com/users/33796/luqui"}, "edited": false, "score": 3, "creation_date": 1463190390, "post_id": 37221342, "comment_id": 61973846, "body": "Hypothesis for why it might be a problem. e.g. in python <code>_</code> isn&#39;t a wildcard, just a regular variable name that is used informally to indicate wildcard."}, {"owner": {"reputation": 2311, "user_id": 122757, "user_type": "registered", "accept_rate": 94, "profile_image": "https://www.gravatar.com/avatar/c708989a53281b638727597a1fcaa9ee?s=128&d=identicon&r=PG", "display_name": "rtpg", "link": "https://stackoverflow.com/users/122757/rtpg"}, "edited": false, "score": 1, "creation_date": 1463190626, "post_id": 37221342, "comment_id": 61973893, "body": "Well, you can do some simple pattern matching on the left side of <code>&lt;-</code> (like <code>Just val &lt;- someMaybeOperation</code>) , so one could assume that you&#39;re doing unification over <code>_</code> (like, what if you had <code>Pair x x &lt;- operationGivingPair</code>?)"}], "tags": [], "owner": {"reputation": 869, "user_id": 2029548, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/5f44dcf3e58fcd22cd857cd563402178?s=128&d=identicon&r=PG", "display_name": "obadz", "link": "https://stackoverflow.com/users/2029548/obadz"}, "is_accepted": true, "score": 4, "last_activity_date": 1463187344, "creation_date": 1463187344, "answer_id": 37221342, "question_id": 37221301, "link": "https://stackoverflow.com/questions/37221301/double-wildcarding-within-a-do-block-in-haskell/37221342#37221342", "title": "Double wildcarding within a do block in Haskell", "body": "<p>No, there is no problem with having one or more <code>_</code> in pattern matches, in do-blocks or otherwise. Why do you think there might be?</p>\n"}, {"tags": [], "owner": {"reputation": 2513, "user_id": 4725625, "user_type": "registered", "accept_rate": 70, "profile_image": "https://i.stack.imgur.com/YwH49.png?s=128&g=1", "display_name": "Kwarrtz", "link": "https://stackoverflow.com/users/4725625/kwarrtz"}, "is_accepted": false, "score": 1, "last_activity_date": 1463188831, "creation_date": 1463188831, "answer_id": 37221470, "question_id": 37221301, "link": "https://stackoverflow.com/questions/37221301/double-wildcarding-within-a-do-block-in-haskell/37221470#37221470", "title": "Double wildcarding within a do block in Haskell", "body": "<p>Strictly speaking, <code>_</code> isn't really any more of a wildcard pattern than <code>x</code> or <code>arg</code>. What it is, however, is a hole. That means that it can not only accept any value, but won't bind that value to any particular variable. Since <code>_</code> doesn't bind the value at all, using it twice in the same function declaration is perfectly valid, both theoretically and pragmatically.</p>\n"}, {"comments": [{"owner": {"reputation": 84731, "user_id": 510937, "user_type": "registered", "accept_rate": 80, "profile_image": "https://www.gravatar.com/avatar/70b13a9ae1aae1ca1aa6ac8dab4643f2?s=128&d=identicon&r=PG", "display_name": "Bakuriu", "link": "https://stackoverflow.com/users/510937/bakuriu"}, "edited": false, "score": 0, "creation_date": 1463222141, "post_id": 37221617, "comment_id": 61981155, "body": "<code>_</code> is <b>not</b> an identifier. If it were <code>f _ = _</code> would compile, while it doesn&#39;t. It&#39;s a wildcard."}], "tags": [], "owner": {"reputation": 2311, "user_id": 122757, "user_type": "registered", "accept_rate": 94, "profile_image": "https://www.gravatar.com/avatar/c708989a53281b638727597a1fcaa9ee?s=128&d=identicon&r=PG", "display_name": "rtpg", "link": "https://stackoverflow.com/users/122757/rtpg"}, "is_accepted": false, "score": 2, "last_activity_date": 1463190510, "last_edit_date": 1495542239, "creation_date": 1463190510, "answer_id": 37221617, "question_id": 37221301, "link": "https://stackoverflow.com/questions/37221301/double-wildcarding-within-a-do-block-in-haskell/37221617#37221617", "title": "Double wildcarding within a do block in Haskell", "body": "<p>You should be fine (at least with GHC).</p>\n\n<p>It's good to be worried, because if you were to use any other identifier this would blow up!</p>\n\n<pre><code>Prelude&gt; :{\nPrelude| do\nPrelude|     (x,x) &lt;- return (1,1)\nPrelude|     return x\nPrelude| :}\n\n&lt;interactive&gt;:12:6:\n    Conflicting definitions for \u2018x\u2019\n    Bound at: &lt;interactive&gt;:12:6\n              &lt;interactive&gt;:12:8\n    In a pattern binding in\n         'do' block\n</code></pre>\n\n<p>The main thing is that this gets desugared to :</p>\n\n<pre><code>return (1,1) &gt;&gt;= \\(x,x) -&gt; return x\n</code></pre>\n\n<p>And lambda abstractions don't let you use the same local name twice. <code>_</code> gets special treatment.</p>\n\n<hr>\n\n<p>So for <code>_</code>, you're telling the compiler that you don't need whatever value's in there. And don't make any assumptions about the value.</p>\n\n<p>In general you shouldn't be worrying about clobbering over your definitions in the same scope, Haskell won't really let you. <a href=\"https://stackoverflow.com/questions/1179008/pattern-matching-identical-values\">Here's</a> a related question about not being able to do things like :</p>\n\n<pre><code>plus a a = 2*a\nplus a b = a + b\n</code></pre>\n\n<p>Which is actually pretty similar to this situation. <code>_</code>'s special treatment is needed.</p>\n"}], "owner": {"reputation": 5821, "user_id": 1770201, "user_type": "registered", "accept_rate": 45, "profile_image": "https://www.gravatar.com/avatar/46bcb5d2018194c9beb884b6797e57e0?s=128&d=identicon&r=PG", "display_name": "George", "link": "https://stackoverflow.com/users/1770201/george"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 68, "favorite_count": 0, "accepted_answer_id": 37221342, "answer_count": 3, "score": 1, "last_activity_date": 1463190510, "creation_date": 1463186941, "question_id": 37221301, "link": "https://stackoverflow.com/questions/37221301/double-wildcarding-within-a-do-block-in-haskell", "title": "Double wildcarding within a do block in Haskell", "body": "<p>Consider the following function which runs a command:</p>\n\n<pre><code>getGrepStdout :: IO String\ngetGrepStdOut = do let cmd' = \"grep\"\n                       pattern' = \"//\"\n                       options' = \"-nR\"\n                       path' = \"/path/to/file\"\n                       stdin' = \"\"\n                       args' = [pattern', options', path']\n                   (_, stdout', _) &lt;- readProcessWithExitCode cmd' args' stdin'\n                   return stdout'\n</code></pre>\n\n<p>Notice the second to last line which has a double <code>_</code> wild card matching (within a <code>do</code> block). This seems to compile fine in my case, but I was wondering if it was problematic formally speaking?</p>\n"}, {"tags": ["haskell", "type-level-computation"], "answers": [{"comments": [{"owner": {"reputation": 1835, "user_id": 6292577, "user_type": "registered", "accept_rate": 70, "profile_image": "https://i.stack.imgur.com/gqMCP.jpg?s=128&g=1", "display_name": "rityzmon", "link": "https://stackoverflow.com/users/6292577/rityzmon"}, "edited": false, "score": 0, "creation_date": 1463213810, "post_id": 37220170, "comment_id": 61978762, "body": "Thanks for the explanation. Could you elaborate on why UndecidableInstances applies in the example?"}, {"owner": {"reputation": 28873, "user_id": 1068232, "user_type": "registered", "accept_rate": 79, "profile_image": "https://www.gravatar.com/avatar/2a0a145ce58c20013969fe3f203531da?s=128&d=identicon&r=PG", "display_name": "Andr&#225;s Kov&#225;cs", "link": "https://stackoverflow.com/users/1068232/andr%c3%a1s-kov%c3%a1cs"}, "reply_to_user": {"reputation": 1835, "user_id": 6292577, "user_type": "registered", "accept_rate": 70, "profile_image": "https://i.stack.imgur.com/gqMCP.jpg?s=128&g=1", "display_name": "rityzmon", "link": "https://stackoverflow.com/users/6292577/rityzmon"}, "edited": false, "score": 0, "creation_date": 1463215266, "post_id": 37220170, "comment_id": 61979129, "body": "The error message says it: &quot;nested type family application&quot;, in our case the <code>Mul</code> call inside the <code>Add</code> application. You can see in <a href=\"https://downloads.haskell.org/~ghc/latest/docs/html/users_guide/type-class-extensions.html#undecidable-instances\" rel=\"nofollow noreferrer\">the docs</a> that such things aren&#39;t allowed by default."}], "tags": [], "owner": {"reputation": 28873, "user_id": 1068232, "user_type": "registered", "accept_rate": 79, "profile_image": "https://www.gravatar.com/avatar/2a0a145ce58c20013969fe3f203531da?s=128&d=identicon&r=PG", "display_name": "Andr&#225;s Kov&#225;cs", "link": "https://stackoverflow.com/users/1068232/andr%c3%a1s-kov%c3%a1cs"}, "is_accepted": true, "score": 2, "last_activity_date": 1463178402, "last_edit_date": 1463178402, "creation_date": 1463178096, "answer_id": 37220170, "question_id": 37219566, "link": "https://stackoverflow.com/questions/37219566/type-level-peano-numbers-and-undecidableinstances/37220170#37220170", "title": "Type-Level Peano Numbers and UndecidableInstances", "body": "<p>It's not really scary. It disables the (rather weak) GHC checks that try to ascertain that type family and instance definitions terminate. So, its worst case behavior is non-terminating type checking. However, most often we get error messages instead of actual looping, because loops often exceed stack limits in the type checker. We don't get unsafety, incoherence or any other property that may adversely affect program robustness or inference.</p>\n\n<p>\"Undecidable\" is probably a stronger expression than warranted, since it only denotes that GHC can't decide whether a definition is terminating. In many cases it's GHC that's too weak for the job, and other compilers for dependent languages would be able to check termination without problem. With GHC, <code>UndecidableInstances</code> is often required for obviously terminating definitions too, in which cases its usage is quite justified.</p>\n"}, {"comments": [{"owner": {"reputation": 57219, "user_id": 33796, "user_type": "registered", "accept_rate": 70, "profile_image": "https://www.gravatar.com/avatar/08727b23ba62e634b32988cdff082663?s=128&d=identicon&r=PG", "display_name": "luqui", "link": "https://stackoverflow.com/users/33796/luqui"}, "edited": false, "score": 1, "creation_date": 1463190631, "post_id": 37220216, "comment_id": 61973894, "body": "Yes, I agree, I think I should have written that more specifically about superclassing.  Knowing when it is okay to use <code>UndecidableInstances</code> is a bit subtle and requires some knowledge about how the type checker works operationally, but that&#39;s ok, that&#39;s how you learn ;-)."}], "tags": [], "owner": {"reputation": 100892, "user_id": 745903, "user_type": "registered", "accept_rate": 74, "profile_image": "https://www.gravatar.com/avatar/50933f6638836741e620669b3940410e?s=128&d=identicon&r=PG", "display_name": "leftaroundabout", "link": "https://stackoverflow.com/users/745903/leftaroundabout"}, "is_accepted": false, "score": 2, "last_activity_date": 1463216728, "last_edit_date": 1463216728, "creation_date": 1463178409, "answer_id": 37220216, "question_id": 37219566, "link": "https://stackoverflow.com/questions/37219566/type-level-peano-numbers-and-undecidableinstances/37220216#37220216", "title": "Type-Level Peano Numbers and UndecidableInstances", "body": "<p><code>UndecidableInstance</code> is ok to use. Granted, you should always <em>consider</em> a moment whether something is really needed, or it would be more idiomatic to choose another path.</p>\n\n<p>Luke makes the point that <code>UndecidableInstances</code> should not be used to implement superclassing. Well, that's true, but it doesn't really have much to do with undecidable instances &ndash; superclassing is just always a hack and pretty much backwards to the way abstractions should be designed.</p>\n\n<p>It is IME <em>not</em> true, at least not anymore, that superclassing is the most common use of <code>UndecidableInstances</code>. There are plenty of things you can do with this extension enabled but not without. Most certainly, it <em>can't</em> be possible to impose a halting-proof condition if you actually <em>want</em> to do Turing-complete dependent typing at compile-time, which is basically what all the DataKinds fuzz is heading to.</p>\n\n<p>So, don't worry too much; indeed you probably won't get around <code>UndecidableInstances</code>. As said by Andr&aacute;s Kov&aacute;cs, this extension is perfectly safe WRT <em>correctness</em>, the worst that can happen is a loop / error.</p>\n\n<p>If that's too scary for your tastes, use a language that's designed up front as dependently-typed and total, i.e. <a href=\"http://wiki.portal.chalmers.se/agda/pmwiki.php\" rel=\"nofollow\">Agda</a>.</p>\n"}], "owner": {"reputation": 1835, "user_id": 6292577, "user_type": "registered", "accept_rate": 70, "profile_image": "https://i.stack.imgur.com/gqMCP.jpg?s=128&g=1", "display_name": "rityzmon", "link": "https://stackoverflow.com/users/6292577/rityzmon"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 128, "favorite_count": 0, "accepted_answer_id": 37220170, "answer_count": 2, "score": 3, "last_activity_date": 1463216728, "creation_date": 1463174759, "last_edit_date": 1463175126, "question_id": 37219566, "link": "https://stackoverflow.com/questions/37219566/type-level-peano-numbers-and-undecidableinstances", "title": "Type-Level Peano Numbers and UndecidableInstances", "body": "<p>Following <a href=\"https://www.schoolofhaskell.com/user/konn/prove-your-haskell-for-great-safety/dependent-types-in-haskell\" rel=\"nofollow\">this tutorial</a>, I have the following code:</p>\n\n<pre><code>{-# LANGUAGE DataKinds, TypeFamilies #-}\n\ndata Nat = Z | S Nat\n\ntype family   Plus (n :: Nat) (m :: Nat) :: Nat\ntype instance Plus Z     m = m\ntype instance Plus (S n) m = S (Plus n m)\n</code></pre>\n\n<p>So far so good. I know that <code>DataKinds</code> does auto promotion of types to kinds, and <code>TypeFamilies</code> enable type-level functions.</p>\n\n<p>Then I add:</p>\n\n<pre><code>type family Mul (m :: Nat) (n :: Nat) :: Nat\ntype instance Mul Z     m = Z\ntype instance Mul (S n) m = Plus m (Mul n m)\n</code></pre>\n\n<p>Compiling gives me:</p>\n\n<pre><code>Nested type family application\n  in the type family application: Plus m (Mul n m)\n(Use UndecidableInstances to permit this)\nIn the type instance declaration for \u2018Mul\u2019\n</code></pre>\n\n<p>The name of this extension is scary. Some people say to <a href=\"https://lukepalmer.wordpress.com/2008/04/08/stop-using-undecidable-instances/\" rel=\"nofollow\">avoid</a> it, and explanations of this extension I've tried reading do not make sense to me. </p>\n\n<p>Looking for a bit of help in understanding the error, why it is showing up in this example, what is the meaning of <em>undecidable</em> in this context and in what instances this extension is as scary as it sounds?</p>\n"}, {"tags": ["multithreading", "haskell", "parallel-processing", "quickcheck"], "comments": [{"owner": {"reputation": 13807, "user_id": 2407038, "user_type": "registered", "accept_rate": 64, "profile_image": "https://www.gravatar.com/avatar/538f6f4a9aa43841841de7d8e8b169fc?s=128&d=identicon&r=PG&f=1", "display_name": "user2407038", "link": "https://stackoverflow.com/users/2407038/user2407038"}, "edited": false, "score": 0, "creation_date": 1463181029, "post_id": 37219533, "comment_id": 61972036, "body": "Would something like <code>$forAllProperties (\\x -&gt; p{Det&#47;Non} x k)</code> where <code>k</code> is some depth work for you?"}, {"owner": {"reputation": 555, "user_id": 1505475, "user_type": "registered", "accept_rate": 62, "profile_image": "https://www.gravatar.com/avatar/6bc72887d0b9f71cdbc2eeb5f9899d8f?s=128&d=identicon&r=PG", "display_name": "simon1505475", "link": "https://stackoverflow.com/users/1505475/simon1505475"}, "reply_to_user": {"reputation": 13807, "user_id": 2407038, "user_type": "registered", "accept_rate": 64, "profile_image": "https://www.gravatar.com/avatar/538f6f4a9aa43841841de7d8e8b169fc?s=128&d=identicon&r=PG&f=1", "display_name": "user2407038", "link": "https://stackoverflow.com/users/2407038/user2407038"}, "edited": false, "score": 0, "creation_date": 1463322408, "post_id": 37219533, "comment_id": 62007874, "body": "I believe not. Please correct me if I&#39;m wrong but running two such statements in parallel still gets the putStrLn in $forAllProperties to appear out of order with the counter examples. So I get stuff like:"}, {"owner": {"reputation": 555, "user_id": 1505475, "user_type": "registered", "accept_rate": 62, "profile_image": "https://www.gravatar.com/avatar/6bc72887d0b9f71cdbc2eeb5f9899d8f?s=128&d=identicon&r=PG", "display_name": "simon1505475", "link": "https://stackoverflow.com/users/1505475/simon1505475"}, "reply_to_user": {"reputation": 13807, "user_id": 2407038, "user_type": "registered", "accept_rate": 64, "profile_image": "https://www.gravatar.com/avatar/538f6f4a9aa43841841de7d8e8b169fc?s=128&d=identicon&r=PG&f=1", "display_name": "user2407038", "link": "https://stackoverflow.com/users/2407038/user2407038"}, "edited": false, "score": 0, "creation_date": 1463323462, "post_id": 37219533, "comment_id": 62008280, "body": "<code>=== prop_stuff in Foo.hs ===</code> <code>=== prop_fooBarFoo in Bar.hs ===</code>  <code>Failed after 7 tests:</code>  <code>7</code>  <code>7 &#47;= 3</code>  <code>Failed after 3 tests</code>  <code>3</code>  <code>3 &#47;= 4</code>  So it is hard to match the counter examples to the properties. Even more so with thousands of individual properties (gathered with forAllProperties)."}, {"owner": {"reputation": 4185, "user_id": 15467, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/a89c04ada36efa853c7f5be0a96b6dd9?s=128&d=identicon&r=PG", "display_name": "ja.", "link": "https://stackoverflow.com/users/15467/ja"}, "edited": false, "score": 0, "creation_date": 1463419050, "post_id": 37219533, "comment_id": 62045959, "body": "<code>quickCheckWithResult</code> returns the <code>String</code> that is printed in the <code>output</code>."}, {"owner": {"reputation": 499, "user_id": 4629794, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/fb19f570a2d96e68ec79f0af208d23a8?s=128&d=identicon&r=PG", "display_name": "lierdakil", "link": "https://stackoverflow.com/users/4629794/lierdakil"}, "edited": false, "score": 0, "creation_date": 1463507847, "post_id": 37219533, "comment_id": 62091582, "body": "Looking at the source (<a href=\"http://hackage.haskell.org/package/QuickCheck-2.8.2/docs/src/Test-QuickCheck-All.html#quickCheckAll\" rel=\"nofollow noreferrer\">hackage.haskell.org/package/QuickCheck-2.8.2/docs/src/&hellip;</a>), it seems it will print property name header form main thread no matter what you supply to <code>forAllProperties</code>. So copy-pasting <code>Test.QuickCheck.All</code> seems like the way to go."}, {"owner": {"reputation": 126897, "user_id": 791604, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/ce991df7a056248d5e4f6fc3659ba733?s=128&d=identicon&r=PG", "display_name": "Daniel Wagner", "link": "https://stackoverflow.com/users/791604/daniel-wagner"}, "edited": false, "score": 3, "creation_date": 1463537675, "post_id": 37219533, "comment_id": 62102860, "body": "You ask, &quot;Is there a way to do X without making changes to Test.QuickCheck.All?&quot;. Why should we rule out that solution? It seems the natural one to me; and if there is a better one, then <i>both</i> should be listed here, and the better one upvoted more!"}, {"owner": {"reputation": 555, "user_id": 1505475, "user_type": "registered", "accept_rate": 62, "profile_image": "https://www.gravatar.com/avatar/6bc72887d0b9f71cdbc2eeb5f9899d8f?s=128&d=identicon&r=PG", "display_name": "simon1505475", "link": "https://stackoverflow.com/users/1505475/simon1505475"}, "reply_to_user": {"reputation": 126897, "user_id": 791604, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/ce991df7a056248d5e4f6fc3659ba733?s=128&d=identicon&r=PG", "display_name": "Daniel Wagner", "link": "https://stackoverflow.com/users/791604/daniel-wagner"}, "edited": false, "score": 0, "creation_date": 1463605493, "post_id": 37219533, "comment_id": 62141161, "body": "@DanielWagner: you&#39;re right, it is one possible solution. I was using it as a baseline to compare other solutions. I don&#39;t like it because it requires duplicating library code, which seems like a last resort solution to me. I ended up doing it anyway but I wish there was a way around it. Maybe I should write to the authors and donate the code I ended up with."}, {"owner": {"reputation": 555, "user_id": 1505475, "user_type": "registered", "accept_rate": 62, "profile_image": "https://www.gravatar.com/avatar/6bc72887d0b9f71cdbc2eeb5f9899d8f?s=128&d=identicon&r=PG", "display_name": "simon1505475", "link": "https://stackoverflow.com/users/1505475/simon1505475"}, "reply_to_user": {"reputation": 4185, "user_id": 15467, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/a89c04ada36efa853c7f5be0a96b6dd9?s=128&d=identicon&r=PG", "display_name": "ja.", "link": "https://stackoverflow.com/users/15467/ja"}, "edited": false, "score": 0, "creation_date": 1463605551, "post_id": 37219533, "comment_id": 62141186, "body": "@ja: that&#39;s correct but that string does not contain the property&#39;s name. What I would really like is a way to use Result to get both the <code>output</code> and the name of the property."}, {"owner": {"reputation": 555, "user_id": 1505475, "user_type": "registered", "accept_rate": 62, "profile_image": "https://www.gravatar.com/avatar/6bc72887d0b9f71cdbc2eeb5f9899d8f?s=128&d=identicon&r=PG", "display_name": "simon1505475", "link": "https://stackoverflow.com/users/1505475/simon1505475"}, "reply_to_user": {"reputation": 499, "user_id": 4629794, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/fb19f570a2d96e68ec79f0af208d23a8?s=128&d=identicon&r=PG", "display_name": "lierdakil", "link": "https://stackoverflow.com/users/4629794/lierdakil"}, "edited": false, "score": 0, "creation_date": 1463605715, "post_id": 37219533, "comment_id": 62141270, "body": "@lierdakil: I am unclear about the relation between your two sentences. Do you mean to point out that <code>forAllProperties</code> does have access to the property name so copy pasting it will let me recombine the names and the Result however I please?"}, {"owner": {"reputation": 499, "user_id": 4629794, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/fb19f570a2d96e68ec79f0af208d23a8?s=128&d=identicon&r=PG", "display_name": "lierdakil", "link": "https://stackoverflow.com/users/4629794/lierdakil"}, "edited": false, "score": 0, "creation_date": 1463618706, "post_id": 37219533, "comment_id": 62145256, "body": "Sorry about being unclear. I was alluding to last paragraph in your question, specifically &quot;copy / pasting the Test.QuickCheck.All module and making the changes I need&quot; -- to me this seems like the only option, unless you manage to somehow trick TH to use custom version of <code>runQuickCheckAll</code>, which is most likely impossible."}, {"owner": {"reputation": 894, "user_id": 994643, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/6a3e2fbf6abc8e31d4ac4223631c425c?s=128&d=identicon&r=PG", "display_name": "chreekat", "link": "https://stackoverflow.com/users/994643/chreekat"}, "edited": false, "score": 1, "creation_date": 1476996894, "post_id": 37219533, "comment_id": 67597509, "body": "I think what others are getting at is that the best solution is to modify Test.Quickcheck.All <i>in place</i>. It&#39;s right over there --&gt; <a href=\"https://github.com/nick8325/quickcheck\" rel=\"nofollow noreferrer\">github.com/nick8325/quickcheck</a> , I&#39;m sure they would be accepting of Issues or PRs."}], "owner": {"reputation": 555, "user_id": 1505475, "user_type": "registered", "accept_rate": 62, "profile_image": "https://www.gravatar.com/avatar/6bc72887d0b9f71cdbc2eeb5f9899d8f?s=128&d=identicon&r=PG", "display_name": "simon1505475", "link": "https://stackoverflow.com/users/1505475/simon1505475"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 288, "favorite_count": 3, "answer_count": 0, "score": 9, "last_activity_date": 1463359965, "creation_date": 1463174580, "question_id": 37219533, "link": "https://stackoverflow.com/questions/37219533/running-quickcheck-properties-in-parallel", "title": "Running QuickCheck properties in parallel", "body": "<p>In my project, I have several QuickCheck properties, most of which I collect using forAllProperties, defined in Test.QuickCheck.All. I am trying to run all my properties in parallel which is proving troublesome: at the end of a run, I get the output printed in the terminal and counterexamples and property names are often scattered so as to make it difficult to match properties with their counter examples. </p>\n\n<p>I see that the purpose of library pqc is to run properties in parallel but it does not provide a replacement for forAllProperties nor does it provide a way of combining forAllProperties with the parallel test driver.</p>\n\n<p>It feels like all I would need is for forAllProperties to pass the property name to the function it gets as an argument. </p>\n\n<p>I have also looked into redirecting stdout on a thread by thread basis, first by using system-posix-redirect (which is not thread safe), then by studying Test.QuickCheck.State, especially the terminal field. The latter didn't pan out because I did not find a way of rewriting the terminal field.</p>\n\n<p>Is there a way for me to, somehow, output the counter-examples together with the property names without copy / pasting the Test.QuickCheck.All module and making the changes I need?</p>\n"}, {"tags": ["haskell", "types"], "answers": [{"tags": [], "owner": {"reputation": 1679, "user_id": 1722752, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/ef35ad86b627ba3176b6aea8a184f51c?s=128&d=identicon&r=PG", "display_name": "MigMit", "link": "https://stackoverflow.com/users/1722752/migmit"}, "is_accepted": false, "score": 2, "last_activity_date": 1463176946, "creation_date": 1463176946, "answer_id": 37219957, "question_id": 37219364, "link": "https://stackoverflow.com/questions/37219364/looking-for-papers-that-talk-like-this-about-types/37219957#37219957", "title": "Looking for papers that talk like this about types", "body": "<p>That's Scott semantics, named after Dana Scott, who really invented this. I guess you can find it in his works.</p>\n\n<p>Oh, and such oredered sets are called \"domains\", so, domain semantics is another name for the same things. There are various refinements of this that allow things like higher-rank types.</p>\n"}, {"tags": [], "owner": {"reputation": 100185, "user_id": 3234959, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/93bb12ca0f93dfddb33880316f7e66c2?s=128&d=identicon&r=PG&f=1", "display_name": "chi", "link": "https://stackoverflow.com/users/3234959/chi"}, "is_accepted": false, "score": 2, "last_activity_date": 1463178716, "creation_date": 1463178716, "answer_id": 37220267, "question_id": 37219364, "link": "https://stackoverflow.com/questions/37219364/looking-for-papers-that-talk-like-this-about-types/37220267#37220267", "title": "Looking for papers that talk like this about types", "body": "<p>What you describe is not typically called a \"type\". Rather, it is usually called a <a href=\"https://en.wikipedia.org/wiki/Domain_theory\" rel=\"nofollow\"><em>domain</em></a>, which is used in <a href=\"https://en.wikipedia.org/wiki/Denotational_semantics\" rel=\"nofollow\">denotational semantics</a>. For fixed points, such domains are often taken to be <a href=\"https://en.wikipedia.org/wiki/Complete_partial_order\" rel=\"nofollow\">complete partial orders</a> (CPOs). These might come in different \"flavours\", like omega-CPOs or DCPOS.</p>\n\n<p>If you can, have a look at <a href=\"https://en.wikipedia.org/wiki/Domain_theory\" rel=\"nofollow\">domain theory</a> which is described in some programming languages textbooks, such as the Winskel formal semantics book.</p>\n"}], "owner": {"reputation": 2313, "user_id": 5318306, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/897fd4f3b92d28c5c1eb28a8024661a1?s=128&d=identicon&r=PG&f=1", "display_name": "Gurkenglas", "link": "https://stackoverflow.com/users/5318306/gurkenglas"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 96, "favorite_count": 0, "answer_count": 2, "score": 0, "last_activity_date": 1463180687, "creation_date": 1463173811, "last_edit_date": 1463180687, "question_id": 37219364, "link": "https://stackoverflow.com/questions/37219364/looking-for-papers-that-talk-like-this-about-types", "title": "Looking for papers that talk like this about types", "body": "<p>I'm writing a bachelor's thesis on a Haskell topic that deals with fix points, and so I tried making all that type stuff rigorous. I made up types as follows:</p>\n\n<p><a href=\"https://i.stack.imgur.com/fidDC.png\" rel=\"nofollow noreferrer\"><img src=\"https://i.stack.imgur.com/fidDC.png\" alt=\"enter image description here\"></a></p>\n\n<p>Do you know papers that use this definition or a close one?</p>\n"}, {"tags": ["haskell", "types"], "comments": [{"owner": {"reputation": 100185, "user_id": 3234959, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/93bb12ca0f93dfddb33880316f7e66c2?s=128&d=identicon&r=PG&f=1", "display_name": "chi", "link": "https://stackoverflow.com/users/3234959/chi"}, "edited": false, "score": 1, "creation_date": 1463164672, "post_id": 37216648, "comment_id": 61965351, "body": "I&#39;m voting to close this question since it is very unclear. A function can not have two types, and in particular not the ones which have been posted. Further, <code>(a -&gt; b) c -&gt; (c -&gt;a) -&gt; b</code> is not even a well-formed type. The types used below in the tests appear to be entirely something else."}, {"owner": {"reputation": 384463, "user_id": 1126841, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/fa05233b2357f8d11c22ef4cfc7bb85c?s=128&d=identicon&r=PG", "display_name": "chepner", "link": "https://stackoverflow.com/users/1126841/chepner"}, "edited": false, "score": 1, "creation_date": 1463165460, "post_id": 37216648, "comment_id": 61965772, "body": "The attempted definition of <code>test1</code>, for instance, appears to assume that <code>([a], a -&gt; a -&gt; a -&gt; b)</code> and <code>([a], a, a, a, b)</code> are the same type."}], "answers": [{"tags": [], "owner": {"reputation": 62252, "user_id": 1435869, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/TrEd9.jpg?s=128&g=1", "display_name": "karakfa", "link": "https://stackoverflow.com/users/1435869/karakfa"}, "is_accepted": true, "score": 4, "last_activity_date": 1463163626, "creation_date": 1463163626, "answer_id": 37216867, "question_id": 37216648, "link": "https://stackoverflow.com/questions/37216648/haskell-create-function-dependent-on-given-type/37216867#37216867", "title": "Haskell, create function dependent on given type?", "body": "<p>you can assume <code>a-&gt; a -&gt; a -&gt; b</code> as a function that takes 3 arguments of the same type and generates output of another type.  For example</p>\n\n<pre><code>fromRGBtoColor :: Int -&gt; Int -&gt; Int -&gt; Color\n</code></pre>\n\n<p>let's continue specializing to <code>Int</code> and <code>Color</code> (for generic types <code>a</code> and <code>b</code>)</p>\n\n<p>Your first example </p>\n\n<pre><code>([a], a -&gt; a -&gt; a -&gt; b) -&gt; b\n</code></pre>\n\n<p>is taking a tuple of <code>[Int]</code> and function of the same type <code>fromRGBtoColor</code> and produces a <code>Color</code>.</p>\n\n<p>Your second case is missing some characters..</p>\n"}], "owner": {"reputation": 237, "user_id": 5539565, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/e3caea1216cdc02bbed42516c88cde26?s=128&d=identicon&r=PG&f=1", "display_name": "FastBatteryCharger", "link": "https://stackoverflow.com/users/5539565/fastbatterycharger"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 109, "favorite_count": 0, "accepted_answer_id": 37216867, "answer_count": 1, "score": -3, "last_activity_date": 1477819140, "creation_date": 1463162878, "last_edit_date": 1477819140, "question_id": 37216648, "link": "https://stackoverflow.com/questions/37216648/haskell-create-function-dependent-on-given-type", "title": "Haskell, create function dependent on given type?", "body": "<p>i want to ask if somebody could explain me how the typ declaration works in Haskell(for more complex functions).</p>\n\n<p>I want to create a function that will use exactly these typs:</p>\n\n<pre><code>  1)     ([a], a-&gt; a -&gt; a -&gt; b) -&gt; b\n  2)     (a -&gt; b) c -&gt; (c -&gt;a) -&gt; b\n</code></pre>\n\n<p>but i dont understand how to read something like that <code>a-&gt;a-&gt;a-&gt; b</code> (i know that b is the output).</p>\n\n<p>Maybe you could help me to read and create a function that match the given typ.</p>\n"}, {"tags": ["haskell"], "comments": [{"owner": {"reputation": 5171, "user_id": 2718186, "user_type": "registered", "accept_rate": 87, "profile_image": "https://www.gravatar.com/avatar/ca44ca18bf615e74f930d28a89d01508?s=128&d=identicon&r=PG", "display_name": "MicroVirus", "link": "https://stackoverflow.com/users/2718186/microvirus"}, "edited": false, "score": 1, "creation_date": 1463159872, "post_id": 37215736, "comment_id": 61962886, "body": "<code>m</code> should already have a fixed type, by your monad instance, so there should be no switching needed nor possible. Do you mean that you are selecting/switching on the constructor of your monad type?"}, {"owner": {"reputation": 3815, "user_id": 5382150, "user_type": "registered", "accept_rate": 86, "profile_image": "https://i.stack.imgur.com/GwGSL.png?s=128&g=1", "display_name": "Gilgamesz", "link": "https://stackoverflow.com/users/5382150/gilgamesz"}, "reply_to_user": {"reputation": 5171, "user_id": 2718186, "user_type": "registered", "accept_rate": 87, "profile_image": "https://www.gravatar.com/avatar/ca44ca18bf615e74f930d28a89d01508?s=128&d=identicon&r=PG", "display_name": "MicroVirus", "link": "https://stackoverflow.com/users/2718186/microvirus"}, "edited": false, "score": 0, "creation_date": 1463160059, "post_id": 37215736, "comment_id": 61963002, "body": "Yes, Indeed it has. I edited."}, {"owner": {"reputation": 5171, "user_id": 2718186, "user_type": "registered", "accept_rate": 87, "profile_image": "https://www.gravatar.com/avatar/ca44ca18bf615e74f930d28a89d01508?s=128&d=identicon&r=PG", "display_name": "MicroVirus", "link": "https://stackoverflow.com/users/2718186/microvirus"}, "edited": false, "score": 0, "creation_date": 1463160160, "post_id": 37215736, "comment_id": 61963052, "body": "Your edit just made the code nonsensical, having a <code>&lt;-</code> outside of a do-block / list comprehension."}, {"owner": {"reputation": 5171, "user_id": 2718186, "user_type": "registered", "accept_rate": 87, "profile_image": "https://www.gravatar.com/avatar/ca44ca18bf615e74f930d28a89d01508?s=128&d=identicon&r=PG", "display_name": "MicroVirus", "link": "https://stackoverflow.com/users/2718186/microvirus"}, "edited": false, "score": 0, "creation_date": 1463160224, "post_id": 37215736, "comment_id": 61963083, "body": "Not considering the edit, without seeing more of your code it&#39;s quite impossible to tell if it&#39;s OK or not. Maybe you could think on the exact question and the relevant details you need to show us to judge this case, and then update your question."}], "answers": [{"tags": [], "owner": {"reputation": 126897, "user_id": 791604, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/ce991df7a056248d5e4f6fc3659ba733?s=128&d=identicon&r=PG", "display_name": "Daniel Wagner", "link": "https://stackoverflow.com/users/791604/daniel-wagner"}, "is_accepted": false, "score": 2, "last_activity_date": 1463160643, "creation_date": 1463160643, "answer_id": 37216046, "question_id": 37215736, "link": "https://stackoverflow.com/questions/37215736/particular-monad-haskell/37216046#37216046", "title": "Particular Monad. Haskell", "body": "<p>The <code>case</code> statement and syntax errors notwithstanding, this definition is indeed clearly nonsensical, as binding from within a do-block gets translated to a use of <code>&gt;&gt;=</code>. So your existing code has defined <code>m &gt;&gt;= f = m &gt;&gt;= \\a -&gt; ...</code>, which is both an infinite loop and a space leak in one.</p>\n"}, {"tags": [], "owner": {"reputation": 1024, "user_id": 5339728, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/bc87e9ae4adff4d75b1ad9233e04bc54?s=128&d=identicon&r=PG&f=1", "display_name": "Sven Williamson", "link": "https://stackoverflow.com/users/5339728/sven-williamson"}, "is_accepted": true, "score": 1, "last_activity_date": 1463208301, "last_edit_date": 1463208301, "creation_date": 1463165970, "answer_id": 37217480, "question_id": 37215736, "link": "https://stackoverflow.com/questions/37215736/particular-monad-haskell/37217480#37217480", "title": "Particular Monad. Haskell", "body": "<p>It is possible that your situation falls into the simple pattern where your monad if of the form:</p>\n\n<pre><code>newtype MyMonad a = MyMonad { run :: State -&gt; (a, State) }\n</code></pre>\n\n<p>where <code>State</code> is a data type you have designed yourself. The point is you probably have a function:</p>\n\n<pre><code>run :: MyMonad a -&gt; State -&gt; (a, State)\n</code></pre>\n\n<p>and you probably need to use this function when implementing (>>=):</p>\n\n<pre><code>m &gt;&gt;= f = MyMonad(\\state -&gt; let (x, newState) = run m state in\n                              case x of \n                                (ParticularParameterA) -&gt; doSomething\n                                 ..........\n</code></pre>\n\n<p>Now if <code>f::a -&gt; MyMonad b</code> your <code>\\state -&gt; ...</code> function must return a <code>(b, State)</code>, so you probably want to use <code>run (f x) newState</code> somewhere in your code.</p>\n\n<p>if your monadic type is of the form:</p>\n\n<pre><code>newtype MyMonad a = MyMonad { run :: State -&gt; Maybe (a, State) }\nnewtype MyMonad a = MyMonad { run :: State -&gt; Either String  (a, State) }\n</code></pre>\n\n<p>then you still use the <code>run</code> function, e.g.</p>\n\n<pre><code>m &gt;&gt;= f = MyMonad (\\state -&gt; case run m state of\n                               Just (x, newState) -&gt; run (f x) newState\n                               Nothing               -&gt; Nothing) \n</code></pre>\n"}], "owner": {"reputation": 3815, "user_id": 5382150, "user_type": "registered", "accept_rate": 86, "profile_image": "https://i.stack.imgur.com/GwGSL.png?s=128&g=1", "display_name": "Gilgamesz", "link": "https://stackoverflow.com/users/5382150/gilgamesz"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 88, "favorite_count": 0, "accepted_answer_id": 37217480, "answer_count": 2, "score": 0, "last_activity_date": 1463208301, "creation_date": 1463159472, "last_edit_date": 1463160104, "question_id": 37215736, "link": "https://stackoverflow.com/questions/37215736/particular-monad-haskell", "title": "Particular Monad. Haskell", "body": "<p>I have written a my monad representing some computations. Now, I would like to define how the computation should be <code>sequenced</code>. So, I am going to define <code>&gt;&gt;=</code> . But, control of flow forced me to focus on conrete type of <code>a</code>. I mean:</p>\n\n<pre><code>m &gt;&gt;= f = \n     a &lt;- m \n     case a of\n        (ParticularParameterA) -&gt; doSomething\n          ..........\n</code></pre>\n\n<p>Is it proper solution? I mean: I have no experience in functional programming so I am not sure is it ok to do it or not. How to do it better?</p>\n"}, {"tags": ["json", "haskell", "yesod"], "comments": [{"owner": {"reputation": 48129, "user_id": 76051, "user_type": "registered", "accept_rate": 91, "profile_image": "https://i.stack.imgur.com/AGDxz.jpg?s=128&g=1", "display_name": "Carsten", "link": "https://stackoverflow.com/users/76051/carsten"}, "edited": false, "score": 0, "creation_date": 1463154375, "post_id": 37214145, "comment_id": 61959827, "body": "first remove the <code>return</code> and see what the compiler tells you about the type ... then look for <code>liftIO</code> ;)"}, {"owner": {"reputation": 48129, "user_id": 76051, "user_type": "registered", "accept_rate": 91, "profile_image": "https://i.stack.imgur.com/AGDxz.jpg?s=128&g=1", "display_name": "Carsten", "link": "https://stackoverflow.com/users/76051/carsten"}, "edited": false, "score": 0, "creation_date": 1463154511, "post_id": 37214145, "comment_id": 61959917, "body": "<code>return</code> here wraps the <code>IO</code> computation into your Yesod-monad and then just ignores it - you can try this in simple <code>IO</code> do - if you open up <code>GHCi</code> and input <code>return (print &quot;Hello&quot;)</code> you will see ... <i>nothing</i> - <code>IO (IO ())</code> is just ignored"}, {"owner": {"reputation": 43, "user_id": 6316336, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/04ad20bb24bd1bdcd7f28d06ed75b66b?s=128&d=identicon&r=PG&f=1", "display_name": "Kabal", "link": "https://stackoverflow.com/users/6316336/kabal"}, "reply_to_user": {"reputation": 48129, "user_id": 76051, "user_type": "registered", "accept_rate": 91, "profile_image": "https://i.stack.imgur.com/AGDxz.jpg?s=128&g=1", "display_name": "Carsten", "link": "https://stackoverflow.com/users/76051/carsten"}, "edited": false, "score": 0, "creation_date": 1463155061, "post_id": 37214145, "comment_id": 61960260, "body": "Yeah, thanks a lot for your answer, I didn&#39;t have the return, put I added it because of this:"}, {"owner": {"reputation": 43, "user_id": 6316336, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/04ad20bb24bd1bdcd7f28d06ed75b66b?s=128&d=identicon&r=PG&f=1", "display_name": "Kabal", "link": "https://stackoverflow.com/users/6316336/kabal"}, "reply_to_user": {"reputation": 48129, "user_id": 76051, "user_type": "registered", "accept_rate": 91, "profile_image": "https://i.stack.imgur.com/AGDxz.jpg?s=128&g=1", "display_name": "Carsten", "link": "https://stackoverflow.com/users/76051/carsten"}, "edited": false, "score": 0, "creation_date": 1463155636, "post_id": 37214145, "comment_id": 61960568, "body": "@Carsten: I am getting this:   Couldn&#39;t match expected type <code>HandlerT Calculator IO a0&#39; with actual type </code>IO ()&#39;         In a stmt of a &#39;do&#39; block: writeFile &quot;test.txt&quot; &quot;Just something&quot;         In the expression:           do {  writeFile &quot;test.txt&quot; &quot;Just something&quot;;                return $ object [&quot;result&quot; .= &quot;Ok&quot;] }"}, {"owner": {"reputation": 48129, "user_id": 76051, "user_type": "registered", "accept_rate": 91, "profile_image": "https://i.stack.imgur.com/AGDxz.jpg?s=128&g=1", "display_name": "Carsten", "link": "https://stackoverflow.com/users/76051/carsten"}, "edited": false, "score": 0, "creation_date": 1463155927, "post_id": 37214145, "comment_id": 61960746, "body": "have you tried <code>liftIO $ writeFile ...</code>?"}, {"owner": {"reputation": 43, "user_id": 6316336, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/04ad20bb24bd1bdcd7f28d06ed75b66b?s=128&d=identicon&r=PG&f=1", "display_name": "Kabal", "link": "https://stackoverflow.com/users/6316336/kabal"}, "reply_to_user": {"reputation": 48129, "user_id": 76051, "user_type": "registered", "accept_rate": 91, "profile_image": "https://i.stack.imgur.com/AGDxz.jpg?s=128&g=1", "display_name": "Carsten", "link": "https://stackoverflow.com/users/76051/carsten"}, "edited": false, "score": 0, "creation_date": 1463156514, "post_id": 37214145, "comment_id": 61961077, "body": "@Carsten. That did the trick! Thanks a lot"}], "answers": [{"tags": [], "owner": {"reputation": 48129, "user_id": 76051, "user_type": "registered", "accept_rate": 91, "profile_image": "https://i.stack.imgur.com/AGDxz.jpg?s=128&g=1", "display_name": "Carsten", "link": "https://stackoverflow.com/users/76051/carsten"}, "is_accepted": true, "score": 1, "last_activity_date": 1463157327, "creation_date": 1463157327, "answer_id": 37215158, "question_id": 37214145, "link": "https://stackoverflow.com/questions/37214145/haskell-yesod-and-writefile/37215158#37215158", "title": "Haskell Yesod and writeFile", "body": "<p>just use <code>liftIO</code>:</p>\n\n<pre><code>getTestR =\n  do\n    liftIO $ writeFile \"test.txt\" \"Just something\"\n    return $ object [\"result\" .= \"Ok\"]\n</code></pre>\n"}], "owner": {"reputation": 43, "user_id": 6316336, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/04ad20bb24bd1bdcd7f28d06ed75b66b?s=128&d=identicon&r=PG&f=1", "display_name": "Kabal", "link": "https://stackoverflow.com/users/6316336/kabal"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 63, "favorite_count": 0, "accepted_answer_id": 37215158, "answer_count": 1, "score": 1, "last_activity_date": 1463157327, "creation_date": 1463154037, "last_edit_date": 1463155790, "question_id": 37214145, "link": "https://stackoverflow.com/questions/37214145/haskell-yesod-and-writefile", "title": "Haskell Yesod and writeFile", "body": "<p>I am trying to learn Yesod and trying to implement a simple REST app where everytime a I get a <em>GET</em> request I write something to a file. Right now I have the following handler function:</p>\n\n<pre><code>getTestR =\n  do\n    return $ writeFile \"test.txt\" \"Just something\"\n    return $ object [\"result\" .= \"Ok\"]\n</code></pre>\n\n<p>What I was expecting is that the file <code>test.txt</code> would be created and I would obtain a JSON with <code>{result=Ok}</code>. However, I am obtaining the JSON, but the file is not being created. </p>\n\n<p>I guess the <code>writeFile</code> is not being evaluated because of the lazy evaluation, but I have no idea how to overcome this problem. Thanks in advance.</p>\n"}, {"tags": ["performance", "haskell"], "comments": [{"owner": {"reputation": 14781, "user_id": 630160, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/4445f21326af525a8ad19af7e3ae41a8?s=128&d=identicon&r=PG", "display_name": "epsilonhalbe", "link": "https://stackoverflow.com/users/630160/epsilonhalbe"}, "edited": false, "score": 2, "creation_date": 1463136049, "post_id": 37207306, "comment_id": 61946844, "body": "just to be sure - have you read the <a href=\"https://stackoverflow.com/tags/haskell/info\">info-page</a> and compiled the program with option <code>-O2</code>?"}, {"owner": {"reputation": 94713, "user_id": 1139697, "user_type": "registered", "accept_rate": 86, "profile_image": "https://www.gravatar.com/avatar/5f136ddb684f39aaee1c028ee1950f6f?s=128&d=identicon&r=PG", "display_name": "Zeta", "link": "https://stackoverflow.com/users/1139697/zeta"}, "reply_to_user": {"reputation": 14781, "user_id": 630160, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/4445f21326af525a8ad19af7e3ae41a8?s=128&d=identicon&r=PG", "display_name": "epsilonhalbe", "link": "https://stackoverflow.com/users/630160/epsilonhalbe"}, "edited": false, "score": 2, "creation_date": 1463138308, "post_id": 37207306, "comment_id": 61948217, "body": "@epsilonhalbe: This is a compiler (well, library) regression in 7.10. It&#39;s fixed in 8.0, though: <a href=\"https://ghc.haskell.org/trac/ghc/ticket/11701\" rel=\"nofollow noreferrer\">ghc.haskell.org/trac/ghc/ticket/11701</a>"}], "answers": [{"comments": [{"owner": {"reputation": 94713, "user_id": 1139697, "user_type": "registered", "accept_rate": 86, "profile_image": "https://www.gravatar.com/avatar/5f136ddb684f39aaee1c028ee1950f6f?s=128&d=identicon&r=PG", "display_name": "Zeta", "link": "https://stackoverflow.com/users/1139697/zeta"}, "edited": false, "score": 5, "creation_date": 1463138391, "post_id": 37208117, "comment_id": 61948269, "body": "Yup. Note that this will be fixed <a href=\"https://ghc.haskell.org/trac/ghc/ticket/11701\" rel=\"nofollow noreferrer\">in 8.0</a>."}, {"owner": {"reputation": 91, "user_id": 6284501, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/65f66ec0b2ad23c1056e119ab2ca27fb?s=128&d=identicon&r=PG&f=1", "display_name": "Chaoyang Jia", "link": "https://stackoverflow.com/users/6284501/chaoyang-jia"}, "edited": false, "score": 0, "creation_date": 1463190070, "post_id": 37208117, "comment_id": 61973799, "body": "@Yuras: Thanks. If changed to Int, running time reduced from 5s to 1.8s."}], "tags": [], "owner": {"reputation": 13626, "user_id": 492865, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/5c69a2080e68c8606961a18aba3a08ec?s=128&d=identicon&r=PG", "display_name": "Yuras", "link": "https://stackoverflow.com/users/492865/yuras"}, "is_accepted": false, "score": 12, "last_activity_date": 1463136649, "creation_date": 1463136649, "answer_id": 37208117, "question_id": 37207306, "link": "https://stackoverflow.com/questions/37207306/why-does-haskells-even-function-slow-my-program-down/37208117#37208117", "title": "Why does Haskell&#39;s &#39;even&#39; function slow my program down?", "body": "<p>If you add <code>{-# NOINLINE myEven #-}</code>, you'll get the same slowdown. The issue is that <code>myEven</code> is defined locally, so it's source is available to compiler, and it is inlined. All allocations and function call itself are eliminated:</p>\n\n<pre><code>Main.$wgo1 [InlPrag=[0], Occ=LoopBreaker]\n  :: GHC.Prim.Word# -&gt; GHC.Prim.Int# -&gt; GHC.Prim.Int#\n[GblId, Arity=2, Caf=NoCafRefs, Str=DmdType &lt;S,1*U&gt;&lt;L,U&gt;]\nMain.$wgo1 =\n  \\ (ww_s6n0 :: GHC.Prim.Word#) (ww1_s6n4 :: GHC.Prim.Int#) -&gt;\n    case ww_s6n0 of wild_X2j {\n      __DEFAULT -&gt;\n        case GHC.Prim.remWord# wild_X2j (__word 2) of _ [Occ=Dead] {\n          __DEFAULT -&gt;\n            Main.$wgo1\n              (GHC.Prim.quotWord#\n                 (GHC.Prim.narrow32Word#\n                    (GHC.Prim.plusWord#\n                       (GHC.Prim.narrow32Word# (GHC.Prim.timesWord# (__word 3) wild_X2j))\n                       (__word 1)))\n                 (__word 2))\n              (GHC.Prim.+# ww1_s6n4 1);\n          __word 0 -&gt;\n            Main.$wgo1\n              (GHC.Prim.quotWord# wild_X2j (__word 2)) (GHC.Prim.+# ww1_s6n4 1)\n        };\n      __word 1 -&gt; ww1_s6n4\n    }\n</code></pre>\n\n<p>But <code>even</code> is defined in other module and it is not marked as <code>INLINE</code> or <code>INLINEABLE</code>. As a result it is not inlined, and each call to <code>even</code> allocates boxed <code>Word32</code>:</p>\n\n<pre><code>Main.$wgo1 [InlPrag=[0], Occ=LoopBreaker]\n  :: GHC.Prim.Word# -&gt; GHC.Prim.Int# -&gt; GHC.Prim.Int#\n[GblId, Arity=2, Str=DmdType &lt;S,U&gt;&lt;L,U&gt;]\nMain.$wgo1 =\n  \\ (ww_s6mz :: GHC.Prim.Word#) (ww1_s6mD :: GHC.Prim.Int#) -&gt;\n    case ww_s6mz of wild_X1W {\n      __DEFAULT -&gt;\n        case even\n               @ Word32 GHC.Word.$fIntegralWord32 (GHC.Word.W32# wild_X1W)\n        of _ [Occ=Dead] {\n          False -&gt;\n            Main.$wgo1\n              (GHC.Prim.quotWord#\n                 (GHC.Prim.narrow32Word#\n                    (GHC.Prim.plusWord#\n                       (GHC.Prim.narrow32Word# (GHC.Prim.timesWord# (__word 3) wild_X1W))\n                       (__word 1)))\n                 (__word 2))\n              (GHC.Prim.+# ww1_s6mD 1);\n          True -&gt;\n            Main.$wgo1\n              (GHC.Prim.quotWord# wild_X1W (__word 2)) (GHC.Prim.+# ww1_s6mD 1)\n        };\n      __word 1 -&gt; ww1_s6mD\n    }\n</code></pre>\n\n<p>Note that <code>even</code> <a href=\"https://hackage.haskell.org/package/base-4.8.2.0/docs/src/GHC.Real.html#even\">is specialized</a> for <code>Int</code> and <code>Integer</code>, but not for <code>Word32</code>, so the issue doesn't occurs if you use <code>Int</code>.</p>\n"}], "owner": {"reputation": 91, "user_id": 6284501, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/65f66ec0b2ad23c1056e119ab2ca27fb?s=128&d=identicon&r=PG&f=1", "display_name": "Chaoyang Jia", "link": "https://stackoverflow.com/users/6284501/chaoyang-jia"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 173, "favorite_count": 3, "closed_date": 1463138208, "answer_count": 1, "score": 9, "last_activity_date": 1463145070, "creation_date": 1463134390, "last_edit_date": 1463145070, "question_id": 37207306, "link": "https://stackoverflow.com/questions/37207306/why-does-haskells-even-function-slow-my-program-down", "closed_reason": "Duplicate", "title": "Why does Haskell&#39;s &#39;even&#39; function slow my program down?", "body": "<p>I have following code. It costs 1s to run with argument 1000000, but it costs 5s to run if replace <em>myEven</em> with standard <a href=\"https://hackage.haskell.org/package/base-4.8.2.0/docs/Prelude.html#v:even\"><em>even</em></a> function. I checked the code, the standard <em>even</em> function does exactly the same as * myEven *.</p>\n\n<pre><code>import Data.Word\nimport Data.List\nimport System.Environment\n\ncollatzNext :: Word32 -&gt; Word32\ncollatzNext a = (if myEven a then a else 3*a+1) `div` 2\n\nmyEven :: (Integral a) =&gt; a -&gt; Bool\nmyEven a = (a `rem` 2) == 0\n\ncollatzLen :: Word32 -&gt; Int\ncollatzLen a0 = length $ takeWhile (/= 1) $ iterate collatzNext a0\n\nmain = do\n    [a0] &lt;- getArgs\n    let max_a0 = (read a0)::Word32\n    print $ maximum $ map (\\a0 -&gt; (collatzLen a0, a0)) [1..max_a0]\n</code></pre>\n"}, {"tags": ["loops", "haskell", "input", "io", "user-input"], "comments": [{"owner": {"reputation": 48129, "user_id": 76051, "user_type": "registered", "accept_rate": 91, "profile_image": "https://i.stack.imgur.com/AGDxz.jpg?s=128&g=1", "display_name": "Carsten", "link": "https://stackoverflow.com/users/76051/carsten"}, "edited": false, "score": 0, "creation_date": 1463131888, "post_id": 37205740, "comment_id": 61944022, "body": "have you tried &lt;CTRL&gt;-D ?"}, {"owner": {"reputation": 4455, "user_id": 1460448, "user_type": "registered", "accept_rate": 71, "profile_image": "https://www.gravatar.com/avatar/0dd5a0fbb2b5d5592a49d2e60ef98f0a?s=128&d=identicon&r=PG&f=1", "display_name": "xji", "link": "https://stackoverflow.com/users/1460448/xji"}, "reply_to_user": {"reputation": 48129, "user_id": 76051, "user_type": "registered", "accept_rate": 91, "profile_image": "https://i.stack.imgur.com/AGDxz.jpg?s=128&g=1", "display_name": "Carsten", "link": "https://stackoverflow.com/users/76051/carsten"}, "edited": false, "score": 0, "creation_date": 1463132001, "post_id": 37205740, "comment_id": 61944091, "body": "@Carsten Doesn&#39;t seem to do anything"}, {"owner": {"reputation": 4455, "user_id": 1460448, "user_type": "registered", "accept_rate": 71, "profile_image": "https://www.gravatar.com/avatar/0dd5a0fbb2b5d5592a49d2e60ef98f0a?s=128&d=identicon&r=PG&f=1", "display_name": "xji", "link": "https://stackoverflow.com/users/1460448/xji"}, "reply_to_user": {"reputation": 48129, "user_id": 76051, "user_type": "registered", "accept_rate": 91, "profile_image": "https://i.stack.imgur.com/AGDxz.jpg?s=128&g=1", "display_name": "Carsten", "link": "https://stackoverflow.com/users/76051/carsten"}, "edited": false, "score": 0, "creation_date": 1463132088, "post_id": 37205740, "comment_id": 61944157, "body": "@Carsten The literal character ^D gets shown in the terminal."}, {"owner": {"reputation": 48129, "user_id": 76051, "user_type": "registered", "accept_rate": 91, "profile_image": "https://i.stack.imgur.com/AGDxz.jpg?s=128&g=1", "display_name": "Carsten", "link": "https://stackoverflow.com/users/76051/carsten"}, "edited": false, "score": 0, "creation_date": 1463132153, "post_id": 37205740, "comment_id": 61944203, "body": "which OS are you using?"}, {"owner": {"reputation": 4455, "user_id": 1460448, "user_type": "registered", "accept_rate": 71, "profile_image": "https://www.gravatar.com/avatar/0dd5a0fbb2b5d5592a49d2e60ef98f0a?s=128&d=identicon&r=PG&f=1", "display_name": "xji", "link": "https://stackoverflow.com/users/1460448/xji"}, "reply_to_user": {"reputation": 48129, "user_id": 76051, "user_type": "registered", "accept_rate": 91, "profile_image": "https://i.stack.imgur.com/AGDxz.jpg?s=128&g=1", "display_name": "Carsten", "link": "https://stackoverflow.com/users/76051/carsten"}, "edited": false, "score": 0, "creation_date": 1463132167, "post_id": 37205740, "comment_id": 61944215, "body": "@Carsten Ubuntu 16.04 LTS"}, {"owner": {"reputation": 48129, "user_id": 76051, "user_type": "registered", "accept_rate": 91, "profile_image": "https://i.stack.imgur.com/AGDxz.jpg?s=128&g=1", "display_name": "Carsten", "link": "https://stackoverflow.com/users/76051/carsten"}, "edited": false, "score": 0, "creation_date": 1463132301, "post_id": 37205740, "comment_id": 61944300, "body": "usually <code>interact</code> will work on the input stream till EOF and you should be able to send this using <code>CTR-D</code> or <code>CTR-Z</code>"}, {"owner": {"reputation": 48129, "user_id": 76051, "user_type": "registered", "accept_rate": 91, "profile_image": "https://i.stack.imgur.com/AGDxz.jpg?s=128&g=1", "display_name": "Carsten", "link": "https://stackoverflow.com/users/76051/carsten"}, "edited": false, "score": 0, "creation_date": 1463132345, "post_id": 37205740, "comment_id": 61944329, "body": "possible duplicate: <a href=\"https://stackoverflow.com/questions/35827615/interact-function-waiting-non-stop-haskell\" title=\"interact function waiting non stop haskell\">stackoverflow.com/questions/35827615/&hellip;</a>"}, {"owner": {"reputation": 44013, "user_id": 1477667, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/trgKM.jpg?s=128&g=1", "display_name": "dfeuer", "link": "https://stackoverflow.com/users/1477667/dfeuer"}, "edited": false, "score": 1, "creation_date": 1463141073, "post_id": 37205740, "comment_id": 61950238, "body": "I generally think of <code>interact</code> as a blast from the past. It&#39;s very rarely seen these days, and I think it&#39;s mostly still here for backwards compatibility."}], "answers": [{"comments": [{"owner": {"reputation": 4455, "user_id": 1460448, "user_type": "registered", "accept_rate": 71, "profile_image": "https://www.gravatar.com/avatar/0dd5a0fbb2b5d5592a49d2e60ef98f0a?s=128&d=identicon&r=PG&f=1", "display_name": "xji", "link": "https://stackoverflow.com/users/1460448/xji"}, "edited": false, "score": 1, "creation_date": 1463139378, "post_id": 37206972, "comment_id": 61949001, "body": "I think this name <code>interact</code> is a bit misleading though. Normally when you think of &quot;interacting&quot; you&#39;d think of something more complicated than what this function provides."}, {"owner": {"reputation": 94713, "user_id": 1139697, "user_type": "registered", "accept_rate": 86, "profile_image": "https://www.gravatar.com/avatar/5f136ddb684f39aaee1c028ee1950f6f?s=128&d=identicon&r=PG", "display_name": "Zeta", "link": "https://stackoverflow.com/users/1139697/zeta"}, "reply_to_user": {"reputation": 4455, "user_id": 1460448, "user_type": "registered", "accept_rate": 71, "profile_image": "https://www.gravatar.com/avatar/0dd5a0fbb2b5d5592a49d2e60ef98f0a?s=128&d=identicon&r=PG&f=1", "display_name": "xji", "link": "https://stackoverflow.com/users/1460448/xji"}, "edited": false, "score": 0, "creation_date": 1463139494, "post_id": 37206972, "comment_id": 61949095, "body": "@JIXiang: It&#39;s more or less interacting as something in a command line pipe, e.g. <code>program1 | haskellprogram | program3</code>. It&#39;s not really meant for human input, though, that&#39;s true."}, {"owner": {"reputation": 94713, "user_id": 1139697, "user_type": "registered", "accept_rate": 86, "profile_image": "https://www.gravatar.com/avatar/5f136ddb684f39aaee1c028ee1950f6f?s=128&d=identicon&r=PG", "display_name": "Zeta", "link": "https://stackoverflow.com/users/1139697/zeta"}, "reply_to_user": {"reputation": 3079, "user_id": 1758363, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/hBUXs.jpg?s=128&g=1", "display_name": "Evgeny", "link": "https://stackoverflow.com/users/1758363/evgeny"}, "edited": false, "score": 1, "creation_date": 1558703749, "post_id": 37206972, "comment_id": 99199282, "body": "@EPo no, that&#39;s from <code>Control.Monad</code>."}], "tags": [], "owner": {"reputation": 94713, "user_id": 1139697, "user_type": "registered", "accept_rate": 86, "profile_image": "https://www.gravatar.com/avatar/5f136ddb684f39aaee1c028ee1950f6f?s=128&d=identicon&r=PG", "display_name": "Zeta", "link": "https://stackoverflow.com/users/1139697/zeta"}, "is_accepted": true, "score": 8, "last_activity_date": 1558703792, "last_edit_date": 1558703792, "creation_date": 1463133515, "answer_id": 37206972, "question_id": 37205740, "link": "https://stackoverflow.com/questions/37205740/haskell-how-do-i-break-out-of-interact/37206972#37206972", "title": "Haskell - How do I break out of interact?", "body": "<blockquote>\n  <p>How should I break out of <code>interact</code>?</p>\n</blockquote>\n\n<p>You can't. You can think of <code>interact f</code> as <code>getContents &gt;&gt;= putStrLn . f</code>. And <code>getContents</code> will close the handle on <code>stdin</code>. Any further operation concerning reading will fail.</p>\n\n<blockquote>\n  <p>The literal character ^D gets shown in the terminal</p>\n</blockquote>\n\n<p>That's a problem with readline. GHCi changes the buffering method of <code>stdin</code> from <code>LineBuffer</code> to <code>NoBuffering</code> to use readline optimally. If you want to exit <code>interact</code> with <code>^D</code>, you need to change the buffering method:</p>\n\n<pre><code>ghci&gt; import System.IO\nghci&gt; hGetBuffering stdin\nNoBuffering\nghci&gt; hSetBuffering stdin LineBuffering\nghci&gt; interact id\nhello world\nhello world\npressing control-D after the next RETURN\npressing control-D after the next RETURN\n&lt;stdin&gt;: hGetBuffering: illegal operation (handle is closed)\n</code></pre>\n\n<blockquote>\n  <p>Or is <code>interact</code> not intended to be used this way and I should compose custom <code>IO</code> functions?</p>\n</blockquote>\n\n<p>Yes, it's not intended to be used this way. <code>interact</code> is meant to use all input and dictate all output. If you want to use use line-wise input, you can write your own line-wise interact method (or use an external library):</p>\n\n<pre><code>import Control.Monad (when)\n\ninteractLine :: (String -&gt; String) -&gt; IO ()\ninteractLine f = loop\n  where\n    loop = do\n      l &lt;- getLine\n      when (l /= \"quit\") $ putStrLn (f l) &gt;&gt; loop\n</code></pre>\n"}], "owner": {"reputation": 4455, "user_id": 1460448, "user_type": "registered", "accept_rate": 71, "profile_image": "https://www.gravatar.com/avatar/0dd5a0fbb2b5d5592a49d2e60ef98f0a?s=128&d=identicon&r=PG&f=1", "display_name": "xji", "link": "https://stackoverflow.com/users/1460448/xji"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 1801, "favorite_count": 0, "accepted_answer_id": 37206972, "answer_count": 1, "score": 8, "last_activity_date": 1558703792, "creation_date": 1463130320, "last_edit_date": 1463131065, "question_id": 37205740, "link": "https://stackoverflow.com/questions/37205740/haskell-how-do-i-break-out-of-interact", "title": "Haskell - How do I break out of interact?", "body": "<p>I am using <code>interact</code> to process some user inputs step-by-step (specifically, it's a chess program). However, I haven't found a way to deal with the situation where the user might want to just break out of the loop and start this match of chess from the beginning.</p>\n\n<p>When I'm executing a normal procedure in ghci, pressing <code>Ctrl-C</code> will not exit the whole ghci, but will just stop the procedure itself and allow me to go on with some other procedures. However, if I press <code>Ctrl-C</code> in the console with the <code>interact</code> function in effect, the following message is shown:</p>\n\n<pre><code>^CInterrupted.\n*Main&gt; \n&lt;stdin&gt;: hGetChar: illegal operation (handle is closed)\n</code></pre>\n\n<p>And then I have to launch ghci all over again.</p>\n\n<p>I also thought of catching special user inputs such as \"exit\", however, since the type of <code>interact</code> is <code>interact :: (String -&gt; String) -&gt; IO ()</code>, the input will have to go through the function typed <code>(String -&gt; String)</code> first, and I haven't found a way for that function to notify the main IO that it should quit.</p>\n\n<p>How should I break out of <code>interact</code>? Or is <code>interact</code> not intended to be used this way and I should compose custom IO functions?</p>\n"}, {"tags": ["haskell"], "comments": [{"owner": {"reputation": 28488, "user_id": 402884, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35583fe46c2cde92467710cc7ceff266?s=128&d=identicon&r=PG", "display_name": "Chris Martin", "link": "https://stackoverflow.com/users/402884/chris-martin"}, "edited": false, "score": 4, "creation_date": 1463130493, "post_id": 37205511, "comment_id": 61943089, "body": "Please include the code that produces that warning."}, {"owner": {"reputation": 100185, "user_id": 3234959, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/93bb12ca0f93dfddb33880316f7e66c2?s=128&d=identicon&r=PG&f=1", "display_name": "chi", "link": "https://stackoverflow.com/users/3234959/chi"}, "edited": false, "score": 1, "creation_date": 1463132344, "post_id": 37205511, "comment_id": 61944328, "body": "There are no overlaps there, AFAICS. Weird warning message. Post the patterns in the actual code."}, {"owner": {"reputation": 3436, "user_id": 4364027, "user_type": "registered", "accept_rate": 64, "profile_image": "https://www.gravatar.com/avatar/e84dbb0e9c838c25bbb70b326fd696aa?s=128&d=identicon&r=PG&f=1", "display_name": "Marko Grdinic", "link": "https://stackoverflow.com/users/4364027/marko-grdinic"}, "edited": false, "score": 0, "creation_date": 1463132919, "post_id": 37205511, "comment_id": 61944710, "body": "Added extra information."}, {"owner": {"reputation": 153048, "user_id": 9204, "user_type": "registered", "accept_rate": 82, "profile_image": "https://www.gravatar.com/avatar/c79937a093ff9e963c563e22cd385f30?s=128&d=identicon&r=PG", "display_name": "Alexey Romanov", "link": "https://stackoverflow.com/users/9204/alexey-romanov"}, "edited": false, "score": 0, "creation_date": 1463134037, "post_id": 37205511, "comment_id": 61945516, "body": "Possible duplicate of <a href=\"http://stackoverflow.com/questions/9336385/why-do-these-pattern-matches-overlap\">why do these pattern matches overlap?</a> and <a href=\"http://stackoverflow.com/questions/7648958/haskell-pattern-matches-are-overlapped\" title=\"haskell pattern matches are overlapped\">stackoverflow.com/questions/7648958/&hellip;</a>"}], "answers": [{"tags": [], "owner": {"reputation": 100185, "user_id": 3234959, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/93bb12ca0f93dfddb33880316f7e66c2?s=128&d=identicon&r=PG&f=1", "display_name": "chi", "link": "https://stackoverflow.com/users/3234959/chi"}, "is_accepted": true, "score": 3, "last_activity_date": 1463133854, "creation_date": 1463133854, "answer_id": 37207113, "question_id": 37205511, "link": "https://stackoverflow.com/questions/37205511/why-are-patterns-overlapping-in-this-example/37207113#37207113", "title": "Why are patterns overlapping in this example?", "body": "<pre><code>eval env (List (function : args)) = do\n</code></pre>\n\n<p>The above overlaps with subsequent patterns, e.g.</p>\n\n<pre><code>eval env (List (Atom \"define\" : List (Atom var : params) : body)) =\n</code></pre>\n\n<p>since <code>function</code> can be <code>Atom \"define\"</code> and <code>args</code> can be <code>List (Atom var : params) : body</code>.</p>\n\n<p>Moreover, the pattern</p>\n\n<pre><code>eval env badForm = \n</code></pre>\n\n<p>matches with everything at all. It should be the very last one.</p>\n"}, {"tags": [], "owner": {"reputation": 34889, "user_id": 86604, "user_type": "registered", "accept_rate": 80, "profile_image": "https://www.gravatar.com/avatar/329af917389e6cf8e146c03012f5319a?s=128&d=identicon&r=PG", "display_name": "Ingo", "link": "https://stackoverflow.com/users/86604/ingo"}, "is_accepted": false, "score": 3, "last_activity_date": 1463133972, "creation_date": 1463133972, "answer_id": 37207151, "question_id": 37205511, "link": "https://stackoverflow.com/questions/37205511/why-are-patterns-overlapping-in-this-example/37207151#37207151", "title": "Why are patterns overlapping in this example?", "body": "<p>You have:</p>\n\n<pre><code>eval env badForm = throwError $ BadSpecialForm \"Unrecognized special form\" badForm\n</code></pre>\n\n<p>Any clause that comes after this must by necessity have an overlapping pattern. Incidentally, that are the ones the compiler mentions.</p>\n"}], "owner": {"reputation": 3436, "user_id": 4364027, "user_type": "registered", "accept_rate": 64, "profile_image": "https://www.gravatar.com/avatar/e84dbb0e9c838c25bbb70b326fd696aa?s=128&d=identicon&r=PG&f=1", "display_name": "Marko Grdinic", "link": "https://stackoverflow.com/users/4364027/marko-grdinic"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 79, "favorite_count": 0, "accepted_answer_id": 37207113, "answer_count": 2, "score": 0, "last_activity_date": 1463135307, "creation_date": 1463129644, "last_edit_date": 1463135307, "question_id": 37205511, "link": "https://stackoverflow.com/questions/37205511/why-are-patterns-overlapping-in-this-example", "title": "Why are patterns overlapping in this example?", "body": "<pre><code>scheme.hs:184:1: Warning:\n    Pattern match(es) are overlapped\n    In an equation for `eval':\n        eval env (List (Atom \"define\" : List (Atom var : params) : body))\n             =\n             ...\n        eval env\n             (List (Atom \"define\" : DottedList (Atom var : params)\n                                               varargs : body))\n             =\n             ...\n        eval env (List (Atom \"lambda\" : List params : body)) = ...\n        eval env (List (Atom \"lambda\" : DottedList params varargs : body))\n             =\n             ...\n        ...\n</code></pre>\n\n<p>From the <a href=\"https://en.wikibooks.org/wiki/Write_Yourself_a_Scheme_in_48_Hours/Defining_Scheme_Functions\" rel=\"nofollow\">Write Yourself a Scheme in 48 Hours</a> book. I do not know Haskell, but I do know some functional programming and despite that I can't figure out why those two patterns are overlapping.</p>\n\n<p>Can anybody explain to me the above error? Thanks.</p>\n\n<p>Edit: I thought the above snippet might be enough.</p>\n\n<pre><code>eval :: Env -&gt; LispVal -&gt; IOThrowsError LispVal\neval env val@(String _) = return val\neval env val@(Number _) = return val\neval env val@(Bool _) = return val\neval env (Atom id) = getVar env id\neval env (List [Atom \"quote\", val]) = return val\neval env (List [Atom \"if\", pred, conseq, alt]) =\n    do result &lt;- eval env pred\n       case result of\n             Bool False -&gt; eval env alt\n             otherwise -&gt; eval env conseq\neval env (List [Atom \"set!\", Atom var, form]) =\n    eval env form &gt;&gt;= setVar env var\neval env (List [Atom \"define\", Atom var, form]) =\n    eval env form &gt;&gt;= defineVar env var\neval env (List (function : args)) = do\n     func &lt;- eval env function\n     argVals &lt;- mapM (eval env) args\n     apply func argVals\neval env badForm = throwError $ BadSpecialForm \"Unrecognized special form\" badForm\neval env (List (Atom \"define\" : List (Atom var : params) : body)) =\n     makeNormalFunc env params body &gt;&gt;= defineVar env var\neval env (List (Atom \"define\" : DottedList (Atom var : params) varargs : body)) =\n     makeVarArgs varargs env params body &gt;&gt;= defineVar env var\neval env (List (Atom \"lambda\" : List params : body)) =\n     makeNormalFunc env params body\neval env (List (Atom \"lambda\" : DottedList params varargs : body)) =\n     makeVarArgs varargs env params body\neval env (List (Atom \"lambda\" : varargs@(Atom _) : body)) =\n     makeVarArgs varargs env [] body\n</code></pre>\n\n<p>Here is the whole thing in this <a href=\"http://pastebin.com/kJj946iR\" rel=\"nofollow\">pastebin</a>.</p>\n\n<p>Edit2: Well, the question is not a duplicate because it is clearly different.</p>\n\n<p>But for me to miss the <code>eval env badForm = throwError $ BadSpecialForm \"Unrecognized special form\" badForm</code> line, I really must be out of it. The <code>eval env (List (function : args)) = ...</code> should also be lower.</p>\n\n<p>I can only conclude that my level of immersion is way too low for this exercise.</p>\n\n<p>At any rate, I see it now. Thanks everyone.</p>\n"}, {"tags": ["haskell"], "comments": [{"owner": {"reputation": 461, "user_id": 5741218, "user_type": "registered", "profile_image": "https://lh5.googleusercontent.com/-_8TKs_U1Ss4/AAAAAAAAAAI/AAAAAAAAABc/UN5oOyx9hT4/photo.jpg?sz=128", "display_name": "Nadim Baraky", "link": "https://stackoverflow.com/users/5741218/nadim-baraky"}, "edited": false, "score": 0, "creation_date": 1463123311, "post_id": 37203103, "comment_id": 61938533, "body": "I don&#39;t know about Haskell, but I found this; check if it helps: &quot;The usual way to convert an Int to a Double is to use fromIntegral, which has the type (Integral a, Num b) =&gt; a -&gt; b. This means that it converts an Integral type (Int and Integer) to any numeric type b, of which Double is an instance.&quot;"}], "answers": [{"comments": [{"owner": {"reputation": 601, "user_id": 6005857, "user_type": "registered", "accept_rate": 94, "profile_image": "https://www.gravatar.com/avatar/10940e23bda8cf7bbc35957025ef3348?s=128&d=identicon&r=PG&f=1", "display_name": "user6005857", "link": "https://stackoverflow.com/users/6005857/user6005857"}, "edited": false, "score": 0, "creation_date": 1463123021, "post_id": 37203317, "comment_id": 61938376, "body": "None intuitive name haha"}, {"owner": {"reputation": 48129, "user_id": 76051, "user_type": "registered", "accept_rate": 91, "profile_image": "https://i.stack.imgur.com/AGDxz.jpg?s=128&g=1", "display_name": "Carsten", "link": "https://stackoverflow.com/users/76051/carsten"}, "reply_to_user": {"reputation": 601, "user_id": 6005857, "user_type": "registered", "accept_rate": 94, "profile_image": "https://www.gravatar.com/avatar/10940e23bda8cf7bbc35957025ef3348?s=128&d=identicon&r=PG&f=1", "display_name": "user6005857", "link": "https://stackoverflow.com/users/6005857/user6005857"}, "edited": false, "score": 2, "creation_date": 1463123232, "post_id": 37203317, "comment_id": 61938488, "body": "@user6005857 why? You probably are just <i>used</i>  to saying where you want to go instead of where you are coming from - but when the compiler knows the destination already ..."}, {"owner": {"reputation": 601, "user_id": 6005857, "user_type": "registered", "accept_rate": 94, "profile_image": "https://www.gravatar.com/avatar/10940e23bda8cf7bbc35957025ef3348?s=128&d=identicon&r=PG&f=1", "display_name": "user6005857", "link": "https://stackoverflow.com/users/6005857/user6005857"}, "edited": false, "score": 0, "creation_date": 1463124067, "post_id": 37203317, "comment_id": 61938955, "body": "True, it makes sense."}], "tags": [], "owner": {"reputation": 49959, "user_id": 866915, "user_type": "registered", "accept_rate": 70, "profile_image": "https://www.gravatar.com/avatar/09242131d6e17cbbe31e8547514da6e5?s=128&d=identicon&r=PG", "display_name": "ErikR", "link": "https://stackoverflow.com/users/866915/erikr"}, "is_accepted": true, "score": 8, "last_activity_date": 1463123003, "creation_date": 1463123003, "answer_id": 37203317, "question_id": 37203103, "link": "https://stackoverflow.com/questions/37203103/how-to-convert-from-int-to-double/37203317#37203317", "title": "How to convert from Int to Double?", "body": "<p>Use <code>fromIntegral</code>:</p>\n\n<pre><code> (Integral a, Num b) =&gt; a -&gt; b\n</code></pre>\n\n<p>It will convert an integral type (i.e. an Int, Integer, etc.) into another Num type.</p>\n"}], "owner": {"reputation": 601, "user_id": 6005857, "user_type": "registered", "accept_rate": 94, "profile_image": "https://www.gravatar.com/avatar/10940e23bda8cf7bbc35957025ef3348?s=128&d=identicon&r=PG&f=1", "display_name": "user6005857", "link": "https://stackoverflow.com/users/6005857/user6005857"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 5315, "favorite_count": 0, "accepted_answer_id": 37203317, "answer_count": 1, "score": 2, "last_activity_date": 1463124080, "creation_date": 1463122355, "last_edit_date": 1463124080, "question_id": 37203103, "link": "https://stackoverflow.com/questions/37203103/how-to-convert-from-int-to-double", "title": "How to convert from Int to Double?", "body": "<p>I have a function that takes a double as input but I have to pass an Int to it and it is giving me this error:</p>\n\n<p>No instance for No instance for (Fractional Int) arising from a use of \u2018/\u2019</p>\n\n<p>Here are my functions:</p>\n\n<pre><code>foo1 :: Int  -&gt; Int\nfoo1 x1 = foo2 (x1 + 1)\n\nfoo2 :: Double -&gt; Int\nfoo2 x = round (((3244325 * x^343)/2352352656) - ((3432 * x^234)/45324645500) + ((23453 * x^21)/2534743435)\n</code></pre>\n\n<p>I am not sure how to get around this problem.</p>\n\n<p>Does something like the following exist:</p>\n\n<pre><code>foo1 :: Int  -&gt; Int\nfoo1 x1 = foo2 $ convertToDouble $ (x1 + 1)\n</code></pre>\n"}, {"tags": ["haskell", "localization", "yesod"], "answers": [{"tags": [], "owner": {"reputation": 14781, "user_id": 630160, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/4445f21326af525a8ad19af7e3ae41a8?s=128&d=identicon&r=PG", "display_name": "epsilonhalbe", "link": "https://stackoverflow.com/users/630160/epsilonhalbe"}, "is_accepted": true, "score": 3, "last_activity_date": 1463127141, "creation_date": 1463127141, "answer_id": 37204688, "question_id": 37201789, "link": "https://stackoverflow.com/questions/37201789/localization-in-yesod/37204688#37204688", "title": "Localization in Yesod", "body": "<p>I think the <a href=\"http://www.yesodweb.com/book/internationalization\" rel=\"nofollow\">yesod book</a> has an example that should solve your issue exactly, two languages (hebrew, english), and messages that should be displayed.</p>\n\n<p>Also the <a href=\"http://haddock.stackage.org/nightly-2016-04-19/shakespeare-2.0.8.1/Text-Shakespeare-I18N.html\" rel=\"nofollow\">documentation</a> is quite clear about this the <code>mkMessages</code> function</p>\n\n<blockquote>\n  <p><code>mkMessage</code></p>\n  \n  <p><code>:: String</code>    base name to use for translation type<br/>\n  <code>-&gt; FilePath</code>  subdirectory which contains the translation files<br/>\n  <code>-&gt; Lang</code>  default translation language<br/>\n  <code>-&gt; Q [Dec]</code>    generate translations from translation files<br/></p>\n  \n  <p>This function will:</p>\n  \n  <p>look in the supplied subdirectory for files ending in .msg generate a\n  type based on the constructors found create a <code>RenderMessage</code> instance</p>\n</blockquote>\n\n<p>So you are trying to have multiple default languages - which is not possible. Please read the link I have provided to the yesod book - I hope this solves all your problems.</p>\n"}], "owner": {"reputation": 375, "user_id": 5287908, "user_type": "registered", "accept_rate": 89, "profile_image": "https://i.stack.imgur.com/w0QJd.png?s=128&g=1", "display_name": "QSpider", "link": "https://stackoverflow.com/users/5287908/qspider"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 138, "favorite_count": 1, "accepted_answer_id": 37204688, "answer_count": 1, "score": -2, "last_activity_date": 1463127141, "creation_date": 1463116779, "question_id": 37201789, "link": "https://stackoverflow.com/questions/37201789/localization-in-yesod", "title": "Localization in Yesod", "body": "<p>I use the localization for application from yesod (module Text.Shakespeare.I18N).\nBelow is example of code</p>\n\n<pre><code>data STest = STest\nmkMessage \"STest\" \"messages\" (\"ru\")\ntrMsg msg  = renderMessage STest [\"ru\"] msg\n</code></pre>\n\n<p>But if I want use several localization at the same time, I try</p>\n\n<pre><code>mkMessage \"STest\" \"messages\" (\"ru\")\nmkMessage \"STest\" \"messages\" (\"en\")\n</code></pre>\n\n<p>or</p>\n\n<pre><code>mkMessage \"STest\" \"messages\" (\"ru\", \"en\")\n</code></pre>\n\n<p>This decision was an error!\nHow can i use several localization at the same time?</p>\n\n<p>Thank you in advance for your help!</p>\n"}, {"tags": ["haskell", "pattern-matching"], "answers": [{"comments": [{"owner": {"reputation": 14050, "user_id": 3772221, "user_type": "registered", "accept_rate": 97, "profile_image": "https://i.stack.imgur.com/xfx4l.png?s=128&g=1", "display_name": "m0meni", "link": "https://stackoverflow.com/users/3772221/m0meni"}, "edited": false, "score": 0, "creation_date": 1463116269, "post_id": 37201683, "comment_id": 61935333, "body": "I know it took me 1 minute after asking the question to figure this out, but since <a href=\"https://www.google.com/search?q=haskell+otherwise+pattern+match&amp;oq=haskell+other&amp;aqs=chrome.0.69i59j0j69i57j0l3.1382j0j4&amp;sourceid=chrome&amp;ie=UTF-8\" rel=\"nofollow noreferrer\">haskell otherwise pattern match</a> turns up nothing definitive on google I figured I shouldn&#39;t delete my question."}], "tags": [], "owner": {"reputation": 14050, "user_id": 3772221, "user_type": "registered", "accept_rate": 97, "profile_image": "https://i.stack.imgur.com/xfx4l.png?s=128&g=1", "display_name": "m0meni", "link": "https://stackoverflow.com/users/3772221/m0meni"}, "is_accepted": false, "score": 3, "last_activity_date": 1463116152, "creation_date": 1463116152, "answer_id": 37201683, "question_id": 37201661, "link": "https://stackoverflow.com/questions/37201661/haskell-otherwise-pattern-match/37201683#37201683", "title": "Haskell &quot;otherwise&quot; pattern match?", "body": "<p>Turns out order matters in pattern matching, and I didn't know that:</p>\n\n<pre><code>swapInPairs :: [a] -&gt; [a]\nswapInPairs (x:y:ys) = y : x : swapInPairs ys\nswapInPairs x = x\n</code></pre>\n\n<p>works.</p>\n"}, {"comments": [{"owner": {"reputation": 14050, "user_id": 3772221, "user_type": "registered", "accept_rate": 97, "profile_image": "https://i.stack.imgur.com/xfx4l.png?s=128&g=1", "display_name": "m0meni", "link": "https://stackoverflow.com/users/3772221/m0meni"}, "edited": false, "score": 0, "creation_date": 1463116418, "post_id": 37201715, "comment_id": 61935386, "body": "Yep! I figured it out right after I posted it, but I&#39;ll probably end up accepting your answer just because I like <code>ide-haskell</code> a lot :p. Thanks for working on it."}, {"owner": {"reputation": 499, "user_id": 4629794, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/fb19f570a2d96e68ec79f0af208d23a8?s=128&d=identicon&r=PG", "display_name": "lierdakil", "link": "https://stackoverflow.com/users/4629794/lierdakil"}, "reply_to_user": {"reputation": 14050, "user_id": 3772221, "user_type": "registered", "accept_rate": 97, "profile_image": "https://i.stack.imgur.com/xfx4l.png?s=128&g=1", "display_name": "m0meni", "link": "https://stackoverflow.com/users/3772221/m0meni"}, "edited": false, "score": 1, "creation_date": 1463116604, "post_id": 37201715, "comment_id": 61935449, "body": "Thank you for using it :)"}], "tags": [], "owner": {"reputation": 499, "user_id": 4629794, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/fb19f570a2d96e68ec79f0af208d23a8?s=128&d=identicon&r=PG", "display_name": "lierdakil", "link": "https://stackoverflow.com/users/4629794/lierdakil"}, "is_accepted": true, "score": 7, "last_activity_date": 1463116345, "creation_date": 1463116345, "answer_id": 37201715, "question_id": 37201661, "link": "https://stackoverflow.com/questions/37201661/haskell-otherwise-pattern-match/37201715#37201715", "title": "Haskell &quot;otherwise&quot; pattern match?", "body": "<p>Pattern matching in general gets applied sequentially.</p>\n\n<p>So if you have a 'catch-all' version <em>after</em> a more specific pattern, more specific pattern will get matched first, and if it's impossible, a 'catch-all' will do its thing.</p>\n\n<p>So you can do</p>\n\n<pre><code>swapInPairs :: [a] -&gt; [a]\nswapInPairs (x:y:ys) = y : x : swapInPairs ys\nswapInPairs x = x\n</code></pre>\n"}], "owner": {"reputation": 14050, "user_id": 3772221, "user_type": "registered", "accept_rate": 97, "profile_image": "https://i.stack.imgur.com/xfx4l.png?s=128&g=1", "display_name": "m0meni", "link": "https://stackoverflow.com/users/3772221/m0meni"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 710, "favorite_count": 1, "accepted_answer_id": 37201715, "answer_count": 2, "score": 1, "last_activity_date": 1463116345, "creation_date": 1463116033, "question_id": 37201661, "link": "https://stackoverflow.com/questions/37201661/haskell-otherwise-pattern-match", "title": "Haskell &quot;otherwise&quot; pattern match?", "body": "<p>I have the following code:</p>\n\n<pre><code>swapInPairs :: [a] -&gt; [a]\nswapInPairs [] = []\nswapInPairs [x] = [x]\nswapInPairs (x:y:ys) = y : x : swapInPairs ys\n</code></pre>\n\n<p>is there any way to do something like</p>\n\n<pre><code>swapInPairs :: [a] -&gt; [a]\nswapInPairs (x:y:ys) = y : x : swapInPairs ys\notherwise = id\n</code></pre>\n\n<p>I know it's not really a big deal, and only gets rid of one line of code, but I'm curious if there's something like this for pattern matching since guards have \"otherwise\".</p>\n"}, {"tags": ["haskell", "versioning"], "answers": [{"tags": [], "owner": {"reputation": 24028, "user_id": 383200, "user_type": "registered", "accept_rate": 60, "profile_image": "https://www.gravatar.com/avatar/a9dc722f936cb1059adaae4fe39c07f0?s=128&d=identicon&r=PG", "display_name": "Carl", "link": "https://stackoverflow.com/users/383200/carl"}, "is_accepted": false, "score": 5, "last_activity_date": 1463116908, "creation_date": 1463116908, "answer_id": 37201808, "question_id": 37201431, "link": "https://stackoverflow.com/questions/37201431/why-does-haskell-versioning-policy-have-two-places-for-major-version-not-one-li/37201808#37201808", "title": "Why does haskell versioning policy have two places for major version, not one like in semantic versioning?", "body": "<p>There are lots of changes that require a major version bump, but actually are small changes to the library.  Things like adding a <code>Functor</code> or <code>Traversable</code> instance are pretty small changes, but require a major version bump.  Removing a function from the api requires a major version bump.</p>\n\n<p>But lots of libraries also undergo <em>huge</em> changes.  Entire rewrites of the API.  Changing the semantics of core types and functions.  Replacing the whole thing in search of better abstraction.</p>\n\n<p>The former changes call for updates to B.  The latter for updates to A.  There are judgment calls to be made in the middle, certainly.  But the rough rule is that B is incremented for small things that require a major version bump, and A is incremented for significant API changes.</p>\n"}], "owner": {"reputation": 677, "user_id": 662716, "user_type": "registered", "accept_rate": 67, "profile_image": "https://www.gravatar.com/avatar/7e09655fd68e038c553fd501c69a6161?s=128&d=identicon&r=PG", "display_name": "Victor Denisov", "link": "https://stackoverflow.com/users/662716/victor-denisov"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 72, "favorite_count": 0, "answer_count": 1, "score": 3, "last_activity_date": 1463122584, "creation_date": 1463114657, "last_edit_date": 1463122584, "question_id": 37201431, "link": "https://stackoverflow.com/questions/37201431/why-does-haskell-versioning-policy-have-two-places-for-major-version-not-one-li", "title": "Why does haskell versioning policy have two places for major version, not one like in semantic versioning?", "body": "<p>I understand the reasoning when and why we should bump major version and minor version. But what is the point to have <code>A.B</code> for major and <code>C</code> for minor? When should I bump <code>A</code> and when <code>B</code>? Why do we not have only one place for major version like in <a href=\"http://semver.org/\" rel=\"nofollow\">semantic versioning</a> policy?</p>\n"}, {"tags": ["list", "haskell", "combinations"], "comments": [{"owner": {"reputation": 507143, "user_id": 1048572, "user_type": "registered", "accept_rate": 77, "profile_image": "https://www.gravatar.com/avatar/7f2c4de95e8f4f8f5a71c3aaf0ed312a?s=128&d=identicon&r=PG", "display_name": "Bergi", "link": "https://stackoverflow.com/users/1048572/bergi"}, "edited": false, "score": 0, "creation_date": 1463105260, "post_id": 37199985, "comment_id": 61932484, "body": "There are only 64000000 (20^6) of them, how is that &quot;too many&quot;? You probably should use a more clever approach to your actual problem. What are these magical ints, what are you doing with them, and why do you need so many?"}, {"owner": {"reputation": 49959, "user_id": 866915, "user_type": "registered", "accept_rate": 70, "profile_image": "https://www.gravatar.com/avatar/09242131d6e17cbbe31e8547514da6e5?s=128&d=identicon&r=PG", "display_name": "ErikR", "link": "https://stackoverflow.com/users/866915/erikr"}, "edited": false, "score": 0, "creation_date": 1463105591, "post_id": 37199985, "comment_id": 61932543, "body": "I think you&#39;ll find the examples on the Haskell wiki page on <a href=\"https://wiki.haskell.org/List_comprehension\" rel=\"nofollow noreferrer\">List Comprehensions</a> helpful."}, {"owner": {"reputation": 45534, "user_id": 106104, "user_type": "registered", "accept_rate": 62, "profile_image": "https://www.gravatar.com/avatar/c88b9310b92a937108ec4336c2832f92?s=128&d=identicon&r=PG", "display_name": "user253751", "link": "https://stackoverflow.com/users/106104/user253751"}, "reply_to_user": {"reputation": 507143, "user_id": 1048572, "user_type": "registered", "accept_rate": 77, "profile_image": "https://www.gravatar.com/avatar/7f2c4de95e8f4f8f5a71c3aaf0ed312a?s=128&d=identicon&r=PG", "display_name": "Bergi", "link": "https://stackoverflow.com/users/1048572/bergi"}, "edited": false, "score": 0, "creation_date": 1463109701, "post_id": 37199985, "comment_id": 61933494, "body": "@Bergi If you actually read the surrounding context, it&#39;s too many to process <i>by hand</i>."}, {"owner": {"reputation": 499, "user_id": 4629794, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/fb19f570a2d96e68ec79f0af208d23a8?s=128&d=identicon&r=PG", "display_name": "lierdakil", "link": "https://stackoverflow.com/users/4629794/lierdakil"}, "reply_to_user": {"reputation": 45534, "user_id": 106104, "user_type": "registered", "accept_rate": 62, "profile_image": "https://www.gravatar.com/avatar/c88b9310b92a937108ec4336c2832f92?s=128&d=identicon&r=PG", "display_name": "user253751", "link": "https://stackoverflow.com/users/106104/user253751"}, "edited": false, "score": 0, "creation_date": 1463115943, "post_id": 37199985, "comment_id": 61935216, "body": "@immibis, it probably was sarcasm. 20\u2076 is quite a lot, and in many cases you don&#39;t actually need that It&#39;s impossible to tell without knowing the actual problem though."}], "answers": [{"tags": [], "owner": {"reputation": 587, "user_id": 1015602, "user_type": "registered", "accept_rate": 58, "profile_image": "https://www.gravatar.com/avatar/ea1629e2c2d1d82ab8c3645d82ecc60d?s=128&d=identicon&r=PG", "display_name": "Free_D", "link": "https://stackoverflow.com/users/1015602/free-d"}, "is_accepted": false, "score": 1, "last_activity_date": 1463105511, "last_edit_date": 1463105511, "creation_date": 1463105006, "answer_id": 37200114, "question_id": 37199985, "link": "https://stackoverflow.com/questions/37199985/generate-all-combinations-of-a-6-element-list-and-apply-a-function-to-each-combi/37200114#37200114", "title": "Generate all combinations of a 6 element list and apply a function to each combination", "body": "<p><code>foo f xs = map (\\ys -&gt; (ys,f ys)) (replicateM (length xs) xs)</code></p>\n\n<p>Here <code>replicateM (length xs) xs</code> will generate all combinations of the elements in <code>xs</code>.  Then you just map over it.</p>\n\n<p>Results in GHCI:</p>\n\n<pre><code>&gt;import Control.Monad\n&gt;let foo f xs = map (\\ys -&gt; (ys,f ys)) (replicateM (length xs) xs)\n&gt;foo sum [1,2]\n[([1,1],2),([1,2],3),([2,1],3),([2,2],4)]\n</code></pre>\n"}, {"tags": [], "owner": {"reputation": 499, "user_id": 4629794, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/fb19f570a2d96e68ec79f0af208d23a8?s=128&d=identicon&r=PG", "display_name": "lierdakil", "link": "https://stackoverflow.com/users/4629794/lierdakil"}, "is_accepted": true, "score": 3, "last_activity_date": 1463119824, "last_edit_date": 1495539847, "creation_date": 1463119099, "answer_id": 37202228, "question_id": 37199985, "link": "https://stackoverflow.com/questions/37199985/generate-all-combinations-of-a-6-element-list-and-apply-a-function-to-each-combi/37202228#37202228", "title": "Generate all combinations of a 6 element list and apply a function to each combination", "body": "<p>As far as I can tell, you want a cartesian product (denoted by \u00d7 here) of 6 lists <code>[0..20]</code>.</p>\n\n<p>So essentially, something like this:</p>\n\n<pre><code>[0..20]\u00d7[0..20]\u00d7[0..20]\u00d7[0..20]\u00d7[0..20]\u00d7[0..20]\n</code></pre>\n\n<p>That's a <em>lot</em> of elements (85,766,121 to be exact). But, it could be done.</p>\n\n<p>Perhaps an easier to understand version is as follows.</p>\n\n<p>Let us define a function, <code>cart</code>, that would do something like a cartesian product over a list and a list of lists:</p>\n\n<pre><code>let cart xs ls = [x:l | x &lt;- xs, l &lt;- ls]\n</code></pre>\n\n<p>This function will take all elements from <code>xs</code>, and all elements from <code>ls</code> and build a list of lists with all possible concatenations.</p>\n\n<p>Now, we need a base case. Suppose you wanted a list of lists of a <em>single</em> element instead of six. How would you apply our <code>cart</code> function? Well, since it adds each element from first argument to every element in second argument, we can pass a list of a single empty list as a second argument, and <code>[0..20]</code> as first argument:</p>\n\n<pre><code>cart [0..20] [[]]\n</code></pre>\n\n<p>We get</p>\n\n<pre><code>[[0],[1],[2],[3],[4],[5],[6],[7],[8],[9],[10],[11],[12],[13],[14],[15],[16],[17],[18],[19],[20]]\n</code></pre>\n\n<p>Great. Now we just apply it 6 times to its own result, starting with <code>[[]]</code>:</p>\n\n<pre><code>foldr ($) [[]] $ replicate 6 (cart [0..20])\n</code></pre>\n\n<p><code>($)</code> is function application.</p>\n\n<p><code>replicateM</code> from <code>Control.Monad</code> (defined as <code>sequence</code> of <code>n</code> monadic actions: <code>replicateM n x = sequence (replicate n x)</code>) basically does the same when applied to lists (see e.g. <a href=\"https://stackoverflow.com/questions/5299295/why-does-application-of-sequence-on-list-of-lists-lead-to-computation-of-its-c\">Why does application of `sequence` on List of Lists lead to computation of its Cartesian Product?</a> for why exactly that is) So shorter answer would be like this:</p>\n\n<pre><code>replicateM 6 [0..20]\n</code></pre>\n\n<p>You can map over those after this, e.g.</p>\n\n<pre><code>map (\\x -&gt; (x, magicFunction x)) $ replicateM 6 [0..20]\n</code></pre>\n"}], "owner": {"reputation": 601, "user_id": 6005857, "user_type": "registered", "accept_rate": 94, "profile_image": "https://www.gravatar.com/avatar/10940e23bda8cf7bbc35957025ef3348?s=128&d=identicon&r=PG&f=1", "display_name": "user6005857", "link": "https://stackoverflow.com/users/6005857/user6005857"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 522, "favorite_count": 1, "accepted_answer_id": 37202228, "answer_count": 2, "score": 0, "last_activity_date": 1463119824, "creation_date": 1463103919, "last_edit_date": 1463104234, "question_id": 37199985, "link": "https://stackoverflow.com/questions/37199985/generate-all-combinations-of-a-6-element-list-and-apply-a-function-to-each-combi", "title": "Generate all combinations of a 6 element list and apply a function to each combination", "body": "<p>I want to generate all possible combinations of a 6 element list [x1,x2,x3,x4,x5,x6] with each xi being a number between 0 and 20.</p>\n\n<p>I want to generate all possible combinations of such list, apply a function (takes the list as input and outputs a magical Int) to each list, then output the results to a list of tuples. So the list of tuples looks like</p>\n\n<pre><code>[([x11,x21,x31,x41,x51,x61],Int1), ([x12,x22,x32,x42,x52,x62],Int2), ...]\n</code></pre>\n\n<p>I tried to this by hand by quickly realised that there are too many combinations and it is practically impossible to do by hand.</p>\n\n<p>The combinations are like [0,0,0,0,0,0], [1,7,0,10,11,6], [7,7,7,7,6,6], [20,20,20,20,20,20] and so on.</p>\n\n<p>I know how to generate all combinations of a list and put them in a list of lists (because I asked this before)</p>\n\n<pre><code>foo [] = [[]]\nfoo (x:xs) = foo xs ++ map (x:) (foo xs)\n</code></pre>\n\n<p>What I want to achieve this time is different because I am not trying to generate the different combinations within a particular list, I am trying to generate all 6 element lists.</p>\n"}, {"tags": ["haskell", "do-notation"], "answers": [{"comments": [{"owner": {"reputation": 37991, "user_id": 409976, "user_type": "registered", "accept_rate": 68, "profile_image": "https://www.gravatar.com/avatar/9ccda0b49cc974197399eae01ebd6850?s=128&d=identicon&r=PG", "display_name": "Kevin Meredith", "link": "https://stackoverflow.com/users/409976/kevin-meredith"}, "edited": false, "score": 0, "creation_date": 1463117640, "post_id": 37199858, "comment_id": 61935825, "body": "Could you please explain how void would be used per your mention of it?"}, {"owner": {"reputation": 100185, "user_id": 3234959, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/93bb12ca0f93dfddb33880316f7e66c2?s=128&d=identicon&r=PG&f=1", "display_name": "chi", "link": "https://stackoverflow.com/users/3234959/chi"}, "reply_to_user": {"reputation": 37991, "user_id": 409976, "user_type": "registered", "accept_rate": 68, "profile_image": "https://www.gravatar.com/avatar/9ccda0b49cc974197399eae01ebd6850?s=128&d=identicon&r=PG", "display_name": "Kevin Meredith", "link": "https://stackoverflow.com/users/409976/kevin-meredith"}, "edited": false, "score": 0, "creation_date": 1463126653, "post_id": 37199858, "comment_id": 61940613, "body": "@KevinMeredith <code>void (receive requester)</code> or more conveniently <code>void $ receive requester</code>"}], "tags": [], "owner": {"reputation": 15757, "user_id": 176841, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/45a168cb9eb8454d66c78f18e29d9342?s=128&d=identicon&r=PG", "display_name": "jberryman", "link": "https://stackoverflow.com/users/176841/jberryman"}, "is_accepted": true, "score": 8, "last_activity_date": 1463102720, "creation_date": 1463102720, "answer_id": 37199858, "question_id": 37199776, "link": "https://stackoverflow.com/questions/37199776/using-f-instead-of-f-alone/37199858#37199858", "title": "Using (_ &lt;- f) instead of f Alone?", "body": "<p>That's a common way to silence warnings about throwing away a value, when you've got something of type <code>m a</code> where <code>a</code> is not <code>()</code>. Another common way to do this is with <code>void</code>.</p>\n"}], "owner": {"reputation": 37991, "user_id": 409976, "user_type": "registered", "accept_rate": 68, "profile_image": "https://www.gravatar.com/avatar/9ccda0b49cc974197399eae01ebd6850?s=128&d=identicon&r=PG", "display_name": "Kevin Meredith", "link": "https://stackoverflow.com/users/409976/kevin-meredith"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 66, "favorite_count": 1, "accepted_answer_id": 37199858, "answer_count": 1, "score": 0, "last_activity_date": 1463103119, "creation_date": 1463101937, "last_edit_date": 1463103119, "question_id": 37199776, "link": "https://stackoverflow.com/questions/37199776/using-f-instead-of-f-alone", "title": "Using (_ &lt;- f) instead of f Alone?", "body": "<p>Looking at this ZeroMQ <a href=\"http://zguide.zeromq.org/hs:hwclient\" rel=\"nofollow\">HelloWorldClient.hs</a> code snippet:</p>\n\n<pre><code>forM_ [1..10] $ \\i -&gt; do\n    liftIO . putStrLn $ \"Sending Hello \" ++ show i ++ \"\u2026\"\n    send requester [] \"Hello\"\n    _ &lt;- receive requester\n    liftIO . putStrLn $ \"Received World \" ++ show i\n</code></pre>\n\n<p>Is there any reason why <code>_ &lt;- receive requester</code> wouldn't be written as <code>receive requester</code>?</p>\n\n<p>Also, in general, is there any reason to use <code>_ &lt;- f</code> (where <code>f : Monad m =&gt; m a</code>) instead of <code>f</code>?</p>\n"}, {"tags": ["haskell", "random"], "answers": [{"tags": [], "owner": {"reputation": 126897, "user_id": 791604, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/ce991df7a056248d5e4f6fc3659ba733?s=128&d=identicon&r=PG", "display_name": "Daniel Wagner", "link": "https://stackoverflow.com/users/791604/daniel-wagner"}, "is_accepted": false, "score": 6, "last_activity_date": 1463100447, "creation_date": 1463100447, "answer_id": 37199613, "question_id": 37199528, "link": "https://stackoverflow.com/questions/37199528/meaning-of-the-string-representation-of-an-stdgen-type-in-haskell/37199613#37199613", "title": "Meaning of the string representation of an StdGen type in Haskell", "body": "<blockquote>\n  <p>From what I understand, a value of type <code>StdGen</code> behaves like the generating seed of a random-sequence.</p>\n</blockquote>\n\n<p>This is correct.</p>\n\n<blockquote>\n  <p>That would mean the <code>StdGen</code> type is nothing but a kind of tagged (but random) integer, with the tag being <code>StdGen</code>.</p>\n</blockquote>\n\n<p>This does not follow. There is no a priori reason to believe that the internal state of a PRNG is a completely unstructured number. Different algorithms use different internal data structures. In the case of <code>StdGen</code>, you can <a href=\"http://hackage.haskell.org/package/random-1.1/docs/src/System-Random.html#StdGen\">read the source</a>:</p>\n\n<pre><code>data StdGen \n = StdGen !Int32 !Int32\n</code></pre>\n\n<p>For this particular algorithm, the internal state is two 32-bit numbers. Other algorithms use <a href=\"http://hackage.haskell.org/package/mwc-random-0.13.4.0/docs/src/System-Random-MWC.html#line-313\">more complicated data structures</a>.</p>\n\n<blockquote>\n  <p>Also getStdGen queries the operating system (or something else possibly?) for a starting seed</p>\n</blockquote>\n\n<p>There is a global <code>IORef</code> containing the seed that notionally gets initialized to <code>mkStdRNG 0</code> at program startup; you can see the details <a href=\"https://hackage.haskell.org/package/random-1.1/docs/src/System-Random.html#getStdGen\">here</a>.</p>\n\n<blockquote>\n  <p>Whenever I try to print a value of type StdGen I see two largish integers always separated by a white-space, as you can see below. So what does that white-space stand for?</p>\n</blockquote>\n\n<p>It separates the two <code>Int32</code> values contained in a <code>StdGen</code>.</p>\n"}, {"tags": [], "owner": {"reputation": 49959, "user_id": 866915, "user_type": "registered", "accept_rate": 70, "profile_image": "https://www.gravatar.com/avatar/09242131d6e17cbbe31e8547514da6e5?s=128&d=identicon&r=PG", "display_name": "ErikR", "link": "https://stackoverflow.com/users/866915/erikr"}, "is_accepted": true, "score": 5, "last_activity_date": 1463103509, "last_edit_date": 1463103509, "creation_date": 1463100767, "answer_id": 37199652, "question_id": 37199528, "link": "https://stackoverflow.com/questions/37199528/meaning-of-the-string-representation-of-an-stdgen-type-in-haskell/37199652#37199652", "title": "Meaning of the string representation of an StdGen type in Haskell", "body": "<p><code>StdGen</code> is just a pseudo-random number generator which uses two seed values.</p>\n\n<p>The authors of <code>StdGen</code> have decided to implement its Show instance as just showing the two seed values separated by a space instead of using a more conventional format.</p>\n\n<p>The exact algorithm is given by <code>stdNext</code> in <a href=\"https://hackage.haskell.org/package/random-1.1/docs/src/System-Random.html#stdNext\" rel=\"nofollow\"><code>System.Random</code></a>.</p>\n"}], "owner": {"reputation": 12714, "user_id": 505306, "user_type": "registered", "accept_rate": 84, "profile_image": "https://i.stack.imgur.com/TjIHR.png?s=128&g=1", "display_name": "smilingbuddha", "link": "https://stackoverflow.com/users/505306/smilingbuddha"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 185, "favorite_count": 0, "accepted_answer_id": 37199652, "answer_count": 2, "score": 2, "last_activity_date": 1463103509, "creation_date": 1463099780, "question_id": 37199528, "link": "https://stackoverflow.com/questions/37199528/meaning-of-the-string-representation-of-an-stdgen-type-in-haskell", "title": "Meaning of the string representation of an StdGen type in Haskell", "body": "<p>I would like to clarify my understanding of how the <code>System.Random</code> of Haskell works after reading the I/O chapter of Learn You a Haskell For A Great Good.  </p>\n\n<p>From what I understand, a value of type <code>StdGen</code> behaves like the generating seed of a random-sequence. That would mean the <code>StdGen</code> type is nothing but a kind of tagged (but random) integer, with the tag being <code>StdGen</code>. Is this correct? </p>\n\n<p>Also <code>getStdGen</code> queries the operating system (or something else possibly?) for a starting seed and the result of executing that action gets stored in <code>gen</code>. </p>\n\n<p>Whenever I try to print a value of type <code>StdGen</code> I see two largish integers always separated by a white-space, as you can see below. I would have imagined that this value would have been a <em>single</em> integer. So what does that white-space stand for? </p>\n\n<pre><code>Prelude System.Random&gt; gen &lt;- getStdGen\nPrelude System.Random&gt; \nPrelude System.Random&gt; gen\n751404879 1655838864\nPrelude System.Random&gt; \n</code></pre>\n"}, {"tags": ["haskell", "functional-programming", "functor", "higher-order-functions", "category-theory"], "comments": [{"owner": {"reputation": 15757, "user_id": 176841, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/45a168cb9eb8454d66c78f18e29d9342?s=128&d=identicon&r=PG", "display_name": "jberryman", "link": "https://stackoverflow.com/users/176841/jberryman"}, "edited": false, "score": 0, "creation_date": 1463096561, "post_id": 37198681, "comment_id": 61930630, "body": "Are you familiar with haskell type classes?"}, {"owner": {"reputation": 44013, "user_id": 1477667, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/trgKM.jpg?s=128&g=1", "display_name": "dfeuer", "link": "https://stackoverflow.com/users/1477667/dfeuer"}, "edited": false, "score": 0, "creation_date": 1463116496, "post_id": 37198681, "comment_id": 61935409, "body": "That&#39;s a pretty weird class."}], "answers": [{"tags": [], "owner": {"reputation": 2313, "user_id": 5318306, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/897fd4f3b92d28c5c1eb28a8024661a1?s=128&d=identicon&r=PG&f=1", "display_name": "Gurkenglas", "link": "https://stackoverflow.com/users/5318306/gurkenglas"}, "is_accepted": false, "score": 5, "last_activity_date": 1463105094, "creation_date": 1463105094, "answer_id": 37200128, "question_id": 37198681, "link": "https://stackoverflow.com/questions/37198681/what-is-a-purpose-of-zap-functor-and-zap-function-in-haskell/37200128#37200128", "title": "What is a purpose of Zap Functor and zap function in Haskell?", "body": "<p><code>Zap</code> relates dual Functors. In Haskell, that means that one carries extra information and the other one uses it up, and that's all both of them do. <code>(r, a)</code>  is an a value carrying an extra r value, <code>r -&gt; b</code> is a b value that first requires an r value. <code>zapWith (+) read (\"123\", 321)</code> will plug the \"123\" into read, and plug the 123 and the 321 into the (+). All <code>Zap</code> does is help with the plugging, if you find a piece of code where it fits. <code>zap = uncurry</code> for this instance, by the way. <code>Reader</code> and <code>Coreader</code> are isomorphic to <code>((-&gt;) r)</code> and <code>((,) r)</code> respectively. Other instances would be one providing two values and the other using both up, or f providing an r, then using up an s, while g provides an s, then uses up an r.</p>\n"}, {"tags": [], "owner": {"reputation": 9772, "user_id": 3963, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/9pDQ8.png?s=128&g=1", "display_name": "hao", "link": "https://stackoverflow.com/users/3963/hao"}, "is_accepted": true, "score": 17, "last_activity_date": 1463161108, "last_edit_date": 1463161108, "creation_date": 1463116684, "answer_id": 37201769, "question_id": 37198681, "link": "https://stackoverflow.com/questions/37198681/what-is-a-purpose-of-zap-functor-and-zap-function-in-haskell/37201769#37201769", "title": "What is a purpose of Zap Functor and zap function in Haskell?", "body": "<p>This is covered by this wonderful Kmett blog post, <a href=\"http://comonad.com/reader/2008/the-cofree-comonad-and-the-expression-problem/\" rel=\"noreferrer\">Cofree Comonad and the Expression Problem</a>. Unfortunately there's quite a lot of terminology in that blog post and I don't quite understand everything myself but we can try and sketch out the details.</p>\n\n<h2>Peano numbers</h2>\n\n<p>Let's define the natural numbers in a very strange way. We will first define the Peano zero and successor functions:</p>\n\n<pre><code>zero :: ()\nzero = ()\n\nincr :: a -&gt; Identity a\nincr = Identity\n</code></pre>\n\n<p>Then we can define some numbers:</p>\n\n<pre><code>one :: Identity ()\none = incr zero\n\ntwo :: Identity (Identity ())\ntwo = incr . incr $ zero\n\nthree :: Identity (Identity (Identity ()))\nthree = incr . incr . incr $ zero\n</code></pre>\n\n<p>Bizarre but it seems to work. You can convert <code>3 :: Int</code> to <code>three</code> and back. (Try it.) Can we write a function <code>f</code> to convert any arbitrary number to our strange representation and back? Unfortunately no. The Haskell type system will not let us construct an <em>infinite type</em>, which is the exact kind of type we want for <code>f</code>.</p>\n\n<p>A yet bigger problem is that, as a lazy functional programmer, I wish to stop typing <code>Identity</code> so many times. At this rate I willl be forced to type it O(n^2) times to define n numbers. This is 2016 and I find this unacceptable.</p>\n\n<p>We can turn to the Free datatype for help for both of our problems. (Some people call this the Free monad, but there is no reason for us to say \"monad\" when we can just say \"type\".)</p>\n\n<pre><code>newtype Free f a = Free (Either a (f (Free f a)))\n\nzero :: a -&gt; Free Identity a\nzero x = Free (Left x)\n\nincr :: Free Identity a -&gt; Free Identity a\nincr = Free . Right . Identity\n\none :: a -&gt; Free Identity a\none x = incr (zero x)\n\ntwo :: a -&gt; Free Identity a\ntwo x = incr (incr (zero x))\n\nthree :: a -&gt; Free Identity a\nthree = incr . incr . incr . zero\n</code></pre>\n\n<p>Pretty. This (surprisingly perhaps) is identical to our unusual <code>Identity</code>-wrapping representation above.</p>\n\n<h2>Streams</h2>\n\n<p>Now let us try to build a stream. Say, the stream of centurial leap years starting from 2000 (2000, 2400, 2800). But in a strange way.</p>\n\n<pre><code>unfold :: (a -&gt; a) -&gt; a -&gt; (a, (a, (a, ...)))\nunfold a2a a = (a, unfold a2a (a2a a))\n\ncenturials :: (Int, (Int, (Int, ...)))\ncenturials = unfold (+ 400) 2000\n</code></pre>\n\n<p>Assuming the compiler allowed us to write down our infinite type, this would be a suitable representation for a stream of numbers. To the rescue comes Cofree, the \"dual\" type to Free. Dual in the category theoretical sense, where if you took the time and pulled out a category theory textbook and boiled a lot of coffee and drew out the categorical diagram and then flipped around all the arrows you would go from one to the other (or the other to the one). This poor explanation will have to suffice as the hand-wavey paragraph on duality.</p>\n\n<pre><code>newtype Cofree f a = Cofree (a, f (Cofree f a))\n\nunfold :: Functor f =&gt; (a -&gt; f a) -&gt; a -&gt; Cofree f a\nunfold a2fa a = Cofree (a, fmap (unfold a2fa) (a2fa a))\n\ncenturials :: Cofree Identity Int\ncenturials = unfold (Identity . (+ 400)) 2000\n</code></pre>\n\n<p>This (again surprisingly perhaps) is equivalent to our infinite Russian nesting doll representation above.</p>\n\n<h2>Indexing streams with Peano numbers</h2>\n\n<p>But how to seek to specific elements in the stream? By taking advantage of the duality between Free and Cofree, we can actually use our representation of Peano numbers to index into our representation of streams.</p>\n\n<p>It turns out that, in Haskell, if <code>f</code> and <code>g</code> are dual in a mathematical sense then the following property holds true:</p>\n\n<pre><code>class Zap f g | f -&gt; g, g -&gt; f where\n  zap :: (a -&gt; b -&gt; r) -&gt; f a -&gt; g b -&gt; r\n</code></pre>\n\n<p>We will have to elide a discussion about duality and why this property holds true for dual functors.</p>\n\n<p>We can implement the simplest instance: the mathematical duality between an identity functor (represented in Haskell as <code>newtype Identity a = Identity a</code>) and itself.</p>\n\n<pre><code>instance Zap Identity Identity where\n  zap ab2r (Identity a) (Identity b) = ab2r a b\n</code></pre>\n\n<p>This property can be extended to bifunctors also:</p>\n\n<pre><code>class Bizap f g | f -&gt; g, g -&gt; f where\n  bizap :: (a -&gt; c -&gt; r) -&gt; (b -&gt; d -&gt; r) -&gt; f a b -&gt; g c d -&gt; r\n</code></pre>\n\n<p>We can instantiate this class for Haskell's encoding of sum and product, which are (non-trivially!) dual in category theory:</p>\n\n<pre><code>instance Bizap Either (,) where\n  bizap ac2r bd2r (Left a) (c, d) = ac2r a c\n  bizap ac2r bd2r (Right b) (c, d) = bd2r b d\n\ninstance Bizap (,) Either where\n  bizap ac2r bd2r (a, b) (Left c) = ac2r a c\n  bizap ac2r bd2r (a, b) (Right d) = bd2r b d\n</code></pre>\n\n<p>We now have enough machinery to show the same duality in Haskell between Free and Cofree.</p>\n\n<pre><code>instance Zap f g =&gt; Zap (Cofree f) (Free g) where\n  zap ab2r (Cofree as) (Free bs) = bizap ab2r (zap (zap ab2r)) as bs\n\ninstance Zap f g =&gt; Zap (Free f) (Cofree g) where\n  zap ab2r (Free as) (Cofree bs) = bizap ab2r (zap (zap ab2r)) as bs\n</code></pre>\n\n<p>These instances exploit the dual bifunctor nature of Either and (,) as well as the inherited <code>zap</code> from the duality of <code>f</code> and <code>g</code>, which in our examples will always be <code>Identity</code> and <code>Identity</code> in order to \"unpeel\" a layer off of <code>Free</code> and <code>Cofree</code> and to recursively call <code>zap</code> on that lower layer.</p>\n\n<p>Finally, let's see it in action:</p>\n\n<pre><code>year2800 :: Int\nyear2800 = zap id (two id) centurials\n</code></pre>\n\n<p>It is by exploiting this zap or \"annhilation\" property that we are able to retrieve values from a stream built by Cofree using natural number indices built by Free. Though far from a real-world example, the code exists as an exercise in how we can encode high-falutin' ideas from category theory in Haskell types and typeclasses. That we are able to do this serves as a brain teaser and also a sanity check for our choice of types for Free and Cofree.</p>\n\n<p>You may find the instances useful for one-liners or when you data structures happen to line up just right, as detailed in Gurkenglas' answer. Should you find duality to be a useful property to exploit, definitely reach for this part of the category-extras package. But even if we cannot find a usage for it we can certainly appreciate the beauty of everything neatly fitting together.</p>\n\n<h2>As for zipping</h2>\n\n<p><a href=\"http://comonad.com/reader/2008/zipping-and-unzipping-functors/\" rel=\"noreferrer\">You are correct in thinking that there is a connection between Zap and Zip</a>. They are named in the Kmett style of wordplay-driven development. Encoding zippable functors leads to a very similar typeclass <code>Zip</code>:</p>\n\n<pre><code>class Functor f =&gt; Zip f where\n  fzipWith :: (a -&gt; b -&gt; c) -&gt; f a -&gt; f b -&gt; f c\n</code></pre>\n\n<p>You can derive a generic zipping function for trees and streams (again using Cofree) by following this construction. See the blog post for more details.</p>\n"}], "owner": {"reputation": 8046, "user_id": 1774391, "user_type": "registered", "accept_rate": 99, "profile_image": "https://www.gravatar.com/avatar/96ec1a791090d470daa3338f3dfdf996?s=128&d=identicon&r=PG", "display_name": "MainstreamDeveloper00", "link": "https://stackoverflow.com/users/1774391/mainstreamdeveloper00"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 667, "favorite_count": 2, "accepted_answer_id": 37201769, "answer_count": 2, "score": 11, "last_activity_date": 1463161108, "creation_date": 1463093282, "question_id": 37198681, "link": "https://stackoverflow.com/questions/37198681/what-is-a-purpose-of-zap-functor-and-zap-function-in-haskell", "title": "What is a purpose of Zap Functor and zap function in Haskell?", "body": "<p>I came across <a href=\"https://hackage.haskell.org/package/category-extras-0.53.5/docs/Control-Functor-Zap.html\">this construction</a> in Haskell. I couldn't find any examples or explanations of how can I use <code>zap</code>/<code>zapWith</code> and <code>bizap</code>/<code>bizapWith</code> in real code. Do they in some way related to standard <code>zip</code>/<code>zipWith</code> functions? How can I use <code>Zap</code>/<code>Bizap</code> functors in Haskell code? What are the benefits of them?</p>\n"}, {"tags": ["haskell", "process"], "comments": [{"owner": {"reputation": 11780, "user_id": 2827654, "user_type": "registered", "accept_rate": 57, "profile_image": "https://www.gravatar.com/avatar/a171742e9c31a541d4d2031af932e94a?s=128&d=identicon&r=PG&f=1", "display_name": "jamshidh", "link": "https://stackoverflow.com/users/2827654/jamshidh"}, "edited": false, "score": 4, "creation_date": 1463087948, "post_id": 37197388, "comment_id": 61927567, "body": "I just tried this code, and got all the matches....  Can you show us your output?"}, {"owner": {"reputation": 5821, "user_id": 1770201, "user_type": "registered", "accept_rate": 45, "profile_image": "https://www.gravatar.com/avatar/46bcb5d2018194c9beb884b6797e57e0?s=128&d=identicon&r=PG", "display_name": "George", "link": "https://stackoverflow.com/users/1770201/george"}, "reply_to_user": {"reputation": 11780, "user_id": 2827654, "user_type": "registered", "accept_rate": 57, "profile_image": "https://www.gravatar.com/avatar/a171742e9c31a541d4d2031af932e94a?s=128&d=identicon&r=PG&f=1", "display_name": "jamshidh", "link": "https://stackoverflow.com/users/2827654/jamshidh"}, "edited": false, "score": 0, "creation_date": 1463088846, "post_id": 37197388, "comment_id": 61927992, "body": "Yes, I&#39;ll get some output and post above; however, are all of your matches coming from the same file? If so, that&#39;s what I get as well; however, if they are coming from more than one file, I only get matches for one file."}, {"owner": {"reputation": 5821, "user_id": 1770201, "user_type": "registered", "accept_rate": 45, "profile_image": "https://www.gravatar.com/avatar/46bcb5d2018194c9beb884b6797e57e0?s=128&d=identicon&r=PG", "display_name": "George", "link": "https://stackoverflow.com/users/1770201/george"}, "reply_to_user": {"reputation": 11780, "user_id": 2827654, "user_type": "registered", "accept_rate": 57, "profile_image": "https://www.gravatar.com/avatar/a171742e9c31a541d4d2031af932e94a?s=128&d=identicon&r=PG&f=1", "display_name": "jamshidh", "link": "https://stackoverflow.com/users/2827654/jamshidh"}, "edited": false, "score": 1, "creation_date": 1463089313, "post_id": 37197388, "comment_id": 61928188, "body": "@jamshidh: you&#39;re right. The issue had to do with symlinks!"}], "owner": {"reputation": 5821, "user_id": 1770201, "user_type": "registered", "accept_rate": 45, "profile_image": "https://www.gravatar.com/avatar/46bcb5d2018194c9beb884b6797e57e0?s=128&d=identicon&r=PG", "display_name": "George", "link": "https://stackoverflow.com/users/1770201/george"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 61, "favorite_count": 1, "answer_count": 0, "score": 1, "last_activity_date": 1463089290, "creation_date": 1463087176, "last_edit_date": 1463089290, "question_id": 37197388, "link": "https://stackoverflow.com/questions/37197388/binding-the-entire-output-of-an-ongoing-system-process-to-a-variable-in-haskell", "title": "Binding the entire output of an ongoing system process to a variable in Haskell", "body": "<p>The following snippet of code executes a <code>grep</code> command and binds the output to <code>stdout'</code>, <code>stderr'</code> and <code>errCode</code> respectively.</p>\n\n<pre><code>main :: IO ()\nmain = do\n    let stdin' = \"\"\n    (errCode, stdout', stderr') &lt;- readProcessWithExitCode \"grep\" [\"search-term\" ,\"-nr\", \"/path/to/be/searched\"] stdin'\n    putStrLn $ \"stdout: \" ++ stdout'\n    putStrLn $ \"stderr: \" ++ stderr'\n    putStrLn $ \"errCode: \" ++ show errCode\n</code></pre>\n\n<p>The problem is that <code>stdout'</code> only captures the <strong>first result</strong> of the search. I think this is because <code>grep</code> is something akin to a spawned process that feeds search results one file by one file until it is finished.</p>\n\n<p><strong>Question:</strong> I need the <strong>entire output</strong> of the standard output of grep to be binded to <code>stdout'</code>. Is this possible in Haskell, and if so, what is an idiomatic way to do it?</p>\n\n<p><strong>EDIT:</strong> It turns out that the issue wasn't as I thought it was. Namely, I had only one file in my directory that wasn't symlinked. I forgot to use <code>-R</code> as an option with <code>grep</code>, and so those symlinks weren't being traversed in the search! The issue has been resolved.</p>\n"}, {"tags": ["haskell", "fold", "iterated-function"], "comments": [{"owner": {"reputation": 14781, "user_id": 630160, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/4445f21326af525a8ad19af7e3ae41a8?s=128&d=identicon&r=PG", "display_name": "epsilonhalbe", "link": "https://stackoverflow.com/users/630160/epsilonhalbe"}, "edited": false, "score": 4, "creation_date": 1463086308, "post_id": 37197025, "comment_id": 61926775, "body": "what have you tried already - as of now this sounds like a homework/exercise - we would be doing for you. us where your tries are failling"}], "answers": [{"comments": [{"owner": {"reputation": 14781, "user_id": 630160, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/4445f21326af525a8ad19af7e3ae41a8?s=128&d=identicon&r=PG", "display_name": "epsilonhalbe", "link": "https://stackoverflow.com/users/630160/epsilonhalbe"}, "edited": false, "score": 0, "creation_date": 1463089976, "post_id": 37197990, "comment_id": 61928490, "body": "great answer for a) not containing spoilers, and for b) providing insight to advanced haskellers as well"}], "tags": [], "owner": {"reputation": 126897, "user_id": 791604, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/ce991df7a056248d5e4f6fc3659ba733?s=128&d=identicon&r=PG", "display_name": "Daniel Wagner", "link": "https://stackoverflow.com/users/791604/daniel-wagner"}, "is_accepted": false, "score": 3, "last_activity_date": 1463091015, "last_edit_date": 1463091015, "creation_date": 1463089657, "answer_id": 37197990, "question_id": 37197025, "link": "https://stackoverflow.com/questions/37197025/how-to-apply-a-function-over-a-list-using-previous-outputs-as-arguments/37197990#37197990", "title": "How to apply a function over a list using previous outputs as arguments?", "body": "<p>You may like <code>mapM</code>. Below I give it the type it has, a specialization of that type, the newtype unwrapping of the specialized type, and a further specialization. The final type should look quite familiar to you. I use <code>~::</code> to informally mean \"approximately has the type\".</p>\n\n<pre><code>mapM  :: Monad m =&gt; (a -&gt; m b) -&gt; [a] -&gt; m [b]\nmapM  :: (a -&gt; State s b) -&gt; [a] -&gt; State s [b]\nmapM ~:: (a -&gt; s -&gt; (s, b)) -&gt; [a] -&gt; s -&gt; (s, [b])\nmapM ~:: (a -&gt; (a -&gt; a) -&gt; (a -&gt; a, a)) -&gt; [a] -&gt; (a -&gt; a) -&gt; (a -&gt; a, [a])\n</code></pre>\n\n<p>The last type describes exactly what you want to do: it can take (a slightly modified) <code>f</code>, <code>inputs</code>, and <code>initial</code> as arguments, and produce the list of outputs (along with some auxiliary information).</p>\n"}, {"comments": [{"owner": {"reputation": 126897, "user_id": 791604, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/ce991df7a056248d5e4f6fc3659ba733?s=128&d=identicon&r=PG", "display_name": "Daniel Wagner", "link": "https://stackoverflow.com/users/791604/daniel-wagner"}, "edited": false, "score": 1, "creation_date": 1463091158, "post_id": 37198234, "comment_id": 61928995, "body": "Perhaps throwing a <code>tail</code> out front would eliminate the danger of empty lists."}, {"owner": {"reputation": 34889, "user_id": 86604, "user_type": "registered", "accept_rate": 80, "profile_image": "https://www.gravatar.com/avatar/329af917389e6cf8e146c03012f5319a?s=128&d=identicon&r=PG", "display_name": "Ingo", "link": "https://stackoverflow.com/users/86604/ingo"}, "reply_to_user": {"reputation": 126897, "user_id": 791604, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/ce991df7a056248d5e4f6fc3659ba733?s=128&d=identicon&r=PG", "display_name": "Daniel Wagner", "link": "https://stackoverflow.com/users/791604/daniel-wagner"}, "edited": false, "score": 0, "creation_date": 1463091869, "post_id": 37198234, "comment_id": 61929276, "body": "Indeed, scanl returns a list that is always 1 element longer than the input list."}], "tags": [], "owner": {"reputation": 34889, "user_id": 86604, "user_type": "registered", "accept_rate": 80, "profile_image": "https://www.gravatar.com/avatar/329af917389e6cf8e146c03012f5319a?s=128&d=identicon&r=PG", "display_name": "Ingo", "link": "https://stackoverflow.com/users/86604/ingo"}, "is_accepted": false, "score": 0, "last_activity_date": 1463091959, "last_edit_date": 1463091959, "creation_date": 1463090697, "answer_id": 37198234, "question_id": 37197025, "link": "https://stackoverflow.com/questions/37197025/how-to-apply-a-function-over-a-list-using-previous-outputs-as-arguments/37198234#37198234", "title": "How to apply a function over a list using previous outputs as arguments?", "body": "<p>Sounds to me like  <code>scanl</code> could help:</p>\n\n<pre><code>scanl g (initial, undefined) xs\n  where g (i,_) a = f i a\n</code></pre>\n\n<p>To remove the initial element from the result list (which will always be 1 longer than the input list), apply a <code>tail</code> to the result.</p>\n"}], "owner": {"reputation": 355, "user_id": 4348117, "user_type": "registered", "accept_rate": 70, "profile_image": "https://www.gravatar.com/avatar/a88d7b140a8c1fec328e9d7ea4c0d0fa?s=128&d=identicon&r=PG&f=1", "display_name": "Mark Anastos", "link": "https://stackoverflow.com/users/4348117/mark-anastos"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 362, "favorite_count": 0, "answer_count": 2, "score": 1, "last_activity_date": 1463091959, "creation_date": 1463085633, "question_id": 37197025, "link": "https://stackoverflow.com/questions/37197025/how-to-apply-a-function-over-a-list-using-previous-outputs-as-arguments", "title": "How to apply a function over a list using previous outputs as arguments?", "body": "<p>I have a function <code>f :: (a -&gt; a) -&gt; a -&gt; ((a -&gt; a), a)</code>. (In the specific case <code>a</code> is <code>Int</code>, but that is irrelevant.)</p>\n\n<p>I have a function <code>initial :: a -&gt; a</code>, and a list of inputs (<code>inputs :: [a]</code>).</p>\n\n<p>I need to apply <code>f</code> to all the elements of <code>inputs</code>, but, for each, I need to take the <code>fst</code> part of the output of the previous iteration and feed it as the <code>(a -&gt; a)</code> part of the input for the next. As the output, I need to have a list of type <code>[a]</code>, which is the <code>snd</code> part of the outputs of each iteration.</p>\n\n<p>How can I recursively apply <code>f</code> to the <code>fst</code> part of the output and the elements of <code>inputs</code>, while building up a list of the intermediate <code>snd</code> parts of the output?</p>\n"}, {"tags": ["haskell", "ghc", "exists", "qualifiers"], "comments": [{"owner": {"reputation": 23444, "user_id": 414413, "user_type": "registered", "accept_rate": 79, "profile_image": "https://www.gravatar.com/avatar/6de2113f01432aa844dc85070ff33e89?s=128&d=identicon&r=PG", "display_name": "Cirdec", "link": "https://stackoverflow.com/users/414413/cirdec"}, "edited": false, "score": 0, "creation_date": 1463081364, "post_id": 37195673, "comment_id": 61924083, "body": "What would <code>(unpack (pack (1 :: Int))) :: String</code> be?"}, {"owner": {"reputation": 781, "user_id": 1163717, "user_type": "registered", "accept_rate": 45, "profile_image": "https://www.gravatar.com/avatar/cbba7289a669e4ca1fcf1064d0cf22fd?s=128&d=identicon&r=PG&f=1", "display_name": "The Red Fox", "link": "https://stackoverflow.com/users/1163717/the-red-fox"}, "reply_to_user": {"reputation": 23444, "user_id": 414413, "user_type": "registered", "accept_rate": 79, "profile_image": "https://www.gravatar.com/avatar/6de2113f01432aa844dc85070ff33e89?s=128&d=identicon&r=PG", "display_name": "Cirdec", "link": "https://stackoverflow.com/users/414413/cirdec"}, "edited": false, "score": 0, "creation_date": 1463081891, "post_id": 37195673, "comment_id": 61924412, "body": "I think that should be a compile error since you are trying to give type to it after you have packed the value, because after you pack it you lose information about the typo of what is inside, so you can&#39;t know if you can change the type of it to String."}], "answers": [{"tags": [], "owner": {"reputation": 9772, "user_id": 3963, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/9pDQ8.png?s=128&g=1", "display_name": "hao", "link": "https://stackoverflow.com/users/3963/hao"}, "is_accepted": false, "score": 4, "last_activity_date": 1463084105, "creation_date": 1463084105, "answer_id": 37196604, "question_id": 37195673, "link": "https://stackoverflow.com/questions/37195673/is-there-a-way-to-represent-the-function-unpack-on-showable-in-ghcs-haskell/37196604#37196604", "title": "Is there a way to represent the function unpack on Showable in GHC&#39;s Haskell?", "body": "<p>Your <code>unpack</code>, as you have typed, cannot be written. The reason is that the existential variable <code>a</code> \"escapes\" the scope of the pattern match and there is no facility to track that behavior. Quote the docs:</p>\n\n<blockquote>\n<pre><code>data Baz = forall a. Eq a =&gt; Baz1 a a\n         | forall b. Show b =&gt; Baz2 b (b -&gt; b)\n</code></pre>\n  \n  <p>When pattern matching, each pattern match introduces a new, distinct, type for each existential type variable. These types cannot be unified with any other type, nor can they escape from the scope of the pattern match. For example, these fragments are incorrect:</p>\n\n<pre><code>f1 (MkFoo a f) = a\n</code></pre>\n  \n  <p>What is this \"a\" in the result type? Clearly we don't mean this:</p>\n\n<pre><code>f1 :: forall a. Foo -&gt; a   -- Wrong!\n</code></pre>\n  \n  <p>The original program is just plain wrong. Here's another sort of error</p>\n\n<pre><code> f2 (Baz1 a b) (Baz1 p q) = a==q\n</code></pre>\n  \n  <p>It's ok to say <code>a==b</code> or <code>p==q</code>, but <code>a==q</code> is wrong because it equates the two distinct types arising from the two <code>Baz1</code> constructors.</p>\n</blockquote>\n\n<p>You can however rewrite the <code>unpack</code> type equivalently so that the existential does <em>not</em> escape:</p>\n\n<pre><code>{-# LANGUAGE ExistentialQuantification #-}\n{-# LANGUAGE RankNTypes                #-}\n\nmodule Lib where\n\ndata Showable = forall a. Show a =&gt; Showable a\n\npack :: Show a =&gt; a -&gt; Showable\npack = Showable\n\nunpack :: Showable -&gt; (forall a. Show a =&gt; a -&gt; r) -&gt; r\nunpack (Showable a) a2r = a2r a\n</code></pre>\n\n\n"}], "owner": {"reputation": 781, "user_id": 1163717, "user_type": "registered", "accept_rate": 45, "profile_image": "https://www.gravatar.com/avatar/cbba7289a669e4ca1fcf1064d0cf22fd?s=128&d=identicon&r=PG&f=1", "display_name": "The Red Fox", "link": "https://stackoverflow.com/users/1163717/the-red-fox"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 205, "favorite_count": 0, "answer_count": 1, "score": 1, "last_activity_date": 1463084105, "creation_date": 1463080672, "question_id": 37195673, "link": "https://stackoverflow.com/questions/37195673/is-there-a-way-to-represent-the-function-unpack-on-showable-in-ghcs-haskell", "title": "Is there a way to represent the function unpack on Showable in GHC&#39;s Haskell?", "body": "<p>I have a type named Showable like this:</p>\n\n<pre><code>    {-# LANGUAGE ExistentialQuantification #-}\n    {-# LANGUAGE ExplicitForAll #-}\n    data Showable = forall a . Show a =&gt; Showable a\n</code></pre>\n\n<p>Then making a function that packs it is trivial. I just have to write:</p>\n\n<pre><code>    pack :: forall a . Show a =&gt; a -&gt; Showable\n    pack x = Showable x\n</code></pre>\n\n<p>However it seems impossible to create the inverse function that would unpack the data from Showable. If I try to just invert what I wrote for pack and write:</p>\n\n<pre><code>    unpack :: exists a . Show a =&gt; Showable -&gt; a\n    unpack (Showable x) = x\n</code></pre>\n\n<p>then I get an error from GHC.</p>\n\n<p>I have looked into the docs on GHC Language extensions and there seems to be no support for the exists keyword. I have seen that it might be possible in some other Haskell compilers, but I would prefer to be able to do it in GHC as well.</p>\n\n<p>Funnily enough, I can still pattern match on Showable and extract the data from inside it in that way. So I could get the value out of it that way, but if I wanted to make a pointfree function involving Showable, then I would need unpack.</p>\n\n<p>So is there some way to implement unpack in GHC's Haskell, maybe using Type Families or some other arcane magic that are GHC extensions?</p>\n"}, {"tags": ["haskell", "cabal", "gloss"], "comments": [{"owner": {"reputation": 14781, "user_id": 630160, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/4445f21326af525a8ad19af7e3ae41a8?s=128&d=identicon&r=PG", "display_name": "epsilonhalbe", "link": "https://stackoverflow.com/users/630160/epsilonhalbe"}, "edited": false, "score": 1, "creation_date": 1463080079, "post_id": 37195188, "comment_id": 61923377, "body": "well first of all <code>gloss-1.8.1.*</code> needs <code>base == 4.6</code>, and <code>gloss-1.8.2</code> needs <code>base == 4.7</code>, but are you aware that the latest gloss version <code>gloss-1.10.1.1</code> needs <code>base == 4.8.*</code> which you could use. Now the question is - why do you need this old version of gloss?"}, {"owner": {"reputation": 44013, "user_id": 1477667, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/trgKM.jpg?s=128&g=1", "display_name": "dfeuer", "link": "https://stackoverflow.com/users/1477667/dfeuer"}, "edited": false, "score": 1, "creation_date": 1463080546, "post_id": 37195188, "comment_id": 61923656, "body": "You can have multiple GHC versions (with their matching base libraries) installed at once. But you should definitely think about whether you really need that exact version."}, {"owner": {"reputation": 111, "user_id": 6068558, "user_type": "registered", "accept_rate": 64, "profile_image": "https://www.gravatar.com/avatar/fe2261de702c7695ad8e1fe9c40707d1?s=128&d=identicon&r=PG&f=1", "display_name": "Caroso", "link": "https://stackoverflow.com/users/6068558/caroso"}, "edited": false, "score": 0, "creation_date": 1463081904, "post_id": 37195188, "comment_id": 61924419, "body": "because I found a game in Haskell on the internet, which is created with this version...I want to test it and try to make another starting with this example. Any ideas for my question?"}, {"owner": {"reputation": 111, "user_id": 6068558, "user_type": "registered", "accept_rate": 64, "profile_image": "https://www.gravatar.com/avatar/fe2261de702c7695ad8e1fe9c40707d1?s=128&d=identicon&r=PG&f=1", "display_name": "Caroso", "link": "https://stackoverflow.com/users/6068558/caroso"}, "edited": false, "score": 0, "creation_date": 1463082329, "post_id": 37195188, "comment_id": 61924674, "body": "and how can i install another version?"}, {"owner": {"reputation": 44013, "user_id": 1477667, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/trgKM.jpg?s=128&g=1", "display_name": "dfeuer", "link": "https://stackoverflow.com/users/1477667/dfeuer"}, "edited": false, "score": 0, "creation_date": 1463083491, "post_id": 37195188, "comment_id": 61925343, "body": "You could try editing the game&#39;s Cabal configuration to make it use the newer version and see if it works. Sometimes upper bounds go out of date."}, {"owner": {"reputation": 111, "user_id": 6068558, "user_type": "registered", "accept_rate": 64, "profile_image": "https://www.gravatar.com/avatar/fe2261de702c7695ad8e1fe9c40707d1?s=128&d=identicon&r=PG&f=1", "display_name": "Caroso", "link": "https://stackoverflow.com/users/6068558/caroso"}, "edited": false, "score": 0, "creation_date": 1463083937, "post_id": 37195188, "comment_id": 61925580, "body": "I&#39;m beginner in Haskell..I&#39;m trying to understand how to make a game ..I don&#39;t think I can handle with editing configuration..that&#39;s why I&#39;m trying to install an old version of ghc with 4.7.* base"}, {"owner": {"reputation": 2831, "user_id": 183792, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/9ddcfbc6c31012fd25384f6301363347?s=128&d=identicon&r=PG&f=1", "display_name": "Michael", "link": "https://stackoverflow.com/users/183792/michael"}, "edited": false, "score": 7, "creation_date": 1463085420, "post_id": 37195188, "comment_id": 61926330, "body": "Coroso also if you are using <code>cabal</code> to build, you might try the invocation <code>cabal install --allow-newer</code> This permits <code>cabal install</code> to use more recent versions than the <code>.cabal</code> file does. The syntax is pretty simple btw, you just go into the <code>.cabal</code> file and look at the <code>build-depends</code> or <code>Build-Depends</code> stanza(s), and change each <code>this_package &gt; 0.7 &amp;&amp; &lt; 0.9</code> to <code>this_package &gt; 0.7</code>. You must preserve commas - that&#39;s as tricky as it gets"}, {"owner": {"reputation": 2831, "user_id": 183792, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/9ddcfbc6c31012fd25384f6301363347?s=128&d=identicon&r=PG&f=1", "display_name": "Michael", "link": "https://stackoverflow.com/users/183792/michael"}, "edited": false, "score": 2, "creation_date": 1463085920, "post_id": 37195188, "comment_id": 61926587, "body": "Coroso, oh, and if a range like  <code>gloss-1.8.* </code> is given, change it  to just <code>gloss</code> or <code>gloss &gt; 1.7</code> or the like. In fact just doing that <i>may</i> work if the other dependencies are ok."}, {"owner": {"reputation": 111, "user_id": 6068558, "user_type": "registered", "accept_rate": 64, "profile_image": "https://www.gravatar.com/avatar/fe2261de702c7695ad8e1fe9c40707d1?s=128&d=identicon&r=PG&f=1", "display_name": "Caroso", "link": "https://stackoverflow.com/users/6068558/caroso"}, "edited": false, "score": 0, "creation_date": 1463086966, "post_id": 37195188, "comment_id": 61927092, "body": "it works. thanks for help"}, {"owner": {"reputation": 496, "user_id": 871821, "user_type": "registered", "accept_rate": 67, "profile_image": "https://www.gravatar.com/avatar/86745c80ad5a0974e23d540abdfe5b02?s=128&d=identicon&r=PG", "display_name": "user3673", "link": "https://stackoverflow.com/users/871821/user3673"}, "edited": false, "score": 0, "creation_date": 1580842358, "post_id": 37195188, "comment_id": 106228493, "body": "Is there any reason those knowledgeable about Haskell have refused to answer the question as stated in the title?  If not, could you please answer that question?  If not, could the author please change the title of the question so as not to mislead people searching for the answer?"}], "owner": {"reputation": 111, "user_id": 6068558, "user_type": "registered", "accept_rate": 64, "profile_image": "https://www.gravatar.com/avatar/fe2261de702c7695ad8e1fe9c40707d1?s=128&d=identicon&r=PG&f=1", "display_name": "Caroso", "link": "https://stackoverflow.com/users/6068558/caroso"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 1214, "favorite_count": 0, "answer_count": 0, "score": 4, "last_activity_date": 1463082900, "creation_date": 1463079034, "last_edit_date": 1463082900, "question_id": 37195188, "link": "https://stackoverflow.com/questions/37195188/how-to-install-an-older-version-of-base-in-haskell", "title": "How to install an older version of base in Haskell", "body": "<p>I have installed Haskell platform and I have the 7.10.3 version of ghci, which has the 4.8.2.0 version of base. I need to install <code>gloss-1.8.*</code> which needs <code>base-4.7.*</code> version of base.</p>\n\n<p>My question is how to install this older version now, when I already have the newer version. Is it possible? Or do I have to uninstall the Haskell platform and install an older version?</p>\n"}, {"tags": ["haskell", "random", "monads", "montecarlo"], "comments": [{"owner": {"reputation": 51584, "user_id": 839246, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/9b0573c2b936b12828dd1e4cc04206dc?s=128&d=identicon&r=PG&f=1", "display_name": "bheklilr", "link": "https://stackoverflow.com/users/839246/bheklilr"}, "edited": false, "score": 1, "creation_date": 1463079365, "post_id": 37195146, "comment_id": 61922961, "body": "Are you creating new values at each step that need to be forwarded to the next function or are you only using a single value in multiple functions?  If the former then the State monad would be a good choice, if the latter then the Reader monad is probably your best option.  You can actually write your functions using <code>MonadReader</code> then use them as pure functions later if you want."}, {"owner": {"reputation": 6241, "user_id": 722869, "user_type": "registered", "accept_rate": 85, "profile_image": "https://www.gravatar.com/avatar/1c5c02f9165e188ab81a53efabc062e2?s=128&d=identicon&r=PG", "display_name": "daj", "link": "https://stackoverflow.com/users/722869/daj"}, "reply_to_user": {"reputation": 51584, "user_id": 839246, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/9b0573c2b936b12828dd1e4cc04206dc?s=128&d=identicon&r=PG&f=1", "display_name": "bheklilr", "link": "https://stackoverflow.com/users/839246/bheklilr"}, "edited": false, "score": 0, "creation_date": 1463080147, "post_id": 37195146, "comment_id": 61923426, "body": "would this be similar to passing around the pre-computated context, except where naively i&#39;d pass around a list, the list would be replaced by a Reader or State?"}, {"owner": {"reputation": 1178, "user_id": 1667161, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/233658d12fabd9d72b04d0a6916f6389?s=128&d=identicon&r=PG", "display_name": "liminalisht", "link": "https://stackoverflow.com/users/1667161/liminalisht"}, "edited": false, "score": 0, "creation_date": 1463104421, "post_id": 37195146, "comment_id": 61932335, "body": "Adding a param to all your functions, or converting them all to monadic actions, can&#39;t be your only options, given that some of the functions aren&#39;t even using random values. Don&#39;t change those fns that don&#39;t require randomness / non-determinism - leave them pure. You can always <code>fmap</code> them over your monads/functors, or use them in <code>let</code> expressions in a monad. For the actions that require randomness, you can have them live in a monad that has a <code>MonadReader StdGen m</code> constraint, or leave those fns pure, but give them a <code>StdGen</code> param, <code>split</code>ting old generators to obtain new ones."}], "answers": [{"tags": [], "owner": {"reputation": 3240, "user_id": 3031069, "user_type": "registered", "accept_rate": 44, "profile_image": "https://www.gravatar.com/avatar/99963eedbe0698475d7443bf95edb43e?s=128&d=identicon&r=PG&f=1", "display_name": "choeger", "link": "https://stackoverflow.com/users/3031069/choeger"}, "is_accepted": false, "score": 0, "last_activity_date": 1463079395, "creation_date": 1463079395, "answer_id": 37195312, "question_id": 37195146, "link": "https://stackoverflow.com/questions/37195146/how-to-structure-monads-in-haskell-programs-which-compute-on-random-values/37195312#37195312", "title": "how to structure monads in haskell programs which compute on random values?", "body": "<p>tl;dr:\nConsider to abstract the random function generator and pass it as an argument. Haskells type classes should help you to hide that abstraction as much as possible.</p>\n\n<p>Unfortunately, there is no silver bullet here. Since you are using side effects, your \"functions\" simply aren't functions in the proper sense. Haskell does not allow you to hide that fact (which makes up the largest part of its safety guarantees). So in some way you will need to express this fact. You also seem to confuse the difference between monadic operations and (plain) functions: A function that (indirectly) uses random values is implicitly monadic. A non-monadic function can always be used inside a monadic operation. So you should probably implement all truly non-monadic functions as such and see how far that carries. </p>\n\n<p>As a completely unrelated side-note: If lazyness is not a requirement and Haskells strong safety is too much a burden for you, but you still want to write (mostly) functional code, you could give OCaml a try (or any other ML dialect for that matter).</p>\n"}, {"comments": [{"owner": {"reputation": 6241, "user_id": 722869, "user_type": "registered", "accept_rate": 85, "profile_image": "https://www.gravatar.com/avatar/1c5c02f9165e188ab81a53efabc062e2?s=128&d=identicon&r=PG", "display_name": "daj", "link": "https://stackoverflow.com/users/722869/daj"}, "edited": false, "score": 0, "creation_date": 1463235914, "post_id": 37216883, "comment_id": 61985459, "body": "thanks you for the pointer. I&#39;ve been deliberately avoiding free monads because i want to internalize vanilla monads first. jared seems to be doing some cool stuff and i wish there were more people doing numerical/scientific computing in the haskell community.   &quot;Unfortunately&quot; only refers to the view of a beginner that finds non-monadic code more effortless to compose. I know with more practice i&#39;ll come to appreciate the benefits of discipline with deeper practice, but it takes some getting used to."}, {"owner": {"reputation": 28456, "user_id": 1094403, "user_type": "registered", "accept_rate": 83, "profile_image": "https://www.gravatar.com/avatar/3770aa7eae5c211921493abd0d2c9f5a?s=128&d=identicon&r=PG", "display_name": "Luis Casillas", "link": "https://stackoverflow.com/users/1094403/luis-casillas"}, "reply_to_user": {"reputation": 6241, "user_id": 722869, "user_type": "registered", "accept_rate": 85, "profile_image": "https://www.gravatar.com/avatar/1c5c02f9165e188ab81a53efabc062e2?s=128&d=identicon&r=PG", "display_name": "daj", "link": "https://stackoverflow.com/users/722869/daj"}, "edited": false, "score": 0, "creation_date": 1463250588, "post_id": 37216883, "comment_id": 61990578, "body": "@daj: I would stress once more that I doubt that you need to delve into free monads to benefit from this article.  Your &quot;one thing at a time&quot; attitude is right\u2014just focus first on learning how to use an RNG monad library effectively."}], "tags": [], "owner": {"reputation": 28456, "user_id": 1094403, "user_type": "registered", "accept_rate": 83, "profile_image": "https://www.gravatar.com/avatar/3770aa7eae5c211921493abd0d2c9f5a?s=128&d=identicon&r=PG", "display_name": "Luis Casillas", "link": "https://stackoverflow.com/users/1094403/luis-casillas"}, "is_accepted": true, "score": 2, "last_activity_date": 1463164015, "last_edit_date": 1463164015, "creation_date": 1463163688, "answer_id": 37216883, "question_id": 37195146, "link": "https://stackoverflow.com/questions/37195146/how-to-structure-monads-in-haskell-programs-which-compute-on-random-values/37216883#37216883", "title": "how to structure monads in haskell programs which compute on random values?", "body": "<blockquote>\n  <p>The other option is to make all the computation functions monadic. This seems unfortunate since some of the functions aren't even using those random values they're just calling a function which calls a function which needs the random values.</p>\n</blockquote>\n\n<p>I would suggest following this approach, and I disagree with your assessment that it's \"unfortunate.\"  What monads are good at <strong>precisely</strong> is separating your pure code from your side effecting code.  Your pure functions can just have pure types, and the <code>Functor</code>/<code>Applicative</code>/<code>Monad</code> methods serve to \"hook them up\" with the random generation parts.  Meditate on the signatures of the standard operations (here specialized to some idealized <code>Random</code> monad type):</p>\n\n<pre><code>-- Apply a pure function to a randomly selected value.\nfmap :: (a -&gt; b) -&gt; Random a -&gt; Random b\n\n-- Apply a randomly selected function to a randomly selected argument.\n-- The two random choices are independent.\n(&lt;*&gt;) :: Random (a -&gt; b) -&gt; Random a -&gt; Random b\n\n-- Apply a two-argument function to a randomly selected arguments.\n-- The two random choices are independent.\nliftA2 :: (a -&gt; b -&gt; c) -&gt; Random a -&gt; Random b -&gt; Random c\n\n-- Make a `Random b` choice whose distribution depends on the value\n-- sampled from the `Random a`.\n(&gt;&gt;=) :: Random a -&gt; (a -&gt; Random b) -&gt; Random b\n</code></pre>\n\n<p>So the reformulated version of your approach is:</p>\n\n<ul>\n<li>Write pure functions wherever you can.</li>\n<li>Adapt these pure functions to work on the random values by using the <code>Functor</code>/<code>Applicative</code>/<code>Monad</code> class operations.</li>\n<li>Wherever you spot a function that's mentioning the <code>Random</code> type superfluously, figure out how to factor the <code>Random</code> part out using those classes' operations (or the copious utility functions that exist for them).</li>\n</ul>\n\n<p>This is not specific to random number generation, by the way, but applies to <em>any</em> monad.</p>\n\n<p>You might enjoy reading this article, and might want to check out the author's random generation monad library:</p>\n\n<ul>\n<li><a href=\"http://jtobin.ca/encoding-independence-statically\" rel=\"nofollow\">\"Encoding Statistical Independence, Statically\"</a></li>\n<li><a href=\"https://hackage.haskell.org/package/mwc-probability\" rel=\"nofollow\">https://hackage.haskell.org/package/mwc-probability</a></li>\n</ul>\n\n<p>I doubt you need to follow the article's approach of using free monads for modeling, but the conceptual bits about probability distribution monads will likely be of some help.</p>\n"}], "owner": {"reputation": 6241, "user_id": 722869, "user_type": "registered", "accept_rate": 85, "profile_image": "https://www.gravatar.com/avatar/1c5c02f9165e188ab81a53efabc062e2?s=128&d=identicon&r=PG", "display_name": "daj", "link": "https://stackoverflow.com/users/722869/daj"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 79, "favorite_count": 1, "accepted_answer_id": 37216883, "answer_count": 2, "score": 3, "last_activity_date": 1463164015, "creation_date": 1463078893, "question_id": 37195146, "link": "https://stackoverflow.com/questions/37195146/how-to-structure-monads-in-haskell-programs-which-compute-on-random-values", "title": "how to structure monads in haskell programs which compute on random values?", "body": "<p>I have a program that's almost pure mathematical computation. The problem is that some of those computations operate on monte carlo generated values. </p>\n\n<p>It seems like I have two design options:</p>\n\n<p>Either all my computation functions take additional parameter which contains a pre-generated monte carlo chain. This lets me keep pure functions everywhere, but since there's functions that call other functions this adds a lot of line noise to the code base.</p>\n\n<p>The other option is to make all the computation functions monadic. This seems unfortunate since some of the functions aren't even using those random values they're just calling a function which calls a function which needs the random values.</p>\n\n<p>Is there any guidance regarding the preferred design here? Specifically, the separation of monadic / non-monadic functions in the code where monte carlo values are concerned?</p>\n"}, {"tags": ["haskell"], "comments": [{"owner": {"reputation": 51584, "user_id": 839246, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/9b0573c2b936b12828dd1e4cc04206dc?s=128&d=identicon&r=PG&f=1", "display_name": "bheklilr", "link": "https://stackoverflow.com/users/839246/bheklilr"}, "edited": false, "score": 0, "creation_date": 1463076871, "post_id": 37193849, "comment_id": 61921530, "body": "Looks like you have <code>InterpreterMT</code> wrapping <code>InterpreterMT</code>, wouldn&#39;t you just need to unwrap the result of <code>interpreter stmts</code> using <code>runInterpreterMT</code> before passing it to <code>local id</code>?"}, {"owner": {"reputation": 51584, "user_id": 839246, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/9b0573c2b936b12828dd1e4cc04206dc?s=128&d=identicon&r=PG&f=1", "display_name": "bheklilr", "link": "https://stackoverflow.com/users/839246/bheklilr"}, "edited": false, "score": 1, "creation_date": 1463077891, "post_id": 37193849, "comment_id": 61922107, "body": "Well, you need to provide <code>Functor</code> and <code>Applicative</code> instances for <code>InterpreterM</code> and <code>InterpreterMT</code>, if these are both supposed to be Monads this is a requirement anyway, but your last line just needs to be <code>InterpreterMT $ local (\\x -&gt; x) $ runInterpreterMT $ interpreter stmts</code>.  What you appear to be wanting to do looks awfully similar to Free monads, by the way."}, {"owner": {"reputation": 3815, "user_id": 5382150, "user_type": "registered", "accept_rate": 86, "profile_image": "https://i.stack.imgur.com/GwGSL.png?s=128&g=1", "display_name": "Gilgamesz", "link": "https://stackoverflow.com/users/5382150/gilgamesz"}, "reply_to_user": {"reputation": 51584, "user_id": 839246, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/9b0573c2b936b12828dd1e4cc04206dc?s=128&d=identicon&r=PG&f=1", "display_name": "bheklilr", "link": "https://stackoverflow.com/users/839246/bheklilr"}, "edited": false, "score": 0, "creation_date": 1463079817, "post_id": 37193849, "comment_id": 61923210, "body": "Why do you do it in such way? Why dont you use a <code>lift</code>?"}, {"owner": {"reputation": 51584, "user_id": 839246, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/9b0573c2b936b12828dd1e4cc04206dc?s=128&d=identicon&r=PG&f=1", "display_name": "bheklilr", "link": "https://stackoverflow.com/users/839246/bheklilr"}, "edited": false, "score": 1, "creation_date": 1463079904, "post_id": 37193849, "comment_id": 61923258, "body": "Because you haven&#39;t made <code>InterpreterMT</code> an instance of <code>MonadTrans</code> either, and <code>lift</code> returns a value of a type that has to implement <code>MonadTrans</code>."}, {"owner": {"reputation": 3815, "user_id": 5382150, "user_type": "registered", "accept_rate": 86, "profile_image": "https://i.stack.imgur.com/GwGSL.png?s=128&g=1", "display_name": "Gilgamesz", "link": "https://stackoverflow.com/users/5382150/gilgamesz"}, "reply_to_user": {"reputation": 51584, "user_id": 839246, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/9b0573c2b936b12828dd1e4cc04206dc?s=128&d=identicon&r=PG&f=1", "display_name": "bheklilr", "link": "https://stackoverflow.com/users/839246/bheklilr"}, "edited": false, "score": 0, "creation_date": 1463130055, "post_id": 37193849, "comment_id": 61942818, "body": "@bheklilr I have made <code>MonadTrans</code> instance indeed, but I didn&#39;t attach this code. My fault. But, there is also problem when I use <code>lift</code> as in my first post. I edited my first post."}], "answers": [{"tags": [], "owner": {"reputation": 499, "user_id": 4629794, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/fb19f570a2d96e68ec79f0af208d23a8?s=128&d=identicon&r=PG", "display_name": "lierdakil", "link": "https://stackoverflow.com/users/4629794/lierdakil"}, "is_accepted": false, "score": 1, "last_activity_date": 1463512137, "creation_date": 1463512137, "answer_id": 37284405, "question_id": 37193849, "link": "https://stackoverflow.com/questions/37193849/haskell-lifting-monad-error-and-local-function/37284405#37284405", "title": "Haskell. Lifting monad Error and local function", "body": "<p>Okay, two problems.</p>\n\n<p>First, <code>lift</code> has the following signature:</p>\n\n<pre><code>lift :: (MonadTrans t, Monad m) =&gt; m a -&gt; t m a\n</code></pre>\n\n<p>So you have to supply non-transformed monadic action to lift. In other words, you can't use <code>InterpreterMT</code> in an argument to <code>lift</code>.</p>\n\n<p>So you would need to unwrap it:</p>\n\n<pre><code>lift $ local id $ runInterpreterMT $ interpreter stmts\n</code></pre>\n\n<p>But now your return types don't make sense: <code>runInterpreterMT $ ...</code> has type</p>\n\n<pre><code>StateT Int (ReaderT Int (ErrorT String IO)) (InterpreterM ())\n</code></pre>\n\n<p>or, shortening transformer stack to <code>M</code>,</p>\n\n<pre><code>M (InterpreterM ())\n</code></pre>\n\n<p>while <code>interpreter</code> returns <code>Interpreter ()</code>, which is</p>\n\n<pre><code>InterpreterMT (StateT Int (ReaderT Int (ErrorT String IO))) ()\n</code></pre>\n\n<p>or, shortening transformer stack,</p>\n\n<pre><code>InterpreterMT M ()\n</code></pre>\n\n<p>going back to type of <code>lift</code>, <code>m a -&gt; t m a</code> becomes <code>M (InterpreterM ()) -&gt; InterpreterMT M (InterpreterM ())</code>. <code>(InterpreterM ())</code> is <em>not</em> <code>()</code>.</p>\n\n<p>The root of the problem? Your <code>InterpreterMT</code> is not actually a monad transformer, since it doesn't really transform the monad. It transforms the value.</p>\n\n<p>Easy fix? Provided that you can figure out a reasonable <code>Monad</code> instance for <code>InterpreterMT</code> (one you provided is doubtful), you can define a <code>MonadReader</code> instance for <code>InterpreterMT</code>:</p>\n\n<pre><code>instance MonadReader r m =&gt; MonadReader r (InterpreterMT m) where\n  local f = InterpreterMT . local f . runInterpreterMT\n  ...\n</code></pre>\n\n<p>(you'll need <code>UndecideableInstances</code> for this particular definition)</p>\n\n<p>General pattern seems to be </p>\n\n<pre><code>inInterpreter f = InterpreterMT . f . runInterpreterMT\n</code></pre>\n\n<p>Note that this is <em>not</em> a <code>Functor</code>.</p>\n\n<p>Not sure what you want to achieve here, but this whole design seems... underdeveloped. Maybe it's a good idea to go back to drawing board and figure out what exactly you want your architecture to be like.</p>\n"}], "owner": {"reputation": 3815, "user_id": 5382150, "user_type": "registered", "accept_rate": 86, "profile_image": "https://i.stack.imgur.com/GwGSL.png?s=128&g=1", "display_name": "Gilgamesz", "link": "https://stackoverflow.com/users/5382150/gilgamesz"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 148, "favorite_count": 0, "answer_count": 1, "score": -2, "last_activity_date": 1463512137, "creation_date": 1463074464, "last_edit_date": 1463129977, "question_id": 37193849, "link": "https://stackoverflow.com/questions/37193849/haskell-lifting-monad-error-and-local-function", "title": "Haskell. Lifting monad Error and local function", "body": "<pre><code>    data InterpreterM a = ExeInterpreter a | PropInterpreter a\n\n    newtype InterpreterMT m a = InterpreterMT { runInterpreterMT :: m (InterpreterM a) }\n\n    type Interpreter = InterpreterMT (StateT Int (ReaderT Int (ErrorT String IO)))\n    data Stmts = Statements Stmt Stmts | EmptyStmts\n\n\n  instance (Monad m) =&gt; Monad (InterpreterMT m) where\n        return x = InterpreterMT $ return (ExeInterpreter x)\n        x &gt;&gt;= f = InterpreterMT $ do\n            m &lt;- runInterpreterMT x \n            case m of\n                (ExeInterpreter a) -&gt; runInterpreterMT (f a)\n    interpreter :: Stmts -&gt; Interpreter ()\n    interpreter EmptyStmts = return () \n    interpreter (Statements s stmts) = lift $ local (\\x -&gt; x) (interpreter stmts)\n\n\n\n\n\ninstance MonadTrans InterpreterMT where\n    lift m = InterpreterMT $ do\n        x &lt;- m\n        return $ ExeInterpreter x\n</code></pre>\n\n<p>Compiler gives me erorr in last line:</p>\n\n<pre><code>  Couldn't match type `InterpreterMT\n                           (StateT Int (ReaderT Int (ErrorT String IO)))'\n                  with `StateT Int (ReaderT Int (ErrorT String IO))'\n    Expected type: Interpreter ()\n      Actual type: InterpreterMT\n                     (InterpreterMT (StateT Int (ReaderT Int (ErrorT String IO)))) ()\n    In the expression: lift $ local (\\ x -&gt; x) (interpreter stmts)\n    In an equation for `interpreter':\n        interpreter (Statements s stmts)\n          = lift $ local (\\ x -&gt; x) (interpreter stmts)\n</code></pre>\n\n<p>How to repair it and why it is an error?</p>\n"}, {"tags": ["haskell", "cabal", "gloss"], "comments": [{"owner": {"reputation": 62421, "user_id": 216164, "user_type": "registered", "accept_rate": 89, "profile_image": "https://www.gravatar.com/avatar/786f224adbe0784cdf7d0f15476061fe?s=128&d=identicon&r=PG", "display_name": "Thomas M. DuBuisson", "link": "https://stackoverflow.com/users/216164/thomas-m-dubuisson"}, "edited": false, "score": 1, "creation_date": 1463071759, "post_id": 37192913, "comment_id": 61918492, "body": "Your step 1 failed so naturally step 3 will fail as well.  Gloss 1.8.* was depends on an OLDER version of base than your version of GHC shipped with."}, {"owner": {"reputation": 111, "user_id": 6068558, "user_type": "registered", "accept_rate": 64, "profile_image": "https://www.gravatar.com/avatar/fe2261de702c7695ad8e1fe9c40707d1?s=128&d=identicon&r=PG&f=1", "display_name": "Caroso", "link": "https://stackoverflow.com/users/6068558/caroso"}, "reply_to_user": {"reputation": 62421, "user_id": 216164, "user_type": "registered", "accept_rate": 89, "profile_image": "https://www.gravatar.com/avatar/786f224adbe0784cdf7d0f15476061fe?s=128&d=identicon&r=PG", "display_name": "Thomas M. DuBuisson", "link": "https://stackoverflow.com/users/216164/thomas-m-dubuisson"}, "edited": false, "score": 0, "creation_date": 1463071975, "post_id": 37192913, "comment_id": 61918620, "body": "i understand, but how can I find with which version of ghc, gloss 1.8.* works?"}, {"owner": {"reputation": 62421, "user_id": 216164, "user_type": "registered", "accept_rate": 89, "profile_image": "https://www.gravatar.com/avatar/786f224adbe0784cdf7d0f15476061fe?s=128&d=identicon&r=PG", "display_name": "Thomas M. DuBuisson", "link": "https://stackoverflow.com/users/216164/thomas-m-dubuisson"}, "edited": false, "score": 0, "creation_date": 1463116717, "post_id": 37192913, "comment_id": 61935502, "body": "The only way is sort of round-about.  You look at the gloss 1.8.* &#39;base&#39; dependency and see what that version is.  The base version maps to a GHC version, so you can translate between the two.  For example, I use GHC 7.10.3 which ships with base 4.8.2.0."}, {"owner": {"reputation": 62421, "user_id": 216164, "user_type": "registered", "accept_rate": 89, "profile_image": "https://www.gravatar.com/avatar/786f224adbe0784cdf7d0f15476061fe?s=128&d=identicon&r=PG", "display_name": "Thomas M. DuBuisson", "link": "https://stackoverflow.com/users/216164/thomas-m-dubuisson"}, "edited": false, "score": 0, "creation_date": 1463116788, "post_id": 37192913, "comment_id": 61935531, "body": "The path I&#39;d pick would be to try the library with gloss-1.10*.  It might not require any changes beyond adjusting the version bound in the .cabal file."}], "answers": [{"comments": [{"owner": {"reputation": 111, "user_id": 6068558, "user_type": "registered", "accept_rate": 64, "profile_image": "https://www.gravatar.com/avatar/fe2261de702c7695ad8e1fe9c40707d1?s=128&d=identicon&r=PG&f=1", "display_name": "Caroso", "link": "https://stackoverflow.com/users/6068558/caroso"}, "edited": false, "score": 0, "creation_date": 1463075884, "post_id": 37193365, "comment_id": 61920941, "body": "It is a way now to install base 4.7 with cabal? Even if I have a newer version of ghc..or I have to uninstall haskell and look for an older version?"}, {"owner": {"reputation": 16362, "user_id": 49220, "user_type": "registered", "accept_rate": 56, "profile_image": "https://www.gravatar.com/avatar/431cd43aaf713caa80316e852a87a840?s=128&d=identicon&r=PG", "display_name": "Paul Johnson", "link": "https://stackoverflow.com/users/49220/paul-johnson"}, "reply_to_user": {"reputation": 111, "user_id": 6068558, "user_type": "registered", "accept_rate": 64, "profile_image": "https://www.gravatar.com/avatar/fe2261de702c7695ad8e1fe9c40707d1?s=128&d=identicon&r=PG&f=1", "display_name": "Caroso", "link": "https://stackoverflow.com/users/6068558/caroso"}, "edited": false, "score": 0, "creation_date": 1463086127, "post_id": 37193365, "comment_id": 61926684, "body": "Not really. Significant parts of base are tied to the version of GHC. But have you just tried compiling with an up-to-date verison of Gloss? Its going to be easier."}], "tags": [], "owner": {"reputation": 16362, "user_id": 49220, "user_type": "registered", "accept_rate": 56, "profile_image": "https://www.gravatar.com/avatar/431cd43aaf713caa80316e852a87a840?s=128&d=identicon&r=PG", "display_name": "Paul Johnson", "link": "https://stackoverflow.com/users/49220/paul-johnson"}, "is_accepted": true, "score": 2, "last_activity_date": 1463073021, "creation_date": 1463073021, "answer_id": 37193365, "question_id": 37192913, "link": "https://stackoverflow.com/questions/37192913/cabal-error-running-with-gloss/37193365#37193365", "title": "Cabal error running with Gloss", "body": "<p>Gloss 1.8.2.2 requires base 4.7.* (see the cabal file). The <a href=\"https://downloads.haskell.org/~ghc/7.8.3/docs/html/users_guide/release-7-8-1.html#idp5507360\" rel=\"nofollow\">release notes</a> for GHC 7.8.3 state that it comes with base 4.7.0.0. </p>\n"}, {"tags": [], "owner": {"reputation": 394, "user_id": 5080177, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/3v8fY.png?s=128&g=1", "display_name": "sighingnow", "link": "https://stackoverflow.com/users/5080177/sighingnow"}, "is_accepted": false, "score": 0, "last_activity_date": 1466427829, "creation_date": 1466427829, "answer_id": 37923346, "question_id": 37192913, "link": "https://stackoverflow.com/questions/37192913/cabal-error-running-with-gloss/37923346#37923346", "title": "Cabal error running with Gloss", "body": "<p>The package gloss 1.8.* depends on base 4.6 or base 4.7. Cabal sandbox is a good choice for you. You can initialize a sandbox, then install base 4.7 and gloss 1.8 in it.</p>\n"}], "owner": {"reputation": 111, "user_id": 6068558, "user_type": "registered", "accept_rate": 64, "profile_image": "https://www.gravatar.com/avatar/fe2261de702c7695ad8e1fe9c40707d1?s=128&d=identicon&r=PG&f=1", "display_name": "Caroso", "link": "https://stackoverflow.com/users/6068558/caroso"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 189, "favorite_count": 0, "accepted_answer_id": 37193365, "answer_count": 2, "score": 0, "last_activity_date": 1478637409, "creation_date": 1463071524, "last_edit_date": 1478637409, "question_id": 37192913, "link": "https://stackoverflow.com/questions/37192913/cabal-error-running-with-gloss", "title": "Cabal error running with Gloss", "body": "<p>I'm  trying to install gloss on my computer to make a graphic game and I followed a tutorial, with these steps:</p>\n\n<p>1) First I run this command: cabal install gloss==1.8.* . I want gloss 1.8.* because I found a game made with this version of gloss, and I understand that it is recommended to use the same version of gloss with which the game was made it.\nI have this on the cmd: \n<a href=\"https://i.stack.imgur.com/8rUFM.jpg\" rel=\"nofollow noreferrer\"><img src=\"https://i.stack.imgur.com/8rUFM.jpg\" alt=\"installing gloss\"></a></p>\n\n<p>2)Next, once gloss is installed, we have to tell cabal that our package is allowed to use it. I founnd the line in pong.cabal that mentions build-depends and change it to the following:</p>\n\n<p>build-depends:       base >=4.7 &amp;&amp; &lt;4.8, gloss==1.8.*</p>\n\n<p>3) Finally, I wanted to run my .hs file(which contain the code to make a \"nice window\" with a circle) with the command: cabal run; the result of this command:</p>\n\n<p><a href=\"https://i.stack.imgur.com/1A8ST.jpg\" rel=\"nofollow noreferrer\"><img src=\"https://i.stack.imgur.com/1A8ST.jpg\" alt=\"running .hs file\"></a></p>\n\n<p>I don't understand why cabal can't find the gloss 1.8*.\nAnyone can help me with this problem?</p>\n"}, {"tags": ["haskell", "recursion"], "answers": [{"comments": [{"owner": {"reputation": 55, "user_id": 5962100, "user_type": "registered", "profile_image": "https://lh5.googleusercontent.com/-uqHqJMWVxFY/AAAAAAAAAAI/AAAAAAAAADw/QaNJIM01UeM/photo.jpg?sz=128", "display_name": "Martin V", "link": "https://stackoverflow.com/users/5962100/martin-v"}, "edited": false, "score": 1, "creation_date": 1463063925, "post_id": 37189478, "comment_id": 61912957, "body": "Thank you Carsten! I thought it had something to do with the way I handled the lists but now I know for sure! I have a &quot;maximumGen&quot; Int that should set a roof on how many generations it should work through :)"}], "tags": [], "owner": {"reputation": 48129, "user_id": 76051, "user_type": "registered", "accept_rate": 91, "profile_image": "https://i.stack.imgur.com/AGDxz.jpg?s=128&g=1", "display_name": "Carsten", "link": "https://stackoverflow.com/users/76051/carsten"}, "is_accepted": true, "score": 5, "last_activity_date": 1463062520, "last_edit_date": 1463062520, "creation_date": 1463062203, "answer_id": 37189478, "question_id": 37189296, "link": "https://stackoverflow.com/questions/37189296/understanding-basic-recursion-in-haskell/37189478#37189478", "title": "Understanding basic recursion in Haskell", "body": "<p>the problem is that <code>g n</code> is not <em>memoized</em> - it will be re-calculated 2 * 1000 in your list-comprehension</p>\n\n<pre><code>g 0 = initialPopulation\ng n = \n    let prev = g (n-1)\n    in [(mutate (mate (fTTS prev) (sTTS prev))) | x &lt;- [1..100]]\n</code></pre>\n\n<p>should improve things (I guess it would be a good problem to get strict values too - but that's probably another question)</p>\n\n<hr>\n\n<p>but I would not use it that way - instead write a:</p>\n\n<pre><code>nextGen prev = [(mutate (mate (fTTS prev) (sTTS prev))) | x &lt;- [1..100]]\n</code></pre>\n\n<p>function and then you could do something like:</p>\n\n<pre><code>find gen = if goodEnough gen then gen else find (nextGen gen)\n</code></pre>\n\n<p>with a <em>hopeful</em></p>\n\n<pre><code>best = find initialPopulation\n</code></pre>\n\n<p>(note that maybe you should have a exit-strategy after to much generations too - so you might want to include a generation counter or something similar)</p>\n"}], "owner": {"reputation": 55, "user_id": 5962100, "user_type": "registered", "profile_image": "https://lh5.googleusercontent.com/-uqHqJMWVxFY/AAAAAAAAAAI/AAAAAAAAADw/QaNJIM01UeM/photo.jpg?sz=128", "display_name": "Martin V", "link": "https://stackoverflow.com/users/5962100/martin-v"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 97, "favorite_count": 0, "accepted_answer_id": 37189478, "answer_count": 1, "score": 3, "last_activity_date": 1463062520, "creation_date": 1463061766, "question_id": 37189296, "link": "https://stackoverflow.com/questions/37189296/understanding-basic-recursion-in-haskell", "title": "Understanding basic recursion in Haskell", "body": "<p>I'm writing a genetic algorithm as a project for my artificial intelligence class. I'm familiar with the concept behind a GA but my experience of Haskell is limited. There is only one thing that's left to do in the program and that's to make a function which loops my other functions. I will present my function and explain the problem more in detail:</p>\n\n<p>This is the function for the second generation. I get the parents, mate them and mutate the genomes, and then pass the new genomes into a list:</p>\n\n<pre><code>generation1 = initialPopulation\ngeneration2 = [(mutate (mate (fTTS generation1) (sTTS generation1))) | x &lt;- [1..100]]\n</code></pre>\n\n<p>This works great. I can create a new generation and repeat:</p>\n\n<pre><code>generation3 = [(mutate (mate (fTTS generation2) (sTTS generation2))) | x &lt;- [1..100]]\n</code></pre>\n\n<p>So for each new generation I'm one step closer to the target genome (which is a String in my case). I want to generate a new generation until the target String is reached. I thought that a basic recursion would solve this, as in:</p>\n\n<pre><code>g 0 = initialPopulation\ng n = [(mutate (mate (fTTS (g (n - 1))) (sTTS (g (n - 1))))) | x &lt;- [1..100]]\n</code></pre>\n\n<p>This works on my laptop up to g (3), but then the computation takes ages. My problem is that I don't really understand why. I thought that Haskell recursion worked like following: </p>\n\n<pre><code>-- g 0 = [(mutate (mate (fTTS initialPopulation) (sTTS initialPopulation))) | x &lt;- [1..100]] = [\"N4kiT\",\"Tu1RT\",\"Tu1R&lt;\"]\n-- g 1 = [(mutate (mate (fTTS (g 0)) (sTTS (g 0)))) | x &lt;- [1..100]]\n-- g 2 = [(mutate (mate (fTTS (g 1)) (sTTS (g 1)))) | x &lt;- [1..100]]\n-- g 3 = [(mutate (mate (fTTS (g 2)) (sTTS (g 2)))) | x &lt;- [1..100]]\n</code></pre>\n\n<p>Which in my head should be the same as the generation3 function above. I would appreciate if someone who knows more about Haskell could explain why I'm able to run a \"generation15\"-function without any trouble but not more than a \"g (3)\"-function before I have to force-exit in the console.</p>\n\n<p>Thanks!</p>\n"}, {"tags": ["haskell", "newtype"], "comments": [{"owner": {"reputation": 100892, "user_id": 745903, "user_type": "registered", "accept_rate": 74, "profile_image": "https://www.gravatar.com/avatar/50933f6638836741e620669b3940410e?s=128&d=identicon&r=PG", "display_name": "leftaroundabout", "link": "https://stackoverflow.com/users/745903/leftaroundabout"}, "edited": false, "score": 2, "creation_date": 1463064292, "post_id": 37187933, "comment_id": 61913288, "body": "How about you tell us your experiments, including the errors they cause?"}, {"owner": {"reputation": 29966, "user_id": 637669, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/0227e5d5eaceb8ae2f751df38d421764?s=128&d=identicon&r=PG", "display_name": "arrowd", "link": "https://stackoverflow.com/users/637669/arrowd"}, "edited": false, "score": 0, "creation_date": 1463064408, "post_id": 37187933, "comment_id": 61913395, "body": "I guess, the problem is <code>Interpreter</code> not being a <code>Monad</code>."}, {"owner": {"reputation": 3815, "user_id": 5382150, "user_type": "registered", "accept_rate": 86, "profile_image": "https://i.stack.imgur.com/GwGSL.png?s=128&g=1", "display_name": "Gilgamesz", "link": "https://stackoverflow.com/users/5382150/gilgamesz"}, "edited": false, "score": 0, "creation_date": 1463064528, "post_id": 37187933, "comment_id": 61913504, "body": "Why do you find that <code>Interpreter</code> is not monad?"}], "answers": [{"tags": [], "owner": {"reputation": 1, "user_id": 14143028, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/5d4b133c4efda0c3e1d07cc23ee8781a?s=128&d=identicon&r=PG&f=1", "display_name": "Mart", "link": "https://stackoverflow.com/users/14143028/mart"}, "is_accepted": false, "score": 0, "last_activity_date": 1598010101, "creation_date": 1598010101, "answer_id": 63522269, "question_id": 37187933, "link": "https://stackoverflow.com/questions/37187933/lift-monad-reader-local/63522269#63522269", "title": "Lift Monad Reader local", "body": "<p>If you want a function such as <code>local</code> to be lifted to an inner monad you need the <code>map...T</code> class of functions.</p>\n<p>For example, if you have a <code>WriterT [String] (ReaderT Int (Either String)) a</code> and you want to do run <code>something</code> with a different reader environment:</p>\n<pre><code>mapWriterT (local (+1)) something\n</code></pre>\n"}], "owner": {"reputation": 3815, "user_id": 5382150, "user_type": "registered", "accept_rate": 86, "profile_image": "https://i.stack.imgur.com/GwGSL.png?s=128&g=1", "display_name": "Gilgamesz", "link": "https://stackoverflow.com/users/5382150/gilgamesz"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 233, "favorite_count": 1, "answer_count": 1, "score": 0, "last_activity_date": 1598010101, "creation_date": 1463058557, "last_edit_date": 1463060365, "question_id": 37187933, "link": "https://stackoverflow.com/questions/37187933/lift-monad-reader-local", "title": "Lift Monad Reader local", "body": "<pre><code>import Control.Monad.Reader\nimport Control.Monad.State\nimport Control.Monad.Error\n\ndata Context\ndata Memory \ndata Functions\n\ndata InterpreterM a = ExeInterpreter a | PropInterpreter a\n\nnewtype InterpreterMT m a = InterpreterMT { runInterpreterMT :: m (InterpreterM a) }\ntype Interpreter = InterpreterMT (StateT (Memory, Functions) (ReaderT (Context, Context) (ErrorT String IO)))\n\ndata Stmt\ndata Stmts = EmptyStmts | Statements Stmt Stmts\n\ninterpretStmt :: Stmt -&gt; Interpreter Context\n\ninterpreter :: Stmts -&gt; Interpreter ()\ninterpreter EmptyStmts = return () \ninterpreter (Statements s stmts) = do\n    currEnv &lt;- interpretStmt s\n    local (\\(prev, _) -&gt; (prev, currEnv)) $ interpreter stmts\n</code></pre>\n\n<p>The problem is in last line- there is no lifting- I know it. But I don't know how to put lift here  because my experiments also gives me errors.\nI am asking for help.</p>\n"}, {"tags": ["haskell", "tree", "functional-programming", "weak-references", "infinite"], "comments": [{"owner": {"reputation": 6415, "user_id": 1416525, "user_type": "registered", "accept_rate": 78, "profile_image": "https://www.gravatar.com/avatar/6f23f148b7241e345a61d193ed205685?s=128&d=identicon&r=PG", "display_name": "cdk", "link": "https://stackoverflow.com/users/1416525/cdk"}, "edited": false, "score": 2, "creation_date": 1463070431, "post_id": 37184230, "comment_id": 61917696, "body": "I don&#39;t think weak pointers (hence <code>IO</code>) will be necessary. For example, <code>Data.Seq</code> goes to great lengths to maximize internal sharing using some clever code: <a href=\"https://hackage.haskell.org/package/containers-0.5.7.1/docs/src/Data.Sequence.html#applicativeTree\" rel=\"nofollow noreferrer\">hackage.haskell.org/package/containers-0.5.7.1/docs/src/&hellip;</a>"}, {"owner": {"reputation": 1281, "user_id": 5600363, "user_type": "registered", "accept_rate": 38, "profile_image": "https://www.gravatar.com/avatar/d820760191b1bb057846d5a06c2bf5b6?s=128&d=identicon&r=PG", "display_name": "hkBst", "link": "https://stackoverflow.com/users/5600363/hkbst"}, "reply_to_user": {"reputation": 6415, "user_id": 1416525, "user_type": "registered", "accept_rate": 78, "profile_image": "https://www.gravatar.com/avatar/6f23f148b7241e345a61d193ed205685?s=128&d=identicon&r=PG", "display_name": "cdk", "link": "https://stackoverflow.com/users/1416525/cdk"}, "edited": false, "score": 0, "creation_date": 1463637563, "post_id": 37184230, "comment_id": 62150155, "body": "@cdk, I cannot quite find where/how it does that. From the comment &quot;Special note: the Identity specialization automatically does node sharing, reducing memory usage of the resulting tree to /O(log n)/&quot;, it seems to be implied that the code does not implement sharing explicitly, but that compiler optimizations for a specific specialization make it happen anyway (implying that for other cases it may not happen). Could you explain a bit more how Data.Seq does sharing and how that would help me?"}, {"owner": {"reputation": 44013, "user_id": 1477667, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/trgKM.jpg?s=128&g=1", "display_name": "dfeuer", "link": "https://stackoverflow.com/users/1477667/dfeuer"}, "edited": false, "score": 1, "creation_date": 1464187455, "post_id": 37184230, "comment_id": 62383597, "body": "@hkBst, that comment is misleading, and I&#39;ll try to edit it to clarify in the next version. The compiler specialization to <code>Identity</code> does nothing but improve constant factors. What it really means is that <i>when used with <code>Identity</code></i> there&#39;s lots of sharing."}, {"owner": {"reputation": 44013, "user_id": 1477667, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/trgKM.jpg?s=128&g=1", "display_name": "dfeuer", "link": "https://stackoverflow.com/users/1477667/dfeuer"}, "edited": false, "score": 1, "creation_date": 1464187804, "post_id": 37184230, "comment_id": 62383879, "body": "I don&#39;t see what you&#39;re trying to do with weak pointers. If you change your game state to point at a child of the state tree root representing the selected move, then the other subtrees should become inaccessible and be dropped by the garbage collector."}, {"owner": {"reputation": 1281, "user_id": 5600363, "user_type": "registered", "accept_rate": 38, "profile_image": "https://www.gravatar.com/avatar/d820760191b1bb057846d5a06c2bf5b6?s=128&d=identicon&r=PG", "display_name": "hkBst", "link": "https://stackoverflow.com/users/5600363/hkbst"}, "reply_to_user": {"reputation": 44013, "user_id": 1477667, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/trgKM.jpg?s=128&g=1", "display_name": "dfeuer", "link": "https://stackoverflow.com/users/1477667/dfeuer"}, "edited": false, "score": 2, "creation_date": 1464188203, "post_id": 37184230, "comment_id": 62384176, "body": "@dfeuer, but the cache will still contain a reference to the previous state, preventing garbage collection."}, {"owner": {"reputation": 1281, "user_id": 5600363, "user_type": "registered", "accept_rate": 38, "profile_image": "https://www.gravatar.com/avatar/d820760191b1bb057846d5a06c2bf5b6?s=128&d=identicon&r=PG", "display_name": "hkBst", "link": "https://stackoverflow.com/users/5600363/hkbst"}, "edited": false, "score": 0, "creation_date": 1464589284, "post_id": 37184230, "comment_id": 62530611, "body": "My bounty is about to expire... I would prefer to award it to even a partial answer or hint rather than letting it go to waste..."}, {"owner": {"reputation": 94553, "user_id": 775806, "user_type": "registered", "accept_rate": 96, "profile_image": "https://i.stack.imgur.com/XNd2C.png?s=128&g=1", "display_name": "n. &#39;pronouns&#39; m.", "link": "https://stackoverflow.com/users/775806/n-pronouns-m"}, "edited": false, "score": 0, "creation_date": 1506979059, "post_id": 37184230, "comment_id": 80022534, "body": "If the game of chess is your motivation, then a game subtree is fully determined by its starting position and you need to eliminate duplicate nodes rather than subtrees."}], "answers": [{"comments": [{"owner": {"reputation": 1281, "user_id": 5600363, "user_type": "registered", "accept_rate": 38, "profile_image": "https://www.gravatar.com/avatar/d820760191b1bb057846d5a06c2bf5b6?s=128&d=identicon&r=PG", "display_name": "hkBst", "link": "https://stackoverflow.com/users/5600363/hkbst"}, "edited": false, "score": 0, "creation_date": 1508073592, "post_id": 46533719, "comment_id": 80456305, "body": "The point of doing it <i>lazily</i> is that you can limit the amount of memory used by limiting traversal. The question is whether you can do it lazily and also <i>detect and eliminate duplicates dynamically</i>."}, {"owner": {"reputation": 67060, "user_id": 783743, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/835bdcdab3e4bf466f0d59f809c50035?s=128&d=identicon&r=PG", "display_name": "Aadit M Shah", "link": "https://stackoverflow.com/users/783743/aadit-m-shah"}, "reply_to_user": {"reputation": 1281, "user_id": 5600363, "user_type": "registered", "accept_rate": 38, "profile_image": "https://www.gravatar.com/avatar/d820760191b1bb057846d5a06c2bf5b6?s=128&d=identicon&r=PG", "display_name": "hkBst", "link": "https://stackoverflow.com/users/5600363/hkbst"}, "edited": false, "score": 0, "creation_date": 1508088605, "post_id": 46533719, "comment_id": 80461050, "body": "First, laziness doesn&#39;t magically reduce your memory requirements. Second, most game tree search algorithms are depth-first searches which only takes linear memory anyway. Third, most Chess engines (even the ones written in C) have lazy move generators (i.e. they only produce one move at a time instead of all at once). Fourth, detecting and eliminating duplicates requires an exponential amount of memory whether you write your program in C or in Haskell. Chess is an EXPSPACE problem and there&#39;s nothing that you can do to improve that."}, {"owner": {"reputation": 67060, "user_id": 783743, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/835bdcdab3e4bf466f0d59f809c50035?s=128&d=identicon&r=PG", "display_name": "Aadit M Shah", "link": "https://stackoverflow.com/users/783743/aadit-m-shah"}, "reply_to_user": {"reputation": 1281, "user_id": 5600363, "user_type": "registered", "accept_rate": 38, "profile_image": "https://www.gravatar.com/avatar/d820760191b1bb057846d5a06c2bf5b6?s=128&d=identicon&r=PG", "display_name": "hkBst", "link": "https://stackoverflow.com/users/5600363/hkbst"}, "edited": false, "score": 0, "creation_date": 1508088777, "post_id": 46533719, "comment_id": 80461113, "body": "Fifth, of course you can have both laziness and transposition tables. Most chess engines do. However, the transposition tables can&#39;t store every single transposition and hence you can&#39;t eliminate every duplicate node. Laziness doesn&#39;t help reduce this. That&#39;s not how laziness works."}, {"owner": {"reputation": 1281, "user_id": 5600363, "user_type": "registered", "accept_rate": 38, "profile_image": "https://www.gravatar.com/avatar/d820760191b1bb057846d5a06c2bf5b6?s=128&d=identicon&r=PG", "display_name": "hkBst", "link": "https://stackoverflow.com/users/5600363/hkbst"}, "edited": false, "score": 0, "creation_date": 1508409521, "post_id": 46533719, "comment_id": 80603204, "body": "Even so, transposition tables are used by chess engines, as you yourself note... My question is firstly a Haskell question and only secondly a chess engine question; if your answer does not help me understand why my program is not lazy, then it does not answer my question."}], "tags": [], "owner": {"reputation": 67060, "user_id": 783743, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/835bdcdab3e4bf466f0d59f809c50035?s=128&d=identicon&r=PG", "display_name": "Aadit M Shah", "link": "https://stackoverflow.com/users/783743/aadit-m-shah"}, "is_accepted": false, "score": 0, "last_activity_date": 1506978364, "creation_date": 1506978364, "answer_id": 46533719, "question_id": 37184230, "link": "https://stackoverflow.com/questions/37184230/how-to-build-an-infinite-tree-with-duplicate-elimination-via-cache-of-weak-point/46533719#46533719", "title": "How to build an infinite tree with duplicate elimination via cache of weak pointers in Haskell", "body": "<blockquote>\n  <p>My question is thus: Is it possible to efficiently generate a lazy (game state) tree without duplicate subtrees (and without leaking memory)?</p>\n</blockquote>\n\n<p>No. Essentially what you're trying to do is use <a href=\"https://en.wikipedia.org/wiki/Transposition_table\" rel=\"nofollow noreferrer\">transposition tables</a> to memoize your tree search function (e.g. <a href=\"https://en.wikipedia.org/wiki/Principal_variation_search\" rel=\"nofollow noreferrer\">negascout</a>). The problem is that games have an exponential number of states and maintaining a transposition table which remembers all the transpositions of the state space is infeasible. You just don't have that much memory.</p>\n\n<p>For example, Chess has a <a href=\"https://en.wikipedia.org/wiki/Game_complexity#Complexities_of_some_well-known_games\" rel=\"nofollow noreferrer\">state space compexity of 10^47</a>. That's several orders of magnitude greater than all the computer memory available in the entire world. Of course, you can reduce this amount by not storing reflections (Chess has <a href=\"https://en.wikipedia.org/wiki/Reflection_symmetry\" rel=\"nofollow noreferrer\">8 reflection symmetries</a>). Furthermore, many of these transpositions would be unreachable due to <a href=\"https://en.wikipedia.org/wiki/Alpha%E2%80%93beta_pruning\" rel=\"nofollow noreferrer\">pruning of the game tree</a>. However, the state space is so intractable that you would still never to able to store every transposition.</p>\n\n<p>What most programs usually do is they use a transposition table of a fixed size and when two transpositions hash to the same value, they use a <a href=\"https://chessprogramming.wikispaces.com/Transposition+Table#Replacement%20Strategies\" rel=\"nofollow noreferrer\">replacement scheme</a> to decide which entry will be kept and which one will be discarded. This is a tradeoff because you are keeping the value which you think will be most efficient (i.e. most visited or closer to the root node) at the cost of having to traverse the other transposition. The point is that it's impossible to generate a game tree which has no duplicate subtrees unless you're from a sufficiently advanced alien civilization.</p>\n"}], "owner": {"reputation": 1281, "user_id": 5600363, "user_type": "registered", "accept_rate": 38, "profile_image": "https://www.gravatar.com/avatar/d820760191b1bb057846d5a06c2bf5b6?s=128&d=identicon&r=PG", "display_name": "hkBst", "link": "https://stackoverflow.com/users/5600363/hkbst"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 319, "favorite_count": 2, "answer_count": 1, "score": 9, "last_activity_date": 1506978364, "creation_date": 1463048904, "last_edit_date": 1464176479, "question_id": 37184230, "link": "https://stackoverflow.com/questions/37184230/how-to-build-an-infinite-tree-with-duplicate-elimination-via-cache-of-weak-point", "title": "How to build an infinite tree with duplicate elimination via cache of weak pointers in Haskell", "body": "<p>The following code builds up an infinite tree, while at the same time creating a cache of all subtrees, such that no duplicate subtrees are created.  The rationale for elimination of duplicate subtrees comes from the application to state trees of chess-like games: one can often end up in the same game state by just changing the order of two moves.  As the game progresses, states that become inaccessible should not continue to take up memory.  I thought I could solve that problem through the use of weak pointers.  Unfortunately using weak pointers brings us into the IO Monad and this seems to have destroyed enough/all lazyness such that this code does not terminate any more.</p>\n\n<p>My question is thus: Is it possible to efficiently generate a lazy (game state) tree without duplicate subtrees (and without leaking memory)?</p>\n\n<pre><code>{-# LANGUAGE RecursiveDo #-}\n\nimport Prelude hiding (lookup)\nimport Data.Map.Lazy (Map, empty, lookup, insert)\nimport Data.List (transpose)\n\nimport Control.Monad.State.Lazy (StateT(..))\nimport System.Mem.Weak\nimport System.Environment\n\ntype TreeCache = Map Integer (Weak NTree)\n\ndata Tree a = Tree a [Tree a]\ntype Node = (Integer, [Integer])\ntype NTree = Tree Node\n\ngetNode (Tree a _) = a\ngetVals = snd . getNode\n\nmakeTree :: Integer -&gt; IO NTree\nmakeTree n = fst &lt;$&gt; runStateT (makeCachedTree n) empty\n\nmakeCachedTree :: Integer -&gt; StateT TreeCache IO NTree\nmakeCachedTree n = StateT $ \\s -&gt; case lookup n s of\n  Nothing -&gt; runStateT (makeNewTree n) s -- makeNewTree n s                                                                                                                                   \n  Just wt -&gt; deRefWeak wt &gt;&gt;= \\mt -&gt; case mt of\n    Nothing -&gt; runStateT (makeNewTree n) s\n    Just t -&gt; return (t,s)\n\nmakeNewTree :: Integer -&gt; StateT TreeCache IO NTree\nmakeNewTree n = StateT $ \\s -&gt; mdo\n  wt &lt;- mkWeak n t Nothing\n  (ts, s') &lt;- runStateT\n              (mapM makeCachedTree $ children n)\n              (insert n wt s)\n  let t = Tree (n, values n $ map getVals ts) ts\n  return (t, s')\n\nchildren n = let bf = 10 in let hit = 2 in [bf*n..bf*n+bf+hit-1]\n\nvalues n [] = repeat n\nvalues n nss = n:maximum (transpose nss)\n\nmain = do\n  args &lt;- getArgs\n  let n = read $ head args in\n    do t &lt;- makeTree n\n       if length args == 1 then putStr $ show $ take (fromInteger n) $ getVals t else putStr \"One argument only!!!\"\n</code></pre>\n"}, {"tags": ["sql", "haskell", "persistent"], "answers": [{"tags": [], "owner": {"reputation": 1894, "user_id": 412417, "user_type": "registered", "accept_rate": 82, "profile_image": "https://www.gravatar.com/avatar/880a205c1958574d83803d5e30da95ca?s=128&d=identicon&r=PG&f=1", "display_name": "MCH", "link": "https://stackoverflow.com/users/412417/mch"}, "is_accepted": true, "score": 1, "last_activity_date": 1525957195, "creation_date": 1525957195, "answer_id": 50273532, "question_id": 37182279, "link": "https://stackoverflow.com/questions/37182279/foreign-key-from-an-existing-database-with-persistent-haskell/50273532#50273532", "title": "Foreign Key from an existing database with Persistent Haskell", "body": "<p>I'm assuming that you are using SQLite. SQLite supports foreign key constraints, but by default, they are not turned on. You must turn them on before the migration. </p>\n\n<p><a href=\"https://www.sqlite.org/foreignkeys.html#fk_enable\" rel=\"nofollow noreferrer\">SQLite Foreign Key Support: 2. Enabling Foreign Key Support</a></p>\n\n<p>This is the SQLite command to turn them on:</p>\n\n<pre><code>PRAGMA foreign_keys = ON;\n</code></pre>\n\n<p>You can turn this PRAGMA on via Haskell and Persistent with the following code:</p>\n\n<pre><code>import qualified Database.Sqlite as Sqlite\nimport Database.Persist.Sqlite (createSqlPool, wrapConnection)\n\nenableForeignKeys :: Sqlite.Connection -&gt; IO ()\nenableForeignKeys conn = Sqlite.prepare conn \"PRAGMA foreign_keys = ON;\" &gt;&gt;= void . Sqlite.step\n\ncreateSqliteBackend :: Text -&gt; LogFunc -&gt; IO SqlBackend\ncreateSqliteBackend connStr logFunc = do\n  conn &lt;- Sqlite.open connStr\n  enableForeignKeys conn\n  wrapConnection conn logFunc\n</code></pre>\n\n<p><code>createSqliteBackend</code> will return an <code>SqlBackend</code> that run Persistent queries against with the <code>foreign_keys</code> Pragma turned on.</p>\n\n<p><a href=\"https://github.com/yesodweb/yesod-cookbook/blob/master/cookbook/Activate-foreign-key-checking-in-Sqlite.md\" rel=\"nofollow noreferrer\">Yesod Cookbook: Activate foreign key checking in Sqlite</a></p>\n"}], "owner": {"reputation": 449, "user_id": 1422441, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/ffb37250909dac913e7ade723b670002?s=128&d=identicon&r=PG", "display_name": "lthms", "link": "https://stackoverflow.com/users/1422441/lthms"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 390, "favorite_count": 1, "accepted_answer_id": 50273532, "answer_count": 1, "score": 1, "last_activity_date": 1525957195, "creation_date": 1463044206, "question_id": 37182279, "link": "https://stackoverflow.com/questions/37182279/foreign-key-from-an-existing-database-with-persistent-haskell", "title": "Foreign Key from an existing database with Persistent Haskell", "body": "<p>I am currently working on a project using Haskell and Persistent and I run in a small issue. I want to code a little library to deal with a generic approach for authentication where each user gets an \"identity\".</p>\n\n<p>This identity is stored in a database using persistent.</p>\n\n<pre><code>Identity\n  lastSeen       UTCTime\n  registration   UTCTime\n  karma          Int DEFAULT=0\n  banned         UTCTime Maybe\n</code></pre>\n\n<p>My idea is that the users of my lib can add map their account datatype to an identity. My issue is that, when I give the type <code>IdentityId</code> to a field of my user datatype, the column is an integer (that's fine) but the references constraint is missing.</p>\n\n<p>For instance\u00a0:</p>\n\n<pre><code>User\n  email          Text\n  identity       IdentityId\n  UniqueIdentity identity\n</code></pre>\n\n<p>I get:</p>\n\n<pre><code>Migrating: CREATE TABLE \"identity\"(\"id\" INTEGER PRIMARY KEY,\"last_seen\" TIMESTAMP NOT NULL,\"registration\" TIMESTAMP NOT NULL,\"karma\" INTEGER NOT NULL,\"banned\" TIMESTAMP NULL)\nMigrating: CREATE TABLE \"user\"(\"id\" INTEGER PRIMARY KEY,\"email\" VARCHAR NOT NULL,\"identity\" INTEGER NOT NULL,CONSTRAINT \"unique_identity\" UNIQUE (\"identity\"))\n</code></pre>\n\n<p>The trick is: the definition of user is done in a different file and I suppose the issue is here.</p>\n\n<p>Can I do something to force persistent to add a references constraint?</p>\n\n<p>Thank you by advance!</p>\n"}, {"tags": ["haskell", "ghc", "cabal", "ghci"], "comments": [{"owner": {"reputation": 11780, "user_id": 2827654, "user_type": "registered", "accept_rate": 57, "profile_image": "https://www.gravatar.com/avatar/a171742e9c31a541d4d2031af932e94a?s=128&d=identicon&r=PG&f=1", "display_name": "jamshidh", "link": "https://stackoverflow.com/users/2827654/jamshidh"}, "edited": false, "score": 4, "creation_date": 1463032847, "post_id": 37178304, "comment_id": 61890808, "body": "All of my problems with imports went away when I started using stack...."}, {"owner": {"reputation": 94713, "user_id": 1139697, "user_type": "registered", "accept_rate": 86, "profile_image": "https://www.gravatar.com/avatar/5f136ddb684f39aaee1c028ee1950f6f?s=128&d=identicon&r=PG", "display_name": "Zeta", "link": "https://stackoverflow.com/users/1139697/zeta"}, "edited": false, "score": 1, "creation_date": 1463033406, "post_id": 37178304, "comment_id": 61891030, "body": "Did you, by any chance, use <code>cabal repl</code> in a project, where <code>random</code> isn&#39;t listed as a dependency? That being said, what is your path, what is the result of <code>cabal list --installed --simple-output</code>, <code>ghc-pkg list</code> and <code>ghc-pkg list --user</code>? I couldn&#39;t reproduce this with a fresh install of GHC 7.10.3 and cabal-install-1.24."}, {"owner": {"reputation": 4074, "user_id": 4154350, "user_type": "registered", "accept_rate": 67, "profile_image": "https://www.gravatar.com/avatar/70e00ce9458ef1e59ce5734fd6e377f6?s=128&d=identicon&r=PG&f=1", "display_name": "Pierre G.", "link": "https://stackoverflow.com/users/4154350/pierre-g"}, "edited": false, "score": 0, "creation_date": 1463043655, "post_id": 37178304, "comment_id": 61897388, "body": "and using  -i option of ghci (ghci -i dir)?"}, {"owner": {"reputation": 499, "user_id": 4629794, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/fb19f570a2d96e68ec79f0af208d23a8?s=128&d=identicon&r=PG", "display_name": "lierdakil", "link": "https://stackoverflow.com/users/4629794/lierdakil"}, "edited": false, "score": 0, "creation_date": 1463512831, "post_id": 37178304, "comment_id": 62094171, "body": "First order of business is checking that libraries are sane. Run <code>ghc-pkg check</code> (you can safely ignore any haddock warnings). Also, ghci doesn&#39;t know anything about cabal, and looks for (user-installed) packages in <code>~&#47;.ghc&#47;&lt;platform&gt;&#47;package.conf.d&#47;</code>"}, {"owner": {"reputation": 5428, "user_id": 482382, "user_type": "registered", "accept_rate": 85, "profile_image": "https://www.gravatar.com/avatar/9fe6eecd0900f0e779711f091fec8b3b?s=128&d=identicon&r=PG", "display_name": "Steven Shaw", "link": "https://stackoverflow.com/users/482382/steven-shaw"}, "edited": false, "score": 0, "creation_date": 1471963860, "post_id": 37178304, "comment_id": 65555754, "body": "I followed the same procedure as you with ghc-8.0.1. I didn&#39;t have any trouble loading <code>System.Random</code> after installing <code>random</code> with cabal. Did you end up solving your issue?"}], "owner": {"reputation": 12714, "user_id": 505306, "user_type": "registered", "accept_rate": 84, "profile_image": "https://i.stack.imgur.com/TjIHR.png?s=128&g=1", "display_name": "smilingbuddha", "link": "https://stackoverflow.com/users/505306/smilingbuddha"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 482, "favorite_count": 0, "answer_count": 0, "score": 0, "last_activity_date": 1463042775, "creation_date": 1463032273, "last_edit_date": 1463042775, "question_id": 37178304, "link": "https://stackoverflow.com/questions/37178304/how-to-add-directory-containing-libraries-to-ghc-and-ghcis-paths-by-default", "title": "How to add directory containing libraries to ghc and ghci&#39;s paths by default", "body": "<p>I am learning Haskell. I want to use the <code>System.Random</code> library. However, Ghci cannot seem to find it. Here is the error reported</p>\n\n<pre><code>Prelude&gt; import System.Random \n\n&lt;no location info&gt;:\n    Could not find module \u2018System.Random\u2019\n    It is not a module in the current program, or in any known package.\nPrelude&gt; \n</code></pre>\n\n<p>So I installed the library using <code>cabal install random</code>. The same problem persisted. After a bit of poking around in my directories I found that the package <em>is</em> present after all. Here are the contents of my <code>~/.cabal/lib</code> \ndirectory</p>\n\n<pre><code>smbud@gedanken:~/.cabal/lib$ ls\nbifunctors-4.1.1.1                  distributive-0.4.4  lens-family-core-1.0.1  StateVar-1.1.0.3             unix-2.7.1.0\ncomonad-4.2.7.2                     exceptions-0.8.2.1  nats-1.1                tagged-0.8.3                 unordered-containers-0.2.7.0\ncontravariant-1.4                   gnuplot-0.5.4.1     process-1.4.2.0         temporary-1.2.0.4            utility-ht-0.0.11\ndata-accessor-0.2.2.7               graphene-0.1.0.4    random-1.1              time-1.5.0.1                 void-0.7.1\ndata-accessor-transformers-0.2.1.7  hashable-1.1.2.5    semigroupoids-4.3       transformers-compat-0.4.0.3\ndirectory-1.2.5.1                   lens-family-1.0.0   semigroups-0.18.1       transformers-compat-0.5.1.4\n</code></pre>\n\n<p>So I think ghci probably does not search in this directory for libraries? \nWhat must I do so that ghci can know the loction of <code>random</code> and the other \nuseful software packages within. </p>\n"}, {"tags": ["haskell", "functional-programming"], "comments": [{"owner": {"reputation": 44013, "user_id": 1477667, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/trgKM.jpg?s=128&g=1", "display_name": "dfeuer", "link": "https://stackoverflow.com/users/1477667/dfeuer"}, "edited": false, "score": 1, "creation_date": 1463030708, "post_id": 37177854, "comment_id": 61889933, "body": "The most obviously wrong syntax is the dangling semicolon, but the whole thing just looks weird. My brain doesn&#39;t work very well with the details of Haskell&#39;s layout rule, so I tend to be extremely boring about how I indent my code."}, {"owner": {"reputation": 11780, "user_id": 2827654, "user_type": "registered", "accept_rate": 57, "profile_image": "https://www.gravatar.com/avatar/a171742e9c31a541d4d2031af932e94a?s=128&d=identicon&r=PG&f=1", "display_name": "jamshidh", "link": "https://stackoverflow.com/users/2827654/jamshidh"}, "edited": false, "score": 1, "creation_date": 1463031196, "post_id": 37177854, "comment_id": 61890112, "body": "and what is that <code>(+++)</code> operator?  You may convince me that with proper spacing and a definition for that <code>(+++)</code> that this should work, but it certainly isn&#39;t idiomatic...."}, {"owner": {"reputation": 28488, "user_id": 402884, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35583fe46c2cde92467710cc7ceff266?s=128&d=identicon&r=PG", "display_name": "Chris Martin", "link": "https://stackoverflow.com/users/402884/chris-martin"}, "edited": false, "score": 3, "creation_date": 1463074020, "post_id": 37177854, "comment_id": 61919800, "body": "Hi, welcome to Stack Overflow. I think this was a fine question that has received some unwarranted rude comments. I hope we do better next time."}, {"owner": {"reputation": 669, "user_id": 5991761, "user_type": "registered", "accept_rate": 41, "profile_image": "https://www.gravatar.com/avatar/984565203d53cc51598def5bb244f159?s=128&d=identicon&r=PG&f=1", "display_name": "Mint.K", "link": "https://stackoverflow.com/users/5991761/mint-k"}, "edited": false, "score": 0, "creation_date": 1463074383, "post_id": 37177854, "comment_id": 61920014, "body": "I know it helps to understand code if people see what my intention is, but for this I was just questioning about my syntax."}], "answers": [{"tags": [], "owner": {"reputation": 28488, "user_id": 402884, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35583fe46c2cde92467710cc7ceff266?s=128&d=identicon&r=PG", "display_name": "Chris Martin", "link": "https://stackoverflow.com/users/402884/chris-martin"}, "is_accepted": false, "score": 11, "last_activity_date": 1463034375, "last_edit_date": 1463034375, "creation_date": 1463032068, "answer_id": 37178268, "question_id": 37177854, "link": "https://stackoverflow.com/questions/37177854/haskell-indentation-in-a-do-block/37178268#37178268", "title": "Haskell indentation in a do block", "body": "<p>Where curly braces are omitted, Haskell uses the <a href=\"https://en.wikipedia.org/wiki/Off-side_rule\" rel=\"noreferrer\">off-side rule</a>; blocks are expressed by their indentation. The <a href=\"https://en.wikibooks.org/wiki/Haskell/Indentation\" rel=\"noreferrer\">Wikibook</a> has an okay description of how Haskell indentation works:</p>\n\n<blockquote>\n  <p>All <em>grouped</em> expressions must be exactly aligned. On the first line, Haskell counts everything to the left of the expression as indent, even though it is not whitespace.</p>\n</blockquote>\n\n<p>In your example, you have two <code>do</code> blocks. The inner one uses curly braces, and the outer one does not. You could get your code to compile by adding curly braces to the outer <code>do</code> block:</p>\n\n<pre><code>firstgrm = do { t &lt;- secgrm;\n             ( do { symbol \"##\";\n               o &lt;- firstgrm;\n           return (O (t ## o));}\n        +++ return t ) }\n</code></pre>\n\n<p>... though I really don't recommend it.</p>\n\n<p>It is customary to <em>always</em> omit braces. The indentation rules also make it awkward to put a <code>do</code> block within parentheses, so we usually avoid that as well.</p>\n\n<pre><code>firstgrm = do t &lt;- secgrm\n              x t +++ return t\n  where\n    x t = do symbol \"##\"\n             o &lt;- firstgrm\n             return (O (t ## o))\n</code></pre>\n"}], "owner": {"reputation": 669, "user_id": 5991761, "user_type": "registered", "accept_rate": 41, "profile_image": "https://www.gravatar.com/avatar/984565203d53cc51598def5bb244f159?s=128&d=identicon&r=PG&f=1", "display_name": "Mint.K", "link": "https://stackoverflow.com/users/5991761/mint-k"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 588, "favorite_count": 0, "closed_date": 1463036804, "answer_count": 1, "score": -2, "last_activity_date": 1463034375, "creation_date": 1463030264, "last_edit_date": 1463034125, "question_id": 37177854, "link": "https://stackoverflow.com/questions/37177854/haskell-indentation-in-a-do-block", "closed_reason": "Needs details or clarity", "title": "Haskell indentation in a do block", "body": "<p>I am implementing arithmetic expression tree examples from the book <em>Programming in Haskell</em> by Hutton, and I'm getting a syntax error:</p>\n\n<blockquote>\n  <p>parse error (possibly incorrect indentation or mismatched brackets)</p>\n</blockquote>\n\n<pre><code>firstgrm = do t &lt;- secgrm\n             ( do { symbol \"##\";\n               o &lt;- firstgrm;\n           return (O (t ## o));}\n        +++ return t )                         -- parse error here\n</code></pre>\n"}, {"tags": ["haskell", "emacs", "indentation", "haskell-mode"], "comments": [{"owner": {"reputation": 43759, "user_id": 1651941, "user_type": "registered", "accept_rate": 97, "profile_image": "https://www.gravatar.com/avatar/a513bc1fa519d2fcf5e4e0d9b5500101?s=128&d=identicon&r=PG", "display_name": "Sibi", "link": "https://stackoverflow.com/users/1651941/sibi"}, "edited": false, "score": 2, "creation_date": 1463021951, "post_id": 37176145, "comment_id": 61887466, "body": "Set it to 4: <code>(setq haskell-indent-spaces 4)</code>."}, {"owner": {"reputation": 25144, "user_id": 477476, "user_type": "registered", "accept_rate": 85, "profile_image": "https://i.stack.imgur.com/Qf4TT.png?s=128&g=1", "display_name": "Cactus", "link": "https://stackoverflow.com/users/477476/cactus"}, "reply_to_user": {"reputation": 43759, "user_id": 1651941, "user_type": "registered", "accept_rate": 97, "profile_image": "https://www.gravatar.com/avatar/a513bc1fa519d2fcf5e4e0d9b5500101?s=128&d=identicon&r=PG", "display_name": "Sibi", "link": "https://stackoverflow.com/users/1651941/sibi"}, "edited": false, "score": 0, "creation_date": 1463027095, "post_id": 37176145, "comment_id": 61888750, "body": "@Sibi: note that it&#39;s available as a <a href=\"https://www.gnu.org/software/emacs/manual/html_node/emacs/Easy-Customization.html\" rel=\"nofollow noreferrer\">customization variable</a> so you can use the customization framework instead of setting it directly via <code>setq</code>."}, {"owner": {"reputation": 44013, "user_id": 1477667, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/trgKM.jpg?s=128&g=1", "display_name": "dfeuer", "link": "https://stackoverflow.com/users/1477667/dfeuer"}, "edited": false, "score": 2, "creation_date": 1463031468, "post_id": 37176145, "comment_id": 61890234, "body": "I very much prefer two spaces because I tend to run out of horizontal space. I also indent the keyword <code>where</code> two spaces and the bindings in its clause another two."}, {"owner": {"reputation": 12070, "user_id": 5044950, "user_type": "registered", "accept_rate": 83, "profile_image": "https://i.stack.imgur.com/9yN0x.jpg?s=128&g=1", "display_name": "Sam Estep", "link": "https://stackoverflow.com/users/5044950/sam-estep"}, "reply_to_user": {"reputation": 43759, "user_id": 1651941, "user_type": "registered", "accept_rate": 97, "profile_image": "https://www.gravatar.com/avatar/a513bc1fa519d2fcf5e4e0d9b5500101?s=128&d=identicon&r=PG", "display_name": "Sibi", "link": "https://stackoverflow.com/users/1651941/sibi"}, "edited": false, "score": 0, "creation_date": 1463053395, "post_id": 37176145, "comment_id": 61904438, "body": "@Sibi I tried that and it didn&#39;t seem to change anything."}, {"owner": {"reputation": 12070, "user_id": 5044950, "user_type": "registered", "accept_rate": 83, "profile_image": "https://i.stack.imgur.com/9yN0x.jpg?s=128&g=1", "display_name": "Sam Estep", "link": "https://stackoverflow.com/users/5044950/sam-estep"}, "reply_to_user": {"reputation": 25144, "user_id": 477476, "user_type": "registered", "accept_rate": 85, "profile_image": "https://i.stack.imgur.com/Qf4TT.png?s=128&g=1", "display_name": "Cactus", "link": "https://stackoverflow.com/users/477476/cactus"}, "edited": false, "score": 2, "creation_date": 1463053573, "post_id": 37176145, "comment_id": 61904566, "body": "@Cactus I like to version my <code>~&#47;.emacs.el</code> file, and I&#39;ve found that the &quot;easy customization&quot; in Emacs doesn&#39;t play very nicely with source control."}, {"owner": {"reputation": 100892, "user_id": 745903, "user_type": "registered", "accept_rate": 74, "profile_image": "https://www.gravatar.com/avatar/50933f6638836741e620669b3940410e?s=128&d=identicon&r=PG", "display_name": "leftaroundabout", "link": "https://stackoverflow.com/users/745903/leftaroundabout"}, "edited": false, "score": 2, "creation_date": 1463061943, "post_id": 37176145, "comment_id": 61911250, "body": "I daresay the Haskell community is pretty relaxed with regard to indentation consistency. Which is good IMO: this really isn&#39;t something that should matter much\u2020 if the code is structured in a properly modular fashion. I personally tend to indent <code>where</code> only one space, <code>do</code> blocks three spaces, and everything else as much as seems to give the best readability for the given circumstances. \u2014 \u2020What&#39;s important, of course, is that you indent <i>correctly</i> (otherwise Haskell code won&#39;t compile anyway), and that you only use spaces, not tabs (about which modern GHC will give a warning)."}, {"owner": {"reputation": 12070, "user_id": 5044950, "user_type": "registered", "accept_rate": 83, "profile_image": "https://i.stack.imgur.com/9yN0x.jpg?s=128&g=1", "display_name": "Sam Estep", "link": "https://stackoverflow.com/users/5044950/sam-estep"}, "reply_to_user": {"reputation": 100892, "user_id": 745903, "user_type": "registered", "accept_rate": 74, "profile_image": "https://www.gravatar.com/avatar/50933f6638836741e620669b3940410e?s=128&d=identicon&r=PG", "display_name": "leftaroundabout", "link": "https://stackoverflow.com/users/745903/leftaroundabout"}, "edited": false, "score": 0, "creation_date": 1463062617, "post_id": 37176145, "comment_id": 61911834, "body": "@leftaroundabout That makes sense, thanks. I suppose the reason I&#39;m asking is that recently, I&#39;ve mostly been working in Lisp, where indentation is just about the easiest thing in the world. So you&#39;re saying that there would be nothing wrong with me just using the default settings and going with that?"}], "answers": [{"comments": [{"owner": {"reputation": 12070, "user_id": 5044950, "user_type": "registered", "accept_rate": 83, "profile_image": "https://i.stack.imgur.com/9yN0x.jpg?s=128&g=1", "display_name": "Sam Estep", "link": "https://stackoverflow.com/users/5044950/sam-estep"}, "edited": false, "score": 1, "creation_date": 1463020841, "post_id": 37176347, "comment_id": 61887217, "body": "Thanks, but this doesn&#39;t fully answer my question. How should I change my Emacs configuration to be consistent with this indentation scheme?"}], "tags": [], "owner": {"reputation": 31, "user_id": 2695060, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/875a1ce473a73108b22056a5deef5a6b?s=128&d=identicon&r=PG&f=1", "display_name": "Nicholas Liskij", "link": "https://stackoverflow.com/users/2695060/nicholas-liskij"}, "is_accepted": false, "score": 0, "last_activity_date": 1463020774, "creation_date": 1463020774, "answer_id": 37176347, "question_id": 37176145, "link": "https://stackoverflow.com/questions/37176145/is-haskell-modes-default-indentation-setup-ok/37176347#37176347", "title": "Is Haskell Mode&#39;s default indentation setup OK?", "body": "<p>You can look at some major projects developed in haskell like <a href=\"https://github.com/aslatter/parsec\" rel=\"nofollow\">parsec</a>. In the case of parsec, it seems that they use <a href=\"https://github.com/aslatter/parsec/blob/6cddf3c4f37c12abd1b2072f977d6243b16bfff9/Text/Parsec/Error.hs\" rel=\"nofollow\">four spaces for guards</a>. </p>\n"}, {"tags": [], "owner": {"reputation": 1, "user_id": 6922385, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/GcT5J.jpg?s=128&g=1", "display_name": "Zach Schuermann", "link": "https://stackoverflow.com/users/6922385/zach-schuermann"}, "is_accepted": false, "score": 0, "last_activity_date": 1546547706, "creation_date": 1546547706, "answer_id": 54029427, "question_id": 37176145, "link": "https://stackoverflow.com/questions/37176145/is-haskell-modes-default-indentation-setup-ok/54029427#54029427", "title": "Is Haskell Mode&#39;s default indentation setup OK?", "body": "<p>Here is something I found useful and included in my <code>init.el</code> file (or similar) to force haskell-mode to use four spaces per tab.</p>\n\n<pre><code>(defun haskell-setup ()\n    (make-local-variable 'tab-stop-list)\n    (setq tab-stop-list (number-sequence 0 120 4))\n    (setq indent-line-function 'tab-to-tab-stop)\n    (setq haskell-indent-spaces 4))\n\n(add-hook 'haskell-mode-hook 'haskell-setup)\n</code></pre>\n"}], "owner": {"reputation": 12070, "user_id": 5044950, "user_type": "registered", "accept_rate": 83, "profile_image": "https://i.stack.imgur.com/9yN0x.jpg?s=128&g=1", "display_name": "Sam Estep", "link": "https://stackoverflow.com/users/5044950/sam-estep"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 757, "favorite_count": 0, "answer_count": 2, "score": 3, "last_activity_date": 1546547706, "creation_date": 1463019312, "last_edit_date": 1463058446, "question_id": 37176145, "link": "https://stackoverflow.com/questions/37176145/is-haskell-modes-default-indentation-setup-ok", "title": "Is Haskell Mode&#39;s default indentation setup OK?", "body": "<p>I'm learning Haskell through, appropriately enough, the <a href=\"http://learnyouahaskell.com/\" rel=\"nofollow\">Learn You a Haskell</a> book. Up until the <a href=\"http://learnyouahaskell.com/syntax-in-functions#guards-guards\" rel=\"nofollow\">section on guards</a>, none of the code examples have been indented, and I'm wondering how I should properly indent my Haskell code going forward.</p>\n\n<p>The book indents the guard lines in the <code>bmiTell</code> function with four spaces:</p>\n\n<pre><code>bmiTell :: (RealFloat a) =&gt; a -&gt; String\nbmiTell bmi\n    | bmi &lt;= 18.5 = \"You're underweight, you emo, you!\"\n    | bmi &lt;= 25.0 = \"You're supposedly normal. Pffft, I bet you're ugly!\"\n    | bmi &lt;= 30.0 = \"You're fat! Lose some weight, fatty!\"\n    | otherwise   = \"You're a whale, congratulations!\"\n</code></pre>\n\n<p><a href=\"https://github.com/samestep/env/blob/b387fb91a300d9b13733b0f2289fbb6f8f95eff8/emacs.el#L231\" rel=\"nofollow\">Using Haskell Mode's default indentation settings</a>, I can toggle between zero spaces (which gives a compilation error) and two spaces (which seems to work fine) using <kbd>TAB</kbd> and <kbd>S-TAB</kbd>:</p>\n\n<pre><code>bmiTell :: (RealFloat a) =&gt; a -&gt; String\nbmiTell bmi\n  | bmi &lt;= 18.5 = \"You're underweight, you emo, you!\"\n  | bmi &lt;= 25.0 = \"You're supposedly normal. Pffft, I bet you're ugly!\"\n  | bmi &lt;= 30.0 = \"You're fat! Lose some weight, fatty!\"\n  | otherwise = \"You're a whale, congratulations!\"\n</code></pre>\n\n<p><a href=\"http://haskell.github.io/haskell-mode/manual/latest/Indentation.html#Indentation\" rel=\"nofollow\">The docs</a> make it seem like I shouldn't need to do anything in my Emacs config to get the recommended indentation settings, but after a bit of Googling, I haven't been able to find any code examples with two-space indentation. A search for \"Haskell style guide\" yields <a href=\"https://github.com/tibbe/haskell-style-guide/blob/master/haskell-style.md\" rel=\"nofollow\">this</a>, which recommends four-space indentation like that used in the book.</p>\n\n<p>Is Haskell Mode's default indentation behavior consistent with the way people commonly format their Haskell code? If not, how should I change my Emacs config to be consistent with the most popular indentation scheme?</p>\n\n<p><strong>Edit:</strong> Apparently, I was incorrect about indentation in previous examples. The <a href=\"http://learnyouahaskell.com/starting-out#babys-first-functions\" rel=\"nofollow\">first use of an <code>if</code> statement</a> is indented like this:</p>\n\n<pre><code>doubleSmallNumber x = if x &gt; 100\n                        then x\n                        else x*2\n</code></pre>\n\n<p>But I can't seem to get anything that looks like that using <kbd>TAB</kbd> and <kbd>S-TAB</kbd> in my current setup.</p>\n"}, {"tags": ["haskell", "types", "singleton-type"], "comments": [{"owner": {"reputation": 126897, "user_id": 791604, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/ce991df7a056248d5e4f6fc3659ba733?s=128&d=identicon&r=PG", "display_name": "Daniel Wagner", "link": "https://stackoverflow.com/users/791604/daniel-wagner"}, "edited": false, "score": 0, "creation_date": 1463025560, "post_id": 37175877, "comment_id": 61888345, "body": "I guess I&#39;m a bit confused: why have the <code>Tag</code> type at all? Are you looking for <code>type Tag = Either TagPrimitive TagComplex</code> (or possibly <code>data Tag = Primitive TagPrimitive | Complex TagComplex</code>) -- that is, a <i>single</i> type which can contain values of either the <code>TagPrimitive</code> or <code>TagComplex</code> types -- instead?"}, {"owner": {"reputation": 5821, "user_id": 1770201, "user_type": "registered", "accept_rate": 45, "profile_image": "https://www.gravatar.com/avatar/46bcb5d2018194c9beb884b6797e57e0?s=128&d=identicon&r=PG", "display_name": "George", "link": "https://stackoverflow.com/users/1770201/george"}, "reply_to_user": {"reputation": 126897, "user_id": 791604, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/ce991df7a056248d5e4f6fc3659ba733?s=128&d=identicon&r=PG", "display_name": "Daniel Wagner", "link": "https://stackoverflow.com/users/791604/daniel-wagner"}, "edited": false, "score": 0, "creation_date": 1463025627, "post_id": 37175877, "comment_id": 61888363, "body": "Yes, I was confused, and you&#39;re right. Is any one of these two alternatives that you mentioned more idiomatic?"}, {"owner": {"reputation": 126897, "user_id": 791604, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/ce991df7a056248d5e4f6fc3659ba733?s=128&d=identicon&r=PG", "display_name": "Daniel Wagner", "link": "https://stackoverflow.com/users/791604/daniel-wagner"}, "edited": false, "score": 0, "creation_date": 1463025754, "post_id": 37175877, "comment_id": 61888393, "body": "It depends on usage a bit. See also <a href=\"http://stackoverflow.com/q/19072930/791604\">this question</a> for some discussion of why you might prefer the custom <code>data</code> declaration."}], "answers": [{"tags": [], "owner": {"reputation": 25144, "user_id": 477476, "user_type": "registered", "accept_rate": 85, "profile_image": "https://i.stack.imgur.com/Qf4TT.png?s=128&g=1", "display_name": "Cactus", "link": "https://stackoverflow.com/users/477476/cactus"}, "is_accepted": false, "score": 7, "last_activity_date": 1463022633, "last_edit_date": 1463022633, "creation_date": 1463017918, "answer_id": 37175957, "question_id": 37175877, "link": "https://stackoverflow.com/questions/37175877/limiting-the-types-that-a-type-paramater-can-take-on-in-data-declarations/37175957#37175957", "title": "Limiting the Types that a Type Paramater Can Take On in Data Declarations", "body": "<p>You could use the usual, singleton-y approach:</p>\n\n<pre><code>{-# language GADTs #-}\n\ndata Taggable a where\n  Primitive : Taggable TagPrimitive\n  Complex : Taggable TagComplex\n</code></pre>\n\n<p>then define <code>Tag</code> as</p>\n\n<pre><code>data Tag a where\n  Tag : Taggable a -&gt; a -&gt; Tag a\n</code></pre>\n\n<p>then when you dispatch on the <code>a</code> of a given <code>Tag</code> value, you can just match on the singleton:</p>\n\n<pre><code> f :: Tag a -&gt; T\n f (Tag Primitive x) = ... - here, you know x :: TagPrimitive\n f (Tag Complex x) = ... -- here, you know x :: TagComplex\n</code></pre>\n\n<p>Or, as @rampion mentioned in a comment, you can fold <code>Taggable</code> into <code>Tag</code>, leaving you with</p>\n\n<pre><code>data Tag a where\n  Primitive :: TagPrimitive -&gt; Tag TagPrimitive\n  Complex :: TagComplex -&gt; Tag TagComplex\n</code></pre>\n"}, {"comments": [{"owner": {"reputation": 25144, "user_id": 477476, "user_type": "registered", "accept_rate": 85, "profile_image": "https://i.stack.imgur.com/Qf4TT.png?s=128&g=1", "display_name": "Cactus", "link": "https://stackoverflow.com/users/477476/cactus"}, "edited": false, "score": 0, "creation_date": 1463027163, "post_id": 37177072, "comment_id": 61888770, "body": "But this type doesn&#39;t tell you, statically, which one of <code>TagPrimitive</code> or <code>TagComplex</code> it wraps, which might be required by OP."}, {"owner": {"reputation": 126897, "user_id": 791604, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/ce991df7a056248d5e4f6fc3659ba733?s=128&d=identicon&r=PG", "display_name": "Daniel Wagner", "link": "https://stackoverflow.com/users/791604/daniel-wagner"}, "reply_to_user": {"reputation": 25144, "user_id": 477476, "user_type": "registered", "accept_rate": 85, "profile_image": "https://i.stack.imgur.com/Qf4TT.png?s=128&g=1", "display_name": "Cactus", "link": "https://stackoverflow.com/users/477476/cactus"}, "edited": false, "score": 1, "creation_date": 1463027274, "post_id": 37177072, "comment_id": 61888794, "body": "@Cactus Correct. Which is why I wrote a comment on the question asking about that before writing this answer. But as I point out in the first paragraph: the <code>TagPrimitive</code> and <code>TagComplex</code> types themselves <i>do</i> make that guarantee, statically, about which one they are!"}], "tags": [], "owner": {"reputation": 126897, "user_id": 791604, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/ce991df7a056248d5e4f6fc3659ba733?s=128&d=identicon&r=PG", "display_name": "Daniel Wagner", "link": "https://stackoverflow.com/users/791604/daniel-wagner"}, "is_accepted": true, "score": 4, "last_activity_date": 1463026066, "last_edit_date": 1495539848, "creation_date": 1463026066, "answer_id": 37177072, "question_id": 37175877, "link": "https://stackoverflow.com/questions/37175877/limiting-the-types-that-a-type-paramater-can-take-on-in-data-declarations/37177072#37177072", "title": "Limiting the Types that a Type Paramater Can Take On in Data Declarations", "body": "<p>Your proposed <code>Tag</code> type is a bit odd: it is a parameterized type which may be either specialized to a type that can <em>only</em> contain <code>TagPrimitive</code>s <em>or</em> may be specialized to a type that can <em>only</em> contain <code>TagComplex</code>s. But this seems a bit pointless: we already have the two specialized types <code>TagPrimitive</code> and <code>TagComplex</code> to serve these two roles.</p>\n\n<p>Instead, I propose that what you actually wanted was a single type that can contain values of either type. For this I recommend cooking up a fresh sum type:</p>\n\n<pre><code>data Tag = Primitive TagPrimitive | Complex TagComplex\n    deriving (Eq, Ord, Read, Show)\n</code></pre>\n\n<p>For early prototypes, you might get away with using the canonical sum type, <code>Either</code>, as in</p>\n\n<pre><code>type Tag = Either TagPrimitive TagComplex\n</code></pre>\n\n<p>but I suspect that as your program grows, this will become an <a href=\"https://stackoverflow.com/q/19072930/791604\">increasingly bad choice</a>.</p>\n"}], "owner": {"reputation": 5821, "user_id": 1770201, "user_type": "registered", "accept_rate": 45, "profile_image": "https://www.gravatar.com/avatar/46bcb5d2018194c9beb884b6797e57e0?s=128&d=identicon&r=PG", "display_name": "George", "link": "https://stackoverflow.com/users/1770201/george"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 62, "favorite_count": 0, "accepted_answer_id": 37177072, "answer_count": 2, "score": 0, "last_activity_date": 1463026066, "creation_date": 1463017194, "last_edit_date": 1463017938, "question_id": 37175877, "link": "https://stackoverflow.com/questions/37175877/limiting-the-types-that-a-type-paramater-can-take-on-in-data-declarations", "title": "Limiting the Types that a Type Paramater Can Take On in Data Declarations", "body": "<p>I'm aware that Haskell has paramaterized data types:</p>\n\n<pre><code>data Maybe a = Nothing | Just a\n</code></pre>\n\n<p>But is there a way to limit the sort of types that <code>a</code> can denote? In particular, I'd like to create a type</p>\n\n<pre><code>data Tag a = Tag a\n</code></pre>\n\n<p>such that <code>a</code> can take <em>either</em> the type <code>TagPrimitive</code> <em>or</em> the type <code>TagComplex</code> (however, I don't want it to be possible that <code>a</code> is of type, say, <code>Integer</code> or <code>String</code> or something that makes no sense in my program).</p>\n\n<p>Is this possible?</p>\n"}, {"tags": ["haskell", "cabal", "haskell-stack"], "comments": [{"owner": {"reputation": 49959, "user_id": 866915, "user_type": "registered", "accept_rate": 70, "profile_image": "https://www.gravatar.com/avatar/09242131d6e17cbbe31e8547514da6e5?s=128&d=identicon&r=PG", "display_name": "ErikR", "link": "https://stackoverflow.com/users/866915/erikr"}, "edited": false, "score": 7, "creation_date": 1463018562, "post_id": 37175822, "comment_id": 61886645, "body": "Try adding a comma between dependencies, e.g. <code>base &gt;= 4.7 &amp;&amp; &lt; 5, zeromq-haskell</code> - even if they are on different lines."}, {"owner": {"reputation": 126897, "user_id": 791604, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/ce991df7a056248d5e4f6fc3659ba733?s=128&d=identicon&r=PG", "display_name": "Daniel Wagner", "link": "https://stackoverflow.com/users/791604/daniel-wagner"}, "reply_to_user": {"reputation": 49959, "user_id": 866915, "user_type": "registered", "accept_rate": 70, "profile_image": "https://www.gravatar.com/avatar/09242131d6e17cbbe31e8547514da6e5?s=128&d=identicon&r=PG", "display_name": "ErikR", "link": "https://stackoverflow.com/users/866915/erikr"}, "edited": false, "score": 3, "creation_date": 1463026690, "post_id": 37175822, "comment_id": 61888629, "body": "@ErikR That&#39;s not a comment, that&#39;s an answer!"}], "answers": [{"comments": [{"owner": {"reputation": 3231, "user_id": 1013393, "user_type": "registered", "accept_rate": 60, "profile_image": "https://www.gravatar.com/avatar/7bca51e5ae3eb8dc24a98616b4e5d6fd?s=128&d=identicon&r=PG", "display_name": "sjakobi", "link": "https://stackoverflow.com/users/1013393/sjakobi"}, "edited": false, "score": 0, "creation_date": 1463087413, "post_id": 37178736, "comment_id": 61927301, "body": "Some fields like <code>exposed-modules</code> and <code>extra-source-files</code> <i>can</i> at least be whitespace-separated. I&#39;m not sure whether there are any fields that <i>must</i> be whitespace-separated though\u2026"}, {"owner": {"reputation": 3231, "user_id": 1013393, "user_type": "registered", "accept_rate": 60, "profile_image": "https://www.gravatar.com/avatar/7bca51e5ae3eb8dc24a98616b4e5d6fd?s=128&d=identicon&r=PG", "display_name": "sjakobi", "link": "https://stackoverflow.com/users/1013393/sjakobi"}, "edited": false, "score": 0, "creation_date": 1463088088, "post_id": 37178736, "comment_id": 61927635, "body": "^ The complicated syntax rules of cabal files are one reason why I use <code>hpack</code> for new projects. With <code>hpack</code> I can define the project&#39;s metadata in <code>yaml</code> syntax instead."}], "tags": [], "owner": {"reputation": 94713, "user_id": 1139697, "user_type": "registered", "accept_rate": 86, "profile_image": "https://www.gravatar.com/avatar/5f136ddb684f39aaee1c028ee1950f6f?s=128&d=identicon&r=PG", "display_name": "Zeta", "link": "https://stackoverflow.com/users/1139697/zeta"}, "is_accepted": true, "score": 2, "last_activity_date": 1463034058, "creation_date": 1463034058, "answer_id": 37178736, "question_id": 37175822, "link": "https://stackoverflow.com/questions/37175822/adding-dependency-parse-error/37178736#37178736", "title": "Adding Dependency - Parse Error", "body": "<p>Any list in a cabal file must be comma separated, not whitespace separated. The rules concerning <code>.cabal</code> files <a href=\"https://www.haskell.org/cabal/users-guide/developing-packages.html#package-descriptions\" rel=\"nofollow\">are listed in the user guide</a>*:</p>\n\n<pre><code>library\n  hs-source-dirs:      src\n  exposed-modules:     Lib\n  build-depends:       base &gt;= 4.7 &amp;&amp; &lt; 5,\n                       zeromq4-haskell\n  default-language:    Haskell2010\n</code></pre>\n\n<p><sub>* Funny enough, the definition of a <code>x list</code> is missing there.</sub></p>\n"}], "owner": {"reputation": 37991, "user_id": 409976, "user_type": "registered", "accept_rate": 68, "profile_image": "https://www.gravatar.com/avatar/9ccda0b49cc974197399eae01ebd6850?s=128&d=identicon&r=PG", "display_name": "Kevin Meredith", "link": "https://stackoverflow.com/users/409976/kevin-meredith"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 206, "favorite_count": 0, "accepted_answer_id": 37178736, "answer_count": 1, "score": 0, "last_activity_date": 1463094829, "creation_date": 1463016807, "last_edit_date": 1463094829, "question_id": 37175822, "link": "https://stackoverflow.com/questions/37175822/adding-dependency-parse-error", "title": "Adding Dependency - Parse Error", "body": "<p>After creating a new project:</p>\n\n<pre><code>$cd myproject\n$stack new workbench\n$cd workbench/\n$stack setup\n</code></pre>\n\n<p>I attempted to add this ZeroMQ library by updating my <code>workbench.cabal</code>:</p>\n\n<pre><code>$cat workbench.cabal \nname:                workbench\n\n...\n\nlibrary\n  hs-source-dirs:      src\n  exposed-modules:     Lib\n  build-depends:       base &gt;= 4.7 &amp;&amp; &lt; 5    # my note: line 19\n                       zeromq4-haskell\n  default-language:    Haskell2010\n</code></pre>\n\n<p>But, I get the following when running <code>stack clean</code>:</p>\n\n<pre><code>$stack clean\nUnable to parse cabal file .../workbench/workbench.cabal: NoParse \"build-depends\" 19\n</code></pre>\n\n<p>What am I doing wrong?</p>\n"}, {"tags": ["algorithm", "haskell", "binary-tree"], "comments": [{"owner": {"reputation": 384463, "user_id": 1126841, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/fa05233b2357f8d11c22ef4cfc7bb85c?s=128&d=identicon&r=PG", "display_name": "chepner", "link": "https://stackoverflow.com/users/1126841/chepner"}, "edited": false, "score": 0, "creation_date": 1463013622, "post_id": 37175350, "comment_id": 61885474, "body": "<code>take k (inorder f [] tree)</code>, where <code>f</code> is a function that produces a list containing in-order traversal of the tree."}, {"owner": {"reputation": 126897, "user_id": 791604, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/ce991df7a056248d5e4f6fc3659ba733?s=128&d=identicon&r=PG", "display_name": "Daniel Wagner", "link": "https://stackoverflow.com/users/791604/daniel-wagner"}, "reply_to_user": {"reputation": 384463, "user_id": 1126841, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/fa05233b2357f8d11c22ef4cfc7bb85c?s=128&d=identicon&r=PG", "display_name": "chepner", "link": "https://stackoverflow.com/users/1126841/chepner"}, "edited": false, "score": 2, "creation_date": 1463013857, "post_id": 37175350, "comment_id": 61885528, "body": "@chepner I think <code>inorder</code> as written will always traverse the entire tree. Obviously it would be desirable to write a &quot;better&quot; <code>inorder</code> function which can avoid doing so when its <code>f</code> is sufficiently lazy; the question here as I see it is about how."}, {"owner": {"reputation": 14050, "user_id": 3772221, "user_type": "registered", "accept_rate": 97, "profile_image": "https://i.stack.imgur.com/xfx4l.png?s=128&g=1", "display_name": "m0meni", "link": "https://stackoverflow.com/users/3772221/m0meni"}, "reply_to_user": {"reputation": 384463, "user_id": 1126841, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/fa05233b2357f8d11c22ef4cfc7bb85c?s=128&d=identicon&r=PG", "display_name": "chepner", "link": "https://stackoverflow.com/users/1126841/chepner"}, "edited": false, "score": 0, "creation_date": 1463013858, "post_id": 37175350, "comment_id": 61885529, "body": "@chepner that doesn&#39;t break early though. I thought that would work as well and that inorder would evaluate lazily, but it didn&#39;t seem to the case when I did <code>take 1 (inorder (:) [] testTree)</code>."}], "answers": [{"comments": [{"owner": {"reputation": 44013, "user_id": 1477667, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/trgKM.jpg?s=128&g=1", "display_name": "dfeuer", "link": "https://stackoverflow.com/users/1477667/dfeuer"}, "edited": false, "score": 0, "creation_date": 1463015240, "post_id": 37175523, "comment_id": 61885819, "body": "This, however, is potentially inefficient because left-associated appends can stack up. You can fix that by passing a different <code>f</code> (this is basically a catamorphism approach, and likely involves <code>Endo</code> in some fashion). Alternatively, and strictly less generally, you can use a <code>Foldable</code>-style approach by passing right children down to the left children."}, {"owner": {"reputation": 126897, "user_id": 791604, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/ce991df7a056248d5e4f6fc3659ba733?s=128&d=identicon&r=PG", "display_name": "Daniel Wagner", "link": "https://stackoverflow.com/users/791604/daniel-wagner"}, "reply_to_user": {"reputation": 44013, "user_id": 1477667, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/trgKM.jpg?s=128&g=1", "display_name": "dfeuer", "link": "https://stackoverflow.com/users/1477667/dfeuer"}, "edited": false, "score": 0, "creation_date": 1463015572, "post_id": 37175523, "comment_id": 61885876, "body": "@dfeuer Updated with an append-less solution using the same <code>anyOldOrder</code> function."}, {"owner": {"reputation": 14050, "user_id": 3772221, "user_type": "registered", "accept_rate": 97, "profile_image": "https://i.stack.imgur.com/xfx4l.png?s=128&g=1", "display_name": "m0meni", "link": "https://stackoverflow.com/users/3772221/m0meni"}, "edited": false, "score": 0, "creation_date": 1463016152, "post_id": 37175523, "comment_id": 61885991, "body": "@DanielWagner your edit is way over my head. Anywhere I can go to do more reading on what&#39;s actually happening because it does not &quot;look simple&quot; haha."}, {"owner": {"reputation": 126897, "user_id": 791604, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/ce991df7a056248d5e4f6fc3659ba733?s=128&d=identicon&r=PG", "display_name": "Daniel Wagner", "link": "https://stackoverflow.com/users/791604/daniel-wagner"}, "reply_to_user": {"reputation": 14050, "user_id": 3772221, "user_type": "registered", "accept_rate": 97, "profile_image": "https://i.stack.imgur.com/xfx4l.png?s=128&g=1", "display_name": "m0meni", "link": "https://stackoverflow.com/users/3772221/m0meni"}, "edited": false, "score": 0, "creation_date": 1463016707, "post_id": 37175523, "comment_id": 61886113, "body": "@AR7 Yeah, the &quot;looks pretty simple&quot; comment was a bit tongue-in-cheek. =) As for what&#39;s actually happening -- perhaps it is best to direct you at <a href=\"https://wiki.haskell.org/All_About_Monads\" rel=\"nofollow noreferrer\">All About Monads</a>, which as I recall has an excellent section on the <code>State</code> and <code>Maybe</code> monads. If you&#39;re comfortable with those and still not sure what&#39;s going on, please feel free to ask a more precise question and I&#39;ll be glad to try to explain or otherwise help you understand."}, {"owner": {"reputation": 14050, "user_id": 3772221, "user_type": "registered", "accept_rate": 97, "profile_image": "https://i.stack.imgur.com/xfx4l.png?s=128&g=1", "display_name": "m0meni", "link": "https://stackoverflow.com/users/3772221/m0meni"}, "edited": false, "score": 0, "creation_date": 1463016968, "post_id": 37175523, "comment_id": 61886184, "body": "@DanielWagner I think I generally do understand monads, but I&#39;d definitely have to do some more reading before asking specifics. I think before I get to that, I&#39;m wondering how the switch to passing f the arguments makes it lazy. Could you explain what exactly about the arguments being passed to f caused the function to switch to being lazy?"}, {"owner": {"reputation": 126897, "user_id": 791604, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/ce991df7a056248d5e4f6fc3659ba733?s=128&d=identicon&r=PG", "display_name": "Daniel Wagner", "link": "https://stackoverflow.com/users/791604/daniel-wagner"}, "reply_to_user": {"reputation": 14050, "user_id": 3772221, "user_type": "registered", "accept_rate": 97, "profile_image": "https://i.stack.imgur.com/xfx4l.png?s=128&g=1", "display_name": "m0meni", "link": "https://stackoverflow.com/users/3772221/m0meni"}, "edited": false, "score": 1, "creation_date": 1463023781, "post_id": 37175523, "comment_id": 61887927, "body": "@AR7 With <code>go (Node v l r) z = go r (f v (go l z))</code>, the outermost call is a recursive call to <code>go</code>, hence has no choice but to recurse (and therefore inspect the subtree and, by induction, every node along the right spine). On the other hand, with <code>go (Node v l r) = f v (go l) (go r)</code>, the outermost call is a <i>non</i>-recursive call to <code>f</code>. This means it is <code>f</code> -- and not <code>go</code> -- which is driving the evaluation, and may choose how much of the tree to inspect. In particular it may choose not to use the values produced by the recursive calls to <code>go l</code> and <code>go r</code>, hence never actually compute them."}, {"owner": {"reputation": 126897, "user_id": 791604, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/ce991df7a056248d5e4f6fc3659ba733?s=128&d=identicon&r=PG", "display_name": "Daniel Wagner", "link": "https://stackoverflow.com/users/791604/daniel-wagner"}, "reply_to_user": {"reputation": 14050, "user_id": 3772221, "user_type": "registered", "accept_rate": 97, "profile_image": "https://i.stack.imgur.com/xfx4l.png?s=128&g=1", "display_name": "m0meni", "link": "https://stackoverflow.com/users/3772221/m0meni"}, "edited": false, "score": 1, "creation_date": 1463023946, "post_id": 37175523, "comment_id": 61887970, "body": "@AR7 ...continuing the previous comment, note that in particular with your definition, <code>go (Node v l r) z = go r (f v (go l z))</code>, you do still get <i>some</i> laziness available: since the &quot;next outermost&quot; call after <code>go</code> is to <code>f</code>, it is possible for <code>f</code> to ignore left subtrees -- but this is not as general as you really want for many applications."}, {"owner": {"reputation": 14050, "user_id": 3772221, "user_type": "registered", "accept_rate": 97, "profile_image": "https://i.stack.imgur.com/xfx4l.png?s=128&g=1", "display_name": "m0meni", "link": "https://stackoverflow.com/users/3772221/m0meni"}, "edited": false, "score": 0, "creation_date": 1463037242, "post_id": 37175523, "comment_id": 61893155, "body": "@DanielWagner is there any way to make flatten work with <code>:</code> instead of <code>++</code> I&#39;ve been trying to think of a way, but none of them have worked."}, {"owner": {"reputation": 14050, "user_id": 3772221, "user_type": "registered", "accept_rate": 97, "profile_image": "https://i.stack.imgur.com/xfx4l.png?s=128&g=1", "display_name": "m0meni", "link": "https://stackoverflow.com/users/3772221/m0meni"}, "edited": false, "score": 0, "creation_date": 1463067039, "post_id": 37175523, "comment_id": 61915299, "body": "@DanielWagner also is there some kind of idiomatic way to do this? I&#39;m just curious if there&#39;s a definitive solution that&#39;s not based on my original code or what you put in your answer."}, {"owner": {"reputation": 126897, "user_id": 791604, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/ce991df7a056248d5e4f6fc3659ba733?s=128&d=identicon&r=PG", "display_name": "Daniel Wagner", "link": "https://stackoverflow.com/users/791604/daniel-wagner"}, "reply_to_user": {"reputation": 14050, "user_id": 3772221, "user_type": "registered", "accept_rate": 97, "profile_image": "https://i.stack.imgur.com/xfx4l.png?s=128&g=1", "display_name": "m0meni", "link": "https://stackoverflow.com/users/3772221/m0meni"}, "edited": false, "score": 1, "creation_date": 1463067157, "post_id": 37175523, "comment_id": 61915387, "body": "@AR7 Both defining a catamorphism (my <code>anyOldOrder</code>) and deriving <code>Foldable</code> as in dfeuer&#39;s answer are idiomatic. I&#39;m not sure what your question about <code>:</code> vs <code>++</code> means. And by the way, you absolutely should steal the idea of using <a href=\"https://wiki.haskell.org/Difference_list\" rel=\"nofollow noreferrer\">difference lists</a> instead of plain lists to implement <code>flatten</code> (as dfeuer does in his answer) -- I used lists only to make code that was as plain and readable as possible, but he is correct to point out that this sacrifices efficiency."}, {"owner": {"reputation": 14050, "user_id": 3772221, "user_type": "registered", "accept_rate": 97, "profile_image": "https://i.stack.imgur.com/xfx4l.png?s=128&g=1", "display_name": "m0meni", "link": "https://stackoverflow.com/users/3772221/m0meni"}, "edited": false, "score": 0, "creation_date": 1463067459, "post_id": 37175523, "comment_id": 61915596, "body": "@DanielWagner ah well I&#39;ve just read that you generally want to avoid <code>++</code> and use <code>:</code> when you can instead for performance reasons, but I when I tried to figure out how to use <code>:</code> to put together the list using <code>anyOldOrder</code> I wasn&#39;t able to do it any way at all."}, {"owner": {"reputation": 126897, "user_id": 791604, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/ce991df7a056248d5e4f6fc3659ba733?s=128&d=identicon&r=PG", "display_name": "Daniel Wagner", "link": "https://stackoverflow.com/users/791604/daniel-wagner"}, "reply_to_user": {"reputation": 14050, "user_id": 3772221, "user_type": "registered", "accept_rate": 97, "profile_image": "https://i.stack.imgur.com/xfx4l.png?s=128&g=1", "display_name": "m0meni", "link": "https://stackoverflow.com/users/3772221/m0meni"}, "edited": false, "score": 1, "creation_date": 1463067617, "post_id": 37175523, "comment_id": 61915716, "body": "@AR7 I have updated my answer to include a comment about using difference lists to implement <code>flatten</code>. Perhaps this will address your efficiency concerns."}, {"owner": {"reputation": 14050, "user_id": 3772221, "user_type": "registered", "accept_rate": 97, "profile_image": "https://i.stack.imgur.com/xfx4l.png?s=128&g=1", "display_name": "m0meni", "link": "https://stackoverflow.com/users/3772221/m0meni"}, "edited": false, "score": 0, "creation_date": 1463067870, "post_id": 37175523, "comment_id": 61915895, "body": "@DanielWagner awesome that&#39;s exactly what I wanted. I got pretty close to that, but not quite. One last question: what&#39;s the point of doing <code>id t</code> instead of just <code>t</code>? Doesn&#39;t that just return <code>t</code>?"}, {"owner": {"reputation": 126897, "user_id": 791604, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/ce991df7a056248d5e4f6fc3659ba733?s=128&d=identicon&r=PG", "display_name": "Daniel Wagner", "link": "https://stackoverflow.com/users/791604/daniel-wagner"}, "reply_to_user": {"reputation": 14050, "user_id": 3772221, "user_type": "registered", "accept_rate": 97, "profile_image": "https://i.stack.imgur.com/xfx4l.png?s=128&g=1", "display_name": "m0meni", "link": "https://stackoverflow.com/users/3772221/m0meni"}, "edited": false, "score": 1, "creation_date": 1463068395, "post_id": 37175523, "comment_id": 61916320, "body": "@AR7 At no point do I call <code>id t</code>! Because it&#39;s a nice puzzle and a nice technique that you may enjoy exploring yourself, I&#39;ll let you ponder that for a bit and include the spoilers rot13&#39;d: V nz npghnyyl cnffvat <code>vq</code> nf gur <code>m</code> nethzrag gb <code>nalByqBeqre</code>, juvpu vf hfrq gb fgnaq va sbe <code>Yrns</code>f. Gur erfhyg bs gur jubyr sbyq vf n shapgvba juvpu gnxrf n yvfg naq cercraqf gur inyhr bs gur va-beqre genirefny gb gung yvfg."}, {"owner": {"reputation": 14050, "user_id": 3772221, "user_type": "registered", "accept_rate": 97, "profile_image": "https://i.stack.imgur.com/xfx4l.png?s=128&g=1", "display_name": "m0meni", "link": "https://stackoverflow.com/users/3772221/m0meni"}, "edited": false, "score": 0, "creation_date": 1463113471, "post_id": 37175523, "comment_id": 61934399, "body": "@DanielWagner ahhhhhhhh it&#39;s like a noop because composing id with a list prepend func yields the same list prepend! Much smarter than what I was trying to do. <code>id . (1:) . id $ [] == (1:) []</code> :O"}], "tags": [], "owner": {"reputation": 126897, "user_id": 791604, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/ce991df7a056248d5e4f6fc3659ba733?s=128&d=identicon&r=PG", "display_name": "Daniel Wagner", "link": "https://stackoverflow.com/users/791604/daniel-wagner"}, "is_accepted": true, "score": 5, "last_activity_date": 1463067977, "last_edit_date": 1463067977, "creation_date": 1463014220, "answer_id": 37175523, "question_id": 37175350, "link": "https://stackoverflow.com/questions/37175350/breaking-after-finding-the-kth-element-of-an-inorder-traversal-using-a-higher-or/37175523#37175523", "title": "Breaking after finding the kth element of an inorder traversal using a higher order traversal function", "body": "<p>I observe that the results of the recursive call to <code>go</code> on the left and right subtrees are not available to <code>f</code>; hence no matter what <code>f</code> does, it cannot choose to ignore the results of recursive calls. Therefore I believe that <code>inorder</code> as written will <em>always</em> walk over the entire tree. (<strong>edit</strong>: On review, this statement may be a bit strong; it seems <code>f</code> may have a chance to ignore left subtrees. But the point basically stands; there is no reason to elevate left subtrees over right subtrees in this way.)</p>\n\n<p>A better choice is to give the recursive calls to <code>f</code>. For example:</p>\n\n<pre><code>anyOldOrder :: (a -&gt; b -&gt; b -&gt; b) -&gt; b -&gt; BinaryTree a -&gt; b\nanyOldOrder f z = go where\n    go Leaf = z\n    go (Node v l r) = f v (go l) (go r)\n</code></pre>\n\n<p>Now when we write</p>\n\n<pre><code>flatten = anyOldOrder (\\v ls rs -&gt; ls ++ [v] ++ rs) []\n</code></pre>\n\n<p>we will find that <code>flatten</code> is sufficiently lazy:</p>\n\n<pre><code>&gt; take 3 (flatten (Node 'c' (Node 'b' (Node 'a' Leaf Leaf) Leaf) undefined))\n\"abc\"\n</code></pre>\n\n<p>(The <code>undefined</code> is used to provide evidence that this part of the tree is never inspected during the traversal.) Hence we may write</p>\n\n<pre><code>findK k = take 1 . reverse . take k . flatten\n</code></pre>\n\n<p>which will correctly short-circuit. You can make <code>flatten</code> slightly more efficient with the standard <a href=\"https://wiki.haskell.org/Difference_list\" rel=\"nofollow\">difference list</a> technique:</p>\n\n<pre><code>flatten' t = anyOldOrder (\\v l r -&gt; l . (v:) . r) id t []\n</code></pre>\n\n<p>Just for fun, I also want to show how to implement this function without using an accumulator list. Instead, we will produce a stateful computation which walks over the \"interesting\" part of the tree, stopping when it reaches the <code>k</code>th element. The stateful computation looks like this:</p>\n\n<pre><code>import Control.Applicative\nimport Control.Monad.State\nimport Control.Monad.Trans.Maybe\n\nkthElem k v l r = l &lt;|&gt; do\n    i &lt;- get\n    if i == k\n        then return v\n        else put (i+1) &gt;&gt; r\n</code></pre>\n\n<p>Looks pretty simple, hey? Now our <code>findK</code> function will farm out to <code>kthElem</code>, then do some newtype unwrapping:</p>\n\n<pre><code>findK' k = (`evalState` 1) . runMaybeT . anyOldOrder (kthElem 3) empty\n</code></pre>\n\n<p>We can verify that it is still as lazy as desired:</p>\n\n<pre><code>&gt; findK' 3 $ Node 'c' (Node 'b' (Node 'a' Leaf Leaf) Leaf) undefined\nJust 'c'\n</code></pre>\n"}, {"comments": [{"owner": {"reputation": 14050, "user_id": 3772221, "user_type": "registered", "accept_rate": 97, "profile_image": "https://i.stack.imgur.com/xfx4l.png?s=128&g=1", "display_name": "m0meni", "link": "https://stackoverflow.com/users/3772221/m0meni"}, "edited": false, "score": 0, "creation_date": 1463037191, "post_id": 37177393, "comment_id": 61893119, "body": "@dfeur doesn&#39;t &quot;treeToListThen&quot; need to traverse the entire tree?"}, {"owner": {"reputation": 2231, "user_id": 1027321, "user_type": "registered", "accept_rate": 70, "profile_image": "https://i.stack.imgur.com/KkFZC.jpg?s=128&g=1", "display_name": "jakubdaniel", "link": "https://stackoverflow.com/users/1027321/jakubdaniel"}, "edited": false, "score": 0, "creation_date": 1463044167, "post_id": 37177393, "comment_id": 61897766, "body": "It lazily constructs a list from left, you can stop producing new elements whenever you want, which means you have only traversed to the node that produced the last element you need and the call to <code>treeToListThen r more</code> is still pending. You have only collected &quot;stubs&quot; (or &quot;promises&quot;) for all the right branches (and parents), which you then choose not to evaluate, i.e. recurse into."}, {"owner": {"reputation": 126897, "user_id": 791604, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/ce991df7a056248d5e4f6fc3659ba733?s=128&d=identicon&r=PG", "display_name": "Daniel Wagner", "link": "https://stackoverflow.com/users/791604/daniel-wagner"}, "edited": false, "score": 0, "creation_date": 1463068111, "post_id": 37177393, "comment_id": 61916105, "body": "So, for posterity: I at first wanted to object that <code>treeToListThen</code> always recurses on its left branch and therefore forces the left spine of any node it visits (and therefore might reasonably be called less lazy than the catamorphism-based approach). However, after some more thought, it turns out this is no objection:  if we want the <code>k</code>th node from an inorder traversal, we have no choice but to lose at least that much laziness, no matter what implementation technique we choose."}, {"owner": {"reputation": 44013, "user_id": 1477667, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/trgKM.jpg?s=128&g=1", "display_name": "dfeuer", "link": "https://stackoverflow.com/users/1477667/dfeuer"}, "reply_to_user": {"reputation": 126897, "user_id": 791604, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/ce991df7a056248d5e4f6fc3659ba733?s=128&d=identicon&r=PG", "display_name": "Daniel Wagner", "link": "https://stackoverflow.com/users/791604/daniel-wagner"}, "edited": false, "score": 1, "creation_date": 1463069914, "post_id": 37177393, "comment_id": 61917368, "body": "@DanielWagner, the only way to fix that is to annotate nodes with their sizes."}], "tags": [], "owner": {"reputation": 44013, "user_id": 1477667, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/trgKM.jpg?s=128&g=1", "display_name": "dfeuer", "link": "https://stackoverflow.com/users/1477667/dfeuer"}, "is_accepted": false, "score": 4, "last_activity_date": 1463028730, "last_edit_date": 1463028730, "creation_date": 1463027937, "answer_id": 37177393, "question_id": 37175350, "link": "https://stackoverflow.com/questions/37175350/breaking-after-finding-the-kth-element-of-an-inorder-traversal-using-a-higher-or/37177393#37177393", "title": "Breaking after finding the kth element of an inorder traversal using a higher order traversal function", "body": "<p>There are (at least?) two important generalizations of the notion of <em>folding</em> a list. The first, more powerful, notion is that of a <em>catamorphism</em>. The <code>anyOldOrder</code> of Daniel Wagner's answer follows this pattern.</p>\n\n<p>But for your particular problem, the catamorphism notion is a bit more power than you need. The second, weaker, notion is that of a <code>Foldable</code> container. <code>Foldable</code> expresses the idea of a container whose elements can all be mashed together using the operation of an arbitrary <code>Monoid</code>. Here's a cute trick:</p>\n\n<pre><code>{-# LANGUAGE DeriveFoldable #-}\n\n-- Note that for this trick  only I've \n-- switched the order of the Node fields.\ndata BinaryTree a =\n  Node (BinaryTree a) a (BinaryTree a)\n  | Leaf\n  deriving (Show, Foldable)\n\nindex :: [a] -&gt; Int -&gt; Maybe a\n[] `index` _ = Nothing\n(x : _) `index` 0 = Just x\n(_ : xs) `index` i = xs `index` (i - 1)\n\n(!?) :: Foldable f =&gt; Int -&gt; f a -&gt; Maybe a\nxs !? i = toList xs `index` i\n</code></pre>\n\n<p>Then you can just use <code>!?</code> to index into your tree!</p>\n\n<hr>\n\n<p>That trick is cute, and in fact deriving <code>Foldable</code> is a tremendous convenience, but it won't help you understand anything. I'll start by showing how you can define <code>treeToList</code> fairly directly and efficiently, without using <code>Foldable</code>.</p>\n\n<pre><code>treeToList :: BinaryTree a -&gt; [a]\ntreeToList t = treeToListThen t []\n</code></pre>\n\n<p>The magic is in the <code>treeToListThen</code> function. <code>treeToListThen t more</code> converts <code>t</code> to a list and appends the list <code>more</code> to the end of the result. This slight generalization turns out to be all that's required to make conversion to a list efficient.</p>\n\n<pre><code>treeToListThen :: BinaryTree a -&gt; [a] -&gt; [a]\ntreeToListThen Leaf more = more\ntreeToListThen (Node v l r) more =\n  treeToListThen l $ v : treeToListThen r more\n</code></pre>\n\n<p>Instead of producing an inorder traversal of the left subtree and then appending everything else, we tell the left traversal what to stick on the end when it's done! This avoids the potentially serious inefficiency of repeated list concatenation that can turn things O(n^2) in bad cases.</p>\n\n<p>Getting back to the <code>Foldable</code> notion, turning things into lists is a special case of <code>foldr</code>:</p>\n\n<pre><code>toList = foldr (:) []\n</code></pre>\n\n<p>So how can we implement <code>foldr</code> for trees? It ends up being somewhat similar to what we did with <code>toList</code>:</p>\n\n<pre><code>foldrTree :: (a -&gt; b -&gt; b) -&gt; b -&gt; BinaryTree a -&gt; b\nfoldrTree _ n Leaf = n\nfoldrTree c n (Node v l r) = foldrTree c rest l\n  where\n    rest = v `c` foldrTree c n r\n</code></pre>\n\n<p>That is, when we go down the left side, we tell it that when it's done, it should deal with the current node and its right child.</p>\n\n<p>Now <code>foldr</code> isn't quite the most fundamental operation of <code>Foldable</code>; that is actually</p>\n\n<pre><code>foldMap :: (Foldable f, Monoid m)\n        =&gt; (a -&gt; m) -&gt; f a -&gt; m\n</code></pre>\n\n<p>It is possible to implement <code>foldr</code> using <code>foldMap</code>, in a somewhat tricky fashion using a peculiar <code>Monoid</code>. I don't want to overload you with details of that right now, unless you ask (but you should look at the default definition of <code>foldr</code> in <code>Data.Foldable</code>). Instead, I'll show how <code>foldMap</code> can be defined using Daniel Wagner's <code>anyOldOrder</code>:</p>\n\n<pre><code>instance Foldable BinaryTree where\n  foldMap f = anyOldOrder bin mempty where\n    bin lres v rres = lres &lt;&gt; f v &lt;&gt; rres\n</code></pre>\n"}], "owner": {"reputation": 14050, "user_id": 3772221, "user_type": "registered", "accept_rate": 97, "profile_image": "https://i.stack.imgur.com/xfx4l.png?s=128&g=1", "display_name": "m0meni", "link": "https://stackoverflow.com/users/3772221/m0meni"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 196, "favorite_count": 2, "accepted_answer_id": 37175523, "answer_count": 2, "score": 3, "last_activity_date": 1463067977, "creation_date": 1463012864, "question_id": 37175350, "link": "https://stackoverflow.com/questions/37175350/breaking-after-finding-the-kth-element-of-an-inorder-traversal-using-a-higher-or", "title": "Breaking after finding the kth element of an inorder traversal using a higher order traversal function", "body": "<p>I have the following code to do an inorder traversal of a Binary Tree:</p>\n\n<pre><code>data BinaryTree a =\n  Node a (BinaryTree a) (BinaryTree a)\n  | Leaf\n  deriving (Show)\n\ninorder :: (a -&gt; b -&gt; b) -&gt; b -&gt; BinaryTree a -&gt; b\ninorder f acc tree = go tree acc\n  where go Leaf z = z\n        go (Node v l r) z = (go r . f v . go l) z\n</code></pre>\n\n<p>Using the inorder function above I'd like to get the kth element without having to traverse the entire list.</p>\n\n<p>The traversal is a little like a fold given that you pass it a function and a starting value. I was thinking that I could solve it by passing <code>k</code> as the starting value, and a function that'll decrement <code>k</code> until it reaches 0 and at that point returns the value inside the current node.</p>\n\n<p>The problem I have is that I'm not quite sure how to <code>break</code> out of the recursion of inorder traversal short of modifying the whole function, but I feel like having to modify the higher order function ruins the point of using a higher order function in the first place.</p>\n\n<p>Is there a way to break after k iterations?</p>\n"}]