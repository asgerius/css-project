[{"tags": ["unit-testing", "haskell", "testing", "quickcheck", "test-framework"], "answers": [{"tags": [], "owner": {"reputation": 3040, "user_id": 4308453, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/fc596d8352ad2c4254536343139b5b82?s=128&d=identicon&r=PG&f=1", "display_name": "zakyggaps", "link": "https://stackoverflow.com/users/4308453/zakyggaps"}, "is_accepted": true, "score": 1, "last_activity_date": 1458816246, "creation_date": 1458816246, "answer_id": 36198292, "question_id": 36190852, "link": "https://stackoverflow.com/questions/36190852/haskell-test-framework-specify-number-of-tests-to-run-from-command-line/36198292#36198292", "title": "Haskell Test.Framework specify number of tests to run from command line", "body": "<p><code>defaultMainWithOpts</code> is not for command line usage: it ignores and suppresses all the command line options. For testing on command line you should use <code>defaultMain</code> and <code>--help</code> will tell you all the available options like:</p>\n\n<pre><code>Usage: cc-test [OPTIONS]\n                   --help                                       show this help message\n  -j NUMBER        --threads=NUMBER                             number of threads to use to run tests\n                   --test-seed=NUMBER|random                    default seed for test random number generator\n  -a NUMBER        --maximum-generated-tests=NUMBER             how many automated tests something like QuickCheck should try, by default\n                   --maximum-unsuitable-generated-tests=NUMBER  how many unsuitable candidate tests something like QuickCheck should endure before giving up, by default\n  -s NUMBER        --maximum-test-size=NUMBER                   to what size something like QuickCheck should test the properties, by default\n  -d NUMBER        --maximum-test-depth=NUMBER                  to what depth something like SmallCheck should test the properties, by default\n  -o NUMBER        --timeout=NUMBER                             how many seconds a test should be run for before giving up, by default\n                   --no-timeout                                 specifies that tests should be run without a timeout, by default\n  -l               --list-tests                                 list available tests but don't run any; useful to guide subsequent --select-tests\n  -t TEST-PATTERN  --select-tests=TEST-PATTERN                  only tests that match at least one glob pattern given by an instance of this argument will be run\n                   --jxml=FILE                                  write a JUnit XML summary of the output to FILE\n                   --jxml-nested                                use nested testsuites to represent groups in JUnit XML (not standards compliant)\n                   --plain                                      do not use any ANSI terminal features to display the test run\n                   --color                                      use ANSI terminal features to display the test run\n                   --hide-successes                             hide sucessful tests, and only show failures\n</code></pre>\n"}], "owner": {"reputation": 3023, "user_id": 1691145, "user_type": "registered", "accept_rate": 87, "profile_image": "https://www.gravatar.com/avatar/4b6744a17b41f3b0e5c7554a43a04094?s=128&d=identicon&r=PG", "display_name": "Justin Raymond", "link": "https://stackoverflow.com/users/1691145/justin-raymond"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 270, "favorite_count": 0, "accepted_answer_id": 36198292, "answer_count": 1, "score": 1, "last_activity_date": 1458816246, "creation_date": 1458776803, "question_id": 36190852, "link": "https://stackoverflow.com/questions/36190852/haskell-test-framework-specify-number-of-tests-to-run-from-command-line", "title": "Haskell Test.Framework specify number of tests to run from command line", "body": "<p>This <a href=\"http://haddock.stackage.org/lts-5.9/test-framework-0.8.1.1/Test-Framework-Options.html#t:TestOptions\" rel=\"nofollow\">documentation</a> implies that <code>Test.Framework</code> can be run with command line arguments. There is a function <code>defaultMain :: [Test] -&gt; IO ()</code> but also the function <code>defaultMainWithOpts :: [Test] -&gt; RunnerOptions -&gt; IO ()</code> which is</p>\n\n<blockquote>\n  <p>A version of <code>defaultMain</code> that lets you ignore the command line arguments in favour of an explicit set of <code>RunnerOptions</code>.</p>\n</blockquote>\n\n<p>I cannot find documentation on how to pass command line arguments, and the error message for unrecognized options only says \"unrecognized option\". So my question is how to pass the number of test cases to run from the command line when running <code>cabal test</code></p>\n"}, {"tags": ["haskell", "type-families", "data-kinds"], "comments": [{"owner": {"reputation": 13807, "user_id": 2407038, "user_type": "registered", "accept_rate": 64, "profile_image": "https://www.gravatar.com/avatar/538f6f4a9aa43841841de7d8e8b169fc?s=128&d=identicon&r=PG&f=1", "display_name": "user2407038", "link": "https://stackoverflow.com/users/2407038/user2407038"}, "edited": false, "score": 1, "creation_date": 1458784952, "post_id": 36190193, "comment_id": 60018706, "body": "It is telling you it is looking for an instance - putting that instance in the context will make it compile. You are trying to recursively apply the <code>toText</code> function, to a value of type <code>a</code>, so you need a constraint to prove that you can do so. You are trying to peform this unwrapping recursively, essentially."}, {"owner": {"reputation": 4185, "user_id": 986475, "user_type": "registered", "accept_rate": 89, "profile_image": "https://www.gravatar.com/avatar/dd36406ee6957594a633373c297a3ab1?s=128&d=identicon&r=PG", "display_name": "Sal", "link": "https://stackoverflow.com/users/986475/sal"}, "reply_to_user": {"reputation": 13807, "user_id": 2407038, "user_type": "registered", "accept_rate": 64, "profile_image": "https://www.gravatar.com/avatar/538f6f4a9aa43841841de7d8e8b169fc?s=128&d=identicon&r=PG&f=1", "display_name": "user2407038", "link": "https://stackoverflow.com/users/2407038/user2407038"}, "edited": false, "score": 0, "creation_date": 1458789435, "post_id": 36190193, "comment_id": 60019862, "body": "@user2407038, how would you express that constraint?"}, {"owner": {"reputation": 13807, "user_id": 2407038, "user_type": "registered", "accept_rate": 64, "profile_image": "https://www.gravatar.com/avatar/538f6f4a9aa43841841de7d8e8b169fc?s=128&d=identicon&r=PG&f=1", "display_name": "user2407038", "link": "https://stackoverflow.com/users/2407038/user2407038"}, "edited": false, "score": 1, "creation_date": 1458793389, "post_id": 36190193, "comment_id": 60020745, "body": "The constraint is literally <code>ToTextC a (Proxy (ToTextHow a))</code>."}, {"owner": {"reputation": 84731, "user_id": 510937, "user_type": "registered", "accept_rate": 80, "profile_image": "https://www.gravatar.com/avatar/70b13a9ae1aae1ca1aa6ac8dab4643f2?s=128&d=identicon&r=PG", "display_name": "Bakuriu", "link": "https://stackoverflow.com/users/510937/bakuriu"}, "edited": false, "score": 0, "creation_date": 1458827713, "post_id": 36190193, "comment_id": 60037105, "body": "Note: <code>UndecidableInstances</code> is <b>not</b> a &quot;bad&quot; extension. It simply tells the compiler to lift the restrictions that are placed to guarantee termination of type inference. So the worst thing that can happen is that when you try to compile your code you get the compiler stuck in an infinite loop instead of getting a type error telling you that no instance could be found."}, {"owner": {"reputation": 4185, "user_id": 986475, "user_type": "registered", "accept_rate": 89, "profile_image": "https://www.gravatar.com/avatar/dd36406ee6957594a633373c297a3ab1?s=128&d=identicon&r=PG", "display_name": "Sal", "link": "https://stackoverflow.com/users/986475/sal"}, "reply_to_user": {"reputation": 84731, "user_id": 510937, "user_type": "registered", "accept_rate": 80, "profile_image": "https://www.gravatar.com/avatar/70b13a9ae1aae1ca1aa6ac8dab4643f2?s=128&d=identicon&r=PG", "display_name": "Bakuriu", "link": "https://stackoverflow.com/users/510937/bakuriu"}, "edited": false, "score": 0, "creation_date": 1458828640, "post_id": 36190193, "comment_id": 60037755, "body": "@Bakuriu, yep, that is what I am wary about. Not a bad extension but possibility of not halting is there. So, exploring if there is a better way to tell the compiler about type-level computations."}], "owner": {"reputation": 4185, "user_id": 986475, "user_type": "registered", "accept_rate": 89, "profile_image": "https://www.gravatar.com/avatar/dd36406ee6957594a633373c297a3ab1?s=128&d=identicon&r=PG", "display_name": "Sal", "link": "https://stackoverflow.com/users/986475/sal"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 90, "favorite_count": 0, "answer_count": 0, "score": 1, "last_activity_date": 1458824856, "creation_date": 1458773318, "last_edit_date": 1495541724, "question_id": 36190193, "link": "https://stackoverflow.com/questions/36190193/overloading-show-method-for-maybe-types", "title": "Overloading show method for Maybe types", "body": "<p>This is followup to an earlier <a href=\"https://stackoverflow.com/questions/36161217/performing-type-equality-in-template-haskell\">question</a> I asked. Now, I am trying to modify the <code>toText</code> method so that it also handles <code>Maybe a</code> with overloaded <code>toText</code> function. Below is a code that compiles and works fine - now, I will like to overload <code>toText</code> for <code>Maybe a</code> using <code>toText</code> definition itself for other types:</p>\n\n<pre><code>{-# LANGUAGE TypeFamilies, DataKinds, MultiParamTypeClasses, FlexibleInstances, ScopedTypeVariables, FlexibleContexts #-}\n\nimport Data.List\nimport Data.Text (unpack, pack, Text, empty)\nimport Data.Proxy\nimport Data.Maybe (maybe)\n\ndata ToTextMethod = TTMText | TTMShow | TTMMaybe\n\ntype family ToTextHow a where\n     ToTextHow Text = TTMText\n     ToTextHow (Maybe b) = TTMMaybe\n     ToTextHow a = TTMShow\n\nclass ToTextC a b where\n      toTextC :: a -&gt; b -&gt; Text\n\ninstance Show a =&gt; ToTextC a (Proxy TTMShow) where\n      toTextC a _ = pack (show a)\n\ninstance Show a =&gt; ToTextC (Maybe a) (Proxy TTMMaybe) where\n      -- Will like to replace this with\n      -- toTextC a _ = maybe empty toText a \n      toTextC a _ = maybe empty (pack . show) a \n\ninstance ToTextC Text (Proxy TTMText) where\n      toTextC t _ = t\n\ntoText :: forall a. (Show a, ToTextC a (Proxy (ToTextHow a))) =&gt; a -&gt; Text\ntoText x = toTextC x (Proxy :: Proxy (ToTextHow a))\n</code></pre>\n\n<p>If I update the <code>toTextC</code> definition for <code>TTMMaybe</code> type as indicated in the comment to below:</p>\n\n<pre><code>instance Show a =&gt; ToTextC (Maybe a) (Proxy TTMMaybe) where\n      toTextC a _ = maybe empty toText a\n</code></pre>\n\n<p>I get this error - will appreciate pointers on how to solve this overloading:</p>\n\n<pre><code> Could not deduce (ToTextC a (Proxy (ToTextHow a)))\n      arising from a use of \u2018toText\u2019\n    from the context (Show a)\n      bound by the instance declaration at Test.hs:21:10-53\n    In the second argument of \u2018maybe\u2019, namely \u2018toText\u2019\n    In the expression: maybe empty toText a\n    In an equation for \u2018toTextC\u2019: toTextC a _ = maybe empty toText a\n</code></pre>\n\n<p><strong>Update 1:</strong> </p>\n\n<p>Following the suggestion in comment, I fixed it using additional constraint. However, it required <code>UndecidableInstances</code> extension to be turned on! Is there a better way to do this without using <code>UndecidableInstances</code>? Perhaps some kind of type operator or function to express type-level computation?</p>\n\n<pre><code>instance (Show a,ToTextC a (Proxy (ToTextHow a))) =&gt; ToTextC (Maybe a) (Proxy TTMMaybe) where\n      toTextC a _ = maybe empty toText a \n</code></pre>\n"}, {"tags": ["haskell", "state", "monads"], "answers": [{"tags": [], "owner": {"reputation": 84731, "user_id": 510937, "user_type": "registered", "accept_rate": 80, "profile_image": "https://www.gravatar.com/avatar/70b13a9ae1aae1ca1aa6ac8dab4643f2?s=128&d=identicon&r=PG", "display_name": "Bakuriu", "link": "https://stackoverflow.com/users/510937/bakuriu"}, "is_accepted": true, "score": 8, "last_activity_date": 1458851611, "last_edit_date": 1458851611, "creation_date": 1458765410, "answer_id": 36188227, "question_id": 36188080, "link": "https://stackoverflow.com/questions/36188080/why-runstate-signature-has-only-state-argument/36188227#36188227", "title": "Why runState signature has only state argument?", "body": "<p>A stateful computation gets an input, a state and returns an output and a new state. So the type will be <code>input -&gt; state -&gt; (state, output)</code>.</p>\n\n<p>The <code>runState</code> is just a partially applied stateful computation that has already taken its inputs.</p>\n\n<p>Note also that when you compose stateful functions (i.e. when you use the <code>&gt;&gt;=</code> bind operator or <code>do</code> notation) you do exactly this: you supply the inputs as expression and the bind is responsible for passing around only the <em>state</em>.</p>\n\n<p>You can call <code>get</code> without using its return value, but then it gets lost. If you want to make use of it you have to use <code>value &lt;- get</code> and then provide the <code>value</code> as an explicit input for the next stateful computation. The bind only comes into play when passing the state around.</p>\n\n<hr>\n\n<p>Practical example: consider the function:</p>\n\n<pre><code>doStuff :: Int -&gt; State Int Int\ndoStuff x = do\n    val &lt;- get\n    put $ val+x+1\n    return 0\n</code></pre>\n\n<p>The <code>doStuff</code> type has exactly the pattern <code>input -&gt; state -&gt; (state, output)</code>. But the <code>input</code> part is represented by the <code>x</code> argument.\nOnce you provide <code>x</code> you get something of type <code>state -&gt; (state, output)</code> which is exactly what <code>runState</code> represents.</p>\n\n<p>So you don't actually need the arguments for stateful actions because you can partially apply them beforehand to obtain \"pure stateful computations that have no input\" (those are scary quotes).</p>\n"}, {"tags": [], "owner": {"reputation": 44013, "user_id": 1477667, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/trgKM.jpg?s=128&g=1", "display_name": "dfeuer", "link": "https://stackoverflow.com/users/1477667/dfeuer"}, "is_accepted": false, "score": 2, "last_activity_date": 1459051658, "last_edit_date": 1459051658, "creation_date": 1458874926, "answer_id": 36213371, "question_id": 36188080, "link": "https://stackoverflow.com/questions/36188080/why-runstate-signature-has-only-state-argument/36213371#36213371", "title": "Why runState signature has only state argument?", "body": "<p>It sounds like what you're looking for is not <code>State</code> but <code>StateT</code>, a <em>monad transformer</em> that adds statefulness to an existing monad.</p>\n\n<pre><code>newtype StateT s m a = StateT (s -&gt; m (a, s))\n</code></pre>\n\n<p>Given a state of type <code>s</code> , a <code>StateT s m a</code> action returns an <code>m</code> action that, when run, produces a result and a new state. <code>StateT s</code> is an instance of <code>MonadTrans</code>:</p>\n\n<pre><code>instance MonadTrans (StateT s) where\n  --lift :: Monad m =&gt; m a -&gt; StateT s m a\n  lift ma = StateT $\n    \\s -&gt; ma &gt;&gt;= \\a -&gt; pure (a, s)\n</code></pre>\n\n<p>Further, if <code>m</code> is a <code>Monad</code>, then so is <code>StateT s m</code>.</p>\n\n<p>So if you want to take \"input\" within some context (e.g., <code>IO</code>), you are free to do so:</p>\n\n<pre><code>do\n  s &lt;- get\n  input &lt;- lift getLine\n  when (annoying input &amp;&amp; annoyed s) $ put Angry\n</code></pre>\n\n<p>For <code>IO</code> in particular, it's usually better to use <code>liftIO</code>, which can lift through a whole stack of transformers.</p>\n"}], "owner": {"reputation": 5386, "user_id": 288091, "user_type": "registered", "accept_rate": 94, "profile_image": "https://www.gravatar.com/avatar/3194291b923afe52e71f2338b0e90977?s=128&d=identicon&r=PG", "display_name": "Ilya Smagin", "link": "https://stackoverflow.com/users/288091/ilya-smagin"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 131, "favorite_count": 1, "accepted_answer_id": 36188227, "answer_count": 2, "score": 7, "last_activity_date": 1459051658, "creation_date": 1458764887, "last_edit_date": 1458775230, "question_id": 36188080, "link": "https://stackoverflow.com/questions/36188080/why-runstate-signature-has-only-state-argument", "title": "Why runState signature has only state argument?", "body": "<p><em>A real-life example: If I'm in a good mood('good state'), when manager asks me about estimates, I give him a solid answer, but dares he to do that 3 times <strong>in a row</strong>, without some free snacks in between, my mood changes(I get to 'bad state') and the next 3 times he approaches I ask him not to disturb me with any of his nonsense.</em></p>\n\n<p>Here's a log of my usual day:</p>\n\n<pre><code>                             [ Mood: Good, Patience: 3 ]  -- 11:00 am, I'm happy\nESTIMATE -&gt; \"bla bla 6\",     [ Mood: Good, Patience: 2 ]\nESTIMATE -&gt; \"bla bla 1\",     [ Mood: Good, Patience: 1 ]\nCookies! -&gt; \"\",              [ Mood: Good, Patience: 3 again! ]\nESTIMATE -&gt; \"bla bla 7\",     [ Mood: Good, Patience: 2 ]\nESTIMATE -&gt; \"bla bla 2\",     [ Mood: Good, Patience: 1 ]\nESTIMATE -&gt; \"bla bla 9\",     [ Mood: BAD , Patience: -2 ] -- Enough!\nESTIMATE -&gt; \"Need a break!\"  [ Mood: BAD , Patience: -1 ]\nESTIMATE -&gt; \"Deploynig!\",    [ Mood: BAD , Patience: 0 ]\nESTIMATE -&gt; \"Lunch time!\",   [ Mood: Good, Patience: 3 ]  -- Ok he needs me..\nESTIMATE -&gt; \"bla bla 6\",     [ Mood: Good, Patience: 2 ]\n...\n</code></pre>\n\n<p>Now this model of me at work seems to fit the <code>State</code> Monad.</p>\n\n<pre><code>newtype State s a = State { runState :: s -&gt; (a, s) } \n</code></pre>\n\n<p>But how do I do this? The signature has room for a state, which in my case is <code>(Mood,Patience)</code>, and not for input (<code>ESTIMATE</code> or <code>Cookies</code>). It's like I'm supposed to answer without even listening!</p>\n\n<p>So my question is: <strong>How do I make not only Stateful but also Argumentful computation with <code>State</code> monad of Haskell?</strong></p>\n"}, {"tags": ["haskell", "functional-programming", "equality", "dependent-type", "morte"], "comments": [{"owner": {"reputation": 100185, "user_id": 3234959, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/93bb12ca0f93dfddb33880316f7e66c2?s=128&d=identicon&r=PG&f=1", "display_name": "chi", "link": "https://stackoverflow.com/users/3234959/chi"}, "edited": false, "score": 2, "creation_date": 1458746966, "post_id": 36181738, "comment_id": 59999914, "body": "Every inductive type can be encoded in CoC, but with no associated <i>dependent</i> elimination principle (non-dependent elimination is available). (Also note that <code>a :~: b</code> is a type, but <code>Refl</code> is a value.)"}, {"owner": {"reputation": 84731, "user_id": 510937, "user_type": "registered", "accept_rate": 80, "profile_image": "https://www.gravatar.com/avatar/70b13a9ae1aae1ca1aa6ac8dab4643f2?s=128&d=identicon&r=PG", "display_name": "Bakuriu", "link": "https://stackoverflow.com/users/510937/bakuriu"}, "edited": false, "score": 1, "creation_date": 1458747060, "post_id": 36181738, "comment_id": 59999984, "body": "Calculus of constructions is the &quot;top&quot; of the lambda cube. Haskell,Agda and Idris are &quot;below&quot; CoC. Hence it ought to be possible for the simple fact that CoC is more expressive.  (Someone could point out if I&#39;m wrong in this deduction?)"}, {"owner": {"reputation": 100185, "user_id": 3234959, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/93bb12ca0f93dfddb33880316f7e66c2?s=128&d=identicon&r=PG&f=1", "display_name": "chi", "link": "https://stackoverflow.com/users/3234959/chi"}, "reply_to_user": {"reputation": 84731, "user_id": 510937, "user_type": "registered", "accept_rate": 80, "profile_image": "https://www.gravatar.com/avatar/70b13a9ae1aae1ca1aa6ac8dab4643f2?s=128&d=identicon&r=PG", "display_name": "Bakuriu", "link": "https://stackoverflow.com/users/510937/bakuriu"}, "edited": false, "score": 3, "creation_date": 1458748799, "post_id": 36181738, "comment_id": 60001341, "body": "@Bakuriu Actually, Agda/Coq are beyond CoC since they also allow inductive types with dependent elimination, which CoC lacks. Agda also proves Streicher&#39;s axiom K, which implies that that any two proofs <code>p,q</code> of the same equality <code>a=b</code> must be equal (<code>p=q</code>) -- unavailable in CoC or Coq (aka CiC)."}, {"owner": {"reputation": 28873, "user_id": 1068232, "user_type": "registered", "accept_rate": 79, "profile_image": "https://www.gravatar.com/avatar/2a0a145ce58c20013969fe3f203531da?s=128&d=identicon&r=PG", "display_name": "Andr&#225;s Kov&#225;cs", "link": "https://stackoverflow.com/users/1068232/andr%c3%a1s-kov%c3%a1cs"}, "reply_to_user": {"reputation": 100185, "user_id": 3234959, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/93bb12ca0f93dfddb33880316f7e66c2?s=128&d=identicon&r=PG&f=1", "display_name": "chi", "link": "https://stackoverflow.com/users/3234959/chi"}, "edited": false, "score": 2, "creation_date": 1458748935, "post_id": 36181738, "comment_id": 60001438, "body": "@chi: I should also note impredicative <code>Prop</code> in Coq and induction-recursion in Agda and Idris as features going far beyond the lambda cube."}, {"owner": {"reputation": 100185, "user_id": 3234959, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/93bb12ca0f93dfddb33880316f7e66c2?s=128&d=identicon&r=PG&f=1", "display_name": "chi", "link": "https://stackoverflow.com/users/3234959/chi"}, "reply_to_user": {"reputation": 28873, "user_id": 1068232, "user_type": "registered", "accept_rate": 79, "profile_image": "https://www.gravatar.com/avatar/2a0a145ce58c20013969fe3f203531da?s=128&d=identicon&r=PG", "display_name": "Andr&#225;s Kov&#225;cs", "link": "https://stackoverflow.com/users/1068232/andr%c3%a1s-kov%c3%a1cs"}, "edited": false, "score": 1, "creation_date": 1458751005, "post_id": 36181738, "comment_id": 60002912, "body": "@Andr&#225;sKov&#225;cs Interesting. Isn&#39;t <code>*</code> impredicative in CoC, though?"}, {"owner": {"reputation": 9455, "user_id": 1172541, "user_type": "registered", "accept_rate": 30, "profile_image": "https://i.stack.imgur.com/LROoN.png?s=128&g=1", "display_name": "PyRulez", "link": "https://stackoverflow.com/users/1172541/pyrulez"}, "reply_to_user": {"reputation": 100185, "user_id": 3234959, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/93bb12ca0f93dfddb33880316f7e66c2?s=128&d=identicon&r=PG&f=1", "display_name": "chi", "link": "https://stackoverflow.com/users/3234959/chi"}, "edited": false, "score": 1, "creation_date": 1458751466, "post_id": 36181738, "comment_id": 60003256, "body": "@chi Do you have a resource explaining dependent elimination? (I had trouble looking it up.)"}, {"owner": {"reputation": 100185, "user_id": 3234959, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/93bb12ca0f93dfddb33880316f7e66c2?s=128&d=identicon&r=PG&f=1", "display_name": "chi", "link": "https://stackoverflow.com/users/3234959/chi"}, "edited": false, "score": 1, "creation_date": 1458761204, "post_id": 36181738, "comment_id": 60009361, "body": "I found <a href=\"http://www.pps.univ-paris-diderot.fr/~lebresne/papers/CodingDependentElimination.pdf\" rel=\"nofollow noreferrer\">this</a>. Surely some type theory books describe non-dependent vs dependent elimination, but I can not access them right now."}], "answers": [{"comments": [{"owner": {"reputation": 9455, "user_id": 1172541, "user_type": "registered", "accept_rate": 30, "profile_image": "https://i.stack.imgur.com/LROoN.png?s=128&g=1", "display_name": "PyRulez", "link": "https://stackoverflow.com/users/1172541/pyrulez"}, "edited": false, "score": 0, "creation_date": 1458749843, "post_id": 36182693, "comment_id": 60002146, "body": "Intriguing. Is it possible to derive a contradiction from <code>0 :~: 1</code>, like you can do in the other languages? (Oh wait, I see how. Just make a equality function that returns <code>()</code> instead of True and <code>Void</code> instead of false. I think that would work.)"}, {"owner": {"reputation": 9455, "user_id": 1172541, "user_type": "registered", "accept_rate": 30, "profile_image": "https://i.stack.imgur.com/LROoN.png?s=128&g=1", "display_name": "PyRulez", "link": "https://stackoverflow.com/users/1172541/pyrulez"}, "edited": false, "score": 0, "creation_date": 1458749875, "post_id": 36182693, "comment_id": 60002175, "body": "(Also, I see how this easily generalizes to other GADTs.)"}, {"owner": {"reputation": 100185, "user_id": 3234959, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/93bb12ca0f93dfddb33880316f7e66c2?s=128&d=identicon&r=PG&f=1", "display_name": "chi", "link": "https://stackoverflow.com/users/3234959/chi"}, "reply_to_user": {"reputation": 9455, "user_id": 1172541, "user_type": "registered", "accept_rate": 30, "profile_image": "https://i.stack.imgur.com/LROoN.png?s=128&g=1", "display_name": "PyRulez", "link": "https://stackoverflow.com/users/1172541/pyrulez"}, "edited": false, "score": 2, "creation_date": 1458750870, "post_id": 36182693, "comment_id": 60002835, "body": "@PyRulez Yes. With church numerals, <code>0 f x = x</code> and <code>1 f x = f x</code> (modulo additional type arguments). Using that, you can have <code>0 (const True) False = False</code> and <code>1 (const True) False = True</code>. Assuming <code>0 :~: 1</code> and taking <code>P x y = (x (const True) False) &lt;-&gt; (y (const True) False)</code>, we can prove <code>False &lt;-&gt; True</code>."}], "tags": [], "owner": {"reputation": 100185, "user_id": 3234959, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/93bb12ca0f93dfddb33880316f7e66c2?s=128&d=identicon&r=PG&f=1", "display_name": "chi", "link": "https://stackoverflow.com/users/3234959/chi"}, "is_accepted": true, "score": 12, "last_activity_date": 1458750423, "last_edit_date": 1458750423, "creation_date": 1458747950, "answer_id": 36182693, "question_id": 36181738, "link": "https://stackoverflow.com/questions/36181738/refl-thing-in-calculus-of-constructions/36182693#36182693", "title": "`Refl` thing in Calculus of Constructions?", "body": "<p>The standard Church-encoding of <code>a :~: b</code> in CoC is:</p>\n\n<pre><code>(a :~: b) =\n   forall (P :: * -&gt; * -&gt; *).\n      (forall c :: *. P c c) -&gt;\n      P a b\n</code></pre>\n\n<p><code>Refl</code> being</p>\n\n<pre><code>Refl a :: a :~: a\nRefl a =\n   \\ (P :: * -&gt; * -&gt; *)\n     (h :: forall (c::*). P c c) -&gt;\n     h a\n</code></pre>\n\n<p>The above formulates equality between <em>types</em>. For equality between <em>terms</em>, the <code>:~:</code> relation must take an additional argument <code>t :: *</code>, where <code>a b :: t</code>.</p>\n\n<pre><code>((:~:) t a b) = \n   forall (P :: t -&gt; t -&gt; *).\n      (forall c :: t. P c c) -&gt;\n      P a b\n\nRefl t a :: (:~:) t a a\nRefl t a =\n   \\ (P :: t -&gt; t -&gt; *)\n     (h :: forall (c :: t). P c c) -&gt;\n     h a\n</code></pre>\n"}, {"comments": [{"owner": {"reputation": 1273, "user_id": 8616229, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/iakXE.jpg?s=128&g=1", "display_name": "SONU SOURAV", "link": "https://stackoverflow.com/users/8616229/sonu-sourav"}, "edited": false, "score": 0, "creation_date": 1592055626, "post_id": 62360315, "comment_id": 110290275, "body": "Could you add some explanation? Please see here <a href=\"https://stackoverflow.com/help/how-to-answer\">how to write a good answer</a>"}, {"owner": {"reputation": 9455, "user_id": 1172541, "user_type": "registered", "accept_rate": 30, "profile_image": "https://i.stack.imgur.com/LROoN.png?s=128&g=1", "display_name": "PyRulez", "link": "https://stackoverflow.com/users/1172541/pyrulez"}, "edited": false, "score": 0, "creation_date": 1592058499, "post_id": 62360315, "comment_id": 110291152, "body": "What do you need <code>id</code> for?"}, {"owner": {"reputation": 33, "user_id": 12556322, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/aKjQW.png?s=128&g=1", "display_name": "\uc784\uae30\uc815", "link": "https://stackoverflow.com/users/12556322/%ec%9e%84%ea%b8%b0%ec%a0%95"}, "reply_to_user": {"reputation": 9455, "user_id": 1172541, "user_type": "registered", "accept_rate": 30, "profile_image": "https://i.stack.imgur.com/LROoN.png?s=128&g=1", "display_name": "PyRulez", "link": "https://stackoverflow.com/users/1172541/pyrulez"}, "edited": false, "score": 0, "creation_date": 1592059376, "post_id": 62360315, "comment_id": 110291420, "body": "@PyRulez Just for the beauty"}, {"owner": {"reputation": 9455, "user_id": 1172541, "user_type": "registered", "accept_rate": 30, "profile_image": "https://i.stack.imgur.com/LROoN.png?s=128&g=1", "display_name": "PyRulez", "link": "https://stackoverflow.com/users/1172541/pyrulez"}, "edited": false, "score": 0, "creation_date": 1592402909, "post_id": 62360315, "comment_id": 110413180, "body": "Okay. Is this definition symmetric?"}, {"owner": {"reputation": 33, "user_id": 12556322, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/aKjQW.png?s=128&g=1", "display_name": "\uc784\uae30\uc815", "link": "https://stackoverflow.com/users/12556322/%ec%9e%84%ea%b8%b0%ec%a0%95"}, "reply_to_user": {"reputation": 9455, "user_id": 1172541, "user_type": "registered", "accept_rate": 30, "profile_image": "https://i.stack.imgur.com/LROoN.png?s=128&g=1", "display_name": "PyRulez", "link": "https://stackoverflow.com/users/1172541/pyrulez"}, "edited": false, "score": 0, "creation_date": 1610597976, "post_id": 62360315, "comment_id": 116185711, "body": "@PyRulez Yes, it is. To show that definition is symmetric, it is sufficient to derive <code>a : *</code>, <code>x : a</code>, <code>y : a</code> |- <code>eqn a x y -&gt; eqn a y x</code>. Let <code>h : eqn a x y</code> be given. Since <code>eqn a x y</code> == <code>\\&#47;p : (a -&gt; *). p x -&gt; p y</code>, we can derive <code>eqn a x x -&gt; eqn a y x</code> from <code>h : \\&#47;p : (a -&gt; *). p x -&gt; p y</code>, putting <code>p</code> := <code>\\z : a. eqn a z x</code>. Applying <code>refl a x : eqn a x x</code>, we obtain a proof of <code>eqn a y x</code>. Q.E.D."}], "tags": [], "owner": {"reputation": 33, "user_id": 12556322, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/aKjQW.png?s=128&g=1", "display_name": "\uc784\uae30\uc815", "link": "https://stackoverflow.com/users/12556322/%ec%9e%84%ea%b8%b0%ec%a0%95"}, "is_accepted": false, "score": 1, "last_activity_date": 1592111578, "last_edit_date": 1592111578, "creation_date": 1592054389, "answer_id": 62360315, "question_id": 36181738, "link": "https://stackoverflow.com/questions/36181738/refl-thing-in-calculus-of-constructions/62360315#62360315", "title": "`Refl` thing in Calculus of Constructions?", "body": "<pre><code>id : \\/a : *. a -&gt; a\nid = \\a : *. \\x : a. x\n\neqn : \\/a : *. a -&gt; a -&gt; *\neqn = \\a : *. \\x : a. \\y : a. \\/p : (a -&gt; *). p x -&gt; p y\n\nrefl : \\/a : *. \\/x : a. eqn a x x\nrefl = \\a : *. \\x : a. \\p : (a -&gt; *). id (p x)\n</code></pre>\n\n<p>where <code>\\/</code> is the pi-constructor and <code>\\</code>is the lambda-constructor.</p>\n\n<p>I think that the idea of Church-Scott Encoding is to define a type as its elimination rule and its constructors as its introduction rules.</p>\n\n<p><code>either</code> is a good example:</p>\n\n<pre><code>either : * -&gt; * -&gt; *\neither = \\a : *. \\b : *. \\/r : *. (a -&gt; r) -&gt; (b -&gt; r) -&gt; r \n\nleft : \\/a : *. \\/b : *. a -&gt; either a b\nleft = \\a : *. \\b : *. \\x : a. \\r : *. \\left1 : (a -&gt; r). \\right1 : (b -&gt; r). left1 x\n\nright : \\/a : *. \\/b : *. b -&gt; either a b\nright = \\a : *. \\b : *. \\y : b. \\r : *. \\left1 : (a -&gt; r). \\right1 : (b -&gt; r). right1 y\n</code></pre>\n\n<p><code>either</code> is defined as the elimination rule of disjunction.</p>\n\n<p>By this idea, <code>eqn a x y</code> must be defined as the liebniz rule <code>\\/p : (a -&gt; *). p x -&gt; p y</code>, because the elimination rule of equation is the liebniz rule.</p>\n\n<hr>\n\n<p>+) a proof of <code>1 != 0</code>:</p>\n\n<pre><code>bottom : *\nbottom = \\/r : *. r\n\nnat : *\nnat = \\/r : *. r -&gt; (r -&gt; r) -&gt; r\n\nzero : nat\nzero = \\r : *. \\z : r. \\s : (r -&gt; r). z\n\nsucc : nat -&gt; nat\nsucc = \\n : nat. \\r : *. \\z : r. \\s : (r -&gt; r). s (n r z s)\n\nid : \\/a : *. a -&gt; a\nid = \\a : *. \\x : a. x\n\neqn : \\/a : *. a -&gt; a -&gt; *\neqn = \\a : *. \\x : a. \\y : a. \\/p : (a -&gt; *). p x -&gt; p y\n\nrefl : \\/a : *. \\/x : a. eqn a x x\nrefl = \\a : *. \\x : a. \\p : (a -&gt; *). id (p x)\n\ngoal : eqn nat (succ zero) zero -&gt; bottom\ngoal = \\one_is_zero : (\\/p : (nat -&gt; *). p (succ zero) -&gt; p zero). \\r : *. one_is_zero (\\n : nat. n * r (\\a : *. r -&gt; a)) (id r)\n</code></pre>\n"}], "owner": {"reputation": 9455, "user_id": 1172541, "user_type": "registered", "accept_rate": 30, "profile_image": "https://i.stack.imgur.com/LROoN.png?s=128&g=1", "display_name": "PyRulez", "link": "https://stackoverflow.com/users/1172541/pyrulez"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 722, "favorite_count": 5, "accepted_answer_id": 36182693, "answer_count": 2, "score": 10, "last_activity_date": 1592111578, "creation_date": 1458745467, "last_edit_date": 1458747020, "question_id": 36181738, "link": "https://stackoverflow.com/questions/36181738/refl-thing-in-calculus-of-constructions", "title": "`Refl` thing in Calculus of Constructions?", "body": "<p>In languages such as <code>Agda</code>, <code>Idris</code>, or <code>Haskell</code> with type extensions, there is a <code>=</code> type sort of like the following</p>\n\n<pre><code>data a :~: b where\n  Refl :: a :~: a\n</code></pre>\n\n<p><code>a :~: b</code> means that <code>a</code> and <code>b</code> are the same.</p>\n\n<p>Can such a type be defined in the <a href=\"https://en.wikipedia.org/wiki/Calculus_of_constructions\" rel=\"noreferrer\">calculus of constructions</a> or <a href=\"https://github.com/Gabriel439/Haskell-Morte-Library\" rel=\"noreferrer\">Morte</a> (which is programming language based on the calculus of construction)?</p>\n"}, {"tags": ["haskell", "random", "while-loop"], "comments": [{"owner": {"reputation": 3040, "user_id": 4308453, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/fc596d8352ad2c4254536343139b5b82?s=128&d=identicon&r=PG&f=1", "display_name": "zakyggaps", "link": "https://stackoverflow.com/users/4308453/zakyggaps"}, "edited": false, "score": 1, "creation_date": 1458746904, "post_id": 36181493, "comment_id": 59999869, "body": "I don&#39;t think it&#39;s possible: expressions in Haskell are referential transparent, so <code>semanticaSTM config</code> will always give the same result for a fixed <code>config</code>. You may have to embed a random seed in your <code>Config</code> type, passing and updating it around when traversing your AST."}, {"owner": {"reputation": 84731, "user_id": 510937, "user_type": "registered", "accept_rate": 80, "profile_image": "https://www.gravatar.com/avatar/70b13a9ae1aae1ca1aa6ac8dab4643f2?s=128&d=identicon&r=PG", "display_name": "Bakuriu", "link": "https://stackoverflow.com/users/510937/bakuriu"}, "edited": false, "score": 1, "creation_date": 1458747259, "post_id": 36181493, "comment_id": 60000139, "body": "An other way is to perform <i>all</i> possible computations. This would be deterministic (in fact it would mean using the list monad)."}], "owner": {"reputation": 410, "user_id": 3927886, "user_type": "registered", "accept_rate": 67, "profile_image": "https://www.gravatar.com/avatar/689a75ec29af93dcc938fdbd5f039b54?s=128&d=identicon&r=PG&f=1", "display_name": "RamiroPastor", "link": "https://stackoverflow.com/users/3927886/ramiropastor"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 86, "favorite_count": 0, "answer_count": 0, "score": 1, "last_activity_date": 1458744746, "creation_date": 1458744746, "question_id": 36181493, "link": "https://stackoverflow.com/questions/36181493/or-and-par-statements-in-haskell-for-the-while-language", "title": "OR and PAR statements in haskell for the WHILE language", "body": "<p>i'm trying to write in Haskell the WHILE language from my Theory of Programming subject. \nEverything was being defined recursively at first, so code was flowing. Then we reached statements, and derivation trees appeared, even though i could still transform that into recursive definitions. Until we got into the OR and PAR statements.</p>\n\n<p>The 2 big-step axioms for the OR statement:    (S1 OR S2)</p>\n\n<ul>\n<li>If   &lt; S1, s> -> s'   then   &lt; S1 OR S2, s> -> s'</li>\n<li>If   &lt; S2, s> -> s'   then   &lt; S1 OR S2, s> -> s'</li>\n</ul>\n\n<p>The 2 small-step axioms for the OR statement:<br>\n - &lt; S1 OR S2 , s > => &lt; S1 , s >\n - &lt; S1 OR S2 , s > => &lt; S2 , s ></p>\n\n<p>where S1 and S2 are Statements and s, s' are functions Var -> Int</p>\n\n<p>Apparently a good way to achieve this behaviour is randomize which of S1 or S2 gets executed when we run S1 OR S2 .\nLuckily i began my monad research months ago, reaching already the System.Random module and the State monad (monad Transformers are still unknown for me), so i can imagine some approaches (which i dislike)</p>\n\n<ul>\n<li>Get some \"random\" seed from both S1 and S2, something like (length . show), and passing that to System.Random . But i know that going that way leads to always choosing the same statement from S1 OR S2 when both S1 and S2 are fixed.</li>\n<li>Define new data (something like SpecialSTM) for the OR and PAR statements, so i can change the types of my functions (mainly semanticaSTM) to add some IO and real randomness .</li>\n</ul>\n\n<p>So, is there a solution allowing me to keep the types just as they are now, but get some reasonable behaviour in the OR and PAR statements?</p>\n\n<p>Here is all my code:</p>\n\n<pre><code>module WhileV4\n  (\n  -- La sintaxis:\n    Bin(Cero, Uno) \n  , Entero(N1,N2)\n  , AritVar(Avar)\n  , BoolVar(Bvar)\n  , Aexpr(A1,A2,Sum,Mult,Rest)\n  , Bexpr(Verdadero,Falso,Iguales,Distintos,MayorOigual,MenorOigual,Mayor,Menor,NO,Y,O,Entonces,Sii)\n  , Stm(AssA,AssB,Skip,Comp,Si,Mientras,Repetir)\n\n  -- La semantica:\n  , semanticaN\n  , semanticaA\n  , semanticaB\n  , freeAV\n  , freeAV'\n  , freeBV\n  , subsA\n  , subsA'\n  , subsB\n  , newStateA\n  , newStateB\n  , semanticaSTM\n\n  -- Otros:\n  , mkEnt  -- para crear Enteros a partir de cadenas de 0s y 1s\n  , (.:)   -- sinonimo infijo de Comp (otra opcion, usar la clase Monoid --&gt; TO DO)\n  , (&gt;+)\n  , (&gt;*)\n  , (&gt;-)\n  , (=:)   -- asignacion para variables aritmeticas, sinonimo infijo\n  , (==:)  -- asignacion para variables booleanas, sinonimo infijo\n  , (=.=)\n  , (=/=)\n  , (&lt;.=)\n  , (&gt;.=)\n  , factorial\n  , euclides\n\n  ) where\n\nimport Data.Char (digitToInt)\nimport qualified Data.Set as S\n\nimport Control.Applicative\nimport Data.Maybe\n\n\n\n----------------------------------------------------------\n-- TEMA 1\n----------------------------------------------------------\n\n-- Comparando con lo visto en clase:\n--   Num ~ Entero , Var ~ AritVar , Aexp ~ Aexpr , Bexp ~ Bexpr , Stm ~ Stm\n--     Los constructores de cada expresion tienen distinta notacion para evitar interferencias con Haskell.\n--     Faltan las BoolVar (se dejan como ejercicio en clase).\n--   N ~ semanticaN , State ~ Astate , A ~ semanticaA\n--     Definiciones de \"definicion composicional\" e \"induccion estructural\".\n--     Observacion sobre la semantica de (-a)\n--     Ej 1.8: Demostrar que las ecuaciones para A definen una funcion total.\n--     Visto en clase: N es funcion total\n--   B ~ semanticaB\n--     Ej 1.10: Demostrar que las ecuaciones para B definen una funcion total.\n--     Ej 1.11: (a) Se extiende Bexp a Bexp'; extender la funcion semantica B (ya implementado)\n--              (b) Demostrar que para cada b' en Bexp' existe b en Bexp tal que b' y b son equivalentes.\n--   FV ~ freeAV\n--     Lema 1: Sean s,s' en State tales que para todo x en FV(a), s x == s' x  =&gt;  A[[a]]s == A[[a]]s'\n--     Ej 1.13: Definir el conjunto de variables libres para una expresion booleana y demostrar un resultado similar al Lema 1.\n--     ERROR: freeBV no es lo que pide el ejercicio 13 (pide freeAV')\n--   substitucion ~ subsA  ,  actualizar estado ~ newStateA\n--     Ej 1.14: Demostrar que A[[ a[y-&gt;a0] ]]s = A[[a]](s[y-&gt;A[[a0]]s]) para cualquier estado s.\n--     Ej 1.15: Definir la substitucion de expresiones booleanas b[y-&gt;a0] y demostrar un resultado similar al del ejercicio anterior.\n\n\n\ndata Bin = Cero | Uno\n  deriving Show\n\n-- Para hacerlo como en clase: \n-- data Entero = N1 Bin | N2 Entero Bin\n-- pero podria hacerlo con listas que total tambien son recursivas\n-- newtype Entero = N [Bin]\n-- pero me toca las narices la lista vacia asi que voy a hacerlo como en clase\n\ndata Entero = N1 Bin | N2 Entero Bin\n  deriving Show\n\n\n\nsemanticaN :: Entero -&gt; Int\nsemanticaN (N1 Cero)   = 0\nsemanticaN (N1 Uno)    = 1\nsemanticaN (N2 n Cero) = 2 * semanticaN n\nsemanticaN (N2 n Uno)  = (2 * semanticaN n) + 1\n\n\n\ndata AritVar = Avar String\n  deriving (Eq, Ord, Show)\n\ndata BoolVar = Bvar String \n  deriving (Eq, Ord, Show)\n-- el Ord lo necesito para hacer uniones de (Set AritVar) y (Set BoolVar)\n\n\ndata Aexpr = A1 Entero | A2 AritVar | Sum Aexpr Aexpr     | Mult Aexpr Aexpr      | Rest Aexpr Aexpr\n\ndata Bexpr = Verdadero | Falso      | Iguales Aexpr Aexpr | Distintos Aexpr Aexpr | MayorOigual Aexpr Aexpr | MenorOigual Aexpr Aexpr | Mayor Aexpr Aexpr  | Menor Aexpr Aexpr\n                       | NO Bexpr   | Y Bexpr Bexpr       | O Bexpr Bexpr         | Entonces Bexpr Bexpr    | Sii Bexpr Bexpr         | B BoolVar         -- Bvar String\n\ndata Stm   = AssA AritVar Aexpr     | AssB BoolVar Bexpr  | Skip                  | Comp Stm Stm            | Si Bexpr Stm Stm        | Mientras Bexpr Stm | Repetir Stm Bexpr  \n                                    | Abortar             | Asegurar Bexpr Stm    | Or Stm Stm              | Par Stm Stm \n                                    | Iniciar Dec \n\n\n\nsemanticaA :: Aexpr -&gt; (AritVar -&gt; Int) -&gt; Int\nsemanticaA (A1 ent) s     = semanticaN ent\nsemanticaA (A2 var) s     = s var\nsemanticaA (Sum a1 a2)  s = (semanticaA a1 s) + (semanticaA a2 s)\nsemanticaA (Mult a1 a2) s = (semanticaA a1 s) * (semanticaA a2 s)\nsemanticaA (Rest a1 a2) s = (semanticaA a1 s) - (semanticaA a2 s)\n\n\n\nsemanticaB :: Bexpr -&gt; (AritVar -&gt; Int) -&gt; (BoolVar -&gt; Bool) -&gt; Bool\nsemanticaB Verdadero _ _ = True\nsemanticaB Falso     _ _ = False\nsemanticaB (Iguales a1 a2)     s _ =  (semanticaA a1 s) == semanticaA a2 s\nsemanticaB (Distintos a1 a2)   s _ =  (semanticaA a1 s) /= semanticaA a2 s\nsemanticaB (MayorOigual a1 a2) s _ =  (semanticaA a1 s) &gt;= semanticaA a2 s\nsemanticaB (MenorOigual a1 a2) s _ =  (semanticaA a1 s) &lt;= semanticaA a2 s\nsemanticaB (Mayor a1 a2)       s _ =  (semanticaA a1 s) &gt; semanticaA a2 s\nsemanticaB (Menor a1 a2)       s _ =  (semanticaA a1 s) &lt; semanticaA a2 s\nsemanticaB (B boolvar)       s1 s2 =  s2 boolvar\nsemanticaB (NO bexpr)        s1 s2 =  not (semanticaB bexpr s1 s2)\nsemanticaB (Y b1 b2)         s1 s2 =  (semanticaB b1 s1 s2) &amp;&amp; (semanticaB b2 s1 s2)\nsemanticaB (O b1 b2)         s1 s2 =  (semanticaB b1 s1 s2) || (semanticaB b2 s1 s2)\nsemanticaB (Entonces b1 b2)  s1 s2 =  semanticaB (NO (b1 `Y` (NO b2))) s1 s2\nsemanticaB (Sii b1 b2)       s1 s2 =  (semanticaB b1 s1 s2) == (semanticaB b2 s1 s2)\n\n\n\nfreeAV :: Aexpr -&gt; S.Set AritVar\nfreeAV (A1 _)       = S.empty\nfreeAV (A2 avar)    = S.singleton avar\nfreeAV (Sum a1 a2)  = (freeAV a1) `S.union` (freeAV a2)\nfreeAV (Mult a1 a2) = (freeAV a1) `S.union` (freeAV a2)\nfreeAV (Rest a1 a2) = (freeAV a1) `S.union` (freeAV a2)\n\n\nfreeAV' :: Bexpr -&gt; S.Set AritVar\nfreeAV' Verdadero = S.empty\nfreeAV' Falso     = S.empty\nfreeAV' (Iguales a1 a2)     = (freeAV a1) `S.union` (freeAV a2)\nfreeAV' (Distintos a1 a2)   = (freeAV a1) `S.union` (freeAV a2)\nfreeAV' (MayorOigual a1 a2) = (freeAV a1) `S.union` (freeAV a2)\nfreeAV' (MenorOigual a1 a2) = (freeAV a1) `S.union` (freeAV a2)\nfreeAV' (Mayor a1 a2)       = (freeAV a1) `S.union` (freeAV a2)\nfreeAV' (Menor a1 a2)       = (freeAV a1) `S.union` (freeAV a2)\nfreeAV' (B boolvar)         = S.empty\nfreeAV' (NO bexpr)          = freeAV' bexpr\nfreeAV' (Y b1 b2)           = (freeAV' b1) `S.union` (freeAV' b2)\nfreeAV' (O b1 b2)           = (freeAV' b1) `S.union` (freeAV' b2)\nfreeAV' (Entonces b1 b2)    = (freeAV' b1) `S.union` (freeAV' b2)\nfreeAV' (Sii b1 b2)         = (freeAV' b1) `S.union` (freeAV' b2)\n\n\nfreeBV :: Bexpr -&gt; S.Set BoolVar\nfreeBV Verdadero = S.empty\nfreeBV Falso     = S.empty\nfreeBV (Iguales a1 a2)     = S.empty\nfreeBV (Distintos a1 a2)   = S.empty\nfreeBV (MayorOigual a1 a2) = S.empty\nfreeBV (MenorOigual a1 a2) = S.empty\nfreeBV (Mayor a1 a2)       = S.empty\nfreeBV (Menor a1 a2)       = S.empty\nfreeBV (B boolvar)         = S.singleton boolvar\nfreeBV (NO bexpr)          = freeBV bexpr\nfreeBV (Y b1 b2)           = (freeBV b1) `S.union` (freeBV b2)\nfreeBV (O b1 b2)           = (freeBV b1) `S.union` (freeBV b2)\nfreeBV (Entonces b1 b2)    = (freeBV b1) `S.union` (freeBV b2)\nfreeBV (Sii b1 b2)         = (freeBV b1) `S.union` (freeBV b2)\n\n\n\nsubsA :: Aexpr -&gt; AritVar -&gt; Aexpr -&gt; Aexpr\nsubsA (A1 ent) _ _     = (A1 ent)\nsubsA (A2 avar) v a    = if avar == v then a else (A2 avar)\nsubsA (Sum a1 a2)  v a = Sum (subsA a1 v a) (subsA a2 v a)\nsubsA (Mult a1 a2) v a = Mult (subsA a1 v a) (subsA a2 v a)\nsubsA (Rest a1 a2) v a = Rest (subsA a1 v a) (subsA a2 v a)\n\n\nsubsA' :: Bexpr -&gt; AritVar -&gt; Aexpr -&gt; Bexpr\nsubsA' Verdadero _ _ = Verdadero\nsubsA' Falso     _ _ = Falso\nsubsA' (Iguales a1 a2)     v a = Iguales (subsA a1 v a) (subsA a2 v a)\nsubsA' (Distintos a1 a2)   v a = Distintos (subsA a1 v a) (subsA a2 v a)\nsubsA' (MayorOigual a1 a2) v a = MayorOigual (subsA a1 v a) (subsA a2 v a)\nsubsA' (MenorOigual a1 a2) v a = MenorOigual (subsA a1 v a) (subsA a2 v a)\nsubsA' (Mayor a1 a2)       v a = Mayor (subsA a1 v a) (subsA a2 v a)\nsubsA' (Menor a1 a2)       v a = Menor (subsA a1 v a) (subsA a2 v a)\nsubsA' (B boolvar)      v a = (B boolvar)\nsubsA' (NO bexpr)       v a = NO (subsA' bexpr v a)\nsubsA' (Y b1 b2)        v a = (subsA' b1 v a) `Y` (subsA' b2 v a)\nsubsA' (O b1 b2)        v a = (subsA' b1 v a) `O` (subsA' b2 v a)\nsubsA' (Entonces b1 b2) v a = (subsA' b1 v a) `Entonces` (subsA' b2 v a)\nsubsA' (Sii b1 b2)      v a = (subsA' b1 v a) `Sii` (subsA' b2 v a)\n\n\nsubsB :: Bexpr -&gt; BoolVar -&gt; Bexpr -&gt; Bexpr\nsubsB Verdadero _ _ = Verdadero\nsubsB Falso     _ _ = Falso\nsubsB b@(Iguales a1 a2)     _ _ = b\nsubsB b@(Distintos a1 a2)   _ _ = b\nsubsB b@(MayorOigual a1 a2) _ _ = b\nsubsB b@(MenorOigual a1 a2) _ _ = b\nsubsB b@(Mayor a1 a2)       _ _ = b\nsubsB b@(Menor a1 a2)       _ _ = b\nsubsB (B boolvar)      v b = if boolvar == v then b else (B boolvar)\nsubsB (NO bexpr)       v b = NO (subsB bexpr v b)\nsubsB (Y b1 b2)        v b = (subsB b1 v b) `Y` (subsB b2 v b)\nsubsB (O b1 b2)        v b = (subsB b1 v b) `O` (subsB b2 v b)\nsubsB (Entonces b1 b2) v b = (subsB b1 v b) `Entonces` (subsB b2 v b)\nsubsB (Sii b1 b2)      v b = (subsB b1 v b) `Sii` (subsB b2 v b)\n\n\nnewStateA :: (AritVar -&gt; Int) -&gt; AritVar -&gt; Int -&gt; (AritVar -&gt; Int)\nnewStateA s y n x = if x == y then n else (s x)\n\n\nnewStateB :: (BoolVar -&gt; Bool) -&gt; BoolVar -&gt; Bool -&gt; (BoolVar -&gt; Bool)\nnewStateB s y b x = if x == y then b else (s x)\n\n\n\n----------------------------------------------------------\n-- TEMA 2\n----------------------------------------------------------\n\n-- Comparando con lo visto en clase:\n--   configuracion ~ Config  ,  transicion ~ Transicion\n--   Defs: La ejecucion de una sentencia S en un estado s:   (\u00ac terminar = ciclar)\n--     termina sii existe un estado s' tal que &lt;S,s&gt; -&gt; s'\n--     cicla sii no existe ningun estado s' tal que &lt;S,s&gt; -&gt; s'\n--   Ej 2.4: Determinar si las sentencias terminan / ciclan (o no) siempre:\n--     while \u00ac(x=1) do (y := y*x ; x := x-1)\n--     while 1&lt;=x do (y := y*x ; x := x-1)\n--     while true do skip\n--   Def: S1 equivale semanticamente a S2 sii para todo s en State, &lt;S1,s&gt; -&gt; s' si y solo si &lt;S2,s&gt; -&gt; s'\n--   Lema 2: {while b do S} es sem\u00e1nticamente equivalente a {if b then (S; while b do S) else skip}\n--   Ej 2.6:\n--     Demostrar que (S1;S2);S3 y S1;(S2;S3) son semanticamente equivalentes\n--     Demostrar que en general S1;S2 no es semanticamente equivalente a S2;S1\n--   Ej 2.7: Extender el lenguaje While con la sentencia  repeat S until b\n--     Demostrar que {repeat S until b} es semanticamente equivalente a {S; if b then skip else (repeat S until b)} \n\n\n\ntype Astate = AritVar -&gt; Int\n\ntype Bstate = BoolVar -&gt; Bool\n\ntype Config  =  (Stm,Astate,Bstate)\n\ntype Transicion = Config -&gt; (Astate,Bstate)\n\n\nsemanticaSTM :: Transicion \nsemanticaSTM (AssA x a, s1, s2) = let n = semanticaA a s1 in (newStateA s1 x n , s2)\nsemanticaSTM (AssB x b, s1, s2) = let n = semanticaB b s1 s2 in (s1 ,newStateB s2 x n)\nsemanticaSTM (Skip, s1, s2)           = (s1,s2)\nsemanticaSTM (Comp stm1 stm2, s1, s2) = let (s1' , s2') = semanticaSTM (stm1,s1,s2) in semanticaSTM (stm2,s1',s2')\nsemanticaSTM (Si b stm1 stm2, s1, s2) = if semanticaB b s1 s2 then semanticaSTM (stm1,s1,s2) else semanticaSTM (stm2,s1,s2)\nsemanticaSTM (Mientras b stm, s1, s2) = if semanticaB b s1 s2 then aux else (s1,s2)\n  where aux =  let (s1' , s2') = semanticaSTM (stm,s1,s2) in semanticaSTM (Mientras b stm, s1', s2')\nsemanticaSTM (Repetir stm b,  s1, s2) = if semanticaB b s1 s2 then semanticaSTM (stm,s1,s2) else aux\n  where aux = let (s1' , s2') = semanticaSTM (stm,s1,s2) in semanticaSTM (Repetir stm b , s1', s2')\nsemanticaSTM (Abortar ,       s1, s2) = error \"La ejecucion del programa ha sido interrumpida por Abortar\"\nsemanticaSTM (Asegurar b stm, s1, s2) = if (semanticaB b s1 s2) then semanticaSTM (stm,s1,s2) else error (\"La ejecucion del programa ha sido interrumpida porque no se puede asegurar la condicion \" ++ show b)\n-- semanticaSTM (Or stm1 stm2 , s1, s2) = ???\n-- semanticaSTM (Par stm1 stm2, s1, s2) = ???\n\n\n\n\n\n----------------------------------------------------------\n-- TEMA 3\n----------------------------------------------------------\n\n\ndata Dec = DvA (String,Aexpr) Dec | DvB (String,Bexpr) Dec | NoMasVariables\n\n\n\n\n----------------------------------------------------------\n-- COSAS EXTRA\n----------------------------------------------------------\n\n-- Sinonimos infijos:\n\n(.:) :: Stm -&gt; Stm -&gt; Stm\nstm1 .: stm2 = Comp stm1 stm2\n\n(&gt;+) :: Aexpr -&gt; Aexpr -&gt; Aexpr\na1 &gt;+ a2 = Sum a1 a2\n\n(&gt;*) :: Aexpr -&gt; Aexpr -&gt; Aexpr\na1 &gt;* a2 = Mult a1 a2\n\n(&gt;-) :: Aexpr -&gt; Aexpr -&gt; Aexpr\na1 &gt;- a2 = Rest a1 a2\n\n(=:) :: AritVar -&gt; Aexpr -&gt; Stm\navar =: a  = avar `AssA` a\n\n(==:) :: BoolVar -&gt; Bexpr -&gt; Stm\nbvar ==: b = bvar `AssB` b\n\n\n(=.=) :: Aexpr -&gt; Aexpr -&gt; Bexpr\na1 =.= a2  =  Iguales a1 a2\n\n(=/=) :: Aexpr -&gt; Aexpr -&gt; Bexpr\na1 =/= a2  =  Distintos a1 a2\n\n(&lt;.=) :: Aexpr -&gt; Aexpr -&gt; Bexpr\na1 &lt;.= a2  =  MenorOigual a1 a2\n\n(&gt;.=) :: Aexpr -&gt; Aexpr -&gt; Bexpr\na1 &gt;.= a2  =  MayorOigual a1 a2\n\n\ncrearEntero :: [Int] -&gt; Entero\ncrearEntero []     = error \"No se puede crear un Entero con la lista vacia\"\ncrearEntero (n:ns) = foldl f aux ns\n  where\n    f ent 0 = N2 ent Cero\n    f ent 1 = N2 ent Uno\n    aux     = if (n == 0) then (N1 Cero) else (N1 Uno)\n\n\nmkEnt :: String -&gt; Entero\nmkEnt = crearEntero . map digitToInt\n\n\n{- PRUEBAS EN PANTALLA\n*While&gt; mkEnt \"100\"\nN2 (N2 (N1 Uno) Cero) Cero\n*While&gt; semanticaN (mkEnt \"100\")\n4\n*While&gt; semanticaN (mkEnt \"112\")\n*** Exception: While.hs:(41,5)-(42,24): Non-exhaustive patterns in function f\n-}\n\n\na1 = Sum (A2 (Avar \"x\")) (A1 (N1 Uno))\nx = Avar \"x\"\ny = Avar \"y\"\nz = Avar \"z\"\nm = Avar \"m\"\nn = Avar \"n\"\nn0 = (N1 Cero)\nn1 = (N1 Uno)\nn2 = mkEnt \"10\"\nn3 = mkEnt \"11\"\nn4 = mkEnt \"100\"\nn5 = mkEnt \"101\"\nn6 = mkEnt \"110\"\nn7 = mkEnt \"111\"\nn8 = mkEnt \"1000\"\nn9 = mkEnt \"1001\"\nn10 = mkEnt \"1010\"\nn11 = mkEnt \"1011\"\na2 = Rest (Sum (A2 x) (A2 y)) (Mult (A2 z) (A1 n5))\nm' = A2 m\nn' = A2 n\n\n\n\nfactorial :: Stm\nfactorial = (y =: (A1 n1)) .: (Mientras (NO (Iguales (A2 x) (A1 n1))) ((y=:(Mult (A2 y) (A2 x))) .: (x=:(Rest (A2 x) (A1 n1)))))\n\n\nstateA1 :: Astate\nstateA1 (Avar \"_\") = 5\n\nstateB1 :: Bstate\nstateB1 _ = True\n\n\neuclides :: Stm\neuclides = Mientras (NO (m' =.= n')) (Si (m' &lt;.= n') (n =: (n' &gt;- m')) (m =: (m' &gt;- n'))) \n\nstA1 :: Astate\nstA1 (Avar x) = if x==\"n\" then 20 else (if x==\"m\" then 8 else 0)\n\n\nprobandoShow :: Stm\nprobandoShow = Si Verdadero euclides factorial\n\n\n{- pruebas en pantalla:\n*While&gt; :t   fst $ semanticaSTM (factorial, stateA1, stateB1) \nfst $ semanticaSTM (factorial, stateA1, stateB1) :: Astate\n*While&gt; let aux = fst $ semanticaSTM (factorial, stateA1, stateB1) in map aux [x,y]\n[1,120]\n(0.03 secs, 7942288 bytes)\n*While&gt; let aux = fst $ semanticaSTM (factorial, const 16, stateB1) in map aux [x,y]\n[1,20922789888000]\n(0.02 secs, 0 bytes)\n*While&gt; product [1..16]\n20922789888000\n(0.00 secs, 0 bytes)\n*While&gt; let aux = fst $ semanticaSTM (factorial, const 20, stateB1) in map aux [x,y]\n[1,2432902008176640000]\n(0.02 secs, 0 bytes)\n*While&gt; let aux = fst $ semanticaSTM (factorial, const 21, stateB1) in map aux [x,y]\n[1,-4249290049419214848]\n(0.00 secs, 0 bytes)\n\n*WhileV3&gt;  let aux = fst $ semanticaSTM (euclides, stA1, stateB1) in map aux [n,m]\n[4,4]\n-}\n\n\n\n\n\n-- instance Eq Entero where\n--   n1 == n2 = (semanticaN n1) == (semanticaN n2)\n\n-- instance Ord Entero where\n--   compare n1 n2 = compare (semanticaN n1) (semanticaN n2)\n\n\ninstance Show Aexpr where\n  show (A1 n)        = (show . semanticaN) n\n  show (A2 (Avar x)) = x\n  show (Sum a1 a2)   = '(' : (show a1) ++ \" + \" ++ (show a2) ++ \")\"\n  show (Mult a1 a2)  = '(' : (show a1) ++ \" * \" ++ (show a2) ++ \")\"\n  show (Rest a1 a2)  = '(' : (show a1) ++ \" - \" ++ (show a2) ++ \")\"\n\n\ninstance Show Bexpr where\n  show Verdadero = \"Verdadero\"\n  show Falso     = \"Falso\"\n  show (Iguales a1 a2)     = '(' : (show a1) ++ \" = \" ++ (show a2) ++ \")\"\n  show (Distintos a1 a2)   = '(' : (show a1) ++ \" /= \" ++ (show a2) ++ \")\"\n  show (MayorOigual a1 a2) = '(' : (show a1) ++ \" &gt;= \" ++ (show a2) ++ \")\"\n  show (MenorOigual a1 a2) = '(' : (show a1) ++ \" &lt;= \" ++ (show a2) ++ \")\"\n  show (Mayor a1 a2)       = '(' : (show a1) ++ \" &gt; \" ++ (show a2) ++ \")\"\n  show (Menor a1 a2)       = '(' : (show a1) ++ \" &lt; \" ++ (show a2) ++ \")\"\n  show (B (Bvar x))        = x\n  show (NO bexpr)          = '(' : 'N' : 'o' : ' ' : (show bexpr) ++ \")\"\n  show (Y b1 b2)           = '(' : (show b1) ++ \" Y \" ++ (show b2) ++ \")\"\n  show (O b1 b2)           = '(' : (show b1) ++ \" O \" ++ (show b2) ++ \")\"\n  show (Entonces b1 b2)    = '(' : (show b1) ++ \" =&gt; \" ++ (show b2) ++ \")\"\n  show (Sii b1 b2)         = '(' : (show b1) ++ \" &lt;=&gt; \" ++ (show b2) ++ \")\"\n\n\ninstance Show Stm where\n  show s = \"\\n\" ++ showStm s 0 ++ \"\\n\"\n\n\nshowStm :: Stm -&gt; Int -&gt; String\nshowStm s n =  let esp k = take k (repeat ' ') in\n  case s of\n    (AssA (Avar x) a) -&gt; (esp n) ++ \"(\" ++ x ++ \" := \" ++ (show a) ++ \")\"\n    (AssB (Bvar y) b) -&gt; (esp n) ++ \"(\" ++ y ++ \" :== \" ++ (show b) ++ \")\"\n    Skip              -&gt; (esp n) ++ \"No hacer nada\"\n    (Comp s1 s2)      -&gt; (showStm s1 n) ++ \"; \\n\" ++ (showStm s2 n)\n    (Si b s1 s2)      -&gt; (esp n) ++ \"Si \" ++ (show b) ++ \"\\n\" ++ (esp $ n+2) ++ \"entonces \\n\" ++ (showStm s1 (n+4)) ++ \"\\n\" ++ (esp $ n+2) ++ \"en otro caso \\n\" ++ (showStm s2 (n+4))\n    (Mientras b s)    -&gt; (esp n) ++ \"Mientras se cumpla \" ++ (show b) ++ \" hacer \\n\" ++ (showStm s (n+4))\n    (Repetir s b)     -&gt; (esp n) ++ \"Repetir \" ++ \"\\n\" ++ (showStm s (n+4)) ++ \"\\n\" ++ (esp $ n+2) ++ \"hasta que \" ++ (show b)\n</code></pre>\n"}, {"tags": ["list", "haskell"], "comments": [{"owner": {"reputation": 2299, "user_id": 1018290, "user_type": "registered", "accept_rate": 76, "profile_image": "https://www.gravatar.com/avatar/113bcc8f198ab8a17839aab5f4f0776f?s=128&d=identicon&r=PG", "display_name": "Will Sewell", "link": "https://stackoverflow.com/users/1018290/will-sewell"}, "edited": false, "score": 1, "creation_date": 1458740738, "post_id": 36179868, "comment_id": 59994804, "body": "It is not clear what the sub-lists should be. Could you provide more examples?"}, {"owner": {"reputation": 39, "user_id": 6079242, "user_type": "registered", "accept_rate": 14, "profile_image": "https://www.gravatar.com/avatar/866e1ad926011e12fccc371a1f76ded5?s=128&d=identicon&r=PG&f=1", "display_name": "Sunil Gautam", "link": "https://stackoverflow.com/users/6079242/sunil-gautam"}, "reply_to_user": {"reputation": 2299, "user_id": 1018290, "user_type": "registered", "accept_rate": 76, "profile_image": "https://www.gravatar.com/avatar/113bcc8f198ab8a17839aab5f4f0776f?s=128&d=identicon&r=PG", "display_name": "Will Sewell", "link": "https://stackoverflow.com/users/1018290/will-sewell"}, "edited": false, "score": 1, "creation_date": 1458741119, "post_id": 36179868, "comment_id": 59995122, "body": "maybe sublist was wrong word to use.. i just want to split the big list to separate list where the values are around 3 . So from this [1.0, 2.0, 0.5, 2.5, 3.0, 1.1, 2.0] to [(1.0, 2.0),(0.5, 2.5),(3.0),(1.1,2.0)]"}, {"owner": {"reputation": 100185, "user_id": 3234959, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/93bb12ca0f93dfddb33880316f7e66c2?s=128&d=identicon&r=PG&f=1", "display_name": "chi", "link": "https://stackoverflow.com/users/3234959/chi"}, "edited": false, "score": 2, "creation_date": 1458742008, "post_id": 36179868, "comment_id": 59995853, "body": "To recap, your requirements are: <code>separate :: Double -&gt; [Double] -&gt; [[Double]]</code> such that <code>separate t xs = ys</code> implies <code>concat ys = xs</code> and (less formally) <code>all (near t . sum) ys</code> where <code>near t x</code> is a predicate stating that <code>x</code> is &quot;close&quot; to <code>t</code>."}], "answers": [{"tags": [], "owner": {"reputation": 62252, "user_id": 1435869, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/TrEd9.jpg?s=128&g=1", "display_name": "karakfa", "link": "https://stackoverflow.com/users/1435869/karakfa"}, "is_accepted": true, "score": 2, "last_activity_date": 1458741925, "creation_date": 1458741925, "answer_id": 36180440, "question_id": 36179868, "link": "https://stackoverflow.com/questions/36179868/haskell-split-list-determined-by-sum-value/36180440#36180440", "title": "Haskell split list determined by sum value", "body": "<p>a recursive function can be written as</p>\n\n<pre><code>split :: [Double] -&gt; [[Double]]\nsplit x = go x [] 0\n     where go [] _ _ = []\n           go (x:xs) acc s | x+s&gt;=3 = (acc++[x]) : go xs [] 0\n                           | otherwise = go xs (acc++[x]) (s+x) \n\nsplit [1.0,2.0,0.5,2.5,3.0,1.1,2.0]\n[[1.0,2.0],[0.5,2.5],[3.0],[1.1,2.0]]\n</code></pre>\n\n<p>carry an accumulator and sum so far, decide to carry forward or split based on the sum.</p>\n\n<p>Note that, this is constructing \"at least\", not \"near\". So all sublists will be greater or equal to 3.0.</p>\n"}], "owner": {"reputation": 39, "user_id": 6079242, "user_type": "registered", "accept_rate": 14, "profile_image": "https://www.gravatar.com/avatar/866e1ad926011e12fccc371a1f76ded5?s=128&d=identicon&r=PG&f=1", "display_name": "Sunil Gautam", "link": "https://stackoverflow.com/users/6079242/sunil-gautam"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 153, "favorite_count": 0, "accepted_answer_id": 36180440, "answer_count": 1, "score": 1, "last_activity_date": 1458743054, "creation_date": 1458740515, "last_edit_date": 1458743054, "question_id": 36179868, "link": "https://stackoverflow.com/questions/36179868/haskell-split-list-determined-by-sum-value", "title": "Haskell split list determined by sum value", "body": "<p>Hi all I am just a starter on Haskell. I have this list <code>[1.0, 2.0, 1.5, 1.5, n-1]</code>. How would I split this list to sub-list for example <code>[3.0, 3.0,etc]</code>. That is when added the values of the list, when the sum equals the given number(in this case 3), separates the list. I hope this question makes sense. Could someone point me out if there is a function in <code>Data.List</code> which can do this? or even the <code>filter</code> function. The only thing I have so far is:</p>\n\n<pre><code>import Data.List \n\nimport Text.Printf\n\n\n--separate :: [Double] -&gt; [(Double)]\n\nseparate = sum [1.0, 2.0, 0.5, 2.5, 3.0, 1.1, 2.0] -- [(1.0, 2.0),(0.5, 2.5),(3.0),(1.1,2.0)] (desired list)\n\n\n\nmain = do\n putStrLn (printf \"list :  %s\" $ show separate)   \n</code></pre>\n\n<hr>\n\n<p>More precisely, the requirements are:</p>\n\n<pre><code>separate :: Double -&gt; [Double] -&gt; [[Double]]\n</code></pre>\n\n<p>where <code>separate t xs = ys</code> implies</p>\n\n<ol>\n<li><code>concat ys = xs</code></li>\n<li><code>all (near t . sum) ys</code>, where <code>near t x</code> is a predicate stating that <code>x</code> is \"close\" to <code>t</code> (semi-formal requirement).</li>\n</ol>\n"}, {"tags": ["haskell", "type-inference", "type-families"], "answers": [{"comments": [{"owner": {"reputation": 2231, "user_id": 1027321, "user_type": "registered", "accept_rate": 70, "profile_image": "https://i.stack.imgur.com/KkFZC.jpg?s=128&g=1", "display_name": "jakubdaniel", "link": "https://stackoverflow.com/users/1027321/jakubdaniel"}, "edited": false, "score": 0, "creation_date": 1458743635, "post_id": 36176391, "comment_id": 59997168, "body": "regarding the last example, could you write <code>top @d</code> at the class level in GHC8?"}, {"owner": {"reputation": 28873, "user_id": 1068232, "user_type": "registered", "accept_rate": 79, "profile_image": "https://www.gravatar.com/avatar/2a0a145ce58c20013969fe3f203531da?s=128&d=identicon&r=PG", "display_name": "Andr&#225;s Kov&#225;cs", "link": "https://stackoverflow.com/users/1068232/andr%c3%a1s-kov%c3%a1cs"}, "reply_to_user": {"reputation": 2231, "user_id": 1027321, "user_type": "registered", "accept_rate": 70, "profile_image": "https://i.stack.imgur.com/KkFZC.jpg?s=128&g=1", "display_name": "jakubdaniel", "link": "https://stackoverflow.com/users/1027321/jakubdaniel"}, "edited": false, "score": 0, "creation_date": 1458749179, "post_id": 36176391, "comment_id": 60001627, "body": "I think we can&#39;t. By default, <code>forall</code>-bound type variables can be <code>@</code>-applied, but we can&#39;t write <code>forall d.</code> in the <code>Domain</code> method types, obviously. I&#39;ve found that <code>@</code> works fine on class methods, and can be used in the order of the class type parameters."}], "tags": [], "owner": {"reputation": 28873, "user_id": 1068232, "user_type": "registered", "accept_rate": 79, "profile_image": "https://www.gravatar.com/avatar/2a0a145ce58c20013969fe3f203531da?s=128&d=identicon&r=PG", "display_name": "Andr&#225;s Kov&#225;cs", "link": "https://stackoverflow.com/users/1068232/andr%c3%a1s-kov%c3%a1cs"}, "is_accepted": true, "score": 9, "last_activity_date": 1458731484, "last_edit_date": 1458731484, "creation_date": 1458731018, "answer_id": 36176391, "question_id": 36175839, "link": "https://stackoverflow.com/questions/36175839/type-ambiguity-in-haskell-type-families/36176391#36176391", "title": "Type ambiguity in Haskell type families", "body": "<p>In your case, associated types aren't enough to infer the types of the methods. </p>\n\n<p>You have class <code>Domain d</code>, and <code>Set</code> and <code>Engine</code> are associated to <code>d</code>. This means that whenever there is a known <code>d</code> in our program with a known <code>Domain d</code> instance, GHC can resolve <code>Set d</code> and <code>Engine d</code>. But this doesn't work backwards. GHC can't resolve <code>d</code> or a <code>Domain</code> instance from the presence of a <code>Set d</code> or an <code>Engine d</code>, since it's entirely possible that there are different <code>Domain</code> instances with the same <code>Set</code> and <code>Engine</code> types. </p>\n\n<p>Since your class methods only mention <code>Set</code> and <code>Engine</code>, <code>Domain d</code>  can never be inferred from method use. </p>\n\n<p>You could do a couple of things depending on your goals.</p>\n\n<p>First, you could make <code>d</code> depend on <code>Set</code> and <code>Engine</code>:</p>\n\n<pre><code>class Domain set engine where\n  type DomainOf set engine :: *\n  -- ...\n</code></pre>\n\n<p>More generally, <a href=\"https://downloads.haskell.org/~ghc/latest/docs/html/users_guide/type-class-extensions.html#functional-dependencies\"><code>FunctionalDependencies</code></a> gives you much more flexibility to enforce dependencies between types. For example, you can specifically declare that there is only one <code>d</code> for each <code>Set</code>, which is enough to recover good type inference:</p>\n\n<pre><code>class Domain d set engine | d -&gt; set engine, set -&gt; d where\n\n    top        :: engine set\n    complement :: set -&gt; engine set\n    exclude    :: set -&gt; set -&gt; engine set\n\ndata TrivialDomain = TrivialDomain\n\ninstance Domain TrivialDomain [Int] IO where\n\n    top = return [0..10]\n\n    complement a = top &gt;&gt;= (flip exclude) a\n\n    exclude a b  = return $ filter (not . (`elem` b)) a\n</code></pre>\n\n<p>Finally, if you want to use your original class, you have to add <code>Proxy d</code> parameters to your methods, in order to make the instance and the associated types resolvable:</p>\n\n<pre><code>import Data.Proxy\n\ndata Transition = Transition\n\nclass Domain d where\n    type Set d\n    type Engine d :: * -&gt; *\n\n    top        :: Proxy d -&gt; Engine d (Set d)\n    complement :: Proxy d -&gt; Set d -&gt; Engine d (Set d)\n    exclude    :: Proxy d -&gt; Set d -&gt; Set d -&gt; Engine d (Set d)\n\ndata TrivialDomain = TrivialDomain\n\ninstance Domain TrivialDomain where\n    type Set TrivialDomain = [Int]\n    type Engine TrivialDomain = IO\n\n    top _ = return [0..10]\n\n    complement d a = top d &gt;&gt;= (flip (exclude d)) a\n    exclude d a b  = return $ filter (not . (`elem` b)) a\n</code></pre>\n\n<p>Here, the purpose of <code>Proxy d</code> is to specify exactly which instance you want to use. </p>\n\n<p>However, this means we have to write <code>top (Proxy :: Proxy d)</code> on each method usage (similarly with other methods), which is rather onerous. With GHC 8 we can omit <code>Proxy</code>s and use <a href=\"https://ghc.haskell.org/trac/ghc/wiki/TypeApplication\"><code>TypeApplications</code></a> instead:</p>\n\n<pre><code>{-# language TypeApplications, TypeFamilies #-}\n\n-- ...\n\ninstance Domain TrivialDomain where\n    type Set TrivialDomain = [Int]\n    type Engine TrivialDomain = IO\n\n    top = return [0..10]\n\n    complement a = top @TrivialDomain &gt;&gt;= (flip (exclude @TrivialDomain)) a\n    exclude a b = return $ filter (not . (`elem` b)) a\n</code></pre>\n"}], "owner": {"reputation": 2231, "user_id": 1027321, "user_type": "registered", "accept_rate": 70, "profile_image": "https://i.stack.imgur.com/KkFZC.jpg?s=128&g=1", "display_name": "jakubdaniel", "link": "https://stackoverflow.com/users/1027321/jakubdaniel"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 196, "favorite_count": 0, "accepted_answer_id": 36176391, "answer_count": 1, "score": 6, "last_activity_date": 1458742704, "creation_date": 1458729531, "last_edit_date": 1458742704, "question_id": 36175839, "link": "https://stackoverflow.com/questions/36175839/type-ambiguity-in-haskell-type-families", "title": "Type ambiguity in Haskell type families", "body": "<p>I am trying put together the following class <code>Domain</code> and its instance <code>TrivialDomain</code></p>\n\n<pre><code>{-# LANGUAGE TypeFamilies #-}\n\ndata Transition = Transition\n\nclass Domain d where\n    type Set d\n    type Engine d :: * -&gt; *\n\n    top :: Engine d (Set d)\n\n    -- ...\n    complement :: Set d -&gt; Engine d (Set d)\n    exclude    :: Set d -&gt; Set d -&gt; Engine d (Set d)\n    -- ...\n\ndata TrivialDomain = TrivialDomain\n\ninstance Domain TrivialDomain where\n    type Set TrivialDomain = [Int]\n    type Engine TrivialDomain = IO\n\n    top = return [0..10]\n\n    -- ...\n    complement a = top &gt;&gt;= (flip exclude) a\n    exclude a b  = return $ filter (not . (`elem` b)) a\n    -- ...\n</code></pre>\n\n<p>but I keep getting the following error which I fail to understand</p>\n\n<pre><code>test3.hs:25:21:\n    Couldn't match type \u2018Engine d0\u2019 with \u2018IO\u2019\n    The type variable \u2018d0\u2019 is ambiguous\n    Expected type: IO (Set d0)\n      Actual type: Engine d0 (Set d0)\n    In the first argument of \u2018(&gt;&gt;=)\u2019, namely \u2018top\u2019\n    In the expression: top &gt;&gt;= (flip exclude) a\ntest3.hs:25:35:\n    Couldn't match type \u2018Set d1\u2019 with \u2018[Int]\u2019\n    The type variable \u2018d1\u2019 is ambiguous\n    Expected type: Set d0 -&gt; [Int] -&gt; IO [Int]\n      Actual type: Set d1 -&gt; Set d1 -&gt; Engine d1 (Set d1)\n    In the first argument of \u2018flip\u2019, namely \u2018exclude\u2019\n    In the second argument of \u2018(&gt;&gt;=)\u2019, namely \u2018(flip exclude) a\u2019\n</code></pre>\n\n<p>I would expect <code>Engine d (Set d)</code> to resolve to <code>IO [Int]</code> in the instance declaration, which does not seem to be the case. At least GHC does not think so. What am I missing?</p>\n"}, {"tags": ["haskell", "haskell-pipes"], "answers": [{"comments": [{"owner": {"reputation": 315, "user_id": 5367513, "user_type": "registered", "accept_rate": 89, "profile_image": "https://www.gravatar.com/avatar/7bc3967ca71ebcd3dbb20b5b7552a904?s=128&d=identicon&r=PG&f=1", "display_name": "Jan Syn&#225;\u010dek", "link": "https://stackoverflow.com/users/5367513/jan-syn%c3%a1%c4%8dek"}, "edited": false, "score": 0, "creation_date": 1459253884, "post_id": 36175883, "comment_id": 60193863, "body": "Thanks! I just realized pipes-safe was mentioned in the conclusion section of the pipes tutorial. It&#39;s quite hidden there..."}], "tags": [], "owner": {"reputation": 28873, "user_id": 1068232, "user_type": "registered", "accept_rate": 79, "profile_image": "https://www.gravatar.com/avatar/2a0a145ce58c20013969fe3f203531da?s=128&d=identicon&r=PG", "display_name": "Andr&#225;s Kov&#225;cs", "link": "https://stackoverflow.com/users/1068232/andr%c3%a1s-kov%c3%a1cs"}, "is_accepted": true, "score": 3, "last_activity_date": 1458729644, "creation_date": 1458729644, "answer_id": 36175883, "question_id": 36174670, "link": "https://stackoverflow.com/questions/36174670/catching-exceptions-in-monad-transformers/36175883#36175883", "title": "Catching exceptions in monad transformers", "body": "<p>You can import <code>bracket</code>, <code>handle</code> and other exception handling facilities from <a href=\"https://hackage.haskell.org/package/pipes-safe\" rel=\"nofollow\"><code>Pipes.Safe</code></a>. </p>\n"}], "owner": {"reputation": 315, "user_id": 5367513, "user_type": "registered", "accept_rate": 89, "profile_image": "https://www.gravatar.com/avatar/7bc3967ca71ebcd3dbb20b5b7552a904?s=128&d=identicon&r=PG&f=1", "display_name": "Jan Syn&#225;\u010dek", "link": "https://stackoverflow.com/users/5367513/jan-syn%c3%a1%c4%8dek"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 90, "favorite_count": 1, "accepted_answer_id": 36175883, "answer_count": 1, "score": 1, "last_activity_date": 1458729644, "creation_date": 1458726423, "question_id": 36174670, "link": "https://stackoverflow.com/questions/36174670/catching-exceptions-in-monad-transformers", "title": "Catching exceptions in monad transformers", "body": "<p>I'm using haskell-pipes to recursively traverse a directory and print the files. How do I handle exceptions from the Producer, which is a monad transformer? <code>bracket</code> and <code>handle</code> do not work in this case.</p>\n\n<pre><code>import Control.Exception (handle, SomeException(..))\nimport Control.Monad (unless)\nimport System.FilePath.Posix ((&lt;/&gt;))\nimport Pipes\nimport qualified Pipes.Prelude as P\nimport System.Posix.Directory (DirStream, openDirStream, closeDirStream, readDirStream)\nimport System.Posix.Files (getFileStatus, isDirectory)\n\nproduceFiles :: DirStream -&gt; Producer FilePath IO ()\nproduceFiles ds = do\n  path &lt;- lift $ readDirStream ds\n  yield path\n  unless (path == \"\") $ produceFiles ds\n\ngetDC :: FilePath -&gt; Producer FilePath IO ()\ngetDC top = do\n  {-\n    lift $ handle (\\(SomeException e) -&gt; putStrLn (show e)) $ do\n    ds &lt;- openDirStream top\n    -- DOESN'T WORK: produceFiles ds\n    -- I would have to \"delift\" the above somehow.\n    closeDirStream ds\n  -}\n  ds &lt;- lift $ openDirStream top\n  produceFiles ds\n  lift $ closeDirStream ds\n\ngetDC' :: FilePath -&gt; Producer FilePath IO ()\ngetDC' top = getDC top &gt;-&gt; P.filter (`notElem` [\".\", \"..\"]) &gt;-&gt; P.map (top&lt;/&gt;)\n\ngetDCR :: FilePath -&gt; Producer FilePath IO ()\ngetDCR top = for (getDC' top) $ \\f -&gt; do\n  st &lt;- lift $ getFileStatus f\n  if isDirectory st &amp;&amp; f /= top\n  then getDCR f\n  else yield f\n\ntest top = runEffect $ for (getDCR top) (lift . putStrLn)\n\nmain = test \"/usr/share\"\n</code></pre>\n"}, {"tags": ["haskell"], "answers": [{"comments": [{"owner": {"reputation": 505, "user_id": 3369350, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/BAkyN.jpg?s=128&g=1", "display_name": "jvrn3", "link": "https://stackoverflow.com/users/3369350/jvrn3"}, "edited": false, "score": 0, "creation_date": 1458698744, "post_id": 36168523, "comment_id": 59974284, "body": "Sorry, but I meant the number &quot;85&quot; was the line 85."}, {"owner": {"reputation": 505, "user_id": 3369350, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/BAkyN.jpg?s=128&g=1", "display_name": "jvrn3", "link": "https://stackoverflow.com/users/3369350/jvrn3"}, "edited": false, "score": 1, "creation_date": 1458699712, "post_id": 36168523, "comment_id": 59974493, "body": "Thank you, I&#39;ll be using GHC from now on"}], "tags": [], "owner": {"reputation": 11780, "user_id": 2827654, "user_type": "registered", "accept_rate": 57, "profile_image": "https://www.gravatar.com/avatar/a171742e9c31a541d4d2031af932e94a?s=128&d=identicon&r=PG&f=1", "display_name": "jamshidh", "link": "https://stackoverflow.com/users/2827654/jamshidh"}, "is_accepted": true, "score": 3, "last_activity_date": 1458700320, "last_edit_date": 1495542687, "creation_date": 1458698366, "answer_id": 36168523, "question_id": 36168469, "link": "https://stackoverflow.com/questions/36168469/syntax-error-in-instance-head-variable-expected/36168523#36168523", "title": "Syntax error in instance head (variable expected)", "body": "<p>It compiled for me, but I had to fix the indentation (<code>lequiv</code> needed to be at the same level as valid), and add the <code>FlexibleInstances</code> language extension using</p>\n\n<pre><code>{-# LANGUAGE FlexibleInstances #-}\n</code></pre>\n\n<p>(I am using GHC, I am not sure what the equivalent for HUGS is)</p>\n\n<hr>\n\n<p>Additional info:</p>\n\n<p>The last answer in <a href=\"https://stackoverflow.com/questions/10551210/instance-show-for-function\">Instance Show for function</a> shows you how to use <code>FlexibleInstances</code> in Hugs.</p>\n"}], "owner": {"reputation": 505, "user_id": 3369350, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/BAkyN.jpg?s=128&g=1", "display_name": "jvrn3", "link": "https://stackoverflow.com/users/3369350/jvrn3"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 133, "favorite_count": 0, "accepted_answer_id": 36168523, "answer_count": 1, "score": 0, "last_activity_date": 1458700340, "creation_date": 1458697956, "last_edit_date": 1458700340, "question_id": 36168469, "link": "https://stackoverflow.com/questions/36168469/syntax-error-in-instance-head-variable-expected", "title": "Syntax error in instance head (variable expected)", "body": "<p>I'm reading the book \"The Haskell Road to Logic, Math and Programming\" and I download their code from the second chapter(<a href=\"http://homepages.cwi.nl/~jve/HR/\" rel=\"nofollow\">http://homepages.cwi.nl/~jve/HR/</a>), but when I try to compile the code, it doesn't work. </p>\n\n<p>The error message is: </p>\n\n<pre><code>TAMO.hs:85 - Syntax error in instance head (variable expected)\n</code></pre>\n\n<p>What variable is expected? I've never used Haskell before and have no idea what the compiler(Hugs) want me to do to fix it.</p>\n\n<pre><code>class TF p where \n  valid :: p -&gt; Bool\n  lequiv :: p -&gt; p -&gt; Bool\ninstance TF Bool\n  where\n  valid  = id\n  lequiv f g = f == g\n\ninstance TF p =&gt; TF (Bool -&gt; p)\n  where\n  valid f = valid (f True) &amp;&amp; valid (f False)\n  lequiv f g = (f True) `lequiv` (g True)\n           &amp;&amp; (f False) `lequiv` (g False)\n</code></pre>\n"}, {"tags": ["haskell", "cabal", "haskell-stack"], "answers": [{"comments": [{"owner": {"reputation": 572, "user_id": 863027, "user_type": "registered", "accept_rate": 40, "profile_image": "https://www.gravatar.com/avatar/bd11f58576579f062e8e699b467e808d?s=128&d=identicon&r=PG", "display_name": "Prakash Rajagaopal", "link": "https://stackoverflow.com/users/863027/prakash-rajagaopal"}, "edited": false, "score": 0, "creation_date": 1458702746, "post_id": 36168504, "comment_id": 59975319, "body": "Ya its 7.10.2 because of the resolver. We are exporting a bunch of haskell functions as an FFI in a shared lib , so its a shared lib - hence the so. Wouldn&#39;t this imply that I&#39;ll have to write a separate condition for each version ? Any chance I can substitute a variable in cabal flags ? Also thanks for the reply"}, {"owner": {"reputation": 572, "user_id": 863027, "user_type": "registered", "accept_rate": 40, "profile_image": "https://www.gravatar.com/avatar/bd11f58576579f062e8e699b467e808d?s=128&d=identicon&r=PG", "display_name": "Prakash Rajagaopal", "link": "https://stackoverflow.com/users/863027/prakash-rajagaopal"}, "edited": false, "score": 0, "creation_date": 1458703048, "post_id": 36168504, "comment_id": 59975398, "body": "Yes , it works and the lib also works well as an FFI. Its just that it is hard coded to 7.10.2 now , which means that it&#39;ll invariably fail the next time we change the resolver"}, {"owner": {"reputation": 3075, "user_id": 1164871, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/4d6a54a3752ab47170d790085935988f?s=128&d=identicon&r=PG", "display_name": "mgsloan", "link": "https://stackoverflow.com/users/1164871/mgsloan"}, "reply_to_user": {"reputation": 572, "user_id": 863027, "user_type": "registered", "accept_rate": 40, "profile_image": "https://www.gravatar.com/avatar/bd11f58576579f062e8e699b467e808d?s=128&d=identicon&r=PG", "display_name": "Prakash Rajagaopal", "link": "https://stackoverflow.com/users/863027/prakash-rajagaopal"}, "edited": false, "score": 0, "creation_date": 1458794437, "post_id": 36168504, "comment_id": 60020989, "body": "I don&#39;t think you can substitute a variable in cabal flags.  If you do find a good way to do that bit, you can get the GHC version by doing &quot;stack exec -- ghc-pkg field ghc version --simple-output&quot;.  So something like roughly <code>stack build --ghc-options -lHSrts-ghc$(stack exec -- ghc-pkg field ghc version --simple-output)</code> could do it"}], "tags": [], "owner": {"reputation": 3075, "user_id": 1164871, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/4d6a54a3752ab47170d790085935988f?s=128&d=identicon&r=PG", "display_name": "mgsloan", "link": "https://stackoverflow.com/users/1164871/mgsloan"}, "is_accepted": false, "score": 3, "last_activity_date": 1458698217, "creation_date": 1458698217, "answer_id": 36168504, "question_id": 36167737, "link": "https://stackoverflow.com/questions/36167737/how-to-link-to-haskell-static-runtime-with-cabal-and-stack-without-hard-coding-g/36168504#36168504", "title": "How to link to Haskell static runtime with cabal and stack without hard coding ghc version?", "body": "<p>Does that cabal file work?  If so, then it should be sufficient to do something like this:</p>\n\n<pre><code>executable libsxp.so\n    ghc-options: -shared -dynamic -fPIC\n    if impl (ghc &gt;= 7.10.2 &amp;&amp; &lt; 7.10.3)\n        ghc-options: -lHSrts-ghc7.10.2\n    else if impl (ghc &gt;= 7.10.3 &amp;&amp; &lt; 7.10.4)\n        ghc-options: -lHSrts-ghc7.10.3\n    else if ...\n</code></pre>\n\n<p>BTW, why does your executable end in .so?  I've never seen that in an executable clause.</p>\n\n<p>Are you sure you're using 7.10.2 and not 7.10.3?  Try <code>stack exec -- ghc --version</code></p>\n"}, {"tags": [], "owner": {"reputation": 113, "user_id": 1663197, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/b7c055b7bb6a0bbbbd3e71fd90e1a346?s=128&d=identicon&r=PG", "display_name": "AleXoundOS", "link": "https://stackoverflow.com/users/1663197/alexoundos"}, "is_accepted": false, "score": 1, "last_activity_date": 1476302913, "last_edit_date": 1495541970, "creation_date": 1476221123, "answer_id": 39987005, "question_id": 36167737, "link": "https://stackoverflow.com/questions/36167737/how-to-link-to-haskell-static-runtime-with-cabal-and-stack-without-hard-coding-g/39987005#39987005", "title": "How to link to Haskell static runtime with cabal and stack without hard coding ghc version?", "body": "<p>The general principle is described in this answer: <a href=\"https://stackoverflow.com/a/6034881/1663197\">https://stackoverflow.com/a/6034881/1663197</a></p>\n\n<blockquote>\n  <p>Using the configure style in Cabal, you can write a little configure\n  script that substitutes a variable for the output of the sdl-config\n  command. The values will then be replaced in a $foo.buildinfo.in file,\n  yielding a $foo.buildinfo file, that Cabal will include in the build\n  process.</p>\n</blockquote>\n\n<hr>\n\n<p>First you need to switch your cabal <code>build-type</code> to <code>Configure</code> in project.cabal. Configure style is described in <a href=\"https://www.haskell.org/cabal/users-guide/developing-packages.html#system-dependent-parameters\" rel=\"nofollow noreferrer\">cabal users guide</a>. For build type <code>Configure</code> the contents of Setup.hs must be:</p>\n\n<pre><code>import Distribution.Simple\nmain = defaultMainWithHooks autoconfUserHooks\n</code></pre>\n\n<p>In case of handling GHC runtime version you can have a variable <code>@GHC_VERSION@</code> corresponding to it in a <strong><em>project</em>.buildinfo.in</strong> file:</p>\n\n<pre><code>ghc-options: -lHSrts-ghc@GHC_VERSION@\n</code></pre>\n\n<p>Finally you write a <strong>configure</strong> bash script that gets GHC version as mgsloan suggested and generates <strong><em>project</em>.buildinfo</strong> file by substitution of <code>@GHC_VERSION@</code> varibale in <strong><em>project</em>.buildinfo.in</strong> file:</p>\n\n<pre><code>GHC_VERSION=$(stack exec -- ghc-pkg field ghc version --simple-output)\nsed 's,@GHC_VERSION@,'\"$GHC_VERSION\"',' project.buildinfo.in &gt; project.buildinfo\n</code></pre>\n\n<p>This way when build is started it will first execute <strong>configure</strong> script, then read <strong>project.buildinfo</strong> file and merge with <strong>project.cabal</strong>.</p>\n\n<hr>\n\n<p>Also it may be worth to populate <code>extra-source-files</code> with configure and \nproject.buildinfo.in; <code>extra-tmp-files</code> with project.buildinfo in <strong>project.cabal</strong>.</p>\n\n<p>A more sophisticated solution may be inspired by this answer: <a href=\"https://stackoverflow.com/a/2940799/1663197\">https://stackoverflow.com/a/2940799/1663197</a></p>\n"}], "owner": {"reputation": 572, "user_id": 863027, "user_type": "registered", "accept_rate": 40, "profile_image": "https://www.gravatar.com/avatar/bd11f58576579f062e8e699b467e808d?s=128&d=identicon&r=PG", "display_name": "Prakash Rajagaopal", "link": "https://stackoverflow.com/users/863027/prakash-rajagaopal"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 378, "favorite_count": 1, "answer_count": 2, "score": 4, "last_activity_date": 1476302913, "creation_date": 1458692980, "last_edit_date": 1458713542, "question_id": 36167737, "link": "https://stackoverflow.com/questions/36167737/how-to-link-to-haskell-static-runtime-with-cabal-and-stack-without-hard-coding-g", "title": "How to link to Haskell static runtime with cabal and stack without hard coding ghc version?", "body": "<p>I have a project which exports a shared static library and I use the following part in my <code>project.cabal</code> file</p>\n\n<pre><code>executable libsxp.so\n    main-is:       Somefile.hs\n    default-language: Haskell2010\n    ghc-options: -shared -dynamic -fPIC -lHSrts-ghc7.10.2\n</code></pre>\n\n<p>The version of GHC is controlled using Stack, so is there a way wherein I can either get and append the version to make <code>-lHSrts-ghc{version}</code> or is there some config for it? I tried setting </p>\n\n<pre><code>stack build --ghc-options='-O0 -lHSrts-ghc7.10.2' \n</code></pre>\n\n<p>but it doesn't seem to pick it.</p>\n\n<p>Also to clarify, <code>cabal install</code> is called by Stack and not by me.</p>\n"}, {"tags": ["haskell", "stm"], "comments": [{"owner": {"reputation": 15757, "user_id": 176841, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/45a168cb9eb8454d66c78f18e29d9342?s=128&d=identicon&r=PG", "display_name": "jberryman", "link": "https://stackoverflow.com/users/176841/jberryman"}, "edited": false, "score": 0, "creation_date": 1458690202, "post_id": 36165340, "comment_id": 59971796, "body": "I didn&#39;t read your question carefully, but <code>TChan</code> is a dead-simple <code>([a], [a])</code> functional dequeue; it sounds like it might make sense for you to implement your own variation on it."}, {"owner": {"reputation": 60057, "user_id": 1333025, "user_type": "registered", "accept_rate": 65, "profile_image": "https://www.gravatar.com/avatar/79ab43010f900324ac5e2de19a2916cb?s=128&d=identicon&r=PG", "display_name": "Petr", "link": "https://stackoverflow.com/users/1333025/petr"}, "edited": false, "score": 0, "creation_date": 1458931664, "post_id": 36165340, "comment_id": 60083084, "body": "Let me ask: How many threads (at least a rough number) are expected to access the structure? And how many of them at a single time? How large do you expect the list of changes to grow?"}, {"owner": {"reputation": 60057, "user_id": 1333025, "user_type": "registered", "accept_rate": 65, "profile_image": "https://www.gravatar.com/avatar/79ab43010f900324ac5e2de19a2916cb?s=128&d=identicon&r=PG", "display_name": "Petr", "link": "https://stackoverflow.com/users/1333025/petr"}, "edited": false, "score": 0, "creation_date": 1458932310, "post_id": 36165340, "comment_id": 60083450, "body": "Also do you need to compose <code>update</code> with other <code>STM</code> operations, or does it always run in its own transaction?"}, {"owner": {"reputation": 219, "user_id": 4625247, "user_type": "registered", "accept_rate": 25, "profile_image": "https://i.stack.imgur.com/cbHw8.gif?s=128&g=1", "display_name": "Mikhail Puzanov", "link": "https://stackoverflow.com/users/4625247/mikhail-puzanov"}, "edited": false, "score": 0, "creation_date": 1459896020, "post_id": 36165340, "comment_id": 60491432, "body": "Sorry for the late reply. I don&#39;t expect big load, but there could be bursts, something like several dozens of simultaneous requests. The dataset is supposed to be pretty small (hundreds of thousands of elements) but frequently updated. And I don&#39;t expect this to be a part of larger transactions."}], "answers": [{"comments": [{"owner": {"reputation": 219, "user_id": 4625247, "user_type": "registered", "accept_rate": 25, "profile_image": "https://i.stack.imgur.com/cbHw8.gif?s=128&g=1", "display_name": "Mikhail Puzanov", "link": "https://stackoverflow.com/users/4625247/mikhail-puzanov"}, "edited": false, "score": 0, "creation_date": 1458921413, "post_id": 36166702, "comment_id": 60077869, "body": "I&#39;ve added an answer with some actual measurements, so it pretty much doesn&#39;t matter which implementation of the change log I use, compared to other expenses."}], "tags": [], "owner": {"reputation": 10108, "user_id": 450811, "user_type": "registered", "accept_rate": 77, "profile_image": "https://www.gravatar.com/avatar/b1a81486c967643c2f05cddb94841d27?s=128&d=identicon&r=PG", "display_name": "Waldheinz", "link": "https://stackoverflow.com/users/450811/waldheinz"}, "is_accepted": false, "score": 3, "last_activity_date": 1458738884, "last_edit_date": 1458738884, "creation_date": 1458686978, "answer_id": 36166702, "question_id": 36165340, "link": "https://stackoverflow.com/questions/36165340/stm-friendly-list-as-a-change-log/36166702#36166702", "title": "STM-friendly list as a change log", "body": "<p>I'd probably just go with the list and see how far it takes performance-wise. Given that, you should consider that both, appending to the end of a list and reversing it are O(n) operations, so you should try to avoid this. Maybe you can just prepend the incoming changes like this:</p>\n\n<pre><code>update dataSet existingChanges newChange = do\n  -- ...\n  return (dataSet, newChange : existingChanges)\n</code></pre>\n\n<p>Also, your example for flush has the problem that reading and updating the state is not atomic at all. You must accomplish this using a single <code>atomically</code> call like so:</p>\n\n<pre><code>flush data = do\n  (dataSet, changes) &lt;- atomically $ do\n    result &lt;- readTVar data_\n    writeTVar data_ (dataSet, [])\n    return result\n\n  -- write them both to FS\n  -- ...\n</code></pre>\n\n<p>You could then just write them out in reverse order (because now <code>changes</code> contains the elements from newest to oldest) or reverse here once if it's important to write them out oldest to newest. If that's important I'd probably go with some data structure which allows O(1) element access like a good old vector.</p>\n\n<p>When using a fixed-size vector you would obviously have to deal with the problem that it can become \"full\" which would mean your writers would have to wait for <code>flush</code> to do it's job before adding fresh changes. That's why I'd personally go for the simple list first and see if it's sufficient or where it needs to be improved.</p>\n\n<p>PS: A <a href=\"https://hackage.haskell.org/package/dequeue-0.1.12/docs/Data-Dequeue.html\" rel=\"nofollow\">dequeue</a> might be a good fit for your problem as well, but going fixed size forces you to deal with the problem that your writers can potentially produce more changes than your reader can flush out. The dequeue can grow infinitely, but you your RAM probably isn't. And the vector has pretty low overhead.</p>\n"}, {"tags": [], "owner": {"reputation": 219, "user_id": 4625247, "user_type": "registered", "accept_rate": 25, "profile_image": "https://i.stack.imgur.com/cbHw8.gif?s=128&g=1", "display_name": "Mikhail Puzanov", "link": "https://stackoverflow.com/users/4625247/mikhail-puzanov"}, "is_accepted": false, "score": 0, "last_activity_date": 1458921310, "creation_date": 1458921310, "answer_id": 36223327, "question_id": 36165340, "link": "https://stackoverflow.com/questions/36165340/stm-friendly-list-as-a-change-log/36223327#36223327", "title": "STM-friendly list as a change log", "body": "<p>I made some (very simplistic) investigation\n<a href=\"https://github.com/lolepezy/rpki-pub-server/tree/add-storage/test/changeLog\" rel=\"nofollow\">https://github.com/lolepezy/rpki-pub-server/tree/add-storage/test/changeLog</a>\nimitating exactly the type of load I supposedly going to have. I used the same STMContainers.Map for the data set and usual list for the change log. To track the number of transaction retries, I used Debug.Trace.trace, meaning, the number of lines printed by trace. And the number of <strong>unique</strong> lines printed by trace gives me the number of committed transactions.</p>\n\n<p>The result is here (<a href=\"https://github.com/lolepezy/rpki-pub-server/blob/add-storage/test/changeLog/numbers.txt\" rel=\"nofollow\">https://github.com/lolepezy/rpki-pub-server/blob/add-storage/test/changeLog/numbers.txt</a>). The first column is the number of threads, the second is the number of change sets generated in total. The third column is the number of trace calls for the case without change log and the last one is the number of trace calls with the change log.</p>\n\n<p>Apparently most of the time change log adds some extra retries, but it's pretty much insignificant. So, I guess, it's fair to say that any data structure would be good enough, because most of the work is related to updating the map and most of the retries are happening because of it.</p>\n"}], "owner": {"reputation": 219, "user_id": 4625247, "user_type": "registered", "accept_rate": 25, "profile_image": "https://i.stack.imgur.com/cbHw8.gif?s=128&g=1", "display_name": "Mikhail Puzanov", "link": "https://stackoverflow.com/users/4625247/mikhail-puzanov"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 156, "favorite_count": 0, "answer_count": 2, "score": 7, "last_activity_date": 1458921310, "creation_date": 1458681216, "last_edit_date": 1458685065, "question_id": 36165340, "link": "https://stackoverflow.com/questions/36165340/stm-friendly-list-as-a-change-log", "title": "STM-friendly list as a change log", "body": "<p>I need an advice on the data structure to use as an atomic change log.</p>\n\n<p>I'm trying to implement the following algorithm. There is a flow of incoming\nchanges updating an in-memory map. In Haskell-like pseudocode it is</p>\n\n<pre><code>    update :: DataSet -&gt; SomeListOf Change -&gt; Change -&gt; STM (DataSet, SomeListOf Change)\n    update dataSet existingChanges newChange = do\n      ...\n      return (dataSet, existingChanges ++ [newChange])\n</code></pre>\n\n<p>where DataSet is a map (currently it is the Map from the stm-containers package, <a href=\"https://hackage.haskell.org/package/stm-containers-0.2.10/docs/STMContainers-Map.html\" rel=\"nofollow\">https://hackage.haskell.org/package/stm-containers-0.2.10/docs/STMContainers-Map.html</a>). The whole \"update\" is called from arbitrary number of threads. Some of the Change's can be rejected due to domain semantics, I use throwSTM for that to throw away the effect of the transaction. In case of successful commit the \"newChange\" is added to the list.</p>\n\n<p>There exists separate thread which calls the following function:</p>\n\n<pre><code>    flush :: STM (DataSet, SomeListOf Change) -&gt; IO ()\n</code></pre>\n\n<p>this function is supposed to take the current snapshot of DataSet together with the list of changes (it has to a consistent pair) and flush it to the filesystem, i.e.</p>\n\n<pre><code>    flush data = do\n      (dataSet, changes) &lt;- atomically $ readTVar data_\n      -- write them both to FS\n      -- ...\n      atomically $ writeTVar data_ (dataSet, [])\n</code></pre>\n\n<p>I need an advice about the data structure to use for \"SomeListOf Change\". I don't want to use [Change] because it is \"too ordered\" and I'm afraid there will be too many conflicts, which will force the whole transaction to retry. Please correct me, if I'm wrong here.</p>\n\n<p>I cannot use the Set (<a href=\"https://hackage.haskell.org/package/stm-containers-0.2.10/docs/STMContainers-Set.html\" rel=\"nofollow\">https://hackage.haskell.org/package/stm-containers-0.2.10/docs/STMContainers-Set.html</a>) because I still need to preserve <em>some</em> order, e.g. the order of transaction commits. I could use TChan for it and it looks like a good match (exactly the order of transaction commits), but I don't know how to implement the \"flush\" function so that it would give the consistent view of the whole change log together with the DataSet.</p>\n\n<p>The current implementation of that is here <a href=\"https://github.com/lolepezy/rpki-pub-server/blob/add-storage/src/RRDP/Repo.hs\" rel=\"nofollow\">https://github.com/lolepezy/rpki-pub-server/blob/add-storage/src/RRDP/Repo.hs</a>, in the functions applyActionsToState and rrdpSyncThread, respectively. It uses TChan and seems to do it in a wrong way.</p>\n\n<p>Thank you in advance.</p>\n\n<p><strong>Update:</strong> A reasonable answer seems to be like that</p>\n\n<pre><code>    type SomeListOf c = TChan [c] \n\n    update :: DataSet -&gt; TChan [Change] -&gt; Change -&gt; STM DataSet\n    update dataSet existingChanges newChange = do\n      ...\n      writeTChan changeChan $ reverse (newChange : existingChanges)\n      return dataSet\n\n   flush data_ = do\n      (dataSet, changes) &lt;- atomically $ (,) &lt;$&gt; readTVar data_ &lt;*&gt; readTChan changeChan\n      -- write them both to FS\n      -- ...\n</code></pre>\n\n<p>But I'm still not sure whether it's a neat solution to pass the whole list as an element of the channel.</p>\n"}, {"tags": ["haskell", "polymorphism", "quantifiers"], "answers": [{"tags": [], "owner": {"reputation": 44013, "user_id": 1477667, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/trgKM.jpg?s=128&g=1", "display_name": "dfeuer", "link": "https://stackoverflow.com/users/1477667/dfeuer"}, "is_accepted": false, "score": 3, "last_activity_date": 1458679638, "last_edit_date": 1458679638, "creation_date": 1458678923, "answer_id": 36164670, "question_id": 36164398, "link": "https://stackoverflow.com/questions/36164398/list-of-polymorphic-functions-in-haskell/36164670#36164670", "title": "List of polymorphic functions in haskell?", "body": "<p>Any way to put these functions into a list will require \"wrapping\" each of them in some fashion. The simplest wrapping is just</p>\n\n<pre><code>wrap :: (a -&gt; (b, c)) -&gt; a -&gt; c\nwrap f = snd . f\n</code></pre>\n\n<p>There are, indeed, other ways to wrap these (notably with existential types), but you've not given any information to suggest that any of those would be even slightly better in your application than this simplest version.</p>\n\n<p>Here's an example where something more sophisticated might make sense. Suppose you have</p>\n\n<pre><code>data Blob a b = Blob [a -&gt; b] [a]\n</code></pre>\n\n<p>Now imagine you want to make a list of values of type <code>Blob a b</code> that all have the same <code>b</code> type, but may have different <code>a</code> types. Actually applying each function to each argument could lead to a prohibitively large list of potential results, so it would make sense to write</p>\n\n<pre><code>data WrapBlob b where\n  WrapBlob :: Blob a b -&gt; WrapBlob b\n</code></pre>\n\n<p>Now you can make the list and postpone the decision of which function(s) to apply to which argument(s) without paying a prohibitive price.</p>\n"}, {"comments": [{"owner": {"reputation": 13337, "user_id": 441899, "user_type": "registered", "accept_rate": 79, "profile_image": "https://www.gravatar.com/avatar/368fb99f86e2264ceec0539a3746b9d3?s=128&d=identicon&r=PG", "display_name": "Jules", "link": "https://stackoverflow.com/users/441899/jules"}, "edited": false, "score": 0, "creation_date": 1458679618, "post_id": 36164715, "comment_id": 59966927, "body": "It&#39;s possible I&#39;ve oversimplified things a bit in my question, which leaves me unsure how to actually apply this.  In my actual scenario, the functions are already wrapped in a type, but both result types are exposed as parameters to the type. I effectively need to make a list ignoring one of the parameters, and as I&#39;m trying to produce a simplified API I&#39;d rather that clients didn&#39;t need to use an explicit wrapper themselves.  But it looks like that may not be possible..."}], "tags": [], "owner": {"reputation": 100892, "user_id": 745903, "user_type": "registered", "accept_rate": 74, "profile_image": "https://www.gravatar.com/avatar/50933f6638836741e620669b3940410e?s=128&d=identicon&r=PG", "display_name": "leftaroundabout", "link": "https://stackoverflow.com/users/745903/leftaroundabout"}, "is_accepted": true, "score": 3, "last_activity_date": 1458679414, "last_edit_date": 1458679414, "creation_date": 1458679066, "answer_id": 36164715, "question_id": 36164398, "link": "https://stackoverflow.com/questions/36164398/list-of-polymorphic-functions-in-haskell/36164715#36164715", "title": "List of polymorphic functions in haskell?", "body": "<p>Existential is correct, not impredicative. And Haskell doesn't have existentials, except through an explicit wrapper...</p>\n\n<pre><code>{-# LANGUAGE GADTs #-}\n\ndata SomeFstRes x z where\n  SFR :: (x -&gt; (y,z)) -&gt; SomeFstRes x z\n\n&gt; fmap (\\(SFR f) -&gt; snd $ f [1,2]) [SFR t1, SFR t2, SFR t3]\n[\"2\",\"??\",\"1+1\"]\n</code></pre>\n\n<p>but, this really is a bit useless. Since you can't possibly do anything with the first result anyway, it's more sensible to just throw it away immediately and put the remaining function in a simple monomorphic list:</p>\n\n<pre><code>&gt; fmap ($[1,2]) [snd . t1, snd . t2, snd . t3]\n[\"2\",\"??\",\"1+1\"]\n</code></pre>\n"}], "owner": {"reputation": 13337, "user_id": 441899, "user_type": "registered", "accept_rate": 79, "profile_image": "https://www.gravatar.com/avatar/368fb99f86e2264ceec0539a3746b9d3?s=128&d=identicon&r=PG", "display_name": "Jules", "link": "https://stackoverflow.com/users/441899/jules"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 196, "favorite_count": 1, "accepted_answer_id": 36164715, "answer_count": 2, "score": 4, "last_activity_date": 1458679638, "creation_date": 1458678040, "question_id": 36164398, "link": "https://stackoverflow.com/questions/36164398/list-of-polymorphic-functions-in-haskell", "title": "List of polymorphic functions in haskell?", "body": "<p>Consider the code below:</p>\n\n<pre><code>t1 :: [Int] -&gt; (Int,String)\nt1 xs = (sum xs,show $ length xs)\n\nt2 :: [Int] -&gt; (Int,String)\nt2 xs = (length xs, (\\x -&gt; '?') &lt;$&gt; xs)\n\nt3 :: [Int] -&gt; (Char,String)\nt3 (x:xs) = ('Y',\"1+\" ++ (show $ length xs))\nt3  []     = ('N',\"empty\")\n</code></pre>\n\n<p>These three functions have a type that only varies partially -- they are entirely usable without needing to know the type of the first component of the tuple they produce.  This means that I can operate on them without needing to refer to that type:</p>\n\n<pre><code>fnListToStrs vs fs = (\\x -&gt; snd $ x vs) &lt;$&gt; fs\n</code></pre>\n\n<p>Loading these definitions into GHCi, all three of the functions work independently as an argument to <code>fnListToStrs</code>, and indeed I can pass in a list containing both t1 and t2 because they have the same type:</p>\n\n<pre><code>*Imprec&gt; fnListToStrs [1,2] [t1,t2]\n[\"2\",\"??\"]\n*Imprec&gt; fnListToStrs [1,2] [t3]\n[\"1+1\"]\n</code></pre>\n\n<p>But I can't pass all 3 at the same time, even though the divergence of types is actually irrelevant to the calculation performed:</p>\n\n<pre><code>*Imprec&gt; fnListToStrs [1,2] [t1,t2]\n[\"2\",\"??\"]\n*Imprec&gt; fnListToStrs [1,2] [t3]\n[\"1+1\"]\n</code></pre>\n\n<p>I have the feeling that making this work has something to do with either existential or impredicative types, but neither extension has worked for me when using the type declaration I expect fnListToStrs to be able to take, namely:</p>\n\n<pre><code>fnListToStrs :: [Int] -&gt; [forall a.[Int]-&gt;(a,String)] -&gt; [String]\n</code></pre>\n\n<p>Is there some other way to make this work?</p>\n"}, {"tags": ["list", "haskell", "scale", "logarithm"], "comments": [{"owner": {"reputation": 94713, "user_id": 1139697, "user_type": "registered", "accept_rate": 86, "profile_image": "https://www.gravatar.com/avatar/5f136ddb684f39aaee1c028ee1950f6f?s=128&d=identicon&r=PG", "display_name": "Zeta", "link": "https://stackoverflow.com/users/1139697/zeta"}, "edited": false, "score": 0, "creation_date": 1458677083, "post_id": 36163851, "comment_id": 59965438, "body": "About your compilation error, didn&#39;t you ask the same thing <a href=\"https://stackoverflow.com/questions/36142846/conversion-between-int-and-fractional-values-splitting-an-interval-following-a\">yesterday</a>?"}, {"owner": {"reputation": 97, "user_id": 5422535, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/5ef55bcc7b645b4729153a98b86ab85f?s=128&d=identicon&r=PG&f=1", "display_name": "JaneDoe", "link": "https://stackoverflow.com/users/5422535/janedoe"}, "edited": false, "score": 0, "creation_date": 1458677131, "post_id": 36163851, "comment_id": 59965466, "body": "It is probably related. However I have edited my question to indicate that I have tried to use <code>fromIntegral</code> at different locations in my code to solve my problem. But it didn&#39;t work. So that&#39;s one of the reason why I have created a new question."}, {"owner": {"reputation": 94713, "user_id": 1139697, "user_type": "registered", "accept_rate": 86, "profile_image": "https://www.gravatar.com/avatar/5f136ddb684f39aaee1c028ee1950f6f?s=128&d=identicon&r=PG", "display_name": "Zeta", "link": "https://stackoverflow.com/users/1139697/zeta"}, "edited": false, "score": 0, "creation_date": 1458677229, "post_id": 36163851, "comment_id": 59965538, "body": "<code>fromIntegral</code> does not work on results of <code>log</code>, and <code>(fromIntegral n :: Int)</code> won&#39;t change the type at all (you meant <code>fromIntegral (n :: Int)</code>. You should probably read a tutorial about the numeric types and the proper conversion between them."}, {"owner": {"reputation": 97, "user_id": 5422535, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/5ef55bcc7b645b4729153a98b86ab85f?s=128&d=identicon&r=PG&f=1", "display_name": "JaneDoe", "link": "https://stackoverflow.com/users/5422535/janedoe"}, "edited": false, "score": 0, "creation_date": 1458677413, "post_id": 36163851, "comment_id": 59965660, "body": "Yes, but I can&#39;t see it in my asked questions (and probably other people can&#39;t too) on this forum and I assumed it was because, the question had been labelled to another answered question on this forum."}], "answers": [{"comments": [{"owner": {"reputation": 94713, "user_id": 1139697, "user_type": "registered", "accept_rate": 86, "profile_image": "https://www.gravatar.com/avatar/5f136ddb684f39aaee1c028ee1950f6f?s=128&d=identicon&r=PG", "display_name": "Zeta", "link": "https://stackoverflow.com/users/1139697/zeta"}, "edited": false, "score": 0, "creation_date": 1458677677, "post_id": 36164167, "comment_id": 59965833, "body": "<code>n</code> is an <code>Int</code>, which is part of the problem."}, {"owner": {"reputation": 97, "user_id": 5422535, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/5ef55bcc7b645b4729153a98b86ab85f?s=128&d=identicon&r=PG&f=1", "display_name": "JaneDoe", "link": "https://stackoverflow.com/users/5422535/janedoe"}, "edited": false, "score": 0, "creation_date": 1458691235, "post_id": 36164167, "comment_id": 59972162, "body": "Thanks a lot! You solved my main query"}], "tags": [], "owner": {"reputation": 62252, "user_id": 1435869, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/TrEd9.jpg?s=128&g=1", "display_name": "karakfa", "link": "https://stackoverflow.com/users/1435869/karakfa"}, "is_accepted": true, "score": 1, "last_activity_date": 1458678648, "last_edit_date": 1458678648, "creation_date": 1458677251, "answer_id": 36164167, "question_id": 36163851, "link": "https://stackoverflow.com/questions/36163851/splitting-a-list-in-non-equal-width-chunks-in-haskell/36164167#36164167", "title": "Splitting a list in non-equal width chunks in Haskell", "body": "<p>you can do something like this to create a log scale intervals</p>\n\n<pre><code>scale k n = map (floor . (*k) . (/(log n)) . log) [1..n]\n</code></pre>\n\n<p>e.g.</p>\n\n<pre><code>scale 100 9\n[0,31,50,63,73,81,88,94,100]\n</code></pre>\n\n<p>and use the indices to partition the array by start/end indices.</p>\n\n<p>You can cast the output to [Int] since floor convert it to an Integral type</p>\n\n<pre><code>Prelude&gt; scale 10 3 :: [Int]\n[0,6,10]\nPrelude&gt; :t it\nit :: [Int]\n</code></pre>\n"}], "owner": {"reputation": 97, "user_id": 5422535, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/5ef55bcc7b645b4729153a98b86ab85f?s=128&d=identicon&r=PG&f=1", "display_name": "JaneDoe", "link": "https://stackoverflow.com/users/5422535/janedoe"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 116, "favorite_count": 0, "closed_date": 1458679363, "accepted_answer_id": 36164167, "answer_count": 1, "score": 1, "last_activity_date": 1458678648, "creation_date": 1458676175, "last_edit_date": 1495542227, "question_id": 36163851, "link": "https://stackoverflow.com/questions/36163851/splitting-a-list-in-non-equal-width-chunks-in-haskell", "closed_reason": "Duplicate", "title": "Splitting a list in non-equal width chunks in Haskell", "body": "<p>I am trying to do something like in Haskell:</p>\n\n<pre><code>mkList start end nb_chunck will output [start, boun1, bound2, bound3 ..., end]\n</code></pre>\n\n<p>However I don't want to split the list in equal-size chunk but to follow a logarithmic scale.</p>\n\n<p>The C algorithm I want to transform in Haskell is availabke here: <a href=\"https://stackoverflow.com/questions/35585913/how-to-get-a-logarithmic-distribution-from-an-interval\">How to get a logarithmic distribution from an interval</a></p>\n\n<p>I don't really know how to do it.</p>\n\n<p>Here's what I have attempted so far:</p>\n\n<pre><code>mkList :: Int -&gt; Int -&gt; Int -&gt; Int -&gt; Int -&gt; [Int]\nmkList _ _ _ _ 7 = []\nmkList lower upper start end n = [lower, ((fromIntegral (log(2 + (fromIntegral n :: Int)) )+start) * scale)] ++ (mkList (fromIntegral(((fromIntegral (log(2 + (fromIntegral n :: Int)) )+start) * scale)+1) :: Int) ((fromIntegral (log(2 + (fromIntegral (n) :: Int)) )+start) * scale) (start) end (fromIntegral (n+1) :: Int)) where\nscale = (end - start) `quot` floor(log(1 + (6)))\n</code></pre>\n\n<p>However, I can't validate this code, because when I compile, error messages pop up:</p>\n\n<pre><code>haskell_par3.hs:71:58:\nNo instance for (Floating Int) arising from a use of `log'\nPossible fix: add an instance declaration for (Floating Int)\nIn the first argument of `fromIntegral', namely\n  `(log (2 + (fromIntegral n :: Int)))'\nIn the first argument of `(+)', namely\n  `fromIntegral (log (2 + (fromIntegral n :: Int)))'\nIn the first argument of `(*)', namely\n  `(fromIntegral (log (2 + (fromIntegral n :: Int))) + start)'\nghc -cpp: /usr/hs/ghc/7.6.3/bin/ghc failure (return code=1)\n</code></pre>\n\n<p>I've tried to make use of <code>fromIntegral</code> at different spots but it didn't help, as seen in other answered questions on StackOverflow.</p>\n\n<p>So I'm asking two things:</p>\n\n<ul>\n<li>Do you have any precise idea of how I could fix these compilation errors? (I know it has something to do with <code>fromIntegral</code>, but I can't get rid of this error).</li>\n<li>And more important: Do you think this code may achieve what I want to do? If no, do you have any suggestions?</li>\n</ul>\n"}, {"tags": ["sql", "haskell", "types", "dsl"], "comments": [{"owner": {"reputation": 44013, "user_id": 1477667, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/trgKM.jpg?s=128&g=1", "display_name": "dfeuer", "link": "https://stackoverflow.com/users/1477667/dfeuer"}, "edited": false, "score": 2, "creation_date": 1458676829, "post_id": 36163712, "comment_id": 59965266, "body": "First off, getting database typing right in Haskell seems to be fairly painful. It&#39;s just not a terribly good fit for Haskell&#39;s type system. Secondly, my limited experience suggests that GADTs are easier to think about than tagless final encodings. Even if you want the latter, it can be easier to start with the former and transform."}, {"owner": {"reputation": 2019, "user_id": 5800895, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/0cab3b0361b7e54267c70c02754f21de?s=128&d=identicon&r=PG&f=1", "display_name": "Derek Elkins left SE", "link": "https://stackoverflow.com/users/5800895/derek-elkins-left-se"}, "edited": false, "score": 3, "creation_date": 1458689305, "post_id": 36163712, "comment_id": 59971471, "body": "Oleg <a href=\"http://okmij.org/ftp/tagless-final/#in-fin\" rel=\"nofollow noreferrer\">covered this</a>. Basically, mimic the GADT constructors as methods of the type class <i>including the type parameters</i>.  I&#39;m not sure why the <code>Column</code> GADT is allowed to be of kind <code>Sz -&gt; *</code> but the <code>Column</code> class classifies types of kind <code>*</code>."}, {"owner": {"reputation": 705, "user_id": 1121705, "user_type": "registered", "accept_rate": 85, "profile_image": "https://www.gravatar.com/avatar/c723ca9f7ba138b9df58d93e100d7146?s=128&d=identicon&r=PG", "display_name": "Brandon Ogle", "link": "https://stackoverflow.com/users/1121705/brandon-ogle"}, "edited": false, "score": 0, "creation_date": 1458759118, "post_id": 36163712, "comment_id": 60008061, "body": "I can certainly do that (see edit). I think what I want though is an interpreter for the tagless ast that promotes the column type (Int, Float, etc) to the type level when convenient such that I can define add with a signature like <code>add :: C t -&gt; C t -&gt; C t</code>"}], "owner": {"reputation": 705, "user_id": 1121705, "user_type": "registered", "accept_rate": 85, "profile_image": "https://www.gravatar.com/avatar/c723ca9f7ba138b9df58d93e100d7146?s=128&d=identicon&r=PG", "display_name": "Brandon Ogle", "link": "https://stackoverflow.com/users/1121705/brandon-ogle"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 212, "favorite_count": 0, "answer_count": 0, "score": 6, "last_activity_date": 1458759767, "creation_date": 1458675751, "last_edit_date": 1458759767, "question_id": 36163712, "link": "https://stackoverflow.com/questions/36163712/static-invariants-with-tagless-final", "title": "Static invariants with tagless final", "body": "<h2><strong>TL;DR</strong> How can I encode static invariants that are possible with GADTs when using a tagless encoding?</h2>\n\n<p>I am building a dsl on top of a SQL like language, with the goals of rounding out some of the rough edges, type safety and minor query optimization. </p>\n\n<p>In my first pass I used GADT's to enforce several restrictions that the target language would execute but the output was in most cases garbage. Namely columns of mixed length in select statements like </p>\n\n<pre><code>select mean x, x by date, time from tbl\n</code></pre>\n\n<p>I prevent these mixed selections by tagging columns as either Selections (vectors) or Reductions (scalars) and thus the compiler can statically prevent these operations. I never did figure out how to prevent selecting from a groupby, however. </p>\n\n<p>The next feature to scratch off is to add type checking to the column arithmetic operations, my first bad idea was to add another phantom type to carry the column type. This wont work as it would break my Schema type and I could no longer select columns of mixed types. This led me to think a tagless embedding of Columns might be appropriate as I could then get the appropriate representation (type, size, etc.) depending on the context. The downside is that this would appear to defer all the invariants I want to encode til run-time. To illustrate this here is rough pseudo code for <code>add</code> in the GADT and tagless approaches. </p>\n\n<pre><code>-- | GADT\nadd :: Column ty s1 -&gt; Column ty s2\nadd a b = BinExpr Add a b\n\n-- | Tagless\nadd :: Column c =&gt; c -&gt; c -&gt; c\nadd a b | (a :: ColType) == (b :: ColType) = binexpr Add a b\n        | TypeMismatch a b\n</code></pre>\n\n<p>The GADT approach also has the benefit of being able to specify <code>Num ty =&gt; ...</code> to prevent addition on columns of strings. This type of issue would seem to propagate through all my code as I now have to defer to runtime checking to ensure prevention of <code>Select</code>s of mixed size or <code>Group</code> only working on a <code>Query Selection</code>. So my question is: Can I somehow retain the static guarantees of GADTs while using the flexibility of a Tagless style?</p>\n\n<p><strong>My current GADTs</strong></p>\n\n<pre><code>{-# LANGUAGE\n    GADTs\n  , DataKinds\n  , TypeFamilies #-}\n\n-- Kinds\n\n-- | State Tags\n--   These constructors are promoted to the kind level to be used as \n--   phantom types to enforce static query invariants. For instance\n--   these are strategically used to prevent selecting from a Groupby\n--   or preventing selection of mixlengthed columns\n\ndata Sz = Selection | Reduction deriving Show\n\n--------------------------------------------------------------------\n-- Schema \n\ndata Schema = Schema { \n    name :: Maybe String, \n    spec :: [Column Selection] \n} deriving Eq\n\n--------------------------------------------------------------------\n-- Column Datatype\n\ndata Column (a :: Sz) where\n    Column  :: String -&gt; Column Selection\n    Assign  :: String -&gt; Column a -&gt; Column a\n    FKey    :: String -&gt; Schema -&gt; Column Selection\n    BinExpr :: BinOp  -&gt; Column a -&gt; Column b -&gt; Column (ColOp a b)\n    LogExpr :: LogOp  -&gt; Column a -&gt; Column b -&gt; Column Selection\n    AggExpr :: AggOp  -&gt; Column Selection -&gt; Column Reduction\n\ntype family ColOp (a :: Sz) (b :: Sz) where\n    -- | If both sides a scalar then output\n    --   is still a scalar, otherwise return\n    --   a vector, as we can perform the op\n    --   elemwise or brodcast a scalar across\n    --   the vector\n    ColOp Reduction Reduction = Reduction\n    ColOp a         b         = Selection \n\n--------------------------------------------------------------------\n-- Query types\n\nclass Tabular repr where\n    meta  ::  repr (a :: Sz) -&gt; Schema\n\ndata Query (a :: Sz) where\n    Table  :: Schema -&gt; Query Selection\n    Select :: (Tabular t, Show (t b)) =&gt; [Column a] -&gt; t b -&gt; Query Selection\n    Where  :: (Tabular t, Show (t Selection)) =&gt; [Column Selection] -&gt; t Selection -&gt; Query Selection\n    Group  :: (Tabular t, Show (t Selection)) =&gt; [Column Selection] -&gt; t Selection -&gt; Query Reduction\n</code></pre>\n\n<p><strong>Tagless Column Prototype</strong></p>\n\n<pre><code>{-# language FlexibleInstances #-}\n\ndata Sz = Selection | Reduction \n    deriving Show\n\ndata ColType \n    = Int | Float | String | Bool \n    | TypeMismatch ColType ColType \n    deriving (Show, Eq)\n\ndata BinOp = Add  | Mul\ndata AggOp = Mean | Count\n\n-- Tagless AST\nclass Show repr =&gt; Column repr where\n    column  :: String -&gt; ColType -&gt; repr\n    assign  :: String -&gt; repr    -&gt; repr\n    binExpr :: BinOp  -&gt; repr    -&gt; repr  -&gt; repr\n    aggExpr :: AggOp  -&gt; repr    -&gt; repr\n\n-- Show Instances\ninstance Show BinOp where\n    show Add = \" + \"\n    show Mul = \" * \"\n\ninstance Show AggOp where \n    show Mean  = \"mean \"\n    show Count = \"count \"\n\n-- I Would like to bring these into the type level (ie performed statically)\nopSz :: Sz -&gt; Sz -&gt; Sz\nopSz Reduction Reduction = Reduction\nopSz a         b         = Selection\n\ntypeCheck :: ColType -&gt; ColType -&gt; ColType \ntypeCheck a b | a == b = a\n              | otherwise = TypeMismatch a b\n\n-- Tagless Interpreters\n-- | Stringify\ninstance Column ([Char]) where \n    column  s t   = s\n    assign  s c   = s ++ \": \" ++ show c\n    binExpr o l r = l ++ show o ++ r\n    aggExpr op l  = show op ++ l\n\n-- | Column Size\ninstance Column Sz where \n    column  s t   = Selection\n    assign  s c   = c :: Sz\n    binExpr o l r = opSz l r\n    aggExpr op l  = Reduction\n\n-- | Column Type\ninstance Column ColType where \n    column s t    = t\n    assign s c    = c :: ColType\n    binExpr o l r = typeCheck l r\n    aggExpr o l   = l :: ColType\n\nadd :: Column c =&gt; c -&gt; c -&gt; c\nadd l r = binExpr Add l r\n\ncolumns :: Column c =&gt; [c]\ncolumns = [ column \"a\" Float\n          , column \"b\" Int\n          , column \"c\" String ]\n\na :: Column c =&gt; c\na = columns !! 0\n\nb :: Column c =&gt; c\nb = columns !! 1\n\n-- add a b :: ColType =&gt; TypeMismatch Float Int\n</code></pre>\n\n<p><strong>Edit:</strong> I can get similar behavior by adding a type parameter to the class </p>\n\n<pre><code>class Column repr where \n    column  :: String -&gt; repr Selection\n    assign  :: String -&gt; repr (a :: Sz) -&gt; repr (a :: Sz)\n    binExpr :: BinOp  -&gt; repr (a :: Sz) -&gt; repr (b :: Sz) -&gt; repr (OpSz a b)\n    aggExpr :: AggOp  -&gt; repr Selection -&gt; repr Reduction\n</code></pre>\n\n<p>But I am still curious how I can define an interpreter of the ast that brings <code>ColType</code> to the type level such that I can define <code>add :: C t -&gt; C t -&gt; C t</code> so <code>add a :: (C String) b :: (C Int)</code> doesn't typecheck</p>\n"}, {"tags": ["haskell", "list-comprehension"], "comments": [{"owner": {"reputation": 61419, "user_id": 849891, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/MbEO3.png?s=128&g=1", "display_name": "Will Ness", "link": "https://stackoverflow.com/users/849891/will-ness"}, "edited": false, "score": 0, "creation_date": 1458749441, "post_id": 36163150, "comment_id": 60001833, "body": "your function&#39;s (<code>factors n = ...</code>) type signature <code>factors :: Int -&gt; [Int]</code> says that its argument is an <code>Int</code>, i.e. <code>n :: Int</code>; then you use <code>[2..sqrt n]</code> but <code>sqrt :: Floating a =&gt; a -&gt; a</code> says <code>n</code>&#39;s type must be in <code>Floating</code> typeclass. Yet <code>Int</code> is not in <code>Floating</code> (try <code>Prelude&gt; :i Int</code> at GHCi prompt). <i>That</i> is what the second error message is telling you."}, {"owner": {"reputation": 61419, "user_id": 849891, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/MbEO3.png?s=128&g=1", "display_name": "Will Ness", "link": "https://stackoverflow.com/users/849891/will-ness"}, "edited": false, "score": 0, "creation_date": 1458750300, "post_id": 36163150, "comment_id": 60002460, "body": "so to fix it, write <code>.... sqrt (fromIntegral n) ...</code>."}], "owner": {"reputation": 338, "user_id": 5573030, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/91fcac7046f8930290c23c81870e7d4c?s=128&d=identicon&r=PG&f=1", "display_name": "BookOwl", "link": "https://stackoverflow.com/users/5573030/bookowl"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 53, "favorite_count": 0, "closed_date": 1458674482, "answer_count": 0, "score": 0, "last_activity_date": 1458673832, "creation_date": 1458673832, "question_id": 36163150, "link": "https://stackoverflow.com/questions/36163150/why-doesnt-this-haskell-code-compile", "closed_reason": "Duplicate", "title": "Why doesn&#39;t this Haskell code compile?", "body": "<p>I'm trying to calculate a list of factors for a number in Haskell. This is my current code:</p>\n\n<pre><code>factors :: Int -&gt; [Int]\nfactors n = map floor [x | x &lt;- [2..sqrt n], n `mod` (floor x) == 0]\n</code></pre>\n\n<p>However, when I try to run it, it throws off this error:</p>\n\n<pre><code>largestprimefactor.hs:4:17:\nNo instance for (RealFrac Int) arising from a use of `floor'\nIn the first argument of `map', namely `floor'\nIn the expression:\n  map floor [x | x &lt;- [2 .. sqrt n], n `mod` (floor x) == 0]\nIn an equation for `factors':\n    factors n\n      = map floor [x | x &lt;- [2 .. sqrt n], n `mod` (floor x) == 0]\n\nlargestprimefactor.hs:4:37:\nNo instance for (Floating Int) arising from a use of `sqrt'\nIn the expression: sqrt n\nIn the expression: [2 .. sqrt n]\nIn a stmt of a list comprehension: x &lt;- [2 .. sqrt n]\nFailed, modules loaded: none.\n</code></pre>\n\n<p>I'm trying to learn Haskell, so it is probably just a dumb beginner mistake, but I've tried to fix this for hours and can't find an answer. </p>\n"}, {"tags": ["scala", "haskell", "cake-pattern"], "comments": [{"owner": {"reputation": 13807, "user_id": 2407038, "user_type": "registered", "accept_rate": 64, "profile_image": "https://www.gravatar.com/avatar/538f6f4a9aa43841841de7d8e8b169fc?s=128&d=identicon&r=PG&f=1", "display_name": "user2407038", "link": "https://stackoverflow.com/users/2407038/user2407038"}, "edited": false, "score": 4, "creation_date": 1458673020, "post_id": 36162127, "comment_id": 59962941, "body": "Just a few guesses: it models Objects (i.e. OO objects) and Haskell does not have Objects. Probably most Haskellers would balk at the thought of trying to hack Objects into their Haskell code... Haskell and Scala have vastly different type systems, I wouldn&#39;t expect design patterns applicable to Scala to be applicable to Haskell in general. Furthermore, Scala has much better support for runtime reflection, so combining the Cake pattern and reflection gets you the power of the model for no syntactic inconvenience. In Haskell you won&#39;t even get a first class object out of it."}, {"owner": {"reputation": 46362, "user_id": 4993128, "user_type": "registered", "accept_rate": 43, "profile_image": "https://i.stack.imgur.com/QkaxJ.jpg?s=128&g=1", "display_name": "jwvh", "link": "https://stackoverflow.com/users/4993128/jwvh"}, "edited": false, "score": 4, "creation_date": 1458673103, "post_id": 36162127, "comment_id": 59962982, "body": "Perhaps the Cake Pattern isn&#39;t as valuable to those with access to a good <a href=\"http://blog.originate.com/blog/2013/10/21/reader-monad-for-dependency-injection/\" rel=\"nofollow noreferrer\">reader monad</a>."}, {"owner": {"reputation": 48129, "user_id": 76051, "user_type": "registered", "accept_rate": 91, "profile_image": "https://i.stack.imgur.com/AGDxz.jpg?s=128&g=1", "display_name": "Carsten", "link": "https://stackoverflow.com/users/76051/carsten"}, "edited": false, "score": 12, "creation_date": 1458673559, "post_id": 36162127, "comment_id": 59963281, "body": "maybe you should first add what a <i>cake pattern</i> is - tbh: this is the first time I heard of it and I am to lazy to search for it myself ^^"}, {"owner": {"reputation": 34889, "user_id": 86604, "user_type": "registered", "accept_rate": 80, "profile_image": "https://www.gravatar.com/avatar/329af917389e6cf8e146c03012f5319a?s=128&d=identicon&r=PG", "display_name": "Ingo", "link": "https://stackoverflow.com/users/86604/ingo"}, "edited": false, "score": 5, "creation_date": 1458675916, "post_id": 36162127, "comment_id": 59964652, "body": "Is it an exaggeration to say that Haskell programmers in general don&#39;t care very much about so-called &quot;patterns&quot;?"}, {"owner": {"reputation": 37219, "user_id": 1523776, "user_type": "moderator", "accept_rate": 87, "profile_image": "https://www.gravatar.com/avatar/b3e0b5c8e42a8c38009ef2d969f8dabb?s=128&d=identicon&r=PG", "display_name": "Benjamin Hodgson", "link": "https://stackoverflow.com/users/1523776/benjamin-hodgson"}, "edited": false, "score": 2, "creation_date": 1458676539, "post_id": 36162127, "comment_id": 59965068, "body": "The Cake Pattern is <i>but one way</i> in Scala to compose big modules out of smaller modules. There are lots of others; the Cake Pattern is not the most popular or even necessarily the best (it&#39;s not simple, for sure). In Haskell we compose big things out of smaller things <i>all the time</i>, and the language also gives us lots of tools with which to do it. To solve the particular problem that the Cake Pattern is used for, the most commonly-used tool is probably monad transformers."}, {"owner": {"reputation": 18456, "user_id": 1198559, "user_type": "registered", "accept_rate": 70, "profile_image": "https://i.stack.imgur.com/bOjLe.png?s=128&g=1", "display_name": "jhegedus", "link": "https://stackoverflow.com/users/1198559/jhegedus"}, "reply_to_user": {"reputation": 48129, "user_id": 76051, "user_type": "registered", "accept_rate": 91, "profile_image": "https://i.stack.imgur.com/AGDxz.jpg?s=128&g=1", "display_name": "Carsten", "link": "https://stackoverflow.com/users/76051/carsten"}, "edited": false, "score": 0, "creation_date": 1458678115, "post_id": 36162127, "comment_id": 59966087, "body": "@Carsten the first link explains it <a href=\"http://stackoverflow.com/questions/12947176/can-scalas-cake-pattern-be-implemented-in-haskell\" title=\"can scalas cake pattern be implemented in haskell\">stackoverflow.com/questions/12947176/&hellip;</a>"}, {"owner": {"reputation": 507143, "user_id": 1048572, "user_type": "registered", "accept_rate": 77, "profile_image": "https://www.gravatar.com/avatar/7f2c4de95e8f4f8f5a71c3aaf0ed312a?s=128&d=identicon&r=PG", "display_name": "Bergi", "link": "https://stackoverflow.com/users/1048572/bergi"}, "edited": false, "score": 1, "creation_date": 1458679275, "post_id": 36162127, "comment_id": 59966762, "body": "@jhegedus: Maybe it would help if you could describe the kind of problems that the cake pattern solves, instead of explaining the pattern itself. Then we could show how these problems are a) solved or b) not existent in Haskell."}, {"owner": {"reputation": 18456, "user_id": 1198559, "user_type": "registered", "accept_rate": 70, "profile_image": "https://i.stack.imgur.com/bOjLe.png?s=128&g=1", "display_name": "jhegedus", "link": "https://stackoverflow.com/users/1198559/jhegedus"}, "reply_to_user": {"reputation": 48129, "user_id": 76051, "user_type": "registered", "accept_rate": 91, "profile_image": "https://i.stack.imgur.com/AGDxz.jpg?s=128&g=1", "display_name": "Carsten", "link": "https://stackoverflow.com/users/76051/carsten"}, "edited": false, "score": 0, "creation_date": 1458679285, "post_id": 36162127, "comment_id": 59966766, "body": "I added a link to a talk that explains the Cake Pattern and why it is a good idea. @Carsten"}, {"owner": {"reputation": 18456, "user_id": 1198559, "user_type": "registered", "accept_rate": 70, "profile_image": "https://i.stack.imgur.com/bOjLe.png?s=128&g=1", "display_name": "jhegedus", "link": "https://stackoverflow.com/users/1198559/jhegedus"}, "reply_to_user": {"reputation": 507143, "user_id": 1048572, "user_type": "registered", "accept_rate": 77, "profile_image": "https://www.gravatar.com/avatar/7f2c4de95e8f4f8f5a71c3aaf0ed312a?s=128&d=identicon&r=PG", "display_name": "Bergi", "link": "https://stackoverflow.com/users/1048572/bergi"}, "edited": false, "score": 0, "creation_date": 1458679343, "post_id": 36162127, "comment_id": 59966800, "body": "@Bergi the link I added explains the purpose of Cake Pattern very well."}, {"owner": {"reputation": 37486, "user_id": 371753, "user_type": "registered", "accept_rate": 83, "profile_image": "https://i.stack.imgur.com/znFEK.jpg?s=128&g=1", "display_name": "sclv", "link": "https://stackoverflow.com/users/371753/sclv"}, "edited": false, "score": 8, "creation_date": 1458679412, "post_id": 36162127, "comment_id": 59966827, "body": "the cake pattern is a lie"}, {"owner": {"reputation": 18456, "user_id": 1198559, "user_type": "registered", "accept_rate": 70, "profile_image": "https://i.stack.imgur.com/bOjLe.png?s=128&g=1", "display_name": "jhegedus", "link": "https://stackoverflow.com/users/1198559/jhegedus"}, "reply_to_user": {"reputation": 37486, "user_id": 371753, "user_type": "registered", "accept_rate": 83, "profile_image": "https://i.stack.imgur.com/znFEK.jpg?s=128&g=1", "display_name": "sclv", "link": "https://stackoverflow.com/users/371753/sclv"}, "edited": false, "score": 0, "creation_date": 1458679953, "post_id": 36162127, "comment_id": 59967111, "body": "@sclv what do u mean ?"}, {"owner": {"reputation": 18456, "user_id": 1198559, "user_type": "registered", "accept_rate": 70, "profile_image": "https://i.stack.imgur.com/bOjLe.png?s=128&g=1", "display_name": "jhegedus", "link": "https://stackoverflow.com/users/1198559/jhegedus"}, "edited": false, "score": 0, "creation_date": 1458680267, "post_id": 36162127, "comment_id": 59967265, "body": "this <a href=\"https://twitter.com/miguelinlas3/status/547660890821361664\" rel=\"nofollow noreferrer\">twitter.com/miguelinlas3/status/547660890821361664</a>"}, {"owner": {"reputation": 56659, "user_id": 450128, "user_type": "registered", "accept_rate": 62, "profile_image": "https://www.gravatar.com/avatar/2f72b3fdc99fe9fd1bbeb2f9da1d2c0a?s=128&d=identicon&r=PG", "display_name": "Ben", "link": "https://stackoverflow.com/users/450128/ben"}, "edited": false, "score": 0, "creation_date": 1458773630, "post_id": 36162127, "comment_id": 60015420, "body": "@jhegedus I doubt very many people are going to watch a 40 minute video to understand some of the context of this question to decide if they want to answer it. I don&#39;t necessarily agree that this question ought to be closed as too broad, but if the cake pattern is so complicated that the core ideas can&#39;t be summarised in the question then it probably can&#39;t be well answered in this format either."}, {"owner": {"reputation": 18456, "user_id": 1198559, "user_type": "registered", "accept_rate": 70, "profile_image": "https://i.stack.imgur.com/bOjLe.png?s=128&g=1", "display_name": "jhegedus", "link": "https://stackoverflow.com/users/1198559/jhegedus"}, "reply_to_user": {"reputation": 56659, "user_id": 450128, "user_type": "registered", "accept_rate": 62, "profile_image": "https://www.gravatar.com/avatar/2f72b3fdc99fe9fd1bbeb2f9da1d2c0a?s=128&d=identicon&r=PG", "display_name": "Ben", "link": "https://stackoverflow.com/users/450128/ben"}, "edited": false, "score": 0, "creation_date": 1458800554, "post_id": 36162127, "comment_id": 60022636, "body": "@Ben this question targets people who know already <i>both</i> Scala and Haskell. The purpose of the question is not to teach Scala. The cake pattern is explained in detail in Odersky&#39;s Scala (intro) book, as well, but I think this video really well summarises why the cake pattern was invented/discovered and what problems ( i.e. Dependency injection) it tries to solve and how (the how part needs understanding of Scala)."}], "owner": {"reputation": 18456, "user_id": 1198559, "user_type": "registered", "accept_rate": 70, "profile_image": "https://i.stack.imgur.com/bOjLe.png?s=128&g=1", "display_name": "jhegedus", "link": "https://stackoverflow.com/users/1198559/jhegedus"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 346, "favorite_count": 0, "closed_date": 1458679387, "answer_count": 0, "score": 3, "last_activity_date": 1458679241, "creation_date": 1458670416, "last_edit_date": 1495539909, "question_id": 36162127, "link": "https://stackoverflow.com/questions/36162127/is-the-cake-pattern-missing-from-haskell-why-and-when-would-i-need-to-use-the-c", "closed_reason": "Needs more focus", "title": "Is the Cake Pattern missing from Haskell? Why and when would I need to use the Cake Pattern in Haskell?", "body": "<p>Reading <a href=\"https://stackoverflow.com/questions/12947176/can-scalas-cake-pattern-be-implemented-in-haskell\">this question</a> and <a href=\"https://m.reddit.com/r/haskell/comments/1629ld/olegs_go_at_reproducing_scalas_cake_pattern/\" rel=\"nofollow noreferrer\">this thread on Reddit</a> inspired me to ask:</p>\n\n<p>Why don't people in the Haskell community seem to be missing Scala's Cake Pattern? Why is the lack (or cumbersomeness) of a Cake Pattern in Haskell not a such a big issue? </p>\n\n<p>The <a href=\"http://events.inf.ed.ac.uk/Milner2012/M_Odersky-html5-mp4.html\" rel=\"nofollow noreferrer\">Cake Pattern</a> is meant to help with large (scalable) systems/programs. Is it possible that systems created with Scala tend to be much larger than systems created with Haskell? This in turn might explain why the Cake Pattern is so important in the Scala world and its lack is not such a big issue in the Haskell world?</p>\n"}, {"tags": ["haskell", "template-haskell"], "comments": [{"owner": {"reputation": 44013, "user_id": 1477667, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/trgKM.jpg?s=128&g=1", "display_name": "dfeuer", "link": "https://stackoverflow.com/users/1477667/dfeuer"}, "edited": false, "score": 0, "creation_date": 1458667883, "post_id": 36161217, "comment_id": 59959657, "body": "Since you seem to be learning Template Haskell, I&#39;m rather curious what resources you&#39;re using. I haven&#39;t yet been able to find decent ones to learn it myself."}, {"owner": {"reputation": 49501, "user_id": 784338, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/ae195ac7c8a5e9002a808544572cc5fc?s=128&d=identicon&r=PG", "display_name": "Daniel Gratzer", "link": "https://stackoverflow.com/users/784338/daniel-gratzer"}, "edited": false, "score": 0, "creation_date": 1458668031, "post_id": 36161217, "comment_id": 59959758, "body": "So you can do an equality check with <code>==</code> but this is almost certainly wrong because it&#39;s just raw syntactic equivalence and doesn&#39;t normalize type synonyms even, let alone indirections through modules or whatever. You&#39;d be better off writing an overloaded type class honestly which behaves differently only on <code>String</code> or something and only using it in your codegen module. Type equality is really hard."}, {"owner": {"reputation": 4185, "user_id": 986475, "user_type": "registered", "accept_rate": 89, "profile_image": "https://www.gravatar.com/avatar/dd36406ee6957594a633373c297a3ab1?s=128&d=identicon&r=PG", "display_name": "Sal", "link": "https://stackoverflow.com/users/986475/sal"}, "reply_to_user": {"reputation": 44013, "user_id": 1477667, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/trgKM.jpg?s=128&g=1", "display_name": "dfeuer", "link": "https://stackoverflow.com/users/1477667/dfeuer"}, "edited": false, "score": 1, "creation_date": 1458669144, "post_id": 36161217, "comment_id": 59960518, "body": "@dfeuer, two main resources: <a href=\"https://ocharles.org.uk/blog/guest-posts/2014-12-22-template-haskell.html\" rel=\"nofollow noreferrer\">deriveShow function example</a> and <a href=\"https://artyom.me/lens-over-tea-6#template-haskell\" rel=\"nofollow noreferrer\">in-depth overview of TH</a>. Constant experimentation in <code>ghci</code> with hackage page for <a href=\"https://hackage.haskell.org/package/template-haskell-2.10.0.0/docs/Language-Haskell-TH.html\" rel=\"nofollow noreferrer\"><code>TH</code></a> in another browser helps a lot. AST generation in <code>ghci</code> using simple code, and understanding importance of <code>Name</code> in <code>TH</code> helped me get up to speed quickly."}, {"owner": {"reputation": 4185, "user_id": 986475, "user_type": "registered", "accept_rate": 89, "profile_image": "https://www.gravatar.com/avatar/dd36406ee6957594a633373c297a3ab1?s=128&d=identicon&r=PG", "display_name": "Sal", "link": "https://stackoverflow.com/users/986475/sal"}, "reply_to_user": {"reputation": 49501, "user_id": 784338, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/ae195ac7c8a5e9002a808544572cc5fc?s=128&d=identicon&r=PG", "display_name": "Daniel Gratzer", "link": "https://stackoverflow.com/users/784338/daniel-gratzer"}, "edited": false, "score": 0, "creation_date": 1458669416, "post_id": 36161217, "comment_id": 59960696, "body": "@jozefg, would <code>Data.Typeable</code> approach to generate appropriate splices also work (at compile-time)? Please feel free to post solutions on how to generate alternative splices (let us say, overloaded <code>show</code> function AST for different types). I think your suggestion makes sense."}, {"owner": {"reputation": 4185, "user_id": 986475, "user_type": "registered", "accept_rate": 89, "profile_image": "https://www.gravatar.com/avatar/dd36406ee6957594a633373c297a3ab1?s=128&d=identicon&r=PG", "display_name": "Sal", "link": "https://stackoverflow.com/users/986475/sal"}, "reply_to_user": {"reputation": 49501, "user_id": 784338, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/ae195ac7c8a5e9002a808544572cc5fc?s=128&d=identicon&r=PG", "display_name": "Daniel Gratzer", "link": "https://stackoverflow.com/users/784338/daniel-gratzer"}, "edited": false, "score": 0, "creation_date": 1458675171, "post_id": 36161217, "comment_id": 59964237, "body": "@jozefg, it seems overloading Show for few types is more elaborate undertaking as documented <a href=\"https://wiki.haskell.org/GHC/AdvancedOverlap\" rel=\"nofollow noreferrer\">here</a>. I tried overloading <code>Show</code> with overlapping pragma but that failed. Perhaps you could elaborate more if you know how to do this."}, {"owner": {"reputation": 4185, "user_id": 986475, "user_type": "registered", "accept_rate": 89, "profile_image": "https://www.gravatar.com/avatar/dd36406ee6957594a633373c297a3ab1?s=128&d=identicon&r=PG", "display_name": "Sal", "link": "https://stackoverflow.com/users/986475/sal"}, "reply_to_user": {"reputation": 44013, "user_id": 1477667, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/trgKM.jpg?s=128&g=1", "display_name": "dfeuer", "link": "https://stackoverflow.com/users/1477667/dfeuer"}, "edited": false, "score": 1, "creation_date": 1458693557, "post_id": 36161217, "comment_id": 59972878, "body": "@dfeuer, one more important source for learning <code>TH</code> - <a href=\"http://stackoverflow.com/questions/16490846/haskell-using-rankntypes-to-fold-a-record-constructor\">this</a> one shows how to solve the problem step-by-step"}, {"owner": {"reputation": 44013, "user_id": 1477667, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/trgKM.jpg?s=128&g=1", "display_name": "dfeuer", "link": "https://stackoverflow.com/users/1477667/dfeuer"}, "edited": false, "score": 0, "creation_date": 1458694338, "post_id": 36161217, "comment_id": 59973097, "body": "@Sal, thanks a lot for the recommendations."}], "answers": [{"comments": [{"owner": {"reputation": 44013, "user_id": 1477667, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/trgKM.jpg?s=128&g=1", "display_name": "dfeuer", "link": "https://stackoverflow.com/users/1477667/dfeuer"}, "edited": false, "score": 0, "creation_date": 1458685137, "post_id": 36164956, "comment_id": 59969768, "body": "Ew.... Overlapping instances are nasty. Is there any way you can get away with just using a default for the <code>toText</code> method?"}, {"owner": {"reputation": 4185, "user_id": 986475, "user_type": "registered", "accept_rate": 89, "profile_image": "https://www.gravatar.com/avatar/dd36406ee6957594a633373c297a3ab1?s=128&d=identicon&r=PG", "display_name": "Sal", "link": "https://stackoverflow.com/users/986475/sal"}, "reply_to_user": {"reputation": 44013, "user_id": 1477667, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/trgKM.jpg?s=128&g=1", "display_name": "dfeuer", "link": "https://stackoverflow.com/users/1477667/dfeuer"}, "edited": false, "score": 0, "creation_date": 1458685769, "post_id": 36164956, "comment_id": 59970068, "body": "@dfeuer, yep, I agree...so far, don&#39;t know of a way to avoid overlapping instances. That is why keeping this open in the hope there is a simpler solution."}], "tags": [], "owner": {"reputation": 4185, "user_id": 986475, "user_type": "registered", "accept_rate": 89, "profile_image": "https://www.gravatar.com/avatar/dd36406ee6957594a633373c297a3ab1?s=128&d=identicon&r=PG", "display_name": "Sal", "link": "https://stackoverflow.com/users/986475/sal"}, "is_accepted": false, "score": 1, "last_activity_date": 1458679873, "creation_date": 1458679873, "answer_id": 36164956, "question_id": 36161217, "link": "https://stackoverflow.com/questions/36161217/performing-type-equality-in-template-haskell/36164956#36164956", "title": "Performing type equality in template haskell", "body": "<p>Following recommendations of <code>jozefg</code> in the comments, I solved this problem by using an overloaded function with type signature <code>a -&gt; Text</code>. Keeping this open for few more days to see if any one has a better suggestion.</p>\n\n<p>This is my original <code>TH</code> splice (<code>ghci</code> output):</p>\n\n<pre><code>&gt; runQ [| pack . show $ 1 ::Int|]\nSigE (InfixE (Just (InfixE (Just (VarE Data.Text.pack)) (VarE GHC.Base..) \n(Just (VarE GHC.Show.show)))) (VarE GHC.Base.$) (Just (LitE (IntegerL 1))))\n(ConT GHC.Types.Int)\n</code></pre>\n\n<p><code>Int</code> gets converted to <code>Text</code>. However, running <code>pack . show</code> on <code>String</code> or <code>Text</code> will be problematic since it will add another layer of double-quotes on top of that (and doesn't make sense anyway). So, we need special handling for <code>Show</code> for <code>Text</code>, <code>String</code> and <code>Char</code> types. So, solution is to write a function <code>toText :: a -&gt; Text</code> and use it in the codegen as below:</p>\n\n<pre><code>&gt; runQ [| toText $ 1 ::Int|]\nSigE (InfixE (Just (VarE ToText.toText)) (VarE GHC.Base.$) (Just (LitE (IntegerL 1)))) (ConT GHC.Types.Int)\n</code></pre>\n\n<p>Now, the code generation is handled by <code>toText</code> itself depending on the type. This is how I wrote it in <code>ghc 7.10.3</code> - it takes the default code (from the first splice as shown above), and overloads it for some types - now, we have the right code in <code>TH</code> codegen location at compile time:</p>\n\n<pre><code>{-# LANGUAGE FlexibleInstances #-}\nmodule ToText \nwhere\n\nimport Data.List\nimport Data.Text (unpack, pack, Text)\n\nclass ToText a where\n    toText :: (Show a) =&gt; a -&gt; Text\n\ninstance {-# OVERLAPPING #-} ToText a  where\n    toText = pack . show\n\ninstance {-# OVERLAPPING #-} ToText Char where\n    toText c = pack [c]\n\ninstance {-# OVERLAPPING #-} ToText String where\n    toText = pack\n\ninstance {-# OVERLAPPING #-} ToText Text where\n    toText = id\n</code></pre>\n"}, {"comments": [{"owner": {"reputation": 44013, "user_id": 1477667, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/trgKM.jpg?s=128&g=1", "display_name": "dfeuer", "link": "https://stackoverflow.com/users/1477667/dfeuer"}, "edited": false, "score": 0, "creation_date": 1458696242, "post_id": 36168097, "comment_id": 59973614, "body": "Is there some reason you didn&#39;t use <code>toTextC :: a -&gt; proxy b -&gt; Text</code>? That&#39;s the usual approach, and less verbose. Also, I think you should indeed flip those arguments. The downside of this, of course, is that it&#39;s quite closed. That&#39;s also an upside."}, {"owner": {"reputation": 44013, "user_id": 1477667, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/trgKM.jpg?s=128&g=1", "display_name": "dfeuer", "link": "https://stackoverflow.com/users/1477667/dfeuer"}, "edited": false, "score": 0, "creation_date": 1458696424, "post_id": 36168097, "comment_id": 59973658, "body": "It also tends to be better for the more interesting argument to an MPTC to come last (as someone reminded me recently, generalized newtype deriving is better that way). So the instance selection type should probably be the first class argument."}, {"owner": {"reputation": 37486, "user_id": 371753, "user_type": "registered", "accept_rate": 83, "profile_image": "https://i.stack.imgur.com/znFEK.jpg?s=128&g=1", "display_name": "sclv", "link": "https://stackoverflow.com/users/371753/sclv"}, "reply_to_user": {"reputation": 44013, "user_id": 1477667, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/trgKM.jpg?s=128&g=1", "display_name": "dfeuer", "link": "https://stackoverflow.com/users/1477667/dfeuer"}, "edited": false, "score": 0, "creation_date": 1458697158, "post_id": 36168097, "comment_id": 59973872, "body": "As I noted at the end &quot;it might be nice to flip the arguments&quot; -- i didn&#39;t do it because I started one way and didn&#39;t feel like changing it, and the answer still stands regardless. Also <code>toTextC</code> is only used internally, so it doesn&#39;t really matter. The only exported &quot;interface&quot; is <code>toText</code> itself."}], "tags": [], "owner": {"reputation": 37486, "user_id": 371753, "user_type": "registered", "accept_rate": 83, "profile_image": "https://i.stack.imgur.com/znFEK.jpg?s=128&g=1", "display_name": "sclv", "link": "https://stackoverflow.com/users/371753/sclv"}, "is_accepted": true, "score": 3, "last_activity_date": 1458695513, "creation_date": 1458695513, "answer_id": 36168097, "question_id": 36161217, "link": "https://stackoverflow.com/questions/36161217/performing-type-equality-in-template-haskell/36168097#36168097", "title": "Performing type equality in template haskell", "body": "<p>As a follow-on to the other answer, here's something that lets you write ToText without any overlapping instances. It uses my new favorite trick -- mixing closed type families over datakinds as a \"choice\" mechanism with typical type classes (note: not even using functional dependencies, much less overlapping instances) to synthesize the actual code:</p>\n\n<pre><code>{-# LANGUAGE TypeFamilies, DataKinds, MultiParamTypeClasses, FlexibleInstances, ScopedTypeVariables, FlexibleContexts #-}\n\nimport Data.List\nimport Data.Text (unpack, pack, Text)\nimport Data.Proxy\n\ndata ToTextMethod = TTMChar | TTMString | TTMText | TTMShow\n\ntype family ToTextHow a where\n     ToTextHow Char = TTMChar\n     ToTextHow String = TTMString\n     ToTextHow Text = TTMText\n     ToTextHow a = TTMShow\n\nclass ToTextC a b where\n      toTextC :: a -&gt; b -&gt; Text\n\ninstance Show a =&gt; ToTextC a (Proxy TTMShow) where\n      toTextC a _ = pack (show a)\n\ninstance ToTextC Char (Proxy TTMChar) where\n      toTextC c _ = pack [c]\n\ninstance ToTextC String (Proxy TTMString) where\n      toTextC s _ = pack s\n\ninstance ToTextC Text (Proxy TTMText) where\n      toTextC t _ = t\n\ntoText :: forall a. (Show a, ToTextC a (Proxy (ToTextHow a))) =&gt; a -&gt; Text\ntoText x = toTextC x (Proxy :: Proxy (ToTextHow a))\n</code></pre>\n\n<p>The names could probably use some work, and it might be nice to flip the arguments to <code>toTextC</code>, but this all works even in ghc 7.8.3.</p>\n"}], "owner": {"reputation": 4185, "user_id": 986475, "user_type": "registered", "accept_rate": 89, "profile_image": "https://www.gravatar.com/avatar/dd36406ee6957594a633373c297a3ab1?s=128&d=identicon&r=PG", "display_name": "Sal", "link": "https://stackoverflow.com/users/986475/sal"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 270, "favorite_count": 3, "accepted_answer_id": 36168097, "answer_count": 2, "score": 2, "last_activity_date": 1458695513, "creation_date": 1458667562, "question_id": 36161217, "link": "https://stackoverflow.com/questions/36161217/performing-type-equality-in-template-haskell", "title": "Performing type equality in template haskell", "body": "<p>I have a function in <code>Template Haskell</code> that extracts the type information for sum of record constructors as below:</p>\n\n<pre><code>listFields :: Name -&gt; Q ([[(String,Name,Type)]])\nlistFields name = do\n  TyConI (DataD _ _ _ cons _) &lt;- reify name  \n  let showClause (RecC conName fields) = (map (\\(x,_,t) -&gt; (nameBase $ x,x,t)) fields)\n  return $ map showClause cons\n</code></pre>\n\n<p>Given the type in there for a field, how do you compare equality of that type with a particular type like <code>GHC.Base.String</code> or <code>Data.Text.Internal.Text</code>? I see <code>TypeQ</code> in <code>TH</code> documentation. It builds type expression. However, I can't find any documentation on how to build a particular type like <code>String</code> or <code>Text</code> or <code>Int</code> so that I can use it for equality comparison? Will appreciate pointers on how to do this, especially how to get the AST for a particular type.</p>\n\n<p>The reason for this question is that given record constructor, we want to convert each field to <code>Text</code>. However, <code>show</code> and <code>pack</code> should be called differently for <code>String</code> and <code>Text</code> types. So, need to generate different splices if the type is <code>Text</code> (no conversion) or <code>String</code> (only call <code>pack</code>, don't call <code>show</code>) or something else (call <code>pack . show</code> assuming <code>Show</code> instance exists).</p>\n"}, {"tags": ["haskell"], "answers": [{"comments": [{"owner": {"user_type": "does_not_exist", "display_name": "user6100041"}, "edited": false, "score": 0, "creation_date": 1458666538, "post_id": 36160832, "comment_id": 59958758, "body": "already did it and still not working still giving me the parse error xD @Carsten"}, {"owner": {"reputation": 48129, "user_id": 76051, "user_type": "registered", "accept_rate": 91, "profile_image": "https://i.stack.imgur.com/AGDxz.jpg?s=128&g=1", "display_name": "Carsten", "link": "https://stackoverflow.com/users/76051/carsten"}, "edited": false, "score": 0, "creation_date": 1458666889, "post_id": 36160832, "comment_id": 59959031, "body": "once the typo in <code>orderTriple</code> (I somehow got in there) is fixed this will work if I copy&amp;paste it straight from here to Haskell (and use some <code>three</code> - in my case <code>three = id</code>) - best guess: you have another <i>problem</i> in code we do not see"}], "tags": [], "owner": {"reputation": 48129, "user_id": 76051, "user_type": "registered", "accept_rate": 91, "profile_image": "https://i.stack.imgur.com/AGDxz.jpg?s=128&g=1", "display_name": "Carsten", "link": "https://stackoverflow.com/users/76051/carsten"}, "is_accepted": false, "score": 3, "last_activity_date": 1458666833, "last_edit_date": 1458666833, "creation_date": 1458666449, "answer_id": 36160832, "question_id": 36160673, "link": "https://stackoverflow.com/questions/36160673/ghg-hs451parse-error-possibly-incorrect-indentation-or-mismatched-brackets/36160832#36160832", "title": "ghg.hs:45:1:parse error possibly incorrect indentation or mismatched brackets", "body": "<p>you are missing the <code>(..)</code> around In<code>teger, Integer, Integer</code> and <code>x,y,z</code>:</p>\n\n<pre><code>orderTriple :: (Integer, Integer, Integer) -&gt; (Integer, Integer, Integer)\norderTriple (x, y, z)\n  | x &lt; y &amp;&amp; x &lt; z &amp;&amp; y &lt; z = (three x, three y, three z)\n  | x &lt; y &amp;&amp; x &lt; z &amp;&amp; z &lt; y = (three x, three z, three y)\n  | y &lt; x &amp;&amp; y &lt; z &amp;&amp; x &lt; z = (three y, three x, three z)\n  | y &lt; x &amp;&amp; y &lt; z &amp;&amp; z &lt; x = (three y, three z, three x)\n  | z &lt; x &amp;&amp; z &lt; y &amp;&amp; y &lt; x = (three z, three x, three y)\n  | otherwise             = (three z, three y, three x\n</code></pre>\n\n<p>should work</p>\n"}, {"comments": [{"owner": {"reputation": 384463, "user_id": 1126841, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/fa05233b2357f8d11c22ef4cfc7bb85c?s=128&d=identicon&r=PG", "display_name": "chepner", "link": "https://stackoverflow.com/users/1126841/chepner"}, "edited": false, "score": 0, "creation_date": 1458666598, "post_id": 36160859, "comment_id": 59958807, "body": "This is a comment on his approach, not an answer to the question."}, {"owner": {"reputation": 44013, "user_id": 1477667, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/trgKM.jpg?s=128&g=1", "display_name": "dfeuer", "link": "https://stackoverflow.com/users/1477667/dfeuer"}, "reply_to_user": {"reputation": 384463, "user_id": 1126841, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/fa05233b2357f8d11c22ef4cfc7bb85c?s=128&d=identicon&r=PG", "display_name": "chepner", "link": "https://stackoverflow.com/users/1126841/chepner"}, "edited": false, "score": 0, "creation_date": 1458666745, "post_id": 36160859, "comment_id": 59958917, "body": "@chepner, I had an answer, but it was based on a misreading of the question. So I removed it promptly. I&#39;ve now added advice on fixing based on their comment on Carsten&#39;s answer."}, {"owner": {"reputation": 44013, "user_id": 1477667, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/trgKM.jpg?s=128&g=1", "display_name": "dfeuer", "link": "https://stackoverflow.com/users/1477667/dfeuer"}, "reply_to_user": {"reputation": 384463, "user_id": 1126841, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/fa05233b2357f8d11c22ef4cfc7bb85c?s=128&d=identicon&r=PG", "display_name": "chepner", "link": "https://stackoverflow.com/users/1126841/chepner"}, "edited": false, "score": 0, "creation_date": 1458666878, "post_id": 36160859, "comment_id": 59959021, "body": "@chepner, I also believe in separating concerns <i>first</i>. Whether debugging a parse error, a type error, a runtime error, or a semantic error, it&#39;s easier to do it if you&#39;re working with smaller pieces."}], "tags": [], "owner": {"reputation": 44013, "user_id": 1477667, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/trgKM.jpg?s=128&g=1", "display_name": "dfeuer", "link": "https://stackoverflow.com/users/1477667/dfeuer"}, "is_accepted": false, "score": 2, "last_activity_date": 1458672675, "last_edit_date": 1458672675, "creation_date": 1458666510, "answer_id": 36160859, "question_id": 36160673, "link": "https://stackoverflow.com/questions/36160673/ghg-hs451parse-error-possibly-incorrect-indentation-or-mismatched-brackets/36160859#36160859", "title": "ghg.hs:45:1:parse error possibly incorrect indentation or mismatched brackets", "body": "<p>Ordering things and multiplying them by three are completely independent operations. Write a function to order them <em>without</em> multiplying them by three.</p>\n\n<p>Can you see how to do this using at most three comparisons?</p>\n\n<p>As for your parse error, run GHC with <code>-fwarn-tabs</code>. If it warns you about tabs, use spaces instead.</p>\n"}, {"tags": [], "owner": {"reputation": 869, "user_id": 2029548, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/5f44dcf3e58fcd22cd857cd563402178?s=128&d=identicon&r=PG", "display_name": "obadz", "link": "https://stackoverflow.com/users/2029548/obadz"}, "is_accepted": false, "score": 2, "last_activity_date": 1458671262, "creation_date": 1458671262, "answer_id": 36162365, "question_id": 36160673, "link": "https://stackoverflow.com/questions/36160673/ghg-hs451parse-error-possibly-incorrect-indentation-or-mismatched-brackets/36162365#36162365", "title": "ghg.hs:45:1:parse error possibly incorrect indentation or mismatched brackets", "body": "<p>Your code runs fine for me but you'll get more reuse out of something like this:</p>\n\n<pre><code>orderedTriple :: (Num a, Ord a) =&gt; (a, a, a) -&gt; (a, a, a)\norderedTriple = mapTriplet (* 3) . orderedTriplet\n\nmapTriplet :: (a -&gt; b) -&gt; (a, a, a) -&gt; (b, b, b)\nmapTriplet f (x, y, z) = (f x, f y, f z)\n\norderedTriplet :: Ord a =&gt; (a, a, a) -&gt; (a, a, a)\norderedTriplet (x, y, z)\n    | x &lt;= u    = (x, u, v)\n    | x &lt;= v    = (u, x, v)\n    | otherwise = (u, v, x)\n    where (u, v) = orderedPair (y, z)\n\norderedPair :: Ord a =&gt; (a, a) -&gt; (a, a)\norderedPair (x, y)\n    | x &lt;= y    = (x, y)\n    | otherwise = (y, x)\n</code></pre>\n"}], "owner": {"user_type": "does_not_exist", "display_name": "user6100041"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 79, "favorite_count": 0, "answer_count": 3, "score": -4, "last_activity_date": 1601044734, "creation_date": 1458665990, "last_edit_date": 1601044734, "question_id": 36160673, "link": "https://stackoverflow.com/questions/36160673/ghg-hs451parse-error-possibly-incorrect-indentation-or-mismatched-brackets", "title": "ghg.hs:45:1:parse error possibly incorrect indentation or mismatched brackets", "body": "<p>It's a program that you give 3 numbers and it needs to order them crescently, I also created the function three that multiplies numbers by 3. That's what I tried to do:</p>\n<pre><code>ordertriple :: (Integer, Integer, Integer) -&gt; (Integer, Integer, Integer)\nordertriple (x, y, z) \n      | x &lt; y &amp;&amp; x &lt; z &amp;&amp; y &lt; z = (three x, three y, three z)\n      | x &lt; y &amp;&amp; x &lt; z &amp;&amp; z &lt; y = (three x, three z, three y)\n      | y &lt; x &amp;&amp; y &lt; z &amp;&amp; x &lt; z = (three y, three x, three z)\n      | y &lt; x &amp;&amp; y &lt; z &amp;&amp; z &lt; x = (three y, three z, three x)\n      | z &lt; x &amp;&amp; z &lt; y &amp;&amp; y &lt; x = (three z, three x, three y)\n      | otherwise               = (three z, three y, three x)\n</code></pre>\n"}, {"tags": ["haskell", "unicode"], "comments": [{"owner": {"reputation": 9772, "user_id": 3963, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/9pDQ8.png?s=128&g=1", "display_name": "hao", "link": "https://stackoverflow.com/users/3963/hao"}, "edited": false, "score": 1, "creation_date": 1458664235, "post_id": 36159921, "comment_id": 59957249, "body": "In Haskell <code>String</code> represents a Unicode string. Which encoding do you want to use to convert a Unicode string into byte form?"}, {"owner": {"reputation": 3040, "user_id": 4308453, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/fc596d8352ad2c4254536343139b5b82?s=128&d=identicon&r=PG&f=1", "display_name": "zakyggaps", "link": "https://stackoverflow.com/users/4308453/zakyggaps"}, "edited": false, "score": 0, "creation_date": 1458664879, "post_id": 36159921, "comment_id": 59957673, "body": "I guess you mean serialization? Have you checked <code>Data.Binary</code>?"}], "answers": [{"tags": [], "owner": {"reputation": 9772, "user_id": 3963, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/9pDQ8.png?s=128&g=1", "display_name": "hao", "link": "https://stackoverflow.com/users/3963/hao"}, "is_accepted": false, "score": 2, "last_activity_date": 1458665488, "creation_date": 1458665488, "answer_id": 36160500, "question_id": 36159921, "link": "https://stackoverflow.com/questions/36159921/haskell-convert-string-with-unicode-characters-to-chunks-of-64-bits/36160500#36160500", "title": "haskell: convert string with unicode characters to chunks of 64 bits", "body": "<h2>UTF-8</h2>\n\n<p>Assuming UTF-8, the <code>utf8-string</code> package implements the desired encoding algorithm. The <code>encode</code> function below takes a <code>String</code> and returns an array of unsigned bytes.</p>\n\n\n\n<pre><code>module Main where\n\nimport Codec.Binary.UTF8.String as UTF8\n\nmain :: IO ()\nmain =\n  print (UTF8.encode \"\u2602\u265e\u262f\")\n</code></pre>\n\n<p>Output:</p>\n\n<pre><code>\u03bb&gt; main\n[226,152,130,226,153,158,226,152,175]\n</code></pre>\n\n<p>As you can see, UTF-8 represents your Unicode string as nine different bytes. You'll have to write your own code to convert them into chunks of 64 bits. There are lots of different ways of chunking them!</p>\n"}, {"tags": [], "owner": {"reputation": 100892, "user_id": 745903, "user_type": "registered", "accept_rate": 74, "profile_image": "https://www.gravatar.com/avatar/50933f6638836741e620669b3940410e?s=128&d=identicon&r=PG", "display_name": "leftaroundabout", "link": "https://stackoverflow.com/users/745903/leftaroundabout"}, "is_accepted": true, "score": 3, "last_activity_date": 1458666034, "last_edit_date": 1458666034, "creation_date": 1458665593, "answer_id": 36160531, "question_id": 36159921, "link": "https://stackoverflow.com/questions/36159921/haskell-convert-string-with-unicode-characters-to-chunks-of-64-bits/36160531#36160531", "title": "haskell: convert string with unicode characters to chunks of 64 bits", "body": "<p><a href=\"http://hackage.haskell.org/package/bytestring-0.10.6.0/docs/Data-ByteString-Char8.html\" rel=\"nofollow\">The <code>ByteString.Char8</code> documentation says</a> (emphasis mine):</p>\n\n<blockquote>\n  <p>Manipulate <code>ByteStrings</code> using <code>Char</code> operations. All Chars will be <strong>truncated to 8 bits</strong>. It can be expected that these functions will run at identical speeds to their Word8 equivalents in <a href=\"http://hackage.haskell.org/package/bytestring-0.10.6.0/docs/Data-ByteString.html\" rel=\"nofollow\">Data.ByteString</a>.</p>\n</blockquote>\n\n<p>IOW, this only works as you'd expect for pure ASCII strings. Well, the <code>Char8</code> in the module name rather suggests this already, doesn't it? So, no, it should not print <code>\u2602\u265e\u262f</code>.</p>\n\n<p>Your second approach makes more sense. To make it reliable you should use not <code>Int</code> but <code>Word64</code>; you can convert to such a type by using <code>fromIntegral . fromEnum</code> instead of just the latter.</p>\n\n<p>It's not really advisable to try building a <code>ByteString</code> directly from such words, because purely functional concatenation of array-like things doesn't work well. But the <a href=\"http://hackage.haskell.org/package/binary-0.8.2.1/docs/Data-Binary-Builder.html\" rel=\"nofollow\"><code>Binary.Builder</code></a> module has an efficient monoid for this purpose. A monoid can directly be mapped over a list:</p>\n\n<pre><code>&gt; toLazyByteString $ foldMap (putWord64le . fromIntegral . fromEnum) \"\u2602\u265e\u262f\"\n\"\\STX&amp;\\NUL\\NUL\\NUL\\NUL\\NUL\\NUL^&amp;\\NUL\\NUL\\NUL\\NUL\\NUL\\NUL/&amp;\\NUL\\NUL\\NUL\\NUL\\NUL\\NUL\"\n</code></pre>\n\n<p>So, these are the actual 64-bit chunks you asked for. Basicall UTF-64, which is of course highly space-inefficient.</p>\n\n<p>Depending on what you want to do, a better alternative might be to just <a href=\"http://hackage.haskell.org/package/binary-0.8.2.1/docs/Data-Binary.html#v:encode\" rel=\"nofollow\">encode</a> the string:</p>\n\n<pre><code>Prelude Data.Binary&gt; encode \"\u2602\u265e\u262f\"\n\"\\NUL\\NUL\\NUL\\NUL\\NUL\\NUL\\NUL\\ETX\\226\\152\\130\\226\\153\\158\\226\\152\\175\"\n</code></pre>\n\n<p>This actually stores the string as UTF-8 (plus the <em>length</em> information stored in the first eight bytes). This can be very easily undone:</p>\n\n<pre><code>Prelude Data.Binary&gt; putStrLn . decode $ encode \"\u2602\u265e\u262f\"\n\u2602\u265e\u262f\n</code></pre>\n"}], "owner": {"reputation": 4014, "user_id": 239117, "user_type": "registered", "accept_rate": 83, "profile_image": "https://i.stack.imgur.com/f6WTW.jpg?s=128&g=1", "display_name": "watain", "link": "https://stackoverflow.com/users/239117/watain"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 325, "favorite_count": 1, "accepted_answer_id": 36160531, "answer_count": 2, "score": 0, "last_activity_date": 1458668082, "creation_date": 1458663886, "question_id": 36159921, "link": "https://stackoverflow.com/questions/36159921/haskell-convert-string-with-unicode-characters-to-chunks-of-64-bits", "title": "haskell: convert string with unicode characters to chunks of 64 bits", "body": "<p>I'd like to convert a <code>String</code> to chunks of 64 bits. I'm not sure whether <code>ByteString</code> is the correct data type to use, but after some testing I realized that I can't convert a <code>String</code> to a <code>ByteString</code> and back:</p>\n\n<pre><code>import qualified Data.ByteString.Lazy.Char8 as B\nmain = putStrLn $ B.unpack $ B.pack \"\u2602\u265e\u262f\"\n</code></pre>\n\n<p>Result:</p>\n\n<pre><code>^/\n</code></pre>\n\n<p>Shouldn't this print <code>\u2602\u265e\u262f</code>?</p>\n\n<p>My second attempt was to split the <code>String</code> into a list of <code>Int</code>s, each <code>Int</code> representing a character:</p>\n\n<pre><code>main = putStrLn $ show $ map fromEnum \"\u2602\u265e\u262f\"\n</code></pre>\n\n<p>Result:</p>\n\n<pre><code>[9730,9822,9775]\n</code></pre>\n\n<p>Now how can I convert this list into a list of 64 bit chunks? It is important that I'm able to convert the 64 bit chunks back to a <code>String</code> afterwards, without losing any information.</p>\n"}, {"tags": ["list", "haskell", "functional-programming"], "comments": [{"owner": {"reputation": 69792, "user_id": 493122, "user_type": "registered", "accept_rate": 96, "profile_image": "https://www.gravatar.com/avatar/1f90ae01c2e24801c2df9189179b0ccd?s=128&d=identicon&r=PG", "display_name": "Shoe", "link": "https://stackoverflow.com/users/493122/shoe"}, "edited": false, "score": 3, "creation_date": 1458651194, "post_id": 36154905, "comment_id": 59946866, "body": "Should it deal with duplicates?"}, {"owner": {"reputation": 100892, "user_id": 745903, "user_type": "registered", "accept_rate": 74, "profile_image": "https://www.gravatar.com/avatar/50933f6638836741e620669b3940410e?s=128&d=identicon&r=PG", "display_name": "leftaroundabout", "link": "https://stackoverflow.com/users/745903/leftaroundabout"}, "edited": false, "score": 1, "creation_date": 1458651347, "post_id": 36154905, "comment_id": 59946988, "body": "...or do you basically consider lists as <i>sets</i>? (There&#39;s <a href=\"http://hackage.haskell.org/package/containers-0.5.7.1/docs/Data-Set.html\" rel=\"nofollow noreferrer\">a better type for those</a>.)"}, {"owner": {"reputation": 77, "user_id": 4954360, "user_type": "registered", "accept_rate": 0, "profile_image": "https://www.gravatar.com/avatar/fe0e0ef4113070bda2daaf77de736323?s=128&d=identicon&r=PG&f=1", "display_name": "Marc Blume", "link": "https://stackoverflow.com/users/4954360/marc-blume"}, "reply_to_user": {"reputation": 69792, "user_id": 493122, "user_type": "registered", "accept_rate": 96, "profile_image": "https://www.gravatar.com/avatar/1f90ae01c2e24801c2df9189179b0ccd?s=128&d=identicon&r=PG", "display_name": "Shoe", "link": "https://stackoverflow.com/users/493122/shoe"}, "edited": false, "score": 0, "creation_date": 1458651532, "post_id": 36154905, "comment_id": 59947134, "body": "@Shoe there will be no duplicated element, so it should not."}, {"owner": {"reputation": 69792, "user_id": 493122, "user_type": "registered", "accept_rate": 96, "profile_image": "https://www.gravatar.com/avatar/1f90ae01c2e24801c2df9189179b0ccd?s=128&d=identicon&r=PG", "display_name": "Shoe", "link": "https://stackoverflow.com/users/493122/shoe"}, "edited": false, "score": 0, "creation_date": 1458651726, "post_id": 36154905, "comment_id": 59947299, "body": "What kind of libraries are you not allowed to use or don&#39;t want to use? You should probably specify that in the question."}, {"owner": {"reputation": 77, "user_id": 4954360, "user_type": "registered", "accept_rate": 0, "profile_image": "https://www.gravatar.com/avatar/fe0e0ef4113070bda2daaf77de736323?s=128&d=identicon&r=PG&f=1", "display_name": "Marc Blume", "link": "https://stackoverflow.com/users/4954360/marc-blume"}, "reply_to_user": {"reputation": 69792, "user_id": 493122, "user_type": "registered", "accept_rate": 96, "profile_image": "https://www.gravatar.com/avatar/1f90ae01c2e24801c2df9189179b0ccd?s=128&d=identicon&r=PG", "display_name": "Shoe", "link": "https://stackoverflow.com/users/493122/shoe"}, "edited": false, "score": 0, "creation_date": 1458651831, "post_id": 36154905, "comment_id": 59947362, "body": "@Shoe I will not use any library. I try to implement using recursion."}, {"owner": {"reputation": 69792, "user_id": 493122, "user_type": "registered", "accept_rate": 96, "profile_image": "https://www.gravatar.com/avatar/1f90ae01c2e24801c2df9189179b0ccd?s=128&d=identicon&r=PG", "display_name": "Shoe", "link": "https://stackoverflow.com/users/493122/shoe"}, "edited": false, "score": 2, "creation_date": 1458651861, "post_id": 36154905, "comment_id": 59947382, "body": "What exactly have you tried?"}, {"owner": {"reputation": 77, "user_id": 4954360, "user_type": "registered", "accept_rate": 0, "profile_image": "https://www.gravatar.com/avatar/fe0e0ef4113070bda2daaf77de736323?s=128&d=identicon&r=PG&f=1", "display_name": "Marc Blume", "link": "https://stackoverflow.com/users/4954360/marc-blume"}, "reply_to_user": {"reputation": 69792, "user_id": 493122, "user_type": "registered", "accept_rate": 96, "profile_image": "https://www.gravatar.com/avatar/1f90ae01c2e24801c2df9189179b0ccd?s=128&d=identicon&r=PG", "display_name": "Shoe", "link": "https://stackoverflow.com/users/493122/shoe"}, "edited": false, "score": 0, "creation_date": 1458652303, "post_id": 36154905, "comment_id": 59947715, "body": "@Shoe i uploaded here. <a href=\"http://prntscr.com/aih6mc\" rel=\"nofollow noreferrer\">prntscr.com/aih6mc</a> Actually, I have to use one more recursion for y:ys but I could not do that."}, {"owner": {"reputation": 44013, "user_id": 1477667, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/trgKM.jpg?s=128&g=1", "display_name": "dfeuer", "link": "https://stackoverflow.com/users/1477667/dfeuer"}, "edited": false, "score": 1, "creation_date": 1458696900, "post_id": 36154905, "comment_id": 59973790, "body": "I&#39;m voting to close this question as off-topic because it&#39;s not our job to do your homework. Non-working code should be included in the body of the question, with an explanation of what it should do and what it&#39;s doing instead."}], "answers": [{"comments": [{"owner": {"reputation": 77, "user_id": 4954360, "user_type": "registered", "accept_rate": 0, "profile_image": "https://www.gravatar.com/avatar/fe0e0ef4113070bda2daaf77de736323?s=128&d=identicon&r=PG&f=1", "display_name": "Marc Blume", "link": "https://stackoverflow.com/users/4954360/marc-blume"}, "edited": false, "score": 1, "creation_date": 1458651683, "post_id": 36155028, "comment_id": 59947267, "body": "Thank you for response, but I dont want to use any library. I want to implement without using module. I try to do that using recursion."}], "tags": [], "owner": {"reputation": 69792, "user_id": 493122, "user_type": "registered", "accept_rate": 96, "profile_image": "https://www.gravatar.com/avatar/1f90ae01c2e24801c2df9189179b0ccd?s=128&d=identicon&r=PG", "display_name": "Shoe", "link": "https://stackoverflow.com/users/493122/shoe"}, "is_accepted": false, "score": 1, "last_activity_date": 1458652791, "last_edit_date": 1458652791, "creation_date": 1458651496, "answer_id": 36155028, "question_id": 36154905, "link": "https://stackoverflow.com/questions/36154905/how-many-elements-are-the-same-in-two-lists-haskell/36155028#36155028", "title": "How many elements are the same in two lists (haskell)", "body": "<p>You can use the module <code>Data.Set</code> to convert the two lists to sets and calculate the size of the intersection:</p>\n\n<pre><code>let a = Set.fromList [\"t\",\"k\",\"m\"]\nlet b = Set.fromList [\"k\",\"b\",\"t\",\"c\"]\nprint $ Set.size (a `Set.intersection` b)\n</code></pre>\n\n<p><a href=\"http://coliru.stacked-crooked.com/a/e6b2d928f565bab7\" rel=\"nofollow\"><kbd>Live demo</kbd></a></p>\n\n<p>As a general rule, if the order of the elements in the list doesn't matter and the list doesn't contain duplicates it's a good idea to convert it into a <code>Set</code>.</p>\n\n<hr>\n\n<p>For some reason you don't want to use the standard library. If you don't care about algorithmic complexity you can then use:</p>\n\n<pre><code>length $ Prelude.filter (`elem` b) a\n</code></pre>\n\n<p><a href=\"http://coliru.stacked-crooked.com/a/cd44125f8e4376b3\" rel=\"nofollow\"><kbd>Live demo</kbd></a></p>\n\n<p>of if you want it to be put into recursive form, then it's something like this:</p>\n\n<pre><code>countDuplicates :: (Eq a) =&gt; [a] -&gt; [a] -&gt; Int\ncountDuplicates [] b = 0\ncountDuplicates (x:rest) b =\n    let index = if x `elem` b then 1 else 0\n    in index + countDuplicates rest b\n</code></pre>\n\n<p><a href=\"http://coliru.stacked-crooked.com/a/2da061682842fb54\" rel=\"nofollow\"><kbd>Live demo</kbd></a></p>\n\n<p>which if you don't want to use <code>elem</code> either will be further expanded to:</p>\n\n<pre><code>countDuplicates :: (Eq a) =&gt; [a] -&gt; [a] -&gt; Int\ncountDuplicates [] b = 0\ncountDuplicates (x:rest) b =\n    let myElem a [] = False\n        myElem a (al:lst) = if a == al then True else myElem a lst\n        index = if x `myElem` b then 1 else 0\n    in index + countDuplicates rest b\n</code></pre>\n\n<p><a href=\"http://coliru.stacked-crooked.com/a/b0fa1fe64d137a66\" rel=\"nofollow\"><kbd>Live demo</kbd></a></p>\n"}, {"tags": [], "owner": {"reputation": 62252, "user_id": 1435869, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/TrEd9.jpg?s=128&g=1", "display_name": "karakfa", "link": "https://stackoverflow.com/users/1435869/karakfa"}, "is_accepted": false, "score": 0, "last_activity_date": 1458653661, "creation_date": 1458653661, "answer_id": 36155844, "question_id": 36154905, "link": "https://stackoverflow.com/questions/36154905/how-many-elements-are-the-same-in-two-lists-haskell/36155844#36155844", "title": "How many elements are the same in two lists (haskell)", "body": "<p>Without using any extra functions you can write it simply as follows</p>\n\n<pre><code>countIntersect :: (Eq a) =&gt; [a] -&gt; [a] -&gt; Int\ncountIntersect _ [] = 0\ncountIntersect [] _ = 0\ncountIntersect (x:xs) y'@(y:ys) | x==y = 1 + countIntersect xs ys\n                                | otherwise = countIntersect [x] ys + countIntersect xs y'\n</code></pre>\n\n<p>essentially, the way you would do by hand, compare the first two elements if same increase the counter and move the next element in both list.  If not equal compare the first element of the first list with the rest of second list and remainder of the first list to the second list.  </p>\n"}], "owner": {"reputation": 77, "user_id": 4954360, "user_type": "registered", "accept_rate": 0, "profile_image": "https://www.gravatar.com/avatar/fe0e0ef4113070bda2daaf77de736323?s=128&d=identicon&r=PG&f=1", "display_name": "Marc Blume", "link": "https://stackoverflow.com/users/4954360/marc-blume"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 1564, "favorite_count": 0, "answer_count": 2, "score": -3, "last_activity_date": 1458653661, "creation_date": 1458651116, "last_edit_date": 1458652951, "question_id": 36154905, "link": "https://stackoverflow.com/questions/36154905/how-many-elements-are-the-same-in-two-lists-haskell", "title": "How many elements are the same in two lists (haskell)", "body": "<p>I try to learn how many elements are the same in the given two sets. To be clear,</p>\n\n<pre><code>let a = [\"t\",\"k\",\"m\"]\nlet b = [\"k\",\"b\",\"t\",\"c\"]\n</code></pre>\n\n<p>\"t\" and \"k\" are parts of both lists, so the return will be 2. How can I implement like this function without using any library and using recursion?</p>\n"}, {"tags": ["haskell"], "comments": [{"owner": {"reputation": 13807, "user_id": 2407038, "user_type": "registered", "accept_rate": 64, "profile_image": "https://www.gravatar.com/avatar/538f6f4a9aa43841841de7d8e8b169fc?s=128&d=identicon&r=PG&f=1", "display_name": "user2407038", "link": "https://stackoverflow.com/users/2407038/user2407038"}, "edited": false, "score": 2, "creation_date": 1458633525, "post_id": 36148859, "comment_id": 59935291, "body": "<code>\\x -&gt; isZero . mod x = \\x -&gt; (.) isZero (mod x) = (.) isZero . mod</code>"}], "answers": [{"comments": [{"owner": {"reputation": 26921, "user_id": 1088797, "user_type": "registered", "accept_rate": 79, "profile_image": "https://i.stack.imgur.com/bltA9.png?s=128&g=1", "display_name": "Dan Prince", "link": "https://stackoverflow.com/users/1088797/dan-prince"}, "edited": false, "score": 0, "creation_date": 1458633771, "post_id": 36148938, "comment_id": 59935392, "body": "Ok, so the discrepancy is the LHS <code>b</code> expecting an <code>Int</code> but getting an <code>(Int -&gt; Int)</code>? So the problem is composing a function that expects &gt;= two arguments?"}, {"owner": {"reputation": 94713, "user_id": 1139697, "user_type": "registered", "accept_rate": 86, "profile_image": "https://www.gravatar.com/avatar/5f136ddb684f39aaee1c028ee1950f6f?s=128&d=identicon&r=PG", "display_name": "Zeta", "link": "https://stackoverflow.com/users/1139697/zeta"}, "reply_to_user": {"reputation": 26921, "user_id": 1088797, "user_type": "registered", "accept_rate": 79, "profile_image": "https://i.stack.imgur.com/bltA9.png?s=128&g=1", "display_name": "Dan Prince", "link": "https://stackoverflow.com/users/1088797/dan-prince"}, "edited": false, "score": 2, "creation_date": 1458633835, "post_id": 36148938, "comment_id": 59935421, "body": "@DanPrince: Basically, yes (in THIS case; <code>map . mod</code> doesn&#39;t have this problem for example, but that has different semantics). But it&#39;s possible to get around this with another application of <code>(.)</code>. There&#39;s a <a href=\"http://pointfree.io/\" rel=\"nofollow noreferrer\">tool</a>, but keep in mind that you want code to be readable by your drunk self in three months whenever possible."}], "tags": [], "owner": {"reputation": 94713, "user_id": 1139697, "user_type": "registered", "accept_rate": 86, "profile_image": "https://www.gravatar.com/avatar/5f136ddb684f39aaee1c028ee1950f6f?s=128&d=identicon&r=PG", "display_name": "Zeta", "link": "https://stackoverflow.com/users/1139697/zeta"}, "is_accepted": true, "score": 6, "last_activity_date": 1458633774, "last_edit_date": 1458633774, "creation_date": 1458633520, "answer_id": 36148938, "question_id": 36148859, "link": "https://stackoverflow.com/questions/36148859/composition-with-ambiguous-types/36148938#36148938", "title": "Composition with ambiguous types", "body": "<p>Well, let's have a look at the types in your first definition of <code>isMultiple</code>:</p>\n\n<pre><code>(.)            :: (b   -&gt; c   ) -&gt; (a -&gt;   b          ) -&gt; a -&gt; c\nisZero         ::  Int -&gt; Bool\nmod            ::                   Int -&gt; Int -&gt; Int\n                    -- same as      Int -&gt; (Int -&gt; Int)\n</code></pre>\n\n<p>As you can see, both <code>b</code>'s aren't the same. That's why it doesn't work. However, one can get it to work, but that's not that easy to the eye anymore:</p>\n\n<pre><code>isMultiple = (isZero.) . mod\n           = ((.) isZero) . mod\n           = \\x -&gt; ((.) isZero) . mod $ x\n           = \\x -&gt; ((.) isZero) (mod x) \n           = \\x -&gt; (.) isZero (mod x)\n           = \\x -&gt; isZero . mod x\n</code></pre>\n\n<p>As you can see, <code>mod x</code> has type <code>Int -&gt; Int</code>, and therefore is suitable for composition with <code>(.)</code> and <code>isZero</code>.</p>\n"}], "owner": {"reputation": 26921, "user_id": 1088797, "user_type": "registered", "accept_rate": 79, "profile_image": "https://i.stack.imgur.com/bltA9.png?s=128&g=1", "display_name": "Dan Prince", "link": "https://stackoverflow.com/users/1088797/dan-prince"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 139, "favorite_count": 0, "accepted_answer_id": 36148938, "answer_count": 1, "score": 1, "last_activity_date": 1458633774, "creation_date": 1458633274, "question_id": 36148859, "link": "https://stackoverflow.com/questions/36148859/composition-with-ambiguous-types", "title": "Composition with ambiguous types", "body": "<p>First time posting on this tag and I'm still taking tentative steps with the language, but I have some dynamic FP background, so I'm familiar with a few concepts already.</p>\n\n<p>I've defined an <code>isZero</code> function.</p>\n\n<pre><code>isZero :: Int -&gt; Bool\nisZero x = x == 0\n</code></pre>\n\n<p>And I'm trying to compose it with the <code>mod</code> function to create an <code>isMultiple</code> function.</p>\n\n<pre><code>isMultiple = isZero . mod\n</code></pre>\n\n<p>However, this results in a type mismatch, because it's expecting the signature to be <code>a0 -&gt; Int</code> and <code>mod</code> is <code>a0 -&gt; a0 -&gt; a0</code> (assuming this is because it supports multiple precisions).</p>\n\n<p>I've noticed that if I just compose them explicitly (and provide a type signature), then there are no problems.</p>\n\n<pre><code>isMultiple :: Int -&gt; Int -&gt; Bool\nisMultiple x n = isZero $ mod x n\n</code></pre>\n\n<p>Is there a way to use compose functions with ambiguous types using the <code>.</code> operator?</p>\n"}, {"tags": ["http", "haskell"], "answers": [{"tags": [], "owner": {"reputation": 774, "user_id": 2755648, "user_type": "registered", "accept_rate": 80, "profile_image": "https://www.gravatar.com/avatar/633566630d4365c3c872d00efa730166?s=128&d=identicon&r=PG&f=1", "display_name": "sid-kap", "link": "https://stackoverflow.com/users/2755648/sid-kap"}, "is_accepted": true, "score": 4, "last_activity_date": 1458615511, "creation_date": 1458615511, "answer_id": 36145398, "question_id": 36145056, "link": "https://stackoverflow.com/questions/36145056/send-a-get-request-with-headers-in-haskell/36145398#36145398", "title": "Send a GET request with headers in Haskell", "body": "<p>Using the <a href=\"https://hackage.haskell.org/package/wreq-0.4.1.0/docs/Network-Wreq.html\" rel=\"nofollow\">Wreq</a> library, I believe</p>\n\n<pre><code>let opts = defaults &amp; header \"Authorisation\" .~ [\"AUTH_INFO_STRING\"] \n                    &amp; header \"custom-header\" .~ [\"string\"] \n                    &amp; param  \"search_term\"   .~ [\"my\",\"search\"]\ngetWith opts \"http://httpbin.org/someUrl\"\n</code></pre>\n\n<p>should do what you want.</p>\n"}], "owner": {"reputation": 401, "user_id": 4868124, "user_type": "registered", "accept_rate": 62, "profile_image": "https://www.gravatar.com/avatar/86dc340359160250de50ea4860cb9931?s=128&d=identicon&r=PG&f=1", "display_name": "Michael Chav", "link": "https://stackoverflow.com/users/4868124/michael-chav"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 469, "favorite_count": 0, "accepted_answer_id": 36145398, "answer_count": 1, "score": 1, "last_activity_date": 1505308353, "creation_date": 1458612793, "last_edit_date": 1505308353, "question_id": 36145056, "link": "https://stackoverflow.com/questions/36145056/send-a-get-request-with-headers-in-haskell", "title": "Send a GET request with headers in Haskell", "body": "<p>I would like to send an <code>HTTP GET</code> request with an auth header and a custom header in Haskell. I can't seem to find a way to do it - most things seem only to care about headers in <code>POST</code> request. Can anyone help me? So in this case I'm trying to send:</p>\n\n<pre><code>Authorisation: AUTH_INFO_STRING\ncustom-header: string\n</code></pre>\n\n<p>To the URL: <code>someUrl/query?[search_term]</code></p>\n"}, {"tags": ["haskell"], "answers": [{"comments": [{"owner": {"reputation": 44013, "user_id": 1477667, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/trgKM.jpg?s=128&g=1", "display_name": "dfeuer", "link": "https://stackoverflow.com/users/1477667/dfeuer"}, "edited": false, "score": 2, "creation_date": 1458614584, "post_id": 36144350, "comment_id": 59928364, "body": "The trouble, I think, is that GHC won&#39;t commit to the first instance you gave unless/until it has the equality in hand. I know I&#39;ve seen that lead to type errors, but I don&#39;t remember the details."}], "tags": [], "owner": {"reputation": 100892, "user_id": 745903, "user_type": "registered", "accept_rate": 74, "profile_image": "https://www.gravatar.com/avatar/50933f6638836741e620669b3940410e?s=128&d=identicon&r=PG", "display_name": "leftaroundabout", "link": "https://stackoverflow.com/users/745903/leftaroundabout"}, "is_accepted": true, "score": 3, "last_activity_date": 1458607853, "creation_date": 1458607853, "answer_id": 36144350, "question_id": 36144258, "link": "https://stackoverflow.com/questions/36144258/deduction-types-fail-in-haskell/36144350#36144350", "title": "Deduction types fail in Haskell.", "body": "<p>The error message is spot on. In your tuple instance, you have</p>\n\n<pre><code>   f :: ((a,b), (a,b)) -&gt; ((a,b), (a,b))\n</code></pre>\n\n<p>where <code>a</code> and <code>b</code> are in general different types. But for any instance, <code>f</code> can only operate on <code>(a,a)</code> tuples, i.e. you need type equality <code>a ~ b</code>. Thus</p>\n\n<pre><code>instance (My a) =&gt; My (a,a) where\n  f (ab, cd) = (f ab, f cd)\n</code></pre>\n\n<p>would work... or, actually, I remember this causes some problems (forgot what) and you should better make the equality constraint explicit</p>\n\n<pre><code>instance (My a, a~b) =&gt; My (a,b) where\n</code></pre>\n"}, {"tags": [], "owner": {"reputation": 100185, "user_id": 3234959, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/93bb12ca0f93dfddb33880316f7e66c2?s=128&d=identicon&r=PG&f=1", "display_name": "chi", "link": "https://stackoverflow.com/users/3234959/chi"}, "is_accepted": false, "score": 3, "last_activity_date": 1458635301, "creation_date": 1458635301, "answer_id": 36149430, "question_id": 36144258, "link": "https://stackoverflow.com/questions/36144258/deduction-types-fail-in-haskell/36149430#36149430", "title": "Deduction types fail in Haskell.", "body": "<p>You might want the following instance instead:</p>\n\n<pre><code>instance (My a, My b) =&gt; My (a,b) where\n    f ((a, b), (c, d)) = case (f (a, c), f (b, d)) of\n      ((a1, a2), (b1, b2)) -&gt; ((a1, b1), (a2, b2))\n</code></pre>\n\n<p>Above <code>(a, c) :: (a, a)</code> and <code>(b, d) :: (b, b)</code>, so we apply <code>f</code> to those. We get back a pair of type <code>((a, a), (b, b))</code> which we reorder so to obtain <code>((a, b), (a, b))</code>.</p>\n"}], "owner": {"reputation": 3815, "user_id": 5382150, "user_type": "registered", "accept_rate": 86, "profile_image": "https://i.stack.imgur.com/GwGSL.png?s=128&g=1", "display_name": "Gilgamesz", "link": "https://stackoverflow.com/users/5382150/gilgamesz"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 78, "favorite_count": 0, "accepted_answer_id": 36144350, "answer_count": 2, "score": 3, "last_activity_date": 1458635301, "creation_date": 1458607195, "question_id": 36144258, "link": "https://stackoverflow.com/questions/36144258/deduction-types-fail-in-haskell", "title": "Deduction types fail in Haskell.", "body": "<pre><code>class (Eq a) =&gt; My a where\n    f:: (a,a) -&gt; (a,a)\n\ninstance My Int where\n    f (a,b) = (a,b)\n\ninstance My Char where\n    f (a,b) = (a,b)\n</code></pre>\n\n<p>And \"specialization for the pair\". It makes compilation error and I don't know why. Please help to repair it and explain me why it is error.</p>\n\n<pre><code>instance (My a, My b) =&gt; My (a,b) where\n    f ((a,b), (c,d)) = ( (f (a,b)), (f (c,d)) )\n</code></pre>\n\n<p>Error:</p>\n\n<pre><code>test.hs:11:31:\n    Could not deduce (a ~ b)\n    from the context (Eq (a, b), My a, My b)\n      bound by the instance declaration at test.hs:10:10-33\n      `a' is a rigid type variable bound by\n          the instance declaration at test.hs:10:10\n      `b' is a rigid type variable bound by\n          the instance declaration at test.hs:10:10\n    Expected type: (a, b)\n      Actual type: (a, a)\n    In the return type of a call of `f'\n    In the expression: (f (a, b))\n    In the expression: ((f (a, b)), (f (c, d)))\nFailed, modules loaded: none.\n</code></pre>\n"}, {"tags": ["java", "haskell", "interpreter", "ffi"], "comments": [{"owner": {"reputation": 19398, "user_id": 775345, "user_type": "registered", "accept_rate": 96, "profile_image": "https://i.stack.imgur.com/c6jtG.jpg?s=128&g=1", "display_name": "Robert Moskal", "link": "https://stackoverflow.com/users/775345/robert-moskal"}, "edited": false, "score": 5, "creation_date": 1458603033, "post_id": 36143522, "comment_id": 59924928, "body": "Shouldn&#39;t this be called, how to call Haskell from java?"}, {"owner": {"reputation": 199, "user_id": 1276588, "user_type": "registered", "accept_rate": 0, "profile_image": "https://www.gravatar.com/avatar/306650b5c1a53bc6d2a87516ff6a480f?s=128&d=identicon&r=PG", "display_name": "Max Lipton", "link": "https://stackoverflow.com/users/1276588/max-lipton"}, "reply_to_user": {"reputation": 19398, "user_id": 775345, "user_type": "registered", "accept_rate": 96, "profile_image": "https://i.stack.imgur.com/c6jtG.jpg?s=128&g=1", "display_name": "Robert Moskal", "link": "https://stackoverflow.com/users/775345/robert-moskal"}, "edited": false, "score": 0, "creation_date": 1458604068, "post_id": 36143522, "comment_id": 59925250, "body": "Yeah, I think I switched the title by accident."}, {"owner": {"reputation": 37486, "user_id": 371753, "user_type": "registered", "accept_rate": 83, "profile_image": "https://i.stack.imgur.com/znFEK.jpg?s=128&g=1", "display_name": "sclv", "link": "https://stackoverflow.com/users/371753/sclv"}, "edited": false, "score": 1, "creation_date": 1458608306, "post_id": 36143522, "comment_id": 59926616, "body": "@MaxLipton the fact that you&#39;re lost reading those answers don&#39;t mean that they don&#39;t answer the question. It just means that you need to learn more to understand them."}, {"owner": {"reputation": 37486, "user_id": 371753, "user_type": "registered", "accept_rate": 83, "profile_image": "https://i.stack.imgur.com/znFEK.jpg?s=128&g=1", "display_name": "sclv", "link": "https://stackoverflow.com/users/371753/sclv"}, "edited": false, "score": 0, "creation_date": 1458608357, "post_id": 36143522, "comment_id": 59926633, "body": "This answer (linked in the comments of the other thread) may be of service: <a href=\"http://stackoverflow.com/a/10370902/371753\">stackoverflow.com/a/10370902/371753</a>"}, {"owner": {"reputation": 199, "user_id": 1276588, "user_type": "registered", "accept_rate": 0, "profile_image": "https://www.gravatar.com/avatar/306650b5c1a53bc6d2a87516ff6a480f?s=128&d=identicon&r=PG", "display_name": "Max Lipton", "link": "https://stackoverflow.com/users/1276588/max-lipton"}, "edited": false, "score": 0, "creation_date": 1458608530, "post_id": 36143522, "comment_id": 59926674, "body": "I don&#39;t know where to start learning. I was hoping somebody could answer the question in a way that doesn&#39;t require a multiple-hour detour to understand certain minutia."}], "answers": [{"tags": [], "owner": {"reputation": 18999, "user_id": 825637, "user_type": "registered", "accept_rate": 85, "profile_image": "https://www.gravatar.com/avatar/825a58fde1ef99db42c5354dab6cd472?s=128&d=identicon&r=PG", "display_name": "MasterMastic", "link": "https://stackoverflow.com/users/825637/mastermastic"}, "is_accepted": false, "score": 4, "last_activity_date": 1458715092, "last_edit_date": 1458715092, "creation_date": 1458612806, "answer_id": 36145057, "question_id": 36143522, "link": "https://stackoverflow.com/questions/36143522/how-to-call-haskell-from-java/36145057#36145057", "title": "How to call Haskell from Java", "body": "<p>How about just make a GHCi/Hugs process, send it the input, and redirect stdout and stderr to your application? The Java API already has what you need, e.g. <a href=\"https://docs.oracle.com/javase/7/docs/api/java/lang/ProcessBuilder.html\" rel=\"nofollow\">java.lang.ProcessBuilder</a>.</p>\n\n<p>Simply exposing the functions won't give you the ability to interpret Haskell, just exposing those functions (whether by library call or service), will really just expose the functions, not the ability to evaluate Haskell input.</p>\n\n<p>To evaluate Haskell input you would either write your own interpreter, use an existing one (I don't think one exists), or take the option I suggested which should be the most practical and easy: use an existing interpreter and invoke it as a process.</p>\n\n<p>I've had some experience with this approach, it's very simple to get to work, but watch out for unexpected termination and naturally, decide what you want to do when that happens. If this is too difficult for your domain, you may also consider invoking the interpreter per expression, (e.g. <code>ghc -e \"1 + 1\"</code> will output <code>2</code>. See <a href=\"https://downloads.haskell.org/~ghc/latest/docs/html/users_guide/modes.html\" rel=\"nofollow\">Modes of operation</a> in the GHC manual, at section 4.5.2 for more information). This could be easier but I'd only use it for infrequent evaluations because it will be slower, and might be noticeable with rapid input.</p>\n"}], "owner": {"reputation": 199, "user_id": 1276588, "user_type": "registered", "accept_rate": 0, "profile_image": "https://www.gravatar.com/avatar/306650b5c1a53bc6d2a87516ff6a480f?s=128&d=identicon&r=PG", "display_name": "Max Lipton", "link": "https://stackoverflow.com/users/1276588/max-lipton"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 685, "favorite_count": 0, "answer_count": 1, "score": 2, "last_activity_date": 1458715092, "creation_date": 1458602762, "last_edit_date": 1495542833, "question_id": 36143522, "link": "https://stackoverflow.com/questions/36143522/how-to-call-haskell-from-java", "title": "How to call Haskell from Java", "body": "<p>Before someone points out, I've looked at the answer here: <a href=\"https://stackoverflow.com/questions/2141148/best-way-to-call-haskell-functions-from-within-java\">Best way to call Haskell functions from within Java</a> and I'm totally lost reading those answers.</p>\n\n<p>I have a set of Haskell functions in a file called \"output.hs\". Normally to execute those functions, I would use an interpreter like Hugs and enter my commands from their prompt.</p>\n\n<p>What I want to do is emulate that process from a Java application. I have a Java swing textfield where the user would type in a command in Haskell, and what I want to do is have that command interpreted and have the output displayed in some nearby text area. Essentially, I'm making a front for a Haskell interpreter. </p>\n\n<p>Does anyone have direct experience with this?</p>\n"}, {"tags": ["haskell", "types", "functional-programming", "currying", "type-signature"], "comments": [{"owner": {"reputation": 100892, "user_id": 745903, "user_type": "registered", "accept_rate": 74, "profile_image": "https://www.gravatar.com/avatar/50933f6638836741e620669b3940410e?s=128&d=identicon&r=PG", "display_name": "leftaroundabout", "link": "https://stackoverflow.com/users/745903/leftaroundabout"}, "edited": false, "score": 3, "creation_date": 1458605530, "post_id": 36143423, "comment_id": 59925702, "body": "Please focus your question on one properly answerable aspect."}, {"owner": {"reputation": 10378, "user_id": 2476735, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/39e9447bbc32246fcd23b76b5e946618?s=128&d=identicon&r=PG&f=1", "display_name": "David Young", "link": "https://stackoverflow.com/users/2476735/david-young"}, "edited": false, "score": 0, "creation_date": 1458608482, "post_id": 36143423, "comment_id": 59926664, "body": "The operation involved in part 1 is creating a function type. The function type created &quot;first&quot; is <code>b -&gt; c</code>. This is then combined into the larger function type <code>a -&gt; (b -&gt; c)</code>. Note that all of this is at the level of types, not at the level of values. <code>-&gt;</code> is something that takes in two types and gives you back a type: the type of functions from the left type to the right type. To make things more a little more concrete, if you give <code>-&gt;</code> the types <code>Char</code> and <code>Int</code>, it gives you back the type of functions from <code>Char</code> to <code>Int</code>."}], "answers": [{"comments": [{"owner": {"reputation": 39, "user_id": 5681774, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/c48701fba9af808bdc4110229d498e2e?s=128&d=identicon&r=PG&f=1", "display_name": "Onowskistein", "link": "https://stackoverflow.com/users/5681774/onowskistein"}, "edited": false, "score": 0, "creation_date": 1458606742, "post_id": 36144053, "comment_id": 59926080, "body": "I do understand left-associativity of function evaluation, but don&#39;t right-associativity of &#39;-&gt;&#39; in the type expression."}, {"owner": {"reputation": 45920, "user_id": 4996248, "user_type": "registered", "accept_rate": 82, "profile_image": "https://i.stack.imgur.com/IUaWZ.jpg?s=128&g=1", "display_name": "John Coleman", "link": "https://stackoverflow.com/users/4996248/john-coleman"}, "reply_to_user": {"reputation": 39, "user_id": 5681774, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/c48701fba9af808bdc4110229d498e2e?s=128&d=identicon&r=PG&f=1", "display_name": "Onowskistein", "link": "https://stackoverflow.com/users/5681774/onowskistein"}, "edited": false, "score": 6, "creation_date": 1458608670, "post_id": 36144053, "comment_id": 59926717, "body": "Type expressions say what something <i>is</i> -- they don&#39;t specify order  of computation. <code>a -&gt; (b -&gt;c)</code> says that an element of type <code>a</code> maps to something which <code>is</code> a function which sends elements of type <code>b</code> to elements of type <code>c</code>. Think of it as logical grouping of constituent parts, not temporal grouping of computation."}], "tags": [], "owner": {"reputation": 45920, "user_id": 4996248, "user_type": "registered", "accept_rate": 82, "profile_image": "https://i.stack.imgur.com/IUaWZ.jpg?s=128&g=1", "display_name": "John Coleman", "link": "https://stackoverflow.com/users/4996248/john-coleman"}, "is_accepted": false, "score": 7, "last_activity_date": 1458605740, "creation_date": 1458605740, "answer_id": 36144053, "question_id": 36143423, "link": "https://stackoverflow.com/questions/36143423/right-associativity-in-type-signatures-of-functions/36144053#36144053", "title": "Right-associativity in type signatures of functions", "body": "<p>Using your notation, in</p>\n\n<pre><code>myAdd :: a -&gt; b -&gt; c\nmyAdd x y = x+y\n</code></pre>\n\n<p>you correctly interpret the type as <code>a -&gt; (b-&gt;c)</code> but then you go on to suggest that the computation in <code>b -&gt; c</code> is somehow done first.</p>\n\n<p>When something like <code>myAdd 2 10</code> is evaluated, the function evaluation is left to right.</p>\n\n<p>1) First <code>myAdd 2</code> is evaluated. The result of this evaluation is the function which sends a given number <code>y</code> to <code>2 + y</code>. In effect, the definition of <code>myAdd</code> is the same as</p>\n\n<pre><code>myAdd x = \\y -&gt; x+y\n</code></pre>\n\n<p>2) This last function is then applied to the argument <code>10</code> to yield <code>2 + 10 = 12</code></p>\n\n<p>Thus, the right associativity of <code>-&gt;</code> in the <em>type expression</em> doesn't correspond to a right to left ordering of computation in the <em>function evaluation</em>. In fact, function evaluation is left-associative: <code>myAdd 2 10</code> is the same as <code>(myAdd 2) 10</code>.</p>\n"}], "owner": {"reputation": 39, "user_id": 5681774, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/c48701fba9af808bdc4110229d498e2e?s=128&d=identicon&r=PG&f=1", "display_name": "Onowskistein", "link": "https://stackoverflow.com/users/5681774/onowskistein"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 692, "favorite_count": 1, "answer_count": 1, "score": 2, "last_activity_date": 1458650825, "creation_date": 1458602257, "last_edit_date": 1458628041, "question_id": 36143423, "link": "https://stackoverflow.com/questions/36143423/right-associativity-in-type-signatures-of-functions", "title": "Right-associativity in type signatures of functions", "body": "<p>I've troubles understanding the reasoning behind types signatures in Haskell. </p>\n\n<p>1) as <code>-&gt;</code> is said to be right associative, does it mean that it could be understood in the similar way as, for example 4^(2^(3^2))? </p>\n\n<p>2) using type signature of simple function so as to express my doubts (to explain the way I understand it, I'll use <code>a</code>,<code>b</code>,<code>c</code> instead of <code>Num a =&gt; a</code>'s or <code>Int</code>'s):</p>\n\n<pre><code>myAdd :: a -&gt; b -&gt; c\nmyAdd x y = x+y\n</code></pre>\n\n<p>It means that function takes parameter <code>a</code> and returns function that takes <code>b</code> and finally returns <code>c</code></p>\n\n<p>But it could be re-written as:</p>\n\n<pre><code>myAdd :: (a-&gt;(b-&gt;c))\n</code></pre>\n\n<p>As most of the learning material states that <code>c</code> in our example is the result of function myAdd, why according to the use of brackets it indicates that first 'operation' is <code>b-&gt;c</code>? How do I deduce from that type signature the order of performed operations?</p>\n\n<p>3) I was given a task to implement </p>\n\n<pre><code>map f xs \n</code></pre>\n\n<p>using  <code>foldr</code>, <code>(.)</code>, and <code>(:)</code> which resulted in:</p>\n\n<pre><code>map f xs = foldr ((:) . f) [] xs\n</code></pre>\n\n<p>I've no problems understanding the workings of the above functions, but here we come again - type signatures. If we assume, that names are unified so type <code>a</code> represents the same type in all contracts, it seems, that <code>c</code> and <code>d</code> can be expressed in terms of <code>a</code> and <code>b</code>. In mathematics, similar task would be probably quite straightforward, but how do I approach it in Haskell?</p>\n\n<pre><code>map :: (a -&gt; b) -&gt; [a] -&gt; [b]\nfoldr :: (a -&gt; c -&gt; c) -&gt; c -&gt; [a] -&gt; c\n(:) :: b -&gt; ([b] -&gt; [b])\n(.) :: (b -&gt; d) -&gt; (a -&gt; b) -&gt; a -&gt; d\n</code></pre>\n"}, {"tags": ["haskell", "monads"], "answers": [{"comments": [{"owner": {"reputation": 3393, "user_id": 1350862, "user_type": "registered", "accept_rate": 92, "profile_image": "https://www.gravatar.com/avatar/2ca95e245ab6f2df8ea64ab934108cc9?s=128&d=identicon&r=PG&f=1", "display_name": "cpa", "link": "https://stackoverflow.com/users/1350862/cpa"}, "edited": false, "score": 0, "creation_date": 1458603873, "post_id": 36143628, "comment_id": 59925200, "body": "Thanks, that&#39;s a nice solution :) Although I&#39;d like <code>unlock</code> to return <code>[action1, UnlockErrorNoLogin]</code> or <code>[action1, UnlockErrorNeedsSudo]</code>. Ie, given <code>data Actions = Action1 | ActionIfNoLogin | ActionIfNeedsSudo</code> I want to collect a list of actions that depends on the execution of the function. But <code>Action1</code> is not monadic."}, {"owner": {"reputation": 126897, "user_id": 791604, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/ce991df7a056248d5e4f6fc3659ba733?s=128&d=identicon&r=PG", "display_name": "Daniel Wagner", "link": "https://stackoverflow.com/users/791604/daniel-wagner"}, "reply_to_user": {"reputation": 3393, "user_id": 1350862, "user_type": "registered", "accept_rate": 92, "profile_image": "https://www.gravatar.com/avatar/2ca95e245ab6f2df8ea64ab934108cc9?s=128&d=identicon&r=PG&f=1", "display_name": "cpa", "link": "https://stackoverflow.com/users/1350862/cpa"}, "edited": false, "score": 0, "creation_date": 1458626624, "post_id": 36143628, "comment_id": 59931956, "body": "@cpa If the monadic action has indeed executed far enough to reach one of the errors above, it will indeed have executed the <code>action1</code> action."}, {"owner": {"reputation": 3393, "user_id": 1350862, "user_type": "registered", "accept_rate": 92, "profile_image": "https://www.gravatar.com/avatar/2ca95e245ab6f2df8ea64ab934108cc9?s=128&d=identicon&r=PG&f=1", "display_name": "cpa", "link": "https://stackoverflow.com/users/1350862/cpa"}, "edited": false, "score": 0, "creation_date": 1458631435, "post_id": 36143628, "comment_id": 59934281, "body": "My OP wasn&#39;t very clear (I updated it), but I don&#39;t want to execute the action, but return a list of actions to execute. After a good night sleep, I think I&#39;m just reinventing free monads, actually."}, {"owner": {"reputation": 126897, "user_id": 791604, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/ce991df7a056248d5e4f6fc3659ba733?s=128&d=identicon&r=PG", "display_name": "Daniel Wagner", "link": "https://stackoverflow.com/users/791604/daniel-wagner"}, "reply_to_user": {"reputation": 3393, "user_id": 1350862, "user_type": "registered", "accept_rate": 92, "profile_image": "https://www.gravatar.com/avatar/2ca95e245ab6f2df8ea64ab934108cc9?s=128&d=identicon&r=PG&f=1", "display_name": "cpa", "link": "https://stackoverflow.com/users/1350862/cpa"}, "edited": false, "score": 0, "creation_date": 1458694340, "post_id": 36143628, "comment_id": 59973099, "body": "@cpa What are you going to do with it if not execute?"}, {"owner": {"reputation": 3393, "user_id": 1350862, "user_type": "registered", "accept_rate": 92, "profile_image": "https://www.gravatar.com/avatar/2ca95e245ab6f2df8ea64ab934108cc9?s=128&d=identicon&r=PG&f=1", "display_name": "cpa", "link": "https://stackoverflow.com/users/1350862/cpa"}, "edited": false, "score": 0, "creation_date": 1458764872, "post_id": 36143628, "comment_id": 60011382, "body": "I want to batch all the actions then execute them in another function. Anyway, I think Free monads solve my problem."}, {"owner": {"reputation": 126897, "user_id": 791604, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/ce991df7a056248d5e4f6fc3659ba733?s=128&d=identicon&r=PG", "display_name": "Daniel Wagner", "link": "https://stackoverflow.com/users/791604/daniel-wagner"}, "reply_to_user": {"reputation": 3393, "user_id": 1350862, "user_type": "registered", "accept_rate": 92, "profile_image": "https://www.gravatar.com/avatar/2ca95e245ab6f2df8ea64ab934108cc9?s=128&d=identicon&r=PG&f=1", "display_name": "cpa", "link": "https://stackoverflow.com/users/1350862/cpa"}, "edited": false, "score": 0, "creation_date": 1458795691, "post_id": 36143628, "comment_id": 60021286, "body": "@cpa So... you <i>are</i> going to execute them. So why go all the way to free monads? Why not just execute them?"}, {"owner": {"reputation": 3393, "user_id": 1350862, "user_type": "registered", "accept_rate": 92, "profile_image": "https://www.gravatar.com/avatar/2ca95e245ab6f2df8ea64ab934108cc9?s=128&d=identicon&r=PG&f=1", "display_name": "cpa", "link": "https://stackoverflow.com/users/1350862/cpa"}, "edited": false, "score": 0, "creation_date": 1458857236, "post_id": 36143628, "comment_id": 60054804, "body": "Because I want to keep my business logic pure."}], "tags": [], "owner": {"reputation": 9772, "user_id": 3963, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/9pDQ8.png?s=128&g=1", "display_name": "hao", "link": "https://stackoverflow.com/users/3963/hao"}, "is_accepted": false, "score": 2, "last_activity_date": 1458603393, "creation_date": 1458603393, "answer_id": 36143628, "question_id": 36143273, "link": "https://stackoverflow.com/questions/36143273/collecting-actions-and-branching-out-early-if-necessary/36143628#36143628", "title": "Collecting actions and branching out early if necessary", "body": "<p>This sounds like an ideal use of <code>throwError</code>, from mtl's <a href=\"https://hackage.haskell.org/package/mtl/docs/Control-Monad-Except.html\" rel=\"nofollow\">Control.Monad.Except</a>, like so:</p>\n\n\n\n<pre><code>{-# LANGUAGE FlexibleContexts #-}\n{-# LANGUAGE RecordWildCards  #-}\n\nmodule Main where\n\nimport Control.Monad.Except\n\ndata UnlockError =\n    UnlockErrorNoLogin\n  | UnlockErrorNeedsSudo\n\ndata State = State {\n    stateUserIsAuthenticated :: Bool\n  , stateUserHasPermission :: Bool\n  }\n\nunlock :: MonadError UnlockError m =&gt; State -&gt; m String\nunlock State{..} = do\n  action1\n  unless stateUserIsAuthenticated\n         (throwError UnlockErrorNoLogin)\n  unless stateUserHasPermission\n         (throwError UnlockErrorNeedsSudo)\n  return \"all\"\n  where\n    action1 = return ()\n\nmain :: IO ()\nmain = do\n  state &lt;- conjureState\n  case unlock state of\n    Left UnlockErrorNoLogin -&gt;\n      p \"please log in\"\n    Left UnlockErrorNeedsSudo -&gt;\n      p \"please sudo\"\n    Right count -&gt;\n      p (\"i love you with \" ++ show count ++ \" of my heart\")\n  where\n    p =\n      putStrLn\n    conjureState =\n      return (State True True)\n</code></pre>\n"}], "owner": {"reputation": 3393, "user_id": 1350862, "user_type": "registered", "accept_rate": 92, "profile_image": "https://www.gravatar.com/avatar/2ca95e245ab6f2df8ea64ab934108cc9?s=128&d=identicon&r=PG&f=1", "display_name": "cpa", "link": "https://stackoverflow.com/users/1350862/cpa"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 75, "favorite_count": 1, "answer_count": 1, "score": 0, "last_activity_date": 1458604659, "creation_date": 1458601441, "last_edit_date": 1458604466, "question_id": 36143273, "link": "https://stackoverflow.com/questions/36143273/collecting-actions-and-branching-out-early-if-necessary", "title": "Collecting actions and branching out early if necessary", "body": "<p>I'm converting some Python code to Haskell. The business logic is fairly complex and my Haskell code is getting ugly.</p>\n\n<p>My Python function:</p>\n\n<pre><code>def f(some_state):\n    doAction1() # e.g. send_message(\"Hi there!\")\n    if not userIsAuthenticated:\n        doAction2() # e.g. send_message(\"Please login\")\n        return\n    if not userHasPermission:\n        doAction3() # e.g. send_message(\"Please sudo\")\n        return\n    if somePredicate3:\n        doAction4()\n        if somePredicate4:\n            doAction5()\n    return\n</code></pre>\n\n<p>I have two constraints for the Haskell version:</p>\n\n<ol>\n<li>In order to keep my code as pure possible, I'd like to collect all my actions in a list (or a Free Monad if I'm feeling fancy) and then (outside the function) execute it. In Python, I would defined <code>tmp = []</code> at the beginning of my function, append to <code>tmp</code> all my actions (without calling them) and return <code>tmp</code>. Then, I'd iterate over the list to execute all the actions (not Pythonic at all!).</li>\n<li><strong>Not</strong> end up with pushed-to-the-right craziness like this:</li>\n</ol>\n\n<p>-</p>\n\n<pre><code>if a\nthen undefined\nelse if b\n     then undefined\n     else if c\n          then undefined\n          else if d\n               then undefined\n               else undefined\n</code></pre>\n\n<p>Basically, I want to collect a list of actions and exit early if necessary, so that I can write something like:</p>\n\n<pre><code>tell Action1\nwhen somePredicate1 $ tell doAction2\nwhen somePredicate2 $ tell doAction3\n...\n</code></pre>\n\n<p><code>tell</code> is NOT from the writer monad but it's a function (which doesn't exist) that aggregates everything that has been \"told\" so far (\u00e0 la writer monad) and is returned when I exit.</p>\n\n<p>This really feels like a generalized Either monad, except that I need to keep all the actions that happened before the first Left (and not just the Left value) and then exit early at the first Left. I think the solution probably builds on MonadPlus or Alternative somehow, but I just can't figure out something nice. Basically, a fancy <code>guard</code>.</p>\n\n<p>It's also definitely possible that I'm having too much fun over-engineering this and I should just accept that my code has to drift right. But that wouldn't be elegant, would it?</p>\n\n<p>Edit: For clarity, I want a function of type <code>f :: State -&gt; [Action]</code>, where <code>data Action = Action1 | Action2 | Action3</code>.</p>\n"}, {"tags": ["haskell", "types", "functional-programming", "type-systems", "dependent-type"], "comments": [{"owner": {"reputation": 46235, "user_id": 2541573, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/Z1qtP.png?s=128&g=1", "display_name": "jub0bs", "link": "https://stackoverflow.com/users/2541573/jub0bs"}, "edited": false, "score": 2, "creation_date": 1458597789, "post_id": 36142428, "comment_id": 59923003, "body": "All other things being equal, stronger guarantees (e.g. no side effects) mean that a wider range of compile-time optimisations are possible."}, {"owner": {"reputation": 100185, "user_id": 3234959, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/93bb12ca0f93dfddb33880316f7e66c2?s=128&d=identicon&r=PG&f=1", "display_name": "chi", "link": "https://stackoverflow.com/users/3234959/chi"}, "edited": false, "score": 3, "creation_date": 1458598511, "post_id": 36142428, "comment_id": 59923327, "body": "&quot;until you realize that python has had dependent types from the beginning&quot; ... can you elaborate? I&#39;m not sure I&#39;ve ever seen a forall type in a dynamically typed language, let alone a dependent type."}, {"owner": {"reputation": 9455, "user_id": 1172541, "user_type": "registered", "accept_rate": 30, "profile_image": "https://i.stack.imgur.com/LROoN.png?s=128&g=1", "display_name": "PyRulez", "link": "https://stackoverflow.com/users/1172541/pyrulez"}, "reply_to_user": {"reputation": 100185, "user_id": 3234959, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/93bb12ca0f93dfddb33880316f7e66c2?s=128&d=identicon&r=PG&f=1", "display_name": "chi", "link": "https://stackoverflow.com/users/3234959/chi"}, "edited": false, "score": 0, "creation_date": 1458598580, "post_id": 36142428, "comment_id": 59923354, "body": "@chi It is trivial to make a function that takes a value and outputs a type in python. You can then make functions whose output type is based on that type producing function."}, {"owner": {"reputation": 100185, "user_id": 3234959, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/93bb12ca0f93dfddb33880316f7e66c2?s=128&d=identicon&r=PG&f=1", "display_name": "chi", "link": "https://stackoverflow.com/users/3234959/chi"}, "edited": false, "score": 0, "creation_date": 1458598653, "post_id": 36142428, "comment_id": 59923387, "body": "OK, but can you produce a value whose type is a <b>forall</b> type? Isn&#39;t every function typed as &quot;function&quot; only, in python (I&#39;m not an expert)?"}, {"owner": {"reputation": 9455, "user_id": 1172541, "user_type": "registered", "accept_rate": 30, "profile_image": "https://i.stack.imgur.com/LROoN.png?s=128&g=1", "display_name": "PyRulez", "link": "https://stackoverflow.com/users/1172541/pyrulez"}, "reply_to_user": {"reputation": 100185, "user_id": 3234959, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/93bb12ca0f93dfddb33880316f7e66c2?s=128&d=identicon&r=PG&f=1", "display_name": "chi", "link": "https://stackoverflow.com/users/3234959/chi"}, "edited": false, "score": 0, "creation_date": 1458598833, "post_id": 36142428, "comment_id": 59923454, "body": "@chi I think you can make <code>forall</code> a function from types to types, right?"}, {"owner": {"reputation": 9455, "user_id": 1172541, "user_type": "registered", "accept_rate": 30, "profile_image": "https://i.stack.imgur.com/LROoN.png?s=128&g=1", "display_name": "PyRulez", "link": "https://stackoverflow.com/users/1172541/pyrulez"}, "reply_to_user": {"reputation": 100185, "user_id": 3234959, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/93bb12ca0f93dfddb33880316f7e66c2?s=128&d=identicon&r=PG&f=1", "display_name": "chi", "link": "https://stackoverflow.com/users/3234959/chi"}, "edited": false, "score": 0, "creation_date": 1458598951, "post_id": 36142428, "comment_id": 59923507, "body": "@chi (I&#39;m using the definition of Dependent Typing from <a href=\"https://en.wikipedia.org/wiki/Dependent_type.\" rel=\"nofollow noreferrer\">en.wikipedia.org/wiki/Dependent_type.</a>)"}, {"owner": {"reputation": 126897, "user_id": 791604, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/ce991df7a056248d5e4f6fc3659ba733?s=128&d=identicon&r=PG", "display_name": "Daniel Wagner", "link": "https://stackoverflow.com/users/791604/daniel-wagner"}, "edited": false, "score": 10, "creation_date": 1458599461, "post_id": 36142428, "comment_id": 59923689, "body": "&quot;Python has had dependent types from the beginning&quot; -- eh, no. There is no tool that will look at a Python program and pronounce it ill-typed without running it."}, {"owner": {"reputation": 9455, "user_id": 1172541, "user_type": "registered", "accept_rate": 30, "profile_image": "https://i.stack.imgur.com/LROoN.png?s=128&g=1", "display_name": "PyRulez", "link": "https://stackoverflow.com/users/1172541/pyrulez"}, "reply_to_user": {"reputation": 126897, "user_id": 791604, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/ce991df7a056248d5e4f6fc3659ba733?s=128&d=identicon&r=PG", "display_name": "Daniel Wagner", "link": "https://stackoverflow.com/users/791604/daniel-wagner"}, "edited": false, "score": 0, "creation_date": 1458599503, "post_id": 36142428, "comment_id": 59923711, "body": "@DanielWagner Its dynamic dependent typing."}, {"owner": {"reputation": 133611, "user_id": 152602, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/7f370b4bd787fc68f9f62d9c6781cb79?s=128&d=identicon&r=PG", "display_name": "Lee", "link": "https://stackoverflow.com/users/152602/lee"}, "edited": false, "score": 2, "creation_date": 1458599605, "post_id": 36142428, "comment_id": 59923755, "body": "Types are a static construct, so &#39;dynamic dependent typing&#39; sounds like an oxymoron."}, {"owner": {"reputation": 384463, "user_id": 1126841, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/fa05233b2357f8d11c22ef4cfc7bb85c?s=128&d=identicon&r=PG", "display_name": "chepner", "link": "https://stackoverflow.com/users/1126841/chepner"}, "edited": false, "score": 6, "creation_date": 1458600261, "post_id": 36142428, "comment_id": 59924012, "body": "@PyRulez You are confusing the <a href=\"https://en.wikipedia.org/wiki/Codomain\" rel=\"nofollow noreferrer\">codomain</a> of a function with its <a href=\"https://en.wikipedia.org/wiki/Image_(mathematics)\" rel=\"nofollow noreferrer\">image</a>. Just because you can define a Python function that only returns, say, strings of length 5, the type of those values remains <code>str</code>, indistinguishable at the type level from strings with other lengths."}, {"owner": {"reputation": 9455, "user_id": 1172541, "user_type": "registered", "accept_rate": 30, "profile_image": "https://i.stack.imgur.com/LROoN.png?s=128&g=1", "display_name": "PyRulez", "link": "https://stackoverflow.com/users/1172541/pyrulez"}, "reply_to_user": {"reputation": 384463, "user_id": 1126841, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/fa05233b2357f8d11c22ef4cfc7bb85c?s=128&d=identicon&r=PG", "display_name": "chepner", "link": "https://stackoverflow.com/users/1126841/chepner"}, "edited": false, "score": 0, "creation_date": 1458600368, "post_id": 36142428, "comment_id": 59924042, "body": "@chepner You could create in python a type for strings of only length $5$ though. You can even make it impossible to violate without throwing an error using properties."}, {"owner": {"reputation": 4959, "user_id": 503377, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/83ad33b911f7d1bdb203427f474924b1?s=128&d=identicon&r=PG", "display_name": "Elliot Cameron", "link": "https://stackoverflow.com/users/503377/elliot-cameron"}, "edited": false, "score": 12, "creation_date": 1458602335, "post_id": 36142428, "comment_id": 59924707, "body": "@PyRulez Python achieves a high-level of metaprogramming <i>not</i> by promoting value-level things to the type level, but my demoting type-level things to the value level. The fact that <code>str</code> can be returned from a function, for example, shows that <code>str</code> is a type being treated like a value, not the other way around. The difference is that value-level things are not statically knowable."}, {"owner": {"reputation": 10378, "user_id": 2476735, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/39e9447bbc32246fcd23b76b5e946618?s=128&d=identicon&r=PG&f=1", "display_name": "David Young", "link": "https://stackoverflow.com/users/2476735/david-young"}, "edited": false, "score": 3, "creation_date": 1458610154, "post_id": 36142428, "comment_id": 59927151, "body": "@PyRulez It seems to me like the phrase &quot;dependently typed&quot; loses its meaning if you try to characterize it like that. All programming languages that have some amount of data hiding ability and can throw errors (at least the weakly or dynamically typed ones) would then be &quot;dependently typed.&quot;"}, {"owner": {"reputation": 43759, "user_id": 1651941, "user_type": "registered", "accept_rate": 97, "profile_image": "https://www.gravatar.com/avatar/a513bc1fa519d2fcf5e4e0d9b5500101?s=128&d=identicon&r=PG", "display_name": "Sibi", "link": "https://stackoverflow.com/users/1651941/sibi"}, "reply_to_user": {"reputation": 100185, "user_id": 3234959, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/93bb12ca0f93dfddb33880316f7e66c2?s=128&d=identicon&r=PG&f=1", "display_name": "chi", "link": "https://stackoverflow.com/users/3234959/chi"}, "edited": false, "score": 0, "creation_date": 1458643348, "post_id": 36142428, "comment_id": 59941432, "body": "@chi I wish you haven&#39;t deleted your answer, it was interesting!"}, {"owner": {"reputation": 100185, "user_id": 3234959, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/93bb12ca0f93dfddb33880316f7e66c2?s=128&d=identicon&r=PG&f=1", "display_name": "chi", "link": "https://stackoverflow.com/users/3234959/chi"}, "reply_to_user": {"reputation": 43759, "user_id": 1651941, "user_type": "registered", "accept_rate": 97, "profile_image": "https://www.gravatar.com/avatar/a513bc1fa519d2fcf5e4e0d9b5500101?s=128&d=identicon&r=PG", "display_name": "Sibi", "link": "https://stackoverflow.com/users/1651941/sibi"}, "edited": false, "score": 0, "creation_date": 1458643738, "post_id": 36142428, "comment_id": 59941715, "body": "@Sibi It might have been, but it really didn&#39;t answer <i>this</i> question, but another one which arose from the comments. With enough rep, it&#39;s still readable anyway."}], "answers": [{"comments": [{"owner": {"reputation": 103, "user_id": 4602927, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/9zfg5.jpg?s=128&g=1", "display_name": "m0rphism", "link": "https://stackoverflow.com/users/4602927/m0rphism"}, "edited": false, "score": 1, "creation_date": 1458600816, "post_id": 36143094, "comment_id": 59924189, "body": "True, but I would count that also as a &quot;safety benefit&quot;."}], "tags": [], "owner": {"reputation": 8440, "user_id": 958083, "user_type": "registered", "accept_rate": 86, "profile_image": "https://www.gravatar.com/avatar/b71f337a50d5197ecd23bd7a709b0cbf?s=128&d=identicon&r=PG", "display_name": "Nacht", "link": "https://stackoverflow.com/users/958083/nacht"}, "is_accepted": false, "score": 3, "last_activity_date": 1458600632, "creation_date": 1458600632, "answer_id": 36143094, "question_id": 36142428, "link": "https://stackoverflow.com/questions/36142428/are-there-benefits-of-strong-typing-besides-safety/36143094#36143094", "title": "Are there benefits of strong typing besides safety?", "body": "<p>Refactoring. By having a strong type system you can safely refactor code and have the compiler tell you whether what you are doing now even makes sense. The stronger the typing system, the more refactor errors are avoided. This of course means your code is a lot more maintainable. </p>\n"}, {"comments": [{"owner": {"reputation": 4959, "user_id": 503377, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/83ad33b911f7d1bdb203427f474924b1?s=128&d=identicon&r=PG", "display_name": "Elliot Cameron", "link": "https://stackoverflow.com/users/503377/elliot-cameron"}, "edited": false, "score": 2, "creation_date": 1458601625, "post_id": 36143176, "comment_id": 59924489, "body": "Another great example would be &quot;do&quot; notation, which relies on the same feature and allows for a level of abstraction that is nigh impossible in Python, et al."}, {"owner": {"reputation": 44013, "user_id": 1477667, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/trgKM.jpg?s=128&g=1", "display_name": "dfeuer", "link": "https://stackoverflow.com/users/1477667/dfeuer"}, "edited": false, "score": 1, "creation_date": 1458614985, "post_id": 36143176, "comment_id": 59928478, "body": "Dependently typed languages can do even better in some cases, actually <i>inferring values</i>. In appropriate cases, you can just tell it what type you want and it&#39;ll find the unique value of that type. Short of that, interactive theorem proving (like Haskell&#39;s typed holes) can assist in program construction."}, {"owner": {"reputation": 64805, "user_id": 286871, "user_type": "registered", "accept_rate": 77, "profile_image": "https://i.stack.imgur.com/xNBpr.png?s=128&g=1", "display_name": "Tikhon Jelvis", "link": "https://stackoverflow.com/users/286871/tikhon-jelvis"}, "edited": false, "score": 1, "creation_date": 1458674019, "post_id": 36143176, "comment_id": 59963557, "body": "It&#39;s worth noting that, with type inference, <i>you don&#39;t have to explicitly write the type out</i>. Your actual example isn&#39;t much better than <code>Integer.read &quot;15&quot;</code> and <code>Bool.read &quot;15&quot;</code> which you could do in most languages; the really neat thing is that you could write something like <code>if read &quot;True&quot; then &quot;yes&quot; else &quot;no&quot;</code> and the type system transparently figures out that <code>read &quot;True&quot;</code> needs to produce a boolean based on how it&#39;s used."}, {"owner": {"reputation": 589, "user_id": 1486400, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/6b6c720fd6b86fdf2293eefb5188d46b?s=128&d=identicon&r=PG", "display_name": "int_index", "link": "https://stackoverflow.com/users/1486400/int-index"}, "reply_to_user": {"reputation": 64805, "user_id": 286871, "user_type": "registered", "accept_rate": 77, "profile_image": "https://i.stack.imgur.com/xNBpr.png?s=128&g=1", "display_name": "Tikhon Jelvis", "link": "https://stackoverflow.com/users/286871/tikhon-jelvis"}, "edited": false, "score": 0, "creation_date": 1458676719, "post_id": 36143176, "comment_id": 59965200, "body": "@TikhonJelvis I agree. However, the purpose of the example was to illustrate that type-level information can influence terms. In your example the information round-trips: from terms to types (via type inference) and from types to terms (via type classes), so it&#39;s not as obvious."}, {"owner": {"reputation": 64805, "user_id": 286871, "user_type": "registered", "accept_rate": 77, "profile_image": "https://i.stack.imgur.com/xNBpr.png?s=128&g=1", "display_name": "Tikhon Jelvis", "link": "https://stackoverflow.com/users/286871/tikhon-jelvis"}, "edited": false, "score": 1, "creation_date": 1458942436, "post_id": 36143176, "comment_id": 60088337, "body": "@int_index: Oh yeah, I don&#39;t think you should have <i>replaced</i> your example, just mentioned type inference (maybe with an additional example). In my view, that&#39;s what really shows off how the type system makes programming different beyond safety."}, {"owner": {"reputation": 375, "user_id": 3854340, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/5ec386363a0eadb401f5d281af2ed3fc?s=128&d=identicon&r=PG&f=1", "display_name": "aoeu256", "link": "https://stackoverflow.com/users/3854340/aoeu256"}, "edited": false, "score": 0, "creation_date": 1565294261, "post_id": 36143176, "comment_id": 101319038, "body": "Err...  Lisp&#39;s metaprogramming is far far more powerful than Haskell&#39;s, but may be more dangerous, and Lisp&#39;s type inference algorithms are kinda lax compared to Haskell&#39;s out of the box.  Python/Lisp can use the runtime type information for to allow context-sensitive &quot;Monads&quot; if they wanted to, but they want to keep Python &quot;easy for noobs to learn&quot; language."}], "tags": [], "owner": {"reputation": 589, "user_id": 1486400, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/6b6c720fd6b86fdf2293eefb5188d46b?s=128&d=identicon&r=PG", "display_name": "int_index", "link": "https://stackoverflow.com/users/1486400/int-index"}, "is_accepted": false, "score": 21, "last_activity_date": 1458600992, "creation_date": 1458600992, "answer_id": 36143176, "question_id": 36142428, "link": "https://stackoverflow.com/questions/36142428/are-there-benefits-of-strong-typing-besides-safety/36143176#36143176", "title": "Are there benefits of strong typing besides safety?", "body": "<blockquote>\n  <p>That's because typing only eliminates programs, not enable new ones.</p>\n</blockquote>\n\n<p>This is not a correct statement. Type-classes make it possible to generate parts of your program from type-level information.</p>\n\n<p>Consider two expressions:</p>\n\n<ol>\n<li><code>readMaybe \"15\" :: Maybe Integer</code></li>\n<li><code>readMaybe \"15\" :: Maybe Bool</code></li>\n</ol>\n\n<p>Here I'm using the <code>readMaybe</code> function from the <code>Text.Read</code> module. At term level those expressions are identical, only their type annotations are different. However, the results they produce at runtime differ (<code>Just 15</code> in the first case, <code>Nothing</code> in the second case).</p>\n\n<p>This is because the compiler generates code for you from the static type information you have. To be more precise, it selects a suitable type class instance and passes its dictionary to the polymorphic function (<code>readMaybe</code> in our case).</p>\n\n<p>This example is simple, but there are way more complex use cases. Using the <code>mtl</code> library you can write computations that run in different computational contexts (aka <code>Monad</code>s). The compiler will automatically insert a lot of code that manages the computational contexts. In a dynamically typed language, you would have no static information to make this possible.</p>\n\n<p>As you can see, static typing not only cuts off incorrect programs but also writes correct ones for you.</p>\n"}, {"tags": [], "owner": {"reputation": 28832, "user_id": 34707, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/9c51a8b8afa2366a2ef4650c411f187a?s=128&d=identicon&r=PG", "display_name": "Edward KMETT", "link": "https://stackoverflow.com/users/34707/edward-kmett"}, "is_accepted": false, "score": 27, "last_activity_date": 1458615520, "creation_date": 1458615520, "answer_id": 36145400, "question_id": 36142428, "link": "https://stackoverflow.com/questions/36142428/are-there-benefits-of-strong-typing-besides-safety/36145400#36145400", "title": "Are there benefits of strong typing besides safety?", "body": "<p>First, we need to talk a bit about the history of the simply typed lambda calculus.</p>\n\n<p>There are two historical developments of the simply typed lambda calculus. </p>\n\n<ul>\n<li><p>When Alonzo Church described the lambda calculus the types were baked in as part of the meaning / operational behavior of the terms.</p></li>\n<li><p>When Haskell Curry described the lambda calculus the types were annotations put on the terms.</p></li>\n</ul>\n\n<p>So we have the lambda calculus a la Church and the lambda calculus a la Curry. See <a href=\"https://en.wikipedia.org/wiki/Simply_typed_lambda_calculus#Intrinsic_vs._extrinsic_interpretations\">https://en.wikipedia.org/wiki/Simply_typed_lambda_calculus#Intrinsic_vs._extrinsic_interpretations</a> for more.</p>\n\n<p>Ironically, the language Haskell, which is named after Curry is based on a lambda calculus a la Church!</p>\n\n<p>What this means is the types aren't simply annotations that rule out bad programs for you. They can \"do stuff\" too. Such types don't erase without leaving residue.</p>\n\n<p>This shows up in Haskell's notion of type classes, which are really why Haskell is a language a la Church.</p>\n\n<p>In Haskell, when I make a function</p>\n\n<pre><code>sort :: Ord a =&gt; [a] -&gt; [a]\n</code></pre>\n\n<p>We're passing an object or dictionary for <code>Ord a</code> as the first argument.</p>\n\n<p>But you aren't forced to plumb that argument around yourself in the code, it is the job of the compiler to build that up and use it.</p>\n\n<pre><code>instance Ord Char\ninstance Ord Int\ninstance Ord a =&gt; Ord [a]\n</code></pre>\n\n<p>So if you go and use sort on a list of strings, which are themselves lists of chars, then this will build up the dictionary by passing the Ord Char instance through the instance for Ord a => Ord [a] to get Ord [Char], which is the same as Ord String, then you can sort a list of strings.</p>\n\n<p>Calling <code>sort</code> above, is a lot less verbose than manually building a <code>LexicographicComparator&lt;List&lt;Char&gt;&gt;</code> by passing it an <code>IComparator&lt;Char&gt;</code> to its constructor and calling the function with an extra second argument, if I were to compare the complexity of calling such a <code>sort</code> function in Haskell to calling it in C# or Java.</p>\n\n<p>This shows us that programming with types can be significantly less verbose, because mechanisms like implicits and typeclasses can infer a large part of the <em>code</em> for your program during type checking.</p>\n\n<p>On a simpler basis, even the sizes of arguments can depend on types, unless you want to pay fairly massive costs for boxing everything in your language up so that it has a homogeneous representation.</p>\n\n<p>This shows us that programming with types can be significantly more efficient, because it can use dedicated representations, rather than paying for boxed structures everywhere in your code. An <code>int</code> can't just be a machine integer, because it has to somehow look like everything else in the system. If you're willing to give up an order of magnitude or more worth of performance at runtime, then this may not matter to you.</p>\n\n<p>Finally, once we have types \"doing stuff\" for us, it is often beneficial to consider the refactoring benefits that mere safety provides. </p>\n\n<p>If I refactor the smaller set of code that remains, it'll rewrite all that type-class plumbing for me. It'll figure out the new ways it can rewrite the code to unbox more arguments. I'm not stuck elaborating all of this stuff by hand, I can leave these mundane tasks to the type-checker.</p>\n\n<p>But even when I do change the types, I can move arguments around fairly willy-nilly, comfortable that the compiler will very likely catch my errors. Types give you \"free theorems\" which are like unit tests for whole classes of such errors. </p>\n\n<p>On the other hand, once I lock down an API in a language like Python I'm deathly afraid of changing it, because it'll silently break at runtime for all my downstream dependencies! This leads to baroque APIs that lean heavily on easily bit-rotted keyword-arguments, and the API of something that evolves over time rarely resembles what you'd build out of the box if you had it to do over again. Consequently, even the mere safety concern has long-term impact in API design once you ever want people to build on top of your work, rather than simply replace it when it gets too unwieldy.</p>\n"}, {"tags": [], "owner": {"reputation": 11986, "user_id": 3237465, "user_type": "registered", "accept_rate": 76, "profile_image": "https://i.stack.imgur.com/vOArX.png?s=128&g=1", "display_name": "user3237465", "link": "https://stackoverflow.com/users/3237465/user3237465"}, "is_accepted": false, "score": 3, "last_activity_date": 1458631644, "last_edit_date": 1458631644, "creation_date": 1458628007, "answer_id": 36147541, "question_id": 36142428, "link": "https://stackoverflow.com/questions/36142428/are-there-benefits-of-strong-typing-besides-safety/36147541#36147541", "title": "Are there benefits of strong typing besides safety?", "body": "<p>You need \"safety\" when you already know what and how you want to write. It's a very small part of what types are useful for. The most important thing about types is that they make your reasoning structured. When someone writes in Python <code>a + b</code> he doesn't see <code>a</code> and <code>b</code> as some abstract variables \u2014 he sees them as some numbers. Types are already there in the internal language of humans, Python just doesn't have a type system to talk about them. The actual question in the \"typed vs untyped (unityped) programming\" dispute is \"do we want to reflect our internal structured concepts in a safe and explicit or unsafe and implicit way?\". Types don't introduce new concepts \u2014 it's untyped reasoning forgets the existing ones.</p>\n\n<p>When someone looks at a tree (I mean a real green one) he doesn't see every single leaf on it, but he doesn't treat it as an abstract nameless object as well. \"A tree\" \u2014 is an approximation that is good enough for most cases and that's why we have Hindley-Milner type systems, but sometimes you want to talk about a specific tree and you do want to look at leaves. And that's what dependent types give you: the ability to zoom. \"A tree without leaves\", \"a tree in the forest\", \"a tree of a particular form\"... Dependently typed programming is just another step towards how humans think.</p>\n\n<p>On a less abstract note, I have a type checker for a toy dependently typed language, where all typing rules are expressed as constructors of a <a href=\"https://github.com/effectfully/Cubes/blob/master/Typecheck.agda#L12\" rel=\"nofollow\">data type</a>. You don't need to dive into the type checking procedure to understand the rules of the system. That's the power of \"zooming\": you can introduce as complex invariants as you want, thus distinguishing essential parts from not important ones.</p>\n\n<p>Another example of the power dependent types give you is various forms of reflection. Look e.g. at the Pierre-\u00c9variste Dagand <a href=\"https://pages.lip6.fr/Pierre-Evariste.Dagand/stuffs/thesis-2011-phd/thesis.pdf\" rel=\"nofollow\">thesis</a>, which proves that</p>\n\n<blockquote>\n  <p>generic programming is just programming</p>\n</blockquote>\n\n<p>And of course types are hints, many functions and abstractions I defined I would define in a far more clumsy way in a weakly typed language, but types suggested better alternatives.</p>\n\n<p>There is just no question \"What to choose: simple types or dependent types?\". Dependent types are always better and they of course subsume simple types. The question is \"What to choose: no types or dependent types?\", but that question doesn't stand for me.</p>\n"}], "owner": {"reputation": 9455, "user_id": 1172541, "user_type": "registered", "accept_rate": 30, "profile_image": "https://i.stack.imgur.com/LROoN.png?s=128&g=1", "display_name": "PyRulez", "link": "https://stackoverflow.com/users/1172541/pyrulez"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 1576, "favorite_count": 4, "answer_count": 4, "score": 7, "last_activity_date": 1458643841, "creation_date": 1458597599, "last_edit_date": 1458600772, "question_id": 36142428, "link": "https://stackoverflow.com/questions/36142428/are-there-benefits-of-strong-typing-besides-safety", "title": "Are there benefits of strong typing besides safety?", "body": "<p>In the Haskell community, we are slowly adding features of dependent types. Dependent types is an advanced typing feature by which types can depend on values. Some languages like Agda and Idris already have them. It appears to be a very advanced feature requiring an advanced type system, until you realize that python <s>has had dependent types</s> has had the dynamic typing version of dependent types, which may or may not be actual dependent types, from the beginning.</p>\n\n<p>For most any program in a functional programming language, there is a way to reperesent it as an untyped lambda calculus term, no matter how advanced the typing. That's because typing only eliminates programs, not enable new ones.</p>\n\n<p>Strong Typing wins us safety. How classes of errors that happened at run time can no longer happen at run time. This safety is rather nice. Besides this safety though, what does strong typing give you?</p>\n\n<p>Are there an additional benefits of a strong type system besides safety?</p>\n\n<p>(Note that I'm not saying that strong typing is worthless. Safety is a <em>huge</em> benefit in and of itself. I'm just wondering if there are additional benefits.)</p>\n"}, {"tags": ["haskell", "trifecta"], "comments": [{"owner": {"reputation": 48129, "user_id": 76051, "user_type": "registered", "accept_rate": 91, "profile_image": "https://i.stack.imgur.com/AGDxz.jpg?s=128&g=1", "display_name": "Carsten", "link": "https://stackoverflow.com/users/76051/carsten"}, "edited": false, "score": 1, "creation_date": 1458597072, "post_id": 36142078, "comment_id": 59922675, "body": "why don&#39;t you use <a href=\"https://hackage.haskell.org/package/parsec-3.1.9/docs/Text-Parsec-Char.html#satisfy\" rel=\"nofollow noreferrer\"><code>satisfy</code></a> instead? - your parser does exactly what you told it - there is a difference between a <code>unexpected</code> failure and not consuming/parsing a character (as you demonstrated ;) )"}, {"owner": {"reputation": 480, "user_id": 2681876, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/fe6ef986f3390388cf5c6b527b31cd5d?s=128&d=identicon&r=PG&f=1", "display_name": "BillyBadBoy", "link": "https://stackoverflow.com/users/2681876/billybadboy"}, "reply_to_user": {"reputation": 48129, "user_id": 76051, "user_type": "registered", "accept_rate": 91, "profile_image": "https://i.stack.imgur.com/AGDxz.jpg?s=128&g=1", "display_name": "Carsten", "link": "https://stackoverflow.com/users/76051/carsten"}, "edited": false, "score": 0, "creation_date": 1458600215, "post_id": 36142078, "comment_id": 59923992, "body": "<code>satisfy</code> would only work with chars. I wanted to write a function that would let me add a filter to <i>any</i> parser."}], "answers": [{"tags": [], "owner": {"reputation": 25144, "user_id": 477476, "user_type": "registered", "accept_rate": 85, "profile_image": "https://i.stack.imgur.com/Qf4TT.png?s=128&g=1", "display_name": "Cactus", "link": "https://stackoverflow.com/users/477476/cactus"}, "is_accepted": true, "score": 1, "last_activity_date": 1458643838, "last_edit_date": 1458643838, "creation_date": 1458626974, "answer_id": 36147308, "question_id": 36142078, "link": "https://stackoverflow.com/questions/36142078/how-to-signal-failure-in-trifecta-parser/36147308#36147308", "title": "How to signal failure in trifecta parser", "body": "<p>You need to make <code>filterParser</code> recoverable by using <a href=\"https://hackage.haskell.org/package/parsers-0.12.3/docs/Text-Parser-Combinators.html#v:try\" rel=\"nofollow\"><code>try</code></a>:</p>\n\n<pre><code>import Text.Trifecta\nimport Control.Applicative\n\nfilterParser :: (a -&gt; Bool) -&gt; Parser a -&gt; Parser a\nfilterParser cond p = try $ do\n  x &lt;- p\n  if cond x then return x else empty\n</code></pre>\n\n<p>However, this would get rid of the custom parse error. Restoring that by using <code>unexpected \"Condition failed\"</code> in the <code>else</code> branch doesn't help either, because of the <code>try</code>.</p>\n\n<p>Instead, we can reinstate the custom error message after the <code>try</code>:</p>\n\n<pre><code>filterParser :: (a -&gt; Bool) -&gt; Parser a -&gt; Parser a\nfilterParser cond p = (&lt;|&gt; unexpected \"Condition failed\") $ try $ do\n  x &lt;- p\n  if cond x then return x else empty\n</code></pre>\n\n<p>This works as expected:</p>\n\n<pre><code>*Main&gt; parseString (many $ filterParser (&gt; 'm') letter) mempty \"zzza\"\nSuccess \"zzz\"\n</code></pre>\n\n<p>and</p>\n\n<pre><code>*Main&gt; parseString (filterParser (&gt; 'm') letter) mempty \"a\"\nFailure (interactive):1:1: error: unexpected\n    Condition failed\na&lt;EOF&gt; \n</code></pre>\n"}, {"tags": [], "owner": {"reputation": 480, "user_id": 2681876, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/fe6ef986f3390388cf5c6b527b31cd5d?s=128&d=identicon&r=PG&f=1", "display_name": "BillyBadBoy", "link": "https://stackoverflow.com/users/2681876/billybadboy"}, "is_accepted": false, "score": 1, "last_activity_date": 1458657660, "creation_date": 1458657660, "answer_id": 36157443, "question_id": 36142078, "link": "https://stackoverflow.com/questions/36142078/how-to-signal-failure-in-trifecta-parser/36157443#36157443", "title": "How to signal failure in trifecta parser", "body": "<p>In addition to the solution suggested by Cactus, there is the following:</p>\n\n<hr>\n\n<pre><code>filterParser :: (a -&gt; Bool) -&gt; Parser a -&gt; Parser a\nfilterParser cond p = do\n  a &lt;- lookAhead p\n  if cond a then p else unexpected \"condition failed!\"\n</code></pre>\n\n<hr>\n\n<p>This seems to give me what I want: </p>\n\n<pre><code>&gt; parseString (filterParser (&gt; 'm') letter) mempty \"z\"\n&gt; Success 'z'\n\n&gt; parseString (filterParser (&gt; 'm') letter) mempty \"4\"\n&gt; Failure (interactive):1:1: error: expected: letter\n\n&gt; parseString (filterParser (&gt; 'm') letter) mempty \"a\"\n&gt; Failure (interactive):1:1: error: unexpected\n&gt;     condition failed!\n\n&gt; parseString (many $ filterParser (&gt; 'm') letter) mempty \"zzz4\"\n&gt; Success \"zzz\"\n\n&gt; parseString (many $ filterParser (&gt; 'm') letter) mempty \"zzza\"\n&gt; Success \"zzz\"\n</code></pre>\n"}], "owner": {"reputation": 480, "user_id": 2681876, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/fe6ef986f3390388cf5c6b527b31cd5d?s=128&d=identicon&r=PG&f=1", "display_name": "BillyBadBoy", "link": "https://stackoverflow.com/users/2681876/billybadboy"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 298, "favorite_count": 0, "accepted_answer_id": 36147308, "answer_count": 2, "score": 2, "last_activity_date": 1458681183, "creation_date": 1458596130, "last_edit_date": 1458681183, "question_id": 36142078, "link": "https://stackoverflow.com/questions/36142078/how-to-signal-failure-in-trifecta-parser", "title": "How to signal failure in trifecta parser", "body": "<p>As an experiment with trifecta I've written the following simple function:</p>\n\n<pre><code>filterParser :: (a -&gt; Bool) -&gt; Parser a -&gt; Parser a\nfilterParser cond p = do\n  a &lt;- p\n  if cond a \n    then return a \n    else unexpected \"condition failed!\"\n</code></pre>\n\n<p>The idea was to be able to add a condition to a parser. For example (assuming predicate <code>prime</code> already exists), you would write:\n<code>filterParser prime integer</code> to create a parser that only accepts prime numbers.</p>\n\n<hr>\n\n<p>With single parses it seems OK:</p>\n\n<pre><code>&gt; parseString (filterParser (&gt; 'm') letter) mempty \"z\"\n&gt; Success 'z\n\n&gt; parseString (filterParser (&gt; 'm') letter) mempty \"a\"\n&gt; Failure (interactive):1:2: error: unexpected\n&gt; condition failed!\n</code></pre>\n\n<hr>\n\n<p>But with 'many' it doesn't work - compare:</p>\n\n<pre><code>&gt; parseString (many $ filterParser (&gt; 'm') letter) mempty \"zzz2\"\n&gt; Success \"zzz\"\n\n&gt; parseString (many $ filterParser (&gt; 'm') letter) mempty \"zzza\"\n&gt; Failure (interactive):1:5: error: unexpected\n&gt; condition failed!\n</code></pre>\n\n<p>I was hoping the last example would also return <code>Success \"zzz\"</code>. The call to <code>unexpected</code> seems to de-rail the entire parse, which isn't what I wanted.</p>\n"}, {"tags": ["haskell"], "comments": [{"owner": {"reputation": 62252, "user_id": 1435869, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/TrEd9.jpg?s=128&g=1", "display_name": "karakfa", "link": "https://stackoverflow.com/users/1435869/karakfa"}, "edited": false, "score": 2, "creation_date": 1458589141, "post_id": 36140027, "comment_id": 59918561, "body": "perhaps add <code>Show a</code> as a qualifier?"}, {"owner": {"reputation": 62252, "user_id": 1435869, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/TrEd9.jpg?s=128&g=1", "display_name": "karakfa", "link": "https://stackoverflow.com/users/1435869/karakfa"}, "edited": false, "score": 0, "creation_date": 1458589621, "post_id": 36140027, "comment_id": 59918813, "body": "since <code>show a</code> will work, wrap it with what you want for <code>Test</code>."}], "answers": [{"comments": [{"owner": {"user_type": "does_not_exist", "display_name": "user6023611"}, "edited": false, "score": 0, "creation_date": 1458592307, "post_id": 36140792, "comment_id": 59920261, "body": "Is it possinble to create instance of class such that this instance has deriving show ?"}, {"owner": {"reputation": 49501, "user_id": 784338, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/ae195ac7c8a5e9002a808544572cc5fc?s=128&d=identicon&r=PG", "display_name": "Daniel Gratzer", "link": "https://stackoverflow.com/users/784338/daniel-gratzer"}, "edited": false, "score": 0, "creation_date": 1458592393, "post_id": 36140792, "comment_id": 59920302, "body": "@HaskellFun An instance cannot have a deriving clause itself, the type you are making an instance for may or may not have a deriving clause for Show but it isn&#39;t possible to require this beyond simply requiring that the type implement <code>Show</code> somehow."}], "tags": [], "owner": {"reputation": 49501, "user_id": 784338, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/ae195ac7c8a5e9002a808544572cc5fc?s=128&d=identicon&r=PG", "display_name": "Daniel Gratzer", "link": "https://stackoverflow.com/users/784338/daniel-gratzer"}, "is_accepted": true, "score": 1, "last_activity_date": 1458591597, "creation_date": 1458591597, "answer_id": 36140792, "question_id": 36140027, "link": "https://stackoverflow.com/questions/36140027/haskell-deriving-show-in-class-and-in-all-instances/36140792#36140792", "title": "haskell, deriving Show in class and in all instances", "body": "<p>You can require that to be part of the <code>Test</code> type class you need to also belong to <code>Show</code> with</p>\n\n<pre><code>  class (Ord a, Show a) =&gt; Test a where\n</code></pre>\n\n<p>and then you can write a function like</p>\n\n<pre><code>printTest :: Test a =&gt; a -&gt; IO ()\nprintTest a = putStrLn (show a) -- equivalent to print a\n</code></pre>\n\n<p>because GHC will infer that if <code>Test a</code> holds then <code>Show a</code> must as well.</p>\n\n<p>But it almost seems like this isn't what you're asking for, if you want to specify <em>a new <code>Show</code> instance</em> for every type which belongs to <code>Test</code> then sadly you're out of luck. You could imagine writing something like</p>\n\n<pre><code> instance Test a =&gt; Show a where\n   ...\n</code></pre>\n\n<p>but this isn't going to work properly, in particular it will \"overlap\" with all other instances in a most unpleasant way and trying to fix this is just going to leave you with 2 dozens tabs into the GHC extensions manual and an elevated blood pressure. Some libraries provide a function</p>\n\n<pre><code> defaultShow :: Test a =&gt; a -&gt; String\n</code></pre>\n\n<p>if they define a type class where you would like to do this which simplifies the processes of defining such a <code>Show</code> instance but it's no more concise than just using <code>deriving</code> truthfully.</p>\n"}], "owner": {"user_type": "does_not_exist", "display_name": "user6023611"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 163, "favorite_count": 0, "accepted_answer_id": 36140792, "answer_count": 1, "score": 0, "last_activity_date": 1458591597, "creation_date": 1458588932, "question_id": 36140027, "link": "https://stackoverflow.com/questions/36140027/haskell-deriving-show-in-class-and-in-all-instances", "title": "haskell, deriving Show in class and in all instances", "body": "<p>That's signature of my class:</p>\n\n<pre><code> class (Ord a) =&gt; Test a where\n</code></pre>\n\n<p>I would like to be able show element <code>a</code> from all instances of class <code>Test</code>.<br>\nSo far I have used <code>deriving Show</code> mechanism only in connection to data type.  </p>\n\n<p>Could you help me ?</p>\n"}, {"tags": ["haskell", "fold", "haskell-lens"], "answers": [{"tags": [], "owner": {"reputation": 49501, "user_id": 784338, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/ae195ac7c8a5e9002a808544572cc5fc?s=128&d=identicon&r=PG", "display_name": "Daniel Gratzer", "link": "https://stackoverflow.com/users/784338/daniel-gratzer"}, "is_accepted": true, "score": 5, "last_activity_date": 1458590724, "creation_date": 1458590724, "answer_id": 36140538, "question_id": 36139995, "link": "https://stackoverflow.com/questions/36139995/why-do-all-lens-match-foldl-handler-type/36140538#36140538", "title": "Why do all Lens match Foldl.Handler type?", "body": "<p>You've got your directions mixed up is all. The optics described there are all of the form</p>\n\n<pre><code> type Foo s t a b = forall f. SomeConstraints f =&gt; (a -&gt; f b)-&gt; (s -&gt; f t)\n</code></pre>\n\n<p><em>Small fib, for prisms it's supposed to work with an arbitrary <code>Choice</code> profunctor, but <code>-&gt;</code> is kind of the canonical example of such a structure so we can specialize the prisms to only work across these profunctors. The reason why this process is legal is identical to what we're going to do with <code>f</code> so suspend disbelief for a minute and read on</em></p>\n\n<p>Now if we instantiate <code>s</code> and <code>t</code> as <code>a</code> and <code>a</code> and <code>b</code> as <code>b</code> then we get</p>\n\n<pre><code> forall f. SomeConstraints f =&gt; (b -&gt; f b) -&gt; (a -&gt; f a)\n</code></pre>\n\n<p>Now this means that if we have some optic, like a lens, prism, or traversal, we can instantiate its type parameters so that it's almost in the form of a <code>Handler</code>. The only difference is ours is guaranteed to work for any <code>f</code> provided it satisfies the constraints we chose. If we know that <code>Constant (Endo x)</code> satisfies those constraints then we can silently specialize that optic to work <em>only with that <code>f</code></em>. This is just plain old polymorphic instantiation! And since <code>Constant a</code> is an <code>Functor</code> and an <code>Applicative</code> it will work with any lens or traversal. This implicit subtyping and instantiation is at the heart of making the lens package work, by leaving all of these things transparent Haskell let's us mix and match abstractions and it will automatically settle on the \"greatest lower bound\" of whatever set of optics we're using.</p>\n\n<p>The whole thing boils down to the fact that in Haskell, if we have <code>e :: forall t. T</code>, then for any appropriately kinded <code>tau</code> we also have <code>e :: [tau/t]T</code>. There are a few wrinkles once we toss in type constraints but over all, it's all just the fact that type application is silent by default in Haskell.</p>\n"}], "owner": {"reputation": 4471, "user_id": 3858142, "user_type": "registered", "accept_rate": 46, "profile_image": "https://www.gravatar.com/avatar/4c27dead2edf0b6dc28833a694c42ba1?s=128&d=identicon&r=PG&f=1", "display_name": "sevo", "link": "https://stackoverflow.com/users/3858142/sevo"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 56, "favorite_count": 0, "accepted_answer_id": 36140538, "answer_count": 1, "score": 0, "last_activity_date": 1458590724, "creation_date": 1458588857, "question_id": 36139995, "link": "https://stackoverflow.com/questions/36139995/why-do-all-lens-match-foldl-handler-type", "title": "Why do all Lens match Foldl.Handler type?", "body": "<p>According to <a href=\"http://haddock.stackage.org/lts-5.8/foldl-1.1.6/Control-Foldl.html#t:Handler\" rel=\"nofollow\">Control.Foldl documentation</a>:</p>\n\n<blockquote>\n  <p>Any lens, traversal, or prism will type-check as a Handler</p>\n</blockquote>\n\n<pre><code>type Handler a b \n   = forall x. (b -&gt; Constant (Endo x) b) -&gt; a -&gt; Constant (Endo x) a\n</code></pre>\n\n<p>One might claim that since lens allows for any <code>Functor</code> that is not a <code>Constant</code> only subset of lens should type-check. Why is that statement incorrect?</p>\n"}, {"tags": ["haskell", "ghci"], "answers": [{"comments": [{"owner": {"reputation": 13337, "user_id": 441899, "user_type": "registered", "accept_rate": 79, "profile_image": "https://www.gravatar.com/avatar/368fb99f86e2264ceec0539a3746b9d3?s=128&d=identicon&r=PG", "display_name": "Jules", "link": "https://stackoverflow.com/users/441899/jules"}, "edited": false, "score": 0, "creation_date": 1458591043, "post_id": 36139407, "comment_id": 59919635, "body": "Thanks.  Reading the documentation I was thinking this might be the case, but wasn&#39;t sure there wasn&#39;t something I was missing."}, {"owner": {"reputation": 94713, "user_id": 1139697, "user_type": "registered", "accept_rate": 86, "profile_image": "https://www.gravatar.com/avatar/5f136ddb684f39aaee1c028ee1950f6f?s=128&d=identicon&r=PG", "display_name": "Zeta", "link": "https://stackoverflow.com/users/1139697/zeta"}, "reply_to_user": {"reputation": 13337, "user_id": 441899, "user_type": "registered", "accept_rate": 79, "profile_image": "https://www.gravatar.com/avatar/368fb99f86e2264ceec0539a3746b9d3?s=128&d=identicon&r=PG", "display_name": "Jules", "link": "https://stackoverflow.com/users/441899/jules"}, "edited": false, "score": 0, "creation_date": 1458634111, "post_id": 36139407, "comment_id": 59935560, "body": "@Jules: You&#39;re welcome. If you open a ticket on trac, either <a href=\"https://stackoverflow.com/posts/36139407/edit\">edit</a> or leave a comment, so that I can get this answer up to date (or add a new answer). Otherwise, if you don&#39;t open a ticket, I&#39;ll have a look whether I can finally create an account and file the ticket and patch myself (either this or next week)."}], "tags": [], "owner": {"reputation": 94713, "user_id": 1139697, "user_type": "registered", "accept_rate": 86, "profile_image": "https://www.gravatar.com/avatar/5f136ddb684f39aaee1c028ee1950f6f?s=128&d=identicon&r=PG", "display_name": "Zeta", "link": "https://stackoverflow.com/users/1139697/zeta"}, "is_accepted": true, "score": 2, "last_activity_date": 1458586699, "creation_date": 1458586699, "answer_id": 36139407, "question_id": 36139011, "link": "https://stackoverflow.com/questions/36139011/how-to-remove-module-from-target-list-in-ghci/36139407#36139407", "title": "How to remove module from &quot;target list&quot; in GHCi", "body": "<p>Unfortunately, <code>:load</code> (or <code>:cd</code>) are the only ways to get rid of the target list. The only other function that changes the target list is <code>:add</code>, and as you know that one only adds additional targets.</p>\n\n<p>However, <a href=\"https://github.com/ghc/ghc/blob/c37a583fb9059053f83f1ab0c3cb7eb7047b1a31/ghc/GHCi/UI.hs\" rel=\"nofollow\">judging by the source</a>, a fix shouldn't be that hard. If you're willing to recompile GHC, something like this should work:</p>\n\n<pre><code>ghciCommands :: [Command]\nghciCommands = map mkCmd [\n  ...\n  (\"rem\",       keepGoingPaths removeModule,   completeFilename),\n  ...\n\n-- | @:rem@ command\nremoveModule :: [FilePath] -&gt; InputT GHCi ()\nremoveModule files = do\n  lift revertCAFs\n  files'  &lt;- mapM expandPath files\n  targets &lt;- mapM (\\m -&gt; GHC.guessTarget m Nothing) files'\n  mapM_ GHC.removeTarget targets\n  _ &lt;- doLoadAndCollectInfo False LoadAllTargets\n  return ()\n</code></pre>\n\n<p>That being said, I haven't tried that yet. Also, this might be worth a <a href=\"https://ghc.haskell.org/trac/ghc/report\" rel=\"nofollow\">ticket on the official tracker</a>.</p>\n"}], "owner": {"reputation": 13337, "user_id": 441899, "user_type": "registered", "accept_rate": 79, "profile_image": "https://www.gravatar.com/avatar/368fb99f86e2264ceec0539a3746b9d3?s=128&d=identicon&r=PG", "display_name": "Jules", "link": "https://stackoverflow.com/users/441899/jules"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 415, "favorite_count": 0, "accepted_answer_id": 36139407, "answer_count": 1, "score": 2, "last_activity_date": 1458586699, "creation_date": 1458585321, "question_id": 36139011, "link": "https://stackoverflow.com/questions/36139011/how-to-remove-module-from-target-list-in-ghci", "title": "How to remove module from &quot;target list&quot; in GHCi", "body": "<p>In GHCI, you can add modules from your current project using <code>:add module</code>, or you can add modules to the current scope using <code>:module + module</code>.  The modules loaded using <code>:add</code> will be automatically reloaded when you use the <code>:reload</code> command, but must be source modules, and cannot come from an external package.</p>\n\n<p>If you accidentally use <code>:add</code> rather than <code>:module +</code> to attempt to load a module, future reloads always fail with an error message that the module is a package module rather than a source module. How can you remove the module so that reload can be used successfully again, without resetting the entire list of source modules via <code>:load</code>?</p>\n"}, {"tags": ["haskell", "polymorphism"], "comments": [{"owner": {"reputation": 13807, "user_id": 2407038, "user_type": "registered", "accept_rate": 64, "profile_image": "https://www.gravatar.com/avatar/538f6f4a9aa43841841de7d8e8b169fc?s=128&d=identicon&r=PG&f=1", "display_name": "user2407038", "link": "https://stackoverflow.com/users/2407038/user2407038"}, "edited": false, "score": 1, "creation_date": 1458596239, "post_id": 36138376, "comment_id": 59922356, "body": "The type <code>forall r. (r -&gt; v1)</code> is inhabited only by functions of the form <code>const x</code> for some <code>x : v1</code>. It is not the same as the type <code>forall a . a -&gt; a</code>. It still isn&#39;t clear what the actual problem is.. the code as given simply <i>doesn&#39;t make sense</i> - you are trying to pull type information from thin air. Have you tried using Typeable? At least, can you give an example of the whole &quot;interact with users, parse her queries and build calls to pure groupColumnsGnAm dynamically&quot; process, and how this desired function would fit into it?"}, {"owner": {"reputation": 83, "user_id": 1709852, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/u9sWp.jpg?s=128&g=1", "display_name": "J Ho", "link": "https://stackoverflow.com/users/1709852/j-ho"}, "reply_to_user": {"reputation": 13807, "user_id": 2407038, "user_type": "registered", "accept_rate": 64, "profile_image": "https://www.gravatar.com/avatar/538f6f4a9aa43841841de7d8e8b169fc?s=128&d=identicon&r=PG&f=1", "display_name": "user2407038", "link": "https://stackoverflow.com/users/2407038/user2407038"}, "edited": false, "score": 0, "creation_date": 1458601955, "post_id": 36138376, "comment_id": 59924591, "body": "Basically I&#39;m trying to mimic mongo aggregation over in-memory column data storage, where columns are represented as unboxed Num vectors and boxed Text vectors. The issue is that Schema is not known at compile time, but is loaded from the filesystem (database). The user can enter queries like: &quot;groupby &quot;region&quot;, &quot;year&quot; aggregate sum &quot;revenue&quot;, count &quot;account&quot; - system should be able to parse it, get corresponding vectors from memory and pass them to groupColumnsGnAm functions, which don&#39;t care what kind of vectors those are as example above shows."}, {"owner": {"reputation": 83, "user_id": 1709852, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/u9sWp.jpg?s=128&g=1", "display_name": "J Ho", "link": "https://stackoverflow.com/users/1709852/j-ho"}, "reply_to_user": {"reputation": 13807, "user_id": 2407038, "user_type": "registered", "accept_rate": 64, "profile_image": "https://www.gravatar.com/avatar/538f6f4a9aa43841841de7d8e8b169fc?s=128&d=identicon&r=PG&f=1", "display_name": "user2407038", "link": "https://stackoverflow.com/users/2407038/user2407038"}, "edited": false, "score": 0, "creation_date": 1458602257, "post_id": 36138376, "comment_id": 59924678, "body": "I tried working with Dynamic but casting back requires explicit typing just as with custom &quot;GenericVector&quot; class. I looked into your suggested Typeable approach but didn&#39;t figure out how to do proper casting using it. I don&#39;t know, I&#39;m starting to think it&#39;s just not the problem domain to be addressed by Haskell efficiently. HList is probably closest to this, but somewhat orthogonal. It&#39;s basically very simplified SQL if you like, but in the middle between inefficient &quot;treat every cell as string&quot; approach and safe but rigid fully typeable for which we need to know schema at compile time."}, {"owner": {"reputation": 83, "user_id": 1709852, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/u9sWp.jpg?s=128&g=1", "display_name": "J Ho", "link": "https://stackoverflow.com/users/1709852/j-ho"}, "reply_to_user": {"reputation": 13807, "user_id": 2407038, "user_type": "registered", "accept_rate": 64, "profile_image": "https://www.gravatar.com/avatar/538f6f4a9aa43841841de7d8e8b169fc?s=128&d=identicon&r=PG&f=1", "display_name": "user2407038", "link": "https://stackoverflow.com/users/2407038/user2407038"}, "edited": false, "score": 0, "creation_date": 1458602461, "post_id": 36138376, "comment_id": 59924747, "body": "Here, it&#39;s optimized for speed for numeric vectors and allows some flexibility with remaining Text columns. Function groupColumnsG1A1 works fine with Vector Text f g Vector Int as well as Vector Int f g Vector Text and all kinds of other combinations - but I need to pass Vectors with explicit typing. I can&#39;t build explicit typing based on user&#39;s input (or I can but it&#39;s a crazy &quot;case&quot; tree). That&#39;s the dilemma. Sorry if it&#39;s unclear, I really tried :)"}, {"owner": {"reputation": 13807, "user_id": 2407038, "user_type": "registered", "accept_rate": 64, "profile_image": "https://www.gravatar.com/avatar/538f6f4a9aa43841841de7d8e8b169fc?s=128&d=identicon&r=PG&f=1", "display_name": "user2407038", "link": "https://stackoverflow.com/users/2407038/user2407038"}, "edited": false, "score": 2, "creation_date": 1458606247, "post_id": 36138376, "comment_id": 59925926, "body": "If the goal is to parse user queries, then you should design a language for user queries, not try to use general functions. Then start from the top, not from the bottom (you are mired in implementation details.. think about high-level design first). Write a function <code>runQuery :: UserQuery -&gt; Table -&gt; Table</code>."}, {"owner": {"reputation": 44013, "user_id": 1477667, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/trgKM.jpg?s=128&g=1", "display_name": "dfeuer", "link": "https://stackoverflow.com/users/1477667/dfeuer"}, "edited": false, "score": 1, "creation_date": 1458607994, "post_id": 36138376, "comment_id": 59926497, "body": "Lots of people hook Haskell up to databases."}], "owner": {"reputation": 83, "user_id": 1709852, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/u9sWp.jpg?s=128&g=1", "display_name": "J Ho", "link": "https://stackoverflow.com/users/1709852/j-ho"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 68, "favorite_count": 0, "answer_count": 0, "score": 0, "last_activity_date": 1458583855, "creation_date": 1458583095, "last_edit_date": 1495540231, "question_id": 36138376, "link": "https://stackoverflow.com/questions/36138376/rankntypes-and-existentials-cant-figure-out-one-final-step", "title": "RankNTypes and Existentials - can&#39;t figure out one final step", "body": "<p>This is a continuation of the previous 2 questions on this topic, getting close but still one final step eludes me. Experts in RankNTypes and other advanced type programming in Haskell, really need your help! :)</p>\n\n<p>There's a family of functions that can do pretty generic map-reduce on column data represented as Vectors, here's the simplest one that takes 2 vectors, groups by unique values of the 1st and runs various aggregation functions on the 2nd:</p>\n\n<pre><code>groupColumnsG1A1 ::\n (Eq k, G.Vector v k, G.Vector v2 r, Hashable k) =&gt;\n   v k -&gt; (v1 -&gt; v1 -&gt; v1) -&gt; (r -&gt; v1) -&gt; v2 r -&gt; Map.HashMap k v1\ngroupColumnsG1A1 xxs f g yys = G.ifoldl' (\\ !acc i x -&gt; Map.insertWith f x (g $ yys G.! i) acc) Map.empty xxs \n</code></pre>\n\n<p>Given 2 sample vectors, boxed <code>V.Vector Text</code> <code>creg</code> and <code>U.Vector Int64</code> <code>cint</code> we can do a bunch of cool polymorphic stuff:</p>\n\n<pre><code>\\&gt; groupColumnsG1A1 creg (+) id cint\nfromList [(\"EMEA\",345),(\"NA\",681),(\"RoW\",988)]\n-- ^ group and sum values in cint\n\n\\&gt; groupColumnsG1A1 creg (+) (const 1) cint\nfromList [(\"EMEA\",7),(\"NA\",7),(\"RoW\",6)]\n-- ^ group and count values in cint\n\n&gt; groupColumnsG1A1 creg (++) (:[]) cint\nfromList [(\"EMEA\",[252,12,1,12,24,43,1]),(\"NA\",[4,412,234,2,4,23,2]),(\"RoW\",[24,23,43,252,412,234])]\n-- ^ group and put all cint values in lists\n</code></pre>\n\n<p>So far, all good and groovy - and important to note that this set of functions works with ALL kinds of Vectors we can feed it - Vector Text, U.Vector Double, U.Vector Int etc etc. Now, if you recall from <a href=\"https://stackoverflow.com/questions/36112633/polymorphic-vector-storage-for-in-memory-column-store-type-of-task\">previous question</a> the problem is that now on top of this pure functional goodies we have to interact with users, parse her queries and build calls to pure groupColumnsGnAm dynamically. After some helpful ideas given, I'm now trying to have one type that hides all the various Vectors in the system so that they can be stored in 1 HashMap and we can get them from there based on user's input:</p>\n\n<pre><code>data GenericVector where\nGenericVector :: (Show a, Eq a, Hashable a, Vector v a, Show (v a)) =&gt; v a -&gt; GenericVector\n</code></pre>\n\n<p>... and then build calls to our pure function like so - same as above but passing GenericVectors instead of specific vectors:</p>\n\n<pre><code>groupColumnsG1A1Gen :: forall v1. Show v1 =&gt; \n                   GenericVector -&gt; \n                   (v1 -&gt; v1 -&gt; v1) -&gt; \n                   (forall r. (r -&gt; v1)) -&gt; \n                   GenericVector -&gt; IO ()\ngroupColumnsG1A1Gen (GenericVector x) f g (GenericVector y) = \n    do let res = groupColumnsG1A1 x f g y\n       putStrLn $ show res\n</code></pre>\n\n<p>All this function does is pattern matches and unwraps our Vectors from <code>GenericVector</code> and calls corresponding pure function. <strong>Now, here comes the problem.</strong> As you can see, <strong>type signature of this function follows <code>groupColumnsG1A1</code> with regards to <code>f</code> and <code>g</code>, so I'd assume it should exhibit all the same flexibility, but it does not work without some <code>RankNTypes</code> magic.</strong> The above is as far as I could get, and the function works for counting example (<code>greg</code> and <code>gint</code> are <code>GenericVectors</code> hiding <code>creg</code> and <code>cint</code>):</p>\n\n<pre><code>\\&gt; groupColumnsG1A1Gen  greg (+) (const 1) gint\nfromList [(\"EMEA\",7),(\"NA\",7),(\"RoW\",6)]\n</code></pre>\n\n<p>But it fails miserably for both sum and list-building examples, here's the error for sum:</p>\n\n<pre><code>\\&gt; groupColumnsG1A1Gen  greg (+) id gint\n\n\nCouldn't match type \u2018r\u2019 with \u2018Integer\u2019\n  \u2018r\u2019 is a rigid type variable bound by\n      a type expected by the context: r -&gt; Integer at &lt;interactive&gt;:266:1\nExpected type: r -&gt; Integer\n  Actual type: Integer -&gt; Integer\nIn the third argument of \u2018groupColumnsG1A1Gen\u2019, namely \u2018id\u2019\nIn the expression: groupColumnsG1A1Gen greg (+) id gint\n</code></pre>\n\n<p>So, it doesn't like <code>id</code> here - but it accepts it perfectly in the pure function case, with the same signature <code>(r-&gt;v1)</code> (apart from RankN stuff, but without it doesn't even compile).</p>\n\n<p>This makes me hope I'm on the right road, but my RankN fluency is nowhere near what it needs to be to figure correct qualifications by myself, so any help is much appreciated - <strong>what should the type signature be to support at least the same 3 cases - <code>(+) id</code>, <code>(+) (const 1)</code>, <code>(++) (:[])</code>?</strong> Maybe it's not just RankNTypes, but I need some typeclass or functional dependency here?</p>\n\n<p>Thanks a lot! I commit to writing a tutorial based on this highly educational experience to give back to the community... </p>\n\n<p>PS Here's the error for the list building case for full picture:</p>\n\n<pre><code>&gt; groupColumnsG1A1Gen  greg (++) (:[]) gint\n\nCouldn't match type \u2018r\u2019 with \u2018()\u2019\n  \u2018r\u2019 is a rigid type variable bound by\n      a type expected by the context: r -&gt; [()] at &lt;interactive&gt;:268:1\nExpected type: r -&gt; [()]\n  Actual type: r -&gt; [r]\nIn the third argument of \u2018groupColumnsG1A1Gen\u2019, namely \u2018(: [])\u2019\nIn the expression: groupColumnsG1A1Gen greg (++) (: []) gint\n</code></pre>\n"}, {"tags": ["haskell", "build", "binary", "executable", "haskell-stack"], "answers": [{"comments": [{"owner": {"reputation": 2024, "user_id": 3026489, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/42eefce716334b3baef26625220fb7a0?s=128&d=identicon&r=PG&f=1", "display_name": "Yosh", "link": "https://stackoverflow.com/users/3026489/yosh"}, "edited": false, "score": 1, "creation_date": 1476630816, "post_id": 36137431, "comment_id": 67416992, "body": "This ability seems to be lost from Nov 2015, up to now. (ref. <a href=\"https://github.com/commercialhaskell/stack/issues/1406\" rel=\"nofollow noreferrer\">commercialhaskell/stack/issues/1406</a>)"}], "tags": [], "owner": {"reputation": 94713, "user_id": 1139697, "user_type": "registered", "accept_rate": 86, "profile_image": "https://www.gravatar.com/avatar/5f136ddb684f39aaee1c028ee1950f6f?s=128&d=identicon&r=PG", "display_name": "Zeta", "link": "https://stackoverflow.com/users/1139697/zeta"}, "is_accepted": true, "score": 5, "last_activity_date": 1458580028, "creation_date": 1458580028, "answer_id": 36137431, "question_id": 36137310, "link": "https://stackoverflow.com/questions/36137310/haskell-stack-build-specific-executable/36137431#36137431", "title": "Haskell Stack build specific executable", "body": "<p>Stack <a href=\"http://docs.haskellstack.org/en/stable/build_command/#target-syntax\" rel=\"noreferrer\">uses a component based lookup</a>, e.g.</p>\n\n<pre><code>stack build packagename:component-type:component-name\n</code></pre>\n\n<p>So if your package is called \"foo\", and your executable is called \"bar\", you can use</p>\n\n<pre><code>stack build foo:exe:bar\n</code></pre>\n\n<p>However, if the component-name is unique, you can drop the package's name and the component type. So if your executable is called \"exectuable-name\", it's</p>\n\n<pre><code>stack build :executable-name\n</code></pre>\n"}], "owner": {"reputation": 7435, "user_id": 3233398, "user_type": "registered", "accept_rate": 9, "profile_image": "https://www.gravatar.com/avatar/c2ab25926e68d6897da205117b1fe9fd?s=128&d=identicon&r=PG", "display_name": "EliuX", "link": "https://stackoverflow.com/users/3233398/eliux"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 1885, "favorite_count": 2, "accepted_answer_id": 36137431, "answer_count": 1, "score": 6, "last_activity_date": 1458580028, "creation_date": 1458579707, "question_id": 36137310, "link": "https://stackoverflow.com/questions/36137310/haskell-stack-build-specific-executable", "title": "Haskell Stack build specific executable", "body": "<p>How to build an specific stack executable file, ie. those specified in <code>projectname.cabal</code>, like:</p>\n\n<pre><code>executable executable-name\n  hs-source-dirs:      tools\n  main-is:             ExecutableModule.hs\n  ghc-options:         -Wall -threaded -rtsopts -with-rtsopts=-N\n  build-depends:       base\n                     , hsass\n                     , hlibsass\n</code></pre>\n\n<p>I would need to compile <code>executable-name</code> and no other. It would be something like:</p>\n\n<pre><code>stack build --executable executable-name\n</code></pre>\n"}, {"tags": ["list", "haskell"], "comments": [{"owner": {"reputation": 500, "user_id": 847984, "user_type": "registered", "accept_rate": 27, "profile_image": "https://i.stack.imgur.com/V9dwi.jpg?s=128&g=1", "display_name": "Andrew Nodermann", "link": "https://stackoverflow.com/users/847984/andrew-nodermann"}, "edited": false, "score": 0, "creation_date": 1458577932, "post_id": 36136537, "comment_id": 59911536, "body": "Imagine that you&#39;re holding a deck of cards consisting of 3 pieces, you take a random card and throw it on the table, then another, and then the last, now the table have a jumbled list of cards, the head of a new deck the last card is thrown. it&#39;s like <a href=\"https://en.wikipedia.org/wiki/Fisher-Yates_shuffle\" rel=\"nofollow noreferrer\">en.wikipedia.org/wiki/Fisher-Yates_shuffle</a>"}, {"owner": {"reputation": 965, "user_id": 3783565, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/Yhgn8.png?s=128&g=1", "display_name": "Kevin W.", "link": "https://stackoverflow.com/users/3783565/kevin-w"}, "edited": false, "score": 2, "creation_date": 1458578002, "post_id": 36136537, "comment_id": 59911583, "body": "What have you tried so far?  This reads a bit to me like a homework request."}, {"owner": {"reputation": 500, "user_id": 847984, "user_type": "registered", "accept_rate": 27, "profile_image": "https://i.stack.imgur.com/V9dwi.jpg?s=128&g=1", "display_name": "Andrew Nodermann", "link": "https://stackoverflow.com/users/847984/andrew-nodermann"}, "reply_to_user": {"reputation": 965, "user_id": 3783565, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/Yhgn8.png?s=128&g=1", "display_name": "Kevin W.", "link": "https://stackoverflow.com/users/3783565/kevin-w"}, "edited": false, "score": 0, "creation_date": 1458578142, "post_id": 36136537, "comment_id": 59911681, "body": "updated for full code, I&#39;m writing a poker server it will be opensource"}, {"owner": {"reputation": 94713, "user_id": 1139697, "user_type": "registered", "accept_rate": 86, "profile_image": "https://www.gravatar.com/avatar/5f136ddb684f39aaee1c028ee1950f6f?s=128&d=identicon&r=PG", "display_name": "Zeta", "link": "https://stackoverflow.com/users/1139697/zeta"}, "edited": false, "score": 0, "creation_date": 1458580227, "post_id": 36136537, "comment_id": 59913208, "body": "That&#39;s not possible with list comprehensions only."}], "answers": [{"tags": [], "owner": {"reputation": 62252, "user_id": 1435869, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/TrEd9.jpg?s=128&g=1", "display_name": "karakfa", "link": "https://stackoverflow.com/users/1435869/karakfa"}, "is_accepted": false, "score": 1, "last_activity_date": 1458584221, "creation_date": 1458584221, "answer_id": 36138702, "question_id": 36136537, "link": "https://stackoverflow.com/questions/36136537/haskell-list-comprehensions-lista-listb-listc/36138702#36138702", "title": "Haskell List Comprehensions listA listB -&gt; listC", "body": "<p>You chose a complicated way to create the permutations but perhaps that's what the problem domain dictates.</p>\n\n<p>The required permutation cannot be created by list comprehensions but can be written with some simple utility functions</p>\n\n<p>first write a drop element function</p>\n\n<pre><code>dropAt :: Int -&gt; [a] -&gt; [a]\ndropAt _ [] = []\ndropAt n x  = let (h,t) = splitAt n x in (init h) ++ t\n</code></pre>\n\n<p>now using this your own picking function</p>\n\n<pre><code>pickAt :: [Int] -&gt; [a] -&gt; [a]\npickAt _ [] = []\npickAt [] _ = []\npickAt (n:ns) xs = xs!!(n-1) : pickAt ns (dropAt n xs)\n</code></pre>\n\n<p>gives you the reverse order though, run through reverse</p>\n\n<pre><code>&gt; reverse $ pickAt [2,1,1] ['a','b','c']\n\"cab\"\n\n&gt; reverse $ pickAt [1,1,1] ['a','b','c']\n\"cba\"\n</code></pre>\n"}], "owner": {"reputation": 500, "user_id": 847984, "user_type": "registered", "accept_rate": 27, "profile_image": "https://i.stack.imgur.com/V9dwi.jpg?s=128&g=1", "display_name": "Andrew Nodermann", "link": "https://stackoverflow.com/users/847984/andrew-nodermann"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 105, "favorite_count": 0, "answer_count": 1, "score": 0, "last_activity_date": 1458584221, "creation_date": 1458577604, "last_edit_date": 1458578328, "question_id": 36136537, "link": "https://stackoverflow.com/questions/36136537/haskell-list-comprehensions-lista-listb-listc", "title": "Haskell List Comprehensions listA listB -&gt; listC", "body": "<p>I have two lists with elements ListA ([String]) and sample positions ListB([Int]) how to create a new ListC ([String]) using <em>list comprehensions</em>?</p>\n\n<p>for example:</p>\n\n<p>the left number is always more right (see ListB)</p>\n\n<pre><code>Step 1: get elem 1, add the head of the ListC\n      ListC = [\"a\"]\nStep 2: get elem 2, add the head of the ListC\n      ListC = [\"c\",\"a\"]\nStep 3: get elem 1, add the head of the ListC\n      ListC = [\"b\",\"c\",\"a\"]\n\nso the full chain:\na b c -&gt; 1 2 1 -&gt; a -&gt; c a -&gt; b c a\n</code></pre>\n\n<p>more templates: </p>\n\n<pre><code>ListA::[String]\nListB::[int]\nListC::[String]\n\nListA    ListB    ListC\na b c -&gt; 3 2 1 -&gt; a b c\na b c -&gt; 2 2 1 -&gt; a c b\na b c -&gt; 3 1 1 -&gt; b a c\na b c -&gt; 1 2 1 -&gt; b c a\na b c -&gt; 2 1 1 -&gt; c a b\na b c -&gt; 1 1 1 -&gt; c b a\n</code></pre>\n\n<p>this function is to generate valid numeric sequences (note each left element, it is more than the previous one, at least per 1, ie. head is the greatest element)</p>\n\n<pre><code>module Main ( main ) where\n\nimport System.Random\n\nmain :: IO ()\n\nrandomList :: Int -&gt; [Int] -&gt; StdGen -&gt; [Int]\nrandomList 0 xlist _ = reverse xlist\nrandomList n xlist gen = randomList (n-1) (randomVal : xlist) gen'\n    where (randomVal, gen') = randomR (1,n) gen\n\nshuffle :: [Int] -&gt; [String] -&gt; [String] -&gt; [String]\nshuffle [] _ deckB = deckB\nshuffle pl deckA deckB = shuffle (tail pl) (hs ++ tail ts) (head ts : deckB)\n    where (hs, ts) = splitAt (pos-1) deckA\n          pos = head pl\n\nranks = [\"2\",\"3\",\"4\",\"5\",\"6\",\"7\",\"8\",\"9\",\"T\",\"J\",\"Q\",\"K\",\"A\"]\nsuits = [\"C\",\"D\",\"H\",\"S\"]\ndeck = [rank ++ suit | suit &lt;- suits, rank &lt;- ranks]\n\nmain = do\n    gen &lt;- newStdGen\n    let len = 52 :: Int\n    let permutationList = randomList len [] gen\n    let newDeck = shuffle permutationList deck []\n    print permutationList\n    print deck\n    print \"-------------------------------------\"\n    print newDeck\n</code></pre>\n"}, {"tags": ["haskell"], "comments": [{"owner": {"reputation": 100892, "user_id": 745903, "user_type": "registered", "accept_rate": 74, "profile_image": "https://www.gravatar.com/avatar/50933f6638836741e620669b3940410e?s=128&d=identicon&r=PG", "display_name": "leftaroundabout", "link": "https://stackoverflow.com/users/745903/leftaroundabout"}, "edited": false, "score": 1, "creation_date": 1458577791, "post_id": 36136487, "comment_id": 59911446, "body": "This is not legal Haskell code, I suppose you mean <code>data Person = Person Name ...</code> \u2013 type names and constructors must be capitalised. Also, your question doesn&#39;t seem to have anything to do with classes (note that Haskell classes \u2013 <i>type classes</i> \u2013 are something quite different from OO classes as you have in e.g. Java)."}, {"owner": {"reputation": 389, "user_id": 5219032, "user_type": "registered", "profile_image": "https://graph.facebook.com/1469151279/picture?type=large", "display_name": "Enes Altuncu", "link": "https://stackoverflow.com/users/5219032/enes-altuncu"}, "reply_to_user": {"reputation": 100892, "user_id": 745903, "user_type": "registered", "accept_rate": 74, "profile_image": "https://www.gravatar.com/avatar/50933f6638836741e620669b3940410e?s=128&d=identicon&r=PG", "display_name": "leftaroundabout", "link": "https://stackoverflow.com/users/745903/leftaroundabout"}, "edited": false, "score": 0, "creation_date": 1458577906, "post_id": 36136487, "comment_id": 59911521, "body": "You&#39;re right. Sorry for bad explanation. Just because I&#39;m quite new in Haskell and I&#39;m used to c-like languages"}, {"owner": {"reputation": 100892, "user_id": 745903, "user_type": "registered", "accept_rate": 74, "profile_image": "https://www.gravatar.com/avatar/50933f6638836741e620669b3940410e?s=128&d=identicon&r=PG", "display_name": "leftaroundabout", "link": "https://stackoverflow.com/users/745903/leftaroundabout"}, "edited": false, "score": 0, "creation_date": 1458577940, "post_id": 36136487, "comment_id": 59911540, "body": "No problem, but please edit your question accordingly. Also, it could use some more explanation on what exactly you want (example input and corresponding result)."}, {"owner": {"reputation": 384463, "user_id": 1126841, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/fa05233b2357f8d11c22ef4cfc7bb85c?s=128&d=identicon&r=PG", "display_name": "chepner", "link": "https://stackoverflow.com/users/1126841/chepner"}, "edited": false, "score": 0, "creation_date": 1458578319, "post_id": 36136487, "comment_id": 59911814, "body": "It seems like <code>Employee</code> should be renamed something like <code>Group</code>. An employee is a particular kind of person, not a group of them."}, {"owner": {"reputation": 100892, "user_id": 745903, "user_type": "registered", "accept_rate": 74, "profile_image": "https://www.gravatar.com/avatar/50933f6638836741e620669b3940410e?s=128&d=identicon&r=PG", "display_name": "leftaroundabout", "link": "https://stackoverflow.com/users/745903/leftaroundabout"}, "edited": false, "score": 0, "creation_date": 1458579317, "post_id": 36136487, "comment_id": 59912537, "body": "The question title still doesn&#39;t make sense. The function signature is helpful, but are you sure you don&#39;t mean <code>Employees -&gt; Name -&gt; Person</code>? Again: it would be helpful if you gave some <i>example input</i> and the expected result. And: it&#39;s also considered good etiquette, at least, to show some <i>own effort</i> to solve the problem!"}, {"owner": {"reputation": 389, "user_id": 5219032, "user_type": "registered", "profile_image": "https://graph.facebook.com/1469151279/picture?type=large", "display_name": "Enes Altuncu", "link": "https://stackoverflow.com/users/5219032/enes-altuncu"}, "edited": false, "score": 0, "creation_date": 1458579666, "post_id": 36136487, "comment_id": 59912804, "body": "My purpose is to print the new Employees list after the changes in Person. So my function signature is that I want."}], "answers": [{"comments": [{"owner": {"reputation": 389, "user_id": 5219032, "user_type": "registered", "profile_image": "https://graph.facebook.com/1469151279/picture?type=large", "display_name": "Enes Altuncu", "link": "https://stackoverflow.com/users/5219032/enes-altuncu"}, "edited": false, "score": 0, "creation_date": 1458579944, "post_id": 36137213, "comment_id": 59913017, "body": "Thank you for your good explanation without any complaining in spite of my bad explanation..."}], "tags": [], "owner": {"reputation": 49501, "user_id": 784338, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/ae195ac7c8a5e9002a808544572cc5fc?s=128&d=identicon&r=PG", "display_name": "Daniel Gratzer", "link": "https://stackoverflow.com/users/784338/daniel-gratzer"}, "is_accepted": true, "score": 1, "last_activity_date": 1458579744, "last_edit_date": 1458579744, "creation_date": 1458579382, "answer_id": 36137213, "question_id": 36136487, "link": "https://stackoverflow.com/questions/36136487/getting-a-data-class-from-a-given-value-of-that-class-in-haskell/36137213#36137213", "title": "Getting a data class from a given value of that class in Haskell", "body": "<p>We can write this most directly by just pattern matching and using <code>map</code>.</p>\n\n<p>In this case we might start by writing a small helper function to perform the local modification a single <code>Person</code> value and use something like <code>map</code> to apply our transformation to a whole bunch of other data. So we might have</p>\n\n<pre><code> updatePerson :: Name -&gt; Person -&gt; Person \n updatePerson targetName (Person name sur projects)\n   | targetName == name = Person name sur (NewProject : project)\n   | otherwise = Person name sur projects\n</code></pre>\n\n<p>and then we can write a little more code to uniformly  apply this transformation to our <code>Employee</code> data</p>\n\n<pre><code>myFunction :: Person -&gt; Person\nmyFunction name (Employee ps salary) = \n  Employee (map (updatePerson name) ps) salaray\n</code></pre>\n\n<p>In your scenario this is the right thing to do. However, presumably we're going to be accessing parts of these data structures a lot so it makes sense to optimize for it a bit! By writing a few helper functions to manipulate our data types we might see how to get a more general approach:</p>\n\n<pre><code>personName :: Person -&gt; Name\npersonName (Person name sur projects) = name\n\nmodifyProjects :: ([Project] -&gt; [Project]) -&gt; Person -&gt; Person\nmodifyProjects f (Person name sur p) = Person name sur (f p)\n</code></pre>\n\n<p>and then writing something like</p>\n\n<pre><code> myFunction name (Employee people salary) = Employee (map go people) salary\n   where go p | personName p == name = modifyProject ... p\n              | otherwise = p\n</code></pre>\n\n<p>Now I wrote this with helper functions rather than pattern matching directly because it suggests we use Haskell's built in feature for generating these functions, records.</p>\n\n<pre><code>data Person = Person { _name :: Name\n                     , _surname :: Surname\n                     , _projects :: [Projects]\ndata Employees = Employees {_people :: [Person], _salary :: Salary}\n</code></pre>\n\n<p>And then we can do something like</p>\n\n<pre><code>myFunction name e = e {_people = map go (_people e}}\n  where go p | _name p == name = p {_projects = New :: _projects p}\n             | otherwise = p\n</code></pre>\n\n<p>but now this is still clunky, Haskell's record system is a little tough to work with. This is actually the impetus for a whole lot of crazy powerful libraries implementing \"lenses\" which give us the ability to implement these record like transformations using a kit of generic combinators. I provide the corresponding lens code for an example of Haskell scaling up to do something cool, but either of the 3 alternatives I mentioned above are perfectly fine and much less complex</p>\n\n<pre><code>import Control.Lens\ndata Person = Person { _name :: Name\n                     , _surname :: Surname\n                     , _projects :: [Projects] }\ndata Employees = Employees {_people :: [Person], _salary :: Salary}\n\nmakeLenses ''Person\nmakeLenses ''Employees\n\nmyFunction n e =\n  e &amp; people.traverse.filtered pred.projects %~ (:) \"New Project\"\n  where pred person = person^.name.to (== n)\n</code></pre>\n"}], "owner": {"reputation": 389, "user_id": 5219032, "user_type": "registered", "profile_image": "https://graph.facebook.com/1469151279/picture?type=large", "display_name": "Enes Altuncu", "link": "https://stackoverflow.com/users/5219032/enes-altuncu"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 51, "favorite_count": 0, "accepted_answer_id": 36137213, "answer_count": 1, "score": 0, "last_activity_date": 1458579744, "creation_date": 1458577472, "last_edit_date": 1458579120, "question_id": 36136487, "link": "https://stackoverflow.com/questions/36136487/getting-a-data-class-from-a-given-value-of-that-class-in-haskell", "title": "Getting a data class from a given value of that class in Haskell", "body": "<p>I have two definitions that</p>\n\n<pre><code>data Person = Person Name Surname [Projects]\ndata Employees = Employees [Person] Salary\n</code></pre>\n\n<p>And I want to get the corresponding person from a given name by using the person list in employee and make some changes in the corresponding person. For example, I want to add a project to the list of project of the person that I want to do the project. How can I do this in Haskell? </p>\n\n<p>The function signature should be like</p>\n\n<pre><code>myfunction :: Employees -&gt; Name -&gt; Employees\n</code></pre>\n"}, {"tags": ["haskell"], "comments": [{"owner": {"reputation": 44013, "user_id": 1477667, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/trgKM.jpg?s=128&g=1", "display_name": "dfeuer", "link": "https://stackoverflow.com/users/1477667/dfeuer"}, "edited": false, "score": 1, "creation_date": 1458579268, "post_id": 36134200, "comment_id": 59912504, "body": "Aside from the type issue, can you see why your function is O(n^2)? Can you figure out how to make it O(n)?"}, {"owner": {"reputation": 44013, "user_id": 1477667, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/trgKM.jpg?s=128&g=1", "display_name": "dfeuer", "link": "https://stackoverflow.com/users/1477667/dfeuer"}, "edited": false, "score": 0, "creation_date": 1458584469, "post_id": 36134200, "comment_id": 59915919, "body": "This question is a near-duplicate of <a href=\"http://stackoverflow.com/questions/24664501/no-instance-for-eq-a0-arising-from-a-use-of\" title=\"no instance for eq a0 arising from a use of\">stackoverflow.com/questions/24664501/&hellip;</a>, but this one is much more to-the-point and has better answers."}, {"owner": {"reputation": 100185, "user_id": 3234959, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/93bb12ca0f93dfddb33880316f7e66c2?s=128&d=identicon&r=PG&f=1", "display_name": "chi", "link": "https://stackoverflow.com/users/3234959/chi"}, "edited": false, "score": 1, "creation_date": 1458588266, "post_id": 36134200, "comment_id": 59918090, "body": "By the way, you coding style is dangerously using partial operations: whenever <code>list</code> is empty, the variables <code>listHead</code> and <code>listTail</code> will be bound to an erroneous value (AKA bottom). In that case, any attempt to use those variables will crash the whole program. The programmer must carefully guard all such uses with a non-null test. By comparison, using proper, exhaustive pattern matching as suggested below in the answers fixes the partiality problem <i>and</i> does not even require the <code>Eq</code> constraint. This is why, arguably, pattern matching should always be preferred to using guards."}, {"owner": {"reputation": 24109, "user_id": 775954, "user_type": "registered", "accept_rate": 85, "profile_image": "https://www.gravatar.com/avatar/9f5a87db35489d2958945f35b457f1ee?s=128&d=identicon&r=PG", "display_name": "Matthias Braun", "link": "https://stackoverflow.com/users/775954/matthias-braun"}, "reply_to_user": {"reputation": 44013, "user_id": 1477667, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/trgKM.jpg?s=128&g=1", "display_name": "dfeuer", "link": "https://stackoverflow.com/users/1477667/dfeuer"}, "edited": false, "score": 0, "creation_date": 1458591836, "post_id": 36134200, "comment_id": 59920038, "body": "@dfeuer: Thanks for the hint! Yes, <code>reverse&#39; listTail</code> and <code>++</code> are <i>both</i> O(n) which makes this function O(n^2). I presume <code>foldl</code> would be useful to make the function less complex."}, {"owner": {"reputation": 44013, "user_id": 1477667, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/trgKM.jpg?s=128&g=1", "display_name": "dfeuer", "link": "https://stackoverflow.com/users/1477667/dfeuer"}, "edited": false, "score": 0, "creation_date": 1458592083, "post_id": 36134200, "comment_id": 59920159, "body": "@MatthiasBraun, you certainly could use <code>foldl</code> for this purpose (although there&#39;s a subtle reason to be careful about that because it can potentially interact very badly with certain GHC optimizations in some cases). But you can (and should!) start by doing it by hand using a helper function."}], "answers": [{"comments": [{"owner": {"reputation": 339851, "user_id": 149392, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/7a561ec0875fcbbe3066ea8fe288ec77?s=128&d=identicon&r=PG", "display_name": "sepp2k", "link": "https://stackoverflow.com/users/149392/sepp2k"}, "edited": false, "score": 2, "creation_date": 1458571857, "post_id": 36134288, "comment_id": 59907021, "body": "Or pattern matching."}], "tags": [], "owner": {"reputation": 94713, "user_id": 1139697, "user_type": "registered", "accept_rate": 86, "profile_image": "https://www.gravatar.com/avatar/5f136ddb684f39aaee1c028ee1950f6f?s=128&d=identicon&r=PG", "display_name": "Zeta", "link": "https://stackoverflow.com/users/1139697/zeta"}, "is_accepted": false, "score": 5, "last_activity_date": 1458571859, "last_edit_date": 1458571859, "creation_date": 1458571824, "answer_id": 36134288, "question_id": 36134200, "link": "https://stackoverflow.com/questions/36134200/why-must-element-type-of-list-be-eq-when-checking-for-empty-list/36134288#36134288", "title": "Why must element type of list be Eq when checking for empty list", "body": "<p>Because <code>(==) :: Eq a =&gt; a -&gt; a -&gt; Bool</code> only works for instances of <code>Eq</code>, and <code>[]</code> is only an instance of <code>Eq</code> if its elements are an instance of <code>Eq</code>:</p>\n\n<pre><code>instance (Eq a) =&gt; Eq [a] where\n    ...\n</code></pre>\n\n<p>Instead, use <code>null :: [a] -&gt; Bool</code> or pattern matching to check whether a list is empty:</p>\n\n<pre><code>reverse' [] = []\nreverse' xs = ...\n</code></pre>\n"}, {"tags": [], "owner": {"reputation": 49501, "user_id": 784338, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/ae195ac7c8a5e9002a808544572cc5fc?s=128&d=identicon&r=PG", "display_name": "Daniel Gratzer", "link": "https://stackoverflow.com/users/784338/daniel-gratzer"}, "is_accepted": true, "score": 8, "last_activity_date": 1458577696, "last_edit_date": 1458577696, "creation_date": 1458571949, "answer_id": 36134336, "question_id": 36134200, "link": "https://stackoverflow.com/questions/36134200/why-must-element-type-of-list-be-eq-when-checking-for-empty-list/36134336#36134336", "title": "Why must element type of list be Eq when checking for empty list", "body": "<p>This is because we can only compare lists in general for equality if we can compare their elements for equality. That is, in the general case there's no real way to explain <code>[a, b, c] == [d, e, f]</code> unless we can explain <code>a == d</code>.</p>\n\n<p>This is reflected in the type of <code>(==)</code> on lists which after all works for both your case and the more generalized one:</p>\n\n<pre><code> (==) :: (Eq a) =&gt; [a] -&gt; [a] -&gt; Bool\n</code></pre>\n\n<p>However you don't want to compare a list of equality with another list really, you just want to check whether a list is empty and so</p>\n\n<pre><code> null :: [a] -&gt; Bool\n</code></pre>\n\n<p>is a far better choice for you. And it doesn't have that equality constraint because it just uses pattern matching on the structure of the list, something that never requires a type class constraint.</p>\n\n<pre><code>  null :: [a] -&gt; Bool\n  null [] = True\n  null (_ : _) = False\n</code></pre>\n\n<p>Even better in your case would be to just do the pattern matching yourself, after all, you're already right by a pattern!</p>\n\n<pre><code>reverse' [] = []\nreverse' (listHead : listTail) = (reverse' listTail) ++ [listHead]\n</code></pre>\n\n<p>This is much closer to idiomatic Haskell because verifying that it doesn't crash can be done trivially by the compiler, we've exhaustively covered all cases in a way that it can check. In your version, to verify that the code would work we had to trace the two paths through the code and ensure an empty list would never end up in the branch where we had done that pattern match. This is only a small problem right now, but it will creep up in difficulty very quickly.</p>\n"}], "owner": {"reputation": 24109, "user_id": 775954, "user_type": "registered", "accept_rate": 85, "profile_image": "https://www.gravatar.com/avatar/9f5a87db35489d2958945f35b457f1ee?s=128&d=identicon&r=PG", "display_name": "Matthias Braun", "link": "https://stackoverflow.com/users/775954/matthias-braun"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 231, "favorite_count": 1, "accepted_answer_id": 36134336, "answer_count": 2, "score": 1, "last_activity_date": 1458577696, "creation_date": 1458571627, "question_id": 36134200, "link": "https://stackoverflow.com/questions/36134200/why-must-element-type-of-list-be-eq-when-checking-for-empty-list", "title": "Why must element type of list be Eq when checking for empty list", "body": "<p>The following <code>reverse'</code> function has type <code>Eq t =&gt; [t] -&gt; [t]</code>:</p>\n\n<pre><code>reverse' list | list == [] = []\n              | otherwise  = (reverse' listTail) ++ [listHead]\n                where (listHead : listTail) = list\n</code></pre>\n\n<p>Why must the elements of the list be members of the typeclass <code>Eq</code>? I'm not comparing the elements for equality but the <em>list</em> they are contained in.</p>\n\n<p>In my intuition, the list of <code>t</code> must be equatable, but <code>t</code> itself doesn't.</p>\n"}, {"tags": ["haskell", "typeclass", "existential-type"], "comments": [{"owner": {"reputation": 44013, "user_id": 1477667, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/trgKM.jpg?s=128&g=1", "display_name": "dfeuer", "link": "https://stackoverflow.com/users/1477667/dfeuer"}, "edited": false, "score": 3, "creation_date": 1458566215, "post_id": 36131396, "comment_id": 59902738, "body": "I don&#39;t think this is going to work, unless you want to add a <code>Typeable</code> constraint or something. Can you give some concrete examples of why you want this?"}, {"owner": {"reputation": 5328, "user_id": 325809, "user_type": "registered", "accept_rate": 70, "profile_image": "https://www.gravatar.com/avatar/b858606c4daae58cfdb362bf2fc4caa5?s=128&d=identicon&r=PG", "display_name": "fakedrake", "link": "https://stackoverflow.com/users/325809/fakedrake"}, "reply_to_user": {"reputation": 44013, "user_id": 1477667, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/trgKM.jpg?s=128&g=1", "display_name": "dfeuer", "link": "https://stackoverflow.com/users/1477667/dfeuer"}, "edited": false, "score": 0, "creation_date": 1458566922, "post_id": 36131396, "comment_id": 59903320, "body": "The <code>Typeable</code> (or <code>Data</code>) constraint is an acceptable compromise, but I couldn&#39;t figure out how to do it event with those..."}, {"owner": {"reputation": 44013, "user_id": 1477667, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/trgKM.jpg?s=128&g=1", "display_name": "dfeuer", "link": "https://stackoverflow.com/users/1477667/dfeuer"}, "edited": false, "score": 2, "creation_date": 1458567131, "post_id": 36131396, "comment_id": 59903475, "body": "This code is so ... weird ... that I can&#39;t give any concrete advice without more background about what, concretely, you&#39;re trying to accomplish. Do you have a use-case?"}], "answers": [{"comments": [{"owner": {"reputation": 5328, "user_id": 325809, "user_type": "registered", "accept_rate": 70, "profile_image": "https://www.gravatar.com/avatar/b858606c4daae58cfdb362bf2fc4caa5?s=128&d=identicon&r=PG", "display_name": "fakedrake", "link": "https://stackoverflow.com/users/325809/fakedrake"}, "edited": false, "score": 0, "creation_date": 1458656241, "post_id": 36145214, "comment_id": 59950944, "body": "Yes proxy was exactly the kind of thing I was looking for"}], "tags": [], "owner": {"reputation": 37486, "user_id": 371753, "user_type": "registered", "accept_rate": 83, "profile_image": "https://i.stack.imgur.com/znFEK.jpg?s=128&g=1", "display_name": "sclv", "link": "https://stackoverflow.com/users/371753/sclv"}, "is_accepted": true, "score": 1, "last_activity_date": 1458613983, "creation_date": 1458613983, "answer_id": 36145214, "question_id": 36131396, "link": "https://stackoverflow.com/questions/36131396/default-values-subject-to-existential-constraint-in-haskell/36145214#36145214", "title": "Default values subject to existential constraint in haskell", "body": "<p>Why not:</p>\n\n<pre><code>import Data.Proxy\n\nclass DefaultingQuestion q a where\n  def :: Proxy q -&gt; a\n\ninstance DefaultingQuestion A where\n  def _ = C1\n</code></pre>\n"}], "owner": {"reputation": 5328, "user_id": 325809, "user_type": "registered", "accept_rate": 70, "profile_image": "https://www.gravatar.com/avatar/b858606c4daae58cfdb362bf2fc4caa5?s=128&d=identicon&r=PG", "display_name": "fakedrake", "link": "https://stackoverflow.com/users/325809/fakedrake"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 111, "favorite_count": 1, "accepted_answer_id": 36145214, "answer_count": 1, "score": 0, "last_activity_date": 1458613983, "creation_date": 1458564312, "last_edit_date": 1458570622, "question_id": 36131396, "link": "https://stackoverflow.com/questions/36131396/default-values-subject-to-existential-constraint-in-haskell", "title": "Default values subject to existential constraint in haskell", "body": "<p>Consider the following typeclass that defines pairs of types:</p>\n\n<pre><code>class Constraint a b where\n  g :: a -&gt; b\n</code></pre>\n\n<p>For all instances of constraint we can derive a set of types <code>a</code>, essentially an implicit typeclass, let's call it <code>A</code>. For each instance of typeclass <code>A</code> there is another implicit typeclass <code>B</code> which is includes all possible types <code>b</code> for <code>Constraint A b</code>.</p>\n\n<p>So here is a piece of code.</p>\n\n<pre><code>{-# LANGUAGE ExistentialQuantification #-}\n{-# LANGUAGE MultiParamTypeClasses #-}\nimport Debug.Trace\n\n-- Contraining class\nclass (Show a, Show b) =&gt; QandA a b where\n  g :: a -&gt; b\n\n-- Some data types\ndata A = A1 | A2 deriving (Show, Eq)\ndata B = B1 | B2 deriving (Show, Eq)\ndata C = C1 | C2 deriving (Show, Eq)\n\ninstance QandA A B where\n  g A1 = B1\n  g A2 = B2\n\ninstance QandA A C where\n  g A1 = C1\n  g A2 = C2\n\n-- We want to define a set of types that includes all the types that\n-- have Constraint a b given a. This can be done via an intermediate\n-- type.\ndata DefaultAnswer q = forall a . (DefaultingQuestion q, QandA q a) =&gt; DefaultAnswer {answer :: a};\n\n-- Polymorphism\nclass DefaultingQuestion q where\n  def :: DefaultAnswer q\n\ninstance DefaultingQuestion A where\n  def = DefaultAnswer C1\n</code></pre>\n\n<p>Which typechecks but in ghci</p>\n\n<pre><code>&gt; (def :: DefaultAnswer A)\n(def :: DefaultAnswer A) :: DefaultAnswer A\n</code></pre>\n\n<p>But </p>\n\n<pre><code>&gt; answer (def :: DefaultAnswer A)\n&lt;interactive&gt;:574:1:\n    Cannot use record selector \"answer\" as a function due to escaped type variables\n    Probable fix: use pattern-matching syntax instead\n    In the expression: answer (def :: DefaultAnswer A)\n    In an equation for \"it\": it = answer (def :: DefaultAnswer A)\n</code></pre>\n\n<p>Now the way I understand it is that, since I use existential types, GHC does not really look for the type of <code>answer</code>, it just makes sure there could be one even if it has no way of figuring out which one it is. So then when I actually want to run <code>answer</code> it can't figure out how to deal with it.</p>\n\n<p>So my question is: is there a way to define a default answer for each type that implements <code>DefaultingQuestion</code></p>\n"}, {"tags": ["haskell", "traversable"], "answers": [{"comments": [{"owner": {"reputation": 22825, "user_id": 992687, "user_type": "registered", "accept_rate": 96, "profile_image": "https://i.stack.imgur.com/0Da71.png?s=128&g=1", "display_name": "The Unfun Cat", "link": "https://stackoverflow.com/users/992687/the-unfun-cat"}, "edited": false, "score": 0, "creation_date": 1458559251, "post_id": 36129569, "comment_id": 59898065, "body": "But how do I write the foldable instance? It expects a <code>b</code> not a <code>List b</code> so I cannot write something like <code>foldr f z (Cons x xs) = Cons (f x z) (foldr f z xs)</code>"}, {"owner": {"reputation": 3040, "user_id": 4308453, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/fc596d8352ad2c4254536343139b5b82?s=128&d=identicon&r=PG&f=1", "display_name": "zakyggaps", "link": "https://stackoverflow.com/users/4308453/zakyggaps"}, "reply_to_user": {"reputation": 22825, "user_id": 992687, "user_type": "registered", "accept_rate": 96, "profile_image": "https://i.stack.imgur.com/0Da71.png?s=128&g=1", "display_name": "The Unfun Cat", "link": "https://stackoverflow.com/users/992687/the-unfun-cat"}, "edited": false, "score": 0, "creation_date": 1458559565, "post_id": 36129569, "comment_id": 59898236, "body": "@TheUnfunCat By <code>foldr f z xs</code> you got a <code>b</code>, combined with <code>x</code> now you have two values of type <code>a</code> and <code>b</code>, if there is some function produces a new <code>b</code> from them...?"}, {"owner": {"reputation": 22825, "user_id": 992687, "user_type": "registered", "accept_rate": 96, "profile_image": "https://i.stack.imgur.com/0Da71.png?s=128&g=1", "display_name": "The Unfun Cat", "link": "https://stackoverflow.com/users/992687/the-unfun-cat"}, "edited": false, "score": 0, "creation_date": 1458560059, "post_id": 36129569, "comment_id": 59898513, "body": "Const is the only one I can think of... There might be some in the class for Applicative or whatevz but I am stumped."}, {"owner": {"reputation": 3040, "user_id": 4308453, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/fc596d8352ad2c4254536343139b5b82?s=128&d=identicon&r=PG&f=1", "display_name": "zakyggaps", "link": "https://stackoverflow.com/users/4308453/zakyggaps"}, "reply_to_user": {"reputation": 22825, "user_id": 992687, "user_type": "registered", "accept_rate": 96, "profile_image": "https://i.stack.imgur.com/0Da71.png?s=128&g=1", "display_name": "The Unfun Cat", "link": "https://stackoverflow.com/users/992687/the-unfun-cat"}, "edited": false, "score": 0, "creation_date": 1458560196, "post_id": 36129569, "comment_id": 59898582, "body": "@TheUnfunCat try look at the type signature of foldr again: <code>(a -&gt; b -&gt; b) -&gt; b -&gt; t a -&gt; b</code>"}, {"owner": {"reputation": 22825, "user_id": 992687, "user_type": "registered", "accept_rate": 96, "profile_image": "https://i.stack.imgur.com/0Da71.png?s=128&g=1", "display_name": "The Unfun Cat", "link": "https://stackoverflow.com/users/992687/the-unfun-cat"}, "edited": false, "score": 3, "creation_date": 1458560636, "post_id": 36129569, "comment_id": 59898858, "body": "Ok, got it: <code>foldr f z (Cons x xs) = f x (foldr f z xs)</code> but do not understand why it worked. Will just follow bitemyapps advice and <code>Don&#39;t sweat the stuff you don&#39;t understand immediately. Keep moving!</code>"}, {"owner": {"reputation": 61419, "user_id": 849891, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/MbEO3.png?s=128&g=1", "display_name": "Will Ness", "link": "https://stackoverflow.com/users/849891/will-ness"}, "reply_to_user": {"reputation": 22825, "user_id": 992687, "user_type": "registered", "accept_rate": 96, "profile_image": "https://i.stack.imgur.com/0Da71.png?s=128&g=1", "display_name": "The Unfun Cat", "link": "https://stackoverflow.com/users/992687/the-unfun-cat"}, "edited": false, "score": 0, "creation_date": 1458565949, "post_id": 36129569, "comment_id": 59902530, "body": "@TheUnfunCat it worked because it is. <code>f :: a -&gt; b -&gt; b</code> means <code>f (x::a) (y::b) :: b</code>. I liked your trick using <code>Nil</code> in Traversable, you should try it with Foldable too: <code>foldr g z Nil = z</code>; <code>foldr g z (Cons x Nil) = z</code> (just for the type) or better <code>= g x z == g x (foldr g z Nil)</code>. Next substitute <code>xs</code> for <code>Nil</code> (their types are the same)..."}], "tags": [], "owner": {"reputation": 3040, "user_id": 4308453, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/fc596d8352ad2c4254536343139b5b82?s=128&d=identicon&r=PG&f=1", "display_name": "zakyggaps", "link": "https://stackoverflow.com/users/4308453/zakyggaps"}, "is_accepted": true, "score": 6, "last_activity_date": 1458559732, "last_edit_date": 1458559732, "creation_date": 1458558912, "answer_id": 36129569, "question_id": 36129373, "link": "https://stackoverflow.com/questions/36129373/why-is-this-instance-of-traversable-for-list-not-correct/36129569#36129569", "title": "Why is this instance of Traversable for list not correct?", "body": "<pre><code>instance Foldable List where\n  foldr f z (Cons x xs) = f x z\n  foldr _ z Nil = z\n</code></pre>\n\n<p>Your Foldable instance doesn't traverse the tail of the list. </p>\n\n<hr>\n\n<p><code>checkers</code> tests your <code>Traversable</code> instances  by testing <code>Functor</code> and <code>Foldable</code> all together: it derives <code>foldMap</code> and <code>fmap</code> from your implementation of <code>Traversable</code> and make sure they produce the same result as <code>foldMap</code> and <code>fmap</code> you defined.</p>\n"}], "owner": {"reputation": 22825, "user_id": 992687, "user_type": "registered", "accept_rate": 96, "profile_image": "https://i.stack.imgur.com/0Da71.png?s=128&g=1", "display_name": "The Unfun Cat", "link": "https://stackoverflow.com/users/992687/the-unfun-cat"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 371, "favorite_count": 2, "accepted_answer_id": 36129569, "answer_count": 1, "score": 5, "last_activity_date": 1458559732, "creation_date": 1458558334, "question_id": 36129373, "link": "https://stackoverflow.com/questions/36129373/why-is-this-instance-of-traversable-for-list-not-correct", "title": "Why is this instance of Traversable for list not correct?", "body": "<p>The below code fails the checkers test for traversable. I'd appreciate an explanation of why it fails, not just how to fix it.</p>\n\n<pre><code>import Test.QuickCheck\nimport Test.QuickCheck.Checkers\nimport Test.QuickCheck.Classes\n\ndata List a =\n  Nil\n  | Cons a (List a)\n    deriving (Show, Eq, Ord)\n\ninstance Functor List where\n  fmap _ Nil = Nil\n  fmap f (Cons x xs) = (Cons (f x) (fmap f xs))\n\ninstance Foldable List where\n  foldr f z (Cons x xs) = f x z\n  foldr _ z Nil = z\n\ninstance Traversable List where\n  traverse f Nil = pure Nil\n  -- traverse f (Cons x Nil) = Cons &lt;$&gt; f x &lt;*&gt; pure Nil\n  traverse f (Cons x xs) = Cons &lt;$&gt; f x &lt;*&gt; (traverse f xs)\n\ninstance Arbitrary a =&gt; Arbitrary (List a) where\n  arbitrary = sized go\n    where go 0 = pure Nil\n          go n = do\n            xs &lt;- go (n - 1)\n            x &lt;- arbitrary\n            return (Cons x xs)\n\ntype TI = List\n\ninstance Eq a =&gt; EqProp (List a) where (=-=) = eq\n\nmain = do\n  let trigger = undefined :: TI (Int, Int, [Int])\n  -- quickBatch (functor trigger)\n  quickBatch (traversable trigger)\n</code></pre>\n\n<p>Here you see that it passes the <code>fmap</code> laws, but not the <code>foldMap</code> ones:</p>\n\n<pre><code>\u03bb&gt; main\n\ntraversable:\n  fmap:    +++ OK, passed 500 tests.\n  foldMap: *** Failed! Falsifiable (after 6 tests): \n&lt;function&gt;\nCons 4 (Cons (-2) (Cons (-5) (Cons 5 (Cons 2 Nil))))\n</code></pre>\n"}, {"tags": ["haskell", "typeclass", "deriving"], "comments": [{"owner": {"reputation": 100185, "user_id": 3234959, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/93bb12ca0f93dfddb33880316f7e66c2?s=128&d=identicon&r=PG&f=1", "display_name": "chi", "link": "https://stackoverflow.com/users/3234959/chi"}, "edited": false, "score": 2, "creation_date": 1458556352, "post_id": 36127504, "comment_id": 59896084, "body": "I&#39;m not sure I understood what you actually want. That instance will work on all <code>c</code>, so you only have to write it once. I don&#39;t think it can be made any shorter, in the general case."}, {"owner": {"reputation": 2231, "user_id": 1027321, "user_type": "registered", "accept_rate": 70, "profile_image": "https://i.stack.imgur.com/KkFZC.jpg?s=128&g=1", "display_name": "jakubdaniel", "link": "https://stackoverflow.com/users/1027321/jakubdaniel"}, "reply_to_user": {"reputation": 100185, "user_id": 3234959, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/93bb12ca0f93dfddb33880316f7e66c2?s=128&d=identicon&r=PG&f=1", "display_name": "chi", "link": "https://stackoverflow.com/users/3234959/chi"}, "edited": false, "score": 0, "creation_date": 1458560791, "post_id": 36127504, "comment_id": 59898968, "body": "But the instance is boring (it just does lifting for all the functions), maybe one could write this concisely (by not having to enumerate all the <code>fooX = lift fooX</code> etc.)"}, {"owner": {"reputation": 100185, "user_id": 3234959, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/93bb12ca0f93dfddb33880316f7e66c2?s=128&d=identicon&r=PG&f=1", "display_name": "chi", "link": "https://stackoverflow.com/users/3234959/chi"}, "edited": false, "score": 1, "creation_date": 1458561072, "post_id": 36127504, "comment_id": 59899143, "body": "I see, but any alternative (e.g. Template Haskell) looks worse, unless you really have a large number of class methods."}, {"owner": {"reputation": 44013, "user_id": 1477667, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/trgKM.jpg?s=128&g=1", "display_name": "dfeuer", "link": "https://stackoverflow.com/users/1477667/dfeuer"}, "edited": false, "score": 1, "creation_date": 1458567539, "post_id": 36127504, "comment_id": 59903740, "body": "And if you have enough class methods to justify Template Haskell for that, you should consider redesigning your class."}, {"owner": {"reputation": 2831, "user_id": 183792, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/9ddcfbc6c31012fd25384f6301363347?s=128&d=identicon&r=PG&f=1", "display_name": "Michael", "link": "https://stackoverflow.com/users/183792/michael"}, "edited": false, "score": 0, "creation_date": 1458588169, "post_id": 36127504, "comment_id": 59918035, "body": "I&#39;m not sure I follow this; are you looking for <code>GeneralizedNewtypeDeriving</code>? <a href=\"https://downloads.haskell.org/~ghc/7.8.4/docs/html/users_guide/deriving.html#newtype-deriving\" rel=\"nofollow noreferrer\">downloads.haskell.org/~ghc/7.8.4/docs/html/users_guide/&hellip;</a>"}], "answers": [{"comments": [{"owner": {"reputation": 44013, "user_id": 1477667, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/trgKM.jpg?s=128&g=1", "display_name": "dfeuer", "link": "https://stackoverflow.com/users/1477667/dfeuer"}, "edited": false, "score": 0, "creation_date": 1458668157, "post_id": 36161051, "comment_id": 59959843, "body": "Writing an instance for the application of a type variable to something is <i>almost never</i> the right approach, so I don&#39;t particularly like it as a suggestion."}, {"owner": {"reputation": 2231, "user_id": 1027321, "user_type": "registered", "accept_rate": 70, "profile_image": "https://i.stack.imgur.com/KkFZC.jpg?s=128&g=1", "display_name": "jakubdaniel", "link": "https://stackoverflow.com/users/1027321/jakubdaniel"}, "edited": false, "score": 0, "creation_date": 1458729374, "post_id": 36161051, "comment_id": 59986981, "body": "I actually need a specific instance for the bottom-most transformer and I would use lifting only in the rest of the transformers."}], "tags": [], "owner": {"reputation": 3016, "user_id": 3190654, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/c321c5241605255cae9ecf3fb2dffc0b?s=128&d=identicon&r=PG", "display_name": "bergey", "link": "https://stackoverflow.com/users/3190654/bergey"}, "is_accepted": false, "score": 1, "last_activity_date": 1458667082, "creation_date": 1458667082, "answer_id": 36161051, "question_id": 36127504, "link": "https://stackoverflow.com/questions/36127504/automatic-haskell-deriving-declaration-that-lifts/36161051#36161051", "title": "Automatic haskell deriving declaration that lifts", "body": "<p>If <code>lift</code> is itself a type class function, you can write a general definition for all instances of the type class.  Something like:</p>\n\n<p><code>instance (Class c, Trans t) =&gt; Class (t c)</code></p>\n\n<p>Be careful that this doesn't overlap with any other instances, and is what you want for all these types.</p>\n\n<p>As a more complete example, this code works, even though it's results are sometimes surprising. </p>\n\n<pre><code>{-# LANGUAGE FlexibleInstances #-}\n\nmodule Inst where\n\nimport Control.Applicative (liftA2)\n\ninstance (Applicative f, Num n) =&gt; Num (f n) where\n  (+) = liftA2 (+)\n  (*) = liftA2 (*)\n  abs = fmap abs\n  signum = fmap signum\n  fromInteger = pure . fromInteger\n  negate = fmap negate\n</code></pre>\n"}], "owner": {"reputation": 2231, "user_id": 1027321, "user_type": "registered", "accept_rate": 70, "profile_image": "https://i.stack.imgur.com/KkFZC.jpg?s=128&g=1", "display_name": "jakubdaniel", "link": "https://stackoverflow.com/users/1027321/jakubdaniel"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 90, "favorite_count": 0, "answer_count": 1, "score": 1, "last_activity_date": 1458667082, "creation_date": 1458553321, "last_edit_date": 1458560967, "question_id": 36127504, "link": "https://stackoverflow.com/questions/36127504/automatic-haskell-deriving-declaration-that-lifts", "title": "Automatic haskell deriving declaration that lifts", "body": "<p>Is there a way to have the compiler derive the functionality that I would write manually as:</p>\n\n<pre><code>instance Class c =&gt; Class (Trans c) where\n    foo1 = lift foo1\n    foo2 = lift foo2\n    ...\n    foo999 = lift foo999\n    bar1 = \\a b c -&gt; lift $ bar1 a b c\n    ...\n    baz1 = lift . baz1\n    ...\n</code></pre>\n\n<p>i.e. when a type of class <code>Class</code> is being wrapped in <code>Trans</code>, is it possible to get a free instance of <code>Class</code> for <code>Trans</code> automatically without having to do the heavy lifting :)?</p>\n"}, {"tags": ["file", "haskell", "io"], "answers": [{"comments": [{"owner": {"reputation": 94713, "user_id": 1139697, "user_type": "registered", "accept_rate": 86, "profile_image": "https://www.gravatar.com/avatar/5f136ddb684f39aaee1c028ee1950f6f?s=128&d=identicon&r=PG", "display_name": "Zeta", "link": "https://stackoverflow.com/users/1139697/zeta"}, "edited": false, "score": 1, "creation_date": 1458543053, "post_id": 36124631, "comment_id": 59888977, "body": "Additional remark: using <code>openFile fileName WriteMode</code> will lead to an error in <code>content &lt;- readFile fileName</code>, since GHC&#39;s runtime only allows either multiple readers or a single writer. Opening the file twice (once for getting the size and reading the content; then for truncating) seems more reasonable."}, {"owner": {"reputation": 25144, "user_id": 477476, "user_type": "registered", "accept_rate": 85, "profile_image": "https://i.stack.imgur.com/Qf4TT.png?s=128&g=1", "display_name": "Cactus", "link": "https://stackoverflow.com/users/477476/cactus"}, "reply_to_user": {"reputation": 94713, "user_id": 1139697, "user_type": "registered", "accept_rate": 86, "profile_image": "https://www.gravatar.com/avatar/5f136ddb684f39aaee1c028ee1950f6f?s=128&d=identicon&r=PG", "display_name": "Zeta", "link": "https://stackoverflow.com/users/1139697/zeta"}, "edited": false, "score": 0, "creation_date": 1458543335, "post_id": 36124631, "comment_id": 59889088, "body": "@Zeta: good point, I&#39;ve updated the answer to show a possible solution that first does the <code>ReadMode</code> operations, then the <code>WriteMode</code> ones."}, {"owner": {"reputation": 25144, "user_id": 477476, "user_type": "registered", "accept_rate": 85, "profile_image": "https://i.stack.imgur.com/Qf4TT.png?s=128&g=1", "display_name": "Cactus", "link": "https://stackoverflow.com/users/477476/cactus"}, "reply_to_user": {"reputation": 94713, "user_id": 1139697, "user_type": "registered", "accept_rate": 86, "profile_image": "https://www.gravatar.com/avatar/5f136ddb684f39aaee1c028ee1950f6f?s=128&d=identicon&r=PG", "display_name": "Zeta", "link": "https://stackoverflow.com/users/1139697/zeta"}, "edited": false, "score": 2, "creation_date": 1458543416, "post_id": 36124631, "comment_id": 59889126, "body": "Also, I&#39;d much rather use some bespoke strict IO functions (like <a href=\"https://hackage.haskell.org/package/strict/docs/System-IO-Strict.html\" rel=\"nofollow noreferrer\">these</a>) to read the file before truncating; the standard IO functions are, unfortunately, lazy."}, {"owner": {"reputation": 13807, "user_id": 2407038, "user_type": "registered", "accept_rate": 64, "profile_image": "https://www.gravatar.com/avatar/538f6f4a9aa43841841de7d8e8b169fc?s=128&d=identicon&r=PG&f=1", "display_name": "user2407038", "link": "https://stackoverflow.com/users/2407038/user2407038"}, "edited": false, "score": 1, "creation_date": 1458543541, "post_id": 36124631, "comment_id": 59889192, "body": "Instead of opening the file twice, you could open with <code>ReadWriteMode</code> (I think). +1 for using <code>withFile</code> instead of a <code>open</code>/<code>close</code> combo."}, {"owner": {"reputation": 25144, "user_id": 477476, "user_type": "registered", "accept_rate": 85, "profile_image": "https://i.stack.imgur.com/Qf4TT.png?s=128&g=1", "display_name": "Cactus", "link": "https://stackoverflow.com/users/477476/cactus"}, "reply_to_user": {"reputation": 13807, "user_id": 2407038, "user_type": "registered", "accept_rate": 64, "profile_image": "https://www.gravatar.com/avatar/538f6f4a9aa43841841de7d8e8b169fc?s=128&d=identicon&r=PG&f=1", "display_name": "user2407038", "link": "https://stackoverflow.com/users/2407038/user2407038"}, "edited": false, "score": 0, "creation_date": 1458543911, "post_id": 36124631, "comment_id": 59889381, "body": "@user2407038: I&#39;m happy to change it to use <code>ReadWriteMode</code> but only if at least one of us actually tries it out :)"}, {"owner": {"reputation": 94713, "user_id": 1139697, "user_type": "registered", "accept_rate": 86, "profile_image": "https://www.gravatar.com/avatar/5f136ddb684f39aaee1c028ee1950f6f?s=128&d=identicon&r=PG", "display_name": "Zeta", "link": "https://stackoverflow.com/users/1139697/zeta"}, "reply_to_user": {"reputation": 13807, "user_id": 2407038, "user_type": "registered", "accept_rate": 64, "profile_image": "https://www.gravatar.com/avatar/538f6f4a9aa43841841de7d8e8b169fc?s=128&d=identicon&r=PG&f=1", "display_name": "user2407038", "link": "https://stackoverflow.com/users/2407038/user2407038"}, "edited": false, "score": 1, "creation_date": 1458544211, "post_id": 36124631, "comment_id": 59889514, "body": "@user2407038 Err, <code>hGetContents</code> will put the handle in a semi-closed state. After all, there&#39;s a reason for <a href=\"http://stackoverflow.com/a/35844504/1139697\">my last poem</a>. *sigh* Although one had to change it for this: <i>Whoopsy daisy, being lazy / tends to make file changes crazy. / Handle is gone / and all along / you ask yourself &quot;what went wrong&quot;? / Don&#39;t yet cry / keep on, try! / All the suffering soon pass by</i>."}], "tags": [], "owner": {"reputation": 25144, "user_id": 477476, "user_type": "registered", "accept_rate": 85, "profile_image": "https://i.stack.imgur.com/Qf4TT.png?s=128&g=1", "display_name": "Cactus", "link": "https://stackoverflow.com/users/477476/cactus"}, "is_accepted": true, "score": 3, "last_activity_date": 1458544652, "last_edit_date": 1458544652, "creation_date": 1458542554, "answer_id": 36124631, "question_id": 36124605, "link": "https://stackoverflow.com/questions/36124605/haskell-hsetfilesize-invalid-argument-invalid-argument/36124631#36124631", "title": "Haskell: hSetFileSize: invalid argument (Invalid argument)", "body": "<p>You are opening the file for reading only; but truncating is a write operation.</p>\n\n<p>What you can do instead is something like</p>\n\n<pre><code>main = do\n    putStrLn \"Enter file name (Including full path) to read\"\n    fileName &lt;- getLine\n\n    sizeBeforeTrunc &lt;- withFile fileName ReadMode $ \\h -&gt; do\n        sizeBeforeTrunc &lt;- hFileSize h\n        content &lt;- hGetContents h\n\n        putStrLn $ \"Size of the file Before truncation is \" ++ (show sizeBeforeTrunc) ++ \" bytes\" \n        putStrLn $ \"Content of the file is \" ++ content\n\n    putStrLn \"**************************************\"\n    let n = sizeBeforeTrunc `div` 2\n    putStrLn $ \"Truncating file to \" ++ (show n) ++ \" bytes\"\n\n    sizeAfterTrunc &lt;- withFile fileName WriteMode $ \\h -&gt; do       \n        info1 &lt;- hSetFileSize h (toInteger 10)\n        putStrLn $ show info1\n        hFileSize h\n\n    putStrLn $ \"Size of the file After truncation is \" ++ (show sizeAfterTrunc) ++ \" bytes\" \n    putStrLn $ \"Content of the file is \" ++ content            \n</code></pre>\n"}, {"tags": [], "owner": {"reputation": 94713, "user_id": 1139697, "user_type": "registered", "accept_rate": 86, "profile_image": "https://www.gravatar.com/avatar/5f136ddb684f39aaee1c028ee1950f6f?s=128&d=identicon&r=PG", "display_name": "Zeta", "link": "https://stackoverflow.com/users/1139697/zeta"}, "is_accepted": false, "score": 2, "last_activity_date": 1458547643, "creation_date": 1458547643, "answer_id": 36125818, "question_id": 36124605, "link": "https://stackoverflow.com/questions/36124605/haskell-hsetfilesize-invalid-argument-invalid-argument/36125818#36125818", "title": "Haskell: hSetFileSize: invalid argument (Invalid argument)", "body": "<p><sup>Note: This answer is written in literate Haskell. Save it with <code>.lhs</code> as extension and try it in GHCi or compile it.</sup></p>\n\n<pre><code>&gt; import System.IO\n</code></pre>\n\n<p>Changing a file isn't a read-only operation. You need to open the file for writing. However, this will lead to problems, since you may only have either a single writer or multiple readers. Since you use <code>readFile</code> your opening the file for reading, so you cannot simply change the open mode.</p>\n\n<p>It gets easier if we refactor your code. We can immediately see two violations of don't-repeat-yourself, namely getting the size and telling the content. So let's fix that:</p>\n\n<pre><code>&gt; putAndCount :: FileName -&gt; String -&gt; IO Int\n&gt; putAndCount fn msg = withFile fn ReadMode $ \\handle -&gt; do\n&gt;     size    &lt;- hFileSize handle\n&gt;     content &lt;- hGetContents handle\n&gt;     putStrLn $ \"Size of the file \" ++ msg ++ \" is \" ++ show size ++ \" bytes\"\n&gt;     putStrLn $ \"Content of the file is \" ++ content\n&gt;     return size\n</code></pre>\n\n<p><code>withFile</code> makes sure that our handle is closed and cannot screw with further actions. Now let's write another function to change the size of a file without using a handle:</p>\n\n<pre><code>&gt; setFileSize :: FileName -&gt; Integer -&gt; IO ()\n&gt; setFileSize fn s = withFile fn ReadWriteMode $ \\handle -&gt; \n&gt;     hSetFileSize handle s\n</code></pre>\n\n<p>It's important to use <code>ReadWriteMode</code> and <strong>not</strong> <code>WriteMode</code> here, since <code>WriteMode</code> will truncate the file to zero bytes! That's the same behavior as in C's <code>fopen</code>, by the way.</p>\n\n<p>Now we have all tools necessary to complete the task:</p>\n\n<pre><code>&gt; main :: IO ()\n&gt; main = do\n&gt;     putStrLn \"Enter file name (Including full path) to read\"\n&gt;     fileName &lt;- getLine\n&gt;\n&gt;     sizeBeforeTrunc &lt;- putAndCount fileName \"Before truncation\"    \n&gt;     putStrLn \"**************************************\"\n&gt; \n&gt;     let n = sizeBeforeTrunc `div` 2\n&gt;     putStrLn $ \"Truncating file to \" ++ (show n) ++ \" bytes\"    \n&gt;     setFileSize fileName n\n&gt;     putAndCount fileName \"After truncation\"\n</code></pre>\n"}], "owner": {"reputation": 2579, "user_id": 3302424, "user_type": "registered", "accept_rate": 70, "profile_image": "https://www.gravatar.com/avatar/70d64f2369ad3cfd0d9271792bdccf3c?s=128&d=identicon&r=PG&f=1", "display_name": "Hari Krishna", "link": "https://stackoverflow.com/users/3302424/hari-krishna"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 282, "favorite_count": 1, "accepted_answer_id": 36124631, "answer_count": 2, "score": 1, "last_activity_date": 1458547643, "creation_date": 1458542385, "last_edit_date": 1458543293, "question_id": 36124605, "link": "https://stackoverflow.com/questions/36124605/haskell-hsetfilesize-invalid-argument-invalid-argument", "title": "Haskell: hSetFileSize: invalid argument (Invalid argument)", "body": "<p>Can some body help me what is wrong with my program. When i tried to run following program, I am getting the following error message:</p>\n\n<blockquote>\n  <p><code>hSetFileSize</code>: invalid argument (Invalid argument)</p>\n</blockquote>\n\n<pre><code>import System.IO\n\nmain = do\n    putStrLn \"Enter file name (Including full path) to read\"\n    fileName &lt;- getLine\n\n    handle &lt;- openFile fileName ReadMode\n    sizeBeforeTrunc &lt;- hFileSize handle\n    content &lt;- readFile fileName \n\n    putStrLn $ \"Size of the file Before truncation is \" ++ (show sizeBeforeTrunc) ++ \" bytes\" \n    putStrLn $ \"Content of the file is \" ++ content\n\n    putStrLn \"**************************************\"\n    let n = sizeBeforeTrunc `div` 2\n    putStrLn $ \"Truncating file to \" ++ (show n) ++ \" bytes\"\n\n    info1 &lt;- hSetFileSize handle (toInteger 10)\n    putStrLn $ show info1\n    sizeAfterTrunc &lt;- hFileSize handle\n\n    putStrLn $ \"Size of the file After truncation is \" ++ (show sizeAfterTrunc) ++ \" bytes\" \n    putStrLn $ \"Content of the file is \" ++ content        \n\n    hClose handle\n</code></pre>\n"}, {"tags": ["haskell"], "answers": [{"tags": [], "owner": {"reputation": 49501, "user_id": 784338, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/ae195ac7c8a5e9002a808544572cc5fc?s=128&d=identicon&r=PG", "display_name": "Daniel Gratzer", "link": "https://stackoverflow.com/users/784338/daniel-gratzer"}, "is_accepted": false, "score": 4, "last_activity_date": 1458534648, "creation_date": 1458534648, "answer_id": 36123188, "question_id": 36123100, "link": "https://stackoverflow.com/questions/36123100/creating-a-function-to-mix-elements-from-two-lists/36123188#36123188", "title": "Creating a function to mix elements from two lists", "body": "<p>One simple option would be to write a simple recursive function to process the two lists into one. This function needs 3 possible cases</p>\n\n<ol>\n<li><p>The first list is empty, so we just return the second straightaway as there's no further mixing to be done.</p>\n\n<pre><code>mixLists [] ys = ys\n</code></pre></li>\n<li><p>The second list could also be empty and as we might expect, in this case we just return the first list, whatever it may be</p>\n\n<pre><code>mixLists xs [] = xs\n</code></pre></li>\n<li><p>Now if we've made it past those two clauses, we know that neither <code>xs</code> nor <code>ys</code> are empty, so we only need to explain what to do if both are nonempty</p>\n\n<pre><code>mixLists (x : xs) (y : ys) = ?\n</code></pre>\n\n<p>Now we want to create a new list which starts with <code>x</code> followed by <code>y</code> because we're mixing together two lists, one of which starts with <code>x</code> and the other, <code>y</code>.</p>\n\n<pre><code>mixLists (x : xs) (y : ys) = x : y : ?\n</code></pre>\n\n<p>Now we have to figure out what the rest of this outputted list should be. Our specification presumably says it ought to contain <code>xs</code> and <code>ys</code> mixed and we can easily calculate that using a recursive call</p>\n\n<pre><code>mixLists (x : xs) (y : ys) = x : y : mixLists xs ys\n</code></pre></li>\n</ol>\n"}, {"comments": [{"owner": {"reputation": 49501, "user_id": 784338, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/ae195ac7c8a5e9002a808544572cc5fc?s=128&d=identicon&r=PG", "display_name": "Daniel Gratzer", "link": "https://stackoverflow.com/users/784338/daniel-gratzer"}, "edited": false, "score": 1, "creation_date": 1458537330, "post_id": 36123441, "comment_id": 59886905, "body": "I thought this would be kind of nice too but it doesn&#39;t work: this drops elements after they stop being equal because of <code>zipWith</code>."}, {"owner": {"reputation": 11780, "user_id": 2827654, "user_type": "registered", "accept_rate": 57, "profile_image": "https://www.gravatar.com/avatar/a171742e9c31a541d4d2031af932e94a?s=128&d=identicon&r=PG&f=1", "display_name": "jamshidh", "link": "https://stackoverflow.com/users/2827654/jamshidh"}, "reply_to_user": {"reputation": 49501, "user_id": 784338, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/ae195ac7c8a5e9002a808544572cc5fc?s=128&d=identicon&r=PG", "display_name": "Daniel Gratzer", "link": "https://stackoverflow.com/users/784338/daniel-gratzer"}, "edited": false, "score": 1, "creation_date": 1458538052, "post_id": 36123441, "comment_id": 59887144, "body": "@jozefg Oops, you are correct....  I missed that point.  I almost removed my answer, but instead I&#39;ll just point out the limitation in the answer, because I am sure others will have the same thought...."}, {"owner": {"reputation": 13807, "user_id": 2407038, "user_type": "registered", "accept_rate": 64, "profile_image": "https://www.gravatar.com/avatar/538f6f4a9aa43841841de7d8e8b169fc?s=128&d=identicon&r=PG&f=1", "display_name": "user2407038", "link": "https://stackoverflow.com/users/2407038/user2407038"}, "edited": false, "score": 1, "creation_date": 1458538742, "post_id": 36123441, "comment_id": 59887367, "body": "If you&#39;re a fan of hideous one liners, how about <code>fix $ \\k xs ys -&gt; maybe ys id $ flip (:) (k ys (drop 1 xs)) `fmap` listToMaybe xs</code>"}], "tags": [], "owner": {"reputation": 11780, "user_id": 2827654, "user_type": "registered", "accept_rate": 57, "profile_image": "https://www.gravatar.com/avatar/a171742e9c31a541d4d2031af932e94a?s=128&d=identicon&r=PG&f=1", "display_name": "jamshidh", "link": "https://stackoverflow.com/users/2827654/jamshidh"}, "is_accepted": false, "score": 2, "last_activity_date": 1458538130, "last_edit_date": 1458538130, "creation_date": 1458536343, "answer_id": 36123441, "question_id": 36123100, "link": "https://stackoverflow.com/questions/36123100/creating-a-function-to-mix-elements-from-two-lists/36123441#36123441", "title": "Creating a function to mix elements from two lists", "body": "<p>If you can live with the limitation that the lists need be the same length, you can solve this with a one liner....</p>\n\n<pre><code>mixLists = concat . zipWith ((. return) . (:))\n</code></pre>\n\n<p>It might be an interesting exercise to figure out how this works....  Hint- the function in zipWith can also be written as <code>\\x y -&gt; [x, y]</code>.</p>\n"}], "owner": {"reputation": 5, "user_id": 6091689, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/892fa07f98663357a1d9dce6606a45eb?s=128&d=identicon&r=PG&f=1", "display_name": "bobby1212", "link": "https://stackoverflow.com/users/6091689/bobby1212"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 105, "favorite_count": 0, "answer_count": 2, "score": -2, "last_activity_date": 1458538130, "creation_date": 1458534142, "question_id": 36123100, "link": "https://stackoverflow.com/questions/36123100/creating-a-function-to-mix-elements-from-two-lists", "title": "Creating a function to mix elements from two lists", "body": "<p>How would I go about writing a function to mix two lists as such:</p>\n\n<pre><code>mixLists :: [a] -&gt;  [a] -&gt; [a]\n\nmixLists  [1,2,3] [4,6,8,2] = [1,4,2,6,3,8,2]\n</code></pre>\n"}, {"tags": ["haskell", "monads"], "answers": [{"tags": [], "owner": {"reputation": 41209, "user_id": 485115, "user_type": "registered", "accept_rate": 87, "profile_image": "https://www.gravatar.com/avatar/59693d66b96ca17ca9d2fdb2393e2be3?s=128&d=identicon&r=PG", "display_name": "Nikita Volkov", "link": "https://stackoverflow.com/users/485115/nikita-volkov"}, "is_accepted": false, "score": 2, "last_activity_date": 1458531824, "creation_date": 1458531824, "answer_id": 36122798, "question_id": 36122731, "link": "https://stackoverflow.com/questions/36122731/monadic-parsing-of-binary-data-in-haskell/36122798#36122798", "title": "Monadic parsing of binary data in Haskell", "body": "<p>This is exactly the purpose of the Monad interface: to encode the dependency of a computation on the result of a preceding computation.</p>\n\n<p>In your case it'll be something like the following:</p>\n\n<pre><code>parseAll = do\n  shouldThePayloadABeParsed &lt;- parseHeader\n  if shouldThePayloadABeParsed\n    then do\n      pa &lt;- parsePayloadA\n      ...\n    else do\n      pb &lt;- parsePayloadB\n      ...\n</code></pre>\n\n<p>For your purposes I recommend reading the <a href=\"http://nikita-volkov.github.io/a-taste-of-state-parsers-are-easy/\" rel=\"nofollow\">\"Taste of State: Parsers are Easy\"</a> post to get an understanding of how this kind of parsing works in Haskell, and the <a href=\"http://hackage.haskell.org/package/binary-parser\" rel=\"nofollow\">\"binary-parser\"</a> package to do the parsing.</p>\n"}, {"comments": [{"owner": {"reputation": 111, "user_id": 6091550, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/673693960db305ee6cfe4680c6f2c334?s=128&d=identicon&r=PG&f=1", "display_name": "liu3tao", "link": "https://stackoverflow.com/users/6091550/liu3tao"}, "edited": false, "score": 0, "creation_date": 1458535582, "post_id": 36122805, "comment_id": 59886383, "body": "Thanks. What would be the type of &quot;payload&quot; in this case?"}, {"owner": {"reputation": 25144, "user_id": 477476, "user_type": "registered", "accept_rate": 85, "profile_image": "https://i.stack.imgur.com/Qf4TT.png?s=128&g=1", "display_name": "Cactus", "link": "https://stackoverflow.com/users/477476/cactus"}, "reply_to_user": {"reputation": 111, "user_id": 6091550, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/673693960db305ee6cfe4680c6f2c334?s=128&d=identicon&r=PG&f=1", "display_name": "liu3tao", "link": "https://stackoverflow.com/users/6091550/liu3tao"}, "edited": false, "score": 0, "creation_date": 1458538729, "post_id": 36122805, "comment_id": 59887359, "body": "This is assuming you have two possible payloads, with <code>data Payload = PayloadA A | PayloadB B</code>"}], "tags": [], "owner": {"reputation": 25144, "user_id": 477476, "user_type": "registered", "accept_rate": 85, "profile_image": "https://i.stack.imgur.com/Qf4TT.png?s=128&g=1", "display_name": "Cactus", "link": "https://stackoverflow.com/users/477476/cactus"}, "is_accepted": true, "score": 3, "last_activity_date": 1458531852, "creation_date": 1458531852, "answer_id": 36122805, "question_id": 36122731, "link": "https://stackoverflow.com/questions/36122731/monadic-parsing-of-binary-data-in-haskell/36122805#36122805", "title": "Monadic parsing of binary data in Haskell", "body": "<p>Note that <code>parseAll</code> uses some kind of <strong>monadic</strong> parser library (as can be seen from the usage of the <code>do</code> notation and the binds). The power of monads is exactly that your choice of <code>parsePayloadA</code> and <code>parsePayloadB</code> can depend on <code>hdr</code>: you have the full power of Haskell to inspect <code>hdr</code>.</p>\n\n<p>So basically you can do something like</p>\n\n<pre><code>parseAll = do\n    hdr &lt;- parseHeader\n    payload &lt;- case somethingInTheHdr hdr of\n       ThisIsAnA -&gt; do\n         a &lt;- parsePayloadA\n         return (PayloadA a)\n       ThisIsAB -&gt; do\n         b &lt;- parsePayloadB\n         return (PayloadB b)\n    -- can use body here, e.g.\n    return (Packet hdr payload)\n</code></pre>\n\n<p>You have this power specifically because in the type of monadic bind:</p>\n\n<pre><code>(&gt;&gt;=) :: m a -&gt; (a -&gt; m b) -&gt; m b\n</code></pre>\n\n<p>the arrow in <code>a -&gt; m b</code> is the real Haskell function arrow, giving you all the power you need.</p>\n"}], "owner": {"reputation": 111, "user_id": 6091550, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/673693960db305ee6cfe4680c6f2c334?s=128&d=identicon&r=PG&f=1", "display_name": "liu3tao", "link": "https://stackoverflow.com/users/6091550/liu3tao"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 221, "favorite_count": 2, "accepted_answer_id": 36122805, "answer_count": 2, "score": 5, "last_activity_date": 1458531852, "creation_date": 1458531273, "last_edit_date": 1495542227, "question_id": 36122731, "link": "https://stackoverflow.com/questions/36122731/monadic-parsing-of-binary-data-in-haskell", "title": "Monadic parsing of binary data in Haskell", "body": "<p>I am pretty new to Haskell, and my first project is to parse captured WLAN packets. A common pattern in parsing such packet is that a header field will define the structure of the remaining bytes. As a generic example, a packet can be formatted like this:</p>\n\n<pre><code>header + [payload A | payload B | ..] \n</code></pre>\n\n<p>where a flag field (can be a bitmap) in the header specifies what payload(s) are included in the packet. For a specific example of this format, please check out <a href=\"http://www.radiotap.org/\" rel=\"nofollow noreferrer\">radiotap</a>.</p>\n\n<p><a href=\"https://stackoverflow.com/questions/5517620/haskell-binary-parsing\">A similar thread</a> suggests to just use a sequence of <code>parse</code> operations like this:</p>\n\n<pre><code>parseAll = do\n    hdr &lt;- parseHeader\n    pa &lt;- parsePayloadA\n    pb &lt;- parsePayloadB\n</code></pre>\n\n<p>However it seems cannot be applied in my case as the existence of payload <code>A</code> and <code>B</code> is defined by the header. In other word, the control flow of data parsing needs to follow a prior parsing result. I'd like to understand that if there is a generic way to parse binary data with this kind of pattern?</p>\n"}, {"tags": ["haskell", "printf", "type-inference"], "answers": [{"comments": [{"owner": {"reputation": 13807, "user_id": 2407038, "user_type": "registered", "accept_rate": 64, "profile_image": "https://www.gravatar.com/avatar/538f6f4a9aa43841841de7d8e8b169fc?s=128&d=identicon&r=PG&f=1", "display_name": "user2407038", "link": "https://stackoverflow.com/users/2407038/user2407038"}, "edited": false, "score": 1, "creation_date": 1458530710, "post_id": 36122571, "comment_id": 59885207, "body": "It should be noted that if you turn on <code>-Wall</code>, the compiler will warn you when defaulting occurs in a (possible very complex) expression, so that code where defaulting is applicable will no longer &quot;magically&quot; work only sometimes."}, {"owner": {"reputation": 97, "user_id": 5963064, "user_type": "registered", "accept_rate": 0, "profile_image": "https://lh4.googleusercontent.com/-pVWjCTSF0V8/AAAAAAAAAAI/AAAAAAAAAA8/xN5naka53n4/photo.jpg?sz=128", "display_name": "user5963064", "link": "https://stackoverflow.com/users/5963064/user5963064"}, "edited": false, "score": 0, "creation_date": 1458549886, "post_id": 36122571, "comment_id": 59892043, "body": "Thank you for answering. Can I think it as that every variable should be prescribed with a concrete type when haskell itself can&#39;t infer a concrete type( just infer some typeclass constraint)."}, {"owner": {"reputation": 25144, "user_id": 477476, "user_type": "registered", "accept_rate": 85, "profile_image": "https://i.stack.imgur.com/Qf4TT.png?s=128&g=1", "display_name": "Cactus", "link": "https://stackoverflow.com/users/477476/cactus"}, "edited": false, "score": 0, "creation_date": 1458552370, "post_id": 36122571, "comment_id": 59893444, "body": "Not necessarily. If you have the type of the variable &quot;escaping&quot; the definition, then it&#39;s OK to have leftover constraints; e.g. <code>foo x = (show x, show x)</code> is perfectly valid and type-able at <code>(Show a) =&gt; a -&gt; (String, String)</code>, since the type variable <code>a</code> occurs in its type, and so it can be &quot;someone else&#39;s problem&quot;."}], "tags": [], "owner": {"reputation": 25144, "user_id": 477476, "user_type": "registered", "accept_rate": 85, "profile_image": "https://i.stack.imgur.com/Qf4TT.png?s=128&g=1", "display_name": "Cactus", "link": "https://stackoverflow.com/users/477476/cactus"}, "is_accepted": false, "score": 5, "last_activity_date": 1458530425, "last_edit_date": 1495535287, "creation_date": 1458530061, "answer_id": 36122571, "question_id": 36122534, "link": "https://stackoverflow.com/questions/36122534/type-annotation-required-on-overloaded-literals-when-passed-to-printf/36122571#36122571", "title": "Type annotation required on overloaded literals when passed to printf", "body": "<p>Because Haskell is not a dependently typed language, the <strong>value</strong> of <code>printf</code>'s first argument (i.e. <code>\"%f\"</code> in your case) has no way of prescribing the <strong>type</strong> of <code>printf</code>'s second argument (<code>2.3</code> in your case). </p>\n\n<p>On its own, <code>2.3</code>'s type is <code>Fractional a =&gt; a</code> because it is an <a href=\"https://www.haskell.org/tutorial/numbers.html\" rel=\"nofollow noreferrer\">overloaded literal</a>. <a href=\"https://hackage.haskell.org/package/base-4.8.2.0/docs/Text-Printf.html\" rel=\"nofollow noreferrer\"><code>printf</code>'s type</a> might look a bit magic, in that it is very polymorphic so that e.g. <code>printf \"%s\" \"foo\"</code> and <code>printf \"%f\" 2.3</code> can both typecheck. This is achieved via the <a href=\"https://hackage.haskell.org/package/base-4.8.2.0/docs/Text-Printf.html#t:PrintfType\" rel=\"nofollow noreferrer\"><code>PrintfType</code></a> and <a href=\"https://hackage.haskell.org/package/base-4.8.2.0/docs/Text-Printf.html#t:PrintfArg\" rel=\"nofollow noreferrer\"><code>PrintfArg</code></a> typeclasses.</p>\n\n<p>All in all, in <code>printf \"%f\" 2.3</code>, the type checker only knows that <code>2.3</code> is some type <code>a</code> that has both a <code>Fractional</code> and a <code>PrintfArg</code> instance; but it doesn't know what <code>a</code> actually needs to be. And it needs one type so that the <code>Fractional</code> and <code>PrintfArg</code> instances can be resolved.</p>\n\n<p>This situation is somewhat similar to the <a href=\"https://stackoverflow.com/a/12486494/477476\"><code>show . read</code></a> problem, and your example works in GHCi because of <code>Num</code> <a href=\"https://www.haskell.org/onlinereport/decls.html#sect4.3.4\" rel=\"nofollow noreferrer\">defaulting</a> to <code>Double</code>.</p>\n"}], "owner": {"reputation": 97, "user_id": 5963064, "user_type": "registered", "accept_rate": 0, "profile_image": "https://lh4.googleusercontent.com/-pVWjCTSF0V8/AAAAAAAAAAI/AAAAAAAAAA8/xN5naka53n4/photo.jpg?sz=128", "display_name": "user5963064", "link": "https://stackoverflow.com/users/5963064/user5963064"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 89, "favorite_count": 0, "answer_count": 1, "score": 0, "last_activity_date": 1458530425, "creation_date": 1458529652, "last_edit_date": 1458530275, "question_id": 36122534, "link": "https://stackoverflow.com/questions/36122534/type-annotation-required-on-overloaded-literals-when-passed-to-printf", "title": "Type annotation required on overloaded literals when passed to printf", "body": "<p>I'm confused with these:</p>\n\n<p>When I write like this</p>\n\n<pre><code>main = do\n    putStrLn . printf \"%f\" $ 2.3\n</code></pre>\n\n<p>It will cause</p>\n\n<blockquote>\n  <p>No instance for <code>(PrintfArg a0)</code> arising from a use of <code>printf</code></p>\n  \n  <p>The type variable <code>a0</code> is ambiguous</p>\n</blockquote>\n\n<p>The code works well in GHCi, this error happened when I use <code>runhaskell</code> in a terminal.</p>\n\n<p>So I write </p>\n\n<pre><code>putStrLn . printf \"%f\" $ (2.3 :: Double)\n</code></pre>\n\n<p>It's Ok, but I don't know the reason. </p>\n\n<p>Don't <code>\"%f\"</code> infer <code>2.3</code> belongs to type <code>Double</code>? </p>\n\n<p>As far I know, <code>putStrLn</code> has the type <code>String -&gt; IO()</code>, can't <code>printf</code>'s result be converted to <code>String</code> when <code>2.3</code> is not decorated by <code>Double</code>? </p>\n"}, {"tags": ["haskell"], "answers": [{"tags": [], "owner": {"reputation": 37486, "user_id": 371753, "user_type": "registered", "accept_rate": 83, "profile_image": "https://i.stack.imgur.com/znFEK.jpg?s=128&g=1", "display_name": "sclv", "link": "https://stackoverflow.com/users/371753/sclv"}, "is_accepted": false, "score": 5, "last_activity_date": 1458529271, "creation_date": 1458529271, "answer_id": 36122479, "question_id": 36122441, "link": "https://stackoverflow.com/questions/36122441/splitting-after-nth-value/36122479#36122479", "title": "Splitting after nth value", "body": "<p>The function you want is <code>splitAt</code>.</p>\n\n<p>You can find it on <a href=\"https://www.haskell.org/hoogle\">hoogle</a>, by just typing the desired type into the search box. <a href=\"https://www.haskell.org/hoogle/?hoogle=Int%20-%3E%20%5Bx%5D%20-%3E%20%28%5Bx%5D%2C%5Bx%5D%29\">First result!</a></p>\n"}], "owner": {"reputation": 19, "user_id": 6090252, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/1e6da38872756d66a841686347581582?s=128&d=identicon&r=PG&f=1", "display_name": "benjy1911", "link": "https://stackoverflow.com/users/6090252/benjy1911"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 56, "favorite_count": 0, "answer_count": 1, "score": 0, "last_activity_date": 1458529271, "creation_date": 1458529025, "last_edit_date": 1458529130, "question_id": 36122441, "link": "https://stackoverflow.com/questions/36122441/splitting-after-nth-value", "title": "Splitting after nth value", "body": "<p>How would I write a function to split values after a certain value, for example</p>\n\n<pre><code>seperate :: Int -&gt; [x] -&gt; ([x],[x])\nseperate 3 [1,4,6,9,1,2,5,7] = ([1,4,6],[9,1,2,5,7])\n</code></pre>\n"}, {"tags": ["unit-testing", "haskell", "haskell-stack"], "comments": [{"owner": {"reputation": 94713, "user_id": 1139697, "user_type": "registered", "accept_rate": 86, "profile_image": "https://www.gravatar.com/avatar/5f136ddb684f39aaee1c028ee1950f6f?s=128&d=identicon&r=PG", "display_name": "Zeta", "link": "https://stackoverflow.com/users/1139697/zeta"}, "edited": false, "score": 2, "creation_date": 1458544014, "post_id": 36121438, "comment_id": 59889415, "body": "Hm, cannot reproduce with a variant that doesn&#39;t use hspec-discover and Stack 1.0.4. That being said, which shell do you use? Also, have you tried to colorize the output manually with <code>--test-arguments &quot;--color&quot;</code>?"}, {"owner": {"reputation": 2207, "user_id": 575152, "user_type": "registered", "accept_rate": 87, "profile_image": "https://www.gravatar.com/avatar/5e0170ce985a52a6af02b95baa38e1ae?s=128&d=identicon&r=PG", "display_name": "Savanni D&#39;Gerinel", "link": "https://stackoverflow.com/users/575152/savanni-dgerinel"}, "reply_to_user": {"reputation": 94713, "user_id": 1139697, "user_type": "registered", "accept_rate": 86, "profile_image": "https://www.gravatar.com/avatar/5f136ddb684f39aaee1c028ee1950f6f?s=128&d=identicon&r=PG", "display_name": "Zeta", "link": "https://stackoverflow.com/users/1139697/zeta"}, "edited": false, "score": 0, "creation_date": 1458575314, "post_id": 36121438, "comment_id": 59909655, "body": "That&#39;s interesting. <code>stack test --test-arguments &quot;--color&quot;</code> works. This will help, but it leaves me mystified about how my current project is different from others."}], "answers": [{"comments": [{"owner": {"reputation": 2207, "user_id": 575152, "user_type": "registered", "accept_rate": 87, "profile_image": "https://www.gravatar.com/avatar/5e0170ce985a52a6af02b95baa38e1ae?s=128&d=identicon&r=PG", "display_name": "Savanni D&#39;Gerinel", "link": "https://stackoverflow.com/users/575152/savanni-dgerinel"}, "edited": false, "score": 0, "creation_date": 1458617980, "post_id": 36137203, "comment_id": 59929203, "body": "Well, that&#39;s not it. The terminal is set to <code>xterm-256color</code>. If I go to another project in the same terminal, <code>stack test</code> displays colors exactly as I expect. The difference is that the working project runs stack resolver 3.15 and the broken project runs stack resolver 5.3"}, {"owner": {"reputation": 94713, "user_id": 1139697, "user_type": "registered", "accept_rate": 86, "profile_image": "https://www.gravatar.com/avatar/5f136ddb684f39aaee1c028ee1950f6f?s=128&d=identicon&r=PG", "display_name": "Zeta", "link": "https://stackoverflow.com/users/1139697/zeta"}, "reply_to_user": {"reputation": 2207, "user_id": 575152, "user_type": "registered", "accept_rate": 87, "profile_image": "https://www.gravatar.com/avatar/5e0170ce985a52a6af02b95baa38e1ae?s=128&d=identicon&r=PG", "display_name": "Savanni D&#39;Gerinel", "link": "https://stackoverflow.com/users/575152/savanni-dgerinel"}, "edited": false, "score": 0, "creation_date": 1458625319, "post_id": 36137203, "comment_id": 59931407, "body": "@SavanniD&#39;Gerinel again, I cannot reproduce that behavior. Can you provide a <a href=\"https://stackoverflow.com/help/minimal-reproducible-example\">minimal reproducible example</a>?"}, {"owner": {"reputation": 564, "user_id": 3637541, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/c455e355de061d57d5a2cabf3649eddb?s=128&d=identicon&r=PG&f=1", "display_name": "user3637541", "link": "https://stackoverflow.com/users/3637541/user3637541"}, "edited": false, "score": 0, "creation_date": 1483469004, "post_id": 36137203, "comment_id": 70106953, "body": "This produces colored output indeed, but i whoud like it to be the default when i call stack test. Do you know a way to (maybe put it somehow in the stack.yaml) to archive this? I tried       <code>build:           test-arguments: [&quot;--color&quot;]</code> but it did not work"}], "tags": [], "owner": {"reputation": 94713, "user_id": 1139697, "user_type": "registered", "accept_rate": 86, "profile_image": "https://www.gravatar.com/avatar/5f136ddb684f39aaee1c028ee1950f6f?s=128&d=identicon&r=PG", "display_name": "Zeta", "link": "https://stackoverflow.com/users/1139697/zeta"}, "is_accepted": false, "score": 4, "last_activity_date": 1458579346, "creation_date": 1458579346, "answer_id": 36137203, "question_id": 36121438, "link": "https://stackoverflow.com/questions/36121438/when-using-stack-test-my-hspec-tests-output-is-not-colorized/36137203#36137203", "title": "When using &quot;stack test&quot;, my hspec tests output is not colorized", "body": "<p>By default, hspec will only use colors when the output is shown on <a href=\"https://hackage.haskell.org/package/base-4.8.2.0/docs/System-IO.html#v:hIsTerminalDevice\" rel=\"nofollow\">a terminal</a> and when the environment variable <code>TERM</code> is not <code>\"dumb\"</code> (or isn't set). Unless you set an environment variable to <code>\"dumb\"</code>, it's likely that there is something going on with the terminal detection.</p>\n\n<p>Either way, <code>stack build</code> enables you to use arguments for test suites with <code>--test-arguments</code>, and <code>hspec</code> interprets several command line arguments, including <code>--color</code> and <code>--no-color</code> which overwrite the default behaviour. Therefore, you can force the colors:</p>\n\n<pre class=\"lang-bash prettyprint-override\"><code>stack test --file-watch --test-arguments \"--color\"\n</code></pre>\n"}, {"tags": [], "owner": {"reputation": 681, "user_id": 1072240, "user_type": "registered", "accept_rate": 80, "profile_image": "https://www.gravatar.com/avatar/1ef5bf598c44bbfa8b87fd77ccf2a993?s=128&d=identicon&r=PG", "display_name": "Jason Whittle", "link": "https://stackoverflow.com/users/1072240/jason-whittle"}, "is_accepted": false, "score": 1, "last_activity_date": 1483478367, "last_edit_date": 1483478367, "creation_date": 1483398269, "answer_id": 41434296, "question_id": 36121438, "link": "https://stackoverflow.com/questions/36121438/when-using-stack-test-my-hspec-tests-output-is-not-colorized/41434296#41434296", "title": "When using &quot;stack test&quot;, my hspec tests output is not colorized", "body": "<p>Stack uses the behavior you are seeing when you give it more than one package to test at a time. Typically, this happens because you have more than one location listed in the packages stanza of your <code>stack.yaml</code> file. </p>\n\n<p>Recent versions of stack mention the following in the auto-generated <code>stack.yaml</code> file: </p>\n\n<pre><code># A package marked 'extra-dep: true' will only be built if demanded by a\n# non-dependency (i.e. a user package), and its test suites and benchmarks\n# will not be run. This is useful for tweaking upstream packages.\n</code></pre>\n\n<p>If you mark all but one location in the packages stanza as an <code>extra-dep</code>, stack will revert to its single-package behavior when testing, and show your colorized test results as you expect. </p>\n"}], "owner": {"reputation": 2207, "user_id": 575152, "user_type": "registered", "accept_rate": 87, "profile_image": "https://www.gravatar.com/avatar/5e0170ce985a52a6af02b95baa38e1ae?s=128&d=identicon&r=PG", "display_name": "Savanni D&#39;Gerinel", "link": "https://stackoverflow.com/users/575152/savanni-dgerinel"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 727, "favorite_count": 1, "answer_count": 2, "score": 6, "last_activity_date": 1483478367, "creation_date": 1458520572, "question_id": 36121438, "link": "https://stackoverflow.com/questions/36121438/when-using-stack-test-my-hspec-tests-output-is-not-colorized", "title": "When using &quot;stack test&quot;, my hspec tests output is not colorized", "body": "<p>This is an infuriating thing since I have built Hspec-based test suites in which colors all behave normally. But on this project, I cannot get colors to appear when I run all of the test suites at once.</p>\n\n<p>My project.cabal is set up like this:</p>\n\n<pre><code>test-suite unit\n  type:               exitcode-stdio-1.0\n  main-is:            SpecMain.hs\n  hs-source-dirs:     tests/unit\n  other-modules:      WikiSpec\n  default-language:   Haskell2010\n  ghc-options:        -Wall -fno-warn-orphans -threaded\n  build-depends:      base                    &gt;=4.6\n  ...\n\ntest-suite integration\n  type:               exitcode-stdio-1.0\n  main-is:            SpecMain.hs\n  hs-source-dirs:     tests/integration, webapp\n  other-modules:      ApiSpec\n  default-language:   Haskell2010\n  ghc-options:        -Wall -fno-warn-orphans -threaded\n  build-depends:      base                    &gt;=4.6\n  ...\n</code></pre>\n\n<p>And then my SpecMain.hs files (identical) contain this:</p>\n\n<pre><code>{-# OPTIONS_GHC -F -pgmF hspec-discover #-}\n</code></pre>\n\n<p>So, when I run <code>stack test</code>, all of my tests run, but the output is not colorized.  If I run <code>stack build --file-watch --test</code>, the tests run, but if there is any failure at all then all of the output is colored red. Finally, if I run <code>stack test weblog:unit</code> or <code>stack test weblog:integration</code>, then the colors end up exactly as they should be. Headers are white, passing tests are green, failing tests are red, and pending tests are yellow.</p>\n\n<p>When I'm doing active development I tend to depend on <code>stack build --file-watch --test</code>, but I really need the colors to be right.</p>\n\n<p>Have any of you any idea what is going on, how I can fix this, or what additional information I need to provide?</p>\n"}, {"tags": ["haskell"], "answers": [{"comments": [{"owner": {"reputation": 11780, "user_id": 2827654, "user_type": "registered", "accept_rate": 57, "profile_image": "https://www.gravatar.com/avatar/a171742e9c31a541d4d2031af932e94a?s=128&d=identicon&r=PG&f=1", "display_name": "jamshidh", "link": "https://stackoverflow.com/users/2827654/jamshidh"}, "edited": false, "score": 1, "creation_date": 1458519781, "post_id": 36121328, "comment_id": 59882838, "body": "And of course, you can always use directly on code as (&quot;const&quot; ++)"}, {"owner": {"reputation": 2683, "user_id": 4522420, "user_type": "registered", "accept_rate": 75, "profile_image": "https://i.stack.imgur.com/RhUFJ.jpg?s=128&g=1", "display_name": "Blake Lockley", "link": "https://stackoverflow.com/users/4522420/blake-lockley"}, "reply_to_user": {"reputation": 11780, "user_id": 2827654, "user_type": "registered", "accept_rate": 57, "profile_image": "https://www.gravatar.com/avatar/a171742e9c31a541d4d2031af932e94a?s=128&d=identicon&r=PG&f=1", "display_name": "jamshidh", "link": "https://stackoverflow.com/users/2827654/jamshidh"}, "edited": false, "score": 0, "creation_date": 1458520024, "post_id": 36121328, "comment_id": 59882917, "body": "@jamshidh of course! added it to the answer, thanks mate"}], "tags": [], "owner": {"reputation": 2683, "user_id": 4522420, "user_type": "registered", "accept_rate": 75, "profile_image": "https://i.stack.imgur.com/RhUFJ.jpg?s=128&g=1", "display_name": "Blake Lockley", "link": "https://stackoverflow.com/users/4522420/blake-lockley"}, "is_accepted": true, "score": 11, "last_activity_date": 1458611857, "last_edit_date": 1458611857, "creation_date": 1458519640, "answer_id": 36121328, "question_id": 36121311, "link": "https://stackoverflow.com/questions/36121311/how-to-simplify-string-concatenation-in-haskell/36121328#36121328", "title": "How to simplify string concatenation in Haskell?", "body": "<p>The magic of currying:    </p>\n\n<pre><code>myF :: String -&gt; String\nmyF = (++) \"const\"\n</code></pre>\n\n<p>or (as mentioned by @jamshidh)</p>\n\n<pre><code>myF :: String -&gt; String\nmyF = (\"const\" ++)\n</code></pre>\n\n<p><strong>Explanation</strong></p>\n\n<p>We say (++) is a function takes two arguments but really all functions in Haskell take only one argument. Lets look at the signature for the (++) function:</p>\n\n<pre><code>(++) :: String -&gt; String -&gt; String\n</code></pre>\n\n<p>We can describe (++) or \"the concatenation\" function as acting like so:</p>\n\n<blockquote>\n  <p>\"Take one string and return a function that takes another string\n  concatenates (joins together) the two strings and return that string\"</p>\n</blockquote>\n\n<p>So when we say <code>myF = (++) \"const\"</code> we are assigning the resulting function from applying the first string to (++) function to <code>myF</code> function. This is known as <strong>\"Partial Application\"</strong>.</p>\n\n<p>Notice we don't need to include an argument at the end of function like this but this is still perfectly fine:</p>\n\n<pre><code>myF arg = \"const\" ++ arg\n</code></pre>\n\n<p>We can leave out the \"arg\" because from the partially applied \"concat\" function we already know that we are expecting one more string argument.</p>\n"}], "owner": {"user_type": "does_not_exist", "display_name": "user266003"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 17272, "favorite_count": 0, "accepted_answer_id": 36121328, "answer_count": 1, "score": 2, "last_activity_date": 1458611857, "creation_date": 1458519503, "last_edit_date": 1458522381, "question_id": 36121311, "link": "https://stackoverflow.com/questions/36121311/how-to-simplify-string-concatenation-in-haskell", "title": "How to simplify string concatenation in Haskell?", "body": "<p>I have this function:</p>\n\n<pre><code>myF :: String -&gt; String\nmyF arg1 = \"const\" ++ arg1\n</code></pre>\n\n<p>Is there any way to simplify it? I think it might have to do with the operator \".\" but I can't figure out how to apply it here.</p>\n"}, {"tags": ["haskell", "types"], "answers": [{"comments": [{"owner": {"reputation": 1799, "user_id": 1137713, "user_type": "registered", "accept_rate": 60, "profile_image": "https://i.stack.imgur.com/iuRcY.jpg?s=128&g=1", "display_name": "iHowell", "link": "https://stackoverflow.com/users/1137713/ihowell"}, "edited": false, "score": 0, "creation_date": 1458516690, "post_id": 36120919, "comment_id": 59882058, "body": "Oh, thank you! I forgot that I needed to use head there. You are a life saver!"}], "tags": [], "owner": {"reputation": 62252, "user_id": 1435869, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/TrEd9.jpg?s=128&g=1", "display_name": "karakfa", "link": "https://stackoverflow.com/users/1435869/karakfa"}, "is_accepted": false, "score": 2, "last_activity_date": 1458516558, "creation_date": 1458516558, "answer_id": 36120919, "question_id": 36120858, "link": "https://stackoverflow.com/questions/36120858/couldnt-match-expected-type-char-b0-with-actual-type-char/36120919#36120919", "title": "Couldn&#39;t match expected type &#39;([Char], b0)&#39; with actual type &#39;[[Char]]&#39;", "body": "<p><code>fst</code> and <code>snd</code> are defined for 2-tuples, here your argument is a list <code>[[Char]]</code>.</p>\n"}, {"tags": [], "owner": {"reputation": 28488, "user_id": 402884, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35583fe46c2cde92467710cc7ceff266?s=128&d=identicon&r=PG", "display_name": "Chris Martin", "link": "https://stackoverflow.com/users/402884/chris-martin"}, "is_accepted": true, "score": 5, "last_activity_date": 1458525082, "last_edit_date": 1458525082, "creation_date": 1458516624, "answer_id": 36120933, "question_id": 36120858, "link": "https://stackoverflow.com/questions/36120858/couldnt-match-expected-type-char-b0-with-actual-type-char/36120933#36120933", "title": "Couldn&#39;t match expected type &#39;([Char], b0)&#39; with actual type &#39;[[Char]]&#39;", "body": "<p><code>fst</code> wants a tuple, but you gave it a list.</p>\n\n<p>The type of <code>fst</code> is:</p>\n\n<pre><code>fst :: (a, b) -&gt; a\n</code></pre>\n\n<p>The first line of the error message</p>\n\n<pre><code>Couldn't match expected type `([Char], b0)'\n</code></pre>\n\n<p>says the expected type for the argument in your call to <code>fst</code> is <code>([Char], b0)</code>. The <code>[Char]</code> bit is inferred from context, and <code>b0</code> just means it doesn't care what that second type is (because <code>fst</code> just discards the second tuple element).</p>\n\n<p>The second line of the error message</p>\n\n<pre><code>with actual type `[[Char]]'\n</code></pre>\n\n<p>says you passed it a <code>[[Char]]</code> instead, because... well, that's what you've done.</p>\n\n<p>Perhaps what you meant instead of <code>fst</code> is <code>head</code>, which gives the first element of a list.</p>\n"}], "owner": {"reputation": 1799, "user_id": 1137713, "user_type": "registered", "accept_rate": 60, "profile_image": "https://i.stack.imgur.com/iuRcY.jpg?s=128&g=1", "display_name": "iHowell", "link": "https://stackoverflow.com/users/1137713/ihowell"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 138, "favorite_count": 0, "accepted_answer_id": 36120933, "answer_count": 2, "score": -1, "last_activity_date": 1458525082, "creation_date": 1458516085, "question_id": 36120858, "link": "https://stackoverflow.com/questions/36120858/couldnt-match-expected-type-char-b0-with-actual-type-char", "title": "Couldn&#39;t match expected type &#39;([Char], b0)&#39; with actual type &#39;[[Char]]&#39;", "body": "<p>first time working with haskell and I keep running into this issue:</p>\n\n<pre><code>Couldn't match expected type `([Char], b0)'\n        with actual type `[[Char]]'\nIn the first argument of `fst', namely `moves'\nIn the second argument of `rotatedMaze', namely `(fst moves)'\n</code></pre>\n\n<p>I can't quite figure out what is going on. Where is my parameter error?</p>\n\n<pre><code>manyPlayersManyRotations :: [[Char]] -&gt; [[Char]] -&gt; [[Char]]\nmanyPlayersManyRotations maze moves = \n    if null moves\n        then maze\n        else  \n            let     \n                rmaze = rotatedMaze maze (fst moves)\n                drop1 = dropPlayer rmaze '1'\n                opor1 = (fst drop1, snd drop1)\n                drop2 = dropPlayer (fst opor1) '2'\n                opor2 = (fst drop2, snd opor2 || snd drop2)\n                drop3 = dropPlayer (fst opor2) '3'\n                opor3 = (fst drop3, snd opor2 || snd drop3)\n                drop4 = dropPlayer (fst opor3) '4'\n                opor4 = (fst drop4, snd opor2 || snd drop4)\n            in \n                if (not)(snd opor4)\n                    then fst opor4\n                    else manyPlayersManyRotations (fst opor4) (tail moves)\n\nrotatedMaze :: [[Char]] -&gt; [Char] -&gt; [[Char]]\nrotatedMaze maze move = \n    if move == ['c']\n        then rc maze\n        else if move == ['c','c']\n                then rcc maze\n                    else r180 maze\n</code></pre>\n"}, {"tags": ["string", "haskell", "replace"], "comments": [{"owner": {"reputation": 13807, "user_id": 2407038, "user_type": "registered", "accept_rate": 64, "profile_image": "https://www.gravatar.com/avatar/538f6f4a9aa43841841de7d8e8b169fc?s=128&d=identicon&r=PG&f=1", "display_name": "user2407038", "link": "https://stackoverflow.com/users/2407038/user2407038"}, "edited": false, "score": 1, "creation_date": 1458517253, "post_id": 36120855, "comment_id": 59882192, "body": "You haven&#39;t given <code>concatMap</code> enough arguments - the rhs of <code>replaceFun</code> (also note the lowercase) should have type <code>String</code> but <code>concatMap (\\str -&gt; if str == &#39;.&#39; then &quot;foo&quot; else [str])</code> has type <code>String -&gt; String</code>. You probably want <code>replaceFun = concatMap (\\str -&gt; if str == &#39;.&#39; then &quot;foo&quot; else [str])</code>"}], "answers": [{"comments": [{"owner": {"reputation": 111, "user_id": 2457584, "user_type": "registered", "accept_rate": 20, "profile_image": "https://www.gravatar.com/avatar/c3f5e5b51ea70afc69b82f2c76214aff?s=128&d=identicon&r=PG", "display_name": "2D3D4D", "link": "https://stackoverflow.com/users/2457584/2d3d4d"}, "edited": false, "score": 0, "creation_date": 1458516516, "post_id": 36120883, "comment_id": 59882013, "body": "Can you define this as a function please? I can&#39;t get it working."}, {"owner": {"reputation": 111, "user_id": 2457584, "user_type": "registered", "accept_rate": 20, "profile_image": "https://www.gravatar.com/avatar/c3f5e5b51ea70afc69b82f2c76214aff?s=128&d=identicon&r=PG", "display_name": "2D3D4D", "link": "https://stackoverflow.com/users/2457584/2d3d4d"}, "edited": false, "score": 0, "creation_date": 1458516804, "post_id": 36120883, "comment_id": 59882081, "body": "I did it like this, but doesn&#39;t work: replaceFun w :: String -&gt; String  replaceFun w = do concatMap (\\x -&gt; if x == &#39;.&#39; then &quot;foo&quot; else [x])"}, {"owner": {"reputation": 111, "user_id": 2457584, "user_type": "registered", "accept_rate": 20, "profile_image": "https://www.gravatar.com/avatar/c3f5e5b51ea70afc69b82f2c76214aff?s=128&d=identicon&r=PG", "display_name": "2D3D4D", "link": "https://stackoverflow.com/users/2457584/2d3d4d"}, "edited": false, "score": 0, "creation_date": 1458517014, "post_id": 36120883, "comment_id": 59882136, "body": "can you have a look at the updated part of the question?"}, {"owner": {"reputation": 3409, "user_id": 3105485, "user_type": "registered", "accept_rate": 76, "profile_image": "https://www.gravatar.com/avatar/b4c41125ff9c7b20ca07d0845e7af7ae?s=128&d=identicon&r=PG&f=1", "display_name": "Caridorc", "link": "https://stackoverflow.com/users/3105485/caridorc"}, "reply_to_user": {"reputation": 111, "user_id": 2457584, "user_type": "registered", "accept_rate": 20, "profile_image": "https://www.gravatar.com/avatar/c3f5e5b51ea70afc69b82f2c76214aff?s=128&d=identicon&r=PG", "display_name": "2D3D4D", "link": "https://stackoverflow.com/users/2457584/2d3d4d"}, "edited": false, "score": 0, "creation_date": 1497972448, "post_id": 36120883, "comment_id": 76299752, "body": "@2D3D4D <code>f = concatMap (\\x -&gt; if x == &#39;.&#39; then &quot;foo&quot; else [x])</code>  or more generally <code>f a b s = concatMap (\\x -&gt; if x == a then b else [x]) s</code>"}], "tags": [], "owner": {"reputation": 3409, "user_id": 3105485, "user_type": "registered", "accept_rate": 76, "profile_image": "https://www.gravatar.com/avatar/b4c41125ff9c7b20ca07d0845e7af7ae?s=128&d=identicon&r=PG&f=1", "display_name": "Caridorc", "link": "https://stackoverflow.com/users/3105485/caridorc"}, "is_accepted": false, "score": 5, "last_activity_date": 1458516313, "creation_date": 1458516313, "answer_id": 36120883, "question_id": 36120855, "link": "https://stackoverflow.com/questions/36120855/haskell-string-replace/36120883#36120883", "title": "Haskell string replace", "body": "<p>Just use <code>concatMap</code>    </p>\n\n<pre><code>Prelude&gt; concatMap (\\x -&gt; if x == '.' then \"foo\" else [x]) \"example...\"\n\"examplefoofoofoo\"\n</code></pre>\n"}, {"comments": [{"owner": {"reputation": 111, "user_id": 2457584, "user_type": "registered", "accept_rate": 20, "profile_image": "https://www.gravatar.com/avatar/c3f5e5b51ea70afc69b82f2c76214aff?s=128&d=identicon&r=PG", "display_name": "2D3D4D", "link": "https://stackoverflow.com/users/2457584/2d3d4d"}, "edited": false, "score": 0, "creation_date": 1458517920, "post_id": 36121036, "comment_id": 59882357, "body": "Thanks @rampion, just realized something, I wanted to use this to pretty print a tree. But all nodes will end up in the same indentation. I wanted to increase the indenting for each nested node. Is that easily possible?"}, {"owner": {"reputation": 81794, "user_id": 9859, "user_type": "registered", "accept_rate": 89, "profile_image": "https://i.stack.imgur.com/KEZOL.jpg?s=128&g=1", "display_name": "rampion", "link": "https://stackoverflow.com/users/9859/rampion"}, "reply_to_user": {"reputation": 111, "user_id": 2457584, "user_type": "registered", "accept_rate": 20, "profile_image": "https://www.gravatar.com/avatar/c3f5e5b51ea70afc69b82f2c76214aff?s=128&d=identicon&r=PG", "display_name": "2D3D4D", "link": "https://stackoverflow.com/users/2457584/2d3d4d"}, "edited": false, "score": 1, "creation_date": 1458518253, "post_id": 36121036, "comment_id": 59882430, "body": "Sure! look at one of the early versions. What if <code>replace2</code> took another argument, <code>n</code>, for how many tabs to insert after it replaced a &#39;(&#39; with a newline? Now the recursive call takes two arguments - the rest of the string and the number of tabs. What would you give the recursive call if (a) <code>x</code> wasn&#39;t a parenthesis, (b) it was an open paren, or (c) it was a close paren?"}, {"owner": {"reputation": 111, "user_id": 2457584, "user_type": "registered", "accept_rate": 20, "profile_image": "https://www.gravatar.com/avatar/c3f5e5b51ea70afc69b82f2c76214aff?s=128&d=identicon&r=PG", "display_name": "2D3D4D", "link": "https://stackoverflow.com/users/2457584/2d3d4d"}, "edited": false, "score": 0, "creation_date": 1458518720, "post_id": 36121036, "comment_id": 59882546, "body": "If it was not a parenthesis, then no replacement needed. If an open parenthesis, then we replace \\n and \\t (for each level of nested). Close parenthesis can be replaced by empty string I think."}, {"owner": {"reputation": 111, "user_id": 2457584, "user_type": "registered", "accept_rate": 20, "profile_image": "https://www.gravatar.com/avatar/c3f5e5b51ea70afc69b82f2c76214aff?s=128&d=identicon&r=PG", "display_name": "2D3D4D", "link": "https://stackoverflow.com/users/2457584/2d3d4d"}, "edited": false, "score": 0, "creation_date": 1458518781, "post_id": 36121036, "comment_id": 59882556, "body": "I tried to do it, but with no luck. I have experience with C, and this is my first attempt with Haskell, can you add this change to your code as well please?"}, {"owner": {"reputation": 81794, "user_id": 9859, "user_type": "registered", "accept_rate": 89, "profile_image": "https://i.stack.imgur.com/KEZOL.jpg?s=128&g=1", "display_name": "rampion", "link": "https://stackoverflow.com/users/9859/rampion"}, "reply_to_user": {"reputation": 111, "user_id": 2457584, "user_type": "registered", "accept_rate": 20, "profile_image": "https://www.gravatar.com/avatar/c3f5e5b51ea70afc69b82f2c76214aff?s=128&d=identicon&r=PG", "display_name": "2D3D4D", "link": "https://stackoverflow.com/users/2457584/2d3d4d"}, "edited": false, "score": 1, "creation_date": 1458519395, "post_id": 36121036, "comment_id": 59882732, "body": "Show me how far you got following my questions above! Did you define a new <code>replace</code> function that took two arguments, <code>xs</code> and <code>n</code>?"}, {"owner": {"reputation": 111, "user_id": 2457584, "user_type": "registered", "accept_rate": 20, "profile_image": "https://www.gravatar.com/avatar/c3f5e5b51ea70afc69b82f2c76214aff?s=128&d=identicon&r=PG", "display_name": "2D3D4D", "link": "https://stackoverflow.com/users/2457584/2d3d4d"}, "edited": false, "score": 0, "creation_date": 1458519885, "post_id": 36121036, "comment_id": 59882879, "body": "please have a look at the function i added at the bottom of the question."}, {"owner": {"reputation": 81794, "user_id": 9859, "user_type": "registered", "accept_rate": 89, "profile_image": "https://i.stack.imgur.com/KEZOL.jpg?s=128&g=1", "display_name": "rampion", "link": "https://stackoverflow.com/users/9859/rampion"}, "reply_to_user": {"reputation": 111, "user_id": 2457584, "user_type": "registered", "accept_rate": 20, "profile_image": "https://www.gravatar.com/avatar/c3f5e5b51ea70afc69b82f2c76214aff?s=128&d=identicon&r=PG", "display_name": "2D3D4D", "link": "https://stackoverflow.com/users/2457584/2d3d4d"}, "edited": false, "score": 1, "creation_date": 1458520177, "post_id": 36121036, "comment_id": 59882959, "body": "2D3D4D: good start! now consider what you want &quot;a(a(a(a(&quot; to look like, and walk through your implementation using that as the input. See if you get what you want. See what goes wrong."}, {"owner": {"reputation": 111, "user_id": 2457584, "user_type": "registered", "accept_rate": 20, "profile_image": "https://www.gravatar.com/avatar/c3f5e5b51ea70afc69b82f2c76214aff?s=128&d=identicon&r=PG", "display_name": "2D3D4D", "link": "https://stackoverflow.com/users/2457584/2d3d4d"}, "edited": false, "score": 0, "creation_date": 1458520637, "post_id": 36121036, "comment_id": 59883076, "body": "so for every &quot;(&quot; I am adding a &quot;\\n&quot; and increasing the number of &quot;\\t&quot;, and for every &quot;)&quot;, I am adding a &quot;\\n&quot; and decreasing the number of &quot;\\t&quot;. I have changed the function, can you have a look? Now, logically I know how this should be done. But in Haskell, I get errors."}, {"owner": {"reputation": 111, "user_id": 2457584, "user_type": "registered", "accept_rate": 20, "profile_image": "https://www.gravatar.com/avatar/c3f5e5b51ea70afc69b82f2c76214aff?s=128&d=identicon&r=PG", "display_name": "2D3D4D", "link": "https://stackoverflow.com/users/2457584/2d3d4d"}, "edited": false, "score": 0, "creation_date": 1458521079, "post_id": 36121036, "comment_id": 59883191, "body": "This is the error that I get using the code I added at the bottom of the question: Expecting one more argument to \u2018[]\u2019     Expected a type, but \u2018[]\u2019 has kind \u2018* -&gt; *\u2019     In the type signature for \u2018replace2\u2019: replace2 :: [] -&gt; Int -&gt; []"}, {"owner": {"reputation": 111, "user_id": 2457584, "user_type": "registered", "accept_rate": 20, "profile_image": "https://www.gravatar.com/avatar/c3f5e5b51ea70afc69b82f2c76214aff?s=128&d=identicon&r=PG", "display_name": "2D3D4D", "link": "https://stackoverflow.com/users/2457584/2d3d4d"}, "edited": false, "score": 0, "creation_date": 1458522210, "post_id": 36121036, "comment_id": 59883438, "body": "Can&#39;t figure out why it doesn&#39;t accept the second argument."}, {"owner": {"reputation": 111, "user_id": 2457584, "user_type": "registered", "accept_rate": 20, "profile_image": "https://www.gravatar.com/avatar/c3f5e5b51ea70afc69b82f2c76214aff?s=128&d=identicon&r=PG", "display_name": "2D3D4D", "link": "https://stackoverflow.com/users/2457584/2d3d4d"}, "edited": false, "score": 0, "creation_date": 1458522724, "post_id": 36121036, "comment_id": 59883558, "body": "how can I repeat a charater, like (n * &#39;\\t&#39;), repeating &#39;\\t&#39; n times?"}, {"owner": {"reputation": 81794, "user_id": 9859, "user_type": "registered", "accept_rate": 89, "profile_image": "https://i.stack.imgur.com/KEZOL.jpg?s=128&g=1", "display_name": "rampion", "link": "https://stackoverflow.com/users/9859/rampion"}, "reply_to_user": {"reputation": 111, "user_id": 2457584, "user_type": "registered", "accept_rate": 20, "profile_image": "https://www.gravatar.com/avatar/c3f5e5b51ea70afc69b82f2c76214aff?s=128&d=identicon&r=PG", "display_name": "2D3D4D", "link": "https://stackoverflow.com/users/2457584/2d3d4d"}, "edited": false, "score": 0, "creation_date": 1458523691, "post_id": 36121036, "comment_id": 59883727, "body": "2D3D4D: You&#39;re <a href=\"https://www.haskell.org/hoogle/?hoogle=Int+-%3E+a+-%3E+%5Ba%5D\" rel=\"nofollow noreferrer\">looking for <code>replicate</code></a>"}, {"owner": {"reputation": 111, "user_id": 2457584, "user_type": "registered", "accept_rate": 20, "profile_image": "https://www.gravatar.com/avatar/c3f5e5b51ea70afc69b82f2c76214aff?s=128&d=identicon&r=PG", "display_name": "2D3D4D", "link": "https://stackoverflow.com/users/2457584/2d3d4d"}, "edited": false, "score": 0, "creation_date": 1458523705, "post_id": 36121036, "comment_id": 59883730, "body": "I got it working except it never ends. So I need to check at the begining to see if it is null?"}, {"owner": {"reputation": 81794, "user_id": 9859, "user_type": "registered", "accept_rate": 89, "profile_image": "https://i.stack.imgur.com/KEZOL.jpg?s=128&g=1", "display_name": "rampion", "link": "https://stackoverflow.com/users/9859/rampion"}, "reply_to_user": {"reputation": 111, "user_id": 2457584, "user_type": "registered", "accept_rate": 20, "profile_image": "https://www.gravatar.com/avatar/c3f5e5b51ea70afc69b82f2c76214aff?s=128&d=identicon&r=PG", "display_name": "2D3D4D", "link": "https://stackoverflow.com/users/2457584/2d3d4d"}, "edited": false, "score": 0, "creation_date": 1458523751, "post_id": 36121036, "comment_id": 59883747, "body": "Yup, just like in your original version."}], "tags": [], "owner": {"reputation": 81794, "user_id": 9859, "user_type": "registered", "accept_rate": 89, "profile_image": "https://i.stack.imgur.com/KEZOL.jpg?s=128&g=1", "display_name": "rampion", "link": "https://stackoverflow.com/users/9859/rampion"}, "is_accepted": false, "score": 2, "last_activity_date": 1458517410, "creation_date": 1458517410, "answer_id": 36121036, "question_id": 36120855, "link": "https://stackoverflow.com/questions/36120855/haskell-string-replace/36121036#36121036", "title": "Haskell string replace", "body": "<p>expanding your example, you can substitute \"\\n\\t\\t\" for \"(\" by just prepending multiple things to the result of the recursive call</p>\n\n<pre><code>replace1 [] = []\nreplace1 (x:xs) =\n   if x == '('\n   then '\\n' : '\\t' : '\\t' : replace1 xs\n   else x : replace1 xs\n</code></pre>\n\n<p>of course, this is equivalent to using <code>\"\\n\\t\\t\" ++</code></p>\n\n<pre><code>replace2 [] = []\nreplace2 (x:xs) =\n   if x == '('\n   then \"\\n\\t\\t\" ++ replace2 xs\n   else x : replace2 xs\n</code></pre>\n\n<p>if we note that <code>x :</code> is equivalent to <code>[x] ++</code></p>\n\n<pre><code>replace3 [] = []\nreplace3 (x:xs) =\n   if x == '('\n   then \"\\n\\t\\t\" ++ replace3 xs\n   else [x] ++ replace3 xs\n</code></pre>\n\n<p>then we can factor out the repeated recursive call</p>\n\n<pre><code>replace4 [] = []\nreplace4 (x:xs) = (if x == '(' then \"\\n\\t\\t\" else [x]) ++ replace4 xs\n</code></pre>\n\n<p>then for clarity, we could filter out the <code>if</code> statement into a function:</p>\n\n<pre><code>replace5 [] = []\nreplace5 (x:xs) = f x ++ replace5 xs\n  where f x = if x == '(' \n              then \"\\n\\t\\t\" \n              else [x]\n</code></pre>\n\n<p>we could then reorganize our code - rather than alternately applying <code>f</code> to each <code>x</code> and \nappending it to our results, we could apply <code>f</code> to all the <code>xs</code> and then concatenate all the results:</p>\n\n<pre><code>replace6 xs = concat $ map f xs\n  where f x = if x == '(' \n              then \"\\n\\t\\t\" \n              else [x]\n</code></pre>\n\n<p>But <code>concat $ map f xs</code> is used so often that it has another name:</p>\n\n<pre><code>replace7 xs = concatMap f xs\n  where f x = if x == '(' \n              then \"\\n\\t\\t\" \n              else [x]\n</code></pre>\n\n<p>Actually, it has another one too, because <code>[]</code> is a monad:</p>\n\n<pre><code>replace8 xs = xs &gt;&gt;= f\n  where f x = if x == '(' \n              then \"\\n\\t\\t\" \n              else [x]\n</code></pre>\n\n<p>But if we're doing that, we might as well go full Monad:</p>\n\n<pre><code>replace9 xs = do\n  x &lt;- xs\n  if x == '(' \n     then \"\\n\\t\\t\" \n     else [x]\n</code></pre>\n\n<p>But I'd probably just stop at <code>replace7</code>, personally.</p>\n"}], "owner": {"reputation": 111, "user_id": 2457584, "user_type": "registered", "accept_rate": 20, "profile_image": "https://www.gravatar.com/avatar/c3f5e5b51ea70afc69b82f2c76214aff?s=128&d=identicon&r=PG", "display_name": "2D3D4D", "link": "https://stackoverflow.com/users/2457584/2d3d4d"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 860, "favorite_count": 1, "answer_count": 2, "score": 0, "last_activity_date": 1458523646, "creation_date": 1458516070, "last_edit_date": 1458523646, "question_id": 36120855, "link": "https://stackoverflow.com/questions/36120855/haskell-string-replace", "title": "Haskell string replace", "body": "<p>How do I replace a character with multiple characters in a string.\nI can replace a character with another character with below:</p>\n\n<pre><code>  replaceO [] = []\n  replaceO (x:xs) =\n     if x == '('\n     then '\\n' : replaceO xs\n     else x : replaceO xs\n</code></pre>\n\n<p>But I want to replace '(' with \"\\n\\t\\t\", not just '\\n'.</p>\n\n<p>---------- UPDATE --------------\nBased on the answer below, can I make that a function that accepts a string and returns a string like this:</p>\n\n<pre><code>ReplaceFun str :: String -&gt; String\nReplaceFun str = do\n    concatMap (\\str -&gt; if str == '.' then \"foo\" else [str])\n</code></pre>\n\n<p>This doesn't work, can someone point out my mistake? I am very new to Haskell.</p>\n\n<p>Here is what I have for nested indentation:</p>\n\n<pre><code>replaceO (x:xs) n l =\n    if x == '('\n    then \"\\n\" ++ (showTabs n \"-\") ++ replaceO xs (n + 1) 'l'\n    else\n        if x == ')'\n        then \"\\n\" ++ (showTabs n \"-\") ++ replaceO xs (n - 1) 'l'\n        else x : replaceO xs n 'l'\n</code></pre>\n"}, {"tags": ["haskell", "binary-tree", "definition"], "answers": [{"tags": [], "owner": {"reputation": 5171, "user_id": 2718186, "user_type": "registered", "accept_rate": 87, "profile_image": "https://www.gravatar.com/avatar/ca44ca18bf615e74f930d28a89d01508?s=128&d=identicon&r=PG", "display_name": "MicroVirus", "link": "https://stackoverflow.com/users/2718186/microvirus"}, "is_accepted": true, "score": 3, "last_activity_date": 1458516597, "creation_date": 1458516597, "answer_id": 36120926, "question_id": 36120767, "link": "https://stackoverflow.com/questions/36120767/haskell-defining-a-tree/36120926#36120926", "title": "Haskell defining a tree", "body": "<p>Keep in mind that to construct an instance of the data type you need to call one of its constructor functions. All these constructors, <code>ND</code>, <code>Data</code>, <code>Branch</code>, are just regular functions, so you should call them as such.</p>\n\n<p>In your <code>tree</code>, you are mixing data types (<code>Btree</code>) with constructors, while you should only be using constructors. Also, keep in mind that the function call (the 'space operator' is left-associated) is very greedy, so <code>Branch ND Data 1</code> calls the function <code>Branch</code> with 3 arguments, rather than what you want: <code>Branch ND (Data 1)</code>.</p>\n\n<p>So to create your tree of depth 2 considering the above you write:</p>\n\n<pre><code>tree = Branch (Branch ND (Data 1)) (Branch ND (Branch ND ND))\n</code></pre>\n"}, {"tags": [], "owner": {"reputation": 62252, "user_id": 1435869, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/TrEd9.jpg?s=128&g=1", "display_name": "karakfa", "link": "https://stackoverflow.com/users/1435869/karakfa"}, "is_accepted": false, "score": 2, "last_activity_date": 1458517377, "creation_date": 1458517377, "answer_id": 36121029, "question_id": 36120767, "link": "https://stackoverflow.com/questions/36120767/haskell-defining-a-tree/36121029#36121029", "title": "Haskell defining a tree", "body": "<p>Note that <code>Data 1</code> will be a Btree as well without any additional baggage</p>\n\n<pre><code>Prelude&gt; :t (Data 1)\n(Data 1) :: Num a =&gt; Btree a\n</code></pre>\n\n<p>if you want a simple branch with a right element only you can write</p>\n\n<pre><code>Branch ND (Data 1)\n</code></pre>\n\n<p>or two level deep as in the other answer.  At this point convenient constructor functions will be handy to minimize noise and typing.</p>\n"}], "owner": {"reputation": 103, "user_id": 5905842, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/72a475cb0ae5799b68eaf7006bf00c1b?s=128&d=identicon&r=PG&f=1", "display_name": "something", "link": "https://stackoverflow.com/users/5905842/something"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 65, "favorite_count": 0, "accepted_answer_id": 36120926, "answer_count": 2, "score": 0, "last_activity_date": 1458517377, "creation_date": 1458515372, "question_id": 36120767, "link": "https://stackoverflow.com/questions/36120767/haskell-defining-a-tree", "title": "Haskell defining a tree", "body": "<p>In haskell I can do things such as </p>\n\n<pre><code>a :: Int\na = 15\n</code></pre>\n\n<p>I have the datatype as below</p>\n\n<pre><code>data Btree a = ND | Data a |  Branch (Btree a) (Btree a) deriving (Show, Eq)\n</code></pre>\n\n<p>How can I define a tree, not using a function, such as above.</p>\n\n<p>I have tried;</p>\n\n<pre><code>tree :: BTree\ntree = Branch Btree (Branch ND Data 1) (Branch ND (Branch ND ND))\n</code></pre>\n\n<p>I cannot seem to get it to work (I am new to haskell so if this is very basic I apologise in advance)</p>\n"}, {"tags": ["haskell", "yaml", "config"], "comments": [{"owner": {"reputation": 11780, "user_id": 2827654, "user_type": "registered", "accept_rate": 57, "profile_image": "https://www.gravatar.com/avatar/a171742e9c31a541d4d2031af932e94a?s=128&d=identicon&r=PG&f=1", "display_name": "jamshidh", "link": "https://stackoverflow.com/users/2827654/jamshidh"}, "edited": false, "score": 1, "creation_date": 1458519702, "post_id": 36120473, "comment_id": 59882816, "body": "Presumably you already have implemented <code>FromJSON</code>, <code>ToJSON</code>, else you would have gotten a compile time error.  Getting <code>Nothing</code> implies the yaml isn&#39;t in the format expected.  Why don&#39;t you try to produce yaml from a known Haskell item, to see what it expects?"}], "answers": [{"tags": [], "owner": {"reputation": 37486, "user_id": 371753, "user_type": "registered", "accept_rate": 83, "profile_image": "https://i.stack.imgur.com/znFEK.jpg?s=128&g=1", "display_name": "sclv", "link": "https://stackoverflow.com/users/371753/sclv"}, "is_accepted": true, "score": 0, "last_activity_date": 1458545287, "last_edit_date": 1458545287, "creation_date": 1458524651, "answer_id": 36121906, "question_id": 36120473, "link": "https://stackoverflow.com/questions/36120473/cant-decode-data-from-a-yml-file/36121906#36121906", "title": "Can&#39;t decode data from a yml file", "body": "<blockquote>\n  <p>Should I necessarily create a data from <code>some_value</code> and implement <code>FromJSON</code> and <code>ToJSON</code> for it even if, like in my case, it's only one <code>String</code> field?</p>\n</blockquote>\n\n<p>Yes.</p>\n\n<p>That said, there is a generic thing (a <code>Value</code>) to decode simple <code>yaml</code> data into if you don't want to set up your own <code>FromJSON</code> instance:</p>\n\n<pre><code>Prelude Data.Yaml&gt; Data.Yaml.decode \"some_value: \\\"fdsfdsfd\\\"\" :: Maybe Value\nJust (Object fromList [(\"some_value\",String \"fdsfdsfd\")])\n</code></pre>\n\n<p>And furthermore since if we only want uniformly typed key value pairs, we can just decode into a <code>HashMap</code> and we get the following:</p>\n\n<pre><code>&gt; Data.HashMap.Strict.lookup (\"some_value\" :: Text) =&lt;&lt; Data.Yaml.decode \"some_value: \\\"fdsfdsfd\\\"\" :: (Maybe String)\nJust \"fdsfdsfd\"\n</code></pre>\n"}], "owner": {"user_type": "does_not_exist", "display_name": "user266003"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 148, "favorite_count": 0, "accepted_answer_id": 36121906, "answer_count": 1, "score": 0, "last_activity_date": 1458545287, "creation_date": 1458513191, "last_edit_date": 1458543030, "question_id": 36120473, "link": "https://stackoverflow.com/questions/36120473/cant-decode-data-from-a-yml-file", "title": "Can&#39;t decode data from a yml file", "body": "<p>I want to read some basic settings from a yml file. Here's my attempt:</p>\n\n<pre><code>  #config.yml \n  some_value: \"fdsfdsfd\"\n\n\n  #.hs\n  yamlData &lt;- BS.readFile \"./config.yml\"\n  let var1 = Data.Yaml.decode yamlData :: Maybe String\n  print $ \"the key is \" ++ fromJust var1\n</code></pre>\n\n<p>It returns <code>Maybe.fromJust: Nothing</code>. Should I necessarily create a <code>data</code> from <code>some_value</code> and implement <code>FromJSON</code> and <code>ToJSON</code> for it even if, like in my case, it's only one <code>String</code> field? Or is the issue somewhere else in my code?</p>\n"}, {"tags": ["haskell", "generics"], "comments": [{"owner": {"reputation": 13807, "user_id": 2407038, "user_type": "registered", "accept_rate": 64, "profile_image": "https://www.gravatar.com/avatar/538f6f4a9aa43841841de7d8e8b169fc?s=128&d=identicon&r=PG&f=1", "display_name": "user2407038", "link": "https://stackoverflow.com/users/2407038/user2407038"}, "edited": false, "score": 0, "creation_date": 1458516992, "post_id": 36120048, "comment_id": 59882130, "body": "When you derive <code>Generic</code>, the generated types that represent metadata (ie. <code>C1_0T</code>, <code>S1_0_0T</code>, etc) have instances of the appropriate classes (<code>Datatype</code>, <code>Constructor</code>, <code>Selector</code>). These instances are what allow you to access this metadata. You will need a class to handle the different generic constructors, as in all the generics examples."}, {"owner": {"reputation": 4185, "user_id": 986475, "user_type": "registered", "accept_rate": 89, "profile_image": "https://www.gravatar.com/avatar/dd36406ee6957594a633373c297a3ab1?s=128&d=identicon&r=PG", "display_name": "Sal", "link": "https://stackoverflow.com/users/986475/sal"}, "reply_to_user": {"reputation": 13807, "user_id": 2407038, "user_type": "registered", "accept_rate": 64, "profile_image": "https://www.gravatar.com/avatar/538f6f4a9aa43841841de7d8e8b169fc?s=128&d=identicon&r=PG&f=1", "display_name": "user2407038", "link": "https://stackoverflow.com/users/2407038/user2407038"}, "edited": false, "score": 0, "creation_date": 1458518935, "post_id": 36120048, "comment_id": 59882609, "body": "@user2407038, yep, I know. My question is about how to access record names and functions. Generic examples that I have seen so far don&#39;t have those scenarios."}, {"owner": {"reputation": 13807, "user_id": 2407038, "user_type": "registered", "accept_rate": 64, "profile_image": "https://www.gravatar.com/avatar/538f6f4a9aa43841841de7d8e8b169fc?s=128&d=identicon&r=PG&f=1", "display_name": "user2407038", "link": "https://stackoverflow.com/users/2407038/user2407038"}, "edited": false, "score": 1, "creation_date": 1458519625, "post_id": 36120048, "comment_id": 59882791, "body": "There is no magic - call the methods of the typeclasses, i.e <a href=\"https://hackage.haskell.org/package/base-4.8.2.0/docs/GHC-Generics.html#t:Selector\" rel=\"nofollow noreferrer\"><code>Selector</code></a> on the appropriate values. The same exact way you have used <code>datatypeName</code>. You haven&#39;t provided any code so it&#39;s hard to say any more."}, {"owner": {"reputation": 44013, "user_id": 1477667, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/trgKM.jpg?s=128&g=1", "display_name": "dfeuer", "link": "https://stackoverflow.com/users/1477667/dfeuer"}, "edited": false, "score": 0, "creation_date": 1458537089, "post_id": 36120048, "comment_id": 59886819, "body": "Use the source, Luke! Hackage is an <i>invaluable</i> resource for learning how to write Haskell. If you want to know how to do something &quot;like <code>aeson</code>&quot;, the <code>aeson</code> source code should be the very first place you look. Fortunately, <code>aeson</code> has pretty readable source, so you should be able to go pretty far that way."}], "answers": [{"comments": [{"owner": {"reputation": 4185, "user_id": 986475, "user_type": "registered", "accept_rate": 89, "profile_image": "https://www.gravatar.com/avatar/dd36406ee6957594a633373c297a3ab1?s=128&d=identicon&r=PG", "display_name": "Sal", "link": "https://stackoverflow.com/users/986475/sal"}, "edited": false, "score": 0, "creation_date": 1458769916, "post_id": 36168324, "comment_id": 60013894, "body": "thank you for taking time to answer this. To extract the record function <code>aInt</code>, would it suffice to pattern match on <code>M1 {unM1 = K1 {unK1 = 1}}</code>, and take <code>unK1</code>?"}, {"owner": {"reputation": 37486, "user_id": 371753, "user_type": "registered", "accept_rate": 83, "profile_image": "https://i.stack.imgur.com/znFEK.jpg?s=128&g=1", "display_name": "sclv", "link": "https://stackoverflow.com/users/371753/sclv"}, "reply_to_user": {"reputation": 4185, "user_id": 986475, "user_type": "registered", "accept_rate": 89, "profile_image": "https://www.gravatar.com/avatar/dd36406ee6957594a633373c297a3ab1?s=128&d=identicon&r=PG", "display_name": "Sal", "link": "https://stackoverflow.com/users/986475/sal"}, "edited": false, "score": 0, "creation_date": 1458800501, "post_id": 36168324, "comment_id": 60022612, "body": "That gives you the value, not the function. Bear in mind this works if you have atomic things in the leaves of the records, if they&#39;re complex structures themselves, you&#39;ll need to <code>to</code> them back to turn them back to normal data from their <code>Rep</code>."}], "tags": [], "owner": {"reputation": 37486, "user_id": 371753, "user_type": "registered", "accept_rate": 83, "profile_image": "https://i.stack.imgur.com/znFEK.jpg?s=128&g=1", "display_name": "sclv", "link": "https://stackoverflow.com/users/371753/sclv"}, "is_accepted": true, "score": 3, "last_activity_date": 1458696955, "creation_date": 1458696955, "answer_id": 36168324, "question_id": 36120048, "link": "https://stackoverflow.com/questions/36120048/accessing-record-name-and-function-in-generics/36168324#36168324", "title": "Accessing record name and function in generics", "body": "<p>Here's something I just whipped up that should get this if you hand it the innards of a specific constructor:</p>\n\n<pre><code>{-# LANGUAGE DeriveGeneric, TypeOperators, FlexibleContexts, FlexibleInstances #-}\n\nimport GHC.Generics\n\ndata T = C1 { aInt::Int, aString::String} deriving (Show,Generic)\n\nclass AllSelNames x where\n    allSelNames :: x -&gt; [String]\n\ninstance (AllSelNames (a p), AllSelNames (b p)) =&gt; AllSelNames ((a :*: b) p) where\n    allSelNames (x :*: y) = allSelNames x ++ allSelNames y\n\ninstance Selector s =&gt; AllSelNames (M1 S s f a) where\n    allSelNames x = [selName x]\n</code></pre>\n\n<p>From the repl we see</p>\n\n<pre><code>*Main&gt; let x = unM1 . unM1 $ from (C1 {aInt=1,aString=\"a\"})\n*Main&gt; allSelNames x\n[\"aInt\",\"aString\"]\n</code></pre>\n"}], "owner": {"reputation": 4185, "user_id": 986475, "user_type": "registered", "accept_rate": 89, "profile_image": "https://www.gravatar.com/avatar/dd36406ee6957594a633373c297a3ab1?s=128&d=identicon&r=PG", "display_name": "Sal", "link": "https://stackoverflow.com/users/986475/sal"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 853, "favorite_count": 1, "accepted_answer_id": 36168324, "answer_count": 1, "score": 2, "last_activity_date": 1458696955, "creation_date": 1458510681, "last_edit_date": 1458525587, "question_id": 36120048, "link": "https://stackoverflow.com/questions/36120048/accessing-record-name-and-function-in-generics", "title": "Accessing record name and function in generics", "body": "<p>I am trying to figure out how to do generic deriving modeled after <code>deriveJSON</code>. I defined a simple type using record style data constructor as below:</p>\n\n<pre><code>data T = C1 { aInt::Int, aString::String} deriving (Show,Generic)\n</code></pre>\n\n<p>What I will like to do is to define a generic derivable function that takes the data constructors above, and outputs a builder using the record names and the functions - just a toy code - we want to make <code>ABuilder</code> generic so we can use it for any data type with record syntax (like <code>deriveJSON</code> in <code>Aeson</code>):</p>\n\n<pre><code>{-# LANGUAGE DeriveGeneric #-}\n\nimport GHC.Generics\n\ndata T = C1 { aInt::Int, aString::String} deriving (Show,Generic)\n\n-- Some kind of builder output - String here is a stand-in for the\n-- builder\nclass ABuilder a where\n  f :: a -&gt; String\n\n-- Need to get the record field name, and record field function \n-- for each argument, and build string - for anything that is not \n-- a string, we need to add show function - we assume \"Show\" instance \n-- exists\ninstance ABuilder T where\n  f x = (\"aInt:\" ++ (show . aInt $ x)) ++ \",\" ++ (\"aString:\" ++ (aString $ x))\n</code></pre>\n\n<p>What I can't figure out is how to get the record name, and the function. Here is my attempt in <code>ghci 7.10.3</code>. I could get the data type name, but can't figure out how to get record names and functions out of it.</p>\n\n<pre><code>$ ghci Test.hs \nGHCi, version 7.10.3: http://www.haskell.org/ghc/  :? for help\n[1 of 1] Compiling Main             ( Test.hs, interpreted )\nOk, modules loaded: Main.\n*Main&gt; datatypeName . from $ (C1 {aInt=1,aString=\"a\"})\n\"T\"\n*Main&gt; :t from (C1 {aInt=1,aString=\"a\"})\nfrom (C1 {aInt=1,aString=\"a\"})\n  :: D1\n       Main.D1T\n       (C1\n          Main.C1_0T\n          (S1 Main.S1_0_0T (Rec0 Int) :*: S1 Main.S1_0_1T (Rec0 String)))\n       x\n*Main&gt; \n</code></pre>\n\n<p>I will appreciate pointers on how to get the record name and the function in <code>Generics</code>. If <code>TemplateHaskell</code> is better approach for defining <code>Generic</code> instance of <code>ABuilder</code>, I will appreciate hearing why. I am hoping to stick to <code>Generics</code> for solving this at compile-time if the solution is simple. I have noticed that <code>Aeson</code> uses <code>TemplateHaskell</code> for <code>deriveJSON</code> part. That is why my question about <code>TemplateHaskell</code> above to see if there is something I am missing here (I am using <code>ghc 7.10.3</code> and don't need backward compatibility with older versions).</p>\n"}, {"tags": ["haskell", "pretty-print"], "comments": [{"owner": {"reputation": 37486, "user_id": 371753, "user_type": "registered", "accept_rate": 83, "profile_image": "https://i.stack.imgur.com/znFEK.jpg?s=128&g=1", "display_name": "sclv", "link": "https://stackoverflow.com/users/371753/sclv"}, "edited": false, "score": 0, "creation_date": 1458510759, "post_id": 36119999, "comment_id": 59880251, "body": "What is your tree format, and what error do you get?"}, {"owner": {"reputation": 111, "user_id": 2457584, "user_type": "registered", "accept_rate": 20, "profile_image": "https://www.gravatar.com/avatar/c3f5e5b51ea70afc69b82f2c76214aff?s=128&d=identicon&r=PG", "display_name": "2D3D4D", "link": "https://stackoverflow.com/users/2457584/2d3d4d"}, "reply_to_user": {"reputation": 37486, "user_id": 371753, "user_type": "registered", "accept_rate": 83, "profile_image": "https://i.stack.imgur.com/znFEK.jpg?s=128&g=1", "display_name": "sclv", "link": "https://stackoverflow.com/users/371753/sclv"}, "edited": false, "score": 0, "creation_date": 1458511237, "post_id": 36119999, "comment_id": 59880404, "body": "@sclv the tree at the bottom of the question, and I added the error there."}, {"owner": {"reputation": 37486, "user_id": 371753, "user_type": "registered", "accept_rate": 83, "profile_image": "https://i.stack.imgur.com/znFEK.jpg?s=128&g=1", "display_name": "sclv", "link": "https://stackoverflow.com/users/371753/sclv"}, "edited": false, "score": 0, "creation_date": 1458511296, "post_id": 36119999, "comment_id": 59880421, "body": "You&#39;ve given me the concrete expression for the tree you&#39;re pretty printing. I want the declaration of the tree data type itself. I.e. the equivalent of <code>data Tree a = Leaf a | Node (Tree a) (Tree a) deriving (Generic)</code> for your tree type."}, {"owner": {"reputation": 37486, "user_id": 371753, "user_type": "registered", "accept_rate": 83, "profile_image": "https://i.stack.imgur.com/znFEK.jpg?s=128&g=1", "display_name": "sclv", "link": "https://stackoverflow.com/users/371753/sclv"}, "edited": false, "score": 2, "creation_date": 1458511414, "post_id": 36119999, "comment_id": 59880457, "body": "In any case, the error message suggest that you shouldn&#39;t call <code>putStrLn (show (pp pTree))</code> but instead just <code>pp pTree</code>..."}, {"owner": {"reputation": 111, "user_id": 2457584, "user_type": "registered", "accept_rate": 20, "profile_image": "https://www.gravatar.com/avatar/c3f5e5b51ea70afc69b82f2c76214aff?s=128&d=identicon&r=PG", "display_name": "2D3D4D", "link": "https://stackoverflow.com/users/2457584/2d3d4d"}, "reply_to_user": {"reputation": 37486, "user_id": 371753, "user_type": "registered", "accept_rate": 83, "profile_image": "https://i.stack.imgur.com/znFEK.jpg?s=128&g=1", "display_name": "sclv", "link": "https://stackoverflow.com/users/371753/sclv"}, "edited": false, "score": 0, "creation_date": 1458511578, "post_id": 36119999, "comment_id": 59880507, "body": "@sclv thanks - the tree is a parse tree generated from the grammar. I have added the grammar as well. I tried pp pTree, didn&#39;t work."}, {"owner": {"reputation": 11001, "user_id": 727667, "user_type": "registered", "accept_rate": 88, "profile_image": "https://www.gravatar.com/avatar/2e2cbd3a202d8d1cfe0cc2a9fff86733?s=128&d=identicon&r=PG", "display_name": "gallais", "link": "https://stackoverflow.com/users/727667/gallais"}, "edited": false, "score": 0, "creation_date": 1458511693, "post_id": 36119999, "comment_id": 59880537, "body": "What do you mean by didn&#39;t work? Was there an error message? What was it?"}, {"owner": {"reputation": 37486, "user_id": 371753, "user_type": "registered", "accept_rate": 83, "profile_image": "https://i.stack.imgur.com/znFEK.jpg?s=128&g=1", "display_name": "sclv", "link": "https://stackoverflow.com/users/371753/sclv"}, "edited": false, "score": 1, "creation_date": 1458511710, "post_id": 36119999, "comment_id": 59880543, "body": "what error do you get with <code>pp pTree</code>? (you may find this advice on asking questions useful: <a href=\"http://stackoverflow.com/help/mcve\">stackoverflow.com/help/mcve</a>). Also note that whenever you say &quot;didn&#39;t work&quot; you need to describe the actual error."}, {"owner": {"reputation": 111, "user_id": 2457584, "user_type": "registered", "accept_rate": 20, "profile_image": "https://www.gravatar.com/avatar/c3f5e5b51ea70afc69b82f2c76214aff?s=128&d=identicon&r=PG", "display_name": "2D3D4D", "link": "https://stackoverflow.com/users/2457584/2d3d4d"}, "edited": false, "score": 1, "creation_date": 1458511975, "post_id": 36119999, "comment_id": 59880639, "body": "Got this:   No instance for (Out (ErrM.Err Prog)) arising from a use of \u2018pp\u2019     In a stmt of a &#39;do&#39; block: pp pTree     In the expression:       do { args &lt;- getArgs;            conts &lt;- readFile (args !! 0);            let tokens = myLexer conts                pTree = pProg tokens;            putStrLn (show tokens);            .... }     In an equation for \u2018main\u2019:         main           = do { args &lt;- getArgs;                  conts &lt;- readFile (args !! 0);                  let tokens = ...                      ....;                  .... }"}, {"owner": {"reputation": 13807, "user_id": 2407038, "user_type": "registered", "accept_rate": 64, "profile_image": "https://www.gravatar.com/avatar/538f6f4a9aa43841841de7d8e8b169fc?s=128&d=identicon&r=PG&f=1", "display_name": "user2407038", "link": "https://stackoverflow.com/users/2407038/user2407038"}, "edited": false, "score": 1, "creation_date": 1458516837, "post_id": 36119999, "comment_id": 59882086, "body": "You need to provide an instance of <code>Out</code> for <code>ErrM.Err</code> (or handle the error) and an instance for <code>Prog</code>. Presumable <code>instance Out Prog</code> and <code>instance Out a =&gt; Out (ErrM.Err a)</code> would work if these types have <code>Generic</code> instances."}], "answers": [{"tags": [], "owner": {"reputation": 111, "user_id": 2457584, "user_type": "registered", "accept_rate": 20, "profile_image": "https://www.gravatar.com/avatar/c3f5e5b51ea70afc69b82f2c76214aff?s=128&d=identicon&r=PG", "display_name": "2D3D4D", "link": "https://stackoverflow.com/users/2457584/2d3d4d"}, "is_accepted": false, "score": 0, "last_activity_date": 1458514594, "creation_date": 1458514594, "answer_id": 36120659, "question_id": 36119999, "link": "https://stackoverflow.com/questions/36119999/haskell-pretty-printing/36120659#36120659", "title": "Haskell pretty printing", "body": "<p>How about just replacing '(' with \\n\\t\\t? That will pretty print it. How do I approach this?</p>\n"}, {"tags": [], "owner": {"reputation": 37486, "user_id": 371753, "user_type": "registered", "accept_rate": 83, "profile_image": "https://i.stack.imgur.com/znFEK.jpg?s=128&g=1", "display_name": "sclv", "link": "https://stackoverflow.com/users/371753/sclv"}, "is_accepted": false, "score": 1, "last_activity_date": 1458523434, "creation_date": 1458523434, "answer_id": 36121753, "question_id": 36119999, "link": "https://stackoverflow.com/questions/36119999/haskell-pretty-printing/36121753#36121753", "title": "Haskell pretty printing", "body": "<p>This error tells you the problem:</p>\n\n<pre><code>No instance for (Out (ErrM.Err Prog)) \n</code></pre>\n\n<p>So try:</p>\n\n<pre><code>instance (Out a) =&gt; Out (ErrM.Err a)\ninstance Out Prog\n</code></pre>\n\n<p>And if those types fail to have <code>Generic</code> defined for them, you need to write something like</p>\n\n<pre><code>deriving instance Generic Prog\n</code></pre>\n\n<p>and</p>\n\n<pre><code>deriving instance (Generic a) =&gt; Generic (ErrM.Err a)\n</code></pre>\n"}], "owner": {"reputation": 111, "user_id": 2457584, "user_type": "registered", "accept_rate": 20, "profile_image": "https://www.gravatar.com/avatar/c3f5e5b51ea70afc69b82f2c76214aff?s=128&d=identicon&r=PG", "display_name": "2D3D4D", "link": "https://stackoverflow.com/users/2457584/2d3d4d"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 610, "favorite_count": 1, "answer_count": 2, "score": 1, "last_activity_date": 1458523434, "creation_date": 1458510428, "last_edit_date": 1458511899, "question_id": 36119999, "link": "https://stackoverflow.com/questions/36119999/haskell-pretty-printing", "title": "Haskell pretty printing", "body": "<p>I want to print a tree in a \"pretty\" format. I am using <a href=\"http://haddock.stackage.org/lts-3.15/GenericPretty-1.2.1/Text-PrettyPrint-GenericPretty.html\" rel=\"nofollow\">Text.PrettyPrint.GenericPretty</a> and <a href=\"http://haddock.stackage.org/lts-5.8/pretty-1.1.2.0/Text-PrettyPrint.html\" rel=\"nofollow\">Text.PrettyPrint</a>. My tree can be nested with pairs of ints, strings, identities.</p>\n\n<p>My code so far:</p>\n\n<pre><code>{-# LANGUAGE DeriveGeneric #-}\n\nmodule Main where\n\nimport System.IO ( stdin, hGetContents )\nimport System.Environment ( getArgs, getProgName )\nimport System.Exit ( exitFailure, exitSuccess )\n\nimport LexNav\nimport ParNav\nimport SkelNav\nimport AbsNav\n\nimport System.Environment\n\nimport Language.LBNF.Compiletime\nimport qualified Language.LBNF.Runtime as L hiding (Ok, Bad)\n\nimport Text.PrettyPrint.GenericPretty\nimport Text.PrettyPrint\n\nmain = pp tree1\n\n\nmain = do \n    args  &lt;- getArgs\n    conts &lt;- readFile (args !! 0)\n    let tokens = myLexer conts\n        pTree  = pProg tokens\n        let tree = transProg pTree\n    putStrLn (show tokens)\n    putStrLn \"----- \\n\\n ---- next -----\"\n    putStrLn (show (pp pTree))\n</code></pre>\n\n<p>I Found an example:</p>\n\n<pre><code>import Text.PrettyPrint.GenericPretty\n\ndata Tree a = Leaf a | Node (Tree a) (Tree a) deriving (Generic)\n\ninstance (Out a) =&gt; Out (Tree a)\n\ntree1 :: Tree Int\ntree1 = Node (Node (Leaf 333333) (Leaf (-555555)))(Node (Node(Node(Leaf 888888) \n        (Leaf 57575757))(Leaf (-14141414)))(Leaf 7777777))\n\nmain = pp tree1\n</code></pre>\n\n<p>Works fine, but not with my tree. How can I get it working with my tree format? My tree looks like this:</p>\n\n<blockquote>\n  <p>Ok (ProgBlock (Block1 (Declarations1 (DeclarationVar_declaration (Var_declaration1 (Ident \"x\") (Array_dimensions1 (ExprBint_term (Bint_termBint_factor (Bint_factorInt_expr (Int_exprInt_term (Int_termInt_factor (Int_factorInteger 2)))))) Array_dimensions2) Type_int)) (Declarations1 (DeclarationFun_declaration (Fun_declaration1 (Ident \"exp\") (Param_list1 (Parameters1 (Basic_declaration1 (Ident \"b\") Basic_array_dimensions2 Type_int) More_parameters2)) Type_int (Fun_block1 (Declarations1 (DeclarationVar_declaration (Var_declaration1 (Ident \"z\") Array_dimensions2 Type_int)) Declarations2) (Fun_body1 (Prog_stmts1 (Prog_stmt1 (ExprBint_term (Bint_termBint_factor (Bint_factor2 (Int_exprInt_term (Int_termInt_factor (Int_factor6 (Ident \"b\") (Modifier_listArray_dimensions Array_dimensions2)))) Compare_op1 (Int_exprInt_term (Int_termInt_factor (Int_factorInteger 0)))))) (Prog_stmt4 (Identifier1 (Ident \"z\") Array_dimensions2) (ExprBint_term (Bint_termBint_factor (Bint_factorInt_expr (Int_exprInt_term (Int_termInt_factor (Int_factorInteger 1))))))) (Prog_stmt4 (Identifier1 (Ident \"z\") Array_dimensions2) (ExprBint_term (Bint_termBint_factor (Bint_factorInt_expr (Int_exprInt_term (Int_term1 (Int_termInt_factor (Int_factor6 (Ident \"x\") (Modifier_listArray_dimensions (Array_dimensions1 (ExprBint_term (Bint_termBint_factor (Bint_factorInt_expr (Int_exprInt_term (Int_termInt_factor (Int_factorInteger 1)))))) Array_dimensions2)))) Mulop1 (Int_factor6 (Ident \"exp\") (Modifier_list1 (Arguments1 (ExprBint_term (Bint_termBint_factor (Bint_factorInt_expr (Int_expr1 (Int_exprInt_term (Int_termInt_factor (Int_factor6 (Ident \"b\") (Modifier_listArray_dimensions Array_dimensions2)))) Addop2 (Int_termInt_factor (Int_factorInteger 1)))))) More_arguments2)))))))))) Prog_stmts2) (ExprBint_term (Bint_termBint_factor (Bint_factorInt_expr (Int_exprInt_term (Int_termInt_factor (Int_factor6 (Ident \"z\") (Modifier_listArray_dimensions Array_dimensions2))))))))))) Declarations2)) (Program_body1 (Prog_stmts1 (Prog_stmt3 (Identifier1 (Ident \"x\") (Array_dimensions1 (ExprBint_term (Bint_termBint_factor (Bint_factorInt_expr (Int_exprInt_term (Int_termInt_factor (Int_factorInteger 0)))))) Array_dimensions2))) (Prog_stmts1 (Prog_stmt3 (Identifier1 (Ident \"x\") (Array_dimensions1 (ExprBint_term (Bint_termBint_factor (Bint_factorInt_expr (Int_exprInt_term (Int_termInt_factor (Int_factorInteger 1)))))) Array_dimensions2))) (Prog_stmts1 (Prog_stmt5 (ExprBint_term (Bint_termBint_factor (Bint_factorInt_expr (Int_exprInt_term (Int_termInt_factor (Int_factor6 (Ident \"exp\") (Modifier_list1 (Arguments1 (ExprBint_term (Bint_termBint_factor (Bint_factorInt_expr (Int_exprInt_term (Int_termInt_factor (Int_factor6 (Ident \"x\") (Modifier_listArray_dimensions (Array_dimensions1 (ExprBint_term (Bint_termBint_factor (Bint_factorInt_expr (Int_exprInt_term (Int_termInt_factor (Int_factorInteger 0)))))) Array_dimensions2)))))))) More_arguments2))))))))) Prog_stmts2))))))</p>\n</blockquote>\n\n<p>I get the following</p>\n\n<pre><code>Error: \n&gt; No instance for (Show (IO ())) arising from a use of \u2018show\u2019\n    In the first argument of \u2018putStrLn\u2019, namely \u2018(show (pp pTree))\u2019\n    In a stmt of a 'do' block: putStrLn (show (pp pTree))\n    In the expression:\n      do { args &lt;- getArgs;\n           conts &lt;- readFile (args !! 0);\n           let tokens = myLexer conts\n               pTree = pProg tokens;\n           putStrLn (show tokens);\n           .... }\n\n&gt; TestNav.hs:33:21:\n    No instance for (Out (ErrM.Err Prog)) arising from a use of \u2018pp\u2019\n    In the first argument of \u2018show\u2019, namely \u2018(pp pTree)\u2019\n    In the first argument of \u2018putStrLn\u2019, namely \u2018(show (pp pTree))\u2019\n    In a stmt of a 'do' block: putStrLn (show (pp pTree))\n</code></pre>\n\n<p>The tree is a parse tree of the following grammar:</p>\n\n<p>prog -> block</p>\n\n<p>block -> declarations program_body.</p>\n\n<p>declarations -> declaration SEMICOLON declarations\n             |.</p>\n\n<p>declaration -> var_declaration\n             | fun_declaration.</p>\n\n<p>var_declaration -> VAR ID array_dimensions COLON type.</p>\n\n<p>type -> INT\n      | REAL\n      | BOOL. </p>\n\n<p>array_dimensions -> SLPAR expr SRPAR array_dimensions\n             |.</p>\n\n<p>fun_declaration -> FUN ID param_list COLON type<br>\n                                            CLPAR fun_block CRPAR.</p>\n\n<p>fun_block -> declarations fun_body. </p>\n\n<p>param_list -> LPAR parameters RPAR.</p>\n\n<p>parameters -> basic_declaration more_parameters\n            |.</p>\n\n<p>more_parameters -> COMMA  basic_declaration more_parameters\n            |.</p>\n\n<p>basic_declaration -> ID basic_array_dimensions COLON type.</p>\n\n<p>basic_array_dimensions -> SLPAR SRPAR basic_array_dimensions\n             |.</p>\n\n<p>program_body -> BEGIN prog_stmts END.</p>\n\n<p>fun_body -> BEGIN prog_stmts RETURN expr SEMICOLON END.</p>\n\n<p>prog_stmts -> prog_stmt SEMICOLON prog_stmts\n            |.                         </p>\n\n<p>prog_stmt -> IF expr THEN prog_stmt ELSE prog_stmt\n           | WHILE expr DO prog_stmt\n           | READ identifier\n           | identifier ASSIGN expr\n           | PRINT expr\n           | CLPAR block CRPAR.</p>\n\n<p>identifier -> ID array_dimensions.</p>\n\n<p>expr ->  expr OR bint_term\n       | bint_term.</p>\n\n<p>bint_term -> bint_term AND bint_factor\n           | bint_factor.</p>\n\n<p>bint_factor -> NOT bint_factor\n             | int_expr compare_op int_expr\n             | int_expr.</p>\n\n<p>compare_op -> EQUAL | LT | GT | LE |GE.</p>\n\n<p>int_expr -> int_expr addop int_term\n          | int_term.</p>\n\n<p>addop -> ADD | SUB.</p>\n\n<p>int_term -> int_term mulop int_factor\n          | int_factor.</p>\n\n<p>mulop -> MUL | DIV.</p>\n\n<p>int_factor -> LPAR expr RPAR\n            | SIZE LPAR ID basic_array_dimensions RPAR\n            | FLOAT LPAR expr RPAR\n            | FLOOR LPAR expr RPAR\n            | CEIL LPAR expr RPAR\n            | ID modifier_list\n            | IVAL\n            | RVAL\n            | BVAL\n            | SUB int_factor.</p>\n\n<p>modifier_list -> LPAR arguments RPAR\n           | array_dimensions.</p>\n\n<p>arguments -> expr more_arguments\n           |.</p>\n\n<p>more_arguments -> COMMA expr more_arguments\n           |.</p>\n"}, {"tags": ["haskell"], "comments": [{"owner": {"reputation": 28488, "user_id": 402884, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35583fe46c2cde92467710cc7ceff266?s=128&d=identicon&r=PG", "display_name": "Chris Martin", "link": "https://stackoverflow.com/users/402884/chris-martin"}, "edited": false, "score": 1, "creation_date": 1458508931, "post_id": 36119472, "comment_id": 59879565, "body": "Just to be clear, you know that you can write <code>(fmap . fmap . fmap . fmap) succ [[[[1]]]]</code>, and you&#39;re looking for a way to rewrite it as a curiosity?"}, {"owner": {"reputation": 1008, "user_id": 2302508, "user_type": "registered", "accept_rate": 75, "profile_image": "https://i.stack.imgur.com/t3O8C.png?s=128&g=1", "display_name": "BlackCap", "link": "https://stackoverflow.com/users/2302508/blackcap"}, "reply_to_user": {"reputation": 28488, "user_id": 402884, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35583fe46c2cde92467710cc7ceff266?s=128&d=identicon&r=PG", "display_name": "Chris Martin", "link": "https://stackoverflow.com/users/402884/chris-martin"}, "edited": false, "score": 0, "creation_date": 1458509115, "post_id": 36119472, "comment_id": 59879637, "body": "@ChrisMartin Correct."}], "owner": {"reputation": 1008, "user_id": 2302508, "user_type": "registered", "accept_rate": 75, "profile_image": "https://i.stack.imgur.com/t3O8C.png?s=128&g=1", "display_name": "BlackCap", "link": "https://stackoverflow.com/users/2302508/blackcap"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 41, "favorite_count": 0, "closed_date": 1458509023, "answer_count": 0, "score": 0, "last_activity_date": 1458507796, "creation_date": 1458507312, "last_edit_date": 1458507796, "question_id": 36119472, "link": "https://stackoverflow.com/questions/36119472/how-many-fmaps-to-lift-four-layers", "closed_reason": "Duplicate", "title": "How many fmaps to lift four layers?", "body": "<p>You use fmap to lift a function over some context:</p>\n\n<pre><code>fmap succ [1] = [2]\n</code></pre>\n\n<p>You can use function composition to lift over two layers of context:</p>\n\n<pre><code>(fmap . fmap) succ [[1]] = [[2]]\n</code></pre>\n\n<p>And because fmap for functions is equal to (.), this can also be written as:</p>\n\n<pre><code>fmap fmap fmap succ [[1]] = [[2]]\n</code></pre>\n\n<p>What about three layers of context?</p>\n\n<pre><code>fmap . fmap . fmap = \n(fmap . fmap) . fmap = \nfmap (fmap . fmap) fmap = \nfmap (fmap fmap fmap) fmap = \n(fmap . fmap fmap) fmap fmap = \nfmap fmap (fmap fmap) fmap fmap = \n(fmap fmap . fmap) fmap fmap fmap = \n(fmap . fmap) fmap fmap fmap fmap fmap = \nfmap fmap fmap fmap fmap fmap fmap fmap\n</code></pre>\n\n<p>Eight! We just went from 5 (2 of which where infix) to 8.\n<br>How many fmaps in a row do I need to lift over four layers of context? A lot apparently, so many that I can't figure it out trough bruteforce. Is it even possible, does the pattern stop at 3?</p>\n"}, {"tags": ["haskell", "error-handling"], "answers": [{"comments": [{"owner": {"reputation": 103, "user_id": 5905842, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/72a475cb0ae5799b68eaf7006bf00c1b?s=128&d=identicon&r=PG&f=1", "display_name": "something", "link": "https://stackoverflow.com/users/5905842/something"}, "edited": false, "score": 0, "creation_date": 1458506143, "post_id": 36119163, "comment_id": 59878617, "body": "Thank you for this, I really couldn&#39;t find anything about this on the web, as I wasn&#39;t sure of what to search for a solution. Thanks again, was a big help!"}], "tags": [], "owner": {"reputation": 49501, "user_id": 784338, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/ae195ac7c8a5e9002a808544572cc5fc?s=128&d=identicon&r=PG", "display_name": "Daniel Gratzer", "link": "https://stackoverflow.com/users/784338/daniel-gratzer"}, "is_accepted": true, "score": 1, "last_activity_date": 1458505921, "creation_date": 1458505921, "answer_id": 36119163, "question_id": 36119029, "link": "https://stackoverflow.com/questions/36119029/haskell-getting-to-the-tuple/36119163#36119163", "title": "Haskell getting to the tuple", "body": "<p><code>fst</code> is a function with the type <code>(a, b) -&gt; a</code> (well, we're using it in a more specific way, as <code>(Int, Int) -&gt; Int</code>) but we're applying it to <code>mixIt 2 2</code> which has the type <code>Error (Int, Int)</code>. This is the source of our error.</p>\n\n<p>In order to fix it we need to inspect the <code>Error</code> value we get back from <code>mixIt</code> by pattern matching on it</p>\n\n<pre><code> case mixIt 2 2 of\n   Nice tuple -&gt; fst tuple\n</code></pre>\n\n<p>We can explicitly pattern match on the case where we have a <code>Nice</code> constructor which has the tuple we want as an argument. However there's a problem because <code>mixIt</code> might also return <code>Woops</code>, the other constructor of <code>Error</code>. We need to handle that case separately otherwise our program will fail at runtime (a very bad thing)</p>\n\n<pre><code> case mixIt 2 2 of\n   Nice tuple -&gt; fst tuple\n   Whoops -&gt; ... some Haskell code to produce another tuple ...\n</code></pre>\n\n<p>once you fill in that last branch of the case expression you're set to go.</p>\n"}], "owner": {"reputation": 103, "user_id": 5905842, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/72a475cb0ae5799b68eaf7006bf00c1b?s=128&d=identicon&r=PG&f=1", "display_name": "something", "link": "https://stackoverflow.com/users/5905842/something"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 36, "favorite_count": 0, "accepted_answer_id": 36119163, "answer_count": 1, "score": -2, "last_activity_date": 1458505921, "creation_date": 1458505217, "question_id": 36119029, "link": "https://stackoverflow.com/questions/36119029/haskell-getting-to-the-tuple", "title": "Haskell getting to the tuple", "body": "<p>I have a function in Haskell defined as (Error is a data type)</p>\n\n<pre><code>data Error a = Woops | Nice a deriving (Eq, Ord, Show)\n\nmixIt :: Int -&gt; Int -&gt; (Error (Int, Int))\n</code></pre>\n\n<p>How can I get to the return tuple, I have tried;</p>\n\n<pre><code>fst (mixIt 2 2)\n</code></pre>\n\n<p>But it gives an error?</p>\n"}, {"tags": ["haskell"], "answers": [{"tags": [], "owner": {"reputation": 13520, "user_id": 2315602, "user_type": "registered", "accept_rate": 89, "profile_image": "https://i.stack.imgur.com/8rKPi.jpg?s=128&g=1", "display_name": "lisyarus", "link": "https://stackoverflow.com/users/2315602/lisyarus"}, "is_accepted": false, "score": 2, "last_activity_date": 1458501731, "last_edit_date": 1458501731, "creation_date": 1458501009, "answer_id": 36118245, "question_id": 36118026, "link": "https://stackoverflow.com/questions/36118026/haskell-trying-to-make-class-matrix-show-instance/36118245#36118245", "title": "Haskell trying to make class Matrix show instance", "body": "<pre><code>print (x:xs) = show x ++ \"\\n\" ++ print xs\n</code></pre>\n\n<p>Here, <code>x</code> has type <code>[a]</code>. The instance <code>Show [a]</code> needs an instance of <code>Show a</code>. In other words, you have to tell how to show <code>a</code> in order to be able to show <code>[a]</code>.</p>\n\n<p>Add a dependency on <code>Show a</code> in your instance declaration:</p>\n\n<pre><code>instance (Show a) =&gt; Show (Matrix a) where\n    ...\n</code></pre>\n\n<p>By the way, your code can be written using standard library like this:</p>\n\n<pre><code>show (Matr d) = concat . intersperse \"\\n\" . map show $ d\n</code></pre>\n\n<p>Note: You need to <code>import Data.List</code> in your matrix module for the <code>intersperse</code> function!</p>\n"}, {"tags": [], "owner": {"reputation": 14781, "user_id": 630160, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/4445f21326af525a8ad19af7e3ae41a8?s=128&d=identicon&r=PG", "display_name": "epsilonhalbe", "link": "https://stackoverflow.com/users/630160/epsilonhalbe"}, "is_accepted": true, "score": 3, "last_activity_date": 1458501869, "last_edit_date": 1458501869, "creation_date": 1458501047, "answer_id": 36118252, "question_id": 36118026, "link": "https://stackoverflow.com/questions/36118026/haskell-trying-to-make-class-matrix-show-instance/36118252#36118252", "title": "Haskell trying to make class Matrix show instance", "body": "<p>The error message says \"you need a <code>Show</code> instance for the element type of your matrix\".</p>\n\n<p>Also <code>print</code> is the wrong function to call here - <code>show</code> is equivalent to <code>toString</code> in languages like java - whereas <code>print</code> is an IO-operation that puts a <code>String</code> to stdout, you are using a name that has already a meaning.</p>\n\n<pre><code>newtype Matrix a = Matr [[a]]\n\ninstance Show a =&gt; Show (Matrix a) where\n    show (Matr xx) = showlines xx\n      where showlines [] = \"\"\n            showlines (x:xs) = showelems x ++ \"\\n\" ++ showlines xs\n            showelems [] = \"\"\n            showelems (x:xs) = show x ++ \" \" ++ showelems xs\n</code></pre>\n\n<p>now this <code>showline</code>/<code>showelems</code> pattern is already a common one the functions are <code>unlines</code> and <code>unwords</code> but the elements need to be strings already so </p>\n\n<pre><code>    show (Matr xx) = let strs = map (map show) xx\n                     in unlines $ map unwords xx\n</code></pre>\n\n<p>or a bit terser</p>\n\n<pre><code>    show (Matr xx) = unlines $ map (unwords . map show) xx\n</code></pre>\n\n<hr>\n\n<p>here is some example usage of <code>unlines</code>/<code>unwords</code></p>\n\n<pre><code>$ &gt; ghci\nGHCi, version 7.10.3: http://www.haskell.org/ghc/  :? for help\nPrelude&gt; putStrLn $ unlines [\"a\",\"b\"]\na\nb\n\nPrelude&gt; putStrLn $ unlines $ map unwords [[\"a\",\"b\"],[\"c\",\"d\"]]\na b\nc d\n\nPrelude&gt; putStrLn $ unlines $ map (unwords . map show ) [[1,2],[3,4]]\n1 2\n3 4\n</code></pre>\n\n<p>@lisyarus' answer shows a lot more what happens behind the scene - but note the output of that show function is different from mine.</p>\n\n<pre><code>Prelude&gt; import Data.List\nPrelude Data.List&gt; putStrLn $ concat . intersperse \"\\n\" . map show $ [[1,2],[3,4]]\n[1,2]\n[3,4]\n</code></pre>\n"}], "owner": {"reputation": 3, "user_id": 6090486, "user_type": "registered", "profile_image": "https://graph.facebook.com/1148672368498386/picture?type=large", "display_name": "\u041b\u0430\u0434\u0430 \u0422\u0440\u0438\u043c\u0430\u0441\u043e\u0432\u0430", "link": "https://stackoverflow.com/users/6090486/%d0%9b%d0%b0%d0%b4%d0%b0-%d0%a2%d1%80%d0%b8%d0%bc%d0%b0%d1%81%d0%be%d0%b2%d0%b0"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 286, "favorite_count": 0, "accepted_answer_id": 36118252, "answer_count": 2, "score": 0, "last_activity_date": 1458501869, "creation_date": 1458499825, "question_id": 36118026, "link": "https://stackoverflow.com/questions/36118026/haskell-trying-to-make-class-matrix-show-instance", "title": "Haskell trying to make class Matrix show instance", "body": "<p>I am a beginner in haskell, please, tell me what I am doing wrong.</p>\n\n<pre><code>    newtype (Matrix a) = Matr [[a]]\n    instance Show (Matrix a) where\n        show (Matr d) = print d\n            where print [] = []\n                print (x:xs) = show x ++ \"\\n\" ++ print xs\n\n    No instance for (Show a) arising from a use of `print'\n    Possible fix:\n    add (Show a) to the context of the instance declaration\n</code></pre>\n"}, {"tags": ["haskell", "instance", "show"], "comments": [{"owner": {"reputation": 14781, "user_id": 630160, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/4445f21326af525a8ad19af7e3ae41a8?s=128&d=identicon&r=PG", "display_name": "epsilonhalbe", "link": "https://stackoverflow.com/users/630160/epsilonhalbe"}, "edited": false, "score": 2, "creation_date": 1458495450, "post_id": 36116980, "comment_id": 59874733, "body": "it is unclear what you are asking - do you need help with your <code>Show</code> instance - it is wrongly indented use at least 2 spaces before  each <code>show ...</code>; if you mean how to print it on command line - use <code>print January</code> or <code>putStrLn $ show January</code>"}, {"owner": {"reputation": 14781, "user_id": 630160, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/4445f21326af525a8ad19af7e3ae41a8?s=128&d=identicon&r=PG", "display_name": "epsilonhalbe", "link": "https://stackoverflow.com/users/630160/epsilonhalbe"}, "edited": false, "score": 1, "creation_date": 1458495515, "post_id": 36116980, "comment_id": 59874757, "body": "I would also call your datatype <code>Month</code> - as the plural would usually indicate a list of things (this is just convention)."}], "answers": [{"comments": [{"owner": {"reputation": 19, "user_id": 6090252, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/1e6da38872756d66a841686347581582?s=128&d=identicon&r=PG&f=1", "display_name": "benjy1911", "link": "https://stackoverflow.com/users/6090252/benjy1911"}, "edited": false, "score": 0, "creation_date": 1458496906, "post_id": 36117210, "comment_id": 59875306, "body": "instead of show January, can I have it so that when I write show Months, they are all displayed? @mdunsmuir"}, {"owner": {"reputation": 13807, "user_id": 2407038, "user_type": "registered", "accept_rate": 64, "profile_image": "https://www.gravatar.com/avatar/538f6f4a9aa43841841de7d8e8b169fc?s=128&d=identicon&r=PG&f=1", "display_name": "user2407038", "link": "https://stackoverflow.com/users/2407038/user2407038"}, "reply_to_user": {"reputation": 19, "user_id": 6090252, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/1e6da38872756d66a841686347581582?s=128&d=identicon&r=PG&f=1", "display_name": "benjy1911", "link": "https://stackoverflow.com/users/6090252/benjy1911"}, "edited": false, "score": 0, "creation_date": 1458496996, "post_id": 36117210, "comment_id": 59875342, "body": "@benjy1911 Use <code>show [January .. July]</code>. The <code>Enum</code> instance allows you to generate all of the months in sequence."}, {"owner": {"reputation": 34889, "user_id": 86604, "user_type": "registered", "accept_rate": 80, "profile_image": "https://www.gravatar.com/avatar/329af917389e6cf8e146c03012f5319a?s=128&d=identicon&r=PG", "display_name": "Ingo", "link": "https://stackoverflow.com/users/86604/ingo"}, "edited": false, "score": 0, "creation_date": 1458507357, "post_id": 36117210, "comment_id": 59879059, "body": "Or, better yet, derive also <code>Bounded</code> and <code>show [minBound .. maxBound]</code> , just in case more months are added later."}], "tags": [], "owner": {"reputation": 482, "user_id": 2009431, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/871eacebfbd5328ea7f5bd4b283c0512?s=128&d=identicon&r=PG", "display_name": "mdunsmuir", "link": "https://stackoverflow.com/users/2009431/mdunsmuir"}, "is_accepted": false, "score": 1, "last_activity_date": 1458495799, "creation_date": 1458495799, "answer_id": 36117210, "question_id": 36116980, "link": "https://stackoverflow.com/questions/36116980/haskell-show-data/36117210#36117210", "title": "Haskell show data", "body": "<p><code>Show</code> can be derived automatically:</p>\n\n<pre><code>data Months = January | February | March | April | May | June | July\n              deriving (Eq, Ord, Enum, Show)\n</code></pre>\n\n<p>And so:</p>\n\n<pre><code>\u03bb&gt; show January \n\"January\"\n</code></pre>\n\n<p>I suppose there might be a good reason that you want your <code>Show</code> instance to display those abbreviated month names, but why not just change the names of your data constructors to match?</p>\n"}], "owner": {"reputation": 19, "user_id": 6090252, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/1e6da38872756d66a841686347581582?s=128&d=identicon&r=PG&f=1", "display_name": "benjy1911", "link": "https://stackoverflow.com/users/6090252/benjy1911"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 210, "favorite_count": 0, "answer_count": 1, "score": 0, "last_activity_date": 1458495799, "creation_date": 1458494675, "question_id": 36116980, "link": "https://stackoverflow.com/questions/36116980/haskell-show-data", "title": "Haskell show data", "body": "<pre><code>data Months = January|February|March|April|May|June|July\n         deriving (Eq, Ord, Enum)\ninstance Show Months where \n\nshow January=\"Jan\"\nshow February=\"Feb\"\nshow March=\"Mar\"\n....\n</code></pre>\n\n<p>What do I need to do to show the output as such: \u201dJan\u201d, \u201dFeb\u201d, ..., \u201dJuly\" ?</p>\n"}, {"tags": ["haskell", "haskell-pipes"], "answers": [{"tags": [], "owner": {"reputation": 44013, "user_id": 1477667, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/trgKM.jpg?s=128&g=1", "display_name": "dfeuer", "link": "https://stackoverflow.com/users/1477667/dfeuer"}, "is_accepted": false, "score": 1, "last_activity_date": 1458494133, "creation_date": 1458494133, "answer_id": 36116871, "question_id": 36116589, "link": "https://stackoverflow.com/questions/36116589/haskell-pipes-how-do-i-sort-the-output-of-a-producer/36116871#36116871", "title": "Haskell Pipes: How do I sort the output of a producer?", "body": "<p>Yes, you need to drain the output first, either into a list our some other structure. Sorting is inherently non-streaming because it may be, for instance, that the last element coming in should be the first going out.</p>\n"}, {"tags": [], "owner": {"reputation": 28873, "user_id": 1068232, "user_type": "registered", "accept_rate": 79, "profile_image": "https://www.gravatar.com/avatar/2a0a145ce58c20013969fe3f203531da?s=128&d=identicon&r=PG", "display_name": "Andr&#225;s Kov&#225;cs", "link": "https://stackoverflow.com/users/1068232/andr%c3%a1s-kov%c3%a1cs"}, "is_accepted": true, "score": 4, "last_activity_date": 1458494172, "creation_date": 1458494172, "answer_id": 36116876, "question_id": 36116589, "link": "https://stackoverflow.com/questions/36116589/haskell-pipes-how-do-i-sort-the-output-of-a-producer/36116876#36116876", "title": "Haskell Pipes: How do I sort the output of a producer?", "body": "<p><code>toListM</code> from <a href=\"https://hackage.haskell.org/package/pipes-4.1.8/docs/Pipes-Prelude.html\" rel=\"nofollow\"><code>Pipes.Prelude</code></a> converts a producer into a list. We can use that and proceed without <code>pipes</code> afterwards:</p>\n\n<pre><code>runTest top = do\n  ds &lt;- P.toListM (getDC top &gt;-&gt; P.map (top&lt;/&gt;))\n  mapM_ print $ sort ds\n</code></pre>\n\n<p>Or a bit more pipe-like using usual monadic operators:</p>\n\n<pre><code>runTest top = P.toListM (getDC top &gt;-&gt; P.map (top&lt;/&gt;)) &gt;&gt;= mapM_ print . sort\n</code></pre>\n\n<p>Grabbing all the <code>Producer</code> contents brings us outside streaming abstraction, which is why <code>toListM</code> returns a plain list instead of being a pipe.</p>\n"}], "owner": {"reputation": 315, "user_id": 5367513, "user_type": "registered", "accept_rate": 89, "profile_image": "https://www.gravatar.com/avatar/7bc3967ca71ebcd3dbb20b5b7552a904?s=128&d=identicon&r=PG&f=1", "display_name": "Jan Syn&#225;\u010dek", "link": "https://stackoverflow.com/users/5367513/jan-syn%c3%a1%c4%8dek"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 217, "favorite_count": 0, "accepted_answer_id": 36116876, "answer_count": 2, "score": 1, "last_activity_date": 1458494172, "creation_date": 1458492590, "question_id": 36116589, "link": "https://stackoverflow.com/questions/36116589/haskell-pipes-how-do-i-sort-the-output-of-a-producer", "title": "Haskell Pipes: How do I sort the output of a producer?", "body": "<p>I have the following piece of code:</p>\n\n<pre><code>import Control.Monad (unless)\nimport Pipes\nimport qualified Pipes.Prelude as P\nimport System.FilePath.Posix ((&lt;/&gt;))\nimport System.Posix.Directory (DirStream, openDirStream, readDirStream)\n\nproduceFiles :: DirStream -&gt; Producer FilePath IO ()\nproduceFiles ds = do\n  path &lt;- lift $ readDirStream ds\n  yield path\n  unless (path == \"\") $ produceFiles ds\n\ngetDC :: FilePath -&gt; Producer FilePath IO ()\ngetDC top = do\n  ds &lt;- lift $ openDirStream top\n  produceFiles ds\n\nrunTest top = runEffect $ getDC top &gt;-&gt; P.map (top&lt;/&gt;) &gt;-&gt; P.stdoutLn\n</code></pre>\n\n<p>It prints all the files in the directory <code>top</code>. How do I sort the output before I print it? Do I need to write a consumer that \"drains\" the output first into a list and then sorts it? I'm using pipes-4.1.4.</p>\n"}, {"tags": ["haskell"], "comments": [{"owner": {"reputation": 33202, "user_id": 987185, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/e4c92f75eac948cee7e7e8913f9aa379?s=128&d=identicon&r=PG", "display_name": "musically_ut", "link": "https://stackoverflow.com/users/987185/musically-ut"}, "edited": false, "score": 0, "creation_date": 1458490788, "post_id": 36116224, "comment_id": 59872923, "body": "I am not sure I follow. Do you want any function with that type signature in Prelude since <code>ord</code> does not return those values for <code>a</code>, <code>b</code>, etc."}, {"owner": {"reputation": 94553, "user_id": 775806, "user_type": "registered", "accept_rate": 96, "profile_image": "https://i.stack.imgur.com/XNd2C.png?s=128&g=1", "display_name": "n. &#39;pronouns&#39; m.", "link": "https://stackoverflow.com/users/775806/n-pronouns-m"}, "edited": false, "score": 0, "creation_date": 1458490981, "post_id": 36116224, "comment_id": 59873014, "body": "Why there should be any duplicate functionality in Haskell libraries?"}, {"owner": {"reputation": 35578, "user_id": 3000206, "user_type": "registered", "accept_rate": 98, "profile_image": "https://i.stack.imgur.com/BK1fo.jpg?s=128&g=1", "display_name": "Carcigenicate", "link": "https://stackoverflow.com/users/3000206/carcigenicate"}, "edited": false, "score": 2, "creation_date": 1458491222, "post_id": 36116224, "comment_id": 59873107, "body": "Why not just import Data.Char?"}], "answers": [{"comments": [{"owner": {"reputation": 3815, "user_id": 5382150, "user_type": "registered", "accept_rate": 86, "profile_image": "https://i.stack.imgur.com/GwGSL.png?s=128&g=1", "display_name": "Gilgamesz", "link": "https://stackoverflow.com/users/5382150/gilgamesz"}, "edited": false, "score": 0, "creation_date": 1458492706, "post_id": 36116309, "comment_id": 59873671, "body": "I didn&#39;t know about <code>fromEnum</code>. Thanks ;)"}], "tags": [], "owner": {"reputation": 62252, "user_id": 1435869, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/TrEd9.jpg?s=128&g=1", "display_name": "karakfa", "link": "https://stackoverflow.com/users/1435869/karakfa"}, "is_accepted": true, "score": 5, "last_activity_date": 1458491039, "creation_date": 1458491039, "answer_id": 36116309, "question_id": 36116224, "link": "https://stackoverflow.com/questions/36116224/char-to-int-haskell/36116309#36116309", "title": "Char to int. Haskell", "body": "<pre><code>f x = fromEnum x - fromEnum 'a'\n</code></pre>\n"}], "owner": {"reputation": 3815, "user_id": 5382150, "user_type": "registered", "accept_rate": 86, "profile_image": "https://i.stack.imgur.com/GwGSL.png?s=128&g=1", "display_name": "Gilgamesz", "link": "https://stackoverflow.com/users/5382150/gilgamesz"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 375, "favorite_count": 0, "accepted_answer_id": 36116309, "answer_count": 1, "score": 0, "last_activity_date": 1477509279, "creation_date": 1458490636, "last_edit_date": 1458502064, "question_id": 36116224, "link": "https://stackoverflow.com/questions/36116224/char-to-int-haskell", "title": "Char to int. Haskell", "body": "<p>I wonder if there is any function I described below is available in <code>Prelude</code>. Is it?\n(I know about <code>ord</code>, but it is in <code>Data.Char</code>)</p>\n\n<p>I am looking for:</p>\n\n<pre><code>f :: Char -&gt; Int\nf 'a' = 0\nf 'b' = 1\n....\n</code></pre>\n"}, {"tags": ["haskell", "ghc", "template-haskell"], "comments": [{"owner": {"reputation": 13807, "user_id": 2407038, "user_type": "registered", "accept_rate": 64, "profile_image": "https://www.gravatar.com/avatar/538f6f4a9aa43841841de7d8e8b169fc?s=128&d=identicon&r=PG&f=1", "display_name": "user2407038", "link": "https://stackoverflow.com/users/2407038/user2407038"}, "edited": false, "score": 0, "creation_date": 1458498385, "post_id": 36115800, "comment_id": 59875902, "body": "You would have to write e.g. <code>mkBar n = appT (conT &#39;&#39;Bar) (litT $ numTyLit n) `appT` (litT $ numTyLit $ f n)</code> and then <code>bar :: $(mkBar 5)</code>. There really is no way to put a splice like that into a type synonym. Unless it is strictly <i>impossible</i> to promote <code>f</code>, then it will probably be easier to do so (even if it is non-trivial) than dealing with TH in the long term."}, {"owner": {"reputation": 44013, "user_id": 1477667, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/trgKM.jpg?s=128&g=1", "display_name": "dfeuer", "link": "https://stackoverflow.com/users/1477667/dfeuer"}, "edited": false, "score": 0, "creation_date": 1458536926, "post_id": 36115800, "comment_id": 59886769, "body": "Can you give a concrete example of your ultimate goal? Template Haskell always looks like line noise to me."}, {"owner": {"reputation": 21417, "user_id": 925978, "user_type": "registered", "accept_rate": 84, "profile_image": "https://www.gravatar.com/avatar/06e4467a5bd1538a92cefb20db07897a?s=128&d=identicon&r=PG&f=1", "display_name": "crockeea", "link": "https://stackoverflow.com/users/925978/crockeea"}, "reply_to_user": {"reputation": 44013, "user_id": 1477667, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/trgKM.jpg?s=128&g=1", "display_name": "dfeuer", "link": "https://stackoverflow.com/users/1477667/dfeuer"}, "edited": false, "score": 0, "creation_date": 1458567956, "post_id": 36115800, "comment_id": 59904017, "body": "@dfeuer <a href=\"http://stackoverflow.com/questions/36062614/typelit-from-generic-integer-expression\">This question</a> goes into a little more detail, but it&#39;s basically what I&#39;ve got there. At the top level, when I give concrete types, I (frequently) want one type parameter to be a function of another. The function (<code>f</code> above) is too hard to compute in my head, so this turns into a multi-step process."}], "owner": {"reputation": 21417, "user_id": 925978, "user_type": "registered", "accept_rate": 84, "profile_image": "https://www.gravatar.com/avatar/06e4467a5bd1538a92cefb20db07897a?s=128&d=identicon&r=PG&f=1", "display_name": "crockeea", "link": "https://stackoverflow.com/users/925978/crockeea"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 86, "favorite_count": 0, "answer_count": 0, "score": 1, "last_activity_date": 1458528282, "creation_date": 1458488292, "last_edit_date": 1458528282, "question_id": 36115800, "link": "https://stackoverflow.com/questions/36115800/type-synonyms-with-templatehaskell", "title": "Type synonyms with TemplateHaskell", "body": "<p>If I have a type <code>data Foo = Foo Int Int</code> where frequently (but not always) the second parameter is a (fixed) function of the first, I could write a helper function <code>mkFoo m = Foo m (f m)</code> to reduce duplication. </p>\n\n<p>I have this exact problem, but at the <em>type level</em>. The natural solution might be to use singletons to promote <code>f</code>, but my <code>f</code> isn't easily promoted. Instead, I'm trying to use TemplateHaskell and reflection to evaluate <code>f</code> at compile time at the data level. For example, I can currently do this (using <code>\u2011XDataKinds</code> and <code>GHC.TypeLits</code>):</p>\n\n<pre><code>f :: Integer -&gt; Integer\n\ndata Bar (a::Nat) (b::Nat)\n\nmkNat :: Integer -&gt; Q Type -- constructs a TypeLit\n\nbar :: Bar 5 $(mkNat $ f $ proxy natValue (Proxy::Proxy 5))\n</code></pre>\n\n<p>It's obviously annoying to have to write this with a concrete type every time I want to use this pattern. Unfortunately, I know of no shorter or generic way to write the signature for <code>bar</code>.  In particular, I can't define the type synonym </p>\n\n<pre><code>type Bar' (m :: Nat) = Bar m $(mkNat $ f $ proxy natVal (Proxy::Proxy m))\n\nbar :: Bar' 5\n</code></pre>\n\n<p>due to TH stage restrictions (<code>m</code> is not imported or known when compiling the synonym).</p>\n\n<p>Is there any way to simplify the signature of <code>bar</code>?</p>\n"}, {"tags": ["haskell", "graph"], "comments": [{"owner": {"reputation": 673, "user_id": 2202153, "user_type": "registered", "accept_rate": 60, "profile_image": "https://www.gravatar.com/avatar/5251e42311913bff27d9ff74d9187214?s=128&d=identicon&r=PG", "display_name": "Wojciech Ptak", "link": "https://stackoverflow.com/users/2202153/wojciech-ptak"}, "edited": false, "score": 3, "creation_date": 1458487705, "post_id": 36115639, "comment_id": 59871814, "body": "I believe you need to use backticks instead of single quotes for infix notation. <code>P &#39;res&#39; v</code> doesn&#39;t seem valid Haskell to me."}], "answers": [{"tags": [], "owner": {"reputation": 14781, "user_id": 630160, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/4445f21326af525a8ad19af7e3ae41a8?s=128&d=identicon&r=PG", "display_name": "epsilonhalbe", "link": "https://stackoverflow.com/users/630160/epsilonhalbe"}, "is_accepted": false, "score": 1, "last_activity_date": 1458494280, "creation_date": 1458494280, "answer_id": 36116897, "question_id": 36115639, "link": "https://stackoverflow.com/questions/36115639/maximum-clique-finder-in-haskell-parse-error/36116897#36116897", "title": "Maximum Clique finder in Haskell - parse error", "body": "<p>As I can see there is a bit more wrong with your code than just the error you get:</p>\n\n<ul>\n<li><p>first of all as the comment already says <code>'</code> are reserved for single characters <code>Char</code>, the syntax you are looking for is <code>`res`</code>.</p></li>\n<li><p>secondly I saw you are using tabs, newer versions of the ghc compiler will warn you about that, usually nowadays people use spaces (this is mostly a matter of taste and it is up to you)</p></li>\n</ul>\n\n<p>I have slightly reordered your code and modified it in such a way it compiles. The <code>undefined</code> will raise a run-time error, but this state is better than a non-compiling one.</p>\n\n<pre><code>type Clique = [Vertex]\ntype Vertex = Int\n\nclass Graph g where\n  size      :: g -&gt; Int\n  vertices  :: g -&gt; [Vertex]\n  connected :: g -&gt; Vertex -&gt; Vertex -&gt; Bool\n</code></pre>\n\n<p>I usually organize my code in a way that <code>type</code>/<code>data</code>/<code>class</code> declarations are on top of my file and the rest below that.</p>\n\n<p>Syntax wise the next error you have is using upper case letters for variable names - this is not allowed in haskell. Types start with upper case variables with lower case.</p>\n\n<p><code>bron</code> is a tricky function and I honestly cannot quite figure out what you want to do there are two things that make this hard to figure out.</p>\n\n<ol>\n<li><p>You have 'variables' <code>r</code> and <code>r</code> in both swarming and loop - it seems that they should be not the same, whereas <code>p</code> should be always the same.\nName shadowing is not a syntactic problem but a logical, it makes it easier if two different things have not the same name.</p></li>\n<li><p>I see</p>\n\n<pre><code>loop ... = swarming\n           loop\n</code></pre>\n\n<p>this is invalid haskell syntax - what are you going to do with swarming it is not used in the following parts of the code, use <code>let \u2026 in</code> to stitch those two lines together</p></li>\n</ol>\n\n<p>here is the rest of your code <code>bron</code> with a compiling but incomplete implementation</p>\n\n<pre><code>bron :: Graph g =&gt; g -&gt; [Clique]\nbron g = swarming [] (vertices g) []\n  where res :: [Vertex] -&gt; Vertex -&gt; [Vertex]\n        res vs v = filter (connected g v) vs\n\n        swarming :: Clique -&gt; [Vertex] -&gt; [Vertex] -&gt; [Clique]\n        swarming r [] [] = [r]\n        swarming r p x   = loop r x\n          where loop :: [Vertex] -&gt; [Vertex] -&gt; [Clique]\n                loop [] _    = []\n                loop (v:r) x = undefined\n                            -- let sw = swarming (v:x) (p `res` v) (x `res` v)\n                            -- in loop ??\n</code></pre>\n"}], "owner": {"reputation": 185, "user_id": 3070814, "user_type": "registered", "accept_rate": 11, "profile_image": "https://i.stack.imgur.com/MUYJA.png?s=128&g=1", "display_name": "Mihov", "link": "https://stackoverflow.com/users/3070814/mihov"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 143, "favorite_count": 0, "answer_count": 1, "score": 0, "last_activity_date": 1547574397, "creation_date": 1458487445, "last_edit_date": 1458489334, "question_id": 36115639, "link": "https://stackoverflow.com/questions/36115639/maximum-clique-finder-in-haskell-parse-error", "title": "Maximum Clique finder in Haskell - parse error", "body": "<p>I am trying to implement the Bron-Kerbosch algorithm for finding the number of maximum cliques (maximum Clique is a subset of a graph where every two verticies are connected and there is no larger clique containing it)</p>\n\n<p><a href=\"https://en.wikipedia.org/wiki/Bron%E2%80%93Kerbosch_algorithm\" rel=\"nofollow\">https://en.wikipedia.org/wiki/Bron%E2%80%93Kerbosch_algorithm</a></p>\n\n<p>Unfortunately, I get an error : \"parse error on input 'res' \"\nAnd I can't seem to solve it. I have tried to change the tap spaces with normal ones, but it doesn't seem to work. I also don't see any errors? Any ideas?</p>\n\n<pre><code>    type Clique = [Vertex]\nswarming::Clique-&gt;[Vertex]-&gt;[Vertex]-&gt;[Clique]\nswarming R P X =\n    if null P &amp;&amp; null X then [R]\n                        else loop R X\n                    where\n                        loop::[Vertex]-&gt;[Vertex]-&gt;[Clique]\n                        loop[] _    =[]\n                        loop(v:R') X=\n                            swarming (v:R)(P 'res' v)(X 'res' v)\n                            loop P (v:X)\n\ntype Vertex = Int\nclass Graph g where\n    size            ::g-&gt;Int\n    verticies       ::g-&gt;[Vertex]\n    connected       ::g-&gt;Vertex-&gt;Vertex-&gt;Bool\n\nbron::Graph g=&gt;g-&gt;[Clique]\nbron g = swarming[] (verticies g) []\n    where\n        swarming R P X =\n                if null P &amp;&amp; null X then [R]\n                        else loop R X\n                    where\n                        loop::[Vertex]-&gt;[Vertex]-&gt;[Clique]\n                        loop[] _    =[]\n                        loop(v:R) X=\n                            swarming (v:R)(P 'res' v)(X 'res' v)\n                            loop P (v:X)\n                       res::[Vertex]-&gt;Vertex-&gt;[Vertex]\n                       res  vs v = filter(connected g v) vs\n</code></pre>\n"}, {"tags": ["haskell"], "answers": [{"tags": [], "owner": {"reputation": 384463, "user_id": 1126841, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/fa05233b2357f8d11c22ef4cfc7bb85c?s=128&d=identicon&r=PG", "display_name": "chepner", "link": "https://stackoverflow.com/users/1126841/chepner"}, "is_accepted": false, "score": 4, "last_activity_date": 1458482953, "last_edit_date": 1458482953, "creation_date": 1458482526, "answer_id": 36114699, "question_id": 36114625, "link": "https://stackoverflow.com/questions/36114625/why-does-t-foldmap-id-yield-t-m-m-and-not-t-a-m/36114699#36114699", "title": "Why does :t foldMap id yield t m -&gt; m, and not t a -&gt; m", "body": "<p><code>a</code> has no restrictions on it, but <code>m</code> must be a monoid. Since <code>id</code> must return a monoid, it must also take a monoid as an argument as well which means the Foldable must wrap a monoid.</p>\n\n<p>That is, you can only <code>foldMap</code> the function <code>id</code> over a <code>Foldable</code> that consists of monoidal values.</p>\n"}, {"tags": [], "owner": {"reputation": 3609, "user_id": 2565354, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/590ed3229d95cdcaa05a96028c586165?s=128&d=identicon&r=PG", "display_name": "badcook", "link": "https://stackoverflow.com/users/2565354/badcook"}, "is_accepted": true, "score": 5, "last_activity_date": 1458482859, "creation_date": 1458482859, "answer_id": 36114754, "question_id": 36114625, "link": "https://stackoverflow.com/questions/36114625/why-does-t-foldmap-id-yield-t-m-m-and-not-t-a-m/36114754#36114754", "title": "Why does :t foldMap id yield t m -&gt; m, and not t a -&gt; m", "body": "<p><code>id</code> is of type <code>x -&gt; x</code> which means when <code>foldMap</code> takes it as an argument, <code>a</code> becomes constrained to be the same type as <code>m</code>. Call this new type <code>n</code>. Because <code>a</code> is a free type variable, the only constraint we have on <code>n</code> comes from <code>m</code>, namely that <code>n</code> is a monoid.</p>\n\n<p>This results in the type signature <code>(Foldable t, Monoid n) =&gt; t n -&gt; n</code> after removing the initial <code>n -&gt; n</code> due to application on <code>id</code>. This is the type signature you observe (after simple relabeling of <code>n</code> to be <code>m</code> again since the type variable names are arbitrary).</p>\n"}], "owner": {"reputation": 22825, "user_id": 992687, "user_type": "registered", "accept_rate": 96, "profile_image": "https://i.stack.imgur.com/0Da71.png?s=128&g=1", "display_name": "The Unfun Cat", "link": "https://stackoverflow.com/users/992687/the-unfun-cat"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 55, "favorite_count": 0, "accepted_answer_id": 36114754, "answer_count": 2, "score": 1, "last_activity_date": 1458483556, "creation_date": 1458482034, "last_edit_date": 1458483556, "question_id": 36114625, "link": "https://stackoverflow.com/questions/36114625/why-does-t-foldmap-id-yield-t-m-m-and-not-t-a-m", "title": "Why does :t foldMap id yield t m -&gt; m, and not t a -&gt; m", "body": "<p><code>foldMap</code> has the following type:</p>\n\n<pre><code>foldMap :: (Foldable t, Monoid m) =&gt; (a -&gt; m) -&gt; t a -&gt; m\n</code></pre>\n\n<p>If you partially apply <code>id</code> to foldMap you get</p>\n\n<pre><code>foldMap id :: (Foldable t, Monoid m) =&gt; t m -&gt; m\n</code></pre>\n\n<p>Why does the <code>t a</code> change to a <code>t m</code> when applying <code>id</code>? </p>\n"}, {"tags": ["parsing", "haskell"], "answers": [{"comments": [{"owner": {"reputation": 13807, "user_id": 2407038, "user_type": "registered", "accept_rate": 64, "profile_image": "https://www.gravatar.com/avatar/538f6f4a9aa43841841de7d8e8b169fc?s=128&d=identicon&r=PG&f=1", "display_name": "user2407038", "link": "https://stackoverflow.com/users/2407038/user2407038"}, "edited": false, "score": 0, "creation_date": 1458499299, "post_id": 36116286, "comment_id": 59876218, "body": "Just to point out, this will be horribly inefficient - <code>p1</code> is almost always being parsed twice. The problem is more basic - if a negative integer is not valid, then why parse the negative symbol at all? And if you would like to report negative integers errors specially (so you must parse the negative sign) you should use <code>parserFail</code> (and not <code>ispositive &lt;$&gt; ..</code> - the <code>Nothing</code> doesn&#39;t represent an error in the way you think here) when you encounter a negative integer - this will cause an actual parser failure, right after the negative integer. <code>&lt;?&gt;</code> can&#39;t cause a parser to fail."}], "tags": [], "owner": {"reputation": 2334, "user_id": 2397162, "user_type": "registered", "accept_rate": 61, "profile_image": "https://www.gravatar.com/avatar/665b976c79d0c9c842b131a2df510c3c?s=128&d=identicon&r=PG", "display_name": "niceman", "link": "https://stackoverflow.com/users/2397162/niceman"}, "is_accepted": true, "score": 1, "last_activity_date": 1458491491, "last_edit_date": 1458491491, "creation_date": 1458490936, "answer_id": 36116286, "question_id": 36114480, "link": "https://stackoverflow.com/questions/36114480/parsec-produce-strange-errors-when-trying-to-handle-maybe-as-parseerror/36116286#36116286", "title": "parsec produce strange errors when trying to handle Maybe as ParseError", "body": "<p>I have found the solution, the cause of is that the first parser gets run and consumes input even when failing.  </p>\n\n<p>The solution was to use <code>lookAhead</code> like this:    </p>\n\n<pre><code>(&lt;!&gt;) :: (Monad m,Stream a m t) =&gt; ParsecT a b m (Maybe c) -&gt; String -&gt; ParsecT a b m c\n(&lt;!&gt;) p1 msg =  ((lookAhead p1) &gt;&gt;= (parserfrommaybe msg)) *&gt; (p1 &gt;&gt;= (parserfrommaybe msg))\n</code></pre>\n\n<p>if <code>lookAhead p1</code> returns <code>Nothing</code> then the first argument of <code>*&gt;</code> would fail without consuming input because of <code>lookAhead</code>, now if <code>lookAhead p1</code> returns <code>Just res</code> then it would succeed again without consuming input and the result would be obtained from the second argument of <code>*&gt;</code>.  </p>\n\n<p>ofcourse I had to change <code>parserfrommaybe</code> type annotation to <code>(Monad m) =&gt; String -&gt; (Maybe c) -&gt; ParsecT a b m c</code> to satisfy ghc.  </p>\n"}], "owner": {"reputation": 2334, "user_id": 2397162, "user_type": "registered", "accept_rate": 61, "profile_image": "https://www.gravatar.com/avatar/665b976c79d0c9c842b131a2df510c3c?s=128&d=identicon&r=PG", "display_name": "niceman", "link": "https://stackoverflow.com/users/2397162/niceman"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 56, "favorite_count": 0, "accepted_answer_id": 36116286, "answer_count": 1, "score": 2, "last_activity_date": 1458491491, "creation_date": 1458481290, "question_id": 36114480, "link": "https://stackoverflow.com/questions/36114480/parsec-produce-strange-errors-when-trying-to-handle-maybe-as-parseerror", "title": "parsec produce strange errors when trying to handle Maybe as ParseError", "body": "<p>If I have this code :  </p>\n\n<pre><code>import Text.Parsec\n\nispositive a = if (a&lt;0) then Nothing else (Just a)\n\nf a b = a+b  \n\nparserfrommaybe :: String -&gt; (Maybe c) -&gt; Parsec a b c\nparserfrommaybe msg Nothing  = fail msg\nparserfrommaybe _ (Just res)  = return res    \n\n(&lt;!&gt;) :: Parsec a b (Maybe c) -&gt; String -&gt; Parsec a b c\n(&lt;!&gt;) p1 msg = p1 &gt;&gt;= (parserfrommaybe msg)    \n\nintegermaybeparser = (ispositive &lt;$&gt; integer) &lt;!&gt; \"negative numbers are not allowed\"\ntestparser = f &lt;$&gt; (integermaybeparser &lt;* whiteSpace) &lt;*&gt; integermaybeparser\n</code></pre>\n\n<p>when I test <code>testparser</code> with input like this \"-1 3\" it gives :  </p>\n\n<pre><code>Left (line 1, column 4):\nunexpected \"3\"\nnegative numbers are not allowed\n</code></pre>\n\n<p>I expected it to give error on Column 1 and give the error message without the sentence \"unexpected 3\" but it seems parsec continued parsing.  </p>\n\n<p>Why did this happen ? and how to make parsec give the error message I expect ?  </p>\n"}, {"tags": ["haskell", "events", "gtk", "gtk2hs"], "comments": [{"owner": {"reputation": 13626, "user_id": 492865, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/5c69a2080e68c8606961a18aba3a08ec?s=128&d=identicon&r=PG", "display_name": "Yuras", "link": "https://stackoverflow.com/users/492865/yuras"}, "edited": false, "score": 0, "creation_date": 1458481536, "post_id": 36114452, "comment_id": 59869656, "body": "Could you please provide a link to documentation where it is marked as deprecated? <code>onExpose</code> lives in <code>gtk</code> package, but <code>gtk3</code> uses <code>exposeEvent</code> instead. I don&#39;t see any deprecation notice in docs."}, {"owner": {"reputation": 2337, "user_id": 3595992, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/a8fc8a00391b1282338f66de57e3fea0?s=128&d=identicon&r=PG&f=1", "display_name": "JeanJouX", "link": "https://stackoverflow.com/users/3595992/jeanjoux"}, "reply_to_user": {"reputation": 13626, "user_id": 492865, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/5c69a2080e68c8606961a18aba3a08ec?s=128&d=identicon&r=PG", "display_name": "Yuras", "link": "https://stackoverflow.com/users/492865/yuras"}, "edited": false, "score": 0, "creation_date": 1458483124, "post_id": 36114452, "comment_id": 59870175, "body": "the link is : <a href=\"https://hackage.haskell.org/package/gtk-0.14.2/docs/Graphics-UI-Gtk-Abstract-Widget.html#v:onExpose\" rel=\"nofollow noreferrer\">hackage.haskell.org/package/gtk-0.14.2/docs/&hellip;</a>"}, {"owner": {"reputation": 13626, "user_id": 492865, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/5c69a2080e68c8606961a18aba3a08ec?s=128&d=identicon&r=PG", "display_name": "Yuras", "link": "https://stackoverflow.com/users/492865/yuras"}, "edited": false, "score": 0, "creation_date": 1458484061, "post_id": 36114452, "comment_id": 59870462, "body": "Ah, the whole section is deprecated, I never noticed that. Usually the <code>DEPRECATED</code> pragma is used for that. Anyway, <code>exposeEvent</code> is the way to go."}], "answers": [{"tags": [], "owner": {"reputation": 13626, "user_id": 492865, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/5c69a2080e68c8606961a18aba3a08ec?s=128&d=identicon&r=PG", "display_name": "Yuras", "link": "https://stackoverflow.com/users/492865/yuras"}, "is_accepted": true, "score": 3, "last_activity_date": 1458483985, "creation_date": 1458483985, "answer_id": 36114934, "question_id": 36114452, "link": "https://stackoverflow.com/questions/36114452/onexpose-function-deprecated/36114934#36114934", "title": "onExpose function deprecated", "body": "<p>You should use <a href=\"https://hackage.haskell.org/package/gtk-0.14.2/docs/Graphics-UI-Gtk-Gdk-EventM.html#t:EventM\" rel=\"nofollow\">new event handling API</a>. In particular you should install a handler for <a href=\"https://hackage.haskell.org/package/gtk-0.14.2/docs/Graphics-UI-Gtk-Abstract-Widget.html#v:exposeEvent\" rel=\"nofollow\"><code>exposeEvent</code></a>, like the next:</p>\n\n<pre><code>on canvas exposeEvent $ do\n  -- do rendering here...\n  return True\n</code></pre>\n\n<p>The same API is provided both by <code>gtk</code> and <code>gtk3</code> packages.</p>\n"}], "owner": {"reputation": 2337, "user_id": 3595992, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/a8fc8a00391b1282338f66de57e3fea0?s=128&d=identicon&r=PG&f=1", "display_name": "JeanJouX", "link": "https://stackoverflow.com/users/3595992/jeanjoux"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 193, "favorite_count": 0, "accepted_answer_id": 36114934, "answer_count": 1, "score": 2, "last_activity_date": 1519190601, "creation_date": 1458481180, "question_id": 36114452, "link": "https://stackoverflow.com/questions/36114452/onexpose-function-deprecated", "title": "onExpose function deprecated", "body": "<p>I'm using Gtk2Hs to build a GUI drawing some picture in a window. I use the function <code>onExpose</code> to connect the expose event to the redrawing function.    </p>\n\n<pre><code>onExpose canvas $ \\_ -&gt; do\n    refreshArea canvas ... \n    return True\n</code></pre>\n\n<p>Things are working but in reading the Gtk2Hs documentation, I saw that this function is deprecated and will disappear in next version of Gtk2Hs.</p>\n\n<p><strong>Do you know how to replace the <code>onExpose</code> function to connect the expose event to my funtion for a long time compatibility?</strong></p>\n"}, {"tags": ["http", "haskell"], "comments": [{"owner": {"reputation": 4068, "user_id": 2219133, "user_type": "registered", "accept_rate": 57, "profile_image": "https://i.stack.imgur.com/Bpzyc.png?s=128&g=1", "display_name": "ngasull", "link": "https://stackoverflow.com/users/2219133/ngasull"}, "edited": false, "score": 0, "creation_date": 1458510355, "post_id": 36113992, "comment_id": 59880092, "body": "To answer my additional question in the edit: I can&#39;t try to read until EOF because it&#39;s the server&#39;s role to close the connection (thus, we would only wait for nothing). Instead, if the client specifies the <code>Content-Length</code> header, we would read the number of bytes specified to get the body. This also explains why <code>hGetContents</code> hung the program."}, {"owner": {"reputation": 13807, "user_id": 2407038, "user_type": "registered", "accept_rate": 64, "profile_image": "https://www.gravatar.com/avatar/538f6f4a9aa43841841de7d8e8b169fc?s=128&d=identicon&r=PG&f=1", "display_name": "user2407038", "link": "https://stackoverflow.com/users/2407038/user2407038"}, "edited": false, "score": 0, "creation_date": 1458513968, "post_id": 36113992, "comment_id": 59881301, "body": "You are closing the handle before everything is written. When you close the handle, you also close the connection. Removing <code>hClose h</code> makes it work 100% of the time on my machine. The solution <i>in practice</i> is to use a higher level http server library and have it worry about these sorts of things."}], "answers": [{"comments": [{"owner": {"reputation": 4068, "user_id": 2219133, "user_type": "registered", "accept_rate": 57, "profile_image": "https://i.stack.imgur.com/Bpzyc.png?s=128&g=1", "display_name": "ngasull", "link": "https://stackoverflow.com/users/2219133/ngasull"}, "edited": false, "score": 0, "creation_date": 1458503143, "post_id": 36117783, "comment_id": 59877464, "body": "Thanks for these nice improvements! So <code>drainHeaders</code> does the job and that&#39;s great news for me :) but my initial purpose actually was to send the request&#39;s content back to the client. I&#39;ll paste in the question the code I used to read the handle. The problem is I don&#39;t manage to finish reading the handle and everything is printed in chaos when I kill the program."}, {"owner": {"reputation": 49501, "user_id": 784338, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/ae195ac7c8a5e9002a808544572cc5fc?s=128&d=identicon&r=PG", "display_name": "Daniel Gratzer", "link": "https://stackoverflow.com/users/784338/daniel-gratzer"}, "reply_to_user": {"reputation": 4068, "user_id": 2219133, "user_type": "registered", "accept_rate": 57, "profile_image": "https://i.stack.imgur.com/Bpzyc.png?s=128&g=1", "display_name": "ngasull", "link": "https://stackoverflow.com/users/2219133/ngasull"}, "edited": false, "score": 1, "creation_date": 1458506137, "post_id": 36117783, "comment_id": 59878613, "body": "@blint You don&#39;t want to take the approach you&#39;re currently doing because the socket isn&#39;t going to reach eof initially: instead the user will explicitly end the current message but leave the handle open for further communication. That&#39;s why my code explicitly checks for a line consisting of just <code>\\r\\n</code>. In order to fix this in your code I think you can just adapt my code to accumulate <code>line</code> values into a list and call <code>unlines</code> at the end. @blint"}, {"owner": {"reputation": 49501, "user_id": 784338, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/ae195ac7c8a5e9002a808544572cc5fc?s=128&d=identicon&r=PG", "display_name": "Daniel Gratzer", "link": "https://stackoverflow.com/users/784338/daniel-gratzer"}, "reply_to_user": {"reputation": 4068, "user_id": 2219133, "user_type": "registered", "accept_rate": 57, "profile_image": "https://i.stack.imgur.com/Bpzyc.png?s=128&g=1", "display_name": "ngasull", "link": "https://stackoverflow.com/users/2219133/ngasull"}, "edited": false, "score": 0, "creation_date": 1458506768, "post_id": 36117783, "comment_id": 59878845, "body": "I suspect you may get that interleaving behaviour because of something hideous involving lazy IO but I&#39;m not sure"}, {"owner": {"reputation": 4068, "user_id": 2219133, "user_type": "registered", "accept_rate": 57, "profile_image": "https://i.stack.imgur.com/Bpzyc.png?s=128&g=1", "display_name": "ngasull", "link": "https://stackoverflow.com/users/2219133/ngasull"}, "edited": false, "score": 0, "creation_date": 1458509986, "post_id": 36117783, "comment_id": 59879954, "body": "I don&#39;t, indeed. After checking <a href=\"https://www.w3.org/Protocols/rfc2616/rfc2616-sec4.html#sec4.4\" rel=\"nofollow noreferrer\">the specs of HTTP</a> I eventually got why: body should be read only if a content-length is mentioned. I guess trying to read everything leaves the connection open until it times out. Thanks again, I&#39;ll make good use of your precisions!"}], "tags": [], "owner": {"reputation": 49501, "user_id": 784338, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/ae195ac7c8a5e9002a808544572cc5fc?s=128&d=identicon&r=PG", "display_name": "Daniel Gratzer", "link": "https://stackoverflow.com/users/784338/daniel-gratzer"}, "is_accepted": true, "score": 3, "last_activity_date": 1458498545, "last_edit_date": 1495539909, "creation_date": 1458498545, "answer_id": 36117783, "question_id": 36113992, "link": "https://stackoverflow.com/questions/36113992/basic-listenon-http-server-recv-failure-connection-reset-by-peer/36117783#36117783", "title": "Basic `listenOn` HTTP server &quot;Recv failure: Connection reset by peer&quot;", "body": "<p>The error seems to be that you are not fully reading the data the client sends upon making a get-request as described in this <a href=\"https://stackoverflow.com/questions/33360721/connection-reset-by-peer-when-benchmarking-a-simple-rust-http-server-with-ab?rq=1\">answer for Rust</a>. The solution proposed there is basically to write a small loop which drains the header from the handle before you respond. The Haskell version is</p>\n\n<pre><code>drainHeaders :: Handle -&gt; IO ()\ndrainHeaders h = do\n  line &lt;- hGetLine h\n  if line == \"\\r\" then return () else drainHeaders h\n</code></pre>\n\n<p>so then your code may be written</p>\n\n<pre><code>import Control.Concurrent\nimport Control.Exception (bracket)\nimport Control.Monad\nimport Network\nimport System.IO\n\nmain = withSocketsDo $\n  bracket (listenOn (PortNumber 8080)) sClose loop\n\nloop :: Socket -&gt; IO ()\nloop sock = do\n  (handle, _host, _port) &lt;- accept sock\n  -- Handle is automatically closed now even in the face of async exns\n  forkFinally (handleRequest handle) (const $ hClose handle)\n  loop sock\n\ndrainHeaders :: Handle -&gt; IO ()\ndrainHeaders h = do\n  line &lt;- hGetLine h -- Strips off a trailing \\n\n  if line == \"\\r\" then return () else drainHeaders h\n\nhandleRequest :: Handle -&gt; IO ()\nhandleRequest h = do\n  drainHeaders h\n  hPutStr h $ httpRequest \"Pong!\\n\"\n  hFlush h\n\nhttpRequest :: String -&gt; String\nhttpRequest body =\n  mconcat [ \"HTTP/1.0 200 OK\\r\\nContent-Length: \"\n          , (show . length) body\n          , \"\\r\\n\\r\\n\"\n          , body\n          , \"\\r\\n\" ]\n</code></pre>\n\n<p>I also took the liberty of tweaking the code to make it a bit more exception safe by using <code>forkFinally</code> and <code>bracket</code> to handle closing things in the face of exceptions: I doubt it's 100% perfect but it's now a little bit cleaner.</p>\n"}], "owner": {"reputation": 4068, "user_id": 2219133, "user_type": "registered", "accept_rate": 57, "profile_image": "https://i.stack.imgur.com/Bpzyc.png?s=128&g=1", "display_name": "ngasull", "link": "https://stackoverflow.com/users/2219133/ngasull"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 563, "favorite_count": 0, "accepted_answer_id": 36117783, "answer_count": 1, "score": 2, "last_activity_date": 1458503608, "creation_date": 1458478788, "last_edit_date": 1458503608, "question_id": 36113992, "link": "https://stackoverflow.com/questions/36113992/basic-listenon-http-server-recv-failure-connection-reset-by-peer", "title": "Basic `listenOn` HTTP server &quot;Recv failure: Connection reset by peer&quot;", "body": "<p>While diving into Haskell's <code>Network</code> library, I'm making a very simple HTTP server based on info from <a href=\"https://wiki.haskell.org/Simple_Servers\" rel=\"nofollow\">this link</a>.</p>\n\n<pre><code>import Control.Concurrent\nimport Control.Monad\nimport Network\nimport System.IO\n\nmain = withSocketsDo $ listenOn (PortNumber 8080) &gt;&gt;= loop\n\nloop :: Socket -&gt; IO ()\nloop sock = do\n  (h,_,_) &lt;- accept sock\n  forkIO $ handleRequest h\n  loop sock\n\nhandleRequest :: Handle -&gt; IO ()\nhandleRequest h = do\n  hPutStr h $ httpRequest \"Pong!\\n\"\n  hFlush h\n  hClose h\n\nhttpRequest :: String -&gt; String\nhttpRequest body = \"HTTP/1.0 200 OK\\r\\n\"\n  ++ \"Content-Length: \" ++ (show.length) body ++ \"\\r\\n\"\n  ++ \"\\r\\n\" ++ body ++ \"\\r\\n\"\n</code></pre>\n\n<p>However, even though I manage to get some response, the handles seems to be closed unexpectedly soon (sometimes?) as curl tells me:</p>\n\n<pre><code>$ curl localhost:8080\nPong!\ncurl: (56) Recv failure: Connection reset by peer\n</code></pre>\n\n<p><em>NB: Sometimes I don't even get the message (<code>Pong!</code>) or just a part of it. Sometimes, it works... but if I run 100 <code>curl</code>s in a row I eventually get some connection resets.</em></p>\n\n<p>Why is the connection reset? I tried with and without <code>forkIO</code> without success. Have I missed some essential about IO streams in Haskell? Thanks!</p>\n\n<p><em>OS: recent Ubuntu ; GHC: 7.8.4</em></p>\n\n<p><strong>--- Edit: ---</strong></p>\n\n<p>jozefg identified that the problem came from draining the request's contents! However I'd like to send this content back to the client and it hangs while using the following code:</p>\n\n<pre><code>handleRequest :: Handle -&gt; IO ()\nhandleRequest h = do\n  contents &lt;- getHandleContents h\n  hPutStr h $ httpRequest contents\n  hFlush h\n  hClose h\n\ngetHandleContents :: Handle -&gt; IO String\ngetHandleContents h = do\n  iseof &lt;- hIsEOF h\n  if iseof\n    then return []\n    else do\n      newLine &lt;- hGetLine h\n      nextLines &lt;- getHandleContents h\n      return $ newLine ++ '\\n' : nextLines\n</code></pre>\n\n<p>Moreover I had no success draining the whole contents using <code>hGetContents</code>. Any idea why?</p>\n"}, {"tags": ["haskell"], "comments": [{"owner": {"reputation": 22825, "user_id": 992687, "user_type": "registered", "accept_rate": 96, "profile_image": "https://i.stack.imgur.com/0Da71.png?s=128&g=1", "display_name": "The Unfun Cat", "link": "https://stackoverflow.com/users/992687/the-unfun-cat"}, "edited": false, "score": 0, "creation_date": 1458475761, "post_id": 36113469, "comment_id": 59867716, "body": "Waah, length (1, 2) is 1."}, {"owner": {"reputation": 34889, "user_id": 86604, "user_type": "registered", "accept_rate": 80, "profile_image": "https://www.gravatar.com/avatar/329af917389e6cf8e146c03012f5319a?s=128&d=identicon&r=PG", "display_name": "Ingo", "link": "https://stackoverflow.com/users/86604/ingo"}, "edited": false, "score": 0, "creation_date": 1458475765, "post_id": 36113469, "comment_id": 59867719, "body": "Why not? What would you expect?"}, {"owner": {"reputation": 22825, "user_id": 992687, "user_type": "registered", "accept_rate": 96, "profile_image": "https://i.stack.imgur.com/0Da71.png?s=128&g=1", "display_name": "The Unfun Cat", "link": "https://stackoverflow.com/users/992687/the-unfun-cat"}, "reply_to_user": {"reputation": 34889, "user_id": 86604, "user_type": "registered", "accept_rate": 80, "profile_image": "https://www.gravatar.com/avatar/329af917389e6cf8e146c03012f5319a?s=128&d=identicon&r=PG", "display_name": "Ingo", "link": "https://stackoverflow.com/users/86604/ingo"}, "edited": false, "score": 0, "creation_date": 1458475818, "post_id": 36113469, "comment_id": 59867733, "body": "In [1]: len((1, 2)) Out[1]: 2"}, {"owner": {"reputation": 48129, "user_id": 76051, "user_type": "registered", "accept_rate": 91, "profile_image": "https://i.stack.imgur.com/AGDxz.jpg?s=128&g=1", "display_name": "Carsten", "link": "https://stackoverflow.com/users/76051/carsten"}, "edited": false, "score": 1, "creation_date": 1458476162, "post_id": 36113469, "comment_id": 59867841, "body": "As to the why: it&#39;s because <code>Foldable</code> on tuples is basically only looking at the last component of the tuple and ignores all other"}, {"owner": {"reputation": 48129, "user_id": 76051, "user_type": "registered", "accept_rate": 91, "profile_image": "https://i.stack.imgur.com/AGDxz.jpg?s=128&g=1", "display_name": "Carsten", "link": "https://stackoverflow.com/users/76051/carsten"}, "edited": false, "score": 0, "creation_date": 1458476258, "post_id": 36113469, "comment_id": 59867874, "body": "it&#39;s more or less this: <code>instance Foldable ((,) a) -- Defined in \u2018Data.Foldable\u2019 </code> ... you (and many other) might disagree about this definition but it&#39;s useful in some cases and you are free to ignore it if you like"}, {"owner": {"reputation": 100892, "user_id": 745903, "user_type": "registered", "accept_rate": 74, "profile_image": "https://www.gravatar.com/avatar/50933f6638836741e620669b3940410e?s=128&d=identicon&r=PG", "display_name": "leftaroundabout", "link": "https://stackoverflow.com/users/745903/leftaroundabout"}, "edited": false, "score": 1, "creation_date": 1458476292, "post_id": 36113469, "comment_id": 59867882, "body": "@zakyggaps I&#39;d rather say it&#39;s the bad side of defining all those functor instances for tuples (as well as, with similar problems, functions). I tend to think it would have been better to leave that to the far more descriptive equivalents <code>Writer</code> / <code>Reader</code>, where the behaviour wouldn&#39;t surprise anybody, and only make <code>(,)</code> and <code>(-&gt;)</code> instances of <code>Bifunctor</code> and <code>Arrow</code>, respectively."}], "answers": [{"tags": [], "owner": {"reputation": 34889, "user_id": 86604, "user_type": "registered", "accept_rate": 80, "profile_image": "https://www.gravatar.com/avatar/329af917389e6cf8e146c03012f5319a?s=128&d=identicon&r=PG", "display_name": "Ingo", "link": "https://stackoverflow.com/users/86604/ingo"}, "is_accepted": false, "score": 4, "last_activity_date": 1458476297, "creation_date": 1458476297, "answer_id": 36113593, "question_id": 36113469, "link": "https://stackoverflow.com/questions/36113469/why-is-tolist-1-2-2/36113593#36113593", "title": "Why is toList (1, 2) == [2]", "body": "<p>The results do make more sense when you interpret the function names like this:</p>\n\n<p><code>length</code> - how many values will be touched by <code>fmap</code>, <code>fold</code> etc.</p>\n\n<p><code>toList</code> - what elements will be touched by <code>fmap</code>, <code>fold</code> etc.</p>\n\n<p>As long as</p>\n\n<pre><code>length x == length (toList x)\n</code></pre>\n\n<p>the world is fine.</p>\n"}, {"tags": [], "owner": {"reputation": 100892, "user_id": 745903, "user_type": "registered", "accept_rate": 74, "profile_image": "https://www.gravatar.com/avatar/50933f6638836741e620669b3940410e?s=128&d=identicon&r=PG", "display_name": "leftaroundabout", "link": "https://stackoverflow.com/users/745903/leftaroundabout"}, "is_accepted": true, "score": 15, "last_activity_date": 1458477395, "last_edit_date": 1458477395, "creation_date": 1458477009, "answer_id": 36113707, "question_id": 36113469, "link": "https://stackoverflow.com/questions/36113469/why-is-tolist-1-2-2/36113707#36113707", "title": "Why is toList (1, 2) == [2]", "body": "<p><code>(1,2)</code> does not correspend to the list <code>[1,2]</code>. That wouldn't make sense: what would then <code>(True, 3.14)</code> correspend to? You can't have the list <code>[True, 3.14]</code>, because a list can only contain elements of a single type. (Haskell is different from e.g. Python here.)</p>\n\n<p>The only way to pick elements of guaranteed a single type from any tuple is, well, <em>to take only a single element</em>. Hence <code>toList</code>, as generated from the <code>Foldable (a,)</code> instance, takes tuples <code>(a,b)</code> and yields lists <code>[b]</code>. Obviously there's always exactly one <code>b</code> element in such a tuple<sup>&dagger;</sup>.\n<br>You could in principle consider <code>(Int, Int)</code> as a special case where the elements have the same type and hence you can pick two instead of one, but such a special handling would require some highly awkward type-equality checking. And generally, special-case handling is not a good idea.</p>\n\n<p>Arguably, it would have been better not to define the <code>Foldable (a,)</code> instance at all, to avoid this confusing behaviour. Then again, sometimes it's handy to use <code>fold</code> to just get rid of the first tuple element (e.g. some index).</p>\n\n<p><hr>\n<sup>&dagger;</sup><sub>Why use <code>b</code> and not <code>a</code>? Kind of arbitrary? Well, not completely. <code>(a,b)</code> is actually syntactic sugar for <code>(,) a b</code>, hence you can consider <code>(,) a</code> as a functor (whose elements have type <code>b</code>), but you can't have a functor <code>(`(,)`b)</code> whose elements would have type <code>a</code>.\n</sub></p>\n"}, {"tags": [], "owner": {"reputation": 11001, "user_id": 727667, "user_type": "registered", "accept_rate": 88, "profile_image": "https://www.gravatar.com/avatar/2e2cbd3a202d8d1cfe0cc2a9fff86733?s=128&d=identicon&r=PG", "display_name": "gallais", "link": "https://stackoverflow.com/users/727667/gallais"}, "is_accepted": false, "score": 6, "last_activity_date": 1458570805, "creation_date": 1458570805, "answer_id": 36133838, "question_id": 36113469, "link": "https://stackoverflow.com/questions/36113469/why-is-tolist-1-2-2/36133838#36133838", "title": "Why is toList (1, 2) == [2]", "body": "<p>If you are planning to use homogeneous pairs heavily, you may want to declare  a new type which will precisely correspond to them. This way you'll be able to have access to the <code>toList</code> you were expecting.</p>\n\n<pre><code>newtype Pair a = Pair { pair :: (a, a) }\n\ninstance Functor Pair where\n  fmap f (Pair (x, y)) = Pair (f x, f y)\n\ninstance Foldable Pair where\n  foldr f z (Pair (x, y)) = f x $ f y z\n</code></pre>\n\n<p><code>(a, b)</code> is fundamentally different from <code>Pair a</code> or <code>Constant (a, a) b</code> and it is important to clearly document which one you mean in your code if you want typeclass resolution to pick the right instance.</p>\n\n<pre><code>newtype Constant a b = Constant a\n\ninstance Functor (Constant a) where\n  fmap f (Constant a) = Constant a\n\ninstance Foldable (Constant a) where\n  foldr f z _ = z\n</code></pre>\n\n<p>Examples:</p>\n\n<pre><code>length (Constant (1, 2)) == 0\nlength (1, 2)            == 1\nlength (Pair (1, 2))     == 2\n</code></pre>\n"}], "owner": {"reputation": 22825, "user_id": 992687, "user_type": "registered", "accept_rate": 96, "profile_image": "https://i.stack.imgur.com/0Da71.png?s=128&g=1", "display_name": "The Unfun Cat", "link": "https://stackoverflow.com/users/992687/the-unfun-cat"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 449, "favorite_count": 1, "accepted_answer_id": 36113707, "answer_count": 3, "score": 6, "last_activity_date": 1458570805, "creation_date": 1458475700, "question_id": 36113469, "link": "https://stackoverflow.com/questions/36113469/why-is-tolist-1-2-2", "title": "Why is toList (1, 2) == [2]", "body": "<p>As the question says, why is <code>toList (1, 2) == [2]</code>?</p>\n\n<p>I remember something similar happening when fmapping on tuples, but I do not remember why or if it is related.</p>\n"}, {"tags": ["haskell", "polymorphism"], "comments": [{"owner": {"reputation": 13807, "user_id": 2407038, "user_type": "registered", "accept_rate": 64, "profile_image": "https://www.gravatar.com/avatar/538f6f4a9aa43841841de7d8e8b169fc?s=128&d=identicon&r=PG&f=1", "display_name": "user2407038", "link": "https://stackoverflow.com/users/2407038/user2407038"}, "edited": false, "score": 1, "creation_date": 1458506071, "post_id": 36112633, "comment_id": 59878581, "body": "Your problem is one of fundamental design - <code>extractVec</code> takes a string but you want it to return the correct typed vector. There is no way it could expose which type of vector it returned to the outside world. You could write a function of type e.g. <code>Text -&gt; ColumnMemoryStore -&gt; (forall k v . (G.Vector k v, Eq v, Hashable v, Show v) =&gt; k v -&gt; r) -&gt; r</code>, but this only allows you to know the output is <i>some</i> vector type, not which particular type it is (i.e. the only things you can know about the ouput are those which are true for all outputs). In short you are asking for dependent types."}, {"owner": {"reputation": 83, "user_id": 1709852, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/u9sWp.jpg?s=128&g=1", "display_name": "J Ho", "link": "https://stackoverflow.com/users/1709852/j-ho"}, "reply_to_user": {"reputation": 13807, "user_id": 2407038, "user_type": "registered", "accept_rate": 64, "profile_image": "https://www.gravatar.com/avatar/538f6f4a9aa43841841de7d8e8b169fc?s=128&d=identicon&r=PG&f=1", "display_name": "user2407038", "link": "https://stackoverflow.com/users/2407038/user2407038"}, "edited": false, "score": 0, "creation_date": 1458508310, "post_id": 36112633, "comment_id": 59879357, "body": "@user2407038 - thank you, started reading on dependent types and now wishing Idris was production ready :) However, my problem is also kind of the opposite - yes, dependent types would solve it, but maybe there&#39;s a proper way to design this in haskell keeping in mind that groupColumns function doesn&#39;t care what exact vector I&#39;m passing to it, only that it&#39;s a vector - so, kind of what you suggest with the function above. Will look into it with some typeclass combinations, maybe something good will come out of it."}, {"owner": {"reputation": 13807, "user_id": 2407038, "user_type": "registered", "accept_rate": 64, "profile_image": "https://www.gravatar.com/avatar/538f6f4a9aa43841841de7d8e8b169fc?s=128&d=identicon&r=PG&f=1", "display_name": "user2407038", "link": "https://stackoverflow.com/users/2407038/user2407038"}, "edited": false, "score": 1, "creation_date": 1458510661, "post_id": 36112633, "comment_id": 59880210, "body": "<code>groupColumns</code> <i>does</i> care about what exact type of vector it is, because it takes a function of type <code>a -&gt; a -&gt; a</code>. For example how could you write <code>groupColumns (extractVec col1 cms) (+) (extractVec col2 cms)</code>? What if one of the columns contains <code>Text</code> values? If <code>col1 :: Text</code> then you really need dependent types, no matter how you encode the table. OTOH, if you encode the schema at the type level, you can have column selectors and grouping expressions which &quot;know about&quot; types."}, {"owner": {"reputation": 83, "user_id": 1709852, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/u9sWp.jpg?s=128&g=1", "display_name": "J Ho", "link": "https://stackoverflow.com/users/1709852/j-ho"}, "reply_to_user": {"reputation": 13807, "user_id": 2407038, "user_type": "registered", "accept_rate": 64, "profile_image": "https://www.gravatar.com/avatar/538f6f4a9aa43841841de7d8e8b169fc?s=128&d=identicon&r=PG&f=1", "display_name": "user2407038", "link": "https://stackoverflow.com/users/2407038/user2407038"}, "edited": false, "score": 0, "creation_date": 1458511077, "post_id": 36112633, "comment_id": 59880356, "body": "(+) is only applied to col2 values, and is being grouped by col1 values. So, col1 values can be whatever - main thing is that it&#39;s Hashable - while col2 values have to be able to be applied by (a-&gt;a-&gt;a). But your point stands regardless. Encoding schema at the type level works when you know the schema in advance, but when you are trying to implement something database-related where schema should be defined dynamically, it doesn&#39;t really help..."}, {"owner": {"reputation": 13807, "user_id": 2407038, "user_type": "registered", "accept_rate": 64, "profile_image": "https://www.gravatar.com/avatar/538f6f4a9aa43841841de7d8e8b169fc?s=128&d=identicon&r=PG&f=1", "display_name": "user2407038", "link": "https://stackoverflow.com/users/2407038/user2407038"}, "edited": false, "score": 0, "creation_date": 1458512075, "post_id": 36112633, "comment_id": 59880669, "body": "If your schema can truly vary at runtime, you&#39;ll probably be best off with <code>Typeable</code>. E.g. <code>data SomeVec = forall v a . (Typeable v, Typeable a) =&gt; SomeVec (v a)</code> gives you the &quot;shape&quot; of the vector at the type level (which is always the same) but hides all the type information. You don&#39;t need multiple maps then - just <code>HashMap Text SomeVec</code>. You don&#39;t even need a <code>HashMap Text SupportedTypes</code>, since <code>SomeVec</code> stores a representation of the type anyways."}, {"owner": {"reputation": 83, "user_id": 1709852, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/u9sWp.jpg?s=128&g=1", "display_name": "J Ho", "link": "https://stackoverflow.com/users/1709852/j-ho"}, "reply_to_user": {"reputation": 13807, "user_id": 2407038, "user_type": "registered", "accept_rate": 64, "profile_image": "https://www.gravatar.com/avatar/538f6f4a9aa43841841de7d8e8b169fc?s=128&d=identicon&r=PG&f=1", "display_name": "user2407038", "link": "https://stackoverflow.com/users/2407038/user2407038"}, "edited": false, "score": 0, "creation_date": 1458583389, "post_id": 36112633, "comment_id": 59915324, "body": "@user2407038 - thank you for all the ideas, I played around with different options, made progress and then got stuck again - would you mind looking at the follow-up question <a href=\"http://stackoverflow.com/questions/36138376/rankntypes-and-existentials-cant-figure-out-one-final-step\">here</a>? Thanks a bunch!"}], "owner": {"reputation": 83, "user_id": 1709852, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/u9sWp.jpg?s=128&g=1", "display_name": "J Ho", "link": "https://stackoverflow.com/users/1709852/j-ho"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 87, "favorite_count": 2, "answer_count": 0, "score": 1, "last_activity_date": 1458478882, "creation_date": 1458469867, "last_edit_date": 1458478882, "question_id": 36112633, "link": "https://stackoverflow.com/questions/36112633/polymorphic-vector-storage-for-in-memory-column-store-type-of-task", "title": "Polymorphic Vector storage for in-memory column store type of task", "body": "<p>\"My brain is about to explode\" tells me ghc and the feeling is mutual. </p>\n\n<p>There's an aggregation function that works as a charm on polymorphic vectors (in-memory column store context) - takes 2 vectors and groups by unique values of the 1st one while applying function f to values of the 2nd. So, similar to SQL GROUP BY or mongo aggregation. Examples:</p>\n\n<pre><code>\\&gt; groupColumns creg (+) cint\nfromList [(\"EMEA\",345),(\"NA\",681),(\"RoW\",988)]\n\n\\&gt; groupColumns cint (*) cdouble\nfromList [(1,13.0),(2,46.0),(4,16.0),(23,5359.0),(24,528.0),(234,5475.599999999999),(43,18619.0),(12,14.399999999999999),(412,1697.44),(252,-6350.4)]\n</code></pre>\n\n<p>Relevant code:</p>\n\n<pre><code>groupColumns :: (Eq k, G.Vector v k, G.Vector v2 a, Hashable k) =&gt;\n v k -&gt; (a -&gt; a -&gt; a) -&gt; v2 a -&gt; Map.HashMap k a\ngroupColumns xxs f yys = ...\n\ncint :: U.Vector Int64\ncint = U.fromList [1,2,43,234,23,412,24,12,4,252,1,2,43,234,23,412,24,12,4,252]\n\ncdouble :: U.Vector Double\ncdouble = U.fromList [13,23,433,23.4,233,4.12,22,1.2,4,-25.2, 1,2,43,234,23,412,24,12,4,252]\n\ncreg :: V.Vector Text\ncreg = V.fromList [\"EMEA\", \"NA\", \"EMEA\", \"RoW\", \"NA\", \"RoW\", \"EMEA\", \"EMEA\", \"NA\", \"RoW\", \"EMEA\", \"NA\", \"RoW\", \"NA\", \"RoW\", \"NA\", \"RoW\", \"EMEA\", \"NA\", \"EMEA\"]\n</code></pre>\n\n<p>The problem arises when I want to parse a user's input and run an aggregation function built dynamically. Let's say there's a source data table of <code>\"Region\" : Text, \"Revenue\" : Int, \"Country\" : Text, \"Booking Date\" : Int</code>. A user may want to do (pseudocode): 1) <code>groupby \"Region\", \"Country\" sum \"Revenue\"</code> or 2) <code>groupby \"Country\", \"Booking Date\" sum \"Revenue\"</code> etc etc. The issue is that \"Region\" and \"Country\" vectors are <code>V.Vector Text</code> while \"Booking Date\" and \"Revenue\" are <code>U.Vector Int64</code> - so I can't store them in one Hashtable or List and do an obvious thing: get abstract (Vector a) from this one Hashtable or List, pass them to <code>groupColumns</code> function (which already perfectly supports polymorphic vectors!!!) and get a result. I don't care about specific type here for groupColumns, I only care that whatever I'm passing supports Vector interface (by being part of the type family). </p>\n\n<p>So, it boils down to: <strong>I need some sort of Storage type that 1) given <code>Text</code> (name of the vector) 2) gives back <code>U.Vector a</code> or <code>V.Vector b</code> without explicit type signature</strong>. In the ideal world it'd be just one line call: <code>groupColumns (extractVec col1 cms) func (extractVec col2 cms)</code>, where <code>col1</code> and <code>col2</code> is Text parsed from user input and <code>func</code> is a function dynamically set from parsed user input. </p>\n\n<p>In the real world I tried: </p>\n\n<p>1) heterogenous tricks (of the <code>Data HV where HV :: (Vector v a) =&gt; v a -&gt; HV</code> sort) but there both mine and ghc brains start to explode because various type variables escape their scope (e.g., in the f function that is passed to groupColumns) - even though getting <code>(HV U.Vector Int64)</code> from <code>[(Text, HV a)]</code> is straightforward.</p>\n\n<p>2) Typed vector storage, like this:</p>\n\n<pre><code>data ColumnMemoryStore = ColumnMemoryStore {\n    intCols :: Map.HashMap Text (U.Vector Int64),\n    doubleCols :: Map.HashMap Text (U.Vector Double),\n    textCols :: Map.HashMap Text (V.Vector Text),\n    typeSchema :: Map.HashMap Text SupportedTypes -- helper map from column names to their types\n\n}\n</code></pre>\n\n<p>with polymorphic <code>extractVector</code> function, so I can do <code>extractVector name cms :: U.Vector Int64</code> - and it automagically returns U.Vector Int64 from the intCols and respectively for others. Here, the problem is that after parsing user input I have to analyze what is the Type of the vectors he wants to aggregate by (by consulting <code>typeSchema</code>) and give corresponding type signatures to <code>extractVector</code> calls - which turns into absolutely, terrifyingly ugly spaghetti of <code>case</code> statements that makes me want to write everything in C as it will be 5x shorter. Here's a sample:</p>\n\n<pre><code>let t1 = checkColType' colname (cms gs)\n            case t1 of\n                PText -&gt; let col = extractVec colname (cms gs) :: V.Vector T.Text\n                             result = groupColumns col (+) aggCol\n                         in outputStrLn $ show result\n                PInt -&gt; let col = extractVec colname (cms gs) :: U.Vector Int64\n                            result = groupColumns col (+) aggCol\n                        in outputStrLn $ show result\n</code></pre>\n\n<p>etc etc etc. This compiles and works but it's ugly, non-functional and boilerplate. I mean, the ONLY reason for doing this is the need to specify return type of <code>extractVec</code> explicitly while <em>then</em> it's <em>never</em> used by <code>groupColumns</code>, which simply expects anything that's <code>Vector v a</code>! There has to be a way around it...</p>\n\n<p>3) Should I even think about Data.Reflection or something similar but no less scary? Template Haskell?</p>\n\n<p>I am sorry for a long description, but I spent tons of time researching and feel like completely stuck - which probably (hopefully) means I'm missing something pretty obvious (like not enough abstraction levels) and those of you who think in Haskell can at least point me to the correct approach of solving this issue. Thanks a lot!</p>\n"}, {"tags": ["haskell", "dll", "ghc", "cabal", "haskell-stack"], "comments": [{"owner": {"reputation": 13807, "user_id": 2407038, "user_type": "registered", "accept_rate": 64, "profile_image": "https://www.gravatar.com/avatar/538f6f4a9aa43841841de7d8e8b169fc?s=128&d=identicon&r=PG&f=1", "display_name": "user2407038", "link": "https://stackoverflow.com/users/2407038/user2407038"}, "edited": false, "score": 0, "creation_date": 1458499906, "post_id": 36111808, "comment_id": 59876430, "body": "Something like <code>ghc-options: -L&lt;path&gt; -llib64</code> might work. Since you know how to compile it from the command line.. just tell cabal to do exactly that. I guess this is at most a workaround and at best an ugly hack. But things rarely play well with Windows and the FFI when it comes to the Haskell toolchain.. if the hack works for you I&#39;d count myself lucky."}, {"owner": {"reputation": 37486, "user_id": 371753, "user_type": "registered", "accept_rate": 83, "profile_image": "https://i.stack.imgur.com/znFEK.jpg?s=128&g=1", "display_name": "sclv", "link": "https://stackoverflow.com/users/371753/sclv"}, "edited": false, "score": 0, "creation_date": 1458523519, "post_id": 36111808, "comment_id": 59883699, "body": "@Leonidas can you post your update as an answer and accept this to remove this from the unanswered questions queue? Thanks!"}, {"owner": {"reputation": 945, "user_id": 2899420, "user_type": "registered", "accept_rate": 89, "profile_image": "https://www.gravatar.com/avatar/33ce7901ec7cd1195561a930201ae56b?s=128&d=identicon&r=PG&f=1", "display_name": "Leonid", "link": "https://stackoverflow.com/users/2899420/leonid"}, "reply_to_user": {"reputation": 13807, "user_id": 2407038, "user_type": "registered", "accept_rate": 64, "profile_image": "https://www.gravatar.com/avatar/538f6f4a9aa43841841de7d8e8b169fc?s=128&d=identicon&r=PG&f=1", "display_name": "user2407038", "link": "https://stackoverflow.com/users/2407038/user2407038"}, "edited": false, "score": 0, "creation_date": 1458543892, "post_id": 36111808, "comment_id": 59889371, "body": "@user2407038, this does not work. Cabal can&#39;t parse file..."}, {"owner": {"reputation": 945, "user_id": 2899420, "user_type": "registered", "accept_rate": 89, "profile_image": "https://www.gravatar.com/avatar/33ce7901ec7cd1195561a930201ae56b?s=128&d=identicon&r=PG&f=1", "display_name": "Leonid", "link": "https://stackoverflow.com/users/2899420/leonid"}, "reply_to_user": {"reputation": 37486, "user_id": 371753, "user_type": "registered", "accept_rate": 83, "profile_image": "https://i.stack.imgur.com/znFEK.jpg?s=128&g=1", "display_name": "sclv", "link": "https://stackoverflow.com/users/371753/sclv"}, "edited": false, "score": 0, "creation_date": 1458544020, "post_id": 36111808, "comment_id": 59889417, "body": "@sclv, I think that it is not an answer. Package is not built yet. I&#39;m studying <code>Setup.hs</code> now, maybe it is the clue."}, {"owner": {"reputation": 37486, "user_id": 371753, "user_type": "registered", "accept_rate": 83, "profile_image": "https://i.stack.imgur.com/znFEK.jpg?s=128&g=1", "display_name": "sclv", "link": "https://stackoverflow.com/users/371753/sclv"}, "edited": false, "score": 0, "creation_date": 1458544235, "post_id": 36111808, "comment_id": 59889523, "body": "Ah, gotcha, I thought the update meant you solved it. Sorry for the confusion"}, {"owner": {"reputation": 37486, "user_id": 371753, "user_type": "registered", "accept_rate": 83, "profile_image": "https://i.stack.imgur.com/znFEK.jpg?s=128&g=1", "display_name": "sclv", "link": "https://stackoverflow.com/users/371753/sclv"}, "edited": false, "score": 0, "creation_date": 1458544388, "post_id": 36111808, "comment_id": 59889590, "body": "Speculative comment -- if you&#39;re getting <code>lib64</code> turning into <code>cabal</code> looking for <code>liblib64</code> what happens if you just put <code>64</code>?"}, {"owner": {"reputation": 945, "user_id": 2899420, "user_type": "registered", "accept_rate": 89, "profile_image": "https://www.gravatar.com/avatar/33ce7901ec7cd1195561a930201ae56b?s=128&d=identicon&r=PG&f=1", "display_name": "Leonid", "link": "https://stackoverflow.com/users/2899420/leonid"}, "reply_to_user": {"reputation": 37486, "user_id": 371753, "user_type": "registered", "accept_rate": 83, "profile_image": "https://i.stack.imgur.com/znFEK.jpg?s=128&g=1", "display_name": "sclv", "link": "https://stackoverflow.com/users/371753/sclv"}, "edited": false, "score": 0, "creation_date": 1458545370, "post_id": 36111808, "comment_id": 59890031, "body": "@sclv, <code>lib</code> is not the actual name of the library. I should have chose something less misleading."}], "answers": [{"comments": [{"owner": {"reputation": 37486, "user_id": 371753, "user_type": "registered", "accept_rate": 83, "profile_image": "https://i.stack.imgur.com/znFEK.jpg?s=128&g=1", "display_name": "sclv", "link": "https://stackoverflow.com/users/371753/sclv"}, "edited": false, "score": 0, "creation_date": 1458546533, "post_id": 36125221, "comment_id": 59890501, "body": "Glad you figured this out. Do you think you ran into anything that would qualify as a bug report or feature request for cabal install? I&#39;d be happy to do a little follow-up on reporting it if you can explain what it might be useful to add..."}, {"owner": {"reputation": 945, "user_id": 2899420, "user_type": "registered", "accept_rate": 89, "profile_image": "https://www.gravatar.com/avatar/33ce7901ec7cd1195561a930201ae56b?s=128&d=identicon&r=PG&f=1", "display_name": "Leonid", "link": "https://stackoverflow.com/users/2899420/leonid"}, "reply_to_user": {"reputation": 37486, "user_id": 371753, "user_type": "registered", "accept_rate": 83, "profile_image": "https://i.stack.imgur.com/znFEK.jpg?s=128&g=1", "display_name": "sclv", "link": "https://stackoverflow.com/users/371753/sclv"}, "edited": false, "score": 0, "creation_date": 1458580439, "post_id": 36125221, "comment_id": 59913373, "body": "@sclv, such issue already exists. You can find link in the updated post."}], "tags": [], "owner": {"reputation": 945, "user_id": 2899420, "user_type": "registered", "accept_rate": 89, "profile_image": "https://www.gravatar.com/avatar/33ce7901ec7cd1195561a930201ae56b?s=128&d=identicon&r=PG&f=1", "display_name": "Leonid", "link": "https://stackoverflow.com/users/2899420/leonid"}, "is_accepted": true, "score": 1, "last_activity_date": 1458580273, "last_edit_date": 1458580273, "creation_date": 1458545127, "answer_id": 36125221, "question_id": 36111808, "link": "https://stackoverflow.com/questions/36111808/how-to-link-a-package-with-a-proprietary-dll/36125221#36125221", "title": "How to link a package with a proprietary DLL?", "body": "<p>Just two steps:</p>\n\n<ol>\n<li>Replace <code>\"txmlconnector64.dll\"</code> with <code>\"txmlconnector64\"</code></li>\n<li>In <code>.cabal</code> file set <code>build-type: Custom</code> to allow it to use your <code>Setup.hs</code></li>\n</ol>\n"}], "owner": {"reputation": 945, "user_id": 2899420, "user_type": "registered", "accept_rate": 89, "profile_image": "https://www.gravatar.com/avatar/33ce7901ec7cd1195561a930201ae56b?s=128&d=identicon&r=PG&f=1", "display_name": "Leonid", "link": "https://stackoverflow.com/users/2899420/leonid"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 220, "favorite_count": 0, "accepted_answer_id": 36125221, "answer_count": 1, "score": 2, "last_activity_date": 1458580273, "creation_date": 1458463933, "last_edit_date": 1458572939, "question_id": 36111808, "link": "https://stackoverflow.com/questions/36111808/how-to-link-a-package-with-a-proprietary-dll", "title": "How to link a package with a proprietary DLL?", "body": "<p>I'm writing a Haskell package which depends on a proprietary DLL. I also use <code>stack</code> tool. The library has x86 and x64 versions. According to <a href=\"https://github.com/haskell/cabal/issues/1317\" rel=\"nofollow\">this issue</a> I can't do it by modifying <code>.cabal</code> file. So I'm trying to do it by updating <code>Setup.hs</code>. This is my setup script:</p>\n\n<pre><code>import Distribution.Simple\nimport Distribution.PackageDescription\nimport Distribution.Simple.LocalBuildInfo\nimport System.Directory\n\nupdateExtraLibDirs :: LocalBuildInfo -&gt; IO LocalBuildInfo\nupdateExtraLibDirs localBuildInfo = do\n    let packageDescription = localPkgDescr localBuildInfo\n        test = head $ testSuites packageDescription\n        testBuild = testBuildInfo  test\n    dir &lt;- getCurrentDirectory\n    print $ length $ testSuites packageDescription\n    return localBuildInfo {\n        localPkgDescr = packageDescription {\n            testSuites = [ test {\n                testBuildInfo = testBuild {\n                    extraLibDirs = (dir ++ \"\\\\lib\") : extraLibDirs testBuild,\n                    extraLibs = (\"txmlconnector64.dll\") : extraLibs testBuild\n                }\n            } ]\n        }\n    }\n\n\nmain = defaultMainWithHooks simpleUserHooks {\n          confHook = \\a f -&gt; confHook simpleUserHooks a f &gt;&gt;= updateExtraLibDirs\n          }\n</code></pre>\n\n<p>Then I call:</p>\n\n<pre><code>&gt; stack test\n</code></pre>\n\n<p>This still leads to undefined references during the test suite linkage. Why?</p>\n"}, {"tags": ["haskell", "haste"], "answers": [{"tags": [], "owner": {"reputation": 1369, "user_id": 509928, "user_type": "registered", "accept_rate": 83, "profile_image": "https://www.gravatar.com/avatar/57d816a396798416d079c92adbabdbf3?s=128&d=identicon&r=PG", "display_name": "Dave Compton", "link": "https://stackoverflow.com/users/509928/dave-compton"}, "is_accepted": false, "score": 3, "last_activity_date": 1458449112, "last_edit_date": 1458449112, "creation_date": 1458448498, "answer_id": 36110276, "question_id": 36109550, "link": "https://stackoverflow.com/questions/36109550/how-to-use-haste-hplayground-with-stack/36110276#36110276", "title": "How to use haste / hplayground with stack", "body": "<p>Once you have installed ghc and cabal installed you will need to install the haste compiler as follows ( from <a href=\"http://haste-lang.org/downloads/\" rel=\"nofollow\">http://haste-lang.org/downloads/</a> ):</p>\n\n<pre><code>$ cabal update\n$ cabal install haste-compiler\n$ haste-boot\n</code></pre>\n\n<p>After doing this, \"hastec\" ( the haste compiler ) should be available to use to compile haskell to javascript.  In addition, \"haste-cabal\" ( the haste version of cabal ) should be available to use to install libraries such as haste-perch for use in your programs.</p>\n\n<p>The readme file for haste-perch (<a href=\"https://github.com/agocorona/haste-perch\" rel=\"nofollow\">https://github.com/agocorona/haste-perch</a>) contains the instructions for installing haste-perch.  Those instructions use \"haste-inst\" to install haste-perch but \"haste-inst\" is obsolete ( and no longer exists ).  Use the modified instructions below to install haste-perch:</p>\n\n<pre><code>&gt;git clone http://github.com/agocorona/haste-perch.git\n&gt;cd haste-perch\n&gt;haste-cabal install\n</code></pre>\n\n<p>I was able to install haste-perch and successfully build the example that it came with.</p>\n\n<p>I also tried building hplayground but ran into compile problems that looked as if they were due to the code not being updated to use haste 0.5 .  For example, \"OnClick\" was a valid identifier in earlier versions of haste but not anymore: </p>\n\n<pre><code>src/Haste/HPlay/View.hs:820:45:\n    Not in scope: data constructor \u2018OnClick\u2019\n    Perhaps you meant \u2018Click\u2019 (line 1017)\n</code></pre>\n"}, {"tags": [], "owner": {"reputation": 7245, "user_id": 867208, "user_type": "registered", "accept_rate": 78, "profile_image": "https://www.gravatar.com/avatar/73ff2469d25f133355be32507631ee40?s=128&d=identicon&r=PG", "display_name": "valderman", "link": "https://stackoverflow.com/users/867208/valderman"}, "is_accepted": true, "score": 3, "last_activity_date": 1458554069, "creation_date": 1458554069, "answer_id": 36127764, "question_id": 36109550, "link": "https://stackoverflow.com/questions/36109550/how-to-use-haste-hplayground-with-stack/36127764#36127764", "title": "How to use haste / hplayground with stack", "body": "<p>Haste's event APIs got overhauled between the 0.4 and 0.5 series, and HPlayground is still on 0.4. If you want to use it, you will unfortunately have to fall back to 0.4 until HPlayground gets patched for 0.5.</p>\n\n<p>For getting started in general, you should install the <a href=\"http://haste-lang.org/downloads\" rel=\"nofollow\">pre-build binaries</a> if you're on a non-Linux platform (and probably if you're on a Linux platform as well, since you get man-pages and other niceties); the build process can be tricky and is prone to errors.</p>\n\n<p>Once you've done that, you can refer to the <a href=\"http://haste-lang.org/docs/\" rel=\"nofollow\">docs and resources</a> page on haste-lang.org, which contains links to API docs, video tutorials, source code examples and more.</p>\n"}], "owner": {"reputation": 285, "user_id": 3462133, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/08445007e5a529a2eeab334c7420ff63?s=128&d=identicon&r=PG", "display_name": "Kevin S. Van Horn", "link": "https://stackoverflow.com/users/3462133/kevin-s-van-horn"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 768, "favorite_count": 0, "accepted_answer_id": 36127764, "answer_count": 2, "score": 6, "last_activity_date": 1458554069, "creation_date": 1458440324, "question_id": 36109550, "link": "https://stackoverflow.com/questions/36109550/how-to-use-haste-hplayground-with-stack", "title": "How to use haste / hplayground with stack", "body": "<p>I have some familiarity with Haskell, the language, but not so much with the toolchain. (I played around with Haskell before cabal and stack existed.) I'm told that stack is the tool I should be using to manage Haskell projects. I'm trying to learn the haste library, and I'm getting stymied on the first tutorial I've tried, because I can't get hplayground installed. I created a stack project; my stack.yaml has </p>\n\n<pre><code>extra-deps:\n- ghc-simple-0.3\n- haste-compiler-0.5.3\n- shellmate-0.2.3\n- haste-perch-0.1.0.9\n- hplayground-0.1.3.1\n</code></pre>\n\n<p>and my .cabal file has hplayground listed in the build-depends. But when I run stack build, I get these errors:</p>\n\n<pre><code>Configuring haste-perch-0.1.0.9...\nBuilding haste-perch-0.1.0.9...\nPreprocessing library haste-perch-0.1.0.9...\n\nHaste/Perch.hs:17:15: Warning:\n    -XOverlappingInstances is deprecated: instead use per-instance pragmas OVERLAPPING/OVERLAPPABLE/OVERLAPS\n\nHaste/App/Perch.hs:18:15: Warning:\n    -XOverlappingInstances is deprecated: instead use per-instance pragmas OVERLAPPING/OVERLAPPABLE/OVERLAPS\n[1 of 2] Compiling Haste.App.Perch  ( Haste/App/Perch.hs, .stack-work/dist/x86_64-osx/Cabal-1.22.4.0/build/Haste/App/Perch.o )\n\nHaste/App/Perch.hs:61:15: Not in scope: \u2018newTextElem\u2019\n\nHaste/App/Perch.hs:71:9:\n    Not in scope: \u2018setAttr\u2019\n    Perhaps you meant \u2018jsSetAttr\u2019 (imported from Haste.App)\n\nHaste/App/Perch.hs:76:15:\n    Not in scope: \u2018newElem\u2019\n    Perhaps you meant one of these:\n    \u2018nelem\u2019 (line 75), \u2018notElem\u2019 (imported from Prelude)\n</code></pre>\n\n<p>and a whole lot of similar errors. Any thoughts on what I'm doing wrong?</p>\n\n<p>More broadly: what is a fast, easy way to get up and running with haste for someone who's not experienced with the Haskell toolchain?</p>\n"}, {"tags": ["haskell"], "comments": [{"owner": {"reputation": 2838, "user_id": 3614521, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/AR81q.png?s=128&g=1", "display_name": "Mephy", "link": "https://stackoverflow.com/users/3614521/mephy"}, "edited": false, "score": 5, "creation_date": 1458431560, "post_id": 36108616, "comment_id": 59859192, "body": "<code>:</code> and <code>++</code> have different types and serve different functions. You could write <code>toList l ++ (v : toList r)</code> if you wish, but you can&#39;t use <code>:</code> for two lists."}, {"owner": {"reputation": 100892, "user_id": 745903, "user_type": "registered", "accept_rate": 74, "profile_image": "https://www.gravatar.com/avatar/50933f6638836741e620669b3940410e?s=128&d=identicon&r=PG", "display_name": "leftaroundabout", "link": "https://stackoverflow.com/users/745903/leftaroundabout"}, "reply_to_user": {"reputation": 2838, "user_id": 3614521, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/AR81q.png?s=128&g=1", "display_name": "Mephy", "link": "https://stackoverflow.com/users/3614521/mephy"}, "edited": false, "score": 1, "creation_date": 1458432773, "post_id": 36108616, "comment_id": 59859483, "body": "@Mephy: correct. BTW the parens aren&#39;t necessary since both <code>:</code> and <code>++</code> are <code>infixr 5</code>."}, {"owner": {"reputation": 44013, "user_id": 1477667, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/trgKM.jpg?s=128&g=1", "display_name": "dfeuer", "link": "https://stackoverflow.com/users/1477667/dfeuer"}, "edited": false, "score": 0, "creation_date": 1458433784, "post_id": 36108616, "comment_id": 59859739, "body": "You need to <i>reassociate</i> the <code>++</code> applications until the left operand of each is a singleton. Then you can (essentially) replace each with <code>:</code>."}, {"owner": {"reputation": 61029, "user_id": 625914, "user_type": "registered", "accept_rate": 70, "profile_image": "https://www.gravatar.com/avatar/f1932d8bf4e9dbf779a48b41bbf21592?s=128&d=identicon&r=PG", "display_name": "behzad.nouri", "link": "https://stackoverflow.com/users/625914/behzad-nouri"}, "edited": false, "score": 1, "creation_date": 1458434109, "post_id": 36108616, "comment_id": 59859822, "body": "<a href=\"http://stackoverflow.com/a/35831388/625914\">this solution</a> replaces <code>++</code> with <code>:</code> by defining a Foldable instance. it seems like it is literally same question as yours"}], "answers": [{"tags": [], "owner": {"reputation": 100892, "user_id": 745903, "user_type": "registered", "accept_rate": 74, "profile_image": "https://www.gravatar.com/avatar/50933f6638836741e620669b3940410e?s=128&d=identicon&r=PG", "display_name": "leftaroundabout", "link": "https://stackoverflow.com/users/745903/leftaroundabout"}, "is_accepted": false, "score": 7, "last_activity_date": 1458433642, "creation_date": 1458433642, "answer_id": 36108904, "question_id": 36108616, "link": "https://stackoverflow.com/questions/36108616/replacement-with-in-haskell-error/36108904#36108904", "title": "Replacement &#39;++&#39; with &#39;:&#39; in Haskell. Error", "body": "<p>You can't do it directly, since <code>:</code> only prepends a <em>single element</em> to a list. But in both child-branches you'll usually give multiple elements. The slow recursive implementation is <em>needed</em> to get around precisely this!</p>\n\n<p>So, the way to go is to use a container with a more efficient concatenation operation! Such are available in libraries, e.g. <a href=\"http://hackage.haskell.org/package/containers-0.5.7.1/docs/Data-Sequence.html\">sequence</a>. But there is one container type that you can very quickly brew up yourself:</p>\n\n<pre><code>newtype DList a = DList { getDList :: [a] -&gt; [a] }\n\ninstance Monoid (DList a) where\n  mempty = DList id\n  mappend (DList l1) (DList l2) = DList $ l1 . l2\n\nsingletonD :: a -&gt; DList a\nsingletonD x = DList (x:)\n</code></pre>\n\n<p>With this, you can do</p>\n\n<pre><code>toDList :: Tree a -&gt; DList a \ntoDList (Node v l r) = toDList l &lt;&gt; singletonD v &lt;&gt; toDList r\ntoDList Empty = mempty\n</code></pre>\n\n<p>This is an exact translation of your definition, but it won't have the same performance problem as when you concatenate ordinary lists.</p>\n\n<p>Because these <a href=\"https://wiki.haskell.org/Difference_list\">difference lists</a> are so easy to implement, it's quite common in Haskell to just do it inline without further mention:</p>\n\n<pre><code>toList :: (Tree a) -&gt; [a]  \ntoList t = tdl t []\n where tdl (Node v l r) = toList l . (v:) . tdl r\n       tdl Empty = id\n</code></pre>\n"}, {"tags": [], "owner": {"reputation": 44013, "user_id": 1477667, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/trgKM.jpg?s=128&g=1", "display_name": "dfeuer", "link": "https://stackoverflow.com/users/1477667/dfeuer"}, "is_accepted": false, "score": 1, "last_activity_date": 1458488716, "last_edit_date": 1458488716, "creation_date": 1458434139, "answer_id": 36108966, "question_id": 36108616, "link": "https://stackoverflow.com/questions/36108616/replacement-with-in-haskell-error/36108966#36108966", "title": "Replacement &#39;++&#39; with &#39;:&#39; in Haskell. Error", "body": "<p>You need to put things together differently to accomplish your goal. You can't just replace <code>++</code> with <code>:</code>. Try this:</p>\n\n<pre><code>toList t = toListPlus t []\ntoListPlus :: Tree a -&gt; [a] -&gt; [a]\n</code></pre>\n\n<p><code>toListPlus t xs</code> should produce <code>toList t ++ xs</code>, but implemented with recursive calls to <code>toListPlus</code>, not using <code>++</code> or <code>toList</code>. Let's work through it. The base case is easy:</p>\n\n<pre><code>toListPlus Empty xs = xs\n</code></pre>\n\n<p>The recursive case isn't too bad either. We want to convert the left subtree to a list, sticking other stuff on after:</p>\n\n<pre><code>toListPlus (Node v l r) xs =\n  toListPlus l ???\n</code></pre>\n\n<p>What comes after? The root, and then the result of converting the right subtree, and then whatever gets tacked on:</p>\n\n<pre><code>toListPlus (Node v l r) xs =\n  toListPlus l (v : toListPlus r xs)\n</code></pre>\n\n<p>This function uses an implicit stack to keep track of the remaining work. This is probably the most efficient way to do it. If you wanted, you could use a zipper-style representation to make the stack explicit.</p>\n\n<hr>\n\n<p>How does this solution relate to the one leftaroundabout described? Well, they're actually the same. We can see that by shifting the list argument over:</p>\n\n<pre><code>toListPlus Empty = \\xs -&gt; xs\ntoListPlus (Node v l r)\n  = \\xs -&gt; toListPlus l (v : toListPlus r xs)\n  = toListPlus l . (v :) . toListPlus r\n</code></pre>\n"}], "owner": {"reputation": 3815, "user_id": 5382150, "user_type": "registered", "accept_rate": 86, "profile_image": "https://i.stack.imgur.com/GwGSL.png?s=128&g=1", "display_name": "Gilgamesz", "link": "https://stackoverflow.com/users/5382150/gilgamesz"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 80, "favorite_count": 0, "closed_date": 1458494868, "answer_count": 2, "score": 0, "last_activity_date": 1458488716, "creation_date": 1458430980, "question_id": 36108616, "link": "https://stackoverflow.com/questions/36108616/replacement-with-in-haskell-error", "closed_reason": "Duplicate", "title": "Replacement &#39;++&#39; with &#39;:&#39; in Haskell. Error", "body": "<pre><code>data Tree a = Node a (Tree a) (Tree a) | Empty \n\n\ntoList :: (Tree a) -&gt; [a]  \ntoList (Node v l r ) = (toList l) ++ [v] ++ (toList r)\ntoList Empty = []\n</code></pre>\n\n<p>As we know it is not optimal because every <code>++</code> is connected with O(n) operations for concatenation of lists. The alternative solution is to use <code>:</code> instead of <code>++</code>. But it causes error because of the fact <code>toList Empty = []</code>. So how to make optimal my solution?</p>\n"}, {"tags": ["haskell", "instances", "aeson", "type-variables"], "comments": [{"owner": {"reputation": 13807, "user_id": 2407038, "user_type": "registered", "accept_rate": 64, "profile_image": "https://www.gravatar.com/avatar/538f6f4a9aa43841841de7d8e8b169fc?s=128&d=identicon&r=PG&f=1", "display_name": "user2407038", "link": "https://stackoverflow.com/users/2407038/user2407038"}, "edited": false, "score": 1, "creation_date": 1458416353, "post_id": 36106261, "comment_id": 59854532, "body": "Do what it tells you, add <code>FromJSON a</code> to the context: <code>instance FromJSON a =&gt; FromJSON (Market a) where ...</code>"}, {"owner": {"reputation": 315, "user_id": 4175994, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/iLwio.jpg?s=128&g=1", "display_name": "IDon&#39;tUnderstandOOP", "link": "https://stackoverflow.com/users/4175994/idontunderstandoop"}, "reply_to_user": {"reputation": 13807, "user_id": 2407038, "user_type": "registered", "accept_rate": 64, "profile_image": "https://www.gravatar.com/avatar/538f6f4a9aa43841841de7d8e8b169fc?s=128&d=identicon&r=PG&f=1", "display_name": "user2407038", "link": "https://stackoverflow.com/users/2407038/user2407038"}, "edited": false, "score": 0, "creation_date": 1458417066, "post_id": 36106261, "comment_id": 59854728, "body": "Thank you. I didn&#39;t know what it meant, nor did I think it would be that simple. This is my first attempt at using instances, and I just got rid of several &quot;Couldn&#39;t match type&quot; errors relating to that instance, so I thought it would be more complicated than that."}], "answers": [{"tags": [], "owner": {"reputation": 49501, "user_id": 784338, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/ae195ac7c8a5e9002a808544572cc5fc?s=128&d=identicon&r=PG", "display_name": "Daniel Gratzer", "link": "https://stackoverflow.com/users/784338/daniel-gratzer"}, "is_accepted": true, "score": 1, "last_activity_date": 1458424208, "creation_date": 1458424208, "answer_id": 36107620, "question_id": 36106261, "link": "https://stackoverflow.com/questions/36106261/type-variables-in-instance-decelerations-aeson/36107620#36107620", "title": "Type Variables in Instance Decelerations (Aeson)", "body": "<p>So there are two issues here. The first is the compilation error: you claim that you have an instance for <code>Market a</code> which should mean you know how to parse the JSON serialization of a market for any choice of <code>a</code>, but this isn't really possible because you want to parse something of type <code>a</code> in order to price the contents of the <code>price</code> field.</p>\n\n<p>We restrict our attention to only consider possible <code>a</code>'s that we know how to parse by adding a constraint to our instance declaration:</p>\n\n<pre><code>instance FromJSON a =&gt; FromJSON (Market a) where\n  ...\n</code></pre>\n\n<p>and now all is well. There's another problem though, the way that we've implemented <code>FromJSON</code> we see that it's riddled with nonexhaustive matches! Try running this with <code>-Wall</code> to see GHC complain at us for it. Now the problem is that each <code>parseJSON</code> will actually fail with an exception (not a parsing failure, like a \"blow up the whole program\" failure) if fed something other than an <code>Object</code>. This means that we get poor behaviour like</p>\n\n<pre><code>\u03bb&gt; decode \"1.0\" :: Maybe Typed\n*** Exception: /home/jozefg/scratch/Aeson.hs:(24,3)-(25,39): Non-exhaustive patterns in function parseJSON\n</code></pre>\n\n<p>In order to fix this we can just add another clause explicitly failing in all the other cases. The more production-y solution might be to not handwrite these instances since they're all pretty straightforward and instead use aeson's support for generics for example. Here's the fixed instance for <code>Order</code> for example where I've just added an extra clause</p>\n\n<pre><code>instance FromJSON Order where\n  parseJSON (Object x) =\n    Order &lt;$&gt; x .: \"price\" &lt;*&gt; x .: \"buy\" &lt;*&gt; x .: \"location\"\n  parseJSON _ = mempty\n</code></pre>\n"}], "owner": {"reputation": 315, "user_id": 4175994, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/iLwio.jpg?s=128&g=1", "display_name": "IDon&#39;tUnderstandOOP", "link": "https://stackoverflow.com/users/4175994/idontunderstandoop"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 94, "favorite_count": 0, "accepted_answer_id": 36107620, "answer_count": 1, "score": 0, "last_activity_date": 1458424208, "creation_date": 1458416266, "question_id": 36106261, "link": "https://stackoverflow.com/questions/36106261/type-variables-in-instance-decelerations-aeson", "title": "Type Variables in Instance Decelerations (Aeson)", "body": "<p>I have JSON data that may either look like this</p>\n\n<pre><code>{\n\"items\": [Day],\n\"pageCount\": Int,\n\"totalCount\": Int\n}\n</code></pre>\n\n<p>or this</p>\n\n<pre><code>{\n\"items\": [Order],\n\"pageCount\": Int,\n\"totalCount\": Int\n}\n</code></pre>\n\n<p>I've been trying to create a data type for the unvaried fields for use with FromJSON, but I haven't been able to find the proper way to do it, while going through a variety of errors. This is my code in its current state</p>\n\n<pre><code>--{-# LANGUAGE FlexibleInstances #-}\n--{-# LANGUAGE MultiParamTypeClasses #-}\n--{-# LANGUAGE TypeFamilies #-}\n{-# LANGUAGE OverloadedStrings #-}\nimport           Data.Aeson\n\ndata Typed = Typed {typeID::Int,name::String} deriving (Show,Eq)\ndata Day =  Day {orderCount::Int,lowPrice::Float,highPrice::Float, avgPrice:: Float,volume::Int,date::String}\ndata Order = Order {price::Float,isBuy::Bool,location::Typed} deriving (Show,Eq)\ndata Market a = Market {items::a,pageCount::Int,totalCount::Int} deriving (Show,Eq)\n-- Can be either Market [Order] or Market [Day]\ninstance FromJSON (Market a) where\n  parseJSON (Object x) = Market &lt;$&gt; x .: \"items\" &lt;*&gt; x .: \"pageCount\" &lt;*&gt; x .: \"totalCount\"\ninstance FromJSON Order where\n  parseJSON (Object x) = Order &lt;$&gt; x .: \"price\" &lt;*&gt; x .: \"buy\" &lt;*&gt; x .: \"location\"\ninstance FromJSON Typed where\n  parseJSON (Object x) = Typed &lt;$&gt; x .: \"id\" &lt;*&gt; x .: \"name\"\ninstance FromJSON Day where\n  parseJSON (Object x) = Day &lt;$&gt; x .: \"orderCount\" &lt;*&gt; x .: \"lowPrice\" &lt;*&gt; x .: \"highPrice\"\n    &lt;*&gt; x .: \"avgPrice\" &lt;*&gt; x .: \"volume\" &lt;*&gt; x .: \"date\"\n</code></pre>\n\n<p>And this is the current error I get</p>\n\n<pre><code>No instance for (FromJSON a) arising from a use of \u2018.:\u2019\n    Possible fix:\n      add (FromJSON a) to the context of the instance declaration\n    In the second argument of \u2018(&lt;$&gt;)\u2019, namely \u2018x .: \"items\"\u2019\n    In the first argument of \u2018(&lt;*&gt;)\u2019, namely \u2018Market &lt;$&gt; x .: \"items\"\u2019\n    In the first argument of \u2018(&lt;*&gt;)\u2019, namely\n      \u2018Market &lt;$&gt; x .: \"items\" &lt;*&gt; x .: \"pageCount\"\u2019\n</code></pre>\n"}, {"tags": ["haskell"], "answers": [{"comments": [{"owner": {"reputation": 3815, "user_id": 5382150, "user_type": "registered", "accept_rate": 86, "profile_image": "https://i.stack.imgur.com/GwGSL.png?s=128&g=1", "display_name": "Gilgamesz", "link": "https://stackoverflow.com/users/5382150/gilgamesz"}, "edited": false, "score": 0, "creation_date": 1458395740, "post_id": 36101421, "comment_id": 59847877, "body": "ok, you are right. You recall me some facts from set theory :D. Ok, so let&#39;s consider only finite sets. How to improve my function to be lazy?"}], "tags": [], "owner": {"reputation": 100185, "user_id": 3234959, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/93bb12ca0f93dfddb33880316f7e66c2?s=128&d=identicon&r=PG&f=1", "display_name": "chi", "link": "https://stackoverflow.com/users/3234959/chi"}, "is_accepted": false, "score": 3, "last_activity_date": 1458388734, "creation_date": 1458388734, "answer_id": 36101421, "question_id": 36101041, "link": "https://stackoverflow.com/questions/36101041/generating-subsets-of-set-laziness/36101421#36101421", "title": "Generating subsets of set. Laziness?", "body": "<p>You can't generate <em>all</em> the subsets of an infinite set: they form an uncountable set. Cardinality makes it impossible.</p>\n\n<p>At most, you can try to generate all the <em>finite</em> subsets. For that, you can't proceed by induction, from <code>[]</code> onwards, since you'll never reach <code>[]</code>. You need to proceed inductively from the beginning of the list, instead of the end.</p>\n"}, {"comments": [{"owner": {"reputation": 3815, "user_id": 5382150, "user_type": "registered", "accept_rate": 86, "profile_image": "https://i.stack.imgur.com/GwGSL.png?s=128&g=1", "display_name": "Gilgamesz", "link": "https://stackoverflow.com/users/5382150/gilgamesz"}, "edited": false, "score": 0, "creation_date": 1458400804, "post_id": 36101787, "comment_id": 59849443, "body": "Thanks you a lot! It is a solution with monads. What about without them?"}, {"owner": {"reputation": 16267, "user_id": 1346276, "user_type": "registered", "accept_rate": 70, "profile_image": "https://i.stack.imgur.com/Tu8Re.jpg?s=128&g=1", "display_name": "phipsgabler", "link": "https://stackoverflow.com/users/1346276/phipsgabler"}, "reply_to_user": {"reputation": 3815, "user_id": 5382150, "user_type": "registered", "accept_rate": 86, "profile_image": "https://i.stack.imgur.com/GwGSL.png?s=128&g=1", "display_name": "Gilgamesz", "link": "https://stackoverflow.com/users/5382150/gilgamesz"}, "edited": false, "score": 1, "creation_date": 1458401378, "post_id": 36101787, "comment_id": 59849600, "body": "@Gilgamesz turns out the monad is not even needed. The previous version was wrong anyway -- now it works with plain lists, and hopefully correctly."}, {"owner": {"reputation": 5668, "user_id": 712526, "user_type": "registered", "accept_rate": 50, "profile_image": "https://www.gravatar.com/avatar/06e3c4065e9d08da698b4f4de3959294?s=128&d=identicon&r=PG", "display_name": "jpaugh", "link": "https://stackoverflow.com/users/712526/jpaugh"}, "reply_to_user": {"reputation": 3815, "user_id": 5382150, "user_type": "registered", "accept_rate": 86, "profile_image": "https://i.stack.imgur.com/GwGSL.png?s=128&g=1", "display_name": "Gilgamesz", "link": "https://stackoverflow.com/users/5382150/gilgamesz"}, "edited": false, "score": 0, "creation_date": 1458462108, "post_id": 36101787, "comment_id": 59864484, "body": "@Gilgamesz Laziness is one of the core, yet most advanced topics of Haskell. For example, phg&#39;s first point is a result of Haskell&#39;s specific implementation of laziness, which uses a graph structure to represent evaluations in progress: IIRC, in some limited cases, the complier <i>will</i> catch the duplication, and share the same data structure in both instances --- but not always. This is one of the prices we pay for having laziness. It&#39;s a limitation of the compiler that we must be aware of when focusing on performance, or dealing with infinity."}, {"owner": {"reputation": 16267, "user_id": 1346276, "user_type": "registered", "accept_rate": 70, "profile_image": "https://i.stack.imgur.com/Tu8Re.jpg?s=128&g=1", "display_name": "phipsgabler", "link": "https://stackoverflow.com/users/1346276/phipsgabler"}, "edited": false, "score": 0, "creation_date": 1458469123, "post_id": 36101787, "comment_id": 59866044, "body": "Good point. Specifically, it helps much to think about the language from the perspective of <a href=\"http://research.microsoft.com/en-us/um/people/simonpj/papers/slpj-book-1987/PAGES/207.HTM\" rel=\"nofollow noreferrer\">graph reduction</a>."}], "tags": [], "owner": {"reputation": 16267, "user_id": 1346276, "user_type": "registered", "accept_rate": 70, "profile_image": "https://i.stack.imgur.com/Tu8Re.jpg?s=128&g=1", "display_name": "phipsgabler", "link": "https://stackoverflow.com/users/1346276/phipsgabler"}, "is_accepted": true, "score": 5, "last_activity_date": 1489238266, "last_edit_date": 1489238266, "creation_date": 1458390818, "answer_id": 36101787, "question_id": 36101041, "link": "https://stackoverflow.com/questions/36101041/generating-subsets-of-set-laziness/36101787#36101787", "title": "Generating subsets of set. Laziness?", "body": "<p>There's two problems with that function. First, it recurses <em>twice</em>, which makes it exponentially more ineffiecient than necessary (if we disregard the exponential number of results...), because each subtree is recalculated every time for all overlapping subsets; this can be fixed by <code>let</code>ing the recursive call be the same value:</p>\n\n<pre><code>subsets' :: [a] -&gt; [[a]]\nsubsets' [] = [[]]\nsubsets' (x:xs) = let s = subsets' xs\n                  in map (x:) s ++ s\n</code></pre>\n\n<p>This will already allow you to calculate <code>length $ subsets' [1..25]</code> in a few seconds, while <code>length $ subsets [1..25]</code> takes... well, I didn't wait ;)</p>\n\n<p>The other issue is that with your version, when you give it an infinite list, it will recurse on the <em>infinite tail</em> of that list first. To generate all finite subsets in a meaningful way, we need to ensure two things: first, we must build up each set from smaller sets (to ensure termination), and second, we should ensure a <em>fair</em> order (ie., not generate the list <code>[[1], [2], ...]</code> first and never get to the rest). For this, we start from <code>[[]]</code> and recursively add the current element to everything we have already generated, and then remember the new list for the next step:</p>\n\n<pre><code>subsets'' :: [a] -&gt; [[a]]\nsubsets'' l = [[]] ++ subs [[]] l\n  where subs previous (x:xs) = let next = map (x:) previous\n                               in next ++ subs (previous ++ next) xs\n        subs _ [] = []\n</code></pre>\n\n<p>Which results in this order:</p>\n\n<pre><code>*Main&gt; take 100 $ subsets'' [1..]\n[[],[1],[2],[2,1],[3],[3,1],[3,2],[3,2,1],[4],[4,1],[4,2],[4,2,1],[4,3],[4,3,1],[4,3,2],[4,3,2,1],[5],[5,1],[5,2],[5,2,1],[5,3],[5,3,1],[5,3,2],[5,3,2,1],[5,4],[5,4,1],[5,4,2],[5,4,2,1],[5,4,3],[5,4,3,1],[5,4,3,2],[5,4,3,2,1],[6],[6,1],[6,2],[6,2,1],[6,3],[6,3,1],[6,3,2],[6,3,2,1],[6,4],[6,4,1],[6,4,2],[6,4,2,1],[6,4,3],[6,4,3,1],[6,4,3,2],[6,4,3,2,1],[6,5],[6,5,1],[6,5,2],[6,5,2,1],[6,5,3],[6,5,3,1],[6,5,3,2],[6,5,3,2,1],[6,5,4],[6,5,4,1],[6,5,4,2],[6,5,4,2,1],[6,5,4,3],[6,5,4,3,1],[6,5,4,3,2],[6,5,4,3,2,1],[7],[7,1],[7,2],[7,2,1],[7,3],[7,3,1],[7,3,2],[7,3,2,1],[7,4],[7,4,1],[7,4,2],[7,4,2,1],[7,4,3],[7,4,3,1],[7,4,3,2],[7,4,3,2,1],[7,5],[7,5,1],[7,5,2],[7,5,2,1],[7,5,3],[7,5,3,1],[7,5,3,2],[7,5,3,2,1],[7,5,4],[7,5,4,1],[7,5,4,2],[7,5,4,2,1],[7,5,4,3],[7,5,4,3,1],[7,5,4,3,2],[7,5,4,3,2,1],[7,6],[7,6,1],[7,6,2],[7,6,2,1]]\n</code></pre>\n"}, {"comments": [{"owner": {"reputation": 100185, "user_id": 3234959, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/93bb12ca0f93dfddb33880316f7e66c2?s=128&d=identicon&r=PG&f=1", "display_name": "chi", "link": "https://stackoverflow.com/users/3234959/chi"}, "edited": false, "score": 0, "creation_date": 1458422614, "post_id": 36106345, "comment_id": 59856518, "body": "+1 for brevity, but it needs more explanation. Especially since it uses the not-quite-idiomatic technique &quot;calling <code>foldr</code> with <i>four</i> arguments&quot;, which can easily confuse newcomers. I&#39;d still prefer plain recursion, which I find more readable."}, {"owner": {"reputation": 61029, "user_id": 625914, "user_type": "registered", "accept_rate": 70, "profile_image": "https://www.gravatar.com/avatar/f1932d8bf4e9dbf779a48b41bbf21592?s=128&d=identicon&r=PG", "display_name": "behzad.nouri", "link": "https://stackoverflow.com/users/625914/behzad-nouri"}, "reply_to_user": {"reputation": 100185, "user_id": 3234959, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/93bb12ca0f93dfddb33880316f7e66c2?s=128&d=identicon&r=PG&f=1", "display_name": "chi", "link": "https://stackoverflow.com/users/3234959/chi"}, "edited": false, "score": 0, "creation_date": 1458423221, "post_id": 36106345, "comment_id": 59856704, "body": "@chi compared to the recursive solution, this uses less memory and performs faster! try <code>length $ powerset [1..24]</code> with <code>ghc --make -O2</code> on this solution versus the recursive one."}, {"owner": {"reputation": 3815, "user_id": 5382150, "user_type": "registered", "accept_rate": 86, "profile_image": "https://i.stack.imgur.com/GwGSL.png?s=128&g=1", "display_name": "Gilgamesz", "link": "https://stackoverflow.com/users/5382150/gilgamesz"}, "edited": false, "score": 0, "creation_date": 1458423739, "post_id": 36106345, "comment_id": 59856860, "body": "Thank you a lot! But if you can explain in some words your solution it will be great. Especiall I do not understand <code>(const [])</code> and <code>&lt;$&gt;</code> :)"}, {"owner": {"reputation": 61029, "user_id": 625914, "user_type": "registered", "accept_rate": 70, "profile_image": "https://www.gravatar.com/avatar/f1932d8bf4e9dbf779a48b41bbf21592?s=128&d=identicon&r=PG", "display_name": "behzad.nouri", "link": "https://stackoverflow.com/users/625914/behzad-nouri"}, "reply_to_user": {"reputation": 3815, "user_id": 5382150, "user_type": "registered", "accept_rate": 86, "profile_image": "https://i.stack.imgur.com/GwGSL.png?s=128&g=1", "display_name": "Gilgamesz", "link": "https://stackoverflow.com/users/5382150/gilgamesz"}, "edited": false, "score": 1, "creation_date": 1458424022, "post_id": 36106345, "comment_id": 59856942, "body": "@Gilgamesz <a href=\"http://hackage.haskell.org/package/base-4.8.2.0/docs/src/GHC.Base.html#const\" rel=\"nofollow noreferrer\"><code>const</code></a> is simply defined as <code>const x _ = x</code>, that is it just returns its 1st argument ignoring the 2nd one. <code>(x:) &lt;$&gt; a</code> in here is equivalent to <code>map (x:) a</code>."}, {"owner": {"reputation": 3815, "user_id": 5382150, "user_type": "registered", "accept_rate": 86, "profile_image": "https://i.stack.imgur.com/GwGSL.png?s=128&g=1", "display_name": "Gilgamesz", "link": "https://stackoverflow.com/users/5382150/gilgamesz"}, "edited": false, "score": 0, "creation_date": 1458424121, "post_id": 36106345, "comment_id": 59856970, "body": "Thanks you again. I&#39;ll analyze it tomorrow - I am too exhausted today. If I have a probleam I will response here."}, {"owner": {"reputation": 16267, "user_id": 1346276, "user_type": "registered", "accept_rate": 70, "profile_image": "https://i.stack.imgur.com/Tu8Re.jpg?s=128&g=1", "display_name": "phipsgabler", "link": "https://stackoverflow.com/users/1346276/phipsgabler"}, "edited": false, "score": 1, "creation_date": 1458470892, "post_id": 36106345, "comment_id": 59866464, "body": "@behzad.nouri That is very neat. Does anybody know why this ends up perfoming better? Because after inlining <code>foldr</code> and some currying, it is exactly the same as my second version, just with the arguments of <code>subs</code>/<code>go</code> reversed."}], "tags": [], "owner": {"reputation": 61029, "user_id": 625914, "user_type": "registered", "accept_rate": 70, "profile_image": "https://www.gravatar.com/avatar/f1932d8bf4e9dbf779a48b41bbf21592?s=128&d=identicon&r=PG", "display_name": "behzad.nouri", "link": "https://stackoverflow.com/users/625914/behzad-nouri"}, "is_accepted": false, "score": 3, "last_activity_date": 1458417184, "last_edit_date": 1458417184, "creation_date": 1458416757, "answer_id": 36106345, "question_id": 36101041, "link": "https://stackoverflow.com/questions/36101041/generating-subsets-of-set-laziness/36106345#36106345", "title": "Generating subsets of set. Laziness?", "body": "<p>A right fold solution would be:</p>\n\n<pre><code>powerset :: Foldable t =&gt; t a -&gt; [[a]]\npowerset xs = []: foldr go (const []) xs [[]]\n    where go x f a = let b = (x:) &lt;$&gt; a in b ++ f (a ++ b)\n</code></pre>\n\n<p>then:</p>\n\n<pre><code>\\&gt; take 8 $ powerset [1..]\n[[],[1],[2],[2,1],[3],[3,1],[3,2],[3,2,1]]\n</code></pre>\n"}], "owner": {"reputation": 3815, "user_id": 5382150, "user_type": "registered", "accept_rate": 86, "profile_image": "https://i.stack.imgur.com/GwGSL.png?s=128&g=1", "display_name": "Gilgamesz", "link": "https://stackoverflow.com/users/5382150/gilgamesz"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 346, "favorite_count": 1, "accepted_answer_id": 36101787, "answer_count": 3, "score": 4, "last_activity_date": 1489238266, "creation_date": 1458386412, "last_edit_date": 1458386831, "question_id": 36101041, "link": "https://stackoverflow.com/questions/36101041/generating-subsets-of-set-laziness", "title": "Generating subsets of set. Laziness?", "body": "<p>I have written a function generating subsets of subset. It caused stack overflow when I use in the following way <code>subsets [1..]</code>. And it is \"normal\" behaviour when it comes to \"normal\" (no-lazy) languages. And now, I would like to improve my function to be lazy. </p>\n\n<p>P.S. I don't understand laziness ( And I try to understand it) so perhaps my problem is strange for you- please explain. :)</p>\n\n<p>P.S. 2 Feel free to say me something about my disability in Haskell ;)</p>\n\n<pre><code>subsets :: [a] -&gt; [[a]]\nsubsets (x:xs) = (map (\\ e -&gt; x:e) (subsets xs)) ++ (subsets xs)\nsubsets [] = [[]]\n</code></pre>\n"}, {"tags": ["haskell", "persistent"], "comments": [{"owner": {"reputation": 48129, "user_id": 76051, "user_type": "registered", "accept_rate": 91, "profile_image": "https://i.stack.imgur.com/AGDxz.jpg?s=128&g=1", "display_name": "Carsten", "link": "https://stackoverflow.com/users/76051/carsten"}, "edited": false, "score": 0, "creation_date": 1458385656, "post_id": 36100560, "comment_id": 59844864, "body": "I think you have to use some <i>semi</i>-documented features - look here for <a href=\"https://github.com/yesodweb/persistent/blob/master/persistent-test/CompositeTest.hs#L53\" rel=\"nofollow noreferrer\">examples using different prim-keys and foreign keys</a> (look for <code>Primary name name2 age</code>) and here is a nice <a href=\"https://www.schoolofhaskell.com/school/advanced-haskell/persistent-in-detail/existing-database\" rel=\"nofollow noreferrer\">overview over some other mappings</a>"}, {"owner": {"reputation": 13, "user_id": 4063261, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/tVaRj.jpg?s=128&g=1", "display_name": "Mark Eibes", "link": "https://stackoverflow.com/users/4063261/mark-eibes"}, "reply_to_user": {"reputation": 48129, "user_id": 76051, "user_type": "registered", "accept_rate": 91, "profile_image": "https://i.stack.imgur.com/AGDxz.jpg?s=128&g=1", "display_name": "Carsten", "link": "https://stackoverflow.com/users/76051/carsten"}, "edited": false, "score": 0, "creation_date": 1458395581, "post_id": 36100560, "comment_id": 59847837, "body": "Yes, I have seen that <i>documentation</i> but I don&#39;t really get it. That&#39;s where I have that comment on the penultimate line from. But that is giving me a headache."}, {"owner": {"reputation": 13, "user_id": 4063261, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/tVaRj.jpg?s=128&g=1", "display_name": "Mark Eibes", "link": "https://stackoverflow.com/users/4063261/mark-eibes"}, "reply_to_user": {"reputation": 48129, "user_id": 76051, "user_type": "registered", "accept_rate": 91, "profile_image": "https://i.stack.imgur.com/AGDxz.jpg?s=128&g=1", "display_name": "Carsten", "link": "https://stackoverflow.com/users/76051/carsten"}, "edited": false, "score": 0, "creation_date": 1458396081, "post_id": 36100560, "comment_id": 59847971, "body": "Update: I get it now, I have to specify the primary key first. Okay, I would have liked it to be possible without that."}, {"owner": {"reputation": 48129, "user_id": 76051, "user_type": "registered", "accept_rate": 91, "profile_image": "https://i.stack.imgur.com/AGDxz.jpg?s=128&g=1", "display_name": "Carsten", "link": "https://stackoverflow.com/users/76051/carsten"}, "edited": false, "score": 0, "creation_date": 1458397326, "post_id": 36100560, "comment_id": 59848367, "body": "Well how should it know? And of course it needs to be the prim.key (see <a href=\"https://en.wikipedia.org/wiki/Foreign_key\" rel=\"nofollow noreferrer\">here</a>) that&#39;s how the stuff works usually"}, {"owner": {"reputation": 48129, "user_id": 76051, "user_type": "registered", "accept_rate": 91, "profile_image": "https://i.stack.imgur.com/AGDxz.jpg?s=128&g=1", "display_name": "Carsten", "link": "https://stackoverflow.com/users/76051/carsten"}, "edited": false, "score": 0, "creation_date": 1458397441, "post_id": 36100560, "comment_id": 59848397, "body": "btw: I guess the you don&#39;t need <code>UniqueUserId</code> once you made it the <code>Primary</code> ;)"}, {"owner": {"reputation": 43759, "user_id": 1651941, "user_type": "registered", "accept_rate": 97, "profile_image": "https://www.gravatar.com/avatar/a513bc1fa519d2fcf5e4e0d9b5500101?s=128&d=identicon&r=PG", "display_name": "Sibi", "link": "https://stackoverflow.com/users/1651941/sibi"}, "edited": false, "score": 0, "creation_date": 1458470163, "post_id": 36100560, "comment_id": 59866299, "body": "Can you include that as a separate answer ?"}, {"owner": {"reputation": 13, "user_id": 4063261, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/tVaRj.jpg?s=128&g=1", "display_name": "Mark Eibes", "link": "https://stackoverflow.com/users/4063261/mark-eibes"}, "edited": false, "score": 0, "creation_date": 1458811320, "post_id": 36100560, "comment_id": 60027052, "body": "Who do you mean, Sibi?"}], "owner": {"reputation": 13, "user_id": 4063261, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/tVaRj.jpg?s=128&g=1", "display_name": "Mark Eibes", "link": "https://stackoverflow.com/users/4063261/mark-eibes"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 137, "favorite_count": 0, "answer_count": 0, "score": 1, "last_activity_date": 1458396227, "creation_date": 1458383455, "last_edit_date": 1458396227, "question_id": 36100560, "link": "https://stackoverflow.com/questions/36100560/store-foreign-key-on-field-other-than-id-in-persistent", "title": "Store foreign key on field other than Id in persistent", "body": "<p>I am trying to create a foreign key constraint on a Unique field that I created. Here is the TemplateHaskell for the model:</p>\n\n<pre><code>User json\n  user_id      Text\n  name         Text\n  UniqueUserId user_id\n  deriving Show Eq\n\nUserPicture\n  user_id           Text\n  picture           ByteString\n  UniqueUserPicture user_id\n  -- Foreign           User UserPictureUser_id UserUser_id\n  deriving Show Eq\n</code></pre>\n\n<p>How can I make it such that <code>user_id</code> in <code>UserPicture</code> is a reference to <code>user_id</code> in <code>User</code>? That way I could probably also cascade deletes of a <code>User</code> and maybe even get all pictures to a user more easily.</p>\n\n<p>Update: Alright so it is necessary to define the field as the primary key. Like this in this case: </p>\n\n<pre><code>User json \n  user_id      Text \n  name         Text \n  UniqueUserId user_id \n  Primary      user_id \n  deriving Show Eq\n\nUserPicture\n   user_id           Text\n   picture           ByteString\n   UniqueUserPicture user_id\n   Foreign           User fkUser user_id\n   deriving Show Eq\n</code></pre>\n"}, {"tags": ["haskell", "pattern-matching", "non-exhaustive-patterns"], "comments": [{"owner": {"reputation": 3040, "user_id": 4308453, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/fc596d8352ad2c4254536343139b5b82?s=128&d=identicon&r=PG&f=1", "display_name": "zakyggaps", "link": "https://stackoverflow.com/users/4308453/zakyggaps"}, "edited": false, "score": 2, "creation_date": 1458381018, "post_id": 36100155, "comment_id": 59843637, "body": "Yes: <code>-fwarn-incomplete-patterns</code> or simply <code>-Wall</code>."}, {"owner": {"reputation": 3609, "user_id": 2565354, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/590ed3229d95cdcaa05a96028c586165?s=128&d=identicon&r=PG", "display_name": "badcook", "link": "https://stackoverflow.com/users/2565354/badcook"}, "edited": false, "score": 1, "creation_date": 1458381276, "post_id": 36100155, "comment_id": 59843695, "body": "Also maybe <code>-fwarn-incomplete-uni-patterns</code>, which is not included in <code>-Wall</code>, if you&#39;re worried about patterns in lambdas."}, {"owner": {"reputation": 84731, "user_id": 510937, "user_type": "registered", "accept_rate": 80, "profile_image": "https://www.gravatar.com/avatar/70b13a9ae1aae1ca1aa6ac8dab4643f2?s=128&d=identicon&r=PG", "display_name": "Bakuriu", "link": "https://stackoverflow.com/users/510937/bakuriu"}, "reply_to_user": {"reputation": 3040, "user_id": 4308453, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/fc596d8352ad2c4254536343139b5b82?s=128&d=identicon&r=PG&f=1", "display_name": "zakyggaps", "link": "https://stackoverflow.com/users/4308453/zakyggaps"}, "edited": false, "score": 1, "creation_date": 1458381913, "post_id": 36100155, "comment_id": 59843854, "body": "@zakyggaps You should post that as an answer instead of a comment."}, {"owner": {"reputation": 84731, "user_id": 510937, "user_type": "registered", "accept_rate": 80, "profile_image": "https://www.gravatar.com/avatar/70b13a9ae1aae1ca1aa6ac8dab4643f2?s=128&d=identicon&r=PG", "display_name": "Bakuriu", "link": "https://stackoverflow.com/users/510937/bakuriu"}, "edited": false, "score": 1, "creation_date": 1458382044, "post_id": 36100155, "comment_id": 59843887, "body": "Anyway, all compilers for all languages have the <code>-Wall</code> option that turns on most warnings. You should compile with that option set. You could even use the <code>-Werror</code> flag which will make compilation fail whenever a warning is issued (sometimes you can ignore some warnings, so it may not be applicable to all cases)."}, {"owner": {"user_type": "does_not_exist", "display_name": "user6023611"}, "edited": false, "score": 0, "creation_date": 1458382206, "post_id": 36100155, "comment_id": 59843925, "body": "Thanks you very much!"}, {"owner": {"reputation": 3040, "user_id": 4308453, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/fc596d8352ad2c4254536343139b5b82?s=128&d=identicon&r=PG&f=1", "display_name": "zakyggaps", "link": "https://stackoverflow.com/users/4308453/zakyggaps"}, "reply_to_user": {"reputation": 84731, "user_id": 510937, "user_type": "registered", "accept_rate": 80, "profile_image": "https://www.gravatar.com/avatar/70b13a9ae1aae1ca1aa6ac8dab4643f2?s=128&d=identicon&r=PG", "display_name": "Bakuriu", "link": "https://stackoverflow.com/users/510937/bakuriu"}, "edited": false, "score": 0, "creation_date": 1458383389, "post_id": 36100155, "comment_id": 59844230, "body": "@Bakuriu Sorry. I was searching for a duplicate but didn&#39;t find one."}, {"owner": {"reputation": 13807, "user_id": 2407038, "user_type": "registered", "accept_rate": 64, "profile_image": "https://www.gravatar.com/avatar/538f6f4a9aa43841841de7d8e8b169fc?s=128&d=identicon&r=PG&f=1", "display_name": "user2407038", "link": "https://stackoverflow.com/users/2407038/user2407038"}, "edited": false, "score": 0, "creation_date": 1458412186, "post_id": 36100155, "comment_id": 59853137, "body": "Easy way to see all the options available: open ghci, type <code>:set -</code> and hit tab. This is the options for interpreting, not compiling, but all of the &quot;warning&quot; flags are shared between the two, at least."}], "answers": [{"tags": [], "owner": {"reputation": 3040, "user_id": 4308453, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/fc596d8352ad2c4254536343139b5b82?s=128&d=identicon&r=PG&f=1", "display_name": "zakyggaps", "link": "https://stackoverflow.com/users/4308453/zakyggaps"}, "is_accepted": true, "score": 1, "last_activity_date": 1458383404, "creation_date": 1458383404, "answer_id": 36100550, "question_id": 36100155, "link": "https://stackoverflow.com/questions/36100155/haskell-non-exhaustive-patterns-in-function-way-for-checking-this-condition/36100550#36100550", "title": "Haskell, Non-exhaustive patterns in function - way for checking this condition", "body": "<p>Yes: <code>-fwarn-incomplete-patterns</code> or simply <code>-Wall</code>. </p>\n\n<p>As @badcook hinted in the comment, if you want GHC to also warn non-exhausive patterns in lambdas you should add <code>-fwarn-incomplete-uni-patterns</code>.</p>\n"}], "owner": {"user_type": "does_not_exist", "display_name": "user6023611"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 385, "favorite_count": 0, "accepted_answer_id": 36100550, "answer_count": 1, "score": 2, "last_activity_date": 1458384430, "creation_date": 1458380649, "last_edit_date": 1458384430, "question_id": 36100155, "link": "https://stackoverflow.com/questions/36100155/haskell-non-exhaustive-patterns-in-function-way-for-checking-this-condition", "title": "Haskell, Non-exhaustive patterns in function - way for checking this condition", "body": "<p>Is there exist any way to check if my code contains: <code>Non-exhaustive patterns in function</code> ? Maybe some flag for compiler ?</p>\n"}, {"tags": ["haskell"], "comments": [{"owner": {"reputation": 21417, "user_id": 925978, "user_type": "registered", "accept_rate": 84, "profile_image": "https://www.gravatar.com/avatar/06e4467a5bd1538a92cefb20db07897a?s=128&d=identicon&r=PG&f=1", "display_name": "crockeea", "link": "https://stackoverflow.com/users/925978/crockeea"}, "edited": false, "score": 0, "creation_date": 1458354158, "post_id": 36097043, "comment_id": 59838271, "body": "With GHC 7.10.3, the compiler gives a very helpful warning that happens to be the cause of your problem. It&#39;s trying to help you, don&#39;t ignore it!"}, {"owner": {"reputation": 100185, "user_id": 3234959, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/93bb12ca0f93dfddb33880316f7e66c2?s=128&d=identicon&r=PG&f=1", "display_name": "chi", "link": "https://stackoverflow.com/users/3234959/chi"}, "edited": false, "score": 0, "creation_date": 1458373012, "post_id": 36097043, "comment_id": 59841752, "body": "You have overlapping patterns, as a warning should tell you if you enable them. Indeed, the first equation covers <i>any</i> input triple, so the last ones are never used, causing an infinite loop. Also, the problem seems to be much more complex than implied by the code above: it involves a non-deterministic transition system and we need to compute all its final states. We need to do a graph visit, essentially."}, {"owner": {"reputation": 62252, "user_id": 1435869, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/TrEd9.jpg?s=128&g=1", "display_name": "karakfa", "link": "https://stackoverflow.com/users/1435869/karakfa"}, "edited": false, "score": 0, "creation_date": 1458743582, "post_id": 36097043, "comment_id": 59997135, "body": "Note that this seems wrong <code>eat (lions, wolves, goats) = eat (lions - 1, wolves - 1, goats - 1)</code>  who eats them all?  You should have three different alternative outcomes from this state.  You also don&#39;t have other terminal states for leaving only lions and only wolfs."}], "answers": [{"comments": [{"owner": {"reputation": 9455, "user_id": 1172541, "user_type": "registered", "accept_rate": 30, "profile_image": "https://i.stack.imgur.com/LROoN.png?s=128&g=1", "display_name": "PyRulez", "link": "https://stackoverflow.com/users/1172541/pyrulez"}, "edited": false, "score": 0, "creation_date": 1458599299, "post_id": 36099353, "comment_id": 59923626, "body": "For non-determinism, look up the list monad."}, {"owner": {"reputation": 94713, "user_id": 1139697, "user_type": "registered", "accept_rate": 86, "profile_image": "https://www.gravatar.com/avatar/5f136ddb684f39aaee1c028ee1950f6f?s=128&d=identicon&r=PG", "display_name": "Zeta", "link": "https://stackoverflow.com/users/1139697/zeta"}, "reply_to_user": {"reputation": 9455, "user_id": 1172541, "user_type": "registered", "accept_rate": 30, "profile_image": "https://i.stack.imgur.com/LROoN.png?s=128&g=1", "display_name": "PyRulez", "link": "https://stackoverflow.com/users/1172541/pyrulez"}, "edited": false, "score": 0, "creation_date": 1458626715, "post_id": 36099353, "comment_id": 59932001, "body": "@PyRulez: If you use the list monad only, it&#39;s going to be horribly slow."}], "tags": [], "owner": {"reputation": 94713, "user_id": 1139697, "user_type": "registered", "accept_rate": 86, "profile_image": "https://www.gravatar.com/avatar/5f136ddb684f39aaee1c028ee1950f6f?s=128&d=identicon&r=PG", "display_name": "Zeta", "link": "https://stackoverflow.com/users/1139697/zeta"}, "is_accepted": false, "score": 3, "last_activity_date": 1458374302, "creation_date": 1458374302, "answer_id": 36099353, "question_id": 36097043, "link": "https://stackoverflow.com/questions/36097043/solving-the-lions-wolves-and-goats/36099353#36099353", "title": "solving the Lions, Wolves, and Goats", "body": "<p>Patterns are read top-down, left-right. Therefore, your first pattern matches all others. Reorder them:</p>\n\n<pre><code>eat :: (Int, Int, Int) -&gt; (Int, Int, Int)\neat (0     , 0      , goats) =     (0         , 0          , goats    )\neat (0     , wolves , goats) = eat (1         , wolves - 1 , goats - 1)\neat (lions , 0      , goats) = eat (lions - 1 , 1          , goats - 1)\neat (lions , wolves , 0)     = eat (lions - 1 , wolves - 1 , 1        )\neat (lions , wolves , goats) = eat (lions - 1 , wolves - 1 , goats - 1)\n</code></pre>\n\n<p>Note that this assumes that all values were originally positive. If one of them was negative, you will still get loop. Also note that you're missing to other \"stable\" states and your logic for a non-zero pack of lions, wolves and goats is off. If there are goats <em>and</em> wolves, a lion might eat either of them. Furthermore, a wolf might eat a goat before a lion does.</p>\n\n<p>That's the part where non-determinism will come into play.</p>\n"}, {"comments": [{"owner": {"reputation": 94713, "user_id": 1139697, "user_type": "registered", "accept_rate": 86, "profile_image": "https://www.gravatar.com/avatar/5f136ddb684f39aaee1c028ee1950f6f?s=128&d=identicon&r=PG", "display_name": "Zeta", "link": "https://stackoverflow.com/users/1139697/zeta"}, "edited": false, "score": 1, "creation_date": 1458626663, "post_id": 36142346, "comment_id": 59931976, "body": "Remark: there isn&#39;t necessarily a single solution. If you start with (1,1,1) you can end up with (2,0,0) (wolf eats goat), (0,2,0) (lion eats goat)  or (0,0,2) (lion eats wolf). You probably want to add that to <code>solution</code> or <code>result</code> as a comment."}, {"owner": {"reputation": 13807, "user_id": 2407038, "user_type": "registered", "accept_rate": 64, "profile_image": "https://www.gravatar.com/avatar/538f6f4a9aa43841841de7d8e8b169fc?s=128&d=identicon&r=PG&f=1", "display_name": "user2407038", "link": "https://stackoverflow.com/users/2407038/user2407038"}, "edited": false, "score": 0, "creation_date": 1458674304, "post_id": 36142346, "comment_id": 59963718, "body": "The program already computes all solutions, it is just throwing away all but the first. Strange choice. solution should probably have type <code>Set State -&gt; Set State</code>. And in <code>result</code>, you do <code>filter done</code>, but you already did <code>filter done</code> in <code>solution</code>. So just return that: <code>| otherwise = final</code>."}, {"owner": {"reputation": 62252, "user_id": 1435869, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/TrEd9.jpg?s=128&g=1", "display_name": "karakfa", "link": "https://stackoverflow.com/users/1435869/karakfa"}, "edited": false, "score": 0, "creation_date": 1458676457, "post_id": 36142346, "comment_id": 59965018, "body": "in one iteration there may be more than one solution and can be returned all, but there may be other solutions in future iterations, however using the first solution found as the termination condition."}], "tags": [], "owner": {"reputation": 62252, "user_id": 1435869, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/TrEd9.jpg?s=128&g=1", "display_name": "karakfa", "link": "https://stackoverflow.com/users/1435869/karakfa"}, "is_accepted": false, "score": 2, "last_activity_date": 1458676200, "last_edit_date": 1458676200, "creation_date": 1458597218, "answer_id": 36142346, "question_id": 36097043, "link": "https://stackoverflow.com/questions/36097043/solving-the-lions-wolves-and-goats/36142346#36142346", "title": "solving the Lions, Wolves, and Goats", "body": "<p>Here is a solution, works but not tidied up since implemented the first thing that came up to my mind.  I'm sure it can be improved...</p>\n\n<p>let's define the state we're going to keep track of as (lions,wolfs,goats)</p>\n\n<pre><code>type State = (Int,Int,Int)\n</code></pre>\n\n<p>the eating rules are given as</p>\n\n<pre><code>lw,lg,wg :: State -&gt; State\nlw (n,w,g) = (n-1,w-1,g+1)\nlg (n,w,g) = (n-1,w+1,g-1)\nwg (n,w,g) = (n+1,w-1,g-1)\n</code></pre>\n\n<p>since at each step the number of steps will exponentially grow, it's better to remove redundant states and non permissible ones (negative values), define helper functions</p>\n\n<pre><code>nonnegative:: State -&gt; Bool\nnonnegative (n,w,g) = n&gt;=0 &amp;&amp; w&gt;=0 &amp;&amp; g&gt;=0\n</code></pre>\n\n<p>core of the program is the step function where we apply the rules to current states</p>\n\n<pre><code>step :: S.Set State -&gt; S.Set State\nstep s = S.unions [mapfilter lg s, mapfilter lw s, mapfilter wg s]\n</code></pre>\n\n<p>here the uniqueness is outsourced to Data.Set using qualified with S prefix, requires the import</p>\n\n<pre><code>import qualified Data.Set as S (Set,toList,unions,singleton,map,filter,null)\n</code></pre>\n\n<p>mapfilter is applying the eating rules and filtering nonnegatives.</p>\n\n<pre><code>mapfilter f s = S.filter nonnegative $ S.map f s\n</code></pre>\n\n<p>we'll compute the steps until we have a solution</p>\n\n<pre><code>solution :: S.Set State -&gt; State\nsolution s | S.null final = solution $ step s\n           | otherwise = result s\n           where final = S.filter done s\n</code></pre>\n\n<p>where two elements of the state is zero</p>\n\n<pre><code>done (n,w,g) | n==0 = w==0 || g==0\n             | w==0 = g==0\n             | otherwise = False\n</code></pre>\n\n<p>and retrieve the first result from the Set</p>\n\n<pre><code>result :: S.Set State -&gt; State\nresult s = head $ Prelude.filter done $ S.toList s\n</code></pre>\n\n<p>using the initial values referenced in the link</p>\n\n<pre><code>initial :: S.Set State\ninitial = S.singleton (6,55,17)\n</code></pre>\n\n<p>we get the result when we run with the initial state</p>\n\n<pre><code>Prelude&gt; solution initial\n(23,0,0)\n</code></pre>\n\n<p>that is 23 lions.</p>\n\n<p><strong>UPDATE</strong></p>\n\n<p>I cleaned up the code little bit, still returns the first solution found</p>\n\n<pre><code>import Data.Set (Set,toList,singleton,map,filter,null,union,empty)\n\ntype State = (Int, Int, Int)   -- lions, wolfs, goats\n\nlw,lg,wg :: State -&gt; State\nlw (n,w,g) = (n-1,w-1,g+1)\nlg (n,w,g) = (n-1,w+1,g-1)\nwg (n,w,g) = (n+1,w-1,g-1)\n\ndone,nonnegative :: State -&gt; Bool\ndone (n,w,g) | n==0 = w==0 || g==0\n             | w==0 = g==0\n             | otherwise = False\nnonnegative (n,w,g) = n&gt;=0 &amp;&amp; w&gt;=0 &amp;&amp; g&gt;=0\n\nstep :: Set State -&gt; Set State\nstep s = mapfilters [lg,lw,wg] s\n\nmapfilters :: [State -&gt; State] -&gt; Set State -&gt; Set State\nmapfilters [] s = empty\nmapfilters (f:fs) s = union (mf f s) (mapfilters fs s)\n      where mf f s = Data.Set.filter nonnegative $ Data.Set.map f s\n\nsolution :: Set State -&gt; Set State\nsolution s | Data.Set.null final = solution (step s)\n           | otherwise = final\n           where final = Data.Set.filter done s\n\nrun = head $ toList $ solution $ singleton (6,55,17)\n</code></pre>\n"}, {"tags": [], "owner": {"reputation": 44013, "user_id": 1477667, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/trgKM.jpg?s=128&g=1", "display_name": "dfeuer", "link": "https://stackoverflow.com/users/1477667/dfeuer"}, "is_accepted": false, "score": 0, "last_activity_date": 1458936782, "last_edit_date": 1458936782, "creation_date": 1458701238, "answer_id": 36168922, "question_id": 36097043, "link": "https://stackoverflow.com/questions/36097043/solving-the-lions-wolves-and-goats/36168922#36168922", "title": "solving the Lions, Wolves, and Goats", "body": "<p>One key to doing this efficiently is to realize that the problem only <em>looks</em> asymmetrical. In each step, there are three possibilities:</p>\n\n<ol>\n<li>There is only one type of animal remaining. This is the final state.</li>\n<li>There are two types of animal remaining. In this case, a specimen of the missing animal is created, and the two pre-existing types reduce in number by one each.</li>\n<li>All three types of animals remain. In this case, one of them increases in number while the other two decrease in number.</li>\n</ol>\n\n<p>Because of this symmetry, we only need to think about the <em>numbers</em>, and not think too much about the <em>animals</em>.</p>\n\n<p>Since the total number of animals goes down by one in each step, the way to get the most animals remaining in the end is to keep the number of steps as small as possible. So what does it take to get the number of animals down to exactly one? Well, that means getting the other two types of animal down to exactly zero. This sounds trivial, but it's actually a key insight!</p>\n\n<p>Suppose we already know which animal we want to survive. How do we get as many as possible? I think you can convince yourself that there are only two ways to improve the situation: either increase the number of winners, or make the numbers of losers more balanced. Making the number of losers <em>less</em> balanced (the only other option) will decrease the number of winners (bad in the short term) and lengthen the game (bad in the long run). At each step where there's a choice, either of these choices is equally good. So it remains only to figure out who should win.</p>\n\n<p>The problem specifies 17 goats, 55 wolves and 6 lions. The significant thing about this is that 17 and 55 are both odd, while 6 is even. At each step, <em>all three parities change</em>. Therefore, the only two that can hit zero at the same time are goats and wolves. Though there are only 6 lions to begin with, they must ultimately survive! Whenever the numbers don't all have the same parity, the winner must be the one that's different from the others.</p>\n\n<p>When all three numbers have the same parity, the easiest way to pick the winner is to calculate the score for each possibility and select the largest. How do we calculate the score? Suppose we select goats to win, and the numbers are labeled <code>g</code>, <code>l</code>, and <code>w</code>. So we need <code>|l - w| / 2</code> balancing moves to balance the lions with the wolves. We additionally need <code>(l + w)/2</code> moves to kill off the lions and wolves. So the total number of goats in the end is <code>g - |l - w|/2 + (l + w)/2</code>. Thus</p>\n\n<ol>\n<li><p>If there are more lions than wolves, there will be <code>g + w</code> goats in the end.</p></li>\n<li><p>If there are more wolves than lions, there will be <code>g + l</code> goats in the end.</p></li>\n</ol>\n\n<p>You can now calculate the final configuration in <em>constant time</em>, and you can calculate a path to reach it in <em>linear time</em>.</p>\n"}], "owner": {"reputation": 11693, "user_id": 858962, "user_type": "registered", "accept_rate": 57, "profile_image": "https://www.gravatar.com/avatar/5f16ec0395b1710fd529b01602de66ca?s=128&d=identicon&r=PG", "display_name": "dopatraman", "link": "https://stackoverflow.com/users/858962/dopatraman"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 234, "favorite_count": 0, "answer_count": 3, "score": 2, "last_activity_date": 1458936782, "creation_date": 1458353387, "question_id": 36097043, "link": "https://stackoverflow.com/questions/36097043/solving-the-lions-wolves-and-goats", "title": "solving the Lions, Wolves, and Goats", "body": "<p>I'm trying to tackle the Lions Wolves and Goats problem found <a href=\"http://unriskinsight.blogspot.com/2014/04/goats-wolves-and-lions.html\" rel=\"nofollow\">here</a></p>\n\n<pre><code>-- Lions Wolves Goats\n-- Lion -&gt; Wolf -&gt; Goat :: -1, -1, +1\n-- Lion -&gt; Goat -&gt; Wolf :: -1, +1, -1\n-- Wolf -&gt; Goat -&gt; Lion :: +1, -1, -1\n--                      -------------\n--                      :: -1, -1, -1\n</code></pre>\n\n<p>This is what my solution looks like:</p>\n\n<pre><code>eat :: (Int, Int, Int) -&gt; (Int, Int, Int)\neat (lions, wolves, goats) = eat (lions - 1, wolves - 1, goats - 1)\neat (0, wolves, goats) = eat (1, wolves - 1, goats - 1)\neat (lions, 0, goats) = eat (lions - 1, 1, goats - 1)\neat (lions, wolves, 0) = eat (lions - 1, wolves - 1, 1)\neat (0, 0, goats) = (0, 0, goats)\n</code></pre>\n\n<p>This code compiles but the code hangs forever. I'm pretty sure I've missed a match but I don't know what. Please let me know how to solve this problem correctly.</p>\n"}, {"tags": ["haskell", "vector", "stream-fusion"], "comments": [{"owner": {"reputation": 100185, "user_id": 3234959, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/93bb12ca0f93dfddb33880316f7e66c2?s=128&d=identicon&r=PG&f=1", "display_name": "chi", "link": "https://stackoverflow.com/users/3234959/chi"}, "edited": false, "score": 1, "creation_date": 1458344171, "post_id": 36095925, "comment_id": 59836164, "body": "Perhaps, that&#39;s because in practical applications it&#39;s fairly uncommon to build a vector only to compute its length, discarding all the elements in the process, and no one coded a fusion rule for this case."}, {"owner": {"reputation": 13626, "user_id": 492865, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/5c69a2080e68c8606961a18aba3a08ec?s=128&d=identicon&r=PG", "display_name": "Yuras", "link": "https://stackoverflow.com/users/492865/yuras"}, "reply_to_user": {"reputation": 100185, "user_id": 3234959, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/93bb12ca0f93dfddb33880316f7e66c2?s=128&d=identicon&r=PG&f=1", "display_name": "chi", "link": "https://stackoverflow.com/users/3234959/chi"}, "edited": false, "score": 1, "creation_date": 1458345202, "post_id": 36095925, "comment_id": 59836448, "body": "@chi I thought <code>Vector.length</code> is implemented in terms of <code>Stream.length</code>, so fusion should be automatically available. But I know little about stream fusion internals. Anyway &quot;it is uncommon use case&quot; is a valid answer too."}, {"owner": {"reputation": 100185, "user_id": 3234959, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/93bb12ca0f93dfddb33880316f7e66c2?s=128&d=identicon&r=PG&f=1", "display_name": "chi", "link": "https://stackoverflow.com/users/3234959/chi"}, "edited": false, "score": 1, "creation_date": 1458345968, "post_id": 36095925, "comment_id": 59836677, "body": "BTW, I know nothing about how fusion is actually implemented. I&#39;m guessing it&#39;s possible to overlook that case. It&#39;s also possible that there are some technical limitations I can&#39;t see right now. For a fusing variant, <code>sum . map 1</code> could be used to avoid allocating a vector (maybe?)."}, {"owner": {"reputation": 44013, "user_id": 1477667, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/trgKM.jpg?s=128&g=1", "display_name": "dfeuer", "link": "https://stackoverflow.com/users/1477667/dfeuer"}, "reply_to_user": {"reputation": 100185, "user_id": 3234959, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/93bb12ca0f93dfddb33880316f7e66c2?s=128&d=identicon&r=PG&f=1", "display_name": "chi", "link": "https://stackoverflow.com/users/3234959/chi"}, "edited": false, "score": 1, "creation_date": 1458349297, "post_id": 36095925, "comment_id": 59837422, "body": "To avoid confusing future visitors: @chi&#39;s expression was supposed to be <code>sum . (1 &lt;$)</code>."}, {"owner": {"reputation": 100185, "user_id": 3234959, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/93bb12ca0f93dfddb33880316f7e66c2?s=128&d=identicon&r=PG&f=1", "display_name": "chi", "link": "https://stackoverflow.com/users/3234959/chi"}, "reply_to_user": {"reputation": 44013, "user_id": 1477667, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/trgKM.jpg?s=128&g=1", "display_name": "dfeuer", "link": "https://stackoverflow.com/users/1477667/dfeuer"}, "edited": false, "score": 1, "creation_date": 1458351739, "post_id": 36095925, "comment_id": 59837870, "body": "@dfeuer Yes, thanks. Missed a <code>const</code> there, but <code>(1 &lt;$)</code> is even better."}, {"owner": {"reputation": 3116, "user_id": 353187, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/dfdc97f71e1b8c257ae1bbd52989785d?s=128&d=identicon&r=PG", "display_name": "xnyhps", "link": "https://stackoverflow.com/users/353187/xnyhps"}, "edited": false, "score": 0, "creation_date": 1458378651, "post_id": 36095925, "comment_id": 59843072, "body": "This looks like a bug, I&#39;d open a ticket at <a href=\"https://ghc.haskell.org/trac/ghc/\" rel=\"nofollow noreferrer\">ghc.haskell.org/trac/ghc</a> (I can&#39;t find an existing one)."}], "answers": [{"comments": [{"owner": {"reputation": 13626, "user_id": 492865, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/5c69a2080e68c8606961a18aba3a08ec?s=128&d=identicon&r=PG", "display_name": "Yuras", "link": "https://stackoverflow.com/users/492865/yuras"}, "edited": false, "score": 0, "creation_date": 1458381359, "post_id": 36097146, "comment_id": 59843714, "body": "So it is inlining failure, not stream fusing itself. I always thought that relying on inliner is a bit vague. Thanks for the answer!"}], "tags": [], "owner": {"reputation": 37486, "user_id": 371753, "user_type": "registered", "accept_rate": 83, "profile_image": "https://i.stack.imgur.com/znFEK.jpg?s=128&g=1", "display_name": "sclv", "link": "https://stackoverflow.com/users/371753/sclv"}, "is_accepted": true, "score": 4, "last_activity_date": 1458354550, "creation_date": 1458354550, "answer_id": 36097146, "question_id": 36095925, "link": "https://stackoverflow.com/questions/36095925/why-vector-length-vector-replicate-n-0-is-not-fused/36097146#36097146", "title": "Why `Vector.length (Vector.replicate n 0)&quot; is not fused?", "body": "<p>I used <code>sum</code> and <code>length</code> from <code>Data.Vector.Generic</code> rather than <code>Data.Vector</code> since the latter are just defined as the former.</p>\n\n<p>Here's the code for length (from <code>Data.Vector.Generic</code>) ...</p>\n\n<pre><code>-- | /O(1)/ Yield the length of the vector.\nlength :: Vector v a =&gt; v a -&gt; Int\n{-# INLINE length #-}\nlength = Bundle.length . stream\n</code></pre>\n\n<p>Hmm.. so let's look at \"sum\"</p>\n\n<pre><code>-- | /O(n)/ Compute the sum of the elements\nsum :: (Vector v a, Num a) =&gt; v a -&gt; a\n{-# INLINE sum #-}\nsum = Bundle.foldl' (+) 0 . stream\n</code></pre>\n\n<p>But if I run <code>ghc -ddump-inlinings -ddump-rule-firings -O2</code> with sum I see</p>\n\n<pre><code>Rule fired: SPEC Data.Vector.$fVectorVectora [GHC.Types.Int]\nInlining done: System.IO.print\nInlining done: System.IO.print1\nInlining done: Data.Vector.Generic.sum\nRule fired: Class op +\nRule fired: Class op fromInteger\nInlining done: GHC.Num.$fNumInt_$cfromInteger\nRule fired: integerToInt\nInlining done: Data.Vector.Fusion.Util.unId\nInlining done: Data.Vector.Fusion.Util.unId1\nInlining done: Data.Vector.replicate\nInlining done: Data.Vector.Generic.replicate\n</code></pre>\n\n<p>And if I run it with <code>length</code> I see:</p>\n\n<pre><code>Rule fired: SPEC Data.Vector.$fVectorVectora [GHC.Types.Int]\nInlining done: System.IO.print\nInlining done: System.IO.print1\nInlining done: Data.Vector.replicate\nInlining done: Data.Vector.Generic.replicate\nRule fired: SPEC Data.Vector.$fVectorVectora [GHC.Types.Int]\n</code></pre>\n\n<p>So <code>sum</code> gets inlined and <code>length</code> doesn't, and I don't understand why. And even turning up the unfolding threshold to ridiculous amounts doesn't change that.</p>\n\n<p>That said, if I manually replace <code>Vector.length</code> with <code>Bundle.length . Vector.stream</code>, the <code>stream/unstream</code> rule <em>does</em> fire, as in the <code>sum</code> case, and a very tidy core is generated with no array allocations.</p>\n"}, {"comments": [{"owner": {"reputation": 13626, "user_id": 492865, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/5c69a2080e68c8606961a18aba3a08ec?s=128&d=identicon&r=PG", "display_name": "Yuras", "link": "https://stackoverflow.com/users/492865/yuras"}, "edited": false, "score": 0, "creation_date": 1458400781, "post_id": 36103226, "comment_id": 59849437, "body": "Then it is a regression, I&#39;ll open an issue. BTW <code>--show-iface</code> trick is nice!"}, {"owner": {"reputation": 44013, "user_id": 1477667, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/trgKM.jpg?s=128&g=1", "display_name": "dfeuer", "link": "https://stackoverflow.com/users/1477667/dfeuer"}, "edited": false, "score": 1, "creation_date": 1458401961, "post_id": 36103226, "comment_id": 59849781, "body": "The fact that only master wizards with good Emacs configurations can read <code>vector</code> source code seems a rather unfortunate effect of the &quot;fusion bundle&quot; strategy."}], "tags": [], "owner": {"reputation": 14485, "user_id": 190376, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/cd8280c5e1491b8cf55760750ed97dec?s=128&d=identicon&r=PG", "display_name": "Reid Barton", "link": "https://stackoverflow.com/users/190376/reid-barton"}, "is_accepted": false, "score": 2, "last_activity_date": 1458399348, "creation_date": 1458399348, "answer_id": 36103226, "question_id": 36095925, "link": "https://stackoverflow.com/questions/36095925/why-vector-length-vector-replicate-n-0-is-not-fused/36103226#36103226", "title": "Why `Vector.length (Vector.replicate n 0)&quot; is not fused?", "body": "<p>This is an extension of sclv's answer.</p>\n\n<p>I noticed the behavior in the question occurs with <code>vector-0.11.0.0</code>, but not the other version I happened to have installed, <code>vector-0.10.12.2</code>. Inspecting the <code>Data/Vector/Generic.hi</code> files from those two versions with <code>ghc --show-iface</code>, I found that in version <code>0.11.0.0</code> only, <code>length</code> (but not <code>sum</code>) is marked as a \"loop-breaker\". This means <code>length</code> is part of a mutually recursive group of definitions and GHC has chosen this function to not inline in order to avoid the possibility of an infinite expansion.</p>\n\n<p>I assume what happened is that the changes in <code>0.11.0.0</code> made <code>length</code> part of a cycle of definitions, probably unintentionally, where it wasn't before, but I didn't try to verify that since it would require actually reading <code>vector</code> source code.</p>\n"}], "owner": {"reputation": 13626, "user_id": 492865, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/5c69a2080e68c8606961a18aba3a08ec?s=128&d=identicon&r=PG", "display_name": "Yuras", "link": "https://stackoverflow.com/users/492865/yuras"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 169, "favorite_count": 2, "accepted_answer_id": 36097146, "answer_count": 2, "score": 9, "last_activity_date": 1458401289, "creation_date": 1458343708, "last_edit_date": 1458401289, "question_id": 36095925, "link": "https://stackoverflow.com/questions/36095925/why-vector-length-vector-replicate-n-0-is-not-fused", "title": "Why `Vector.length (Vector.replicate n 0)&quot; is not fused?", "body": "<p>The following code unexpectedly (at least for me) produces an intermediate vector:</p>\n\n<pre><code>import qualified Data.Vector as Vector\n\nmain :: IO ()\nmain =\n  print (test n)\n\nn :: Int\nn = 1000000\n\ntest :: Int -&gt; Int\ntest n = Vector.length (Vector.replicate n (0 :: Int))\n</code></pre>\n\n<p>The relevant part of Core is here (note the <code>newArray# 1000000</code> call):</p>\n\n<pre><code>Main.main4\n  :: forall s_a38t.\n     GHC.Prim.State# s_a38t\n     -&gt; (# GHC.Prim.State# s_a38t, Vector.Vector Int #)\n[GblId,\n Arity=1,\n Str=DmdType,\n Unf=Unf{Src=&lt;vanilla&gt;, TopLvl=True, Value=True, ConLike=True,\n         WorkFree=True, Expandable=True, Guidance=IF_ARGS [0] 399 30}]\nMain.main4 =\n  \\ (@ s_a38t) (s1_a38u [OS=OneShot] :: GHC.Prim.State# s_a38t) -&gt;\n    case GHC.Prim.newArray#\n           @ Int\n           @ (Control.Monad.Primitive.PrimState (GHC.ST.ST s_a38t))\n           1000000\n           (Data.Vector.Mutable.uninitialised @ Int)\n           (s1_a38u\n            `cast` ((GHC.Prim.State#\n                       (Sym (Control.Monad.Primitive.TFCo:R:PrimStateST[0] &lt;s_a38t&gt;_N)))_R\n                    :: GHC.Prim.State# s_a38t\n                       ~R# GHC.Prim.State#\n                             (Control.Monad.Primitive.PrimState (GHC.ST.ST s_a38t))))\n    of _ [Occ=Dead] { (# ipv_a5RG, ipv1_a5RH #) -&gt;\n    letrec {\n      $wa_s609 [InlPrag=[0], Occ=LoopBreaker]\n        :: GHC.Types.SPEC\n           -&gt; GHC.Prim.Int#\n           -&gt; Bool\n           -&gt; GHC.Prim.State# s_a38t\n           -&gt; (# GHC.Prim.State# s_a38t, Int #)\n      [LclId, Arity=4, Str=DmdType &lt;S,1*U&gt;&lt;L,U&gt;&lt;S,1*U&gt;&lt;L,U&gt;]\n      $wa_s609 =\n...\n</code></pre>\n\n<p>At the same time if I replace <code>length</code> with <code>sum</code>, fusion occurs correctly:</p>\n\n<pre><code>test n = Vector.sum (Vector.replicate n (0 :: Int))\n</code></pre>\n\n<p>Core:</p>\n\n<pre><code>Rec {\nMain.main_$s$wfoldlM'_loop [Occ=LoopBreaker]\n  :: GHC.Prim.Int# -&gt; GHC.Prim.Int# -&gt; GHC.Prim.Int#\n[GblId, Arity=2, Caf=NoCafRefs, Str=DmdType &lt;L,U&gt;&lt;L,U&gt;]\nMain.main_$s$wfoldlM'_loop =\n  \\ (sc_s6bx :: GHC.Prim.Int#) (sc1_s6by :: GHC.Prim.Int#) -&gt;\n    case GHC.Prim.tagToEnum# @ Bool (GHC.Prim.&lt;=# sc1_s6by 0)\n    of _ [Occ=Dead] {\n      False -&gt;\n        Main.main_$s$wfoldlM'_loop sc_s6bx (GHC.Prim.-# sc1_s6by 1);\n      True -&gt; sc_s6bx\n    }\nend Rec }\n\nMain.main2 :: String\n[GblId,\n Str=DmdType,\n Unf=Unf{Src=&lt;vanilla&gt;, TopLvl=True, Value=False, ConLike=False,\n         WorkFree=False, Expandable=False, Guidance=IF_ARGS [] 100 30}]\nMain.main2 =\n  case Main.main_$s$wfoldlM'_loop 0 1000000 of ww_s67W { __DEFAULT -&gt;\n  case GHC.Show.$wshowSignedInt 0 ww_s67W (GHC.Types.[] @ Char)\n  of _ [Occ=Dead] { (# ww5_a5Vq, ww6_a5Vr #) -&gt;\n  GHC.Types.: @ Char ww5_a5Vq ww6_a5Vr\n  }\n  }\n</code></pre>\n\n<p>Also, if I rewrite the original function in terms of monadic stream combinators, the intermediate vector is not allocated also:</p>\n\n<pre><code>import qualified Data.Vector.Fusion.Stream.Monadic as Stream\nimport Data.Functor.Identity\n\ntest n = runIdentity $ Stream.length (Stream.replicate n (0 :: Int))\n</code></pre>\n\n<p>Core:</p>\n\n<pre><code>Rec {\nMain.main_$s$wfoldlM'_loop [Occ=LoopBreaker]\n  :: GHC.Prim.Int# -&gt; GHC.Prim.Int# -&gt; GHC.Prim.Int#\n[GblId, Arity=2, Caf=NoCafRefs, Str=DmdType &lt;L,U&gt;&lt;L,U&gt;]\nMain.main_$s$wfoldlM'_loop =\n  \\ (sc_s5lE :: GHC.Prim.Int#) (sc1_s5lF :: GHC.Prim.Int#) -&gt;\n    case GHC.Prim.tagToEnum# @ Bool (GHC.Prim.&lt;=# sc1_s5lF 0)\n    of _ [Occ=Dead] {\n      False -&gt;\n        Main.main_$s$wfoldlM'_loop\n          (GHC.Prim.+# sc_s5lE 1) (GHC.Prim.-# sc1_s5lF 1);\n      True -&gt; sc_s5lE\n    }\nend Rec }\n\nMain.main2 :: String\n[GblId,\n Str=DmdType,\n Unf=Unf{Src=&lt;vanilla&gt;, TopLvl=True, Value=False, ConLike=False,\n         WorkFree=False, Expandable=False, Guidance=IF_ARGS [] 100 30}]\nMain.main2 =\n  case Main.main_$s$wfoldlM'_loop 0 1000000 of ww_s5ke { __DEFAULT -&gt;\n  case GHC.Show.$wshowSignedInt 0 ww_s5ke (GHC.Types.[] @ Char)\n  of _ [Occ=Dead] { (# ww5_a5gi, ww6_a5gj #) -&gt;\n  GHC.Types.: @ Char ww5_a5gi ww6_a5gj\n  }\n  }\n</code></pre>\n\n<p>Why <code>Vector.length</code> breaks fusion?</p>\n\n<p>I'm using <code>ghc-7.10.3</code> and <code>vector-0.11.0.0</code>.</p>\n\n<p>ADDED:\nHere is an issue: <a href=\"https://github.com/haskell/vector/issues/111\" rel=\"nofollow\">https://github.com/haskell/vector/issues/111</a></p>\n"}, {"tags": ["haskell", "matrix"], "comments": [{"owner": {"reputation": 100185, "user_id": 3234959, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/93bb12ca0f93dfddb33880316f7e66c2?s=128&d=identicon&r=PG&f=1", "display_name": "chi", "link": "https://stackoverflow.com/users/3234959/chi"}, "edited": false, "score": 0, "creation_date": 1458345194, "post_id": 36095037, "comment_id": 59836445, "body": "This looks as a job for list comprehensions: enumerate all possible rectangles. You already know which constraints these 4-tuples must satisfy, so you can exploit them."}, {"owner": {"reputation": 221, "user_id": 5464538, "user_type": "registered", "accept_rate": 83, "profile_image": "https://i.stack.imgur.com/MGHR8.jpg?s=128&g=1", "display_name": "pioupiou1211", "link": "https://stackoverflow.com/users/5464538/pioupiou1211"}, "reply_to_user": {"reputation": 100185, "user_id": 3234959, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/93bb12ca0f93dfddb33880316f7e66c2?s=128&d=identicon&r=PG&f=1", "display_name": "chi", "link": "https://stackoverflow.com/users/3234959/chi"}, "edited": false, "score": 0, "creation_date": 1458386417, "post_id": 36095037, "comment_id": 59845129, "body": "Indeed list comprehensions may do the job but I can&#39;t see how to cover all the issues. I have 4 conditions so it seems hard to cover them all"}], "answers": [{"comments": [{"owner": {"reputation": 221, "user_id": 5464538, "user_type": "registered", "accept_rate": 83, "profile_image": "https://i.stack.imgur.com/MGHR8.jpg?s=128&g=1", "display_name": "pioupiou1211", "link": "https://stackoverflow.com/users/5464538/pioupiou1211"}, "edited": false, "score": 0, "creation_date": 1458397968, "post_id": 36101690, "comment_id": 59848559, "body": "Thanks that&#39;s exactly what I needed. So, I just have to map it with <code>getRectangle</code> but how can I bind an argument with map? Explanation: I got: <code>allGridOf :: [Rectangle] -&gt; [Grille] allGridOf x = map getRectangle g0</code> but it doesn&#39;t work. I want to bind g0 here."}, {"owner": {"reputation": 1404, "user_id": 5559663, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/sQiE2.gif?s=128&g=1", "display_name": "baxbaxwalanuksiwe", "link": "https://stackoverflow.com/users/5559663/baxbaxwalanuksiwe"}, "reply_to_user": {"reputation": 221, "user_id": 5464538, "user_type": "registered", "accept_rate": 83, "profile_image": "https://i.stack.imgur.com/MGHR8.jpg?s=128&g=1", "display_name": "pioupiou1211", "link": "https://stackoverflow.com/users/5464538/pioupiou1211"}, "edited": false, "score": 1, "creation_date": 1458399215, "post_id": 36101690, "comment_id": 59848928, "body": "Just use lambda function (or partial application if you can) <code>getAllSubGrids g = map (\\ r -&gt; getRectangle r g) (allRectsOf g)</code>  And then use <code>getAllSubGrids g0</code>"}], "tags": [], "owner": {"reputation": 1404, "user_id": 5559663, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/sQiE2.gif?s=128&g=1", "display_name": "baxbaxwalanuksiwe", "link": "https://stackoverflow.com/users/5559663/baxbaxwalanuksiwe"}, "is_accepted": true, "score": 1, "last_activity_date": 1458391448, "last_edit_date": 1458391448, "creation_date": 1458390244, "answer_id": 36101690, "question_id": 36095037, "link": "https://stackoverflow.com/questions/36095037/create-all-the-small-matrix-from-a-bigger-one-haskell/36101690#36101690", "title": "Create all the &#39;&#39; small&#39;&#39; matrix from a bigger one - Haskell", "body": "<p>Salut :),</p>\n\n<p>For combinations, I often work with the list monad.\nNote that using the <code>do</code> notation like this is equivalent to working with list comprehensions</p>\n\n<p>From a position you can deduce all the rectangles that can originate from a given point:</p>\n\n<pre><code>allRectsOriginatingFrom :: Point -&gt; Grille -&gt; [Rectangle]\nallRectsOriginatingFrom (x, y) g\n    -- Si le point est dans ta grille...\n    | (x &gt;= 1 &amp;&amp; x &lt;= width g) &amp;&amp; (y &gt;= 1 &amp;&amp; y &lt;= height g) = do\n        w &lt;- [0 .. width g - x]\n        h &lt;- [0 .. height g - y]\n        return (x, y, w, h)\n    -- Sinon y'a pas de rectangle possible\n    | otherwise = [] \n</code></pre>\n\n<p>From there, your just have to map the function over all the possible positions on your grid:</p>\n\n<pre><code>allPointsOf :: Grille -&gt; [Point]\nallPointsOf g = do\n    x &lt;- [1 .. width g]\n    y &lt;- [1 .. height g]\n    return (x, y)\n\nallRectsOf :: Grille -&gt; [Rectangle]\nallRectsOf g = do\n    pos &lt;- allPointsOf g\n    allRectsOriginatingFrom pos g\n</code></pre>\n\n<p>And finally, mapping it with your <code>getLigne</code> function will get you every rectangle in your grid.</p>\n\n<p>PS: Try to create datatypes instead of type aliases, it's better in my opinion (e.g. create a datatype like <code>data Rectangle = Rectangle Int Int Int Int</code> instead of <code>type Rectangle = (Int, Int, Int, Int)</code>).</p>\n"}], "owner": {"reputation": 221, "user_id": 5464538, "user_type": "registered", "accept_rate": 83, "profile_image": "https://i.stack.imgur.com/MGHR8.jpg?s=128&g=1", "display_name": "pioupiou1211", "link": "https://stackoverflow.com/users/5464538/pioupiou1211"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 97, "favorite_count": 0, "accepted_answer_id": 36101690, "answer_count": 1, "score": 0, "last_activity_date": 1458439849, "creation_date": 1458338915, "last_edit_date": 1458439849, "question_id": 36095037, "link": "https://stackoverflow.com/questions/36095037/create-all-the-small-matrix-from-a-bigger-one-haskell", "title": "Create all the &#39;&#39; small&#39;&#39; matrix from a bigger one - Haskell", "body": "<p>I have a rectangular matrix with cases containing B or N. An example of matrix: </p>\n\n<pre><code>g0 = [[B,B,B,B,B,B,N],\n      [B,B,N,B,N,B,B],\n      [N,B,N,N,N,N,N],\n      [B,B,B,N,N,B,N],\n      [N,N,N,B,B,B,B],\n      [B,B,B,N,N,B,N]]\n</code></pre>\n\n<p>I have a type rectangle like <code>[Int,Int,Int,Int]</code> and a function that gets a smaller rectangular matrix from my matrix with this type. Here's the function but that's not the most important part:</p>\n\n<pre><code>getRectangle :: Rectangle -&gt; Grille -&gt; Grille -- cette fonction r\u00e9cup\u00e8re la grille qui correspond au rectangle donn\u00e9\ngetRectangle (i,j,l,c) g = transpose (getLigne (j,c,(nbLigne (transpose g0))) (transpose (getLigne (i,l,(nbLigne g0)) g0)))\n--transpose get create a matrix with (n,m) = (lines,columns) in a matrix (m,n) and nbLigne return the number of lines (or columns when used with transpose) of a matrix.\n\ngetLigne :: (Int,Int,Int) -&gt; Grille -&gt; Grille \ngetLigne (i,l,0) g = []                     \ngetLigne (1,l,1) g = [head g]                \ngetLigne (i,l,indice) [] = []\ngetLigne (i,l,indice) g         \n    | indice == (i+l) =  getLigne (i,l,(indice-1)) (init g) ++ [last g]\n    | indice == i = [last g]\n    | i &lt; indice &amp;&amp; indice &lt; (i+l) = getLigne (i,l,(indice-1)) (init g) ++ [last g]\n    | otherwise = getLigne (i,l,(indice-1)) (init g)\n</code></pre>\n\n<p>Here's an example:</p>\n\n<pre><code>*Main&gt; affiche (getRectangle (1,2,2,3) g0)\n[B,B,B,B]\n[B,N,B,N]\n[B,N,N,N]\n</code></pre>\n\n<p>So, I have a tuple with <code>(i,j,l,c)</code>. Knowing that <code>1&lt;=i&lt;i+l&lt;=n</code> and <code>1&lt;=j&lt;j+c&lt;=m</code> with n the number of lines of the matrix and m the number of columns.\nTo be clear, with a tuple <code>(i,j,l,c)</code>, my function create a rectangle, from my matrix, formed with these cases: <code>(i,j)</code>, <code>(i+l,j)</code>, <code>(i,j+c)</code> and <code>(i+l,j+c)</code>.</p>\n\n<p>Now that I can create a single rectangle, I need to create all the possibles rectangles in any matrix. I don't have any clue on how I can do this since I feel like there is so many rectangles in a single matrix and cover all the cases seems very hard and long to me. </p>\n\n<p>Maybe that I wasn't clear on some points, feel free to ask.</p>\n"}, {"tags": ["haskell", "types"], "comments": [{"owner": {"reputation": 43759, "user_id": 1651941, "user_type": "registered", "accept_rate": 97, "profile_image": "https://www.gravatar.com/avatar/a513bc1fa519d2fcf5e4e0d9b5500101?s=128&d=identicon&r=PG", "display_name": "Sibi", "link": "https://stackoverflow.com/users/1651941/sibi"}, "edited": false, "score": 3, "creation_date": 1458338328, "post_id": 36094886, "comment_id": 59834226, "body": "Folks here can help you better if can show your code which reproduces the above error."}, {"owner": {"reputation": 37486, "user_id": 371753, "user_type": "registered", "accept_rate": 83, "profile_image": "https://i.stack.imgur.com/znFEK.jpg?s=128&g=1", "display_name": "sclv", "link": "https://stackoverflow.com/users/371753/sclv"}, "edited": false, "score": 0, "creation_date": 1458348556, "post_id": 36094886, "comment_id": 59837248, "body": "Note that <code>String</code> is an alias of <code>[Char]</code>."}], "answers": [{"tags": [], "owner": {"reputation": 44013, "user_id": 1477667, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/trgKM.jpg?s=128&g=1", "display_name": "dfeuer", "link": "https://stackoverflow.com/users/1477667/dfeuer"}, "is_accepted": false, "score": 1, "last_activity_date": 1458341761, "creation_date": 1458341761, "answer_id": 36095593, "question_id": 36094886, "link": "https://stackoverflow.com/questions/36094886/map-lookup-strange-behavior-with-typing/36095593#36095593", "title": "Map.lookup strange behavior with typing", "body": "<p>Without seeing your code, there's no way to say for sure, but most likely you've looked something up in a <code>Map</code> and expected to get a <code>String</code> (which is the same as <code>[Char]</code>). In fact, <code>lookup</code> returns a <code>Maybe String</code>, so it can return <code>Nothing</code> if the requested key is not in the <code>Map</code>.</p>\n"}, {"comments": [{"owner": {"reputation": 790, "user_id": 334632, "user_type": "registered", "accept_rate": 94, "profile_image": "https://i.stack.imgur.com/SL2Mb.jpg?s=128&g=1", "display_name": "Joe Hillenbrand", "link": "https://stackoverflow.com/users/334632/joe-hillenbrand"}, "edited": false, "score": 2, "creation_date": 1458347245, "post_id": 36096186, "comment_id": 59836987, "body": "I&#39;d like point out to beginners that this highlights one of the best things about Haskell. Haskell forces the programmer to think about the non-happy path up front and handle it explicitly. This is counter to most other programming languages, but it leads to much more reliable programs."}], "tags": [], "owner": {"reputation": 100185, "user_id": 3234959, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/93bb12ca0f93dfddb33880316f7e66c2?s=128&d=identicon&r=PG&f=1", "display_name": "chi", "link": "https://stackoverflow.com/users/3234959/chi"}, "is_accepted": false, "score": 1, "last_activity_date": 1458349380, "last_edit_date": 1458349380, "creation_date": 1458345605, "answer_id": 36096186, "question_id": 36094886, "link": "https://stackoverflow.com/questions/36094886/map-lookup-strange-behavior-with-typing/36096186#36096186", "title": "Map.lookup strange behavior with typing", "body": "<p>You can't \"convert\" <code>x :: Maybe String</code> to a <code>String</code>, unless you decide how to handle the case where <code>x</code> is <code>Nothing</code> -- in your case, when the element in the <code>Map</code> was not found.</p>\n\n<p>Try something like this:</p>\n\n<pre><code>case Map.lookup ... of\n   Nothing  -&gt; ... -- handle the \"not found\" case\n   Just str -&gt; ... -- handle the \"found\" case, str contains the found string value\n</code></pre>\n\n<p>There's also a <a href=\"https://hackage.haskell.org/package/base-4.8.2.0/docs/Data-Maybe.html#v:maybe\" rel=\"nofollow\">maybe</a> function which can provide a shorter alternative in some cases, but I'd recommend learning how to use a <code>case</code> first.</p>\n"}], "owner": {"reputation": 1164, "user_id": 3119546, "user_type": "registered", "accept_rate": 57, "profile_image": "https://www.gravatar.com/avatar/6d51080abc8a98ac0fce744fcc1f2d2a?s=128&d=identicon&r=PG&f=1", "display_name": "sudobangbang", "link": "https://stackoverflow.com/users/3119546/sudobangbang"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 63, "favorite_count": 0, "closed_date": 1458348536, "answer_count": 2, "score": -3, "last_activity_date": 1458349380, "creation_date": 1458338168, "last_edit_date": 1458340383, "question_id": 36094886, "link": "https://stackoverflow.com/questions/36094886/map-lookup-strange-behavior-with-typing", "closed_reason": "Duplicate", "title": "Map.lookup strange behavior with typing", "body": "<p>I have been using Map.lookup in Haskell and I am constantly getting the following error: </p>\n\n<pre><code>Couldn't match expected type `[Char]` with actual type `Maybe String`.\n</code></pre>\n\n<p>Is there a quick and simple way to convert this?</p>\n"}, {"tags": ["haskell"], "comments": [{"owner": {"reputation": 43759, "user_id": 1651941, "user_type": "registered", "accept_rate": 97, "profile_image": "https://www.gravatar.com/avatar/a513bc1fa519d2fcf5e4e0d9b5500101?s=128&d=identicon&r=PG", "display_name": "Sibi", "link": "https://stackoverflow.com/users/1651941/sibi"}, "edited": false, "score": 1, "creation_date": 1458337728, "post_id": 36094758, "comment_id": 59833978, "body": "What does this mean: <code>(*)r ((a,b), (c,d))</code> ? That doesn&#39;t seem correct."}, {"owner": {"reputation": 2501, "user_id": 2868481, "user_type": "registered", "accept_rate": 48, "profile_image": "https://www.gravatar.com/avatar/d32920192c6bebcffb83fffd557b9553?s=128&d=identicon&r=PG&f=1", "display_name": "d8d0d65b3f7cf42", "link": "https://stackoverflow.com/users/2868481/d8d0d65b3f7cf42"}, "edited": false, "score": 0, "creation_date": 1458338040, "post_id": 36094758, "comment_id": 59834120, "body": "guess he meant to mark the line that the error message refers to."}, {"owner": {"reputation": 43759, "user_id": 1651941, "user_type": "registered", "accept_rate": 97, "profile_image": "https://www.gravatar.com/avatar/a513bc1fa519d2fcf5e4e0d9b5500101?s=128&d=identicon&r=PG", "display_name": "Sibi", "link": "https://stackoverflow.com/users/1651941/sibi"}, "reply_to_user": {"reputation": 2501, "user_id": 2868481, "user_type": "registered", "accept_rate": 48, "profile_image": "https://www.gravatar.com/avatar/d32920192c6bebcffb83fffd557b9553?s=128&d=identicon&r=PG&f=1", "display_name": "d8d0d65b3f7cf42", "link": "https://stackoverflow.com/users/2868481/d8d0d65b3f7cf42"}, "edited": false, "score": 0, "creation_date": 1458338479, "post_id": 36094758, "comment_id": 59834288, "body": "@d8d0d65b3f7cf42 Thanks, i get that now.  It would be better if it wasn&#39;t indicated that way as it&#39;s quite confusing!"}], "answers": [{"tags": [], "owner": {"reputation": 2501, "user_id": 2868481, "user_type": "registered", "accept_rate": 48, "profile_image": "https://www.gravatar.com/avatar/d32920192c6bebcffb83fffd557b9553?s=128&d=identicon&r=PG&f=1", "display_name": "d8d0d65b3f7cf42", "link": "https://stackoverflow.com/users/2868481/d8d0d65b3f7cf42"}, "is_accepted": false, "score": 2, "last_activity_date": 1458338151, "creation_date": 1458338151, "answer_id": 36094880, "question_id": 36094758, "link": "https://stackoverflow.com/questions/36094758/parse-error-on-input-haskell/36094880#36094880", "title": "Parse error on input `=&#39;. Haskell", "body": "<p>it should be </p>\n\n<pre><code>instance C T where\n   foo = bar where\n      bar = ...\n</code></pre>\n\n<p>The first <code>where</code> is missing.</p>\n"}, {"comments": [{"owner": {"reputation": 2501, "user_id": 2868481, "user_type": "registered", "accept_rate": 48, "profile_image": "https://www.gravatar.com/avatar/d32920192c6bebcffb83fffd557b9553?s=128&d=identicon&r=PG&f=1", "display_name": "d8d0d65b3f7cf42", "link": "https://stackoverflow.com/users/2868481/d8d0d65b3f7cf42"}, "edited": false, "score": 1, "creation_date": 1458338445, "post_id": 36094898, "comment_id": 59834276, "body": "Yes yes yes but I do think that giving a hint is more useful than a complete solution. The guy only asked for the syntax error."}], "tags": [], "owner": {"reputation": 43759, "user_id": 1651941, "user_type": "registered", "accept_rate": 97, "profile_image": "https://www.gravatar.com/avatar/a513bc1fa519d2fcf5e4e0d9b5500101?s=128&d=identicon&r=PG", "display_name": "Sibi", "link": "https://stackoverflow.com/users/1651941/sibi"}, "is_accepted": true, "score": 3, "last_activity_date": 1458338563, "last_edit_date": 1458338563, "creation_date": 1458338230, "answer_id": 36094898, "question_id": 36094758, "link": "https://stackoverflow.com/questions/36094758/parse-error-on-input-haskell/36094898#36094898", "title": "Parse error on input `=&#39;. Haskell", "body": "<p>Some errors which I can see:</p>\n\n<ul>\n<li><s>This isn't correct: <code>(*)r ((a,b), (c,d))</code>. Perhaps you meant this: <code>r ((a,b), (c,d))</code></s> The OP was indicating the line using that terminology.</li>\n<li>Your instance definition misses the keyword <code>where</code>. It should be defined like this:\n<code>instance (X a, X b) =&gt; X (a,b) where</code></li>\n<li><p>The type of the function <code>r</code> indicates that it returns a list <code>[a]</code>. But in the first clause of your definition of <code>r'</code>, you are returning a tuple which isn't correct. Perhaps, you want to do this:</p>\n\n<pre><code>  r' ((a, b), (c,d)) b'\n      | a == c &amp;&amp; b == d = [(a,b)]\n</code></pre></li>\n<li><p>Since you are using the function <code>succ</code>, the type variable <code>a</code> and <code>b</code> should be of <code>Enum</code> instances.</p></li>\n</ul>\n\n<p>Fixing all the above error, gives this code which typechecks:</p>\n\n<pre><code>instance (X a, Enum a, Enum b, X b) =&gt; X (a,b) where\n    r ((a,b), (c,d)) = r' ((a,b), (c,d)) b \n        where\n          r' ((a, b), (c,d)) b'\n              | a == c &amp;&amp; b == d = [(a,b)]\n              | b &lt; d = (a,b) : (r' ((a, succ b), (c, d)) b')\n              | otherwise = (a,b) : (r' ((succ a, b'), (c,d)) b')\n</code></pre>\n"}], "owner": {"reputation": 3815, "user_id": 5382150, "user_type": "registered", "accept_rate": 86, "profile_image": "https://i.stack.imgur.com/GwGSL.png?s=128&g=1", "display_name": "Gilgamesz", "link": "https://stackoverflow.com/users/5382150/gilgamesz"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 45, "favorite_count": 0, "accepted_answer_id": 36094898, "answer_count": 2, "score": -1, "last_activity_date": 1458338563, "creation_date": 1458337456, "question_id": 36094758, "link": "https://stackoverflow.com/questions/36094758/parse-error-on-input-haskell", "title": "Parse error on input `=&#39;. Haskell", "body": "<p>I have defined a following class in Haskell</p>\n\n<pre><code>class Ord a =&gt; X a where \n    r :: (a, a) -&gt; [a]        \n\n\ninstance (X a, X b) =&gt; X (a,b)\n    (*)r ((a,b), (c,d)) = r' ((a,b), (c,d)) b where\n        r' ((a, b), (c,d)) b'\n            | a == c &amp;&amp; b == d = (a,b)\n            | b &lt; d = (a,b) : (r' ((a, succ b), (c, d)) b')\n            | otherwise = (a,b) : (r' ((succ a, b'), (c,d)) b')\n</code></pre>\n\n<p>I got error <code>parse error on input</code>='` in line (*)</p>\n\n<p>I don't know how to repair it. Help me please.</p>\n"}, {"tags": ["haskell", "recursion", "tree"], "comments": [{"owner": {"reputation": 13807, "user_id": 2407038, "user_type": "registered", "accept_rate": 64, "profile_image": "https://www.gravatar.com/avatar/538f6f4a9aa43841841de7d8e8b169fc?s=128&d=identicon&r=PG&f=1", "display_name": "user2407038", "link": "https://stackoverflow.com/users/2407038/user2407038"}, "edited": false, "score": 1, "creation_date": 1458334303, "post_id": 36093407, "comment_id": 59832328, "body": "Firstly, you don&#39;t even need the <code>rev (Node v []) = .. </code> case, the general list cases cover the empty list case as well. Secondly, using <code>unzip</code> seems perfectly reasonable - the use of <code>fst</code> and <code>snd</code> (also multiple calls to <code>unzip</code>) should probably be eliminated. You can write it with primitive recursion by eg. <code>rev (Node a ts) = Node a $ uncurry (\\x y -&gt; zip x (y [])) $ foldr (\\(e,t) (as, bs) -&gt; (e:as, bs . (rev t :))) ([], id) ts</code>. But I really doubt this is more efficient than the <code>unzip&#47;reverse</code> version (and it&#39;s certainly uglier)."}], "answers": [{"comments": [{"owner": {"reputation": 44013, "user_id": 1477667, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/trgKM.jpg?s=128&g=1", "display_name": "dfeuer", "link": "https://stackoverflow.com/users/1477667/dfeuer"}, "edited": false, "score": 1, "creation_date": 1458334821, "post_id": 36094053, "comment_id": 59832576, "body": "A picky efficiency point: for Good Reasons (really, I promise), <code>reverse</code> doesn&#39;t participate in list fusion. Therefore, <code>reverse . map f</code> should ideally be fused by hand into an application of <code>mapReverse</code> (a name I made up, with the obvious sense)."}, {"owner": {"reputation": 44013, "user_id": 1477667, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/trgKM.jpg?s=128&g=1", "display_name": "dfeuer", "link": "https://stackoverflow.com/users/1477667/dfeuer"}, "edited": false, "score": 0, "creation_date": 1458335001, "post_id": 36094053, "comment_id": 59832662, "body": "A picky didactic point: the <code>Arrow</code> abstraction is intimidating to even intermediate-level Haskellers like myself. Therefore, I strongly recommend using the <code>second</code> from <code>Data.Bifunctor</code> instead. <code>Bifunctor</code> is, IMO, a much more beginner-friendly abstraction."}, {"owner": {"reputation": 14781, "user_id": 630160, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/4445f21326af525a8ad19af7e3ae41a8?s=128&d=identicon&r=PG", "display_name": "epsilonhalbe", "link": "https://stackoverflow.com/users/630160/epsilonhalbe"}, "edited": false, "score": 0, "creation_date": 1458335111, "post_id": 36094053, "comment_id": 59832714, "body": "what about just using the Functor instance for <code>(,)</code>? it is the same as <code>second</code> if I remember correctly."}, {"owner": {"reputation": 44013, "user_id": 1477667, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/trgKM.jpg?s=128&g=1", "display_name": "dfeuer", "link": "https://stackoverflow.com/users/1477667/dfeuer"}, "reply_to_user": {"reputation": 14781, "user_id": 630160, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/4445f21326af525a8ad19af7e3ae41a8?s=128&d=identicon&r=PG", "display_name": "epsilonhalbe", "link": "https://stackoverflow.com/users/630160/epsilonhalbe"}, "edited": false, "score": 0, "creation_date": 1458335295, "post_id": 36094053, "comment_id": 59832811, "body": "@epsilonhalbe, it&#39;s <i>not</i> actually the same, because the <code>Functor</code> instance is strictly law-abiding (hence probably better here) while the <code>Bifunctor</code> instance is only morally so. So you&#39;re probably right that <code>fmap</code> is better. That said, there&#39;s a case to be made for <code>(,)</code> being a more intuitive <code>Bifunctor</code> than <code>(a,)</code> is a functor."}, {"owner": {"reputation": 100892, "user_id": 745903, "user_type": "registered", "accept_rate": 74, "profile_image": "https://www.gravatar.com/avatar/50933f6638836741e620669b3940410e?s=128&d=identicon&r=PG", "display_name": "leftaroundabout", "link": "https://stackoverflow.com/users/745903/leftaroundabout"}, "reply_to_user": {"reputation": 44013, "user_id": 1477667, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/trgKM.jpg?s=128&g=1", "display_name": "dfeuer", "link": "https://stackoverflow.com/users/1477667/dfeuer"}, "edited": false, "score": 0, "creation_date": 1458335502, "post_id": 36094053, "comment_id": 59832910, "body": "@dfeuer I disagree, arrows are an excellent abstraction IMO. (They&#39;re tricky \u2013 and needless \u2013 as monad substitutes, but I don&#39;t see what&#39;s hard to understand about the <code>Arrow</code> class as such \u2013 you know, <i>it&#39;s just a well-pointed monoidal category, what&#39;s the problem</i>...) Wheras @epsilonhalbe the functor instances of <code>(a,)</code> and <code>a-&gt;</code> are, well... I&#39;m not a fan of these. Really, <code>(,)</code> is the canonical example of a bifunctor, and looking at \u201chalf this bifunctor\u201d is quite a lop-sided perspective."}, {"owner": {"reputation": 14781, "user_id": 630160, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/4445f21326af525a8ad19af7e3ae41a8?s=128&d=identicon&r=PG", "display_name": "epsilonhalbe", "link": "https://stackoverflow.com/users/630160/epsilonhalbe"}, "edited": false, "score": 0, "creation_date": 1458335515, "post_id": 36094053, "comment_id": 59832915, "body": "Now that we have mentioned <code>Bifunctor</code> we should say what it is: it is just something that has two types and is a functor in every one separatedly, think of Pairs, Eithers ..."}, {"owner": {"reputation": 233, "user_id": 4014698, "user_type": "registered", "accept_rate": 38, "profile_image": "https://i.stack.imgur.com/eiVGm.jpg?s=128&g=1", "display_name": "alixander", "link": "https://stackoverflow.com/users/4014698/alixander"}, "edited": false, "score": 0, "creation_date": 1557396613, "post_id": 36094053, "comment_id": 98754732, "body": "how can i write the same function for <code>data Tree t = Node t [Tree t]</code>"}, {"owner": {"reputation": 233, "user_id": 4014698, "user_type": "registered", "accept_rate": 38, "profile_image": "https://i.stack.imgur.com/eiVGm.jpg?s=128&g=1", "display_name": "alixander", "link": "https://stackoverflow.com/users/4014698/alixander"}, "edited": false, "score": 0, "creation_date": 1557754032, "post_id": 36094053, "comment_id": 98860234, "body": "i found it  : <code>reverseT (Node t []) = Node t []  \\n reverseT (Node t (x:xs)) =  Node t $ (map reverseT xs) ++ [reverseT x]</code>"}], "tags": [], "owner": {"reputation": 100892, "user_id": 745903, "user_type": "registered", "accept_rate": 74, "profile_image": "https://www.gravatar.com/avatar/50933f6638836741e620669b3940410e?s=128&d=identicon&r=PG", "display_name": "leftaroundabout", "link": "https://stackoverflow.com/users/745903/leftaroundabout"}, "is_accepted": false, "score": 2, "last_activity_date": 1458334538, "creation_date": 1458334538, "answer_id": 36094053, "question_id": 36093407, "link": "https://stackoverflow.com/questions/36093407/haskell-how-do-i-reverse-a-the-children-of-a-tree-recursive/36094053#36094053", "title": "Haskell : How do I reverse a the children of a Tree recursive", "body": "<p><strong>Zeroth</strong>, clean up your code. You don't need those many parens, and you should avoid duplicate computations. <code>fst</code> and <code>snd</code> on twice the same thing? Meh. Better use pattern matching:</p>\n\n<pre><code>rev :: Tree v e -&gt; Tree v e\nrev (Node v xs)\n  = let (es, cs) = unzip xs\n        xs' = rev' cs\n    in Node v $ zip es (map rev xs')\n\nrev' :: [Tree v e] -&gt; [Tree v e]\nrev' [] = []\nrev' (x:xs) = rev' xs ++ [x]  \n</code></pre>\n\n<p><strong>First</strong> note that <code>rev'</code> is not specific to lists of trees, at all! It's just <sup><sub>an inefficient implementation of</sub></sup> the standard <a href=\"http://hackage.haskell.org/packages/archive/base/latest/doc/html/Prelude.html#v:reverse\" rel=\"nofollow\"><code>reverse</code></a> function, which works on any list.</p>\n\n<p><strong>Second</strong>, this unzipping/zipping is a bit clumsy. Are you sure this is actually the behaviour you want: right now you're only reversing the list of children, but the order of <em>elements</em> stays the same. If not, then you'd better do it all with one reverse and one map:</p>\n\n<pre><code>rev :: Tree v e -&gt; Tree v e\nrev (Node v xs) = Node v . reverse $ map (\\(e,c) -&gt; (e, rev c)) xs\n</code></pre>\n\n<p>or, even nicer,</p>\n\n<pre><code>import Control.Arrow\n\nrev (Node v xs) = Node v . reverse $ map (second rev) xs\n</code></pre>\n"}], "owner": {"reputation": 41, "user_id": 4917855, "user_type": "registered", "accept_rate": 25, "profile_image": "https://www.gravatar.com/avatar/09012b161eafbc5deb798b2078975889?s=128&d=identicon&r=PG&f=1", "display_name": "Rard", "link": "https://stackoverflow.com/users/4917855/rard"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 952, "favorite_count": 0, "answer_count": 1, "score": 0, "last_activity_date": 1458334538, "creation_date": 1458331915, "last_edit_date": 1458333494, "question_id": 36093407, "link": "https://stackoverflow.com/questions/36093407/haskell-how-do-i-reverse-a-the-children-of-a-tree-recursive", "title": "Haskell : How do I reverse a the children of a Tree recursive", "body": "<p>I am trying to reverse the children of a Tree in haskell. The Tree looks like this:  </p>\n\n<pre><code>data Tree v e = Node v [(e,Tree v e)]  \n</code></pre>\n\n<p>At the moment I do it with these two functions:  </p>\n\n<pre><code>rev :: Tree v e -&gt; Tree v e\nrev (Node v []) = Node v []\nrev (Node v xs) =\n  let xs' = (rev'(snd (unzip xs)))\n  in Node v (zip (fst (unzip xs)) (map rev xs'))\n\n\nrev' :: [Tree v e] -&gt; [Tree v e]\nrev' [] = []\nrev' (x:xs) = (rev' xs) ++ [x]  \n</code></pre>\n\n<p>I am not even sure if this works 100%. Is there any way to do it recursive in just one function? I feel like my way is inefficient. I was trying to write a function that looks like this:</p>\n\n<pre><code>revRec :: Tree v e -&gt; Tree v e\nrevRec (Node v [])     = Node v []\nrevRec (Node v (x:xs)) = Node v (revRec xs ++ [x]) \n</code></pre>\n\n<p>Obviosuly I can't call <code>revRec</code> with <code>xs</code> since <code>xs</code> a list. I just can't wrap my head around this problem even though I feel like it shoudn't be that hard.</p>\n"}, {"tags": ["haskell"], "answers": [{"tags": [], "owner": {"reputation": 3040, "user_id": 4308453, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/fc596d8352ad2c4254536343139b5b82?s=128&d=identicon&r=PG&f=1", "display_name": "zakyggaps", "link": "https://stackoverflow.com/users/4308453/zakyggaps"}, "is_accepted": true, "score": 3, "last_activity_date": 1458331346, "creation_date": 1458331346, "answer_id": 36093256, "question_id": 36092146, "link": "https://stackoverflow.com/questions/36092146/rewrite-haskell-expression-in-prefix-notation/36093256#36093256", "title": "Rewrite Haskell expression in prefix notation", "body": "<blockquote>\n  <p>What existing API would be best suited for this task?</p>\n</blockquote>\n\n<p>With Template Haskell and a package <code>th-desugar</code> to desugar Template Haskell. The idea is simple: wrap the expression in quasi-quote, desugar it as template haskell, then render it to haskell code again.</p>\n\n<p>I'm reusing the code for anothe answer here so it may be a little messy:</p>\n\n<pre><code>{-# LANGUAGE DeriveGeneric   #-}\n{-# LANGUAGE QuasiQuotes     #-}\n{-# LANGUAGE TemplateHaskell #-}\n\nimport           Control.Monad\nimport           Generics.Deriving.Monoid\nimport           GHC.Generics\nimport           Language.Haskell.TH.Desugar\n\ndata T = MkT {str :: String, str' :: String}\n  deriving (Generic, Show)\n\nmain = $([| print $ MkT \"a\" \"b\" `mappend` MkT \"c\" \"d\" |] &gt;&gt;= dsExp &gt;&gt;= return . expToTH)\n\ninstance Monoid T where\n  mempty = memptydefault\n  mappend = mappenddefault\n</code></pre>\n\n<p>By <code>-ddump-splices</code> ghc will dump a <code>*.dump-splices</code> file showing what template haskell had done to the source code:</p>\n\n<pre><code>app\\Main.hs:12:10-87: Splicing expression\n    [| print $ MkT \"a\" \"b\" `mappend` MkT \"c\" \"d\" |] &gt;&gt;= dsExp\n    &gt;&gt;= return . expToTH\n  ======&gt;\n    ($) print (mappend (MkT \"a\" \"b\") (MkT \"c\" \"d\"))\n</code></pre>\n"}], "owner": {"reputation": 4471, "user_id": 3858142, "user_type": "registered", "accept_rate": 46, "profile_image": "https://www.gravatar.com/avatar/4c27dead2edf0b6dc28833a694c42ba1?s=128&d=identicon&r=PG&f=1", "display_name": "sevo", "link": "https://stackoverflow.com/users/3858142/sevo"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 100, "favorite_count": 0, "closed_date": 1459097202, "accepted_answer_id": 36093256, "answer_count": 1, "score": 0, "last_activity_date": 1458331346, "creation_date": 1458326844, "question_id": 36092146, "link": "https://stackoverflow.com/questions/36092146/rewrite-haskell-expression-in-prefix-notation", "closed_reason": "Not suitable for this site", "title": "Rewrite Haskell expression in prefix notation", "body": "<p>I would like to implement a program that would take any Haskell expression and rewrite it using prefix notation.</p>\n\n<p>I was hoping that <code>GHC</code> itself would dump some helpful information (like added parentheses after parsing), but unfortunately this does not seem to be the case.</p>\n\n<pre><code>$ ghc Example.hs -fforce-recomp -ddump-tc\n[1 of 1] Compiling Example          ( Example.hs, Example.o )\nTYPE SIGNATURES\n  f :: Maybe ()\nTYPE CONSTRUCTORS\nCOERCION AXIOMS\nDependent modules: []\nDependent packages: [base-4.8.1.0, ghc-prim-0.4.0.0,\n                     integer-gmp-1.0.0.0]\n\n==================== Typechecker ====================\nAbsBinds [] []\n  {Exports: [f &lt;= f_alA\n               &lt;&gt;]\n   Exported types: f :: Maybe ()\n                   [LclId, Str=DmdType]\n   Binds: f_alA = ($) const (GHC.Base.Just) \"Foo\" GHC.Tuple.()}\n</code></pre>\n\n<p>What existing API would be best suited for this task?</p>\n"}, {"tags": ["list", "haskell", "nodes"], "comments": [{"owner": {"reputation": 48129, "user_id": 76051, "user_type": "registered", "accept_rate": 91, "profile_image": "https://i.stack.imgur.com/AGDxz.jpg?s=128&g=1", "display_name": "Carsten", "link": "https://stackoverflow.com/users/76051/carsten"}, "edited": false, "score": 1, "creation_date": 1458321376, "post_id": 36090329, "comment_id": 59825187, "body": "you can get this working if you have split - but if you don&#39;t have it (yet) you basically replaced this problem with another (probably equal difficult for you) problem - have you tried a basic recursive approach with patter-matching on the input list yet? This way it&#39;s rather easy to do - do it and show the code you get if you run into trouble"}], "answers": [{"comments": [{"owner": {"reputation": 17837, "user_id": 1923190, "user_type": "registered", "accept_rate": 62, "profile_image": "https://i.stack.imgur.com/D0JyZ.jpg?s=128&g=1", "display_name": "Simon H", "link": "https://stackoverflow.com/users/1923190/simon-h"}, "edited": false, "score": 0, "creation_date": 1458322879, "post_id": 36090642, "comment_id": 59826129, "body": "I had never seen the @ before in <code>bs&#39;@(b:bs)</code> - looks like it provides two different patterns for the same thing?"}, {"owner": {"reputation": 1164, "user_id": 3119546, "user_type": "registered", "accept_rate": 57, "profile_image": "https://www.gravatar.com/avatar/6d51080abc8a98ac0fce744fcc1f2d2a?s=128&d=identicon&r=PG&f=1", "display_name": "sudobangbang", "link": "https://stackoverflow.com/users/3119546/sudobangbang"}, "edited": false, "score": 0, "creation_date": 1458323175, "post_id": 36090642, "comment_id": 59826289, "body": "@Carsten, how would I reference the list if I am using <code>((a&#39;,_,_):ys)</code>? Like what would I do to return the list combined? something ++ [new list] ++ bs?"}, {"owner": {"reputation": 48129, "user_id": 76051, "user_type": "registered", "accept_rate": 91, "profile_image": "https://i.stack.imgur.com/AGDxz.jpg?s=128&g=1", "display_name": "Carsten", "link": "https://stackoverflow.com/users/76051/carsten"}, "edited": false, "score": 0, "creation_date": 1458325036, "post_id": 36090642, "comment_id": 59827320, "body": "that&#39;s what the <code>bs&#39;@...</code> is for - the <code>bs&#39;</code> represents the the complete pattern after so you don&#39;t have to reconstruct it - it&#39;s really just the same as the solution I gave - I gave the <code>x</code> and the <code>bs&#39;</code> to make it more comfortable for you"}, {"owner": {"reputation": 75362, "user_id": 625403, "user_type": "registered", "accept_rate": 82, "profile_image": "https://www.gravatar.com/avatar/786eed7da67079cb5d63a49d469af25b?s=128&d=identicon&r=PG", "display_name": "amalloy", "link": "https://stackoverflow.com/users/625403/amalloy"}, "edited": false, "score": 0, "creation_date": 1458327740, "post_id": 36090642, "comment_id": 59828957, "body": "I was surprised to see your function not look like <code>insertOrdered x = go where ...</code>, which seemed like an easy improvement to me since you never need to pass a new x. Am I missing some style or good-taste reason why this is worse?"}, {"owner": {"reputation": 48129, "user_id": 76051, "user_type": "registered", "accept_rate": 91, "profile_image": "https://i.stack.imgur.com/AGDxz.jpg?s=128&g=1", "display_name": "Carsten", "link": "https://stackoverflow.com/users/76051/carsten"}, "edited": false, "score": 0, "creation_date": 1458328826, "post_id": 36090642, "comment_id": 59829561, "body": "I don&#39;t know exactly what you mean - IMO you gain nothing here - yes you can use <code>x</code> inside your <code>go</code> without redefining it but if you want to use patter-matching you just have to do it with <code>go</code> in the <code>where</code>... maybe it&#39;s a matter of tast - why don&#39;t you add your answer and let the OP decide?"}], "tags": [], "owner": {"reputation": 48129, "user_id": 76051, "user_type": "registered", "accept_rate": 91, "profile_image": "https://i.stack.imgur.com/AGDxz.jpg?s=128&g=1", "display_name": "Carsten", "link": "https://stackoverflow.com/users/76051/carsten"}, "is_accepted": false, "score": 3, "last_activity_date": 1458322338, "last_edit_date": 1458322338, "creation_date": 1458321931, "answer_id": 36090642, "question_id": 36090329, "link": "https://stackoverflow.com/questions/36090329/haskell-inserting-into-an-ordered-list/36090642#36090642", "title": "Haskell, inserting into an ordered list", "body": "<p>Well the pattern-matching is the usual one.</p>\n\n<p>This is the general case:</p>\n\n<pre><code>insertOrdered :: Ord a =&gt; a -&gt; [a] -&gt; [a]\ninsertOrdered a [] = [a]\ninsertOrdered a bs'@(b:bs)\n  | a &lt;= b     = a : bs'\n  | otherwise = b : insertOrdered a bs\n</code></pre>\n\n<p>your turn: replace the undefined with some code of yours ;)</p>\n\n<hr>\n\n<h3>Note</h3>\n\n<ul>\n<li>Whatever <code>Nil</code> here is you have to either make it an instance of <code>Ord</code> or you have to change the function to directly deal only with the first component of the tuple</li>\n</ul>\n\n<p>I choose to just use:</p>\n\n<pre><code>data Nil = Nil\n         deriving (Show, Eq, Ord)\n</code></pre>\n\n<p>and it will work as is:</p>\n\n<pre><code>\u03bb&gt; let xs = [(2 , Nil, Nil), (4, Nil, Nil), (10, Nil, Nil)]\n\u03bb&gt; insertOrdered (3,Nil,Nil) xs\n[(2,Nil,Nil),(3,Nil,Nil),(4,Nil,Nil),(10,Nil,Nil)]\n</code></pre>\n\n<p>but maybe you have to change this for you like this:</p>\n\n<pre><code>insertOrdered :: Ord a =&gt; (a,b,c) -&gt; [(a,b,c)] -&gt; [(a,b,c)]\ninsertOrdered x [] = undefined\ninsertOrdered x@(a,_,_) ((a',_,_):ys)\n  | a &lt;= a'   = undefined\n  | otherwise = undefined -- probably something with insertOrdered?\n</code></pre>\n"}, {"tags": [], "owner": {"reputation": 1463, "user_id": 3703503, "user_type": "registered", "accept_rate": 86, "profile_image": "https://www.gravatar.com/avatar/1ca51bdb8bc5906975c4133f0bf4873c?s=128&d=identicon&r=PG&f=1", "display_name": "SlySherZ", "link": "https://stackoverflow.com/users/3703503/slysherz"}, "is_accepted": false, "score": 1, "last_activity_date": 1458323925, "last_edit_date": 1495540773, "creation_date": 1458323925, "answer_id": 36091263, "question_id": 36090329, "link": "https://stackoverflow.com/questions/36090329/haskell-inserting-into-an-ordered-list/36091263#36091263", "title": "Haskell, inserting into an ordered list", "body": "<p>I suggest starting with simple lists, like lists of Nums. Here's a function that inserts a member in a list, as long as the elements can be compared:</p>\n\n<pre><code>insertOrdered :: Ord a =&gt; a -&gt; [a] -&gt; [a]   -- Ord means the elements of the list can be ordered\ninsertOrdered item [] = [item]              -- Empty list, return list with a single argument\ninsertOrdered item (first:ls)               -- Split list between first element and the rest of it\n    | item &lt;= first = item : first : ls     -- Append our item at the start and merge everything\n    | otherwise = first : (insertOrdered item ls)   -- Merge the first element with the result of calling this again\n</code></pre>\n\n<p>You can test it immediatly with something like:</p>\n\n<pre><code>insertOrdered 1 [0, 2, 3]    -- [0, 1, 2, 3]\n</code></pre>\n\n<p>Now that it works for the simple case, you can think about your harder one. That means telling Haskell that you type can be ordered and how to do it, which you can learn <a href=\"https://stackoverflow.com/questions/3065954/defining-your-own-ord-for-a-data-type-haskell\">here</a>.</p>\n"}, {"comments": [{"owner": {"reputation": 44013, "user_id": 1477667, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/trgKM.jpg?s=128&g=1", "display_name": "dfeuer", "link": "https://stackoverflow.com/users/1477667/dfeuer"}, "edited": false, "score": 1, "creation_date": 1458342118, "post_id": 36094782, "comment_id": 59835590, "body": "From an efficiency standpoint, it&#39;s usually better to pull out constant arguments only if there are at least two of them. It&#39;s not likely to make a huge difference though."}], "tags": [], "owner": {"reputation": 75362, "user_id": 625403, "user_type": "registered", "accept_rate": 82, "profile_image": "https://www.gravatar.com/avatar/786eed7da67079cb5d63a49d469af25b?s=128&d=identicon&r=PG", "display_name": "amalloy", "link": "https://stackoverflow.com/users/625403/amalloy"}, "is_accepted": false, "score": 2, "last_activity_date": 1458337580, "creation_date": 1458337580, "answer_id": 36094782, "question_id": 36090329, "link": "https://stackoverflow.com/questions/36090329/haskell-inserting-into-an-ordered-list/36094782#36094782", "title": "Haskell, inserting into an ordered list", "body": "<p>My suggestion looks a lot like Carsten's, but I think it's a bit nicer to use an auxiliary <code>go</code> function to avoid having to pass around the <code>x</code> argument manually so often:</p>\n\n<pre><code>insertOrdered :: Ord a =&gt; x -&gt; [a] -&gt; [a]\ninsertOrdered x = go where\n  go [] = [x]\n  go all@(y:ys) | x &lt; y = x : all\n                | otherwise = y : go ys\n</code></pre>\n"}], "owner": {"reputation": 1164, "user_id": 3119546, "user_type": "registered", "accept_rate": 57, "profile_image": "https://www.gravatar.com/avatar/6d51080abc8a98ac0fce744fcc1f2d2a?s=128&d=identicon&r=PG&f=1", "display_name": "sudobangbang", "link": "https://stackoverflow.com/users/3119546/sudobangbang"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 1992, "favorite_count": 0, "answer_count": 3, "score": 0, "last_activity_date": 1458337580, "creation_date": 1458320869, "question_id": 36090329, "link": "https://stackoverflow.com/questions/36090329/haskell-inserting-into-an-ordered-list", "title": "Haskell, inserting into an ordered list", "body": "<p>I am beginning to learn about Haskell and have been closely following the guides at <a href=\"http://learnyouahaskell.com\" rel=\"nofollow\">http://learnyouahaskell.com</a> and the documentation at <a href=\"https://wiki.haskell.org/How_to_work_on_lists\" rel=\"nofollow\">https://wiki.haskell.org/How_to_work_on_lists</a>. I have been working with nodes and binary trees as of late and have run into a problem that I cannot seem to figure out the correct syntax for. </p>\n\n<p>If I have an ordered list of nodes:</p>\n\n<pre><code>[(2 , Nil, Nil), (4, Nil, Nil), (10, Nil, Nil)]\n</code></pre>\n\n<p>And I want to insert a new node <code>(3, Nil, Nil)</code> into the list so that it could be represented as:</p>\n\n<pre><code>[(2, Nil, Nil), (3, Nil, Nil),(4, Nil, Nil), (10, Nil, Nil)]\n</code></pre>\n\n<p>What is the most elegant solution to do this? From what I have read <a href=\"https://wiki.haskell.org/How_to_work_on_lists\" rel=\"nofollow\">here</a> it looks as if you have to split the list in two parts once you detect the correct position but as a beginner im not sure how to do this. Obviously the pseudo code would be something a long the lines of <code>For every Node in the list, compare its number value versus the count value of the new Node . Once this value is greater than  or equal to the current index, split the list into two parts (a and b) and then combine the list in this order a ++ [newElement] ++ b</code>.</p>\n\n<p>In my mind (again, at a beginner level) when trying to implement this it would look like:</p>\n\n<p>sortedInsert </p>\n"}, {"tags": ["haskell", "terminal", "yesod", "ghci", "hoogle"], "answers": [{"comments": [{"owner": {"reputation": 1336, "user_id": 2801316, "user_type": "registered", "accept_rate": 87, "profile_image": "https://i.stack.imgur.com/cqx1a.jpg?s=128&g=1", "display_name": "FtheBuilder", "link": "https://stackoverflow.com/users/2801316/fthebuilder"}, "edited": false, "score": 0, "creation_date": 1458328223, "post_id": 36091596, "comment_id": 59829231, "body": "Could you explain your <code>mv</code> command? <code>mv default.hoo{,-prev}</code>"}, {"owner": {"reputation": 9772, "user_id": 3963, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/9pDQ8.png?s=128&g=1", "display_name": "hao", "link": "https://stackoverflow.com/users/3963/hao"}, "reply_to_user": {"reputation": 1336, "user_id": 2801316, "user_type": "registered", "accept_rate": 87, "profile_image": "https://i.stack.imgur.com/cqx1a.jpg?s=128&g=1", "display_name": "FtheBuilder", "link": "https://stackoverflow.com/users/2801316/fthebuilder"}, "edited": false, "score": 0, "creation_date": 1458334913, "post_id": 36091596, "comment_id": 59832615, "body": "it&#39;s a shell expansion! a{foo,bar} = afoo aba"}], "tags": [], "owner": {"reputation": 9772, "user_id": 3963, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/9pDQ8.png?s=128&g=1", "display_name": "hao", "link": "https://stackoverflow.com/users/3963/hao"}, "is_accepted": true, "score": 3, "last_activity_date": 1458325038, "creation_date": 1458325038, "answer_id": 36091596, "question_id": 36090261, "link": "https://stackoverflow.com/questions/36090261/hoogle-and-yesod-how-to-easily-find-functions-in-non-default-packages/36091596#36091596", "title": "Hoogle and yesod - how to easily find functions in non-default packages", "body": "<p>You'll need to first get Hoogle to create you a yesod-core database:</p>\n\n<pre><code>\u03bb&gt; :!hoogle data yesod-core\n0 warnings, saved to .warnings\nData generation complete\n</code></pre>\n\n<p>Then it just works!</p>\n\n<pre><code>\u03bb&gt; :!hoogle \"+yesod-core MonadHandler m =&gt; Text -&gt; Text -&gt; m ()\"\nYesod.Core.Handler addHeader :: MonadHandler m =&gt; Text -&gt; Text -&gt; m ()\nYesod.Core.Handler deleteCookie :: MonadHandler m =&gt; Text -&gt; Text -&gt; m ()\nYesod.Core.Handler setHeader :: MonadHandler m =&gt; Text -&gt; Text -&gt; m ()\nYesod.Core.Handler setSession :: MonadHandler m =&gt; Text -&gt; Text -&gt; m ()\nYesod.Core.Widget toWidgetMedia :: (ToWidgetMedia site a, MonadWidget m, HandlerSite m ~ site) =&gt; Text -&gt; a -&gt; m ()\nYesod.Core.Json (.=) :: KeyValue kv =&gt; forall v. ToJSON v =&gt; Text -&gt; v -&gt; kv\n</code></pre>\n\n<p>Yuck, the <code>+yesod-core</code> tag isn't great. Fortunately, we can <a href=\"http://newartisans.com/2012/09/running-a-fully-local-hoogle/\" rel=\"nofollow\">combine our Hoogle databases into one big one</a>:</p>\n\n<pre><code>$ cd ~/.stack/snapshots/x86_64-osx/lts-5.8/7.10.3/share/x86_64-osx-ghc-7.10.3/hoogle-4.2.43/databases \n$ mv default.hoo{,-prev}\n$ hoogle combine *.hoo\n</code></pre>\n\n<p>(Your databases path will vary depending on whether you <code>stack install</code>ed or <code>cabal install</code>ed.)</p>\n\n<pre><code>\u03bb&gt; :!hoogle \"addHeader\"\nYesod.Core.Handler addHeader :: MonadHandler m =&gt; Text -&gt; Text -&gt; m ()\nNetwork.CGI.Monad cgiAddHeader :: MonadCGI m =&gt; HeaderName -&gt; String -&gt; m ()\n</code></pre>\n\n<p>Way better than Google.</p>\n"}], "owner": {"reputation": 1336, "user_id": 2801316, "user_type": "registered", "accept_rate": 87, "profile_image": "https://i.stack.imgur.com/cqx1a.jpg?s=128&g=1", "display_name": "FtheBuilder", "link": "https://stackoverflow.com/users/2801316/fthebuilder"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 73, "favorite_count": 0, "accepted_answer_id": 36091596, "answer_count": 1, "score": 3, "last_activity_date": 1458325240, "creation_date": 1458320658, "last_edit_date": 1458325240, "question_id": 36090261, "link": "https://stackoverflow.com/questions/36090261/hoogle-and-yesod-how-to-easily-find-functions-in-non-default-packages", "title": "Hoogle and yesod - how to easily find functions in non-default packages", "body": "<p>I installed hoogle, using <code>stack install hoogle</code>. Now I can search for functions using a command like this from <code>stack ghci</code>:</p>\n\n<pre><code>:!hoogle --count=15 \"[a] -&gt; a\"\n</code></pre>\n\n<p>I am in the root directory of my Yesod project - the main reason I installed it was to get help with Yesod functions - but when I try to find a function from Yesod like <code>addHeader</code>, it doesn't recognize a type defined on Yesod:</p>\n\n<pre><code>:t addHeader\naddHeader :: MonadHandler m =&gt; Text -&gt; Text -&gt; m ()\n:!hoogle --count=15 \"MonadHandler m =&gt; Text -&gt; Text -&gt; m ()\"\nWarning: Unknown class MonadHandler\n.\n.\n.\n</code></pre>\n\n<p>How can I setup hoogle to work beautifully with Yesod and also this very project I am working on, so that hoogle would bring my own functions and Yesod ones?</p>\n"}, {"tags": ["haskell"], "comments": [{"owner": {"reputation": 48129, "user_id": 76051, "user_type": "registered", "accept_rate": 91, "profile_image": "https://i.stack.imgur.com/AGDxz.jpg?s=128&g=1", "display_name": "Carsten", "link": "https://stackoverflow.com/users/76051/carsten"}, "edited": false, "score": 1, "creation_date": 1458321230, "post_id": 36090195, "comment_id": 59825100, "body": "it&#39;s right there: &quot;<code>zip</code> is applied to too few arguments&quot; - <code>zip</code> now is <code>[a] -&gt; ([b] -&gt; [(a,b)])</code> and this bubbles through - just let the <code>xs</code> stand and it will work <code>equal_els xs = ... $ zip xs</code>"}], "answers": [{"comments": [{"owner": {"reputation": 7961, "user_id": 482601, "user_type": "registered", "accept_rate": 88, "profile_image": "https://www.gravatar.com/avatar/52578189717d3748d30828c5fff42ba9?s=128&d=identicon&r=PG", "display_name": "fabian789", "link": "https://stackoverflow.com/users/482601/fabian789"}, "edited": false, "score": 0, "creation_date": 1458324013, "post_id": 36090490, "comment_id": 59826779, "body": "Ah, I understand! Thanks"}, {"owner": {"reputation": 26541, "user_id": 1532460, "user_type": "registered", "accept_rate": 88, "profile_image": "https://www.gravatar.com/avatar/dc5b338bf194a9e117af20bd9b2e4edb?s=128&d=identicon&r=PG", "display_name": "awesoon", "link": "https://stackoverflow.com/users/1532460/awesoon"}, "reply_to_user": {"reputation": 7961, "user_id": 482601, "user_type": "registered", "accept_rate": 88, "profile_image": "https://www.gravatar.com/avatar/52578189717d3748d30828c5fff42ba9?s=128&d=identicon&r=PG", "display_name": "fabian789", "link": "https://stackoverflow.com/users/482601/fabian789"}, "edited": false, "score": 0, "creation_date": 1458324108, "post_id": 36090490, "comment_id": 59826829, "body": "@fabian789 Glad it helped :)"}], "tags": [], "owner": {"reputation": 26541, "user_id": 1532460, "user_type": "registered", "accept_rate": 88, "profile_image": "https://www.gravatar.com/avatar/dc5b338bf194a9e117af20bd9b2e4edb?s=128&d=identicon&r=PG", "display_name": "awesoon", "link": "https://stackoverflow.com/users/1532460/awesoon"}, "is_accepted": true, "score": 3, "last_activity_date": 1458321401, "creation_date": 1458321401, "answer_id": 36090490, "question_id": 36090195, "link": "https://stackoverflow.com/questions/36090195/confusion-about-combining-functions-with-and-zip/36090490#36090490", "title": "Confusion about combining functions with $ and zip", "body": "<p>The type of <code>$</code> is <code>(a -&gt; b) -&gt; a -&gt; b</code>, so it accepts a function and an argument, and then passes the argument to the function.</p>\n\n<p>You are trying to pass <code>zip</code> as a parameter, however, you should pass the result of <code>zip</code> function, i.e. combine two functions. This is the purpose of <code>.</code> (function composition):</p>\n\n<pre><code>Prelude&gt; :t (.)\n(.) :: (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c\n\nPrelude&gt; let equal_els xs = map fst . filter (uncurry (==)) . zip xs\nPrelude&gt; equal_els [1, 2, 3] [1, 4, 3]\n[1,3]\n</code></pre>\n\n<p>However, leaving the last element makes this function unreadable:</p>\n\n<pre><code>Prelude&gt; let equal_els xs =       map fst . filter (uncurry (==))  .  zip   xs\nPrelude&gt; let equal_els xs =  (.) (map fst . filter (uncurry (==)))   (zip   xs)\nPrelude&gt; let equal_els xs = ((.) (map fst . filter (uncurry (==)))) . zip $ xs\nPrelude&gt; let equal_els    = ((.) (map fst . filter (uncurry (==)))) . zip\n</code></pre>\n\n<p>So, I'd leave the function with one parameter.</p>\n"}], "owner": {"reputation": 7961, "user_id": 482601, "user_type": "registered", "accept_rate": 88, "profile_image": "https://www.gravatar.com/avatar/52578189717d3748d30828c5fff42ba9?s=128&d=identicon&r=PG", "display_name": "fabian789", "link": "https://stackoverflow.com/users/482601/fabian789"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 119, "favorite_count": 0, "accepted_answer_id": 36090490, "answer_count": 1, "score": 2, "last_activity_date": 1458321401, "creation_date": 1458320450, "question_id": 36090195, "link": "https://stackoverflow.com/questions/36090195/confusion-about-combining-functions-with-and-zip", "title": "Confusion about combining functions with $ and zip", "body": "<p>The following function takes two lists returns all elements that occur in both lists at the same indices:</p>\n\n<pre><code>equal_els :: Eq a =&gt; [a] -&gt; [a] -&gt; [a]\nequal_els xs ys = map fst $ filter (uncurry (==)) $ zip xs ys\n</code></pre>\n\n<p>Seeing how <code>xs ys</code> occurs at the end on both sides, I did what I always do in that case: remove it! However, the resulting</p>\n\n<pre><code>equal_els = map fst $ filter (uncurry (==)) $ zip\n</code></pre>\n\n<p>does not compile anymore and I cannot for the life of me figure out what the error message is trying to tell me!</p>\n\n<hr>\n\n<pre class=\"lang-none prettyprint-override\"><code>Couldn't match expected type \u2018[a] -&gt; [a] -&gt; [a]\u2019\n            with actual type \u2018[b0]\u2019\nRelevant bindings include\n  equal_els :: [a] -&gt; [a] -&gt; [a] (bound at ...)\nIn the expression: map fst $ filter (uncurry (==)) $ zip\nIn an equation for \u2018equal_els\u2019:\n    equal_els = map fst $ filter (uncurry (==)) $ zip\n\nCouldn't match expected type \u2018[(b0, b0)]\u2019\n            with actual type \u2018[a0] -&gt; [b1] -&gt; [(a0, b1)]\u2019\nProbable cause: \u2018zip\u2019 is applied to too few arguments\nIn the second argument of \u2018($)\u2019, namely \u2018zip\u2019\nIn the second argument of \u2018($)\u2019, namely\n  \u2018filter (uncurry (==)) $ zip\u2019\n</code></pre>\n"}, {"tags": ["haskell"], "comments": [{"owner": {"reputation": 3040, "user_id": 4308453, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/fc596d8352ad2c4254536343139b5b82?s=128&d=identicon&r=PG&f=1", "display_name": "zakyggaps", "link": "https://stackoverflow.com/users/4308453/zakyggaps"}, "edited": false, "score": 0, "creation_date": 1458317790, "post_id": 36089142, "comment_id": 59822903, "body": "If you are not going to use the derived <code>Show</code> instance, you can implement it yourself (<code>Success</code> mapped to <code>&quot;OK&quot;</code>, of source) and define <code>formatAction = show . someAction</code>."}, {"owner": {"reputation": 169, "user_id": 4386129, "user_type": "registered", "accept_rate": 100, "profile_image": "https://graph.facebook.com/100000394595220/picture?type=large", "display_name": "BarbedWire", "link": "https://stackoverflow.com/users/4386129/barbedwire"}, "reply_to_user": {"reputation": 3040, "user_id": 4308453, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/fc596d8352ad2c4254536343139b5b82?s=128&d=identicon&r=PG&f=1", "display_name": "zakyggaps", "link": "https://stackoverflow.com/users/4308453/zakyggaps"}, "edited": false, "score": 0, "creation_date": 1458318589, "post_id": 36089142, "comment_id": 59823428, "body": "OK. It&#39;s not about &#39;show&#39;. This code doesn&#39;t compile because of:  Couldn&#39;t match expected type <code>MyData -&gt; String&#39;                 with actual type </code>[Char]&#39;     In the expression: &quot;OK&quot;     In a case alternative: Success -&gt; &quot;OK&quot;     In the expression:       case res of {         Success -&gt; &quot;OK&quot;         Fail -&gt; &quot;Fail&quot; }"}, {"owner": {"reputation": 100185, "user_id": 3234959, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/93bb12ca0f93dfddb33880316f7e66c2?s=128&d=identicon&r=PG&f=1", "display_name": "chi", "link": "https://stackoverflow.com/users/3234959/chi"}, "edited": false, "score": 1, "creation_date": 1458320670, "post_id": 36089142, "comment_id": 59824805, "body": "The problem is that <code>processData</code> does not take any arguments, and does not forward them to <code>doSomeWork&#39;</code>. Hence, <code>res</code> is a <i>function</i>, not a <code>SomeData</code> value, and you can&#39;t pattern match on that. Simon H. below did it correctly."}, {"owner": {"reputation": 169, "user_id": 4386129, "user_type": "registered", "accept_rate": 100, "profile_image": "https://graph.facebook.com/100000394595220/picture?type=large", "display_name": "BarbedWire", "link": "https://stackoverflow.com/users/4386129/barbedwire"}, "edited": false, "score": 0, "creation_date": 1458320927, "post_id": 36089142, "comment_id": 59824957, "body": "May be you are right. I&#39;ve tried so many variants and probably decided to use pointless style only..:))"}], "answers": [{"tags": [], "owner": {"reputation": 17837, "user_id": 1923190, "user_type": "registered", "accept_rate": 62, "profile_image": "https://i.stack.imgur.com/D0JyZ.jpg?s=128&g=1", "display_name": "Simon H", "link": "https://stackoverflow.com/users/1923190/simon-h"}, "is_accepted": true, "score": 2, "last_activity_date": 1458335864, "last_edit_date": 1458335864, "creation_date": 1458317797, "answer_id": 36089294, "question_id": 36089142, "link": "https://stackoverflow.com/questions/36089142/usin-case-expression-to-wrap-result-in-haskell/36089294#36089294", "title": "Usin case expression to wrap result in Haskell", "body": "<p>You may need to add the function parameter</p>\n\n<pre><code>formatAction :: MyData -&gt; String\nformatAction d = \n  case someAction d of \n    Success -&gt; \"OK\"\n    Fail -&gt; \"Fail\"\n</code></pre>\n"}], "owner": {"reputation": 169, "user_id": 4386129, "user_type": "registered", "accept_rate": 100, "profile_image": "https://graph.facebook.com/100000394595220/picture?type=large", "display_name": "BarbedWire", "link": "https://stackoverflow.com/users/4386129/barbedwire"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 107, "favorite_count": 1, "accepted_answer_id": 36089294, "answer_count": 1, "score": 0, "last_activity_date": 1458335864, "creation_date": 1458317355, "last_edit_date": 1458320407, "question_id": 36089142, "link": "https://stackoverflow.com/questions/36089142/usin-case-expression-to-wrap-result-in-haskell", "title": "Usin case expression to wrap result in Haskell", "body": "<p>Suppose I have some type</p>\n\n<pre><code>data Result = Fail | Success deriving (Show)\n</code></pre>\n\n<p>expressing result of some operation and another arbitrary type</p>\n\n<pre><code>data MyData\n</code></pre>\n\n<p>and some function which processes the data</p>\n\n<pre><code>someAction :: MyData -&gt; Result\nsomeAction = if ... then Success else Fail\n</code></pre>\n\n<p>I need a wrapper function formatAction which calls someAction with MyData and formats the result of processing using case statement. Something like that:</p>\n\n<pre><code>formatAction :: MyData -&gt; String\nformatAction = let res = someAction in\n  case res of \n    Success -&gt; \"OK\"\n    Fail -&gt; \"Fail\"\n</code></pre>\n\n<p>It's not a valid code, but I can't undestand how to use result of the function with 'case' expression. Any idea? </p>\n\n<p>Actually I meant a piece of code like that:</p>\n\n<pre><code>data Result = Fail | Success\n\ndata SomeData = SDS | SDF \n\ndoSomeWork' :: SomeData -&gt; Result\ndoSomeWork' SDS = Success\ndoSomeWork' _ = Fail\n\nprocessData :: SomeData -&gt; String\nprocessData = let res = doSomeWork' in\n    case res of \n        Success -&gt; \"OK\"\n        Fail -&gt; \"Fail\"\n</code></pre>\n\n<p>It doesn't compile with the message:</p>\n\n<p><strong>D:\\Work\\Haskell\\revRange.hs:16:17:\n    Couldn't match expected type <code>SomeData -&gt; Result'\n                with actual type</code>Result'\n    In the pattern: Success\n    In a case alternative: Success -> \"OK\"\n    In the expression:\n      case res of {\n        Success -> \"OK\"\n        Fail -> \"Fail\" }\nD:\\Work\\Haskell\\revRange.hs:16:28:\n    Couldn't match expected type <code>SomeData -&gt; String'\n                with actual type</code>[Char]'\n    In the expression: \"OK\"\n    In a case alternative: Success -> \"OK\"\n    In the expression:\n      case res of {\n        Success -> \"OK\"\n        Fail -> \"Fail\" }\nD:\\Work\\Haskell\\revRange.hs:17:17:\n    Couldn't match expected type <code>SomeData -&gt; Result'\n                with actual type</code>Result'\n    In the pattern: Fail\n    In a case alternative: Fail -> \"Fail\"\n    In the expression:\n      case res of {\n        Success -> \"OK\"\n        Fail -> \"Fail\" }\nD:\\Work\\Haskell\\revRange.hs:17:25:\n    Couldn't match expected type <code>SomeData -&gt; String'\n                with actual type</code>[Char]'\n    In the expression: \"Fail\"\n    In a case alternative: Fail -> \"Fail\"\n    In the expression:\n      case res of {\n        Success -> \"OK\"\n        Fail -> \"Fail\" }</strong></p>\n\n<p>Just can't catch how to match the result to the patterns.</p>\n"}, {"tags": ["list", "haskell"], "comments": [{"owner": {"reputation": 44013, "user_id": 1477667, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/trgKM.jpg?s=128&g=1", "display_name": "dfeuer", "link": "https://stackoverflow.com/users/1477667/dfeuer"}, "edited": false, "score": 1, "creation_date": 1458316490, "post_id": 36088736, "comment_id": 59821983, "body": "This sounds like a job for list comprehensions. Have you learned about them yet?"}, {"owner": {"reputation": 3, "user_id": 6083341, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/deb468b163442ba76f154c93b8b947b0?s=128&d=identicon&r=PG&f=1", "display_name": "Naleg", "link": "https://stackoverflow.com/users/6083341/naleg"}, "reply_to_user": {"reputation": 44013, "user_id": 1477667, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/trgKM.jpg?s=128&g=1", "display_name": "dfeuer", "link": "https://stackoverflow.com/users/1477667/dfeuer"}, "edited": false, "score": 0, "creation_date": 1458317033, "post_id": 36088736, "comment_id": 59822375, "body": "I have indeed, but I only used them in simple situations where only 1 variable is iterating. How could I do this with 4 different variables, also keeping in mind that I need to test every possibility (so, not only (1,1,1,1), (2,2,2,2), but (3,4,1,2) aswell as (4,3,1,2) for exemple) and I also need to specify somewhere the conditions I stated in my original post."}], "answers": [{"comments": [{"owner": {"reputation": 44013, "user_id": 1477667, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/trgKM.jpg?s=128&g=1", "display_name": "dfeuer", "link": "https://stackoverflow.com/users/1477667/dfeuer"}, "edited": false, "score": 0, "creation_date": 1458317950, "post_id": 36088995, "comment_id": 59823007, "body": "You can just as easily integrate the filtering into the comprehension. Depending on the filter(s), that could even be much more efficient."}, {"owner": {"reputation": 49501, "user_id": 784338, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/ae195ac7c8a5e9002a808544572cc5fc?s=128&d=identicon&r=PG", "display_name": "Daniel Gratzer", "link": "https://stackoverflow.com/users/784338/daniel-gratzer"}, "reply_to_user": {"reputation": 44013, "user_id": 1477667, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/trgKM.jpg?s=128&g=1", "display_name": "dfeuer", "link": "https://stackoverflow.com/users/1477667/dfeuer"}, "edited": false, "score": 0, "creation_date": 1458318040, "post_id": 36088995, "comment_id": 59823065, "body": "@dfeuer Absolutely, I think it&#39;s conceptually clearer to separate the two though and it should perform identically in this usage because the results will stream nicely. I&#39;ve updated with a note though"}, {"owner": {"reputation": 44013, "user_id": 1477667, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/trgKM.jpg?s=128&g=1", "display_name": "dfeuer", "link": "https://stackoverflow.com/users/1477667/dfeuer"}, "edited": false, "score": 0, "creation_date": 1458318633, "post_id": 36088995, "comment_id": 59823459, "body": "My point about efficiency is that sticking conditions <i>between</i> enumerations can avoid a lot of wasted work."}, {"owner": {"reputation": 49501, "user_id": 784338, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/ae195ac7c8a5e9002a808544572cc5fc?s=128&d=identicon&r=PG", "display_name": "Daniel Gratzer", "link": "https://stackoverflow.com/users/784338/daniel-gratzer"}, "reply_to_user": {"reputation": 44013, "user_id": 1477667, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/trgKM.jpg?s=128&g=1", "display_name": "dfeuer", "link": "https://stackoverflow.com/users/1477667/dfeuer"}, "edited": false, "score": 0, "creation_date": 1458318934, "post_id": 36088995, "comment_id": 59823651, "body": "Oh that&#39;s fair, is that relevant here though? @dfeuer"}, {"owner": {"reputation": 44013, "user_id": 1477667, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/trgKM.jpg?s=128&g=1", "display_name": "dfeuer", "link": "https://stackoverflow.com/users/1477667/dfeuer"}, "edited": false, "score": 0, "creation_date": 1458320354, "post_id": 36088995, "comment_id": 59824604, "body": "No way to know, under the circumstances."}, {"owner": {"reputation": 3, "user_id": 6083341, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/deb468b163442ba76f154c93b8b947b0?s=128&d=identicon&r=PG&f=1", "display_name": "Naleg", "link": "https://stackoverflow.com/users/6083341/naleg"}, "edited": false, "score": 0, "creation_date": 1458393802, "post_id": 36088995, "comment_id": 59847305, "body": "Thanks for this great answer. Didn&#39;t know you could write comprehensions lists like that. My problem is solved."}], "tags": [], "owner": {"reputation": 49501, "user_id": 784338, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/ae195ac7c8a5e9002a808544572cc5fc?s=128&d=identicon&r=PG", "display_name": "Daniel Gratzer", "link": "https://stackoverflow.com/users/784338/daniel-gratzer"}, "is_accepted": true, "score": 2, "last_activity_date": 1458318099, "last_edit_date": 1458318099, "creation_date": 1458316876, "answer_id": 36088995, "question_id": 36088736, "link": "https://stackoverflow.com/questions/36088736/generate-a-list-from-another-function-which-returns-a-bool-in-haskell/36088995#36088995", "title": "Generate a list from another function which returns a Bool in Haskell", "body": "<p>There are two basic approaches for doing this in Haskell.</p>\n\n<ol>\n<li>Generate a stream of tuples that satisfy the constaints you listed but don't necessarily return true according to the function</li>\n<li>Use <code>filter</code> to par down the list</li>\n</ol>\n\n<p>Or we can try to avoid generating all that redundant data and just have something like</p>\n\n<ol>\n<li>Use our knowledge of the predicate to only generate a stream of valid tuples in the first place</li>\n</ol>\n\n<p>Since we're working with an arbitrary function, we can't really do the second so we'll opt for the former. Thus we start by generating all of the tuples satisfying the constaints <code>1 &lt;= a &lt; a + c &lt;= n</code> and <code>1 &lt;= b &lt; b + d &lt;= m</code>.</p>\n\n<p>Now it's clear that <code>a</code> is in the range <code>[1 .. n]</code> and <code>b</code> is in <code>[1 .. m]</code>. Furthermore, for each <code>a</code> we can have <code>c</code> in <code>[a + 1 .. n - a]</code> and for each <code>b</code> we can have <code>[b + 1 .. m - b]</code>. We'll use <a href=\"http://learnyouahaskell.com/starting-out#im-a-list-comprehension\" rel=\"nofollow\">Haskell's list comprehensions</a> to encode this is a very snazzy way</p>\n\n<pre><code>allTuples :: Int -&gt; Int -&gt; [(Int, Int, Int, Int)]\nallTuples n m = -- First we take in n, m\n  [(a, b, c, d) |\n    a &lt;- [1 .. n],\n    b &lt;- [1 .. m],\n    c &lt;- [a + 1 .. n - a],\n    d &lt;- [b + 1 .. m - b]]\n</code></pre>\n\n<p>Here these <code>&lt;-</code> will do the right thing and take all possible combinations. Next all we need do is use <a href=\"http://learnyouahaskell.com/higher-order-functions#maps-and-filters\" rel=\"nofollow\"><code>filter</code></a> to remove elements.</p>\n\n<pre><code> prune :: Grid -&gt; [(Int, Int, Int, Int)] -&gt; [(Int, Int, Int, Int)]\n prune grid tuples = filter (\\t -&gt; f grid t) tuples\n -- could have written:\n -- prune grid = filter (f grid)\n -- prune = filter . f\n</code></pre>\n\n<p>Then we can glue them together, but I'll leave this final step to you because I'm not sure how you'll use it in your application. You can also merge these steps into a single list comprehension:</p>\n\n<pre><code>allTuples :: Int -&gt; Int -&gt; [(Int, Int, Int, Int)]\nallTuples n m = -- First we take in n, m\n  [(a, b, c, d) |\n    a &lt;- [1 .. n],\n    b &lt;- [1 .. m],\n    c &lt;- [a + 1 .. n - a],\n    d &lt;- [b + 1 .. m - b],\n    f grid (a, b, c, d)]\n</code></pre>\n"}], "owner": {"reputation": 3, "user_id": 6083341, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/deb468b163442ba76f154c93b8b947b0?s=128&d=identicon&r=PG&f=1", "display_name": "Naleg", "link": "https://stackoverflow.com/users/6083341/naleg"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 182, "favorite_count": 0, "accepted_answer_id": 36088995, "answer_count": 1, "score": 0, "last_activity_date": 1458318899, "creation_date": 1458316131, "last_edit_date": 1458318899, "question_id": 36088736, "link": "https://stackoverflow.com/questions/36088736/generate-a-list-from-another-function-which-returns-a-bool-in-haskell", "title": "Generate a list from another function which returns a Bool in Haskell", "body": "<p>i'm currently working on lists of lists (which we use to represent a grid).\nI have one function which receive 2 arguments (my grid and a tuple of 4 Integers) and it returns a Boolean.</p>\n\n<p>Now with a new function, I need to generate a list of every tuples which returns True for a certain grid. For exemple, <code>function1 (1,3,2,2) grid1</code> will return <code>True</code> so I need to get <code>(1,3,2,2)</code> in my list.</p>\n\n<p>The other problem is that I have multiple conditions to respect for my tuple <code>(a,b,c,d)</code> of 4 Integers such as : <code>1 &lt;= a &lt; a+c &lt;= n and 1 &lt;= b &lt; b+d &lt;= m</code> where <code>n</code> is the number of lines (so length grid) and <code>m</code> is the number of columns (so length (head grid)).</p>\n\n<p>I had the idea to use map but so far I never used it in such a situation and everything I tried failed.</p>\n\n<p>Thanks</p>\n"}, {"tags": ["haskell", "monoids"], "answers": [{"comments": [{"owner": {"reputation": 9455, "user_id": 1172541, "user_type": "registered", "accept_rate": 30, "profile_image": "https://i.stack.imgur.com/LROoN.png?s=128&g=1", "display_name": "PyRulez", "link": "https://stackoverflow.com/users/1172541/pyrulez"}, "edited": false, "score": 1, "creation_date": 1458320504, "post_id": 36088452, "comment_id": 59824702, "body": "&quot;but in the special case when the data type have only one constructor with concrete and monoidal fields the derived instance is unique.&quot; Although there is a <i>natural</i> monoid, it still isn&#39;t unique. It could <code>mappend</code> some of the fields in reverse order."}], "tags": [], "owner": {"reputation": 3040, "user_id": 4308453, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/fc596d8352ad2c4254536343139b5b82?s=128&d=identicon&r=PG&f=1", "display_name": "zakyggaps", "link": "https://stackoverflow.com/users/4308453/zakyggaps"}, "is_accepted": true, "score": 4, "last_activity_date": 1458320694, "last_edit_date": 1495539908, "creation_date": 1458315368, "answer_id": 36088452, "question_id": 36088212, "link": "https://stackoverflow.com/questions/36088212/automatic-propagation-of-monoidal-mappend/36088452#36088452", "title": "Automatic propagation of monoidal mappend", "body": "<p>There's <code>generic-deriving</code> package matches exactly your requirement:</p>\n\n<pre><code>{-# LANGUAGE DeriveGeneric #-}\n\nimport           Generics.Deriving.Monoid\nimport           GHC.Generics\n\ndata T = T {str :: String, str' :: String}\n  deriving (Generic, Show)\n\nmain = undefined\n\ninstance Monoid T where\n  mempty = memptydefault\n  mappend = mappenddefault\n</code></pre>\n\n<p>And some result from ghci:</p>\n\n<pre><code>&gt; T \"a\" \"b\" `mappend` T \"c\" \"d\"\n&lt; T {str = \"ac\", str' = \"bd\"}\n</code></pre>\n\n<p>But it doesn't work out-of-box for your <code>TotalLine</code> data type, since both <code>Int</code> and <code>Float</code> do not have an instance of <code>Monoid</code>.</p>\n\n<p>Also add a dependency just for that purpose is not so economic. You'd better implement the <code>Monoid</code> instance manually.</p>\n\n<hr>\n\n<p>There has been <a href=\"https://stackoverflow.com/questions/11165316/why-cant-ghc-derive-instances-for-monoid\">some discussion</a> on why GHC cannot derive Monoid instances, it turned out in general such derived instance may not be unique.<s> But in the special case when the data type have only one constructor with concrete and monoidal fields the derived instance is unique.</s></p>\n"}, {"comments": [{"owner": {"reputation": 100185, "user_id": 3234959, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/93bb12ca0f93dfddb33880316f7e66c2?s=128&d=identicon&r=PG&f=1", "display_name": "chi", "link": "https://stackoverflow.com/users/3234959/chi"}, "edited": false, "score": 0, "creation_date": 1458319377, "post_id": 36088499, "comment_id": 59823946, "body": "Minor note: I was confused at first by the parenthesis, since I misread it to imply that Nat,Float,... are distinct monoids with domain Int, which makes no sense."}], "tags": [], "owner": {"reputation": 2501, "user_id": 2868481, "user_type": "registered", "accept_rate": 48, "profile_image": "https://www.gravatar.com/avatar/d32920192c6bebcffb83fffd557b9553?s=128&d=identicon&r=PG&f=1", "display_name": "d8d0d65b3f7cf42", "link": "https://stackoverflow.com/users/2868481/d8d0d65b3f7cf42"}, "is_accepted": false, "score": 7, "last_activity_date": 1458315465, "creation_date": 1458315465, "answer_id": 36088499, "question_id": 36088212, "link": "https://stackoverflow.com/questions/36088212/automatic-propagation-of-monoidal-mappend/36088499#36088499", "title": "Automatic propagation of monoidal mappend", "body": "<p>Note there are several monoids with domain Int (Nat, Float, ..)\nso I would find it highly confusing to read code that has <code>instance Monoid Int</code>. Then <code>mappend</code> could be any of plus, times, max, min, and a lot more.</p>\n"}, {"tags": [], "owner": {"reputation": 9455, "user_id": 1172541, "user_type": "registered", "accept_rate": 30, "profile_image": "https://i.stack.imgur.com/LROoN.png?s=128&g=1", "display_name": "PyRulez", "link": "https://stackoverflow.com/users/1172541/pyrulez"}, "is_accepted": false, "score": 3, "last_activity_date": 1458320130, "creation_date": 1458320130, "answer_id": 36090080, "question_id": 36088212, "link": "https://stackoverflow.com/questions/36088212/automatic-propagation-of-monoidal-mappend/36090080#36090080", "title": "Automatic propagation of monoidal mappend", "body": "<p>If you're fine changing the type a little (but that is still isomorphic to yours), you could try this:</p>\n\n<pre><code>{-# LANGUAGE GeneralizedNewtypeDeriving #-}\nimport Data.Monoid\n\nnewtype TotalLine = TotalLine (Sum Int, Sum Float) deriving Monoid\n</code></pre>\n"}], "owner": {"reputation": 849, "user_id": 1714059, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/95f887aedbff06d22b6cfebb4526468e?s=128&d=identicon&r=PG", "display_name": "Batou99", "link": "https://stackoverflow.com/users/1714059/batou99"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 88, "favorite_count": 1, "accepted_answer_id": 36088452, "answer_count": 3, "score": 3, "last_activity_date": 1458433951, "creation_date": 1458314671, "question_id": 36088212, "link": "https://stackoverflow.com/questions/36088212/automatic-propagation-of-monoidal-mappend", "title": "Automatic propagation of monoidal mappend", "body": "<p>Let's say I have a monoid defined as this:</p>\n\n<pre><code>data TotalLine = TotalLine { totalQuantity :: Int, orderTotal :: Float }\n\ninstance Monoid TotalLine where\n  mempty = zero\n  mappend = add\n</code></pre>\n\n<p>As <strong>totalQuantity</strong> and <strong>orderTotal</strong> are both numbers they also form a monoid under <strong>(+)</strong>\nIs there any way to define</p>\n\n<pre><code>add :: TotalLine -&gt; TotalLine -&gt; TotalLine\n</code></pre>\n\n<p>so, Can I just propagate the <strong>mappend</strong> call on each field instead of having to manually define something like</p>\n\n<pre><code>add line1 line2 =\n  TotalLine {\n    totalQuantity = totalQuantity line1 + totalQuantity line2,\n    orderTotal = orderTotal line1 + orderTotal line2\n   }\n</code></pre>\n"}, {"tags": ["haskell", "input", "output"], "answers": [{"comments": [{"owner": {"user_type": "does_not_exist", "display_name": "user6055028"}, "edited": false, "score": 0, "creation_date": 1458296158, "post_id": 36081641, "comment_id": 59807722, "body": "So haskell before writes <code>string</code> to output removes quotes."}, {"owner": {"reputation": 94713, "user_id": 1139697, "user_type": "registered", "accept_rate": 86, "profile_image": "https://www.gravatar.com/avatar/5f136ddb684f39aaee1c028ee1950f6f?s=128&d=identicon&r=PG", "display_name": "Zeta", "link": "https://stackoverflow.com/users/1139697/zeta"}, "edited": false, "score": 0, "creation_date": 1458296333, "post_id": 36081641, "comment_id": 59807846, "body": "@J.Doe: I don&#39;t quite get what you mean. <code>print</code> is <code>putStrLn . show</code>, which is <i>why</i> you get the quotes. You just want to <b>put</b> a <b>str</b> ing on the terminal."}], "tags": [], "owner": {"reputation": 94713, "user_id": 1139697, "user_type": "registered", "accept_rate": 86, "profile_image": "https://www.gravatar.com/avatar/5f136ddb684f39aaee1c028ee1950f6f?s=128&d=identicon&r=PG", "display_name": "Zeta", "link": "https://stackoverflow.com/users/1139697/zeta"}, "is_accepted": true, "score": 2, "last_activity_date": 1458295976, "creation_date": 1458295976, "answer_id": 36081641, "question_id": 36081459, "link": "https://stackoverflow.com/questions/36081459/haskell-write-non-string-from-print/36081641#36081641", "title": "Haskell, write non-string from print", "body": "<p><code>print :: Show a =&gt; a -&gt; IO ()</code> will always use <code>show</code>, which introduces the additional quotes. If you already have a <code>String</code>, use <code>putStrLn</code> or <code>putStr</code>, depending on whether you want to have a newline after putting the <code>String</code>.</p>\n"}], "owner": {"user_type": "does_not_exist", "display_name": "user6055028"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 38, "favorite_count": 1, "closed_date": 1458296050, "accepted_answer_id": 36081641, "answer_count": 1, "score": 0, "last_activity_date": 1458295976, "creation_date": 1458295483, "last_edit_date": 1458295915, "question_id": 36081459, "link": "https://stackoverflow.com/questions/36081459/haskell-write-non-string-from-print", "closed_reason": "Duplicate", "title": "Haskell, write non-string from print", "body": "<pre><code>s &lt;- readFile $ head aruments\nprint $ myFoo s\n</code></pre>\n\n<p><code>s</code> is a String. <code>myFoo</code> is a <code>String -&gt; String</code></p>\n\n<p>It writes to terminal something like:</p>\n\n<pre><code>\"['a', 'b', 'c']\"\n</code></pre>\n\n<p>What that annoying me is <code>\" \"</code>. Is it possible to write only <code>['a', 'b', 'c']</code>? I mean something like in case of interact:  </p>\n\n<pre><code>interact myFoo \n</code></pre>\n\n<p>writes to terminal only <code>['a', 'b', 'c']</code> although <code>myFoo</code> returns <code>String</code>.</p>\n"}, {"tags": ["haskell"], "comments": [{"owner": {"reputation": 23895, "user_id": 472416, "user_type": "registered", "accept_rate": 79, "profile_image": "https://www.gravatar.com/avatar/aa78d79fb4238d200e26fb87e3de947b?s=128&d=identicon&r=PG", "display_name": "utdemir", "link": "https://stackoverflow.com/users/472416/utdemir"}, "edited": false, "score": 3, "creation_date": 1458294585, "post_id": 36081071, "comment_id": 59806585, "body": "What do you mean by &quot;overflow can happen&quot;. Should or supposed to be traverse the whole list to see if anything is True?"}, {"owner": {"reputation": 627, "user_id": 634615, "user_type": "registered", "accept_rate": 27, "profile_image": "https://www.gravatar.com/avatar/5d0319056378070fa0eea3a731fb173c?s=128&d=identicon&r=PG", "display_name": "user634615", "link": "https://stackoverflow.com/users/634615/user634615"}, "reply_to_user": {"reputation": 23895, "user_id": 472416, "user_type": "registered", "accept_rate": 79, "profile_image": "https://www.gravatar.com/avatar/aa78d79fb4238d200e26fb87e3de947b?s=128&d=identicon&r=PG", "display_name": "utdemir", "link": "https://stackoverflow.com/users/472416/utdemir"}, "edited": false, "score": 0, "creation_date": 1458294932, "post_id": 36081071, "comment_id": 59806873, "body": "If the list argument contain all <code>False</code> then we need to tarverse the whole list to check. Am I wrong here?"}, {"owner": {"reputation": 23600, "user_id": 1695172, "user_type": "registered", "accept_rate": 91, "profile_image": "https://www.gravatar.com/avatar/6319d7eafca7852cf04c88598ca31e75?s=128&d=identicon&r=PG", "display_name": "Netwave", "link": "https://stackoverflow.com/users/1695172/netwave"}, "reply_to_user": {"reputation": 23895, "user_id": 472416, "user_type": "registered", "accept_rate": 79, "profile_image": "https://www.gravatar.com/avatar/aa78d79fb4238d200e26fb87e3de947b?s=128&d=identicon&r=PG", "display_name": "utdemir", "link": "https://stackoverflow.com/users/472416/utdemir"}, "edited": false, "score": 0, "creation_date": 1458294942, "post_id": 36081071, "comment_id": 59806882, "body": "@utdemir has the point, you must check it till the last element if all the previus ones are False"}, {"owner": {"reputation": 23600, "user_id": 1695172, "user_type": "registered", "accept_rate": 91, "profile_image": "https://www.gravatar.com/avatar/6319d7eafca7852cf04c88598ca31e75?s=128&d=identicon&r=PG", "display_name": "Netwave", "link": "https://stackoverflow.com/users/1695172/netwave"}, "edited": false, "score": 0, "creation_date": 1458294987, "post_id": 36081071, "comment_id": 59806913, "body": "@user634615, Yes, otherwise you would never know it the last element is  true"}, {"owner": {"reputation": 94713, "user_id": 1139697, "user_type": "registered", "accept_rate": 86, "profile_image": "https://www.gravatar.com/avatar/5f136ddb684f39aaee1c028ee1950f6f?s=128&d=identicon&r=PG", "display_name": "Zeta", "link": "https://stackoverflow.com/users/1139697/zeta"}, "edited": false, "score": 1, "creation_date": 1458295092, "post_id": 36081071, "comment_id": 59806990, "body": "@user634615: No you&#39;re correct about the traversing. But <code>(||)</code> isn&#39;t strict in its arguments, other than, let&#39;s say <code>(+)</code>, where you can get into problems. Therefore, your stack overflow does not happen in <code>or</code>."}, {"owner": {"reputation": 627, "user_id": 634615, "user_type": "registered", "accept_rate": 27, "profile_image": "https://www.gravatar.com/avatar/5d0319056378070fa0eea3a731fb173c?s=128&d=identicon&r=PG", "display_name": "user634615", "link": "https://stackoverflow.com/users/634615/user634615"}, "edited": false, "score": 0, "creation_date": 1458295234, "post_id": 36081071, "comment_id": 59807110, "body": "in case of <code>foldr</code> till we get <code>True</code> we are building up thunks. Is&#39;nt it?"}, {"owner": {"reputation": 48129, "user_id": 76051, "user_type": "registered", "accept_rate": 91, "profile_image": "https://i.stack.imgur.com/AGDxz.jpg?s=128&g=1", "display_name": "Carsten", "link": "https://stackoverflow.com/users/76051/carsten"}, "edited": false, "score": 0, "creation_date": 1458295667, "post_id": 36081071, "comment_id": 59807385, "body": "well ask yourself this question : which one will work for <code>True : repeat False</code>"}], "answers": [{"comments": [{"owner": {"reputation": 627, "user_id": 634615, "user_type": "registered", "accept_rate": 27, "profile_image": "https://www.gravatar.com/avatar/5d0319056378070fa0eea3a731fb173c?s=128&d=identicon&r=PG", "display_name": "user634615", "link": "https://stackoverflow.com/users/634615/user634615"}, "edited": false, "score": 0, "creation_date": 1458296142, "post_id": 36081563, "comment_id": 59807709, "body": "Got it. I didn&#39;t pay attention to definition of (||)"}, {"owner": {"reputation": 13807, "user_id": 2407038, "user_type": "registered", "accept_rate": 64, "profile_image": "https://www.gravatar.com/avatar/538f6f4a9aa43841841de7d8e8b169fc?s=128&d=identicon&r=PG&f=1", "display_name": "user2407038", "link": "https://stackoverflow.com/users/2407038/user2407038"}, "edited": false, "score": 0, "creation_date": 1458298594, "post_id": 36081563, "comment_id": 59809332, "body": "<code>foldr strictOr</code> runs in constant space (no &quot;overflow&quot;) as well. <code>strictOr</code> can be defined by pattern matching or simply <code>\\x y -&gt; x `seq` y `seq` x || y</code>. Maybe there is some super special optimization going on here but I think this property is due to <code>foldr</code> itself."}, {"owner": {"reputation": 94713, "user_id": 1139697, "user_type": "registered", "accept_rate": 86, "profile_image": "https://www.gravatar.com/avatar/5f136ddb684f39aaee1c028ee1950f6f?s=128&d=identicon&r=PG", "display_name": "Zeta", "link": "https://stackoverflow.com/users/1139697/zeta"}, "reply_to_user": {"reputation": 13807, "user_id": 2407038, "user_type": "registered", "accept_rate": 64, "profile_image": "https://www.gravatar.com/avatar/538f6f4a9aa43841841de7d8e8b169fc?s=128&d=identicon&r=PG&f=1", "display_name": "user2407038", "link": "https://stackoverflow.com/users/2407038/user2407038"}, "edited": false, "score": 1, "creation_date": 1458303998, "post_id": 36081563, "comment_id": 59812875, "body": "@user2407038: IIRC, GHC doesn&#39;t use above <code>foldr</code> implementation, but one that&#39;s based on builders. That being said, <code>foldr strictOr</code> fails when interpreted in GHCi on large lists like <code>replicate (10^9) False</code>. I&#39;m not sure whether optimization rules (aka possible builders) defuse that."}], "tags": [], "owner": {"reputation": 94713, "user_id": 1139697, "user_type": "registered", "accept_rate": 86, "profile_image": "https://www.gravatar.com/avatar/5f136ddb684f39aaee1c028ee1950f6f?s=128&d=identicon&r=PG", "display_name": "Zeta", "link": "https://stackoverflow.com/users/1139697/zeta"}, "is_accepted": true, "score": 4, "last_activity_date": 1458295754, "creation_date": 1458295754, "answer_id": 36081563, "question_id": 36081071, "link": "https://stackoverflow.com/questions/36081071/implementation-of-or-in-foldr-and-foldl-in-data-list/36081563#36081563", "title": "Implementation of or in foldr and foldl&#39; in Data.List", "body": "<blockquote>\n  <p>If the list contains all <code>False</code> then [\u2026] We have to reduce till last element.</p>\n</blockquote>\n\n<p>That is correct. </p>\n\n<blockquote>\n  <p>If the list contains all <code>False</code> then overflow can happen [\u2026].</p>\n</blockquote>\n\n<p>That's not. Other than functions like <code>(+)</code>, <code>(||)</code> isn't strict in <em>both</em> arguments. It only pattern matches the left one:</p>\n\n<pre><code>(||) :: Bool -&gt; Bool -&gt; Bool\n(||) True _ = True\n(||) _    x = x\n</code></pre>\n\n<p>Therefore, if we use the definition of <code>foldr</code> for lists, we get:</p>\n\n<pre><code>foldr (||) False [False,False])\n  = False || (foldr (||) False [False]) -- use: False || x = x\n  = foldr (||) False [False]\n  = False || (foldr (||) False [])      -- use: False || x = x\n  = foldr (||) False []\n  = False\n</code></pre>\n\n<p>However, if we use a function where <em>both</em> arguments need to be fully evaluated we get into problems:</p>\n\n<pre><code>foldr (+) 0 [1,2]\n  = 0 + (foldr (+) 1 [2])  -- cannot reduce (+), since it needs right hand side\n  = 0 + (1 + (foldr (+) 2 []))\n  = 0 + (1 + (2))\n  = 0 + (3)\n  = 3\n</code></pre>\n\n<p>Which is why you should use <code>foldl'</code> in this case. But for right-lazy functions like <code>(||)</code> or <code>(:)</code>, <code>foldr</code> is perfectly fine.</p>\n"}], "owner": {"reputation": 627, "user_id": 634615, "user_type": "registered", "accept_rate": 27, "profile_image": "https://www.gravatar.com/avatar/5d0319056378070fa0eea3a731fb173c?s=128&d=identicon&r=PG", "display_name": "user634615", "link": "https://stackoverflow.com/users/634615/user634615"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 206, "favorite_count": 1, "accepted_answer_id": 36081563, "answer_count": 1, "score": 1, "last_activity_date": 1458295754, "creation_date": 1458294438, "question_id": 36081071, "link": "https://stackoverflow.com/questions/36081071/implementation-of-or-in-foldr-and-foldl-in-data-list", "title": "Implementation of or in foldr and foldl&#39; in Data.List", "body": "<p>Here is the declaration of <code>or</code> function from Prelude</p>\n\n<pre><code>or = foldr (||) False\n</code></pre>\n\n<p>This implementation is fine if the list fields contains at least one <code>True</code>\nIf the list contains all <code>False</code> then overflow can happen and  We have to reduce till last element</p>\n\n<p>Here is the implementation using foldl'</p>\n\n<pre><code>or = foldl' (||) False\n</code></pre>\n\n<p>Here though it is inefficient since it has to reduce till last element of the list irrespective of the contents of the list argument. But we are guaranteed that we will not encounter an overflow.</p>\n\n<p>So question is why not use the safer <code>foldl'</code> version</p>\n"}, {"tags": ["haskell", "types", "typeclass", "type-families", "data-kinds"], "answers": [{"tags": [], "owner": {"reputation": 100185, "user_id": 3234959, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/93bb12ca0f93dfddb33880316f7e66c2?s=128&d=identicon&r=PG&f=1", "display_name": "chi", "link": "https://stackoverflow.com/users/3234959/chi"}, "is_accepted": false, "score": 1, "last_activity_date": 1458291602, "creation_date": 1458291602, "answer_id": 36080090, "question_id": 36079644, "link": "https://stackoverflow.com/questions/36079644/how-to-create-a-kind-class-in-haskell-or-ad-hoc-polymorphism-at-the-type-leve/36080090#36080090", "title": "How to create a &quot;kind class&quot; in Haskell, or ad-hoc polymorphism at the type-level using type families", "body": "<p>(This should be a comment but I need more space)</p>\n\n<p>I tried something like</p>\n\n<pre><code>class GoodK (Proxy k) =&gt; NumK (a :: k) (b :: k) where ...\n</code></pre>\n\n<p>but I failed. I have no idea if what you ask is achievable. </p>\n\n<p>The best approximation I got is making <code>Add Bool Bool</code> kind-check, but generate an unsolvable constraint, so that if we ever use it we'll get an error anyway.\nPerhaps this could be enough for your purposes (?).</p>\n\n<pre><code>class Fail a where\n\ninstance Fail a =&gt; NumK (a :: *) (b :: *) where\n    type Add a b = ()\n</code></pre>\n"}, {"comments": [{"owner": {"reputation": 5359, "user_id": 582917, "user_type": "registered", "accept_rate": 81, "profile_image": "https://www.gravatar.com/avatar/98a347823cd1db90af884b227a29c29e?s=128&d=identicon&r=PG", "display_name": "CMCDragonkai", "link": "https://stackoverflow.com/users/582917/cmcdragonkai"}, "edited": false, "score": 0, "creation_date": 1458303717, "post_id": 36080107, "comment_id": 59812665, "body": "Thanks! This is pretty cool, but could you expand on what exactly makes it work? That is, why does it work? For both your open+closed solution, KProxy solution, and the TypeInType solution."}, {"owner": {"reputation": 5359, "user_id": 582917, "user_type": "registered", "accept_rate": 81, "profile_image": "https://www.gravatar.com/avatar/98a347823cd1db90af884b227a29c29e?s=128&d=identicon&r=PG", "display_name": "CMCDragonkai", "link": "https://stackoverflow.com/users/582917/cmcdragonkai"}, "edited": false, "score": 1, "creation_date": 1458304530, "post_id": 36080107, "comment_id": 59813251, "body": "Oh but i just tested your first solution, and it still allows <code>:kind! Add Bool Bool</code> resulting in <code>Add Bool Bool :: *</code>. I was hoping for this to become a type error, instead of being accepted!?"}, {"owner": {"reputation": 5359, "user_id": 582917, "user_type": "registered", "accept_rate": 81, "profile_image": "https://www.gravatar.com/avatar/98a347823cd1db90af884b227a29c29e?s=128&d=identicon&r=PG", "display_name": "CMCDragonkai", "link": "https://stackoverflow.com/users/582917/cmcdragonkai"}, "edited": false, "score": 1, "creation_date": 1458305069, "post_id": 36080107, "comment_id": 59813635, "body": "Also your second solution also allows <code>Add Bool Bool</code>. It doesn&#39;t show up as a type error."}, {"owner": {"reputation": 28873, "user_id": 1068232, "user_type": "registered", "accept_rate": 79, "profile_image": "https://www.gravatar.com/avatar/2a0a145ce58c20013969fe3f203531da?s=128&d=identicon&r=PG", "display_name": "Andr&#225;s Kov&#225;cs", "link": "https://stackoverflow.com/users/1068232/andr%c3%a1s-kov%c3%a1cs"}, "reply_to_user": {"reputation": 5359, "user_id": 582917, "user_type": "registered", "accept_rate": 81, "profile_image": "https://www.gravatar.com/avatar/98a347823cd1db90af884b227a29c29e?s=128&d=identicon&r=PG", "display_name": "CMCDragonkai", "link": "https://stackoverflow.com/users/582917/cmcdragonkai"}, "edited": false, "score": 1, "creation_date": 1458306025, "post_id": 36080107, "comment_id": 59814354, "body": "That&#39;s unavoidable. If we have a well-kinded type family application, and there isn&#39;t a matching case for the arguments, we get a stuck application, instead of a pattern error as in runtime. A stuck application cannot be used for anything (with an <a href=\"http://hackage.haskell.org/package/constraints-0.6/docs/Data-Constraint-Forall.html\" rel=\"nofollow noreferrer\">esoteric exception</a>) so this behavior is safe."}, {"owner": {"reputation": 28873, "user_id": 1068232, "user_type": "registered", "accept_rate": 79, "profile_image": "https://www.gravatar.com/avatar/2a0a145ce58c20013969fe3f203531da?s=128&d=identicon&r=PG", "display_name": "Andr&#225;s Kov&#225;cs", "link": "https://stackoverflow.com/users/1068232/andr%c3%a1s-kov%c3%a1cs"}, "reply_to_user": {"reputation": 5359, "user_id": 582917, "user_type": "registered", "accept_rate": 81, "profile_image": "https://www.gravatar.com/avatar/98a347823cd1db90af884b227a29c29e?s=128&d=identicon&r=PG", "display_name": "CMCDragonkai", "link": "https://stackoverflow.com/users/582917/cmcdragonkai"}, "edited": false, "score": 0, "creation_date": 1458306359, "post_id": 36080107, "comment_id": 59814607, "body": "So, your solution of defining a single poly-kinded closed type family is also safe, it&#39;s just not extensible/modular."}, {"owner": {"reputation": 5359, "user_id": 582917, "user_type": "registered", "accept_rate": 81, "profile_image": "https://www.gravatar.com/avatar/98a347823cd1db90af884b227a29c29e?s=128&d=identicon&r=PG", "display_name": "CMCDragonkai", "link": "https://stackoverflow.com/users/582917/cmcdragonkai"}, "edited": false, "score": 0, "creation_date": 1458357745, "post_id": 36080107, "comment_id": 59838827, "body": "Ok I guess the behaviour is not possible/not desirable?"}, {"owner": {"reputation": 28873, "user_id": 1068232, "user_type": "registered", "accept_rate": 79, "profile_image": "https://www.gravatar.com/avatar/2a0a145ce58c20013969fe3f203531da?s=128&d=identicon&r=PG", "display_name": "Andr&#225;s Kov&#225;cs", "link": "https://stackoverflow.com/users/1068232/andr%c3%a1s-kov%c3%a1cs"}, "reply_to_user": {"reputation": 5359, "user_id": 582917, "user_type": "registered", "accept_rate": 81, "profile_image": "https://www.gravatar.com/avatar/98a347823cd1db90af884b227a29c29e?s=128&d=identicon&r=PG", "display_name": "CMCDragonkai", "link": "https://stackoverflow.com/users/582917/cmcdragonkai"}, "edited": false, "score": 0, "creation_date": 1458370596, "post_id": 36080107, "comment_id": 59841233, "body": "It&#39;s a valid alternative to the current behavior, perhaps desirable, but definitely not possible currently."}, {"owner": {"reputation": 44013, "user_id": 1477667, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/trgKM.jpg?s=128&g=1", "display_name": "dfeuer", "link": "https://stackoverflow.com/users/1477667/dfeuer"}, "edited": false, "score": 0, "creation_date": 1459355712, "post_id": 36080107, "comment_id": 60252711, "body": "@Andr&#225;sKov&#225;cs, that&#39;s not the only esoteric exception. The same <code>constraints</code> package also defines a (nullary) class that can&#39;t have any instances using <code>class Any =&gt; Bottom where no :: Dict a</code>. Since <code>Any</code> is a stuck type family (used here at kind <code>Constraint</code>!) there is no way to satisfy it, and thus no way whatsoever to write even a bogus instance of <code>Bottom</code>. I&#39;m not sure just why that&#39;s important, if it is, but it&#39;s there."}], "tags": [], "owner": {"reputation": 28873, "user_id": 1068232, "user_type": "registered", "accept_rate": 79, "profile_image": "https://www.gravatar.com/avatar/2a0a145ce58c20013969fe3f203531da?s=128&d=identicon&r=PG", "display_name": "Andr&#225;s Kov&#225;cs", "link": "https://stackoverflow.com/users/1068232/andr%c3%a1s-kov%c3%a1cs"}, "is_accepted": true, "score": 8, "last_activity_date": 1458292016, "last_edit_date": 1458292016, "creation_date": 1458291661, "answer_id": 36080107, "question_id": 36079644, "link": "https://stackoverflow.com/questions/36079644/how-to-create-a-kind-class-in-haskell-or-ad-hoc-polymorphism-at-the-type-leve/36080107#36080107", "title": "How to create a &quot;kind class&quot; in Haskell, or ad-hoc polymorphism at the type-level using type families", "body": "<p>The simplest solution is to use open type families for ad-hoc overloading and closed type families for implementation:</p>\n\n<pre><code>data NatK = Z | S NatK\ndata IntK = I NatK NatK\n\ntype family Add (x :: k) (y :: k) :: k\n\ntype family AddNatK (a :: NatK) (b :: NatK) where\n  AddNatK Z b = b\n  AddNatK (S a) b = S (AddNatK a b)\n\ntype family AddIntK (a :: IntK) (b :: IntK) where\n  AddIntK (I a b) (I a' b') = I (AddNatK a a') (AddNatK b b')\n\ntype instance Add (a :: NatK) (b :: NatK) = AddNatK a b\ntype instance Add (a :: IntK) (b :: IntK) = AddIntK a b\n</code></pre>\n\n<p>If we want multiple type-level and term-level methods grouped together, we can write kind classes using using <code>KProxy</code> from <a href=\"https://hackage.haskell.org/package/base-4.8.2.0/docs/Data-Proxy.html\" rel=\"noreferrer\"><code>Data.Proxy</code></a>:</p>\n\n<pre><code>class NumKind (kproxy :: KProxy k) where\n  type Add (a :: k) (b :: k) :: k\n  -- possibly other methods on type or term level\n\ninstance NumKind ('KProxy :: KProxy NatK) where\n  type Add a b = AddNatK a b\n\ninstance NumKind ('KProxy :: KProxy IntK) where\n  type Add a b = AddIntK a b\n</code></pre>\n\n<p>Of course, associated types are the same as open type families, so we could have also used open type families with a separate class for term-level methods. But I think it's generally cleaner to have all overloaded names in the same class.</p>\n\n<p>From GHC 8.0, <code>KProxy</code> becomes unnecessary since kinds and types will be treated the exact same way:</p>\n\n<pre><code>{-# LANGUAGE TypeInType #-}\n\nimport Data.Kind (Type)\n\nclass NumKind (k :: Type) where\n  type Add (a :: k) (b :: k) :: k\n\ninstance NumKind NatK where\n  type Add a b = AddNatK a b\n\ninstance NumKind IntK where\n  type Add a b = AddIntK a b \n</code></pre>\n"}], "owner": {"reputation": 5359, "user_id": 582917, "user_type": "registered", "accept_rate": 81, "profile_image": "https://www.gravatar.com/avatar/98a347823cd1db90af884b227a29c29e?s=128&d=identicon&r=PG", "display_name": "CMCDragonkai", "link": "https://stackoverflow.com/users/582917/cmcdragonkai"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 518, "favorite_count": 1, "accepted_answer_id": 36080107, "answer_count": 2, "score": 7, "last_activity_date": 1458292016, "creation_date": 1458290252, "question_id": 36079644, "link": "https://stackoverflow.com/questions/36079644/how-to-create-a-kind-class-in-haskell-or-ad-hoc-polymorphism-at-the-type-leve", "title": "How to create a &quot;kind class&quot; in Haskell, or ad-hoc polymorphism at the type-level using type families", "body": "<p>I'm studying the type family features of Haskell, and type level computation.\nIt appears it's quite easy to get parametric polymorphism at the type-level using <code>PolyKinds</code>:</p>\n\n<pre><code>{-# LANGUAGE DataKinds, TypeFamilies, KindSignatures, GADTs, TypeOperators, UndecidableInstances, PolyKinds, MultiParamTypeClasses, FlexibleInstances #-}\n\ndata NatK = Z | S NatK\ndata IntK = I NatK NatK\n\ninfix 6 +\ntype family (x :: NatK) + (y :: NatK) :: NatK where\n    Z     + y = y\n    (S x) + y = S (x + y)\n\n-- here's a parametrically polymorphic (==) at the type-level\n-- it also deals specifically with the I type of kind IntK\ninfix 4 ==\ntype family (a :: k) == (b :: k) :: Bool where\n    (I a1 a2) == (I b1 b2) = (a1 + b2) == (a2 + b1)\n    a == a = True\n    a == b = False\n</code></pre>\n\n<p>I can do things like <code>:kind! Bool == Bool</code> or <code>:kind! Int == Int</code> or <code>:kind! Z == Z</code> and <code>:kind! (I Z (S Z)) == (I (S Z) (S (S Z)))</code>.</p>\n\n<p>However I want to make <code>type +</code> ad-hoc polymorphic. So that it's constrained to the instances I give it. The 2 instances here, would be types of kind <code>NatK</code> and types of kind <code>IntK</code>.</p>\n\n<p>I first tried making it parametrically polymorphic:</p>\n\n<pre><code>infix 6 :+\ntype family (x :: k) :+ (y :: k) :: k where\n    Z         :+ y = y\n    (S x)     :+ y = S (x :+ y)\n    (I x1 x2) :+ (I y1 y2) = I (x1 :+ y1) (x2 :+ y2)\n</code></pre>\n\n<p>This works, as I can do <code>:kind! (I (S Z) Z) :+ (I (S Z) Z)</code>.</p>\n\n<p>However I can also do <code>:kind! Bool :+ Bool</code>. And this doesn't make any sense, but it allows it as a simple type constructor. I want to create a type family that doesn't allow such errant types.</p>\n\n<p>At this point I'm lost. I tried type classes with a <code>type</code> parameter. But that didn't work.</p>\n\n<pre><code>class NumK (a :: k) (b :: k) where\n    type Add a b :: k\n\ninstance NumK (Z :: NatK) (b :: NatK) where\n    type Add Z b = b\n\ninstance NumK (S a :: NatK) (b :: NatK) where\n    type Add (S a) b = S (Add a b)\n\ninstance NumK (I a1 a2 :: IntK) (I b1 b2 :: IntK) where\n    type Add (I a1 a2) (I b1 b2) = I (Add a1 b1) (Add a2 b2)\n</code></pre>\n\n<p>It still allows <code>:kind! Add Bool Bool</code>.</p>\n\n<p>Does this have something to do with the <code>ConstraintKinds</code> extension, where I need to constrain the <code>:+</code> or <code>Add</code> to some \"kind class\"?</p>\n"}, {"tags": ["haskell", "error-handling", "uniqueidentifier", "yesod", "persistent"], "owner": {"reputation": 915, "user_id": 4883095, "user_type": "registered", "accept_rate": 91, "profile_image": "https://www.gravatar.com/avatar/186dca84cf6c850ddeedf8318061e58d?s=128&d=identicon&r=PG&f=1", "display_name": "Nicholas Monta&#241;o", "link": "https://stackoverflow.com/users/4883095/nicholas-monta%c3%b1o"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 48, "favorite_count": 0, "answer_count": 0, "score": 1, "last_activity_date": 1458290151, "creation_date": 1458290151, "question_id": 36079614, "link": "https://stackoverflow.com/questions/36079614/individually-handling-unique-constraint-violations-with-an-entity-containing-two", "title": "Individually handling Unique Constraint violations with an Entity containing two or more Constraints", "body": "<p>I have a User entity with two unique constraints:</p>\n\n<pre><code>share [mkPersist sqlSettings, mkMigrate \"migrateAll\"] [persistLowerCase|\nUser\n    ident Text\n    email Text\n    ...\n    UniqueUser ident\n    UniqueUserEmail email\n|]\n</code></pre>\n\n<p>This entity has two possible fields for which it can throw a Unique constraint violation, and I'd like to be able to handle each one individually. Unfortunately, the <a href=\"http://haddock.stackage.org/lts-5.8/persistent-2.2.4.1/Database-Persist-Class.html#insertUnique\" rel=\"nofollow\"><code>insertUnique</code></a> function can only tell me that <strong><em>some</em></strong> constraint was violated, but not <strong><em>which</em></strong>.</p>\n\n<p>Though <code>replaceUnique</code> returns the <code>Unique</code> violation, there doesn't seem to be an equivalent functionality for <code>insert</code>-based functions.</p>\n\n<p>So, it seems like <code>checkUnique</code> is my best option, and I've tried to roll out something that uses some of the lower-level functions in the <a href=\"http://haddock.stackage.org/lts-5.8/persistent-2.2.4.1/Database-Persist-Class.html#t:PersistEntity\" rel=\"nofollow\"><code>PersistEntity</code></a> class (specifically the <code>persistUniqueToFieldNames</code> and <code>persistUniqueKeys</code> functions), but the best thing I can think to come up with would use fairly shoddy string-equality to handle the appropriate violation, as opposed to data-type matching.</p>\n\n<p>Before I dived in deeper to a stringly-typed implementation, I thought I'd ask here if there was a better way to solve this type of problem. Thank you all for your time.</p>\n"}, {"tags": ["haskell", "notation", "applicative", "nomenclature"], "answers": [{"tags": [], "owner": {"reputation": 25144, "user_id": 477476, "user_type": "registered", "accept_rate": 85, "profile_image": "https://i.stack.imgur.com/Qf4TT.png?s=128&g=1", "display_name": "Cactus", "link": "https://stackoverflow.com/users/477476/cactus"}, "is_accepted": false, "score": 14, "last_activity_date": 1458711577, "last_edit_date": 1458711577, "creation_date": 1458291376, "answer_id": 36080005, "question_id": 36079573, "link": "https://stackoverflow.com/questions/36079573/what-is-the-etymology-of-from-applicative-in-haskell/36080005#36080005", "title": "What is the etymology of &lt;*&gt; from Applicative in Haskell?", "body": "<p><a href=\"http://strictlypositive.org/Idiom.pdf\" rel=\"nofollow noreferrer\">The original idioms paper</a> already uses <code>\u229b</code> for application; <code>&lt;*&gt;</code> was picked as an ASCII-art approximation of that, since <code>(*)</code> isn't available (it is the syntax of the prefix form of the infix operator <code>*</code>).</p>\n"}, {"comments": [{"owner": {"reputation": 1441, "user_id": 399718, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/aaf9ed61cccaec0fcc7c15b395a31583?s=128&d=identicon&r=PG", "display_name": "PLL", "link": "https://stackoverflow.com/users/399718/pll"}, "edited": false, "score": 1, "creation_date": 1458311023, "post_id": 36080164, "comment_id": 59818096, "body": "Just to help in finding this notation in the Fokker paper: it\u2019s introduced on p.5, at the start of &#167;4."}], "tags": [], "owner": {"reputation": 2019, "user_id": 5800895, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/0cab3b0361b7e54267c70c02754f21de?s=128&d=identicon&r=PG&f=1", "display_name": "Derek Elkins left SE", "link": "https://stackoverflow.com/users/5800895/derek-elkins-left-se"}, "is_accepted": true, "score": 28, "last_activity_date": 1458291790, "creation_date": 1458291790, "answer_id": 36080164, "question_id": 36079573, "link": "https://stackoverflow.com/questions/36079573/what-is-the-etymology-of-from-applicative-in-haskell/36080164#36080164", "title": "What is the etymology of &lt;*&gt; from Applicative in Haskell?", "body": "<p>It's an ASCIIification of the notation used in the original idioms paper: \"<a href=\"http://strictlypositive.org/Idiom.pdf\">Idioms: applicative programming with effects</a>\".  That notation, was in turn, inspired by an already ASCIIified version from Sweirstra's and Duponcheel's paper on error-correcting parser combinators: \"<a href=\"http://www.staff.science.uu.nl/~swier101/Papers/1996/DetErrCorrComPars.pdf\">Deterministic, Error-Correcting\nCombinator Parsers</a>\".  That came from \"<a href=\"http://www.staff.science.uu.nl/~fokke101/article/parsers/\">Functional Parsers</a>\" by Jeroen Fokker.  This paper does not indicate where it came from which may mean it originated it.  I would not be surprised if it was used for parsing before then.</p>\n"}], "owner": {"reputation": 28488, "user_id": 402884, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35583fe46c2cde92467710cc7ceff266?s=128&d=identicon&r=PG", "display_name": "Chris Martin", "link": "https://stackoverflow.com/users/402884/chris-martin"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 603, "favorite_count": 6, "accepted_answer_id": 36080164, "answer_count": 2, "score": 26, "last_activity_date": 1458711577, "creation_date": 1458290045, "last_edit_date": 1458291531, "question_id": 36079573, "link": "https://stackoverflow.com/questions/36079573/what-is-the-etymology-of-from-applicative-in-haskell", "title": "What is the etymology of &lt;*&gt; from Applicative in Haskell?", "body": "<p>Where did the name <code>&lt;*&gt;</code> first begin to appear in literature or code, and did it come with any explanation for the choice of symbol?</p>\n"}, {"tags": ["parsing", "haskell", "ghc", "parsec", "parser-combinators"], "comments": [{"owner": {"reputation": 14781, "user_id": 630160, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/4445f21326af525a8ad19af7e3ae41a8?s=128&d=identicon&r=PG", "display_name": "epsilonhalbe", "link": "https://stackoverflow.com/users/630160/epsilonhalbe"}, "edited": false, "score": 1, "creation_date": 1458286697, "post_id": 36078405, "comment_id": 59802155, "body": "I recommed looking at &quot;HaRe&quot; it had the same problem solving it with relative positions. Maybe the talk by Matthew Pickering at skillsmatter2015 conference can provide some insight"}], "answers": [{"tags": [], "owner": {"reputation": 28873, "user_id": 1068232, "user_type": "registered", "accept_rate": 79, "profile_image": "https://www.gravatar.com/avatar/2a0a145ce58c20013969fe3f203531da?s=128&d=identicon&r=PG", "display_name": "Andr&#225;s Kov&#225;cs", "link": "https://stackoverflow.com/users/1068232/andr%c3%a1s-kov%c3%a1cs"}, "is_accepted": true, "score": 9, "last_activity_date": 1458298403, "last_edit_date": 1458298403, "creation_date": 1458289243, "answer_id": 36079374, "question_id": 36078405, "link": "https://stackoverflow.com/questions/36078405/parsec-getting-start-and-end-source-positions-of-expressions/36079374#36079374", "title": "Parsec: Getting start and end source positions of expressions?", "body": "<p>You can use <code>getPosition</code> after you parse as well.</p>\n\n<pre><code>import Text.Parsec\nimport Text.Parsec.String\n\nspanned :: Parser a -&gt; Parser (SourcePos, SourcePos, a)\nspanned p = do\n  pos1 &lt;- getPosition\n  a &lt;- p\n  pos2 &lt;- getPosition\n  pure (pos1, pos2, a)\n</code></pre>\n\n<p>Testing:</p>\n\n<pre><code>&gt; parseTest (spanned (many1 (char 'a'))) \"aaaaafff\"\n((line 1, column 1),(line 1, column 6),\"aaaaa\")\n</code></pre>\n"}], "owner": {"reputation": 7230, "user_id": 788337, "user_type": "registered", "accept_rate": 70, "profile_image": "https://i.stack.imgur.com/wiVpx.png?s=128&g=1", "display_name": "jmite", "link": "https://stackoverflow.com/users/788337/jmite"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 372, "favorite_count": 3, "accepted_answer_id": 36079374, "answer_count": 1, "score": 9, "last_activity_date": 1458298403, "creation_date": 1458285704, "question_id": 36078405, "link": "https://stackoverflow.com/questions/36078405/parsec-getting-start-and-end-source-positions-of-expressions", "title": "Parsec: Getting start and end source positions of expressions?", "body": "<p>I'm writing a programming language which uses Parsec for its parsing. For reporting error messages, I've got each element of my syntax tree labelled with its source location, using the <code>getPosition</code> function from <a href=\"https://hackage.haskell.org/package/parsec-3.1.9/docs/Text-ParserCombinators-Parsec-Pos.html\" rel=\"noreferrer\">the Pos module </a> of Parsec.</p>\n\n<p>However, it only gives the location of the beginning of each expression I parse, and I'd like the beginning and end, so that I can highlight their entire location within the source code.</p>\n\n<p>Is such a thing possible with parsec? Is there a standard way of getting the end-point of an expression I'm parsing, so that I can include it in my AST?</p>\n"}, {"tags": ["list", "haskell"], "comments": [{"owner": {"reputation": 26541, "user_id": 1532460, "user_type": "registered", "accept_rate": 88, "profile_image": "https://www.gravatar.com/avatar/dc5b338bf194a9e117af20bd9b2e4edb?s=128&d=identicon&r=PG", "display_name": "awesoon", "link": "https://stackoverflow.com/users/1532460/awesoon"}, "edited": false, "score": 0, "creation_date": 1458276124, "post_id": 36076251, "comment_id": 59797913, "body": "The problem is <i>&quot;How to write setDiff function&quot;</i>?"}, {"owner": {"reputation": 1473, "user_id": 204305, "user_type": "registered", "accept_rate": 83, "profile_image": "https://www.gravatar.com/avatar/4fa6165d3bcb50e58e60304807f4090a?s=128&d=identicon&r=PG", "display_name": "Sage Mitchell", "link": "https://stackoverflow.com/users/204305/sage-mitchell"}, "reply_to_user": {"reputation": 26541, "user_id": 1532460, "user_type": "registered", "accept_rate": 88, "profile_image": "https://www.gravatar.com/avatar/dc5b338bf194a9e117af20bd9b2e4edb?s=128&d=identicon&r=PG", "display_name": "awesoon", "link": "https://stackoverflow.com/users/1532460/awesoon"}, "edited": false, "score": 0, "creation_date": 1458335402, "post_id": 36076251, "comment_id": 59832866, "body": "I suspect your question is getting down-voted because <code>setDiff</code> isn&#39;t often described as &quot;combining two lists&quot;. Changing the title to what @soon suggested may help."}], "answers": [{"tags": [], "owner": {"reputation": 1473, "user_id": 204305, "user_type": "registered", "accept_rate": 83, "profile_image": "https://www.gravatar.com/avatar/4fa6165d3bcb50e58e60304807f4090a?s=128&d=identicon&r=PG", "display_name": "Sage Mitchell", "link": "https://stackoverflow.com/users/204305/sage-mitchell"}, "is_accepted": false, "score": 6, "last_activity_date": 1458284882, "last_edit_date": 1592644375, "creation_date": 1458277381, "answer_id": 36076510, "question_id": 36076251, "link": "https://stackoverflow.com/questions/36076251/how-to-combine-two-list-with-the-different-element/36076510#36076510", "title": "How to combine two list with the different element?", "body": "<p>You're looking for the <code>(\\\\)</code> function:</p>\n<pre><code>[2,4,6,8,10] \\\\ [3,4,5,6] == [2,8,10]\n</code></pre>\n<p>Haskell comes with a lot of built-in functions. Especially for simple tasks like this, you'll often find one that does the job. But how do you find one?</p>\n<p>The first step is to determine the type of your desired function. In this case you're looking for a function that takes two lists with elements of the same type (<code>a</code>) and produces a list with elements of that same type:</p>\n<pre><code>[a] -&gt; [a] -&gt; [a]\n</code></pre>\n<p>Next <a href=\"https://www.haskell.org/hoogle/?hoogle=%5Ba%5D%20-%3E%20%5Ba%5D%20-%3E%20%5Ba%5D\" rel=\"nofollow noreferrer\">search Hoogle</a> for functions that match that type. <code>(\\\\)</code> is near the top of the results. It includes the following documentation:</p>\n<blockquote>\n<p>The <code>\\\\</code> function is list difference (non-associative). In the result of <code>xs \\\\ ys</code>, the first occurrence of each element of <code>ys</code> in turn (if any) has been removed from <code>xs</code>. Thus</p>\n<pre><code>(xs ++ ys) \\\\ xs == ys.\n</code></pre>\n<p>It is a special case of <code>deleteFirstsBy</code>, which allows the programmer to supply their own equality test.</p>\n</blockquote>\n"}], "owner": {"reputation": 17, "user_id": 6080625, "user_type": "registered", "profile_image": "https://graph.facebook.com/940820429300837/picture?type=large", "display_name": "Yulian Deni Adhitama", "link": "https://stackoverflow.com/users/6080625/yulian-deni-adhitama"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 432, "favorite_count": 0, "answer_count": 1, "score": -3, "last_activity_date": 1458284882, "creation_date": 1458275881, "last_edit_date": 1458275994, "question_id": 36076251, "link": "https://stackoverflow.com/questions/36076251/how-to-combine-two-list-with-the-different-element", "title": "How to combine two list with the different element?", "body": "<p>How to combine two list with the different element? The problem like this:</p>\n\n<p><img src=\"https://i.stack.imgur.com/Bea2D.png\" alt=\"enter image description here\"></p>\n"}, {"tags": ["string", "haskell", "count", "character"], "comments": [{"owner": {"reputation": 11, "user_id": 6080125, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/26e53044daaeec5757810aa3cde2a805?s=128&d=identicon&r=PG&f=1", "display_name": "blinky11509", "link": "https://stackoverflow.com/users/6080125/blinky11509"}, "reply_to_user": {"reputation": 34889, "user_id": 86604, "user_type": "registered", "accept_rate": 80, "profile_image": "https://www.gravatar.com/avatar/329af917389e6cf8e146c03012f5319a?s=128&d=identicon&r=PG", "display_name": "Ingo", "link": "https://stackoverflow.com/users/86604/ingo"}, "edited": false, "score": 0, "creation_date": 1458265144, "post_id": 36074601, "comment_id": 59795228, "body": "Hi, thank you for the response.  I&#39;m very new to Haskell, so not much at the moment."}], "answers": [{"comments": [{"owner": {"reputation": 11, "user_id": 6080125, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/26e53044daaeec5757810aa3cde2a805?s=128&d=identicon&r=PG&f=1", "display_name": "blinky11509", "link": "https://stackoverflow.com/users/6080125/blinky11509"}, "edited": false, "score": 0, "creation_date": 1458265925, "post_id": 36074663, "comment_id": 59795419, "body": "Thank you, I will try this."}, {"owner": {"reputation": 11, "user_id": 6080125, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/26e53044daaeec5757810aa3cde2a805?s=128&d=identicon&r=PG&f=1", "display_name": "blinky11509", "link": "https://stackoverflow.com/users/6080125/blinky11509"}, "edited": false, "score": 0, "creation_date": 1458265963, "post_id": 36074663, "comment_id": 59795423, "body": "I&#39;m unfamiliar with some of the errors.  For example, the compiler is saying &quot;Not in scope &#39;sort&#39;&quot;  &quot;Not in scope &#39;group&#39;&quot;"}, {"owner": {"reputation": 11780, "user_id": 2827654, "user_type": "registered", "accept_rate": 57, "profile_image": "https://www.gravatar.com/avatar/a171742e9c31a541d4d2031af932e94a?s=128&d=identicon&r=PG&f=1", "display_name": "jamshidh", "link": "https://stackoverflow.com/users/2827654/jamshidh"}, "reply_to_user": {"reputation": 11, "user_id": 6080125, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/26e53044daaeec5757810aa3cde2a805?s=128&d=identicon&r=PG&f=1", "display_name": "blinky11509", "link": "https://stackoverflow.com/users/6080125/blinky11509"}, "edited": false, "score": 0, "creation_date": 1458266441, "post_id": 36074663, "comment_id": 59795560, "body": "You need to import something, I&#39;ve added this to the answer."}, {"owner": {"reputation": 11, "user_id": 6080125, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/26e53044daaeec5757810aa3cde2a805?s=128&d=identicon&r=PG&f=1", "display_name": "blinky11509", "link": "https://stackoverflow.com/users/6080125/blinky11509"}, "edited": false, "score": 0, "creation_date": 1458346275, "post_id": 36074663, "comment_id": 59836767, "body": "Thanks again!  So i am able to get this to work at the command line in ghci,however, how would I get this into a function?  I&#39;ve tried something like: &quot;countCharacters str = map (\\x -&gt; (head x, length x)) $ group $ sort str&quot; but I had no luck"}, {"owner": {"reputation": 11780, "user_id": 2827654, "user_type": "registered", "accept_rate": 57, "profile_image": "https://www.gravatar.com/avatar/a171742e9c31a541d4d2031af932e94a?s=128&d=identicon&r=PG&f=1", "display_name": "jamshidh", "link": "https://stackoverflow.com/users/2827654/jamshidh"}, "reply_to_user": {"reputation": 11, "user_id": 6080125, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/26e53044daaeec5757810aa3cde2a805?s=128&d=identicon&r=PG&f=1", "display_name": "blinky11509", "link": "https://stackoverflow.com/users/6080125/blinky11509"}, "edited": false, "score": 0, "creation_date": 1458351200, "post_id": 36074663, "comment_id": 59837777, "body": "That should work, what error are you getting.  Note, you still need the <code>import Data.List</code> at the top of the file.  I copied your code directly and it worked for me."}], "tags": [], "owner": {"reputation": 11780, "user_id": 2827654, "user_type": "registered", "accept_rate": 57, "profile_image": "https://www.gravatar.com/avatar/a171742e9c31a541d4d2031af932e94a?s=128&d=identicon&r=PG&f=1", "display_name": "jamshidh", "link": "https://stackoverflow.com/users/2827654/jamshidh"}, "is_accepted": false, "score": 1, "last_activity_date": 1458266420, "last_edit_date": 1458266420, "creation_date": 1458265185, "answer_id": 36074663, "question_id": 36074601, "link": "https://stackoverflow.com/questions/36074601/haskell-count-the-occurrences-of-the-characters-in-a-string-for-every-character/36074663#36074663", "title": "Haskell: Count the occurrences of the characters in a string for every character", "body": "<p>This will do it</p>\n\n<pre><code>map (\\x -&gt; (head x, length x)) $ group $ sort theString\n</code></pre>\n\n<p>Note, you will need to import Data.List.</p>\n"}], "owner": {"reputation": 11, "user_id": 6080125, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/26e53044daaeec5757810aa3cde2a805?s=128&d=identicon&r=PG&f=1", "display_name": "blinky11509", "link": "https://stackoverflow.com/users/6080125/blinky11509"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 2835, "favorite_count": 0, "closed_date": 1458279027, "answer_count": 1, "score": -2, "last_activity_date": 1458266420, "creation_date": 1458264706, "question_id": 36074601, "link": "https://stackoverflow.com/questions/36074601/haskell-count-the-occurrences-of-the-characters-in-a-string-for-every-character", "closed_reason": "Duplicate", "title": "Haskell: Count the occurrences of the characters in a string for every character", "body": "<p>countCharacterOccurences :: String -> [(Char, Int)]</p>\n\n<p>I'm trying to make a function that will return a list of all the characters in the string along with the amount of times they are included.</p>\n\n<p>For example:</p>\n\n<p>countCharacterOccurences \"happy\" = [('h', 1), ('a', 1), ('p', 2), ('y', 1)]</p>\n\n<p>Thanks in advance</p>\n"}, {"tags": ["haskell"], "comments": [{"owner": {"reputation": 100892, "user_id": 745903, "user_type": "registered", "accept_rate": 74, "profile_image": "https://www.gravatar.com/avatar/50933f6638836741e620669b3940410e?s=128&d=identicon&r=PG", "display_name": "leftaroundabout", "link": "https://stackoverflow.com/users/745903/leftaroundabout"}, "edited": false, "score": 0, "creation_date": 1458260361, "post_id": 36073959, "comment_id": 59793970, "body": "Efficient as opposed to what approach? Surely you can do this <i>somehow</i>."}, {"owner": {"reputation": 22952, "user_id": 210211, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/8721ff8fa4b5c658058f4a2803231f44?s=128&d=identicon&r=PG", "display_name": "comingstorm", "link": "https://stackoverflow.com/users/210211/comingstorm"}, "edited": false, "score": 0, "creation_date": 1458260556, "post_id": 36073959, "comment_id": 59794021, "body": "If you&#39;re talking pixels, don&#39;t you mean <code>i+stride*j</code> position, instead of <code>i*j</code>?  Or, do you actually want to conflate all tuples whose elements multiply to give the same value?"}, {"owner": {"reputation": 87, "user_id": 3213489, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/793a6ba7e5ebc13a0b7f0494520e8c78?s=128&d=identicon&r=PG&f=1", "display_name": "dissem", "link": "https://stackoverflow.com/users/3213489/dissem"}, "edited": false, "score": 0, "creation_date": 1458260700, "post_id": 36073959, "comment_id": 59794051, "body": "I tried to check for every combination of i and j if the tuple (i, j) was an element of the first list, but that approach seemed to be too slow."}, {"owner": {"reputation": 87, "user_id": 3213489, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/793a6ba7e5ebc13a0b7f0494520e8c78?s=128&d=identicon&r=PG&f=1", "display_name": "dissem", "link": "https://stackoverflow.com/users/3213489/dissem"}, "edited": false, "score": 0, "creation_date": 1458261060, "post_id": 36073959, "comment_id": 59794134, "body": "I&#39;m trying to see which pixels need to be rendered so I want pixels with the same <code>i</code> and <code>j</code> values to give the same value."}, {"owner": {"reputation": 1353, "user_id": 3356218, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/d308520be749c71072454bbdb3a8d151?s=128&d=identicon&r=PG", "display_name": "Stefano Nardo", "link": "https://stackoverflow.com/users/3356218/stefano-nardo"}, "edited": false, "score": 0, "creation_date": 1458261147, "post_id": 36073959, "comment_id": 59794157, "body": "pixel (3,2) is different from pixels (2,3), (1,6), (6,1)... However you are looking for a map function.. It should not be hard."}, {"owner": {"reputation": 87, "user_id": 3213489, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/793a6ba7e5ebc13a0b7f0494520e8c78?s=128&d=identicon&r=PG&f=1", "display_name": "dissem", "link": "https://stackoverflow.com/users/3213489/dissem"}, "edited": false, "score": 0, "creation_date": 1458262270, "post_id": 36073959, "comment_id": 59794464, "body": "I need to construct a list of color values for each pixel so that I can render with the glDrawPIxels function from opengl."}], "answers": [{"tags": [], "owner": {"reputation": 11780, "user_id": 2827654, "user_type": "registered", "accept_rate": 57, "profile_image": "https://www.gravatar.com/avatar/a171742e9c31a541d4d2031af932e94a?s=128&d=identicon&r=PG&f=1", "display_name": "jamshidh", "link": "https://stackoverflow.com/users/2827654/jamshidh"}, "is_accepted": true, "score": 1, "last_activity_date": 1458263238, "creation_date": 1458263238, "answer_id": 36074421, "question_id": 36073959, "link": "https://stackoverflow.com/questions/36073959/haskell-construction-of-list-from-tuple-list/36074421#36074421", "title": "Haskell Construction of List from Tuple List", "body": "<p>First, sort the list of points</p>\n\n<pre><code>let sortedPoints = sort [(0, 1), (1, 0), (1, 1)]\n-- == [(0, 0), (0, 1), (1, 0)]\n</code></pre>\n\n<p>Then, create the list of all points</p>\n\n<pre><code>let allPoints = [(x, y) | x &lt;- [0, 3], y &lt;- [0, 3]]\n-- where I chose width = 3\n-- = [(0,0),(0,1),(0,2),(0,3),(1,0),(1,1),(1,2),(1,3),(2,0),(2,1),(2,2),(2,3),(3,0),(3,1),(3,2),(3,3)]\n</code></pre>\n\n<p>Note that this comes automatically sorted.</p>\n\n<p>Finally, write a function that goes through the items one by one and checks which items from list sortedPoints are in allPoints</p>\n\n<pre><code>isIn::[(Int, Int)]-&gt;[(Int, Int)]-&gt;[Int]\nisIn [] [] = []\nisIn (first:rest) (allFirst:allRest) | first == allFirst = 1:isIn rest allRest\nisIn points (_:rest) = 0:isIn points rest\n</code></pre>\n\n<p>Then just calculate</p>\n\n<pre><code>isIn sortedPoints allPoints\n</code></pre>\n"}], "owner": {"reputation": 87, "user_id": 3213489, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/793a6ba7e5ebc13a0b7f0494520e8c78?s=128&d=identicon&r=PG&f=1", "display_name": "dissem", "link": "https://stackoverflow.com/users/3213489/dissem"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 215, "favorite_count": 0, "accepted_answer_id": 36074421, "answer_count": 1, "score": -1, "last_activity_date": 1458263238, "creation_date": 1458260127, "last_edit_date": 1458261266, "question_id": 36073959, "link": "https://stackoverflow.com/questions/36073959/haskell-construction-of-list-from-tuple-list", "title": "Haskell Construction of List from Tuple List", "body": "<p>I have a list of tuples where each tuple represents the row and column of a pixel. How would I go about efficiently constructing a list where for each <code>(i, j)</code> tuple in the first list, the element at the <code>i*width + j</code> position in the new list has a value of 1? </p>\n"}, {"tags": ["debugging", "haskell"], "comments": [{"owner": {"reputation": 49501, "user_id": 784338, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/ae195ac7c8a5e9002a808544572cc5fc?s=128&d=identicon&r=PG", "display_name": "Daniel Gratzer", "link": "https://stackoverflow.com/users/784338/daniel-gratzer"}, "edited": false, "score": 0, "creation_date": 1458259988, "post_id": 36073879, "comment_id": 59793862, "body": "In order to find this bug you would have to show us how <code>Args</code> is defined. The error indicates that the field <code>maxDiscard</code> isn&#39;t actually part of if its definition though."}, {"owner": {"user_type": "does_not_exist", "display_name": "user6055028"}, "reply_to_user": {"reputation": 49501, "user_id": 784338, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/ae195ac7c8a5e9002a808544572cc5fc?s=128&d=identicon&r=PG", "display_name": "Daniel Gratzer", "link": "https://stackoverflow.com/users/784338/daniel-gratzer"}, "edited": false, "score": 0, "creation_date": 1458260180, "post_id": 36073879, "comment_id": 59793919, "body": "In this file, there is no definion of <code>Args</code> (it is from Test.QuickCheck)"}], "answers": [{"comments": [{"owner": {"user_type": "does_not_exist", "display_name": "user6055028"}, "edited": false, "score": 0, "creation_date": 1458294199, "post_id": 36074252, "comment_id": 59806303, "body": "Additionally, I did forget define Bool field &#39;chatty&#39;"}], "tags": [], "owner": {"reputation": 1817, "user_id": 1231408, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/664df5610226a9aa6a239aaa4f2de4b9?s=128&d=identicon&r=PG", "display_name": "cydparser", "link": "https://stackoverflow.com/users/1231408/cydparser"}, "is_accepted": true, "score": 2, "last_activity_date": 1458262020, "creation_date": 1458262020, "answer_id": 36074252, "question_id": 36073879, "link": "https://stackoverflow.com/questions/36073879/exporting-chose-funcitons-datatypes-in-haskell/36074252#36074252", "title": "exporting chose funcitons/datatypes in Haskell", "body": "<p><code>maxDiscard</code> should be <a href=\"http://hackage.haskell.org/package/QuickCheck/docs/Test-QuickCheck-Test.html\" rel=\"nofollow\"><code>maxDiscardRatio</code></a>.</p>\n"}], "owner": {"user_type": "does_not_exist", "display_name": "user6055028"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 33, "favorite_count": 0, "accepted_answer_id": 36074252, "answer_count": 1, "score": 1, "last_activity_date": 1458262020, "creation_date": 1458259661, "question_id": 36073879, "link": "https://stackoverflow.com/questions/36073879/exporting-chose-funcitons-datatypes-in-haskell", "title": "exporting chose funcitons/datatypes in Haskell", "body": "<p>I am newbie when it comes to haskell. Tell me please, where the bug is ?</p>\n\n<pre><code>t :: Int -&gt; Args\nt k =  Args {\n            replay = Nothing,\n            maxSuccess = 100,\n            maxDiscard = 22,\n            maxSize = k\n}\n</code></pre>\n\n<blockquote>\n  <p>\u2018maxDiscard\u2019 is not a (visible) field of constructor \u2018Args\u2019</p>\n</blockquote>\n"}, {"tags": ["haskell", "ghci"], "comments": [{"owner": {"reputation": 49501, "user_id": 784338, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/ae195ac7c8a5e9002a808544572cc5fc?s=128&d=identicon&r=PG", "display_name": "Daniel Gratzer", "link": "https://stackoverflow.com/users/784338/daniel-gratzer"}, "edited": false, "score": 1, "creation_date": 1458258994, "post_id": 36073543, "comment_id": 59793569, "body": "I don&#39;t think you&#39;re able to pull up the actual code because GHCi simply might not have access to it. What would you like to see exactly?"}, {"owner": {"reputation": 10218, "user_id": 1684670, "user_type": "registered", "accept_rate": 74, "profile_image": "https://www.gravatar.com/avatar/0de21f6ec42b67830c9308664e0abf72?s=128&d=identicon&r=PG", "display_name": "thkang", "link": "https://stackoverflow.com/users/1684670/thkang"}, "reply_to_user": {"reputation": 49501, "user_id": 784338, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/ae195ac7c8a5e9002a808544572cc5fc?s=128&d=identicon&r=PG", "display_name": "Daniel Gratzer", "link": "https://stackoverflow.com/users/784338/daniel-gratzer"}, "edited": false, "score": 0, "creation_date": 1458259321, "post_id": 36073543, "comment_id": 59793655, "body": "@jozefg to see how haskell guys implemented that interface?"}, {"owner": {"reputation": 49501, "user_id": 784338, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/ae195ac7c8a5e9002a808544572cc5fc?s=128&d=identicon&r=PG", "display_name": "Daniel Gratzer", "link": "https://stackoverflow.com/users/784338/daniel-gratzer"}, "edited": false, "score": 0, "creation_date": 1458259804, "post_id": 36073543, "comment_id": 59793801, "body": "Not purely in GHCi but for local searching <code>cabal get base</code> will give you a copy of the sources of the latest version of the standard libraries and search with grep (line 685 of GHC/Base.hs for <code>instance Alternative Maybe</code>). However GHCi works only with various compiled representations of the code and so you won&#39;t have much luck asking it to print the source to an instance sadly."}, {"owner": {"reputation": 49501, "user_id": 784338, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/ae195ac7c8a5e9002a808544572cc5fc?s=128&d=identicon&r=PG", "display_name": "Daniel Gratzer", "link": "https://stackoverflow.com/users/784338/daniel-gratzer"}, "edited": false, "score": 1, "creation_date": 1458259926, "post_id": 36073543, "comment_id": 59793841, "body": "Alternatively, there&#39;s a &quot;view source&quot; link on Haddock&#39;s for Haskell libraries which I make heavy use of. It now even has not-awful-looking syntax highlighting :) It&#39;s also usable in something like w3m if you use emacs."}], "answers": [{"tags": [], "owner": {"reputation": 37486, "user_id": 371753, "user_type": "registered", "accept_rate": 83, "profile_image": "https://i.stack.imgur.com/znFEK.jpg?s=128&g=1", "display_name": "sclv", "link": "https://stackoverflow.com/users/371753/sclv"}, "is_accepted": false, "score": 4, "last_activity_date": 1458270761, "creation_date": 1458270761, "answer_id": 36075472, "question_id": 36073543, "link": "https://stackoverflow.com/questions/36073543/how-do-i-find-information-of-an-instance-in-ghci/36075472#36075472", "title": "How do I find information of an instance in ghci?", "body": "<p><code>ghci</code> doesn't have any commands that bring up the underlying source for functions and instances, although it would be neat if it did.</p>\n\n<p>The way I find source of such things is to find them on hackage (for things in <code>base</code>, hoogle is the way to go). Then the haddocks <a href=\"http://hackage.haskell.org/package/base-4.8.2.0/docs/Prelude.html#t:Maybe\" rel=\"nofollow\">include links to source from the documentation</a>.</p>\n"}], "owner": {"reputation": 10218, "user_id": 1684670, "user_type": "registered", "accept_rate": 74, "profile_image": "https://www.gravatar.com/avatar/0de21f6ec42b67830c9308664e0abf72?s=128&d=identicon&r=PG", "display_name": "thkang", "link": "https://stackoverflow.com/users/1684670/thkang"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 1012, "favorite_count": 1, "answer_count": 1, "score": 3, "last_activity_date": 1458270761, "creation_date": 1458257545, "question_id": 36073543, "link": "https://stackoverflow.com/questions/36073543/how-do-i-find-information-of-an-instance-in-ghci", "title": "How do I find information of an instance in ghci?", "body": "<p>I can see data constructor and instances for, say <code>Maybe</code> in ghci:</p>\n\n<pre><code>Prelude Control.Applicative&gt; :i Maybe\ndata Maybe a = Nothing | Just a     -- Defined in `Data.Maybe'\ninstance Eq a =&gt; Eq (Maybe a) -- Defined in `Data.Maybe'\ninstance Monad Maybe -- Defined in `Data.Maybe'\ninstance Functor Maybe -- Defined in `Data.Maybe'\ninstance Ord a =&gt; Ord (Maybe a) -- Defined in `Data.Maybe'\ninstance Read a =&gt; Read (Maybe a) -- Defined in `GHC.Read'\ninstance Show a =&gt; Show (Maybe a) -- Defined in `GHC.Show'\ninstance Applicative Maybe -- Defined in `Control.Applicative'\ninstance Alternative Maybe -- Defined in `Control.Applicative'\n</code></pre>\n\n<p>and I can see how <code>Applicative</code> typeclass defined in ghci, too:</p>\n\n<pre><code>Prelude Control.Applicative&gt; :i Applicative\nclass Functor f =&gt; Applicative f where\n  pure :: a -&gt; f a\n  (&lt;*&gt;) :: f (a -&gt; b) -&gt; f a -&gt; f b\n  (*&gt;) :: f a -&gt; f b -&gt; f b\n  (&lt;*) :: f a -&gt; f b -&gt; f a\n    -- Defined in `Control.Applicative'\ninstance Applicative [] -- Defined in `Control.Applicative'\ninstance Applicative ZipList -- Defined in `Control.Applicative'\ninstance Monad m =&gt; Applicative (WrappedMonad m)\n  -- Defined in `Control.Applicative'\ninstance Applicative Maybe -- Defined in `Control.Applicative'\ninstance Applicative IO -- Defined in `Control.Applicative'\ninstance Applicative (Either e) -- Defined in `Control.Applicative'\ninstance Applicative ((-&gt;) a) -- Defined in `Control.Applicative'\n</code></pre>\n\n<p>but How can I find information <em>about specific instances</em> of a type, say <code>instance Alternative Maybe</code> ?</p>\n"}, {"tags": ["haskell"], "comments": [{"owner": {"reputation": 9772, "user_id": 3963, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/9pDQ8.png?s=128&g=1", "display_name": "hao", "link": "https://stackoverflow.com/users/3963/hao"}, "edited": false, "score": 0, "creation_date": 1458253675, "post_id": 36072588, "comment_id": 59791696, "body": "Though you&#39;re defining mkL recursively and you&#39;ve defined your base cases, your last instance is missing a crucial element that makes it, currently, completely non-recursive! How might you use Haskell to introduce the appropriate MkL constraints and thus let the recursion kick in?"}], "answers": [{"tags": [], "owner": {"reputation": 13807, "user_id": 2407038, "user_type": "registered", "accept_rate": 64, "profile_image": "https://www.gravatar.com/avatar/538f6f4a9aa43841841de7d8e8b169fc?s=128&d=identicon&r=PG&f=1", "display_name": "user2407038", "link": "https://stackoverflow.com/users/2407038/user2407038"}, "is_accepted": true, "score": 3, "last_activity_date": 1458254549, "creation_date": 1458254549, "answer_id": 36073003, "question_id": 36072588, "link": "https://stackoverflow.com/questions/36072588/polymorphic-constructor-for-type-level-list/36073003#36073003", "title": "polymorphic constructor for type-level list", "body": "<p>You must write recursive functions on lists according to the recursive structure of lists. A list is either <code>[]</code> or <code>_ : _</code>:</p>\n\n<pre><code>instance MkL (L '[]) where \n  mkL = L [] \n\ninstance MkL (L xs) =&gt; MkL (L ('Foo ': xs)) where \n  mkL = let L xs = mkL :: L xs in L (Foo : xs)\n\ninstance MkL (L xs) =&gt; MkL (L ('Bar ': xs)) where \n  mkL = let L xs = mkL :: L xs in L (Bar : xs)\n</code></pre>\n\n<p>But it should be noted that your <code>L</code> type is probably not what you want. As far as the compiler is concerned, there is no relation between the value level <code>[T]</code> and the type level <code>[T]</code>. This is perfectly valid:</p>\n\n<pre><code>instance MkL (L xs) where \n  mkL = L [] \n</code></pre>\n\n<p>To store a value level representation of the type level list, you must do something like </p>\n\n<pre><code>data family SingT (x :: k) \n\ndata instance SingT (x :: [k]) where \n  Nil :: SingT '[] \n  Cons :: SingT x -&gt; SingT xs -&gt; SingT (x ': xs) \n\ndata instance SingT (x :: T) where \n  SFoo :: SingT 'Foo \n  SBar :: SingT 'Bar \n\nclass Sing a where \n  sing :: SingT a \n\ninstance Sing 'Foo where sing = SFoo \ninstance Sing 'Bar where sing = SBar\ninstance (Sing x, Sing xs) =&gt; Sing (x ': xs) where sing = Cons sing sing  \ninstance Sing '[] where sing = Nil \n</code></pre>\n\n<p>Then you have <code>sing :: SingT '[ 'Foo, 'Bar ]</code>, etc, and this type is inhabited only by <code>Cons SFoo (Cons SBar Nil)</code>. There are packages, eg <a href=\"https://hackage.haskell.org/package/singletons\" rel=\"nofollow\">singletons</a>, which partially automate the process of defining such a <code>SingT</code> type. </p>\n"}, {"comments": [{"owner": {"reputation": 44013, "user_id": 1477667, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/trgKM.jpg?s=128&g=1", "display_name": "dfeuer", "link": "https://stackoverflow.com/users/1477667/dfeuer"}, "edited": false, "score": 0, "creation_date": 1458270086, "post_id": 36073093, "comment_id": 59796426, "body": "It&#39;s also some pretty scary-looking Template Haskell. :-/"}], "tags": [], "owner": {"reputation": 28873, "user_id": 1068232, "user_type": "registered", "accept_rate": 79, "profile_image": "https://www.gravatar.com/avatar/2a0a145ce58c20013969fe3f203531da?s=128&d=identicon&r=PG", "display_name": "Andr&#225;s Kov&#225;cs", "link": "https://stackoverflow.com/users/1068232/andr%c3%a1s-kov%c3%a1cs"}, "is_accepted": false, "score": 1, "last_activity_date": 1458255038, "creation_date": 1458255038, "answer_id": 36073093, "question_id": 36072588, "link": "https://stackoverflow.com/questions/36072588/polymorphic-constructor-for-type-level-list/36073093#36073093", "title": "polymorphic constructor for type-level list", "body": "<p>You have to consider three cases: the empty list, the lists with <code>Foo</code> at the head, and the lists with <code>Bar</code> at the head. Translated to instances:</p>\n\n<pre><code>instance MkL (L '[]) where\n  mkL = L []\n\ninstance MkL (L ts) =&gt; MkL (L (Foo ': ts)) where\n  mkL = case mkL :: L ts of L ts -&gt; L (Foo : ts)\n\ninstance MkL (L ts) =&gt; MkL (L (Bar ': ts)) where\n  mkL = case mkL :: L ts of L ts -&gt; L (Bar : ts)  \n</code></pre>\n\n<p>There's no need here to consider lists  of <code>n + 2</code> length for some <code>n</code>, since I assume we'd like to have instances for all <code>ts :: [T]</code>, and the empty and <code>(:)</code> constructors cover them all.</p>\n\n<hr>\n\n<p>On a different note, there's an <a href=\"https://hackage.haskell.org/package/singletons\" rel=\"nofollow\">existing library</a> covering this use case, and it's safer and generally more powerful. It lets us generate (via Template Haskell, but one could also write it by hand) value-level representatives of type-level data (called \"singletons\") or type-level representatives of value-level functions, and gives us plenty of tools for working with them.</p>\n\n<p>For example:</p>\n\n<pre><code>{-# LANGUAGE TemplateHaskell #-} -- on the top of the others\n\nimport Data.Singletons.TH\n\n$(singletons [d| data T = Foo | Bar |])\n</code></pre>\n\n<p>This defines (among other things) the <code>SFoo :: Sing Foo</code> and <code>SBar :: Sing Bar</code> constructors, where <code>Sing</code> is a data family and <code>Sing x</code> contains exactly the value-level representative of some <code>x</code> type. For each <code>Sing x</code> there is just a single value (that's why it's a singleton), therefore it's possible to unambiguously determine a type from its singleton.</p>\n\n<pre><code>sFoo :: Sing Foo\nsFoo = SFoo\n\nsBar :: Sing Bar\nsBar = SBar\n\ndemo1 :: Sing '[Foo]\ndemo1 = sing\n\ndemo2 :: Sing '[Foo, Bar]\ndemo2 = sing\n</code></pre>\n\n<p><code>sing</code> is similar to your <code>Mk</code> class, except it works across many different kinds. </p>\n\n<p>Here, <code>demo1</code> is equal to <code>SCons SFoo SNil</code>, where <code>SCons</code> and <code>SNil</code> are the singleton constructors representing type-level lists. If we don't want to work with singletons though, we can erase the type indices and work with plain old data:</p>\n\n<pre><code>demo1' :: [T]\ndemo1' = fromSing demo1\n</code></pre>\n\n<p>Now <code>demo1</code> equals <code>[Foo]</code>, so <code>fromSing</code> converts the <code>S</code>-prefixed singletons back to the simple representations. </p>\n\n<p>The biggest benefit of working with singletons is that they mirror the types perfectly, so it's not possibly to \"cheat\"; in contrast, we could have arbitrary values of <code>L ts</code> at runtime that doesn't conform to the phantom type index. In a nutshell, in <code>L ts</code> the index is just a phantom type, but in <code>Sing ts</code>, the index is precisely reflected in the constructors. </p>\n"}], "owner": {"reputation": 597, "user_id": 512596, "user_type": "registered", "accept_rate": 60, "profile_image": "https://www.gravatar.com/avatar/ce84bd6e6f9723451f1daf95a6670874?s=128&d=identicon&r=PG&f=1", "display_name": "Joey", "link": "https://stackoverflow.com/users/512596/joey"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 102, "favorite_count": 1, "accepted_answer_id": 36073003, "answer_count": 2, "score": 2, "last_activity_date": 1458255038, "creation_date": 1458252543, "question_id": 36072588, "link": "https://stackoverflow.com/questions/36072588/polymorphic-constructor-for-type-level-list", "title": "polymorphic constructor for type-level list", "body": "<p>I have a type-level list L, and am trying to write a polymorphic mkL, that can be used as follows:</p>\n\n<pre><code>{-# LANGUAGE TypeOperators, PolyKinds, DataKinds, TypeFamilies,\n  UndecidableInstances, AllowAmbiguousTypes, TypeSynonymInstances,\n  FlexibleInstances, ScopedTypeVariables #-}\n\ndata T = Foo | Bar\n    deriving (Show, Eq)\n\ndata L (ts :: [T]) = L [T]\n    deriving (Show, Eq)\n\ndemo1 :: L '[Foo]\ndemo1 = mkL\n\ndemo2 :: L '[Foo, Bar]\ndemo2 = mkL\n</code></pre>\n\n<p>I have demo1 working easily enough, but the recursive case is defeating me for some reason.</p>\n\n<pre><code>class MkL p where\n    mkL :: p\ninstance MkL (L '[]) where\n    mkL = L []\ninstance MkL (L '[Foo]) where\n    mkL = L [Foo]\ninstance MkL (L '[Bar]) where\n    mkL = L [Bar]\ninstance MkL (L (l1 ': l2 ': ls)) where\n    mkL =\n        let (L [l1]) = undefined -- FIXME\n            (L [l2]) = undefined\n            (L rest) = undefined\n        in L (l1 : l2 : rest)\n</code></pre>\n\n<p>If I replace the FIXME with mkL, I get:</p>\n\n<pre><code>No instance for (MkL (L t0)) arising from a use of \u2018mkL\u2019\nThe type variable \u2018t0\u2019 is ambiguous\nNote: there are several potential instances:\n  instance MkL (L (l1 : l2 : ls)) -- Defined at Target.hs:19:10\n  instance MkL (L '['Bar]) -- Defined at Target.hs:17:10\n  instance MkL (L '['Foo]) -- Defined at Target.hs:15:10\n  ...plus one other\nIn the expression: mkL\nIn a pattern binding: (L [l1]) = mkL\n</code></pre>\n\n<p>So, is there any way to implement this?</p>\n"}, {"tags": ["rest", "haskell", "handler", "yesod"], "comments": [{"owner": {"reputation": 7297, "user_id": 1176156, "user_type": "registered", "accept_rate": 80, "profile_image": "https://www.gravatar.com/avatar/89604545aa57aa3d14306af60126e193?s=128&d=identicon&r=PG", "display_name": "MaxGabriel", "link": "https://stackoverflow.com/users/1176156/maxgabriel"}, "edited": false, "score": 0, "creation_date": 1458262188, "post_id": 36070178, "comment_id": 59794442, "body": "Do you just want to use <a href=\"http://haddock.stackage.org/lts-5.8/yesod-core-1.4.19/Yesod-Core-Handler.html#v:addHeader\" rel=\"nofollow noreferrer\"><code>addHeader</code></a>?"}, {"owner": {"reputation": 1336, "user_id": 2801316, "user_type": "registered", "accept_rate": 87, "profile_image": "https://i.stack.imgur.com/cqx1a.jpg?s=128&g=1", "display_name": "FtheBuilder", "link": "https://stackoverflow.com/users/2801316/fthebuilder"}, "reply_to_user": {"reputation": 7297, "user_id": 1176156, "user_type": "registered", "accept_rate": 80, "profile_image": "https://www.gravatar.com/avatar/89604545aa57aa3d14306af60126e193?s=128&d=identicon&r=PG", "display_name": "MaxGabriel", "link": "https://stackoverflow.com/users/1176156/maxgabriel"}, "edited": false, "score": 0, "creation_date": 1458267091, "post_id": 36070178, "comment_id": 59795716, "body": "Not exactly, I would like something like this: <code>setLocationHeader (ExchangeByIdR eId)</code>..."}, {"owner": {"reputation": 7297, "user_id": 1176156, "user_type": "registered", "accept_rate": 80, "profile_image": "https://www.gravatar.com/avatar/89604545aa57aa3d14306af60126e193?s=128&d=identicon&r=PG", "display_name": "MaxGabriel", "link": "https://stackoverflow.com/users/1176156/maxgabriel"}, "edited": false, "score": 1, "creation_date": 1458314491, "post_id": 36070178, "comment_id": 59820549, "body": "Ah ok. I think <a href=\"http://haddock.stackage.org/lts-5.8/yesod-core-1.4.19/Yesod-Core-Handler.html#v:sendResponseCreated\" rel=\"nofollow noreferrer\"><code>sendResponseCreated</code></a> might be appropriate?"}, {"owner": {"reputation": 1336, "user_id": 2801316, "user_type": "registered", "accept_rate": 87, "profile_image": "https://i.stack.imgur.com/cqx1a.jpg?s=128&g=1", "display_name": "FtheBuilder", "link": "https://stackoverflow.com/users/2801316/fthebuilder"}, "reply_to_user": {"reputation": 7297, "user_id": 1176156, "user_type": "registered", "accept_rate": 80, "profile_image": "https://www.gravatar.com/avatar/89604545aa57aa3d14306af60126e193?s=128&d=identicon&r=PG", "display_name": "MaxGabriel", "link": "https://stackoverflow.com/users/1176156/maxgabriel"}, "edited": false, "score": 0, "creation_date": 1458321134, "post_id": 36070178, "comment_id": 59825053, "body": "@MaxGabriel Exactly! It is what I was looking for. I think you should make it an answer."}, {"owner": {"reputation": 1336, "user_id": 2801316, "user_type": "registered", "accept_rate": 87, "profile_image": "https://i.stack.imgur.com/cqx1a.jpg?s=128&g=1", "display_name": "FtheBuilder", "link": "https://stackoverflow.com/users/2801316/fthebuilder"}, "reply_to_user": {"reputation": 7297, "user_id": 1176156, "user_type": "registered", "accept_rate": 80, "profile_image": "https://www.gravatar.com/avatar/89604545aa57aa3d14306af60126e193?s=128&d=identicon&r=PG", "display_name": "MaxGabriel", "link": "https://stackoverflow.com/users/1176156/maxgabriel"}, "edited": false, "score": 0, "creation_date": 1458325782, "post_id": 36070178, "comment_id": 59827761, "body": "@MaxGabriel, I realised it is not right, it is not sending the json data as before"}], "answers": [{"tags": [], "owner": {"reputation": 1336, "user_id": 2801316, "user_type": "registered", "accept_rate": 87, "profile_image": "https://i.stack.imgur.com/cqx1a.jpg?s=128&g=1", "display_name": "FtheBuilder", "link": "https://stackoverflow.com/users/2801316/fthebuilder"}, "is_accepted": true, "score": 1, "last_activity_date": 1458329530, "creation_date": 1458329530, "answer_id": 36092829, "question_id": 36070178, "link": "https://stackoverflow.com/questions/36070178/yesod-location-header/36092829#36092829", "title": "Yesod Location Header", "body": "<p>I simply created my own function <code>addLocationHeader</code>:</p>\n\n<pre><code>addLocationHeader :: MonadHandler m =&gt; Route (HandlerSite m) -&gt; m ()\naddLocationHeader url = do\n  r &lt;- getUrlRender\n  addHeader \"Location\" (r url)\n</code></pre>\n"}], "owner": {"reputation": 1336, "user_id": 2801316, "user_type": "registered", "accept_rate": 87, "profile_image": "https://i.stack.imgur.com/cqx1a.jpg?s=128&g=1", "display_name": "FtheBuilder", "link": "https://stackoverflow.com/users/2801316/fthebuilder"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 54, "favorite_count": 0, "accepted_answer_id": 36092829, "answer_count": 1, "score": 0, "last_activity_date": 1458330183, "creation_date": 1458243522, "last_edit_date": 1458330183, "question_id": 36070178, "link": "https://stackoverflow.com/questions/36070178/yesod-location-header", "title": "Yesod Location Header", "body": "<p>I have to set a location header in a post handler response, putting the location where the newly created entity is placed. How can I do it dynamically? </p>\n\n<p>The target route (where it will be placed) has this definition:</p>\n\n<pre><code>/exchanges/#ExchangeId ExchangeByIdR GET PUT\n</code></pre>\n\n<p><strong>EDIT</strong></p>\n\n<p>I would like a function like this one:</p>\n\n<pre><code>addLocationHeader (ExchangeByIdR eId)\n</code></pre>\n"}, {"tags": ["haskell"], "comments": [{"owner": {"reputation": 31, "user_id": 6057593, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/4fb8d3c37cbec56836610f22fd9bbf1a?s=128&d=identicon&r=PG&f=1", "display_name": "Darren Reid", "link": "https://stackoverflow.com/users/6057593/darren-reid"}, "edited": false, "score": 0, "creation_date": 1458233936, "post_id": 36067064, "comment_id": 59780407, "body": "censor :: [Char] -&gt; [Char] censor [] = [] censor (x:xs)    |x <code>elem</code> &quot;aeiou&quot; = &quot;X&quot; : censor xs    |otherwise = x : censor xs"}, {"owner": {"reputation": 1958, "user_id": 3217013, "user_type": "registered", "accept_rate": 92, "profile_image": "https://www.gravatar.com/avatar/8fe4c19ed2edcb4fe6e661a5faed0205?s=128&d=identicon&r=PG&f=1", "display_name": "Emil", "link": "https://stackoverflow.com/users/3217013/emil"}, "edited": false, "score": 0, "creation_date": 1458249736, "post_id": 36067064, "comment_id": 59789956, "body": "There is currently 3 downvotes with no comments whatsoever. Why?!"}, {"owner": {"reputation": 1958, "user_id": 3217013, "user_type": "registered", "accept_rate": 92, "profile_image": "https://www.gravatar.com/avatar/8fe4c19ed2edcb4fe6e661a5faed0205?s=128&d=identicon&r=PG&f=1", "display_name": "Emil", "link": "https://stackoverflow.com/users/3217013/emil"}, "edited": false, "score": 0, "creation_date": 1458249782, "post_id": 36067064, "comment_id": 59789988, "body": "Why are we artificially increasing the already-high barrier to entry to Haskell?"}, {"owner": {"reputation": 48938, "user_id": 246886, "user_type": "registered", "accept_rate": 94, "profile_image": "https://www.gravatar.com/avatar/dd1ebaade6623fc538fb8af3338e730d?s=128&d=identicon&r=PG", "display_name": "Jon Purdy", "link": "https://stackoverflow.com/users/246886/jon-purdy"}, "edited": false, "score": 0, "creation_date": 1458259191, "post_id": 36067064, "comment_id": 59793615, "body": "The error message (in GHC 7.10) points to <code>x : censor xs</code>, not <code>&quot;X&quot; : censor xs</code> as the location of the error, which is probably the cause of the confusion."}], "answers": [{"tags": [], "owner": {"reputation": 51584, "user_id": 839246, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/9b0573c2b936b12828dd1e4cc04206dc?s=128&d=identicon&r=PG&f=1", "display_name": "bheklilr", "link": "https://stackoverflow.com/users/839246/bheklilr"}, "is_accepted": false, "score": 7, "last_activity_date": 1458234446, "creation_date": 1458234446, "answer_id": 36067253, "question_id": 36067064, "link": "https://stackoverflow.com/questions/36067064/couldnt-match-expected-type-char-with-actual-type-char/36067253#36067253", "title": "Couldn&#39;t match expected type \u2018Char\u2019 with actual type \u2018[Char]\u2019", "body": "<p>You are trying to prepend the string <code>\"X\"</code> instead of the character <code>'X'</code>:</p>\n\n<pre><code>| x `elem` \"aeiou\" = 'X' : censor xs\n</code></pre>\n\n<p>The rest of your code is fine.</p>\n"}], "owner": {"reputation": 31, "user_id": 6057593, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/4fb8d3c37cbec56836610f22fd9bbf1a?s=128&d=identicon&r=PG&f=1", "display_name": "Darren Reid", "link": "https://stackoverflow.com/users/6057593/darren-reid"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 3464, "favorite_count": 0, "answer_count": 1, "score": 0, "last_activity_date": 1458234446, "creation_date": 1458233918, "last_edit_date": 1458234396, "question_id": 36067064, "link": "https://stackoverflow.com/questions/36067064/couldnt-match-expected-type-char-with-actual-type-char", "title": "Couldn&#39;t match expected type \u2018Char\u2019 with actual type \u2018[Char]\u2019", "body": "<pre><code>censor :: [Char] -&gt; [Char]\ncensor [] = []\ncensor (x:xs)\n    |x `elem` \"aeiou\" = \"X\" : censor xs\n    |otherwise = x : censor xs\n</code></pre>\n\n<p>my code is supposed to censor lower-case vowels and replace them with an x however i am getting the error in my title, any suggestions? Thanks.</p>\n\n<p>Edit: had to put spaces on here for formatting take them away while looking</p>\n"}]