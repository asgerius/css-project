[{"tags": ["haskell", "ghci"], "comments": [{"owner": {"reputation": 22091, "user_id": 5684257, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/ea5090cde8ea066a1fda67ed52dd5084?s=128&d=identicon&r=PG&f=1", "display_name": "HTNW", "link": "https://stackoverflow.com/users/5684257/htnw"}, "edited": false, "score": 2, "creation_date": 1564588062, "post_id": 57293827, "comment_id": 101083476, "body": "What does <code>ghc-pkg list</code> say?"}, {"owner": {"reputation": 448, "user_id": 4743466, "user_type": "registered", "accept_rate": 69, "profile_image": "https://www.gravatar.com/avatar/35b9eee7a42e06c9845b2a5df2be4596?s=128&d=identicon&r=PG", "display_name": "Erik Vesterlund", "link": "https://stackoverflow.com/users/4743466/erik-vesterlund"}, "reply_to_user": {"reputation": 22091, "user_id": 5684257, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/ea5090cde8ea066a1fda67ed52dd5084?s=128&d=identicon&r=PG&f=1", "display_name": "HTNW", "link": "https://stackoverflow.com/users/5684257/htnw"}, "edited": false, "score": 0, "creation_date": 1564588319, "post_id": 57293827, "comment_id": 101083608, "body": "It says <code>&#47;usr&#47;lib&#47;ghc&#47;package.conf.d network-uri-2.6.1.0 ... &#47;home&#47;evesterl&#47;.ghc&#47;x86_64-linux-8.0.2&#47;package.conf.d network-uri-2.6.1.0</code>, I guess that might have something to do with the problem? No idea how to fix it though (or how I got in that mess)."}, {"owner": {"reputation": 126897, "user_id": 791604, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/ce991df7a056248d5e4f6fc3659ba733?s=128&d=identicon&r=PG", "display_name": "Daniel Wagner", "link": "https://stackoverflow.com/users/791604/daniel-wagner"}, "edited": false, "score": 0, "creation_date": 1564591869, "post_id": 57293827, "comment_id": 101085396, "body": "I&#39;m a bit lost about where the edits leave us. Are things working for you now or not? If not, can you simply adjust the question to be a self-contained description of the current state of affairs, rather than this account which requires readers to piece together details from three different points in time?"}, {"owner": {"reputation": 448, "user_id": 4743466, "user_type": "registered", "accept_rate": 69, "profile_image": "https://www.gravatar.com/avatar/35b9eee7a42e06c9845b2a5df2be4596?s=128&d=identicon&r=PG", "display_name": "Erik Vesterlund", "link": "https://stackoverflow.com/users/4743466/erik-vesterlund"}, "reply_to_user": {"reputation": 126897, "user_id": 791604, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/ce991df7a056248d5e4f6fc3659ba733?s=128&d=identicon&r=PG", "display_name": "Daniel Wagner", "link": "https://stackoverflow.com/users/791604/daniel-wagner"}, "edited": false, "score": 0, "creation_date": 1564592566, "post_id": 57293827, "comment_id": 101085717, "body": "@DanielWagner From the first edit it follows that the program loads, in the second edit a hint was given as to what caused the problem. The original problem, &quot;how do I resolve it&quot;, still stands (re-install doesn&#39;t count as resolution)."}], "answers": [{"tags": [], "owner": {"reputation": 22091, "user_id": 5684257, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/ea5090cde8ea066a1fda67ed52dd5084?s=128&d=identicon&r=PG&f=1", "display_name": "HTNW", "link": "https://stackoverflow.com/users/5684257/htnw"}, "is_accepted": false, "score": 6, "last_activity_date": 1564593893, "creation_date": 1564593893, "answer_id": 57296100, "question_id": 57293827, "link": "https://stackoverflow.com/questions/57293827/duplicate-packages-in-haskell-environment/57296100#57296100", "title": "Duplicate packages in Haskell environment?", "body": "\n\n<p>GHC understands the concept of package databases. Cabal manages multiple package databases. There's a system package database, and a user package database. When you compile something with Cabal V1, it uses the union of these package databases. This is a bit of a time bomb, because, as you see, GHC does not like it when you have multiple of the same package. When you issued <code>cabal install network-uri</code>, <code>cabal</code> decided to install one copy of that package into your user database, though you already had one in the system database. When you tried to use <code>ghc</code>, it picked up on the two copies and got confused. Because <code>cabal</code> does not support removing packages, your Haskell installation was pretty much borked, and you reinstalled. I believe you could have done a more conservative <code>rm ~/.ghc</code>, or, had you been really adventurous, used the low-level <code>ghc-pkg</code> command to edit the package database.</p>\n\n<p>Now that you've reinstalled the Platform, I would heavily recommend <em>never using <code>cabal install</code> again</em>. It's old, it's broken, <code>cabal</code> itself tells you not to use it. If you're using the Platform, I think it has <code>stack</code> in it, which is a different build manager, based on Cabal, which is not prone to this kind of breakage. Or, you can just stick to the V2 series of <code>cabal</code> commands, which is what I prefer.</p>\n\n<p>Cabal V2 does not directly support your usecase, where you install a package globally and compile a program against it. This is because doing so is fundamentally broken: global package databases really just don't work for GHC. What Cabal V2 does is install packages into your home directory, <code>~/.cabal/store</code>. You then have to explicitly tell it which packages you want, and it will construct a package database that contains each required package, without any wonkiness. You can get a REPL with a certain set of packages by issuing (this will take you to a temporary directory; you may need to <code>:cd</code> yourself back.)</p>\n\n<pre class=\"lang-none prettyprint-override\"><code>cabal v2-repl -b network-uri -b package2 -b etc\n</code></pre>\n\n<p>If you want to actually compile files with <code>ghc</code> with a set packages, you have to actually define a package with a <code>.cabal</code> file. Here's a stub <code>.cabal</code> file:</p>\n\n<pre class=\"lang-none prettyprint-override\"><code>name:          temporary-pkg\nversion:       0.0.0.0\nbuild-type:    Simple\ncabal-version: &gt;=2.0\nexecutable main -- if there is no Main, say \"library\" instead of \"executable &lt;name&gt;\"\n  default-language: Haskell2010\n  main-is:          Main.hs -- only valid in executable stanzas\n  hs-source-dirs:   src -- source files go here\n  build-depends:    base, network-uri, package2, etc -- packages go here\n</code></pre>\n\n<p>Create and enter a directory, place that in <code>temporary-pkg.cabal</code>, place your sources in <code>src/</code>, and you can issue stuff like <code>cabal v2-build</code> and <code>cabal v2-repl</code> and <code>cabal v2-exec main</code>, etc. <code>cabal</code> will go off and install dependencies from Hackage into <code>~/.cabal/store</code> as needed. <code>cabal v2-install</code> is therefore not that useful here. In general, <code>v2-install</code>ing libraries is unnecessary, but <code>v2-install</code>ing packages with executables is useful. Again, for hygiene reasons, you have to list all the packages you are <code>import</code>ing from, but you don't need to list <em>their</em> dependencies or anything insane like that.</p>\n\n<p>Cabal V2 still doesn't support uninstalling packages, though the point is that should not be necessary. However, if you find <code>~/.cabal/store</code> getting too large for your liking, you can just nuke it, and should be built back up as packages are requested.</p>\n"}], "owner": {"reputation": 448, "user_id": 4743466, "user_type": "registered", "accept_rate": 69, "profile_image": "https://www.gravatar.com/avatar/35b9eee7a42e06c9845b2a5df2be4596?s=128&d=identicon&r=PG", "display_name": "Erik Vesterlund", "link": "https://stackoverflow.com/users/4743466/erik-vesterlund"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 237, "favorite_count": 0, "answer_count": 1, "score": 4, "last_activity_date": 1564593893, "creation_date": 1564585478, "last_edit_date": 1564591242, "question_id": 57293827, "link": "https://stackoverflow.com/questions/57293827/duplicate-packages-in-haskell-environment", "title": "Duplicate packages in Haskell environment?", "body": "<p>I put <a href=\"https://subscription.packtpub.com/book/big_data_and_business_intelligence/9781783286331/1/ch01lvl1sec17/learning-how-to-perform-http-post-requests\" rel=\"nofollow noreferrer\">this</a> in a file (see bottom) and got the following error when loading it in ghci (i.e. start ghci then <code>:l file</code>):</p>\n\n<pre><code>7:13: error:\n    \u2022 Couldn't match expected type \u2018network-uri-2.6.1.0@network-uri-2.6.1.0-7BN1tbB3iHQ2XgvmqLAYph:Network.URI.URI\u2019\n                  with actual type \u2018Network.URI.URI\u2019\n      NB: \u2018Network.URI.URI\u2019\n            is defined in \u2018Network.URI\u2019\n                in package \u2018network-uri-2.6.1.0@network-uri-2.6.1.0-80FpvaNUTSDFCPv0sSze40\u2019\n          \u2018network-uri-2.6.1.0@network-uri-2.6.1.0-7BN1tbB3iHQ2XgvmqLAYph:Network.URI.URI\u2019\n            is defined in \u2018Network.URI\u2019\n                in package \u2018network-uri-2.6.1.0@network-uri-2.6.1.0-7BN1tbB3iHQ2XgvmqLAYph\u2019\n</code></pre>\n\n<p>Have I somehow installed two slightly different versions of network-uri, or what is this? How do I resolve it?</p>\n\n<p>I've hardly used cabal but tried <code>cabal install --reinstall network-uri</code>, went fine but problem persists.</p>\n\n<p>File contents:</p>\n\n<pre class=\"lang-hs prettyprint-override\"><code>import Network.HTTP\nimport Network.URI (parseURI)\nimport Data.Maybe (fromJust)\nmyRequestURL = \"http://www.virginia.edu/cgi-local/ldapweb\"\nmyRequest :: String -&gt; Request_String\nmyRequest query = Request {\n    rqURI = fromJust $ parseURI myRequestURL\n  , rqMethod = POST\n  , rqHeaders = [ mkHeader HdrContentType \"text/html\"\n                , mkHeader HdrContentLength $ show $ length body ]\n  , rqBody = body\n  }\n  where body = \"whitepages=\" ++ query\nmain :: IO ()\nmain = do\n  response &lt;- simpleHTTP $ myRequest \"poon\"\n  putStrLn \"\"\n</code></pre>\n\n<p><strong>EDIT</strong> Re-installed haskell-platform. After this, <code>ghc-pkg list</code> reports all packages to be under (?) <code>/usr/lib/ghc/package.conf.d</code>, and the program I tried to copy loads just fine.</p>\n\n<p><strong>EDIT 2</strong> After running <code>cabal install some-pkg</code>, <code>ghc-pkg list</code> reports that the newly installed stuff is in another directory. Indeed, <code>~/.cabal/config</code> specifies install dirs for user, as well as install dirs for global. How is all this supposed to be managed properly?</p>\n"}, {"tags": ["parsing", "haskell", "functional-programming", "monads", "do-notation"], "answers": [{"tags": [], "owner": {"reputation": 100185, "user_id": 3234959, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/93bb12ca0f93dfddb33880316f7e66c2?s=128&d=identicon&r=PG&f=1", "display_name": "chi", "link": "https://stackoverflow.com/users/3234959/chi"}, "is_accepted": true, "score": 5, "last_activity_date": 1564575263, "creation_date": 1564575263, "answer_id": 57290519, "question_id": 57289927, "link": "https://stackoverflow.com/questions/57289927/parsing-within-case-block/57290519#57290519", "title": "Parsing within case block", "body": "<blockquote>\n  <p>Normally I would just 'unpack' it, however, how would I do this within a case ?</p>\n</blockquote>\n\n<p>You need to \"push\" the final <code>return</code> inside the case branches first</p>\n\n<pre><code>pattern &lt;- match \"pos:\" `mplus`  ....\ncase pattern of\n   \"pos\"   -&gt; return (Tile  parsePosition  fix  wiel)\n   \"fixed\" -&gt; return (Tile  pos     parseFixed  wiel)\n   \"wheel\" -&gt; return (Tile  pos     fix    parseWiel)\n</code></pre>\n\n<p>Now, having the branches being run in the parser monad, you can unpack as usual:</p>\n\n<pre><code>pattern &lt;- match \"pos:\" `mplus`  ....\ncase pattern of\n   \"pos\"   -&gt; do  -- alternative 1\n      pp &lt;- parsePosition\n      return (Tile pp fix wiel)\n   \"fixed\" -&gt; -- alternative 2\n      (\\pf -&gt; Tile pos pf wiel) &lt;$&gt; parseFixed\n   \"wheel\" -&gt; ...\n</code></pre>\n"}, {"comments": [{"owner": {"reputation": 126897, "user_id": 791604, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/ce991df7a056248d5e4f6fc3659ba733?s=128&d=identicon&r=PG", "display_name": "Daniel Wagner", "link": "https://stackoverflow.com/users/791604/daniel-wagner"}, "edited": false, "score": 0, "creation_date": 1564580404, "post_id": 57290722, "comment_id": 101078587, "body": "How is the second one less code duplication? Sure, we are saying <code>Tile</code> fewer times, but now we&#39;re saying <code>(,,)</code> more times."}, {"owner": {"reputation": 61419, "user_id": 849891, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/MbEO3.png?s=128&g=1", "display_name": "Will Ness", "link": "https://stackoverflow.com/users/849891/will-ness"}, "reply_to_user": {"reputation": 126897, "user_id": 791604, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/ce991df7a056248d5e4f6fc3659ba733?s=128&d=identicon&r=PG", "display_name": "Daniel Wagner", "link": "https://stackoverflow.com/users/791604/daniel-wagner"}, "edited": false, "score": 0, "creation_date": 1564584077, "post_id": 57290722, "comment_id": 101081083, "body": "@DanielWagner <i>&quot;in case&quot;</i> etc as in the answer -- i.e. there could be some more steps before the final return, which I hinted at with the <code>-- .....</code>. what I wanted was the ability to continue <i>after</i> the case. the first (most immediate) translation is a split (into the three tails), the second connects back the split ends into one line so to speak (in the control flow diagram)."}], "tags": [], "owner": {"reputation": 61419, "user_id": 849891, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/MbEO3.png?s=128&g=1", "display_name": "Will Ness", "link": "https://stackoverflow.com/users/849891/will-ness"}, "is_accepted": false, "score": 1, "last_activity_date": 1564585199, "last_edit_date": 1564585199, "creation_date": 1564576007, "answer_id": 57290722, "question_id": 57289927, "link": "https://stackoverflow.com/questions/57289927/parsing-within-case-block/57290722#57290722", "title": "Parsing within case block", "body": "<p>Something like</p>\n\n<pre><code>parseCompontntsTile :: Tile -&gt; Parser Tile\nparseCompontntsTile (Tile pos fix wiel) = \n    do  parseWhiteSpace\n        pattern &lt;- match \"pos:\" `mplus` match \"fixed:\" `mplus` match \"wheel:\"\n        case pattern of\n                 \"pos\"   -&gt; do { pos &lt;- parsePosition ; return $ Tile pos fix wiel }\n                 \"fixed\" -&gt; do { fix &lt;- parseFixed    ; return $ Tile pos fix wiel }\n                 \"wheel\" -&gt; do { wiel &lt;- parseWiel    ; return $ Tile pos fix wiel } \n</code></pre>\n\n<p>assuming that those <code>parseXXXX</code> items are parsers.</p>\n\n<p>Or restructure it for less code duplication, by the use of <em>shadowing</em> to <a href=\"https://stackoverflow.com/a/11923567/849891\">\"update\"</a> the corresponding variable, as</p>\n\n<pre><code>parseCompontntsTile :: Tile -&gt; Parser Tile\nparseCompontntsTile (Tile pos fix wiel) = \n    do  parseWhiteSpace\n        pattern &lt;- match \"pos:\" `mplus` match \"fixed:\" `mplus` match \"wheel:\"\n        (pos,fix,wiel) &lt;- case pattern of\n                 \"pos\"   -&gt; do { pos &lt;- parsePosition ; return (pos,fix,wiel) }\n                 \"fixed\" -&gt; do { fix &lt;- parseFixed    ; return (pos,fix,wiel) }\n                 \"wheel\" -&gt; do { wiel &lt;- parseWiel    ; return (pos,fix,wiel) } \n        -- .....\n        return $ Tile pos fix wiel\n</code></pre>\n\n<p><em>in case</em> the actual post-processing step is more involved (i.e. there's more steps after the <code>case</code>, before the final <code>return</code>).</p>\n"}], "owner": {"reputation": 293, "user_id": 9715006, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/eeb905e7fb1642526f814464beb1755c?s=128&d=identicon&r=PG&f=1", "display_name": "swaffelay", "link": "https://stackoverflow.com/users/9715006/swaffelay"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 77, "favorite_count": 0, "accepted_answer_id": 57290519, "answer_count": 2, "score": 2, "last_activity_date": 1564585199, "creation_date": 1564573271, "last_edit_date": 1564574873, "question_id": 57289927, "link": "https://stackoverflow.com/questions/57289927/parsing-within-case-block", "title": "Parsing within case block", "body": "<p>So I am writing my own parser which is almost done, however I keep on getting stuck with the return of my function. My return is a <code>case</code>, but within the <code>case</code> I have to do a parse, which I can't manage to make it work.</p>\n\n<pre><code>parseCompontntsTile :: Tile -&gt; Parser Tile\nparseCompontntsTile (Tile pos fix wiel) = \n    do  parseWhiteSpace\n        patern &lt;- match \"pos:\" `mplus`     match \"fixed:\" `mplus` match \"wheel:\"\n        return (case patern of\n                 \"pos\"   -&gt; (Tile  parsePosition  fix  wiel)\n                 \"fixed\" -&gt; (Tile  pos     parseFixed  wiel)\n                 \"wheel\" -&gt; (Tile  pos     fix    parseWiel) )\n</code></pre>\n\n<p>The function <code>parsePosition</code> is from the type <code>parsePosition :: Parser Coord</code>;\nthe constructor of tile is <code>Coord Bool Bool</code>.</p>\n\n<p>This of course doesn't work because <code>parsePosition</code> returns <code>Parser Coord</code> and it expects a <code>Coord</code> (without the <em>\"parse\"</em>). Normally I would just 'unpack' it, however, how would I do this within a case ?</p>\n\n<p>thx for the help</p>\n"}, {"tags": ["haskell", "type-level-computation"], "comments": [{"owner": {"reputation": 100185, "user_id": 3234959, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/93bb12ca0f93dfddb33880316f7e66c2?s=128&d=identicon&r=PG&f=1", "display_name": "chi", "link": "https://stackoverflow.com/users/3234959/chi"}, "edited": false, "score": 2, "creation_date": 1564571014, "post_id": 57289089, "comment_id": 101073067, "body": "I don&#39;t think this can be done, in general. GHC works under an open world assumption so to support incremental compilation. This would entail to commit to &quot;no instance exists&quot; on a local basis, which copes with that. I&#39;d be happy to be proven wrong on this, though :)"}], "answers": [{"tags": [], "owner": {"reputation": 1882, "user_id": 2882307, "user_type": "registered", "accept_rate": 66, "profile_image": "https://www.gravatar.com/avatar/ec8370b53eef1b4e53bccdcdf605a282?s=128&d=identicon&r=PG&f=1", "display_name": "John Smith", "link": "https://stackoverflow.com/users/2882307/john-smith"}, "is_accepted": false, "score": 0, "last_activity_date": 1564672178, "last_edit_date": 1564672178, "creation_date": 1564670366, "answer_id": 57311500, "question_id": 57289089, "link": "https://stackoverflow.com/questions/57289089/how-to-create-custom-type-error-on-constraint-violation/57311500#57311500", "title": "how to create custom type error on constraint violation", "body": "<p>While the following won't work for all constraints. In the case that your constraint operates on a finite number of types you can do something like the following:</p>\n\n<pre><code>class Bar a where\n  baz :: a -&gt; a\n\ndata Foo (n :: Nat) = Foo deriving Show\n\ninstance {-# OVERLAPS #-} Bar (Foo 0) where\n  baz = id\n\ninstance {-# OVERLAPS #-} Bar (Foo 1) where\n  baz = id\n\ninstance {-# OVERLAPPABLE #-} (TypeError (Text \"N is greater then 1\")) =&gt; Bar (Foo a) where\n  baz = undefined\n\nr1 = baz (Foo :: Foo 0) -- succeeds\nr2 = baz (Foo :: Foo 1) -- succeeds\nr3 = baz (Foo :: Foo 2) -- fails with custom type error\n</code></pre>\n\n<p>I will keep this question open until someone comes along that either gives a general solution or tells us this isn't possible with some good explanation.</p>\n"}, {"tags": [], "owner": {"reputation": 44013, "user_id": 1477667, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/trgKM.jpg?s=128&g=1", "display_name": "dfeuer", "link": "https://stackoverflow.com/users/1477667/dfeuer"}, "is_accepted": false, "score": 0, "last_activity_date": 1564686093, "creation_date": 1564686093, "answer_id": 57315494, "question_id": 57289089, "link": "https://stackoverflow.com/questions/57289089/how-to-create-custom-type-error-on-constraint-violation/57315494#57315494", "title": "how to create custom type error on constraint violation", "body": "<p>Csongor Kiss has come up with a technique that can sometimes improve error messages in these cases, though it can't give custom type errors. There are also situations where it will make type errors <em>less</em> useful, so some judgement and care is required. His technique needs a minor tweak to work here.</p>\n\n<pre><code>eqFoo\n  :: KnownNat n\n  =&gt; Foo n -&gt; Foo n -&gt; Bool\neqFoo _ _ = True\n\ninstance {-# OVERLAPPING #-}\n    Eq (Foo 0) where\n  (==) = eqFoo\n\ninstance {-# OVERLAPPABLE #-}\n    KnownNat n =&gt; Eq (Foo n) where\n  (==) = eqFoo\n</code></pre>\n\n<p>Now GHC can't reduce the <code>Eq (Foo n)</code> constraint to <code>KnownNat n</code> until it knows what <code>n</code> is. So you'll get an error saying that it couldn't resolve the instance for <code>Eq (Foo n)</code> rather than one about <code>KnownNat</code>. In this case, that seems strictly worse, but maybe in your real code it would be better.</p>\n"}, {"tags": [], "owner": {"reputation": 8621, "user_id": 1848029, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/qfjAy.jpg?s=128&g=1", "display_name": "lehins", "link": "https://stackoverflow.com/users/1848029/lehins"}, "is_accepted": false, "score": 0, "last_activity_date": 1571161829, "creation_date": 1571161829, "answer_id": 58400143, "question_id": 57289089, "link": "https://stackoverflow.com/questions/57289089/how-to-create-custom-type-error-on-constraint-violation/58400143#58400143", "title": "how to create custom type error on constraint violation", "body": "<p>This approach will not work for arbitrary constraints, but since the question seems to be dealing with <code>Nat</code>s we can have a general solution for this problem. What we want is the <code>TypeError</code> at the type level, rather than at the constraint level, like it was suggested in the suggested solution by @John Smith:</p>\n\n<pre class=\"lang-hs prettyprint-override\"><code>{-# LANGUAGE DataKinds #-}\n{-# LANGUAGE FlexibleInstances #-}\n{-# LANGUAGE KindSignatures #-}\n{-# LANGUAGE TypeFamilies #-}\n{-# LANGUAGE TypeOperators #-}\n{-# LANGUAGE UndecidableInstances #-}\nimport GHC.TypeLits\n\nclass Bar a where\n  baz :: a -&gt; a\n\ndata Foo (n :: Nat) = Foo deriving Show\n\ntype family ReportNotInRange (n :: Nat) (x :: Nat) (y :: Nat) xAbove yBelow :: Bool where\n  ReportNotInRange n x y 'True  'True = 'True\n  ReportNotInRange n x y 'False 'True =\n    TypeError ('Text \"Value \" :&lt;&gt;: ShowType n :&lt;&gt;: 'Text \" is below the expected \" :&lt;&gt;: ShowType x)\n  ReportNotInRange n x y xAbove 'False =\n    TypeError ('Text \"Value \" :&lt;&gt;: ShowType n :&lt;&gt;: 'Text \" is above the expected \" :&lt;&gt;: ShowType y)\n\ntype family InRange n x y :: Bool where\n  InRange n x y = ReportNotInRange n x y (x &lt;=? n) (n &lt;=? y)\n\ninstance (KnownNat n, InRange n 1 2 ~ 'True) =&gt; Bar (Foo n) where\n  baz = id\n\nr1 = baz (Foo :: Foo 0) -- fails with custom type error\nr2 = baz (Foo :: Foo 1) -- succeeds\nr3 = baz (Foo :: Foo 2) -- succeeds\nr4 = baz (Foo :: Foo 3) -- fails with custom type error\n</code></pre>\n\n<p>Above code gives us a very nice descriptive compilation errors and we didn't need to use overlapping instances:</p>\n\n<pre><code>how-to-create-custom-type-error-on-constraint-violation.hs:37:6-23: error: \u2026\n    \u2022 Value 0 is below the expected 1\n    \u2022 In the expression: baz (Foo :: Foo 0)\n      In an equation for \u2018r1\u2019: r1 = baz (Foo :: Foo 0)\n   |\nhow-to-create-custom-type-error-on-constraint-violation.hs:40:6-23: error: \u2026\n    \u2022 Value 3 is above the expected 2\n    \u2022 In the expression: baz (Foo :: Foo 3)\n      In an equation for \u2018r4\u2019: r4 = baz (Foo :: Foo 3)\n   |\nCompilation failed.\n</code></pre>\n"}], "owner": {"reputation": 1882, "user_id": 2882307, "user_type": "registered", "accept_rate": 66, "profile_image": "https://www.gravatar.com/avatar/ec8370b53eef1b4e53bccdcdf605a282?s=128&d=identicon&r=PG&f=1", "display_name": "John Smith", "link": "https://stackoverflow.com/users/2882307/john-smith"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 162, "favorite_count": 1, "answer_count": 3, "score": 9, "last_activity_date": 1571161829, "creation_date": 1564570369, "last_edit_date": 1564573256, "question_id": 57289089, "link": "https://stackoverflow.com/questions/57289089/how-to-create-custom-type-error-on-constraint-violation", "title": "how to create custom type error on constraint violation", "body": "<p>I have a class instance that has some relatively unintuitive constraints. This results in unreadable error messages if this constraint is violated. What I would like to do is provide a custom type error which explains the constraint in a human readable way. I have looked <a href=\"https://gitlab.haskell.org/ghc/ghc/wikis/proposal/custom-type-errors\" rel=\"noreferrer\">here</a> which seems close to what I want. However the TypeError I want to generate is based on a constraint violation and not on the instance declaration.</p>\n\n<p>Here is example code of what I would like to achieve:</p>\n\n<pre><code>data Foo (n :: Nat) = Foo\n\ninstance\n  (TypeError (Text \"Missing KnownNat constraint\")) \n  =&gt; Eq (Foo n) where (==) = undefined\n\ninstance\n  (KnownNat n) \n  =&gt; Eq (Foo n) where (==) _ _ = True\n</code></pre>\n\n<p>I don't particularly need two instance declaration. If there is some other way to do it I'm fine with it as well.</p>\n"}, {"tags": ["haskell"], "comments": [{"owner": {"reputation": 61419, "user_id": 849891, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/MbEO3.png?s=128&g=1", "display_name": "Will Ness", "link": "https://stackoverflow.com/users/849891/will-ness"}, "edited": false, "score": 0, "creation_date": 1564567239, "post_id": 57280926, "comment_id": 101070919, "body": "did you think that <code>f []</code> was a function call syntax?"}], "answers": [{"tags": [], "owner": {"reputation": 14030, "user_id": 8475054, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/edbf41c4b5aecb1a949936e06368a7c2?s=128&d=identicon&r=PG&f=1", "display_name": "Robin Zigmond", "link": "https://stackoverflow.com/users/8475054/robin-zigmond"}, "is_accepted": false, "score": 5, "last_activity_date": 1564527192, "creation_date": 1564527192, "answer_id": 57281034, "question_id": 57280926, "link": "https://stackoverflow.com/questions/57280926/understanding-type-definitions/57281034#57281034", "title": "Understanding type definitions", "body": "<p>First let me rewrite your definition of <code>fmap_List</code> using the more normal notation, where <code>[] a</code> is written as <code>[a]</code></p>\n\n<pre><code>fmap_list :: (a -&gt; b) -&gt; [a] -&gt; [b]\nfmap_list f [] = []\nfmap_list f (x:xs) = f x : fmap_List f xs\n</code></pre>\n\n<p>The type signature tells you that the function takes 2 arguments: a function of type <code>a -&gt; b</code> and a list of type <code>[a]</code>, and that it returns a list of type <code>[b]</code>. So that must mean that on that second line, for example:</p>\n\n<pre><code>fmap_list f [] = []\n</code></pre>\n\n<p>the <code>f</code> has type <code>a -&gt; b</code> (although the name is arbitrary, it's usual to use things like <code>f</code> and <code>g</code> to refer to functions, so this matches up), and the first <code>[]</code> (to the left of the equals sign) has type <code>[a]</code>. The <code>[]</code> on the right of the equals sign is the result of the function, so is of type <code>[b]</code>. It's exactly the same on the subsequent line. Let me try to emphasise how the types of the function definition match up with those of the signature with some spacing:</p>\n\n<pre><code>fmap_list :: (a -&gt; b) -&gt; [a]    -&gt; [b]\nfmap_list    f           []     =  []\nfmap_list    f           (x:xs) =  f x : fmap_List f xs\n</code></pre>\n\n<p>I hope this makes sense now - and I see no need to go through the other 2 examples in the same detail, as for this purpose they're exactly the same. If you need further clarification, please let me know in the comments.</p>\n\n<p>The major error in your assumptions is here (and similar cases): \"<code>f []</code> is <code>(a -&gt; b)</code> right?\" No, <code>f</code> is of type <code>a -&gt; b</code> and <code>f []</code> isn't actually meaningful here (it would mean the value of the function <code>f</code> applied to <code>[]</code>, but that only works if <code>a</code> is a list type, something which there is no reason to infer). What appears in the function definition isn't <code>f []</code> but <code>fmap_list f []</code>, which is parsed as <code>(fmap_list f) []</code>.</p>\n"}, {"tags": [], "owner": {"reputation": 339851, "user_id": 149392, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/7a561ec0875fcbbe3066ea8fe288ec77?s=128&d=identicon&r=PG", "display_name": "sepp2k", "link": "https://stackoverflow.com/users/149392/sepp2k"}, "is_accepted": true, "score": 8, "last_activity_date": 1564527201, "creation_date": 1564527201, "answer_id": 57281038, "question_id": 57280926, "link": "https://stackoverflow.com/questions/57280926/understanding-type-definitions/57281038#57281038", "title": "Understanding type definitions", "body": "<p>If we think a curried function as a function taking multiple arguments, then</p>\n\n<pre><code>fmap_List :: (a -&gt; b) -&gt; [a] -&gt; [b]\n</code></pre>\n\n<p>means that <code>fmap_List</code> is a two-argument function where the first argument has type <code>a -&gt; b</code>, the second argument has type <code>[a]</code> and the result has type <code>[b]</code>.</p>\n\n<pre><code>fmap_list f [] = [] --1\n</code></pre>\n\n<p>Here <code>f</code> is the name given to the first argument of the function, so <code>f</code> has type <code>a -&gt; b</code> and the <code>[]</code> pattern is applied to the second argument (of type <code>[a]</code>). The result of the function is <code>[]</code>, which has type <code>[b]</code> in accordance with the declared result type.</p>\n\n<pre><code>fmap_list f (x:xs) = f x : fmap_List f xs --2\n</code></pre>\n\n<p>Again <code>f</code> has type <code>a -&gt; b</code>. <code>x:xs</code> is a pattern that matches the second argument of type <code>[a]</code>. Since <code>:</code> is pattern of the type <code>[a]</code> with the operand types <code>a</code> and <code>[a]</code>, this means that <code>x</code> will have type <code>a</code> and <code>xs</code> will have type <code>[a]</code>. <code>f x : fmap_List f xs</code> is an expression of type <code>[b]</code>.</p>\n\n<pre><code>fmap_Maybe f Nothing = Nothing --3\n</code></pre>\n\n<p><code>f</code> is the <code>a -&gt; b</code>, <code>Nothing</code> matches the <code>Maybe a</code> and the <code>Nothing</code> on the right of the <code>=</code> is the result of type <code>Maybe b</code>.</p>\n\n<pre><code>fmap_maybe f (Just a) = Just (f a) --4\n</code></pre>\n\n<p>Again <code>f</code> is the <code>a -&gt; b</code>. <code>Just a</code> matches the <code>Maybe a</code>, giving <code>a</code> the type <code>a</code>. <code>Just (f a)</code> is the result of type <code>Maybe b</code> (<code>f a</code> having type <code>b</code> and <code>Just</code> turning the <code>b</code> into a <code>Maybe b</code>).</p>\n"}], "owner": {"reputation": 14927, "user_id": 2719875, "user_type": "registered", "accept_rate": 78, "profile_image": "https://www.gravatar.com/avatar/ae764a4524119ce0d93e7d8f0ee2356c?s=128&d=identicon&r=PG&f=1", "display_name": "user2719875", "link": "https://stackoverflow.com/users/2719875/user2719875"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 103, "favorite_count": 0, "accepted_answer_id": 57281038, "answer_count": 2, "score": 3, "last_activity_date": 1564527201, "creation_date": 1564526438, "question_id": 57280926, "link": "https://stackoverflow.com/questions/57280926/understanding-type-definitions", "title": "Understanding type definitions", "body": "<p>I'm trying to understand type definitions given to me while learning Haskell.</p>\n\n<p>First, this:</p>\n\n<pre><code>fmap_List :: (a -&gt; b) -&gt; [] a -&gt; [] b\nfmap_list f [] = [] --1\nfmap_list f (x:xs) = f x : fmap_List f xs --2\n</code></pre>\n\n<p>For <code>1</code>, <code>f []</code> is <code>(a -&gt; b)</code> right? And then <code>= []</code> is <code>[] a</code>. What's <code>[] b</code>?</p>\n\n<p>For <code>2</code>, <code>f (x:xs)</code> is <code>(a -&gt; b)</code>. And <code>= f x</code> is <code>[] a</code> and <code>: fmap_List f xs</code> is <code>[] b</code>, right?</p>\n\n<p>Now, given <code>Maybe</code>:</p>\n\n<pre><code>data Maybe a = Nothing | Just a\n\nfmap_Maybe :: (a -&gt; b) -&gt; Maybe a -&gt; Maybe b\nfmap_Maybe f Nothing = Nothing --3\nfmap_maybe f (Just a) = Just (f a) --4\n</code></pre>\n\n<p>For <code>3</code>, <code>f Nothing</code> is <code>(a -&gt; b)</code>. <code>= Nothing</code> is the <code>-&gt; Maybe a</code> part. Where is the <code>-&gt; Maybe b</code> part?</p>\n\n<p>For <code>4</code>, <code>f (Just a)</code> is <code>(a -&gt; b)</code>, <code>= Just (f a)</code> is <code>-&gt; Maybe a</code>. So Again, where is the <code>-&gt; Maybe b</code> part?</p>\n\n<p>And I got No idea how this works (hoping based on the above clarifications, I can figure it out):</p>\n\n<pre><code>fmap_Either :: (a -&gt; b) -&gt; (Either e) a -&gt; (Either e) b\nfmap_Either f (Left e) = Left e\nfmap_Either f (Right a) = Right (f a)\n</code></pre>\n\n<p>Thanks!</p>\n"}, {"tags": ["mongodb", "haskell", "database-cursor"], "comments": [{"owner": {"reputation": 7, "user_id": 5066419, "user_type": "registered", "accept_rate": 100, "profile_image": "https://lh4.googleusercontent.com/-BQe12bJ4Iyo/AAAAAAAAAAI/AAAAAAAAAC4/lbP-gO8qZMc/photo.jpg?sz=128", "display_name": "MinecraftBoxGuy", "link": "https://stackoverflow.com/users/5066419/minecraftboxguy"}, "reply_to_user": {"reputation": 24028, "user_id": 383200, "user_type": "registered", "accept_rate": 60, "profile_image": "https://www.gravatar.com/avatar/a9dc722f936cb1059adaae4fe39c07f0?s=128&d=identicon&r=PG", "display_name": "Carl", "link": "https://stackoverflow.com/users/383200/carl"}, "edited": false, "score": 0, "creation_date": 1564557043, "post_id": 57280043, "comment_id": 101065273, "body": "@Carl I have referred to the connection to the database as the &quot;pipe&quot;. I have referred to closing the pipe multiple times (e.g. &quot; This either means that the Haskell client has closed it or it was closed by the MongoDB Database when the connection was dropped.&quot;)  and know that that is what causes the error. However I do not understand why it causes an error: the Haskell MongoDB docs explicitly state that: a cursor is not closed when the pipe is closed, so you can open another pipe to the same server and continue using the cursor."}, {"owner": {"reputation": 24028, "user_id": 383200, "user_type": "registered", "accept_rate": 60, "profile_image": "https://www.gravatar.com/avatar/a9dc722f936cb1059adaae4fe39c07f0?s=128&d=identicon&r=PG", "display_name": "Carl", "link": "https://stackoverflow.com/users/383200/carl"}, "edited": false, "score": 0, "creation_date": 1564578721, "post_id": 57280043, "comment_id": 101077516, "body": "Sorry, looks like I missed the main point of the question.  A quick survey of the code suggests it&#39;s entirely up to the underlying database.  Not sure why Mongo would be doing that."}, {"owner": {"reputation": 7, "user_id": 5066419, "user_type": "registered", "accept_rate": 100, "profile_image": "https://lh4.googleusercontent.com/-BQe12bJ4Iyo/AAAAAAAAAAI/AAAAAAAAAC4/lbP-gO8qZMc/photo.jpg?sz=128", "display_name": "MinecraftBoxGuy", "link": "https://stackoverflow.com/users/5066419/minecraftboxguy"}, "reply_to_user": {"reputation": 24028, "user_id": 383200, "user_type": "registered", "accept_rate": 60, "profile_image": "https://www.gravatar.com/avatar/a9dc722f936cb1059adaae4fe39c07f0?s=128&d=identicon&r=PG", "display_name": "Carl", "link": "https://stackoverflow.com/users/383200/carl"}, "edited": false, "score": 0, "creation_date": 1564609495, "post_id": 57280043, "comment_id": 101092334, "body": "Yep, I&#39;m not sure how I should go about finding specific documentation / help about this behaviour."}], "owner": {"reputation": 7, "user_id": 5066419, "user_type": "registered", "accept_rate": 100, "profile_image": "https://lh4.googleusercontent.com/-BQe12bJ4Iyo/AAAAAAAAAAI/AAAAAAAAAC4/lbP-gO8qZMc/photo.jpg?sz=128", "display_name": "MinecraftBoxGuy", "link": "https://stackoverflow.com/users/5066419/minecraftboxguy"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 94, "favorite_count": 0, "answer_count": 0, "score": 0, "last_activity_date": 1564520827, "creation_date": 1564520827, "question_id": 57280043, "link": "https://stackoverflow.com/questions/57280043/issue-with-using-cursor-after-initial-pipe-is-closed-mongodb", "title": "Issue With Using Cursor After Initial Pipe Is Closed \u2013 MongoDB", "body": "<p>I'm attempting to use a MongoDB Cursor in Haskell. I use a pipe (connection to my MongoDB database) to obtain the value of this cursor, then close the pipe and give the value of the cursor. After opening another pipe, I have errors when accessing the cursor, although the Haskell MongoDB docs state that:</p>\n\n<blockquote>\n  <p>a cursor is not closed when the pipe is closed, so you can open another pipe to the same server and continue using the cursor.</p>\n</blockquote>\n\n<p>at <a href=\"http://hackage.haskell.org/package/mongoDB-2.5.0.0/docs/Database-MongoDB-Query.html#t:Cursor\" rel=\"nofollow noreferrer\">http://hackage.haskell.org/package/mongoDB-2.5.0.0/docs/Database-MongoDB-Query.html#t:Cursor</a></p>\n\n<p>I have tried using cursors when the pipe does not close between the initialisation and usage of them: this does work, however this is not the solution I want to integrate into my web-app (I will want to use pooling in the future.) I am also left wondering why closing the pipe causes the cursor to no longer work.</p>\n\n<p>I have looked through the MongoDB source code, and have only found one area where <code>closeCursor</code> is used (<a href=\"https://github.com/mongodb-haskell/mongodb/blob/33f2aca7b736c34d915916bc978bc5435baae533/Database/MongoDB/Query.hs#L1214\" rel=\"nofollow noreferrer\">https://github.com/mongodb-haskell/mongodb/blob/33f2aca7b736c34d915916bc978bc5435baae533/Database/MongoDB/Query.hs#L1214</a>). I am not sure if the error I'm having is a problem with a mismatch between the documentation of the client and my actual MongoDB Community Server (v4.0.10). </p>\n\n<p>I have created a reproducible example of an IO Action causing this error. </p>\n\n<pre class=\"lang-hs prettyprint-override\"><code>firstFiveOver20 :: IO ()\nfirstFiveOver20 = (DB.withDB . find  $ (select [] \"test\"))\n &gt;&gt;= (() &lt;$) . DB.withDB . Database.MongoDB.nextN 5\n</code></pre>\n\n<p><code>find</code>, <code>select</code>, and <code>nextN</code> are from the MongoDB package.\nThe function <code>withDB</code> is defined as:</p>\n\n<pre class=\"lang-hs prettyprint-override\"><code>withDB :: Action IO a -&gt; IO a\nwithDB action =  (connect $ host \"127.0.0.1\") &gt;&gt;= (\\pipe -&gt; access pipe master databaseName action &lt;* close pipe)\n</code></pre>\n\n<p>The expected result is for nothing to be logged (as I don't expect any errors). However, the error <code>ConnectionFailure Handle has been closed: does not exist</code> is given. From my perception, this seems to mean that the MongoDB Database is reporting the cursor as not existing. This either means that the Haskell client has closed it or it was closed by the MongoDB Database when the connection was dropped. These both contradict the statement in the docs (<a href=\"http://hackage.haskell.org/package/mongoDB-2.5.0.0/docs/Database-MongoDB-Query.html#t:Cursor\" rel=\"nofollow noreferrer\">http://hackage.haskell.org/package/mongoDB-2.5.0.0/docs/Database-MongoDB-Query.html#t:Cursor</a>).</p>\n"}, {"tags": ["haskell", "pattern-matching", "lazy-evaluation"], "comments": [{"owner": {"reputation": 3603, "user_id": 165806, "user_type": "registered", "accept_rate": 64, "profile_image": "https://www.gravatar.com/avatar/c889e0a95a3bb07f90ab28ad442f1127?s=128&d=identicon&r=PG", "display_name": "Iceland_jack", "link": "https://stackoverflow.com/users/165806/iceland-jack"}, "edited": false, "score": 3, "creation_date": 1564514206, "post_id": 57278354, "comment_id": 101053898, "body": "You can think of <code>left a ~(l, r) = (a:l, r)</code> as <code>left a pair = (a:fst pair, snd pair)</code>. I think they are completely equivalent but I&#39;m not 100%"}, {"owner": {"reputation": 57219, "user_id": 33796, "user_type": "registered", "accept_rate": 70, "profile_image": "https://www.gravatar.com/avatar/08727b23ba62e634b32988cdff082663?s=128&d=identicon&r=PG", "display_name": "luqui", "link": "https://stackoverflow.com/users/33796/luqui"}, "reply_to_user": {"reputation": 3603, "user_id": 165806, "user_type": "registered", "accept_rate": 64, "profile_image": "https://www.gravatar.com/avatar/c889e0a95a3bb07f90ab28ad442f1127?s=128&d=identicon&r=PG", "display_name": "Iceland_jack", "link": "https://stackoverflow.com/users/165806/iceland-jack"}, "edited": false, "score": 0, "creation_date": 1564515564, "post_id": 57278354, "comment_id": 101054470, "body": "@Iceland_jack, they are not quite equivalent.  <code>fst pair</code> is outfitted with a special rig to rewrite <code>snd pair</code> to <code>r</code> (and vice versa), so as to destroy the reference to <code>pair</code> and improve degenerate GC behavior."}, {"owner": {"reputation": 44013, "user_id": 1477667, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/trgKM.jpg?s=128&g=1", "display_name": "dfeuer", "link": "https://stackoverflow.com/users/1477667/dfeuer"}, "reply_to_user": {"reputation": 57219, "user_id": 33796, "user_type": "registered", "accept_rate": 70, "profile_image": "https://www.gravatar.com/avatar/08727b23ba62e634b32988cdff082663?s=128&d=identicon&r=PG", "display_name": "luqui", "link": "https://stackoverflow.com/users/33796/luqui"}, "edited": false, "score": 0, "creation_date": 1564531066, "post_id": 57278354, "comment_id": 101059020, "body": "@luqui, that should apply to the lazy pattern match as well. <code>left</code> will compile to something like <code>left a lr = (a : case lr of (l,_) -&gt; l, case lr of (_, r) -&gt; r)</code>. Those cases will both become &quot;selector thunks&quot;, treated specially by the GC."}, {"owner": {"reputation": 57219, "user_id": 33796, "user_type": "registered", "accept_rate": 70, "profile_image": "https://www.gravatar.com/avatar/08727b23ba62e634b32988cdff082663?s=128&d=identicon&r=PG", "display_name": "luqui", "link": "https://stackoverflow.com/users/33796/luqui"}, "reply_to_user": {"reputation": 44013, "user_id": 1477667, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/trgKM.jpg?s=128&g=1", "display_name": "dfeuer", "link": "https://stackoverflow.com/users/1477667/dfeuer"}, "edited": false, "score": 0, "creation_date": 1564535914, "post_id": 57278354, "comment_id": 101059818, "body": "@dfeuer, wait I&#39;m confused. I didn&#39;t mean to say that if <code>fst</code>/<code>snd</code> are written literally this will happen -- in fact I think it won&#39;t.  I mean as the lazy pattern is &quot;translated&quot; (conceptually) they become special versions of <code>fst</code>/<code>snd</code> which do this special thing. Are we on the same page?"}, {"owner": {"reputation": 44013, "user_id": 1477667, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/trgKM.jpg?s=128&g=1", "display_name": "dfeuer", "link": "https://stackoverflow.com/users/1477667/dfeuer"}, "reply_to_user": {"reputation": 57219, "user_id": 33796, "user_type": "registered", "accept_rate": 70, "profile_image": "https://www.gravatar.com/avatar/08727b23ba62e634b32988cdff082663?s=128&d=identicon&r=PG", "display_name": "luqui", "link": "https://stackoverflow.com/users/33796/luqui"}, "edited": false, "score": 2, "creation_date": 1564545280, "post_id": 57278354, "comment_id": 101061416, "body": "@luqui, not so sure.... <code>fst</code> and <code>snd</code> will generally inline to do the right thing there. I also don&#39;t think your description of the rig is how it works. The <code>fst lr</code> (once inlined) doesn&#39;t compile (ultimately) to &quot;create a thunk to apply the <code>fst</code> function to <code>lr</code>.&quot; It compiles to &quot;create a <i>selector thunk</i> that chooses the first component of <code>lr</code>.&quot; When the garbage collector sees a selector thunk, it checks whether the argument is in WHNF and, if so, reduces it to the appropriate component. Now I know there was a later paper that suggested a (possibly more robust?) way that <i>doesn&#39;t</i> rely"}, {"owner": {"reputation": 44013, "user_id": 1477667, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/trgKM.jpg?s=128&g=1", "display_name": "dfeuer", "link": "https://stackoverflow.com/users/1477667/dfeuer"}, "edited": false, "score": 0, "creation_date": 1564545303, "post_id": 57278354, "comment_id": 101061425, "body": "on GC, but last I heard this is how GHC does it."}, {"owner": {"reputation": 57219, "user_id": 33796, "user_type": "registered", "accept_rate": 70, "profile_image": "https://www.gravatar.com/avatar/08727b23ba62e634b32988cdff082663?s=128&d=identicon&r=PG", "display_name": "luqui", "link": "https://stackoverflow.com/users/33796/luqui"}, "reply_to_user": {"reputation": 44013, "user_id": 1477667, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/trgKM.jpg?s=128&g=1", "display_name": "dfeuer", "link": "https://stackoverflow.com/users/1477667/dfeuer"}, "edited": false, "score": 0, "creation_date": 1564553272, "post_id": 57278354, "comment_id": 101063591, "body": "@dfeuer, ah, thanks, nice to know about the fiddlies."}, {"owner": {"reputation": 17170, "user_id": 1671066, "user_type": "registered", "accept_rate": 82, "profile_image": "https://www.gravatar.com/avatar/bd4c9461f2d17a884fba66eeed20e320?s=128&d=identicon&r=PG", "display_name": "Micha Wiedenmann", "link": "https://stackoverflow.com/users/1671066/micha-wiedenmann"}, "edited": false, "score": 0, "creation_date": 1564564549, "post_id": 57278354, "comment_id": 101069282, "body": "A list of hard to search symbols can be found at <a href=\"https://github.com/takenobu-hs/haskell-symbol-search-cheatsheet\" rel=\"nofollow noreferrer\">Haskell/GHC symbol search cheatsheet</a>."}, {"owner": {"reputation": 22091, "user_id": 5684257, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/ea5090cde8ea066a1fda67ed52dd5084?s=128&d=identicon&r=PG&f=1", "display_name": "HTNW", "link": "https://stackoverflow.com/users/5684257/htnw"}, "reply_to_user": {"reputation": 44013, "user_id": 1477667, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/trgKM.jpg?s=128&g=1", "display_name": "dfeuer", "link": "https://stackoverflow.com/users/1477667/dfeuer"}, "edited": false, "score": 1, "creation_date": 1564599129, "post_id": 57278354, "comment_id": 101088532, "body": "@dfeuer @luqui Testing with <code>testL f ~(x, y) = f x y; testF f xy = f (fst xy) (snd xy); testI f xy = f (inline fst xy) (inline snd xy)</code>, I observe: in <code>testF</code>, <code>fst</code> and <code>snd</code> do not inline and &quot;do the right thing&quot;; GHC doesn&#39;t seem to notice the benefit. Forcing it in <code>testI</code> works, causing deduplication to <code>testI = testL</code>. <code>testF</code>&#39;s thunks are really just normal thunks with code in them. Meanwhile <code>testL</code> actually uses on built-in, static selector thunks pre-specialized in the RTS, which seems to make it &quot;much better&quot; than <code>testF</code>."}, {"owner": {"reputation": 44013, "user_id": 1477667, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/trgKM.jpg?s=128&g=1", "display_name": "dfeuer", "link": "https://stackoverflow.com/users/1477667/dfeuer"}, "reply_to_user": {"reputation": 22091, "user_id": 5684257, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/ea5090cde8ea066a1fda67ed52dd5084?s=128&d=identicon&r=PG&f=1", "display_name": "HTNW", "link": "https://stackoverflow.com/users/5684257/htnw"}, "edited": false, "score": 0, "creation_date": 1564603989, "post_id": 57278354, "comment_id": 101090453, "body": "@HTNW, they don&#39;t even inline with optimization on? That&#39;s rather sad. I think I&#39;ll open a ticket."}, {"owner": {"reputation": 22091, "user_id": 5684257, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/ea5090cde8ea066a1fda67ed52dd5084?s=128&d=identicon&r=PG&f=1", "display_name": "HTNW", "link": "https://stackoverflow.com/users/5684257/htnw"}, "reply_to_user": {"reputation": 44013, "user_id": 1477667, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/trgKM.jpg?s=128&g=1", "display_name": "dfeuer", "link": "https://stackoverflow.com/users/1477667/dfeuer"}, "edited": false, "score": 1, "creation_date": 1564604596, "post_id": 57278354, "comment_id": 101090660, "body": "@dfeuer Yep, I tested it with <code>-O2</code> and they just sit there. Uninlined. I was surprised too. Do be warned though, I did this on 8.6.5. Maybe 8.8 is better about this."}, {"owner": {"reputation": 44013, "user_id": 1477667, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/trgKM.jpg?s=128&g=1", "display_name": "dfeuer", "link": "https://stackoverflow.com/users/1477667/dfeuer"}, "reply_to_user": {"reputation": 22091, "user_id": 5684257, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/ea5090cde8ea066a1fda67ed52dd5084?s=128&d=identicon&r=PG&f=1", "display_name": "HTNW", "link": "https://stackoverflow.com/users/5684257/htnw"}, "edited": false, "score": 0, "creation_date": 1564606229, "post_id": 57278354, "comment_id": 101091264, "body": "@HTNW, doubt it, but worth a check."}], "answers": [{"comments": [{"owner": {"reputation": 1447, "user_id": 6101419, "user_type": "registered", "accept_rate": 60, "profile_image": "https://lh5.googleusercontent.com/-i7UE6w9zuc8/AAAAAAAAAAI/AAAAAAAAAeU/A7Hw5rvVpYc/photo.jpg?sz=128", "display_name": "Enrico Borba", "link": "https://stackoverflow.com/users/6101419/enrico-borba"}, "edited": false, "score": 0, "creation_date": 1564723884, "post_id": 57278521, "comment_id": 101131601, "body": "Wow I always knew Haskell was non-strict but this is on a whole other level than what I previously expected. Seeing &quot;the values are&quot; being printed immediately before the Exception is awesome."}, {"owner": {"reputation": 57219, "user_id": 33796, "user_type": "registered", "accept_rate": 70, "profile_image": "https://www.gravatar.com/avatar/08727b23ba62e634b32988cdff082663?s=128&d=identicon&r=PG", "display_name": "luqui", "link": "https://stackoverflow.com/users/33796/luqui"}, "reply_to_user": {"reputation": 1447, "user_id": 6101419, "user_type": "registered", "accept_rate": 60, "profile_image": "https://lh5.googleusercontent.com/-i7UE6w9zuc8/AAAAAAAAAAI/AAAAAAAAAeU/A7Hw5rvVpYc/photo.jpg?sz=128", "display_name": "Enrico Borba", "link": "https://stackoverflow.com/users/6101419/enrico-borba"}, "edited": false, "score": 0, "creation_date": 1564736730, "post_id": 57278521, "comment_id": 101136872, "body": "@EnricoBorba, you like that?  Here&#39;s a favorite:  <code>howToWrite = &quot;How to write this book: &quot; ++ concatMap (\\x -&gt; &quot;write &quot; ++ show x ++ &quot;, then &quot;) (words  howToWrite)</code>."}], "tags": [], "owner": {"reputation": 57219, "user_id": 33796, "user_type": "registered", "accept_rate": 70, "profile_image": "https://www.gravatar.com/avatar/08727b23ba62e634b32988cdff082663?s=128&d=identicon&r=PG", "display_name": "luqui", "link": "https://stackoverflow.com/users/33796/luqui"}, "is_accepted": true, "score": 19, "last_activity_date": 1564514028, "last_edit_date": 1564514028, "creation_date": 1564513611, "answer_id": 57278521, "question_id": 57278354, "link": "https://stackoverflow.com/questions/57278354/what-is-the-meaning-of-before-l-r/57278521#57278521", "title": "What is the meaning of ~ before (l, r)", "body": "<p>This is a <a href=\"https://en.wikibooks.org/wiki/Haskell/Laziness#Lazy_pattern_matching\" rel=\"noreferrer\">lazy pattern match</a>.  It means that the pattern match is assumed to be successful, and only actually performed when its data is needed.</p>\n\n<pre><code>ghci&gt; strictPat (a,b) = \"hello\"\nghci&gt; lazyPat  ~(a,b) = \"hello\"\n\nghci&gt; strictPat undefined\n\"*** Exception: Prelude.undefined\nghci&gt; lazyPat undefined\n\"hello\"\n\nghci&gt; strictPat2 (a,b) = \"the values are \" ++ a ++ \" and \" ++ b\nghci&gt; lazyPat2  ~(a,b) = \"the values are \" ++ a ++ \" and \" ++ b\n\nghci&gt; strictPat2 undefined\n\"*** Exception: Prelude.undefined\nghci&gt; lazyPat2 undefined\n\"the values are *** Exception: Prelude.undefined\n</code></pre>\n\n<p>It is used here so that <code>partitionEithers</code> can be a good streamer.  Otherwise it would have to evaluate the whole list before it could return the first element of either of its results (because e.g. <code>left</code> would force the incoming pair, which was generated by a recursive call, which would have to force its incoming pair, and so on...).</p>\n"}], "owner": {"reputation": 257, "user_id": 11484713, "user_type": "registered", "profile_image": "https://lh4.googleusercontent.com/-jf7y-3MrxDE/AAAAAAAAAAI/AAAAAAAAAc8/ETJ5Qy_LNVg/photo.jpg?sz=128", "display_name": "Morgen Yang", "link": "https://stackoverflow.com/users/11484713/morgen-yang"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 263, "favorite_count": 2, "accepted_answer_id": 57278521, "answer_count": 1, "score": 11, "last_activity_date": 1564787911, "creation_date": 1564512897, "last_edit_date": 1564787911, "question_id": 57278354, "link": "https://stackoverflow.com/questions/57278354/what-is-the-meaning-of-before-l-r", "title": "What is the meaning of ~ before (l, r)", "body": "<p>I read the library of Haskell</p>\n\n<pre><code>partitionEithers :: [Either a b] -&gt; ([a],[b])\npartitionEithers = foldr (either left right) ([],[])\n where\n  left  a ~(l, r) = (a:l, r)\n  right a ~(l, r) = (l, a:r)\n\n</code></pre>\n\n<p>What is the meaning of <code>~</code> before <code>(l, r)</code>?</p>\n"}, {"tags": ["haskell"], "comments": [{"owner": {"reputation": 314794, "user_id": 67579, "user_type": "registered", "accept_rate": 81, "profile_image": "https://i.stack.imgur.com/BJXub.png?s=128&g=1", "display_name": "Willem Van Onsem", "link": "https://stackoverflow.com/users/67579/willem-van-onsem"}, "edited": false, "score": 1, "creation_date": 1564510071, "post_id": 57277522, "comment_id": 101051938, "body": "You probably want to change this to <code>w == 1 = [avg]</code> and <code>w == 2 = [avg, avg, avg, avg]</code>, and the type to <code>[Word8]</code>, you furthermore probably want to use <code>listArray</code> (<a href=\"https://hackage.haskell.org/package/array-0.5.3.0/docs/Data-Array.html#v:listArray\" rel=\"nofollow noreferrer\">hackage.haskell.org/package/array-0.5.3.0/docs/&hellip;</a>) instead of <code>array</code> in your <code>quadtreeToPic</code>. Finally I&#39;m not convinced that the logic is completely correct."}, {"owner": {"reputation": 14927, "user_id": 2719875, "user_type": "registered", "accept_rate": 78, "profile_image": "https://www.gravatar.com/avatar/ae764a4524119ce0d93e7d8f0ee2356c?s=128&d=identicon&r=PG&f=1", "display_name": "user2719875", "link": "https://stackoverflow.com/users/2719875/user2719875"}, "reply_to_user": {"reputation": 314794, "user_id": 67579, "user_type": "registered", "accept_rate": 81, "profile_image": "https://i.stack.imgur.com/BJXub.png?s=128&g=1", "display_name": "Willem Van Onsem", "link": "https://stackoverflow.com/users/67579/willem-van-onsem"}, "edited": false, "score": 0, "creation_date": 1564510252, "post_id": 57277522, "comment_id": 101052023, "body": "@WillemVanOnsem I want the type to be <code>\u2018Array (Int, Int) Word8\u2019</code>, I was wondering how to return the result in that particular format. I&#39;ll look into <code>listArray</code>. Thanks."}, {"owner": {"reputation": 14927, "user_id": 2719875, "user_type": "registered", "accept_rate": 78, "profile_image": "https://www.gravatar.com/avatar/ae764a4524119ce0d93e7d8f0ee2356c?s=128&d=identicon&r=PG&f=1", "display_name": "user2719875", "link": "https://stackoverflow.com/users/2719875/user2719875"}, "reply_to_user": {"reputation": 314794, "user_id": 67579, "user_type": "registered", "accept_rate": 81, "profile_image": "https://i.stack.imgur.com/BJXub.png?s=128&g=1", "display_name": "Willem Van Onsem", "link": "https://stackoverflow.com/users/67579/willem-van-onsem"}, "edited": false, "score": 0, "creation_date": 1564510364, "post_id": 57277522, "comment_id": 101052082, "body": "@WillemVanOnsem your solution <code>w == 1 = [avg]</code> does not use <code>array</code> or <code>listArray</code> though. How would I use it?"}, {"owner": {"reputation": 314794, "user_id": 67579, "user_type": "registered", "accept_rate": 81, "profile_image": "https://i.stack.imgur.com/BJXub.png?s=128&g=1", "display_name": "Willem Van Onsem", "link": "https://stackoverflow.com/users/67579/willem-van-onsem"}, "edited": false, "score": 0, "creation_date": 1564510437, "post_id": 57277522, "comment_id": 101052110, "body": "sorry, I realize you use a recursive approach here. You will need to &quot;unwrap&quot; the arrays in the recursion, or use something that is capable of &quot;combining&quot; two arrays then in the recursive definition."}, {"owner": {"reputation": 14927, "user_id": 2719875, "user_type": "registered", "accept_rate": 78, "profile_image": "https://www.gravatar.com/avatar/ae764a4524119ce0d93e7d8f0ee2356c?s=128&d=identicon&r=PG&f=1", "display_name": "user2719875", "link": "https://stackoverflow.com/users/2719875/user2719875"}, "reply_to_user": {"reputation": 314794, "user_id": 67579, "user_type": "registered", "accept_rate": 81, "profile_image": "https://i.stack.imgur.com/BJXub.png?s=128&g=1", "display_name": "Willem Van Onsem", "link": "https://stackoverflow.com/users/67579/willem-van-onsem"}, "edited": false, "score": 0, "creation_date": 1564510660, "post_id": 57277522, "comment_id": 101052216, "body": "@WillemVanOnsem Your solution solved a lot of the problems. Can you look at my update?"}], "answers": [{"tags": [], "owner": {"reputation": 57219, "user_id": 33796, "user_type": "registered", "accept_rate": 70, "profile_image": "https://www.gravatar.com/avatar/08727b23ba62e634b32988cdff082663?s=128&d=identicon&r=PG", "display_name": "luqui", "link": "https://stackoverflow.com/users/33796/luqui"}, "is_accepted": true, "score": 4, "last_activity_date": 1564511963, "last_edit_date": 1564511963, "creation_date": 1564511646, "answer_id": 57278083, "question_id": 57277522, "link": "https://stackoverflow.com/questions/57277522/type-errors-when-implementing-quadtree/57278083#57278083", "title": "Type Errors when implementing Quadtree", "body": "<p>It's referring to the underlined subexpression:</p>\n\n<pre><code>concat (map quadtreeToPic [q1, q2, q3, q4])\n        ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n</code></pre>\n\n<p>The <strong>expected type</strong> is the type that it should be from context, that is:</p>\n\n<pre><code>concat ???\n</code></pre>\n\n<p>It's what the compiler knows about what <code>???</code> must be without looking inside it.  <code>concat :: [[a]] -&gt; [a]</code> <sup>(*)</sup> takes a collection of lists and joins them all together.  So we expect to see a collection of <em>lists</em>.</p>\n\n<p>The <strong>actual type</strong> is the type that it looks like it is when analyzing the expression \"from the inside\":</p>\n\n<pre><code>map quadtreeToPic [q1, q2, q3, q4]\n</code></pre>\n\n<p>Here we get, from <code>map</code> and the declared type signature of your function, a <code>[Array (Int,Int) Word8]</code>.  It's a collection of arrays.  But we were expecting a collection of lists from the previous step.  Thus the error:</p>\n\n<pre><code>Couldn't match type \u2018Array (Int, Int) Word8\u2019 with \u2018[Word8]\u2019\n</code></pre>\n\n<p>Perhaps you want to turn those arrays into lists using <a href=\"http://hackage.haskell.org/package/base-4.12.0.0/docs/Data-Foldable.html#v:toList\" rel=\"nofollow noreferrer\"><code>Data.Foldable.toList</code></a> first?</p>\n\n<p><sup>(*)</sup>Well it's actually <code>concat :: Foldable t =&gt; t [a] -&gt; [a]</code> but I simplified for exposition.</p>\n"}], "owner": {"reputation": 14927, "user_id": 2719875, "user_type": "registered", "accept_rate": 78, "profile_image": "https://www.gravatar.com/avatar/ae764a4524119ce0d93e7d8f0ee2356c?s=128&d=identicon&r=PG&f=1", "display_name": "user2719875", "link": "https://stackoverflow.com/users/2719875/user2719875"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 53, "favorite_count": 0, "accepted_answer_id": 57278083, "answer_count": 1, "score": 1, "last_activity_date": 1564511963, "creation_date": 1564509637, "last_edit_date": 1564510643, "question_id": 57277522, "link": "https://stackoverflow.com/questions/57277522/type-errors-when-implementing-quadtree", "title": "Type Errors when implementing Quadtree", "body": "<p>Update:</p>\n\n<p>So this is my code:</p>\n\n<pre><code>quadtreeToPic :: Quadtree -&gt; Array (Int, Int) Word8\nquadtreeToPic (QNode x y w avg Q0)\n  | w == 1 = listArray (0,0) [avg]\n  | w == 2 = listArray (0,4) [avg, avg, avg, avg]\n\nquadtreeToPic (QNode x y w avg (Q4 q1 q2 q3 q4)) = listArray ((0,0), (w-1,w-1)) (concat (map quadtreeToPic [q1, q2, q3, q4])) \n</code></pre>\n\n<p>A <code>Quadtree</code> is either </p>\n\n<pre><code>QNode Int Int Int Word8 QKids\ndata QKids = Q0 | Q4 Quadtree Quadtree Quadtree Quadtree\n</code></pre>\n\n<p>The error I get is </p>\n\n<pre><code>Quadtree.hs:13:90: error:\n    \u2022 Couldn't match type \u2018Array (Int, Int) Word8\u2019 with \u2018[Word8]\u2019\n      Expected type: [[Word8]]\n        Actual type: [Array (Int, Int) Word8]\n    \u2022 In the first argument of \u2018concat\u2019, namely\n        \u2018(map quadtreeToPic [q1, q2, q3, q4])\u2019\n      In the second argument of \u2018listArray\u2019, namely\n        \u2018(concat (map quadtreeToPic [q1, q2, q3, q4]))\u2019\n      In the expression:\n        listArray\n          ((0, 0), (w - 1, w - 1))\n          (concat (map quadtreeToPic [q1, q2, q3, q4]))\n   |\n13 | quadtreeToPic (QNode x y w avg (Q4 q1 q2 q3 q4)) = listArray ((0,0), (w-1,w-1)) (concat (map quadtreeToPic [q1, q2, q3, q4])) \n   |                                                                                          ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n</code></pre>\n\n<p>How do I solve this? Why is <code>[[Word8]]</code> expected when by definition it should expect <code>Array (Int, Int) Word8</code>?</p>\n"}, {"tags": ["haskell"], "comments": [{"owner": {"reputation": 314794, "user_id": 67579, "user_type": "registered", "accept_rate": 81, "profile_image": "https://i.stack.imgur.com/BJXub.png?s=128&g=1", "display_name": "Willem Van Onsem", "link": "https://stackoverflow.com/users/67579/willem-van-onsem"}, "edited": false, "score": 2, "creation_date": 1564508474, "post_id": 57277240, "comment_id": 101051319, "body": "You need to add brackets around the <code>Q4</code> data constructor, so <code>quadtreeToPic QNode x y w avg (Q4 q1 q2 q3 q4) = ...</code>"}], "answers": [{"comments": [{"owner": {"reputation": 14927, "user_id": 2719875, "user_type": "registered", "accept_rate": 78, "profile_image": "https://www.gravatar.com/avatar/ae764a4524119ce0d93e7d8f0ee2356c?s=128&d=identicon&r=PG&f=1", "display_name": "user2719875", "link": "https://stackoverflow.com/users/2719875/user2719875"}, "edited": false, "score": 0, "creation_date": 1564509088, "post_id": 57277279, "comment_id": 101051538, "body": "I get the error <code>Quadtree.hs:13:85: error:     \u2022 Couldn&#39;t match type \u2018Array (Int, Int) Word8\u2019                      with \u2018[((Int, Int), Word8)]\u2019       Expected type: [[((Int, Int), Word8)]]         Actual type: [Array (Int, Int) Word8]     \u2022 In the first argument of \u2018concat\u2019, namely         \u2018(map quadtreeToPic [q1, q2, q3, q4])\u2019       In the second argument of \u2018array\u2019, namely         \u2018(concat (map quadtreeToPic [q1, q2, q3, q4]))\u2019       In the expression:         array           ((0, 0) (w - 1, w - 1))           (concat (map quadtreeToPic [q1, q2, q3, q4]))</code>"}, {"owner": {"reputation": 14927, "user_id": 2719875, "user_type": "registered", "accept_rate": 78, "profile_image": "https://www.gravatar.com/avatar/ae764a4524119ce0d93e7d8f0ee2356c?s=128&d=identicon&r=PG&f=1", "display_name": "user2719875", "link": "https://stackoverflow.com/users/2719875/user2719875"}, "edited": false, "score": 0, "creation_date": 1564509109, "post_id": 57277279, "comment_id": 101051544, "body": "after I make this fix. Any idea why?"}, {"owner": {"reputation": 314794, "user_id": 67579, "user_type": "registered", "accept_rate": 81, "profile_image": "https://i.stack.imgur.com/BJXub.png?s=128&g=1", "display_name": "Willem Van Onsem", "link": "https://stackoverflow.com/users/67579/willem-van-onsem"}, "reply_to_user": {"reputation": 14927, "user_id": 2719875, "user_type": "registered", "accept_rate": 78, "profile_image": "https://www.gravatar.com/avatar/ae764a4524119ce0d93e7d8f0ee2356c?s=128&d=identicon&r=PG&f=1", "display_name": "user2719875", "link": "https://stackoverflow.com/users/2719875/user2719875"}, "edited": false, "score": 0, "creation_date": 1564509177, "post_id": 57277279, "comment_id": 101051576, "body": "@user2719875: that&#39;s a type error: your <code>quadtreeToPic</code> is supposed to return <code>[((Int, Int), Word8)]]</code>s, but it returns <code>[Array (Int, Int) Word8]</code>?"}, {"owner": {"reputation": 14927, "user_id": 2719875, "user_type": "registered", "accept_rate": 78, "profile_image": "https://www.gravatar.com/avatar/ae764a4524119ce0d93e7d8f0ee2356c?s=128&d=identicon&r=PG&f=1", "display_name": "user2719875", "link": "https://stackoverflow.com/users/2719875/user2719875"}, "edited": false, "score": 0, "creation_date": 1564509818, "post_id": 57277279, "comment_id": 101051842, "body": "it looks like it&#39;s a different question altogether. I asked it here, if you can help: <a href=\"https://stackoverflow.com/questions/57277522/type-errors-when-implementing-quadtree\" title=\"type errors when implementing quadtree\">stackoverflow.com/questions/57277522/&hellip;</a>"}], "tags": [], "owner": {"reputation": 314794, "user_id": 67579, "user_type": "registered", "accept_rate": 81, "profile_image": "https://i.stack.imgur.com/BJXub.png?s=128&g=1", "display_name": "Willem Van Onsem", "link": "https://stackoverflow.com/users/67579/willem-van-onsem"}, "is_accepted": true, "score": 3, "last_activity_date": 1564508561, "creation_date": 1564508561, "answer_id": 57277279, "question_id": 57277240, "link": "https://stackoverflow.com/questions/57277240/parse-error-in-pattern-when-implementing-tree/57277279#57277279", "title": "&quot;Parse error in pattern&quot; when implementing tree", "body": "<p>The <code>Q4</code> dataconstructor and the parameters are a single parameter, here, so you need to add brackets <em>including</em> the <code>Q4</code> data constructor. For example:</p>\n\n<pre><code>quadtreeToPic QNode x y w avg <b>(Q4 q1 q2 q3 q4)</b> = ...</code></pre>\n\n<p>Note that you can use <a href=\"https://hackage.haskell.org/package/base-4.12.0.0/docs/Prelude.html#v:concatMap\" rel=\"nofollow noreferrer\"><strong><code>concatMap :: (a -&gt; [b]) -&gt; [a] -&gt; [b]</code></strong></a> here instead of <code>concat (map ...)</code>:</p>\n\n<pre><code>... <b>concatMap</b> quadtreeToPic [q1, q2, q3, q4]</code></pre>\n"}], "owner": {"reputation": 14927, "user_id": 2719875, "user_type": "registered", "accept_rate": 78, "profile_image": "https://www.gravatar.com/avatar/ae764a4524119ce0d93e7d8f0ee2356c?s=128&d=identicon&r=PG&f=1", "display_name": "user2719875", "link": "https://stackoverflow.com/users/2719875/user2719875"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 32, "favorite_count": 0, "accepted_answer_id": 57277279, "answer_count": 1, "score": 1, "last_activity_date": 1564508561, "creation_date": 1564508381, "question_id": 57277240, "link": "https://stackoverflow.com/questions/57277240/parse-error-in-pattern-when-implementing-tree", "title": "&quot;Parse error in pattern&quot; when implementing tree", "body": "<p>Here is my code</p>\n\n<pre><code>quadtreeToPic QNode x y w avg Q4(q1 q2 q3 q4) = array ((0,0) (w-1,w-1)) (concat (map quadtreeToPic [q1, q2, q3, q4])) \n</code></pre>\n\n<p>Basically, a <code>Quadtree</code> is <code>x y w avg QChildren</code> where <code>QChildren</code> is qither <code>Q0</code> or <code>Q4 Quadtree Quadtree Quadtree Quadtree</code>.</p>\n\n<p>When I do what I tried above, I get this error</p>\n\n<pre><code>Quadtree.hs:13:34: error: Parse error in pattern: q1\n   |\n13 | quadtreeToPic QNode x y w avg Q4(q1 q2 q3 q4) = array ((0,0) (w-1,w-1)) (concat (map quadtreeToPic [q1, q2, q3, q4])) \n   |                                  ^^^^^^^^^^^\n</code></pre>\n\n<p>Why is this?</p>\n"}, {"tags": ["haskell", "recursion", "traversal"], "comments": [{"owner": {"reputation": 314794, "user_id": 67579, "user_type": "registered", "accept_rate": 81, "profile_image": "https://i.stack.imgur.com/BJXub.png?s=128&g=1", "display_name": "Willem Van Onsem", "link": "https://stackoverflow.com/users/67579/willem-van-onsem"}, "edited": false, "score": 1, "creation_date": 1564485972, "post_id": 57270529, "comment_id": 101039153, "body": "This looks similar to the <i>subset sum</i> problem (and the bin packing problem). You need to use <i>dynamic programming</i> for this."}, {"owner": {"reputation": 999, "user_id": 8604871, "user_type": "registered", "accept_rate": 14, "profile_image": "https://www.gravatar.com/avatar/36382829e5be7f6da95308288d976949?s=128&d=identicon&r=PG&f=1", "display_name": "Madderote", "link": "https://stackoverflow.com/users/8604871/madderote"}, "reply_to_user": {"reputation": 314794, "user_id": 67579, "user_type": "registered", "accept_rate": 81, "profile_image": "https://i.stack.imgur.com/BJXub.png?s=128&g=1", "display_name": "Willem Van Onsem", "link": "https://stackoverflow.com/users/67579/willem-van-onsem"}, "edited": false, "score": 0, "creation_date": 1564486158, "post_id": 57270529, "comment_id": 101039255, "body": "@Willem: can you elaborate on that to get me on track? Searched for a similar problem, but could not really find something equal. Will look for &#39;subset sum&#39; problem then."}, {"owner": {"reputation": 314794, "user_id": 67579, "user_type": "registered", "accept_rate": 81, "profile_image": "https://i.stack.imgur.com/BJXub.png?s=128&g=1", "display_name": "Willem Van Onsem", "link": "https://stackoverflow.com/users/67579/willem-van-onsem"}, "edited": false, "score": 2, "creation_date": 1564486185, "post_id": 57270529, "comment_id": 101039275, "body": "see <a href=\"https://en.wikipedia.org/wiki/Subset_sum_problem\" rel=\"nofollow noreferrer\">en.wikipedia.org/wiki/Subset_sum_problem</a>"}, {"owner": {"reputation": 43134, "user_id": 1726343, "user_type": "registered", "accept_rate": 88, "profile_image": "https://www.gravatar.com/avatar/55744f355c4714fd473c50e799165a70?s=128&d=identicon&r=PG", "display_name": "Asad Saeeduddin", "link": "https://stackoverflow.com/users/1726343/asad-saeeduddin"}, "reply_to_user": {"reputation": 314794, "user_id": 67579, "user_type": "registered", "accept_rate": 81, "profile_image": "https://i.stack.imgur.com/BJXub.png?s=128&g=1", "display_name": "Willem Van Onsem", "link": "https://stackoverflow.com/users/67579/willem-van-onsem"}, "edited": false, "score": 1, "creation_date": 1564486553, "post_id": 57270529, "comment_id": 101039503, "body": "A naive approach would be to simply <code>filter</code> the result of applying <code>subsequences</code> to the input list in order to find the subsequences which sum to the specified value. A more optimal approach requires dynamic programming, as @WillemVanOnsem mentioned."}, {"owner": {"reputation": 999, "user_id": 8604871, "user_type": "registered", "accept_rate": 14, "profile_image": "https://www.gravatar.com/avatar/36382829e5be7f6da95308288d976949?s=128&d=identicon&r=PG&f=1", "display_name": "Madderote", "link": "https://stackoverflow.com/users/8604871/madderote"}, "reply_to_user": {"reputation": 314794, "user_id": 67579, "user_type": "registered", "accept_rate": 81, "profile_image": "https://i.stack.imgur.com/BJXub.png?s=128&g=1", "display_name": "Willem Van Onsem", "link": "https://stackoverflow.com/users/67579/willem-van-onsem"}, "edited": false, "score": 0, "creation_date": 1564487537, "post_id": 57270529, "comment_id": 101040056, "body": "@Willem, Asad: checked the Wiki and it looks similar. It also looked like a deceptively simple problem to me, but seems a lot more complicated..."}, {"owner": {"reputation": 100892, "user_id": 745903, "user_type": "registered", "accept_rate": 74, "profile_image": "https://www.gravatar.com/avatar/50933f6638836741e620669b3940410e?s=128&d=identicon&r=PG", "display_name": "leftaroundabout", "link": "https://stackoverflow.com/users/745903/leftaroundabout"}, "edited": false, "score": 5, "creation_date": 1564489548, "post_id": 57270529, "comment_id": 101041266, "body": "@Madderote well, it <i>is</i> simple to do this with brute-force, but the performance of this is very bad. That might still be ok for you, if you&#39;re only dealing with very small lists."}, {"owner": {"reputation": 100185, "user_id": 3234959, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/93bb12ca0f93dfddb33880316f7e66c2?s=128&d=identicon&r=PG&f=1", "display_name": "chi", "link": "https://stackoverflow.com/users/3234959/chi"}, "edited": false, "score": 2, "creation_date": 1564504014, "post_id": 57270529, "comment_id": 101050046, "body": "@Madderote It may look simple at first, but it turns out that checking if <code>max</code> can be reached is an NP complete problem (subset sum). So, we had theoretical computer scientists around the world trying to find efficient solutions to this (&amp; related problems) for 50 years, and a still unclaimed 1M$ prize for an efficient solution. Definitely not simple at all. For &quot;small&quot; lists, though, coding a slow brute force algorithm is feasible."}, {"owner": {"reputation": 999, "user_id": 8604871, "user_type": "registered", "accept_rate": 14, "profile_image": "https://www.gravatar.com/avatar/36382829e5be7f6da95308288d976949?s=128&d=identicon&r=PG&f=1", "display_name": "Madderote", "link": "https://stackoverflow.com/users/8604871/madderote"}, "reply_to_user": {"reputation": 100185, "user_id": 3234959, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/93bb12ca0f93dfddb33880316f7e66c2?s=128&d=identicon&r=PG&f=1", "display_name": "chi", "link": "https://stackoverflow.com/users/3234959/chi"}, "edited": false, "score": 1, "creation_date": 1564558981, "post_id": 57270529, "comment_id": 101066265, "body": "Thanks @Chi for the added context. Willem also put me in that direction. Found a brute-force way to do it but it is not elegant and way to slow for the dataset I need it for, so I&#39;&#39; side-track it and try to figure something more elegant. It is good to know that for once it isn&#39;t me that can&#39;t figure out a proper solution :)"}], "owner": {"reputation": 999, "user_id": 8604871, "user_type": "registered", "accept_rate": 14, "profile_image": "https://www.gravatar.com/avatar/36382829e5be7f6da95308288d976949?s=128&d=identicon&r=PG&f=1", "display_name": "Madderote", "link": "https://stackoverflow.com/users/8604871/madderote"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 112, "favorite_count": 0, "answer_count": 0, "score": 3, "last_activity_date": 1564486062, "creation_date": 1564485856, "last_edit_date": 1564486062, "question_id": 57270529, "link": "https://stackoverflow.com/questions/57270529/haskell-optimized-fill-of-max-value", "title": "haskell optimized fill of max value", "body": "<p>Started building some small real world stuff in Haskell for getting some routine. Need piece of code that takes a value-A (<code>max</code>) and a list of values <code>(x:xs)</code> that will return a list of values of which the sum equals or is lower than value-A. What I have now below, but this keeps fitting numbers until full. It will not return the most optimal sequence.</p>\n\n<pre><code>fill :: Int -&gt; [Int] -&gt; Int \nfill max (x:xs) = if x &lt; max then fill (max - x) xs else fill max xs\nfill max [] = max  \n</code></pre>\n\n<p>I think I would need to write a function that takes the first value of the list, traverses the rest of the list for the most optimal addition, add that to another list and keep doing that until the smallest remainder or a match with <code>max</code>. Guess might be simple for you but proven a tough nut to crack for me. </p>\n\n<p>Edit: if I sort the value list first, it's a little simpler it seems, since I can discard values that blow up <code>max</code></p>\n"}, {"tags": ["list", "haskell", "functional-programming"], "answers": [{"comments": [{"owner": {"reputation": 7817, "user_id": 7345298, "user_type": "registered", "accept_rate": 50, "profile_image": "https://www.gravatar.com/avatar/9477d048c5c29b16307b3356146d497a?s=128&d=identicon&r=PG&f=1", "display_name": "bradrn", "link": "https://stackoverflow.com/users/7345298/bradrn"}, "edited": false, "score": 5, "creation_date": 1564470876, "post_id": 57265749, "comment_id": 101031007, "body": "Might be worth mentioning <code>unlines</code> as an alternative to <code>intercalate &quot;\\n&quot;</code>."}, {"owner": {"reputation": 314794, "user_id": 67579, "user_type": "registered", "accept_rate": 81, "profile_image": "https://i.stack.imgur.com/BJXub.png?s=128&g=1", "display_name": "Willem Van Onsem", "link": "https://stackoverflow.com/users/67579/willem-van-onsem"}, "edited": false, "score": 2, "creation_date": 1564471031, "post_id": 57265749, "comment_id": 101031080, "body": "@bradm: <code>unlines</code> will add an extra <code>&#39;\\n&#39;</code> at the end. Although of course that is not per se a problem."}], "tags": [], "owner": {"reputation": 25321, "user_id": 163177, "user_type": "registered", "accept_rate": 86, "profile_image": "https://www.gravatar.com/avatar/e811b5337bcad19d52c8fed3a0ea0075?s=128&d=identicon&r=PG", "display_name": "John F. Miller", "link": "https://stackoverflow.com/users/163177/john-f-miller"}, "is_accepted": false, "score": 6, "last_activity_date": 1564468997, "creation_date": 1564468997, "answer_id": 57265749, "question_id": 57265317, "link": "https://stackoverflow.com/questions/57265317/haskell-flatten-lists-of-string/57265749#57265749", "title": "Haskell Flatten Lists of string", "body": "<p>The function you are looking for is called <a href=\"https://hackage.haskell.org/package/base-4.12.0.0/docs/Data-List.html#v:intercalate\" rel=\"noreferrer\"><code>intercalate</code></a> and it lives in <code>Data.List</code>. You will have to use it twice.  first to add a space between each word of the inner lists then again to add a <code>\\n</code> between the outer lists.  <code>fmap</code> is your friend.</p>\n"}, {"comments": [{"owner": {"reputation": 57219, "user_id": 33796, "user_type": "registered", "accept_rate": 70, "profile_image": "https://www.gravatar.com/avatar/08727b23ba62e634b32988cdff082663?s=128&d=identicon&r=PG", "display_name": "luqui", "link": "https://stackoverflow.com/users/33796/luqui"}, "edited": false, "score": 0, "creation_date": 1564472066, "post_id": 57266426, "comment_id": 101031543, "body": "How about <code>intercalate &quot;\\n&quot; . map (intercalate &quot; &quot;)</code> ?"}, {"owner": {"reputation": 14537, "user_id": 7128034, "user_type": "registered", "accept_rate": 85, "profile_image": "https://i.stack.imgur.com/T8aRg.jpg?s=128&g=1", "display_name": "Dami&#225;n Rafael Lattenero", "link": "https://stackoverflow.com/users/7128034/dami%c3%a1n-rafael-lattenero"}, "reply_to_user": {"reputation": 57219, "user_id": 33796, "user_type": "registered", "accept_rate": 70, "profile_image": "https://www.gravatar.com/avatar/08727b23ba62e634b32988cdff082663?s=128&d=identicon&r=PG", "display_name": "luqui", "link": "https://stackoverflow.com/users/33796/luqui"}, "edited": false, "score": 0, "creation_date": 1564472468, "post_id": 57266426, "comment_id": 101031733, "body": "@luqui sounds great, with that idea I updated the answer, forgot to mention you sorry"}], "tags": [], "owner": {"reputation": 14537, "user_id": 7128034, "user_type": "registered", "accept_rate": 85, "profile_image": "https://i.stack.imgur.com/T8aRg.jpg?s=128&g=1", "display_name": "Dami&#225;n Rafael Lattenero", "link": "https://stackoverflow.com/users/7128034/dami%c3%a1n-rafael-lattenero"}, "is_accepted": false, "score": 3, "last_activity_date": 1564472432, "last_edit_date": 1564472432, "creation_date": 1564471680, "answer_id": 57266426, "question_id": 57265317, "link": "https://stackoverflow.com/questions/57265317/haskell-flatten-lists-of-string/57266426#57266426", "title": "Haskell Flatten Lists of string", "body": "<p>Combining the answer of @John F Miller, you just have to do intercalate and add the element you need, and use concatMap:</p>\n\n<pre><code>import Data.List\n\nls = [[\"My\",\"Name\",\"is\"],[\"John\",\"Doe\"]]\n\nrs = concatMap (intercalate \" \") (insertAt 1 [\"\\n\"] ls)\n\ninsertAt _ _ []     = []\ninsertAt 0 e xs     = e:xs\ninsertAt n e (x:xs) = x : (insertAt (n-1) e xs)\n\n\nmain = do\n  putStrLn rs\n\n$&gt; My Name is\n   John Doe\n</code></pre>\n\n<p>Another option in the comment by @luqui, but I would think in:</p>\n\n<pre><code>rs = intercalate \" \" . intercalate [\"\\n\"] $ ls\n</code></pre>\n"}, {"comments": [{"owner": {"reputation": 34864, "user_id": 237428, "user_type": "registered", "accept_rate": 78, "profile_image": "https://i.stack.imgur.com/ThNhZ.jpg?s=128&g=1", "display_name": "Antal Spector-Zabusky", "link": "https://stackoverflow.com/users/237428/antal-spector-zabusky"}, "edited": false, "score": 0, "creation_date": 1564588666, "post_id": 57266587, "comment_id": 101083802, "body": "Also, if you want/can tolerate an extra <code>&quot;\\n&quot;</code> at the end, you can replace <code>intercalate &quot;\\n&quot;</code> with <code>unlines</code>"}], "tags": [], "owner": {"reputation": 314794, "user_id": 67579, "user_type": "registered", "accept_rate": 81, "profile_image": "https://i.stack.imgur.com/BJXub.png?s=128&g=1", "display_name": "Willem Van Onsem", "link": "https://stackoverflow.com/users/67579/willem-van-onsem"}, "is_accepted": true, "score": 8, "last_activity_date": 1564472309, "creation_date": 1564472309, "answer_id": 57266587, "question_id": 57265317, "link": "https://stackoverflow.com/questions/57265317/haskell-flatten-lists-of-string/57266587#57266587", "title": "Haskell Flatten Lists of string", "body": "<p>You can use <a href=\"https://hackage.haskell.org/package/base-4.12.0.0/docs/Prelude.html#v:unwords\" rel=\"noreferrer\"><strong><code>unwords :: [String] -&gt; String</code></strong></a> to convert a list of <code>String</code>s into a single <code>String</code>, and then use <a href=\"https://hackage.haskell.org/package/base-4.12.0.0/docs/Data-List.html#v:intercalate\" rel=\"noreferrer\"><strong><code>intercalate :: [a] -&gt; [[a]] -&gt; [a]</code></strong></a> to join the lines together with a separator in between, like:</p>\n\n<pre><code>tolines :: [[String]] -&gt; String\ntolines = intercalate \"\\n\" . map unwords</code></pre>\n"}], "owner": {"reputation": 107, "user_id": 8323023, "user_type": "registered", "accept_rate": 57, "profile_image": "https://www.gravatar.com/avatar/099456fafb1d1821b2f8fa482f359a1e?s=128&d=identicon&r=PG&f=1", "display_name": "Rahmat", "link": "https://stackoverflow.com/users/8323023/rahmat"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 805, "favorite_count": 0, "accepted_answer_id": 57266587, "answer_count": 3, "score": 5, "last_activity_date": 1572883293, "creation_date": 1564467109, "last_edit_date": 1572883293, "question_id": 57265317, "link": "https://stackoverflow.com/questions/57265317/haskell-flatten-lists-of-string", "title": "Haskell Flatten Lists of string", "body": "<p>I want to flatten lists of string but with additional requirements. example</p>\n\n<p><code>[[\"My\",\"Name\",\"is\"],[\"John\",\"Doe\"]]</code></p>\n\n<p>output :\n<code>My name is \\nJohn Doe</code></p>\n\n<p>I try using concat function, but still no luck</p>\n\n<p>thanks</p>\n"}, {"tags": ["haskell", "functor", "traversable", "foldable"], "answers": [{"comments": [{"owner": {"reputation": 44013, "user_id": 1477667, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/trgKM.jpg?s=128&g=1", "display_name": "dfeuer", "link": "https://stackoverflow.com/users/1477667/dfeuer"}, "edited": false, "score": 0, "creation_date": 1564580457, "post_id": 57264185, "comment_id": 101078620, "body": "What makes <code>Const</code> too magical? Yeah, the implementation of <code>foldMapDefault</code> is full of coercion magic, but that&#39;s not essential."}, {"owner": {"reputation": 126897, "user_id": 791604, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/ce991df7a056248d5e4f6fc3659ba733?s=128&d=identicon&r=PG", "display_name": "Daniel Wagner", "link": "https://stackoverflow.com/users/791604/daniel-wagner"}, "reply_to_user": {"reputation": 44013, "user_id": 1477667, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/trgKM.jpg?s=128&g=1", "display_name": "dfeuer", "link": "https://stackoverflow.com/users/1477667/dfeuer"}, "edited": false, "score": 4, "creation_date": 1564580659, "post_id": 57264185, "comment_id": 101078780, "body": "@dfeuer My judgment, based on this user&#39;s other questions, is that a good answer for this user should introduce one and only one new idea at a time. Turning a traversal into a fold is already that one idea. I can only hope that the writer monad was not a second idea already, let alone the less complicated but also less popular <code>Const</code> applicative."}], "tags": [], "owner": {"reputation": 126897, "user_id": 791604, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/ce991df7a056248d5e4f6fc3659ba733?s=128&d=identicon&r=PG", "display_name": "Daniel Wagner", "link": "https://stackoverflow.com/users/791604/daniel-wagner"}, "is_accepted": false, "score": 13, "last_activity_date": 1564459959, "creation_date": 1564459959, "answer_id": 57264185, "question_id": 57264117, "link": "https://stackoverflow.com/questions/57264117/how-does-traversable-use-the-fact-that-it-subclasses-both-foldable-and-functor/57264185#57264185", "title": "How does Traversable use the fact that it subclasses both Foldable and Functor?", "body": "<p>The <code>Foldable</code> instance is not used. Nevertheless, it is fine to demand <code>Foldable</code>, since if we can <code>traverse</code> a thing, then we can <code>foldMap</code> it:</p>\n\n<pre><code>foldMapDefault :: (Traversable t, Monoid m) =&gt; (a -&gt; m) -&gt; t a -&gt; m\nfoldMapDefault f = fst . traverse (\\a -&gt; (f a, ()))\n</code></pre>\n\n<p>The basic idea here is to use the standard writer monad; since the bind operation for the writer uses <code>mappend</code> to combine the \"written\" part -- here, the <code>f a</code> values -- <code>traverse</code> will <code>mappend</code> together just the right things. (It will also build up a <code>t ()</code> that we don't actually care about; throwing away that part is the job of <code>fst</code>.)</p>\n\n<p>For simplicity and self-containment, I've used the writer monad, but the true implementation uses the slightly mind-bending <code>Const</code> applicative to avoid building (and then throwing away) the uninteresting <code>t ()</code> value. You may see the documentation of <code>foldMapDefault</code> <a href=\"https://hackage.haskell.org/package/base-4.12.0.0/docs/Data-Traversable.html#v:foldMapDefault\" rel=\"noreferrer\">here</a> and its implementation <a href=\"https://hackage.haskell.org/package/base-4.12.0.0/docs/src/Data.Traversable.html#foldMapDefault\" rel=\"noreferrer\">here</a>.</p>\n"}, {"tags": [], "owner": {"reputation": 14537, "user_id": 7128034, "user_type": "registered", "accept_rate": 85, "profile_image": "https://i.stack.imgur.com/T8aRg.jpg?s=128&g=1", "display_name": "Dami&#225;n Rafael Lattenero", "link": "https://stackoverflow.com/users/7128034/dami%c3%a1n-rafael-lattenero"}, "is_accepted": false, "score": 4, "last_activity_date": 1564760387, "last_edit_date": 1564760387, "creation_date": 1564460208, "answer_id": 57264218, "question_id": 57264117, "link": "https://stackoverflow.com/questions/57264117/how-does-traversable-use-the-fact-that-it-subclasses-both-foldable-and-functor/57264218#57264218", "title": "How does Traversable use the fact that it subclasses both Foldable and Functor?", "body": "<p>From <a href=\"https://hackage.haskell.org/package/base-4.12.0.0/docs/Prelude.html#t:Traversable\" rel=\"nofollow noreferrer\">here</a>, class <code>Traversable</code> is a <code>Functor</code> and a <code>Foldable</code>, and must satisfy the laws:</p>\n\n<p>And <code>Foldable</code> see more <a href=\"https://hackage.haskell.org/package/base-4.12.0.0/docs/Prelude.html#t:Foldable\" rel=\"nofollow noreferrer\">here</a>. That means that it can be folded (foldMap, foldr, foldl...)</p>\n\n<p><code>traverse</code> function must satisfy the laws:</p>\n\n<ul>\n<li><p>naturality: </p>\n\n<p>t . traverse f = traverse (t . f) for every applicative transformation t</p></li>\n<li><p>identity</p>\n\n<p>traverse Identity = Identity</p></li>\n<li><p>composition</p>\n\n<p>traverse (Compose . fmap g . f) = Compose . fmap (traverse g) . traverse f</p></li>\n</ul>\n\n<p>and sequenceA:</p>\n\n<ul>\n<li><p>naturality</p>\n\n<p>t . sequenceA = sequenceA . fmap t for every applicative transformation t</p></li>\n<li><p>identity</p>\n\n<p>sequenceA . fmap Identity = Identity</p></li>\n<li><p>composition</p>\n\n<p>sequenceA . fmap Compose = Compose . fmap sequenceA . sequenceA</p></li>\n</ul>\n\n<blockquote>\n  <p>Which fact does sequenceA use: t being a Functor type, t being a Foldable type, or both?</p>\n</blockquote>\n\n<p><code>Traversable</code>, as its definition says (and the laws quoted above):</p>\n\n<pre><code>class (Functor t, Foldable t) =&gt; Traversable t where\n</code></pre>\n\n<p>is both, a <code>Functor</code> and a Foldable, by the laws it has to obey, it is not only a <code>Functor</code>, is more specific than a <code>Functor</code> (but still a Functor because satisfies the laws of Functor and can use the functions of its typeclass interface), and even more specific than <code>Foldable</code>, hence powerful, less general, with more constraints.</p>\n\n<p>And what's the fact? The definition, but why the designer of <code>Traversable</code> choose those two? Because is useful, as you can see in @Daniel Wagner answer. Other examples:</p>\n\n<pre><code>instance Traversable [] where\n    traverse f = List.foldr cons_f (pure [])\n      where cons_f x ys = liftA2 (:) (f x) ys\n</code></pre>\n\n<p>this one uses <code>foldr</code></p>\n\n<pre><code>instance Foldable [] where\n    elem    = List.elem\n    foldl   = List.foldl\n    foldl'  = List.foldl'\n    foldl1  = List.foldl1\n    foldr   = List.foldr\n    foldr1  = List.foldr1\n    length  = List.length\n    maximum = List.maximum\n    minimum = List.minimum\n    null    = List.null\n    product = List.product\n    sum     = List.sum\n    toList  = id\n</code></pre>\n\n<p>So, <code>Traverse</code> is a <code>Functor</code> and a <code>Foldable</code> so you could use the functions of its interface when needed. (as in the example, is just an example not a justification of why the designer chooses to define <code>Traversable</code> with <code>Functor</code> and <code>Foldable</code>), is because is useful.</p>\n"}, {"comments": [{"owner": {"reputation": 44013, "user_id": 1477667, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/trgKM.jpg?s=128&g=1", "display_name": "dfeuer", "link": "https://stackoverflow.com/users/1477667/dfeuer"}, "edited": false, "score": 1, "creation_date": 1564515260, "post_id": 57271583, "comment_id": 101054341, "body": "There are definitely other reasons for superclasses. <code>Num</code> is a superclass of <code>Integral</code> because it doesn&#39;t make sense for something to be integral if it&#39;s not a number. <code>Semigroup</code> is (now) a superclass of <code>Monoid</code> because a monoid is a semigroup with an identity element (mathematically)."}, {"owner": {"reputation": 126897, "user_id": 791604, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/ce991df7a056248d5e4f6fc3659ba733?s=128&d=identicon&r=PG", "display_name": "Daniel Wagner", "link": "https://stackoverflow.com/users/791604/daniel-wagner"}, "reply_to_user": {"reputation": 44013, "user_id": 1477667, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/trgKM.jpg?s=128&g=1", "display_name": "dfeuer", "link": "https://stackoverflow.com/users/1477667/dfeuer"}, "edited": false, "score": 0, "creation_date": 1564591213, "post_id": 57271583, "comment_id": 101085100, "body": "@dfeuer The semigroup-monoid relation arguably falls under point (2) here."}, {"owner": {"reputation": 44013, "user_id": 1477667, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/trgKM.jpg?s=128&g=1", "display_name": "dfeuer", "link": "https://stackoverflow.com/users/1477667/dfeuer"}, "reply_to_user": {"reputation": 126897, "user_id": 791604, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/ce991df7a056248d5e4f6fc3659ba733?s=128&d=identicon&r=PG", "display_name": "Daniel Wagner", "link": "https://stackoverflow.com/users/791604/daniel-wagner"}, "edited": false, "score": 0, "creation_date": 1564599046, "post_id": 57271583, "comment_id": 101088487, "body": "@DanielWagner, that&#39;s purely a historical accident."}], "tags": [], "owner": {"reputation": 42360, "user_id": 389146, "user_type": "registered", "accept_rate": 25, "profile_image": "https://i.stack.imgur.com/zGYUq.jpg?s=128&g=1", "display_name": "Karl Bielefeldt", "link": "https://stackoverflow.com/users/389146/karl-bielefeldt"}, "is_accepted": false, "score": 4, "last_activity_date": 1564489365, "creation_date": 1564489365, "answer_id": 57271583, "question_id": 57264117, "link": "https://stackoverflow.com/questions/57264117/how-does-traversable-use-the-fact-that-it-subclasses-both-foldable-and-functor/57271583#57271583", "title": "How does Traversable use the fact that it subclasses both Foldable and Functor?", "body": "<p>There are two main reasons for subclassing in general:</p>\n\n<ol>\n<li><p>You need the class to make your definition work, or at least it makes the implementation so much more clear that it doesn't really make sense to leave it out. This is the case here for <code>Functor</code>. </p></li>\n<li><p>You can derive the other class for free from the parts you already have for your main definition, so you may as well declare it.  This is the case here for <code>Foldable</code>.</p></li>\n</ol>\n"}], "owner": {"reputation": 1, "user_id": 156458, "user_type": "registered", "accept_rate": 47, "profile_image": "https://i.stack.imgur.com/3PCjR.png?s=128&g=1", "display_name": "Tim", "link": "https://stackoverflow.com/users/156458/tim"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 339, "favorite_count": 1, "answer_count": 3, "score": 10, "last_activity_date": 1573747323, "creation_date": 1564459296, "last_edit_date": 1573747323, "question_id": 57264117, "link": "https://stackoverflow.com/questions/57264117/how-does-traversable-use-the-fact-that-it-subclasses-both-foldable-and-functor", "title": "How does Traversable use the fact that it subclasses both Foldable and Functor?", "body": "<pre><code>class (Functor t, Foldable t) =&gt; Traversable t where\n\n    traverse :: Applicative f =&gt; (a -&gt; f b) -&gt; t a -&gt; f (t b)\n    traverse g = sequenceA . fmap g\n\n    sequenceA :: Applicative f =&gt; t (f a) -&gt; f (t a)\n    sequenceA = traverse id\n</code></pre>\n\n<p>How does <code>Traversable</code> use the fact that it subclasses both <code>Foldable</code> and <code>Functor</code>?</p>\n\n<p><code>t</code> being a traversable type implies <code>t</code> is also a functor type and a foldable type.</p>\n\n<p>I see that the fact that <code>t</code> is a functor type, i.e. <code>fmap</code> , is used  in <code>traverse</code>.</p>\n\n<p>Is the fact that <code>t</code> is a foldable type used somewhere?</p>\n\n<p>Does <code>traverse</code> use the fact that <code>t</code> is a foldable type?</p>\n\n<p>Which fact does <code>sequenceA</code> use: <code>t</code> being a functor type, <code>t</code> being a foldable type, or both?</p>\n\n<p>Can we define a class which is a subclass of <code>Functor</code> only and has both <code>traverse</code> and <code>sequenceA</code> functions defined in the same way?</p>\n\n<p>Thanks.</p>\n"}, {"tags": ["haskell", "opengl", "glut", "opengl-compat"], "comments": [{"owner": {"reputation": 47449, "user_id": 44729, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/tyWaU.png?s=128&g=1", "display_name": "genpfault", "link": "https://stackoverflow.com/users/44729/genpfault"}, "edited": false, "score": 1, "creation_date": 1564454039, "post_id": 57263186, "comment_id": 101026134, "body": "Anything change if you flip the sphere inside-out using <code>glScalef(-1, -1, -1)</code>?  Probably have to do <code>glFrontFace(GL_CW)</code> too since the negative scale will flip all the triangle/quad windings."}, {"owner": {"reputation": 2567, "user_id": 994206, "user_type": "registered", "accept_rate": 84, "profile_image": "https://www.gravatar.com/avatar/699bacad8f85a069dda312cc29e03baa?s=128&d=identicon&r=PG", "display_name": "Mokosha", "link": "https://stackoverflow.com/users/994206/mokosha"}, "edited": false, "score": 2, "creation_date": 1564465486, "post_id": 57263186, "comment_id": 101028741, "body": "This might be due to the far-plane of your camera clipping the geometry, too."}, {"owner": {"reputation": 41485, "user_id": 2521214, "user_type": "registered", "accept_rate": 71, "profile_image": "https://i.stack.imgur.com/nd58V.jpg?s=128&g=1", "display_name": "Spektre", "link": "https://stackoverflow.com/users/2521214/spektre"}, "edited": false, "score": 1, "creation_date": 1564465736, "post_id": 57263186, "comment_id": 101028823, "body": "if you mean by inside your sphere  underground than turn off <code>GL_CULL_FACE</code> otherwise its znear plane clipping. Also take a look at this: <a href=\"https://stackoverflow.com/a/28020934/2521214\">Is it possible to make realistic n-body solar system simulation in matter of size and mass?</a> and sublinks in there they cover all of the sub-tasks you will encounter ... This <a href=\"https://stackoverflow.com/a/31804515/2521214\">Applying map of the earth texture a Sphere</a> might help a bit too"}, {"owner": {"reputation": 41485, "user_id": 2521214, "user_type": "registered", "accept_rate": 71, "profile_image": "https://i.stack.imgur.com/nd58V.jpg?s=128&g=1", "display_name": "Spektre", "link": "https://stackoverflow.com/users/2521214/spektre"}, "reply_to_user": {"reputation": 2567, "user_id": 994206, "user_type": "registered", "accept_rate": 84, "profile_image": "https://www.gravatar.com/avatar/699bacad8f85a069dda312cc29e03baa?s=128&d=identicon&r=PG", "display_name": "Mokosha", "link": "https://stackoverflow.com/users/994206/mokosha"}, "edited": false, "score": 1, "creation_date": 1564466094, "post_id": 57263186, "comment_id": 101028933, "body": "@Mokosha sounds more like znear clipping (problem starts when getting close)"}, {"owner": {"reputation": 41485, "user_id": 2521214, "user_type": "registered", "accept_rate": 71, "profile_image": "https://i.stack.imgur.com/nd58V.jpg?s=128&g=1", "display_name": "Spektre", "link": "https://stackoverflow.com/users/2521214/spektre"}, "edited": false, "score": 1, "creation_date": 1564466389, "post_id": 57263186, "comment_id": 101029043, "body": "btw I am using these <a href=\"https://svs.gsfc.nasa.gov/cgi-bin/details.cgi?aid=3895\" rel=\"nofollow noreferrer\">Deep Star Maps</a> + Hipparcos/BSC"}, {"owner": {"reputation": 1664, "user_id": 2649079, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/b41a2c9d80a4b8917940e65858c9abc0?s=128&d=identicon&r=PG", "display_name": "Nadir", "link": "https://stackoverflow.com/users/2649079/nadir"}, "edited": false, "score": 0, "creation_date": 1564473957, "post_id": 57263186, "comment_id": 101032521, "body": "Use a vertex shader to set the <code>gl_FragDepth</code> to something like 0.99 so it is always rendered, but behind everything else viewable within the frustrum"}, {"owner": {"reputation": 100892, "user_id": 745903, "user_type": "registered", "accept_rate": 74, "profile_image": "https://www.gravatar.com/avatar/50933f6638836741e620669b3940410e?s=128&d=identicon&r=PG", "display_name": "leftaroundabout", "link": "https://stackoverflow.com/users/745903/leftaroundabout"}, "edited": false, "score": 2, "creation_date": 1564490483, "post_id": 57263186, "comment_id": 101041854, "body": "How about posting a <a href=\"https://stackoverflow.com/help/minimal-reproducible-example\">minimal reproducible example</a>?"}], "owner": {"reputation": 532, "user_id": 660339, "user_type": "registered", "accept_rate": 40, "profile_image": "https://www.gravatar.com/avatar/ba401042a68ed65c16f73c8cf3a15287?s=128&d=identicon&r=PG", "display_name": "Ivan Perez", "link": "https://stackoverflow.com/users/660339/ivan-perez"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 117, "favorite_count": 1, "answer_count": 0, "score": 1, "last_activity_date": 1564453801, "creation_date": 1564449952, "last_edit_date": 1564453801, "question_id": 57263186, "link": "https://stackoverflow.com/questions/57263186/rendering-celestial-sphere-in-opengl", "title": "Rendering celestial sphere in OpenGL", "body": "<p>I'm trying to draw the celestial sphere in OpenGL, from the inside (from the perspective of the solar system). I want to be able to turn the camera around and see the stars in the milky way.</p>\n\n<p>I'm using OpenGL 3 (and Glut) because that's well supported in Haskell. I'm using textures, because that seems simple enough for my purposes. I'm not trying to make it incredibly accurate, or spend too much time on it. I'm using this image as texture: <a href=\"https://www.eso.org/public/images/eso0932a/\" rel=\"nofollow noreferrer\">https://www.eso.org/public/images/eso0932a/</a></p>\n\n<p>My gist of my code is as follows:</p>\n\n<pre><code>render tex i = do\n  -- Clear background\n  ...            \n\n  -- paint sphere\n  GL.matrixMode $= GL.Modelview 0                                               \n  GL.loadIdentity                                                               \n  GL.texture GL.Texture2D $= GL.Enabled                                         \n  GL.textureBinding Texture2D $= Just tex                                       \n  GL.rotate (90+i) (Vector3 0.0 1.0 (0.0 :: GLfloat)) -- turn image around\n                                                      -- just because\n  GL.rotate 90 (Vector3 1.0 0.0 (0.0 :: GLfloat))     -- turn image sideways\n                                                      -- to align with ecliptic                          \n  GL.preservingMatrix $                                                     \n    Quad.renderQuadric myStyle sphere                                           \n\n  GLUT.swapBuffers                                                              \n  GL.texture GL.Texture2D $= GL.Disabled                                        \n  render tex (i+0.04)\n</code></pre>\n\n<p>Something is drawn if the sphere is small (e.g., 1 unit, whatever that means): it looks like it's just another celestial body. But if I start making it bigger, so that the viewer is inside it, then a hole opens in the middle and it eventually disappears. All I see is the background.</p>\n\n<p>I'd like to see the inside of the sphere.</p>\n\n<p>What am I doing wrong?</p>\n"}, {"tags": ["string", "haskell", "unicode"], "answers": [{"comments": [{"owner": {"reputation": 7873, "user_id": 2225104, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/195de66794c596e35bc145c80e9f5515?s=128&d=identicon&r=PG", "display_name": "BitTickler", "link": "https://stackoverflow.com/users/2225104/bittickler"}, "edited": false, "score": 1, "creation_date": 1564450317, "post_id": 57263206, "comment_id": 101025470, "body": "Is <code>Char</code> not 16 bit? With something like UTF16 there is still the code point and multi &quot;word&quot; issue. But I like your idea - I could go for a <code>Data.Vector.Unbox.Vector Word32</code> and be done with just a few conversion functions..."}, {"owner": {"reputation": 44013, "user_id": 1477667, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/trgKM.jpg?s=128&g=1", "display_name": "dfeuer", "link": "https://stackoverflow.com/users/1477667/dfeuer"}, "reply_to_user": {"reputation": 7873, "user_id": 2225104, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/195de66794c596e35bc145c80e9f5515?s=128&d=identicon&r=PG", "display_name": "BitTickler", "link": "https://stackoverflow.com/users/2225104/bittickler"}, "edited": false, "score": 5, "creation_date": 1564450608, "post_id": 57263206, "comment_id": 101025525, "body": "@BitTickler, no, <code>Char</code> is a full code point, stored as 32 bits."}], "tags": [], "owner": {"reputation": 24509, "user_id": 6863749, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/UyoQv.jpg?s=128&g=1", "display_name": "Li-yao Xia", "link": "https://stackoverflow.com/users/6863749/li-yao-xia"}, "is_accepted": true, "score": 8, "last_activity_date": 1564450135, "creation_date": 1564450135, "answer_id": 57263206, "question_id": 57263083, "link": "https://stackoverflow.com/questions/57263083/which-haskell-string-type-to-use-for-unicode-data-when-fast-o1-indexing-is-r/57263206#57263206", "title": "Which Haskell string type to use for Unicode data when fast (O(1)) indexing is required?", "body": "<p>That sounds just like an array of <code>Char</code>: <code>Data.Vector.Unbox.Vector Char</code>.</p>\n\n<p><a href=\"https://hackage.haskell.org/package/vector-0.12.0.3/docs/Data-Vector-Unboxed.html\" rel=\"noreferrer\">https://hackage.haskell.org/package/vector-0.12.0.3/docs/Data-Vector-Unboxed.html</a></p>\n"}], "owner": {"reputation": 7873, "user_id": 2225104, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/195de66794c596e35bc145c80e9f5515?s=128&d=identicon&r=PG", "display_name": "BitTickler", "link": "https://stackoverflow.com/users/2225104/bittickler"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 80, "favorite_count": 0, "accepted_answer_id": 57263206, "answer_count": 1, "score": 5, "last_activity_date": 1564450135, "creation_date": 1564449002, "question_id": 57263083, "link": "https://stackoverflow.com/questions/57263083/which-haskell-string-type-to-use-for-unicode-data-when-fast-o1-indexing-is-r", "title": "Which Haskell string type to use for Unicode data when fast (O(1)) indexing is required?", "body": "<p>After reading about all 5 (<code>String, Text, Text.Lazy, ByteString, ByteString.Lazy</code>) commonly used types for strings in Haskell I am rather at the end of my wits:</p>\n\n<p>What I need is a String type which is immutable (I read it once from a file and never change it), with fast indexing (O(1)) and which can be consumed by code point, rather than by potentially incomplete bytes, which form a code point.</p>\n\n<p>I could live with a <code>Data.ByteString.UTF32</code>, actually, as with that representation, I would not need to be careful about multi byte encoding ever again.</p>\n\n<p>Will I have to write myself such a module or - by any chance - did someone else come to the same conclusion and did it already? </p>\n"}, {"tags": ["haskell", "fold", "foldable"], "comments": [{"owner": {"reputation": 507143, "user_id": 1048572, "user_type": "registered", "accept_rate": 77, "profile_image": "https://www.gravatar.com/avatar/7f2c4de95e8f4f8f5a71c3aaf0ed312a?s=128&d=identicon&r=PG", "display_name": "Bergi", "link": "https://stackoverflow.com/users/1048572/bergi"}, "edited": false, "score": 6, "creation_date": 1564436545, "post_id": 57260253, "comment_id": 101022633, "body": "<a href=\"https://wiki.haskell.org/Foldl_as_foldr\" rel=\"nofollow noreferrer\">wiki.haskell.org/Foldl_as_foldr</a>"}], "answers": [{"tags": [], "owner": {"reputation": 14537, "user_id": 7128034, "user_type": "registered", "accept_rate": 85, "profile_image": "https://i.stack.imgur.com/T8aRg.jpg?s=128&g=1", "display_name": "Dami&#225;n Rafael Lattenero", "link": "https://stackoverflow.com/users/7128034/dami%c3%a1n-rafael-lattenero"}, "is_accepted": false, "score": 1, "last_activity_date": 1564584359, "last_edit_date": 1564584359, "creation_date": 1564428962, "answer_id": 57260390, "question_id": 57260253, "link": "https://stackoverflow.com/questions/57260253/can-foldr-and-foldl-be-defined-in-terms-of-each-other/57260390#57260390", "title": "Can `foldr` and `foldl` be defined in terms of each other?", "body": "<blockquote>\n  <p>Edit 2:</p>\n</blockquote>\n\n<p>There is another way also that satisfy (based on <a href=\"http://www.cs.nott.ac.uk/~pszgmh/fold.pdf\" rel=\"nofollow noreferrer\">this article</a>) for <code>foldl</code>:</p>\n\n<pre><code>foldl f a list = (foldr construct (\\acc -&gt; acc) list) a\n  where\n    construct x r = \\acc -&gt; r (f acc x)\n</code></pre>\n\n<blockquote>\n  <p>Edit 1</p>\n</blockquote>\n\n<p>Flipping the arguments of the function will not create a same foldr/foldl, meaning this examples does not satisfy the equality of foldr-foldl:</p>\n\n<pre><code>foldr :: Foldable t =&gt; (a -&gt; b -&gt; b) -&gt; b -&gt; t a -&gt; b\n</code></pre>\n\n<p>and <code>foldl</code> in terms of foldr:</p>\n\n<pre><code>foldl' :: Foldable t =&gt; (b -&gt; a -&gt; b) -&gt; b -&gt; t a -&gt; b\nfoldl' f b = foldr (flip f) b \n</code></pre>\n\n<p>and <code>foldr</code>:</p>\n\n<pre><code>foldr' :: Foldable t =&gt; (a -&gt; b -&gt; b) -&gt; b -&gt; t a -&gt; b\nfoldr' f b = foldl (flip f) b \n</code></pre>\n\n<p>The converse is not true, since foldr may work on infinite lists, which foldl variants never can do. However, for finite lists, foldr can also be written in terms of foldl although losing laziness in the process. (for more check <a href=\"https://wiki.haskell.org/Foldl_as_foldr\" rel=\"nofollow noreferrer\">here</a>)</p>\n\n<p>Ando also not satisfy this examples:</p>\n\n<pre><code>foldr (-) 2 [8,10] = 8 - (10 - 2) == 0\n\nfoldl (flip (-)) 2 [8,10] = (flip (-) (flip (-) 2 8) 10) == 4\n</code></pre>\n"}, {"comments": [{"owner": {"reputation": 44013, "user_id": 1477667, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/trgKM.jpg?s=128&g=1", "display_name": "dfeuer", "link": "https://stackoverflow.com/users/1477667/dfeuer"}, "edited": false, "score": 0, "creation_date": 1564589823, "post_id": 57261231, "comment_id": 101084427, "body": "Since <code>foldl&#39;</code> and <code>foldr&#39;</code> are real methods that do something <i>different</i>, maybe it would be better to rename those?"}], "tags": [], "owner": {"reputation": 22091, "user_id": 5684257, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/ea5090cde8ea066a1fda67ed52dd5084?s=128&d=identicon&r=PG&f=1", "display_name": "HTNW", "link": "https://stackoverflow.com/users/5684257/htnw"}, "is_accepted": false, "score": 6, "last_activity_date": 1564434566, "last_edit_date": 1564434566, "creation_date": 1564433548, "answer_id": 57261231, "question_id": 57260253, "link": "https://stackoverflow.com/questions/57260253/can-foldr-and-foldl-be-defined-in-terms-of-each-other/57261231#57261231", "title": "Can `foldr` and `foldl` be defined in terms of each other?", "body": "<p>In general, <em>neither</em> <code>foldr</code> nor <code>foldl</code> can be implemented in terms of each other. The core operation of <code>Foldable</code> is <code>foldMap</code>, from which all the other operations may be derived. Neither <code>foldr</code> nor <code>foldl</code> are enough. However, the difference only shines through in the case of infinite or (partially) undefined structures, so there's a tendency to gloss over this fact.</p>\n\n<p>@DamianLattenero has shown the \"implementations\" of <code>foldl</code> and <code>foldr</code> in terms of one another:</p>\n\n<pre><code>foldl' c = foldr (flip c)\nfoldr' c = foldl (flip c)\n</code></pre>\n\n<p>But they do not always have the correct behavior. Consider lists. Then, <code>foldr (:) [] xs = xs</code> for all <code>xs :: [a]</code>. However, <code>foldr' (:) [] /= xs</code> for all <code>xs</code>, because <code>foldr' (:) [] xs = foldl (flip (:)) n xs</code>, and <code>foldl</code> (in the case of lists) has to walk the entire spine of the list before it can produce an output. But, if <code>xs</code> is infinite, <code>foldl</code> <em>can't</em> walk the entire infinite list, so <code>foldr' (:) [] xs</code> loops forever for infinite <code>xs</code>, while <code>foldr (:) [] xs</code> just produces <code>xs</code>. <code>foldl' = foldl</code> as desired, however. Essentially, for <code>[]</code>, <code>foldr</code> is \"natural\" and <code>foldl</code> is \"unnatural\". Implementing <code>foldl</code> with <code>foldr</code> works because you're just losing \"naturalness\", but implementing <code>foldr</code> in terms of <code>foldl</code> doesn't work, because you cannot recover that \"natural\" behavior.</p>\n\n<p>On the flipside, consider</p>\n\n<pre><code>data Tsil a = Lin | Snoc (Tsil a) a\n-- backwards version of data [a] = [] | (:) a [a]\n</code></pre>\n\n<p>In this case, <code>foldl</code> is natural:</p>\n\n<pre><code>foldl c n Lin = n\nfoldl c n (Snoc xs x) = c (foldl c n xs) x\n</code></pre>\n\n<p>And <code>foldr</code> is unnatural:</p>\n\n<pre><code>foldr c = foldl (flip c)\n</code></pre>\n\n<p>Now, <code>foldl</code> has the good, \"productive\" behavior on infinite/partially undefined <code>Tsil</code>s, while <code>foldr</code> does not. Implementing <code>foldr</code> in terms of <code>foldl</code> works (as I just did above), but you cannot implement <code>foldl</code> in terms of <code>foldr</code>, because you cannot recover that productivity.</p>\n\n<p><code>foldMap</code> avoids this issue. For <code>[]</code>:</p>\n\n<pre><code>foldMap f [] = mempty\nfoldMap f (x : xs) = f x &lt;&gt; foldMap f xs\n-- foldMap f = foldr (\\x r -&gt; f x &lt;&gt; r) mempty\n</code></pre>\n\n<p>And for <code>Tsil</code>:</p>\n\n<pre><code>foldMap f Lin = mempty\nfoldMap f (Snoc xs x) = foldMap f xs &lt;&gt; f x\n-- foldMap f = foldl (\\r x -&gt; r &lt;&gt; f x) mempty\n</code></pre>\n\n<p>Now,</p>\n\n<pre><code>instance Semigroup [a] where\n  [] &lt;&gt; ys = ys\n  (x : xs) &lt;&gt; ys = x : (xs &lt;&gt; ys)\n  -- (&lt;&gt;) = (++)\ninstance Monoid [a] where mempty = []\ninstance Semigroup (Tsil a) where\n  ys &lt;&gt; Lin = ys\n  ys &lt;&gt; (Snoc xs x) = Snoc (ys &lt;&gt; xs) x\ninstance Monoid (Tsil a) where mempty = Lin\n</code></pre>\n\n<p>And we have</p>\n\n<pre><code>foldMap (: []) xs = xs -- even for infinite xs\nfoldMap (Snoc Lin) xs = xs -- even for infinite xs\n</code></pre>\n\n<p>Implementations for <code>foldl</code> and <code>foldr</code> are actually given in the documentation</p>\n\n<pre><code>foldr f z t = appEndo (foldMap (Endo . f) t ) z\nfoldl f z t = appEndo (getDual (foldMap (Dual . Endo . flip f) t)) z\n</code></pre>\n\n<p><code>f</code> is used to turn each <code>a</code> in the <code>t a</code> into a <code>b -&gt; b</code> (<code>Endo b</code>), and then all the <code>b -&gt; b</code>s are composed together (<code>foldr</code> does it one way, while <code>foldl</code> composes them backwards with <code>Dual (Endo b)</code>) and the final <code>b -&gt; b</code> is then applied to the initial value <code>z :: b</code>.</p>\n\n<p><code>foldr</code> is replaced with <code>foldl</code> in specializations <code>sum</code>, <code>minimum</code>, etc. in the <code>instance Foldable []</code>, for performance reasons. The idea is that you can't take the <code>sum</code> of an infinite list anyway (this assumption is false, but it's generally true enough), so we don't need <code>foldr</code> to handle it. Using <code>foldl</code> is, in some cases, more performant than <code>foldr</code>, so <code>foldr</code> is changed to <code>foldl</code>. I would expect, for <code>Tsil</code>, that <code>foldr</code> is sometimes more performant than <code>foldl</code>, and therefore <code>sum</code>, <code>minimum</code>, etc. can be reimplemented in terms of <code>foldr</code>, instead of <code>fold</code> in order to get that performance improvement. Note that the documentation says that <code>sum</code>, <code>minimum</code>, etc. should be equivalent to the forms using <code>foldMap</code>/<code>fold</code>, but may be less defined, which is exactly what would happen.</p>\n\n<hr/>\n\n<p>Bit of an appendix, but I think it's worth noticing that:</p>\n\n<pre><code>genFoldr c n [] = n; genFoldr c n (x : xs) = c x (genFoldr c n xs)\ninstance Foldable [] where\n  foldl c = genFoldr (flip c)\n  foldr c = foldl (flip c)\n-- similarly for Tsil\n</code></pre>\n\n<p>is actually a valid, lawful <code>Foldable</code> instance, where <em>both</em> <code>foldr</code> and <code>foldl</code> are unnatural and neither can handle infinite structures (<code>foldMap</code> is defaulted in terms of <code>foldr</code>, and thus won't handle infinite lists either). In this case, <code>foldr</code> and <code>foldl</code> can be written in terms of each other (<code>foldl c = foldr (flip c)</code>, though it is implemented with <code>genFoldr</code>). However, this instance is undesirable, because we would really like a <code>foldr</code> that can handle infinite lists, so we instead implement</p>\n\n<pre><code>instance Foldable [] where\n  foldr = genFoldr\n  foldl c = foldr (flip c)\n</code></pre>\n\n<p>where the equality <code>foldr c = foldl (flip c)</code> no longer holds.</p>\n"}, {"tags": [], "owner": {"reputation": 1706, "user_id": 1840613, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/c2dfd4d21060ccd9b972864e0f6cb8c4?s=128&d=identicon&r=PG", "display_name": "Jeremy List", "link": "https://stackoverflow.com/users/1840613/jeremy-list"}, "is_accepted": false, "score": 3, "last_activity_date": 1564434532, "creation_date": 1564434532, "answer_id": 57261433, "question_id": 57260253, "link": "https://stackoverflow.com/questions/57260253/can-foldr-and-foldl-be-defined-in-terms-of-each-other/57261433#57261433", "title": "Can `foldr` and `foldl` be defined in terms of each other?", "body": "<p>In the case of lists: <code>foldl</code> can be defined in terms of <code>foldr</code> but not vice-versa.</p>\n\n<pre><code>foldl f a l = foldr (\\b e c -&gt; e (f c b)) id l a\n</code></pre>\n\n<p>For other types which implement <code>Foldable</code>: the opposite may be true.</p>\n"}, {"tags": [], "owner": {"reputation": 44013, "user_id": 1477667, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/trgKM.jpg?s=128&g=1", "display_name": "dfeuer", "link": "https://stackoverflow.com/users/1477667/dfeuer"}, "is_accepted": false, "score": 3, "last_activity_date": 1564766810, "creation_date": 1564766810, "answer_id": 57331074, "question_id": 57260253, "link": "https://stackoverflow.com/questions/57260253/can-foldr-and-foldl-be-defined-in-terms-of-each-other/57331074#57331074", "title": "Can `foldr` and `foldl` be defined in terms of each other?", "body": "<p>Here's a type for which <em>neither</em> <code>foldl</code> nor <code>foldr</code> can be implemented in terms of the other:</p>\n\n<pre><code>import Data.Functor.Reverse\nimport Data.Monoid\n\ndata DL a = DL [a] (Reverse [] a)\n  deriving Foldable\n</code></pre>\n\n<p>The <code>Foldable</code> implementation looks like</p>\n\n<pre><code>instance Foldable DL where\n  foldMap f (DL front rear) = foldMap f front &lt;&gt; foldMap f rear\n</code></pre>\n\n<p>Inlining the <code>Foldable</code> instance for <code>Reverse []</code>, and adding the corresponding <code>foldr</code> and <code>foldl</code>,</p>\n\n<pre><code>  foldMap f (DL front rear) = foldMap f front &lt;&gt; getDual (foldMap (Dual . f) (getReverse rear))\n  foldr c n (DL xs (Reverse ys)) =\n    foldr c (foldl (flip c) n ys) xs\n  foldl f b (DL xs (Reverse ys)) =\n    foldr (flip f) (foldl f b xs) ys\n</code></pre>\n\n<p>If the front list is infinite, then <code>foldr</code> defined using <code>foldl</code> won't work. If the rear list is infinite, then <code>foldl</code> defined using <code>foldr</code> won't work.</p>\n"}], "owner": {"reputation": 1, "user_id": 156458, "user_type": "registered", "accept_rate": 47, "profile_image": "https://i.stack.imgur.com/3PCjR.png?s=128&g=1", "display_name": "Tim", "link": "https://stackoverflow.com/users/156458/tim"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 380, "favorite_count": 1, "answer_count": 4, "score": -4, "last_activity_date": 1565276057, "creation_date": 1564428282, "last_edit_date": 1565276057, "question_id": 57260253, "link": "https://stackoverflow.com/questions/57260253/can-foldr-and-foldl-be-defined-in-terms-of-each-other", "title": "Can `foldr` and `foldl` be defined in terms of each other?", "body": "<p>Can <code>foldr</code> and <code>foldl</code>   be defined in terms of each other?</p>\n\n<p>Programming in Haskell by Hutton says</p>\n\n<blockquote>\n  <p>What   do  we  need    to  define  manually?   The     minimal     complete    definition  for     an  instance    of  the\n  <code>Foldable</code>  class   is  to  define  either  <code>foldMap</code> or    <code>foldr</code>,    as  all other   functions   in  the class   can be  derived\n  from    either  of  these   two using   the default definitions and the instance    for lists.  </p>\n</blockquote>\n\n<p>So how can <code>foldl</code>   be defined in terms of <code>foldr</code>?</p>\n\n<p>Can <code>foldr</code> be defined in terms of <code>foldl</code>, so that we can define a <code>Foldable</code> type by defining <code>foldl</code>?</p>\n\n<p>Why is it that in <code>Foldable</code>, <code>fold</code> is defined in terms of <code>foldMap</code> which is defined in terms of <code>foldr</code>, while in list foldable, some specializations of <code>fold</code> are defined in terms of <code>foldl</code> as:</p>\n\n<pre><code>maximum :: Ord a =&gt; [a] -&gt; a\nmaximum = foldl max\n\nminimum :: Ord a =&gt; [a] -&gt; a\nminimum = foldl min\n\nsum :: Num a =&gt; [a] -&gt; a\nsum = foldl (+) 0\n\nproduct :: Num a =&gt; [a] -&gt; a\nproduct = foldl (*) 1\n</code></pre>\n\n<p>? Can they be rewritten as</p>\n\n<pre><code>maximum :: Ord a =&gt; [a] -&gt; a\nmaximum = foldr max\n\nminimum :: Ord a =&gt; [a] -&gt; a\nminimum = foldr min\n\nsum :: Num a =&gt; [a] -&gt; a\nsum = foldr (+) 0\n\nproduct :: Num a =&gt; [a] -&gt; a\nproduct = foldr (*) 1\n</code></pre>\n\n<p>Thanks.</p>\n"}, {"tags": ["haskell", "compiler-construction", "source-maps"], "comments": [{"owner": {"reputation": 62421, "user_id": 216164, "user_type": "registered", "accept_rate": 89, "profile_image": "https://www.gravatar.com/avatar/786f224adbe0784cdf7d0f15476061fe?s=128&d=identicon&r=PG", "display_name": "Thomas M. DuBuisson", "link": "https://stackoverflow.com/users/216164/thomas-m-dubuisson"}, "edited": false, "score": 2, "creation_date": 1564426018, "post_id": 57259505, "comment_id": 101018744, "body": "Try reading the answers here: <a href=\"https://stackoverflow.com/questions/27157717/boilerplate-free-annotation-of-asts-in-haskell/27158312\" title=\"boilerplate free annotation of asts in haskell\">stackoverflow.com/questions/27157717/&hellip;</a>  Also there are some questions linked from there that likely have good content."}], "answers": [{"tags": [], "owner": {"reputation": 9089, "user_id": 293147, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/247ce1ecd6cce2377ff3194386362392?s=128&d=identicon&r=PG", "display_name": "SK-logic", "link": "https://stackoverflow.com/users/293147/sk-logic"}, "is_accepted": false, "score": 4, "last_activity_date": 1570731999, "last_edit_date": 1570731999, "creation_date": 1564562242, "answer_id": 57286541, "question_id": 57259505, "link": "https://stackoverflow.com/questions/57259505/how-to-implement-source-map-in-a-compiler/57286541#57286541", "title": "How to implement source map in a compiler?", "body": "<p>Details depend on a compilation technique you're applying.</p>\n\n<p>If you're doing it via a sequence of transforms of intermediate languages, as most sane compilers do these days, your options are following:</p>\n\n<ul>\n<li>Annotate all <em>intermediate representation</em> (IR) nodes with source location information. Introduce special nodes for preserving variable names (they'll all go after you do, say, an SSA-transform, so you need to track their origins separately)</li>\n<li>Inject tons of intrinsic function calls (see how it's done in LLVM IR) instead of annotating each node</li>\n<li>Do a mixture of the above</li>\n</ul>\n\n<p>The first option can even be done nearly automatically - if each transform preserves source location of an original node in all nodes it creates from it, you'd only have to manually change some non-trivial annotations.</p>\n\n<p>Also you must keep in mind that some optimisations may render your source location information absolutely meaningless. E.g., a value numbering would collapse a number of similar expressions into one, probably preserving a source location information for one random origin. Same for rematerialisation.</p>\n\n<p>With Haskell, the first approach will result in a lot of boilerplate in your ADT definitions and pattern matching, even if you sugar coat it with something like Scrap Your Boilerplate (SYB), so I'd recommend the second approach, which is extensively documented and nicely demonstrated in LLVM IR.</p>\n"}], "owner": {"reputation": 962, "user_id": 490815, "user_type": "registered", "accept_rate": 24, "profile_image": "https://www.gravatar.com/avatar/366f7b0d571e7811680c53984c34c966?s=128&d=identicon&r=PG", "display_name": "sinoTrinity", "link": "https://stackoverflow.com/users/490815/sinotrinity"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 159, "favorite_count": 1, "answer_count": 1, "score": 2, "last_activity_date": 1570731999, "creation_date": 1564424700, "last_edit_date": 1566089944, "question_id": 57259505, "link": "https://stackoverflow.com/questions/57259505/how-to-implement-source-map-in-a-compiler", "title": "How to implement source map in a compiler?", "body": "<p>I'm implementing a compiler compiling a source language to a target language (assembly like) in Haskell. </p>\n\n<p>For debugging purpose, a source map is needed to map target language assembly instruction to its corresponding source position (line and column). </p>\n\n<p>I've searched extensively compiler implementation, but none includes a source map.</p>\n\n<p>Can anyone please point me in the right direction on how to generate a source map? </p>\n\n<p>Code samples, books, etc. Haskell is preferred, other languages are also welcome.</p>\n"}, {"tags": ["haskell", "fold"], "comments": [{"owner": {"reputation": 384463, "user_id": 1126841, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/fa05233b2357f8d11c22ef4cfc7bb85c?s=128&d=identicon&r=PG", "display_name": "chepner", "link": "https://stackoverflow.com/users/1126841/chepner"}, "edited": false, "score": 10, "creation_date": 1564421498, "post_id": 57258608, "comment_id": 101016916, "body": "Please do a little research by looking at the source for <code>Data.Foldable</code> first, and make an <i>attempt</i> to either define <code>foldMap</code> in terms of <code>foldl</code>, or provide what you think is proof (or at least evidence) that you cannot do so."}, {"owner": {"reputation": 384463, "user_id": 1126841, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/fa05233b2357f8d11c22ef4cfc7bb85c?s=128&d=identicon&r=PG", "display_name": "chepner", "link": "https://stackoverflow.com/users/1126841/chepner"}, "edited": false, "score": 1, "creation_date": 1564421560, "post_id": 57258608, "comment_id": 101016942, "body": "What <code>fold</code> are you referring to?"}, {"owner": {"reputation": 126897, "user_id": 791604, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/ce991df7a056248d5e4f6fc3659ba733?s=128&d=identicon&r=PG", "display_name": "Daniel Wagner", "link": "https://stackoverflow.com/users/791604/daniel-wagner"}, "reply_to_user": {"reputation": 384463, "user_id": 1126841, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/fa05233b2357f8d11c22ef4cfc7bb85c?s=128&d=identicon&r=PG", "display_name": "chepner", "link": "https://stackoverflow.com/users/1126841/chepner"}, "edited": false, "score": 6, "creation_date": 1564421977, "post_id": 57258608, "comment_id": 101017100, "body": "@chepner Given the context of the question, I think it&#39;s pretty clearly <a href=\"https://hackage.haskell.org/package/base-4.12.0.0/docs/Data-Foldable.html#v:fold\" rel=\"nofollow noreferrer\">this <code>fold</code></a> that&#39;s being referred to. (I fully agree with your comment suggesting more effort on the part of the asker, though.)"}, {"owner": {"reputation": 14537, "user_id": 7128034, "user_type": "registered", "accept_rate": 85, "profile_image": "https://i.stack.imgur.com/T8aRg.jpg?s=128&g=1", "display_name": "Dami&#225;n Rafael Lattenero", "link": "https://stackoverflow.com/users/7128034/dami%c3%a1n-rafael-lattenero"}, "edited": false, "score": 0, "creation_date": 1564471199, "post_id": 57258608, "comment_id": 101031153, "body": "I hope my answer helped, let me know if you need more info"}], "answers": [{"tags": [], "owner": {"reputation": 14537, "user_id": 7128034, "user_type": "registered", "accept_rate": 85, "profile_image": "https://i.stack.imgur.com/T8aRg.jpg?s=128&g=1", "display_name": "Dami&#225;n Rafael Lattenero", "link": "https://stackoverflow.com/users/7128034/dami%c3%a1n-rafael-lattenero"}, "is_accepted": false, "score": 2, "last_activity_date": 1564423385, "creation_date": 1564423385, "answer_id": 57259206, "question_id": 57258608, "link": "https://stackoverflow.com/questions/57258608/can-foldmap-f-be-defined-equivalently-in-terms-of-fold-foldl-and-f/57259206#57259206", "title": "Can `foldMap f` be defined equivalently in terms of `fold/foldl` and `f`?", "body": "<p>If you carefully check the type of <code>foldr</code> and <code>foldl</code> you will see how easy could be:</p>\n\n<p>look:</p>\n\n<pre><code>foldr :: Foldable t =&gt; (a -&gt; b -&gt; b) -&gt; b -&gt; t a -&gt; b\n\nfoldl :: Foldable t =&gt; (b -&gt; a -&gt; b) -&gt; b -&gt; t a -&gt; b\n</code></pre>\n\n<p>so... what can we do here... mmm, do you know <code>flip</code>?</p>\n\n<pre><code>flip :: (a -&gt; b -&gt; c) -&gt; b -&gt; a -&gt; c\n</code></pre>\n\n<p>ok then:</p>\n\n<pre><code>foldMap' :: (Foldable t, Monoid m) =&gt; (a -&gt; m) -&gt; t a -&gt; m\nfoldMap' f = foldl (flip (mappend . f)) mempty\n</code></pre>\n"}, {"comments": [{"owner": {"reputation": 391, "user_id": 5922388, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/64d51926ef05c2bfb8599e4e5cef6315?s=128&d=identicon&r=PG&f=1", "display_name": "Niko", "link": "https://stackoverflow.com/users/5922388/niko"}, "edited": false, "score": 0, "creation_date": 1564425363, "post_id": 57259350, "comment_id": 101018474, "body": "<code>fold</code> is defined using <code>foldMap</code>: <a href=\"https://hackage.haskell.org/package/base-4.12.0.0/docs/src/Data.Foldable.html#fold\" rel=\"nofollow noreferrer\">hackage.haskell.org/package/base-4.12.0.0/docs/src/&hellip;</a> Wouldn&#39;t this lead to an infinite loop?"}, {"owner": {"reputation": 44013, "user_id": 1477667, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/trgKM.jpg?s=128&g=1", "display_name": "dfeuer", "link": "https://stackoverflow.com/users/1477667/dfeuer"}, "reply_to_user": {"reputation": 391, "user_id": 5922388, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/64d51926ef05c2bfb8599e4e5cef6315?s=128&d=identicon&r=PG&f=1", "display_name": "Niko", "link": "https://stackoverflow.com/users/5922388/niko"}, "edited": false, "score": 1, "creation_date": 1564425428, "post_id": 57259350, "comment_id": 101018498, "body": "@Niko, that&#39;s a <i>default</i> definition. It works often enough to be useful, but it doesn&#39;t work for every container."}, {"owner": {"reputation": 1, "user_id": 156458, "user_type": "registered", "accept_rate": 47, "profile_image": "https://i.stack.imgur.com/3PCjR.png?s=128&g=1", "display_name": "Tim", "link": "https://stackoverflow.com/users/156458/tim"}, "edited": false, "score": 0, "creation_date": 1564426706, "post_id": 57259350, "comment_id": 101019010, "body": "Thanks. (1) Is your way that  requires the foldable also be a functor the only possible way for representing <code>foldMap</code> by <code>fold</code> and <code>f</code>? Is it necessary that the foldable also be a functor? (2) How do you define <code>foldMap f</code> equivalently in terms of <code>foldl</code> and <code>f</code>?"}, {"owner": {"reputation": 44013, "user_id": 1477667, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/trgKM.jpg?s=128&g=1", "display_name": "dfeuer", "link": "https://stackoverflow.com/users/1477667/dfeuer"}, "reply_to_user": {"reputation": 1, "user_id": 156458, "user_type": "registered", "accept_rate": 47, "profile_image": "https://i.stack.imgur.com/3PCjR.png?s=128&g=1", "display_name": "Tim", "link": "https://stackoverflow.com/users/156458/tim"}, "edited": false, "score": 0, "creation_date": 1564427474, "post_id": 57259350, "comment_id": 101019308, "body": "@Tim, (1) think about what you need to give <code>fold</code>, compared to what <code>foldMap</code> is given. What do you need to do to adapt one to the other? (2) Try writing <code>foldMap f = foldl _ _</code> in an instance and see what the compiler tells you. Can you see how to plug the holes?"}, {"owner": {"reputation": 1, "user_id": 156458, "user_type": "registered", "accept_rate": 47, "profile_image": "https://i.stack.imgur.com/3PCjR.png?s=128&g=1", "display_name": "Tim", "link": "https://stackoverflow.com/users/156458/tim"}, "edited": false, "score": 0, "creation_date": 1564427632, "post_id": 57259350, "comment_id": 101019361, "body": "In both (1) and (2), I guess your approach is trying to bridge them at the type level, and I am also concerned about whether the definitions are equivalent. In (1) furthermore, my question is whether your way that imposes the extra functor requirement is the only way."}, {"owner": {"reputation": 44013, "user_id": 1477667, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/trgKM.jpg?s=128&g=1", "display_name": "dfeuer", "link": "https://stackoverflow.com/users/1477667/dfeuer"}, "reply_to_user": {"reputation": 1, "user_id": 156458, "user_type": "registered", "accept_rate": 47, "profile_image": "https://i.stack.imgur.com/3PCjR.png?s=128&g=1", "display_name": "Tim", "link": "https://stackoverflow.com/users/156458/tim"}, "edited": false, "score": 0, "creation_date": 1564427733, "post_id": 57259350, "comment_id": 101019404, "body": "@Tim, fold + map gives an equivalent (but slower) implementation. As I explained already, <code>foldl</code> can only do so in some situations. For (2), you&#39;re really going to have to try it yourself and see what you find if you want to learn something."}, {"owner": {"reputation": 1, "user_id": 156458, "user_type": "registered", "accept_rate": 47, "profile_image": "https://i.stack.imgur.com/3PCjR.png?s=128&g=1", "display_name": "Tim", "link": "https://stackoverflow.com/users/156458/tim"}, "edited": false, "score": 0, "creation_date": 1564428416, "post_id": 57259350, "comment_id": 101019665, "body": "Thanks.  I am unable to understand the part about foldr and foldl in your answer. First of all, I can&#39;t find out what <code>:&gt;</code> and <code>:&lt;</code> mean."}, {"owner": {"reputation": 44013, "user_id": 1477667, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/trgKM.jpg?s=128&g=1", "display_name": "dfeuer", "link": "https://stackoverflow.com/users/1477667/dfeuer"}, "reply_to_user": {"reputation": 1, "user_id": 156458, "user_type": "registered", "accept_rate": 47, "profile_image": "https://i.stack.imgur.com/3PCjR.png?s=128&g=1", "display_name": "Tim", "link": "https://stackoverflow.com/users/156458/tim"}, "edited": false, "score": 1, "creation_date": 1564430315, "post_id": 57259350, "comment_id": 101020435, "body": "@Tim, they&#39;re data constructors I&#39;m defining. I suspect it&#39;s time for to take a step back and work through some of the earlier chapters of a Haskell book."}, {"owner": {"reputation": 1, "user_id": 156458, "user_type": "registered", "accept_rate": 47, "profile_image": "https://i.stack.imgur.com/3PCjR.png?s=128&g=1", "display_name": "Tim", "link": "https://stackoverflow.com/users/156458/tim"}, "edited": false, "score": 0, "creation_date": 1564430510, "post_id": 57259350, "comment_id": 101020506, "body": "What am I expected to step back to?   In <code>data Stream a = a :&lt; Stream a</code>, the part after <code>=</code> is supposed to be a sequence of constructors separated by <code>|</code>, so I guess you new type has only one constructor <code>a :&lt; Stream a</code>.  But I have never seen such a &quot;convoluted&quot; constructor in &quot; the earlier chapters of a Haskell book&quot;. I am not sure what the constructor means, if it has some special keywords or predefined symbols, and what  <code>:&gt;</code> and <code>:&lt;</code> in the constructor mean"}, {"owner": {"reputation": 44013, "user_id": 1477667, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/trgKM.jpg?s=128&g=1", "display_name": "dfeuer", "link": "https://stackoverflow.com/users/1477667/dfeuer"}, "reply_to_user": {"reputation": 1, "user_id": 156458, "user_type": "registered", "accept_rate": 47, "profile_image": "https://i.stack.imgur.com/3PCjR.png?s=128&g=1", "display_name": "Tim", "link": "https://stackoverflow.com/users/156458/tim"}, "edited": false, "score": 0, "creation_date": 1564442374, "post_id": 57259350, "comment_id": 101023986, "body": "@Tim, they&#39;re just infix. An operator that starts with a colon is a constructor, like <code>:</code> for lists."}, {"owner": {"reputation": 44013, "user_id": 1477667, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/trgKM.jpg?s=128&g=1", "display_name": "dfeuer", "link": "https://stackoverflow.com/users/1477667/dfeuer"}, "reply_to_user": {"reputation": 1, "user_id": 156458, "user_type": "registered", "accept_rate": 47, "profile_image": "https://i.stack.imgur.com/3PCjR.png?s=128&g=1", "display_name": "Tim", "link": "https://stackoverflow.com/users/156458/tim"}, "edited": false, "score": 0, "creation_date": 1564447470, "post_id": 57259350, "comment_id": 101024998, "body": "@Tim, just one. That could also be written <code>data Stream a = (:&lt;) a (Stream a)</code>. It represents a list that is definitely infinite."}], "tags": [], "owner": {"reputation": 44013, "user_id": 1477667, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/trgKM.jpg?s=128&g=1", "display_name": "dfeuer", "link": "https://stackoverflow.com/users/1477667/dfeuer"}, "is_accepted": false, "score": 4, "last_activity_date": 1564424050, "creation_date": 1564424050, "answer_id": 57259350, "question_id": 57258608, "link": "https://stackoverflow.com/questions/57258608/can-foldmap-f-be-defined-equivalently-in-terms-of-fold-foldl-and-f/57259350#57259350", "title": "Can `foldMap f` be defined equivalently in terms of `fold/foldl` and `f`?", "body": "<p>Almost, but not quite.</p>\n\n<pre><code>myFoldMap\n  :: (Foldable t, Functor t, Monoid m)\n  =&gt; (a -&gt; m) -&gt; t a -&gt; m\nmyFoldMap f = fold . fmap f\n</code></pre>\n\n<p>This idea is where <code>foldMap</code> gets its name, but it has a <code>Functor</code> constraint that can't be satisfied by types like <code>Data.Set.Set</code>.</p>\n\n<p>As for <code>foldr</code> and <code>foldl</code>, you can get the right types, and the right behavior for <em>finite</em> containers, but not the right behavior for <em>infinite</em> containers. Consider what <code>foldl</code> does for</p>\n\n<pre><code>data Stream a = a :&lt; Stream a\n  deriving Foldable\n</code></pre>\n\n<p>and what <code>foldr</code> does for</p>\n\n<pre><code>data RStream a = RStream a :&gt; a\n  deriving Foldable\n</code></pre>\n\n<p>In each case, you'll end up with an infinite loop.</p>\n"}], "owner": {"reputation": 1, "user_id": 156458, "user_type": "registered", "accept_rate": 47, "profile_image": "https://i.stack.imgur.com/3PCjR.png?s=128&g=1", "display_name": "Tim", "link": "https://stackoverflow.com/users/156458/tim"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 280, "favorite_count": 0, "answer_count": 2, "score": -4, "last_activity_date": 1564433953, "creation_date": 1564420715, "last_edit_date": 1564433953, "question_id": 57258608, "link": "https://stackoverflow.com/questions/57258608/can-foldmap-f-be-defined-equivalently-in-terms-of-fold-foldl-and-f", "title": "Can `foldMap f` be defined equivalently in terms of `fold/foldl` and `f`?", "body": "<p>In <code>Foldable t</code>, <code>foldMap</code> is defined based on <code>foldr</code></p>\n\n<pre><code>foldMap :: Monoid m =&gt; (a -&gt; m) -&gt; t a -&gt; m\nfoldMap f = foldr (mappend . f) mempty\n</code></pre>\n\n<p>Can <code>foldMap f</code> be defined equivalently in terms of <code>fold</code> and <code>f</code>?\nI guess <code>foldMap</code> is some kind of composition of <code>fold</code> and <code>f</code>, but <code>fold . f</code> doesn't make sense.</p>\n\n<p>Can <code>foldMap f</code> be defined equivalently in terms of <code>foldl</code> and <code>f</code>?</p>\n"}, {"tags": ["haskell", "bloom-filter", "clash"], "comments": [{"owner": {"reputation": 1154, "user_id": 10410363, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/M5yYJ.gif?s=128&g=1", "display_name": "cccnrc", "link": "https://stackoverflow.com/users/10410363/cccnrc"}, "edited": false, "score": 0, "creation_date": 1564409296, "post_id": 57255492, "comment_id": 101010855, "body": "please reformat with code formatting"}, {"owner": {"reputation": 25144, "user_id": 477476, "user_type": "registered", "accept_rate": 85, "profile_image": "https://i.stack.imgur.com/Qf4TT.png?s=128&g=1", "display_name": "Cactus", "link": "https://stackoverflow.com/users/477476/cactus"}, "edited": false, "score": 0, "creation_date": 1564630461, "post_id": 57255492, "comment_id": 101096261, "body": "Start by making sure everything is fixed-size. For example, instead of <code>[Int]</code>, use a <code>BitVector 32</code> or a <code>Vec 32 Bit</code> in <code>HashTable</code>&#39;s <code>value</code> field."}], "owner": {"reputation": 11, "user_id": 11801324, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/93f776fb6036094e27aede25b0b2c74e?s=128&d=identicon&r=PG&f=1", "display_name": "Antony", "link": "https://stackoverflow.com/users/11801324/antony"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 92, "favorite_count": 0, "answer_count": 0, "score": 1, "last_activity_date": 1564630111, "creation_date": 1564408904, "last_edit_date": 1564630111, "question_id": 57255492, "link": "https://stackoverflow.com/questions/57255492/implement-a-simple-bloomfilter-by-using-clash", "title": "Implement a simple bloomfilter by using clash", "body": "<p>I have implemented a simple hash process in a bloom filter. How can I implement the same process by using clash?</p>\n\n<p>Here is the Haskell code I have already implemented\uff1a</p>\n\n<pre><code>module testbloom where \ndata HashTable = HashTable { location :: Int,  value :: [Int] } \ndata HashFunction = HashFunction { hashfunction :: HashTable -&gt; Int -&gt; Int } \ndata BloomFilter = BloomFilter { hashF :: [HashFunction], table :: HashTable } \n\nhashtable :: Int -&gt; HashTable \nhashtable loc = HashTable { location = loc, value = replicate loc 0 } \n\nsetbloom :: BloomFilter \nsetbloom = BloomFilter { hashF = [defaultfunction], table = hashtable 32 } \n\ndefaultfunction :: HashFunction \ndefaultfunction = HashFunction { hashfunction = function } \n\nfunction :: HashTable -&gt; Int -&gt; Int \nfunction va t = t `mod` ( location va ) \n\nhash :: HashFunction -&gt; HashTable -&gt; Int -&gt; Int \nhash func hash t = ( hashfunction func ) hash t \n\nreplacebit :: [Int] -&gt; Int -&gt; Int -&gt; [Int] \nreplacebit hashtable posit v = a ++ (v:tail ax) \n        where (a,ax) = splitAt posit hashtable  \n\nsetToOne :: Int -&gt; HashTable -&gt; HashTable \nsetToOne t hashtable = hashtable { value = values } \n         where values = replacebit (value hashtable) t 1 \n\nfill :: BloomFilter -&gt; [Int] -&gt; BloomFilter \nfill bf t = bf {table = tables} \n  where tables = foldr setToOne initialbloom $ concat [ [ hash f initialbloom v  | v &lt;- t] | f &lt;- fns ] \n         initialbloom = table setbloom \n         fns = hashF setbloom \n\njudge:: BloomFilter -&gt; Int -&gt; Bool \njudge setbloom v  \n  | vs == [1]   = True \n  | otherwise   = False \n  where vs = [(value bs) !! pos | pos &lt;- positions] \n        positions = [ hash hf bs v | hf &lt;- hashF setbloom] \n        bs = table setbloom  \n\nbloom :: [Int] -&gt; Int -&gt; Bool \nbloom vs v = judge (fill setbloom vs) v \n\ntest :: [Int] -&gt; [Int] \ntest vs = value $ table $ fill setbloom vs\n</code></pre>\n\n<p>How to convert it to clash-lang, thanks for help.</p>\n"}, {"tags": ["haskell", "pattern-matching"], "comments": [{"owner": {"reputation": 314794, "user_id": 67579, "user_type": "registered", "accept_rate": 81, "profile_image": "https://i.stack.imgur.com/BJXub.png?s=128&g=1", "display_name": "Willem Van Onsem", "link": "https://stackoverflow.com/users/67579/willem-van-onsem"}, "edited": false, "score": 7, "creation_date": 1564393432, "post_id": 57251108, "comment_id": 101002240, "body": "The <code>b</code> in <code>b -&gt; True</code> is a locally scoped variable that &quot;hides&quot; the outer <code>b</code> in the <code>f</code> definition level. The pattern you use is <code>b</code>, and pattern matching with a variable will always succeed."}, {"owner": {"reputation": 61419, "user_id": 849891, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/MbEO3.png?s=128&g=1", "display_name": "Will Ness", "link": "https://stackoverflow.com/users/849891/will-ness"}, "reply_to_user": {"reputation": 314794, "user_id": 67579, "user_type": "registered", "accept_rate": 81, "profile_image": "https://i.stack.imgur.com/BJXub.png?s=128&g=1", "display_name": "Willem Van Onsem", "link": "https://stackoverflow.com/users/67579/willem-van-onsem"}, "edited": false, "score": 0, "creation_date": 1564406389, "post_id": 57251108, "comment_id": 101009154, "body": "@WillemVanOnsem isn&#39;t this question <i>essentially</i> about <a href=\"https://stackoverflow.com/questions/tagged/pattern-matching\">pattern-matching</a>? don&#39;t you think it really <i>should</i> be tagged that way? So if you already answering it anyway, what do you think about maybe you could also re-tag them sometimes in such circumstances? I really feel uneasy seeing my name all over the tag all the time after I do such re-tagging edits..."}, {"owner": {"reputation": 1378, "user_id": 2195721, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/37ff0c10acb6603393e11b44132b23cb?s=128&d=identicon&r=PG", "display_name": "Cthulhu", "link": "https://stackoverflow.com/users/2195721/cthulhu"}, "edited": false, "score": 4, "creation_date": 1564425281, "post_id": 57251108, "comment_id": 101018432, "body": "Moral of the story: don&#39;t forget to add <code>-Wall</code>."}, {"owner": {"reputation": 2790, "user_id": 5137782, "user_type": "registered", "accept_rate": 71, "profile_image": "https://i.stack.imgur.com/b8bQ8.jpg?s=128&g=1", "display_name": "8protons", "link": "https://stackoverflow.com/users/5137782/8protons"}, "edited": false, "score": 1, "creation_date": 1564436632, "post_id": 57251108, "comment_id": 101022659, "body": "OP: <code>Is this the correct behavior?</code> What behavior were you expecting? You should have shared your hypothesis in the question :)"}], "answers": [{"comments": [{"owner": {"reputation": 14537, "user_id": 7128034, "user_type": "registered", "accept_rate": 85, "profile_image": "https://i.stack.imgur.com/T8aRg.jpg?s=128&g=1", "display_name": "Dami&#225;n Rafael Lattenero", "link": "https://stackoverflow.com/users/7128034/dami%c3%a1n-rafael-lattenero"}, "edited": false, "score": 1, "creation_date": 1564413984, "post_id": 57251196, "comment_id": 101013441, "body": "Marvelous as always, but now I could add my two cents :)"}], "tags": [], "owner": {"reputation": 314794, "user_id": 67579, "user_type": "registered", "accept_rate": 81, "profile_image": "https://i.stack.imgur.com/BJXub.png?s=128&g=1", "display_name": "Willem Van Onsem", "link": "https://stackoverflow.com/users/67579/willem-van-onsem"}, "is_accepted": false, "score": 24, "last_activity_date": 1564394471, "last_edit_date": 1564394471, "creation_date": 1564393654, "answer_id": 57251196, "question_id": 57251108, "link": "https://stackoverflow.com/questions/57251108/strange-pattern-matching-is-it-correct/57251196#57251196", "title": "Strange pattern-matching: is it correct?", "body": "<p>The <code>b</code> in the case definition is <em>not</em> the <code>b</code> in in the head of the <code>f</code> definition. You created a <em>new locally scoped variable</em>. Your code is thus equivalent to:</p>\n\n<pre><code>f a b = case a of\n    <b>c</b> -&gt; True\n    _ -&gt; False</code></pre>\n\n<p>Pattern matching with a variable indeed always succeeds.</p>\n\n<p>If you want to check if two values are the same, you will need to define some function (or let Haskell automatically derive <code>Eq</code> for example).</p>\n\n<blockquote>\n  <p><strong>Note</strong>: you can turn on the <code>-Wname-shadowing</code> warning to let the compiler warn you about creating identifiers that shadow existing ones. For example your code will produce:</p>\n\n<pre><code>Prelude&gt; f a b = case a of b -&gt; True; _ -&gt; False\n\n&lt;interactive&gt;:1:19: warning: [-Wname-shadowing]\n    This binding for \u2018b\u2019 shadows the existing binding\n      bound at &lt;interactive&gt;:1:5\n</code></pre>\n</blockquote>\n"}, {"tags": [], "owner": {"reputation": 14537, "user_id": 7128034, "user_type": "registered", "accept_rate": 85, "profile_image": "https://i.stack.imgur.com/T8aRg.jpg?s=128&g=1", "display_name": "Dami&#225;n Rafael Lattenero", "link": "https://stackoverflow.com/users/7128034/dami%c3%a1n-rafael-lattenero"}, "is_accepted": true, "score": 5, "last_activity_date": 1564420244, "last_edit_date": 1564420244, "creation_date": 1564413964, "answer_id": 57256939, "question_id": 57251108, "link": "https://stackoverflow.com/questions/57251108/strange-pattern-matching-is-it-correct/57256939#57256939", "title": "Strange pattern-matching: is it correct?", "body": "<p>Just in addition to the perfect answer accepted, my two cents:</p>\n\n<p>this:</p>\n\n<pre><code>f a b = case a of b -&gt; True; _ -&gt; False -- (A)\n</code></pre>\n\n<p>and this:</p>\n\n<pre><code>f a b = case a of\n                c -&gt; True\n                _ -&gt; False --(B)\n</code></pre>\n\n<p>are is equivalent to:</p>\n\n<pre><code>f a b = case a of\n    _ -&gt; True\n</code></pre>\n\n<p>or</p>\n\n<pre><code>f a b = True\n</code></pre>\n\n<p>or</p>\n\n<pre><code>f _ b = True\n</code></pre>\n\n<p>So, be careful because that's the real behavior you created, a function that takes two parameters and returns always True.</p>\n\n<blockquote>\n  <p>Also:</p>\n</blockquote>\n\n<p><strong>(A)</strong> and <strong>(B)</strong> will show this warning if <code>-Woverlapping-patterns</code> is used:</p>\n\n<pre><code>warning: [-Woverlapping-patterns]\n    Pattern match is redundant\n    In a case alternative: _ -&gt; ...\n  |\n3 |               _ -&gt; False\n  |               ^^^^^^^^^^\n</code></pre>\n"}], "owner": {"reputation": 2196, "user_id": 1980863, "user_type": "registered", "accept_rate": 50, "profile_image": "https://www.gravatar.com/avatar/8a9248211c4148f5d7df2269aa711e2e?s=128&d=identicon&r=PG", "display_name": "RandomB", "link": "https://stackoverflow.com/users/1980863/randomb"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 817, "favorite_count": 1, "accepted_answer_id": 57256939, "answer_count": 2, "score": 9, "last_activity_date": 1564469226, "creation_date": 1564393344, "last_edit_date": 1564469226, "question_id": 57251108, "link": "https://stackoverflow.com/questions/57251108/strange-pattern-matching-is-it-correct", "title": "Strange pattern-matching: is it correct?", "body": "<p>Why does this function always succeed? It always returns <code>True</code> with any values and any types. Is this the correct behavior?</p>\n\n<pre><code>f a b = case a of b -&gt; True; _ -&gt; False\n</code></pre>\n"}, {"tags": ["list", "haskell", "monads", "applicative", "equivalent"], "comments": [{"owner": {"reputation": 3127, "user_id": 7096763, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/4c1843972ea822c36c0c024d2ddcc8d7?s=128&d=identicon&r=PG&f=1", "display_name": "MikaelF", "link": "https://stackoverflow.com/users/7096763/mikaelf"}, "edited": false, "score": 2, "creation_date": 1564378000, "post_id": 57247249, "comment_id": 100995537, "body": "I think I see what you mean. I won&#39;t risk answering and getting storm-downvoted, as I&#39;m fairly recent to Haskell, but if you look at <a href=\"https://simonmar.github.io/bib/papers/applicativedo.pdf\" rel=\"nofollow noreferrer\">this paper</a>, they basically answer your question at the end of page 2."}, {"owner": {"reputation": 7817, "user_id": 7345298, "user_type": "registered", "accept_rate": 50, "profile_image": "https://www.gravatar.com/avatar/9477d048c5c29b16307b3356146d497a?s=128&d=identicon&r=PG&f=1", "display_name": "bradrn", "link": "https://stackoverflow.com/users/7345298/bradrn"}, "reply_to_user": {"reputation": 3127, "user_id": 7096763, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/4c1843972ea822c36c0c024d2ddcc8d7?s=128&d=identicon&r=PG&f=1", "display_name": "MikaelF", "link": "https://stackoverflow.com/users/7096763/mikaelf"}, "edited": false, "score": 1, "creation_date": 1564378217, "post_id": 57247249, "comment_id": 100995588, "body": "@MikaelF That\u2019s entirely correct \u2014 you should definitely add that as an answer! (Possibly with a quote from the paper at the relevant point.)"}, {"owner": {"reputation": 7817, "user_id": 7345298, "user_type": "registered", "accept_rate": 50, "profile_image": "https://www.gravatar.com/avatar/9477d048c5c29b16307b3356146d497a?s=128&d=identicon&r=PG&f=1", "display_name": "bradrn", "link": "https://stackoverflow.com/users/7345298/bradrn"}, "reply_to_user": {"reputation": 3127, "user_id": 7096763, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/4c1843972ea822c36c0c024d2ddcc8d7?s=128&d=identicon&r=PG&f=1", "display_name": "MikaelF", "link": "https://stackoverflow.com/users/7096763/mikaelf"}, "edited": false, "score": 2, "creation_date": 1564378494, "post_id": 57247249, "comment_id": 100995661, "body": "@MikaelF Might also be useful to mention <a href=\"http://hackage.haskell.org/package/base-4.12.0.0/docs/Control-Applicative.html#t:Applicative\" rel=\"nofollow noreferrer\">hackage.haskell.org/package/base-4.12.0.0/docs/&hellip;</a>, the documentation of which explicitly states the relation between <code>&lt;*&gt;</code> and <code>ap</code>."}, {"owner": {"reputation": 17170, "user_id": 1671066, "user_type": "registered", "accept_rate": 82, "profile_image": "https://www.gravatar.com/avatar/bd4c9461f2d17a884fba66eeed20e320?s=128&d=identicon&r=PG", "display_name": "Micha Wiedenmann", "link": "https://stackoverflow.com/users/1671066/micha-wiedenmann"}, "edited": false, "score": 1, "creation_date": 1564411664, "post_id": 57247249, "comment_id": 101012108, "body": "I have added Applicative and Monad to the title to improve searchability.  Maybe someone has a better title though."}], "answers": [{"tags": [], "owner": {"reputation": 78982, "user_id": 1848654, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/84180c0f3c9c04f8b8f0613fc0129dac?s=128&d=identicon&r=PG", "display_name": "melpomene", "link": "https://stackoverflow.com/users/1848654/melpomene"}, "is_accepted": true, "score": 12, "last_activity_date": 1564378610, "creation_date": 1564378610, "answer_id": 57247698, "question_id": 57247249, "link": "https://stackoverflow.com/questions/57247249/proving-equivalence-of-sequence-definitions-from-applicative-and-monad/57247698#57247698", "title": "Proving equivalence of sequence definitions from Applicative and Monad", "body": "<p>Here's a proof sketch:</p>\n\n<ol>\n<li><p>Show that</p>\n\n<pre><code>do\n    x'  &lt;- x\n    xs' &lt;- sequenceA' xs\n    return (x' : xs')\n</code></pre>\n\n<p>is equivalent to</p>\n\n<pre><code>do\n    f1  &lt;- do\n        cons &lt;- return (:)\n        x'  &lt;- x\n        return (cons x')\n    xs' &lt;- sequenceA' xs\n    return (f1 xs')\n</code></pre>\n\n<p>This involves desugaring (and resugaring) <code>do</code> notation and applying the <a href=\"https://hackage.haskell.org/package/base-4.12.0.0/docs/Control-Monad.html#t:Monad\" rel=\"noreferrer\">Monad laws</a>.</p></li>\n<li><p>Use the <a href=\"https://hackage.haskell.org/package/base-4.12.0.0/docs/src/GHC.Base.html#ap\" rel=\"noreferrer\">definition of <code>ap</code></a>:</p>\n\n<pre><code>ap m1 m2 = do { x1 &lt;- m1; x2 &lt;- m2; return (x1 x2) }\n</code></pre>\n\n<p>to turn the above code into</p>\n\n<pre><code>do\n    f1  &lt;- return (:) `ap` x\n    xs' &lt;- sequenceA' xs\n    return (f1 xs')\n</code></pre>\n\n<p>and then</p>\n\n<pre><code>return (:) `ap` x `ap` sequenceA' xs\n</code></pre></li>\n<li><p>Now you have</p>\n\n<pre><code>sequenceA' [] = return [] \nsequenceA' (x:xs) = return (:) `ap` x `ap` sequenceA' xs\n</code></pre>\n\n<p>Assume that <code>pure</code> and <code>&lt;*&gt;</code> are essentially the same as <code>return</code> and <code>`ap`</code>, respectively, and you're done.</p>\n\n<p>This latter property is also stated in the <a href=\"https://hackage.haskell.org/package/base-4.12.0.0/docs/Control-Applicative.html#t:Applicative\" rel=\"noreferrer\">Applicative documentation</a>:</p>\n\n<blockquote>\n  <p>If <code>f</code> is also a <code>Monad</code>, it should satisfy</p>\n  \n  <ul>\n  <li><p><code>pure = return</code></p></li>\n  <li><p><code>(&lt;*&gt;) = ap</code></p></li>\n  </ul>\n</blockquote></li>\n</ol>\n"}, {"tags": [], "owner": {"reputation": 3127, "user_id": 7096763, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/4c1843972ea822c36c0c024d2ddcc8d7?s=128&d=identicon&r=PG&f=1", "display_name": "MikaelF", "link": "https://stackoverflow.com/users/7096763/mikaelf"}, "is_accepted": false, "score": 8, "last_activity_date": 1564382749, "last_edit_date": 1564382749, "creation_date": 1564380424, "answer_id": 57247981, "question_id": 57247249, "link": "https://stackoverflow.com/questions/57247249/proving-equivalence-of-sequence-definitions-from-applicative-and-monad/57247981#57247981", "title": "Proving equivalence of sequence definitions from Applicative and Monad", "body": "<p>Since the <a href=\"https://wiki.haskell.org/Functor-Applicative-Monad_Proposal\" rel=\"noreferrer\">Functor-Applicative-Monad proposal</a>, implemented in GHC 7.10, Applicative is a superclass of Monad. So even though your two functions can't be strictly equivalent, since <code>sequenceA</code>'s domain includes <code>sequenceA'</code>'s domain, we can look at what happens in this common domain (the <code>Monad</code> typeclass).</p>\n\n<p><a href=\"https://simonmar.github.io/bib/papers/applicativedo.pdf\" rel=\"noreferrer\">This paper</a> shows an interesting demonstration of desugaring <code>do</code> notation to applicative and functor operations (<code>&lt;$&gt;</code>, <code>pure</code> and <code>&lt;*&gt;</code>). If the expressions on the right hand side of your left-pointing arrows (<code>&lt;-</code>) don't depend on each other, as is the case in your question, you can always use applicative operations, and therefore show that your hypothesis is correct (for the <code>Monad</code> domain).</p>\n\n<p>Also have a look at the <a href=\"https://gitlab.haskell.org/ghc/ghc/wikis/applicative-do\" rel=\"noreferrer\">ApplicativeDo</a> language extension proposal, which contains an example that's just like yours:</p>\n\n<pre><code>do\n  x &lt;- a\n  y &lt;- b\n  return (f x y)\n</code></pre>\n\n<p>which translates to:</p>\n\n<pre><code>(\\x y -&gt; f x y) &lt;$&gt; a &lt;*&gt; b\n</code></pre>\n\n<p>Substituting <code>f</code> for <code>(:)</code>, we get:</p>\n\n<pre><code>do\n  x &lt;- a\n  y &lt;- b\n  return (x : y)\n</code></pre>\n\n<p>... which translates to...</p>\n\n<pre><code>(\\x y -&gt; x : y) &lt;$&gt; a &lt;*&gt; b\n--And by eta reduction\n(:) &lt;$&gt; a &lt;*&gt; b\n--Which is equivalent to the code in your question (albeit more general):\npure (:) &lt;*&gt; a &lt;*&gt; b\n</code></pre>\n\n<p>Alternatively, you can make GHC's desugarer work for you by using the <code>ApplicativeDo</code> language extension and by following <a href=\"https://stackoverflow.com/a/8019870/7096763\">this answer</a> to the SO question \"haskell - Desugaring do-notation for Monads\". I'll leave this exercise up to you (as it honestly goes beyond my capacities!).</p>\n"}, {"comments": [{"owner": {"reputation": 61419, "user_id": 849891, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/MbEO3.png?s=128&g=1", "display_name": "Will Ness", "link": "https://stackoverflow.com/users/849891/will-ness"}, "edited": false, "score": 0, "creation_date": 1573750338, "post_id": 57257511, "comment_id": 103994768, "body": "there&#39;s ApplicativeDo extension. as for wiki, it&#39;s largely abandoned, isn&#39;t it? you can check any page&#39;s history there, to see how recent / relevant it really is."}], "tags": [], "owner": {"reputation": 14537, "user_id": 7128034, "user_type": "registered", "accept_rate": 85, "profile_image": "https://i.stack.imgur.com/T8aRg.jpg?s=128&g=1", "display_name": "Dami&#225;n Rafael Lattenero", "link": "https://stackoverflow.com/users/7128034/dami%c3%a1n-rafael-lattenero"}, "is_accepted": false, "score": 0, "last_activity_date": 1564416005, "creation_date": 1564416005, "answer_id": 57257511, "question_id": 57247249, "link": "https://stackoverflow.com/questions/57247249/proving-equivalence-of-sequence-definitions-from-applicative-and-monad/57257511#57257511", "title": "Proving equivalence of sequence definitions from Applicative and Monad", "body": "<blockquote>\n  <p>My own two cents</p>\n</blockquote>\n\n<p>There is no do notation for applicatives in Haskell. It can be seen specifically in <a href=\"https://wiki.haskell.org/Do_notation_considered_harmful#Library_design\" rel=\"nofollow noreferrer\">this segment</a>.</p>\n\n<p><code>return</code> and <code>pure</code> do exactly the same, but with different constraints, right?, so this part <code>pure (:)</code> and this part <code>return (x:xs)</code> are essentially the same. </p>\n\n<p>Then, here <code>x  &lt;- act</code> you are getting the value of act, and then the value of the recursion <code>xs &lt;- seqn acts</code>, to finally wrap it with the <code>return</code>.</p>\n\n<p>And that's what <code>pure (:) &lt;*&gt; x &lt;*&gt; sequenceA xs</code> is essentially doing.</p>\n"}], "owner": {"reputation": 14537, "user_id": 7128034, "user_type": "registered", "accept_rate": 85, "profile_image": "https://i.stack.imgur.com/T8aRg.jpg?s=128&g=1", "display_name": "Dami&#225;n Rafael Lattenero", "link": "https://stackoverflow.com/users/7128034/dami%c3%a1n-rafael-lattenero"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 203, "favorite_count": 0, "accepted_answer_id": 57247698, "answer_count": 3, "score": 8, "last_activity_date": 1572883071, "creation_date": 1564374905, "last_edit_date": 1572883071, "question_id": 57247249, "link": "https://stackoverflow.com/questions/57247249/proving-equivalence-of-sequence-definitions-from-applicative-and-monad", "title": "Proving equivalence of sequence definitions from Applicative and Monad", "body": "<p>How can I properly prove that</p>\n\n<pre><code>sequenceA :: (Traversable t, Applicative f) =&gt; t (f a) -&gt; f (t a)\nsequenceA []     = pure []\nsequenceA (x:xs) = pure (:) &lt;*&gt; x &lt;*&gt; sequenceA xs\n</code></pre>\n\n<p>is essentially the same to monad inputs as</p>\n\n<pre><code>sequenceA' :: Monad m =&gt; [m a] -&gt; m [a]\nsequenceA' [] = return [] \nsequenceA' (x:xs) = do \n                    x'  &lt;- x \n                    xs' &lt;- sequenceA' xs \n                    return (x':xs')\n</code></pre>\n\n<p>In spite of the constraint <code>Applicative</code> and <code>Monad</code> of course.</p>\n"}, {"tags": ["haskell", "parser-generator", "alex"], "comments": [{"owner": {"reputation": 101, "user_id": 11795614, "user_type": "registered", "profile_image": "https://lh5.googleusercontent.com/-6Qaz3buUXGo/AAAAAAAAAAI/AAAAAAAAACM/ts7tV7Ol-nU/photo.jpg?sz=128", "display_name": "\u042e\u0440\u0438\u0439 \u041a\u043e\u0437\u043b\u043e\u0432", "link": "https://stackoverflow.com/users/11795614/%d0%ae%d1%80%d0%b8%d0%b9-%d0%9a%d0%be%d0%b7%d0%bb%d0%be%d0%b2"}, "edited": false, "score": 0, "creation_date": 1564400308, "post_id": 57246916, "comment_id": 101005825, "body": "sorry of my English. Please, print keyword &quot;data&quot; in first position of string."}, {"owner": {"reputation": 384, "user_id": 9948945, "user_type": "registered", "profile_image": "https://lh3.googleusercontent.com/-XdUIqdMkCWA/AAAAAAAAAAI/AAAAAAAAAAA/4252rscbv5M/photo.jpg?sz=128", "display_name": "Samuel Barr", "link": "https://stackoverflow.com/users/9948945/samuel-barr"}, "edited": false, "score": 0, "creation_date": 1564425199, "post_id": 57246916, "comment_id": 101018398, "body": "Anything between the brackets at the end of a happy .y file should be valid Haskell code. What you have there is not- the indentation is all off, and Haskell is a white-space sensitive language."}], "answers": [{"comments": [{"owner": {"reputation": 15, "user_id": 11750547, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/d21e3e7ecf6a83fa3b5c4c09d70bf2a2?s=128&d=identicon&r=PG&f=1", "display_name": "Chrimpyslime", "link": "https://stackoverflow.com/users/11750547/chrimpyslime"}, "edited": false, "score": 0, "creation_date": 1564492916, "post_id": 57256067, "comment_id": 101043357, "body": "@Samuel Barr Thank you all! This was very helpful! I found several other problems too and fixed them! Thanks again!"}], "tags": [], "owner": {"reputation": 126897, "user_id": 791604, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/ce991df7a056248d5e4f6fc3659ba733?s=128&d=identicon&r=PG", "display_name": "Daniel Wagner", "link": "https://stackoverflow.com/users/791604/daniel-wagner"}, "is_accepted": true, "score": 2, "last_activity_date": 1564411048, "creation_date": 1564411048, "answer_id": 57256067, "question_id": 57246916, "link": "https://stackoverflow.com/questions/57246916/haskell-source-generated-by-happy-has-error-parse-error-on-input-data/57256067#57256067", "title": "Haskell source generated by happy has error &quot;parse error on input &#39;data&#39;&quot;", "body": "<p>Happy produces its generated code on column 1 of the file. Therefore, to have your code be considered part of the same <code>module</code>-<code>where</code> block as the generated code (which you cannot control), it must also live on column 1 of the file.</p>\n\n<p>Delete four spaces from the beginning of the plain-Haskell lines of code in your happy file and you'll be on your way to the next error. Make sure that your <code>deriving</code> clauses and <code>where</code> clauses are indented one level from their surroundings when you are deleting spaces.</p>\n"}], "owner": {"reputation": 15, "user_id": 11750547, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/d21e3e7ecf6a83fa3b5c4c09d70bf2a2?s=128&d=identicon&r=PG&f=1", "display_name": "Chrimpyslime", "link": "https://stackoverflow.com/users/11750547/chrimpyslime"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 423, "favorite_count": 0, "accepted_answer_id": 57256067, "answer_count": 1, "score": 1, "last_activity_date": 1564718872, "creation_date": 1564371325, "last_edit_date": 1564718872, "question_id": 57246916, "link": "https://stackoverflow.com/questions/57246916/haskell-source-generated-by-happy-has-error-parse-error-on-input-data", "title": "Haskell source generated by happy has error &quot;parse error on input &#39;data&#39;&quot;", "body": "<p>I'm trying out the happy parser generator of Haskell. After generating the module in happy.hs (no problem while generating!), I run the command <code>ghc happy.hs</code>, and I get the error: <code>Line 297: parse error on input 'data'</code>. Does anyone have solutions? Or tell me where can I get the solution?</p>\n\n<p>I tried loading the module in GHCi, rather than compiling it using ghc. But it seems not to be working too - I get the same error.</p>\n\n<p>Code in happy.y (happy source):</p>\n\n<pre class=\"lang-hs prettyprint-override\"><code>-- TODO: add more of my things!!!\n\n{\n    module Main where\n}\n%name calc\n%tokentype { Token }\n%error { parseError }\n-- tokens\n%token\n    let { TokenLet }\n    in { TokenIn }\n    int { TokenInt $$ }\n    var { TokenVar $$ }\n    '=' { TokenEq }\n    '+' { TokenPlus }\n    '-' { TokenSub }\n    '*' { TokenMul }\n    '/' { TokenDvd }\n    '(' { TokenOB }\n    ')' { TokenCB }\n%%\nExp : let var '=' Exp in Exp { Let $2 $4 $6 }\n    | Exp1 { Exp1 $1 }\nExp1 : Exp1 '+' Term { Plus $1 $3 }\n    | Exp1 '-' Term { Minus $1 $3 }\n    | Term { Term $1 }\nTerm : Term '*' Factor { Times $1 $3 }\n    | Term '/' Factor { Div $1 $3 }\n    | Factor { Factor $1 }\nFactor : int { Int $1 }\n    | var { Var $1 }\n    | '(' Exp ')' { Brack $2 }\n\n{\n    parseError :: [Token] -&gt; a\n    parseError _ = error \"Parse error! please try again...\"\n\n    data Exp = Let String Exp Exp\n        | Exp1 Exp1\n    deriving Show\n\n    data Exp1 = Plus Exp1 Term\n        | Minus Exp1 Term\n        | Term Term\n    deriving Show\n\n    data Term = Times Term Factor\n        | Div Term Factor\n        | Factor Factor\n    deriving Show\n\n    data Factor = Int Int\n        | Var String\n        | Brack Exp\n    deriving Show\n\n    -- the tokens \n    data Token = TokenLet\n        | TokenIn\n        | TokenInt Int\n        | TokenVar String\n        | TokenEq\n        | TokenPlus\n        | TokenMinus\n        | TokenTimes\n        | TokenDiv\n        | TokenOB\n        | TokenCB\n        deriving Show\n\n    -- the lexer\n    lexer :: String -&gt; [Token]\n    lexer [] = []\n    lexer (c:cs)\n        | isSpace c = lexer cs\n        | isAlpha c = lexVar (c:cs)\n        | isDigit c = lexNum (c:cs)\n    lexer ('=':cs) = TokenEq : lexer cs\n    lexer ('+':cs) = TokenPlus : lexer cs\n    lexer ('-':cs) = TokenMinus : lexer cs\n    lexer ('*':cs) = TokenTimes : lexer cs\n    lexer ('/':cs) = TokenDiv : lexer cs\n    lexer ('(':cs) = TokenOB : lexer cs\n    lexer (')':cs) = TokenCB : lexer cs\n    lexNum cs = TokenInt (read num) : lexer rest\n    where (num,rest) = span isDigit cs\n    lexVar cs =\n        case span isAlpha cs of\n        (\"let\",rest) -&gt; TokenLet : lexer rest\n        (\"in\",rest) -&gt; TokenIn : lexer rest\n        (var,rest) -&gt; TokenVar var : lexer rest\n\n    -- the main function\n    main = getContents &gt;&gt;= print . calc . lexer\n}\n</code></pre>\n\n<p>Line that makes error in happy.hs and \u00b110 Lines(Lines 287~307, including):</p>\n\n<pre class=\"lang-hs prettyprint-override\"><code>287: calc tks = happyRunIdentity happySomeParser where\n288:  happySomeParser = happyThen (happyParse action_0 tks) (\\x -&gt; case x of 289: {HappyAbsSyn4 z -&gt; happyReturn z; _other -&gt; notHappyAtAll })\n290: \n291: happySeq = happyDontSeq\n292:\n293:\n294: parseError :: [Token] -&gt; a\n295:    parseError _ = error \"Parse error! please try again...\"\n296:\n297:    data Exp = Let String Exp Exp       -- &lt;= I get error on this line!\n298:       | Exp1 Exp1\n299:    deriving Show\n300:\n301:    data Exp1 = Plus Exp1 Term\n302:        | Minus Exp1 Term\n303:        | Term Term\n304:    deriving Show\n305:\n306:    data Term = Times Term Factor\n307:        | Div Term Factor\n</code></pre>\n\n<p>I expect the program to run smoothly without any errors, but it doesn't.</p>\n"}, {"tags": ["haskell", "recursion", "fold"], "comments": [{"owner": {"reputation": 10378, "user_id": 2476735, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/39e9447bbc32246fcd23b76b5e946618?s=128&d=identicon&r=PG&f=1", "display_name": "David Young", "link": "https://stackoverflow.com/users/2476735/david-young"}, "edited": false, "score": 6, "creation_date": 1564368670, "post_id": 57246616, "comment_id": 100993954, "body": "Can you describe what sort of thing you mean by a &quot;kind of recursion&quot;?"}, {"owner": {"reputation": 1, "user_id": 156458, "user_type": "registered", "accept_rate": 47, "profile_image": "https://i.stack.imgur.com/3PCjR.png?s=128&g=1", "display_name": "Tim", "link": "https://stackoverflow.com/users/156458/tim"}, "reply_to_user": {"reputation": 10378, "user_id": 2476735, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/39e9447bbc32246fcd23b76b5e946618?s=128&d=identicon&r=PG&f=1", "display_name": "David Young", "link": "https://stackoverflow.com/users/2476735/david-young"}, "edited": false, "score": 0, "creation_date": 1564369378, "post_id": 57246616, "comment_id": 100994046, "body": "I think I know it: non tail and tail recursions."}, {"owner": {"reputation": 10378, "user_id": 2476735, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/39e9447bbc32246fcd23b76b5e946618?s=128&d=identicon&r=PG&f=1", "display_name": "David Young", "link": "https://stackoverflow.com/users/2476735/david-young"}, "edited": false, "score": 5, "creation_date": 1564373729, "post_id": 57246616, "comment_id": 100994679, "body": "It is true that one of them is tail recursive and one of them is not tail recursive. Is there a description of tail recursion that you are working from? If so, what parts of it do you understand and what parts of it do you not understand? Giving information like this helps us answer the question in a way that helps you to better understand. Try to provide a bit more information like this, when possible (especially definitions like that and what you do and don&#39;t understand about those definitions)."}, {"owner": {"reputation": 31243, "user_id": 2751851, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/4ddc0.png?s=128&g=1", "display_name": "duplode", "link": "https://stackoverflow.com/users/2751851/duplode"}, "edited": false, "score": 1, "creation_date": 1564397284, "post_id": 57246616, "comment_id": 101004328, "body": "Relevant: <a href=\"https://stackoverflow.com/q/3429634/2751851\"><i>foldl is tail recursive, so how come foldr runs faster than foldl?</i></a>"}], "answers": [{"tags": [], "owner": {"reputation": 61419, "user_id": 849891, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/MbEO3.png?s=128&g=1", "display_name": "Will Ness", "link": "https://stackoverflow.com/users/849891/will-ness"}, "is_accepted": false, "score": 3, "last_activity_date": 1564398996, "creation_date": 1564398996, "answer_id": 57252692, "question_id": 57246616, "link": "https://stackoverflow.com/questions/57246616/what-kinds-of-recursions-are-used-in-the-definitions-of-foldr-and-foldl/57252692#57252692", "title": "What kinds of recursions are used in the definitions of `foldr` and `foldl`?", "body": "<p><code>foldl</code> uses tail recursion. </p>\n\n<p><code>foldr</code> uses <em>guarded recursion</em>, the recursion being guarded by <code>f</code>'s laziness (if any). </p>\n\n<ul>\n<li>see also: <a href=\"https://stackoverflow.com/q/13042353/849891\">Does Haskell have tail-recursive optimization?</a></li>\n</ul>\n"}], "owner": {"reputation": 1, "user_id": 156458, "user_type": "registered", "accept_rate": 47, "profile_image": "https://i.stack.imgur.com/3PCjR.png?s=128&g=1", "display_name": "Tim", "link": "https://stackoverflow.com/users/156458/tim"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 137, "favorite_count": 0, "answer_count": 1, "score": -3, "last_activity_date": 1564398996, "creation_date": 1564367927, "question_id": 57246616, "link": "https://stackoverflow.com/questions/57246616/what-kinds-of-recursions-are-used-in-the-definitions-of-foldr-and-foldl", "title": "What kinds of recursions are used in the definitions of `foldr` and `foldl`?", "body": "<pre><code>foldr   ::  (a  -&gt;  b   -&gt;  b)  -&gt;  b   -&gt;  [a] -&gt;  b\nfoldr   f   v   [] =    v\nfoldr   f   v   (x:xs)  =   f   x   (foldr  f   v   xs)\n</code></pre>\n\n<p>and</p>\n\n<pre><code>foldl   ::  (a  -&gt;  b   -&gt;  a)  -&gt;  a   -&gt;  [b] -&gt;  a\nfoldl   f   v   [] =    v\nfoldl   f   v   (x:xs)  =   foldl   f   (f  v   x)  xs\n</code></pre>\n\n<p>seem to use different kinds of recursions.</p>\n\n<p>What  kinds of recursions are used in the  definitions of <code>foldr</code> and <code>foldl</code>?</p>\n\n<p>Thanks.</p>\n"}, {"tags": ["haskell", "haskell-stack"], "comments": [{"owner": {"reputation": 100892, "user_id": 745903, "user_type": "registered", "accept_rate": 74, "profile_image": "https://www.gravatar.com/avatar/50933f6638836741e620669b3940410e?s=128&d=identicon&r=PG", "display_name": "leftaroundabout", "link": "https://stackoverflow.com/users/745903/leftaroundabout"}, "edited": false, "score": 0, "creation_date": 1564393648, "post_id": 57245036, "comment_id": 101002359, "body": "Perhaps the downvoters would care to explain what they dislike about this question?"}], "answers": [{"comments": [{"owner": {"reputation": 101, "user_id": 10515870, "user_type": "registered", "profile_image": "https://lh4.googleusercontent.com/-zSliZh5bm6g/AAAAAAAAAAI/AAAAAAAAAVU/c4vXo_Dxovg/photo.jpg?sz=128", "display_name": "Another Sad balloon", "link": "https://stackoverflow.com/users/10515870/another-sad-balloon"}, "edited": false, "score": 0, "creation_date": 1564424855, "post_id": 57247211, "comment_id": 101018260, "body": "Thanks for the information. Sorry that it should have been clear if I had read it."}], "tags": [], "owner": {"reputation": 7817, "user_id": 7345298, "user_type": "registered", "accept_rate": 50, "profile_image": "https://www.gravatar.com/avatar/9477d048c5c29b16307b3356146d497a?s=128&d=identicon&r=PG&f=1", "display_name": "bradrn", "link": "https://stackoverflow.com/users/7345298/bradrn"}, "is_accepted": true, "score": 2, "last_activity_date": 1564374643, "creation_date": 1564374643, "answer_id": 57247211, "question_id": 57245036, "link": "https://stackoverflow.com/questions/57245036/for-haskell-stack-i-cant-install-spock/57247211#57247211", "title": "For haskell stack I can&#39;t install Spock", "body": "<p>The important bit in this error is the following:</p>\n\n<blockquote>\n  <p>In the dependencies for Spock-0.13.0.0: Spock-core must match >=0.13, but the stack configuration has no specified version</p>\n</blockquote>\n\n<p>Basically, here is what is happening: The primary Haskell package repository is <a href=\"http://hackage.haskell.org/\" rel=\"nofollow noreferrer\">Hackage</a>. However, Stack gets its packages from its own repository, known as <a href=\"https://www.stackage.org/\" rel=\"nofollow noreferrer\">Stackage</a>. As the front page says:</p>\n\n<blockquote>\n  <p>A Stackage snapshot includes pinned package versions from Hackage \u2026 It is a curated set of packages that work well together</p>\n</blockquote>\n\n<p>However, Stackage has one major problem: it does not include every package in Hackage. This is indicated by the fact that that package has no specified version in the Stackage snapshot you are using. But that\u2019s what Stack\u2019s error message says! So in plain English, the error from Stack says that <code>Spock-core</code> is not included in your selected snapshot.</p>\n\n<p>So, how do we fix this? Well, it is possible to manually tell Stack which package version to use. And in fact, the instructions for doing so are included in the error message:</p>\n\n<blockquote>\n<pre><code>  * Recommended action: try adding the following to your extra-deps\n   in C:\\Windows\\system32\\stack.yaml:\n\n- Spock-core-0.13.0.0@sha256:06e007f23c47bdda52d2927da54160d73f1b6f51a977f3ca9087275698db8f0a\n- reroute-0.5.0.0@sha256:3360747cdc700c9808a38bff48b75926efa443d4af282396082329a218a8d9d3\n- stm-containers-0.2.16@sha256:e98efa8dcf0045ea8a78a04b4e2763cf2d8bc33aad0750e2f30a67f8f4e933b1\n</code></pre>\n</blockquote>\n\n<p>Here, <code>C:\\Windows\\system32\\stack.yaml</code> is the path of your global Stack configuration file. To get rid of the error, you need to open that file and find a line starting with <code>extra-deps:</code>. Then, delete that line and replace it with the following information, taken from the error message:</p>\n\n<pre><code>extra-deps:\n- Spock-core-0.13.0.0@sha256:06e007f23c47bdda52d2927da54160d73f1b6f51a977f3ca9087275698db8f0a\n- reroute-0.5.0.0@sha256:3360747cdc700c9808a38bff48b75926efa443d4af282396082329a218a8d9d3\n- stm-containers-0.2.16@sha256:e98efa8dcf0045ea8a78a04b4e2763cf2d8bc33aad0750e2f30a67f8f4e933b1\n</code></pre>\n\n<p>This informs Stack that you want to use version 0.13.0.0 of <code>Spock-core</code>, version 0.5.0.0 of <code>reroute</code>, and version 0.2.16 <code>stm-containers</code>. Normally Stack can figure this information out by itself using the information in the appropriate Stackage snapshot, but in this case the snapshot does not contain information about those three packages, which is why you have to specify this information yourself.</p>\n"}], "owner": {"reputation": 101, "user_id": 10515870, "user_type": "registered", "profile_image": "https://lh4.googleusercontent.com/-zSliZh5bm6g/AAAAAAAAAAI/AAAAAAAAAVU/c4vXo_Dxovg/photo.jpg?sz=128", "display_name": "Another Sad balloon", "link": "https://stackoverflow.com/users/10515870/another-sad-balloon"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 279, "favorite_count": 0, "accepted_answer_id": 57247211, "answer_count": 1, "score": 0, "last_activity_date": 1586479039, "creation_date": 1564348585, "last_edit_date": 1586479039, "question_id": 57245036, "link": "https://stackoverflow.com/questions/57245036/for-haskell-stack-i-cant-install-spock", "title": "For haskell stack I can&#39;t install Spock", "body": "<p>For Stack, it gives me this error(see it below) when I try to use stack install for Spock.</p>\n\n<p>I tried to install each one by themselves(individual packages) and it didn't work. \nI tried to follow with the answers in <a href=\"https://stackoverflow.com/questions/42142210/haskell-stack-package-installation-error\">Haskell Stack package installation error</a> and that didn't work either.</p>\n\n<pre><code>Error: While constructing the build plan, the following exceptions were encountered:\n\nIn the dependencies for Spock-0.13.0.0:\n    Spock-core must match &gt;=0.13, but the stack configuration has no specified version  (latest\n               matching version is 0.13.0.0)\n    reroute must match &gt;=0.5, but the stack configuration has no specified version  (latest matching\n            version is 0.5.0.0)\n    stm-containers must match &gt;=0.2 &amp;&amp; &lt;0.3, but the stack configuration has no specified version\n                   (latest matching version is 0.2.16)\nneeded since Spock is a build target.\n\nSome different approaches to resolving this:\n\n  * Consider trying 'stack solver', which uses the cabal-install solver to attempt to find some\n    working build configuration. This can be convenient when dealing with many complicated\n    constraint errors, but results may be unpredictable.\n\n  * Recommended action: try adding the following to your extra-deps\n    in C:\\Windows\\system32\\stack.yaml:\n\nSpock-core-0.13.0.0@sha256:06e007f23c47bdda52d2927da54160d73f1b6f51a977f3ca9087275698db8f0a\nreroute-0.5.0.0@sha256:3360747cdc700c9808a38bff48b75926efa443d4af282396082329a218a8d9d3\nstm-containers-0.2.16@sha256:e98efa8dcf0045ea8a78a04b4e2763cf2d8bc33aad0750e2f30a67f8f4e933b1\n\nPlan construction failed.\n</code></pre>\n\n<p>I want to be installed without error.</p>\n"}, {"tags": ["haskell"], "answers": [{"comments": [{"owner": {"reputation": 253903, "user_id": 9515207, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/34932d3e923ffad9a4a1423e30b1d9fc?s=128&d=identicon&r=PG&f=1", "display_name": "CertainPerformance", "link": "https://stackoverflow.com/users/9515207/certainperformance"}, "edited": false, "score": 2, "creation_date": 1564350428, "post_id": 57244590, "comment_id": 100991043, "body": "This was flagged and came up in review, you might consider adding a bit of explanation"}], "tags": [], "owner": {"reputation": 19307, "user_id": 1663462, "user_type": "registered", "accept_rate": 78, "profile_image": "https://www.gravatar.com/avatar/c30e0fa0f3a065c038c633a95066d299?s=128&d=identicon&r=PG", "display_name": "Chris Stryczynski", "link": "https://stackoverflow.com/users/1663462/chris-stryczynski"}, "is_accepted": true, "score": 0, "last_activity_date": 1564353171, "last_edit_date": 1564353171, "creation_date": 1564344630, "answer_id": 57244590, "question_id": 57244497, "link": "https://stackoverflow.com/questions/57244497/rainbox-library-how-can-i-set-no-default-background-colour-on-a-cell/57244590#57244590", "title": "Rainbox library - how can I set no/default background colour on a Cell?", "body": "<p>To create a 'default' text without additional color formatting:</p>\n\n<pre><code>import Rainbow.Types\n\ndefaultText :: Rainbow.Radiant\ndefaultText = Radiant (Color Nothing) (Color Nothing)\n</code></pre>\n"}], "owner": {"reputation": 19307, "user_id": 1663462, "user_type": "registered", "accept_rate": 78, "profile_image": "https://www.gravatar.com/avatar/c30e0fa0f3a065c038c633a95066d299?s=128&d=identicon&r=PG", "display_name": "Chris Stryczynski", "link": "https://stackoverflow.com/users/1663462/chris-stryczynski"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 29, "favorite_count": 0, "accepted_answer_id": 57244590, "answer_count": 1, "score": 0, "last_activity_date": 1564353171, "creation_date": 1564343891, "question_id": 57244497, "link": "https://stackoverflow.com/questions/57244497/rainbox-library-how-can-i-set-no-default-background-colour-on-a-cell", "title": "Rainbox library - how can I set no/default background colour on a Cell?", "body": "<p>When using a <code>Cell</code> how can I set no background colour?</p>\n\n<p><a href=\"http://hackage.haskell.org/package/rainbox-0.18.0.10/docs/Rainbox-Core.html#t:Cell\" rel=\"nofollow noreferrer\">http://hackage.haskell.org/package/rainbox-0.18.0.10/docs/Rainbox-Core.html#t:Cell</a></p>\n\n<pre><code>Cell\n  :: Data.Sequence.Internal.Seq\n       (Data.Sequence.Internal.Seq\n          (Rainbow.Types.Chunk Data.Text.Internal.Text))\n     -&gt; Alignment Horizontal\n     -&gt; Alignment Vertical\n     -&gt; Rainbow.Types.Radiant\n     -&gt; Cell\n</code></pre>\n\n<p>Alternatively is there some way I can determine the terminal's default background color? How would I then create a <code>Radient</code> type with this value?</p>\n"}, {"tags": ["haskell", "types", "typeclass", "type-mismatch", "typechecking"], "comments": [{"owner": {"reputation": 314794, "user_id": 67579, "user_type": "registered", "accept_rate": 81, "profile_image": "https://i.stack.imgur.com/BJXub.png?s=128&g=1", "display_name": "Willem Van Onsem", "link": "https://stackoverflow.com/users/67579/willem-van-onsem"}, "edited": false, "score": 3, "creation_date": 1564326599, "post_id": 57242142, "comment_id": 100985404, "body": "When you use a function with incorrect types. The reason why it does not complain about the first one is because you here define a &quot;subset&quot; type signature, that is fine. Whereas in the latter, that is not the case."}, {"owner": {"reputation": 11366, "user_id": 3922954, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/76ba47d2fdd24ab56b0b273cce2075e5?s=128&d=identicon&r=PG&f=1", "display_name": "AJF", "link": "https://stackoverflow.com/users/3922954/ajf"}, "edited": false, "score": 3, "creation_date": 1564335915, "post_id": 57242142, "comment_id": 100987630, "body": "The nicest way I&#39;ve found to think about this is that you can always make a type more specific than it needs to be, but you can&#39;t always make it more general. A spoon can be used for many things, but <i>my</i> spoon I choose to use only on ice-cream ;)"}, {"owner": {"reputation": 2019, "user_id": 5800895, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/0cab3b0361b7e54267c70c02754f21de?s=128&d=identicon&r=PG&f=1", "display_name": "Derek Elkins left SE", "link": "https://stackoverflow.com/users/5800895/derek-elkins-left-se"}, "reply_to_user": {"reputation": 314794, "user_id": 67579, "user_type": "registered", "accept_rate": 81, "profile_image": "https://i.stack.imgur.com/BJXub.png?s=128&g=1", "display_name": "Willem Van Onsem", "link": "https://stackoverflow.com/users/67579/willem-van-onsem"}, "edited": false, "score": 2, "creation_date": 1564372670, "post_id": 57242142, "comment_id": 100994529, "body": "@WillemVanOnsem &quot;Subset&quot; is a poor choice of word here (which is presumably why you put it in quotes). &quot;More restrictive&quot; which you use in your answer is much better. The technical term is <code>(a, a) -&gt; a</code> is an <i>instance</i> of <code>(a, b) -&gt; a</code>."}], "answers": [{"comments": [{"owner": {"reputation": 14537, "user_id": 7128034, "user_type": "registered", "accept_rate": 85, "profile_image": "https://i.stack.imgur.com/T8aRg.jpg?s=128&g=1", "display_name": "Dami&#225;n Rafael Lattenero", "link": "https://stackoverflow.com/users/7128034/dami%c3%a1n-rafael-lattenero"}, "edited": false, "score": 1, "creation_date": 1564337138, "post_id": 57242223, "comment_id": 100987982, "body": "Covers everything, nothing to add here, I wanted to answer adding something. But usually your answers are very good and complete."}], "tags": [], "owner": {"reputation": 314794, "user_id": 67579, "user_type": "registered", "accept_rate": 81, "profile_image": "https://i.stack.imgur.com/BJXub.png?s=128&g=1", "display_name": "Willem Van Onsem", "link": "https://stackoverflow.com/users/67579/willem-van-onsem"}, "is_accepted": true, "score": 32, "last_activity_date": 1564326987, "creation_date": 1564326987, "answer_id": 57242223, "question_id": 57242142, "link": "https://stackoverflow.com/questions/57242142/when-does-haskell-complain-about-incorrect-typing-in-functions/57242223#57242223", "title": "When does Haskell complain about incorrect typing in functions?", "body": "<p><code>fst</code> has as type <a href=\"https://hackage.haskell.org/package/base-4.12.0.0/docs/Prelude.html#v:fst\" rel=\"noreferrer\"><strong><code>fst :: (a, b) -&gt; a</code></strong></a> so that means it is fine to define a function:</p>\n\n<pre><code>fst' :: (a, a) -&gt; a\nfst' = fst\n</code></pre>\n\n<p>Your <code>fst'</code> function is <em>more restrictive</em> than the <code>fst</code> function. Regardless with what you replace <code>a</code> in your <code>fst'</code> function that is fine for <code>fst</code>. If for example <code>a ~ Bool</code> holds, then you call <code>fst</code> with signature <code>fst :: (Bool, Bool) -&gt; Bool</code>. But since <code>fst</code> can deal with all <code>a</code>s and <code>b</code>, it is fine that both elements of the tuple are <code>Bool</code>, so given <code>fst</code> can handle tuples for all possible types for both the first and the second item of the 2-tuple, it is defintely ok if the two items have the same type.</p>\n\n<p>The latter is <em>not</em> ok, here you define:</p>\n\n<pre><code>elem' :: (Eq a, Eq b) =&gt; a -&gt; [b] -&gt; Bool\nelem' = elem\n</code></pre>\n\n<p>but <code>elem</code> has type <a href=\"https://hackage.haskell.org/package/base-4.12.0.0/docs/GHC-List.html#v:elem\" rel=\"noreferrer\"><strong><code>elem :: Eq a =&gt; a -&gt; [a] -&gt; Bool</code></strong></a>. The signatures you can make with the <code>elem'</code> function are not a subset of the ones of the <code>elem</code> function, since you can set <code>a ~ Int</code> and <code>b ~ Bool</code>. In that case you expect <code>elem :: Int -&gt; [Bool] -&gt; Bool</code>, but evidently that does not hold, since the <code>Int</code> and <code>Bool</code> type are two different types, and in the <code>elem</code> signature, these are both <code>a</code>s.</p>\n"}], "owner": {"reputation": 317, "user_id": 4594041, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/2db3ea5590de7376bf2b0542f438a9ba?s=128&d=identicon&r=PG&f=1", "display_name": "user4132", "link": "https://stackoverflow.com/users/4594041/user4132"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 1063, "favorite_count": 1, "accepted_answer_id": 57242223, "answer_count": 1, "score": 21, "last_activity_date": 1564328236, "creation_date": 1564326482, "last_edit_date": 1564328236, "question_id": 57242142, "link": "https://stackoverflow.com/questions/57242142/when-does-haskell-complain-about-incorrect-typing-in-functions", "title": "When does Haskell complain about incorrect typing in functions?", "body": "<p>I am a Haskell newbie trying to wrap my head around type binding in functions and how Haskell enforces it. For example, even though the type for the <code>fst</code> function is <code>fst :: (a, b) -&gt; a</code>, the compiler does not complain for the function <code>fst'</code>. But the compiler complains about type bindings for the function <code>elem'</code>.</p>\n\n<pre><code>fst' :: (a,a) -&gt; a\nfst' s = fst s\n\nelem' :: (Eq a, Eq b) =&gt; a -&gt; [b] -&gt; Bool\nelem' x xs = elem x xs\n</code></pre>\n"}, {"tags": ["list", "haskell", "monads", "applicative"], "comments": [{"owner": {"reputation": 14030, "user_id": 8475054, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/edbf41c4b5aecb1a949936e06368a7c2?s=128&d=identicon&r=PG&f=1", "display_name": "Robin Zigmond", "link": "https://stackoverflow.com/users/8475054/robin-zigmond"}, "reply_to_user": {"reputation": 11366, "user_id": 3922954, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/76ba47d2fdd24ab56b0b273cce2075e5?s=128&d=identicon&r=PG&f=1", "display_name": "AJF", "link": "https://stackoverflow.com/users/3922954/ajf"}, "edited": false, "score": 3, "creation_date": 1564321079, "post_id": 57241265, "comment_id": 100984067, "body": "by <code>seqn</code> I assume you mean <a href=\"https://hackage.haskell.org/package/base-4.12.0.0/docs/Prelude.html#v:sequence\" rel=\"nofollow noreferrer\">sequence</a>? (I totally agree with @AJFarmar&#39;s comment too.)"}, {"owner": {"reputation": 44013, "user_id": 1477667, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/trgKM.jpg?s=128&g=1", "display_name": "dfeuer", "link": "https://stackoverflow.com/users/1477667/dfeuer"}, "reply_to_user": {"reputation": 14030, "user_id": 8475054, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/edbf41c4b5aecb1a949936e06368a7c2?s=128&d=identicon&r=PG&f=1", "display_name": "Robin Zigmond", "link": "https://stackoverflow.com/users/8475054/robin-zigmond"}, "edited": false, "score": 0, "creation_date": 1564330832, "post_id": 57241265, "comment_id": 100986446, "body": "@RobinZigmond, I should note that <code>sequence</code> and <code>mapM</code> aren&#39;t entirely vestigial. The stream fusion system for <code>vector</code>, for example, allows a better implementation of <code>mapM</code> than of <code>traverse</code>."}, {"owner": {"reputation": 61419, "user_id": 849891, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/MbEO3.png?s=128&g=1", "display_name": "Will Ness", "link": "https://stackoverflow.com/users/849891/will-ness"}, "edited": false, "score": 0, "creation_date": 1564379694, "post_id": 57241265, "comment_id": 100995984, "body": "the real question here it seems is, what exactly is <code>&lt;*&gt;</code> and how it can be related to the monadic <code>&gt;&gt;=</code>? of course this question only makes sense for types which have instances of both. in that case, <code>(&lt;*&gt;)</code> = <a href=\"https://hackage.haskell.org/package/base-4.12.0.0/docs/Control-Monad.html#v:ap\" rel=\"nofollow noreferrer\"><code>ap</code></a> (look at their types, they are exactly the same if we swap <code>Applicative</code> and <code>Monad</code> in their constraint (that part of a type which looks like <code>Monad a =&gt; ...</code>)). and <code>ap</code> <a href=\"https://hackage.haskell.org/package/base-4.12.0.0/docs/src/GHC.Base.html#liftM5\" rel=\"nofollow noreferrer\">is defined</a> in terms of <code>do</code>, i.e. <code>&gt;&gt;=</code>."}, {"owner": {"reputation": 61419, "user_id": 849891, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/MbEO3.png?s=128&g=1", "display_name": "Will Ness", "link": "https://stackoverflow.com/users/849891/will-ness"}, "edited": false, "score": 0, "creation_date": 1564379983, "post_id": 57241265, "comment_id": 100996058, "body": "<code>sequence</code> is <i>the</i> salient example with which <code>Applicative</code> was <a href=\"http://strictlypositive.org/Idiom.pdf\" rel=\"nofollow noreferrer\">originally introduced</a> / invented / discovered. you can search for &quot;difference between Monad and Applicative&quot; (here on SO, and elsewhere) for more context for this. here&#39;s <a href=\"https://stackoverflow.com/a/24467994/849891\">one example</a>."}, {"owner": {"reputation": 61419, "user_id": 849891, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/MbEO3.png?s=128&g=1", "display_name": "Will Ness", "link": "https://stackoverflow.com/users/849891/will-ness"}, "edited": false, "score": 0, "creation_date": 1564380422, "post_id": 57241265, "comment_id": 100996179, "body": "more about Monad / Applicative correspondence (a.o.t. difference) is e.g. <a href=\"https://stackoverflow.com/a/22117522/849891\">here</a>. But some types allow for a more specialized (more efficient, perhaps) implementation of <code>&lt;*&gt;</code> a.o.t. just using <code>ap</code>. For such types, <code>sequence</code> and <code>sequenceA</code> are not necessarily exactly the same thing. Does that answer your question?"}, {"owner": {"reputation": 61419, "user_id": 849891, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/MbEO3.png?s=128&g=1", "display_name": "Will Ness", "link": "https://stackoverflow.com/users/849891/will-ness"}, "edited": false, "score": 0, "creation_date": 1564398615, "post_id": 57241265, "comment_id": 101005025, "body": "and check out <a href=\"https://stackoverflow.com/a/57247698/849891\">this answer</a>!"}], "answers": [{"tags": [], "owner": {"reputation": 14537, "user_id": 7128034, "user_type": "registered", "accept_rate": 85, "profile_image": "https://i.stack.imgur.com/T8aRg.jpg?s=128&g=1", "display_name": "Dami&#225;n Rafael Lattenero", "link": "https://stackoverflow.com/users/7128034/dami%c3%a1n-rafael-lattenero"}, "is_accepted": false, "score": 3, "last_activity_date": 1564415510, "last_edit_date": 1564415510, "creation_date": 1564335427, "answer_id": 57243422, "question_id": 57241265, "link": "https://stackoverflow.com/questions/57241265/what-is-the-relation-and-difference-between-seqn-and-sequencea/57243422#57243422", "title": "What is the relation and difference between `seqn` and `sequenceA`?", "body": "<p>From the link at book (<a href=\"https://books.google.com.ar/books?id=75C5DAAAQBAJ&amp;pg=PA12&amp;dq=inauthor:%22Graham%20Hutton%22%20seqn&amp;hl=es&amp;sa=X&amp;ved=0ahUKEwiIlNGekdjjAhWgDrkGHc21CqkQ6AEIKzAA#v=onepage&amp;q=inauthor%3A%22Graham%20Hutton%22%20seqn&amp;f=false\" rel=\"nofollow noreferrer\">here</a>) you added, the type of <code>seqn</code> is:</p>\n\n<pre><code>seqn :: Monad m -&gt; [m a] -&gt; m [a]\n</code></pre>\n\n<p>and it's implementation is:</p>\n\n<pre><code>seqn [] = return []\nseqn (act:acts) = do \n                     x  &lt;- act \n                     xs &lt;- seqn acts\n                     return (x:xs)\n</code></pre>\n\n<p>And if you look at the type definition of <code>sequenceA</code>:</p>\n\n<pre><code>sequenceA :: (Traversable t, Applicative f) =&gt; t (f a) -&gt; f (t a)\n</code></pre>\n\n<p>is more general, since Monad is an applicative, and your implementation:</p>\n\n<pre><code>sequenceA []     = pure []\nsequenceA (x:xs) = pure (:) &lt;*&gt; x &lt;*&gt; sequenceA xs\n</code></pre>\n\n<p>is essentially the same as <code>seqn</code> </p>\n\n<blockquote>\n  <p>edit:</p>\n</blockquote>\n\n<p><strong>To answer the question in the comments</strong> \nI asked a new question to see the differences between one and another. Hope it helps:\n<a href=\"https://stackoverflow.com/questions/57247249/proving-equality-of-functions-from-applicative-and-monad\">Proving equality of functions from Applicative and Monad</a></p>\n\n<blockquote>\n  <p>to summarize </p>\n</blockquote>\n\n<p>There is no <code>do</code> notation for applicatives in Haskell, as you can read specifically in <a href=\"https://wiki.haskell.org/Do_notation_considered_harmful#Library_design\" rel=\"nofollow noreferrer\">this segment</a>. \n This is a very nice article: <a href=\"https://simonmar.github.io/bib/papers/applicativedo.pdf\" rel=\"nofollow noreferrer\">Desugaring Haskell\u2019s do-Notation into Applicative Operations</a>, and its main idea is how to desugar the <code>do</code> notation of monads into applicatives if you want to know.\n <code>return</code> and <code>pure</code> do exactly the same, but with different constraints, right?, so this part <code>pure (:)</code> and this part <code>return (x:xs)</code> you can see that are covered.\n  Then, here <code>x  &lt;- act</code> you are getting the value of <code>act</code>, and then the value of the recursion <code>xs &lt;- seqn acts</code> , to finally wrap it with the return.</p>\n\n<p>And that's what <code>pure (:) &lt;*&gt; x &lt;*&gt; sequenceA xs</code> is essentially doing. </p>\n"}], "owner": {"reputation": 1, "user_id": 156458, "user_type": "registered", "accept_rate": 47, "profile_image": "https://i.stack.imgur.com/3PCjR.png?s=128&g=1", "display_name": "Tim", "link": "https://stackoverflow.com/users/156458/tim"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 442, "favorite_count": 1, "answer_count": 1, "score": -2, "last_activity_date": 1572883400, "creation_date": 1564319764, "last_edit_date": 1572883400, "question_id": 57241265, "link": "https://stackoverflow.com/questions/57241265/what-is-the-relation-and-difference-between-seqn-and-sequencea", "title": "What is the relation and difference between `seqn` and `sequenceA`?", "body": "<pre><code>sequenceA :: Applicative f =&gt; [f a] -&gt; f [a]\nsequenceA []     = pure []\nsequenceA (x:xs) = pure (:) &lt;*&gt; x &lt;*&gt; sequenceA xs\n</code></pre>\n\n<p>From <a href=\"https://books.google.com/books?id=1xHPDAAAQBAJ&amp;lpg=PA12&amp;ots=J4QoW9kb4N&amp;dq=This%09flexibility%09is%09captured%09in%09Haskell%09by%09means%09of%09thefollowing%09more%09general%09type%3A&amp;pg=PA12#v=onepage&amp;q=This%09flexibility%09is%09captured%09in%09Haskell%09by%09means%09of%09thefollowing%09more%09general%09type:&amp;f=false\" rel=\"nofollow noreferrer\">Programming in Haskell by Hutton</a></p>\n\n<pre><code>seqn :: Monad m =&gt; [m a] -&gt; m [a]\n</code></pre>\n\n<p>and is its implementation</p>\n\n<pre><code>seqn [] = return [] \nseqn (act:acts) = do x&lt;- act \n                  xs &lt;- seqn acts \n                  return (x:xs)\n</code></pre>\n\n<p>What is the relation and difference between <code>seqn</code> and <code>sequenceA</code>?</p>\n\n<p>Since a monad is an applicative, is <code>seqn</code> the <code>sequenceA</code> limited to monad?</p>\n"}, {"tags": ["haskell", "monads"], "comments": [{"owner": {"reputation": 314794, "user_id": 67579, "user_type": "registered", "accept_rate": 81, "profile_image": "https://i.stack.imgur.com/BJXub.png?s=128&g=1", "display_name": "Willem Van Onsem", "link": "https://stackoverflow.com/users/67579/willem-van-onsem"}, "edited": false, "score": 0, "creation_date": 1564317115, "post_id": 57240919, "comment_id": 100983019, "body": "Because the bind operator is <code>concatMap</code> so it concatenates the results."}, {"owner": {"reputation": 100185, "user_id": 3234959, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/93bb12ca0f93dfddb33880316f7e66c2?s=128&d=identicon&r=PG&f=1", "display_name": "chi", "link": "https://stackoverflow.com/users/3234959/chi"}, "edited": false, "score": 0, "creation_date": 1564318179, "post_id": 57240919, "comment_id": 100983309, "body": "Your suggested result is invalid syntax: <code>[[x],[y]]</code> is a list of lists, <code>[[x]],[[y]]</code> does not mean anything. At best, we have <code>[[[x]],[[y]]]</code> which would be a list-of-lists-of-lists, but that has another type wrt <code>[[x],[y]]</code>."}, {"owner": {"reputation": 61419, "user_id": 849891, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/MbEO3.png?s=128&g=1", "display_name": "Will Ness", "link": "https://stackoverflow.com/users/849891/will-ness"}, "edited": false, "score": 0, "creation_date": 1564384729, "post_id": 57240919, "comment_id": 100997868, "body": "<a href=\"https://stackoverflow.com/a/51178620/849891\">for lists</a>, <code>join [a,b,c,...,n] == a ++ b ++ c ++ ... ++ n</code>, hence <code>join [[x],[],[y]] = [x] ++ [] ++ [y] = [x,y]</code>. how is this relevant? because <code>xs &gt;&gt;= foo = join (fmap foo xs)</code> (and hence, <code>= join (map foo xs) = concat (map foo xs) = concatMap foo xs</code>). <code>return x = [x]</code> &quot;injects&quot; an element <code>x</code> into the overall result (list). and <code>[]</code> injects nothing into the overall result (list)."}], "answers": [{"tags": [], "owner": {"reputation": 314794, "user_id": 67579, "user_type": "registered", "accept_rate": 81, "profile_image": "https://i.stack.imgur.com/BJXub.png?s=128&g=1", "display_name": "Willem Van Onsem", "link": "https://stackoverflow.com/users/67579/willem-van-onsem"}, "is_accepted": false, "score": 8, "last_activity_date": 1564318570, "last_edit_date": 1564318570, "creation_date": 1564317919, "answer_id": 57241033, "question_id": 57240919, "link": "https://stackoverflow.com/questions/57240919/in-filterm-why-is-return-if-b-then-xys-else-ys-evaluated-once-after-all-th/57241033#57241033", "title": "In filterM, why is `return (if b then x:ys else ys)` evaluated once after all the lists are created?", "body": "<p><strong>In short</strong>: because the bind function <code>(&gt;&gt;=)</code> for the <code>instance Monad []</code> is implement with <code><b>concat</b>Map</code>, not <code>map</code>.</p>\n\n<p>We can desugar the <code>do</code> block as:</p>\n\n<pre><code>filterM ::  Monad m =&gt; (a -&gt; m Bool) -&gt; [a] -&gt; m [a]\nfilterM p [] = return []\nfilterM p (x:xs) =  p x &gt;&gt;= \\b -&gt; (filterM p xs &gt;&gt;= \\ys -&gt; return (if b then x:ys else ys))</code></pre>\n\n<p>For <code>m ~ []</code>, the <code>&gt;&gt;=</code> function is equivalent to <code>flip concatMap</code>, and <code>return x</code> is equivalent to <code>[x]</code>, so that means that we can transform this, for a list, into:</p>\n\n<pre><code>filterM ::  (a -&gt; [Bool]) -&gt; [a] -&gt; [[a]]\nfilterM p [] = [[]]\nfilterM p (x:xs) = concatMap (\\b -&gt; concatMap (\\ys -&gt; [if b then (x:ys) else ys]) (filterM p xs)) (p x)</code></pre>\n\n<p>A <code>concatMap (\\x -&gt; [f x])</code> is equivalent to <code>map f</code>, since the concatenation of all these singleton lists will result in a list that contains the outcomes of <code>f</code> for all elements in the given list.</p>\n\n<p>It thus means that the above function is equivalent to:</p>\n\n<pre><code>filterM ::  (a -&gt; [Bool]) -&gt; [a] -&gt; [[a]]\nfilterM p [] = [[]]\nfilterM p (x:xs) = concatMap (\\b -&gt; map (\\ys -&gt; if b then (x:ys) else ys) (filterM p xs)) (p x)</code></pre>\n\n<p>If <code>p</code> is <code>\\_ -&gt; [True, False]</code>, it thus means we can replace <code>(p x)</code> with <code>[True, False]</code>, and thus obtain:</p>\n\n<pre><code>concatMap (\\b -&gt; map (\\ys -> if b then (x:ys) else ys) (filterM p xs)) [True, False]</code></pre>\n\n<p>This thus means that <code>concatMap</code> is the concatenation of two lists: one where <code>b</code> is <code>True</code>, and one where <code>b</code> is <code>False</code>, like:</p>\n\n<pre><code>map (\\ys -> (x:ys)) (filterM p xs) ++ map (\\ys -> ys) (filterM p xs)</code></pre>\n\n<p>The first <code>map</code> will thus prepend all the lists from <code>filterM p xs</code> with <code>x</code> whereas the second one will not. The above expression is thus equivalent to:</p>\n\n<pre><code>map (x:) (filterM p xs) ++ filterM p xs</code></pre>\n\n<p>if <code>filterM p xs</code> contains the powerset of <code>xs</code>, then the above expression will thus contain the powerset of <code>(x:xs)</code>.</p>\n"}], "owner": {"reputation": 1, "user_id": 156458, "user_type": "registered", "accept_rate": 47, "profile_image": "https://i.stack.imgur.com/3PCjR.png?s=128&g=1", "display_name": "Tim", "link": "https://stackoverflow.com/users/156458/tim"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 90, "favorite_count": 0, "answer_count": 1, "score": 1, "last_activity_date": 1564320258, "creation_date": 1564317044, "last_edit_date": 1564320258, "question_id": 57240919, "link": "https://stackoverflow.com/questions/57240919/in-filterm-why-is-return-if-b-then-xys-else-ys-evaluated-once-after-all-th", "title": "In filterM, why is `return (if b then x:ys else ys)` evaluated once after all the lists are created?", "body": "<pre><code>filterM :: Monad m =&gt; (a -&gt; m Bool) -&gt; [a] -&gt; m [a]\nfilterM p [] = return []\nfilterM p (x:xs) = do b &lt;- p x\n                      ys &lt;- filterM p xs\n                      return (if b then x:ys else ys)\n</code></pre>\n\n<p>and</p>\n\n<pre><code>&gt; filterM (\\x -&gt; [True,False]) [1,2,3]\n[[1,2,3],[1,2],[1,3],[1],[2,3],[2],[3],[]]\n</code></pre>\n\n<p>Is <code>return  (if b then x:ys else ys)</code>  evaluated  each time a list is created? Is yes, why isn't the result <code>[[1,2,3]],[[1,2]],[[1,3]],[[1]],[[2,3]],[[2]],[[3]],[[]]</code>?</p>\n\n<p>Does the result <code>[[1,2,3],[1,2],[1,3],[1],[2,3],[2],[3],[]]</code> imply that <code>return (if b then x:ys else ys)</code>  is  evaluated once after all the lists are created?</p>\n"}, {"tags": ["haskell"], "comments": [{"owner": {"user_type": "does_not_exist", "display_name": "user2956272"}, "edited": false, "score": 5, "creation_date": 1564280104, "post_id": 57237438, "comment_id": 100976853, "body": "Surely <code>animationOf</code> implementation applies it somewhere."}, {"owner": {"reputation": 100185, "user_id": 3234959, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/93bb12ca0f93dfddb33880316f7e66c2?s=128&d=identicon&r=PG&f=1", "display_name": "chi", "link": "https://stackoverflow.com/users/3234959/chi"}, "edited": false, "score": 5, "creation_date": 1564295333, "post_id": 57237438, "comment_id": 100978494, "body": "Functions are first-class values: they can be passed as arguments, returned as results, put into pairs/lists/other containers, etc. You do not have to apply a function immediately each time you mention it."}], "answers": [{"tags": [], "owner": {"reputation": 7817, "user_id": 7345298, "user_type": "registered", "accept_rate": 50, "profile_image": "https://www.gravatar.com/avatar/9477d048c5c29b16307b3356146d497a?s=128&d=identicon&r=PG&f=1", "display_name": "bradrn", "link": "https://stackoverflow.com/users/7345298/bradrn"}, "is_accepted": true, "score": 9, "last_activity_date": 1564282691, "creation_date": 1564282691, "answer_id": 57237610, "question_id": 57237438, "link": "https://stackoverflow.com/questions/57237438/how-does-haskell-code-works-without-applying-the-parameter/57237610#57237610", "title": "how does Haskell code works without applying the parameter?", "body": "<p>The <code>t</code> parameter is indeed never applied explicitly. However, you are correct in saying that <code>trafficController</code> needs <code>t</code> to be applied in order to work. What gives?</p>\n\n<p>In this case, the <code>animationOf</code> function is the key. Let\u2019s have a look at its type:</p>\n\n<pre class=\"lang-hs prettyprint-override\"><code>animationOf :: (Double -&gt; Picture) -&gt; IO ()\n</code></pre>\n\n<p>We can see that <code>animationOf</code> takes a function as its first parameter. Presumably, the implementation of <code>animationOf</code> takes this function, figures out the correct <code>Double</code> to use, applies this value to the function, and then draws the resulting <code>Picture</code> on the screen. (Since this is an animation, it probably does this multiple times.) So even though you never apply the parameter explicitly, <code>animationOf</code> does it for you.</p>\n"}], "owner": {"reputation": 1195, "user_id": 2814202, "user_type": "registered", "accept_rate": 89, "profile_image": "https://www.gravatar.com/avatar/c8e45b7eb53a10285dbc4195f61e9d83?s=128&d=identicon&r=PG&f=1", "display_name": "himekami", "link": "https://stackoverflow.com/users/2814202/himekami"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 102, "favorite_count": 0, "closed_date": 1564329986, "accepted_answer_id": 57237610, "answer_count": 1, "score": -1, "last_activity_date": 1564282691, "creation_date": 1564279779, "question_id": 57237438, "link": "https://stackoverflow.com/questions/57237438/how-does-haskell-code-works-without-applying-the-parameter", "closed_reason": "Duplicate", "title": "how does Haskell code works without applying the parameter?", "body": "<p>I encountered the following Haskell code:</p>\n\n<pre><code>trafficController :: Double -&gt; Picture\ntrafficController t\n | round (t/3) `mod` 2 == 0 = trafficLight True\n | otherwise                = trafficLight False\n\nmain :: IO ()\nmain = animationOf trafficController\n</code></pre>\n\n<p>I ran and it worked. But how can it be coz the 't' parameter was never applied ? </p>\n"}, {"tags": ["haskell", "proof", "liquid-haskell"], "answers": [{"tags": [], "owner": {"reputation": 730, "user_id": 2708711, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/13eb7bf6018c00d359233c47b63f43be?s=128&d=identicon&r=PG&f=1", "display_name": "Thales MG", "link": "https://stackoverflow.com/users/2708711/thales-mg"}, "is_accepted": true, "score": 0, "last_activity_date": 1565730631, "creation_date": 1565730631, "answer_id": 57485384, "question_id": 57236789, "link": "https://stackoverflow.com/questions/57236789/simple-congruence-proof-error-with-liquid-haskell-liquid-type-mismatch/57485384#57485384", "title": "Simple congruence proof error with Liquid Haskell - Liquid Type Mismatch", "body": "<p>I found out the problem. Theorem proving must be enabled in order for this to work.</p>\n\n<p>It can be enabled in the file (or as an argument to <code>liquid</code>) as follows:</p>\n\n<pre class=\"lang-hs prettyprint-override\"><code>{-@ LIQUID \"--reflection\" @-}\n\n{-@ type TRUE  = {v:Bool | v    } @-}\n{-@ type FALSE = {v:Bool | not v} @-}\n\n{-@ (==&gt;) :: p:Bool -&gt; q:Bool -&gt; {v:Bool | v &lt;=&gt; (p ==&gt; q)} @-}\nFalse ==&gt; False = True\nFalse ==&gt; True  = True\nTrue  ==&gt; True  = True\nTrue  ==&gt; False = False\n\n{-@ measure f :: Int -&gt; Int @-}\n{-@ congruence :: (f :: Int -&gt; Int) -&gt; Int -&gt; Int -&gt; TRUE @-}\ncongruence :: (Int -&gt; Int) -&gt; Int -&gt; Int -&gt; Bool\ncongruence f x y = (x == y) ==&gt; (f x == f y)\n</code></pre>\n\n<p>Then:</p>\n\n<pre><code>LiquidHaskell Version 0.8.6.0, Git revision f4fe82cd03fbe906379c8ebeac5ec3efae0b4cd8 (dirty) [develop@f4fe82cd03fbe906379c8ebeac5ec3efae0b4cd8 (Mon Jun 24 10:55:17 2019 +0200)] \nCopyright 2013-19 Regents of the University of California. All Rights Reserved.\n\nTargets: liquid.hs\n\n**** [Checking: liquid.hs] *****************************************************\n\n**** DONE:  A-Normalization ****************************************************\n\n\n**** DONE:  Extracted Core using GHC *******************************************\n\n\n**** DONE:  Transformed Core ***************************************************\n\nWorking 183% [========================================================================================================================]\n\n**** DONE:  annotate ***********************************************************\n\n\n**** RESULT: SAFE **************************************************************\n</code></pre>\n"}], "owner": {"reputation": 730, "user_id": 2708711, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/13eb7bf6018c00d359233c47b63f43be?s=128&d=identicon&r=PG&f=1", "display_name": "Thales MG", "link": "https://stackoverflow.com/users/2708711/thales-mg"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 148, "favorite_count": 1, "accepted_answer_id": 57485384, "answer_count": 1, "score": 7, "last_activity_date": 1565730631, "creation_date": 1564269810, "question_id": 57236789, "link": "https://stackoverflow.com/questions/57236789/simple-congruence-proof-error-with-liquid-haskell-liquid-type-mismatch", "title": "Simple congruence proof error with Liquid Haskell - Liquid Type Mismatch", "body": "<p>I'm following the <a href=\"https://ucsd-progsys.github.io/liquidhaskell-tutorial/\" rel=\"noreferrer\">official tutorial on Liquid Haskell</a>, and stumbled upon what seems to be a \"bug\" in it.</p>\n\n<p>The following code is <a href=\"https://ucsd-progsys.github.io/liquidhaskell-tutorial/02-logic.html\" rel=\"noreferrer\">present in the tutorial,</a> and Liquid Haskell was supposed to check that it is safe.</p>\n\n<pre class=\"lang-hs prettyprint-override\"><code>{-@ type TRUE  = {v:Bool | v    } @-}\n{-@ type FALSE = {v:Bool | not v} @-}\n\n{-@ (==&gt;) :: p:Bool -&gt; q:Bool -&gt; {v:Bool | v &lt;=&gt; (p ==&gt; q)} @-}\nFalse ==&gt; False = True\nFalse ==&gt; True  = True\nTrue  ==&gt; True  = True\nTrue  ==&gt; False = False\n\n{-@ measure f :: Int -&gt; Int @-}\n\n{-@ congruence :: (Int -&gt; Int) -&gt; Int -&gt; Int -&gt; TRUE @-}\ncongruence :: (Int -&gt; Int) -&gt; Int -&gt; Int -&gt; Bool\ncongruence f x y = (x == y) ==&gt; (f x == f y)\n</code></pre>\n\n<p>However, when checking the file I get:</p>\n\n<pre><code>**** RESULT: UNSAFE ************************************************************\n\n\n /tmp/liquid.hs:14:1-44: Error: Liquid Type Mismatch\n\n 14 | congruence f x y = (x == y) ==&gt; (f x == f y)\n      ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n\n   Inferred type\n     VV : {v : GHC.Types.Bool | v &lt;=&gt; (x == y =&gt; ?d == ?c)}\n\n   not a subtype of Required type\n     VV : {VV : GHC.Types.Bool | VV}\n\n   In Context\n     ?c : GHC.Types.Int\n\n     x : GHC.Types.Int\n\n     ?d : GHC.Types.Int\n\n     y : GHC.Types.Int\n</code></pre>\n\n<p>How can I check this property?</p>\n"}, {"tags": ["function", "haskell", "syntax", "definition", "guard-clause"], "answers": [{"comments": [{"owner": {"reputation": 1, "user_id": 156458, "user_type": "registered", "accept_rate": 47, "profile_image": "https://i.stack.imgur.com/3PCjR.png?s=128&g=1", "display_name": "Tim", "link": "https://stackoverflow.com/users/156458/tim"}, "edited": false, "score": 0, "creation_date": 1564268448, "post_id": 57236649, "comment_id": 100975595, "body": "Thanks. Do I have to indent for each guard? How many spaces for each indention?"}, {"owner": {"reputation": 7817, "user_id": 7345298, "user_type": "registered", "accept_rate": 50, "profile_image": "https://www.gravatar.com/avatar/9477d048c5c29b16307b3356146d497a?s=128&d=identicon&r=PG&f=1", "display_name": "bradrn", "link": "https://stackoverflow.com/users/7345298/bradrn"}, "reply_to_user": {"reputation": 1, "user_id": 156458, "user_type": "registered", "accept_rate": 47, "profile_image": "https://i.stack.imgur.com/3PCjR.png?s=128&g=1", "display_name": "Tim", "link": "https://stackoverflow.com/users/156458/tim"}, "edited": false, "score": 1, "creation_date": 1564268870, "post_id": 57236649, "comment_id": 100975657, "body": "@Tim It\u2019s a general rule of Haskell: the body of an expression should be indented further than the beginning of that expression. Haskell uses <i>indentation-based parsing</i>, which means that your indentation determines the structure of the program. (If you\u2019ve used Python, it\u2019s the same concept.) For more detail, have a look at <a href=\"https://en.wikibooks.org/wiki/Haskell/Indentation\" rel=\"nofollow noreferrer\">the Haskell Wikibook page on indentation</a>. And you can use any number of spaces; you just have to be consistent, otherwise the parser gets confused."}, {"owner": {"reputation": 126897, "user_id": 791604, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/ce991df7a056248d5e4f6fc3659ba733?s=128&d=identicon&r=PG", "display_name": "Daniel Wagner", "link": "https://stackoverflow.com/users/791604/daniel-wagner"}, "edited": false, "score": 2, "creation_date": 1564275250, "post_id": 57236649, "comment_id": 100976376, "body": "@bradrn In this particular case you need not be consistent. Guards are not separate lines of a block (they don&#39;t have implicit semicolons inserted), so they merely all need to be indented more than their enclosing block, but each may be indented by a different amount from that block if you like."}, {"owner": {"reputation": 7817, "user_id": 7345298, "user_type": "registered", "accept_rate": 50, "profile_image": "https://www.gravatar.com/avatar/9477d048c5c29b16307b3356146d497a?s=128&d=identicon&r=PG&f=1", "display_name": "bradrn", "link": "https://stackoverflow.com/users/7345298/bradrn"}, "reply_to_user": {"reputation": 126897, "user_id": 791604, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/ce991df7a056248d5e4f6fc3659ba733?s=128&d=identicon&r=PG", "display_name": "Daniel Wagner", "link": "https://stackoverflow.com/users/791604/daniel-wagner"}, "edited": false, "score": 0, "creation_date": 1564276344, "post_id": 57236649, "comment_id": 100976501, "body": "I didn\u2019t know that @DanielWagner \u2014 thanks for explaining!"}], "tags": [], "owner": {"reputation": 7817, "user_id": 7345298, "user_type": "registered", "accept_rate": 50, "profile_image": "https://www.gravatar.com/avatar/9477d048c5c29b16307b3356146d497a?s=128&d=identicon&r=PG&f=1", "display_name": "bradrn", "link": "https://stackoverflow.com/users/7345298/bradrn"}, "is_accepted": false, "score": 8, "last_activity_date": 1564268079, "creation_date": 1564268079, "answer_id": 57236649, "question_id": 57236600, "link": "https://stackoverflow.com/questions/57236600/why-parse-error-in-pattern-x-y-when-defining-a-function-by-guarded-equatio/57236649#57236649", "title": "Why &quot;Parse error in pattern: x &gt;= y&quot; when defining a function by guarded equation?", "body": "<p>Your syntax is wrong. Don\u2019t be confused by the fact that the prompt already contains <code>|</code>! What you\u2019ve written is the following:</p>\n\n<pre class=\"lang-hs prettyprint-override\"><code>maxThree :: Integer -&gt; Integer -&gt; Integer -&gt; Integer\nmaxThree x y z\nx &gt;= y &amp;&amp; x &gt;= z = x\ny &gt;= z = y\notherwise = z\n</code></pre>\n\n<p>As you can see, this is clearly <strong>wrong</strong>. Guards always start with a vertical bar <code>|</code>, but you\u2019ve left it out. I assume you got confused by the fact that the <code>Prelude|</code> prompt already contains <code>|</code>; that is part of the UI of GHCi, and is <strong>not</strong> considered to be part of the code you type in. If you want to type a guard into GHCi, do it like this:</p>\n\n<pre><code>Prelude&gt; :{\nPrelude| maxThree :: Integer -&gt; Integer -&gt; Integer -&gt; Integer\nPrelude| maxThree x y z\nPrelude|   | x &gt;= y &amp;&amp; x &gt;= z = x\nPrelude|   | y &gt;= z = y\nPrelude|   | otherwise = z\nPrelude| :}\n</code></pre>\n\n<p>Note how I have typed the code into GHCi <strong>exactly the same</strong> as I would type it into a file, including the fact that the guards need to be indented relative to the start of the definition.</p>\n"}], "owner": {"reputation": 1, "user_id": 156458, "user_type": "registered", "accept_rate": 47, "profile_image": "https://i.stack.imgur.com/3PCjR.png?s=128&g=1", "display_name": "Tim", "link": "https://stackoverflow.com/users/156458/tim"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 129, "favorite_count": 0, "answer_count": 1, "score": -1, "last_activity_date": 1564326939, "creation_date": 1564267441, "last_edit_date": 1564326939, "question_id": 57236600, "link": "https://stackoverflow.com/questions/57236600/why-parse-error-in-pattern-x-y-when-defining-a-function-by-guarded-equatio", "title": "Why &quot;Parse error in pattern: x &gt;= y&quot; when defining a function by guarded equation?", "body": "<p>I try to use guarded equation to define a function. Why does it not work in GHCi? Thanks.</p>\n\n<pre><code>Prelude&gt; :{\nPrelude| maxThree :: Integer -&gt; Integer -&gt; Integer -&gt; Integer\nPrelude| maxThree x y z\nPrelude| x &gt;= y &amp;&amp; x &gt;= z = x\nPrelude| y &gt;= z = y\nPrelude| otherwise = z\nPrelude| :}\n\n&lt;interactive&gt;:77:1: error: Parse error in pattern: x &gt;= y\n</code></pre>\n"}, {"tags": ["haskell"], "comments": [{"owner": {"reputation": 1155, "user_id": 962394, "user_type": "registered", "accept_rate": 42, "profile_image": "https://www.gravatar.com/avatar/97268298c366b07e5556567639105ee1?s=128&d=identicon&r=PG", "display_name": "codeshot", "link": "https://stackoverflow.com/users/962394/codeshot"}, "edited": false, "score": 0, "creation_date": 1564246306, "post_id": 57234168, "comment_id": 100970870, "body": "the best answer would be a link to a thesis or alternative nonstrict haskell-like programming language where the reasons have been eliminated and a sound system is described."}, {"owner": {"reputation": 100185, "user_id": 3234959, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/93bb12ca0f93dfddb33880316f7e66c2?s=128&d=identicon&r=PG&f=1", "display_name": "chi", "link": "https://stackoverflow.com/users/3234959/chi"}, "edited": false, "score": 1, "creation_date": 1564248343, "post_id": 57234168, "comment_id": 100971342, "body": "For the whole story, read Winskel&#39;s book on programming language semantics, where he defines eager and lazy denotational semantics for HOFL (a simple functional language). Lazy semantics lifts domains more than its eager variant -- that&#39;s the whole point of it. Haskell decided to be lazy instead of eager -- this is a design choice, and could have been done otherwise."}, {"owner": {"reputation": 1155, "user_id": 962394, "user_type": "registered", "accept_rate": 42, "profile_image": "https://www.gravatar.com/avatar/97268298c366b07e5556567639105ee1?s=128&d=identicon&r=PG", "display_name": "codeshot", "link": "https://stackoverflow.com/users/962394/codeshot"}, "reply_to_user": {"reputation": 100185, "user_id": 3234959, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/93bb12ca0f93dfddb33880316f7e66c2?s=128&d=identicon&r=PG&f=1", "display_name": "chi", "link": "https://stackoverflow.com/users/3234959/chi"}, "edited": false, "score": 0, "creation_date": 1564258247, "post_id": 57234168, "comment_id": 100973767, "body": "thanks chi, I&#39;ll add it to my list of books to study, but will it include the succinct list I&#39;m looking for? The succinct list and a statement that the book explains how each item forces type lifting would be a great answer!"}, {"owner": {"reputation": 100185, "user_id": 3234959, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/93bb12ca0f93dfddb33880316f7e66c2?s=128&d=identicon&r=PG&f=1", "display_name": "chi", "link": "https://stackoverflow.com/users/3234959/chi"}, "edited": false, "score": 0, "creation_date": 1564294971, "post_id": 57234168, "comment_id": 100978437, "body": "I don&#39;t think you&#39;ll find a list of &quot;reasons&quot;, since it&#39;s a design choice rather than something mandatory. In the book you see a definition for eager and lazy semantics, so you can see what happens if you lift domains (lazy) or not (eager). Haskell chose to be lazy, Ocaml chose to be eager."}, {"owner": {"reputation": 1155, "user_id": 962394, "user_type": "registered", "accept_rate": 42, "profile_image": "https://www.gravatar.com/avatar/97268298c366b07e5556567639105ee1?s=128&d=identicon&r=PG", "display_name": "codeshot", "link": "https://stackoverflow.com/users/962394/codeshot"}, "reply_to_user": {"reputation": 100185, "user_id": 3234959, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/93bb12ca0f93dfddb33880316f7e66c2?s=128&d=identicon&r=PG&f=1", "display_name": "chi", "link": "https://stackoverflow.com/users/3234959/chi"}, "edited": false, "score": 0, "creation_date": 1564295860, "post_id": 57234168, "comment_id": 100978576, "body": "@chi: &quot;no reason, the feature to allow it could be added&quot; would be a good answer."}], "answers": [{"comments": [{"owner": {"reputation": 14582, "user_id": 2225384, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/f30b04ed4d0b3fc4bc791a28815f34ca?s=128&d=identicon&r=PG", "display_name": "Rein Henrichs", "link": "https://stackoverflow.com/users/2225384/rein-henrichs"}, "edited": false, "score": 3, "creation_date": 1564248324, "post_id": 57234483, "comment_id": 100971339, "body": "There are lazy languages without bottom. It is a consequence of laziness and general recursion."}, {"owner": {"reputation": 24028, "user_id": 383200, "user_type": "registered", "accept_rate": 60, "profile_image": "https://www.gravatar.com/avatar/a9dc722f936cb1059adaae4fe39c07f0?s=128&d=identicon&r=PG", "display_name": "Carl", "link": "https://stackoverflow.com/users/383200/carl"}, "reply_to_user": {"reputation": 14582, "user_id": 2225384, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/f30b04ed4d0b3fc4bc791a28815f34ca?s=128&d=identicon&r=PG", "display_name": "Rein Henrichs", "link": "https://stackoverflow.com/users/2225384/rein-henrichs"}, "edited": false, "score": 0, "creation_date": 1564249621, "post_id": 57234483, "comment_id": 100971649, "body": "@Rein True, I&#39;ll add that in."}, {"owner": {"reputation": 1155, "user_id": 962394, "user_type": "registered", "accept_rate": 42, "profile_image": "https://www.gravatar.com/avatar/97268298c366b07e5556567639105ee1?s=128&d=identicon&r=PG", "display_name": "codeshot", "link": "https://stackoverflow.com/users/962394/codeshot"}, "edited": false, "score": 0, "creation_date": 1564256374, "post_id": 57234483, "comment_id": 100973365, "body": "I noticed that we always know a 2-tuple&#39;s constructor is <code>(,)</code>, so <code>fix id :: (a,b)</code> doesn&#39;t have to be <code>_|_</code> it can be <code>(_|_,_|_)</code> which means 2-tuples don&#39;t have to be occupied by bottom, so I think there must be a 3rd factor to conjoin with those two to explain it. In this case I already wonder if it&#39;s modularity that is added to force 2-tuples to be occupied by <code>_|_</code>."}, {"owner": {"reputation": 24509, "user_id": 6863749, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/UyoQv.jpg?s=128&g=1", "display_name": "Li-yao Xia", "link": "https://stackoverflow.com/users/6863749/li-yao-xia"}, "edited": false, "score": 0, "creation_date": 1564264735, "post_id": 57234483, "comment_id": 100975054, "body": "I&#39;m not sure that really changes much, you could say that just makes <code>(_|_,_|_)</code> the new bottom for products: <code>_|_ = (_|_, _|_)</code>."}, {"owner": {"reputation": 1155, "user_id": 962394, "user_type": "registered", "accept_rate": 42, "profile_image": "https://www.gravatar.com/avatar/97268298c366b07e5556567639105ee1?s=128&d=identicon&r=PG", "display_name": "codeshot", "link": "https://stackoverflow.com/users/962394/codeshot"}, "reply_to_user": {"reputation": 24509, "user_id": 6863749, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/UyoQv.jpg?s=128&g=1", "display_name": "Li-yao Xia", "link": "https://stackoverflow.com/users/6863749/li-yao-xia"}, "edited": false, "score": 0, "creation_date": 1564273050, "post_id": 57234483, "comment_id": 100976138, "body": "@Li-yaoXia, that&#39;s exactly the thrust of my question, why isn&#39;t it so - but I&#39;ve phrased it to get a complete answer that can be methodically examined without all the red-herrings in a full book, and rather than the incomplete status-quo answers we mostly have. To be a duplicate, this requested list would have to be available and that would be grand."}, {"owner": {"reputation": 24509, "user_id": 6863749, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/UyoQv.jpg?s=128&g=1", "display_name": "Li-yao Xia", "link": "https://stackoverflow.com/users/6863749/li-yao-xia"}, "edited": false, "score": 2, "creation_date": 1564277516, "post_id": 57234483, "comment_id": 100976616, "body": "An answer as clear cut as what you&#39;re asking for sounds like it could be at least a research paper worth of work..."}, {"owner": {"reputation": 1155, "user_id": 962394, "user_type": "registered", "accept_rate": 42, "profile_image": "https://www.gravatar.com/avatar/97268298c366b07e5556567639105ee1?s=128&d=identicon&r=PG", "display_name": "codeshot", "link": "https://stackoverflow.com/users/962394/codeshot"}, "reply_to_user": {"reputation": 24509, "user_id": 6863749, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/UyoQv.jpg?s=128&g=1", "display_name": "Li-yao Xia", "link": "https://stackoverflow.com/users/6863749/li-yao-xia"}, "edited": false, "score": 0, "creation_date": 1564318076, "post_id": 57234483, "comment_id": 100983271, "body": "@Li-yaoXia, perhaps someone has read or written that research paper and a link to it would be a good answer."}, {"owner": {"reputation": 1155, "user_id": 962394, "user_type": "registered", "accept_rate": 42, "profile_image": "https://www.gravatar.com/avatar/97268298c366b07e5556567639105ee1?s=128&d=identicon&r=PG", "display_name": "codeshot", "link": "https://stackoverflow.com/users/962394/codeshot"}, "edited": false, "score": 0, "creation_date": 1564331593, "post_id": 57234483, "comment_id": 100986615, "body": "@Carl, See Chris Smith&#39;s answer where he points out that newtypes are not occupied by <code>_|_</code> but they can still be used in general recursion with laziness."}, {"owner": {"reputation": 14582, "user_id": 2225384, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/f30b04ed4d0b3fc4bc791a28815f34ca?s=128&d=identicon&r=PG", "display_name": "Rein Henrichs", "link": "https://stackoverflow.com/users/2225384/rein-henrichs"}, "edited": false, "score": 0, "creation_date": 1564355110, "post_id": 57234483, "comment_id": 100991844, "body": "<code>fix id :: a</code> is a valid value of type <code>(a,b)</code> and its implementation cannot produce a tuple of any kind. Perhaps the 3rd factor you are looking for is parametricity. A language with typecase could, perhaps, behave as you suggest."}, {"owner": {"reputation": 1155, "user_id": 962394, "user_type": "registered", "accept_rate": 42, "profile_image": "https://www.gravatar.com/avatar/97268298c366b07e5556567639105ee1?s=128&d=identicon&r=PG", "display_name": "codeshot", "link": "https://stackoverflow.com/users/962394/codeshot"}, "reply_to_user": {"reputation": 14582, "user_id": 2225384, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/f30b04ed4d0b3fc4bc791a28815f34ca?s=128&d=identicon&r=PG", "display_name": "Rein Henrichs", "link": "https://stackoverflow.com/users/2225384/rein-henrichs"}, "edited": false, "score": 0, "creation_date": 1564522534, "post_id": 57234483, "comment_id": 101056950, "body": "@ReinHenrichs, thanks, how does parametricity prevent <code>fix id :: (a,b)</code> from being <code>(undefined::a,undefined::b)</code> ie, preventing unlifted <code>(a,b)</code>?"}, {"owner": {"reputation": 14582, "user_id": 2225384, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/f30b04ed4d0b3fc4bc791a28815f34ca?s=128&d=identicon&r=PG", "display_name": "Rein Henrichs", "link": "https://stackoverflow.com/users/2225384/rein-henrichs"}, "edited": false, "score": 0, "creation_date": 1564543921, "post_id": 57234483, "comment_id": 101061163, "body": "It doesn&#39;t. As I said, it prevents <code>(undefined, undefined)</code> from being a value of type <code>forall a. a</code>. You can&#39;t define <code>bottom :: a; bottom = (undefined, undefined)</code>."}, {"owner": {"reputation": 1155, "user_id": 962394, "user_type": "registered", "accept_rate": 42, "profile_image": "https://www.gravatar.com/avatar/97268298c366b07e5556567639105ee1?s=128&d=identicon&r=PG", "display_name": "codeshot", "link": "https://stackoverflow.com/users/962394/codeshot"}, "edited": false, "score": 0, "creation_date": 1566419689, "post_id": 57234483, "comment_id": 101654892, "body": "if tuples were unlifted then you could define leastDefined :: a; leastDefined = let x = x in x. Then leastDefined :: (a,b) would equal (leastDefined,leastDefined)"}], "tags": [], "owner": {"reputation": 24028, "user_id": 383200, "user_type": "registered", "accept_rate": 60, "profile_image": "https://www.gravatar.com/avatar/a9dc722f936cb1059adaae4fe39c07f0?s=128&d=identicon&r=PG", "display_name": "Carl", "link": "https://stackoverflow.com/users/383200/carl"}, "is_accepted": false, "score": 5, "last_activity_date": 1564249834, "last_edit_date": 1564249834, "creation_date": 1564248256, "answer_id": 57234483, "question_id": 57234168, "link": "https://stackoverflow.com/questions/57234168/why-is-every-haskell-type-lifted-ie-occupied-by/57234483#57234483", "title": "why is every haskell type lifted (ie, occupied by _|_)?", "body": "<p>It's a direct consequence of laziness and general recursion. All* values may be unevaluated expressions in the presence of laziness. All unevaluated expressions might diverge in the presence of general recursion. When evaluation diverges, the value is bottom.</p>\n\n<p>*There are contexts where you might have a value that's known to be evaluated already, such as coming from pattern matching on a constructor with a strict field. But for every (lifted) type there are ways to generate unevaluated values of that type. <code>undefined :: a</code> is one such way. </p>\n"}, {"comments": [{"owner": {"reputation": 1155, "user_id": 962394, "user_type": "registered", "accept_rate": 42, "profile_image": "https://www.gravatar.com/avatar/97268298c366b07e5556567639105ee1?s=128&d=identicon&r=PG", "display_name": "codeshot", "link": "https://stackoverflow.com/users/962394/codeshot"}, "edited": false, "score": 0, "creation_date": 1564271778, "post_id": 57236592, "comment_id": 100975995, "body": "That&#39;s very interesting, I wondered about them, but I didn&#39;t check because <code>fix id :: GHC.Prim.Int#</code> is an invalid expression due to <code>fix id</code> not unifying with unlifted types and I was sure it would unify with a newtype (and it does now that I check)."}, {"owner": {"reputation": 1155, "user_id": 962394, "user_type": "registered", "accept_rate": 42, "profile_image": "https://www.gravatar.com/avatar/97268298c366b07e5556567639105ee1?s=128&d=identicon&r=PG", "display_name": "codeshot", "link": "https://stackoverflow.com/users/962394/codeshot"}, "edited": false, "score": 0, "creation_date": 1564271837, "post_id": 57236592, "comment_id": 100976003, "body": "If only newtypes could have more than one field... how close we are to sanity"}, {"owner": {"reputation": 1155, "user_id": 962394, "user_type": "registered", "accept_rate": 42, "profile_image": "https://www.gravatar.com/avatar/97268298c366b07e5556567639105ee1?s=128&d=identicon&r=PG", "display_name": "codeshot", "link": "https://stackoverflow.com/users/962394/codeshot"}, "edited": false, "score": 0, "creation_date": 1564271904, "post_id": 57236592, "comment_id": 100976012, "body": "not quite all types: (let x = x in x) :: Int# ----- Couldn&#39;t match a lifted type with an unlifted type ...."}, {"owner": {"reputation": 1155, "user_id": 962394, "user_type": "registered", "accept_rate": 42, "profile_image": "https://www.gravatar.com/avatar/97268298c366b07e5556567639105ee1?s=128&d=identicon&r=PG", "display_name": "codeshot", "link": "https://stackoverflow.com/users/962394/codeshot"}, "edited": false, "score": 0, "creation_date": 1564272428, "post_id": 57236592, "comment_id": 100976075, "body": "I edited the question to qualify it to &quot;data type&quot; instead of just &quot;type&quot; but you deserve positive karma for your response."}, {"owner": {"reputation": 1155, "user_id": 962394, "user_type": "registered", "accept_rate": 42, "profile_image": "https://www.gravatar.com/avatar/97268298c366b07e5556567639105ee1?s=128&d=identicon&r=PG", "display_name": "codeshot", "link": "https://stackoverflow.com/users/962394/codeshot"}, "edited": false, "score": 0, "creation_date": 1564274497, "post_id": 57236592, "comment_id": 100976277, "body": "The fact that <code>fix id :: SomeUnliftedType</code> is an error because <code>fix id</code> is only for lifted types is going to be a key part of the answer to this question but it will still lead to a &quot;Well, why doesn&#39;t it work for unlifted types if it can work for newtypes?&quot;"}, {"owner": {"reputation": 1155, "user_id": 962394, "user_type": "registered", "accept_rate": 42, "profile_image": "https://www.gravatar.com/avatar/97268298c366b07e5556567639105ee1?s=128&d=identicon&r=PG", "display_name": "codeshot", "link": "https://stackoverflow.com/users/962394/codeshot"}, "edited": false, "score": 0, "creation_date": 1564332940, "post_id": 57236592, "comment_id": 100986910, "body": "I&#39;ve selected this answer because it shows that there&#39;s no reason for it to be how it seems to be (by pointing out that it&#39;s not like that)."}], "tags": [], "owner": {"reputation": 2501, "user_id": 598892, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/8a22954b638ce69b9994c9e3623953a5?s=128&d=identicon&r=PG", "display_name": "Chris Smith", "link": "https://stackoverflow.com/users/598892/chris-smith"}, "is_accepted": true, "score": 2, "last_activity_date": 1564267380, "creation_date": 1564267380, "answer_id": 57236592, "question_id": 57234168, "link": "https://stackoverflow.com/questions/57234168/why-is-every-haskell-type-lifted-ie-occupied-by/57236592#57236592", "title": "why is every haskell type lifted (ie, occupied by _|_)?", "body": "<p>There's a sense in which it's not true that all types are inhabited by <code>_|_</code>.  For example, given:</p>\n\n<pre><code>newtype Foo = Foo Int\n</code></pre>\n\n<p>The least element of this type is <code>Foo _|_</code>.  This is significant because pattern matching on <code>Foo</code> never fails, even for <code>undefined</code>.  This is still a least element of the type, and indeed all Haskell types must have a least element.  The reason is that even if you didn't have <code>undefined</code> and <code>error</code> in the standard library, you still need to have a value for <code>let x = x in x</code>, which is a term built from pretty fundamental language constructs, and that inhabits all types.</p>\n"}], "owner": {"reputation": 1155, "user_id": 962394, "user_type": "registered", "accept_rate": 42, "profile_image": "https://www.gravatar.com/avatar/97268298c366b07e5556567639105ee1?s=128&d=identicon&r=PG", "display_name": "codeshot", "link": "https://stackoverflow.com/users/962394/codeshot"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 220, "favorite_count": 0, "accepted_answer_id": 57236592, "answer_count": 2, "score": 3, "last_activity_date": 1564355666, "creation_date": 1564245999, "last_edit_date": 1564355666, "question_id": 57234168, "link": "https://stackoverflow.com/questions/57234168/why-is-every-haskell-type-lifted-ie-occupied-by", "title": "why is every haskell type lifted (ie, occupied by _|_)?", "body": "<p>Why is every non-primitive haskell data type lifted (ie, occupied by <code>_|_</code>)?</p>\n\n<p>I've heard one reason is the existence and semantics of <code>seq</code> but I've never seen a full explanation why that makes them all be occupied by <code>_|_</code> - ie why none of them may be unoccupied by <code>_|_</code>.</p>\n\n<p>In addition to that, what other reasons are there?</p>\n"}, {"tags": ["haskell", "fold"], "comments": [{"owner": {"reputation": 78982, "user_id": 1848654, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/84180c0f3c9c04f8b8f0613fc0129dac?s=128&d=identicon&r=PG", "display_name": "melpomene", "link": "https://stackoverflow.com/users/1848654/melpomene"}, "edited": false, "score": 6, "creation_date": 1564244784, "post_id": 57233949, "comment_id": 100970503, "body": "<code>foldr (.) (+3) [(*2), (+5)]</code> is <code>(*2) . (+5) . (+3)</code>."}, {"owner": {"reputation": 107, "user_id": 6372779, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/9e401543f81aff24fd4c6667b01fcfd6?s=128&d=identicon&r=PG&f=1", "display_name": "dark_knight94", "link": "https://stackoverflow.com/users/6372779/dark-knight94"}, "reply_to_user": {"reputation": 78982, "user_id": 1848654, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/84180c0f3c9c04f8b8f0613fc0129dac?s=128&d=identicon&r=PG", "display_name": "melpomene", "link": "https://stackoverflow.com/users/1848654/melpomene"}, "edited": false, "score": 0, "creation_date": 1564247835, "post_id": 57233949, "comment_id": 100971229, "body": "@melpomene Thanks for the quick response :) ok now that i understand, but when we change the <code>foldr</code> to <code>foldl</code>, is it still the same thing then or does the order change? Thanks again!"}, {"owner": {"reputation": 314794, "user_id": 67579, "user_type": "registered", "accept_rate": 81, "profile_image": "https://i.stack.imgur.com/BJXub.png?s=128&g=1", "display_name": "Willem Van Onsem", "link": "https://stackoverflow.com/users/67579/willem-van-onsem"}, "edited": false, "score": 0, "creation_date": 1564248495, "post_id": 57233949, "comment_id": 100971388, "body": "@AchrafRAGUI: no, the it is <code>(+3) . (*2) . (+5)</code>."}, {"owner": {"reputation": 107, "user_id": 6372779, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/9e401543f81aff24fd4c6667b01fcfd6?s=128&d=identicon&r=PG&f=1", "display_name": "dark_knight94", "link": "https://stackoverflow.com/users/6372779/dark-knight94"}, "reply_to_user": {"reputation": 314794, "user_id": 67579, "user_type": "registered", "accept_rate": 81, "profile_image": "https://i.stack.imgur.com/BJXub.png?s=128&g=1", "display_name": "Willem Van Onsem", "link": "https://stackoverflow.com/users/67579/willem-van-onsem"}, "edited": false, "score": 0, "creation_date": 1564248904, "post_id": 57233949, "comment_id": 100971500, "body": "@WillemVanOnsem That was my guess also for that, but then i don&#39;t  quiet get the order of the <code>foldr</code>, because with <code>foldl</code> it makes sense, since it goes from left to right, but with <code>foldr</code> it doesn&#39;t go from right to left: like <code>(+5) . (*2) . (+3)</code>. Can you please explain to me that a bit more? I really appreciate it"}, {"owner": {"reputation": 314794, "user_id": 67579, "user_type": "registered", "accept_rate": 81, "profile_image": "https://i.stack.imgur.com/BJXub.png?s=128&g=1", "display_name": "Willem Van Onsem", "link": "https://stackoverflow.com/users/67579/willem-van-onsem"}, "edited": false, "score": 0, "creation_date": 1564248985, "post_id": 57233949, "comment_id": 100971506, "body": "<code>foldl</code> conceptually works left-to-right, and replaces the empty list (the end of the list) with <code>z</code>. <code>foldr</code> works right-to-left."}, {"owner": {"reputation": 507143, "user_id": 1048572, "user_type": "registered", "accept_rate": 77, "profile_image": "https://www.gravatar.com/avatar/7f2c4de95e8f4f8f5a71c3aaf0ed312a?s=128&d=identicon&r=PG", "display_name": "Bergi", "link": "https://stackoverflow.com/users/1048572/bergi"}, "edited": false, "score": 1, "creation_date": 1564249897, "post_id": 57233949, "comment_id": 100971706, "body": "@AchrafRAGUI The difference between <code>foldl</code> and <code>foldr</code> is <code>((((+3)) . (*2)) . (+5))</code> vs <code>((*2) . ((+5) . ((+3))))</code>, not the direction of the list traversal. To achieve that, you&#39;d <code>reverse</code> the list or <code>flip</code> the <code>(.)</code> combinator."}, {"owner": {"reputation": 107, "user_id": 6372779, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/9e401543f81aff24fd4c6667b01fcfd6?s=128&d=identicon&r=PG&f=1", "display_name": "dark_knight94", "link": "https://stackoverflow.com/users/6372779/dark-knight94"}, "reply_to_user": {"reputation": 507143, "user_id": 1048572, "user_type": "registered", "accept_rate": 77, "profile_image": "https://www.gravatar.com/avatar/7f2c4de95e8f4f8f5a71c3aaf0ed312a?s=128&d=identicon&r=PG", "display_name": "Bergi", "link": "https://stackoverflow.com/users/1048572/bergi"}, "edited": false, "score": 0, "creation_date": 1564251242, "post_id": 57233949, "comment_id": 100972065, "body": "@Bergi ah ok that makes much more sense now. Thanks so much for the explanation"}], "answers": [{"tags": [], "owner": {"reputation": 26848, "user_id": 683453, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/263366f6318ce617f95d7282883402c0?s=128&d=identicon&r=PG", "display_name": "Philip JF", "link": "https://stackoverflow.com/users/683453/philip-jf"}, "is_accepted": true, "score": 4, "last_activity_date": 1564249017, "creation_date": 1564249017, "answer_id": 57234579, "question_id": 57233949, "link": "https://stackoverflow.com/questions/57233949/how-does-the-foldr-function-in-haskell-work-in-this-case/57234579#57234579", "title": "How does the foldr function in haskell work in this case?", "body": "<p>Comments might have already solved this for you. However, if not:</p>\n\n<p>(.) is function composition:</p>\n\n<pre><code>f . g\n= \\x -&gt; f $ g $ x\n= \\x -&gt; f (g x).\n</code></pre>\n\n<p>Forms like <code>(* 2)</code> are sugar for functions of the form <code>\\x -&gt; x * 2</code></p>\n\n<p>Now, observe that</p>\n\n<pre><code>foldr op base [a,b]\n</code></pre>\n\n<p>is the same as</p>\n\n<pre><code>a `op` (b `op` base)\n</code></pre>\n\n<p>of course, this works for higher numbers of arguments as well. For instance,</p>\n\n<pre><code>foldr (+) 0 [1,2,3,4,5]\n</code></pre>\n\n<p>is just</p>\n\n<pre><code>1 + 2 + 3 + 4 + 5 + 0\n</code></pre>\n\n<p>In your case, you ask about</p>\n\n<pre><code>foldr (.) (+3) [(*2), (+5)]\n</code></pre>\n\n<p>which is (for <code>Integer</code>)</p>\n\n<pre><code>(*2) . (+5) . (+3)\n= \\x -&gt; (*2) $ (+5) $ (+3) $ x\n= \\x -&gt; (*2) $ (+5) $ x + 3\n= \\x -&gt; (*2) $ x + 3 + 5\n= \\x -&gt; (x + 3 + 5) * 2\n= \\x -&gt; x*2 + 16\n</code></pre>\n\n<p>and so</p>\n\n<pre><code>foldr (.) (+3) [(*2), (+5)] 13\n= (\\x -&gt; x*2 + 16) 13\n= 13*2 + 16\n= 26 + 16\n= 42\n</code></pre>\n"}, {"tags": [], "owner": {"reputation": 314794, "user_id": 67579, "user_type": "registered", "accept_rate": 81, "profile_image": "https://i.stack.imgur.com/BJXub.png?s=128&g=1", "display_name": "Willem Van Onsem", "link": "https://stackoverflow.com/users/67579/willem-van-onsem"}, "is_accepted": false, "score": 2, "last_activity_date": 1564249585, "last_edit_date": 1564249585, "creation_date": 1564249205, "answer_id": 57234599, "question_id": 57233949, "link": "https://stackoverflow.com/questions/57233949/how-does-the-foldr-function-in-haskell-work-in-this-case/57234599#57234599", "title": "How does the foldr function in haskell work in this case?", "body": "<p><code>foldr f z</code> can be seen as replacing the \"cons\" <code>(:)</code> of the list with <code>f</code>, and the empty list with <code>z</code>. This thus means that <code>foldr f z [x<sub>1</sub>, x<sub>2</sub> &hellip; x<sub>n</sub>]</code> is equivalent to <code>f x<sub>1</sub> (f x<sub>2</sub> ( &hellip; (f x<sub>n</sub> z) &hellip; ))</code></p>\n\n<p><code>[(*2), (+5)]</code> is syntactical sugar for <code>(:) (*2) ((:) (+5)  [])</code>, so we can replace this with: <code>(.) (*2) ((.) (+5)  (+3))</code>, which is a verbose form of <code>(*2) . (+5) . (+3)</code>. This is thus a function. If we make a function application with this function and <code>13</code> as argument, we get:</p>\n\n<pre><code>   ((*2) . (+5) . (+3)) 13\n-&gt; ((*2) . (+5)) 16\n-&gt; (*2) 21\n-&gt; 42\n</code></pre>\n\n<p><code>foldl f z [x<sub>1</sub>, x<sub>2</sub> &hellip; x<sub>n</sub>]</code> is equivalent to <code>f (&hellip; (f (f z x<sub>1</sub>) x<sub>2</sub>) &hellip; ) x<sub>n</sub></code>. So here that means <code>foldl (.) (+3) [(*2), (+5)]</code> is equivalent to <code>(.) ((.) (+3) (*2)) (+5)</code>, or less verbose <code>(+3) . (*2) . (+5)</code>. If we evaluate this for <code>13</code>, we obtain:</p>\n\n<pre><code>   ((+3) . (*2) . (+5)) 13\n-&gt; ((+3) . (*2)) 18\n-&gt; (+3) 36\n-&gt; 39\n</code></pre>\n"}, {"tags": [], "owner": {"reputation": 14537, "user_id": 7128034, "user_type": "registered", "accept_rate": 85, "profile_image": "https://i.stack.imgur.com/T8aRg.jpg?s=128&g=1", "display_name": "Dami&#225;n Rafael Lattenero", "link": "https://stackoverflow.com/users/7128034/dami%c3%a1n-rafael-lattenero"}, "is_accepted": false, "score": 0, "last_activity_date": 1564263667, "creation_date": 1564263667, "answer_id": 57236281, "question_id": 57233949, "link": "https://stackoverflow.com/questions/57233949/how-does-the-foldr-function-in-haskell-work-in-this-case/57236281#57236281", "title": "How does the foldr function in haskell work in this case?", "body": "<p>In Haskell (and in lambda calculus) you can do <a href=\"https://wiki.haskell.org/Eta_conversion\" rel=\"nofollow noreferrer\">Eta reduction</a></p>\n\n<p>In the example you shown, the long way to write would be:</p>\n\n<pre><code>foldr (\\f h -&gt; f . h) (\\x -&gt; x+3) [(\\x -&gt; x*2), (\\x-&gt;x+5)] 13\n</code></pre>\n\n<p>Now you can apply Eta reduction one by one like this:</p>\n\n<pre><code>(\\f h -&gt; f . h)\n(\\f -&gt; (f.))\n(.)\n</code></pre>\n\n<p>next:</p>\n\n<pre><code>(\\x -&gt; x+3)\n(+3)\n</code></pre>\n\n<p>(\\x -> x*2), (\\x->x+5) are so similar to (+3)</p>\n\n<p>so finally you get you equivalent expression:</p>\n\n<pre><code>foldr (.) (+3) [(*2), (+5)]\n</code></pre>\n\n<p>and that means, compose each function, and when the list is empty, apply (+3)</p>\n"}], "owner": {"reputation": 107, "user_id": 6372779, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/9e401543f81aff24fd4c6667b01fcfd6?s=128&d=identicon&r=PG&f=1", "display_name": "dark_knight94", "link": "https://stackoverflow.com/users/6372779/dark-knight94"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 142, "favorite_count": 0, "accepted_answer_id": 57234579, "answer_count": 3, "score": 2, "last_activity_date": 1564263667, "creation_date": 1564244326, "question_id": 57233949, "link": "https://stackoverflow.com/questions/57233949/how-does-the-foldr-function-in-haskell-work-in-this-case", "title": "How does the foldr function in haskell work in this case?", "body": "<p>So I'm new to haskell and I kind of encountered this following expression which i don't quiet get how it works:\n<code>foldr (.) (+3) [(*2), (+5)] 13</code>\nit gives out the result: 42\nnow i know that <code>foldr</code> normally works in an example like: <code>foldr (+) 0 [1,2,3]</code> like: <code>(1+(2+(0+3)))</code> but with adding another function <code>(.)</code> I kind of got confused.\nSo please if any of you could explain to me exactly how haskell interprets this expression that would be great, thanks!</p>\n"}, {"tags": ["haskell", "applicative"], "comments": [{"owner": {"reputation": 78982, "user_id": 1848654, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/84180c0f3c9c04f8b8f0613fc0129dac?s=128&d=identicon&r=PG", "display_name": "melpomene", "link": "https://stackoverflow.com/users/1848654/melpomene"}, "edited": false, "score": 0, "creation_date": 1564237850, "post_id": 57232971, "comment_id": 100968742, "body": "What&#39;s with the random spacing?"}, {"owner": {"reputation": 11366, "user_id": 3922954, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/76ba47d2fdd24ab56b0b273cce2075e5?s=128&d=identicon&r=PG&f=1", "display_name": "AJF", "link": "https://stackoverflow.com/users/3922954/ajf"}, "edited": false, "score": 6, "creation_date": 1564239567, "post_id": 57232971, "comment_id": 100969172, "body": "The code uses tabs in <i>every single space</i>. As a general rule, tabs break the Haskell parser, so you shouldn&#39;t use them <i>at all</i>. I&#39;ve edited the code to use spaces and more consistent spacing in general."}, {"owner": {"reputation": 11366, "user_id": 3922954, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/76ba47d2fdd24ab56b0b273cce2075e5?s=128&d=identicon&r=PG&f=1", "display_name": "AJF", "link": "https://stackoverflow.com/users/3922954/ajf"}, "edited": false, "score": 7, "creation_date": 1564239681, "post_id": 57232971, "comment_id": 100969209, "body": "<code>sequenceA</code> is described and explained in the <a href=\"https://hackage.haskell.org/package/base-4.12.0.0/docs/Prelude.html#v:sequenceA\" rel=\"nofollow noreferrer\">prelude documentation on Hackage</a> as well as <a href=\"https://stackoverflow.com/questions/34629132/how-sequencea-works\">various past questions</a>. This question is lacking in research effort."}, {"owner": {"reputation": 61419, "user_id": 849891, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/MbEO3.png?s=128&g=1", "display_name": "Will Ness", "link": "https://stackoverflow.com/users/849891/will-ness"}, "edited": false, "score": 0, "creation_date": 1564249699, "post_id": 57232971, "comment_id": 100971671, "body": "according to what you wrote in a recent question, <code>sequenceA (x:xs) = pure (:) &lt;*&gt; x &lt;*&gt; sequenceA xs = liftA2 (:) x (sequenceA xs) = [ x : xs | x &lt;- x, xs &lt;- sequenceA xs]</code>. thus <code>sequenceA (replicate 3 getChar) = [ x : xs | x &lt;- getChar, xs &lt;- sequenceA [getChar,getChar]] = [[x,y,z] | x &lt;- getChar, y &lt;- getChar, z &lt;- getChar]</code>. this uses MonadComprehensions."}, {"owner": {"reputation": 1, "user_id": 156458, "user_type": "registered", "accept_rate": 47, "profile_image": "https://i.stack.imgur.com/3PCjR.png?s=128&g=1", "display_name": "Tim", "link": "https://stackoverflow.com/users/156458/tim"}, "reply_to_user": {"reputation": 61419, "user_id": 849891, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/MbEO3.png?s=128&g=1", "display_name": "Will Ness", "link": "https://stackoverflow.com/users/849891/will-ness"}, "edited": false, "score": 0, "creation_date": 1564268618, "post_id": 57232971, "comment_id": 100975618, "body": "@WillNess Thanks. (1) How did you get <code>liftA2 (:) x (sequenceA xs) = [ x : xs | x &lt;- x, xs &lt;- sequenceA xs]</code>? (2)  What is monad comprehension?"}, {"owner": {"reputation": 7817, "user_id": 7345298, "user_type": "registered", "accept_rate": 50, "profile_image": "https://www.gravatar.com/avatar/9477d048c5c29b16307b3356146d497a?s=128&d=identicon&r=PG&f=1", "display_name": "bradrn", "link": "https://stackoverflow.com/users/7345298/bradrn"}, "edited": false, "score": 0, "creation_date": 1564269492, "post_id": 57232971, "comment_id": 100975756, "body": "@Tim For (2), it\u2019s a language extension allowing list comprehensions to be used for arbitrary monads. As for (1), it\u2019s a simple equivalence originating from the definitions of <code>liftA2</code> and monad comprehensions."}, {"owner": {"reputation": 1, "user_id": 156458, "user_type": "registered", "accept_rate": 47, "profile_image": "https://i.stack.imgur.com/3PCjR.png?s=128&g=1", "display_name": "Tim", "link": "https://stackoverflow.com/users/156458/tim"}, "reply_to_user": {"reputation": 7817, "user_id": 7345298, "user_type": "registered", "accept_rate": 50, "profile_image": "https://www.gravatar.com/avatar/9477d048c5c29b16307b3356146d497a?s=128&d=identicon&r=PG&f=1", "display_name": "bradrn", "link": "https://stackoverflow.com/users/7345298/bradrn"}, "edited": false, "score": 0, "creation_date": 1564280120, "post_id": 57232971, "comment_id": 100976854, "body": "@bradrn Is the result  of monad comprehension a list? Since it is a generalization of list comprehension, is it correct that it shouldn&#39;t output list? But <code>[ x : xs | x &lt;- x, xs &lt;- sequenceA xs]</code> seems to be a list."}, {"owner": {"reputation": 7817, "user_id": 7345298, "user_type": "registered", "accept_rate": 50, "profile_image": "https://www.gravatar.com/avatar/9477d048c5c29b16307b3356146d497a?s=128&d=identicon&r=PG&f=1", "display_name": "bradrn", "link": "https://stackoverflow.com/users/7345298/bradrn"}, "edited": false, "score": 0, "creation_date": 1564281040, "post_id": 57232971, "comment_id": 100976943, "body": "@Tim The result of a monad comprehension is whatever monad you\u2019re using. If <code>x</code> and <code>xs</code> are lists, then <code>[ x : xs | x &lt;- x, xs &lt;- sequenceA xs]</code> will also be a list. If they\u2019re some other monad, the output will also be that monad."}, {"owner": {"reputation": 1, "user_id": 156458, "user_type": "registered", "accept_rate": 47, "profile_image": "https://i.stack.imgur.com/3PCjR.png?s=128&g=1", "display_name": "Tim", "link": "https://stackoverflow.com/users/156458/tim"}, "reply_to_user": {"reputation": 7817, "user_id": 7345298, "user_type": "registered", "accept_rate": 50, "profile_image": "https://www.gravatar.com/avatar/9477d048c5c29b16307b3356146d497a?s=128&d=identicon&r=PG&f=1", "display_name": "bradrn", "link": "https://stackoverflow.com/users/7345298/bradrn"}, "edited": false, "score": 0, "creation_date": 1564281512, "post_id": 57232971, "comment_id": 100976991, "body": "@bradrn So <code>[...]</code> in <code>[ x : xs | x &lt;- x, xs &lt;- sequenceA xs]</code> doesn&#39;t necessarily mean list, and different from <code>[...]</code> (which represents a list) in Haskell language?"}, {"owner": {"reputation": 7817, "user_id": 7345298, "user_type": "registered", "accept_rate": 50, "profile_image": "https://www.gravatar.com/avatar/9477d048c5c29b16307b3356146d497a?s=128&d=identicon&r=PG&f=1", "display_name": "bradrn", "link": "https://stackoverflow.com/users/7345298/bradrn"}, "edited": false, "score": 1, "creation_date": 1564281701, "post_id": 57232971, "comment_id": 100977015, "body": "@Tim It depends. List comprehensions were originally designed only for lists, so I presume that <code>[...]</code> originally denoted that it was a <i>list</i> comprehension. By default, this is what Haskell uses. However, if you enable the <code>MonadComprehensions</code> extension, then you can use the same syntax for arbitrary monads. So if you use that extension, <code>[...]</code> is best thought of as just part of the syntax than having any particular meaning."}, {"owner": {"reputation": 61419, "user_id": 849891, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/MbEO3.png?s=128&g=1", "display_name": "Will Ness", "link": "https://stackoverflow.com/users/849891/will-ness"}, "edited": false, "score": 0, "creation_date": 1564287320, "post_id": 57232971, "comment_id": 100977539, "body": "@Tim &quot;Is the result of monad comprehension a list?&quot; why don&#39;t you try <code>GHCi&gt; :set -XMonadComprehensions</code> ; <code>GHCi&gt; :t [[x,y,z] | x &lt;- getChar, y &lt;- getChar, z &lt;- getChar]</code> and find out? -- Googling <a href=\"https://www.google.com/search?q=MonadComprehensions\" rel=\"nofollow noreferrer\">&quot;MonadComprehensions&quot;</a> leads to e.g. <a href=\"https://gitlab.haskell.org/ghc/ghc/wikis/monad-comprehensions\" rel=\"nofollow noreferrer\">gitlab.haskell.org/ghc/ghc/wikis/monad-comprehensions</a>."}, {"owner": {"reputation": 61419, "user_id": 849891, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/MbEO3.png?s=128&g=1", "display_name": "Will Ness", "link": "https://stackoverflow.com/users/849891/will-ness"}, "edited": false, "score": 0, "creation_date": 1564299581, "post_id": 57232971, "comment_id": 100979291, "body": "then there&#39;s <a href=\"https://ncatlab.org/nlab/files/WadlerMonads.pdf\" rel=\"nofollow noreferrer\">the original paper</a> and <a href=\"https://downloads.haskell.org/~ghc/latest/docs/html/users_guide/glasgow_exts.html?highlight=parallellist#monad-comprehensions\" rel=\"nofollow noreferrer\">the docs</a>."}, {"owner": {"reputation": 61419, "user_id": 849891, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/MbEO3.png?s=128&g=1", "display_name": "Will Ness", "link": "https://stackoverflow.com/users/849891/will-ness"}, "edited": false, "score": 0, "creation_date": 1564301995, "post_id": 57232971, "comment_id": 100979771, "body": "as to the <i>why</i>, <code>pure (:) &lt;*&gt; x = (:) &lt;$&gt; x = fmap (:) x</code> and hence <code>pure (:) &lt;*&gt; x &lt;*&gt; sequenceA xs = fmap (:) x &lt;*&gt; sequenceA xs = {- by def of &lt;*&gt; -} do { fx &lt;- fmap (:) x ; xs &lt;- sequenceA xs; return fx xs } = do { x &lt;- x ; let fx = (:) x ; xs &lt;- sequenceA xs; return fx xs } = do { x &lt;- x ; xs &lt;- sequenceA xs; return (x : xs) } = [ (x : xs) | x &lt;- x, xs &lt;- sequenceA xs]</code>. All the above of course only holds for such Applicative Functors that are also Monads. Such that are not, have to implement it directly. But it is nevertheless illuminating to see these translations, I think."}], "answers": [{"tags": [], "owner": {"reputation": 54, "user_id": 11840352, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/f4781c5e8c21e3e9ca03ad14c423d231?s=128&d=identicon&r=PG&f=1", "display_name": "mariusz-r", "link": "https://stackoverflow.com/users/11840352/mariusz-r"}, "is_accepted": false, "score": 2, "last_activity_date": 1564244035, "creation_date": 1564244035, "answer_id": 57233911, "question_id": 57232971, "link": "https://stackoverflow.com/questions/57232971/what-does-sequenceareplicatengetchar-do/57233911#57233911", "title": "What does `sequenceA\t(replicate\tn\tgetChar)` do?", "body": "<p><code>sequenceA (replicate n getChar)</code> will wait for <code>n</code> characters from standard input and return them as <code>String</code> (list of <code>Char</code>) wrapped into <code>IO</code>. <code>sequenceA</code> will just evaluate (run in case of IO) the actions in the traversable and collect the results.</p>\n"}, {"tags": [], "owner": {"reputation": 7817, "user_id": 7345298, "user_type": "registered", "accept_rate": 50, "profile_image": "https://www.gravatar.com/avatar/9477d048c5c29b16307b3356146d497a?s=128&d=identicon&r=PG&f=1", "display_name": "bradrn", "link": "https://stackoverflow.com/users/7345298/bradrn"}, "is_accepted": false, "score": 1, "last_activity_date": 1564270315, "creation_date": 1564270315, "answer_id": 57236826, "question_id": 57232971, "link": "https://stackoverflow.com/questions/57232971/what-does-sequenceareplicatengetchar-do/57236826#57236826", "title": "What does `sequenceA\t(replicate\tn\tgetChar)` do?", "body": "<p>(This answer assumes you know what an <code>Applicative</code> is; if you don\u2019t, <a href=\"http://learnyouahaskell.com/functors-applicative-functors-and-monoids\" rel=\"nofollow noreferrer\">Learn You a Haskell</a> may be a useful resource.)</p>\n\n<p>Roughly speaking, <code>sequenceA</code> is a method of taking several <code>Applicative</code> values and running them. To start, let\u2019s have a look at its type signature. You\u2019ve defined a restricted version, but the full type signature is:</p>\n\n<pre class=\"lang-hs prettyprint-override\"><code>sequenceA :: (Traversable t, Applicative f) =&gt; t (f a) -&gt; f (t a)\n</code></pre>\n\n<p>In general, Haskell allows you to learn a lot about a function from its type signature alone, and this is no exception. To start, let\u2019s have a look at its input and output: it takes as input a <code>Traversable</code> containing <code>Applicative</code> elements, and returns an <code>Applicative</code> containing <code>Traversible</code> elements.</p>\n\n<p>Now, how can we get from <code>t (f a)</code> to <code>f (t a)</code>? This may be easier to understand if you <em>specialise</em> <code>t</code> to <code>[]</code>, as that is an instance of <code>Traversible</code>:</p>\n\n<pre class=\"lang-hs prettyprint-override\"><code>sequenceA :: (Applicative f) =&gt; [f a] -&gt; f [a]\n</code></pre>\n\n<p>Now this starts to make more sense: given a list of <code>f a</code>s, extract the <code>a</code>s and return them as a list. The idea is that a value of type <code>f x</code>, where <code>f</code> is an <code>Applicative</code>, is an <em>effectful value</em>: a value which could potentially have some side-effects, but then returns a value of type <code>x</code>. So <code>sequenceA</code> acts to <strong>accumulate</strong> effects: if you have a list of effectful values <code>[f a]</code>, then <code>sequenceA</code> takes each <code>f a</code> in sequence, runs its effect, then returns all the <code>a</code>s together. It returns these values as an effectful list, since to return <code>[a]</code> it has to run the effects inside the original list.</p>\n\n<p>Now let\u2019s go back to the original definition:</p>\n\n<pre class=\"lang-hs prettyprint-override\"><code>sequenceA :: (Traversable t, Applicative f) =&gt; t (f a) -&gt; f (t a)\n</code></pre>\n\n<p>We can interpret this in the same way: given a set of effectful values inside a <code>Traversible</code> data structure, <code>sequenceA</code> returns an effectful value created by running all the effects inside the <code>Traversible</code> in turn, then taking the return value thus generated and putting it back inside the <code>Traversible</code>. The idea of \u2018in turn\u2019 is very important: in some sense, the <code>Traversible</code> instance (and hence <code>sequenceA</code>, as one of its methods) <em>creates</em> the idea of an order inside a data structure, since there aren\u2019t really any other Haskell functions which iterate over a data structure in some particular order.</p>\n\n<p>Now, we can finally understand your example! Let\u2019s consider what <code>sequenceA (replicate n getChar)</code> does:</p>\n\n<ul>\n<li>As you noted, <code>replicate n getChar</code> repeats a list of <code>[getChar, getChar, ..., getChar]</code> <em>n</em> times.</li>\n<li><p>From the above description:</p>\n\n<blockquote>\n  <p><code>sequenceA</code> returns an effectful value created by running all the effects inside the <code>Traversible</code> in turn, then taking the return value thus generated and putting it back inside the <code>Traversible</code>.</p>\n</blockquote>\n\n<p>So here, we take the list of <code>getChar</code>s, run each effectful value (which has the effect of getting a character from the user and returning it), then taking the return value (i.e. the user\u2019s character) and putting it back inside the <code>Traversible</code> (i.e. putting the return values back in a list).</p></li>\n</ul>\n\n<p>So <code>sequenceA (replicate n getChar)</code> just gets <em>n</em> characters from the user, then returns them in a list.</p>\n\n<p>It\u2019s worth noting that this is far from the only use for <code>sequenceA</code>. A small sample:</p>\n\n<ul>\n<li>The <code>Applicative</code> instance for lists takes each pair in turn from the give lists. For instance, <code>(,) &lt;$&gt; [1,2] &lt;*&gt; ['a','b']</code> returns <code>[(1,'a'),(1,'b'),(2,'a'),(2,'b')]</code>. So <code>sequenceA [list1, list2, ...]</code> gets all combinations of elements i.e. the cartesian produce! For example, <code>sequenceA [['a','b'], ['c','d'], ['e','f']]</code> \u2018runs\u2019 the applicative by returning each combination, and then puts the results back in a list, giving <code>[\"ace\",\"acf\",\"ade\",\"adf\",\"bce\",\"bcf\",\"bde\",\"bdf\"]</code>.</li>\n<li>In general, any time you have a collection of effects you want to run, you should be reaching for <code>sequenceA</code>. (Or its close relative <code>traverse</code>.) For example, recently I was writing a cellular automaton simulation program, and I had ended up with a data structure representing a grid with random elements. Since I was using the <code>MonadRandom</code> package, my randomness was represented as an <code>Applicative</code>, so I could use <code>sequenceA</code> to run each random value in turn and turn a \u2018grid of random values\u2019 into a \u2018random grid of values\u2019, which was much easier to work with.</li>\n</ul>\n"}], "owner": {"reputation": 1, "user_id": 156458, "user_type": "registered", "accept_rate": 47, "profile_image": "https://i.stack.imgur.com/3PCjR.png?s=128&g=1", "display_name": "Tim", "link": "https://stackoverflow.com/users/156458/tim"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 191, "favorite_count": 0, "answer_count": 2, "score": -4, "last_activity_date": 1564270315, "creation_date": 1564237019, "last_edit_date": 1564239565, "question_id": 57232971, "link": "https://stackoverflow.com/questions/57232971/what-does-sequenceareplicatengetchar-do", "title": "What does `sequenceA\t(replicate\tn\tgetChar)` do?", "body": "<pre><code>sequenceA :: Applicative f =&gt; [f a] -&gt; f [a]\nsequenceA []     = pure []\nsequenceA (x:xs) = pure (:) &lt;*&gt; x &lt;*&gt; sequenceA xs\n</code></pre>\n\n<p>which can be used for example:</p>\n\n<pre><code>getChars :: Int -&gt; IO String\ngetChars n = sequenceA (replicate n getChar)\n</code></pre>\n\n<p><code>replicate n getChar</code> outputs <code>[getChar, getChar, ...]</code> of type <code>[IO Char]</code>.</p>\n\n<p>What does <code>sequenceA (replicate n getChar)</code> do ?</p>\n\n<p>In general what does <code>sequenceA</code> do?</p>\n"}, {"tags": ["list", "haskell"], "comments": [{"owner": {"reputation": 14030, "user_id": 8475054, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/edbf41c4b5aecb1a949936e06368a7c2?s=128&d=identicon&r=PG&f=1", "display_name": "Robin Zigmond", "link": "https://stackoverflow.com/users/8475054/robin-zigmond"}, "edited": false, "score": 0, "creation_date": 1564233761, "post_id": 57232537, "comment_id": 100967720, "body": "They both represent lists, and in fact are exactly the same pattern. <code>[&#39;a&#39;,_]</code> is syntactic sugar for <code>(a:_)</code> [Actually that&#39;s not quite true: <code>[&#39;a&#39;,_]</code> is a list of exactly 2 elements whose first is <code>a</code>, whereas the other is a list of any length which starts with <code>a</code>.]"}, {"owner": {"reputation": 314794, "user_id": 67579, "user_type": "registered", "accept_rate": 81, "profile_image": "https://i.stack.imgur.com/BJXub.png?s=128&g=1", "display_name": "Willem Van Onsem", "link": "https://stackoverflow.com/users/67579/willem-van-onsem"}, "edited": false, "score": 0, "creation_date": 1564233880, "post_id": 57232537, "comment_id": 100967754, "body": "The <code>(:)</code> is a data constructor of a list."}, {"owner": {"reputation": 61419, "user_id": 849891, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/MbEO3.png?s=128&g=1", "display_name": "Will Ness", "link": "https://stackoverflow.com/users/849891/will-ness"}, "edited": false, "score": 0, "creation_date": 1564235769, "post_id": 57232537, "comment_id": 100968200, "body": "<code>( , , , )</code> are tuples, <code>[ , , , ]</code> are lists; parentheses have many uses and brackets have few."}, {"owner": {"reputation": 384463, "user_id": 1126841, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/fa05233b2357f8d11c22ef4cfc7bb85c?s=128&d=identicon&r=PG", "display_name": "chepner", "link": "https://stackoverflow.com/users/1126841/chepner"}, "edited": false, "score": 2, "creation_date": 1564252371, "post_id": 57232537, "comment_id": 100972360, "body": "No  comma, no tuple."}], "answers": [{"comments": [{"owner": {"reputation": 14030, "user_id": 8475054, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/edbf41c4b5aecb1a949936e06368a7c2?s=128&d=identicon&r=PG&f=1", "display_name": "Robin Zigmond", "link": "https://stackoverflow.com/users/8475054/robin-zigmond"}, "edited": false, "score": 3, "creation_date": 1564234482, "post_id": 57232607, "comment_id": 100967902, "body": "I actually always think of the &quot;unit type&quot; <code>()</code> as indeed being a tuple, just one with zero elements. That&#39;s still a type with exactly one (non-bottom) value. And I think the wiki article you linked suggests this interpretation is legitimate. (But I don&#39;t think the OP was actually talking about unit when referring to <code>()</code>, they were just referring to the fact that tuples in general use parentheses. At least that&#39;s my interpretation.)"}, {"owner": {"reputation": 314794, "user_id": 67579, "user_type": "registered", "accept_rate": 81, "profile_image": "https://i.stack.imgur.com/BJXub.png?s=128&g=1", "display_name": "Willem Van Onsem", "link": "https://stackoverflow.com/users/67579/willem-van-onsem"}, "reply_to_user": {"reputation": 14030, "user_id": 8475054, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/edbf41c4b5aecb1a949936e06368a7c2?s=128&d=identicon&r=PG&f=1", "display_name": "Robin Zigmond", "link": "https://stackoverflow.com/users/8475054/robin-zigmond"}, "edited": false, "score": 0, "creation_date": 1564234689, "post_id": 57232607, "comment_id": 100967942, "body": "@RobinZigmond: one can indeed interpret it as an 0-tuple, since logically speaking an 0-tuple would have one data constructor with no parameters, and thus have one possible value. It is even defined in <code>GHC.Tuple</code> :)"}, {"owner": {"reputation": 14030, "user_id": 8475054, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/edbf41c4b5aecb1a949936e06368a7c2?s=128&d=identicon&r=PG&f=1", "display_name": "Robin Zigmond", "link": "https://stackoverflow.com/users/8475054/robin-zigmond"}, "edited": false, "score": 0, "creation_date": 1564234812, "post_id": 57232607, "comment_id": 100967968, "body": "Agreed - so I was surprised with your explicit insistence that <code>()</code> &quot;is not a tuple&quot;."}, {"owner": {"reputation": 61419, "user_id": 849891, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/MbEO3.png?s=128&g=1", "display_name": "Will Ness", "link": "https://stackoverflow.com/users/849891/will-ness"}, "reply_to_user": {"reputation": 14030, "user_id": 8475054, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/edbf41c4b5aecb1a949936e06368a7c2?s=128&d=identicon&r=PG&f=1", "display_name": "Robin Zigmond", "link": "https://stackoverflow.com/users/8475054/robin-zigmond"}, "edited": false, "score": 1, "creation_date": 1564235456, "post_id": 57232607, "comment_id": 100968121, "body": "@RobinZigmond moreover, in the algebra of types <code>(,)</code> is a product, and 1 is the multiplication&#39;s identity element (<code>a = a*1</code> ; <code>a &lt;--&gt; (a,())</code>). so it all ties up together nicely."}], "tags": [], "owner": {"reputation": 314794, "user_id": 67579, "user_type": "registered", "accept_rate": 81, "profile_image": "https://i.stack.imgur.com/BJXub.png?s=128&g=1", "display_name": "Willem Van Onsem", "link": "https://stackoverflow.com/users/67579/willem-van-onsem"}, "is_accepted": true, "score": 8, "last_activity_date": 1564234677, "last_edit_date": 1564234677, "creation_date": 1564234237, "answer_id": 57232607, "question_id": 57232537, "link": "https://stackoverflow.com/questions/57232537/does-a-represent-a-tuple-or-a-list/57232607#57232607", "title": "Does `(&#39;a&#39;:_)` represent a tuple or a list?", "body": "<blockquote>\n  <p>Does the second use <code>('a':_)</code> to represent a tuple or a list? </p>\n</blockquote>\n\n<p>A <strong>list</strong>.</p>\n\n<blockquote>\n  <p>If a list, doesn't <code>()</code> represent a tuple and how can it represent a list?</p>\n</blockquote>\n\n<p>No, this is the <a href=\"https://en.wikipedia.org/wiki/Unit_type\" rel=\"noreferrer\"><strong>unit type</strong> [wiki]</a>. It is not a tuple, nor a list. Sometimes, as the Wikipedia article says, it is interpreted as an 0-tuple. It is defined in <a href=\"https://hackage.haskell.org/package/ghc-prim-0.5.3/docs/GHC-Tuple.html#t:-40--41-\" rel=\"noreferrer\"><strong><code>GHC.Tuple</code></strong></a> as well.</p>\n\n<blockquote>\n  <p>Why does the first use <code>[]</code>, while the second uses <code>()</code>? </p>\n</blockquote>\n\n<p>The two are <em>not</em> equivalent. The former one matches a list with <em>exactly</em> two elements where the first element is an <code>'a'</code>, whereas the latter matches a list with <em>at least one</em> element where the first element is an <code>'a'</code>. But the latter can match a list with one element, three elements, etc. whereas the former can only match lists with <em>exactly</em> two elements.</p>\n\n<h1>Background</h1>\n\n<p><strong><code>(:)</code></strong> is a <em>data constructor</em> of a list. Indeed:</p>\n\n<pre><code>Prelude&gt; :i (:)\ndata [] a = ... | a : [a]   -- Defined in \u2018GHC.Types\u2019\ninfixr 5 :\n</code></pre>\n\n<p>The <code>('a': _)</code> is just a nicer form of <code>((:) 'a' _)</code>. We here thus use one of the list data constructors.</p>\n\n<p>The <code>['a', _]</code> is syntactical sugar for <code>(:) 'a' ((:) _ [])</code>, so here we match a list that starts with an <code>'a'</code> and where the tail is a list with as head a value we do not care about and its tail the empty list <em>data constructor</em>.</p>\n"}, {"tags": [], "owner": {"reputation": 14030, "user_id": 8475054, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/edbf41c4b5aecb1a949936e06368a7c2?s=128&d=identicon&r=PG&f=1", "display_name": "Robin Zigmond", "link": "https://stackoverflow.com/users/8475054/robin-zigmond"}, "is_accepted": false, "score": 5, "last_activity_date": 1564234254, "creation_date": 1564234254, "answer_id": 57232610, "question_id": 57232537, "link": "https://stackoverflow.com/questions/57232537/does-a-represent-a-tuple-or-a-list/57232610#57232610", "title": "Does `(&#39;a&#39;:_)` represent a tuple or a list?", "body": "<p>Haskell's list notation is just syntactic sugar for \"cons\"ing elements on to the empty list (that is, using the <code>:</code> operator).</p>\n\n<p>In other words,</p>\n\n<pre><code>[x,y,z]\n</code></pre>\n\n<p>is syntactic sugar for</p>\n\n<pre><code>x:(y:(z:[]))\n</code></pre>\n\n<p>(although this form would more normally be written as <code>x:y:z:[]</code> without the parentheses, since <code>:</code> is right-associative). </p>\n\n<p>So, in the example you quote, <code>('a':_)</code> represents any list whose first element is <code>'a'</code>, while <code>['a',_]</code> is sugar for <code>(a:(_:[]))</code> which is a list of length exactly 2, whose first element is <code>a</code>.</p>\n\n<p>Note that tuples are something else entirely, being denoted by a sequence of values in parentheses separated by commas.</p>\n"}, {"tags": [], "owner": {"reputation": 14537, "user_id": 7128034, "user_type": "registered", "accept_rate": 85, "profile_image": "https://i.stack.imgur.com/T8aRg.jpg?s=128&g=1", "display_name": "Dami&#225;n Rafael Lattenero", "link": "https://stackoverflow.com/users/7128034/dami%c3%a1n-rafael-lattenero"}, "is_accepted": false, "score": 1, "last_activity_date": 1565057244, "last_edit_date": 1565057244, "creation_date": 1564761276, "answer_id": 57329896, "question_id": 57232537, "link": "https://stackoverflow.com/questions/57232537/does-a-represent-a-tuple-or-a-list/57329896#57329896", "title": "Does `(&#39;a&#39;:_)` represent a tuple or a list?", "body": "<p>In Haskell there are data constructors that are symbols, some examples that may confuse you:</p>\n\n<pre><code>() :: ()\n</code></pre>\n\n<p>that's the type <code>unit</code> with its constructor <code>()</code> and its value <code>()</code></p>\n\n<p>then there is:</p>\n\n<pre><code>(,) :: a -&gt; b -&gt; (a,b)\n</code></pre>\n\n<p><code>(,)</code> is the constructor for tuples, for example <code>(1,\"b\")</code> that can be <code>(1,) \u201cb\u201d</code> or <code>(,) 1 \u201cb\u201d</code></p>\n\n<p>finally your case: </p>\n\n<pre><code>(:) :: a -&gt; [a] -&gt; [a]\n</code></pre>\n\n<p>for example, <code>1:[]</code> that can be <code>[1]</code> or <code>(:) 1 []</code> </p>\n"}], "owner": {"reputation": 1, "user_id": 156458, "user_type": "registered", "accept_rate": 47, "profile_image": "https://i.stack.imgur.com/3PCjR.png?s=128&g=1", "display_name": "Tim", "link": "https://stackoverflow.com/users/156458/tim"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 129, "favorite_count": 0, "accepted_answer_id": 57232607, "answer_count": 3, "score": 3, "last_activity_date": 1565057244, "creation_date": 1564233647, "last_edit_date": 1564234441, "question_id": 57232537, "link": "https://stackoverflow.com/questions/57232537/does-a-represent-a-tuple-or-a-list", "title": "Does `(&#39;a&#39;:_)` represent a tuple or a list?", "body": "<p>A function  that    decides if  a   list begins with    the letter  \u2019a\u2019 can be  defined as  follows:</p>\n\n<pre><code>test :: [Char] -&gt; Bool \ntest ['a',_] = True  \ntest _ = False\n</code></pre>\n\n<p>or</p>\n\n<pre><code>test :: [Char] -&gt; Bool \ntest ('a':_) = True  \ntest _ = False\n</code></pre>\n\n<p>Why does the first use <code>[]</code>, while the second uses <code>()</code>? </p>\n\n<p>Does the second use <code>('a':_)</code> to represent a tuple or a list? </p>\n\n<ul>\n<li>If a tuple, doesn't <code>test</code>'s argument  have a list type <code>[Char]</code>?</li>\n<li>If a list, doesn't <code>()</code> represent a tuple and how can it represent a list?</li>\n</ul>\n"}, {"tags": ["list", "haskell", "instance", "typeclass", "deriving"], "comments": [{"owner": {"reputation": 314794, "user_id": 67579, "user_type": "registered", "accept_rate": 81, "profile_image": "https://i.stack.imgur.com/BJXub.png?s=128&g=1", "display_name": "Willem Van Onsem", "link": "https://stackoverflow.com/users/67579/willem-van-onsem"}, "edited": false, "score": 0, "creation_date": 1564233327, "post_id": 57232488, "comment_id": 100967621, "body": "They do <code>deriving</code> means Haskell can implement the <code>Eq</code> and <code>Ord</code> class automatically (this means you do not need to implement these yourself). The others are implemented with an explicit <code>instance Monad</code>, etc."}, {"owner": {"reputation": 1, "user_id": 156458, "user_type": "registered", "accept_rate": 47, "profile_image": "https://i.stack.imgur.com/3PCjR.png?s=128&g=1", "display_name": "Tim", "link": "https://stackoverflow.com/users/156458/tim"}, "reply_to_user": {"reputation": 314794, "user_id": 67579, "user_type": "registered", "accept_rate": 81, "profile_image": "https://i.stack.imgur.com/BJXub.png?s=128&g=1", "display_name": "Willem Van Onsem", "link": "https://stackoverflow.com/users/67579/willem-van-onsem"}, "edited": false, "score": 0, "creation_date": 1564233760, "post_id": 57232488, "comment_id": 100967719, "body": "(1) Do you mean by default  list is not an instance of Monad? If I want it to be, I have to declare that explicitly? (2) Is a list type an instance of Foldable class? If yes, why is that not mentioned in the link above?"}, {"owner": {"reputation": 314794, "user_id": 67579, "user_type": "registered", "accept_rate": 81, "profile_image": "https://i.stack.imgur.com/BJXub.png?s=128&g=1", "display_name": "Willem Van Onsem", "link": "https://stackoverflow.com/users/67579/willem-van-onsem"}, "edited": false, "score": 0, "creation_date": 1564233840, "post_id": 57232488, "comment_id": 100967743, "body": "no, it is, it only means that Haskell can implement certain instances for type classes automatically: these are <code>Eq</code>, <code>Ord</code>, <code>Enum</code>, <code>Bounded</code>, <code>Show</code> and <code>Read</code>."}, {"owner": {"reputation": 1, "user_id": 156458, "user_type": "registered", "accept_rate": 47, "profile_image": "https://i.stack.imgur.com/3PCjR.png?s=128&g=1", "display_name": "Tim", "link": "https://stackoverflow.com/users/156458/tim"}, "reply_to_user": {"reputation": 314794, "user_id": 67579, "user_type": "registered", "accept_rate": 81, "profile_image": "https://i.stack.imgur.com/BJXub.png?s=128&g=1", "display_name": "Willem Van Onsem", "link": "https://stackoverflow.com/users/67579/willem-van-onsem"}, "edited": false, "score": 0, "creation_date": 1564234016, "post_id": 57232488, "comment_id": 100967793, "body": "Thanks. (1) (2) I am not sure what you mean. (3) How can I find out all the classes which a type (e.g. a list type) belong to?"}, {"owner": {"reputation": 314794, "user_id": 67579, "user_type": "registered", "accept_rate": 81, "profile_image": "https://i.stack.imgur.com/BJXub.png?s=128&g=1", "display_name": "Willem Van Onsem", "link": "https://stackoverflow.com/users/67579/willem-van-onsem"}, "edited": false, "score": 0, "creation_date": 1564234311, "post_id": 57232488, "comment_id": 100967865, "body": "with <code>:i</code> you can find a list of instances."}], "answers": [{"tags": [], "owner": {"reputation": 314794, "user_id": 67579, "user_type": "registered", "accept_rate": 81, "profile_image": "https://i.stack.imgur.com/BJXub.png?s=128&g=1", "display_name": "Willem Van Onsem", "link": "https://stackoverflow.com/users/67579/willem-van-onsem"}, "is_accepted": false, "score": 3, "last_activity_date": 1564233738, "creation_date": 1564233738, "answer_id": 57232547, "question_id": 57232488, "link": "https://stackoverflow.com/questions/57232488/how-can-i-find-out-the-classes-which-list-types-belong-to/57232547#57232547", "title": "How can I find out the classes which list types belong to?", "body": "<blockquote>\n  <p>Why do the two above not agree completely with each other?</p>\n</blockquote>\n\n<p>These two statements do <em>not</em> conflict at all.</p>\n\n<p>A <a href=\"https://www.haskell.org/onlinereport/haskell2010/haskellch11.html#x18-18200011\" rel=\"nofollow noreferrer\"><code>deriving</code> [Haskell'10 report]</a> means that the compiler will <em>automatically</em> derive the instance. You thus do not need to define an <code>instance</code> clause explicitly. The report also specifies how this automatic instance will look like.</p>\n\n<p>The Haskell report mentions that only a limited number of type classes can be derived automatically:</p>\n\n<blockquote>\n  <p><em>C</em> is one of <code>Eq</code>, <code>Ord</code>, <code>Enum</code>, <code>Bounded</code>, <code>Show</code>, or <code>Read</code>.</p>\n</blockquote>\n\n<p>Certain <code>ghc</code> extensions allow more automatically derived typeclasses (like <code>Functor</code>, etc.).</p>\n\n<p>besides the one that Haskell can derive automatically, you can manually instantiate others with an <a href=\"https://www.haskell.org/onlinereport/haskell2010/haskellch4.html#x10-770004.3.2\" rel=\"nofollow noreferrer\"><code>instance</code> block [Haskell'10 report]</a>.</p>\n\n<p>We can for example define <code>Maybe</code> ourselves with:</p>\n\n<pre><code>data Maybe a = Nothing | Just a <b>deriving</b> (Show, Eq, Ord)\n\n<b>instance</b> Functor Maybe where\n    fmap _ Nothing = Nothing\n    fmap f (Just x) = Just (f x)</code></pre>\n\n<p>Our <code>Maybe</code> type is thus an instance of <code>Show</code>, <code>Eq</code>, <code>Ord</code> and <code>Functor</code> here.</p>\n\n<p>In <code>ghci</code>, you can use <code>:i</code> to find out to which type classes a type belongs, for example:</p>\n\n<pre><code>Prelude&gt; :i []\ndata [] a = [] | a : [a]    -- Defined in \u2018GHC.Types\u2019\ninstance Eq a =&gt; Eq [a] -- Defined in \u2018GHC.Classes\u2019\ninstance Monad [] -- Defined in \u2018GHC.Base\u2019\ninstance Functor [] -- Defined in \u2018GHC.Base\u2019\ninstance Ord a =&gt; Ord [a] -- Defined in \u2018GHC.Classes\u2019\ninstance Read a =&gt; Read [a] -- Defined in \u2018GHC.Read\u2019\ninstance Show a =&gt; Show [a] -- Defined in \u2018GHC.Show\u2019\ninstance Applicative [] -- Defined in \u2018GHC.Base\u2019\ninstance Foldable [] -- Defined in \u2018Data.Foldable\u2019\ninstance Traversable [] -- Defined in \u2018Data.Traversable\u2019\ninstance Monoid [a] -- Defined in \u2018GHC.Base\u2019\n</code></pre>\n"}], "owner": {"reputation": 1, "user_id": 156458, "user_type": "registered", "accept_rate": 47, "profile_image": "https://i.stack.imgur.com/3PCjR.png?s=128&g=1", "display_name": "Tim", "link": "https://stackoverflow.com/users/156458/tim"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 63, "favorite_count": 0, "answer_count": 1, "score": 1, "last_activity_date": 1564236235, "creation_date": 1564233249, "last_edit_date": 1564236235, "question_id": 57232488, "link": "https://stackoverflow.com/questions/57232488/how-can-i-find-out-the-classes-which-list-types-belong-to", "title": "How can I find out the classes which list types belong to?", "body": "<p>How can I find out the classes which  list types belong to?</p>\n\n<p>In <a href=\"https://www.haskell.org/onlinereport/haskell2010/haskellch6.html\" rel=\"nofollow noreferrer\">https://www.haskell.org/onlinereport/haskell2010/haskellch6.html</a> says</p>\n\n<blockquote>\n  <p>data  [a]  =  [] | a : [a]  deriving (Eq, Ord) </p>\n</blockquote>\n\n<p>and</p>\n\n<blockquote>\n  <p>Lists are an instance of classes Read, Show, Eq, Ord, Monad, Functor, and MonadPlus. </p>\n</blockquote>\n\n<p>Why do the two above not agree completely with each other?</p>\n\n<p>Is a list type an instance of <code>Foldable</code> class?\nIf yes, why is that not mentioned in the link above?</p>\n\n<p>Thanks.</p>\n"}, {"tags": ["haskell", "state", "monads"], "comments": [{"owner": {"reputation": 7817, "user_id": 7345298, "user_type": "registered", "accept_rate": 50, "profile_image": "https://www.gravatar.com/avatar/9477d048c5c29b16307b3356146d497a?s=128&d=identicon&r=PG&f=1", "display_name": "bradrn", "link": "https://stackoverflow.com/users/7345298/bradrn"}, "edited": false, "score": 1, "creation_date": 1564211098, "post_id": 57229411, "comment_id": 100963381, "body": "Quick question: in words, what is <code>turbo</code> supposed to do? Understanding the intended purpose may help with diagnosing the problem."}, {"owner": {"reputation": 82, "user_id": 7627317, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/0156c3d2ade6b5de14cb3033327b59e1?s=128&d=identicon&r=PG&f=1", "display_name": "loiuytre35", "link": "https://stackoverflow.com/users/7627317/loiuytre35"}, "reply_to_user": {"reputation": 7817, "user_id": 7345298, "user_type": "registered", "accept_rate": 50, "profile_image": "https://www.gravatar.com/avatar/9477d048c5c29b16307b3356146d497a?s=128&d=identicon&r=PG&f=1", "display_name": "bradrn", "link": "https://stackoverflow.com/users/7345298/bradrn"}, "edited": false, "score": 0, "creation_date": 1564211642, "post_id": 57229411, "comment_id": 100963488, "body": "@bradrn <code>turbo</code> is suppose to take in a <code>Stmt</code> and return <code>State</code> with the resulting <code>TurboMem</code> (stores the state of the Map and variables) and a list of <code>SVGPathCmd</code> (which are just <code>MoveTo x y</code> and <code>LineTo x y</code> determined by the Statements)."}], "answers": [{"comments": [{"owner": {"reputation": 82, "user_id": 7627317, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/0156c3d2ade6b5de14cb3033327b59e1?s=128&d=identicon&r=PG&f=1", "display_name": "loiuytre35", "link": "https://stackoverflow.com/users/7627317/loiuytre35"}, "edited": false, "score": 0, "creation_date": 1564213886, "post_id": 57230080, "comment_id": 100963826, "body": "Thanks for the response. I was wondering if I need to change how I check the following <code>if (snd (deState (isVarBetween var from to) state)) then...</code>, assuming <code>isVarBetween :: String -&gt; Double-&gt; Double-&gt; State TurboMem Bool</code>"}, {"owner": {"reputation": 100185, "user_id": 3234959, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/93bb12ca0f93dfddb33880316f7e66c2?s=128&d=identicon&r=PG&f=1", "display_name": "chi", "link": "https://stackoverflow.com/users/3234959/chi"}, "reply_to_user": {"reputation": 82, "user_id": 7627317, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/0156c3d2ade6b5de14cb3033327b59e1?s=128&d=identicon&r=PG&f=1", "display_name": "loiuytre35", "link": "https://stackoverflow.com/users/7627317/loiuytre35"}, "edited": false, "score": 1, "creation_date": 1564215368, "post_id": 57230080, "comment_id": 100964080, "body": "@loiuytre35 You can use <code>between &lt;- isVarBetween var from to</code> and then <code>if between then ...</code> in the next line."}, {"owner": {"reputation": 82, "user_id": 7627317, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/0156c3d2ade6b5de14cb3033327b59e1?s=128&d=identicon&r=PG&f=1", "display_name": "loiuytre35", "link": "https://stackoverflow.com/users/7627317/loiuytre35"}, "edited": false, "score": 1, "creation_date": 1564216406, "post_id": 57230080, "comment_id": 100964273, "body": "So you really don&#39;t need to use <code>deState</code> anywhere except for the first line of code executed for the initial state."}, {"owner": {"reputation": 100185, "user_id": 3234959, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/93bb12ca0f93dfddb33880316f7e66c2?s=128&d=identicon&r=PG&f=1", "display_name": "chi", "link": "https://stackoverflow.com/users/3234959/chi"}, "reply_to_user": {"reputation": 82, "user_id": 7627317, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/0156c3d2ade6b5de14cb3033327b59e1?s=128&d=identicon&r=PG&f=1", "display_name": "loiuytre35", "link": "https://stackoverflow.com/users/7627317/loiuytre35"}, "edited": false, "score": 0, "creation_date": 1564217747, "post_id": 57230080, "comment_id": 100964567, "body": "@loiuytre35 Yes, exactly: you need to use it only once at the very beginning to pass the initial state."}, {"owner": {"reputation": 1610, "user_id": 11257715, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/eb7ef71a9bfa4abd30cb98cbb290b909?s=128&d=identicon&r=PG", "display_name": "moonGoose", "link": "https://stackoverflow.com/users/11257715/moongoose"}, "edited": false, "score": 0, "creation_date": 1564222292, "post_id": 57230080, "comment_id": 100965400, "body": "Why explicit recursion? Isn&#39;t this a perfect place for eg. <code>concatMapM</code>?"}, {"owner": {"reputation": 100185, "user_id": 3234959, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/93bb12ca0f93dfddb33880316f7e66c2?s=128&d=identicon&r=PG&f=1", "display_name": "chi", "link": "https://stackoverflow.com/users/3234959/chi"}, "reply_to_user": {"reputation": 1610, "user_id": 11257715, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/eb7ef71a9bfa4abd30cb98cbb290b909?s=128&d=identicon&r=PG", "display_name": "moonGoose", "link": "https://stackoverflow.com/users/11257715/moongoose"}, "edited": false, "score": 0, "creation_date": 1564222549, "post_id": 57230080, "comment_id": 100965453, "body": "@moonGoose Sure, but the OP is clearly not yet familiar with the state monad, so I think it&#39;s beneficial to understand the basic approach before using a &quot;magical&quot; library function which solves the job."}, {"owner": {"reputation": 1610, "user_id": 11257715, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/eb7ef71a9bfa4abd30cb98cbb290b909?s=128&d=identicon&r=PG", "display_name": "moonGoose", "link": "https://stackoverflow.com/users/11257715/moongoose"}, "edited": false, "score": 0, "creation_date": 1564228808, "post_id": 57230080, "comment_id": 100966664, "body": "Just to me, that ending point is <i>so</i> unnatural as to be insufficient I guess."}], "tags": [], "owner": {"reputation": 100185, "user_id": 3234959, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/93bb12ca0f93dfddb33880316f7e66c2?s=128&d=identicon&r=PG&f=1", "display_name": "chi", "link": "https://stackoverflow.com/users/3234959/chi"}, "is_accepted": true, "score": 4, "last_activity_date": 1564213310, "last_edit_date": 1564213310, "creation_date": 1564212568, "answer_id": 57230080, "question_id": 57229411, "link": "https://stackoverflow.com/questions/57229411/monad-state-not-updating/57230080#57230080", "title": "Monad State not Updating", "body": "<p>This is wrong:</p>\n\n<pre><code>turbo (Seq [x]) = turbo x\nturbo (Seq (x:xs)) = do\n    state &lt;- get\n    let a0 = snd (deState (turbo x) state)\n    state &lt;- get\n    let a1 = snd (deState (turbo (Seq xs)) state)\n    pure (a0 ++ a1)\n</code></pre>\n\n<p>Here, <code>deState (turbo x) state</code> returns a pair <code>(newState, a0)</code>, and <code>newState</code> is simply discarded by <code>snd</code>. So, the next <code>state &lt;- get</code> will read the original state again. Essentially, the state \"in the monad\" never change throughout the execution of <code>Seq (x:xs)</code>, when it should.</p>\n\n<p>The problem here is that you are using <code>deState</code> in a monadic computation. You should not, since that requires you to manually keep track of what is the \"current\" state, and pass it around like this:</p>\n\n<pre><code>let (state0,a0) = deState (turbo x0) state\n    (state1,a1) = deState (turbo x1) state0\n    (state2,a2) = deState (turbo x2) state1\n    ...\n</code></pre>\n\n<p>Writing in this way works, but it is <em>precisely</em> what the state monad helps to avoid! We should write instead</p>\n\n<pre><code>a0 &lt;- turbo x0\na1 &lt;- turbo x1\na2 &lt;- turbo x2\n...\n</code></pre>\n\n<p>and let the monad deal with the state passing boilerplate.</p>\n\n<p>I would rewrite the <code>turbo (Seq ...)</code> cases as follows:</p>\n\n<pre><code>turbo (Seq []) = pure []\nturbo (Seq (x:xs)) = do\n    a0 &lt;- turbo x\n    a1 &lt;- turbo (Seq xs)\n    pure (a0 ++ a1)\n</code></pre>\n\n<p>Much simpler, since now <code>turbo x</code> feels like a function call in an imperative language, which can modify the state variables with a side effect -- and that's what the state monad is about. We do not have to track the current state explicitly, and pass it around.</p>\n\n<p>Try to remove all other uses of <code>deState</code> in your code. You should only use <code>deState</code> once: outside of <code>turbo</code>, when you are \"exiting the monad\" and your return type is not longer of the form <code>State TurboMem something</code></p>\n"}], "owner": {"reputation": 82, "user_id": 7627317, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/0156c3d2ade6b5de14cb3033327b59e1?s=128&d=identicon&r=PG&f=1", "display_name": "loiuytre35", "link": "https://stackoverflow.com/users/7627317/loiuytre35"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 78, "favorite_count": 0, "accepted_answer_id": 57230080, "answer_count": 1, "score": 0, "last_activity_date": 1564213310, "creation_date": 1564205372, "last_edit_date": 1564212898, "question_id": 57229411, "link": "https://stackoverflow.com/questions/57229411/monad-state-not-updating", "title": "Monad State not Updating", "body": "<p>I'm trying to create use a state monad to store the current state of a game that takes in a list of statement (commands) to return a list of actions.</p>\n\n<p>Individually, the turbo commands work, but done sequentially, the previous commands do not have any affect on the current command.</p>\n\n<p>Something I don't really understand is how are the states suppose to be propagated down to the next commands? The following is what I would do if I was running the code manually:</p>\n\n<pre><code>s0 = turbo (PenDown)\ns1 = turbo (Forward (RLit 50))\ns2 = turbo (Turn (RLit 90))\ns3 = turbo (Forward (RLit 50))\ns4 = turbo (Turn (RLit 90))\ns5 = turbo (Forward (RLit 50))\n\na1 = snd (deState s1 (fst (deState s1 (fst (deState s0 initTurboMem)))))\na2 = snd (deState s3 (fst (deState s2 (fst (deState s1 (fst (deState s1 (fst (deState s0 initTurboMem)))))))))\na3 = snd (deState s5 (fst (deState s4 (fst (deState s3 (fst (deState s2 (fst (deState s1 (fst (deState s1 (fst (deState s0 initTurboMem)))))))))))))\na = a1 ++ a2 ++ a3\n</code></pre>\n\n<p>This would give the answer, but I'm not sure how it would be done in the code below.</p>\n\n<p>To run the code, use the following</p>\n\n<pre><code>stmt = Seq [ \n             PenDown\n           , Forward (RLit 50)\n           , Turn (RLit 90)    \n           , Forward (RLit 50)    \n           , Turn (RLit 90)    \n           , Forward (RLit 50)   \n           ]  \nsnd (deState (turbo stmt) initTurboMem)\n</code></pre>\n\n<p>Here is the function in question that isn't taking previous statements into consideration</p>\n\n<pre><code>turbo (Seq [x]) = turbo x\nturbo (Seq (x:xs)) = do\n    state &lt;- get\n    let a0 = snd (deState (turbo x) state)\n    state &lt;- get\n    let a1 = snd (deState (turbo (Seq xs)) state)\n    pure (a0 ++ a1)\n</code></pre>\n\n<p>Here are the rest of the functions</p>\n\n<pre><code>turbo :: Stmt -&gt; State TurboMem [SVGPathCmd]\nturbo (var := expr) = do\n    state &lt;- get\n    let val = snd (deState (evalReal expr) state)\n    setVar var val\n    pure []\nturbo PenDown = do\n    setPen True\n    pure []\nturbo PenUp = do\n    setPen False\n    pure []\nturbo (Turn expr) = do\n    state &lt;- get\n    let angle = snd (deState (evalReal expr) state)\n    turn angle\n    pure []\nturbo (Forward expr) = do\n    state &lt;- get\n    let angle = snd (deState (getAngle) state)\n        dist = snd (deState (evalReal expr) state)\n        x = dist * cos (angle * pi / 180)\n        y = dist * sin (angle * pi / 180)\n        pen = snd (deState (getPen) state)\n    if pen then pure [LineTo x y] else pure [MoveTo x y]\n</code></pre>\n\n<p>The turbo state</p>\n\n<pre><code>data TurboMem = TurboMem (Map String Double) Double Bool\n    deriving (Eq, Show)\n</code></pre>\n\n<p>The expressions and statements</p>\n\n<pre><code>data RealExpr\n    = RLit Double               -- literal/constant\n    | RVar String               -- read var's current value\n                                -- if uninitialized, the answer is 0\n    | Neg RealExpr              -- unary minus\n    | RealExpr :+ RealExpr      -- plus\n    | RealExpr :- RealExpr      -- minus\n    | RealExpr :* RealExpr      -- times\n    | RealExpr :/ RealExpr      -- divide\n    deriving (Eq, Ord, Read, Show)\ndata Stmt\n    = String := RealExpr        -- assignment, the string is var name\n    | PenDown                   -- set pen to down (touch paper) state\n    | PenUp                     -- set pen to up (away from paper) state\n    | Turn RealExpr             -- turn counterclockwise by given degrees\n                                -- negative angle just means clockwise\n    | Forward RealExpr          -- move by given distance units (in current direction)\n                                -- negative distance just means backward\n                                -- if pen is down, this causes drawing too\n                                -- if pen is up, this moves without drawing\n    | Seq [Stmt]                -- sequential compound statement. run in given order\n    deriving (Eq, Ord, Read, Show)\ndata SVGPathCmd = MoveTo Double Double -- move without drawing\n                | LineTo Double Double -- draw and move\n    deriving (Eq, Ord, Read, Show)\n</code></pre>\n\n<p>Helper functions to manipulate the state</p>\n\n<pre><code>-- Get current direction.\ngetAngle :: State TurboMem Double\n-- Change direction by adding the given angle.\nturn :: Double -&gt; State TurboMem ()\n-- Get pen state.\ngetPen :: State TurboMem Bool\n-- Set pen state.\nsetPen :: Bool -&gt; State TurboMem ()\n-- Get a variable's current value.\ngetVar :: String -&gt; State TurboMem Double\n-- Set a variable to value.\nsetVar :: String -&gt; Double -&gt; State TurboMem ()\n</code></pre>\n\n<p>The initial state</p>\n\n<pre><code>initTurboMem = TurboMem Map.empty 0 False\n</code></pre>\n\n<p>I expect the result to be </p>\n\n<pre><code>[LineTo 50.0 0.0,LineTo 0.0 50.0,LineTo -50.0 0.0]\n\n</code></pre>\n\n<p>but what I actually get is</p>\n\n<pre><code>[MoveTo 50.0 0.0,MoveTo 50.0 0.0,MoveTo 50.0 0.0]\n</code></pre>\n"}, {"tags": ["haskell"], "comments": [{"owner": {"reputation": 7817, "user_id": 7345298, "user_type": "registered", "accept_rate": 50, "profile_image": "https://www.gravatar.com/avatar/9477d048c5c29b16307b3356146d497a?s=128&d=identicon&r=PG&f=1", "display_name": "bradrn", "link": "https://stackoverflow.com/users/7345298/bradrn"}, "edited": false, "score": 0, "creation_date": 1564192472, "post_id": 57228178, "comment_id": 100961170, "body": "It is easiest to solve this problem in two stages. First, write a function <code>catsLine :: Integer -&gt; String`` which makes one line containing </code>n` repetitions of \u201ccats\u201d. (You\u2019ve done this already with your first attempt \u2014 try replacing <code>\\n</code> with a space.) Next, write your function <code>cats :: Integer -&gt; String</code> by running <code>catsLine</code> for 1,2,3,\u2026,<i>n</i> repetitions, then <code>concat</code>ing them together. I won\u2019t give an answer directly as this looks like homework and I want you to work it out for yourself. (Even if it isn\u2019t homework, it\u2019s always best to work it out yourself!)"}, {"owner": {"reputation": 13, "user_id": 11843715, "user_type": "registered", "profile_image": "https://lh5.googleusercontent.com/-qeYHqzoZsGE/AAAAAAAAAAI/AAAAAAAAAMY/DLQnYQpplKU/photo.jpg?sz=128", "display_name": "Izzudin Anuar", "link": "https://stackoverflow.com/users/11843715/izzudin-anuar"}, "reply_to_user": {"reputation": 7817, "user_id": 7345298, "user_type": "registered", "accept_rate": 50, "profile_image": "https://www.gravatar.com/avatar/9477d048c5c29b16307b3356146d497a?s=128&d=identicon&r=PG&f=1", "display_name": "bradrn", "link": "https://stackoverflow.com/users/7345298/bradrn"}, "edited": false, "score": 0, "creation_date": 1564206991, "post_id": 57228178, "comment_id": 100962800, "body": "@bradrn yes, it&#39;s for my homework. I figured it out! Thanks!"}, {"owner": {"reputation": 7817, "user_id": 7345298, "user_type": "registered", "accept_rate": 50, "profile_image": "https://www.gravatar.com/avatar/9477d048c5c29b16307b3356146d497a?s=128&d=identicon&r=PG&f=1", "display_name": "bradrn", "link": "https://stackoverflow.com/users/7345298/bradrn"}, "edited": false, "score": 0, "creation_date": 1564210386, "post_id": 57228178, "comment_id": 100963285, "body": "You\u2019re welcome @IzzudinAnaur! Even though it may not strictly qualify, can I add my instructions as an answer?"}, {"owner": {"reputation": 3248, "user_id": 5707684, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/wrGFn.jpg?s=128&g=1", "display_name": "Elmex80s", "link": "https://stackoverflow.com/users/5707684/elmex80s"}, "edited": false, "score": 0, "creation_date": 1564226376, "post_id": 57228178, "comment_id": 100966207, "body": "Why not use something like <code>replicate</code>?"}], "answers": [{"tags": [], "owner": {"reputation": 14537, "user_id": 7128034, "user_type": "registered", "accept_rate": 85, "profile_image": "https://i.stack.imgur.com/T8aRg.jpg?s=128&g=1", "display_name": "Dami&#225;n Rafael Lattenero", "link": "https://stackoverflow.com/users/7128034/dami%c3%a1n-rafael-lattenero"}, "is_accepted": false, "score": 0, "last_activity_date": 1564220318, "last_edit_date": 1564220318, "creation_date": 1564196199, "answer_id": 57228794, "question_id": 57228178, "link": "https://stackoverflow.com/questions/57228178/combining-text-in-list-comprehension/57228794#57228794", "title": "Combining text in list comprehension", "body": "<p>You can achieve this with pattern matching over <code>Integer</code></p>\n\n<pre><code>cats :: Integer -&gt; String\ncats 0 = \"\"\ncats n = aux 1 n\n  where\n    aux m 0 = \"\"\n    aux m n = concat (fcats m) ++ aux (m+1) (n-1)\n    fcats n = take (fromIntegral n) (repeat \"cats \") ++ [\"\\n\"]\n</code></pre>\n\n<p>I used an aux function to put it in reverse, if not, it would be five cats first and last one cats</p>\n"}, {"tags": [], "owner": {"reputation": 100185, "user_id": 3234959, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/93bb12ca0f93dfddb33880316f7e66c2?s=128&d=identicon&r=PG&f=1", "display_name": "chi", "link": "https://stackoverflow.com/users/3234959/chi"}, "is_accepted": true, "score": 0, "last_activity_date": 1564215761, "creation_date": 1564215761, "answer_id": 57230430, "question_id": 57228178, "link": "https://stackoverflow.com/questions/57228178/combining-text-in-list-comprehension/57230430#57230430", "title": "Combining text in list comprehension", "body": "<p>You already have a solution for single rows:</p>\n\n<pre><code>cat_row n = concat[\"cat \" | m &lt;- [0..n-1], m &lt; n]\n</code></pre>\n\n<p>(by the way, the last <code>m &lt; n</code> is redundant, since it's always true)</p>\n\n<p>So, you can iterate over that in the same way:</p>\n\n<pre><code>cat n = concat[cat_row m ++ \"\\n\" | m &lt;- [1..n]]\n</code></pre>\n\n<p>For a simpler solution, you could exploit the library functions <code>unlines</code> and <code>unwords</code>.</p>\n"}, {"tags": [], "owner": {"reputation": 119, "user_id": 11475860, "user_type": "registered", "profile_image": "https://lh3.googleusercontent.com/-uxVBrP25b5k/AAAAAAAAAAI/AAAAAAAACIM/ZhAG3ym2qGk/photo.jpg?sz=128", "display_name": "H&#229;kan", "link": "https://stackoverflow.com/users/11475860/h%c3%a5kan"}, "is_accepted": false, "score": 0, "last_activity_date": 1564757583, "creation_date": 1564757583, "answer_id": 57328914, "question_id": 57228178, "link": "https://stackoverflow.com/questions/57228178/combining-text-in-list-comprehension/57328914#57328914", "title": "Combining text in list comprehension", "body": "<p>Since this is from your homework, you should also consider explicit recursive solutions.</p>\n\n<p>If we look at your example where cats 5 have returned 5 rows, we will notice that rows 2-5 contains cats 4. More precisely, if we disregard the left-most column what remains is exactly cats 4. </p>\n\n<p>So, if given cats 4, we just need to add the left-most column to get cats 5. If the rows are represented as a list of strings, this amounts to prepending \"cats \" to each of the strings and add a first one. Let's write a help function that works like this:</p>\n\n<pre><code>help :: String -&gt; Int -&gt; [String]\nhelp s 1 = [s ++ \" \"]\nhelp s n = [s ++ \" \" ++ x | x &lt;- \"\" : help s (n-1)]\n</code></pre>\n\n<p>The call</p>\n\n<pre><code>&gt; help \"cats\" 5\n</code></pre>\n\n<p>then results in</p>\n\n<pre><code>[\"cats \",\"cats cats \",\"cats cats cats \",\"cats cats cats cats \",\"cats cats cats cats cats \"]\n</code></pre>\n\n<p>Not exactly what we want but almost. Ending newlines are missing and it's not a single string ready to print. Appending newlines is easy with another list comprehension:</p>\n\n<pre><code>[ x ++ \"\\n\" | x &lt;- help \"cats\" 5] \n</code></pre>\n\n<p>This gives us</p>\n\n<pre><code>[\"cats \\n\",\"cats cats \\n\",\"cats cats cats \\n\",\"cats cats cats cats \\n\",\"cats cats cats cats cats \\n\"]\n</code></pre>\n\n<p>The last remaining step is to turn this list of strings into a string by concatenating the substrings. Since a string is a list of Char, a list of strings is really just a list of list of Char. This means we can concatenate all substrings by picking out the characters one at a time in order and form the result from them: </p>\n\n<pre><code>[c | s &lt;- [ x ++ \"\\n\" | x &lt;- help \"cats\" 5], c &lt;- s]\n</code></pre>\n\n<p>Note how we first pick out (generate) substrings s, and for each such we pick out its characters c. This now gives us the desired result:</p>\n\n<pre><code>\"cats \\ncats cats \\ncats cats cats \\ncats cats cats cats \\ncats cats cats cats cats \\n\"\n</code></pre>\n\n<p>To recap, this alternative solution relies on explicit recursion and list comprehensions. It does not rely on predefined functions. Instead of using list comprehensions, we could have written short primitive recursive functions, effectively getting a highly self-contained program. </p>\n\n<p>Again, since this is homework, I suggest these two exercises to you: </p>\n\n<ol>\n<li>Put the pieces above together into a function cats :: Int -> String.</li>\n<li>Rewrite the code so it no longer makes use of list comprehensions. </li>\n</ol>\n\n<p>Happy Haskelling!</p>\n"}], "owner": {"reputation": 13, "user_id": 11843715, "user_type": "registered", "profile_image": "https://lh5.googleusercontent.com/-qeYHqzoZsGE/AAAAAAAAAAI/AAAAAAAAAMY/DLQnYQpplKU/photo.jpg?sz=128", "display_name": "Izzudin Anuar", "link": "https://stackoverflow.com/users/11843715/izzudin-anuar"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 84, "favorite_count": 0, "accepted_answer_id": 57230430, "answer_count": 3, "score": 0, "last_activity_date": 1564757583, "creation_date": 1564186238, "last_edit_date": 1564187526, "question_id": 57228178, "link": "https://stackoverflow.com/questions/57228178/combining-text-in-list-comprehension", "title": "Combining text in list comprehension", "body": "<p>Using \n<code>cats :: Integer -&gt; String</code></p>\n\n<p>How do I display \n<code>&gt; cats 5</code></p>\n\n<p>Will show</p>\n\n<pre><code>cats\ncats cats\ncats cats cats\ncats cats cats cats\ncats cats cats cats cats\n</code></pre>\n\n<p>I've tried a single line and multi-line output</p>\n\n<p><code>cat n = concat[\"cat\\n\" | n &lt;- [0..n-1]]</code>\nand\n<code>cat_row n = concat[\"cat \" | m &lt;- [0..n-1], m &lt; n]</code></p>\n\n<p>but I'm not sure how to combine them.</p>\n"}, {"tags": ["arrays", "haskell", "io", "monads", "io-monad"], "comments": [{"owner": {"reputation": 11366, "user_id": 3922954, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/76ba47d2fdd24ab56b0b273cce2075e5?s=128&d=identicon&r=PG&f=1", "display_name": "AJF", "link": "https://stackoverflow.com/users/3922954/ajf"}, "edited": false, "score": 5, "creation_date": 1564161316, "post_id": 57224380, "comment_id": 100953350, "body": "Write a new function that doesn&#39;t work with <code>IO</code>s, then write this function in terms of that function, using <code>do</code>-notation. Don&#39;t use <code>unsafePerformIO</code> unless you really know what you&#39;re doing."}, {"owner": {"reputation": 61419, "user_id": 849891, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/MbEO3.png?s=128&g=1", "display_name": "Will Ness", "link": "https://stackoverflow.com/users/849891/will-ness"}, "edited": false, "score": 1, "creation_date": 1564171764, "post_id": 57224380, "comment_id": 100957083, "body": "&quot;Otherwise, how could I do ?&quot; -- with <code>do</code>! :) with <code>unsafePerformIO</code> the return type of hour function wouldn&#39;t have been <code>IO Double</code>, but just <code>Double</code>. But since you return the <code>IO Double</code> value, you must create that value, and that is done easiest with the <code>do</code> notation. (as you have discovered, and show in your answer) :)"}, {"owner": {"reputation": 45534, "user_id": 106104, "user_type": "registered", "accept_rate": 62, "profile_image": "https://www.gravatar.com/avatar/c88b9310b92a937108ec4336c2832f92?s=128&d=identicon&r=PG", "display_name": "user253751", "link": "https://stackoverflow.com/users/106104/user253751"}, "edited": false, "score": 0, "creation_date": 1564359886, "post_id": 57224380, "comment_id": 100992582, "body": "Your condition doesn&#39;t have to be in a guard for the <code>jac</code> function. You can just as easily write: <code>| otherwise = do {value &lt;- readArray arr (1,1); if value &#47;= 0 then .......</code>"}, {"owner": {"reputation": 8621, "user_id": 1848029, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/qfjAy.jpg?s=128&g=1", "display_name": "lehins", "link": "https://stackoverflow.com/users/1848029/lehins"}, "edited": false, "score": 0, "creation_date": 1564701072, "post_id": 57224380, "comment_id": 101127368, "body": "Does your <code>jac</code> function actually mutates the array? If not, why not just freeze it and use pure indexing in the guard and in the body of the function"}], "answers": [{"comments": [{"owner": {"reputation": 46777, "user_id": 1100107, "user_type": "registered", "accept_rate": 80, "profile_image": "https://www.gravatar.com/avatar/8789d3da0b482bcd8e562bfdf3687c74?s=128&d=identicon&r=PG", "display_name": "St&#233;phane Laurent", "link": "https://stackoverflow.com/users/1100107/st%c3%a9phane-laurent"}, "edited": false, "score": 1, "creation_date": 1564170666, "post_id": 57224667, "comment_id": 100956709, "body": "This is not correct. My <code>otherwise</code> condition must trigger <code>YYY</code> when <code>k &#47;= 0</code>"}, {"owner": {"reputation": 21417, "user_id": 925978, "user_type": "registered", "accept_rate": 84, "profile_image": "https://www.gravatar.com/avatar/06e4467a5bd1538a92cefb20db07897a?s=128&d=identicon&r=PG&f=1", "display_name": "crockeea", "link": "https://stackoverflow.com/users/925978/crockeea"}, "reply_to_user": {"reputation": 46777, "user_id": 1100107, "user_type": "registered", "accept_rate": 80, "profile_image": "https://www.gravatar.com/avatar/8789d3da0b482bcd8e562bfdf3687c74?s=128&d=identicon&r=PG", "display_name": "St&#233;phane Laurent", "link": "https://stackoverflow.com/users/1100107/st%c3%a9phane-laurent"}, "edited": false, "score": 0, "creation_date": 1564172013, "post_id": 57224667, "comment_id": 100957160, "body": "Fixed by adding a final case. This duplicates <code>YYY</code>, but that can be factored out of this function if it&#39;s nontrivial."}], "tags": [], "owner": {"reputation": 21417, "user_id": 925978, "user_type": "registered", "accept_rate": 84, "profile_image": "https://www.gravatar.com/avatar/06e4467a5bd1538a92cefb20db07897a?s=128&d=identicon&r=PG&f=1", "display_name": "crockeea", "link": "https://stackoverflow.com/users/925978/crockeea"}, "is_accepted": false, "score": 3, "last_activity_date": 1564171971, "last_edit_date": 1564171971, "creation_date": 1564162276, "answer_id": 57224667, "question_id": 57224380, "link": "https://stackoverflow.com/questions/57224380/using-unsafeperformio-in-a-guard-condition/57224667#57224667", "title": "Using unsafePerformIO in a guard condition", "body": "<p>One option is to combine the last two cases:</p>\n\n<pre><code>jac m k mu nu arr\n  ...\n  | k == 0 = do\n       element &lt;- readArray arr (1,1)\n       case element of\n         0 -&gt; YYY\n         _ -&gt; XXX\n  | otherwise -&gt; YYY\n</code></pre>\n"}, {"comments": [{"owner": {"reputation": 46777, "user_id": 1100107, "user_type": "registered", "accept_rate": 80, "profile_image": "https://www.gravatar.com/avatar/8789d3da0b482bcd8e562bfdf3687c74?s=128&d=identicon&r=PG", "display_name": "St&#233;phane Laurent", "link": "https://stackoverflow.com/users/1100107/st%c3%a9phane-laurent"}, "edited": false, "score": 0, "creation_date": 1564170781, "post_id": 57224689, "comment_id": 100956762, "body": "That cannot work like this, because <code>YYY</code> involves <code>arr</code>, not only <code>arrVal</code>. I&#39;ve found a solution."}], "tags": [], "owner": {"reputation": 11366, "user_id": 3922954, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/76ba47d2fdd24ab56b0b273cce2075e5?s=128&d=identicon&r=PG&f=1", "display_name": "AJF", "link": "https://stackoverflow.com/users/3922954/ajf"}, "is_accepted": false, "score": 5, "last_activity_date": 1564162727, "last_edit_date": 1564162727, "creation_date": 1564162395, "answer_id": 57224689, "question_id": 57224380, "link": "https://stackoverflow.com/questions/57224380/using-unsafeperformio-in-a-guard-condition/57224689#57224689", "title": "Using unsafePerformIO in a guard condition", "body": "<p>Let's make a simplified version of your question.</p>\n\n<p>Let's say we want to make the following function. It tells us whether or not both of the <code>Int</code> values are equal to <code>0</code>. Problem is, it contains an <code>IO</code>. Your current method is this:</p>\n\n<pre><code>-- THIS IS BAD CODE! This could easily cause unexpected behaviour.\nareBothZero :: Int -&gt; IO Int -&gt; IO Bool\nareBothZero a b\n    | a == 0 &amp;&amp; unsafePerformIO b == 0 = return True\n    | otherwise                        = return False\n</code></pre>\n\n<p>This shows a misunderstanding of monads. In Haskell, <code>unsafePerformIO</code> as a general rule shouldn't be used, unless you want to achieve a certain effect that pure computation cannot achieve. However, this kind of situation is perfectly achievable using the monad operations, which are, unlike <code>unsafePerformIO</code>, perfectly safe.</p>\n\n<p>This is how we achieve this. Firsly, write the logic outside the context of <code>IO</code>:</p>\n\n<pre><code>areBothZeroLogic :: Int -&gt; Int -&gt; Bool\nareBothZeroLogic a b\n  | a == 0 &amp;&amp; b == 0 = True\n  | otherwise        = False\n</code></pre>\n\n<p>Then, we pipe that up to the <code>IO</code> logic we want:</p>\n\n<pre><code>areBothZeroIO :: Int -&gt; IO Int -&gt; IO Bool\nareBothZeroIO a mb = do\n    b &lt;- mb -- Use do-notation to work with the value 'inside' the IO:\n    return $ areBothZeroLogic a b\n</code></pre>\n\n<p>Immediately, this <strong>separates <code>IO</code> logic from pure logic</strong>. This is a fundamental design principle in Haskell that you should always try to follow.</p>\n\n<hr>\n\n<p>Now, onto your problem.</p>\n\n<p>Your problem is much more messy and has several other issues, which suggests to me that you haven't considered how best to split the problem up into smaller peices. However, a better solution may look something like this, maybe with better names:</p>\n\n<pre><code>--                              Look here! vvvvvv    vvvvvv\njacPure :: Int -&gt; Int -&gt; [Int] -&gt; [Int] -&gt; Double -&gt; Double\njacPure m k mu nu arrVal\n  | nu!!0 == 0                 = 1\n  | length nu &gt; m &amp;&amp; nu!!m &gt; 0 = 0\n  | m == 1                     = x!!0^(nu!!0) * theproduct (nu!!0)\n  | k == 0 &amp;&amp; arrVal /= 0      = XXX\n  | otherwise                  = YYY\n\njac :: Int -&gt; Int -&gt; [Int] -&gt; [Int] -&gt; IOArray (Int,Int) Double -&gt; IO Double\njac m k mu nu arr = do\n    arrVal &lt;- readArray arr (1,1) -- Use do-notation to work with the value 'inside' the IO:\n    return $ jacPure m k mu nu arrVal \n</code></pre>\n\n<p>You should see immediately why this is much better. When implementing logic, who cares what's going on in the <code>IO</code> domain? Including an <code>IO</code> in what should be pure logic is like telling an author about the acidity of the paper their book will be printed on\u2014it isn't relevant to what their job is. Always separate logic and <code>IO</code>!</p>\n\n<p>There are of course other ways of doing this, and some could very well be better than the way I have suggested. However, it is not possible to know with the code you have provided which the best path would be. You should aim to learn more about monads and get better at using them, so you can make this judgement on your own.</p>\n\n<hr>\n\n<p>I suspect this question is borne from a lack of understanding of Monads and monadic operations. If you are a beginner, I recommend reading <a href=\"http://learnyouahaskell.com/a-fistful-of-monads\" rel=\"noreferrer\">the relevant LYAH chapter</a>, which I found helpful as a beginner too.</p>\n"}, {"tags": [], "owner": {"reputation": 100185, "user_id": 3234959, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/93bb12ca0f93dfddb33880316f7e66c2?s=128&d=identicon&r=PG&f=1", "display_name": "chi", "link": "https://stackoverflow.com/users/3234959/chi"}, "is_accepted": false, "score": 1, "last_activity_date": 1564171423, "last_edit_date": 1564171423, "creation_date": 1564170968, "answer_id": 57226324, "question_id": 57224380, "link": "https://stackoverflow.com/questions/57224380/using-unsafeperformio-in-a-guard-condition/57226324#57226324", "title": "Using unsafePerformIO in a guard condition", "body": "<p>Not terribly elegant, but should do:</p>\n\n<pre><code>jac :: Int -&gt; Int -&gt; [Int] -&gt; [Int] -&gt; IOArray (Int,Int) Double -&gt; IO Double\njac m k mu nu arr\n  | nu!!0 == 0 = return 1\n  | length nu &gt; m &amp;&amp; nu!!m &gt; 0 = return 0\n  | m == 1 = return $ x!!0^(nu!!0) * theproduct (nu!!0)\n  | otherwise = do\n     v &lt;- readArray arr (1,1)\n     case () of\n        _ | k == 0 &amp;&amp; v /= 0 -&gt; XXX\n          | otherwise        -&gt; YYY\n</code></pre>\n\n<p>Alternatively, read from the array at the very beginning:</p>\n\n<pre><code>jac :: Int -&gt; Int -&gt; [Int] -&gt; [Int] -&gt; IOArray (Int,Int) Double -&gt; IO Double\njac m k mu nu arr = do\n   v &lt;- readArray arr (1,1)\n   case () of\n      _ | nu!!0 == 0 = return 1\n        | length nu &gt; m &amp;&amp; nu!!m &gt; 0 = return 0\n        | m == 1 = return $ x!!0^(nu!!0) * theproduct (nu!!0)\n        | k == 0 &amp;&amp; v /= 0 -&gt; XXX\n        | otherwise        -&gt; YYY\n</code></pre>\n"}, {"tags": [], "owner": {"reputation": 46777, "user_id": 1100107, "user_type": "registered", "accept_rate": 80, "profile_image": "https://www.gravatar.com/avatar/8789d3da0b482bcd8e562bfdf3687c74?s=128&d=identicon&r=PG", "display_name": "St&#233;phane Laurent", "link": "https://stackoverflow.com/users/1100107/st%c3%a9phane-laurent"}, "is_accepted": false, "score": 2, "last_activity_date": 1564171028, "creation_date": 1564171028, "answer_id": 57226329, "question_id": 57224380, "link": "https://stackoverflow.com/questions/57224380/using-unsafeperformio-in-a-guard-condition/57226329#57226329", "title": "Using unsafePerformIO in a guard condition", "body": "<p>I've found a solution. I pass the value of the array element in addition.</p>\n\n<pre><code>jac :: Int -&gt; Int -&gt; [Int] -&gt; [Int] -&gt; IOArray (Int,Int) Double -&gt; Double -&gt; IO Double\njac m k mu nu arr elt\n  | nu!!0 == 0 || m == 0 = return 1\n  | length nu &gt; m &amp;&amp; nu!!m &gt; 0 = return 0\n  | m == 1 = return $ x!!0^(nu!!0) * theproduct (nu!!0)\n  | k == 0 &amp;&amp; elt /= 0 = XXX\n  | otherwise = do\n    e &lt;- readArray arr (1, 1)\n    jck &lt;- jac (m-1) 0 nu nu arr e\n    ......\n</code></pre>\n\n<p>Maybe my question was not precise enough...</p>\n"}, {"comments": [{"owner": {"reputation": 45534, "user_id": 106104, "user_type": "registered", "accept_rate": 62, "profile_image": "https://www.gravatar.com/avatar/c88b9310b92a937108ec4336c2832f92?s=128&d=identicon&r=PG", "display_name": "user253751", "link": "https://stackoverflow.com/users/106104/user253751"}, "edited": false, "score": 1, "creation_date": 1564359974, "post_id": 57226399, "comment_id": 100992602, "body": "FFI calls can be declared as pure, by the way. <code>unsafePerformIO</code> is not required."}, {"owner": {"reputation": 1706, "user_id": 1840613, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/c2dfd4d21060ccd9b972864e0f6cb8c4?s=128&d=identicon&r=PG", "display_name": "Jeremy List", "link": "https://stackoverflow.com/users/1840613/jeremy-list"}, "reply_to_user": {"reputation": 45534, "user_id": 106104, "user_type": "registered", "accept_rate": 62, "profile_image": "https://www.gravatar.com/avatar/c88b9310b92a937108ec4336c2832f92?s=128&d=identicon&r=PG", "display_name": "user253751", "link": "https://stackoverflow.com/users/106104/user253751"}, "edited": false, "score": 0, "creation_date": 1568086174, "post_id": 57226399, "comment_id": 102152977, "body": "@immibis that&#39;s not always true: <code>bracket malloc free some_ffi_call</code> gives you an <code>IO</code> value but not necessarily an impure function."}], "tags": [], "owner": {"reputation": 44013, "user_id": 1477667, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/trgKM.jpg?s=128&g=1", "display_name": "dfeuer", "link": "https://stackoverflow.com/users/1477667/dfeuer"}, "is_accepted": false, "score": 3, "last_activity_date": 1564256381, "last_edit_date": 1564256381, "creation_date": 1564171426, "answer_id": 57226399, "question_id": 57224380, "link": "https://stackoverflow.com/questions/57224380/using-unsafeperformio-in-a-guard-condition/57226399#57226399", "title": "Using unsafePerformIO in a guard condition", "body": "<p>Suppose we have</p>\n\n<pre><code>areBothZero :: Int -&gt; IOArray Int Int -&gt; IO Bool\nareBothZero a b\n  | a == 0 &amp;&amp; unsafePerformIO (readArray b 0) == 0 = return True\n  | otherwise = return False\n</code></pre>\n\n<p>I think it's worth thinking about what can go wrong. Suppose I write</p>\n\n<pre><code>do\n  x &lt;- areBothZero a b\n  -- Change the value in b[0]\n  y &lt;- areBothZero a b\n</code></pre>\n\n<p>Now there are two identical function calls, so the compiler is perfectly free to rewrite this:</p>\n\n<pre><code>do\n  let m = areBothZero a b\n  x &lt;- m\n  -- change b\n  y &lt;- m\n</code></pre>\n\n<p>The first time we run <code>m</code>, we perform the <code>IO</code>, reading <code>b</code> and getting an action <code>return True</code> or <code>return False</code>. We run that action and bind the result to <code>x</code>. The next time, we already have an action, so we run it, producing the same result. Any change to <code>b</code> is ignored.</p>\n\n<p>This is only <em>one</em> of the ways things can go wrong with <code>unsafePerformIO</code>, so watch out!</p>\n\n<hr>\n\n<p>I think there are one and a half ways it's reasonable to use <code>unsafePerformIO</code> or (in some cases) <code>unsafeDupablePerformIO</code> routinely. The entirely reasonable one is to wrap an \"essentially pure\" FFI call that just performs a mathematical calculation in another language. The less reasonable one is to create a global <code>IORef</code> or (more often) <code>MVar</code>. I think this is less reasonable because global variables have a certain tendency to turn out not to be as global as you thought once a year or two has passed. Most other uses of these unsafe <code>IO</code> operations require very careful thought to get right These tend to be in libraries like <code>monad-par</code> and <code>reflex</code> that introduce whole new styles of computation to Haskell. They also tend to be subtly buggy, sometimes for years, until someone figures out just what needs to happen to make them right. (Not to toot my own horn too much, but I think I'm probably one of the top handful of people in the world at reasoning about unsafe <code>IO</code>, and I very much prefer to avoid it when possible. This stuff has tripped up some of the best Haskell programmers and most important GHC developers.)</p>\n"}], "owner": {"reputation": 46777, "user_id": 1100107, "user_type": "registered", "accept_rate": 80, "profile_image": "https://www.gravatar.com/avatar/8789d3da0b482bcd8e562bfdf3687c74?s=128&d=identicon&r=PG", "display_name": "St&#233;phane Laurent", "link": "https://stackoverflow.com/users/1100107/st%c3%a9phane-laurent"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 174, "favorite_count": 0, "answer_count": 5, "score": 2, "last_activity_date": 1564256381, "creation_date": 1564160757, "last_edit_date": 1564172087, "question_id": 57224380, "link": "https://stackoverflow.com/questions/57224380/using-unsafeperformio-in-a-guard-condition", "title": "Using unsafePerformIO in a guard condition", "body": "<p>I have a function like this:</p>\n\n<pre><code>jac :: Int -&gt; Int -&gt; [Int] -&gt; [Int] -&gt; IOArray (Int,Int) Double -&gt; IO Double\njac m k mu nu arr\n  | nu!!0 == 0 = return 1\n  | length nu &gt; m &amp;&amp; nu!!m &gt; 0 = return 0\n  | m == 1 = return $ x!!0^(nu!!0) * theproduct (nu!!0)\n  | k == 0 &amp;&amp; CONDITION = XXX\n  | otherwise = YYY\n</code></pre>\n\n<p>The <code>CONDITION</code> must check that that element <code>(1,1)</code> of the array <code>arr</code> is different from 0. But to get this element, one must do </p>\n\n<pre><code>element &lt;- readArray arr (1,1)\n</code></pre>\n\n<p>I don't see how to do. Except with <code>unsafePerformIO</code>. Is it safe to use it here ? I mean:</p>\n\n<pre><code>  | k == 0 &amp;&amp; unsafePerformIO (readArray arr (1,1)) /= 0 = XXX\n</code></pre>\n\n<p>Otherwise, how could I do ?</p>\n"}, {"tags": ["haskell", "functional-programming", "functor", "ramda.js"], "comments": [{"owner": {"reputation": 314794, "user_id": 67579, "user_type": "registered", "accept_rate": 81, "profile_image": "https://i.stack.imgur.com/BJXub.png?s=128&g=1", "display_name": "Willem Van Onsem", "link": "https://stackoverflow.com/users/67579/willem-van-onsem"}, "edited": false, "score": 3, "creation_date": 1564151663, "post_id": 57222175, "comment_id": 100948712, "body": "In JavaScript, a string is not a list of characters. A string is an iterable of characters, but not a list. In Haskell <code>String</code> is a type synonym of <code>[Char]</code>."}, {"owner": {"reputation": 11144, "user_id": 4099454, "user_type": "registered", "accept_rate": 64, "profile_image": "https://i.stack.imgur.com/hjZGE.png?s=128&g=1", "display_name": "Hitmands", "link": "https://stackoverflow.com/users/4099454/hitmands"}, "reply_to_user": {"reputation": 314794, "user_id": 67579, "user_type": "registered", "accept_rate": 81, "profile_image": "https://i.stack.imgur.com/BJXub.png?s=128&g=1", "display_name": "Willem Van Onsem", "link": "https://stackoverflow.com/users/67579/willem-van-onsem"}, "edited": false, "score": 0, "creation_date": 1564151783, "post_id": 57222175, "comment_id": 100948777, "body": "well, why is it returning a list of strings then? I would expect the functor law to be respected... <code>map identity &quot;hello&quot;</code> should return &quot;hello&quot;"}, {"owner": {"reputation": 314794, "user_id": 67579, "user_type": "registered", "accept_rate": 81, "profile_image": "https://i.stack.imgur.com/BJXub.png?s=128&g=1", "display_name": "Willem Van Onsem", "link": "https://stackoverflow.com/users/67579/willem-van-onsem"}, "edited": false, "score": 0, "creation_date": 1564151949, "post_id": 57222175, "comment_id": 100948873, "body": "because afaik, JavaScript sees characters as 1-char strings, just like Python."}, {"owner": {"reputation": 507143, "user_id": 1048572, "user_type": "registered", "accept_rate": 77, "profile_image": "https://www.gravatar.com/avatar/7f2c4de95e8f4f8f5a71c3aaf0ed312a?s=128&d=identicon&r=PG", "display_name": "Bergi", "link": "https://stackoverflow.com/users/1048572/bergi"}, "edited": false, "score": 3, "creation_date": 1564152306, "post_id": 57222175, "comment_id": 100949105, "body": "I suppose Ramda&#39;s <code>map</code> is not designed to work on strings at all, and just doesn&#39;t throw an error because strings are array-like enough."}, {"owner": {"reputation": 11144, "user_id": 4099454, "user_type": "registered", "accept_rate": 64, "profile_image": "https://i.stack.imgur.com/hjZGE.png?s=128&g=1", "display_name": "Hitmands", "link": "https://stackoverflow.com/users/4099454/hitmands"}, "edited": false, "score": 0, "creation_date": 1564152429, "post_id": 57222175, "comment_id": 100949186, "body": "it works with iterables such as arrays, objects, strings... and behaves consistently for array and objects, but not for strings..."}, {"owner": {"reputation": 133611, "user_id": 152602, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/7f370b4bd787fc68f9f62d9c6781cb79?s=128&d=identicon&r=PG", "display_name": "Lee", "link": "https://stackoverflow.com/users/152602/lee"}, "edited": false, "score": 2, "creation_date": 1564153044, "post_id": 57222175, "comment_id": 100949543, "body": "strings aren&#39;t functors since they have the wrong kind. If you view strings as an iterable of strings then it appears to be consistent."}, {"owner": {"reputation": 36858, "user_id": 1243641, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/a70aa9d494bf438c8b56aced999e897f?s=128&d=identicon&r=PG", "display_name": "Scott Sauyet", "link": "https://stackoverflow.com/users/1243641/scott-sauyet"}, "edited": false, "score": 0, "creation_date": 1564161946, "post_id": 57222175, "comment_id": 100953579, "body": "There is definitely room out there for a library that works on arbitrary iterables, doing many of the same things that Ramda does (see raganwald&#39;s work for many examples) but I don&#39;t know that Ramda will ever turn into that."}], "answers": [{"comments": [{"owner": {"reputation": 11144, "user_id": 4099454, "user_type": "registered", "accept_rate": 64, "profile_image": "https://i.stack.imgur.com/hjZGE.png?s=128&g=1", "display_name": "Hitmands", "link": "https://stackoverflow.com/users/4099454/hitmands"}, "edited": false, "score": 0, "creation_date": 1564162232, "post_id": 57224454, "comment_id": 100953676, "body": "This makes sense, we can&#39;t think of a string as a functor. That&#39;s fair enough... and unintentional map&#39;s behaviour on string is why it differs from haskell."}, {"owner": {"reputation": 36858, "user_id": 1243641, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/a70aa9d494bf438c8b56aced999e897f?s=128&d=identicon&r=PG", "display_name": "Scott Sauyet", "link": "https://stackoverflow.com/users/1243641/scott-sauyet"}, "reply_to_user": {"reputation": 11144, "user_id": 4099454, "user_type": "registered", "accept_rate": 64, "profile_image": "https://i.stack.imgur.com/hjZGE.png?s=128&g=1", "display_name": "Hitmands", "link": "https://stackoverflow.com/users/4099454/hitmands"}, "edited": false, "score": 0, "creation_date": 1564162525, "post_id": 57224454, "comment_id": 100953788, "body": "@hitmands: It would not be unreasonable to do the type-checking, and if the input is a String, and the results of the transformation function are all strings, to <code>join(&#39;&#39;)</code> the results back into one, if you&#39;re interested in pursuing this.  Again, no guarantees that it would be accepted."}, {"owner": {"reputation": 57219, "user_id": 33796, "user_type": "registered", "accept_rate": 70, "profile_image": "https://www.gravatar.com/avatar/08727b23ba62e634b32988cdff082663?s=128&d=identicon&r=PG", "display_name": "luqui", "link": "https://stackoverflow.com/users/33796/luqui"}, "edited": false, "score": 0, "creation_date": 1564204176, "post_id": 57224454, "comment_id": 100962401, "body": "@ScottSauyet that behavior is not at all reasonable to me. God forbid you optimize <code>map(f, map(g, s))</code> to <code>map(compose(f,g),s)</code> and you get a phantom concatenation because <code>f</code> returns a string (but <code>g</code> doesn&#39;t).  Worse if this is in a polymorphic context where <code>f</code> returns strings sometimes but not others."}, {"owner": {"reputation": 36858, "user_id": 1243641, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/a70aa9d494bf438c8b56aced999e897f?s=128&d=identicon&r=PG", "display_name": "Scott Sauyet", "link": "https://stackoverflow.com/users/1243641/scott-sauyet"}, "reply_to_user": {"reputation": 57219, "user_id": 33796, "user_type": "registered", "accept_rate": 70, "profile_image": "https://www.gravatar.com/avatar/08727b23ba62e634b32988cdff082663?s=128&d=identicon&r=PG", "display_name": "luqui", "link": "https://stackoverflow.com/users/33796/luqui"}, "edited": false, "score": 0, "creation_date": 1564264899, "post_id": 57224454, "comment_id": 100975080, "body": "@luqui: Note that this would only happen if the second parameter to <code>map</code> was a string.  Right now that&#39;s formally undefined behavior, and in practice acts as <code>map(f, str.split(&#39;&#39;))</code>.  I&#39;m suggesting that we might add the behavior <code>map :: (char -&gt; char) -&gt; String -&gt; String</code>, where <code>char</code> is a single-character string.  This would match Haskell&#39;s behavior, and would be fairly simple to implement (and we could avoid the expensive part of that calculation unless the user supplied a string.)  As to your &quot;polymorphic&quot; context, any function like that would already have issues working with Ramda."}, {"owner": {"reputation": 57219, "user_id": 33796, "user_type": "registered", "accept_rate": 70, "profile_image": "https://www.gravatar.com/avatar/08727b23ba62e634b32988cdff082663?s=128&d=identicon&r=PG", "display_name": "luqui", "link": "https://stackoverflow.com/users/33796/luqui"}, "edited": false, "score": 0, "creation_date": 1564295872, "post_id": 57224454, "comment_id": 100978578, "body": "@ScottSauyet, yes, true, the wacky behavior would only occur a tiny fraction of the time.  This does not improve the situation..."}, {"owner": {"reputation": 36858, "user_id": 1243641, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/a70aa9d494bf438c8b56aced999e897f?s=128&d=identicon&r=PG", "display_name": "Scott Sauyet", "link": "https://stackoverflow.com/users/1243641/scott-sauyet"}, "reply_to_user": {"reputation": 57219, "user_id": 33796, "user_type": "registered", "accept_rate": 70, "profile_image": "https://www.gravatar.com/avatar/08727b23ba62e634b32988cdff082663?s=128&d=identicon&r=PG", "display_name": "luqui", "link": "https://stackoverflow.com/users/33796/luqui"}, "edited": false, "score": 0, "creation_date": 1564347384, "post_id": 57224454, "comment_id": 100990395, "body": "@luqui: I suppose I simply don&#39;t see what those cases would be.  I&#39;ve opened up <a href=\"https://github.com/ramda/ramda/issues/2870\" rel=\"nofollow noreferrer\">an issue</a> on the Ramda tracker to discuss this, if anyone is interested"}, {"owner": {"reputation": 57219, "user_id": 33796, "user_type": "registered", "accept_rate": 70, "profile_image": "https://www.gravatar.com/avatar/08727b23ba62e634b32988cdff082663?s=128&d=identicon&r=PG", "display_name": "luqui", "link": "https://stackoverflow.com/users/33796/luqui"}, "edited": false, "score": 0, "creation_date": 1564389353, "post_id": 57224454, "comment_id": 101000094, "body": "@ScottSauyet I told you: if you fuse two maps in a row, <code>map(f,map(g,s))</code>, and the intermediate type is not char/string, say <code>g : char -&gt; int</code>; <code>f : int -&gt; char</code>, (imagine, say, mapping to ints and back for rot13) the implicit concatenation disappears and suddenly you are getting a string instead of a list back. Imagine trying to track that down as the cause of a bug! These &quot;cute&quot; type-sensitive conveniences are more nefarious than they appear."}, {"owner": {"reputation": 36858, "user_id": 1243641, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/a70aa9d494bf438c8b56aced999e897f?s=128&d=identicon&r=PG", "display_name": "Scott Sauyet", "link": "https://stackoverflow.com/users/1243641/scott-sauyet"}, "reply_to_user": {"reputation": 57219, "user_id": 33796, "user_type": "registered", "accept_rate": 70, "profile_image": "https://www.gravatar.com/avatar/08727b23ba62e634b32988cdff082663?s=128&d=identicon&r=PG", "display_name": "luqui", "link": "https://stackoverflow.com/users/33796/luqui"}, "edited": false, "score": 0, "creation_date": 1564398269, "post_id": 57224454, "comment_id": 101004841, "body": "@luqui: This is already undefined behavior that happens to fall out of the implementation. It has no guarantee. If you call <code>map(f, &#39;somestring&#39;)</code> Ramda might, for all you know, divide by zero, launch the missiles, and steal your girlfriend. If we were to define this behavior, what would we want? We obviously can&#39;t handle <code>char -&gt; a</code> in any useful way, but we could reasonably handle <code>char -&gt; char</code>. The question is whether it would make sense to cover a non-functor in <code>map</code>. In Haskell, it&#39;s simply a separate function; here it&#39;s a harder call. My instinct is still no, but it&#39;s interesting."}, {"owner": {"reputation": 57219, "user_id": 33796, "user_type": "registered", "accept_rate": 70, "profile_image": "https://www.gravatar.com/avatar/08727b23ba62e634b32988cdff082663?s=128&d=identicon&r=PG", "display_name": "luqui", "link": "https://stackoverflow.com/users/33796/luqui"}, "edited": false, "score": 0, "creation_date": 1564438716, "post_id": 57224454, "comment_id": 101023193, "body": "@ScottSauyet, Ah, I see what you mean about undefined behavior.  So you&#39;re saying if the function doesn&#39;t happen to always return chars, then it&#39;s just an error.  That feels more reasonable.  I still am uncomfortable with ad hoc overloading (esp in dynamic languages); I would rather it be a method of string or a separate function with a different name."}, {"owner": {"reputation": 36858, "user_id": 1243641, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/a70aa9d494bf438c8b56aced999e897f?s=128&d=identicon&r=PG", "display_name": "Scott Sauyet", "link": "https://stackoverflow.com/users/1243641/scott-sauyet"}, "reply_to_user": {"reputation": 57219, "user_id": 33796, "user_type": "registered", "accept_rate": 70, "profile_image": "https://www.gravatar.com/avatar/08727b23ba62e634b32988cdff082663?s=128&d=identicon&r=PG", "display_name": "luqui", "link": "https://stackoverflow.com/users/33796/luqui"}, "edited": false, "score": 0, "creation_date": 1564486739, "post_id": 57224454, "comment_id": 101039609, "body": "@luqui: Ramda often delegates calls to the data object when we don&#39;t supply them.  For this reason, Ramda&#39;s <code>map</code>, which we only implement internally for <code>Array</code>, <code>Object</code>, and <code>Function</code>, will also work with any Fantasy-Land functor, or with your custom type that has a <code>map</code> method.  That can&#39;t happen here, since <code>map</code> is not on <code>String.prototype</code>, but we could decide to handle it ourselves.  I&#39;m inclined not to do so, but I don&#39;t like the current behavior, and I&#39;m loathe to throw exceptions for reasons of composibility.  So I&#39;m not really happy with any options I can see."}], "tags": [], "owner": {"reputation": 36858, "user_id": 1243641, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/a70aa9d494bf438c8b56aced999e897f?s=128&d=identicon&r=PG", "display_name": "Scott Sauyet", "link": "https://stackoverflow.com/users/1243641/scott-sauyet"}, "is_accepted": true, "score": 7, "last_activity_date": 1564346295, "last_edit_date": 1564346295, "creation_date": 1564161163, "answer_id": 57224454, "question_id": 57222175, "link": "https://stackoverflow.com/questions/57222175/map-behaviour-with-strings/57224454#57224454", "title": "map behaviour with strings", "body": "<p>As the comments say, Strings are not <a href=\"https://github.com/fantasyland/fantasy-land/#functor\" rel=\"nofollow noreferrer\"><code>functor</code>s</a>.  The functor laws require</p>\n\n<pre class=\"lang-hs prettyprint-override\"><code>map :: Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b\n</code></pre>\n\n<p>That is, for a functor holding an item or items of type <code>a</code> and a function from type <code>a</code> to type <code>b</code>, it will return a functor of the same type holding an item or items of type <code>b</code>.  A String cannot do that, as it holds only characters.  For instance, what would you expect <code>map(_ =&gt; 1.234, \"hello\")</code> to return?</p>\n\n<p>Ramda's behavior on Strings is not intentional.  It simply falls out of the implementation, as Bergi suggested.  Strings look enough like arrays (with integer <code>length</code> properties and integer-indexed sub-elements) that the code treats them as though they were arrays.</p>\n\n<p>Ramda has always intended to be a low-level library, and the founders weren't particularly interested in writing hand-holding code.  It should work as advertised if you supply the types required, but there are few guarantees if you don't. However, if you feel strongly about this, feel free to <a href=\"https://github.com/ramda/ramda/issues/new\" rel=\"nofollow noreferrer\">raise an issue</a> with the Ramda team about it, or even better, <a href=\"https://github.com/ramda/ramda/compare\" rel=\"nofollow noreferrer\">raise a pull request</a> with the behavior you'd prefer.  It might not get accepted, but it will receive a fair hearing.</p>\n"}], "owner": {"reputation": 11144, "user_id": 4099454, "user_type": "registered", "accept_rate": 64, "profile_image": "https://i.stack.imgur.com/hjZGE.png?s=128&g=1", "display_name": "Hitmands", "link": "https://stackoverflow.com/users/4099454/hitmands"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 138, "favorite_count": 0, "accepted_answer_id": 57224454, "answer_count": 1, "score": 3, "last_activity_date": 1564346295, "creation_date": 1564151607, "last_edit_date": 1564152624, "question_id": 57222175, "link": "https://stackoverflow.com/questions/57222175/map-behaviour-with-strings", "title": "map behaviour with strings", "body": "<p>given that <code>map</code> is:</p>\n\n<pre><code>map :: (a -&gt; b) -&gt; [a] -&gt; [b]\n</code></pre>\n\n<p>why <code>R.map(R.toUpper, 'hello')</code> returns <code>['H', 'E', 'L', 'L', 'O']</code> and not <code>\"HELLO\"</code>?</p>\n\n<p>in haskell, for instance, a string is a list of chars, so <code>map toUpper \"hello\"</code> behaves as expected (<code>HELLO</code>).</p>\n\n<p>Shouldn't Ramda's <code>map</code> be doing the same?</p>\n\n<hr>\n\n<p>It might be a design choice but I think Ramda's map might be violating the functor law: \n<strong>If we map the id function over a functor, we don't get back the original functor</strong></p>\n\n<p><div class=\"snippet\" data-lang=\"js\" data-hide=\"false\" data-console=\"true\" data-babel=\"false\">\r\n<div class=\"snippet-code\">\r\n<pre class=\"snippet-code-js lang-js prettyprint-override\"><code>console.log(\r\n  R.map(R.identity, 'Hello World'),\r\n);</code></pre>\r\n<pre class=\"snippet-code-html lang-html prettyprint-override\"><code>&lt;script src=\"https://cdnjs.cloudflare.com/ajax/libs/ramda/0.26.1/ramda.js\" integrity=\"sha256-xB25ljGZ7K2VXnq087unEnoVhvTosWWtqXB4tAtZmHU=\" crossorigin=\"anonymous\"&gt;&lt;/script&gt;</code></pre>\r\n</div>\r\n</div>\r\n</p>\n\n<p>Why wouldn't I be expecting <code>map</code> to behave more like:</p>\n\n<p><div class=\"snippet\" data-lang=\"js\" data-hide=\"false\" data-console=\"true\" data-babel=\"false\">\r\n<div class=\"snippet-code\">\r\n<pre class=\"snippet-code-js lang-js prettyprint-override\"><code>const map = (fn, string) =&gt; string.replace(/./g, fn);\r\n\r\n\r\nconsole.log(\r\n  map(R.toUpper, 'hello world'),\r\n);</code></pre>\r\n<pre class=\"snippet-code-html lang-html prettyprint-override\"><code>&lt;script src=\"https://cdnjs.cloudflare.com/ajax/libs/ramda/0.26.1/ramda.js\" integrity=\"sha256-xB25ljGZ7K2VXnq087unEnoVhvTosWWtqXB4tAtZmHU=\" crossorigin=\"anonymous\"&gt;&lt;/script&gt;</code></pre>\r\n</div>\r\n</div>\r\n</p>\n"}, {"tags": ["haskell", "applicative", "maybe"], "comments": [{"owner": {"reputation": 314794, "user_id": 67579, "user_type": "registered", "accept_rate": 81, "profile_image": "https://i.stack.imgur.com/BJXub.png?s=128&g=1", "display_name": "Willem Van Onsem", "link": "https://stackoverflow.com/users/67579/willem-van-onsem"}, "edited": false, "score": 2, "creation_date": 1564145284, "post_id": 57220345, "comment_id": 100944936, "body": "Since the <code>fmap f x = pure f &lt;*&gt; x</code> law holds, it is not uncommon that one is sometimes implemented in terms of the other. But here the implementation of <code>&lt;*&gt;</code> still does some work: it does pattern matching and unwraps the <code>g</code> out of the <code>Just</code> data constructor."}, {"owner": {"reputation": 314794, "user_id": 67579, "user_type": "registered", "accept_rate": 81, "profile_image": "https://i.stack.imgur.com/BJXub.png?s=128&g=1", "display_name": "Willem Van Onsem", "link": "https://stackoverflow.com/users/67579/willem-van-onsem"}, "edited": false, "score": 0, "creation_date": 1564145543, "post_id": 57220345, "comment_id": 100945093, "body": "Note that your <code>fmap0</code> is <code>pure</code>, something that is <i>not</i> defined on a <code>Functor</code>."}, {"owner": {"reputation": 1, "user_id": 156458, "user_type": "registered", "accept_rate": 47, "profile_image": "https://i.stack.imgur.com/3PCjR.png?s=128&g=1", "display_name": "Tim", "link": "https://stackoverflow.com/users/156458/tim"}, "reply_to_user": {"reputation": 314794, "user_id": 67579, "user_type": "registered", "accept_rate": 81, "profile_image": "https://i.stack.imgur.com/BJXub.png?s=128&g=1", "display_name": "Willem Van Onsem", "link": "https://stackoverflow.com/users/67579/willem-van-onsem"}, "edited": false, "score": 0, "creation_date": 1564146007, "post_id": 57220345, "comment_id": 100945379, "body": "Thanks. In Maybe applicative, could you write `&lt;*&gt; without fmap?"}, {"owner": {"reputation": 314794, "user_id": 67579, "user_type": "registered", "accept_rate": 81, "profile_image": "https://i.stack.imgur.com/BJXub.png?s=128&g=1", "display_name": "Willem Van Onsem", "link": "https://stackoverflow.com/users/67579/willem-van-onsem"}, "edited": false, "score": 1, "creation_date": 1564146087, "post_id": 57220345, "comment_id": 100945432, "body": "you can just &quot;inline&quot; the definition of <code>fmap</code> in the definition of <code>(&lt;*&gt;)</code>, like <code>Just f &lt;*&gt; Just x = Just (f x)</code> and <code>_ &lt;*&gt; _ = Nothing</code>"}, {"owner": {"reputation": 314794, "user_id": 67579, "user_type": "registered", "accept_rate": 81, "profile_image": "https://i.stack.imgur.com/BJXub.png?s=128&g=1", "display_name": "Willem Van Onsem", "link": "https://stackoverflow.com/users/67579/willem-van-onsem"}, "edited": false, "score": 5, "creation_date": 1564147006, "post_id": 57220345, "comment_id": 100946002, "body": "As @AJFarmar already says, it might probably help to &quot;get your hands dirty&quot; and do some implementations. Yes studying algebraic structures definitely has a lot of value (especially in Haskell), but usually one appreciates the power of algebraic structures more, once one has solved some challenges."}], "answers": [{"comments": [{"owner": {"reputation": 384463, "user_id": 1126841, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/fa05233b2357f8d11c22ef4cfc7bb85c?s=128&d=identicon&r=PG", "display_name": "chepner", "link": "https://stackoverflow.com/users/1126841/chepner"}, "reply_to_user": {"reputation": 61419, "user_id": 849891, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/MbEO3.png?s=128&g=1", "display_name": "Will Ness", "link": "https://stackoverflow.com/users/849891/will-ness"}, "edited": false, "score": 0, "creation_date": 1564158026, "post_id": 57223385, "comment_id": 100951978, "body": "Yeah, blanked on <code>concat</code>&#39;s arguments (would have been <code>concat [fmap f xs, fs &lt;*&gt; xs]</code>)."}, {"owner": {"reputation": 61419, "user_id": 849891, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/MbEO3.png?s=128&g=1", "display_name": "Will Ness", "link": "https://stackoverflow.com/users/849891/will-ness"}, "edited": false, "score": 0, "creation_date": 1564158223, "post_id": 57223385, "comment_id": 100952052, "body": "<code>(f:fs) &lt;*&gt; xs = fmap f xs ++ (fs &lt;*&gt; xs) = concat [fmap f xs, fs &lt;*&gt; xs] = concat [fmap f xs | f &lt;- fs] = [f x | f &lt;- fx, x &lt;- xs]</code> ... (it also means, <code>[f, g] &lt;*&gt; [x, y] == [f x, f y, g x, g y]</code> ...) BTW it&#39;s interesting, could the transposed version be the canonical...? probably would break some laws maybe..."}, {"owner": {"reputation": 384463, "user_id": 1126841, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/fa05233b2357f8d11c22ef4cfc7bb85c?s=128&d=identicon&r=PG", "display_name": "chepner", "link": "https://stackoverflow.com/users/1126841/chepner"}, "reply_to_user": {"reputation": 61419, "user_id": 849891, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/MbEO3.png?s=128&g=1", "display_name": "Will Ness", "link": "https://stackoverflow.com/users/849891/will-ness"}, "edited": false, "score": 0, "creation_date": 1564158908, "post_id": 57223385, "comment_id": 100952344, "body": "@WillNess That&#39;s actually the equivalence I meant to add in the comment. On the plus side, I think this answer is running out of things to fix :)"}], "tags": [], "owner": {"reputation": 384463, "user_id": 1126841, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/fa05233b2357f8d11c22ef4cfc7bb85c?s=128&d=identicon&r=PG", "display_name": "chepner", "link": "https://stackoverflow.com/users/1126841/chepner"}, "is_accepted": false, "score": 5, "last_activity_date": 1564158819, "last_edit_date": 1564158819, "creation_date": 1564156322, "answer_id": 57223385, "question_id": 57220345, "link": "https://stackoverflow.com/questions/57220345/is-the-implementation-of-based-on-fmap-special-to-maybe-applicative-or-c/57223385#57223385", "title": "Is the implementation of `&lt;*&gt;` based on `fmap` special to Maybe applicative or can it be generalized to other applicatives?", "body": "<p>It cannot be generalized. A <code>Functor</code> instance is unique:</p>\n\n<pre><code>instance Functor [] where\n    fmap = map\n</code></pre>\n\n<p>but there can be multiple valid <code>Applicative</code> instances for the same type constructor.</p>\n\n<pre><code>-- \"Canonical\" instance: [f, g] &lt;*&gt; [x, y] == [f x, f y, g x, g y]\ninstance Applicative [] where\n    pure x = [x]\n    [] &lt;*&gt; _ = []\n    (f:fs) &lt;*&gt; xs = fmap f xs ++ (fs &lt;*&gt; xs)\n\n-- Zip instance: [f, g] &lt;*&gt; [x, y] == [f x, g y]\ninstance Applicative [] where\n    pure x = repeat x\n    (f:fs) &lt;*&gt; (x:xs) = f x : (fs &lt;*&gt; xs)\n    _ &lt;*&gt; _ = []\n</code></pre>\n\n<p>In the latter, we neither want to apply any single function from the left argument to all elements of the right, nor apply all the functions on the left to any single element on the right, making <code>fmap</code> useless.</p>\n"}], "owner": {"reputation": 1, "user_id": 156458, "user_type": "registered", "accept_rate": 47, "profile_image": "https://i.stack.imgur.com/3PCjR.png?s=128&g=1", "display_name": "Tim", "link": "https://stackoverflow.com/users/156458/tim"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 149, "favorite_count": 0, "answer_count": 1, "score": -3, "last_activity_date": 1564158819, "creation_date": 1564145000, "last_edit_date": 1564145419, "question_id": 57220345, "link": "https://stackoverflow.com/questions/57220345/is-the-implementation-of-based-on-fmap-special-to-maybe-applicative-or-c", "title": "Is the implementation of `&lt;*&gt;` based on `fmap` special to Maybe applicative or can it be generalized to other applicatives?", "body": "<p>In Maybe applicative, <code>&lt;*&gt;</code> can be implemented based on <code>fmap</code>. Is it incidental, or can it be generalized to other applicative(s)?</p>\n\n<pre><code>(&lt;*&gt;)   ::  Maybe   (a  -&gt;  b)  -&gt;  Maybe   a   -&gt;  Maybe   b\nNothing &lt;*&gt; _   =   Nothing\n(Just   g)  &lt;*&gt; mx  =   fmap    g   mx\n</code></pre>\n\n<p>Thanks.</p>\n\n<p>See also <a href=\"https://stackoverflow.com/questions/57188385/in-applicative-how-can-be-represented-in-terms-of-fmap-i-i-0-1-2\">In applicative, how can `&lt;*&gt;` be represented in terms of `fmap_i, i=0,1,2,...`?</a></p>\n"}, {"tags": ["haskell", "monads"], "comments": [{"owner": {"reputation": 314794, "user_id": 67579, "user_type": "registered", "accept_rate": 81, "profile_image": "https://i.stack.imgur.com/BJXub.png?s=128&g=1", "display_name": "Willem Van Onsem", "link": "https://stackoverflow.com/users/67579/willem-van-onsem"}, "edited": false, "score": 4, "creation_date": 1564140094, "post_id": 57219021, "comment_id": 100942273, "body": "Exactly the sam way, with <code>m &gt;&gt;= id</code>."}], "answers": [{"tags": [], "owner": {"reputation": 36513, "user_id": 752976, "user_type": "registered", "accept_rate": 84, "profile_image": "https://i.stack.imgur.com/j7Uis.jpg?s=128&g=1", "display_name": "Bartek Banachewicz", "link": "https://stackoverflow.com/users/752976/bartek-banachewicz"}, "is_accepted": false, "score": 5, "last_activity_date": 1564140426, "creation_date": 1564140426, "answer_id": 57219111, "question_id": 57219021, "link": "https://stackoverflow.com/questions/57219021/how-is-join-implemented-in-maybe-list-monad/57219111#57219111", "title": "How is `join` implemented in Maybe/List monad?", "body": "<p><code>join</code> is implemented <em>exactly once</em>, and it works for all types that are Monads.</p>\n\n<p>The very point of the Monad abstraction is to enable working on different types in the same way. Once you provide <code>&gt;&gt;=</code> (and <code>return</code>) for your type, and make sure they follow the Monad laws, any code that is generic enough to only use those operations will work on your type correctly.</p>\n"}, {"comments": [{"owner": {"reputation": 314794, "user_id": 67579, "user_type": "registered", "accept_rate": 81, "profile_image": "https://i.stack.imgur.com/BJXub.png?s=128&g=1", "display_name": "Willem Van Onsem", "link": "https://stackoverflow.com/users/67579/willem-van-onsem"}, "reply_to_user": {"reputation": 61419, "user_id": 849891, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/MbEO3.png?s=128&g=1", "display_name": "Will Ness", "link": "https://stackoverflow.com/users/849891/will-ness"}, "edited": false, "score": 0, "creation_date": 1564150536, "post_id": 57219170, "comment_id": 100947956, "body": "@join: well it is not implemented per monad instance. The definition is each time the same. It is the ad-hoc polymorphism of <code>(&gt;&gt;)</code> that here ensures the behaviour is different."}, {"owner": {"reputation": 61419, "user_id": 849891, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/MbEO3.png?s=128&g=1", "display_name": "Will Ness", "link": "https://stackoverflow.com/users/849891/will-ness"}, "edited": false, "score": 0, "creation_date": 1564150662, "post_id": 57219170, "comment_id": 100948049, "body": "<a href=\"https://xkcd.com/386/\" rel=\"nofollow noreferrer\">someone was <i>wrong</i> on the internets</a>. all&#39;s better now. :)"}, {"owner": {"reputation": 314794, "user_id": 67579, "user_type": "registered", "accept_rate": 81, "profile_image": "https://i.stack.imgur.com/BJXub.png?s=128&g=1", "display_name": "Willem Van Onsem", "link": "https://stackoverflow.com/users/67579/willem-van-onsem"}, "reply_to_user": {"reputation": 61419, "user_id": 849891, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/MbEO3.png?s=128&g=1", "display_name": "Will Ness", "link": "https://stackoverflow.com/users/849891/will-ness"}, "edited": false, "score": 0, "creation_date": 1564150692, "post_id": 57219170, "comment_id": 100948064, "body": "@WillNess: and the best way to get a correct answer, is giving a wrong answer, not asking a question :)"}, {"owner": {"reputation": 730, "user_id": 1461328, "user_type": "registered", "accept_rate": 88, "profile_image": "https://www.gravatar.com/avatar/9ab9a9eb59973a7ec2be684341370e2a?s=128&d=identicon&r=PG", "display_name": "user1461328", "link": "https://stackoverflow.com/users/1461328/user1461328"}, "edited": false, "score": 0, "creation_date": 1569554665, "post_id": 57219170, "comment_id": 102642361, "body": "id has type of id :: a -&gt; a, how can it be used in x &gt;&gt;= id ?  (&gt;&gt;=) requires a type of (a -&gt; m b), doesn&#39;t it ?"}, {"owner": {"reputation": 314794, "user_id": 67579, "user_type": "registered", "accept_rate": 81, "profile_image": "https://i.stack.imgur.com/BJXub.png?s=128&g=1", "display_name": "Willem Van Onsem", "link": "https://stackoverflow.com/users/67579/willem-van-onsem"}, "reply_to_user": {"reputation": 730, "user_id": 1461328, "user_type": "registered", "accept_rate": 88, "profile_image": "https://www.gravatar.com/avatar/9ab9a9eb59973a7ec2be684341370e2a?s=128&d=identicon&r=PG", "display_name": "user1461328", "link": "https://stackoverflow.com/users/1461328/user1461328"}, "edited": false, "score": 0, "creation_date": 1569562527, "post_id": 57219170, "comment_id": 102644036, "body": "@user1461328: <code>id</code> has type <code>a -&gt; a</code>, so it can for example take as specific type <code>Maybe Int -&gt; Maybe Int</code>, and thus then it can typecheck when using it with <code>&gt;&gt;=</code>."}, {"owner": {"reputation": 730, "user_id": 1461328, "user_type": "registered", "accept_rate": 88, "profile_image": "https://www.gravatar.com/avatar/9ab9a9eb59973a7ec2be684341370e2a?s=128&d=identicon&r=PG", "display_name": "user1461328", "link": "https://stackoverflow.com/users/1461328/user1461328"}, "edited": false, "score": 0, "creation_date": 1569810180, "post_id": 57219170, "comment_id": 102703738, "body": "@WillemVanOnsem: <code>Maybe Int -&gt; Maybe Int</code>  is still basically<code>a -&gt; a</code>, not  <code>a -&gt; m a</code>.  Could you please explain how this is applied to <code>Nothing </code>, like <code>join Nothing</code> ?"}, {"owner": {"reputation": 314794, "user_id": 67579, "user_type": "registered", "accept_rate": 81, "profile_image": "https://i.stack.imgur.com/BJXub.png?s=128&g=1", "display_name": "Willem Van Onsem", "link": "https://stackoverflow.com/users/67579/willem-van-onsem"}, "reply_to_user": {"reputation": 730, "user_id": 1461328, "user_type": "registered", "accept_rate": 88, "profile_image": "https://www.gravatar.com/avatar/9ab9a9eb59973a7ec2be684341370e2a?s=128&d=identicon&r=PG", "display_name": "user1461328", "link": "https://stackoverflow.com/users/1461328/user1461328"}, "edited": false, "score": 0, "creation_date": 1569822845, "post_id": 57219170, "comment_id": 102706077, "body": "@user1461328: it is, note that it is <code>a -&gt; m b</code>, and thus <code>id :: c -&gt; c</code> (note that the variables are different ones, so we better do not use <code>a</code> twice) can unfiy with <code>a ~ Maybe Int</code>, <code>m ~ Maybe</code> and <code>b ~ Int</code>."}, {"owner": {"reputation": 314794, "user_id": 67579, "user_type": "registered", "accept_rate": 81, "profile_image": "https://i.stack.imgur.com/BJXub.png?s=128&g=1", "display_name": "Willem Van Onsem", "link": "https://stackoverflow.com/users/67579/willem-van-onsem"}, "reply_to_user": {"reputation": 730, "user_id": 1461328, "user_type": "registered", "accept_rate": 88, "profile_image": "https://www.gravatar.com/avatar/9ab9a9eb59973a7ec2be684341370e2a?s=128&d=identicon&r=PG", "display_name": "user1461328", "link": "https://stackoverflow.com/users/1461328/user1461328"}, "edited": false, "score": 0, "creation_date": 1569823382, "post_id": 57219170, "comment_id": 102706214, "body": "@user1461328: it is key that it is a <code>b</code> in <code>a -&gt; m b</code>, that thus means that <code>a</code> can be monadic, and <code>m b</code> as well."}, {"owner": {"reputation": 730, "user_id": 1461328, "user_type": "registered", "accept_rate": 88, "profile_image": "https://www.gravatar.com/avatar/9ab9a9eb59973a7ec2be684341370e2a?s=128&d=identicon&r=PG", "display_name": "user1461328", "link": "https://stackoverflow.com/users/1461328/user1461328"}, "edited": false, "score": 0, "creation_date": 1570093254, "post_id": 57219170, "comment_id": 102807601, "body": "@WillemVanOnsem, thanks a lot for answering my stupid questions. I think I got your point now."}], "tags": [], "owner": {"reputation": 314794, "user_id": 67579, "user_type": "registered", "accept_rate": 81, "profile_image": "https://i.stack.imgur.com/BJXub.png?s=128&g=1", "display_name": "Willem Van Onsem", "link": "https://stackoverflow.com/users/67579/willem-van-onsem"}, "is_accepted": false, "score": 3, "last_activity_date": 1564150598, "last_edit_date": 1564150598, "creation_date": 1564140636, "answer_id": 57219170, "question_id": 57219021, "link": "https://stackoverflow.com/questions/57219021/how-is-join-implemented-in-maybe-list-monad/57219170#57219170", "title": "How is `join` implemented in Maybe/List monad?", "body": "<p><code>join</code> is just <a href=\"https://hackage.haskell.org/package/base-4.12.0.0/docs/src/GHC.Base.html#join\" rel=\"nofollow noreferrer\">implemented as [src]</a>:</p>\n\n<blockquote><pre><code>join              :: (Monad m) =&gt; m (m a) -&gt; m a\njoin x            =  x &gt;&gt;= id</code></pre></blockquote>\n\n<p>If we take a look at the monad instances of <a href=\"https://hackage.haskell.org/package/base-4.12.0.0/docs/src/GHC.Base.html#line-984\" rel=\"nofollow noreferrer\"><code>[]</code> [src]</a> and <a href=\"https://hackage.haskell.org/package/base-4.12.0.0/docs/src/GHC.Base.html#line-854\" rel=\"nofollow noreferrer\"><code>Maybe</code> [src]</a>, we see:</p>\n\n<blockquote><pre><code>instance Monad []  where\n    {-# INLINE (&gt;&gt;=) #-}\n    xs &gt;&gt;= f             = [y | x &lt;- xs, y &lt;- f x]\n    {-# INLINE (&gt;&gt;) #-}\n    (&gt;&gt;) = (*&gt;)\n    {-# INLINE fail #-}\n    fail _               = []</code></pre></blockquote>\n\n<blockquote><pre><code>instance  Monad Maybe  where\n    (Just x) &gt;&gt;= k      = k x\n    Nothing  &gt;&gt;= _      = Nothing\n\n    (&gt;&gt;) = (*&gt;)\n\n    fail _              = Nothing</code></pre></blockquote>\n\n<p>So that means that for lists, <code>join</code> is equivalent to:</p>\n\n<pre><code>-- for lists\n   join xs\n-&gt; xs &gt;&gt;= id\n-&gt; [ y | x &lt;- xs, y &lt;- id x ]\n-&gt; concatMap id xs\n-&gt; concat xs\n</code></pre>\n\n<p>so for lists, the equivalent implementation is:</p>\n\n<pre><code>join_list :: [[a]] -&gt; [a]\njoin_list = concat\n</code></pre>\n\n<p>For <code>Maybe</code> we can do case-analysis: the input is a <code>Maybe (Maybe a)</code> so there are basically three possibilities here:</p>\n\n<pre><code>-- (1)\n   join Nothing\n-&gt; Nothing &gt;&gt;= id\n-&gt; Nothing\n\n-- (2)\n   join (Just Nothing)\n-&gt; Just Nothing &gt;&gt;= id\n-&gt; id Nothing\n-&gt; Nothing\n\n-- (3)\n   join (Just (Just x))\n-&gt; Just (Just x) &gt;&gt;= id\n-&gt; id (Just x)\n-&gt; Just x\n</code></pre>\n\n<p>So that means that for <code>Maybe</code>s the equivalent implementation is:</p>\n\n<pre><code>join_maybe :: Maybe (Maybe a) -&gt; Maybe a\njoin_maybe (Just x) = x\njoin_maybe Nothing = Nothing\n</code></pre>\n\n<p><code>join</code> is thus not <em>reimplemented</em> for list or <code>Maybe</code> monads, it simply uses the implementation for <code>(&gt;&gt;=)</code> for lists and <code>Maybe</code>s, and since these differ, the behavior of <code>join</code> is of course different.</p>\n"}, {"comments": [{"owner": {"reputation": 61419, "user_id": 849891, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/MbEO3.png?s=128&g=1", "display_name": "Will Ness", "link": "https://stackoverflow.com/users/849891/will-ness"}, "edited": false, "score": 1, "creation_date": 1564150309, "post_id": 57221447, "comment_id": 100947830, "body": "<a href=\"https://ryanglscott.github.io/2018/03/04/how-quantifiedconstraints-can-let-us-put-join-back-in-monad/\" rel=\"nofollow noreferrer\">BTW</a>."}], "tags": [], "owner": {"reputation": 384463, "user_id": 1126841, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/fa05233b2357f8d11c22ef4cfc7bb85c?s=128&d=identicon&r=PG", "display_name": "chepner", "link": "https://stackoverflow.com/users/1126841/chepner"}, "is_accepted": false, "score": 4, "last_activity_date": 1564148941, "creation_date": 1564148941, "answer_id": 57221447, "question_id": 57219021, "link": "https://stackoverflow.com/questions/57219021/how-is-join-implemented-in-maybe-list-monad/57221447#57221447", "title": "How is `join` implemented in Maybe/List monad?", "body": "<p><code>join</code> is just a regular function, implemented in terms of the preexisting <code>(&gt;&gt;=)</code> function. You don't have to worry about <em>which</em> monad is used; <code>(&gt;&gt;=)</code> takes care of that.</p>\n\n<p>Conversely, <code>Monad</code> <em>could</em> have been defined in a way closer to its mathematical definition:</p>\n\n<pre><code>class Monad' m where\n    return :: a -&gt; m a\n    join :: m (m a) -&gt; m a\n</code></pre>\n\n<p>with</p>\n\n<pre><code>(&gt;&gt;=) :: Monad' m =&gt; m a -&gt; (a -&gt; m b) -&gt; m b\nx &gt;&gt;= f = join (fmap f x)\n</code></pre>\n\n<p>as the regular function. Then the list-specific definition of <code>join</code> would just be <code>concat :: [[a]] -&gt; [a]</code>:</p>\n\n<pre><code>instance Monad' [] where\n    return x = [x]\n    join = concat\n</code></pre>\n"}], "owner": {"reputation": 1, "user_id": 156458, "user_type": "registered", "accept_rate": 47, "profile_image": "https://i.stack.imgur.com/3PCjR.png?s=128&g=1", "display_name": "Tim", "link": "https://stackoverflow.com/users/156458/tim"}, "delete_vote_count": 1, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 298, "favorite_count": 0, "closed_date": 1564166997, "answer_count": 3, "score": 3, "last_activity_date": 1564150598, "creation_date": 1564140065, "question_id": 57219021, "link": "https://stackoverflow.com/questions/57219021/how-is-join-implemented-in-maybe-list-monad", "closed_reason": "Duplicate", "title": "How is `join` implemented in Maybe/List monad?", "body": "<p><code>join</code> can be defined implemented in terms of <code>&gt;&gt;=</code>:</p>\n\n<pre><code>join :: Monad m =&gt; m (m a) -&gt; m a\njoin m = m &gt;&gt;= id\n</code></pre>\n\n<p>Specifically, how is it implemented in a Maybe and a List monad?</p>\n\n<p>Is it in Maybe monad:</p>\n\n<pre><code>join Nothing = Nothing\njoin (Just (Just x)) = Just x\n</code></pre>\n\n<p>and in List monad:</p>\n\n<pre><code>join [] = []\njoin [[xs]] = [xs]\n</code></pre>\n\n<p>?</p>\n\n<p>Thanks.</p>\n"}, {"tags": ["haskell", "functional-programming", "monads", "io-monad"], "comments": [{"owner": {"reputation": 11366, "user_id": 3922954, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/76ba47d2fdd24ab56b0b273cce2075e5?s=128&d=identicon&r=PG&f=1", "display_name": "AJF", "link": "https://stackoverflow.com/users/3922954/ajf"}, "edited": false, "score": 4, "creation_date": 1564136606, "post_id": 57217952, "comment_id": 100940449, "body": "<code>a :: IO t</code>. Yes, it&#39;s polymorphic. An infinite computation never returns anything, so it can be any type."}, {"owner": {"reputation": 100185, "user_id": 3234959, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/93bb12ca0f93dfddb33880316f7e66c2?s=128&d=identicon&r=PG&f=1", "display_name": "chi", "link": "https://stackoverflow.com/users/3234959/chi"}, "edited": false, "score": 2, "creation_date": 1564137321, "post_id": 57217952, "comment_id": 100940804, "body": "If the definition were <code>a=a</code> (an infinite recursion), the type would be <code>a :: forall b. b</code>, i.e. <code>a</code> could be of any type <code>b</code>. Since we have instead <code>a = ioAction &gt;&gt; a</code>, we force <code>b</code> to be of the form <code>IO t</code>, but <code>t</code> can be anything. So we get <code>a :: forall t. IO t</code>. It is still an infinite recursion, except that the IO action is run at every recursive call. In a sense, this works since <code>&gt;&gt;</code> won&#39;t evaluate its second argument/action before having executed its first argument/action."}, {"owner": {"reputation": 61419, "user_id": 849891, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/MbEO3.png?s=128&g=1", "display_name": "Will Ness", "link": "https://stackoverflow.com/users/849891/will-ness"}, "edited": false, "score": 1, "creation_date": 1564139396, "post_id": 57217952, "comment_id": 100941892, "body": "fully parenthesized, what you have is <code>a = (getLine &gt;&gt;= (putStrLn . filter isDigit)) &gt;&gt; a</code>. (both <code>&gt;&gt;</code> and <code>&gt;&gt;=</code> are <code>infixl 1</code>)."}, {"owner": {"reputation": 126897, "user_id": 791604, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/ce991df7a056248d5e4f6fc3659ba733?s=128&d=identicon&r=PG", "display_name": "Daniel Wagner", "link": "https://stackoverflow.com/users/791604/daniel-wagner"}, "edited": false, "score": 0, "creation_date": 1564167416, "post_id": 57217952, "comment_id": 100955643, "body": "You say, &quot;the first argument passed to <code>&gt;&gt;</code> would be of type <code>IO String</code>&quot;. What do you believe the first argument passed to <code>&gt;&gt;</code> is? Why do you believe it to have type <code>IO String</code>? (That is not the correct type for the first argument, so if you explain your thinking, we may help you spot an error in it.)"}], "answers": [{"comments": [{"owner": {"reputation": 384, "user_id": 9948945, "user_type": "registered", "profile_image": "https://lh3.googleusercontent.com/-XdUIqdMkCWA/AAAAAAAAAAI/AAAAAAAAAAA/4252rscbv5M/photo.jpg?sz=128", "display_name": "Samuel Barr", "link": "https://stackoverflow.com/users/9948945/samuel-barr"}, "edited": false, "score": 0, "creation_date": 1564153851, "post_id": 57218366, "comment_id": 100949997, "body": "It may be worth clarifying that the function named <code>a</code> and the type variable <code>a</code> are two different things. With some more sensible naming, we have <code>readPrintLoop :: IO a</code>, and <code>readPrintLoop = getLine &gt;&gt;= putStrLn . filter isDigit &gt;&gt; readPrintLoop</code>"}, {"owner": {"reputation": 530, "user_id": 2275559, "user_type": "registered", "accept_rate": 80, "profile_image": "https://i.stack.imgur.com/Qr2dB.jpg?s=128&g=1", "display_name": "Charlie Harding", "link": "https://stackoverflow.com/users/2275559/charlie-harding"}, "edited": false, "score": 0, "creation_date": 1564564728, "post_id": 57218366, "comment_id": 101069401, "body": "There is an error in the definition of <code>&gt;&gt;</code>: <code>m</code> is not defined, and should be <code>u</code>."}], "tags": [], "owner": {"reputation": 314794, "user_id": 67579, "user_type": "registered", "accept_rate": 81, "profile_image": "https://i.stack.imgur.com/BJXub.png?s=128&g=1", "display_name": "Willem Van Onsem", "link": "https://stackoverflow.com/users/67579/willem-van-onsem"}, "is_accepted": false, "score": 6, "last_activity_date": 1564564836, "last_edit_date": 1564564836, "creation_date": 1564137736, "answer_id": 57218366, "question_id": 57217952, "link": "https://stackoverflow.com/questions/57217952/haskell-understanding-the-bind-and-functions/57218366#57218366", "title": "Haskell: Understanding the bind and &gt;&gt; functions", "body": "<p><strong>Note</strong>: I renamed the <code>a</code> function to <code>readPrintLoop</code> as suggested by <a href=\"https://stackoverflow.com/questions/57217952/haskell-understanding-the-bind-and-functions/57218366?noredirect=1#comment100949997_57218366\">@SamuelBarr</a>, since that avoids some confusion.</p>\n\n<blockquote>\n  <p>My question is, what is the type of <code>readPrintLoop</code>, and how does the above expression work to continually take user input and print only the numeric part of the input back to the screen?</p>\n</blockquote>\n\n<p><code>readPrintLoop</code> has type: <code>readPrintLoop :: <b>IO a</b></code> so it is an <code>IO</code>. The <code>a</code> can be any type, since we never \"return\" that value, we will never end this function.</p>\n\n<p>The function is constantly repeated because <code>readPrintLoop</code> is defined in terms of itself. <code>readPrintLoop</code> is defined as:</p>\n\n<pre><code>readPrintLoop :: IO a\n<b>readPrintLoop</b> = getLine &gt;&gt;= putStrLn . filter isDigit &gt;&gt; <b>readPrintLoop</b></code></pre>\n\n<p>We here thus have infinite recursion, since eventually you will run into <code>a</code>, and thus replace that with another <code>getLine &gt;&gt;= putStrLn . filter isDigit &gt;&gt; a</code> and so on.</p>\n\n<blockquote>\n  <p>However, the function <code>&gt;&gt;</code> takes a first monadic value and a second monadic value and returns the second monadic value.</p>\n</blockquote>\n\n<p><code>(&gt;&gt;)</code> is equivalent to:</p>\n\n<pre><code>(&gt;&gt;) :: Monad m =&gt; m a -&gt; m b -&gt; m b\nu &gt;&gt; v = u &gt;&gt;= (\\_ -&gt; v)</code></pre>\n\n<p>so the implementation of <code>a</code> is equivalent to:</p>\n\n<pre><code>readPrintLoop :: IO a\n<b>readPrintLoop</b> = getLine &gt;&gt;= putStrLn . filter isDigit &gt;&gt;= \\_ -&gt; <b>readPrintLoop</b></code></pre>\n\n<p>Here the underscore variable <code>_</code> will be passed <code>()</code>.</p>\n"}, {"tags": [], "owner": {"reputation": 61419, "user_id": 849891, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/MbEO3.png?s=128&g=1", "display_name": "Will Ness", "link": "https://stackoverflow.com/users/849891/will-ness"}, "is_accepted": false, "score": 5, "last_activity_date": 1564141250, "creation_date": 1564141250, "answer_id": 57219344, "question_id": 57217952, "link": "https://stackoverflow.com/questions/57217952/haskell-understanding-the-bind-and-functions/57219344#57219344", "title": "Haskell: Understanding the bind and &gt;&gt; functions", "body": "<pre><code>a  =  getLine &gt;&gt;= putStrLn . filter isDigit\n</code></pre>\n\n<p>is <em>not</em> \"the part of expression\".</p>\n\n<pre><code>      getLine &gt;&gt;= putStrLn . filter isDigit\n</code></pre>\n\n<p>is the part of the expression. And it does not \"<em>return</em> <code>IO ()</code>\". It <em>has</em> the type <code>IO ()</code> (which you've correctly inferred <sup>(*)</sup>). It <em>is</em> a <em>\"monadic value\"</em> that you talk about.</p>\n\n<p>Giving it a name, <a href=\"https://stackoverflow.com/questions/57217952/haskell-understanding-the-bind-and-functions#comment100940804_57217952\">any name</a>,</p>\n\n<pre><code>ioAction :: IO ()\nioAction  =  getLine &gt;&gt;= (putStrLn . filter isDigit)\n</code></pre>\n\n<p>we end up with</p>\n\n<pre><code>a  =  ioAction &gt;&gt; a \n----------------------------------\n (&gt;&gt;)     :: IO a -&gt; IO b -&gt; IO b\n ioAction :: IO ()\n a        ::         IO b\n----------------------------------\n a        ::                 IO b\n</code></pre>\n\n<p>and everything typechecks.</p>\n\n<p>The semantics of <code>a</code> in</p>\n\n<pre><code>a  =  ((&gt;&gt;) ioAction) a\n</code></pre>\n\n<p>is defined by the semantics of <code>&gt;&gt;</code>.</p>\n\n<hr>\n\n<p><sup>(*)</sup></p>\n\n<pre><code>---------------------------------------------------- \n    (&gt;&gt;=)                     :: m a -&gt; (a -&gt; m b) -&gt; m b\n    getLine                   :: IO String                   m a\n    putStrLn                  ::    String -&gt; IO ()          \n    putStrLn . filter isDigit ::    String -&gt; IO ()            a -&gt; m b\n----------------------------------------------------        ------------\n getLine &gt;&gt;= (putStrLn . filter isDigit)   :: IO ()          m        b\n</code></pre>\n"}], "owner": {"reputation": 1905, "user_id": 8713450, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/ed61e21ec072346277da9569f1c9f966?s=128&d=identicon&r=PG&f=1", "display_name": "ceno980", "link": "https://stackoverflow.com/users/8713450/ceno980"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 185, "favorite_count": 0, "answer_count": 2, "score": 2, "last_activity_date": 1564564836, "creation_date": 1564136238, "last_edit_date": 1564140283, "question_id": 57217952, "link": "https://stackoverflow.com/questions/57217952/haskell-understanding-the-bind-and-functions", "title": "Haskell: Understanding the bind and &gt;&gt; functions", "body": "<p>I have the following Haskell expression:</p>\n\n<pre><code>a = getLine &gt;&gt;= putStrLn . filter isDigit &gt;&gt; a\n</code></pre>\n\n<p>I am having trouble understanding how the above expression works. I know the <code>&gt;&gt;=</code> function takes a monadic value and a function (that takes a normal value and returns a monadic value), and returns a monadic value.</p>\n\n<p>I know that <code>getLine</code> and <code>putStrLn</code> have the following type declarations:</p>\n\n<pre><code>getLine :: IO String \nputStrLn :: String -&gt; IO ()\n</code></pre>\n\n<p>So the following part of expression:</p>\n\n<pre><code>a = getLine &gt;&gt;= putStrLn . filter isDigit\n</code></pre>\n\n<p>Would return an <code>IO ()</code>. However, the function <code>&gt;&gt;</code> takes a first monadic value and a second monadic value and returns the second monadic value.</p>\n\n<p>Given the original expression, the first argument passed to <code>&gt;&gt;</code> would be of type <code>IO String</code>. The second argument is <code>a</code>. </p>\n\n<p>My question is, what is the type of <code>a</code>, and how does the above expression work to continually take user input and print only the numeric part of the input back to the screen? Any insights are appreciated.</p>\n"}, {"tags": ["haskell", "binary-tree"], "comments": [{"owner": {"reputation": 314794, "user_id": 67579, "user_type": "registered", "accept_rate": 81, "profile_image": "https://i.stack.imgur.com/BJXub.png?s=128&g=1", "display_name": "Willem Van Onsem", "link": "https://stackoverflow.com/users/67579/willem-van-onsem"}, "edited": false, "score": 3, "creation_date": 1564129993, "post_id": 57216123, "comment_id": 100936890, "body": "You should use brackets, so <code>(Leaf v)</code> instead of <code>Leaf v</code>."}, {"owner": {"reputation": 100185, "user_id": 3234959, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/93bb12ca0f93dfddb33880316f7e66c2?s=128&d=identicon&r=PG&f=1", "display_name": "chi", "link": "https://stackoverflow.com/users/3234959/chi"}, "edited": false, "score": 2, "creation_date": 1564137644, "post_id": 57216123, "comment_id": 100941001, "body": "If <code>l</code> and <code>r</code> are complete trees of different height, <code>Node l _ r</code> is not complete, but your code claims otherwise. You could try to use an auxiliary function for computing the height. Alternatively, make your function return either &quot;tree is complete and of height H&quot; or &quot;tree is not complete&quot;. You could use <code>Either Int ()</code> or <code>Maybe Int</code> as a return type, or -better- define your custom type <code>data Result = Complete Int | NotComplete</code>."}], "answers": [{"comments": [{"owner": {"reputation": 153048, "user_id": 9204, "user_type": "registered", "accept_rate": 82, "profile_image": "https://www.gravatar.com/avatar/c79937a093ff9e963c563e22cd385f30?s=128&d=identicon&r=PG", "display_name": "Alexey Romanov", "link": "https://stackoverflow.com/users/9204/alexey-romanov"}, "edited": false, "score": 0, "creation_date": 1564148715, "post_id": 57216612, "comment_id": 100946890, "body": "&quot;That being said, your function will here generate True for all trees.&quot; Not for infinite trees (you obviously know that, but still might be worth mentioning for anybody else who reads the answer)."}, {"owner": {"reputation": 315, "user_id": 10254215, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/521e01735f5148b32d131961ed39f69e?s=128&d=identicon&r=PG&f=1", "display_name": "Chien", "link": "https://stackoverflow.com/users/10254215/chien"}, "edited": false, "score": 1, "creation_date": 1564557787, "post_id": 57216612, "comment_id": 101065655, "body": "Thank you for answering the question! I&#39;ve fixed it now XD"}], "tags": [], "owner": {"reputation": 314794, "user_id": 67579, "user_type": "registered", "accept_rate": 81, "profile_image": "https://i.stack.imgur.com/BJXub.png?s=128&g=1", "display_name": "Willem Van Onsem", "link": "https://stackoverflow.com/users/67579/willem-van-onsem"}, "is_accepted": true, "score": 4, "last_activity_date": 1564148781, "last_edit_date": 1564148781, "creation_date": 1564131693, "answer_id": 57216612, "question_id": 57216123, "link": "https://stackoverflow.com/questions/57216123/equations-have-different-numbers-of-arguments-when-deciding-whether-a-tree-is/57216612#57216612", "title": "&#39;Equations have different numbers of arguments&#39; when deciding whether a tree is complete or not", "body": "<p>You <code>decideComplete</code> function takes a <code>BinaryTree Int</code> (perhaps you want to generalize this to <code>BinaryTree a</code>). <code>Leaf</code> is not a <code>BinaryTree a</code>, it is a data constructor that takes a parameteter, you thus should add brackets, like:</p>\n\n<pre><code>decideComplete :: BinaryTree a -&gt; Bool\ndecideComplete (Node l _ r) = (decideComplete l) && (decideComplete r)\ndecideComplete <b>(</b>Leaf v<b>)</b> = True</code></pre>\n\n<p>That being said, your function will here generate <code>True</code> for <em>all</em> trees (unless of course the tree has an infinite number of nodes, but in that case it will simply get stuck in an infinite loop, or run out of memory). Indeed: for all <code>Leaf</code>s it will return <code>True</code>, and for a <code>Node l _ r</code>, it will return <code>True</code> given <code>decideComplete</code> on both <code>l</code> and <code>r</code>, but there is no way this can return <code>False</code>, since eventually the subtrees will be <code>Leaf</code>s, so that node will be <code>True</code>, and so by induction, all your <code>BinaryTree</code>s will be <code>True</code>.</p>\n\n<p>In order to check if a binary tree is complete, all the levels except the last one should be full. The last level should contain nodes at the most far left as possible.</p>\n"}], "owner": {"reputation": 315, "user_id": 10254215, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/521e01735f5148b32d131961ed39f69e?s=128&d=identicon&r=PG&f=1", "display_name": "Chien", "link": "https://stackoverflow.com/users/10254215/chien"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 81, "favorite_count": 0, "accepted_answer_id": 57216612, "answer_count": 1, "score": 2, "last_activity_date": 1564148781, "creation_date": 1564129913, "question_id": 57216123, "link": "https://stackoverflow.com/questions/57216123/equations-have-different-numbers-of-arguments-when-deciding-whether-a-tree-is", "title": "&#39;Equations have different numbers of arguments&#39; when deciding whether a tree is complete or not", "body": "<p>I'm tring to use a function to decided whether a binary tree is complete or not, but the compiler keeps telling me \"equations have different numbers of arguments\".</p>\n\n<p>Guess the error is about syntax, but I just can't find the right format.</p>\n\n<pre class=\"lang-hs prettyprint-override\"><code>data BinaryTree a = Leaf a | Node (BinaryTree a) a (BinaryTree a)\n\n...\n\ndecideComplete :: BinaryTree Int -&gt; Bool\ndecideComplete (Node l _ r) = (decideComplete l) &amp;&amp; (decideComplete r)\ndecideComplete Leaf v = True\n</code></pre>\n"}, {"tags": ["haskell", "yesod", "rich-text-editor", "summernote"], "comments": [{"owner": {"reputation": 11, "user_id": 11839391, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/c56cf68d72de8f4b975414bc566ca026?s=128&d=identicon&r=PG&f=1", "display_name": "rosalux", "link": "https://stackoverflow.com/users/11839391/rosalux"}, "edited": false, "score": 0, "creation_date": 1564220794, "post_id": 57213272, "comment_id": 100965109, "body": "It turns out that with Yesod 1.5, a change was made to a package provided by Yesod implementing MonadUnliftIO. This was announced in a <a href=\"https://www.yesodweb.com/blog/2018/01/upcoming-yesod-breaking-changes\" rel=\"nofollow noreferrer\">Yesod blog post</a>. This change affects the yesod-form-richtext package which makes it impossible to compile with Yesod 1.6. The alternatives at the moment are to manually include an Html editor or use the old Yesod.Form.Nic or to base the project on Yesod 1.4 which makes using the official, up to date, stack scaffolds impossible to use."}], "owner": {"reputation": 11, "user_id": 11839391, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/c56cf68d72de8f4b975414bc566ca026?s=128&d=identicon&r=PG&f=1", "display_name": "rosalux", "link": "https://stackoverflow.com/users/11839391/rosalux"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 34, "favorite_count": 0, "answer_count": 0, "score": 1, "last_activity_date": 1564115717, "creation_date": 1564115717, "question_id": 57213272, "link": "https://stackoverflow.com/questions/57213272/trying-to-use-yesod-form-richtext-in-a-scaffolded-site-i-am-unable-to-compile-d", "title": "Trying to use Yesod.Form.Richtext in a scaffolded site, I am unable to compile due to an issue in Summernote.hs", "body": "<p>I am setting up a blog/website using Yesod. I followed a couple of the tutorials currently available. I am definitely interested in having an HTML editor available to post articles. When I set up NicEditor in the development server, it worked well enough, however when I moved it to an Nginx proxy server, it no longer worked. I had a feeling the issue was a CORS issue, but I enable CORS on the Yesod side and on the Nginx side and it still does not work.</p>\n\n<p>Then someone told me about Yesod.Forms.Richtext and Summernote. When I included Summernote in my extra-deps and package.yaml files, my web app no longer could compile. I tried editing the Yesod.Forms.Richtext package myself to get it to compile, but I could not get it to work. When I try to compile, I am given the following error message:</p>\n\n<pre><code>yesod-form-richtext&gt;     * Could not deduce (Monad m0)\nyesod-form-richtext&gt;       from the context: (YesodSummernote site, Monad m)\nyesod-form-richtext&gt;         bound by the type signature for:\nyesod-form-richtext&gt;                    snHtmlField :: forall site (m :: * -&gt; *).\nyesod-form-richtext&gt;                                   (YesodSummernote site, Monad m) =&gt;\nyesod-form-richtext&gt;                                   Field (HandlerT site m) Html\nyesod-form-richtext&gt;         at src/Yesod/Form/Summernote.hs:(102,16)-(103,43)\nyesod-form-richtext&gt;       The type variable `m0' is ambiguous\nyesod-form-richtext&gt;     * In the ambiguity check for `snHtmlField'\nyesod-form-richtext&gt;       To defer the ambiguity check to use sites, enable AllowAmbiguousTypes\nyesod-form-richtext&gt;       In the type signature:\nyesod-form-richtext&gt;         snHtmlField :: (YesodSummernote site, Monad m) =&gt;\nyesod-form-richtext&gt;                        Field (HandlerT site m) Html\nyesod-form-richtext&gt;     |\nyesod-form-richtext&gt; 102 | snHtmlField :: (YesodSummernote site, Monad m)\nyesod-form-richtext&gt;     |                ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^...\n\n</code></pre>\n\n<p>One thing I tried to do is modify the code to include the {-# LANGUAGE AllowAmbiguousTypes -#} pragma, but it did not help. Is this something that is common with this library? Is there an easier to use Html editor with Yesod?</p>\n"}, {"tags": ["haskell", "functional-programming", "monads", "equivalence", "do-notation"], "comments": [{"owner": {"reputation": 153048, "user_id": 9204, "user_type": "registered", "accept_rate": 82, "profile_image": "https://www.gravatar.com/avatar/c79937a093ff9e963c563e22cd385f30?s=128&d=identicon&r=PG", "display_name": "Alexey Romanov", "link": "https://stackoverflow.com/users/9204/alexey-romanov"}, "edited": false, "score": 4, "creation_date": 1564124688, "post_id": 57213260, "comment_id": 100934527, "body": "Don&#39;t you need <code>do turn Right; robot</code> in the second case (<code>;</code> standing for new line)?"}, {"owner": {"reputation": 1905, "user_id": 8713450, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/ed61e21ec072346277da9569f1c9f966?s=128&d=identicon&r=PG&f=1", "display_name": "ceno980", "link": "https://stackoverflow.com/users/8713450/ceno980"}, "reply_to_user": {"reputation": 153048, "user_id": 9204, "user_type": "registered", "accept_rate": 82, "profile_image": "https://www.gravatar.com/avatar/c79937a093ff9e963c563e22cd385f30?s=128&d=identicon&r=PG", "display_name": "Alexey Romanov", "link": "https://stackoverflow.com/users/9204/alexey-romanov"}, "edited": false, "score": 0, "creation_date": 1564128761, "post_id": 57213260, "comment_id": 100936364, "body": "Why does there have to be a do turn Right; robot for program two? Is it needed because in order to glue multiple IO actions together?"}, {"owner": {"reputation": 153048, "user_id": 9204, "user_type": "registered", "accept_rate": 82, "profile_image": "https://www.gravatar.com/avatar/c79937a093ff9e963c563e22cd385f30?s=128&d=identicon&r=PG", "display_name": "Alexey Romanov", "link": "https://stackoverflow.com/users/9204/alexey-romanov"}, "edited": false, "score": 0, "creation_date": 1564130322, "post_id": 57213260, "comment_id": 100937034, "body": "Yes, for your version I am not sure why it would compile."}, {"owner": {"reputation": 56659, "user_id": 450128, "user_type": "registered", "accept_rate": 62, "profile_image": "https://www.gravatar.com/avatar/2f72b3fdc99fe9fd1bbeb2f9da1d2c0a?s=128&d=identicon&r=PG", "display_name": "Ben", "link": "https://stackoverflow.com/users/450128/ben"}, "edited": false, "score": 0, "creation_date": 1564130323, "post_id": 57213260, "comment_id": 100937036, "body": "@ceno980 Because the then and else parts of if/then/else can be arbitrary expressions so they use normal Haskell expression syntax. They&#39;re not automatically <code>do</code> block syntax just because the whole if/then/else happened to occur in a do block. You want to sequence two IO actions. One way to do that is to write them on separate lines of a <code>do</code> block. In ordinary expression syntax writing them on multiple lines doesn&#39;t do that; it means the same thing as <code>turn Right robot</code> on one line. If you want <code>do</code> syntax you need to start a new <code>do</code> block."}, {"owner": {"reputation": 1905, "user_id": 8713450, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/ed61e21ec072346277da9569f1c9f966?s=128&d=identicon&r=PG&f=1", "display_name": "ceno980", "link": "https://stackoverflow.com/users/8713450/ceno980"}, "edited": false, "score": 0, "creation_date": 1564130486, "post_id": 57213260, "comment_id": 100937110, "body": "How do you know that robot is an IO action? Is it because IO actions are used in the do block?"}, {"owner": {"reputation": 56659, "user_id": 450128, "user_type": "registered", "accept_rate": 62, "profile_image": "https://www.gravatar.com/avatar/2f72b3fdc99fe9fd1bbeb2f9da1d2c0a?s=128&d=identicon&r=PG", "display_name": "Ben", "link": "https://stackoverflow.com/users/450128/ben"}, "edited": false, "score": 0, "creation_date": 1564137536, "post_id": 57213260, "comment_id": 100940925, "body": "@ceno980 The type signature you have for <code>turn</code> tells me it produces <code>IO ()</code>. All the statements in a <code>do</code> block must use the same monad type (which is also the monad type of the<code>do</code> block as a whole)."}], "answers": [{"comments": [{"owner": {"reputation": 100185, "user_id": 3234959, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/93bb12ca0f93dfddb33880316f7e66c2?s=128&d=identicon&r=PG&f=1", "display_name": "chi", "link": "https://stackoverflow.com/users/3234959/chi"}, "edited": false, "score": 2, "creation_date": 1564127246, "post_id": 57213540, "comment_id": 100935673, "body": "Note that, to be pedantic, the law you mention holds for <i>strict</i> <code>f</code>, only. E.g. <code>cond = undefined</code> and <code>f = \\_ -&gt; ()</code> break the law. That being said, <code>f = (&gt;&gt; action)</code> is strict in the IO monad, so everything works."}, {"owner": {"reputation": 7817, "user_id": 7345298, "user_type": "registered", "accept_rate": 50, "profile_image": "https://www.gravatar.com/avatar/9477d048c5c29b16307b3356146d497a?s=128&d=identicon&r=PG&f=1", "display_name": "bradrn", "link": "https://stackoverflow.com/users/7345298/bradrn"}, "reply_to_user": {"reputation": 100185, "user_id": 3234959, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/93bb12ca0f93dfddb33880316f7e66c2?s=128&d=identicon&r=PG&f=1", "display_name": "chi", "link": "https://stackoverflow.com/users/3234959/chi"}, "edited": false, "score": 0, "creation_date": 1564127639, "post_id": 57213540, "comment_id": 100935853, "body": "Thanks for the correction @chi! Should I edit that into my post?"}, {"owner": {"reputation": 100185, "user_id": 3234959, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/93bb12ca0f93dfddb33880316f7e66c2?s=128&d=identicon&r=PG&f=1", "display_name": "chi", "link": "https://stackoverflow.com/users/3234959/chi"}, "edited": false, "score": 0, "creation_date": 1564134757, "post_id": 57213540, "comment_id": 100939426, "body": "Nah, I&#39;m just nitpicking. It&#39;s fairly common to mention laws which should hold in Haskell, but actually do so only in a &quot;moral&quot; sense, if we neglect bottoms here and there."}], "tags": [], "owner": {"reputation": 7817, "user_id": 7345298, "user_type": "registered", "accept_rate": 50, "profile_image": "https://www.gravatar.com/avatar/9477d048c5c29b16307b3356146d497a?s=128&d=identicon&r=PG&f=1", "display_name": "bradrn", "link": "https://stackoverflow.com/users/7345298/bradrn"}, "is_accepted": true, "score": 7, "last_activity_date": 1564118117, "creation_date": 1564118117, "answer_id": 57213540, "question_id": 57213260, "link": "https://stackoverflow.com/questions/57213260/haskell-understanding-do-notation-with-if-else-statements/57213540#57213540", "title": "Haskell: Understanding do notation with if-else statements", "body": "<p>You are correct in saying that these two programs are equivalent. More generally, <code>if cond then (x &gt;&gt; action) else (y &gt;&gt; action)</code> is equivalent to <code>(if cond then x else y) &gt;&gt; action</code>. This is a consequence of the fact that <code>f (if cond then x else y) = if cond then (f x) else (f y)</code>; if you take <code>f = (&gt;&gt; action)</code> you get the equivalence for monads.</p>\n"}], "owner": {"reputation": 1905, "user_id": 8713450, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/ed61e21ec072346277da9569f1c9f966?s=128&d=identicon&r=PG&f=1", "display_name": "ceno980", "link": "https://stackoverflow.com/users/8713450/ceno980"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 237, "favorite_count": 0, "accepted_answer_id": 57213540, "answer_count": 1, "score": 2, "last_activity_date": 1564165365, "creation_date": 1564115612, "last_edit_date": 1564165365, "question_id": 57213260, "link": "https://stackoverflow.com/questions/57213260/haskell-understanding-do-notation-with-if-else-statements", "title": "Haskell: Understanding do notation with if-else statements", "body": "<p>I have the following code for an API for manipulating a robot:</p>\n\n<pre><code>data Direction = Left | Right\nforward    :: IO ()\nblocked :: IO Bool\nturn       :: Direction -&gt; IO ()\n</code></pre>\n\n<p>I am trying to understand two programs that will move the robot forward unless it is blocked by an obstacle, in which case, the robot should turn in the Right direction.</p>\n\n<p>However, I am not sure what is the difference is between the following two programs:</p>\n\n<pre><code>-- program 1\nrobot = do\n  detected &lt;- blocked\n  if detected \n    then turn Right\n    else forward\n  robot\n\n-- program 2\nrobot = do\n  detected &lt;- blocked\n  if detected\n    then turn Right\n         robot\n    else forward\n         robot\n</code></pre>\n\n<p>The line <code>detected &lt;- blocked</code> takes the boolean value out of the IO. If the condition <code>if detected</code> evaluates as true, then the robot turns Right, otherwise the robot moves forward. In program 1 the function robot is called again after moving the robot either right or forward. In program 2, the function robot is called directly after turning right or moving forward.</p>\n\n<p>I am not sure what the difference is between calling robot after the <code>if-else</code> statements (in program 1) versus calling it in the <code>then</code> and <code>else</code> case in program 2. Am I correct in saying that these two programs are equivalent? Any insights are appreciated.</p>\n"}, {"tags": ["haskell"], "comments": [{"owner": {"reputation": 25321, "user_id": 163177, "user_type": "registered", "accept_rate": 86, "profile_image": "https://www.gravatar.com/avatar/e811b5337bcad19d52c8fed3a0ea0075?s=128&d=identicon&r=PG", "display_name": "John F. Miller", "link": "https://stackoverflow.com/users/163177/john-f-miller"}, "edited": false, "score": 0, "creation_date": 1564116060, "post_id": 57213096, "comment_id": 100931867, "body": "Are there any language extensions in use?"}, {"owner": {"reputation": 7817, "user_id": 7345298, "user_type": "registered", "accept_rate": 50, "profile_image": "https://www.gravatar.com/avatar/9477d048c5c29b16307b3356146d497a?s=128&d=identicon&r=PG&f=1", "display_name": "bradrn", "link": "https://stackoverflow.com/users/7345298/bradrn"}, "edited": false, "score": 4, "creation_date": 1564118276, "post_id": 57213096, "comment_id": 100932358, "body": "That is <i>really</i> weird. I can confirm that the <code>data</code> declaration parses, but attempting to use <code>(-&gt;)</code> fails, without enabling any extensions. I suspect that the parsing algorithm has different rules in a <code>data</code> declaration than in an expression, but can\u2019t say anything definitively."}, {"owner": {"reputation": 100185, "user_id": 3234959, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/93bb12ca0f93dfddb33880316f7e66c2?s=128&d=identicon&r=PG&f=1", "display_name": "chi", "link": "https://stackoverflow.com/users/3234959/chi"}, "edited": false, "score": 4, "creation_date": 1564127019, "post_id": 57213096, "comment_id": 100935563, "body": "This looks like a GHC bug to me."}, {"owner": {"reputation": 100892, "user_id": 745903, "user_type": "registered", "accept_rate": 74, "profile_image": "https://www.gravatar.com/avatar/50933f6638836741e620669b3940410e?s=128&d=identicon&r=PG", "display_name": "leftaroundabout", "link": "https://stackoverflow.com/users/745903/leftaroundabout"}, "edited": false, "score": 2, "creation_date": 1564131017, "post_id": 57213096, "comment_id": 100937354, "body": "Pretty sure <code>data Type = (-&gt;) Type Type</code> <i>shouldn&#39;t</i> parse. Infix constructors must generally start with a <code>:</code>, i.e. <code>data Type = (:-&gt;) Type Type</code> would be the closest legal approximation."}, {"owner": {"reputation": 141, "user_id": 11839464, "user_type": "registered", "profile_image": "https://lh3.googleusercontent.com/-xGtkV7hfenw/AAAAAAAAAAI/AAAAAAAAAAA/ACHi3rehrjdjNkJbTJdBfTjXvvsT1iFQJA/photo.jpg?sz=128", "display_name": "bobluza", "link": "https://stackoverflow.com/users/11839464/bobluza"}, "reply_to_user": {"reputation": 7817, "user_id": 7345298, "user_type": "registered", "accept_rate": 50, "profile_image": "https://www.gravatar.com/avatar/9477d048c5c29b16307b3356146d497a?s=128&d=identicon&r=PG&f=1", "display_name": "bradrn", "link": "https://stackoverflow.com/users/7345298/bradrn"}, "edited": false, "score": 0, "creation_date": 1564135001, "post_id": 57213096, "comment_id": 100939576, "body": "I am using overloaded strings and lambda case, but I don&#39;t think that is relevant here.  @bradrn Indeed, test&#39; does not parse. Should I just treat this syntax as a bug then?"}, {"owner": {"reputation": 14537, "user_id": 7128034, "user_type": "registered", "accept_rate": 85, "profile_image": "https://i.stack.imgur.com/T8aRg.jpg?s=128&g=1", "display_name": "Dami&#225;n Rafael Lattenero", "link": "https://stackoverflow.com/users/7128034/dami%c3%a1n-rafael-lattenero"}, "reply_to_user": {"reputation": 100892, "user_id": 745903, "user_type": "registered", "accept_rate": 74, "profile_image": "https://www.gravatar.com/avatar/50933f6638836741e620669b3940410e?s=128&d=identicon&r=PG", "display_name": "leftaroundabout", "link": "https://stackoverflow.com/users/745903/leftaroundabout"}, "edited": false, "score": 0, "creation_date": 1564151392, "post_id": 57213096, "comment_id": 100948512, "body": "@leftaroundabout I think you&#39;re right, I was looking a little bit and concluded in the same"}, {"owner": {"reputation": 34158, "user_id": 7203016, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/ybAMw.png?s=128&g=1", "display_name": "K. A. Buhr", "link": "https://stackoverflow.com/users/7203016/k-a-buhr"}, "edited": false, "score": 2, "creation_date": 1564247750, "post_id": 57213096, "comment_id": 100971203, "body": "I&#39;ve submitted this as <a href=\"https://gitlab.haskell.org/ghc/ghc/issues/16999\" rel=\"nofollow noreferrer\">issue #16999</a>."}, {"owner": {"reputation": 14766, "user_id": 27779, "user_type": "registered", "accept_rate": 89, "profile_image": "https://www.gravatar.com/avatar/b3c28efaa2a3b032a91632e8984cb477?s=128&d=identicon&r=PG", "display_name": "Gregory Higley", "link": "https://stackoverflow.com/users/27779/gregory-higley"}, "edited": false, "score": 0, "creation_date": 1564770269, "post_id": 57213096, "comment_id": 101153323, "body": "Infix constructors! Infix constructors! How did I miss infix constructors?"}], "answers": [{"comments": [{"owner": {"reputation": 44013, "user_id": 1477667, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/trgKM.jpg?s=128&g=1", "display_name": "dfeuer", "link": "https://stackoverflow.com/users/1477667/dfeuer"}, "edited": false, "score": 0, "creation_date": 1564759973, "post_id": 57217743, "comment_id": 101149186, "body": "I doubt your hypothesis about the cause of the bug is right. See the discussion on the ticket."}, {"owner": {"reputation": 8621, "user_id": 1848029, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/qfjAy.jpg?s=128&g=1", "display_name": "lehins", "link": "https://stackoverflow.com/users/1848029/lehins"}, "reply_to_user": {"reputation": 44013, "user_id": 1477667, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/trgKM.jpg?s=128&g=1", "display_name": "dfeuer", "link": "https://stackoverflow.com/users/1477667/dfeuer"}, "edited": false, "score": 1, "creation_date": 1564769733, "post_id": 57217743, "comment_id": 101153131, "body": "@dfeuer, yep, my guess was off. In fact I still don&#39;t understand what is the reason for this bug. Nevertheless, the answer is still right, it is a ghc bug. ;)"}, {"owner": {"reputation": 44013, "user_id": 1477667, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/trgKM.jpg?s=128&g=1", "display_name": "dfeuer", "link": "https://stackoverflow.com/users/1477667/dfeuer"}, "edited": false, "score": 0, "creation_date": 1564772643, "post_id": 57217743, "comment_id": 101154208, "body": "I dunno either. Parsing Haskell is relatively hard, and parsing GHC Haskell is really hard. I personally think some of the decisions about syntax were unwise. It&#39;s pretty tricky to go back and change things in a mature language, but it looks like a few of those decisions are being reconsidered along the long road to <code>DependentHaskell</code>."}], "tags": [], "owner": {"reputation": 8621, "user_id": 1848029, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/qfjAy.jpg?s=128&g=1", "display_name": "lehins", "link": "https://stackoverflow.com/users/1848029/lehins"}, "is_accepted": false, "score": 2, "last_activity_date": 1564769888, "last_edit_date": 1564769888, "creation_date": 1564135500, "answer_id": 57217743, "question_id": 57213096, "link": "https://stackoverflow.com/questions/57213096/arrow-as-haskell-data-constructor/57217743#57217743", "title": "Arrow (-&gt;) as haskell data constructor", "body": "<p>It does look like a <a href=\"https://gitlab.haskell.org/ghc/ghc/issues/16999\" rel=\"nofollow noreferrer\">GHC bug</a> (thanks to Kevin Buhr for reporting it) in the use case you provided. </p>\n\n<p><strong>Note</strong></p>\n\n<p>This does fail to parse with <code>GADTs</code>:</p>\n\n<pre><code>data Type where\n  TBool :: Type\n  TInt :: Type\n  Arrow :: Type -&gt; Type -&gt; Type\n  (-&gt;) :: Type -&gt; Type -&gt; Type\n</code></pre>\n"}, {"comments": [{"owner": {"reputation": 44013, "user_id": 1477667, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/trgKM.jpg?s=128&g=1", "display_name": "dfeuer", "link": "https://stackoverflow.com/users/1477667/dfeuer"}, "edited": false, "score": 0, "creation_date": 1564257338, "post_id": 57222113, "comment_id": 100973580, "body": "Infix type constructors are allowed with the <code>TypeOperators</code> extension."}], "tags": [], "owner": {"reputation": 14537, "user_id": 7128034, "user_type": "registered", "accept_rate": 85, "profile_image": "https://i.stack.imgur.com/T8aRg.jpg?s=128&g=1", "display_name": "Dami&#225;n Rafael Lattenero", "link": "https://stackoverflow.com/users/7128034/dami%c3%a1n-rafael-lattenero"}, "is_accepted": false, "score": 0, "last_activity_date": 1564262795, "last_edit_date": 1564262795, "creation_date": 1564151292, "answer_id": 57222113, "question_id": 57213096, "link": "https://stackoverflow.com/questions/57213096/arrow-as-haskell-data-constructor/57222113#57222113", "title": "Arrow (-&gt;) as haskell data constructor", "body": "<p>As @leftaroundabout commented, and According to <a href=\"https://downloads.haskell.org/~ghc/7.2.1/docs/html/users_guide/data-type-extensions.html\" rel=\"nofollow noreferrer\">this</a> you must add a <code>:</code> in order to create infix constructors:\nAnd according to <a href=\"https://stackoverflow.com/questions/30039123/haskell-why-arent-infix-type-constructors-allowed\">this question</a>:</p>\n\n<blockquote>\n  <p>Unlike data constructors, infix type constructors are not allowed (other than (->)).</p>\n</blockquote>\n\n<p>So by example this won't work:</p>\n\n<pre><code>data Type\n  = TBool\n  | TInt\n  | Arrow Type Type\n  | (-**) Type Type\n\ntest :: Type \ntest = Arrow TBool TInt -- Ok\n\ntest' :: Type\ntest' = (-**) TBool TInt\n</code></pre>\n\n<p>but this will:</p>\n\n<pre><code>data Type\n  = TBool\n  | TInt\n  | Arrow Type Type\n  | (:-**) Type Type\n\ntest :: Type \ntest = Arrow TBool TInt -- Ok\n\ntest' :: Type\ntest' = (:-**) TBool TInt\n</code></pre>\n\n<p>and this:</p>\n\n<pre><code>data Type\n  = TBool\n  | TInt\n  | Arrow Type Type\n  | (:-*) Type Type\n\ntest :: Type \ntest = Arrow TBool TInt -- Ok\n\ntest' :: Type\ntest' = (:-*) TBool TInt\n</code></pre>\n\n<p>and in your case you will want something like:</p>\n\n<pre><code>data Type\n  = TBool\n  | TInt\n  | Arrow Type Type\n  | (:-&gt;) Type Type\n\ntest :: Type \ntest = Arrow TBool TInt -- Ok\n\ntest' :: Type\ntest' = (:-&gt;) TBool TInt\n</code></pre>\n"}], "owner": {"reputation": 141, "user_id": 11839464, "user_type": "registered", "profile_image": "https://lh3.googleusercontent.com/-xGtkV7hfenw/AAAAAAAAAAI/AAAAAAAAAAA/ACHi3rehrjdjNkJbTJdBfTjXvvsT1iFQJA/photo.jpg?sz=128", "display_name": "bobluza", "link": "https://stackoverflow.com/users/11839464/bobluza"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 259, "favorite_count": 1, "answer_count": 2, "score": 10, "last_activity_date": 1564769888, "creation_date": 1564114188, "last_edit_date": 1564114540, "question_id": 57213096, "link": "https://stackoverflow.com/questions/57213096/arrow-as-haskell-data-constructor", "title": "Arrow (-&gt;) as haskell data constructor", "body": "<p>I'm confused about the arrow and what it actually means in the data constructor. I'm surprised it even compiled but I have no idea how to use it. </p>\n\n<p>If I try to use it as the name of a data constructor it doesn't parse, and I'm not sure how else to interpret it. If I interpret it as a function type then the data constructor has no name which also does not make sense to me. </p>\n\n<pre><code>data Type\n  = TBool\n  | TInt\n  | Arrow Type Type\n  | (-&gt;) Type Type\n\ntest :: Type \ntest = Arrow TBool TInt -- Ok\n\ntest' :: Type\ntest' = (-&gt;) TBool TInt -- Parse Error on input '-&gt;'\n</code></pre>\n"}, {"tags": ["haskell", "io", "fold"], "answers": [{"tags": [], "owner": {"reputation": 7817, "user_id": 7345298, "user_type": "registered", "accept_rate": 50, "profile_image": "https://www.gravatar.com/avatar/9477d048c5c29b16307b3356146d497a?s=128&d=identicon&r=PG&f=1", "display_name": "bradrn", "link": "https://stackoverflow.com/users/7345298/bradrn"}, "is_accepted": true, "score": 3, "last_activity_date": 1564100768, "creation_date": 1564100768, "answer_id": 57211649, "question_id": 57211543, "link": "https://stackoverflow.com/questions/57211543/folding-over-user-input-in-haskell/57211649#57211649", "title": "Folding Over User Input in Haskell", "body": "<p>Firstly: why doesn\u2019t your program work? The issue is that when you do <code>repeat getChar</code>, that repeats <code>getChar</code> <em>infinitely</em>. Then you use <code>sequence</code>; because of how <code>sequence</code> is implemented, it needs to go through the <em>whole</em> list before returning. But that list is infinite! Result: an infinite loop.</p>\n\n<p>Now, let\u2019s try to solve this. Often the first thing I do in this sort of scenario is to forget about functions such as <code>sequence</code> and just write it as a recursive function:</p>\n\n<pre class=\"lang-hs prettyprint-override\"><code>main = runGameIO (newState \"secret\")\n  where\n    runGameIO :: GameState -&gt; IO ()\n    runGameIO curState = do\n        input &lt;- getChar\n        let newState = updateState curState input\n        if isPlaying newState        -- if still playing\n            then runGameIO newState  -- then repeat with new state\n            else return ()           -- else finish\n</code></pre>\n\n<p>Now, is there any way to simplify <code>runGameIO</code>? I can\u2019t see any as it is now. Certainly, we can see now that <code>sequence</code> won\u2019t work: <code>sequence</code> requires that each item given to it is independent, i.e. each monadic action doesn\u2019t depend on a previous monadic action. (That\u2019s why you can also implement <code>sequence</code> with an <code>Applicative</code> constraint instead of a <code>Monad</code> constraint.) But this problem is all <em>about</em> responding given the previous state! So clearly <code>sequence</code> won\u2019t work.</p>\n\n<p>Next, let\u2019s desugar the do-notation to see if we can spot anything:</p>\n\n<pre class=\"lang-hs prettyprint-override\"><code>runGameIO :: GameState -&gt; Io ()\nrunGameIO curState =\n    getChar &gt;&gt;= \\input -&gt;\n    let newState = updateState curState input\n    in if isPlaying newState then runGameIO newState else return ()\n</code></pre>\n\n<p>Hmm\u2026 still nothing, really. But this makes it more obvious that you can use <code>fmap</code> here:</p>\n\n<pre class=\"lang-hs prettyprint-override\"><code>runGameIO :: GameState -&gt; Io ()\nrunGameIO curState =\n    fmap (updateState curState) getChar &gt;&gt;= \\newState -&gt;\n    if isPlaying newState then runGameIO newState else return ()\n</code></pre>\n\n<p>At this point, there\u2019s often some clever trick which can be used to get rid of the explicit recursion. But I can\u2019t see anything to do here. If you weren\u2019t restricting yourself to the standard library, I would say to use <a href=\"http://hackage.haskell.org/package/monad-loops-0.4.3/docs/Control-Monad-Loops.html#v:iterateUntilM\" rel=\"nofollow noreferrer\"><code>iterateUntilM</code></a> from the <code>monad-loops</code> package, but you can\u2019t use that. Sometimes explicit recursion is just best, and this seems to be one of those cases.</p>\n"}], "owner": {"reputation": 23, "user_id": 11838776, "user_type": "registered", "profile_image": "https://lh6.googleusercontent.com/-0FY8Bb1SjUY/AAAAAAAAAAI/AAAAAAAAAAA/ACHi3rfNIq250KrZbvcngvXJaKuy1pL3VA/photo.jpg?sz=128", "display_name": "vigenary", "link": "https://stackoverflow.com/users/11838776/vigenary"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 82, "favorite_count": 0, "accepted_answer_id": 57211649, "answer_count": 1, "score": 2, "last_activity_date": 1564100768, "creation_date": 1564099526, "question_id": 57211543, "link": "https://stackoverflow.com/questions/57211543/folding-over-user-input-in-haskell", "title": "Folding Over User Input in Haskell", "body": "<p>I'm new to Haskell and have been programming a simple hangman game to get used to the language. I'm storing the game state in a datatype called GameState.</p>\n\n<pre class=\"lang-hs prettyprint-override\"><code>data GameState = GameState\n  { word :: String,\n    blanks :: String,\n    wrongGuesses :: [Char]\n  } deriving Show\n</code></pre>\n\n<p>I also have a function to update the state given an input character and another function to check if the game is finished.</p>\n\n<pre class=\"lang-hs prettyprint-override\"><code>updateState :: GameState -&gt; Char -&gt; GameState\nupdateState state c\n  | (c `elem` (word state)) = state { blanks = newBlanks }\n  | otherwise = state { wrongGuesses = c:(wrongGuesses state)}\n  where newBlanks = foldr replaceAt (blanks state) $ elemIndices c (word state)\n        replaceAt i = (take i) &lt;&gt; (const [c]) &lt;&gt; (drop (i + 1))\n\nisPlaying :: GameState -&gt; Bool\nisPlaying state = ('_' `elem` (blanks state)) &amp;&amp; (length (wrongGuesses state) &lt; 5)\n</code></pre>\n\n<p>Given a list of characters, I can do a fold to simulate the game on the given input.</p>\n\n<pre class=\"lang-hs prettyprint-override\"><code>runGame :: GameState -&gt; [Char] -&gt; [GameState]\nrunGame initialState chars = takeWhile isPlaying $ scanl updateState initialState chars\n</code></pre>\n\n<p>My question is how to adapt this code to work with actual user input. I've tried using sequence, but the program just endlessly gets user input.</p>\n\n<pre class=\"lang-hs prettyprint-override\"><code>main = runGame (newState \"secret\") &lt;$&gt; (sequence $ repeat getChar)\n</code></pre>\n\n<p>Is there any way to fold over getChar similar to how runGame works and print the game state after each user input? I'd like to avoid explicit recursion like runGame does, and if possible, I'd like to stick with standard library functions.</p>\n"}, {"tags": ["haskell", "functional-programming", "side-effects"], "comments": [{"owner": {"reputation": 11366, "user_id": 3922954, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/76ba47d2fdd24ab56b0b273cce2075e5?s=128&d=identicon&r=PG&f=1", "display_name": "AJF", "link": "https://stackoverflow.com/users/3922954/ajf"}, "edited": false, "score": 0, "creation_date": 1564100102, "post_id": 57211404, "comment_id": 100929149, "body": "No, that is absolutely not pure, and is definitely observable to the outside world."}, {"owner": {"reputation": 14830, "user_id": 3757232, "user_type": "registered", "accept_rate": 90, "profile_image": "https://i.stack.imgur.com/kLzML.jpg?s=128&g=1", "display_name": "Jared Smith", "link": "https://stackoverflow.com/users/3757232/jared-smith"}, "edited": false, "score": 5, "creation_date": 1564138607, "post_id": 57211404, "comment_id": 100941473, "body": "Don&#39;t mix levels of abstraction. At the level where you are concerned about memory there is no purity and at the level where you are concerned with purity you don&#39;t call malloc."}], "answers": [{"comments": [{"owner": {"reputation": 1905, "user_id": 8713450, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/ed61e21ec072346277da9569f1c9f966?s=128&d=identicon&r=PG&f=1", "display_name": "ceno980", "link": "https://stackoverflow.com/users/8713450/ceno980"}, "edited": false, "score": 0, "creation_date": 1564100224, "post_id": 57211574, "comment_id": 100929165, "body": "Thanks for your reply. So since the outside world is modified would I be correct in saying that allocating memory is an external effect?"}, {"owner": {"reputation": 309, "user_id": 10046520, "user_type": "registered", "profile_image": "https://lh3.googleusercontent.com/-b7DDckg1iCc/AAAAAAAAAAI/AAAAAAAAAAA/AB6qoq3WUstgK_PCXI0Q3VmTSCGEtg2z1g/mo/photo.jpg?sz=128", "display_name": "Ahmedou", "link": "https://stackoverflow.com/users/10046520/ahmedou"}, "reply_to_user": {"reputation": 1905, "user_id": 8713450, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/ed61e21ec072346277da9569f1c9f966?s=128&d=identicon&r=PG&f=1", "display_name": "ceno980", "link": "https://stackoverflow.com/users/8713450/ceno980"}, "edited": false, "score": 0, "creation_date": 1564101747, "post_id": 57211574, "comment_id": 100929394, "body": "Yes, but every mutation of memory is not considered as a side effect"}, {"owner": {"reputation": 1905, "user_id": 8713450, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/ed61e21ec072346277da9569f1c9f966?s=128&d=identicon&r=PG&f=1", "display_name": "ceno980", "link": "https://stackoverflow.com/users/8713450/ceno980"}, "edited": false, "score": 0, "creation_date": 1564105617, "post_id": 57211574, "comment_id": 100930021, "body": "What would be an example of mutating memory that wouldn&#39;t be a side effect?"}, {"owner": {"reputation": 2915, "user_id": 1295154, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/9687b362fd1d4754033efc0b19001e81?s=128&d=identicon&r=PG", "display_name": "Dominique Devriese", "link": "https://stackoverflow.com/users/1295154/dominique-devriese"}, "edited": false, "score": 3, "creation_date": 1564134433, "post_id": 57211574, "comment_id": 100939244, "body": "The situation is much more nuanced than this answer suggests.  If the code generated by the compiler for a pure function generates allocations, these are not considered side effects in Haskell, even though they modify state in the outside world and the effect is observable from the outside world in certain ways.  The real answer, imho, is that Haskell makes certain, to some extent arbitrary, choices about what is considered a side effect (in the sense that it is only allowed in IO) and what isn&#39;t: termination, internal memory use, computation time and errors are not, others are."}], "tags": [], "owner": {"reputation": 309, "user_id": 10046520, "user_type": "registered", "profile_image": "https://lh3.googleusercontent.com/-b7DDckg1iCc/AAAAAAAAAAI/AAAAAAAAAAA/AB6qoq3WUstgK_PCXI0Q3VmTSCGEtg2z1g/mo/photo.jpg?sz=128", "display_name": "Ahmedou", "link": "https://stackoverflow.com/users/10046520/ahmedou"}, "is_accepted": true, "score": -2, "last_activity_date": 1564710668, "last_edit_date": 1564710668, "creation_date": 1564099867, "answer_id": 57211574, "question_id": 57211404, "link": "https://stackoverflow.com/questions/57211404/understanding-side-effects-is-allocating-memory-a-pure-operation/57211574#57211574", "title": "Understanding side effects: Is allocating memory a pure operation?", "body": "<p>By explicitly allocating you modify a state in the outside world and by design a side effect</p>\n"}, {"tags": [], "owner": {"reputation": 44043, "user_id": 1565698, "user_type": "registered", "accept_rate": 38, "profile_image": "https://www.gravatar.com/avatar/7dace33805b9dcdec5aa63308daf88dc?s=128&d=identicon&r=PG", "display_name": "Sylwester", "link": "https://stackoverflow.com/users/1565698/sylwester"}, "is_accepted": false, "score": 2, "last_activity_date": 1564106339, "creation_date": 1564106339, "answer_id": 57212204, "question_id": 57211404, "link": "https://stackoverflow.com/questions/57211404/understanding-side-effects-is-allocating-memory-a-pure-operation/57212204#57212204", "title": "Understanding side effects: Is allocating memory a pure operation?", "body": "<p>Making a binding to be s value is considered pure, but the resulting machine code will overwrite memory to do so. Thus the question is if you are explicitly allocating or if you are setting a value leaving the compiler to do the allocating. </p>\n"}, {"comments": [{"owner": {"reputation": 659, "user_id": 519759, "user_type": "registered", "accept_rate": 67, "profile_image": "https://www.gravatar.com/avatar/8f95f6887c152b8fbc0490d6e2449f53?s=128&d=identicon&r=PG", "display_name": "Duncan Drennan", "link": "https://stackoverflow.com/users/519759/duncan-drennan"}, "edited": false, "score": 0, "creation_date": 1604618686, "post_id": 57225999, "comment_id": 114410064, "body": "In the case of the pure function which uses malloc, what if malloc fails? Assuming the underlying C function handles malloc failures consistently, then for a given input you could get different results. Is the state of the memory then considered to be part of the system state when the function is called? So (1) if memory is available, then for input x output is y, or (2) if no memory available, then for input x, output is z. i.e. the state of the memory effectively forms part of the input to the function"}, {"owner": {"reputation": 2360, "user_id": 367332, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/6D0rd.png?s=128&g=1", "display_name": "DarthFennec", "link": "https://stackoverflow.com/users/367332/darthfennec"}, "reply_to_user": {"reputation": 659, "user_id": 519759, "user_type": "registered", "accept_rate": 67, "profile_image": "https://www.gravatar.com/avatar/8f95f6887c152b8fbc0490d6e2449f53?s=128&d=identicon&r=PG", "display_name": "Duncan Drennan", "link": "https://stackoverflow.com/users/519759/duncan-drennan"}, "edited": false, "score": 1, "creation_date": 1604698226, "post_id": 57225999, "comment_id": 114436232, "body": "@DuncanDrennan Failures like this tend to be represented in Haskell as &quot;bottom&quot; values (Haskell&#39;s version of exceptions). Those can be caught and handled on the IO level, but in pure code they propagate into any value that depends on them. So if such a failure happens at any point, the resulting output value (and any value that uses it) won&#39;t exist or be accessible. So as far as the pure code is concerned, the result is still pure. The only part of the code that&#39;s aware of the exception is at the IO level, and only if it&#39;s explicitly caught and handled."}], "tags": [], "owner": {"reputation": 2360, "user_id": 367332, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/6D0rd.png?s=128&g=1", "display_name": "DarthFennec", "link": "https://stackoverflow.com/users/367332/darthfennec"}, "is_accepted": false, "score": 5, "last_activity_date": 1564170917, "last_edit_date": 1564170917, "creation_date": 1564169210, "answer_id": 57225999, "question_id": 57211404, "link": "https://stackoverflow.com/questions/57211404/understanding-side-effects-is-allocating-memory-a-pure-operation/57225999#57225999", "title": "Understanding side effects: Is allocating memory a pure operation?", "body": "<blockquote>\n  <p>Is allocating memory for a data structure a pure operation?</p>\n</blockquote>\n\n<p>In Haskell, memory is almost never allocated directly by the programmer. In this sense, the question is moot: allocating memory is neither a pure nor impure operation, because allocating memory is <em>not an operation</em>, but rather, it is an implementation detail. Put another way, memory allocations in Haskell <em>are not observable</em> to external code (or any code), but that's <em>not</em> because of purity, it's because <em>the language itself abstracts over the concept</em> of memory allocation. As far as the Haskell code itself is concerned, there's no such thing as memory, or memory allocation.</p>\n\n<p>The reason this is important is because it allows the compiler to make all kinds of optimizations without changing the meaning of the code. For example, in Haskell, when you make small changes to a large data structure, you're actually making a copy of the structure instead of modifying the original, and this is extremely inefficient. However, the compiler can usually tell if old copies of the structure are needed, and if not, it will write machine code that simply modifies the original structure. As another example, small local values may be moved to CPU registers or the system stack, bypassing allocation entirely for those values. As long as it doesn't change what the code does, the optimizer can and will break the purity rule by any means necessary. The distinction is simply unimportant at that level.</p>\n\n<hr>\n\n<blockquote>\n  <p>In the case of allocating a data structure, you would have to call some functions (e.g. malloc) to allocate memory for it. But if these functions were called within a function, this wouldn't be observable to the outside world. Even though the outside world is modified (as there is memory allocated for the data structure), I don't think that allocating a data structure is a side-effect since it's not observable.</p>\n</blockquote>\n\n<p>There are situations where a memory allocation operation may be exposed to Haskell code. For example, a C function that allocates memory with <code>malloc</code> might be called by a Haskell binding via the <a href=\"https://wiki.haskell.org/Foreign_Function_Interface#Introduction\" rel=\"nofollow noreferrer\">FFI</a>. In these situations, the author of the binding needs to decide whether the function is \"pure\" (the type should return a pure value), or \"impure\" (the type should return an <code>IO</code> action). This is the main situation I can think of where an answer to this question is pragmatically valuable.</p>\n\n<p>In this context, the important things to look at are:</p>\n\n<ul>\n<li>If I run the function with the same inputs in any situation, will it always give me the same outputs?</li>\n<li>If I replace the function call in the source code with its resulting value, will the program have exactly the same behavior?</li>\n</ul>\n\n<p>If both of the answers are \"yes\", it's a pure function, otherwise it's impure. This is regardless of how much impurity is happening in the C code, as long as that impurity is not visible outside of the function it's fine.</p>\n\n<hr>\n\n<p>So to actually answer your question: It depends.</p>\n\n<p>Say <code>malloc</code> is called, and then the memory is freed before the function exits. Over the course of the function, zero net memory has been allocated. So the function is pure.</p>\n\n<p>Say <code>malloc</code> is called, and a pointer into the allocated memory is returned. This is <strong>not</strong> pure, because Haskell is only aware of the pointer, not the allocated memory itself. If we run this function to allocate a 4-byte chunk, and then we run it again to allocate another 4-byte chunk, and Haskell thinks the function is pure, it may replace the second call with the result (pointer) of the first call, causing both calls to return pointers to the same 4-byte chunk (which is not what you want). Because of this, the function must be typed as an impure <code>IO</code> action.</p>\n"}], "owner": {"reputation": 1905, "user_id": 8713450, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/ed61e21ec072346277da9569f1c9f966?s=128&d=identicon&r=PG&f=1", "display_name": "ceno980", "link": "https://stackoverflow.com/users/8713450/ceno980"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 326, "favorite_count": 0, "accepted_answer_id": 57211574, "answer_count": 3, "score": 4, "last_activity_date": 1564710668, "creation_date": 1564098096, "question_id": 57211404, "link": "https://stackoverflow.com/questions/57211404/understanding-side-effects-is-allocating-memory-a-pure-operation", "title": "Understanding side effects: Is allocating memory a pure operation?", "body": "<p>I am learning about side-effects in functional programming (in Haskell) and I know that external effects are effects that are observable outside the function, whereas internal effects are not visible from the outside. </p>\n\n<p>Is allocating memory for a data structure a pure operation? A side-effect has to modify some state or have an observable interaction with calling functions or the outside world. In the case of allocating a data structure, you would have to call some functions (e.g. malloc) to allocate memory for it. But if these functions were called within a function, this wouldn't be observable to the outside world. Even though the outside world is modified (as there is memory allocated for the data structure), I don't think that allocating a data structure is a side-effect since it's not observable.</p>\n\n<p>However, I am not sure whether my reasoning is correct. Any insights are appreciated.</p>\n"}, {"tags": ["haskell", "functional-programming"], "comments": [{"owner": {"reputation": 14030, "user_id": 8475054, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/edbf41c4b5aecb1a949936e06368a7c2?s=128&d=identicon&r=PG&f=1", "display_name": "Robin Zigmond", "link": "https://stackoverflow.com/users/8475054/robin-zigmond"}, "edited": false, "score": 3, "creation_date": 1564095542, "post_id": 57211121, "comment_id": 100928356, "body": "Haskell doesn&#39;t allow you to modify variables at all - that&#39;s part of what being a pure language means."}, {"owner": {"reputation": 100185, "user_id": 3234959, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/93bb12ca0f93dfddb33880316f7e66c2?s=128&d=identicon&r=PG&f=1", "display_name": "chi", "link": "https://stackoverflow.com/users/3234959/chi"}, "edited": false, "score": 1, "creation_date": 1564096416, "post_id": 57211121, "comment_id": 100928544, "body": "There are some libraries that allow &quot;local mutable state&quot; which is not visible from outside (<code>ST</code>), but that&#39;s a rather peculiar thing, which is not commonly used. It&#39;s easier to try understanding <code>IO</code> first, which always exposes side effects to the outside, even if they could be &quot;local&quot; and not really observable."}, {"owner": {"reputation": 1905, "user_id": 8713450, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/ed61e21ec072346277da9569f1c9f966?s=128&d=identicon&r=PG&f=1", "display_name": "ceno980", "link": "https://stackoverflow.com/users/8713450/ceno980"}, "edited": false, "score": 0, "creation_date": 1564096480, "post_id": 57211121, "comment_id": 100928554, "body": "So in the context of purity, I am right in saying that changing the value of a variable, regardless of whether it&#39;s local or global would be considered an effect?"}, {"owner": {"reputation": 100185, "user_id": 3234959, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/93bb12ca0f93dfddb33880316f7e66c2?s=128&d=identicon&r=PG&f=1", "display_name": "chi", "link": "https://stackoverflow.com/users/3234959/chi"}, "edited": false, "score": 0, "creation_date": 1564126671, "post_id": 57211121, "comment_id": 100935396, "body": "Modifying variables is not possible in Haskell. You can read and modify some state e.g. using <code>IORef</code>s, which will be considered an <code>IO</code> effect. Similarly, reading or modifying a <code>STRef</code> will be an <code>ST</code> effect. However, <code>IO</code> effects &quot;propagate&quot; through the whole program: you can&#39;t use <code>IO</code> in a function <code>Int -&gt; String</code>, for example (you need <code>Int -&gt; IO String</code>, exposing the IO). Instead, <code>ST</code> effects can be made &quot;local&quot;, so that they can be used even in functions of type <code>Int -&gt; String</code>."}], "answers": [{"tags": [], "owner": {"reputation": 14537, "user_id": 7128034, "user_type": "registered", "accept_rate": 85, "profile_image": "https://i.stack.imgur.com/T8aRg.jpg?s=128&g=1", "display_name": "Dami&#225;n Rafael Lattenero", "link": "https://stackoverflow.com/users/7128034/dami%c3%a1n-rafael-lattenero"}, "is_accepted": true, "score": 2, "last_activity_date": 1564095918, "creation_date": 1564095918, "answer_id": 57211163, "question_id": 57211121, "link": "https://stackoverflow.com/questions/57211121/haskell-understanding-side-effects-in-functions/57211163#57211163", "title": "Haskell: Understanding side-effects in functions", "body": "<p>Try to run this program:</p>\n\n<pre><code>x = 5\nx = 7\n</code></pre>\n\n<p>it will show:</p>\n\n<pre><code>    Multiple declarations of \u2018x\u2019\n    Declared at: main.hs:1:1\n                 main.hs:2:1\n  |\n2 | x = 7\n</code></pre>\n\n<p>it means, <code>variables</code> in haskell has different meaning and concept and obviously behavior than other languages. You bind values, the value in the right side of the equation ( because <code>=</code> is to declare equations, it doesn't do the same as <code>=</code> in other languages, such as allocate the value in memory and give the memory pointer so you can change it or access to it) is bonded to the value in the left side. And values in Haskell are pure, <code>x</code> has the exact same value in all the execution of the program, will never change.</p>\n\n<blockquote>\n  <p>Global variable accesses are external effects,</p>\n</blockquote>\n\n<p>Yes, <code>x</code> is global, but that is a matter of scopes, I can do:</p>\n\n<pre><code>x = 5\n\nf = \\x -&gt; 6 + x\n</code></pre>\n\n<p>and then</p>\n\n<pre><code>&amp;&gt; x\n&amp;&gt; 5\n&amp;&gt; y 4\n$&gt; 10\n</code></pre>\n\n<p>don't get confuse in that point</p>\n"}], "owner": {"reputation": 1905, "user_id": 8713450, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/ed61e21ec072346277da9569f1c9f966?s=128&d=identicon&r=PG&f=1", "display_name": "ceno980", "link": "https://stackoverflow.com/users/8713450/ceno980"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 107, "favorite_count": 0, "accepted_answer_id": 57211163, "answer_count": 1, "score": 1, "last_activity_date": 1564095918, "creation_date": 1564095459, "question_id": 57211121, "link": "https://stackoverflow.com/questions/57211121/haskell-understanding-side-effects-in-functions", "title": "Haskell: Understanding side-effects in functions", "body": "<p>I am learning about IO in Haskell and about side-effects in functions. I know that external effects are effects that are observable outside the function, whereas internal effects are not visible from the outside. My understanding is that external effects make changes to the \"real world\" that lies beyond the scope of the function. </p>\n\n<p>Global variable accesses are external effects, since they are visible outside of the function. However, would modifying local variables be considered as an internal effect? I believe that since these local variables are only accessible within the function itself, making changes to them would not affect the \"real world\", and thus this wouldn't be considered as an internal effect. </p>\n\n<p>However, I am not sure if my reasoning is correct. Any insights are appreciated.</p>\n"}, {"tags": ["haskell"], "comments": [{"owner": {"reputation": 314794, "user_id": 67579, "user_type": "registered", "accept_rate": 81, "profile_image": "https://i.stack.imgur.com/BJXub.png?s=128&g=1", "display_name": "Willem Van Onsem", "link": "https://stackoverflow.com/users/67579/willem-van-onsem"}, "edited": false, "score": 2, "creation_date": 1564075834, "post_id": 57207017, "comment_id": 100921265, "body": "Note that <code>a</code> and <code>b</code> are universally quantified. So if you write <code>solveIntent :: Intent -&gt; Entity a -&gt; IO (Entity b)</code> then it means that the function holds for <i>all</i> <code>a</code>s and <code>b</code>s. But that is not the case here. Since you likely use functions like <code>searchModule</code> that are specific for <code>NavigationEntity</code>, etc."}, {"owner": {"reputation": 33, "user_id": 9845992, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/9TkGA.jpg?s=128&g=1", "display_name": "dciug", "link": "https://stackoverflow.com/users/9845992/dciug"}, "reply_to_user": {"reputation": 314794, "user_id": 67579, "user_type": "registered", "accept_rate": 81, "profile_image": "https://i.stack.imgur.com/BJXub.png?s=128&g=1", "display_name": "Willem Van Onsem", "link": "https://stackoverflow.com/users/67579/willem-van-onsem"}, "edited": false, "score": 0, "creation_date": 1564076245, "post_id": 57207017, "comment_id": 100921444, "body": "I understand that I can make every handler to be of type <code>Entity a -&gt; IO (Entity b)</code>. But that would mean I lose type information."}, {"owner": {"reputation": 11366, "user_id": 3922954, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/76ba47d2fdd24ab56b0b273cce2075e5?s=128&d=identicon&r=PG&f=1", "display_name": "AJF", "link": "https://stackoverflow.com/users/3922954/ajf"}, "edited": false, "score": 0, "creation_date": 1564076778, "post_id": 57207017, "comment_id": 100921696, "body": "@dciug You would only lose type information which doesn&#39;t exist...? That <code>b</code> is simply incorrect in your type signature."}, {"owner": {"reputation": 314794, "user_id": 67579, "user_type": "registered", "accept_rate": 81, "profile_image": "https://i.stack.imgur.com/BJXub.png?s=128&g=1", "display_name": "Willem Van Onsem", "link": "https://stackoverflow.com/users/67579/willem-van-onsem"}, "edited": false, "score": 0, "creation_date": 1564077007, "post_id": 57207017, "comment_id": 100921807, "body": "@dciug: but that is indeed exactly the problem: by writing <code>solveIndent</code> as <code>solveIndent :: Intent -&gt; Entity a -&gt; IO (Entity b)</code>, it indeed loses information, likely type information you need in the <i>body</i> (the expression) of your <code>solveIntent</code> function."}, {"owner": {"reputation": 33, "user_id": 9845992, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/9TkGA.jpg?s=128&g=1", "display_name": "dciug", "link": "https://stackoverflow.com/users/9845992/dciug"}, "edited": false, "score": 0, "creation_date": 1564077169, "post_id": 57207017, "comment_id": 100921882, "body": "Ok. Then how do I make it so that I can pass any kind of entity? There could be a lot of entities in the system."}, {"owner": {"reputation": 384463, "user_id": 1126841, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/fa05233b2357f8d11c22ef4cfc7bb85c?s=128&d=identicon&r=PG", "display_name": "chepner", "link": "https://stackoverflow.com/users/1126841/chepner"}, "edited": false, "score": 0, "creation_date": 1564080155, "post_id": 57207017, "comment_id": 100923187, "body": "In order to pass any kind of entity, it looks like you need handlers for all of them, and some way to dispatch each entity to the correct handler. Your example doesn&#39;t demonstrate how that happens."}, {"owner": {"reputation": 384463, "user_id": 1126841, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/fa05233b2357f8d11c22ef4cfc7bb85c?s=128&d=identicon&r=PG", "display_name": "chepner", "link": "https://stackoverflow.com/users/1126841/chepner"}, "edited": false, "score": 2, "creation_date": 1564080209, "post_id": 57207017, "comment_id": 100923212, "body": "<code>Intent -&gt; Entity a -&gt; IO (Entity b)</code> doesn&#39;t mean that <code>solveIntent</code> can handle <i>any</i> entity; it <i>promises</i> that it can handle <i>every</i> entity."}, {"owner": {"reputation": 14537, "user_id": 7128034, "user_type": "registered", "accept_rate": 85, "profile_image": "https://i.stack.imgur.com/T8aRg.jpg?s=128&g=1", "display_name": "Dami&#225;n Rafael Lattenero", "link": "https://stackoverflow.com/users/7128034/dami%c3%a1n-rafael-lattenero"}, "edited": false, "score": 1, "creation_date": 1564085334, "post_id": 57207017, "comment_id": 100925337, "body": "can you add the full code? from <code>data</code> and functions?"}], "answers": [{"comments": [{"owner": {"reputation": 33, "user_id": 9845992, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/9TkGA.jpg?s=128&g=1", "display_name": "dciug", "link": "https://stackoverflow.com/users/9845992/dciug"}, "edited": false, "score": 0, "creation_date": 1564134727, "post_id": 57210152, "comment_id": 100939408, "body": "I&#39;ve been looking through the docs for a few hours to understand this and I learned a lot. This works but the reason I was thinking about Intents is because the system is linked to an NLP module, which extracts the intents from a textual request from a user."}, {"owner": {"reputation": 33, "user_id": 9845992, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/9TkGA.jpg?s=128&g=1", "display_name": "dciug", "link": "https://stackoverflow.com/users/9845992/dciug"}, "edited": false, "score": 0, "creation_date": 1564142284, "post_id": 57210152, "comment_id": 100943406, "body": "For now I have to manually specify the result type of the <code>lookupModule</code> function. Can I deduce that automatically at runtime? Something like: take the <code>typeOf</code> this varialbe and the <code>typeOf</code> that variable and then lookup the index."}, {"owner": {"reputation": 22091, "user_id": 5684257, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/ea5090cde8ea066a1fda67ed52dd5084?s=128&d=identicon&r=PG&f=1", "display_name": "HTNW", "link": "https://stackoverflow.com/users/5684257/htnw"}, "reply_to_user": {"reputation": 33, "user_id": 9845992, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/9TkGA.jpg?s=128&g=1", "display_name": "dciug", "link": "https://stackoverflow.com/users/9845992/dciug"}, "edited": false, "score": 0, "creation_date": 1564342669, "post_id": 57210152, "comment_id": 100989374, "body": "Type information (<code>Typeable</code>) is not attached to variables. Type information is attached to types. Having a variable <code>x :: a</code>, and having type information <code>Typeable a</code> are simply not related. For your use case I might try something like <code>data SomeEntity = forall a. Typeable a =&gt; SomeEntity (Entity a); data WithSomeEntity r = forall a. Typeable a =&gt; WithSomeEntity (Entity a -&gt; r); handleInput :: UserInput -&gt; (SomeEntity, WithSomeEntity Result)</code>, but I&#39;d need more details to be sure."}], "tags": [], "owner": {"reputation": 22091, "user_id": 5684257, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/ea5090cde8ea066a1fda67ed52dd5084?s=128&d=identicon&r=PG&f=1", "display_name": "HTNW", "link": "https://stackoverflow.com/users/5684257/htnw"}, "is_accepted": true, "score": 0, "last_activity_date": 1564088954, "creation_date": 1564088954, "answer_id": 57210152, "question_id": 57207017, "link": "https://stackoverflow.com/questions/57207017/how-to-get-around-the-couldnt-match-type-b-with-concretetype/57210152#57210152", "title": "How to get around the &quot;couldn&#39;t match type &#39;b&#39; with ConcreteType&quot;?", "body": "<p>A data type like <code>Intent</code> exposes no type information. The type of an <code>Intent</code> for <code>NavigationEntity -&gt; DirectionEntity</code> is the same as the type of an <code>Intent</code> for <code>DirectionEntity -&gt; NavigationEntity</code>. Therefore, the type of the result of <code>searchModule</code> cannot change based on the <code>Intent</code>, and you have a problem, because that's the point.</p>\n\n<p>Stepping back, you have a huge collection of <code>exists a b. Entity a -&gt; IO (Entity b)</code>s. You want to be able to pick two <code>Type</code>s\u2014<code>a</code> and <code>b</code>\u2014and search your collection for a matching function. This is a job for <code>Typeable</code>: You need to define a type to hold each <code>exists a b. Entity a -&gt; IO (Entity b)</code>, plus <code>Typeable</code> evidence for <code>a</code> and <code>b</code>, and then <code>lookupModule</code> should take <code>Typeable</code> evidence for the two types you're searching for. You don't need an <code>Intent</code> or whatever. You just need the type of the module you are searching for. The simplest collection type to deal with is just <code>[]</code>.</p>\n\n<pre><code>import Data.Type.Equality\nimport Type.Reflection\n\ndata DirectionEntity deriving Typeable -- needs DeriveDataTypeable extension\ndata NavigationEntity deriving Typeable\n\ndata SomeModule =\n  -- needs ExistentialQuantification, ExplicitForAll extensions\n  forall a b. (Typeable a, Typeable b) =&gt; \n  SomeModule (Entity a -&gt; IO (Entity b))\n\ntype ModuleIndex = [SomeModule]\nhandler :: Entity NavigationEntity -&gt; IO (Entity DirectionEntity)\nindex :: ModuleIndex\nindex = [SomeModule handler] -- or whatever\n\n-- really, this is more of a mapMaybe/filter than a lookup\nlookupModule ::\n  forall a b. (Typeable a, Typeable b) =&gt; -- needs ScopedTypeVariables\n  ModuleIndex -&gt; [Entity a -&gt; IO (Entity b)] -- can have any number of matches!\nlookupModule [] = []\n-- we have a, b, which are our search queries\n-- we extract x, y from the `SomeModule`\n-- we have Typeable for all four, so we check for a match\n-- then decide whether or not to include the function\n-- (well, *we* don't really decide; without a match, it's a type error!)\nlookupModule (SomeModule (x :: Entity x -&gt; IO (Entity y)) : xs)\n  -- needs GADTs, TypeOperators extensions\n  | Just Refl &lt;- testEquality typeRep typeRep :: Maybe (a :~: x)\n  , Just Refl &lt;- testEquality typeRep typeRep :: Maybe (b :~: y)\n  = x : lookupModule xs\n  | otherwise = lookupModule xs\n</code></pre>\n\n<p>Which should give you something like</p>\n\n<pre><code>&gt; length (lookupModule index :: [Entity NavigationEntity -&gt; IO (Entity DirectionEntity)]) \n1\n&gt; length (lookupModule index :: [Entity DirectionEntity -&gt; IO (Entity NavigationEntity)])\n0\n</code></pre>\n\n<p>If your collection is <em>really</em> big, you may want to use a <code>Map</code>. This gets hairier, because we're using unsafe operations, but the interface is still safe. This should get its own module, for access control.</p>\n\n<pre><code>module ModuleIndex(ModuleIndex, SomeModule(..), fromList, lookupModule) where\n\nimport Type.Reflection\nimport Unsafe.Coerce\n\nimport Data.Map as M\n\ndata Key = forall (a :: Type) (b :: Type). Key (TypeRep a) (TypeRep b)\ninstance Eq Key where\n  Key a b == Key x y =\n    SomeTypeRep a == SomeTypeRep x &amp;&amp; SomeTypeRep b == SomeTypeRep y\ninstance Ord Key where\n  compare (Key a b) (Key x y) =\n    compare (SomeTypeRep a) (SomeTypeRep x) &lt;&gt; compare (SomeTypeRep b) (SomeTypeRep y)\ndata Value = forall a b. Value (Entity a -&gt; IO (Entity b))\n\nnewtype ModuleIndex = ModuleIndex { getModuleIndex :: Map Key Value }\ndata SomeModule =\n  forall a b. (Typeable a, Typeable b) =&gt; \n  SomeModule (Entity a -&gt; IO (Entity b))\nfromList :: [SomeModule] -&gt; ModuleIndex\nfromList = ModuleIndex . M.fromList . fmap disentangle\n  where disentangle (SomeModule (f :: Entity a -&gt; IO (Entity b))) =\n          (Key (typeRep :: TypeRep a) (typeRep :: TypeRep b), Value f)\nlookupModule ::\n  forall a b. (Typeable a, Typeable b) =&gt;\n  ModuleIndex -&gt; Maybe (Entity a -&gt; IO (Entity b))\nlookupModule = fmap extract . M.lookup key . getModuleIndex\n  where key = Key (typeRep :: TypeRep a) (typeRep :: TypeRep b)\n        extract (Value f) = unsafeCoerce f :: Entity a -&gt; IO (Entity b)\n</code></pre>\n"}], "owner": {"reputation": 33, "user_id": 9845992, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/9TkGA.jpg?s=128&g=1", "display_name": "dciug", "link": "https://stackoverflow.com/users/9845992/dciug"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 94, "favorite_count": 0, "accepted_answer_id": 57210152, "answer_count": 1, "score": 2, "last_activity_date": 1564088954, "creation_date": 1564074337, "last_edit_date": 1564076847, "question_id": 57207017, "link": "https://stackoverflow.com/questions/57207017/how-to-get-around-the-couldnt-match-type-b-with-concretetype", "title": "How to get around the &quot;couldn&#39;t match type &#39;b&#39; with ConcreteType&quot;?", "body": "<p>The architecture is as follows: a user generates an Intent, which is then captured by the system. The Resolver finds an appropriate function that can resolve this intent. There is an index that maps Intents to Modules that have mentioned their capabilities in these intents. The basic idea is that a module takes an entity and generates another entity as a result.</p>\n\n<p>I tried ExistentialTypes but I don't think I have enough expertise to work with them yet, so I'd like to know if there's a simpler way.</p>\n\n<p>An entity looks like this.</p>\n\n<pre class=\"lang-hs prettyprint-override\"><code>data Entity a = Entity {...}\n\ndata DirectionEntity = DirectionEntity {...}\n</code></pre>\n\n<p>There are lots of entities.</p>\n\n<p>A handler looks like this:</p>\n\n<pre class=\"lang-hs prettyprint-override\"><code>handler :: Entity NavigationEntity -&gt; IO (Entity DirectionEntity)\n</code></pre>\n\n<p>I want to have some information at the type level.\nEverything is fine until I want to have a single data structure that contains all these handlers, in one place. Basically, I would like to have a function like:</p>\n\n<pre class=\"lang-hs prettyprint-override\"><code>solveIntent :: Intent -&gt; Entity a -&gt; IO (Entity b)\nsolveIntent intent entity = do\n  index &lt;- mkIndex\n  let m = searchModule index intent\n  run m entity\n</code></pre>\n\n<p>And here's the problem in the title: I can't match the types:</p>\n\n<pre class=\"lang-hs prettyprint-override\"><code>Expected type: Entity a -&gt; IO (Entity b)\nActual type: Entity NavigationEntity -&gt; IO (Entity DirectionEntity)\n</code></pre>\n\n<p>Any help would be appreciated. Thanks.</p>\n"}, {"tags": ["haskell", "fibonacci"], "comments": [{"owner": {"reputation": 314794, "user_id": 67579, "user_type": "registered", "accept_rate": 81, "profile_image": "https://i.stack.imgur.com/BJXub.png?s=128&g=1", "display_name": "Willem Van Onsem", "link": "https://stackoverflow.com/users/67579/willem-van-onsem"}, "edited": false, "score": 3, "creation_date": 1564058659, "post_id": 57202242, "comment_id": 100912034, "body": "We did not generate duplicates. Where do you see duplicates here?"}, {"owner": {"reputation": 11366, "user_id": 3922954, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/76ba47d2fdd24ab56b0b273cce2075e5?s=128&d=identicon&r=PG&f=1", "display_name": "AJF", "link": "https://stackoverflow.com/users/3922954/ajf"}, "edited": false, "score": 0, "creation_date": 1564058727, "post_id": 57202242, "comment_id": 100912071, "body": "Asking a new question is the right thing to do. You should avoid seeing the list as developing in &quot;steps&quot;. When we refer to <code>fibs</code> in that definition, we really mean the whole list. The accepted answer is better at explaining this."}, {"owner": {"reputation": 23, "user_id": 11836166, "user_type": "registered", "profile_image": "https://lh4.googleusercontent.com/-jR0dpHkItv0/AAAAAAAAAAI/AAAAAAAAAAA/ACHi3rdpL9O4QMP9mMcO98NJM6TPOsQPGA/photo.jpg?sz=128", "display_name": "Aydin Yasar", "link": "https://stackoverflow.com/users/11836166/aydin-yasar"}, "reply_to_user": {"reputation": 314794, "user_id": 67579, "user_type": "registered", "accept_rate": 81, "profile_image": "https://i.stack.imgur.com/BJXub.png?s=128&g=1", "display_name": "Willem Van Onsem", "link": "https://stackoverflow.com/users/67579/willem-van-onsem"}, "edited": false, "score": 0, "creation_date": 1564063642, "post_id": 57202242, "comment_id": 100915114, "body": "@WillemVanOnsem no duplicates in running code, it works completely fine but I was wondering how come there is no duplicates when I iterate the recursion myself. Now the answer clarified my mind, understood the process better."}], "answers": [{"comments": [{"owner": {"reputation": 23, "user_id": 11836166, "user_type": "registered", "profile_image": "https://lh4.googleusercontent.com/-jR0dpHkItv0/AAAAAAAAAAI/AAAAAAAAAAA/ACHi3rdpL9O4QMP9mMcO98NJM6TPOsQPGA/photo.jpg?sz=128", "display_name": "Aydin Yasar", "link": "https://stackoverflow.com/users/11836166/aydin-yasar"}, "edited": false, "score": 0, "creation_date": 1564063766, "post_id": 57202912, "comment_id": 100915180, "body": "Thanks for detailed explanation; very well understood. :)"}, {"owner": {"reputation": 384463, "user_id": 1126841, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/fa05233b2357f8d11c22ef4cfc7bb85c?s=128&d=identicon&r=PG", "display_name": "chepner", "link": "https://stackoverflow.com/users/1126841/chepner"}, "edited": false, "score": 1, "creation_date": 1564065380, "post_id": 57202912, "comment_id": 100916159, "body": "You forgot to use U+254c in your fadeout :)"}, {"owner": {"reputation": 14537, "user_id": 7128034, "user_type": "registered", "accept_rate": 85, "profile_image": "https://i.stack.imgur.com/T8aRg.jpg?s=128&g=1", "display_name": "Dami&#225;n Rafael Lattenero", "link": "https://stackoverflow.com/users/7128034/dami%c3%a1n-rafael-lattenero"}, "edited": false, "score": 0, "creation_date": 1564081515, "post_id": 57202912, "comment_id": 100923789, "body": "Always providing excellent answers. Superb actually. Very nice answer here!"}], "tags": [], "owner": {"reputation": 100892, "user_id": 745903, "user_type": "registered", "accept_rate": 74, "profile_image": "https://www.gravatar.com/avatar/50933f6638836741e620669b3940410e?s=128&d=identicon&r=PG", "display_name": "leftaroundabout", "link": "https://stackoverflow.com/users/745903/leftaroundabout"}, "is_accepted": true, "score": 7, "last_activity_date": 1564061777, "last_edit_date": 1564061777, "creation_date": 1564060725, "answer_id": 57202912, "question_id": 57202242, "link": "https://stackoverflow.com/questions/57202242/understanding-recursive-fibonacci-function-in-haskell/57202912#57202912", "title": "Understanding recursive fibonacci function in Haskell", "body": "<p>Let's write this out with some more labels:</p>\n\n<pre><code>fibs :: [Integer]\nfibs = 1 : 1 : sumft\n where sumft = zipWith (+) fibs tfi\n       tfi = tail fibs\n</code></pre>\n\n<p>Then, the \u201cstarting step\u201d is</p>\n\n<pre>           \u256d\u2500\u2500 tfi \u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2508\u2504\u00b7\u00b7\nfibs : [1, 1, ?, ?, ...\n              \u2570\u2500\u2500 sumft \u2500\u2500\u2508\u2504\u00b7\u00b7\ntfi  : [1, ?, ?, ?, ... \nsumft: [2, ?, ?, ?,</pre>\n\n<p>Now, as the computation marches on, the runtime don't <em>move anything</em> or whatever, it merely tries to fill in <code>?</code> signs with concrete values. Remember, everything in Haskell is immutable; when I write <code>?</code> I just mean I don't know yet what the value there is, but in principle it's already predetermined.</p>\n\n<p>In this case, the runtime knows that the first <code>?</code> in <code>fibs</code> comes from the head of <code>sumft</code>, whose exact value is known by now:</p>\n\n<pre>           \u256d\u2500\u2500\u2500 tfi \u2500\u2500\u2500\u2500\u2500\u2500\u2508\u2504\u00b7\u00b7\nfibs : [1, 1, <b>2</b>, ?, ...\n              \u2570\u2500\u25c0 sumft \u2500\u2500\u2508\u2504\u00b7\u00b7\ntfi  : [1, ?, ?, ?, ... \nsumft: [<b>2</b>, ?, ?, ?,</pre>\n\n<p>Now, this <code>2</code> is also known in <code>tfi</code>:</p>\n\n<pre>           \u256d\u2500\u2500\u25b6 tfi \u2500\u2500\u2500\u2500\u2500\u2500\u2508\u2504\u00b7\u00b7\nfibs : [1, 1, <b>2</b>, ?, ...\n              \u2570\u2500\u2500 sumft \u2500\u2500\u2508\u2504\u00b7\u00b7\ntfi  : [1, <b>2</b>, ?, ?, ... \nsumft: [2, ?, ?, ?,</pre>\n\n<p>...and thus we can perform the next addition:</p>\n\n<pre>           \u256d\u2500\u2500\u2500 tfi \u2500\u2500\u2500\u2500\u2500\u2500\u2508\u2504\u00b7\u00b7\nfibs : [1, <b>1</b>, 2, ?, ...\n              \u2570\u2500\u2500 sumft \u2500\u2500\u2508\u2504\u00b7\u00b7\ntfi  : [1, <b>2</b>, ?, ?, ... \nsumft: [2, <b>3</b>, ?, ?,</pre>\n\n<p>So, another number, i.e. another element of <code>sumft</code> that, being part of <code>fibs</code>, can also be used there. But it still occurs at the same place <em>relative to the head of <code>sumft</code></em> \u2013 i.e. after the <code>2</code>.</p>\n\n<pre>           \u256d\u2500\u2500\u2500 tfi \u2500\u2500\u2500\u2500\u2500\u2500\u2508\u2504\u00b7\u00b7\nfibs : [1, 1, 2, <b>3</b>, ...\n              \u2570\u2500\u25c0 sumft \u2500\u2500\u2508\u2504\u00b7\u00b7\ntfi  : [1, 2, ?, ?, ... \nsumft: [2, <b>3</b>, ?, ?,</pre>\n\n<p>That gets again used in <code>tfi</code></p>\n\n<pre>           \u256d\u2500\u2500\u25b6 tfi \u2500\u2500\u2500\u2500\u2500\u2500\u2508\u2504\u00b7\u00b7\nfibs : [1, 1, 2, <b>3</b>, ...\n              \u2570\u2500\u2500 sumft \u2500\u2500\u2508\u2504\u00b7\u00b7\ntfi  : [1, 2, <b>3</b>, ?, ... \nsumft: [2, 3, ?, ?,</pre>\n\n<p>...and so on and so on.</p>\n"}], "owner": {"reputation": 23, "user_id": 11836166, "user_type": "registered", "profile_image": "https://lh4.googleusercontent.com/-jR0dpHkItv0/AAAAAAAAAAI/AAAAAAAAAAA/ACHi3rdpL9O4QMP9mMcO98NJM6TPOsQPGA/photo.jpg?sz=128", "display_name": "Aydin Yasar", "link": "https://stackoverflow.com/users/11836166/aydin-yasar"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 134, "favorite_count": 1, "accepted_answer_id": 57202912, "answer_count": 1, "score": 2, "last_activity_date": 1564061777, "creation_date": 1564058531, "last_edit_date": 1564058852, "question_id": 57202242, "link": "https://stackoverflow.com/questions/57202242/understanding-recursive-fibonacci-function-in-haskell", "title": "Understanding recursive fibonacci function in Haskell", "body": "<p>Although this thread were available, I wasn't allowed to ask my question under the answers (due to reputation points) therefore I had to create a new question for that regard. (I am just new in stackoverflow :)</p>\n\n<p>I didn't clearly understand one point regarding how following fibs function works </p>\n\n<pre><code>fibs :: [Integer]\nfibs = 1 : 1 : zipWith (+) fibs (tail fibs)\n</code></pre>\n\n<p>In this <a href=\"https://stackoverflow.com/questions/1105765/generating-fibonacci-numbers-in-haskell/57188964#57188964?newreg=a13c92bfe66b4f65b1e8570d83b7522d\">stackoverflow thread</a></p>\n\n<p>nichijou has step by step explained below the thread here I quoted from nichijou:</p>\n\n<blockquote>\n  <p>at first, with fibs and tail fibs, we can get the 3rd:</p>\n\n<pre><code>fibs                        : [1, 1, ?\ntail fibs                   : [1, ?\nzipWith (+) fibs (tail fibs): [2, ?\n</code></pre>\n  \n  <p>now, we know the 3rd is 2, we can get the 4th:</p>\n\n<pre><code>fibs                        : [1, 1, 2, ?\ntail fibs                   : [1, 2, ?\nzipWith (+) fibs (tail fibs): [2, 3, ?\n</code></pre>\n  \n  <p>now the 5th:</p>\n\n<pre><code>fibs                        : [1, 1, 2, 3, ?\ntail fibs                   : [1, 2, 3, ?\nzipWith (+) fibs (tail fibs): [2, 3, 5, ?\n</code></pre>\n  \n  <p>and so on ..        </p>\n</blockquote>\n\n<pre><code>fibs :: [Integer]\nfibs = 1 : 1 : zipWith (+) fibs (tail fibs)\n</code></pre>\n\n<p>Here my question is, after the second step how did we get rid of the duplicates in the list? I was expecting to see the second step should generate a list as</p>\n\n<pre><code>[1, 1, 2, 2, 3] \n</code></pre>\n\n<p>same goes in the next step and so on...</p>\n"}, {"tags": ["haskell", "monads", "binary-operators"], "comments": [{"owner": {"reputation": 314794, "user_id": 67579, "user_type": "registered", "accept_rate": 81, "profile_image": "https://i.stack.imgur.com/BJXub.png?s=128&g=1", "display_name": "Willem Van Onsem", "link": "https://stackoverflow.com/users/67579/willem-van-onsem"}, "edited": false, "score": 2, "creation_date": 1564057637, "post_id": 57201860, "comment_id": 100911445, "body": "No, <code>&gt;&gt;=</code> does not implicitly takes another argument. The logic is implemented in the <code>&gt;&gt;=</code> (bind) function. Note that a lot of monad instances do not make such check. For example the list monad, state monad, etc."}, {"owner": {"reputation": 1, "user_id": 156458, "user_type": "registered", "accept_rate": 47, "profile_image": "https://i.stack.imgur.com/3PCjR.png?s=128&g=1", "display_name": "Tim", "link": "https://stackoverflow.com/users/156458/tim"}, "reply_to_user": {"reputation": 314794, "user_id": 67579, "user_type": "registered", "accept_rate": 81, "profile_image": "https://i.stack.imgur.com/BJXub.png?s=128&g=1", "display_name": "Willem Van Onsem", "link": "https://stackoverflow.com/users/67579/willem-van-onsem"}, "edited": false, "score": 0, "creation_date": 1564057736, "post_id": 57201860, "comment_id": 100911500, "body": "Thanks. Sorry for my language. I mean ?Can <code>&gt;&gt;=</code> be viewed as equivalently and implicitly take other function argument(s) for dealing with alternative case(s)?? If a monad instance doesn&#39;t check alternative cases, then is it the same as just pass a null function as the additional argument?"}, {"owner": {"reputation": 314794, "user_id": 67579, "user_type": "registered", "accept_rate": 81, "profile_image": "https://i.stack.imgur.com/BJXub.png?s=128&g=1", "display_name": "Willem Van Onsem", "link": "https://stackoverflow.com/users/67579/willem-van-onsem"}, "edited": false, "score": 0, "creation_date": 1564057818, "post_id": 57201860, "comment_id": 100911555, "body": "But the &quot;fail&quot; option is not parameterized. For a <code>Maybe</code> monad, if the left operand is <code>Nothing</code> it is logical to return <code>Nothing</code>. What else would it return? Since it has no <code>x</code>, we can not apply a function on that <code>x</code>. For several monad instances, the <code>&gt;&gt;=</code> is the only possible implementation (w.r.t. the types), or (one of) the most simplest implementation. Certain tools like Djinn/Exference/... can frequently &quot;guess&quot; the monad implementation."}, {"owner": {"reputation": 78982, "user_id": 1848654, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/84180c0f3c9c04f8b8f0613fc0129dac?s=128&d=identicon&r=PG", "display_name": "melpomene", "link": "https://stackoverflow.com/users/1848654/melpomene"}, "edited": false, "score": 0, "creation_date": 1564057845, "post_id": 57201860, "comment_id": 100911566, "body": "&quot;<i>Many implementations</i>&quot; [citation needed]"}, {"owner": {"reputation": 24509, "user_id": 6863749, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/UyoQv.jpg?s=128&g=1", "display_name": "Li-yao Xia", "link": "https://stackoverflow.com/users/6863749/li-yao-xia"}, "edited": false, "score": 4, "creation_date": 1564058176, "post_id": 57201860, "comment_id": 100911759, "body": "Could you try to reformulate your question in a different way than &quot;Can <code>&gt;&gt;=</code> be viewed as equivalently...&quot;? You also used that formulation in a previous question and it makes it unclear whether you are asking a technical or conceptual question."}, {"owner": {"reputation": 11366, "user_id": 3922954, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/76ba47d2fdd24ab56b0b273cce2075e5?s=128&d=identicon&r=PG&f=1", "display_name": "AJF", "link": "https://stackoverflow.com/users/3922954/ajf"}, "edited": false, "score": 10, "creation_date": 1564058360, "post_id": 57201860, "comment_id": 100911854, "body": "You seem to be asking a lot of questions, some of which display confusion. Instead of asking more questions, perhaps you should instead try some exercises involving monads\u2014the best way to learn is doing\u2014and you may find your understanding is improved."}, {"owner": {"reputation": 1, "user_id": 156458, "user_type": "registered", "accept_rate": 47, "profile_image": "https://i.stack.imgur.com/3PCjR.png?s=128&g=1", "display_name": "Tim", "link": "https://stackoverflow.com/users/156458/tim"}, "reply_to_user": {"reputation": 314794, "user_id": 67579, "user_type": "registered", "accept_rate": 81, "profile_image": "https://i.stack.imgur.com/BJXub.png?s=128&g=1", "display_name": "Willem Van Onsem", "link": "https://stackoverflow.com/users/67579/willem-van-onsem"}, "edited": false, "score": 0, "creation_date": 1564059756, "post_id": 57201860, "comment_id": 100912756, "body": "@WillemVanOnsem Thanks. What is <code>&gt;&gt;= :: m a -&gt; (a -&gt;m b) -&gt; m b</code> more about: being able to implicitly unpack <code>ma :: m a</code> to <code>a</code> so that <code>f :: a-&gt; mb</code> can apply to it, or being able to handle different cases depending on <code>ma :: m a</code>, or both?"}, {"owner": {"reputation": 1, "user_id": 156458, "user_type": "registered", "accept_rate": 47, "profile_image": "https://i.stack.imgur.com/3PCjR.png?s=128&g=1", "display_name": "Tim", "link": "https://stackoverflow.com/users/156458/tim"}, "reply_to_user": {"reputation": 78982, "user_id": 1848654, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/84180c0f3c9c04f8b8f0613fc0129dac?s=128&d=identicon&r=PG", "display_name": "melpomene", "link": "https://stackoverflow.com/users/1848654/melpomene"}, "edited": false, "score": 0, "creation_date": 1564060461, "post_id": 57201860, "comment_id": 100913171, "body": "@melpomene See my update. I guess I might mistaken the purpose of &gt;&gt;= to be handling different cases depending on argument."}, {"owner": {"reputation": 384463, "user_id": 1126841, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/fa05233b2357f8d11c22ef4cfc7bb85c?s=128&d=identicon&r=PG", "display_name": "chepner", "link": "https://stackoverflow.com/users/1126841/chepner"}, "edited": false, "score": 2, "creation_date": 1564060651, "post_id": 57201860, "comment_id": 100913282, "body": "@Tim Yes, both. Part of &quot;unpacking&quot; (which isn&#39;t implicit; it&#39;s right there in the definition of <code>&gt;&gt;=</code>) means being able to unpack <i>any</i> value of type <code>m a</code>, no matter which constructor of was used to create it."}, {"owner": {"reputation": 1, "user_id": 156458, "user_type": "registered", "accept_rate": 47, "profile_image": "https://i.stack.imgur.com/3PCjR.png?s=128&g=1", "display_name": "Tim", "link": "https://stackoverflow.com/users/156458/tim"}, "reply_to_user": {"reputation": 384463, "user_id": 1126841, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/fa05233b2357f8d11c22ef4cfc7bb85c?s=128&d=identicon&r=PG", "display_name": "chepner", "link": "https://stackoverflow.com/users/1126841/chepner"}, "edited": false, "score": 0, "creation_date": 1564060784, "post_id": 57201860, "comment_id": 100913369, "body": "@chepner Thanks. Some instance types don&#39;t handle more than one cases, so is &gt;&gt;= actually not about handling more than one cases depending on the first argument, but only about unpacking the first argument so that the second function argument can apply to it?"}, {"owner": {"reputation": 14030, "user_id": 8475054, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/edbf41c4b5aecb1a949936e06368a7c2?s=128&d=identicon&r=PG&f=1", "display_name": "Robin Zigmond", "link": "https://stackoverflow.com/users/8475054/robin-zigmond"}, "edited": false, "score": 1, "creation_date": 1564061055, "post_id": 57201860, "comment_id": 100913540, "body": "Agreed that the &quot;unpacking&quot; is definitely the key to <code>&gt;&gt;=</code>. I would say that the key reason why monads are useful is that they allow you to compose functions. You can easily compose function types <code>a -&gt; b</code> and <code>b -&gt; c</code>, but in practice you probably have <code>a -&gt; m b</code> and <code>b -&gt; m c</code> instead, to allow for some context (eg possible failure, need to rely on some environment, etc). You can no longer compose these directly, but you can use <code>&gt;&gt;=</code> to effectively do so, and get a function of type <code>a -&gt; m c</code>. This is explained in all the better monad tutorials, including plenty of SO answers."}, {"owner": {"reputation": 384463, "user_id": 1126841, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/fa05233b2357f8d11c22ef4cfc7bb85c?s=128&d=identicon&r=PG", "display_name": "chepner", "link": "https://stackoverflow.com/users/1126841/chepner"}, "edited": false, "score": 0, "creation_date": 1564061217, "post_id": 57201860, "comment_id": 100913644, "body": "@Tim What &quot;cases&quot; are you talking about? I assumed you meant (using <code>[]</code> as an example) defining <code>(&gt;&gt;=)</code> to handle both <code>[]</code> and <code>(x:xs)</code>."}, {"owner": {"reputation": 1, "user_id": 156458, "user_type": "registered", "accept_rate": 47, "profile_image": "https://i.stack.imgur.com/3PCjR.png?s=128&g=1", "display_name": "Tim", "link": "https://stackoverflow.com/users/156458/tim"}, "reply_to_user": {"reputation": 384463, "user_id": 1126841, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/fa05233b2357f8d11c22ef4cfc7bb85c?s=128&d=identicon&r=PG", "display_name": "chepner", "link": "https://stackoverflow.com/users/1126841/chepner"}, "edited": false, "score": 0, "creation_date": 1564061519, "post_id": 57201860, "comment_id": 100913817, "body": "@chepner for list monad, &gt;&gt;= only handles one case <code>xs\t&gt;&gt;=\tf\t=\t[y\t|\tx\t&lt;-\txs,\ty\t&lt;-\tf\tx]</code>."}, {"owner": {"reputation": 1, "user_id": 156458, "user_type": "registered", "accept_rate": 47, "profile_image": "https://i.stack.imgur.com/3PCjR.png?s=128&g=1", "display_name": "Tim", "link": "https://stackoverflow.com/users/156458/tim"}, "reply_to_user": {"reputation": 14030, "user_id": 8475054, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/edbf41c4b5aecb1a949936e06368a7c2?s=128&d=identicon&r=PG&f=1", "display_name": "Robin Zigmond", "link": "https://stackoverflow.com/users/8475054/robin-zigmond"}, "edited": false, "score": 0, "creation_date": 1564061610, "post_id": 57201860, "comment_id": 100913874, "body": "@RobinZigmond Many monad tutorials use the example of <code>Maybe</code> monad, whose &gt;&gt;= handles different cases depending on its first argument. Is it misleading to think that the purpose of &gt;&gt;= involves handling different cases depending on the first argument?"}, {"owner": {"reputation": 384463, "user_id": 1126841, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/fa05233b2357f8d11c22ef4cfc7bb85c?s=128&d=identicon&r=PG", "display_name": "chepner", "link": "https://stackoverflow.com/users/1126841/chepner"}, "edited": false, "score": 1, "creation_date": 1564061817, "post_id": 57201860, "comment_id": 100913987, "body": "@Tim I would call that an equivalence, not an actual definition of <code>(&gt;&gt;=)</code> (because it assumes some definition of list comprehensions that isn&#39;t itself based on <code>(&gt;&gt;=)</code>). The more &quot;proper&quot; definition would be <code>[] &gt;&gt;= f = []</code> and <code>(x:xs) &gt;&gt;= f = f x : xs &gt;&gt;= f</code>."}, {"owner": {"reputation": 314794, "user_id": 67579, "user_type": "registered", "accept_rate": 81, "profile_image": "https://i.stack.imgur.com/BJXub.png?s=128&g=1", "display_name": "Willem Van Onsem", "link": "https://stackoverflow.com/users/67579/willem-van-onsem"}, "edited": false, "score": 1, "creation_date": 1564061966, "post_id": 57201860, "comment_id": 100914071, "body": "@Tim: no, it handles both data constructors, since if the list is empty, <code>[ y | x &lt;- xs, y &lt;- f x]</code> will return an empty list. If the list is non-empty, it will work as well."}, {"owner": {"reputation": 384463, "user_id": 1126841, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/fa05233b2357f8d11c22ef4cfc7bb85c?s=128&d=identicon&r=PG", "display_name": "chepner", "link": "https://stackoverflow.com/users/1126841/chepner"}, "edited": false, "score": 0, "creation_date": 1564062304, "post_id": 57201860, "comment_id": 100914288, "body": "See <a href=\"https://www.haskell.org/onlinereport/exps.html#sect3.11\" rel=\"nofollow noreferrer\">haskell.org/onlinereport/exps.html#sect3.11</a> for what a list comprehension really means. Essentially, it just requires that it be equivalent to an application of <code>concatMap</code>, however <code>concatMap</code> is defined. An implementation is therefore free to define list comprehensions as a &quot;primitive&quot; operation, and define <code>concatMap</code> and/or <code>(&gt;&gt;=)</code> in terms of a list comprehension, or it can make <code>concatMap</code> the &quot;primitive&quot; and define list comprehensions as syntactic sugar."}, {"owner": {"reputation": 14030, "user_id": 8475054, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/edbf41c4b5aecb1a949936e06368a7c2?s=128&d=identicon&r=PG&f=1", "display_name": "Robin Zigmond", "link": "https://stackoverflow.com/users/8475054/robin-zigmond"}, "edited": false, "score": 3, "creation_date": 1564062342, "post_id": 57201860, "comment_id": 100914315, "body": "@Tim yes it is misleading if that&#39;s your takeaway. It&#39;s quite incidental whether a particular implementation of <code>&gt;&gt;=</code> does different things for different constructors (in fact a Monad can do anything it likes as long as it respects the monad laws, it&#39;s just an abstract interface rather like interfaces in classical OOP). As I said, the real <i>raison d&#39;etre</i> of <code>&gt;&gt;=</code> is to compose functions which produce Monadic results."}, {"owner": {"reputation": 10378, "user_id": 2476735, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/39e9447bbc32246fcd23b76b5e946618?s=128&d=identicon&r=PG&f=1", "display_name": "David Young", "link": "https://stackoverflow.com/users/2476735/david-young"}, "edited": false, "score": 1, "creation_date": 1564073828, "post_id": 57201860, "comment_id": 100920400, "body": "I think this represents a misunderstanding: &quot;Many implementations of <code>&gt;&gt;=</code> check argument ma to see if ma satisfies some condition. If yes, then <code>a &lt;- ma; f a</code>&quot; The problem is <code>a &lt;- ma</code> gets immediately translated by the compiler into a call to <code>&gt;&gt;=</code>. The fundamental thing here is <code>(&gt;&gt;=)</code>, <b>not</b> <code>&lt;-</code>. I think that trying out a couple of <code>Monad</code>s firsthand will make things more clear. I also get the impression that you may want more experience with pattern matching in Haskell, since it sounds like you believe <code>&lt;-</code> is some kind of &quot;unpacking operation&quot; (though I could be mistaken)"}, {"owner": {"reputation": 10378, "user_id": 2476735, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/39e9447bbc32246fcd23b76b5e946618?s=128&d=identicon&r=PG&f=1", "display_name": "David Young", "link": "https://stackoverflow.com/users/2476735/david-young"}, "reply_to_user": {"reputation": 14030, "user_id": 8475054, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/edbf41c4b5aecb1a949936e06368a7c2?s=128&d=identicon&r=PG&f=1", "display_name": "Robin Zigmond", "link": "https://stackoverflow.com/users/8475054/robin-zigmond"}, "edited": false, "score": 0, "creation_date": 1564074528, "post_id": 57201860, "comment_id": 100920689, "body": "@RobinZigmond I&#39;m not sure I would say unpacking is key to <code>&gt;&gt;=</code>, since are some <code>Monad</code>s where <code>&gt;&gt;=</code> does not do any unpacking (<code>Const a</code> and <code>Proxy</code> definitely don&#39;t. Also, in my opinion at least, it&#39;s a bit of a stretch to say that <code>Monad</code>s like <code>(-&gt;) a</code> do unpacking (an unnecessary stretch at that, again in my opinion. Particularly since there are other <code>Monad</code>s which definitely do not unpack))."}, {"owner": {"reputation": 10378, "user_id": 2476735, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/39e9447bbc32246fcd23b76b5e946618?s=128&d=identicon&r=PG&f=1", "display_name": "David Young", "link": "https://stackoverflow.com/users/2476735/david-young"}, "edited": false, "score": 0, "creation_date": 1564074806, "post_id": 57201860, "comment_id": 100920832, "body": "Also, one more <code>Monad</code> where the &quot;unpacking&quot; concept doesn&#39;t work too well: <code>IO</code>. In <code>x &gt;&gt;= f</code> for <code>IO</code>, the value you give the function argument is not &quot;packed&quot; inside the <code>x</code> argument. It executes the argument and gets the result from that, then passes it to <code>f</code>. This is sort of like executing <code>ls | wc</code> in Bash or zsh (etc). You wouldn&#39;t generally say that the list of filenames in the current directory is contained in <code>&#47;bin&#47;ls</code>, and then <code>&#47;bin&#47;ls</code> was &quot;unpacked&quot; by the pipe."}, {"owner": {"reputation": 14030, "user_id": 8475054, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/edbf41c4b5aecb1a949936e06368a7c2?s=128&d=identicon&r=PG&f=1", "display_name": "Robin Zigmond", "link": "https://stackoverflow.com/users/8475054/robin-zigmond"}, "reply_to_user": {"reputation": 10378, "user_id": 2476735, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/39e9447bbc32246fcd23b76b5e946618?s=128&d=identicon&r=PG&f=1", "display_name": "David Young", "link": "https://stackoverflow.com/users/2476735/david-young"}, "edited": false, "score": 1, "creation_date": 1564076090, "post_id": 57201860, "comment_id": 100921366, "body": "@David perhaps &quot;unpacking&quot; isn&#39;t the most accurate word (I didn&#39;t choose it), but I still think this is the key thing about <code>&gt;&gt;=</code>, at least when viewed through from a sufficiently abstract viewpoint. But <code>IO</code> is a great example of the practical use of this &quot;unpacking&quot; imo. When you write <code>x &gt;&gt;= f</code>, you can&#39;t at that point possibly know the result of the <code>IO</code> action <code>x</code>, but you can still &quot;unpack&quot; the value (that is, actually run the IO action) and feed it to <code>f</code>. (Please forgive my drift into imperative-style language.)"}, {"owner": {"reputation": 61419, "user_id": 849891, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/MbEO3.png?s=128&g=1", "display_name": "Will Ness", "link": "https://stackoverflow.com/users/849891/will-ness"}, "edited": false, "score": 0, "creation_date": 1564137960, "post_id": 57201860, "comment_id": 100941146, "body": "the purpose of &gt;&gt;= is to apply the function to the value under wraps, and how it does it, involves handling different cases depending on the first argument. about lists, it&#39;s <code>[] &gt;&gt;= f = [] ; (x:xs) &gt;&gt;= f = f x ++ xs &gt;&gt;= f</code>."}], "answers": [{"tags": [], "owner": {"reputation": 61419, "user_id": 849891, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/MbEO3.png?s=128&g=1", "display_name": "Will Ness", "link": "https://stackoverflow.com/users/849891/will-ness"}, "is_accepted": false, "score": 1, "last_activity_date": 1607733063, "last_edit_date": 1607733063, "creation_date": 1564064750, "answer_id": 57204317, "question_id": 57201860, "link": "https://stackoverflow.com/questions/57201860/which-is-the-purpose-of-more-about-handling-different-cases-depending-on/57204317#57204317", "title": "Which is the purpose of `&gt;&gt;=` more about: handling different cases depending on argument, or unpacking argument?", "body": "<p>The first. The purpose of <code>ma &gt;&gt;= k</code> is to apply the function <code>k</code> to the <code>a</code> value under <code>m</code> wraps, and how it does it, involves handling different cases depending on the first argument.</p>\n<p>The <a href=\"https://stackoverflow.com/a/11249714/849891\">type &quot;mandala&quot;</a> for <code>ma &gt;&gt;= k  =  join (fmap k ma)</code> is</p>\n<pre><code>    m   a                   -- ma\n        a  -&gt;   m b         -- k\n    m          (m b)        -- after fmap\n   ------------------\n    m             b         -- after join\n</code></pre>\n<p><code>k :: a -&gt; m b</code> is indeed applied to <code>a</code> &quot;inside&quot; <code>m a</code>,  <em>&quot;under wraps&quot;</em>.</p>\n<p>The checking of <code>ma</code> <em>value</em> that you mention is an orthogonal issue. If <code>m a</code> is a sum type, <code>&gt;&gt;=</code> will check and see which of the alternatives to handle; the type handled is still the same <code>m a</code>. For example, <code>Nothing</code> still has the type <code>Maybe a</code>, even if it has no specific <code>a</code> value &quot;inside&quot;.</p>\n<p>Both <code>Nothing</code> and <code>Just x</code> cases are handled by the same <code>&lt;-</code> (or equivalently <code>&gt;&gt;=</code>),</p>\n<pre><code>    do { a &lt;- ma ; foo a }  ==  ma &gt;&gt;= (\\a -&gt; foo a)\n                            ==  (\\case Nothing -&gt; Nothing ;\n                                       Just a  -&gt; (\\a -&gt; foo a) a) ma\n</code></pre>\n<hr />\n<p>Another part of your second option is a reflection on the possibility of chaining.</p>\n<p>Using the so called &quot;Kleisli composition&quot;</p>\n<pre><code>(f &gt;=&gt; g) x  =  f x &gt;&gt;= g\n</code></pre>\n<p>we can chain &quot;Kleisli arrow&quot; type of functions,</p>\n<pre><code>   f  &gt;=&gt;  g  &gt;=&gt;  ...  &gt;=&gt;  h\n------------------------------------\n a -&gt; m b\n        b -&gt; m c\n                  ......\n                           s -&gt; m t\n------------------------------------\n a -&gt;                           m t\n</code></pre>\n<p>But both <code>&gt;&gt;=</code> and <code>&gt;=&gt;</code> are <em>binary</em> operators. When the types align, they can be chained, to form <em>n</em>-ary chains of operations; but the basic, elementary operator is binary.</p>\n<p>This is similar to lists, formed with the binary operator <code>(:)</code>.</p>\n<pre><code>[a,b,c,...,n]  =  a : (b : (c : ... (n : []) ...))\n</code></pre>\n"}], "owner": {"reputation": 1, "user_id": 156458, "user_type": "registered", "accept_rate": 47, "profile_image": "https://i.stack.imgur.com/3PCjR.png?s=128&g=1", "display_name": "Tim", "link": "https://stackoverflow.com/users/156458/tim"}, "delete_vote_count": 1, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 165, "favorite_count": 0, "closed_date": 1564300757, "answer_count": 1, "score": 0, "last_activity_date": 1607733063, "creation_date": 1564057288, "last_edit_date": 1564064227, "question_id": 57201860, "link": "https://stackoverflow.com/questions/57201860/which-is-the-purpose-of-more-about-handling-different-cases-depending-on", "closed_reason": "Opinion-based", "title": "Which is the purpose of `&gt;&gt;=` more about: handling different cases depending on argument, or unpacking argument?", "body": "<p><code>&gt;&gt;=</code> has type  <code>m a -&gt; (a -&gt; m b) -&gt; m b</code></p>\n\n<p>Suppose <code>ma :: m a</code> and <code>f :: a -&gt; m b</code>.</p>\n\n<p>What is the purpose of <code>&gt;&gt;= :: m a -&gt; (a -&gt; m b) -&gt; m b</code> more about: </p>\n\n<ul>\n<li>either being able to implicitly unpack <code>ma :: m a</code> to <code>a</code> so that <code>f :: a -&gt; m b</code> can apply to it?</li>\n<li><p>Or being able to handle different cases depending on <code>ma :: m a</code>? \nMany implementations of <code>&gt;&gt;=</code> check argument <code>ma</code> to see if <code>ma</code> satisfies some condition. If yes, then <code>a &lt;- ma; f a</code>. If no, then do something else with <code>ma</code>, say <code>g ma</code>, where <code>g :: m a -&gt; m b</code>. \nIs it correct that a <strong>more specific</strong> and still <strong>equivalent</strong> version of <code>&gt;&gt;=</code> would have  a type <code>m a -&gt; (a -&gt;m b) -&gt; (... -&gt; m b) -&gt; m b</code>, where   <code>... -&gt; m b</code> is  the type for the third argument like <code>g</code> above?\nIf yes, what is type <code>...</code>?  Shall it be <code>m a</code>? It might not be <code>a</code>, correct?</p></li>\n<li><p>Or both?</p></li>\n</ul>\n\n<p>Thanks.</p>\n"}, {"tags": ["haskell", "monad-transformers", "newtype", "deriving"], "comments": [{"owner": {"reputation": 36513, "user_id": 752976, "user_type": "registered", "accept_rate": 84, "profile_image": "https://i.stack.imgur.com/j7Uis.jpg?s=128&g=1", "display_name": "Bartek Banachewicz", "link": "https://stackoverflow.com/users/752976/bartek-banachewicz"}, "edited": false, "score": 0, "creation_date": 1564048341, "post_id": 57198777, "comment_id": 100906345, "body": "Could you provide the definitions of <code>Auth</code> and <code>FeatureFlag</code>, or simplify this code to the minimal part that reproduces this issue? Right now it&#39;s impossible to easily reproduce the error you&#39;re getting, and I&#39;m sure you could cut out a few irrelevant parts."}, {"owner": {"reputation": 5657, "user_id": 534481, "user_type": "registered", "accept_rate": 31, "profile_image": "https://www.gravatar.com/avatar/60df8c1a366ab1bf4378154e71a93367?s=128&d=identicon&r=PG", "display_name": "Saurabh Nanda", "link": "https://stackoverflow.com/users/534481/saurabh-nanda"}, "reply_to_user": {"reputation": 36513, "user_id": 752976, "user_type": "registered", "accept_rate": 84, "profile_image": "https://i.stack.imgur.com/j7Uis.jpg?s=128&g=1", "display_name": "Bartek Banachewicz", "link": "https://stackoverflow.com/users/752976/bartek-banachewicz"}, "edited": false, "score": 0, "creation_date": 1564050728, "post_id": 57198777, "comment_id": 100907733, "body": "@BartekBanachewicz I have added a minimal code snippet to the question. As a first step, I was able to get the error with just the newtype (i.e. without phantom-type)."}, {"owner": {"reputation": 8621, "user_id": 1848029, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/qfjAy.jpg?s=128&g=1", "display_name": "lehins", "link": "https://stackoverflow.com/users/1848029/lehins"}, "edited": false, "score": 0, "creation_date": 1564052511, "post_id": 57198777, "comment_id": 100908742, "body": "Not related to your question, but I think you newtype might be misspelled <code>AuhM</code> vs <code>AuthM</code>?"}, {"owner": {"reputation": 5657, "user_id": 534481, "user_type": "registered", "accept_rate": 31, "profile_image": "https://www.gravatar.com/avatar/60df8c1a366ab1bf4378154e71a93367?s=128&d=identicon&r=PG", "display_name": "Saurabh Nanda", "link": "https://stackoverflow.com/users/534481/saurabh-nanda"}, "reply_to_user": {"reputation": 8621, "user_id": 1848029, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/qfjAy.jpg?s=128&g=1", "display_name": "lehins", "link": "https://stackoverflow.com/users/1848029/lehins"}, "edited": false, "score": 0, "creation_date": 1564053462, "post_id": 57198777, "comment_id": 100909241, "body": "@lehins yes, good catch :)"}], "answers": [{"comments": [{"owner": {"reputation": 5657, "user_id": 534481, "user_type": "registered", "accept_rate": 31, "profile_image": "https://www.gravatar.com/avatar/60df8c1a366ab1bf4378154e71a93367?s=128&d=identicon&r=PG", "display_name": "Saurabh Nanda", "link": "https://stackoverflow.com/users/534481/saurabh-nanda"}, "edited": false, "score": 0, "creation_date": 1564063545, "post_id": 57201987, "comment_id": 100915066, "body": "Wow! Thank you for this insightful answer. The second part is some new level of type-fu that I haven&#39;t seen till now. Let me play around with this with my original and come back with the results!"}, {"owner": {"reputation": 5657, "user_id": 534481, "user_type": "registered", "accept_rate": 31, "profile_image": "https://www.gravatar.com/avatar/60df8c1a366ab1bf4378154e71a93367?s=128&d=identicon&r=PG", "display_name": "Saurabh Nanda", "link": "https://stackoverflow.com/users/534481/saurabh-nanda"}, "edited": false, "score": 0, "creation_date": 1564073712, "post_id": 57201987, "comment_id": 100920358, "body": "In which GHC version was <code>QuantifiedConstraints</code> introduced? i&#39;m getting an <code>Unsupported extension</code> error."}, {"owner": {"reputation": 24509, "user_id": 6863749, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/UyoQv.jpg?s=128&g=1", "display_name": "Li-yao Xia", "link": "https://stackoverflow.com/users/6863749/li-yao-xia"}, "reply_to_user": {"reputation": 5657, "user_id": 534481, "user_type": "registered", "accept_rate": 31, "profile_image": "https://www.gravatar.com/avatar/60df8c1a366ab1bf4378154e71a93367?s=128&d=identicon&r=PG", "display_name": "Saurabh Nanda", "link": "https://stackoverflow.com/users/534481/saurabh-nanda"}, "edited": false, "score": 0, "creation_date": 1564076687, "post_id": 57201987, "comment_id": 100921640, "body": "It appeared in GHC 8.6 <a href=\"https://downloads.haskell.org/~ghc/latest/docs/html/users_guide/glasgow_exts.html#quantified-constraints\" rel=\"nofollow noreferrer\">downloads.haskell.org/~ghc/latest/docs/html/users_guide/&hellip;</a>"}], "tags": [], "owner": {"reputation": 24509, "user_id": 6863749, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/UyoQv.jpg?s=128&g=1", "display_name": "Li-yao Xia", "link": "https://stackoverflow.com/users/6863749/li-yao-xia"}, "is_accepted": false, "score": 7, "last_activity_date": 1564090153, "last_edit_date": 1564090153, "creation_date": 1564057722, "answer_id": 57201987, "question_id": 57198777, "link": "https://stackoverflow.com/questions/57198777/how-to-define-monadunliftio-instance-for-a-newtype-with-a-phantom-type-variable/57201987#57201987", "title": "How to define MonadUnliftIO instance for a newtype with a phantom type-variable?", "body": "<p>Plan:</p>\n\n<ul>\n<li>How to implement <code>MonadUnliftIO</code> by hand.</li>\n<li>How to newtype-derive <code>MonadUnliftIO</code>.</li>\n</ul>\n\n<h1>Implement explicitly</h1>\n\n<pre class=\"lang-hs prettyprint-override\"><code>newtype AuthM m a = AuthM { unAuthM :: ReaderT Auth m a }\n  deriving ...\n\ninstance MonadUnliftIO m =&gt; MonadUnliftIO (AuthM m) where\n  askUnliftIO = AuthM (fmap (\\(UnliftIO run) -&gt; UnliftIO (run . unAuthM)) askUnliftIO)\n  withRunInIO go = AuthM (withRunInIO (\\k -&gt; go (k . unAuthM)))\n</code></pre>\n\n<p>There is nothing magical about this; here's how you can derive the definition of <code>askUnliftIO</code>. We want to wrap the existing instance of <code>MonadUnliftIO</code> for <code>ReaderT Auth m</code>. Using that instance, we have:</p>\n\n<pre><code>askUnliftIO :: ReaderT Auth m (UnliftIO (ReaderT Auth m))\n</code></pre>\n\n<p>And we are looking for</p>\n\n<pre><code>_ :: AuthM m (UnliftIO (AuthM m))\n</code></pre>\n\n<p>In other words, we want to replace the two occurrences of <code>ReaderT Auth</code> with <code>AuthM</code>. The outer one is easy:</p>\n\n<pre><code>AuthM askUnliftIO :: AuthM m (UnliftIO (ReaderT Auth m))\n</code></pre>\n\n<p>To get at the inner one, we can use <code>fmap</code>, and then the problem becomes to find the right function <code>UnliftIO (ReaderT Auth m) -&gt; UnliftIO (AuthM m)</code>.</p>\n\n<pre><code>fmap _ (AuthM askUnliftIO) :: AuthM m (UnliftIO (AuthM m))\n\n-- provided --\n\n_ :: UnliftIO (ReaderT Auth m) -&gt; UnliftIO (AuthM m)\n</code></pre>\n\n<p>We're now looking for a function, and the library doesn't provide any functions on <code>UnliftIO</code>, so the only way to start is a lambda with pattern-matching, and since the function result is <code>UnliftIO</code>, we can also start with a constructor:</p>\n\n<pre><code>(\\(UnliftIO run) -&gt; UnliftIO (_ :: forall a. AuthM m a -&gt; IO a) :: UnliftIO (AuthM m))\n  :: UnliftIO (ReaderT Auth m) -&gt; UnliftIO (AuthM m)\n\n-- where (run :: forall a. ReaderT Auth m a -&gt; IO a)\n</code></pre>\n\n<p>Here we see that <code>run</code> and the hole only differ in their arguments. We can transform a function's argument by function composition, we fill the hole with <code>run . _</code>, containing a new hole:</p>\n\n<pre><code>(\\(UnliftIO run) -&gt; UnliftIO (run . (_ :: AuthM m a -&gt; ReaderT Auth m a)\n                                :: forall a. AuthM m a -&gt; IO a\n                             )\n) :: UnliftIO (ReaderT Auth m) -&gt; UnliftIO (AuthM m)\n</code></pre>\n\n<p>That hole is finally filled with the destructor <code>\\(AuthM u) -&gt; u</code>, aka. <code>unAuthM</code>. Put all the pieces together:</p>\n\n<pre><code>fmap (\\(UnliftIO run) -&gt; UnliftIO (run . unAuthM)) (AuthM askUnliftIO)\n</code></pre>\n\n<p>Note that <code>fmap f (AuthM u) = AuthM (fmap f u)</code> (by definition of <code>fmap</code> for <code>AuthM</code>), which is how you get the version at the top. Whether or not to do that bit of rewriting is mostly a matter of taste.</p>\n\n<p>Most of these steps can be carried out with the help of GHC's <em>typed holes</em>. There's some loose ends at the beginning when you try to find the right shape for the expression, but there might also be a way to use typed holes to help with that part of the exploration as well.</p>\n\n<ul>\n<li>See also <a href=\"https://reasonablypolymorphic.com/blog/typeholes/\" rel=\"nofollow noreferrer\">Implement With Types, Not Your Brain!</a></li>\n</ul>\n\n<p>Note that none of this requires any knowledge about the purpose of <code>askUnliftIO</code> nor <code>AuthM</code>. It's 100% mindless wrapping/unwrapping between <code>AuthM</code> and <code>ReaderT</code>, i.e., 100% boilerplate that could be automated, which is the topic of this next section.</p>\n\n<h1>Derive</h1>\n\n<p>Technical explanation of why deriving doesn't Just Work. The extension <code>GeneralizedNewtypeDeriving</code> tries to coerce <code>ReaderT Auth m (UnliftIO (ReaderT Auth m))</code> to <code>AuthM m (UnliftIO (AuthM m))</code> (in the case of <code>askUnliftIO</code>). However, this is not possible if <code>m</code> depends on its argument nominally.</p>\n\n<ul>\n<li>For more details, see also this blogpost, which also gives the solution summarized below: <a href=\"https://ryanglscott.github.io/2018/03/04/how-quantifiedconstraints-can-let-us-put-join-back-in-monad/\" rel=\"nofollow noreferrer\">https://ryanglscott.github.io/2018/03/04/how-quantifiedconstraints-can-let-us-put-join-back-in-monad/</a></li>\n</ul>\n\n<p>We need a \"representational role\" constraint, which we can encode as follows thanks to <code>QuantifiedConstraints</code> which appeared in GHC 8.6.</p>\n\n<pre><code>{-# LANGUAGE QuantifiedConstraints, RankNTypes, KindSignatures #-}\n-- Note: GHC &gt;= 8.6\n\nimport Data.Coerce\nimport Data.Kind (Constraint)\n\ntype Representational m\n  = (forall a b. Coercible a b =&gt; Coercible (m a) (m b) :: Constraint)\n  -- ^ QuantifiedConstraints + RankNTypes               ^ KindSignatures\n</code></pre>\n\n<p>Thus annotate the derived instance with that constraint:</p>\n\n<pre><code>{-# LANGUAGE GeneralizedNewtypeDeriving, StandaloneDeriving #-}\n\nderiving instance (MonadUnliftIO m, Representational m) =&gt; MonadUnliftIO (AuthM m)\n</code></pre>\n\n<hr>\n\n<p>Full snippet:</p>\n\n<pre><code>{-# LANGUAGE GeneralizedNewtypeDeriving, StandaloneDeriving, QuantifiedConstraints, KindSignatures, RankNTypes #-}\n\nmodule Try13 where\n\nimport Control.Monad.Reader\nimport UnliftIO\nimport Control.Monad.Catch\nimport Data.Coerce\nimport Data.Kind (Constraint)\n\ndata Auth = Auth\n\nnewtype AuthM m a = AuthM { unAuthM :: ReaderT Auth m a }\n  deriving(Functor, Applicative, Monad, MonadReader Auth, MonadIO, MonadThrow, MonadCatch, MonadMask)\n\ntype Representational m = (forall a b. Coercible a b =&gt; Coercible (m a) (m b) :: Constraint)\n\nderiving instance (MonadUnliftIO m, Representational m) =&gt; MonadUnliftIO (AuthM m)\n\n-- instance MonadUnliftIO m =&gt; MonadUnliftIO (AuthM m) where\n--   askUnliftIO = AuthM (fmap (\\(UnliftIO run) -&gt; UnliftIO (run . unAuthM)) askUnliftIO)\n--   withRunInIO go = AuthM (withRunInIO (\\k -&gt; go (k . unAuthM)))\n</code></pre>\n"}, {"tags": [], "owner": {"reputation": 3203, "user_id": 2622234, "user_type": "registered", "accept_rate": 68, "profile_image": "https://www.gravatar.com/avatar/a4b0faa804acdb74ea677bc421d5caac?s=128&d=identicon&r=PG", "display_name": "sara", "link": "https://stackoverflow.com/users/2622234/sara"}, "is_accepted": false, "score": 3, "last_activity_date": 1592216543, "last_edit_date": 1592216543, "creation_date": 1592215556, "answer_id": 62385887, "question_id": 57198777, "link": "https://stackoverflow.com/questions/57198777/how-to-define-monadunliftio-instance-for-a-newtype-with-a-phantom-type-variable/62385887#62385887", "title": "How to define MonadUnliftIO instance for a newtype with a phantom type-variable?", "body": "<p>As of version 0.2.0.0 of <code>unliftio-core</code>, the <code>askUnliftIO</code> function has been moved out of the typeclass, which makes it possible to <code>newtype</code>-derive this instance again! </p>\n\n<pre class=\"lang-hs prettyprint-override\"><code>data FeatureFlag\ndata Auth auth\n\nnewtype AuthM (fs :: [FeatureFlag]) auth m a = AuthM\n  { unAuthM :: Auth auth -&gt; m a\n  }\n  deriving newtype\n    ( Functor\n    , Applicative\n    , Monad\n    , MonadReader (Auth auth)\n    , MonadIO\n    , MonadThrow\n    , MonadCatch\n    , MonadMask\n    , MonadUnliftIO\n    )\n</code></pre>\n\n<p>cf <a href=\"https://github.com/fpco/unliftio/issues/55\" rel=\"nofollow noreferrer\">https://github.com/fpco/unliftio/issues/55</a></p>\n"}], "owner": {"reputation": 5657, "user_id": 534481, "user_type": "registered", "accept_rate": 31, "profile_image": "https://www.gravatar.com/avatar/60df8c1a366ab1bf4378154e71a93367?s=128&d=identicon&r=PG", "display_name": "Saurabh Nanda", "link": "https://stackoverflow.com/users/534481/saurabh-nanda"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 343, "favorite_count": 2, "answer_count": 2, "score": 7, "last_activity_date": 1592216543, "creation_date": 1564047248, "last_edit_date": 1564050694, "question_id": 57198777, "link": "https://stackoverflow.com/questions/57198777/how-to-define-monadunliftio-instance-for-a-newtype-with-a-phantom-type-variable", "title": "How to define MonadUnliftIO instance for a newtype with a phantom type-variable?", "body": "<p>Related question - <a href=\"https://stackoverflow.com/questions/56863771/is-it-safe-to-derive-monadthrow-monadcatch-monadbasecontrol-monadunliftio-et\">Is it safe to derive MonadThrow, MonadCatch, MonadBaseControl, MonadUnliftIO, etc?</a> - where I had enabled, both - <code>DeriveAnyClass</code> and <code>GeneralizedNewtypeDeriving</code> \nto get the code to compile, but didn't bother looking at the ominous warnings. Now, that I am running my refactored code, it's throwing a runtime error:</p>\n\n<pre><code>No instance nor default method for class operation &gt;&gt;=\n</code></pre>\n\n<p>So, I removed <code>DeriveAnyClass</code> and kept ONLY <code>GeneralizedNewtypeDeriving</code> and have the following compile error:</p>\n\n<pre><code>{-# LANGUAGE DataKinds, GADTs, ScopedTypeVariables, TypeFamilies, AllowAmbiguousTypes, RankNTypes, StandaloneDeriving, UndecidableInstances #-}\n\nnewtype AuthM (fs :: [FeatureFlag]) auth m a =\n  AuthM (ReaderT (Auth auth) m a)\n  deriving (Functor, Applicative, Monad, MonadReader (Auth auth), MonadIO, MonadThrow, MonadCatch, MonadMask, MonadUnliftIO)\n\n\n--     \u2022 Couldn't match representation of type \u2018m (Control.Monad.IO.Unlift.UnliftIO\n--                                                   (AuthM fs auth m))\u2019\n--                                with that of \u2018m (Control.Monad.IO.Unlift.UnliftIO\n--                                                   (ReaderT (Auth auth) m))\u2019\n--         arising from the coercion of the method \u2018Control.Monad.IO.Unlift.askUnliftIO\u2019\n--           from type \u2018ReaderT\n--                        (Auth auth)\n--                        m\n--                        (Control.Monad.IO.Unlift.UnliftIO (ReaderT (Auth auth) m))\u2019\n--             to type \u2018AuthM\n--                        fs auth m (Control.Monad.IO.Unlift.UnliftIO (AuthM fs auth m))\u2019\n--       NB: We cannot know what roles the parameters to \u2018m\u2019 have;\n--         we must assume that the role is nominal\n--     \u2022 When deriving the instance for (MonadUnliftIO (AuthM fs auth m))\n--    |\n-- 82 |   deriving (Functor, Applicative, Monad, MonadReader (Auth auth), MonadIO, MonadThrow, MonadCatch, MonadMask, MonadUnliftIO)\n--    |                                                                                                               ^^^^^^^^^^^^^\n</code></pre>\n\n<p><strong>Note:</strong> I realise that the first error about <code>&gt;&gt;=</code> has got nothing to do with the error about <code>MonadUnliftIO</code>. I have confirmed that there are no warnings about a missing <code>&gt;&gt;=</code>, when <code>DeriveAnyClass</code> is turned off.</p>\n\n<p>I guess I need to write the instance for <code>MonadUnliftIO</code> myself, because the compiler probably cannot figure this out in the presence of a <code>newtype</code> AND a phantom type-variable. However, I just can't figure out how to define the <a href=\"https://www.stackage.org/haddock/lts-12.1/unliftio-core-0.1.1.0/Control-Monad-IO-Unlift.html#v:askUnliftIO\" rel=\"noreferrer\"><code>askUnliftIO</code></a> for my type, given above.</p>\n\n<h3>Attempt 1 at minimal code snippet</h3>\n\n<pre><code>{-# LANGUAGE GeneralizedNewtypeDeriving #-}\n\nmodule Try13 where\n\nimport Control.Monad.Reader\nimport UnliftIO\nimport Control.Monad.Catch\n\ndata Auth = Auth\n\nnewtype AuhM m a = AuthM (ReaderT Auth m a)\n  deriving(Functor, Applicative, Monad, MonadReader Auth, MonadIO, MonadThrow, MonadCatch, MonadMask, MonadUnliftIO)\n\n--     \u2022 Couldn't match representation of type \u2018m (UnliftIO (AuhM m))\u2019\n--                                with that of \u2018m (UnliftIO (ReaderT Auth m))\u2019\n--         arising from the coercion of the method \u2018askUnliftIO\u2019\n--           from type \u2018ReaderT Auth m (UnliftIO (ReaderT Auth m))\u2019\n--             to type \u2018AuhM m (UnliftIO (AuhM m))\u2019\n--       NB: We cannot know what roles the parameters to \u2018m\u2019 have;\n--         we must assume that the role is nominal\n--     \u2022 When deriving the instance for (MonadUnliftIO (AuhM m))\n--    |\n-- 12 |   deriving(Functor, Applicative, Monad, MonadReader Auth, MonadIO, MonadThrow, MonadCatch, MonadMask, MonadUnliftIO)\n--    |                                                                                                       ^^^^^^^^^^^^^\n-- \n</code></pre>\n"}, {"tags": ["haskell", "random", "haskell-stack", "ghci"], "comments": [{"owner": {"reputation": 100185, "user_id": 3234959, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/93bb12ca0f93dfddb33880316f7e66c2?s=128&d=identicon&r=PG&f=1", "display_name": "chi", "link": "https://stackoverflow.com/users/3234959/chi"}, "edited": false, "score": 2, "creation_date": 1564047325, "post_id": 57197920, "comment_id": 100905766, "body": "<code>getFourDigits &lt;- return (fourDigits rndGen)</code> is more commonly written as <code>let getFourDigits = fourDigits rndGen</code>."}, {"owner": {"reputation": 126897, "user_id": 791604, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/ce991df7a056248d5e4f6fc3659ba733?s=128&d=identicon&r=PG", "display_name": "Daniel Wagner", "link": "https://stackoverflow.com/users/791604/daniel-wagner"}, "edited": false, "score": 1, "creation_date": 1564063368, "post_id": 57197920, "comment_id": 100914965, "body": "A more idiomatic spelling would be <code>randomList = print . sort . take 4 . randomRs (0,9) =&lt;&lt; getStdGn</code>."}, {"owner": {"reputation": 570, "user_id": 3295004, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/IGNvT.jpg?s=128&g=1", "display_name": "fp_mora", "link": "https://stackoverflow.com/users/3295004/fp-mora"}, "edited": false, "score": 0, "creation_date": 1564154409, "post_id": 57197920, "comment_id": 100950278, "body": "<code>take 500 $ unionAll [[1..],[2..],[3..]]</code> or with duplicates <code>take 500 $ mergeAll [[1..],[2..],[3..]]</code>"}], "answers": [{"tags": [], "owner": {"reputation": 314794, "user_id": 67579, "user_type": "registered", "accept_rate": 81, "profile_image": "https://i.stack.imgur.com/BJXub.png?s=128&g=1", "display_name": "Willem Van Onsem", "link": "https://stackoverflow.com/users/67579/willem-van-onsem"}, "is_accepted": true, "score": 4, "last_activity_date": 1564045401, "last_edit_date": 1564045401, "creation_date": 1564045332, "answer_id": 57198130, "question_id": 57197920, "link": "https://stackoverflow.com/questions/57197920/haskell-sorted-random-list-is-infinite/57198130#57198130", "title": "Haskell sorted random list is infinite", "body": "<p>In short, your <code>rndGen</code> has as type an <code>[Int]</code>. So a list of <code>Int</code>s. This thus means that <code>repeat rndGen</code> has type <code>[[Int]]</code>, so a list of <em>lists</em> of <code>Int</code>s. All these lists have infinite size.</p>\n\n<p>This thus means that if you want to sort that list, you compare the individual elements. But since these individual elements have infinite size, and are equal, that function will never terminate. If you want to determine if a list <code>x</code> is smaller than a list <code>y</code>, you can concurrently iterate over the two lists and stop from the moment the elements are different. But these elements are never different.</p>\n\n<p>You should implement your function as:</p>\n\n<pre><code>fourDigits :: Ord a =&gt; <b>[</b>a<b>]</b> -&gt; [a]\nfourDigits rndGen = sort $ take 4 <b>rndGen</b></code></pre>\n"}], "owner": {"reputation": 999, "user_id": 8604871, "user_type": "registered", "accept_rate": 14, "profile_image": "https://www.gravatar.com/avatar/36382829e5be7f6da95308288d976949?s=128&d=identicon&r=PG&f=1", "display_name": "Madderote", "link": "https://stackoverflow.com/users/8604871/madderote"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 85, "favorite_count": 0, "accepted_answer_id": 57198130, "answer_count": 1, "score": 2, "last_activity_date": 1566241378, "creation_date": 1564044626, "last_edit_date": 1566241378, "question_id": 57197920, "link": "https://stackoverflow.com/questions/57197920/haskell-sorted-random-list-is-infinite", "title": "Haskell sorted random list is infinite", "body": "<p>For a small project I want to use Haskell. Need batches of 4 random numbers between 0 and 9, and these <code>[Int]</code> needs to be sorted when done (using: <code>Data.Sort</code>). Code below keeps returning an infinite list despite <code>take 4 xs</code>. </p>\n\n<pre><code>import System.Random \nimport Data.Sort \n\nrandomList :: IO () \nrandomList = do \n  generator &lt;- getStdGen \n  let rndGen = randomRs (0,9) generator :: [Int]\n  getFourDigits &lt;- return (fourDigits rndGen) \n  putStrLn $ show getFourDigits\n\nfourDigits :: Ord a =&gt; a -&gt; [a]\nfourDigits rndGen = sort $ take 4 (repeat rndGen)\n</code></pre>\n\n<p>Is this caused by dry-running in <code>stack ghci</code>?</p>\n"}, {"tags": ["haskell", "functional-programming", "singleton-type"], "answers": [{"comments": [{"owner": {"reputation": 7817, "user_id": 7345298, "user_type": "registered", "accept_rate": 50, "profile_image": "https://www.gravatar.com/avatar/9477d048c5c29b16307b3356146d497a?s=128&d=identicon&r=PG&f=1", "display_name": "bradrn", "link": "https://stackoverflow.com/users/7345298/bradrn"}, "edited": false, "score": 0, "creation_date": 1564036715, "post_id": 57195622, "comment_id": 100900059, "body": "Wouldn\u2019t it be the <i>kind</i> rather than the <i>type</i> which changes with the input?"}, {"owner": {"reputation": 22091, "user_id": 5684257, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/ea5090cde8ea066a1fda67ed52dd5084?s=128&d=identicon&r=PG&f=1", "display_name": "HTNW", "link": "https://stackoverflow.com/users/5684257/htnw"}, "reply_to_user": {"reputation": 7817, "user_id": 7345298, "user_type": "registered", "accept_rate": 50, "profile_image": "https://www.gravatar.com/avatar/9477d048c5c29b16307b3356146d497a?s=128&d=identicon&r=PG&f=1", "display_name": "bradrn", "link": "https://stackoverflow.com/users/7345298/bradrn"}, "edited": false, "score": 0, "creation_date": 1564036845, "post_id": 57195622, "comment_id": 100900108, "body": "@bradrn In Haskell, types have types. Due to historical reasons, the type of a type is often called its kind. I prefer to pretend the word &quot;kind&quot; doesn&#39;t exist, until someone else brings it up, because it was a deliberate move to eliminate the distinction from the language."}, {"owner": {"reputation": 23, "user_id": 11834064, "user_type": "registered", "profile_image": "https://lh6.googleusercontent.com/-4rwnta7HNhc/AAAAAAAAAAI/AAAAAAAAAAA/ACHi3reSmVL99ivBamVmVyVngu0-zPWdVg/photo.jpg?sz=128", "display_name": "Denis", "link": "https://stackoverflow.com/users/11834064/denis"}, "edited": false, "score": 0, "creation_date": 1564038861, "post_id": 57195622, "comment_id": 100901041, "body": "@HTNW, amazing! This pattern of splitting computation into 2 steps is everywhere in singletons, and now I&#39;m starting to understand why it&#39;s used. Thanks!"}], "tags": [], "owner": {"reputation": 22091, "user_id": 5684257, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/ea5090cde8ea066a1fda67ed52dd5084?s=128&d=identicon&r=PG&f=1", "display_name": "HTNW", "link": "https://stackoverflow.com/users/5684257/htnw"}, "is_accepted": true, "score": 3, "last_activity_date": 1564037076, "last_edit_date": 1564037076, "creation_date": 1564036132, "answer_id": 57195622, "question_id": 57194718, "link": "https://stackoverflow.com/questions/57194718/how-to-convert-type-level-list-into-chain-of-pairs/57195622#57195622", "title": "How to convert type-level list into chain of pairs", "body": "<p>The type of <code>IntoChainOfPairs</code>'s result should change with the input. Therefore, there are actually two functions, one <code>type ToPairsType (xs :: [a]) :: Type</code>\u2014computing the output type from the input\u2014and one <code>type ToPairs (xs :: [a]) :: ToPairsType xs</code>\u2014actually computing the output.</p>\n\n<pre><code>type family ToPairsType (xs :: [a]) :: Type where\n  ToPairsType '[] = ()\n  ToPairsType ((_ :: a) : xs) = (a, ToPairsType xs)\ntype family ToPairs (xs :: [a]) :: ToPairsType xs where\n  ToPairs '[] = '()\n  ToPairs (x : xs) = '(x, ToPairs xs)\n</code></pre>\n\n<p>You defined a single partial function, where <code>b</code> was an argument to <code>IntoChainOfPairs</code>. You really wrote</p>\n\n<pre><code>type family IntoChainOfPairs (k :: Type) (b :: Type) (xs :: [k]) :: (k, b) where\n  IntoChainOfPairs k () (x : '[]) = '(x, '())\n  IntoChainOfPairs k (k, b') (x : xs) = '(x, IntoChainOfPairs k b' xs)\n</code></pre>\n\n<p>Where you had partial pattern matching on <code>b</code>, with nonlinear matching on <code>k</code>. Additionally, the unnatural (partial!) list-processing does not help. You can sorta-maybe-painfully get value-level <code>case</code> on <code>Type</code>s, using the <code>Typeable</code> infrastructure, for writing <code>sIntoChainOfPairs</code>, but I would not advise it. Really, <code>IntoChainOfPairs</code> is just broken.</p>\n\n<p><code>sToPairs</code> is written as a direct \"reflection\" of <code>ToPairs</code>:</p>\n\n<pre><code>sToPairs :: forall (a :: Type) (xs :: [a]). Sing xs -&gt; Sing (ToPairs xs)\nsToPairs SNil = STuple0\nsToPairs (SCons x xs) = STuple2 x (sToPairs xs)\n</code></pre>\n"}], "owner": {"reputation": 23, "user_id": 11834064, "user_type": "registered", "profile_image": "https://lh6.googleusercontent.com/-4rwnta7HNhc/AAAAAAAAAAI/AAAAAAAAAAA/ACHi3reSmVL99ivBamVmVyVngu0-zPWdVg/photo.jpg?sz=128", "display_name": "Denis", "link": "https://stackoverflow.com/users/11834064/denis"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 64, "favorite_count": 0, "accepted_answer_id": 57195622, "answer_count": 1, "score": 2, "last_activity_date": 1564037076, "creation_date": 1564031499, "question_id": 57194718, "link": "https://stackoverflow.com/questions/57194718/how-to-convert-type-level-list-into-chain-of-pairs", "title": "How to convert type-level list into chain of pairs", "body": "<p>The singletons library seems too difficult to deal with it without strong background. Is there any way to convert level typed list like <code>'[1, 2, 3]</code> into chain of pairs like <code>'(1, '(2, '(3, '())))</code>? </p>\n\n<p>I've tried to write few lines but they produce expressionless for me errors.</p>\n\n<pre class=\"lang-hs prettyprint-override\"><code>{-# LANGUAGE TypeFamilies, TypeInType #-}\n\nmodule ExpandList where\n\nimport Data.Singletons.Prelude.List\nimport Data.Singletons.Prelude.Tuple\n\ntype family IntoChainOfPairs (xs :: [k]) :: (k, b) where\n  IntoChainOfPairs (x ': '[]) = '(x, '())\n  IntoChainOfPairs (x ': xs) = '(x, IntoChainOfPairs xs)\n\nsIntoChainOfPairs :: forall a (t :: [a]). Sing t -&gt; Sing (IntoChainOfPairs t)\nsIntoChainOfPairs = \\case\n  SCons a SNil -&gt; STuple2 a STuple0\n  SCons a b -&gt; STuple2 a (sIntoChainOfPairs b)\n</code></pre>\n\n<p>So I stacked in fundamental misunderstanding. Compiler doesn't understand me, I don't understand it. I'm sure my code is wrong at the root.</p>\n"}, {"tags": ["haskell", "state-monad"], "answers": [{"comments": [{"owner": {"reputation": 7817, "user_id": 7345298, "user_type": "registered", "accept_rate": 50, "profile_image": "https://www.gravatar.com/avatar/9477d048c5c29b16307b3356146d497a?s=128&d=identicon&r=PG&f=1", "display_name": "bradrn", "link": "https://stackoverflow.com/users/7345298/bradrn"}, "reply_to_user": {"reputation": 79, "user_id": 9306908, "user_type": "registered", "profile_image": "https://lh3.googleusercontent.com/-0PUuILofnc0/AAAAAAAAAAI/AAAAAAAAAFc/gnH2Rqv_y7Y/photo.jpg?sz=128", "display_name": "all", "link": "https://stackoverflow.com/users/9306908/all"}, "edited": false, "score": 0, "creation_date": 1564096571, "post_id": 57194612, "comment_id": 100928567, "body": "You\u2019re welcome @all! If you find this answer helps, can you accept it (click the green check mark) so this question is marked as answered?"}], "tags": [], "owner": {"reputation": 7817, "user_id": 7345298, "user_type": "registered", "accept_rate": 50, "profile_image": "https://www.gravatar.com/avatar/9477d048c5c29b16307b3356146d497a?s=128&d=identicon&r=PG&f=1", "display_name": "bradrn", "link": "https://stackoverflow.com/users/7345298/bradrn"}, "is_accepted": true, "score": 5, "last_activity_date": 1564030740, "creation_date": 1564030740, "answer_id": 57194612, "question_id": 57194376, "link": "https://stackoverflow.com/questions/57194376/getting-gamestate-value-in-state-monad/57194612#57194612", "title": "Getting Gamestate value in State Monad", "body": "<p>Let\u2019s start with what you have so far:</p>\n\n<pre class=\"lang-hs prettyprint-override\"><code>getDirection :: State GameState Double\ngetDirection = do\n     x &lt;- get\n     return x\n</code></pre>\n\n<p>(As an aside, this is really just the same as <code>getDirection = get</code>, since you\u2019re simply running <code>get</code> and returning its return value.)</p>\n\n<p>Firstly, what is the type of <code>x</code> here? Your state is of type <code>GameState</code>, and <code>get</code> just gets the state, so <code>x :: GameState</code>. So we can pattern match on it to get:</p>\n\n<pre class=\"lang-hs prettyprint-override\"><code>getDirection :: State GameState Double\ngetDirection = do\n     (GameState map dir bool) &lt;- get\n     return (GameState map dir bool)\n</code></pre>\n\n<p>At this point it should be obvious what to do: simply return <code>dir</code> instead of <code>(GameState map dir bool)</code>.</p>\n\n<blockquote>\n  <p>And when I want to change the direction do I use put or modify?</p>\n</blockquote>\n\n<p>You shouldn\u2019t really ask two questions in the same post, but to answer this, let\u2019s have a look at their types:</p>\n\n<pre class=\"lang-hs prettyprint-override\"><code>put    :: s        -&gt; State s ()\nmodify :: (s -&gt; s) -&gt; State s ()\n</code></pre>\n\n<p>The idea is that <code>put</code> simply writes a new state, whereas <code>modify</code> takes the existing state and modifies it using the given function. These functions are in fact equivalent in power, meaning you can replace either function with the other:</p>\n\n<pre class=\"lang-hs prettyprint-override\"><code>-- write \u2018put\u2019 using \u2018modify\u2019\nput s = modify (\\_oldState -&gt; s)\n\n-- write \u2018modify\u2019 using \u2018put\u2019 (and \u2018get\u2019)\nmodify f = do\n    oldState &lt;- get\n    put $ f oldState\n</code></pre>\n\n<p>However, usually it is easier to use <code>put</code> or <code>modify</code> in different situations. For instance, if you want to write a completely new state without reference to the old state, use <code>put</code>; if you want to take the existing state and change it a bit, use <code>modify</code>. In your case, you want to change the direction only, so it\u2019s easiest to use <code>modify</code> so you can change the state with reference to what it used to be:</p>\n\n<pre class=\"lang-hs prettyprint-override\"><code>changeDirTo :: Double -&gt; State GameState ()\nchangeDirTo newDir = modify (\\(GameState map _ bool) -&gt; GameState map newDir bool)\n\n-- you can also do it using \u2018put\u2019, but it\u2019s a bit harder and less elegant:\nchangeDirTo2 :: Direction -&gt; State GameState ()\nchangeDirTo2 newDir = do\n    (GameState map _ bool) &lt;- get\n    put $ GameState map newDir bool\n</code></pre>\n\n<p>On the other hand, if you (say) wanted to assign a completely new <code>GameState</code>, <code>put</code> would be easier:</p>\n\n<pre class=\"lang-hs prettyprint-override\"><code>putNewGameState :: GameState -&gt; State GameState ()\nputNewGameState gs = put gs\n\n-- the above is the same as:\n-- putNewGameState = put\n\n-- you can also do it using \u2018modify\u2019, but it\u2019s a bit harder and less elegant:\nputNewGameState2 :: GameState -&gt; State GameState ()\nputNewGameState2 gs = put (\\_oldState -&gt; gs)\n</code></pre>\n"}], "owner": {"reputation": 79, "user_id": 9306908, "user_type": "registered", "profile_image": "https://lh3.googleusercontent.com/-0PUuILofnc0/AAAAAAAAAAI/AAAAAAAAAFc/gnH2Rqv_y7Y/photo.jpg?sz=128", "display_name": "all", "link": "https://stackoverflow.com/users/9306908/all"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 63, "favorite_count": 0, "accepted_answer_id": 57194612, "answer_count": 1, "score": 1, "last_activity_date": 1564030740, "creation_date": 1564029217, "question_id": 57194376, "link": "https://stackoverflow.com/questions/57194376/getting-gamestate-value-in-state-monad", "title": "Getting Gamestate value in State Monad", "body": "<p>I'm learning about state monads and i'm a little confused.</p>\n\n<p>I have a data type</p>\n\n<pre><code>data GameState = GameState (Map String Double) Double Bool\nderiving (Eq, Show)\n</code></pre>\n\n<p>The second argument Double is a direction</p>\n\n<p>and of course the state monad definition</p>\n\n<pre><code>newtype State s a = StateOf (s -&gt; (s, a))\ndeState (StateOf stf) = stf\nget = StateOf (\\s0 -&gt; (s0, s0))\nput s = StateOf (\\s0 -&gt; (s , ()))\nmodify f = get &gt;&gt;= \\s -&gt; put (f s)\n</code></pre>\n\n<p>So how do I write a function to get the direction</p>\n\n<pre><code>getDirection:: State GameState Double\n</code></pre>\n\n<p>I've tried</p>\n\n<pre><code>getDirection = do\n     x &lt;- get\n     return x\n</code></pre>\n\n<p>But this will just return GameState, how do I get what the direction currently is?</p>\n\n<p>And when I want to change the direction do I use put or modify?</p>\n"}]