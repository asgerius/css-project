[{"tags": ["list", "function", "haskell"], "comments": [{"owner": {"reputation": 11366, "user_id": 3922954, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/76ba47d2fdd24ab56b0b273cce2075e5?s=128&d=identicon&r=PG&f=1", "display_name": "AJF", "link": "https://stackoverflow.com/users/3922954/ajf"}, "edited": false, "score": 1, "creation_date": 1485362167, "post_id": 41855564, "comment_id": 70897401, "body": "It is worth mentioning that SO is not a write-my-code website. It is expected that you at least present your solution so far, even if incomplete."}], "answers": [{"comments": [{"owner": {"reputation": 100185, "user_id": 3234959, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/93bb12ca0f93dfddb33880316f7e66c2?s=128&d=identicon&r=PG&f=1", "display_name": "chi", "link": "https://stackoverflow.com/users/3234959/chi"}, "edited": false, "score": 1, "creation_date": 1485359651, "post_id": 41855869, "comment_id": 70895640, "body": "The first example does not work. The second binding for <code>y</code> will shadow the first, as if it were <code>[(x,z) | (,x_) &lt;- a , (y,z) &lt;- b]</code>"}, {"owner": {"reputation": 7953, "user_id": 812149, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/6lIqv.png?s=128&g=1", "display_name": "S.L. Barth", "link": "https://stackoverflow.com/users/812149/s-l-barth"}, "reply_to_user": {"reputation": 100185, "user_id": 3234959, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/93bb12ca0f93dfddb33880316f7e66c2?s=128&d=identicon&r=PG&f=1", "display_name": "chi", "link": "https://stackoverflow.com/users/3234959/chi"}, "edited": false, "score": 0, "creation_date": 1485360129, "post_id": 41855869, "comment_id": 70895976, "body": "@chi Looks like you&#39;re right :-(  It worked for the first two cases, but doesn&#39;t actually unify on <code>y</code>. I&#39;ll have to update the answer."}, {"owner": {"reputation": 19, "user_id": 3892813, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/ffe39aa9cddbd9d05ebe8601d47edb07?s=128&d=identicon&r=PG&f=1", "display_name": "Pavels", "link": "https://stackoverflow.com/users/3892813/pavels"}, "edited": false, "score": 0, "creation_date": 1485366984, "post_id": 41855869, "comment_id": 70900606, "body": "Thanks, I&#39;ve learned a lot from your post. Glad you could help!"}, {"owner": {"reputation": 126897, "user_id": 791604, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/ce991df7a056248d5e4f6fc3659ba733?s=128&d=identicon&r=PG", "display_name": "Daniel Wagner", "link": "https://stackoverflow.com/users/791604/daniel-wagner"}, "edited": false, "score": 0, "creation_date": 1485374841, "post_id": 41855869, "comment_id": 70905114, "body": "You can&#39;t give <code>composite</code> the more general type you claim: you need at least an <code>Eq</code> constraint. So it has to be more specific in that sense. But it can also be less specific in another sense, since there&#39;s no reason to require that all the parts of the tuple be the same type. So a better type would be <code>composite :: Eq b =&gt; [(a, b)] -&gt; [(b, c)] -&gt; [(a, c)]</code>. This is also the type that will be inferred for you if you don&#39;t give a type signature at all."}], "tags": [], "owner": {"reputation": 7953, "user_id": 812149, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/6lIqv.png?s=128&g=1", "display_name": "S.L. Barth", "link": "https://stackoverflow.com/users/812149/s-l-barth"}, "is_accepted": true, "score": 4, "last_activity_date": 1485415598, "last_edit_date": 1485415598, "creation_date": 1485359317, "answer_id": 41855869, "question_id": 41855564, "link": "https://stackoverflow.com/questions/41855564/how-can-i-combine-two-lists-by-comparing-elements-in-this-way/41855869#41855869", "title": "How can I combine two lists by comparing elements in this way?", "body": "<p>You can combine the lists using a list comprehension over multiple lists:</p>\n\n<pre><code>[(x,z)|(x,y) &lt;- a, (y',z) &lt;- b, y == y' ]\n</code></pre>\n\n<p>Note that the result is the list if <code>(x,z)</code> tuples, and the inputs are the lists of <code>(x,y)</code> and <code>(y,z)</code> tuples.</p>\n\n<p>I have tried this in <a href=\"http://tryhaskell.org\" rel=\"nofollow noreferrer\">http://tryhaskell.org</a> with your list test case; feel free to copy-paste it there and play around with it:</p>\n\n<pre><code>[(x,z) | (x,y) &lt;-[('a', 'b'), ('a', 'd'), ('a', 'e')],(y',z) &lt;- [('b','c'), ('d','c')], y == y']\n</code></pre>\n\n<p>This yields:</p>\n\n<blockquote>\n  <p>[('a','c'),('a','c')]</p>\n</blockquote>\n\n<p>There are a few other things to note.</p>\n\n<p>First, the <code>y == y'</code>. As @chi points out, if you use 'y' again in the list comprehension, the system does not consider it the same variable. You need to use a new variable, <code>y'</code> (or any other name) and explicitly tell Haskell that <code>y</code> and <code>y'</code> should have the same value.  </p>\n\n<p>Second, we're not using capitals; Haskell is case-sensitive and uses capitals for other purposes.  </p>\n\n<p>Third, you don't have to make it only for Strings. The function can operate on tuples of arbitrary types:</p>\n\n<pre><code>composite :: [(a,a)] -&gt; [(a,a)] -&gt; [(a,a)]  \n</code></pre>\n\n<p>As @Daniel Wagner observes in the comments, it's actually a little more complicated:</p>\n\n<pre><code>composite :: (Eq a) =&gt; [(a,a)] -&gt; [(a,a)] -&gt; [(a,a)] \n</code></pre>\n\n<p>The <code>Eq a</code> tells Haskell that <code>a</code> is something that you can compare for equality. Formally, <code>a</code> is a member of the <code>Eq</code> type class.\nHe also observes that we can generalize this further: the lefthand side of the tuples in list A don't have to be of the same type as the righthand side of the tuples in list B. So you could have, for example, a list of <code>(Int,String)</code> and a list of <code>(String,Char)</code>, and match them on the String. The type would become:</p>\n\n<pre><code>composite :: Eq b =&gt; [(a, b)] -&gt; [(b, c)] -&gt; [(a, c)]\n</code></pre>\n\n<p>A final thing to note is that there may be duplicates in your resulting list. This is the case in your third test case.  </p>\n\n<p>The exercise probably doesn't require you to remove the duplicates.. yet.<br>\nHaskells libraries provide tools to remove duplicates. In a production setting, you should use these tools. But when learning, writing your own code to remove duplicates may be a useful exercise.</p>\n\n<p>I've also got it in <a href=\"http://ideone.com/w8buTb\" rel=\"nofollow noreferrer\">ideone.org</a>. Don't worry about the \"main\" and \"print\" over there for now; just experiment with the function and see if you understand it.</p>\n"}, {"comments": [{"owner": {"reputation": 7953, "user_id": 812149, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/6lIqv.png?s=128&g=1", "display_name": "S.L. Barth", "link": "https://stackoverflow.com/users/812149/s-l-barth"}, "edited": false, "score": 0, "creation_date": 1485361160, "post_id": 41856461, "comment_id": 70896706, "body": "Ah yes, <code>Eq</code>. Good for you to think of that. Voting up."}], "tags": [], "owner": {"reputation": 399, "user_id": 964015, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/57b3afdd566b092e68363ec93cf09d96?s=128&d=identicon&r=PG", "display_name": "f4st", "link": "https://stackoverflow.com/users/964015/f4st"}, "is_accepted": false, "score": 3, "last_activity_date": 1485360937, "last_edit_date": 1495535366, "creation_date": 1485360937, "answer_id": 41856461, "question_id": 41855564, "link": "https://stackoverflow.com/questions/41855564/how-can-i-combine-two-lists-by-comparing-elements-in-this-way/41856461#41856461", "title": "How can I combine two lists by comparing elements in this way?", "body": "<p><a href=\"https://stackoverflow.com/users/812149/s-l-barth\">S.L. Barth</a> is on the right track, but isn't quite there. What you need to do is to go through the cartesian product of both lists, compare the <code>y</code> parts and if they match, then you can emit a tuple on the output.</p>\n\n<p>This can easily be done with a <a href=\"https://wiki.haskell.org/List_comprehension\" rel=\"nofollow noreferrer\">list comprehension</a>, such as this one:</p>\n\n<pre><code>[(x, z) | (x, y1) &lt;- a, (y2, z) &lt;- b, y1 == y2]\n</code></pre>\n\n<p>You should be able to wrap this in a function.</p>\n\n<p>Note that if you want the function to be polymorphic, the type of it needs an <code>Eq y</code> constraint so that you can actually compare the <code>y</code> parts:</p>\n\n<pre><code>composite :: Eq y =&gt; [(x, y)] -&gt; [(y, z)] -&gt; [(x, z)]\n</code></pre>\n"}], "owner": {"reputation": 19, "user_id": 3892813, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/ffe39aa9cddbd9d05ebe8601d47edb07?s=128&d=identicon&r=PG&f=1", "display_name": "Pavels", "link": "https://stackoverflow.com/users/3892813/pavels"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 136, "favorite_count": 1, "accepted_answer_id": 41855869, "answer_count": 2, "score": -2, "last_activity_date": 1485415598, "creation_date": 1485358534, "last_edit_date": 1485367130, "question_id": 41855564, "link": "https://stackoverflow.com/questions/41855564/how-can-i-combine-two-lists-by-comparing-elements-in-this-way", "title": "How can I combine two lists by comparing elements in this way?", "body": "<p>I'm just starting to learn Haskell, and I have to create a function <code>composite</code> that receives two lists <code>a, b :: [(String, String)]</code> as inputs, and outputs a new list <code>c :: [(String, String)]</code>, which is a 'composition' of both <code>a</code> and <code>b</code>. Specifically, list <code>c</code> has to include only those pairs <code>(p,q)</code>, where there is a <code>r</code> such that:</p>\n\n<ul>\n<li><code>(p,r)</code> is in <code>a</code></li>\n<li><code>(r,q)</code> in in <code>b</code></li>\n</ul>\n\n<p>For example:</p>\n\n<ul>\n<li><code>composite [(\"1\",\"2\")] [(\"2\",\"3\"), (\"2\",\"4\")] == [(\"1\",\"3\"), (\"1\",\"4\")]</code></li>\n<li><code>composite [(\"1\",\"2\"), (\"5\",\"2\")] [(\"2\",\"3\"), (\"2\",\"4\")] == [(\"1\",\"3\"), (\"1\",\"4\"), (\"5\",\"3\"), (\"5\",\"4\")]</code></li>\n<li><code>composite [(\"1\",\"2\"), (\"1\",\"4\"), (\"1\",\"5\")] [(\"2\",\"3\"), (\"4\",\"3\")] == [(\"1\",\"3\")]</code></li>\n</ul>\n\n<p>How can I do this?</p>\n"}, {"tags": ["haskell", "parallel-processing"], "answers": [{"comments": [{"owner": {"reputation": 49, "user_id": 6790573, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/8e2c1bc451bf0a06a5efca18111a4ba6?s=128&d=identicon&r=PG&f=1", "display_name": "McGill", "link": "https://stackoverflow.com/users/6790573/mcgill"}, "edited": false, "score": 0, "creation_date": 1485410650, "post_id": 41855707, "comment_id": 70917641, "body": "So your answer would mean that my understanding of strategy composition was incorrect (i.e rparWith rdeepseq == rpar . rseq . force is basically incorrect)?  BTW thanks for the answer."}, {"owner": {"reputation": 94713, "user_id": 1139697, "user_type": "registered", "accept_rate": 86, "profile_image": "https://www.gravatar.com/avatar/5f136ddb684f39aaee1c028ee1950f6f?s=128&d=identicon&r=PG", "display_name": "Zeta", "link": "https://stackoverflow.com/users/1139697/zeta"}, "reply_to_user": {"reputation": 49, "user_id": 6790573, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/8e2c1bc451bf0a06a5efca18111a4ba6?s=128&d=identicon&r=PG&f=1", "display_name": "McGill", "link": "https://stackoverflow.com/users/6790573/mcgill"}, "edited": false, "score": 1, "creation_date": 1485417195, "post_id": 41855707, "comment_id": 70919797, "body": "@McGill: no, that&#39;s completely fine (well, except for the missing <code>dot</code>, since you cannot compose strategies with <code>(.)</code>) But <code>(.) f g x</code> is <code>f (g x)</code>, so <code>(rpar . rseq. force) x</code> is <code>rpar (rseq (force x))</code>. In other programming languages, we would have to evaluate <code>force x</code> to use <code>rseq</code>. But since Haskell isn&#39;t strict, we don&#39;t actually evaluate the arguments in <code>rpar &lt;something&gt;</code>. Instead, we hand <code>&lt;something&gt;</code> over to <code>rpar</code>, which <i>then</i> sparks <code>&lt;something&gt;</code> for evaluation in parallel."}], "tags": [], "owner": {"reputation": 94713, "user_id": 1139697, "user_type": "registered", "accept_rate": 86, "profile_image": "https://www.gravatar.com/avatar/5f136ddb684f39aaee1c028ee1950f6f?s=128&d=identicon&r=PG", "display_name": "Zeta", "link": "https://stackoverflow.com/users/1139697/zeta"}, "is_accepted": true, "score": 4, "last_activity_date": 1485358906, "creation_date": 1485358906, "answer_id": 41855707, "question_id": 41854791, "link": "https://stackoverflow.com/questions/41854791/why-will-the-following-run-in-parallel-rather-than-sequentially/41855707#41855707", "title": "Why will the following run in parallel rather than sequentially?", "body": "<p>Let's have a look at <code>parPair rdeepseq rdeepseq</code>:</p>\n\n<pre><code>parPair rdeepseq rdeepseq (a,b)\n = evalPair (rparWith rdeepseq) (rparWith rdeepseq) (a,b)\n = do\n    a' &lt;- rparWith rdeepseq a\n    b' &lt;- rparWith rdeepseq b\n    return (a', b')\n</code></pre>\n\n<p>Since <code>rparWith</code> sparks it arguments, <code>rdeepseq a</code> will be evaluated in parallel (possibly). It wouldn't be in parallel, if you were to use</p>\n\n<pre><code>evalPair rdeepseq rdeepseq\n</code></pre>\n\n<p>instead. The <code>rparWith</code> is essential, as it sparks its argument for evaluation with the given strategy.</p>\n"}], "owner": {"reputation": 49, "user_id": 6790573, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/8e2c1bc451bf0a06a5efca18111a4ba6?s=128&d=identicon&r=PG&f=1", "display_name": "McGill", "link": "https://stackoverflow.com/users/6790573/mcgill"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 238, "favorite_count": 1, "accepted_answer_id": 41855707, "answer_count": 1, "score": 2, "last_activity_date": 1485358906, "creation_date": 1485356397, "last_edit_date": 1485358514, "question_id": 41854791, "link": "https://stackoverflow.com/questions/41854791/why-will-the-following-run-in-parallel-rather-than-sequentially", "title": "Why will the following run in parallel rather than sequentially?", "body": "<p>Given the following functions for <code>evalPair</code>, <code>parPair</code> and <code>deepSeq</code> respectively,</p>\n\n<pre><code>evalPair :: Strategy a -&gt; Strategy b -&gt; Strategy (a,b)\nevalPair sa sb (a,b) = do\n      a' &lt;- sa a\n      b' &lt;- sb b\n      return (a',b')\n\nparPair :: Strategy a -&gt; Strategy b -&gt; Strategy (a,b)\nparPair sa sb = evalPair (rparWith sa) (rparWith sb)\n\nrdeepseq :: NFData a =&gt; Strategy a\nrdeepseq x = rseq (force x)\n</code></pre>\n\n<p>The question is why will the following code be evaluated in parallel as the author claims?</p>\n\n<pre><code>parPair rdeepseq rdeepseq :: (NFData a, NFData b) =&gt; Strategy (a,b)\n</code></pre>\n\n<p>I am in dount since Simon Marlow says the following</p>\n\n<blockquote>\n  <p>To break down what happens when this <code>Strategy</code> is applied to a pair:\n  <code>parPair</code> calls <code>evalPair</code>, and <code>evalPair</code> calls <code>rparWith rdeepseq</code> on each\n  component of the pair. So the effect is that each component will be\n  fully evaluated to normal form in parallel.</p>\n</blockquote>\n\n<p>According to what I see <code>rparWith rdeepseq</code> is informally <code>rpar . rseq . force</code> which means the argument will be evaluated to normal form, which it will be evaluated with <code>rseq</code> sequentially, and hence in the end the <code>rpar</code> is of no use in a parallel context.</p>\n\n<p>Everything is taken from Simon Marlow's book. </p>\n\n<hr>\n\n<p>Thanks in advance. </p>\n"}, {"tags": ["haskell", "recursion", "io"], "comments": [{"owner": {"reputation": 51584, "user_id": 839246, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/9b0573c2b936b12828dd1e4cc04206dc?s=128&d=identicon&r=PG&f=1", "display_name": "bheklilr", "link": "https://stackoverflow.com/users/839246/bheklilr"}, "edited": false, "score": 2, "creation_date": 1485356106, "post_id": 41854275, "comment_id": 70893033, "body": "You aren&#39;t using correct syntax, for starters.  FYI, in the future it&#39;d be better to include type signatures for what you think your functions should be, format your code correctly, and include compiler errors."}, {"owner": {"reputation": 51584, "user_id": 839246, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/9b0573c2b936b12828dd1e4cc04206dc?s=128&d=identicon&r=PG&f=1", "display_name": "bheklilr", "link": "https://stackoverflow.com/users/839246/bheklilr"}, "edited": false, "score": 0, "creation_date": 1485356143, "post_id": 41854275, "comment_id": 70893054, "body": "What do you think <code>putStrLn t &lt;- getLine</code> should be doing?  What does it mean to pass <code>n &lt;- readLn</code> as an argument to a function?"}, {"owner": {"reputation": 2231, "user_id": 1027321, "user_type": "registered", "accept_rate": 70, "profile_image": "https://i.stack.imgur.com/KkFZC.jpg?s=128&g=1", "display_name": "jakubdaniel", "link": "https://stackoverflow.com/users/1027321/jakubdaniel"}, "edited": false, "score": 0, "creation_date": 1485357073, "post_id": 41854275, "comment_id": 70893704, "body": "...and make sure that it is clear what was the expected behavior :)"}, {"owner": {"reputation": 384463, "user_id": 1126841, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/fa05233b2357f8d11c22ef4cfc7bb85c?s=128&d=identicon&r=PG", "display_name": "chepner", "link": "https://stackoverflow.com/users/1126841/chepner"}, "edited": false, "score": 1, "creation_date": 1485357280, "post_id": 41854275, "comment_id": 70893834, "body": "<code>&lt;-</code> is not an operator; it is part of the syntax of a <code>do</code> expression."}], "answers": [{"comments": [{"owner": {"reputation": 2231, "user_id": 1027321, "user_type": "registered", "accept_rate": 70, "profile_image": "https://i.stack.imgur.com/KkFZC.jpg?s=128&g=1", "display_name": "jakubdaniel", "link": "https://stackoverflow.com/users/1027321/jakubdaniel"}, "edited": false, "score": 2, "creation_date": 1485357282, "post_id": 41854782, "comment_id": 70893839, "body": "worth mentioning that <code>xMal</code> then is the same as the standard <code>replicate</code> function (from <code>Prelude</code>) in this context"}, {"owner": {"reputation": 314794, "user_id": 67579, "user_type": "registered", "accept_rate": 81, "profile_image": "https://i.stack.imgur.com/BJXub.png?s=128&g=1", "display_name": "Willem Van Onsem", "link": "https://stackoverflow.com/users/67579/willem-van-onsem"}, "reply_to_user": {"reputation": 2231, "user_id": 1027321, "user_type": "registered", "accept_rate": 70, "profile_image": "https://i.stack.imgur.com/KkFZC.jpg?s=128&g=1", "display_name": "jakubdaniel", "link": "https://stackoverflow.com/users/1027321/jakubdaniel"}, "edited": false, "score": 0, "creation_date": 1485357374, "post_id": 41854782, "comment_id": 70893919, "body": "@jd823592: yeah that was why I said &quot;replicates&quot;. But answer is updated."}], "tags": [], "owner": {"reputation": 314794, "user_id": 67579, "user_type": "registered", "accept_rate": 81, "profile_image": "https://i.stack.imgur.com/BJXub.png?s=128&g=1", "display_name": "Willem Van Onsem", "link": "https://stackoverflow.com/users/67579/willem-van-onsem"}, "is_accepted": true, "score": 5, "last_activity_date": 1485357356, "last_edit_date": 1485357356, "creation_date": 1485356379, "answer_id": 41854782, "question_id": 41854275, "link": "https://stackoverflow.com/questions/41854275/error-with-recursive-io/41854782#41854782", "title": "Error with recursive IO", "body": "<p>Haskell does not work that way, with your <code>&lt;-</code> expressions, you make monadic calls, these should be placed on the correct order. You probably want:</p>\n\n<pre><code>xMal 0 _ = []\nxMal n text = text : xMal (n-1) text\n\nmain = do\n    n &lt;- readLn\n    t &lt;- getLine\n    putStrLn $ show $ xMal n t\n</code></pre>\n\n<p>Here <code>xMal</code> is a pure function: <code>xMal :: (Eq a, Num a) =&gt; a -&gt; t -&gt; [t]</code> that replicates the given <code>t</code> object <code>a</code> times.</p>\n\n<p><code>main</code> is an <code>IO</code> monad that reads a line from stdin and parses it as an integer, next it reads a line as a string an finally it shows the replicated string. Something like:</p>\n\n<pre><code>*Main&gt; main\n15\nHello\n[\"Hello\",\"Hello\",\"Hello\",\"Hello\",\"Hello\",\"Hello\",\"Hello\",\"Hello\",\"Hello\",\"Hello\",\"Hello\",\"Hello\",\"Hello\",\"Hello\",\"Hello\"]\n</code></pre>\n\n<p>Mind however that your <code>xMal</code> already exists: <a href=\"http://hackage.haskell.org/packages/archive/base/latest/doc/html/Prelude.html#v:replicate\" rel=\"noreferrer\"><code>replicate :: Int -&gt; a -&gt; [a]</code></a> already does that.</p>\n"}, {"tags": [], "owner": {"reputation": 61419, "user_id": 849891, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/MbEO3.png?s=128&g=1", "display_name": "Will Ness", "link": "https://stackoverflow.com/users/849891/will-ness"}, "is_accepted": false, "score": 1, "last_activity_date": 1485380488, "creation_date": 1485380488, "answer_id": 41862149, "question_id": 41854275, "link": "https://stackoverflow.com/questions/41854275/error-with-recursive-io/41862149#41862149", "title": "Error with recursive IO", "body": "<p>The correct syntax is:</p>\n\n\n\n<pre class=\"lang-hs prettyprint-override\"><code>   xMal 0 _    = return ()\n   xMal n text = do                   -- or, indentation-proof:   \n                   text               --  do { text\n                   xMal (n-1) text    --     ; xMal (n-1) text }\n   main = do {\n               t &lt;- getLine\n             ; n &lt;- readLn\n             ; xMal n (putStrLn t) }\n</code></pre>\n\n<p>it is important to have the same indentation. Otherwise, <code>{ ; }</code> are used to delimit the statements in a whitespace-proof fashion. Then, broken indentation doesn't break the code. Still, it's good to line-up our code properly.</p>\n\n<p><code>putStrLn t :: IO ()</code> is an I/O action that prints its string argument <code>t</code> on a separate line. It also \"produces\" a value of type <code>()</code> for the next I/O action in chain to react upon; this can be only one value, written as <code>()</code> as well, thus denoting an unimportant, throw-away value, a value to be ignored. You could have written <code>_ &lt;- text</code> there in your <code>do</code> block as well. Writing just <code>text</code> has the same effect: the produced value is ignored.</p>\n\n<p>Trying it, in GHCi,</p>\n\n<pre class=\"lang-hs prettyprint-override\"><code>~&gt; main\nhello\n3\nhello\nhello\nhello\n</code></pre>\n"}], "owner": {"reputation": 97, "user_id": 6392671, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/e3aae406e02d04e57b6ba2f9d77ea18c?s=128&d=identicon&r=PG&f=1", "display_name": "Memo", "link": "https://stackoverflow.com/users/6392671/memo"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 104, "favorite_count": 0, "accepted_answer_id": 41854782, "answer_count": 2, "score": -1, "last_activity_date": 1485380488, "creation_date": 1485354996, "last_edit_date": 1485362444, "question_id": 41854275, "link": "https://stackoverflow.com/questions/41854275/error-with-recursive-io", "title": "Error with recursive IO", "body": "<p>Why doesn't this code work?</p>\n\n<pre><code>xMal 0 _ = return ()\nxMal n text =\n do\n  text\n    xMal (n-1) text\nmain = xMal (putStrLn t &lt;- getLine) (n &lt;- readLn)\n</code></pre>\n\n<p>I expect to be able to get a number and string as input.</p>\n"}, {"tags": ["multithreading", "haskell", "parallel-processing", "repa", "hmatrix"], "owner": {"reputation": 1004, "user_id": 3088265, "user_type": "registered", "accept_rate": 93, "profile_image": "https://www.gravatar.com/avatar/99c2e5db7086c4dc0a5bd9aada58f162?s=128&d=identicon&r=PG&f=1", "display_name": "Richard Vock", "link": "https://stackoverflow.com/users/3088265/richard-vock"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 128, "favorite_count": 0, "answer_count": 0, "score": 2, "last_activity_date": 1485354238, "creation_date": 1485354238, "question_id": 41854019, "link": "https://stackoverflow.com/questions/41854019/parallel-calls-to-hmatrix-or-ffi-in-general", "title": "Parallel calls to HMatrix (or FFI in general)", "body": "<p>I am working with point clouds in haskell using the repa library (3 as well as 4). At least I am trying to.</p>\n\n<p>There are a few operations I need to do massively where parallelism really helps a lot. Most of these are simple linear algebra operations on the (metric) neighborhood of a point. For example a principal component analysis where I need to compute a SVD on a small matrix where each row is a point.</p>\n\n<p>Now I use the <strong>linear</strong> package for the vector type</p>\n\n<pre><code>type Vec3 = V3 Float\n</code></pre>\n\n<p>and a 1-dimensional array of these vectors for point clouds</p>\n\n<pre><code>type Cloud = Array F DIM1 Vec3\n</code></pre>\n\n<p>So now I have the problem of calling a function using matrix decompositions of hmatrix in parallel using computeP. I tried hmatrix itself as well as the <strong>repa-linear-algebra</strong> package for that. The problem I have is that with all these calls (no matter how I provide the data and no matter what I call (svd, eigen decompositions, qr decomp. etc.)) the application always crashes randomly with a bus error or segfault.</p>\n\n<p>I also didn't find any way to get any stacktrace that would at least point me in the right direction. Stack traces usually end at pthread.</p>\n\n<p>Additionally I wrote my own C code which I call like e.g.:</p>\n\n<pre><code>foreign import ccall safe \"pca.hpp pca\"\n    c_pca :: CUInt -&gt; Ptr Float -&gt; Ptr Float -&gt; Ptr Float -&gt; IO ()\n\n{-# INLINE foreignPCA #-}\nforeignPCA :: forall r . (Source r Vec3) =&gt; Array r DIM1 Vec3 -&gt; ([Vec3], Vec3)\nforeignPCA !vs = unsafePerformIO $ do\n    n &lt;- return $ Arrays.length vs\n    ps &lt;- mallocForeignPtrArray n :: IO (ForeignPtr Vec3) -- point matrix\n    computeIntoS ps (delay vs)\n    as &lt;- mallocForeignPtrArray 3 :: IO (ForeignPtr Float) -- singular values\n    av &lt;- mallocForeignPtrArray 3 :: IO (ForeignPtr Vec3) -- right singular vectors\n    withForeignPtr (castForeignPtr ps) $ \\pps -&gt;\n        withForeignPtr as $ \\pas -&gt;\n            withForeignPtr (castForeignPtr av) $ \\pav -&gt; do\n                c_pca (fromIntegral n) pps pas pav\n                svalues &lt;- peekArray 3 pas :: IO [Float]\n                svecs &lt;- peekArray 3 (castPtr pav :: Ptr Vec3) :: IO [Vec3]\n                let [sx, sy, sz] = svalues in\n                    return (svecs, (V3 sx sy sz))\n</code></pre>\n\n<p>This works perfectly fine on a massive point cloud with 20 cores in parallel. Never crashed in any way.</p>\n\n<p>Now my very vague idea is that hmatrix calls C/Fortran code with \"safe\" thereby allowing pthread forks and without actually being thread-safe.\nI can't try to verify this assumption as debugging seems a foreign concept to the haskell tool chain (at least for a complete newbie that I am).</p>\n\n<p>In conclusion I have three questions:</p>\n\n<ul>\n<li>Is hmatrix known to have problems working in parallel</li>\n<li>Is there anyone working on native implementations of these fundamental algorithms?</li>\n<li>How do I prevent FFI wrapped code to spawn fork()'ed threads without having access to the import call?</li>\n<li>How do I debug things like hmatrix?</li>\n</ul>\n\n<p>The second one is of particular interest to me since I find hmatrix to be incredibly ugly (subhask looks very promising but is too incomplete to be feasible). My goal is to change to haskell, but if I have to use my own C++ code for any trivial matter like above, I can just keep coding in C++ as I do now...</p>\n"}, {"tags": ["haskell", "recursion"], "comments": [{"owner": {"reputation": 384463, "user_id": 1126841, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/fa05233b2357f8d11c22ef4cfc7bb85c?s=128&d=identicon&r=PG", "display_name": "chepner", "link": "https://stackoverflow.com/users/1126841/chepner"}, "edited": false, "score": 2, "creation_date": 1485354991, "post_id": 41854009, "comment_id": 70892243, "body": "Don&#39;t just link to the page; include whatever context you need (but no more!) to explain the problem in the question itself."}, {"owner": {"reputation": 81794, "user_id": 9859, "user_type": "registered", "accept_rate": 89, "profile_image": "https://i.stack.imgur.com/KEZOL.jpg?s=128&g=1", "display_name": "rampion", "link": "https://stackoverflow.com/users/9859/rampion"}, "edited": false, "score": 0, "creation_date": 1485362242, "post_id": 41854009, "comment_id": 70897450, "body": "<code>chop [1,0,0,0]</code> is for chopping off one 1st level head, which should result in <code>[0,0,0]</code> in the code as written."}], "answers": [{"tags": [], "owner": {"reputation": 1392, "user_id": 5198575, "user_type": "registered", "profile_image": "https://lh6.googleusercontent.com/-RAYCSjVZdnQ/AAAAAAAAAAI/AAAAAAAAClo/VQ8V_H3l8O8/photo.jpg?sz=128", "display_name": "trevor cook", "link": "https://stackoverflow.com/users/5198575/trevor-cook"}, "is_accepted": false, "score": 1, "last_activity_date": 1485375274, "creation_date": 1485375274, "answer_id": 41860848, "question_id": 41854009, "link": "https://stackoverflow.com/questions/41854009/chop-the-hydra-in-haskell/41860848#41860848", "title": "Chop the Hydra in Haskell", "body": "<p>I think you misunderstood the intended behavior. As rampion points out, \n<code>chop [1,0,0,0]</code> should result in <code>[0,0,0]</code>. I don't understand, where you get <code>[0,3,0,0]</code>, but I'll walk you through a little.</p>\n\n<p>First, the definition of <code>chop</code>, with some comments that allow me to refer to each part of the definition.</p>\n\n<pre><code>chop []       = []                               --chopNull\nchop (1:xs)   = xs                               --chopHead1\nchop (n:xs) = (replicate (n - 1) (n - 1)) ++ xs  --chopHeadN\n</code></pre>\n\n<p>You asked about <code>chop chop [1,0,0,0]</code>. This isn't valid code. I'll assume you meant <code>chop (chop [1,0,0,0])</code>. Taking this as the starting point, I'll perform a bit of equational reasoning. That is, I'll transform the program fragment in question by substituting the relevant part of the definition. Each line has a comment indicating how the current line was calculated from the previous one.</p>\n\n<pre><code>chop (chop [1,0,0,0]) \n   = chop (chop (1:0:0:0:[]) --De-sugaring of List\n   = chop (chop (1:xs))      --Let xs = 0:0:0:[] = [0,0,0]\n   = chop (xs)               --chopHead1\n   = chop (0:0:0:[])         --def of xs\n   = (replicate (0 - 1) (0 - 1)) ++ (0:0:[])  --chopHeadN\n   = [] ++ (0:0:[])          --From definition of replicate\n   = (0:0:[])                --From defintion of (++)\n   = [0,0]                   --re-sugaring\n</code></pre>\n\n<p>I do a few loose things above. Notably I equate <code>xs</code> to <code>(0:0:0:[])</code> in the comment. This is just to make it clear how that particular substitution is satisfied by the pattern match in the definition. Next, I used the <code>chopHeadN</code> definition to match the case where <code>n=0</code>, as it is the first thing that matches. You'll have to trust me on the definition of replicate and (++).</p>\n\n<p>So that is what that particular call should be doing. Generally however, if you don't know what a particular function does, it is a good idea to start with some simpler input. For lists, an empty list <code>[]</code> or singleton's, <code>[n]</code> are good starting points. Then move on to two element lists. Like in this example, you can cut out part of a definition and inspect what that part does on known data. Do it yourself in ghci. (Actually, that's what I did for the replicate (0-1) (0-1) expression. I thought it would be an error.)</p>\n"}], "owner": {"reputation": 1, "user_id": 4236777, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/dfbe00c3bf8f090370e333672349b8e2?s=128&d=identicon&r=PG&f=1", "display_name": "Aakanksha Ardhapurkar", "link": "https://stackoverflow.com/users/4236777/aakanksha-ardhapurkar"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 578, "favorite_count": 0, "closed_date": 1485388248, "answer_count": 1, "score": 0, "last_activity_date": 1485375274, "creation_date": 1485354208, "question_id": 41854009, "link": "https://stackoverflow.com/questions/41854009/chop-the-hydra-in-haskell", "closed_reason": "Not suitable for this site", "title": "Chop the Hydra in Haskell", "body": "<p>I was working on a version of the problem that's here :  <a href=\"http://blog.gja.in/2014/01/functional-programming-101-with-haskell.html#.WIi0J7YrKHo\" rel=\"nofollow noreferrer\">http://blog.gja.in/2014/01/functional-programming-101-with-haskell.html#.WIi0J7YrKHo</a></p>\n\n<p>However if I were to give in an input of  chop chop [1,0,0,0], it should return [0,3,0,0]. I tried playing around with the code that was given on the above website however I can't seem to be figuring it out. I've also only started learning Haskell 3-4 days ago so I'm not sure what the right direction is to go on.</p>\n\n<p>Thank you in advance!</p>\n"}, {"tags": ["haskell", "types", "typeclass", "generic-type-argument"], "answers": [{"tags": [], "owner": {"reputation": 23816, "user_id": 572606, "user_type": "registered", "accept_rate": 81, "profile_image": "https://www.gravatar.com/avatar/c20a126ad0dce40e8fc4a43456107919?s=128&d=identicon&r=PG", "display_name": "shang", "link": "https://stackoverflow.com/users/572606/shang"}, "is_accepted": true, "score": 4, "last_activity_date": 1485353333, "creation_date": 1485353333, "answer_id": 41853726, "question_id": 41853468, "link": "https://stackoverflow.com/questions/41853468/haskell-type-classes-in-type-alias-declaration/41853726#41853726", "title": "Haskell Type Classes in Type Alias declaration", "body": "<p>You need to include the generic state as a type parameter.</p>\n\n<pre><code>type Expand s = s -&gt; s\ntype Eval s   = s -&gt; Float\ntype Tree s   = [s]\n</code></pre>\n\n<p>It's impossible to completely hide it, because e.g. <code>Expand</code> for an <code>(Int, Int)</code> state is a completely different type than for a <code>String</code> state.</p>\n\n<p>As for the <code>Eq</code> constraint. Typically, you would include that locally only in the specific function that requires the constraint.</p>\n"}], "owner": {"reputation": 265, "user_id": 7430178, "user_type": "registered", "accept_rate": 75, "profile_image": "https://i.stack.imgur.com/phrjq.jpg?s=128&g=1", "display_name": "Diego Vicente", "link": "https://stackoverflow.com/users/7430178/diego-vicente"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 707, "favorite_count": 0, "accepted_answer_id": 41853726, "answer_count": 1, "score": 2, "last_activity_date": 1485353333, "creation_date": 1485352602, "question_id": 41853468, "link": "https://stackoverflow.com/questions/41853468/haskell-type-classes-in-type-alias-declaration", "title": "Haskell Type Classes in Type Alias declaration", "body": "<p>I am trying to develop a module that performs different algorithms over a set of states by receiving the functions to manage them as paremeters. I was defining different type aliases to make it easier to implement; a simple example to understand this would be:</p>\n\n<pre><code>-- Function that expands a state\ntype Expand = State -&gt; State\n-- Function that evaluates a state\ntype Eval = State -&gt; Float\n-- Group of states\ntype Tree = [State]\n</code></pre>\n\n<p>And then I realized that I wanted <code>State</code> to be the alias of a type that is equatable: I really don't care if the user's states are <code>(Int, Int)</code>, <code>Float</code>, or <code>String</code> as long as it's possible for him to implement the <code>Expand</code> and <code>Eval</code> functions and for me to compare two different states.</p>\n\n<p>How can I generalize the type <code>State</code> to achieve this? The intuitive thing that comes to my mind is something like <code>type State = (Eq a) =&gt; a</code> but that is obviously not possible without an <code>a</code> in scope. Is there an easy way for me to declare functions that treat <code>State</code> as a black box?</p>\n"}, {"tags": ["haskell", "vector", "repa"], "comments": [{"owner": {"reputation": 8621, "user_id": 1848029, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/qfjAy.jpg?s=128&g=1", "display_name": "lehins", "link": "https://stackoverflow.com/users/1848029/lehins"}, "edited": false, "score": 0, "creation_date": 1485350594, "post_id": 41852460, "comment_id": 70889072, "body": "Repa uses Unboxed(<code>U</code>) or Storable(<code>F</code>) Vector for all dimensions under the hood, not just <code>DIM1</code>. So, I&#39;d say, if you don&#39;t need to process those <code>DIM1</code> arrays in parallel, you are better of using <code>vector</code> package directly."}, {"owner": {"reputation": 850, "user_id": 3560671, "user_type": "registered", "accept_rate": 97, "profile_image": "https://graph.facebook.com/1078263042/picture?type=large", "display_name": "Thomas Vanhelden", "link": "https://stackoverflow.com/users/3560671/thomas-vanhelden"}, "reply_to_user": {"reputation": 8621, "user_id": 1848029, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/qfjAy.jpg?s=128&g=1", "display_name": "lehins", "link": "https://stackoverflow.com/users/1848029/lehins"}, "edited": false, "score": 0, "creation_date": 1485363399, "post_id": 41852460, "comment_id": 70898296, "body": "Yes, you&#39;re right. Every N-dimensional Array is a Vector under the hood. Its only the shape that changes."}], "answers": [{"tags": [], "owner": {"reputation": 850, "user_id": 3560671, "user_type": "registered", "accept_rate": 97, "profile_image": "https://graph.facebook.com/1078263042/picture?type=large", "display_name": "Thomas Vanhelden", "link": "https://stackoverflow.com/users/3560671/thomas-vanhelden"}, "is_accepted": true, "score": 2, "last_activity_date": 1485427988, "creation_date": 1485427988, "answer_id": 41871888, "question_id": 41852460, "link": "https://stackoverflow.com/questions/41852460/performance-of-dim1-repa-array-vs-vector/41871888#41871888", "title": "Performance of DIM1 Repa Array vs Vector", "body": "<p>I've implemented some parts of my program with <code>Data.Vector.Unboxed</code> instead of using one-dimensional <code>Data.Array.Repa</code>. Except for some minor improvements, the algorithms are the same. <code>Data.Vector.Unboxed</code> seems to be 4 times faster than one-dimensional <code>Data.Array.Repa</code> for sequential operations. </p>\n"}], "owner": {"reputation": 850, "user_id": 3560671, "user_type": "registered", "accept_rate": 97, "profile_image": "https://graph.facebook.com/1078263042/picture?type=large", "display_name": "Thomas Vanhelden", "link": "https://stackoverflow.com/users/3560671/thomas-vanhelden"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 307, "favorite_count": 1, "accepted_answer_id": 41871888, "answer_count": 1, "score": 2, "last_activity_date": 1485427988, "creation_date": 1485349729, "question_id": 41852460, "link": "https://stackoverflow.com/questions/41852460/performance-of-dim1-repa-array-vs-vector", "title": "Performance of DIM1 Repa Array vs Vector", "body": "<p>I've written a program to process a large amount of data samples using <a href=\"https://hackage.haskell.org/package/repa-3.4.1.2/docs/Data-Array-Repa.html\" rel=\"nofollow noreferrer\">Repa</a>. Performance is key for this program. A large part of the operations require parallel maps/folds over a multi-dimensional arrays and <code>Repa</code> is perfect for this. However, there is still a part of my program that only uses one-dimensional arrays and doesn't require parallelism (i.e. overhead of parallelism would harm performance). Some of these operations require functions like <code>take</code> or <code>fold</code>s with custom accumulators, which <code>Repa</code> doesn't support. So I'm writing these operations myself by iterating over the <code>Repa</code> array. </p>\n\n<p>Am I better off re-writing these operations by using <a href=\"https://hackage.haskell.org/package/vector-0.12.0.0/docs/Data-Vector-Unboxed.html\" rel=\"nofollow noreferrer\">Vector</a> instead of <code>Repa</code>? Would they result in better performance? </p>\n\n<p>I've read somewhere that one-dimensional <code>Repa</code> arrays are implemented as <code>Vector</code>s 'under the hood' so I doubt that <code>Vector</code>s result in better performance. On the other hand, <code>Vector</code> does have some nice built-in functions that I could use instead of writing them myself.  </p>\n"}, {"tags": ["haskell", "yesod", "persistent"], "answers": [{"comments": [{"owner": {"reputation": 375, "user_id": 3335163, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/da7c16ceedcdd8d1a01eee6b5b3de944?s=128&d=identicon&r=PG&f=1", "display_name": "Grisha", "link": "https://stackoverflow.com/users/3335163/grisha"}, "edited": false, "score": 2, "creation_date": 1485349033, "post_id": 41852202, "comment_id": 70888007, "body": "Answer copied from a email sent by Michael Snoyman with his permission"}], "tags": [], "owner": {"reputation": 375, "user_id": 3335163, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/da7c16ceedcdd8d1a01eee6b5b3de944?s=128&d=identicon&r=PG&f=1", "display_name": "Grisha", "link": "https://stackoverflow.com/users/3335163/grisha"}, "is_accepted": false, "score": 1, "last_activity_date": 1485348992, "creation_date": 1485348992, "answer_id": 41852202, "question_id": 41852201, "link": "https://stackoverflow.com/questions/41852201/type-families-in-persistent-library/41852202#41852202", "title": "Type families in Persistent library", "body": "<p>Alright, to simplify just a bit first, let's pretend it said:</p>\n\n<pre><code>newtype KeyPerson = PersonKey (BackendKey SqlBackend)\n</code></pre>\n\n<p>In this case, <code>KeyPerson</code> would be the \"type constructor\", and <code>PersonKey</code> would be the \"data constructor.\" We would be creating both of them here. The <code>PersonKey</code> data constructor would hold a value of type <code>BackendKey SqlBackend</code>, which would need to exist elsewhere and be referenced from here.</p>\n\n<p>In this case, we're usually associated types (aka type families), which makes things <em>slightly</em> more complicated: <code>newtype Key Person</code> means \"we're defining an associated <code>Key</code> for the <code>Person</code> type. But we're still creating a <code>PersonKey</code> data constructor just as before.</p>\n"}], "owner": {"reputation": 375, "user_id": 3335163, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/da7c16ceedcdd8d1a01eee6b5b3de944?s=128&d=identicon&r=PG&f=1", "display_name": "Grisha", "link": "https://stackoverflow.com/users/3335163/grisha"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 37, "favorite_count": 0, "answer_count": 1, "score": 1, "last_activity_date": 1485348992, "creation_date": 1485348992, "question_id": 41852201, "link": "https://stackoverflow.com/questions/41852201/type-families-in-persistent-library", "title": "Type families in Persistent library", "body": "<p>When explaining the template expansion in the chapter on Persistent, the Yesod book has something looking like</p>\n\n<pre><code>newtype Key Person = PersonKey (BackendKey SqlBackend)\n</code></pre>\n\n<p>I'm not quite sure how to read this newtype declaration: is\n<code>PersonKey a</code> something already defined somewhere else (couldn't\nfind its definition though) or is <code>PersonKey</code> just an ordinary\ntype or value constructor like <code>Just</code>/<code>Nothing</code>/<code>Left</code>/etc. ?</p>\n"}, {"tags": ["haskell", "vector"], "answers": [{"comments": [{"owner": {"reputation": 81794, "user_id": 9859, "user_type": "registered", "accept_rate": 89, "profile_image": "https://i.stack.imgur.com/KEZOL.jpg?s=128&g=1", "display_name": "rampion", "link": "https://stackoverflow.com/users/9859/rampion"}, "edited": false, "score": 2, "creation_date": 1485347944, "post_id": 41849084, "comment_id": 70887314, "body": "You can use <a href=\"https://hackage.haskell.org/package/vector-0.12.0.0/docs/Data-Vector.html#g:10\" rel=\"nofollow noreferrer\"><code>Data.Vector.unfold :: (b -&gt; Maybe (a, b)) -&gt; b -&gt; Vector a </code></a> to implement this directly - <code>V.unfold (\\bs -&gt; let (fs, bs&#39;) = BS.splitAt 3 bs in if BS.length fs &#47;= 3 then Nothing else Just (myToFloat fs, bs&#39;))</code>"}, {"owner": {"reputation": 2831, "user_id": 183792, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/9ddcfbc6c31012fd25384f6301363347?s=128&d=identicon&r=PG&f=1", "display_name": "Michael", "link": "https://stackoverflow.com/users/183792/michael"}, "reply_to_user": {"reputation": 81794, "user_id": 9859, "user_type": "registered", "accept_rate": 89, "profile_image": "https://i.stack.imgur.com/KEZOL.jpg?s=128&g=1", "display_name": "rampion", "link": "https://stackoverflow.com/users/9859/rampion"}, "edited": false, "score": 1, "creation_date": 1485349731, "post_id": 41849084, "comment_id": 70888431, "body": "It might be worth adding to @rampion &#39;s remark that <code>unfold</code> is an especially good way to construct a <code>Data.Vector.Unboxed.Vector</code> as it will fuse with any suitable consumer. It corresponds closely to the underlying <code>Stream</code> type. Whether this matters depends on what you are going to do with the vector once you get it."}, {"owner": {"reputation": 303, "user_id": 4173209, "user_type": "registered", "accept_rate": 89, "profile_image": "https://www.gravatar.com/avatar/caf52eb0e43490cabe3bb0cc1f850dfc?s=128&d=identicon&r=PG&f=1", "display_name": "Valerie94", "link": "https://stackoverflow.com/users/4173209/valerie94"}, "edited": false, "score": 0, "creation_date": 1485349988, "post_id": 41849084, "comment_id": 70888647, "body": "That looks terribly expensive. Splitting might be O(1), but having to split n/3 times still results in O(n) for splitting, O(n) for unpacking and O(n) for <code>fromList</code>. I&#39;ll give it a try though."}, {"owner": {"reputation": 75362, "user_id": 625403, "user_type": "registered", "accept_rate": 82, "profile_image": "https://www.gravatar.com/avatar/786eed7da67079cb5d63a49d469af25b?s=128&d=identicon&r=PG", "display_name": "amalloy", "link": "https://stackoverflow.com/users/625403/amalloy"}, "edited": false, "score": 2, "creation_date": 1485350193, "post_id": 41849084, "comment_id": 70888787, "body": "I mean, you have to do O(n) work because there are O(n) floats to produce. The important thing is that a single split is not O(n), so you end up with the optimal O(n) rather than O(n^2) or something. Agreed using unfold looks pretty clean too, and probably has a better constant factor."}, {"owner": {"reputation": 2831, "user_id": 183792, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/9ddcfbc6c31012fd25384f6301363347?s=128&d=identicon&r=PG&f=1", "display_name": "Michael", "link": "https://stackoverflow.com/users/183792/michael"}, "edited": false, "score": 1, "creation_date": 1485350690, "post_id": 41849084, "comment_id": 70889131, "body": "you might want to rewrite <code>toFloat</code> so that it doesn&#39;t take a list, but a short bytestring. A more black magic approach might be to reread the bytestring as a storable vector and then invent a Storable type with <code>sizeOf _ = 3</code> or something like that, than translate that into Float. The conversion from <code>ByteString</code> to <code>Storable.Vector Word8</code> and then to <code>Storable.Vector MyThreeWord8LongThing</code> would then basically be free. Then you&#39;d <code>map toFloat</code>, but <code>toFloat :: MyThreeWord8LongThing -&gt; Float</code> would be completely different of course. I would do nothing but make mistakes if I tried that ..."}], "tags": [], "owner": {"reputation": 75362, "user_id": 625403, "user_type": "registered", "accept_rate": 82, "profile_image": "https://www.gravatar.com/avatar/786eed7da67079cb5d63a49d469af25b?s=128&d=identicon&r=PG", "display_name": "amalloy", "link": "https://stackoverflow.com/users/625403/amalloy"}, "is_accepted": false, "score": 2, "last_activity_date": 1485339908, "creation_date": 1485339908, "answer_id": 41849084, "question_id": 41847758, "link": "https://stackoverflow.com/questions/41847758/bytestring-to-vector-conversion/41849084#41849084", "title": "ByteString to Vector conversion", "body": "<p>Try using</p>\n\n<pre><code>splitAt :: Int -&gt; ByteString -&gt; (ByteString, ByteString)\n</code></pre>\n\n<p>to split the ByteString into two: one of exactly 3 characters, and another containing the rest of the input. You can use this to implement a recursive function that will give you all the groups of length 3 (similar to <code>Data.List.Split.chunksOf</code>), and then you can use <code>unpack</code> on each to get the <code>[Word8]</code> you need. Pass that through your <code>toFloat</code> function, and convert to a vector with <code>Vector.fromList</code>.</p>\n\n<p>There are a number of steps there that seem like perhaps they could be expensive, but I think probably the compiler is smart enough to fuse some of them, like the unpack/fromList pair. And splitting a ByteString is O(1), so that part's not as expensive as it looks either. Seems like this ought to be as suitable an approach as any.</p>\n"}, {"comments": [{"owner": {"reputation": 2831, "user_id": 183792, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/9ddcfbc6c31012fd25384f6301363347?s=128&d=identicon&r=PG&f=1", "display_name": "Michael", "link": "https://stackoverflow.com/users/183792/michael"}, "edited": false, "score": 2, "creation_date": 1485352888, "post_id": 41853078, "comment_id": 70890741, "body": "this is almost twice as fast as the <code>unfold</code> versions I tried. <a href=\"http://sprunge.us/cjfe\" rel=\"nofollow noreferrer\">sprunge.us/cjfe</a>"}], "tags": [], "owner": {"reputation": 81794, "user_id": 9859, "user_type": "registered", "accept_rate": 89, "profile_image": "https://i.stack.imgur.com/KEZOL.jpg?s=128&g=1", "display_name": "rampion", "link": "https://stackoverflow.com/users/9859/rampion"}, "is_accepted": true, "score": 5, "last_activity_date": 1485351889, "last_edit_date": 1485351889, "creation_date": 1485351460, "answer_id": 41853078, "question_id": 41847758, "link": "https://stackoverflow.com/questions/41847758/bytestring-to-vector-conversion/41853078#41853078", "title": "ByteString to Vector conversion", "body": "<p>Just use <a href=\"https://hackage.haskell.org/package/vector-0.12.0.0/docs/Data-Vector.html#v:generate\" rel=\"noreferrer\"><code>Data.Vector.generate</code></a>:</p>\n\n<pre><code>V.generate (BS.length bs `div` 3) $ \\i -&gt;\n  myToFloat (bs BS.! 3*i) (bs BS.! 3*i+1) (bs BS.! 3*i+2)\n</code></pre>\n\n<p>It'll allocate the vector all at once, and populate it.  <code>Data.ByteString.!</code> is O(1), so this is quite efficient.</p>\n"}], "owner": {"reputation": 303, "user_id": 4173209, "user_type": "registered", "accept_rate": 89, "profile_image": "https://www.gravatar.com/avatar/caf52eb0e43490cabe3bb0cc1f850dfc?s=128&d=identicon&r=PG&f=1", "display_name": "Valerie94", "link": "https://stackoverflow.com/users/4173209/valerie94"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 442, "favorite_count": 2, "accepted_answer_id": 41853078, "answer_count": 2, "score": 7, "last_activity_date": 1485351889, "creation_date": 1485336227, "question_id": 41847758, "link": "https://stackoverflow.com/questions/41847758/bytestring-to-vector-conversion", "title": "ByteString to Vector conversion", "body": "<p>I have a <code>ByteString</code> that is containing the representation of <code>Float</code>s. Each <code>Float</code> is represented by 3 bytes in the <code>ByteString</code>. </p>\n\n<p>I need to do some processing on the <code>Float</code> values, so I would like to perform that processing on an <code>Vector</code> of <code>Float</code> values. What would be the best way to do this? </p>\n\n<p>I have a function <code>toFloat :: [Word8] -&gt; Float</code> that converts 3 bytes of the <code>ByteString</code> to a Float. So I was thinking of iterating over the <code>ByteString</code> in steps of 3 Bytes and converting every step to a <code>Float</code> for a <code>vector</code>. </p>\n\n<p>I've looked at the library functions for <code>Vector</code> but I can't find anything that suits this purpose. <code>Data.Vector.Storable.ByteString.byteStringToVector</code> looked promising but it converts every byte (instead of every 3 bytes) and doesn't give me any control over how the conversion of <code>ByteString</code> to <code>Float</code> should happen. </p>\n"}, {"tags": ["parsing", "haskell", "happy"], "answers": [{"comments": [{"owner": {"reputation": 126897, "user_id": 791604, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/ce991df7a056248d5e4f6fc3659ba733?s=128&d=identicon&r=PG", "display_name": "Daniel Wagner", "link": "https://stackoverflow.com/users/791604/daniel-wagner"}, "edited": false, "score": 1, "creation_date": 1485302065, "post_id": 41839421, "comment_id": 70867326, "body": "Forgive me if this is a stupid question, since I&#39;ve never used happy before. Does this mean that <code>%left &#39;+&#39;; %left &#39;*&#39;</code> <i>does</i> declare precedences for <code>&#39;+&#39;</code> and <code>&#39;*&#39;</code>, but that <code>%left PLUS; %left TIMES</code> <i>does not</i> declare precedences for <code>PLUS</code> and <code>TIMES</code>?"}, {"owner": {"reputation": 199706, "user_id": 1566221, "user_type": "registered", "accept_rate": 86, "profile_image": "https://www.gravatar.com/avatar/ce3ea4ffd1023d4382f397312352726d?s=128&d=identicon&r=PG", "display_name": "rici", "link": "https://stackoverflow.com/users/1566221/rici"}, "reply_to_user": {"reputation": 126897, "user_id": 791604, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/ce991df7a056248d5e4f6fc3659ba733?s=128&d=identicon&r=PG", "display_name": "Daniel Wagner", "link": "https://stackoverflow.com/users/791604/daniel-wagner"}, "edited": false, "score": 0, "creation_date": 1485302768, "post_id": 41839421, "comment_id": 70867525, "body": "@DanielWagner: What was unclear about what I wrote?  <code>%left &#39;+&#39;; %left &#39;*&#39;</code> declares precedences for <code>&#39;+&#39;</code> and <code>&#39;*&#39;</code> and <code>%left PLUS; %left TIMES</code> declares precedences for <code>PLUS</code> and <code>TIMES</code>. But the comparison of precedences is always between a production and a terminal, and <code>%left PLUS; %left TIMES</code> does <i>not</i> declare precedences for <code>&#39;+&#39;</code> and <code>&#39;*&#39;</code>. Why would it? And if <code>&#39;+&#39;</code> and <code>&#39;*&#39;</code> don&#39;t have declared precedences, there is nothing to compare the precedences of <code>PLUS</code> and <code>TIMES</code> with."}, {"owner": {"reputation": 126897, "user_id": 791604, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/ce991df7a056248d5e4f6fc3659ba733?s=128&d=identicon&r=PG", "display_name": "Daniel Wagner", "link": "https://stackoverflow.com/users/791604/daniel-wagner"}, "edited": false, "score": 0, "creation_date": 1485303078, "post_id": 41839421, "comment_id": 70867616, "body": "Thanks, that clears it up! I didn&#39;t understand that it would be trying to compare the precedence of <code>&#39;+&#39;</code> to <code>PLUS</code> in the second example, and not succeeding (because only <code>PLUS</code> has a declared precedence there)."}, {"owner": {"reputation": 199706, "user_id": 1566221, "user_type": "registered", "accept_rate": 86, "profile_image": "https://www.gravatar.com/avatar/ce3ea4ffd1023d4382f397312352726d?s=128&d=identicon&r=PG", "display_name": "rici", "link": "https://stackoverflow.com/users/1566221/rici"}, "reply_to_user": {"reputation": 126897, "user_id": 791604, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/ce991df7a056248d5e4f6fc3659ba733?s=128&d=identicon&r=PG", "display_name": "Daniel Wagner", "link": "https://stackoverflow.com/users/791604/daniel-wagner"}, "edited": false, "score": 0, "creation_date": 1485303319, "post_id": 41839421, "comment_id": 70867682, "body": "@DanielWagner: &quot;a precedence comparison is always between a production (which could be reduced) and a terminal (which could be shifted).&quot; I don&#39;t know how many times I have written that sentence in an SO answer about some parser generator or other; it&#39;s not happy-specific. If there is a better phrasing, please suggest it."}, {"owner": {"reputation": 199706, "user_id": 1566221, "user_type": "registered", "accept_rate": 86, "profile_image": "https://www.gravatar.com/avatar/ce3ea4ffd1023d4382f397312352726d?s=128&d=identicon&r=PG", "display_name": "rici", "link": "https://stackoverflow.com/users/1566221/rici"}, "reply_to_user": {"reputation": 126897, "user_id": 791604, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/ce991df7a056248d5e4f6fc3659ba733?s=128&d=identicon&r=PG", "display_name": "Daniel Wagner", "link": "https://stackoverflow.com/users/791604/daniel-wagner"}, "edited": false, "score": 0, "creation_date": 1485303375, "post_id": 41839421, "comment_id": 70867696, "body": "Also, it&#39;s not comparing <code>PLUS</code> to <code>+</code>. It&#39;s comparing <code>TIMES</code> (the precedence of the production which could be reduced) with <code>+</code> (the terminal which could be shifted). Later, it compares <code>PLUS</code> (the production which could be reduced) with <code>*</code> (the terminal which could be shifted). The first time, the reduce wins; the second time, the shift does."}], "tags": [], "owner": {"reputation": 199706, "user_id": 1566221, "user_type": "registered", "accept_rate": 86, "profile_image": "https://www.gravatar.com/avatar/ce3ea4ffd1023d4382f397312352726d?s=128&d=identicon&r=PG", "display_name": "rici", "link": "https://stackoverflow.com/users/1566221/rici"}, "is_accepted": true, "score": 4, "last_activity_date": 1485296513, "last_edit_date": 1485296513, "creation_date": 1485293831, "answer_id": 41839421, "question_id": 41837086, "link": "https://stackoverflow.com/questions/41837086/happy-context-dependent-operator-precedence/41839421#41839421", "title": "Happy Context-Dependent Operator Precedence", "body": "<p>\"Context-dependent precedence\" is a very misleading way of describing that feature. The description of the precedence algorithm in the preceding section is largely accurate, though.</p>\n\n<p>As it says, a precedence comparison is always between a <em>production</em> (which could be reduced) and a <em>terminal</em>  (which could be shifted). That simple fact is often clouded by the decision to design the precedence declaration syntax as though precedence were solely an attribute of the terminal.</p>\n\n<p>The production's precedence is set by copying the precedence of the last terminal in the production unless there is an explicit declaration with <code>%prec</code>. Or to put it another way, the production's precdence is set with a <code>%prec</code> clause, defaulting to the precedence of the last token. Either way, you can only define the precedence of the production by saying that it is the same as that of some terminal. Since that is not always convenient, the parser generator gives you the option of using an arbitrary name which is not the name of a grammar symbol. The implementation is to treat the name as a terminal and ignore the fact that it is never actually used in any grammar rule, but logically it is the name of a precedence level which is to be assigned to that particular production.</p>\n\n<p>In your first example, you let the productions default their precedence to the last (in fact, the only) terminal in each production. But in your second example you have defined two named precedence levels, PLUS and TIMES and you use those to set the precedence of two productions. But you do not declare the precedence of any terminal. So when the parser generator attempts to check the relative precedence of the production which could be reduced and the terminal which could be shifted, it finds that only one of those things has a declared precedence. And in that case, it always shifts.</p>\n"}], "owner": {"reputation": 73, "user_id": 7465439, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/33e1ec4b973dd46bad7e462c20c992de?s=128&d=identicon&r=PG&f=1", "display_name": "Kyle McCormick", "link": "https://stackoverflow.com/users/7465439/kyle-mccormick"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 404, "favorite_count": 1, "accepted_answer_id": 41839421, "answer_count": 1, "score": 6, "last_activity_date": 1485296513, "creation_date": 1485285242, "last_edit_date": 1485293836, "question_id": 41837086, "link": "https://stackoverflow.com/questions/41837086/happy-context-dependent-operator-precedence", "title": "Happy Context-Dependent Operator Precedence", "body": "<p>I have two snippets of Happy code here, one that uses normal precedence rules, and one that uses context-dependent precedence rules (both of which are described <a href=\"https://www.haskell.org/happy/doc/html/sec-Precedences.html#context-precedence\" rel=\"nofollow noreferrer\">here</a>).</p>\n\n<p>Normal:</p>\n\n<pre><code>%left '+'\n%left '*'\n%%\n\nExp :: { Exp }\n    : Exp '+' Exp { Plus $1 $3 }\n    | Exp '*' Exp { Times $1 $3 }\n    | var         { Var $1 }\n</code></pre>\n\n<p>Context-dependent:</p>\n\n<pre><code>%left PLUS\n%left TIMES\n%%\n\nExp :: { Exp }\n    : Exp '+' Exp %prec PLUS  { Plus $1 $3 }\n    | Exp '*' Exp %prec TIMES { Times $1 $3 }\n    | var                     { Var $1 }\n</code></pre>\n\n<p>Given the input:</p>\n\n<pre><code>a * b + c * d\n</code></pre>\n\n<p>The normal version gives:</p>\n\n<pre><code>Plus (Times (Var \"a\") (Var \"b\")) (Times (Var \"c\") (Var \"d\"))\n</code></pre>\n\n<p>whereas the context-dependent version gives:</p>\n\n<pre><code>Times (Var \"a\") (Plus (Var \"b\") (Times (Var \"c\") (Var \"c\")))\n</code></pre>\n\n<p>Shouldn't these both give the same output? What am I doing wrong here that's making them generate different parse trees?</p>\n"}, {"tags": ["haskell", "heist"], "answers": [{"tags": [], "owner": {"reputation": 7154, "user_id": 527460, "user_type": "registered", "accept_rate": 88, "profile_image": "https://www.gravatar.com/avatar/0cece5abd2f9ad9056f5ac3830ac0bfe?s=128&d=identicon&r=PG", "display_name": "mightybyte", "link": "https://stackoverflow.com/users/527460/mightybyte"}, "is_accepted": true, "score": 0, "last_activity_date": 1485810730, "creation_date": 1485810730, "answer_id": 41945479, "question_id": 41836496, "link": "https://stackoverflow.com/questions/41836496/does-heist-support-substituting-strings-json-into-an-arbitrary-location-with/41945479#41945479", "title": "Does heist support substituting (strings / JSON) into an arbitrary location within a template?", "body": "<p>No.  You cannot substitute anything inside a <code>&lt;script&gt;</code> tag because the text inside a script tag is not treated as HTML.  It's treated as plain text.  If this was not done, you wouldn't be able to write JS code like <code>if ( x &lt; 42 )</code> because the less than would get treated as the beginning of a tag.</p>\n"}], "owner": {"reputation": 19307, "user_id": 1663462, "user_type": "registered", "accept_rate": 78, "profile_image": "https://www.gravatar.com/avatar/c30e0fa0f3a065c038c633a95066d299?s=128&d=identicon&r=PG", "display_name": "Chris Stryczynski", "link": "https://stackoverflow.com/users/1663462/chris-stryczynski"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 43, "favorite_count": 0, "accepted_answer_id": 41945479, "answer_count": 1, "score": 0, "last_activity_date": 1485810730, "creation_date": 1485283147, "question_id": 41836496, "link": "https://stackoverflow.com/questions/41836496/does-heist-support-substituting-strings-json-into-an-arbitrary-location-with", "title": "Does heist support substituting (strings / JSON) into an arbitrary location within a template?", "body": "<p>Regarding heist, I've got a template such as:</p>\n\n<pre><code>&lt;script&gt;\n  var json = ???;\n&lt;/script&gt;\n&lt;h1&gt;Example&lt;/h1&gt;\n</code></pre>\n\n<p>Is there a way to substitute the <code>???</code> string with another string?</p>\n\n<p>I think the following function might be the solution <a href=\"https://hackage.haskell.org/package/heist-1.0.1.0/docs/Heist-Splices-Json.html#v:bindJson\" rel=\"nofollow noreferrer\">https://hackage.haskell.org/package/heist-1.0.1.0/docs/Heist-Splices-Json.html#v:bindJson</a> but I have difficulty understanding that function and or what markup to use in the template.</p>\n"}, {"tags": ["arrays", "haskell", "matrix"], "comments": [{"owner": {"reputation": 133611, "user_id": 152602, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/7f370b4bd787fc68f9f62d9c6781cb79?s=128&d=identicon&r=PG", "display_name": "Lee", "link": "https://stackoverflow.com/users/152602/lee"}, "edited": false, "score": 0, "creation_date": 1485276456, "post_id": 41833584, "comment_id": 70854151, "body": "<code>array ((1,1), (2,2)...</code> constructs an array, but in <code>doSth</code> you need to take a <code>Matrix</code> as a parameter and that could be any value chosen by the caller. So <code>doSth (array ((1, 1), (2, 2)...)</code> would be valid, but within <code>doSth</code> you need to perform the transform on an arbitrary <code>Matrix</code>. What should <code>doSth</code> calculate?"}, {"owner": {"reputation": 314794, "user_id": 67579, "user_type": "registered", "accept_rate": 81, "profile_image": "https://i.stack.imgur.com/BJXub.png?s=128&g=1", "display_name": "Willem Van Onsem", "link": "https://stackoverflow.com/users/67579/willem-van-onsem"}, "edited": false, "score": 1, "creation_date": 1485276859, "post_id": 41833584, "comment_id": 70854427, "body": "<code>array</code> without a capital letter? Is this a typo? Furthermore your constructor is called with wrong types..."}, {"owner": {"reputation": 3231, "user_id": 1013393, "user_type": "registered", "accept_rate": 60, "profile_image": "https://www.gravatar.com/avatar/7bca51e5ae3eb8dc24a98616b4e5d6fd?s=128&d=identicon&r=PG", "display_name": "sjakobi", "link": "https://stackoverflow.com/users/1013393/sjakobi"}, "edited": false, "score": 6, "creation_date": 1485278557, "post_id": 41833584, "comment_id": 70855512, "body": "You can&#39;t pattern match an Array. To pattern match, you need the constructors for the data type, and Array doesn&#39;t export its constructors."}, {"owner": {"reputation": 65, "user_id": 7186508, "user_type": "registered", "accept_rate": 50, "profile_image": "https://www.gravatar.com/avatar/efbb0f6aa8d6a557d7d430b01ab4780b?s=128&d=identicon&r=PG&f=1", "display_name": "John Doe", "link": "https://stackoverflow.com/users/7186508/john-doe"}, "reply_to_user": {"reputation": 133611, "user_id": 152602, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/7f370b4bd787fc68f9f62d9c6781cb79?s=128&d=identicon&r=PG", "display_name": "Lee", "link": "https://stackoverflow.com/users/152602/lee"}, "edited": false, "score": 0, "creation_date": 1485278748, "post_id": 41833584, "comment_id": 70855630, "body": "@Lee doSth should calculate the transposed input Matrix. So in the parameter Matrix I have to work with variables a,b,c..? What would be a valid parameter Matrix then? Something like (array ((1,1),(a,b)) (x:xs)) doesn&#39;t work."}, {"owner": {"reputation": 384463, "user_id": 1126841, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/fa05233b2357f8d11c22ef4cfc7bb85c?s=128&d=identicon&r=PG", "display_name": "chepner", "link": "https://stackoverflow.com/users/1126841/chepner"}, "edited": false, "score": 2, "creation_date": 1485280508, "post_id": 41833584, "comment_id": 70856989, "body": "For pattern matching, all you can do is match <i>a</i> <code>Matrix</code> value <code>m</code>. Any structure within that value has to be extracted in the body of the function using functions that take <code>Array</code> values as arguments."}, {"owner": {"reputation": 65, "user_id": 7186508, "user_type": "registered", "accept_rate": 50, "profile_image": "https://www.gravatar.com/avatar/efbb0f6aa8d6a557d7d430b01ab4780b?s=128&d=identicon&r=PG&f=1", "display_name": "John Doe", "link": "https://stackoverflow.com/users/7186508/john-doe"}, "reply_to_user": {"reputation": 384463, "user_id": 1126841, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/fa05233b2357f8d11c22ef4cfc7bb85c?s=128&d=identicon&r=PG", "display_name": "chepner", "link": "https://stackoverflow.com/users/1126841/chepner"}, "edited": false, "score": 0, "creation_date": 1485281860, "post_id": 41833584, "comment_id": 70857630, "body": "@chepner Ah okay so for example if I want to get the Dimension of the Matrix I could use the predefined function bounds m. Thanks, now I know how to solve it :)"}, {"owner": {"reputation": 100185, "user_id": 3234959, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/93bb12ca0f93dfddb33880316f7e66c2?s=128&d=identicon&r=PG&f=1", "display_name": "chi", "link": "https://stackoverflow.com/users/3234959/chi"}, "edited": false, "score": 3, "creation_date": 1485282325, "post_id": 41833584, "comment_id": 70857906, "body": "Using advanced Haskell like view patterns and pattern synonyms one could, in principle, define patterns for arrays. the library does not provide these, though -- those extensions are too recent. For the time being, it&#39;s better to learn to use arrays through their related library-exported functions."}], "owner": {"reputation": 65, "user_id": 7186508, "user_type": "registered", "accept_rate": 50, "profile_image": "https://www.gravatar.com/avatar/efbb0f6aa8d6a557d7d430b01ab4780b?s=128&d=identicon&r=PG&f=1", "display_name": "John Doe", "link": "https://stackoverflow.com/users/7186508/john-doe"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 425, "favorite_count": 0, "answer_count": 0, "score": 0, "last_activity_date": 1485293871, "creation_date": 1485275921, "last_edit_date": 1485293871, "question_id": 41833584, "link": "https://stackoverflow.com/questions/41833584/pattern-matching-with-arrays", "title": "Pattern matching with arrays", "body": "<p>He guys,\nI have problems with pattern matching in Haskell. I have a two-dimensional Matrix depicted as an array. \nHere's the code:</p>\n\n<pre><code>import Data.Array\ntype Matrix = Array (Int,Int) Int\n\ndoSth :: Matrix -&gt; Matrix\ndoSth (array ((1,1),(2,2)) [((1,1),0),((1,2),1),((2,1),2),((2,2),3)]) = ...\n</code></pre>\n\n<p>When I execute this code it gives me a parse error in pattern 'array' in line 5. I don't know what the problem is. The argument matrix <code>(array ((1,1),(2,2)) [((1,1),0),((1,2),1),((2,1),2),((2,2),3)])</code> should be a correct 2x2 matrix.</p>\n"}, {"tags": ["haskell", "parsec"], "comments": [{"owner": {"reputation": 314794, "user_id": 67579, "user_type": "registered", "accept_rate": 81, "profile_image": "https://i.stack.imgur.com/BJXub.png?s=128&g=1", "display_name": "Willem Van Onsem", "link": "https://stackoverflow.com/users/67579/willem-van-onsem"}, "edited": false, "score": 0, "creation_date": 1485275168, "post_id": 41833258, "comment_id": 70853266, "body": "What is not working? You get a compiler error? Wrong output?? Please be specific about what your problem is."}, {"owner": {"reputation": 3335, "user_id": 1017211, "user_type": "registered", "accept_rate": 72, "profile_image": "https://i.stack.imgur.com/7vlEI.png?s=128&g=1", "display_name": "monnef", "link": "https://stackoverflow.com/users/1017211/monnef"}, "reply_to_user": {"reputation": 314794, "user_id": 67579, "user_type": "registered", "accept_rate": 81, "profile_image": "https://i.stack.imgur.com/BJXub.png?s=128&g=1", "display_name": "Willem Van Onsem", "link": "https://stackoverflow.com/users/67579/willem-van-onsem"}, "edited": false, "score": 0, "creation_date": 1485278275, "post_id": 41833258, "comment_id": 70855322, "body": "@WillemVanOnsem Sorry, forgot to add an error message. I have added it to the question."}, {"owner": {"reputation": 649, "user_id": 2998746, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/2fc15b842026d8a039ffdd1b2a528aec?s=128&d=identicon&r=PG&f=1", "display_name": "Euge", "link": "https://stackoverflow.com/users/2998746/euge"}, "edited": false, "score": 0, "creation_date": 1485278415, "post_id": 41833258, "comment_id": 70855425, "body": "There are two newlines separating each segment of letters"}, {"owner": {"reputation": 3335, "user_id": 1017211, "user_type": "registered", "accept_rate": 72, "profile_image": "https://i.stack.imgur.com/7vlEI.png?s=128&g=1", "display_name": "monnef", "link": "https://stackoverflow.com/users/1017211/monnef"}, "reply_to_user": {"reputation": 649, "user_id": 2998746, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/2fc15b842026d8a039ffdd1b2a528aec?s=128&d=identicon&r=PG&f=1", "display_name": "Euge", "link": "https://stackoverflow.com/users/2998746/euge"}, "edited": false, "score": 0, "creation_date": 1485279059, "post_id": 41833258, "comment_id": 70855812, "body": "@Euge Oh, you are right, overlooked that. But even if I use <code>p  = sepBy1 (try pp) (newline &gt;&gt; newline)</code> it still doesn&#39;t work ._. (same error)."}], "answers": [{"tags": [], "owner": {"reputation": 649, "user_id": 2998746, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/2fc15b842026d8a039ffdd1b2a528aec?s=128&d=identicon&r=PG&f=1", "display_name": "Euge", "link": "https://stackoverflow.com/users/2998746/euge"}, "is_accepted": true, "score": 2, "last_activity_date": 1485280815, "creation_date": 1485280815, "answer_id": 41835837, "question_id": 41833258, "link": "https://stackoverflow.com/questions/41833258/nested-sepby1-with-same-delimiter/41835837#41835837", "title": "Nested sepBy1 with same delimiter", "body": "<p>The problem seems to be the implementation of sepBy1, because the error appears even for  <code>parse pp \"\" \"a\\nb\\n\"</code>. While we expect this to return <code>Right [\"a\",\"b\"]</code>, it throws the same <code>expected \\n</code> error.</p>\n\n<p>So, it looks like <code>sepBy1</code> works as expected, except in the case where the string to parse ends with the separator. This seems to be harmless, because there's another parser combinator for that case. But now that we want two nested <code>sepBy1</code>s with the same separator, that's a problem.</p>\n\n<p>The only solution I found is to write your own backtracking <code>sepBy1</code>, and use it in the inner case.</p>\n\n<pre><code>main :: IO ()\nmain = print $ parse p \"\" \"a\\nb\\n\\nc\\nd\"\n  where  pp = mySepBy1 l newline\n         l  = many1 letter\n         p  = sepBy1 pp (newline &gt;&gt; newline)\n\nmySepBy1 parser separator = do\n  x &lt;- parser\n  xs &lt;- many (try $ separator &gt;&gt; parser)\n  return (x:xs)\n</code></pre>\n"}], "owner": {"reputation": 3335, "user_id": 1017211, "user_type": "registered", "accept_rate": 72, "profile_image": "https://i.stack.imgur.com/7vlEI.png?s=128&g=1", "display_name": "monnef", "link": "https://stackoverflow.com/users/1017211/monnef"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 148, "favorite_count": 0, "accepted_answer_id": 41835837, "answer_count": 1, "score": 0, "last_activity_date": 1485280815, "creation_date": 1485275023, "last_edit_date": 1485278224, "question_id": 41833258, "link": "https://stackoverflow.com/questions/41833258/nested-sepby1-with-same-delimiter", "title": "Nested sepBy1 with same delimiter", "body": "<pre><code>#!/usr/bin/env runhaskell\n\nimport           Control.Applicative           ((&lt;|&gt;))\nimport           Text.Parsec.Char\nimport           Text.ParserCombinators.Parsec hiding (spaces, (&lt;|&gt;))\n\nmain :: IO ()\nmain = do\n  print $ parse p \"\" \"a\\nb\\n\\nc\\nd\" where\n  p  = sepBy1 (try pp) newline\n  pp = sepBy1 l newline\n  l  = many1 letter\n</code></pre>\n\n<p>I am trying to parse this:</p>\n\n<pre><code>a\nb\n\nc\nd\n</code></pre>\n\n<p>to this: <code>[[\"a\", \"b\"], [\"c\", \"d\"]]</code>. I tried fiddling with <code>try</code> but it doesn't seem to be working.</p>\n\n<p>It is probably something quite basic, please try to explain what is going on in your answer (I am beginner in Haskell and Parsec).</p>\n\n<p>Edit: Forgot to add an error message.</p>\n\n<pre><code>Left (line 3, column 1):\nunexpected \"\\n\"\nexpecting letter\n</code></pre>\n"}, {"tags": ["java", "swing", "user-interface", "haskell", "xmonad"], "answers": [{"comments": [{"owner": {"reputation": 2863, "user_id": 2297560, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/948d4a17494b3c616a0873453b74670c?s=128&d=identicon&r=PG", "display_name": "user2297560", "link": "https://stackoverflow.com/users/2297560/user2297560"}, "edited": false, "score": 2, "creation_date": 1485311001, "post_id": 41839531, "comment_id": 70869682, "body": "People who solve their own problem and come back here to share their solution are heroes."}, {"owner": {"user_type": "does_not_exist", "display_name": "user1544337"}, "edited": false, "score": 0, "creation_date": 1485424039, "post_id": 41839531, "comment_id": 70923358, "body": "That, and please mark this answer as accepted so that other people don&#39;t think they still need to answer :)"}, {"owner": {"reputation": 1277, "user_id": 568021, "user_type": "registered", "accept_rate": 88, "profile_image": "https://www.gravatar.com/avatar/47b8e45f4ba0648073e8d58376a98a86?s=128&d=identicon&r=PG", "display_name": "user568021", "link": "https://stackoverflow.com/users/568021/user568021"}, "edited": false, "score": 0, "creation_date": 1531928372, "post_id": 41839531, "comment_id": 89783010, "body": "I hate when solutions seem so straight forward, but don&#39;t work for me :("}, {"owner": {"reputation": 117, "user_id": 952804, "user_type": "registered", "accept_rate": 50, "profile_image": "https://www.gravatar.com/avatar/32ac383940690c4fd4339d4641161896?s=128&d=identicon&r=PG", "display_name": "MantasG", "link": "https://stackoverflow.com/users/952804/mantasg"}, "edited": false, "score": 1, "creation_date": 1578408651, "post_id": 41839531, "comment_id": 105423465, "body": "It seems that <code>startupHook = setWMName &quot;LG3D&quot;</code> is important here too (<a href=\"https://thinkingeek.com/2012/01/24/fix-java-gui-applications-xmonad/\" rel=\"nofollow noreferrer\">thinkingeek.com/2012/01/24/fix-java-gui-applications-xmonad</a>&zwnj;&#8203;)"}], "tags": [], "owner": {"reputation": 185, "user_id": 5697704, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/cbp0M.jpg?s=128&g=1", "display_name": "oliverwiegers", "link": "https://stackoverflow.com/users/5697704/oliverwiegers"}, "is_accepted": true, "score": 7, "last_activity_date": 1485294271, "creation_date": 1485294271, "answer_id": 41839531, "question_id": 41832881, "link": "https://stackoverflow.com/questions/41832881/java-gui-xmonad-not-working/41839531#41839531", "title": "Java GUI Xmonad not working", "body": "<p>so finally I found out it is:</p>\n\n<pre><code>borderWidth = 0,\n</code></pre>\n\n<p>after disabling this setting or setting it to any positive value everything works like a charm.</p>\n\n<pre><code>--this works\nborderWidth = [any positive value],\n--for example\nborderWidth = 1,\n</code></pre>\n\n<p>Sorry for bothering you guys. I hope the information can help anyone.</p>\n"}], "owner": {"reputation": 185, "user_id": 5697704, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/cbp0M.jpg?s=128&g=1", "display_name": "oliverwiegers", "link": "https://stackoverflow.com/users/5697704/oliverwiegers"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 537, "favorite_count": 0, "accepted_answer_id": 41839531, "answer_count": 1, "score": 7, "last_activity_date": 1485294271, "creation_date": 1485274091, "question_id": 41832881, "link": "https://stackoverflow.com/questions/41832881/java-gui-xmonad-not-working", "title": "Java GUI Xmonad not working", "body": "<p>Java GUI applications only give me a blank window, I tried:</p>\n\n<pre><code>main = do\n    xmonad $ defaultConfig\n    { modMask = mod4Mask\n    , startupHook = setWMName \"LG3D\"\n    -- other customizations\n    }\n</code></pre>\n\n<p>and setting this:</p>\n\n<pre><code>_JAVA_AWT_WM_NONREPARENTING=1 \n</code></pre>\n\n<p>and this:</p>\n\n<pre><code>AWT_TOOLKIT=MToolkit\n</code></pre>\n\n<p>and I tried using \"wmname\" suckless tools.\nNone of those methods worked for me. Two questions: </p>\n\n<ol>\n<li>Is there any other possibility?</li>\n<li>What am I getting wrong?</li>\n</ol>\n\n<p>I use java 8 and below is my currently minimal xmonad config.</p>\n\n<pre><code>import XMonad \nimport XMonad.Hooks.DynamicLog\nimport XMonad.Hooks.SetWMName\nimport XMonad.Hooks.ManageDocks\nimport XMonad.Hooks.FadeInactive\nimport XMonad.Util.Run(spawnPipe)\nimport XMonad.Util.EZConfig(additionalKeys)\nimport XMonad.Actions.UpdatePointer\nimport XMonad.Hooks.EwmhDesktops\nimport System.IO\n\n\nterm = \"termite\"\nmyWorkspaces = [\"1\",\"2\",\"3\",\"4\",\"5\"]\n\nmyLogHook :: X ()\nmyLogHook = fadeInactiveLogHook fadeAmount\n    where fadeAmount = 0.7\n\nmain = do\n    xmonad $ defaultConfig { \n        startupHook = setWMName \"LG3D\",\n        manageHook = manageDocks &lt;+&gt; manageHook defaultConfig,\n        layoutHook = avoidStruts $ layoutHook defaultConfig,\n        logHook = dynamicLog\n             &gt;&gt; updatePointer (0.5,0.5) (1,1)\n             &gt;&gt; myLogHook,\n        terminal = term,\n        borderWidth = 0,\n        focusFollowsMouse = False,\n        workspaces = myWorkspaces\n        }`additionalKeys`[\n            ((mod1Mask .|. shiftMask, xK_l), spawn \"scrot 'lock.png' -q 1 -e 'mv $f /tmp/lock.png' &amp;&amp; i3lock -I 1 -i /tmp/lock.png\"),\n            ((controlMask, xK_Print), spawn \"sleep 0.2; scrot -s\"),\n            ((0, xK_Print), spawn \"scrot\"),\n            ((mod1Mask, xK_d), spawn \"rofi -config /home/chrootzius/.config/rofi/config -show run\")\n        ]\n</code></pre>\n"}, {"tags": ["haskell", "singleton-type"], "answers": [{"comments": [{"owner": {"reputation": 2369, "user_id": 1500583, "user_type": "registered", "accept_rate": 91, "profile_image": "https://www.gravatar.com/avatar/71020354a2fefbdadf424bd48c912515?s=128&d=identicon&r=PG", "display_name": "David McHealy", "link": "https://stackoverflow.com/users/1500583/david-mchealy"}, "edited": false, "score": 0, "creation_date": 1485278481, "post_id": 41833896, "comment_id": 70855462, "body": "What lead me to try to do this was this tutorial: <a href=\"https://blog.jle.im/entry/practical-dependent-types-in-haskell-2.html\" rel=\"nofollow noreferrer\">blog.jle.im/entry/practical-dependent-types-in-haskell-2.htm&zwnj;&#8203;l</a>.  He uses it to generate types at runtime.  But it lost me around the <code>SomeSing</code> portion.  I can&#39;t seem to find any intuition for how it is meant to be used."}, {"owner": {"reputation": 28873, "user_id": 1068232, "user_type": "registered", "accept_rate": 79, "profile_image": "https://www.gravatar.com/avatar/2a0a145ce58c20013969fe3f203531da?s=128&d=identicon&r=PG", "display_name": "Andr&#225;s Kov&#225;cs", "link": "https://stackoverflow.com/users/1068232/andr%c3%a1s-kov%c3%a1cs"}, "reply_to_user": {"reputation": 2369, "user_id": 1500583, "user_type": "registered", "accept_rate": 91, "profile_image": "https://www.gravatar.com/avatar/71020354a2fefbdadf424bd48c912515?s=128&d=identicon&r=PG", "display_name": "David McHealy", "link": "https://stackoverflow.com/users/1500583/david-mchealy"}, "edited": false, "score": 0, "creation_date": 1485281332, "post_id": 41833896, "comment_id": 70857365, "body": "The intuition should ideally come from dependent type theory, because GHC&#39;s singletons are a complicated and inconvenient approximation of that. There isn&#39;t a lot of beginner materials, however. <a href=\"https://www.manning.com/books/type-driven-development-with-idris\" rel=\"nofollow noreferrer\">This</a> seems good but it&#39;s not free. You can look at <a href=\"http://people.inf.elte.hu/divip/AgdaTutorial/Index.html\" rel=\"nofollow noreferrer\">these</a> <a href=\"http://oxij.org/note/BrutalDepTypes/\" rel=\"nofollow noreferrer\">two</a> Agda tutorials, but they&#39;re a bit out of date tooling wise and more geared towards formalization than programming."}, {"owner": {"reputation": 28873, "user_id": 1068232, "user_type": "registered", "accept_rate": 79, "profile_image": "https://www.gravatar.com/avatar/2a0a145ce58c20013969fe3f203531da?s=128&d=identicon&r=PG", "display_name": "Andr&#225;s Kov&#225;cs", "link": "https://stackoverflow.com/users/1068232/andr%c3%a1s-kov%c3%a1cs"}, "reply_to_user": {"reputation": 2369, "user_id": 1500583, "user_type": "registered", "accept_rate": 91, "profile_image": "https://www.gravatar.com/avatar/71020354a2fefbdadf424bd48c912515?s=128&d=identicon&r=PG", "display_name": "David McHealy", "link": "https://stackoverflow.com/users/1500583/david-mchealy"}, "edited": false, "score": 0, "creation_date": 1485281653, "post_id": 41833896, "comment_id": 70857523, "body": "You could also look at <a href=\"https://www.cis.upenn.edu/~bcpierce/sf/current/index.html\" rel=\"nofollow noreferrer\">Software Foundations</a>, which is very thorough and beginner friendly, but also has a focus on proofs and formalization, and Coq is more alien to Haskellers than Idris or Agda."}, {"owner": {"reputation": 2369, "user_id": 1500583, "user_type": "registered", "accept_rate": 91, "profile_image": "https://www.gravatar.com/avatar/71020354a2fefbdadf424bd48c912515?s=128&d=identicon&r=PG", "display_name": "David McHealy", "link": "https://stackoverflow.com/users/1500583/david-mchealy"}, "edited": false, "score": 0, "creation_date": 1485281973, "post_id": 41833896, "comment_id": 70857684, "body": "Thank you.  I&#39;ll be taking a long look at all of these."}], "tags": [], "owner": {"reputation": 28873, "user_id": 1068232, "user_type": "registered", "accept_rate": 79, "profile_image": "https://www.gravatar.com/avatar/2a0a145ce58c20013969fe3f203531da?s=128&d=identicon&r=PG", "display_name": "Andr&#225;s Kov&#225;cs", "link": "https://stackoverflow.com/users/1068232/andr%c3%a1s-kov%c3%a1cs"}, "is_accepted": true, "score": 3, "last_activity_date": 1485285735, "last_edit_date": 1485285735, "creation_date": 1485276783, "answer_id": 41833896, "question_id": 41832575, "link": "https://stackoverflow.com/questions/41832575/show-instance-for-a-dependent-type/41833896#41833896", "title": "Show instance for a dependent type", "body": "<p><code>fromString :: String -&gt; EmailAddress a a</code> is impossible. <code>fromString @a \"\"</code> would give us <code>KnownSymbol a</code> for any <code>a</code>, which can't happen, because GHC erases all types from programs, including <code>Symbol</code>-s. We can't just conjure a runtime <code>String</code> corresponding to <code>a</code>. This is the reason why we have to use singletons in the first place.</p>\n\n<p>From another perspective, the issue with <code>String -&gt; EmailAddress a a</code> is that the input <code>String</code> can't be used in any meaningful way, because we need a <code>KnownSymbol a</code> output for a particular <code>a</code>. </p>\n\n<p>If we have non-singleton runtime data, we can convert that to an existential singleton with <code>toSing</code>. We can then do runtime checks to learn about properties of the resulting singleton.</p>\n"}], "owner": {"reputation": 2369, "user_id": 1500583, "user_type": "registered", "accept_rate": 91, "profile_image": "https://www.gravatar.com/avatar/71020354a2fefbdadf424bd48c912515?s=128&d=identicon&r=PG", "display_name": "David McHealy", "link": "https://stackoverflow.com/users/1500583/david-mchealy"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 147, "favorite_count": 0, "accepted_answer_id": 41833896, "answer_count": 1, "score": 1, "last_activity_date": 1485285735, "creation_date": 1485273333, "question_id": 41832575, "link": "https://stackoverflow.com/questions/41832575/show-instance-for-a-dependent-type", "title": "Show instance for a dependent type", "body": "<p>I am playing with dependent types in ghc 8, and I am running into a problem creating a Show instance for my type.</p>\n\n<pre><code>#!/usr/bin/env stack\n-- stack exec --resolver=lts-7.14 --package singletons -- ghci\n{-# LANGUAGE GADTs, ScopedTypeVariables, TypeInType, TemplateHaskell, LambdaCase, TypeApplications #-}\n\nimport Data.Kind\nimport Data.Singletons.Prelude\nimport Data.Singletons.TypeLits\n\n data EmailAddress :: Symbol -&gt; Symbol -&gt; * where\n  EmailAddress :: (KnownSymbol a, KnownSymbol b) =&gt; EmailAddress a b \n\n-- works\ntestEmail :: EmailAddress \"blah\" \"blah.com\"\ntestEmail = EmailAddress\n</code></pre>\n\n<p>I wanted to be able to show my address.</p>\n\n<pre><code>instance Show (EmailAddress a b)\n  where show = showEmailAddress\n\nshowEmailAddress :: forall a b. EmailAddress a b -&gt; String\nshowEmailAddress = \\case\n  EmailAddress -&gt; symbolVal (Proxy :: Proxy a) ++ \"@\" ++ symbolVal (Proxy :: Proxy b)\n\ntest1 = show testEmail -- works\n</code></pre>\n\n<p>Now I want to make a runtime <code>EmailAddress</code> from a user supplied string.  To start out I will get an address from a singleton.    Just taking one string for now.</p>\n\n<pre><code>fromString' :: Sing i -&gt; EmailAddress i i\nfromString' = \\case\n  SSym -&gt; EmailAddress\n\ntest2 = fromString' @\"asdf\" sing -- works\n</code></pre>\n\n<p>The final piece of the puzzle is that I feel like I should be able to do something like the following.</p>\n\n<pre><code>fromString :: String -&gt; EmailAddress a a\nfromString str = case toSing str of\n   SomeSing s -&gt; fromString' s\n</code></pre>\n\n<p>But it doesn't work.  No matter what type signatures I apply to various parts of the function, I cannot get it to typecheck, I always get the following error <code>Couldn't match type \u2018a\u2019 with \u2018a1\u2019</code> error on the following code.</p>\n\n<pre><code>fromString1 :: String -&gt; EmailAddress a a\nfromString1 str = case toSing str of\n   SomeSing s -&gt; fromString' s\n\nfromString2 :: forall a. String -&gt; EmailAddress a a\nfromString2 str = case toSing str of\n   SomeSing (s :: Sing a) -&gt; fromString' s\n\nfromString3 :: forall a. String -&gt; EmailAddress a a\nfromString3 str = case toSing str of\n   (SomeSing s :: Sing (a :: Symbol)) -&gt; fromString' s\n</code></pre>\n\n<p>This is the full error.  I don't understand where the <code>a1</code> is coming from in this.</p>\n\n<pre><code>Existentials5.hs:45:20: error:\n\u2022 Couldn't match type \u2018a\u2019 with \u2018a1\u2019\n  \u2018a\u2019 is a rigid type variable bound by\n    the type signature for:\n      fromString3 :: forall (a :: Symbol). String -&gt; EmailAddress a a\n    at Existentials5.hs:43:16\n  \u2018a1\u2019 is a rigid type variable bound by\n    a pattern with constructor:\n      SomeSing :: forall k k1 (k2 :: k1) (a :: k). Sing a -&gt; SomeSing k,\n    in a case alternative\n    at Existentials5.hs:45:5\n  Expected type: EmailAddress a a\n    Actual type: EmailAddress a1 a1\n\u2022 In the expression: fromString' s\n  In a case alternative: (SomeSing s) -&gt; fromString' s\n  In the expression:\n    case toSing str of { (SomeSing s) -&gt; fromString' s }\n\u2022 Relevant bindings include\n    s :: Sing a1 (bound at Existentials5.hs:45:14)\n    fromString3 :: String -&gt; EmailAddress a a\n      (bound at Existentials5.hs:44:1)\n</code></pre>\n"}, {"tags": ["haskell"], "comments": [{"owner": {"reputation": 9772, "user_id": 3963, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/9pDQ8.png?s=128&g=1", "display_name": "hao", "link": "https://stackoverflow.com/users/3963/hao"}, "edited": false, "score": 0, "creation_date": 1485272527, "post_id": 41832211, "comment_id": 70851275, "body": "you can avoid prelude (<code>-XNoImplicitPrelude</code>) and then define it however you want. the problem is that most libraries implicitly depend on the prelude so it will be very lonely"}, {"owner": {"reputation": 3436, "user_id": 4364027, "user_type": "registered", "accept_rate": 64, "profile_image": "https://www.gravatar.com/avatar/e84dbb0e9c838c25bbb70b326fd696aa?s=128&d=identicon&r=PG&f=1", "display_name": "Marko Grdinic", "link": "https://stackoverflow.com/users/4364027/marko-grdinic"}, "reply_to_user": {"reputation": 9772, "user_id": 3963, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/9pDQ8.png?s=128&g=1", "display_name": "hao", "link": "https://stackoverflow.com/users/3963/hao"}, "edited": false, "score": 0, "creation_date": 1485272577, "post_id": 41832211, "comment_id": 70851311, "body": "I tried just hiding negate during import and it did not work."}, {"owner": {"reputation": 9772, "user_id": 3963, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/9pDQ8.png?s=128&g=1", "display_name": "hao", "link": "https://stackoverflow.com/users/3963/hao"}, "edited": false, "score": 0, "creation_date": 1485272617, "post_id": 41832211, "comment_id": 70851349, "body": "oh wait, i forgot. ignore me!"}], "answers": [{"comments": [{"owner": {"reputation": 3436, "user_id": 4364027, "user_type": "registered", "accept_rate": 64, "profile_image": "https://www.gravatar.com/avatar/e84dbb0e9c838c25bbb70b326fd696aa?s=128&d=identicon&r=PG&f=1", "display_name": "Marko Grdinic", "link": "https://stackoverflow.com/users/4364027/marko-grdinic"}, "edited": false, "score": 0, "creation_date": 1485273962, "post_id": 41832408, "comment_id": 70852380, "body": "It seems I have to define a bunch of things apart from negate. I needed to also define ifThenElse (using pattern matching) and import fromString, but now it works. Thanks. ...And actually, rather than use a global standard ifThenElse, it occurs to me now that I could make it a part of the typeclass definition for my DSL. That is quite neat."}], "tags": [], "owner": {"reputation": 9772, "user_id": 3963, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/9pDQ8.png?s=128&g=1", "display_name": "hao", "link": "https://stackoverflow.com/users/3963/hao"}, "is_accepted": true, "score": 4, "last_activity_date": 1485272828, "creation_date": 1485272828, "answer_id": 41832408, "question_id": 41832211, "link": "https://stackoverflow.com/questions/41832211/is-there-a-way-to-rebind-the-unary-minus-negate-to-a-different-typeclass-than/41832408#41832408", "title": "Is there a way to rebind the unary minus (negate) to a different typeclass than Num?", "body": "<p>Try <a href=\"https://ocharles.org.uk/blog/guest-posts/2014-12-06-rebindable-syntax.html\" rel=\"nofollow noreferrer\">the RebindableSyntax extension</a>. It allows the unary minus to refer to whatever \"negate\" is in scope. As the <a href=\"https://downloads.haskell.org/~ghc/latest/docs/html/users_guide/glasgow_exts.html?highlight=rebindable#ghc-flag--XRebindableSyntax\" rel=\"nofollow noreferrer\">docs say</a>:</p>\n\n<blockquote>\n  <ul>\n  <li>Negation (e.g. \u201c- (f x)\u201d) means \u201cnegate (f x)\u201d, both in numeric patterns, and expressions.</li>\n  </ul>\n</blockquote>\n\n<p>The compiler has this convention hardcoded but can be persuaded otherwise as long as you</p>\n\n<ul>\n<li>Turn on <code>RebindableSyntax</code>, which implicitly turns on <code>NoImplicitPrelude</code>;</li>\n<li>Hide the default <code>negate</code> when you import the Prelude; and</li>\n<li>Define your own <code>negate</code> in scope.</li>\n</ul>\n"}], "owner": {"reputation": 3436, "user_id": 4364027, "user_type": "registered", "accept_rate": 64, "profile_image": "https://www.gravatar.com/avatar/e84dbb0e9c838c25bbb70b326fd696aa?s=128&d=identicon&r=PG&f=1", "display_name": "Marko Grdinic", "link": "https://stackoverflow.com/users/4364027/marko-grdinic"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 63, "favorite_count": 0, "accepted_answer_id": 41832408, "answer_count": 1, "score": 2, "last_activity_date": 1485272828, "creation_date": 1485272288, "question_id": 41832211, "link": "https://stackoverflow.com/questions/41832211/is-there-a-way-to-rebind-the-unary-minus-negate-to-a-different-typeclass-than", "title": "Is there a way to rebind the unary minus (negate) to a different typeclass than Num?", "body": "<p>As I understand it, the unary minus is the only unary operator in Haskell and it is bound to <code>Num</code>'s <code>negate</code>? Is there way to rebind the unary minus to a <code>negate</code> in a different typeclass?</p>\n"}, {"tags": ["haskell", "functional-programming"], "comments": [{"owner": {"reputation": 314794, "user_id": 67579, "user_type": "registered", "accept_rate": 81, "profile_image": "https://i.stack.imgur.com/BJXub.png?s=128&g=1", "display_name": "Willem Van Onsem", "link": "https://stackoverflow.com/users/67579/willem-van-onsem"}, "edited": false, "score": 0, "creation_date": 1485269925, "post_id": 41831091, "comment_id": 70849422, "body": "Which Haskell book did you buy? Please specify..."}, {"owner": {"reputation": 25967, "user_id": 1743843, "user_type": "registered", "accept_rate": 77, "profile_image": "https://www.gravatar.com/avatar/8ea2c1d9051e40332376a07bc166d9d5?s=128&d=identicon&r=PG&f=1", "display_name": "softshipper", "link": "https://stackoverflow.com/users/1743843/softshipper"}, "reply_to_user": {"reputation": 314794, "user_id": 67579, "user_type": "registered", "accept_rate": 81, "profile_image": "https://i.stack.imgur.com/BJXub.png?s=128&g=1", "display_name": "Willem Van Onsem", "link": "https://stackoverflow.com/users/67579/willem-van-onsem"}, "edited": false, "score": 0, "creation_date": 1485270954, "post_id": 41831091, "comment_id": 70850154, "body": "The best one <a href=\"http://haskellbook.com/\" rel=\"nofollow noreferrer\">haskellbook.com</a>"}], "answers": [{"comments": [{"owner": {"reputation": 314794, "user_id": 67579, "user_type": "registered", "accept_rate": 81, "profile_image": "https://i.stack.imgur.com/BJXub.png?s=128&g=1", "display_name": "Willem Van Onsem", "link": "https://stackoverflow.com/users/67579/willem-van-onsem"}, "reply_to_user": {"reputation": 25967, "user_id": 1743843, "user_type": "registered", "accept_rate": 77, "profile_image": "https://www.gravatar.com/avatar/8ea2c1d9051e40332376a07bc166d9d5?s=128&d=identicon&r=PG&f=1", "display_name": "softshipper", "link": "https://stackoverflow.com/users/1743843/softshipper"}, "edited": false, "score": 0, "creation_date": 1485271477, "post_id": 41831335, "comment_id": 70850544, "body": "@zero_coding: don&#39;t know one immediately: I learned beta-reductions in the <i>Automata and Computability</i> course, but the coursetext is in Dutch :("}, {"owner": {"reputation": 25967, "user_id": 1743843, "user_type": "registered", "accept_rate": 77, "profile_image": "https://www.gravatar.com/avatar/8ea2c1d9051e40332376a07bc166d9d5?s=128&d=identicon&r=PG&f=1", "display_name": "softshipper", "link": "https://stackoverflow.com/users/1743843/softshipper"}, "edited": false, "score": 0, "creation_date": 1485272634, "post_id": 41831335, "comment_id": 70851363, "body": "Thanks a lot for answer."}, {"owner": {"reputation": 126897, "user_id": 791604, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/ce991df7a056248d5e4f6fc3659ba733?s=128&d=identicon&r=PG", "display_name": "Daniel Wagner", "link": "https://stackoverflow.com/users/791604/daniel-wagner"}, "reply_to_user": {"reputation": 25967, "user_id": 1743843, "user_type": "registered", "accept_rate": 77, "profile_image": "https://www.gravatar.com/avatar/8ea2c1d9051e40332376a07bc166d9d5?s=128&d=identicon&r=PG&f=1", "display_name": "softshipper", "link": "https://stackoverflow.com/users/1743843/softshipper"}, "edited": false, "score": 3, "creation_date": 1485274277, "post_id": 41831335, "comment_id": 70852607, "body": "@zero_coding Types and Programming Languages by Benjamin Pierce is one very popular introductory text on this topic."}], "tags": [], "owner": {"reputation": 314794, "user_id": 67579, "user_type": "registered", "accept_rate": 81, "profile_image": "https://i.stack.imgur.com/BJXub.png?s=128&g=1", "display_name": "Willem Van Onsem", "link": "https://stackoverflow.com/users/67579/willem-van-onsem"}, "is_accepted": true, "score": 9, "last_activity_date": 1485273315, "last_edit_date": 1485273315, "creation_date": 1485269819, "answer_id": 41831335, "question_id": 41831091, "link": "https://stackoverflow.com/questions/41831091/working-with-beta-reduce/41831335#41831335", "title": "Working with beta reduce", "body": "<p>First of all:</p>\n\n<pre><code>(\u03bb a b c . c b a) z z (\u03bb w v . w)</code></pre>\n\n<p>is short for:</p>\n\n<pre><code>(\u03bb a . (\u03bb b . (\u03bb c . c b a) ) ) z z (\u03bb w . (\u03bb v . w) )</code></pre>\n\n<p>Well given you apply beta-reduction on:</p>\n\n<pre><code>(\u03bb <b>a</b> b c . c b <b>a</b>) <i>z</i> z (\u03bb w v . w)</code></pre>\n\n<p>(boldface added for the \"active\" variable so to speak, and italics for its replacement)</p>\n\n<p>you thus replace <strong><code>a</code></strong> with the oparand <em><code>z</code></em> so, now the result is:</p>\n\n<pre><code>(\u03bb b c . c b z) z (\u03bb w v . w)</code></pre>\n\n<p>So we replaced <code>a</code> by <code>z</code> in the <strong>scope of the lambda expression</strong>, next we perform an additional reduction:</p>\n\n<pre><code>(\u03bb <b>b</b> c . c <b>b</b> z) <i>z</i> (\u03bb w v . w)</code></pre>\n\n<p>to:</p>\n\n<pre><code>(\u03bb c . c z z) (\u03bb w v . w)</code></pre>\n\n<p>Now you can also use beta-reduction to <strong>inject functions</strong> as is demonstrated here:</p>\n\n<pre><code>(\u03bb <b>c</b> . <b>c</b> z z) <i>(\u03bb w v . w)</i></code></pre>\n\n<p>Into:</p>\n\n<pre><code>((\u03bb w v . w) z z)</code></pre>\n\n<p>So we have not ended yet. Because again there is a lambda expression in the head:</p>\n\n<pre><code>(\u03bb <b>w</b> v . <b>w</b>) <i>z</i> z</code></pre>\n\n<p>into:</p>\n\n<pre><code>(\u03bb v . z) z</code></pre>\n\n<p>and finally the book demonstrates that a variable in the head does not need a variable in the body, so the last beta-reduction has no effect <strong>on the body</strong> (but it removes the last lambda-expression):</p>\n\n<pre><code>(\u03bb <b>v</b> . z) <i>z</i></code></pre>\n\n<p>into:</p>\n\n<pre><code>(z)</code></pre>\n\n<p>or:</p>\n\n<pre><code>z\n</code></pre>\n\n<p>Beta reduction is more or less what is behind every functional programming language: Haskell calls the beta-reduction repeatedly - if needed, since it is lazy - until the resulting value is derived.</p>\n"}], "owner": {"reputation": 25967, "user_id": 1743843, "user_type": "registered", "accept_rate": 77, "profile_image": "https://www.gravatar.com/avatar/8ea2c1d9051e40332376a07bc166d9d5?s=128&d=identicon&r=PG&f=1", "display_name": "softshipper", "link": "https://stackoverflow.com/users/1743843/softshipper"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 131, "favorite_count": 0, "accepted_answer_id": 41831335, "answer_count": 1, "score": 4, "last_activity_date": 1485273315, "creation_date": 1485269147, "last_edit_date": 1485270987, "question_id": 41831091, "link": "https://stackoverflow.com/questions/41831091/working-with-beta-reduce", "title": "Working with beta reduce", "body": "<p>I brought the <a href=\"http://haskellbook.com/\" rel=\"nofollow noreferrer\">Haskell book</a> and struggle with beta reduce.</p>\n\n<p>I do understand the concept but do not know, how to use it, when I have a lambda in front of me.\nFor example:</p>\n\n<pre><code>(\u03bb a b c . c b a) z z (\u03bb w v . w)\n</code></pre>\n\n<p>How to reduce it?</p>\n"}, {"tags": ["haskell", "io", "functional-programming", "monads", "side-effects"], "comments": [{"owner": {"reputation": 51584, "user_id": 839246, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/9b0573c2b936b12828dd1e4cc04206dc?s=128&d=identicon&r=PG&f=1", "display_name": "bheklilr", "link": "https://stackoverflow.com/users/839246/bheklilr"}, "edited": false, "score": 1, "creation_date": 1485267421, "post_id": 41829618, "comment_id": 70847697, "body": "(commenting because I&#39;m not 100% sure of this) My understanding is that IO is modeled as a low level state monad with the &quot;real world&quot; as the state.  The compiler/runtime actually converts that into IO operations that are implemented using bindings to the operating system&#39;s API.  A purely functional programming would be able to calculate anything, but not tell anyone about it.  We need a runtime that can convert these stateful actions on the real world into actual calls to the underlying operating system."}, {"owner": {"reputation": 148712, "user_id": 19750, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/13b41b2620da0b1e630715e0c91a0b03?s=128&d=identicon&r=PG", "display_name": "Josh Lee", "link": "https://stackoverflow.com/users/19750/josh-lee"}, "edited": false, "score": 0, "creation_date": 1485268076, "post_id": 41829618, "comment_id": 70848154, "body": "<a href=\"https://wiki.haskell.org/IO_inside#Welcome_to_the_RealWorld.2C_baby\" rel=\"nofollow noreferrer\">wiki.haskell.org/IO_inside#Welcome_to_the_RealWorld.2C_baby</a>"}, {"owner": {"reputation": 243, "user_id": 13679816, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/7b02acae66c6a347786eb93e8cbead85?s=128&d=identicon&r=PG", "display_name": "atravers", "link": "https://stackoverflow.com/users/13679816/atravers"}, "edited": false, "score": 0, "creation_date": 1606269560, "post_id": 41829618, "comment_id": 114911778, "body": "Read John Launchbury and Simon Peyton Jones&#39;s <a href=\"https://citeseerx.ist.psu.edu/viewdoc/download?doi=10.1.1.52.3656&amp;rep=rep1&amp;type=pdf\" rel=\"nofollow noreferrer\">State in Haskell</a>."}], "answers": [{"tags": [], "owner": {"reputation": 24028, "user_id": 383200, "user_type": "registered", "accept_rate": 60, "profile_image": "https://www.gravatar.com/avatar/a9dc722f936cb1059adaae4fe39c07f0?s=128&d=identicon&r=PG", "display_name": "Carl", "link": "https://stackoverflow.com/users/383200/carl"}, "is_accepted": true, "score": 17, "last_activity_date": 1485267953, "creation_date": 1485267953, "answer_id": 41830646, "question_id": 41829618, "link": "https://stackoverflow.com/questions/41829618/functional-programming-where-does-the-side-effect-actually-happen/41830646#41830646", "title": "Functional programming : Where does the side effect actually happen?", "body": "<p>As a preface, it's not \"the <code>IO</code> <code>Monad</code>\", despite what many poorly-written introductions say.  It's just \"the <code>IO</code> type\".  There's nothing magical about monads.  Haskell's <code>Monad</code> class is a pretty boring thing - it's just unfamiliar and more abstract than what most languages can support. You don't ever see anyone call <code>IO</code> \"the <code>IO</code> <code>Alternative</code>,\" even though <code>IO</code> implements <code>Alternative</code>.  Focusing too much on <code>Monad</code> only gets in the way of learning.</p>\n\n<p>The conceptual magic for principled handling of effects (<em>not</em> side-effects!) in pure languages is the existence of an <code>IO</code> type at all. It's a real type. It's not some flag saying \"This is impure!\".  It's a full Haskell type of kind <code>* -&gt; *</code>, just like <code>Maybe</code> or <code>[]</code>. Type signatures accepting IO values as arguments, like <code>IO a -&gt; IO (Maybe a)</code>, make sense.  Type signatures with nested IO make sense, like <code>IO (IO a)</code>.</p>\n\n<p>So if it's a real type, it must have a concrete meaning. <code>Maybe a</code> as a type represents a possibly-missing value of type <code>a</code>.  <code>[a]</code> means 0 or more values of type <code>a</code>. <code>IO a</code> means a sequence of effects that produce a value of type <code>a</code>.</p>\n\n<p>Note that the entire purpose of <code>IO</code> is to represent a sequence of effects. As I said above, they're not side effects. They can't be hidden away in an innocuous-looking leaf of the program and mysteriously change things behind the back of other code. Instead, effects are rather explicitly called out by the fact that they're an <code>IO</code> value.  This is why people attempt to minimize the part of their program using <code>IO</code> types. The less that you do there, the fewer ways there are for spooky action at a distance to interfere with your program.</p>\n\n<p>As to the main thrust of your question, then - a complete Haskell program is an <code>IO</code> value called <code>main</code>, and the collection of definitions it uses. The compiler, when it generates code, inserts a decidedly non-Haskell block of code that actually runs the sequence of effects in an <code>IO</code> value. In some sense, this is what Simon Peyton Jones (one of the long-time authors of GHC) was getting at in his talk <a href=\"https://www.youtube.com/watch?v=iSmkqocn0oQ\">Haskell is useless</a>.</p>\n\n<p>It's true that whatever actually executes the IO action cannot remain conceptually pure. (And there is that very impure function that runs <code>IO</code> actions exposed within the Haskell language. I won't say more about it than it was added to support the foreign function interface, and using it improperly will break your program very badly.) But the point of Haskell is to provide a principled interface to the effect system, and hide away the unprincipled bits.  And it does that in a way that's actually quite useful in practice.</p>\n"}], "owner": {"reputation": 629, "user_id": 3083061, "user_type": "registered", "accept_rate": 33, "profile_image": "https://www.gravatar.com/avatar/79e9fefa05d861698e88df02c5a1f0b6?s=128&d=identicon&r=PG&f=1", "display_name": "kondor", "link": "https://stackoverflow.com/users/3083061/kondor"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 569, "favorite_count": 1, "accepted_answer_id": 41830646, "answer_count": 1, "score": 2, "last_activity_date": 1485273128, "creation_date": 1485264923, "last_edit_date": 1485273128, "question_id": 41829618, "link": "https://stackoverflow.com/questions/41829618/functional-programming-where-does-the-side-effect-actually-happen", "title": "Functional programming : Where does the side effect actually happen?", "body": "<p>After beginning to learn Haskell, there something I don't understand in Haskell even after reading a lot of documentation.</p>\n\n<p>I understand that to perform IO operation you have to use a \"IO monad\" that wrapped a value in a kind of \"black box\" so the any function that uses the IO monad is still purely functional. OK, fine, but then where does the IO operation actually happen?</p>\n\n<p>Does it mean that a Monad itself is not purely functional? Or is the IO operation implemented, let's say in C, and \"embedded\" inside the Haskell compiler?</p>\n\n<p>Can I write, in pure Haskell, with or without a Monad, something that will do an IO operation? And if not, where does this ability come from if it's not possible inside the language itself? If it's embedded/linked inside the Haskell compiler to chunks of C code, will that eventually be called by the IO Monad to do the \"dirty job\"?</p>\n"}, {"tags": ["haskell"], "comments": [{"owner": {"reputation": 314794, "user_id": 67579, "user_type": "registered", "accept_rate": 81, "profile_image": "https://i.stack.imgur.com/BJXub.png?s=128&g=1", "display_name": "Willem Van Onsem", "link": "https://stackoverflow.com/users/67579/willem-van-onsem"}, "edited": false, "score": 0, "creation_date": 1485262870, "post_id": 41828859, "comment_id": 70844500, "body": "Please print the compiler error as well."}, {"owner": {"reputation": 49, "user_id": 6473325, "user_type": "registered", "accept_rate": 0, "profile_image": "https://www.gravatar.com/avatar/83a984b18bddba398c7bea7cfc0e3305?s=128&d=identicon&r=PG&f=1", "display_name": "Amateur", "link": "https://stackoverflow.com/users/6473325/amateur"}, "reply_to_user": {"reputation": 314794, "user_id": 67579, "user_type": "registered", "accept_rate": 81, "profile_image": "https://i.stack.imgur.com/BJXub.png?s=128&g=1", "display_name": "Willem Van Onsem", "link": "https://stackoverflow.com/users/67579/willem-van-onsem"}, "edited": false, "score": 0, "creation_date": 1485262936, "post_id": 41828859, "comment_id": 70844544, "body": "Compiler error is:"}, {"owner": {"reputation": 49, "user_id": 6473325, "user_type": "registered", "accept_rate": 0, "profile_image": "https://www.gravatar.com/avatar/83a984b18bddba398c7bea7cfc0e3305?s=128&d=identicon&r=PG&f=1", "display_name": "Amateur", "link": "https://stackoverflow.com/users/6473325/amateur"}, "reply_to_user": {"reputation": 314794, "user_id": 67579, "user_type": "registered", "accept_rate": 81, "profile_image": "https://i.stack.imgur.com/BJXub.png?s=128&g=1", "display_name": "Willem Van Onsem", "link": "https://stackoverflow.com/users/67579/willem-van-onsem"}, "edited": false, "score": 0, "creation_date": 1485262943, "post_id": 41828859, "comment_id": 70844551, "body": "No instance for (Floating Integer) arising from a use of \u2018res\u2019         In the expression: res fibs         In an equation for \u2018it\u2019: it = res fibs"}, {"owner": {"reputation": 314794, "user_id": 67579, "user_type": "registered", "accept_rate": 81, "profile_image": "https://i.stack.imgur.com/BJXub.png?s=128&g=1", "display_name": "Willem Van Onsem", "link": "https://stackoverflow.com/users/67579/willem-van-onsem"}, "edited": false, "score": 0, "creation_date": 1485262985, "post_id": 41828859, "comment_id": 70844579, "body": "Please in the future <a href=\"http://stackoverflow.com/posts/41828859/edit\">edit</a> your question."}, {"owner": {"reputation": 49, "user_id": 6473325, "user_type": "registered", "accept_rate": 0, "profile_image": "https://www.gravatar.com/avatar/83a984b18bddba398c7bea7cfc0e3305?s=128&d=identicon&r=PG&f=1", "display_name": "Amateur", "link": "https://stackoverflow.com/users/6473325/amateur"}, "reply_to_user": {"reputation": 314794, "user_id": 67579, "user_type": "registered", "accept_rate": 81, "profile_image": "https://i.stack.imgur.com/BJXub.png?s=128&g=1", "display_name": "Willem Van Onsem", "link": "https://stackoverflow.com/users/67579/willem-van-onsem"}, "edited": false, "score": 1, "creation_date": 1485263092, "post_id": 41828859, "comment_id": 70844664, "body": "I&#39;m running the code by typing res fibs in GHCI 7.10.3.  and...noted Willem."}, {"owner": {"reputation": 314794, "user_id": 67579, "user_type": "registered", "accept_rate": 81, "profile_image": "https://i.stack.imgur.com/BJXub.png?s=128&g=1", "display_name": "Willem Van Onsem", "link": "https://stackoverflow.com/users/67579/willem-van-onsem"}, "edited": false, "score": 0, "creation_date": 1485263151, "post_id": 41828859, "comment_id": 70844705, "body": "it appears tha the error is not in the function itself. That one compiles, please show the calling code."}, {"owner": {"reputation": 49, "user_id": 6473325, "user_type": "registered", "accept_rate": 0, "profile_image": "https://www.gravatar.com/avatar/83a984b18bddba398c7bea7cfc0e3305?s=128&d=identicon&r=PG&f=1", "display_name": "Amateur", "link": "https://stackoverflow.com/users/6473325/amateur"}, "reply_to_user": {"reputation": 314794, "user_id": 67579, "user_type": "registered", "accept_rate": 81, "profile_image": "https://i.stack.imgur.com/BJXub.png?s=128&g=1", "display_name": "Willem Van Onsem", "link": "https://stackoverflow.com/users/67579/willem-van-onsem"}, "edited": false, "score": 0, "creation_date": 1485263269, "post_id": 41828859, "comment_id": 70844783, "body": "I call by typing res fibs in GHCI 7.10.3"}, {"owner": {"reputation": 384463, "user_id": 1126841, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/fa05233b2357f8d11c22ef4cfc7bb85c?s=128&d=identicon&r=PG", "display_name": "chepner", "link": "https://stackoverflow.com/users/1126841/chepner"}, "edited": false, "score": 0, "creation_date": 1485293570, "post_id": 41828859, "comment_id": 70863974, "body": "Why not just use <code>sort . take 9 . show $ x</code> instead? <code>res = head . filter ((== &quot;123456789&quot;) . sort . take 9 . show) $ fibs</code>."}], "answers": [{"comments": [{"owner": {"reputation": 49, "user_id": 6473325, "user_type": "registered", "accept_rate": 0, "profile_image": "https://www.gravatar.com/avatar/83a984b18bddba398c7bea7cfc0e3305?s=128&d=identicon&r=PG&f=1", "display_name": "Amateur", "link": "https://stackoverflow.com/users/6473325/amateur"}, "edited": false, "score": 0, "creation_date": 1485327494, "post_id": 41829406, "comment_id": 70874823, "body": "Many thanks Willem for your detailed explanation. This is very helpful."}], "tags": [], "owner": {"reputation": 314794, "user_id": 67579, "user_type": "registered", "accept_rate": 81, "profile_image": "https://i.stack.imgur.com/BJXub.png?s=128&g=1", "display_name": "Willem Van Onsem", "link": "https://stackoverflow.com/users/67579/willem-van-onsem"}, "is_accepted": false, "score": 2, "last_activity_date": 1485265078, "last_edit_date": 1485265078, "creation_date": 1485264368, "answer_id": 41829406, "question_id": 41828859, "link": "https://stackoverflow.com/questions/41828859/no-instance-for-floating-integer-arising-from-a-use-of-res/41829406#41829406", "title": "No instance for (Floating Integer) arising from a use of \u2018res\u2019", "body": "<p>You cannot call <code>res fib</code> directly because <code>res</code> has type:</p>\n\n<pre><code>res :: (Floating r, Integral r, RealFrac r, Show r) =&gt; [r] -&gt; r\n</code></pre>\n\n<p>it thus requires a type that is <code>Floating</code>, <code>Integral</code>, <code>RealFrac</code> and <code>Show</code>.</p>\n\n<p>Now it seems that you simply constructed a function that is very problematic for types: you expect the type to be both <code>Floating</code> and <code>Integral</code>.</p>\n\n<p>You can however rewrite your function to:</p>\n\n<pre><code>res (x:xs) | s == sort (show (div x (10^(m - 8)))) = x\n           | otherwise = res xs\n           where m = floor $ logBase 10 $ <b>fromIntegral x</b>\n</code></pre>\n\n<p>now <code>res</code> has type:</p>\n\n<pre><code>res :: (Integral a, Show a) =&gt; [a] -&gt; a\n</code></pre>\n\n<p>If I now run <code>res fib</code>, it gives:</p>\n\n<pre><code>*Main&gt; res fibs\n*** Exception: Negative exponent\n</code></pre>\n\n<p>which is logical, because you feed it a negative exponent <code>(10^(m-8))</code>. My guess is that you simply want to omit these cases, so that you rewrite it to:</p>\n\n<pre><code>res (x:xs) | <b>m >= 8 &&</b> s == sort (show (div x (10^(m - 8)))) = x\n           | otherwise = res xs\n           where m = floor $ logBase 10 $ fromIntegral x\n</code></pre>\n\n<p>If I now run <code>res fibs</code> the program seems to calculate (and does not find a solution in reasonable time, it eventually even eats all available memory).</p>\n\n<p>If you want to inspect that every digit is present however, you cannot simply use sort, since sort will not filter out duplicates.</p>\n"}], "owner": {"reputation": 49, "user_id": 6473325, "user_type": "registered", "accept_rate": 0, "profile_image": "https://www.gravatar.com/avatar/83a984b18bddba398c7bea7cfc0e3305?s=128&d=identicon&r=PG&f=1", "display_name": "Amateur", "link": "https://stackoverflow.com/users/6473325/amateur"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 219, "favorite_count": 0, "answer_count": 1, "score": 1, "last_activity_date": 1485269193, "creation_date": 1485262728, "last_edit_date": 1485269193, "question_id": 41828859, "link": "https://stackoverflow.com/questions/41828859/no-instance-for-floating-integer-arising-from-a-use-of-res", "title": "No instance for (Floating Integer) arising from a use of \u2018res\u2019", "body": "<pre><code>import Data.List\n\ns = \"123456789\"\n\nfibs = 1 : scanl (+) 1 fibs\nres (x:xs) = if (sort. show $ div x (10^(floor(m) - 8))) == s then x else res       xs\n where m = logBase 10 x\n</code></pre>\n\n<p>The code picks the first 9 digits of a fib number and checks if they match the variable s. I have tried to fix this by inserting fromIntegral in various areas, but I can't seem to make it work, especially because the of the error references the function 'res'. Please point me in the right direction.</p>\n\n<p>The error I get is:</p>\n\n<pre><code>No instance for (Floating Integer) arising from a use of \u2018res\u2019\nIn the expression: res fibs\nIn an equation for \u2018it\u2019: it = res fibs\n</code></pre>\n"}, {"tags": ["haskell", "functor"], "comments": [{"owner": {"reputation": 100892, "user_id": 745903, "user_type": "registered", "accept_rate": 74, "profile_image": "https://www.gravatar.com/avatar/50933f6638836741e620669b3940410e?s=128&d=identicon&r=PG", "display_name": "leftaroundabout", "link": "https://stackoverflow.com/users/745903/leftaroundabout"}, "edited": false, "score": 4, "creation_date": 1485256125, "post_id": 41826223, "comment_id": 70840180, "body": "That&#39;s a bit like using exp (<i>a</i> + <i>b</i>) = exp <i>a</i> \u22c5 exp <i>b</i> = exp <i>b</i> \u22c5 exp <i>a</i> = exp (<i>b</i> + <i>a</i>) to prove commutativity of addition... namely: with <code>do</code> syntax, you exploit the <code>Monad</code> instance, and every monad is first and foremostly a functor. \u2014 I don&#39;t think it&#39;s really possible to prove that <code>IO</code> obeys all the laws, since its semantics are fundamentally intertwined with runtime evaluation. In fact it&#39;s somewhat contested if <code>IO</code> <i>is</i> properly law-abiding. But normally, we can quite well take it as something of an <i>axiom</i> that <code>IO</code> obeys the laws."}, {"owner": {"reputation": 7030, "user_id": 3032349, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/3cd8d19756aa9bc73d8045ae988ae728?s=128&d=identicon&r=PG&f=1", "display_name": "ThreeFx", "link": "https://stackoverflow.com/users/3032349/threefx"}, "edited": false, "score": 0, "creation_date": 1485256475, "post_id": 41826223, "comment_id": 70840396, "body": "Since you are already using the monadic definition of the <code>IO</code> monad, (even with <code>ApplicativeDo</code>, applicative is strong enough too), you can simply use the fact that <code>fmap f = (&gt;&gt;= return . f)</code> for monads."}, {"owner": {"reputation": 7030, "user_id": 3032349, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/3cd8d19756aa9bc73d8045ae988ae728?s=128&d=identicon&r=PG&f=1", "display_name": "ThreeFx", "link": "https://stackoverflow.com/users/3032349/threefx"}, "reply_to_user": {"reputation": 100892, "user_id": 745903, "user_type": "registered", "accept_rate": 74, "profile_image": "https://www.gravatar.com/avatar/50933f6638836741e620669b3940410e?s=128&d=identicon&r=PG", "display_name": "leftaroundabout", "link": "https://stackoverflow.com/users/745903/leftaroundabout"}, "edited": false, "score": 1, "creation_date": 1485256723, "post_id": 41826223, "comment_id": 70840564, "body": "@leftaroundabout If I understand correctly, the <code>IO</code> newtype is a special state monad. Can you not just prove the laws for <code>State</code> in that case?"}, {"owner": {"reputation": 100892, "user_id": 745903, "user_type": "registered", "accept_rate": 74, "profile_image": "https://www.gravatar.com/avatar/50933f6638836741e620669b3940410e?s=128&d=identicon&r=PG", "display_name": "leftaroundabout", "link": "https://stackoverflow.com/users/745903/leftaroundabout"}, "reply_to_user": {"reputation": 7030, "user_id": 3032349, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/3cd8d19756aa9bc73d8045ae988ae728?s=128&d=identicon&r=PG&f=1", "display_name": "ThreeFx", "link": "https://stackoverflow.com/users/3032349/threefx"}, "edited": false, "score": 1, "creation_date": 1485262627, "post_id": 41826223, "comment_id": 70844324, "body": "@ThreeFx: kinda, I suppose; but <code>RealWorld</code> is \u201cdeeply magical\u201d. That&#39;s not too helpful when you&#39;re trying to prove something."}, {"owner": {"reputation": 384463, "user_id": 1126841, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/fa05233b2357f8d11c22ef4cfc7bb85c?s=128&d=identicon&r=PG", "display_name": "chepner", "link": "https://stackoverflow.com/users/1126841/chepner"}, "edited": false, "score": 1, "creation_date": 1485264922, "post_id": 41826223, "comment_id": 70845928, "body": "The magical nature of <code>RealWorld</code> shouldn&#39;t affect the <code>Functor</code> instance of <code>State a</code> (okay, <code>State# a</code> really), though, should it, since <code>fmap</code> doesn&#39;t (and cannot) make any assumptions about <code>a</code>?"}, {"owner": {"reputation": 2019, "user_id": 5800895, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/0cab3b0361b7e54267c70c02754f21de?s=128&d=identicon&r=PG&f=1", "display_name": "Derek Elkins left SE", "link": "https://stackoverflow.com/users/5800895/derek-elkins-left-se"}, "edited": false, "score": 1, "creation_date": 1485293474, "post_id": 41826223, "comment_id": 70863934, "body": "Please don&#39;t think of <code>IO</code> as a &quot;special state monad&quot;.  That&#39;s an admitted hack in the GHC implementation. As a conceptual model it becomes utterly ridiculous when you incorporate concurrency (<code>forkIO</code>, <code>MVar</code>)."}], "owner": {"reputation": 91, "user_id": 6542453, "user_type": "registered", "accept_rate": 56, "profile_image": "https://www.gravatar.com/avatar/ecc896c6aac5ea73c520da4d6b79f4c3?s=128&d=identicon&r=PG&f=1", "display_name": "user6542453", "link": "https://stackoverflow.com/users/6542453/user6542453"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 218, "favorite_count": 1, "answer_count": 0, "score": 3, "last_activity_date": 1485262513, "creation_date": 1485254964, "last_edit_date": 1485262513, "question_id": 41826223, "link": "https://stackoverflow.com/questions/41826223/proving-functor-laws-for-io-instance", "title": "Proving functor laws for IO instance", "body": "<p>How can I prove the functor laws for the <code>IO</code> instance, which is:</p>\n\n<pre><code>instance Functor IO where\n    fmap f action = do\n        result &lt;- action\n        return (f result)\n</code></pre>\n\n<p>These are the steps that I have used:</p>\n\n<pre><code>fmap id m == fmap id action\n          == id action\n\nfmap (f.g) action = ?\n(fmap f . fmap g) action = ?\n</code></pre>\n"}, {"tags": ["sqlite", "haskell", "monads"], "answers": [{"tags": [], "owner": {"reputation": 2863, "user_id": 2297560, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/948d4a17494b3c616a0873453b74670c?s=128&d=identicon&r=PG", "display_name": "user2297560", "link": "https://stackoverflow.com/users/2297560/user2297560"}, "is_accepted": true, "score": 3, "last_activity_date": 1485272000, "last_edit_date": 1485272000, "creation_date": 1485265983, "answer_id": 41829995, "question_id": 41825686, "link": "https://stackoverflow.com/questions/41825686/using-readert-and-runreadert-with-sqlite/41829995#41829995", "title": "Using ReaderT and runReaderT with SQLite?", "body": "<p>1) In this example, the purpose of <code>ReaderT</code> is to make a value of type <code>SQLiteHandle</code> available to the functions without adding an additional parameter to each function.</p>\n\n<p>2) <code>runReaderT</code> \"unwraps\" the <code>ReaderT</code>: <code>newtype ReaderT r m a = ReaderT { runReaderT :: r -&gt; m a}</code>. As you can see, the real representation is <code>r -&gt; m a</code>: a function from the provided item of type <code>r</code> to the <code>m a</code> that you thought you were dealing with directly. Thus <code>ReaderT</code> isn't really avoiding the fact that a new parameter has to be added to your functions; it's just hiding it for you.</p>\n\n<p>3) <code>runReaderT ask ==  runReaderT $ ReaderT return  ==  return  ==  r -&gt; m r</code> Thus <code>ask</code> is providing access to the \"environment\" <code>r</code> (the extra parameter) simply by wrapping it in the underlying monad.</p>\n\n<p>Here's a very simple (admittedly too simple to be realistic) example.</p>\n\n<pre><code>type ModeFlag = Int\n\ng :: ModeFlag -&gt; IO ()\ng modeFlag = ... -- take some action based on modeFlag\n</code></pre>\n\n<p>is equivalent to</p>\n\n<pre><code>h :: ReaderT ModeFlag IO ()\nh = do\n  modeFlag &lt;- ask\n  ... -- take some action based on modeFlag\n</code></pre>\n\n<p>The utility of this technique wasn't immediately obvious to me when I started learning Haskell. However, consider the case where you have many configuration parameters or you may foresee the need to add more configuration parameters soon. Adding new arguments to functions is very inconvenient. Instead, just pack your configuration values into a record and provide it throughout your application via <code>ReaderT</code>. There's a function called <code>asks</code> that is like <code>ask</code> but also takes a function to apply to the <code>r</code> value. This can be used to extract certain fields from a record.</p>\n\n<pre><code>data Config :: Config { param1 :: Int, param2 :: String, ... other fields }\n\ndoStuff :: ReaderT Config IO ()\ndoStuff = do\n  i &lt;- asks param1\n  s &lt;- asks param2\n  undefined -- do some stuff\n</code></pre>\n\n<p>There are some more examples of <code>Reader</code> and <code>ReaderT</code> in the documentation (<a href=\"http://hackage.haskell.org/package/mtl-2.2.1/docs/Control-Monad-Reader.html\" rel=\"nofollow noreferrer\">http://hackage.haskell.org/package/mtl-2.2.1/docs/Control-Monad-Reader.html</a> at the bottom), including the <code>local</code> function which is pretty cool but I haven't used much.</p>\n"}], "owner": {"reputation": 2691, "user_id": 5477287, "user_type": "registered", "accept_rate": 87, "profile_image": "https://i.stack.imgur.com/yKMgF.jpg?s=128&g=1", "display_name": "Babra Cunningham", "link": "https://stackoverflow.com/users/5477287/babra-cunningham"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 201, "favorite_count": 1, "accepted_answer_id": 41829995, "answer_count": 1, "score": 2, "last_activity_date": 1485272000, "creation_date": 1485253506, "question_id": 41825686, "link": "https://stackoverflow.com/questions/41825686/using-readert-and-runreadert-with-sqlite", "title": "Using ReaderT and runReaderT with SQLite?", "body": "<p>I've the below code, taken from <a href=\"https://github.com/simonmar/haskell-eXchange-2015/blob/3ae0e34a051201eb77721bee2e940ec1f764a0df/BlogDB.hs\" rel=\"nofollow noreferrer\">here</a>: </p>\n\n<pre><code>type Blog a = ReaderT SQLiteHandle IO a\ndata BlogDBException = BlogDBException String deriving (Show, Typeable)\ninstance Exception BlogDBException \n\nrun :: Blog a -&gt; IO a\nrun m = do \n  db &lt;- openConnection \"myblog.db\"\n  runReaderT m db --runReaderT :: ReaderT r m a -&gt; (r -&gt; m a)\n\n\nsql :: String -&gt; Blog (Either String[[Row Value]])\nsql query = do\n  db &lt;- ask --ask :: Monad m =&gt; ReaderT r m r\n  liftIO $ do\n    putStrLn query\n    execStatement db query\n\n\ndbQuery :: Blog [Int]\ndbQuery = do \n   r &lt;- sql \"select UID from UIDS;\"\n   case r of \n    Right [rows] -&gt; return [fromIntegral uid | [(_, Int uid)] &lt;- rows]\n    Left s -&gt; liftIO $ throwIO (BlogDBException s)\n    _ -&gt; liftIO $ throwIO (BlogDBException \"Invalid result\")\n</code></pre>\n\n<p>I'm trying to understand </p>\n\n<p>1) the exact role of <code>readerT</code> in <code>data Blog a</code>? </p>\n\n<p>2) exactly what is <code>runReaderT</code> doing here? </p>\n\n<p>3) how does the <code>ask</code> function work? </p>\n\n<p>Does anyone have a straightforward explanation? This is my first time working with the <code>Reader</code> monad.</p>\n"}, {"tags": ["haskell", "ghci"], "comments": [{"owner": {"reputation": 777, "user_id": 5303318, "user_type": "registered", "accept_rate": 62, "profile_image": "https://lh6.googleusercontent.com/-qykohYXsIz0/AAAAAAAAAAI/AAAAAAAAADc/G9CJWc1s3dM/photo.jpg?sz=128", "display_name": "milad zahedi", "link": "https://stackoverflow.com/users/5303318/milad-zahedi"}, "edited": false, "score": 0, "creation_date": 1485253353, "post_id": 41825586, "comment_id": 70838327, "body": "someone on haskell channel gave the following comment : &quot;use the sandbox&#39;s ghci wrapper or it won;t be able to see the sandbox&quot;"}, {"owner": {"reputation": 777, "user_id": 5303318, "user_type": "registered", "accept_rate": 62, "profile_image": "https://lh6.googleusercontent.com/-qykohYXsIz0/AAAAAAAAAAI/AAAAAAAAADc/G9CJWc1s3dM/photo.jpg?sz=128", "display_name": "milad zahedi", "link": "https://stackoverflow.com/users/5303318/milad-zahedi"}, "edited": false, "score": 0, "creation_date": 1485253481, "post_id": 41825586, "comment_id": 70838436, "body": "he also said : &quot;sandboxes hide stuff from ghc, that&#39;s the point. ghci is ghc; it won&#39;t see inside the sandbox unless specifically run within the sandbox. which means the wrappers I mentioned, or stack/cabal exec ghci)&quot;"}], "answers": [{"tags": [], "owner": {"reputation": 777, "user_id": 5303318, "user_type": "registered", "accept_rate": 62, "profile_image": "https://lh6.googleusercontent.com/-qykohYXsIz0/AAAAAAAAAAI/AAAAAAAAADc/G9CJWc1s3dM/photo.jpg?sz=128", "display_name": "milad zahedi", "link": "https://stackoverflow.com/users/5303318/milad-zahedi"}, "is_accepted": false, "score": 2, "last_activity_date": 1485253716, "last_edit_date": 1485253716, "creation_date": 1485253617, "answer_id": 41825731, "question_id": 41825586, "link": "https://stackoverflow.com/questions/41825586/cabal-dependency-is-not-recognized-by-ghci/41825731#41825731", "title": "cabal dependency is not recognized by ghci", "body": "<p>for documentation purposes I write the answer here.\nwith help of geekosaur from Haskell IRC chanell all I needed to do was : </p>\n\n<pre><code>stack/cabal exec ghci\n</code></pre>\n"}], "owner": {"reputation": 777, "user_id": 5303318, "user_type": "registered", "accept_rate": 62, "profile_image": "https://lh6.googleusercontent.com/-qykohYXsIz0/AAAAAAAAAAI/AAAAAAAAADc/G9CJWc1s3dM/photo.jpg?sz=128", "display_name": "milad zahedi", "link": "https://stackoverflow.com/users/5303318/milad-zahedi"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 73, "favorite_count": 0, "answer_count": 1, "score": 0, "last_activity_date": 1485253716, "creation_date": 1485253218, "question_id": 41825586, "link": "https://stackoverflow.com/questions/41825586/cabal-dependency-is-not-recognized-by-ghci", "title": "cabal dependency is not recognized by ghci", "body": "<p>I have a project in a sandbox and it has a dependency (mongoDB). when I build the project it build fine but when I want to load a .hs file into ghci it says \"Failed to load interface for \u2018Database.MongoDB\u2019\". what is going on here ?</p>\n\n<p>info : I create sandbox using <code>cabal sandbox init</code> instead of <code>cabal sandbox init --sandbox =.</code></p>\n"}, {"tags": ["haskell", "type-families"], "owner": {"reputation": 1106, "user_id": 4197293, "user_type": "registered", "accept_rate": 83, "profile_image": "https://www.gravatar.com/avatar/fdd3542179c9735316f934724992b7ce?s=128&d=identicon&r=PG", "display_name": "jeiea", "link": "https://stackoverflow.com/users/4197293/jeiea"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 122, "favorite_count": 0, "answer_count": 0, "score": 1, "last_activity_date": 1485248056, "creation_date": 1485248056, "question_id": 41823796, "link": "https://stackoverflow.com/questions/41823796/how-can-i-make-this-work-conditional-typeclass-instance", "title": "How can I make this work? (Conditional typeclass instance)", "body": "<p>I want to insert <code>trace</code> in Monad's <code>bind</code>, but it requires <code>Show</code> instance and makes many other instances to be modified.</p>\n\n<p>I saw <a href=\"https://wiki.haskell.org/GHC/AdvancedOverlap#Solution_3_.28using_closed_type_families.29\" rel=\"nofollow noreferrer\">this</a>, and it seems the last one is the best solution. But there's no full example code, and I don't have enough knowledge yet about this language extension.</p>\n\n<p>Could there be any better solution? And what's the problem of the below code?</p>\n\n<pre><code>{-# LANGUAGE MultiParamTypeClasses, TypeFamilies, FlexibleInstances #-}\n{-# LANGUAGE UndecidableInstances, FlexibleContexts #-}\n\ndata STrue = STrue\ndata SFalse = SFalse\n\ntype family ShowPred a where\n  ShowPred Char = STrue\n  ShowPred [Char] = STrue\n  ShowPred a = SFalse\n\nclass Print' flag a where\n  print' :: flag -&gt; a -&gt; b -&gt; b\ninstance Show a =&gt; Print' STrue a where\n  print' _ s v = traceShow s v\ninstance Print' SFalse a where\n  print' _ _ = id\n\ninstance (ShowPred [t] ~ flag, Print' flag [t]) =&gt; Monad (Parser t) where\n    return x     = P (\\ts-&gt; Success ts x)\n    fail e       = P (\\ts-&gt; Failure ts e)\n    (P f) &gt;&gt;= g  = P (continue . f)\n      where\n        continue (Success ts x) = let (P g') = g x in {- print' (undefined :: flag) ts $ -} g' ts\n        continue (Committed r)  = Committed (continue r)\n        continue (Failure ts e) = Failure ts e\n</code></pre>\n"}, {"tags": ["haskell", "monad-transformers", "deriving"], "answers": [{"comments": [{"owner": {"reputation": 4593, "user_id": 2289983, "user_type": "registered", "accept_rate": 92, "profile_image": "https://i.stack.imgur.com/LG4hj.jpg?s=128&g=1", "display_name": "Damian Nadales", "link": "https://stackoverflow.com/users/2289983/damian-nadales"}, "edited": false, "score": 0, "creation_date": 1485255455, "post_id": 41824375, "comment_id": 70839740, "body": "What do you mean by &quot;underlying instance for a class&quot; in this context?"}, {"owner": {"reputation": 4593, "user_id": 2289983, "user_type": "registered", "accept_rate": 92, "profile_image": "https://i.stack.imgur.com/LG4hj.jpg?s=128&g=1", "display_name": "Damian Nadales", "link": "https://stackoverflow.com/users/2289983/damian-nadales"}, "edited": false, "score": 0, "creation_date": 1485255766, "post_id": 41824375, "comment_id": 70839951, "body": "Is there a way to derive trivial instances for <code>MonadTrans</code>?"}, {"owner": {"reputation": 4593, "user_id": 2289983, "user_type": "registered", "accept_rate": 92, "profile_image": "https://i.stack.imgur.com/LG4hj.jpg?s=128&g=1", "display_name": "Damian Nadales", "link": "https://stackoverflow.com/users/2289983/damian-nadales"}, "edited": false, "score": 0, "creation_date": 1512062731, "post_id": 41824375, "comment_id": 82115425, "body": "Almost a year later <a href=\"https://stackoverflow.com/questions/47579216/doing-dependency-injection-using-monad-stacks\">it seems I keep on hitting the same wall</a>."}], "tags": [], "owner": {"reputation": 5992, "user_id": 74497, "user_type": "registered", "accept_rate": 78, "profile_image": "https://www.gravatar.com/avatar/0d4a7e6c8edd88e835508df8397592e5?s=128&d=identicon&r=PG", "display_name": "ocharles", "link": "https://stackoverflow.com/users/74497/ocharles"}, "is_accepted": true, "score": 9, "last_activity_date": 1485249725, "creation_date": 1485249725, "answer_id": 41824375, "question_id": 41823706, "link": "https://stackoverflow.com/questions/41823706/cannot-make-a-derived-instance-of-monad-transformer/41824375#41824375", "title": "Cannot make a derived instance of monad transformer", "body": "<p><code>GeneralizedNewtypeDeriving</code> uses the underlying instance for a class for the implementation of the class for the <code>newtype</code>. However, in this case that doesn't make any sense, because <code>m</code> isn't of the right kind to even be an instance of <code>MonadTrans</code> (recall that <code>m :: * -&gt; *</code>, but <code>MonadTrans</code> wants <code>(* -&gt; *) -&gt; * -&gt; *</code>).</p>\n"}], "owner": {"reputation": 4593, "user_id": 2289983, "user_type": "registered", "accept_rate": 92, "profile_image": "https://i.stack.imgur.com/LG4hj.jpg?s=128&g=1", "display_name": "Damian Nadales", "link": "https://stackoverflow.com/users/2289983/damian-nadales"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 526, "favorite_count": 0, "accepted_answer_id": 41824375, "answer_count": 1, "score": 6, "last_activity_date": 1485249725, "creation_date": 1485247802, "question_id": 41823706, "link": "https://stackoverflow.com/questions/41823706/cannot-make-a-derived-instance-of-monad-transformer", "title": "Cannot make a derived instance of monad transformer", "body": "<p>I have the following <code>newtype</code>:</p>\n\n<pre><code>{-# LANGUAGE GeneralizedNewtypeDeriving #-}\n\nnewtype Wrap m a = Wrap {runWrap :: m a}\n  deriving (Functor, Applicative, Monad, MonadTrans)\n</code></pre>\n\n<p>I'm trying to derive <code>MonadTrans</code> automatically, but I get the following error:</p>\n\n<pre><code>\u2022 Can't make a derived instance of \u2018MonadTrans Wrap\u2019\n    (even with cunning GeneralizedNewtypeDeriving):\n    cannot eta-reduce the representation type enough\n\u2022 In the newtype declaration for \u2018Wrap\u2019\n</code></pre>\n\n<p>However, writing the trivial instance for <code>MonadTrans</code> works just fine:</p>\n\n<pre><code>instance MonadTrans Wrap where\n  lift = Wrap\n</code></pre>\n\n<p>What is the reason for such an error message?</p>\n"}, {"tags": ["database", "postgresql", "haskell", "numbers"], "comments": [{"owner": {"reputation": 3231, "user_id": 1013393, "user_type": "registered", "accept_rate": 60, "profile_image": "https://www.gravatar.com/avatar/7bca51e5ae3eb8dc24a98616b4e5d6fd?s=128&d=identicon&r=PG", "display_name": "sjakobi", "link": "https://stackoverflow.com/users/1013393/sjakobi"}, "edited": false, "score": 0, "creation_date": 1485243061, "post_id": 41822107, "comment_id": 70832268, "body": "Note that <code>fromEnum</code> truncates to 0 for values that don&#39;t fit into an <code>Int</code>. If that range is large enough for you, you may as well just use a Postgres <code>bigint</code>. To convert a <code>DiffTime</code> into an <code>Integer</code> you should use <a href=\"http://hackage.haskell.org/package/time-1.7.0.1/docs/Data-Time-Clock.html#v:diffTimeToPicoseconds\" rel=\"nofollow noreferrer\"><code>diffTimeToPicoseconds</code></a>."}, {"owner": {"reputation": 662, "user_id": 668354, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/Yn84u.jpg?s=128&g=1", "display_name": "Mikkel", "link": "https://stackoverflow.com/users/668354/mikkel"}, "reply_to_user": {"reputation": 3231, "user_id": 1013393, "user_type": "registered", "accept_rate": 60, "profile_image": "https://www.gravatar.com/avatar/7bca51e5ae3eb8dc24a98616b4e5d6fd?s=128&d=identicon&r=PG", "display_name": "sjakobi", "link": "https://stackoverflow.com/users/1013393/sjakobi"}, "edited": false, "score": 0, "creation_date": 1485268231, "post_id": 41822107, "comment_id": 70848246, "body": "Thanks for the warning. I did see that function, but also need to do a conversion for <code>NominalDiffTime</code>, which doesn&#39;t have a function like that."}], "answers": [{"comments": [{"owner": {"reputation": 662, "user_id": 668354, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/Yn84u.jpg?s=128&g=1", "display_name": "Mikkel", "link": "https://stackoverflow.com/users/668354/mikkel"}, "edited": false, "score": 0, "creation_date": 1485424596, "post_id": 41822753, "comment_id": 70923673, "body": "Thanks I&#39;ll look at that. Have started to use <code>hasql</code>. Any recommendations for selecting int, rational or float and rational vs. scientific?"}, {"owner": {"reputation": 974, "user_id": 3829232, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/d3d2de116df80bc024b799e84dcdbc97?s=128&d=identicon&r=PG", "display_name": "soupi", "link": "https://stackoverflow.com/users/3829232/soupi"}, "reply_to_user": {"reputation": 662, "user_id": 668354, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/Yn84u.jpg?s=128&g=1", "display_name": "Mikkel", "link": "https://stackoverflow.com/users/668354/mikkel"}, "edited": false, "score": 0, "creation_date": 1485461501, "post_id": 41822753, "comment_id": 70946388, "body": "I think int and float are not precise enough so probably go with scientific, which is supposed to be faster and safer than rational afaik, if you can&#39;t just use interval."}], "tags": [], "owner": {"reputation": 974, "user_id": 3829232, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/d3d2de116df80bc024b799e84dcdbc97?s=128&d=identicon&r=PG", "display_name": "soupi", "link": "https://stackoverflow.com/users/3829232/soupi"}, "is_accepted": true, "score": 5, "last_activity_date": 1485244206, "creation_date": 1485244206, "answer_id": 41822753, "question_id": 41822107, "link": "https://stackoverflow.com/questions/41822107/type-for-storing-difftime-in-database/41822753#41822753", "title": "Type for storing `DiffTime` in database", "body": "<p>I think you might be looking for <a href=\"https://www.postgresql.org/docs/9.6/static/datatype-datetime.html\">interval</a>. The hasql library has an encoder and a decoder for DiffTime with the name <a href=\"http://hackage.haskell.org/package/hasql-0.19.15.2/docs/Hasql-Encoders.html#v:interval\">interval</a> as well.</p>\n"}], "owner": {"reputation": 662, "user_id": 668354, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/Yn84u.jpg?s=128&g=1", "display_name": "Mikkel", "link": "https://stackoverflow.com/users/668354/mikkel"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 80, "favorite_count": 0, "accepted_answer_id": 41822753, "answer_count": 1, "score": 2, "last_activity_date": 1485244206, "creation_date": 1485241864, "question_id": 41822107, "link": "https://stackoverflow.com/questions/41822107/type-for-storing-difftime-in-database", "title": "Type for storing `DiffTime` in database", "body": "<p>I need to store a <code>DiffTime</code> from the <code>time</code> library in a database (PostgreSQL) and have three options for converting to a database type:</p>\n\n<ol>\n<li>Integer using <code>fromIntegral . fromEnum</code></li>\n<li>Numeric via Rational <code>toRational</code></li>\n<li>Real using <code>realToFrac</code></li>\n</ol>\n\n<p>The integer is exact, but rather large, since stored in pico seconds (10^12). Numeric is also exact, but it is potentially very expensive to calculate a <code>Rational</code>, since it has to calculate <code>gcd</code> for numerator and denominator. The real is inexact, but maybe that doesn't matter.</p>\n\n<p>My time granularity would never be below minutes or larger than a couple of days. I need to make exact calculations. Speed is probably not an issue.</p>\n\n<p>Which option should I choose and what are the implications? Should Rational generally be avoided when handling user submitted numbers like explained in <a href=\"https://hackage.haskell.org/package/scientific-0.3.4.10/docs/Data-Scientific.html\" rel=\"nofollow noreferrer\"><code>scientific</code></a> library?</p>\n"}, {"tags": ["haskell", "ghc", "gmp", "haskell-stack"], "comments": [{"owner": {"reputation": 3231, "user_id": 1013393, "user_type": "registered", "accept_rate": 60, "profile_image": "https://www.gravatar.com/avatar/7bca51e5ae3eb8dc24a98616b4e5d6fd?s=128&d=identicon&r=PG", "display_name": "sjakobi", "link": "https://stackoverflow.com/users/1013393/sjakobi"}, "edited": false, "score": 5, "creation_date": 1485239462, "post_id": 41821346, "comment_id": 70830569, "body": "What&#39;s your Linux distro? Try installing libgmp3-dev."}, {"owner": {"reputation": 94713, "user_id": 1139697, "user_type": "registered", "accept_rate": 86, "profile_image": "https://www.gravatar.com/avatar/5f136ddb684f39aaee1c028ee1950f6f?s=128&d=identicon&r=PG", "display_name": "Zeta", "link": "https://stackoverflow.com/users/1139697/zeta"}, "edited": false, "score": 1, "creation_date": 1485245694, "post_id": 41821346, "comment_id": 70833537, "body": "Instead of a picture, use actual text."}, {"owner": {"reputation": 41, "user_id": 7461228, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/02c27dd82d62019b2cbed9d626ec2e76?s=128&d=identicon&r=PG&f=1", "display_name": "Tristan Greeno", "link": "https://stackoverflow.com/users/7461228/tristan-greeno"}, "edited": false, "score": 0, "creation_date": 1485269306, "post_id": 41821346, "comment_id": 70849029, "body": "I&#39;m using Linux Mint latest."}], "owner": {"reputation": 41, "user_id": 7461228, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/02c27dd82d62019b2cbed9d626ec2e76?s=128&d=identicon&r=PG&f=1", "display_name": "Tristan Greeno", "link": "https://stackoverflow.com/users/7461228/tristan-greeno"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 260, "favorite_count": 0, "answer_count": 0, "score": 0, "last_activity_date": 1572444935, "creation_date": 1485238940, "last_edit_date": 1485246208, "question_id": 41821346, "link": "https://stackoverflow.com/questions/41821346/stack-fails-on-sanity-check-with-sandboxed-ghc", "title": "Stack Fails on Sanity Check with Sandboxed GHC", "body": "<p>I am getting a very strange error relating to freshly installed, sandboxed GHC that was created from <code>stack setup</code>. \nIt looks like it's related to <code>/usr/bin/ld</code></p>\n\n<p>Thanks for your help in advance! I'm new to Linux in general as well.</p>\n\n<pre>tristan@tristan-System-Product-Name ~ $ stack setup\nThe GHC located at /home/tristan/.stack/programs/x86_64-linux/ghc-8.0.1/bin/ghc failed to compile a sanity check. Please see \n\n    http://docs.haskellstack.org/en/stable/installiandiupgrade/ \n\nfor more information. Exception was: \nRunning /home/tristan/.stack/programs/x86_64-linux/ghc-8.0.1/bin/ghc /tmp/stack-sanity-check10861/Main.hs -no-user-package-db in directory /tmp/stack-sanity-check10861/ exited with ExitFailure 1 \n[1 of 1] Compiling Main        (/tmp/stackrsanityrchecklos\ufb01l/Main.hs, /tmp /stackrsanityrcheck10861/Main.0 ) \nLinking /tmp/stackrsanityrcheck10861/Main \n\n/usr/bin/ld: cannot find -lgmp \ncollect2: error: ld returned 1 exit status \n`gcc' failed in phase `Linker'. (Exit code: 1)</pre>\n"}, {"tags": ["postgresql", "haskell", "yesod", "esqueleto"], "owner": {"reputation": 136, "user_id": 2140218, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/edbc2c30266f4c42a8912ea7d10e7bb3?s=128&d=identicon&r=PG", "display_name": "Tony DiPasquale", "link": "https://stackoverflow.com/users/2140218/tony-dipasquale"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 150, "favorite_count": 0, "answer_count": 0, "score": 2, "last_activity_date": 1485232180, "creation_date": 1485232180, "question_id": 41820036, "link": "https://stackoverflow.com/questions/41820036/how-to-query-array-contains-in-haskell-esqueleto", "title": "How to query array contains in Haskell Esqueleto", "body": "<p>I'm trying to select all Events from the database that contain a Tag in the Event's tags column.</p>\n\n<p><code>Event</code> is a model with a column <code>tags</code> that is defined in Yesod's model file as <code>tags [Tag]</code>. Tag is a model that is simply <code>newtype Tag = Tag Text</code> with a lot of derivings including <code>PersistField</code> which should allow <code>Tag</code> types to be stored as <code>Text</code> types.</p>\n\n<p>I would like to define a query that selects all events that contain a given tag in their tags column. Something like:</p>\n\n<pre><code>getEventsByTag :: Tag -&gt; Handler Value\ngetEventsByTag tag = do\n  events &lt;- runDB findEvents :: Handler [Entity Event]\n  return $ object [\"events\" ==. events]\n where\n  findEvents =\n    select $\n      from $ \\event -&gt; do\n        where_ $ (event ^. EventTags) `contains` (val tag)\n        return event\n</code></pre>\n\n<p>The part I'm not sure how to do is the <code>contains</code> function. It doesn't seem likely that I can use any postgres array functions since Persistent stores arrays as varchars in postgres. In which case I could get fancy with <code>like</code>. I was actually able to get the result I wanted with this query in postgres: <code>select * from events where tags like '%\"tag\"%';</code> But I'm not sure how to translate this into Esqueleto's language. I tried using the <code>like</code> function but it requires both arguments to be instances of <code>SqlString</code> which I made <code>Tag</code> derive but had trouble figuring out how to make <code>[Tag]</code> derive without overlapping instances.</p>\n"}, {"tags": ["haskell"], "comments": [{"owner": {"reputation": 35578, "user_id": 3000206, "user_type": "registered", "accept_rate": 98, "profile_image": "https://i.stack.imgur.com/BK1fo.jpg?s=128&g=1", "display_name": "Carcigenicate", "link": "https://stackoverflow.com/users/3000206/carcigenicate"}, "edited": false, "score": 0, "creation_date": 1485219122, "post_id": 41818248, "comment_id": 70824665, "body": "What&#39;s the signature of <code>toInteger</code>? Can&#39;t remember. Also, why not just define it as <code>length. show</code>?"}, {"owner": {"reputation": 273, "user_id": 6569748, "user_type": "registered", "accept_rate": 44, "profile_image": "https://www.gravatar.com/avatar/ae79ffd5f41cf29f3600ed54e0e1ba2c?s=128&d=identicon&r=PG&f=1", "display_name": "K.U", "link": "https://stackoverflow.com/users/6569748/k-u"}, "reply_to_user": {"reputation": 35578, "user_id": 3000206, "user_type": "registered", "accept_rate": 98, "profile_image": "https://i.stack.imgur.com/BK1fo.jpg?s=128&g=1", "display_name": "Carcigenicate", "link": "https://stackoverflow.com/users/3000206/carcigenicate"}, "edited": false, "score": 0, "creation_date": 1485219339, "post_id": 41818248, "comment_id": 70824739, "body": "toInteger because log Base 10 return a Double I suppose ?"}, {"owner": {"reputation": 35578, "user_id": 3000206, "user_type": "registered", "accept_rate": 98, "profile_image": "https://i.stack.imgur.com/BK1fo.jpg?s=128&g=1", "display_name": "Carcigenicate", "link": "https://stackoverflow.com/users/3000206/carcigenicate"}, "edited": false, "score": 0, "creation_date": 1485219419, "post_id": 41818248, "comment_id": 70824755, "body": "Are you doing this in a REPL, or a source file?"}, {"owner": {"reputation": 273, "user_id": 6569748, "user_type": "registered", "accept_rate": 44, "profile_image": "https://www.gravatar.com/avatar/ae79ffd5f41cf29f3600ed54e0e1ba2c?s=128&d=identicon&r=PG&f=1", "display_name": "K.U", "link": "https://stackoverflow.com/users/6569748/k-u"}, "reply_to_user": {"reputation": 35578, "user_id": 3000206, "user_type": "registered", "accept_rate": 98, "profile_image": "https://i.stack.imgur.com/BK1fo.jpg?s=128&g=1", "display_name": "Carcigenicate", "link": "https://stackoverflow.com/users/3000206/carcigenicate"}, "edited": false, "score": 0, "creation_date": 1485219568, "post_id": 41818248, "comment_id": 70824795, "body": "I use emacs and Terminal cause I have a Mac"}, {"owner": {"reputation": 35578, "user_id": 3000206, "user_type": "registered", "accept_rate": 98, "profile_image": "https://i.stack.imgur.com/BK1fo.jpg?s=128&g=1", "display_name": "Carcigenicate", "link": "https://stackoverflow.com/users/3000206/carcigenicate"}, "edited": false, "score": 1, "creation_date": 1485219619, "post_id": 41818248, "comment_id": 70824807, "body": "But are you trying to write this code in GHCI in the terminal?"}, {"owner": {"reputation": 35578, "user_id": 3000206, "user_type": "registered", "accept_rate": 98, "profile_image": "https://i.stack.imgur.com/BK1fo.jpg?s=128&g=1", "display_name": "Carcigenicate", "link": "https://stackoverflow.com/users/3000206/carcigenicate"}, "edited": false, "score": 1, "creation_date": 1485219645, "post_id": 41818248, "comment_id": 70824815, "body": "And does it actually say <code>Integer -&gt; t</code>,  or is that a typo?"}, {"owner": {"reputation": 273, "user_id": 6569748, "user_type": "registered", "accept_rate": 44, "profile_image": "https://www.gravatar.com/avatar/ae79ffd5f41cf29f3600ed54e0e1ba2c?s=128&d=identicon&r=PG&f=1", "display_name": "K.U", "link": "https://stackoverflow.com/users/6569748/k-u"}, "reply_to_user": {"reputation": 35578, "user_id": 3000206, "user_type": "registered", "accept_rate": 98, "profile_image": "https://i.stack.imgur.com/BK1fo.jpg?s=128&g=1", "display_name": "Carcigenicate", "link": "https://stackoverflow.com/users/3000206/carcigenicate"}, "edited": false, "score": 0, "creation_date": 1485219814, "post_id": 41818248, "comment_id": 70824857, "body": "Yes I wrote it in GHCI and no it is not a typo. I copied it straight from the terminal"}, {"owner": {"reputation": 35578, "user_id": 3000206, "user_type": "registered", "accept_rate": 98, "profile_image": "https://i.stack.imgur.com/BK1fo.jpg?s=128&g=1", "display_name": "Carcigenicate", "link": "https://stackoverflow.com/users/3000206/carcigenicate"}, "edited": false, "score": 0, "creation_date": 1485219922, "post_id": 41818248, "comment_id": 70824880, "body": "This is likely a GHCI issue. Certain versions of GHCI execute every line 1 at a time. When it evals the signature line, it can&#39;t find a matching definition, so it throws. I think you surround the code in curly braces or something to have it eval everything at once."}, {"owner": {"reputation": 100892, "user_id": 745903, "user_type": "registered", "accept_rate": 74, "profile_image": "https://www.gravatar.com/avatar/50933f6638836741e620669b3940410e?s=128&d=identicon&r=PG", "display_name": "leftaroundabout", "link": "https://stackoverflow.com/users/745903/leftaroundabout"}, "edited": false, "score": 0, "creation_date": 1485219965, "post_id": 41818248, "comment_id": 70824893, "body": "You realise you can&#39;t just paste Haskell definitions in the GHCi REPL, right? You&#39;d need to write <code>let numDigits :: Integer -&gt; Integer; numDigits n = toInteger (round (logBase 10 (fromIntegral n)) + 1)</code>."}, {"owner": {"reputation": 273, "user_id": 6569748, "user_type": "registered", "accept_rate": 44, "profile_image": "https://www.gravatar.com/avatar/ae79ffd5f41cf29f3600ed54e0e1ba2c?s=128&d=identicon&r=PG&f=1", "display_name": "K.U", "link": "https://stackoverflow.com/users/6569748/k-u"}, "edited": false, "score": 0, "creation_date": 1485220011, "post_id": 41818248, "comment_id": 70824907, "body": "I wrote it in emacs and compile using ghci in my terminal, so I didn&#39;t use let"}, {"owner": {"reputation": 35578, "user_id": 3000206, "user_type": "registered", "accept_rate": 98, "profile_image": "https://i.stack.imgur.com/BK1fo.jpg?s=128&g=1", "display_name": "Carcigenicate", "link": "https://stackoverflow.com/users/3000206/carcigenicate"}, "edited": false, "score": 0, "creation_date": 1485220113, "post_id": 41818248, "comment_id": 70824933, "body": "@K.U I think he&#39;s right, iirc, let is the workaround. Your code works: <a href=\"http://rextester.com/AHGX41414\" rel=\"nofollow noreferrer\">rextester.com/AHGX41414</a>"}, {"owner": {"reputation": 273, "user_id": 6569748, "user_type": "registered", "accept_rate": 44, "profile_image": "https://www.gravatar.com/avatar/ae79ffd5f41cf29f3600ed54e0e1ba2c?s=128&d=identicon&r=PG&f=1", "display_name": "K.U", "link": "https://stackoverflow.com/users/6569748/k-u"}, "edited": false, "score": 0, "creation_date": 1485220391, "post_id": 41818248, "comment_id": 70825007, "body": "I don&#39;t think let is the problem here cause I wrote it in emacs and complied in terminal. My other code worked just fine this way though"}, {"owner": {"reputation": 2366, "user_id": 1112406, "user_type": "registered", "accept_rate": 45, "profile_image": "https://www.gravatar.com/avatar/abd557d2593a8fa81511a817b83c8f4b?s=128&d=identicon&r=PG", "display_name": "RussAbbott", "link": "https://stackoverflow.com/users/1112406/russabbott"}, "edited": false, "score": 0, "creation_date": 1485224118, "post_id": 41818248, "comment_id": 70825993, "body": "No problems when entered directly into WinGHCi."}, {"owner": {"reputation": 31243, "user_id": 2751851, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/4ddc0.png?s=128&g=1", "display_name": "duplode", "link": "https://stackoverflow.com/users/2751851/duplode"}, "edited": false, "score": 0, "creation_date": 1485225308, "post_id": 41818248, "comment_id": 70826260, "body": "If you are using a sufficiently recent GHC, an alternative to putting everything in a single line is entering <code>:{</code> (on its own in a line), then pasting your code without changes (no need to add <code>let</code> or remove linebreaks) and finally entering <code>:}</code> (also in a separate line). GHCi can handle most things without changes in this way."}, {"owner": {"reputation": 62421, "user_id": 216164, "user_type": "registered", "accept_rate": 89, "profile_image": "https://www.gravatar.com/avatar/786f224adbe0784cdf7d0f15476061fe?s=128&d=identicon&r=PG", "display_name": "Thomas M. DuBuisson", "link": "https://stackoverflow.com/users/216164/thomas-m-dubuisson"}, "edited": false, "score": 0, "creation_date": 1485234243, "post_id": 41818248, "comment_id": 70828527, "body": "How are you calling <code>numDigits</code>?  That error is from a call site, not the definition."}], "answers": [{"comments": [{"owner": {"reputation": 6980, "user_id": 1544347, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/1ad87bb0303238ee876a147dacd557a1?s=128&d=identicon&r=PG", "display_name": "Markus Unterwaditzer", "link": "https://stackoverflow.com/users/1544347/markus-unterwaditzer"}, "edited": false, "score": 1, "creation_date": 1575474400, "post_id": 41820383, "comment_id": 104580538, "body": "Buggy with <code>9999</code> as input on my machine"}, {"owner": {"reputation": 62421, "user_id": 216164, "user_type": "registered", "accept_rate": 89, "profile_image": "https://www.gravatar.com/avatar/786f224adbe0784cdf7d0f15476061fe?s=128&d=identicon&r=PG", "display_name": "Thomas M. DuBuisson", "link": "https://stackoverflow.com/users/216164/thomas-m-dubuisson"}, "reply_to_user": {"reputation": 6980, "user_id": 1544347, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/1ad87bb0303238ee876a147dacd557a1?s=128&d=identicon&r=PG", "display_name": "Markus Unterwaditzer", "link": "https://stackoverflow.com/users/1544347/markus-unterwaditzer"}, "edited": false, "score": 0, "creation_date": 1575478442, "post_id": 41820383, "comment_id": 104582984, "body": "Sure, the algorithms is shoddy but the question was about loading and testing code in a repl."}], "tags": [], "owner": {"reputation": 62421, "user_id": 216164, "user_type": "registered", "accept_rate": 89, "profile_image": "https://www.gravatar.com/avatar/786f224adbe0784cdf7d0f15476061fe?s=128&d=identicon&r=PG", "display_name": "Thomas M. DuBuisson", "link": "https://stackoverflow.com/users/216164/thomas-m-dubuisson"}, "is_accepted": true, "score": 3, "last_activity_date": 1485234341, "creation_date": 1485234341, "answer_id": 41820383, "question_id": 41818248, "link": "https://stackoverflow.com/questions/41818248/the-number-of-digits-of-an-integer-in-haskell/41820383#41820383", "title": "The number of digits of an integer in Haskell", "body": "<p>FYI I voted to close because you have either made a typo or failed to provide us with the actual failing code.  The code in question is valid, but you should specify how you're loading it and how you're calling it.</p>\n\n<p>For demonstration:</p>\n\n<pre><code>% cat so.hs\nnumDigits :: Integer -&gt; Integer\nnumDigits n = toInteger (round (logBase 10 (fromIntegral n)) + 1)\n% ghci so.hs\nGHCi, version 8.0.1: http://www.haskell.org/ghc/  :? for help\nLoaded GHCi configuration from /Users/tommd/.ghci\n[1 of 1] Compiling Main             ( so.hs, interpreted )\nOk, modules loaded: Main.\n*Main&gt; numDigits 1948\n4\n</code></pre>\n"}], "owner": {"reputation": 273, "user_id": 6569748, "user_type": "registered", "accept_rate": 44, "profile_image": "https://www.gravatar.com/avatar/ae79ffd5f41cf29f3600ed54e0e1ba2c?s=128&d=identicon&r=PG&f=1", "display_name": "K.U", "link": "https://stackoverflow.com/users/6569748/k-u"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 2751, "favorite_count": 0, "closed_date": 1485237494, "accepted_answer_id": 41820383, "answer_count": 1, "score": 1, "last_activity_date": 1485234341, "creation_date": 1485218997, "question_id": 41818248, "link": "https://stackoverflow.com/questions/41818248/the-number-of-digits-of-an-integer-in-haskell", "closed_reason": "Not suitable for this site", "title": "The number of digits of an integer in Haskell", "body": "<p>Classic problem, but in Haskell this time. I try to do this the C way but I keep getting this error </p>\n\n<pre><code>Variable not in scope: numDigits :: Integer -&gt; t\n</code></pre>\n\n<p>Here is the code I wrote</p>\n\n<pre><code>numDigits :: Integer -&gt; Integer\nnumDigits n = toInteger (round (logBase 10 (fromIntegral n)) + 1)\n</code></pre>\n\n<p>Did i do something wrong? Or log</p>\n"}, {"tags": ["haskell", "aeson"], "comments": [{"owner": {"reputation": 2365, "user_id": 6682929, "user_type": "registered", "accept_rate": 95, "profile_image": "https://i.stack.imgur.com/BuvWA.jpg?s=128&g=1", "display_name": "Jonathan Portorreal", "link": "https://stackoverflow.com/users/6682929/jonathan-portorreal"}, "edited": false, "score": 0, "creation_date": 1485217394, "post_id": 41816726, "comment_id": 70824190, "body": "based on this error it looks like <code>l :: Int</code> in your data constructor for <code>GameResult</code> should be of type <code>l :: Float</code> ; try lining up those types."}, {"owner": {"reputation": 14781, "user_id": 630160, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/4445f21326af525a8ad19af7e3ae41a8?s=128&d=identicon&r=PG", "display_name": "epsilonhalbe", "link": "https://stackoverflow.com/users/630160/epsilonhalbe"}, "edited": false, "score": 0, "creation_date": 1485218491, "post_id": 41816726, "comment_id": 70824500, "body": "Working with huge datatypes like you do I&#39;d recommend using <code>RecordWildCards</code> or some form of lenses if you have nested structures"}, {"owner": {"reputation": 49, "user_id": 6850759, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/c8170739a2a526163a0d0a0c8e9555d5?s=128&d=identicon&r=PG&f=1", "display_name": "Rhett D", "link": "https://stackoverflow.com/users/6850759/rhett-d"}, "reply_to_user": {"reputation": 2365, "user_id": 6682929, "user_type": "registered", "accept_rate": 95, "profile_image": "https://i.stack.imgur.com/BuvWA.jpg?s=128&g=1", "display_name": "Jonathan Portorreal", "link": "https://stackoverflow.com/users/6682929/jonathan-portorreal"}, "edited": false, "score": 0, "creation_date": 1485222513, "post_id": 41816726, "comment_id": 70825580, "body": "I appreciate the help guys.  @JonathanPortorreal I tried to change the types in <code>GameResult</code> according to what the error messages were telling me, but it appears that it&#39;s telling me to change all my record fields to have type Int which won&#39;t match the array in the JSON. It&#39;ll also give me the error message: <code>No instance for (FromJSON (Parser Int)) arising from a use of \u2018parseJSON\u2019</code> (referencing the line with <code>[...x,y,z] &lt;- parseJSON arr</code>)    @epsilonhalbe I&#39;ll look into lenses right now.    Thanks again!"}, {"owner": {"reputation": 2365, "user_id": 6682929, "user_type": "registered", "accept_rate": 95, "profile_image": "https://i.stack.imgur.com/BuvWA.jpg?s=128&g=1", "display_name": "Jonathan Portorreal", "link": "https://stackoverflow.com/users/6682929/jonathan-portorreal"}, "edited": false, "score": 0, "creation_date": 1485240914, "post_id": 41816726, "comment_id": 70831220, "body": "you could also convert the array into an object and then parse the object as a GameResult."}, {"owner": {"reputation": 49, "user_id": 6850759, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/c8170739a2a526163a0d0a0c8e9555d5?s=128&d=identicon&r=PG&f=1", "display_name": "Rhett D", "link": "https://stackoverflow.com/users/6850759/rhett-d"}, "reply_to_user": {"reputation": 2365, "user_id": 6682929, "user_type": "registered", "accept_rate": 95, "profile_image": "https://i.stack.imgur.com/BuvWA.jpg?s=128&g=1", "display_name": "Jonathan Portorreal", "link": "https://stackoverflow.com/users/6682929/jonathan-portorreal"}, "edited": false, "score": 0, "creation_date": 1485251438, "post_id": 41816726, "comment_id": 70836963, "body": "Thanks again @JonathanPortorreal I think I&#39;ll start refactoring it that way to clean it up."}], "owner": {"reputation": 49, "user_id": 6850759, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/c8170739a2a526163a0d0a0c8e9555d5?s=128&d=identicon&r=PG&f=1", "display_name": "Rhett D", "link": "https://stackoverflow.com/users/6850759/rhett-d"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 341, "favorite_count": 0, "answer_count": 0, "score": 2, "last_activity_date": 1485239052, "creation_date": 1485210060, "last_edit_date": 1495535355, "question_id": 41816726, "link": "https://stackoverflow.com/questions/41816726/how-to-parse-json-of-multi-type-array-using-aeson-into-a-custom-haskell-type", "title": "How to parse JSON of multi-type array using Aeson into a custom Haskell type?", "body": "<p>this is my first post on Stack Overflow and I'm very new to Haskell and programming/web development in general. I'm using it to try and parse some JSON into an ADT type.</p>\n\n<p>Here is the section of JSON I want to try and parse:</p>\n\n<pre><code>{\"resource\":\"teamgamelog\",\n \"parameters\":{\"TeamID\":1610612747,\"LeagueID\":null,\"Season\":\"2015-16\",\"SeasonType\":\"Regular Season\",\"DateFrom\":null,\"DateTo\":null},\n \"resultSets\":[\n   {\"name\":\"TeamGameLog\",\n    \"headers\":[\"Team_ID\",\"Game_ID\",\"GAME_DATE\",\"MATCHUP\",\"WL\",\"W\",\"L\",\"W_PCT\",\"MIN\",\"FGM\",\"FGA\",\"FG_PCT\",\"FG3M\",\"FG3A\",\"FG3_PCT\",\"FTM\",\"FTA\",\"FT_PCT\",\"OREB\",\"DREB\",\"REB\",\"AST\",\"STL\",\"BLK\",\"TOV\",\"PF\",\"PTS\"], \n    \"rowSet\": [ [1610612747,\"0021501228\",\"APR 13, 2016\",\"LAL vs. UTA\",\"W\",17,65,0.207,240,41,85,0.482,6,25,0.240,13,15,0.867,8,39,47,19,6,3,13,17,101]\n               ,[1610612747,\"0021501209\",\"APR 11, 2016\",\"LAL @ OKC\",\"L\",16,65,0.198,240,23,81,0.284,7,31,0.226,26,30,0.867,10,38,48,15,8,1,15,20,79]\n               ,[1610612747,\"0021501195\",\"APR 10, 2016\",\"LAL @ HOU\",\"L\",16,64,0.2,240,41,83,0.494,12,28,0.429,16,19,0.842,7,33,40,25,10,3,18,15,110]\n               .\n               .\n               .\n               ]\n   }\n}\n</code></pre>\n\n<p>What I'm trying to accomplish is ending up with <code>[GameResult]</code> where each <code>GameResult</code> is made from the nested array's in the JSON <code>\"rowSet\"</code> key:</p>\n\n<pre><code>data GameResult = GameResult { team_ID   :: Int\n                             , game_ID   :: String\n                             , game_date :: String\n                             , matchup   :: String\n                             , wl        :: Char\n                             , w         :: Int\n                             , l         :: Int\n                             , w_pct     :: Float\n                             , min       :: Int\n                             , fgm       :: Int\n                             , fga       :: Int\n                             , fg_pct    :: Float\n                             , fg3m      :: Int\n                             , fg3a      :: Int\n                             , fg3_pct   :: Float\n                             , ftm       :: Int\n                             , fta       :: Int\n                             , ft_pct    :: Float\n                             , oreb      :: Int\n                             , dreb      :: Int\n                             , reb       :: Int\n                             , ast       :: Int\n                             , stl       :: Int\n                             , blk       :: Int\n                             , tov       :: Int\n                             , pf        :: Int\n                             , pts       :: Int\n                             } deriving (Show, Eq, Ord, Read)\n</code></pre>\n\n<p>I have this so far:</p>\n\n<pre><code>module Main where\n\nimport Data.Aeson\nimport Network.HTTP.Conduit (simpleHttp)\n\ndata RowSet  = ResultSet [GameResult] deriving (Show, Eq, Read)\ndata ResultSets = ResultSets [RowSet] deriving (Show, Eq, Read)\n\ninstance FromJSON ResultSets where\n  parseJSON (Object o) = ResultSets &lt;$&gt; (o .: \"resultSets\")\n\ninstance FromJSON RowSetSet where\n  parseJSON (Object o) = RowSet &lt;$&gt; (o .: \"rowSet\")\n\njsonURL :: String\njsonURL = \"http://stats.nba.com/stats/teamgamelog/?Season=2015-16&amp;SeasonType=Regular%20Season&amp;TeamID=1610612747\"\n\ngetJSON :: IO B.ByteString\ngetJSON = simpleHttp jsonURL\n\nmain :: IO ()\nmain = do\n  d &lt;- (eitherDecode &lt;$&gt; getJSON) :: IO (Either String (Maybe ResultSets)) \n  case d of\n    Left err -&gt; putStrLn err\n    Right ps -&gt; putStrLn (show ps)\n</code></pre>\n\n<p>Not sure if this is exactly the direction I should be going, but I was thinking of a lengthy pattern match:</p>\n\n<pre><code>instance FromJSON GameResult where\n  parseJSON arr = do \n  [a,b,c,...x,y,z] &lt;- parseJSON arr\n  GameResult &lt;$&gt; a &lt;*&gt; b &lt;*&gt; c &lt;*&gt; ...\n</code></pre>\n\n<p>Of course I'm getting a number of errors trying to compile:</p>\n\n<pre><code>Couldn't match type \u2018Int\u2019 with \u2018Float\u2019\n  Expected type: Parser Float\n    Actual type: Parser Int\nIn the second argument of \u2018(&lt;*&gt;)\u2019, namely \u2018l\u2019\n  In the first argument of \u2018(&lt;*&gt;)\u2019, namely\n    \u2018GameResult &lt;$&gt; a &lt;*&gt; b &lt;*&gt; c &lt;*&gt; d &lt;*&gt; e &lt;*&gt; f &lt;*&gt; g &lt;*&gt; h &lt;*&gt; i\n     &lt;*&gt; j\n     &lt;*&gt; k\n     &lt;*&gt; l\u2019\n  In the first argument of \u2018(&lt;*&gt;)\u2019, namely\n    \u2018GameResult &lt;$&gt; a &lt;*&gt; b &lt;*&gt; c &lt;*&gt; d &lt;*&gt; e &lt;*&gt; f &lt;*&gt; g &lt;*&gt; h &lt;*&gt; i\n     &lt;*&gt; j\n     &lt;*&gt; k\n     &lt;*&gt; l\n     &lt;*&gt; m\u2019\n</code></pre>\n\n<p>There are in total 8 of those errors I'm getting in the console.</p>\n\n<p>I'd appreciate any help I can get here. I apologize if this post is a little lengthy and full of bad code.</p>\n\n<p>EDIT: It turns out I've fixed my problem. Thanks to both <a href=\"https://stackoverflow.com/users/6682929/jonathan-portorreal\">jonathan-portorreal</a> and <a href=\"https://stackoverflow.com/users/630160/epsilonhalbe\">epsilonhalbe</a> I looked at my types again and also checked out the Lens package for some ideas. I ended up using a <code>do</code> block in my <code>FromJSON GameResult</code> instance but I was still having type problems because it turns out I was using <code>w</code> and <code>l</code> as certain field names in the <code>GameResult</code>ADT and outside of it.</p>\n\n<pre><code>instance FromJSON GameResult where\n  parseJSON arr = do \n  [a,b,c,d,...,l,...,w,x,y,z] &lt;- parseJSON arr\n  team_ID   &lt;- a\n  game_ID   &lt;- b\n  game_date &lt;- c\n  matchup   &lt;- d\n  wl        &lt;- e\n  w         &lt;- f\n  l         &lt;- g\n  ...\n            &lt;- l\n            ...\n            &lt;- w\n</code></pre>\n\n<p>I'll definitely clean this up though, probably will utilize the Lens package once I get more familiar with the basics.</p>\n"}, {"tags": ["haskell", "fold"], "comments": [{"owner": {"reputation": 314794, "user_id": 67579, "user_type": "registered", "accept_rate": 81, "profile_image": "https://i.stack.imgur.com/BJXub.png?s=128&g=1", "display_name": "Willem Van Onsem", "link": "https://stackoverflow.com/users/67579/willem-van-onsem"}, "edited": false, "score": 0, "creation_date": 1485202005, "post_id": 41814640, "comment_id": 70817479, "body": "Why don&#39;t you provide the &quot;Relevant bindings&quot;?"}, {"owner": {"reputation": 51584, "user_id": 839246, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/9b0573c2b936b12828dd1e4cc04206dc?s=128&d=identicon&r=PG&f=1", "display_name": "bheklilr", "link": "https://stackoverflow.com/users/839246/bheklilr"}, "edited": false, "score": 3, "creation_date": 1485202268, "post_id": 41814640, "comment_id": 70817614, "body": "You need to provide a type signature for <code>duplicate</code>, something like <code>[a] -&gt; [a]</code> or <code>Foldable t =&gt; t a -&gt; [a]</code> will work.  GHC doesn&#39;t want to default anything for you so it tells you that the type signature is ambiguous."}, {"owner": {"reputation": 15757, "user_id": 176841, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/45a168cb9eb8454d66c78f18e29d9342?s=128&d=identicon&r=PG", "display_name": "jberryman", "link": "https://stackoverflow.com/users/176841/jberryman"}, "edited": false, "score": 0, "creation_date": 1485202634, "post_id": 41814640, "comment_id": 70817821, "body": "Did you try searching SO for this error message? If so what is confusing you about the answers to those other questions?"}, {"owner": {"reputation": 39, "user_id": 7459555, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/01f706aa3dd7c61ccafb02075137425a?s=128&d=identicon&r=PG&f=1", "display_name": "Kyrill96", "link": "https://stackoverflow.com/users/7459555/kyrill96"}, "edited": false, "score": 0, "creation_date": 1485203763, "post_id": 41814640, "comment_id": 70818477, "body": "Thanks! I didnt know exactly what is meant with relevant bindings, now i know."}], "owner": {"reputation": 39, "user_id": 7459555, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/01f706aa3dd7c61ccafb02075137425a?s=128&d=identicon&r=PG&f=1", "display_name": "Kyrill96", "link": "https://stackoverflow.com/users/7459555/kyrill96"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 124, "favorite_count": 0, "closed_date": 1485203839, "answer_count": 0, "score": 0, "last_activity_date": 1485203289, "creation_date": 1485201842, "last_edit_date": 1485203289, "question_id": 41814640, "link": "https://stackoverflow.com/questions/41814640/haskell-ambiguous-type-variable", "closed_reason": "Duplicate", "title": "Haskell Ambiguous type variable?", "body": "<p>if i try to run this msall little code:</p>\n\n<pre><code>module Problem14 where \n\nduplicate = foldl (\\acc x -&gt; acc ++ [x,x]) []\n</code></pre>\n\n<p>I get the following error message by GHCi: </p>\n\n<pre><code>*Ambiguous type variable `t0' arising from a use of `foldl'\nprevents the constraint `(Foldable t0)' from being solved.\nRelevant bindings include*\n</code></pre>\n\n<p>Why is GHCi giving me that message?</p>\n"}, {"tags": ["haskell", "monads"], "comments": [{"owner": {"reputation": 14781, "user_id": 630160, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/4445f21326af525a8ad19af7e3ae41a8?s=128&d=identicon&r=PG", "display_name": "epsilonhalbe", "link": "https://stackoverflow.com/users/630160/epsilonhalbe"}, "edited": false, "score": 2, "creation_date": 1485194944, "post_id": 41812761, "comment_id": 70813684, "body": "have you had a look at one of the two streaming libraries &quot;conduit&quot; and/or &quot;pipes&quot;"}, {"owner": {"reputation": 5352, "user_id": 4896150, "user_type": "registered", "accept_rate": 43, "profile_image": "https://www.gravatar.com/avatar/74d0c938f3f71d6ee14db4f6b9d222c2?s=128&d=identicon&r=PG&f=1", "display_name": "Anton Harald", "link": "https://stackoverflow.com/users/4896150/anton-harald"}, "reply_to_user": {"reputation": 14781, "user_id": 630160, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/4445f21326af525a8ad19af7e3ae41a8?s=128&d=identicon&r=PG", "display_name": "epsilonhalbe", "link": "https://stackoverflow.com/users/630160/epsilonhalbe"}, "edited": false, "score": 0, "creation_date": 1485195065, "post_id": 41812761, "comment_id": 70813746, "body": "Not yet, is there one of the two that you&#39;d consider more beginner friendly?"}, {"owner": {"reputation": 4185, "user_id": 1424121, "user_type": "registered", "accept_rate": 62, "profile_image": "https://www.gravatar.com/avatar/c6f5c5cd761b9ce4493fd875cc041ac3?s=128&d=identicon&r=PG", "display_name": "ryachza", "link": "https://stackoverflow.com/users/1424121/ryachza"}, "edited": false, "score": 0, "creation_date": 1485195406, "post_id": 41812761, "comment_id": 70813949, "body": "@AntonHarald I wanted to second that it sounds like you&#39;re looking for streaming support, which will separate the producer from the consumer and &quot;pull&quot; values through the pipeline as needed. I think <code>pipes</code> and <code>conduit</code> are very similar and either should be fine for a beginner. Personally, I&#39;ve only used <code>io-streams</code>."}, {"owner": {"reputation": 5352, "user_id": 4896150, "user_type": "registered", "accept_rate": 43, "profile_image": "https://www.gravatar.com/avatar/74d0c938f3f71d6ee14db4f6b9d222c2?s=128&d=identicon&r=PG&f=1", "display_name": "Anton Harald", "link": "https://stackoverflow.com/users/4896150/anton-harald"}, "edited": false, "score": 0, "creation_date": 1485195726, "post_id": 41812761, "comment_id": 70814120, "body": "Is there any relation between conduit and http-conduit? Would they maybe work together particularly well?"}, {"owner": {"reputation": 4185, "user_id": 1424121, "user_type": "registered", "accept_rate": 62, "profile_image": "https://www.gravatar.com/avatar/c6f5c5cd761b9ce4493fd875cc041ac3?s=128&d=identicon&r=PG", "display_name": "ryachza", "link": "https://stackoverflow.com/users/1424121/ryachza"}, "edited": false, "score": 0, "creation_date": 1485196819, "post_id": 41812761, "comment_id": 70814729, "body": "@AntonHarald I believe <code>http-conduit</code> wraps <code>http-client</code> using <code>conduit</code> internally, and may expose some of its interface in terms of <code>conduit</code> types. There also appears to be a <code>pipes-http</code> with the same goal using <code>pipes</code> (I have no idea about comparing the two). I&#39;ve used <code>http-streams</code> which uses <code>io-streams</code>."}, {"owner": {"reputation": 29444, "user_id": 3072788, "user_type": "registered", "accept_rate": 82, "profile_image": "https://www.gravatar.com/avatar/220a45c2fcff7e7358d144551b116205?s=128&d=identicon&r=PG&f=1", "display_name": "Alec", "link": "https://stackoverflow.com/users/3072788/alec"}, "edited": false, "score": 0, "creation_date": 1485198240, "post_id": 41812761, "comment_id": 70815508, "body": "@AntonHarald I recommend <code>conduit</code>. It has a pretty vast ecosystem of helper libraries (like <code>http-conduit</code>), a pretty intuitive API, and lots of examples."}, {"owner": {"reputation": 978, "user_id": 1902082, "user_type": "registered", "accept_rate": 40, "profile_image": "https://www.gravatar.com/avatar/f46590cf12954aeab118e32b10f0ed97?s=128&d=identicon&r=PG", "display_name": "scooter me fecit", "link": "https://stackoverflow.com/users/1902082/scooter-me-fecit"}, "edited": false, "score": 0, "creation_date": 1485199015, "post_id": 41812761, "comment_id": 70815903, "body": "<code>map</code> and <code>mapM</code> will apply <code>req</code> to each element of the list, so, you would expect it to be invoked 1000 times for a 1000 element list. Why would you expect <code>req</code> to be invoked once? Also, <code>req</code> should have the type <code>Integer -&gt; IO [Integer]</code> for it to work with <code>mapM</code>."}, {"owner": {"reputation": 3392, "user_id": 7175117, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/Tfz44.png?s=128&g=1", "display_name": "freestyle", "link": "https://stackoverflow.com/users/7175117/freestyle"}, "edited": false, "score": 2, "creation_date": 1485206469, "post_id": 41812761, "comment_id": 70819891, "body": "I recommend you the <a href=\"https://github.com/michaelt/streaming\" rel=\"nofollow noreferrer\">streaming</a> library. It&#39;s more simpler then conduit or pipes."}, {"owner": {"reputation": 2831, "user_id": 183792, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/9ddcfbc6c31012fd25384f6301363347?s=128&d=identicon&r=PG&f=1", "display_name": "Michael", "link": "https://stackoverflow.com/users/183792/michael"}, "reply_to_user": {"reputation": 4185, "user_id": 1424121, "user_type": "registered", "accept_rate": 62, "profile_image": "https://www.gravatar.com/avatar/c6f5c5cd761b9ce4493fd875cc041ac3?s=128&d=identicon&r=PG", "display_name": "ryachza", "link": "https://stackoverflow.com/users/1424121/ryachza"}, "edited": false, "score": 0, "creation_date": 1485267787, "post_id": 41812761, "comment_id": 70847960, "body": "@ryachza all streaming libraries  have an http client package, it&#39;s like having &#39;readFile&#39;. You mention the ones for io-streams, pipes, conduit <a href=\"http://hackage.haskell.org/package/streaming-utils-0.1.4.7/docs/Data-ByteString-Streaming-HTTP.html\" rel=\"nofollow noreferrer\">here&#39;s the one for streaming fwiw</a>"}], "answers": [{"comments": [{"owner": {"reputation": 4185, "user_id": 1424121, "user_type": "registered", "accept_rate": 62, "profile_image": "https://www.gravatar.com/avatar/c6f5c5cd761b9ce4493fd875cc041ac3?s=128&d=identicon&r=PG", "display_name": "ryachza", "link": "https://stackoverflow.com/users/1424121/ryachza"}, "edited": false, "score": 1, "creation_date": 1485202043, "post_id": 41814177, "comment_id": 70817506, "body": "I&#39;m not sure this answers the question - my interpretation was asking how to ensure <code>req</code> is evaluated lazily, for example if you <code>take 4</code> on the result of <code>mapM</code> it should only need to be called twice, since that would produce 6 values. To my knowledge this cannot be achieved with <code>mapM</code>."}, {"owner": {"reputation": 978, "user_id": 1902082, "user_type": "registered", "accept_rate": 40, "profile_image": "https://www.gravatar.com/avatar/f46590cf12954aeab118e32b10f0ed97?s=128&d=identicon&r=PG", "display_name": "scooter me fecit", "link": "https://stackoverflow.com/users/1902082/scooter-me-fecit"}, "reply_to_user": {"reputation": 4185, "user_id": 1424121, "user_type": "registered", "accept_rate": 62, "profile_image": "https://www.gravatar.com/avatar/c6f5c5cd761b9ce4493fd875cc041ac3?s=128&d=identicon&r=PG", "display_name": "ryachza", "link": "https://stackoverflow.com/users/1424121/ryachza"}, "edited": false, "score": 0, "creation_date": 1485206322, "post_id": 41814177, "comment_id": 70819814, "body": "I probably should have stated up front that the OP &quot;can&#39;t get there from here&quot;. My answer is an explanation of how laziness works and why <code>mapM</code> will evaluate <code>req</code> multiple times (if the OP had actually written compilable code.)"}], "tags": [], "owner": {"reputation": 978, "user_id": 1902082, "user_type": "registered", "accept_rate": 40, "profile_image": "https://www.gravatar.com/avatar/f46590cf12954aeab118e32b10f0ed97?s=128&d=identicon&r=PG", "display_name": "scooter me fecit", "link": "https://stackoverflow.com/users/1902082/scooter-me-fecit"}, "is_accepted": false, "score": 0, "last_activity_date": 1485201223, "last_edit_date": 1485201223, "creation_date": 1485199977, "answer_id": 41814177, "question_id": 41812761, "link": "https://stackoverflow.com/questions/41812761/retain-laziness-with-mapm/41814177#41814177", "title": "Retain Laziness With mapM", "body": "<p>The working version of your code:</p>\n\n<pre><code>module Foo where\n\nreq :: Integer -&gt; IO [Integer]\nreq _x = do\n    print \"x\"\n    return [1,2,3]\n\nreq' :: IO [Integer]\nreq' = concat &lt;$&gt; mapM req [1..1000]\n</code></pre>\n\n<p>(Note: I replaced <code>fmap concat</code> with <code>concat &lt;$&gt;</code>.)</p>\n\n<p>When you evalute <code>fmap (take 4) req'</code>, the <code>mapM</code> expression's value is needed, which, in turn, needs the value of the <code>[1..1000]</code> list. So, a 1000 element list is generated and <code>mapM</code> applies the <code>req</code> function to each element -- hence, the 1000 'x'-es printed. <code>concat</code> then has to supply a value to the <code>(take 4)</code> section, which produces <code>[1,2,3]</code> repeated 1000 times. Then, and only then, can <code>(take 4)</code> take the first four elements.</p>\n\n<p>All of these computations occur because a value is needed by <code>ghci</code>, if you're at the interpreter's REPL prompt. Otherwise, in an executing program, <code>take 4</code> is simply stacked in a waiting thunk until its value is actually needed.</p>\n\n<p>Best to think about this as a tree where expressions are pushed onto the root of the tree, replacing the root each time (root becomes a leaf in another expression that needs its value.) When the value at the root of the tree is needed, evaluate from the bottom up.</p>\n\n<p>Now, if you really only wanted <code>req</code> evaluated once and only once because it is truly a constant value, here's the code:</p>\n\n<pre><code>module Foo where\n\nreq2 :: IO [Integer]\nreq2 = do\n    print \"x\"\n    return [1,2,3]\n\nreq2' :: IO [Integer]\nreq2' = concat &lt;$&gt; mapM (const req2) ([1..1000] :: [Integer])\n</code></pre>\n\n<p><code>req2</code>' is evaluated only once because it evaluates to a constant (no function parameters guarantees this.) Admittedly, though, that's probably not what you really intended.</p>\n"}, {"tags": [], "owner": {"reputation": 7245, "user_id": 867208, "user_type": "registered", "accept_rate": 78, "profile_image": "https://www.gravatar.com/avatar/73ff2469d25f133355be32507631ee40?s=128&d=identicon&r=PG", "display_name": "valderman", "link": "https://stackoverflow.com/users/867208/valderman"}, "is_accepted": false, "score": 6, "last_activity_date": 1485205146, "last_edit_date": 1485205146, "creation_date": 1485203150, "answer_id": 41814963, "question_id": 41812761, "link": "https://stackoverflow.com/questions/41812761/retain-laziness-with-mapm/41814963#41814963", "title": "Retain Laziness With mapM", "body": "<h3>Short version:</h3>\n\n<p><strong>You shouldn't do this, look into a streaming IO library such as <code>pipes</code> or <code>conduit</code> instead.</strong></p>\n\n<h3>Long version:</h3>\n\n<p>You can't. Or at least, you really shouldn't. Allowing lazily evaluated code to have side effects is generally a very bad idea. Not only does it very quickly become hard to reason about wich effects are performed when and how many times, but even worse, <em>effects may not be performed in the order you expect them to</em>! With pure code, this is not a big deal. With side-effecting code, this is a disaster.</p>\n\n<p>Imagine that you want to read a value from a reference and then replace the value with an updated value. In the IO monad, where the order of computation is well defined, this is easy:</p>\n\n<pre><code>main = do\n  yesterdaysDate &lt;- readIORef ref\n  writeIORef ref todaysDate\n</code></pre>\n\n<p>However, if the above code were instead to be evaluated lazily, there would be no guarantee that the reference was read before it was written - or even that both computations would be executed at all. The semantics of the program would depend entirely on if and when we needed the results of the computations. This is one of the reasons for coming up with monads in the first place: to give programmers a way to write code with side effects, which execute in a well-defined and easily understood order.</p>\n\n<p>Now, it <em>is</em> actually possible to lazily concatenate the lists, if you create them using <code>unsafeInterleaveIO</code>:</p>\n\n<pre><code>import System.IO.Unsafe\n\nreq :: IO [Integer]\nreq = unsafeInterleaveIO $ do\n    print \"x\"\n    return [1,2,3]\n\nreq' :: IO [Integer]\nreq' = fmap concat $ mapM (const req) [1..1000]\n</code></pre>\n\n<p>This will cause each application of <code>req</code> to be deferred until the corresponding sublist is needed. However, lazily performing IO like this may lead to interesting race conditions and resource leaks, and is generally frowned upon. The recommended alternative would be to use a streaming IO library such as <code>conduit</code> or <code>pipes</code>, which are mentioned in the comments.</p>\n"}, {"tags": [], "owner": {"reputation": 4185, "user_id": 1424121, "user_type": "registered", "accept_rate": 62, "profile_image": "https://www.gravatar.com/avatar/c6f5c5cd761b9ce4493fd875cc041ac3?s=128&d=identicon&r=PG", "display_name": "ryachza", "link": "https://stackoverflow.com/users/1424121/ryachza"}, "is_accepted": false, "score": 1, "last_activity_date": 1485204213, "creation_date": 1485204213, "answer_id": 41815267, "question_id": 41812761, "link": "https://stackoverflow.com/questions/41812761/retain-laziness-with-mapm/41815267#41815267", "title": "Retain Laziness With mapM", "body": "<p>As far as I know, what you're looking for shouldn't/can't be done using <code>mapM</code> and should probably use some form of streaming. In case it's helpful, an example using <code>io-streams</code>:</p>\n\n<pre><code>import qualified System.IO.Streams as Streams\nimport qualified System.IO.Streams.Combinators as Streams\n\nreq :: IO (Maybe [Integer])\nreq = do\n  print \"x\"\n  return (Just [1,2,3])\n\nreq' :: IO [Integer]\nreq' = Streams.toList =&lt;&lt; Streams.take 4 =&lt;&lt; Streams.concatLists =&lt;&lt; Streams.makeInputStream req\n</code></pre>\n"}, {"tags": [], "owner": {"reputation": 2369, "user_id": 1500583, "user_type": "registered", "accept_rate": 91, "profile_image": "https://www.gravatar.com/avatar/71020354a2fefbdadf424bd48c912515?s=128&d=identicon&r=PG", "display_name": "David McHealy", "link": "https://stackoverflow.com/users/1500583/david-mchealy"}, "is_accepted": false, "score": 0, "last_activity_date": 1485206600, "creation_date": 1485206600, "answer_id": 41815898, "question_id": 41812761, "link": "https://stackoverflow.com/questions/41812761/retain-laziness-with-mapm/41815898#41815898", "title": "Retain Laziness With mapM", "body": "<p>This is what the pipes and conduit ecosystems were designed for.  Here's an example for pipes.</p>\n\n<pre><code>#!/usr/bin/env stack\n--stack runghc --resolver=lts-7.16 --package pipes\n\nmodule Main where\n\nimport Control.Monad (forever)\nimport Pipes as P\nimport qualified Pipes.Prelude as P\n\nreq :: Producer Int IO ()\nreq = forever $ do\n  liftIO $ putStrLn \"Making a request.\"\n  mapM_ yield [1,2,3]\n\n\nmain :: IO ()\nmain = P.toListM (req &gt;-&gt; P.take 4) &gt;&gt;= print\n</code></pre>\n\n<p>Note that normally you don't collapse a result into a list using pipes, but that seems to be your use case.</p>\n"}, {"tags": [], "owner": {"reputation": 2831, "user_id": 183792, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/9ddcfbc6c31012fd25384f6301363347?s=128&d=identicon&r=PG&f=1", "display_name": "Michael", "link": "https://stackoverflow.com/users/183792/michael"}, "is_accepted": false, "score": 3, "last_activity_date": 1485274786, "last_edit_date": 1485274786, "creation_date": 1485208911, "answer_id": 41816487, "question_id": 41812761, "link": "https://stackoverflow.com/questions/41812761/retain-laziness-with-mapm/41816487#41816487", "title": "Retain Laziness With mapM", "body": "<p>Here is how you would do something like this with the <a href=\"https://hackage.haskell.org/package/streaming\" rel=\"nofollow noreferrer\"><code>streaming</code></a> and  <a href=\"https://hackage.haskell.org/package/pipes\" rel=\"nofollow noreferrer\"><code>pipes</code></a> libraries. Pipes programs will be somewhat similar those written with conduit especially in this sort of case. <code>conduit</code> uses different names, and <code>pipes</code> and <code>conduit</code> have somewhat fancier types and operators than <code>streaming</code>; but it's really a matter of indifference which you use.  <code>streaming</code> is I think fundamentally simpler in <em>this</em> sort of case; the formulation will be structurally similar to the corresponding <code>IO [a]</code> program and indeed frequently simpler. The essential point is that a <code>Stream (Of Integer) IO ()</code> is exactly like list of <code>Integer</code>s but it is built in that the elements of the list or stream can arise from successive IO actions.  </p>\n\n<p>I gave <code>req</code> an argument in the following, since that seemed to be what you had in mind.</p>\n\n<pre><code>import Streaming\nimport qualified Streaming.Prelude as S\nimport Streaming.Prelude (for, each)\n\nreq :: Integer -&gt; Stream (Of Integer) IO ()\nreq x = do                   -- this 'stream' is just a list of Integers arising in IO\n  liftIO $ putStr \"Sending request #\" &gt;&gt; print x\n  each [x..x+2]               \n\nreq' :: Stream (Of Integer) IO ()\nreq' = for (S.each [1..]) req -- An infinite succession of requests \n                              -- each yielding three numbers. Here we are not \n                              -- actually using IO to get each but we could.\nmain = S.print $ S.take 4 req'\n-- &gt;&gt;&gt; main\n-- Sending request #1\n-- 1\n-- 2\n-- 3\n-- Sending request #2\n-- 2\n</code></pre>\n\n<p>To get our four desired values we had to send two \"requests\"; we of course don't end up applying <code>req</code> to all Integers! <code>S.take</code> doesn't permit any further development of the infinite stream <code>req'</code> it takes as argument; so only the first element from the second request is ever calculated. Then everything shuts down. The fancy signature <code>Stream (Of Int) IO ()</code> could be replaced by a synonymn </p>\n\n<pre><code> type List a = Stream (Of a) IO ()\n</code></pre>\n\n<p>and you would barely notice the difference from Haskell lists, except you don't get the apocalypses you noticed. The extra moveable parts in the actual signature are distracting here, but make it possible to replicate the whole API of <code>Data.List</code> in basically every detail while permitting IO and avoidance of accumulation everywhere. (Without the further moveable parts it is e.g. impossible to write <code>splitAt</code>, <code>partition</code> and <code>chunksOf</code>, and indeed you will find stack overflow is awash with questions how to do these obvious things with e.g. <code>conduit</code>.)</p>\n\n<p>The <code>pipes</code> equivalent is this</p>\n\n<pre><code>import Pipes\nimport qualified Pipes.Prelude as P\n\nreq :: Integer -&gt; Producer Integer IO ()\nreq x = do\n  liftIO $ putStr \"Sending request #\" &gt;&gt; print x\n  each [x..x+2]\n\nreq' = for (each [1..]) req\n\nmain = runEffect $ req' &gt;-&gt; P.take 4 &gt;-&gt;  P.print \n-- &gt;&gt;&gt; main\n-- Sending request #1\n-- 1\n-- 2\n-- 3\n-- Sending request #2\n-- 2\n</code></pre>\n\n<p>it differs by treating <code>take</code> and <code>print</code> as pipes, rather than as ordinary functions on streams as they are with <code>Data.List</code>. This has charm but is not needed in the present context where the conception of the stream as an effectful list predominates. Intuitively <code>take</code>ing and <code>print</code>ing are things we do to a list, even if it is an effectful list as in this case, and the piping and conduiting aspect is a distraction (in bread-and-butter cases it also nearly doubles the time needed for calculation, due to the cost of <code>&gt;-&gt;</code> and <code>.|</code> which is akin to that of say <code>map</code>.)</p>\n\n<p>It might help understanding if we note that <code>req</code> above could have been written </p>\n\n<pre><code>req x = do\n  liftIO $ putStr \"Sending request #\" &gt;&gt; print x\n  yield x      -- yield a &gt;&gt; yield b == each [a,b]\n  yield (x+1)\n  yield (x+2)  \n</code></pre>\n\n<p>this will be word for word the same in <code>streaming</code> <code>pipes</code> and <code>conduit</code>. <code>yield a &gt;&gt; rest</code> is the same as <code>a:rest</code> The difference is that a <code>yield a</code> line (in a do block) can be preceded by a bit of IO, e.g. <code>a &lt;- liftIO readLn; yield a</code></p>\n\n<p>In general list <code>mapM</code> <code>replicateM</code> <code>traverse</code> and <code>sequence</code> should be avoided - except for short lists - for the reasons you mention. <code>sequence</code> is at the bottom of them all and it basically has to constitute the whole list before it can proceed. (Note <code>sequence = mapM id</code>; <code>mapM f = sequence . map f</code>) Thus we see </p>\n\n<pre><code> &gt;&gt;&gt; sequence [getChar,getChar,getChar] &gt;&gt;= mapM_ print\n abc'a'   -- here and below I just type abc, ghci prints 'a' 'b' 'c'\n 'b'\n 'c'\n</code></pre>\n\n<p>but with a streaming library we see stuff like </p>\n\n<pre><code> &gt;&gt;&gt; S.mapM_ print $ S.sequence $ S.each [getChar,getChar,getChar] \n a'a'\n b'b'\n c'c'\n</code></pre>\n\n<p>Similarly</p>\n\n<pre><code>&gt;&gt;&gt; replicateM 3 getChar &gt;&gt;= mapM_ print\nabc'a'\n'b'\n'c'\n</code></pre>\n\n<p>is a mess - nothing happens till the whole list is constructed, then each of the collected <code>Char</code>s is printed in succession. But with a streaming library we write the simpler</p>\n\n<pre><code>&gt;&gt;&gt; S.mapM_ print $ S.replicateM 3 getChar\na'a'\nb'b'\nc'c'\n</code></pre>\n\n<p>and the outputs are in sync with the inputs. In particular, no more than one character is in memory at a time.  <code>replicateM_</code>, <code>mapM_</code> and <code>sequence_</code> by contrast don't accumulate lists aren't a problem. It's the others that should prompt one to think of a streaming library, any streaming library. A monad-general <code>sequence</code> can't do any better than this, as you can see by reflecting on </p>\n\n<pre><code>&gt;&gt;&gt; sequence [Just 1, Just 2, Just 3]\nJust [1,2,3]\n&gt;&gt;&gt; sequence [Just 1, Just 2, Nothing]\nNothing\n</code></pre>\n\n<p>If the list were a million <code>Maybe Int</code>s long, it would all have to be remembered and left unused while waiting to see if last item is <code>Nothing</code>. Since <code>sequence</code>, <code>mapM</code>, <code>replicateM</code>, <code>traverse</code> and company are monad general, what goes for <code>Maybe</code> goes for <code>IO</code>.</p>\n\n<p>Continuing above, we can similarly collect the list as you seemed to want to do:</p>\n\n<pre><code>main = S.toList_ (S.take 4 req') &gt;&gt;= print \n-- &gt;&gt;&gt; main\n-- Sending request #1\n-- Sending request #2\n-- [1,2,3,2]\n</code></pre>\n\n<p>or, in the <code>pipes</code> version:</p>\n\n<pre><code>main = P.toListM (req' &gt;-&gt;  P.take 4) &gt;&gt;= print  \n-- &gt;&gt;&gt; main\n-- Sending request #1\n-- Sending request #2\n-- [1,2,3,2]\n</code></pre>\n\n<p>Or to pile on possibilities, we can do IO with each element, while collecting them in a list or vector or whatever</p>\n\n<pre><code>main = do\n  ls &lt;- S.toList_ $ S.print $ S.copy $ S.take 4 req'\n  print ls\n\n-- &gt;&gt;&gt; main\n-- Sending request #1\n-- 1\n-- 2\n-- 3\n-- Sending request #2\n-- 2\n-- [1,2,3,2]\n</code></pre>\n\n<p>Here I print the copies and save the 'originals' for a list. The games we are playing here start to come upon the limits of <code>pipes</code> and <code>conduit</code>, though this particular program can be replicated with them.</p>\n"}], "owner": {"reputation": 5352, "user_id": 4896150, "user_type": "registered", "accept_rate": 43, "profile_image": "https://www.gravatar.com/avatar/74d0c938f3f71d6ee14db4f6b9d222c2?s=128&d=identicon&r=PG&f=1", "display_name": "Anton Harald", "link": "https://stackoverflow.com/users/4896150/anton-harald"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 280, "favorite_count": 0, "answer_count": 5, "score": 5, "last_activity_date": 1485274786, "creation_date": 1485194608, "question_id": 41812761, "link": "https://stackoverflow.com/questions/41812761/retain-laziness-with-mapm", "title": "Retain Laziness With mapM", "body": "<p>consider the following simple IO function:</p>\n\n<pre><code>req :: IO [Integer]\nreq = do\n  print \"x\"\n  return [1,2,3]\n</code></pre>\n\n<p>In reality this might be a http request, which returns a list after parsing it's result.</p>\n\n<p>I'm trying to concatenate the results of several calls of that function in a lazy way.</p>\n\n<p>In simple terms, the following should print the 'x' only two times:</p>\n\n<pre><code>fmap (take 4) req'\n--&gt; [1, 2, 3, 4]\n</code></pre>\n\n<p>I thought this might be solved with <code>sequence</code> or <code>mapM</code>, however my approach fails in terms of laziness:</p>\n\n<pre><code>import Control.Monad\n\nreq' :: IO [Integer]\nreq' = fmap concat $ mapM req [1..1000] -- should be infinite..\n</code></pre>\n\n<p>This yields the right result, however the IO function req is called 1000 times instead of the necessary 2 times. When implementing the above with a map over an infinite list, the evaluation does not terminate at all.</p>\n"}, {"tags": ["haskell", "io"], "answers": [{"comments": [{"owner": {"reputation": 339851, "user_id": 149392, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/7a561ec0875fcbbe3066ea8fe288ec77?s=128&d=identicon&r=PG", "display_name": "sepp2k", "link": "https://stackoverflow.com/users/149392/sepp2k"}, "edited": false, "score": 0, "creation_date": 1485192822, "post_id": 41812193, "comment_id": 70812516, "body": "The problem isn&#39;t the strings, it&#39;s how they&#39;re written to the file. Using <code>hPrint</code> on <code>unlines [&quot;foo&quot;, &quot;bar&quot;]</code> won&#39;t yield any better results than <code>hPrint &quot;foo\\nbar&quot;</code>."}, {"owner": {"reputation": 303, "user_id": 4173209, "user_type": "registered", "accept_rate": 89, "profile_image": "https://www.gravatar.com/avatar/caf52eb0e43490cabe3bb0cc1f850dfc?s=128&d=identicon&r=PG&f=1", "display_name": "Valerie94", "link": "https://stackoverflow.com/users/4173209/valerie94"}, "edited": false, "score": 0, "creation_date": 1485206456, "post_id": 41812193, "comment_id": 70819883, "body": "This doesn&#39;t solve my problem. This is still writing the quotation marks to the file."}], "tags": [], "owner": {"reputation": 7873, "user_id": 2225104, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/195de66794c596e35bc145c80e9f5515?s=128&d=identicon&r=PG", "display_name": "BitTickler", "link": "https://stackoverflow.com/users/2225104/bittickler"}, "is_accepted": false, "score": 1, "last_activity_date": 1485194438, "last_edit_date": 1485194438, "creation_date": 1485192694, "answer_id": 41812193, "question_id": 41812127, "link": "https://stackoverflow.com/questions/41812127/writing-newlines-to-files/41812193#41812193", "title": "Writing newlines to files", "body": "<p>The probably idiomatic solution to what you try to do is to simply aggregate the resulting strings in a list. Then, use the <code>unlines</code> prelude function which has the signature <code>unlines :: [String] -&gt; String</code> and does your <code>\\n</code> business for you.</p>\n\n<p>Then, writing the string to disk can be done with help of <code>writeFile</code> which has the signature: <code>writeFile :: FilePath -&gt; String -&gt; IO ()</code>.</p>\n\n<p>Haskell is lazy. As such, it sometimes helps to think of Haskell lists as enumerators (C# like IEnumerable). This means here, that trying to compute line wise, then build the string manually and write it line by line is not really necessary. Just as <code>readFile</code> works lazily, so then does e.g. <code>lines</code>. In other words, you gain nothing if you try to \"optimize\" code which looks in its genuine form similar to this:</p>\n\n<pre><code>main = do\n    input &lt;- readFile \"infile\"\n    writeFile \"outfile\" ((unlines . process) (lines input))\n    where \n        process inputLines = -- whatever you do\n</code></pre>\n"}, {"comments": [{"owner": {"reputation": 303, "user_id": 4173209, "user_type": "registered", "accept_rate": 89, "profile_image": "https://www.gravatar.com/avatar/caf52eb0e43490cabe3bb0cc1f850dfc?s=128&d=identicon&r=PG&f=1", "display_name": "Valerie94", "link": "https://stackoverflow.com/users/4173209/valerie94"}, "edited": false, "score": 0, "creation_date": 1485206534, "post_id": 41812280, "comment_id": 70819922, "body": "I&#39;m now iterating over my list of strings and writing each one to the file using <code>hPutStrLn</code>. I think that&#39;s what you had in mind. Either way, it&#39;s working."}], "tags": [], "owner": {"reputation": 339851, "user_id": 149392, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/7a561ec0875fcbbe3066ea8fe288ec77?s=128&d=identicon&r=PG", "display_name": "sepp2k", "link": "https://stackoverflow.com/users/149392/sepp2k"}, "is_accepted": true, "score": 7, "last_activity_date": 1485192947, "creation_date": 1485192947, "answer_id": 41812280, "question_id": 41812127, "link": "https://stackoverflow.com/questions/41812127/writing-newlines-to-files/41812280#41812280", "title": "Writing newlines to files", "body": "<p>Don't use <code>hPrint</code> to write the strings to the file. Just like regular <code>print</code> it outputs the result of <code>show</code>, which produces a debugging-friendly version of the string with control characters and line endings escaped (and the surrounding quotes).</p>\n\n<p>Use <code>hPutStr</code> or <code>hPutStrLn</code> instead. They will write the string to the file as-is (well, the latter adds a newline at the end).</p>\n"}], "owner": {"reputation": 303, "user_id": 4173209, "user_type": "registered", "accept_rate": 89, "profile_image": "https://www.gravatar.com/avatar/caf52eb0e43490cabe3bb0cc1f850dfc?s=128&d=identicon&r=PG&f=1", "display_name": "Valerie94", "link": "https://stackoverflow.com/users/4173209/valerie94"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 728, "favorite_count": 0, "accepted_answer_id": 41812280, "answer_count": 2, "score": 1, "last_activity_date": 1485194438, "creation_date": 1485192451, "question_id": 41812127, "link": "https://stackoverflow.com/questions/41812127/writing-newlines-to-files", "title": "Writing newlines to files", "body": "<p>How can I write a string that contains newlines (\"\\n\") to a file so that each string is on a new line in the file?</p>\n\n<p>I have an accumulator function that iterates over some data and incrementally constructs a string (that contains information) for each element of the data. I don't want to write to the file every step so I'm appending the strings in each step. I do this so I can write the string in one time and limit the amount of IO. </p>\n\n<p>Adding a newline to the string via <code>str ++ \"\\n\"</code> doesn't work, <code>hPrint h str</code> will just print <code>\"\\n\"</code> instead of starting on a new line.</p>\n\n<p>I've tried accumulating a list of strings, instead of one big string, and iterating over the list and printing each string via <code>hPrint</code>. This works for the newlines but it also prints the quotation marks around each string on every line.    </p>\n"}, {"tags": ["haskell", "io", "monads", "purely-functional"], "comments": [{"owner": {"reputation": 314794, "user_id": 67579, "user_type": "registered", "accept_rate": 81, "profile_image": "https://i.stack.imgur.com/BJXub.png?s=128&g=1", "display_name": "Willem Van Onsem", "link": "https://stackoverflow.com/users/67579/willem-van-onsem"}, "edited": false, "score": 0, "creation_date": 1485192507, "post_id": 41812122, "comment_id": 70812343, "body": "It is already implemented: <code>filterM</code>."}, {"owner": {"reputation": 853, "user_id": 385711, "user_type": "registered", "accept_rate": 89, "profile_image": "https://www.gravatar.com/avatar/2f0abd395a12c96554142e3c2cad59df?s=128&d=identicon&r=PG", "display_name": "Chris", "link": "https://stackoverflow.com/users/385711/chris"}, "reply_to_user": {"reputation": 314794, "user_id": 67579, "user_type": "registered", "accept_rate": 81, "profile_image": "https://i.stack.imgur.com/BJXub.png?s=128&g=1", "display_name": "Willem Van Onsem", "link": "https://stackoverflow.com/users/67579/willem-van-onsem"}, "edited": false, "score": 0, "creation_date": 1485192624, "post_id": 41812122, "comment_id": 70812419, "body": "Sure it is, but as said this is just a contrived example. Is the general solution to always implement separately a version that interacts with IO ? That&#39;ll be a lot boilerplate code for any non-trivial algorithm."}, {"owner": {"reputation": 314794, "user_id": 67579, "user_type": "registered", "accept_rate": 81, "profile_image": "https://i.stack.imgur.com/BJXub.png?s=128&g=1", "display_name": "Willem Van Onsem", "link": "https://stackoverflow.com/users/67579/willem-van-onsem"}, "edited": false, "score": 0, "creation_date": 1485192765, "post_id": 41812122, "comment_id": 70812488, "body": "I think that would be against the use of <code>Monad</code>s. What <code>a -&gt; IO Bool</code> means is that you feed as input a variable <code>a</code> and &quot;it does some <code>IO</code> returning a bool&quot;. Now you want to convert that to &quot;doing some IO returning the generic function&quot;. But in order to execute the function, one probably needs to do IO. The conversion makes - afaik - no sense at all."}, {"owner": {"reputation": 314794, "user_id": 67579, "user_type": "registered", "accept_rate": 81, "profile_image": "https://i.stack.imgur.com/BJXub.png?s=128&g=1", "display_name": "Willem Van Onsem", "link": "https://stackoverflow.com/users/67579/willem-van-onsem"}, "edited": false, "score": 2, "creation_date": 1485192892, "post_id": 41812122, "comment_id": 70812545, "body": "Take for instance the example <code>FilePath -&gt; IO String</code> that reads from the file and returns it content. Now you want to convert that to <code>IO (FilePath -&gt; String)</code>? Performing IO such that you have a function that - regardless of the filename you give it - returns you its content without performing IO anymore? Mind that for instance in Linux some files are technically drivers to which you write bytes."}, {"owner": {"reputation": 853, "user_id": 385711, "user_type": "registered", "accept_rate": 89, "profile_image": "https://www.gravatar.com/avatar/2f0abd395a12c96554142e3c2cad59df?s=128&d=identicon&r=PG", "display_name": "Chris", "link": "https://stackoverflow.com/users/385711/chris"}, "reply_to_user": {"reputation": 314794, "user_id": 67579, "user_type": "registered", "accept_rate": 81, "profile_image": "https://i.stack.imgur.com/BJXub.png?s=128&g=1", "display_name": "Willem Van Onsem", "link": "https://stackoverflow.com/users/67579/willem-van-onsem"}, "edited": false, "score": 0, "creation_date": 1485193164, "post_id": 41812122, "comment_id": 70812695, "body": "Make sense.  Seems like there&#39;s no choice but to have a separate function signature. But surely there are some ways to share code between the two implementation? After all the only differences between the two are lifting things in and out of IO."}, {"owner": {"reputation": 314794, "user_id": 67579, "user_type": "registered", "accept_rate": 81, "profile_image": "https://i.stack.imgur.com/BJXub.png?s=128&g=1", "display_name": "Willem Van Onsem", "link": "https://stackoverflow.com/users/67579/willem-van-onsem"}, "edited": false, "score": 0, "creation_date": 1485193287, "post_id": 41812122, "comment_id": 70812754, "body": "indeed because a monad forces &quot;order&quot; so to speak, that <code>f</code> is called after <code>g</code> is called. And it can also depend on the previous call. A generic function <code>FilePath -&gt; Maybe String -&gt; IO String</code> could for instance act as a read/writer: if the <code>Maybe String</code> is <code>Just _</code>, the content is written to a file, so now the previous monadic call has <i>effects</i> on the next one. Because if you later decide to read from that file, the previous write will have modified something. A simple monad I sometimes use to conceptualize is the state monad: you carry a state with you and each function can read/write."}, {"owner": {"reputation": 15757, "user_id": 176841, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/45a168cb9eb8454d66c78f18e29d9342?s=128&d=identicon&r=PG", "display_name": "jberryman", "link": "https://stackoverflow.com/users/176841/jberryman"}, "edited": false, "score": 0, "creation_date": 1485193372, "post_id": 41812122, "comment_id": 70812803, "body": "It&#39;s not clear what you&#39;re asking. &quot;to share code between the two implementation&quot; do you mean to share code between <code>filter</code> and <code>filterM</code>? This sounds like either an X/Y problem (which we can&#39;t help you with without a proper example), or a hypothetical &quot;gotcha&quot; type question."}, {"owner": {"reputation": 314794, "user_id": 67579, "user_type": "registered", "accept_rate": 81, "profile_image": "https://i.stack.imgur.com/BJXub.png?s=128&g=1", "display_name": "Willem Van Onsem", "link": "https://stackoverflow.com/users/67579/willem-van-onsem"}, "reply_to_user": {"reputation": 15757, "user_id": 176841, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/45a168cb9eb8454d66c78f18e29d9342?s=128&d=identicon&r=PG", "display_name": "jberryman", "link": "https://stackoverflow.com/users/176841/jberryman"}, "edited": false, "score": 0, "creation_date": 1485193424, "post_id": 41812122, "comment_id": 70812823, "body": "@jberryman: I think what the OP aims to do is &quot;hack&quot; the inner function out of <code>a -&gt; IO b</code> and then use the <i>good old filter</i>."}, {"owner": {"reputation": 853, "user_id": 385711, "user_type": "registered", "accept_rate": 89, "profile_image": "https://www.gravatar.com/avatar/2f0abd395a12c96554142e3c2cad59df?s=128&d=identicon&r=PG", "display_name": "Chris", "link": "https://stackoverflow.com/users/385711/chris"}, "reply_to_user": {"reputation": 15757, "user_id": 176841, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/45a168cb9eb8454d66c78f18e29d9342?s=128&d=identicon&r=PG", "display_name": "jberryman", "link": "https://stackoverflow.com/users/176841/jberryman"}, "edited": false, "score": 0, "creation_date": 1485193799, "post_id": 41812122, "comment_id": 70813022, "body": "@jberryman the original question is about whether it&#39;s possible to do without having to write a IO version of the same function(the answer seems no). The question that I asked in the comment is given pure version of the function, can you implement the IO version without re-writing everything? I have concrete example but I don&#39;t think it adds anything to the underlying question."}, {"owner": {"reputation": 31243, "user_id": 2751851, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/4ddc0.png?s=128&g=1", "display_name": "duplode", "link": "https://stackoverflow.com/users/2751851/duplode"}, "reply_to_user": {"reputation": 314794, "user_id": 67579, "user_type": "registered", "accept_rate": 81, "profile_image": "https://i.stack.imgur.com/BJXub.png?s=128&g=1", "display_name": "Willem Van Onsem", "link": "https://stackoverflow.com/users/67579/willem-van-onsem"}, "edited": false, "score": 0, "creation_date": 1485195618, "post_id": 41812122, "comment_id": 70814065, "body": "It is also worth noting that the impossibility of going from <code>a -&gt; IO b</code> to <code>IO (a -&gt; b)</code> that @WillemVanOnsem has explained reflects the difference between <code>Monad</code> and <code>Applicative</code>."}, {"owner": {"reputation": 100185, "user_id": 3234959, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/93bb12ca0f93dfddb33880316f7e66c2?s=128&d=identicon&r=PG&f=1", "display_name": "chi", "link": "https://stackoverflow.com/users/3234959/chi"}, "edited": false, "score": 1, "creation_date": 1485200614, "post_id": 41812122, "comment_id": 70816751, "body": "This is a potential duplicate of <a href=\"http://stackoverflow.com/questions/27267848/turning-a-mb-into-ma-b\" title=\"turning a mb into ma b\">stackoverflow.com/questions/27267848/turning-a-mb-into-ma-b</a> , especially given the last question."}, {"owner": {"reputation": 31243, "user_id": 2751851, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/4ddc0.png?s=128&g=1", "display_name": "duplode", "link": "https://stackoverflow.com/users/2751851/duplode"}, "reply_to_user": {"reputation": 100185, "user_id": 3234959, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/93bb12ca0f93dfddb33880316f7e66c2?s=128&d=identicon&r=PG&f=1", "display_name": "chi", "link": "https://stackoverflow.com/users/3234959/chi"}, "edited": false, "score": 0, "creation_date": 1485200959, "post_id": 41812122, "comment_id": 70816931, "body": "@chi Given how the question has evolved, I don&#39;t think it is quite a duplicate anymore. Still, your answer there covers very well the discussion in the comments here."}, {"owner": {"reputation": 100185, "user_id": 3234959, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/93bb12ca0f93dfddb33880316f7e66c2?s=128&d=identicon&r=PG&f=1", "display_name": "chi", "link": "https://stackoverflow.com/users/3234959/chi"}, "reply_to_user": {"reputation": 31243, "user_id": 2751851, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/4ddc0.png?s=128&g=1", "display_name": "duplode", "link": "https://stackoverflow.com/users/2751851/duplode"}, "edited": false, "score": 0, "creation_date": 1485205752, "post_id": 41812122, "comment_id": 70819531, "body": "@duplode Indeed, I intentionally did not vote this as a duplicate since that would close it at once. This question is more nuanced."}], "answers": [{"comments": [{"owner": {"reputation": 31243, "user_id": 2751851, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/4ddc0.png?s=128&g=1", "display_name": "duplode", "link": "https://stackoverflow.com/users/2751851/duplode"}, "edited": false, "score": 0, "creation_date": 1485196192, "post_id": 41812966, "comment_id": 70814396, "body": "Footnote: I wondered for a moment about whether there was a version of <code>filterM</code> generalised to <code>Applicative</code>; then I hoogled it and found <a href=\"https://hackage.haskell.org/package/base-4.9.1.0/docs/Control-Monad.html#v:filterM\" rel=\"nofollow noreferrer\">it is <code>filterM</code> itself</a>!"}, {"owner": {"reputation": 853, "user_id": 385711, "user_type": "registered", "accept_rate": 89, "profile_image": "https://www.gravatar.com/avatar/2f0abd395a12c96554142e3c2cad59df?s=128&d=identicon&r=PG", "display_name": "Chris", "link": "https://stackoverflow.com/users/385711/chris"}, "edited": false, "score": 0, "creation_date": 1485196455, "post_id": 41812966, "comment_id": 70814532, "body": "@Alec Thanks! The <code>Identity</code> monad is what I have been missing."}, {"owner": {"reputation": 853, "user_id": 385711, "user_type": "registered", "accept_rate": 89, "profile_image": "https://www.gravatar.com/avatar/2f0abd395a12c96554142e3c2cad59df?s=128&d=identicon&r=PG", "display_name": "Chris", "link": "https://stackoverflow.com/users/385711/chris"}, "edited": false, "score": 0, "creation_date": 1485197482, "post_id": 41812966, "comment_id": 70815103, "body": "Minor correction: the pure example should also use <code>filterM</code>"}, {"owner": {"reputation": 29444, "user_id": 3072788, "user_type": "registered", "accept_rate": 82, "profile_image": "https://www.gravatar.com/avatar/220a45c2fcff7e7358d144551b116205?s=128&d=identicon&r=PG&f=1", "display_name": "Alec", "link": "https://stackoverflow.com/users/3072788/alec"}, "reply_to_user": {"reputation": 853, "user_id": 385711, "user_type": "registered", "accept_rate": 89, "profile_image": "https://www.gravatar.com/avatar/2f0abd395a12c96554142e3c2cad59df?s=128&d=identicon&r=PG", "display_name": "Chris", "link": "https://stackoverflow.com/users/385711/chris"}, "edited": false, "score": 0, "creation_date": 1485198082, "post_id": 41812966, "comment_id": 70815427, "body": "@Chris Thanks! Important correction. - it is sort of the point of the question. :)"}, {"owner": {"reputation": 29444, "user_id": 3072788, "user_type": "registered", "accept_rate": 82, "profile_image": "https://www.gravatar.com/avatar/220a45c2fcff7e7358d144551b116205?s=128&d=identicon&r=PG&f=1", "display_name": "Alec", "link": "https://stackoverflow.com/users/3072788/alec"}, "reply_to_user": {"reputation": 31243, "user_id": 2751851, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/4ddc0.png?s=128&g=1", "display_name": "duplode", "link": "https://stackoverflow.com/users/2751851/duplode"}, "edited": false, "score": 0, "creation_date": 1485198838, "post_id": 41812966, "comment_id": 70815834, "body": "@duplode That bugs me so much... Only half the functions in <code>Control.Monad</code> have been generalized to <code>Applicative</code> and yet they all have the <code>M</code> suffix."}], "tags": [], "owner": {"reputation": 29444, "user_id": 3072788, "user_type": "registered", "accept_rate": 82, "profile_image": "https://www.gravatar.com/avatar/220a45c2fcff7e7358d144551b116205?s=128&d=identicon&r=PG&f=1", "display_name": "Alec", "link": "https://stackoverflow.com/users/3072788/alec"}, "is_accepted": true, "score": 5, "last_activity_date": 1485200633, "last_edit_date": 1485200633, "creation_date": 1485195366, "answer_id": 41812966, "question_id": 41812122, "link": "https://stackoverflow.com/questions/41812122/how-to-interact-with-pure-algorithm-in-io-code/41812966#41812966", "title": "How to interact with pure algorithm in IO code", "body": "<blockquote>\n  <p>How do it make it work with filter without writing a separate implementation</p>\n</blockquote>\n\n<p>That isn't possible and the fact this sort of thing isn't possible is by design - Haskell places firm limits on its types and you have to obey them. You cannot sprinkle <code>IO</code> all over the place willy-nilly.</p>\n\n<blockquote>\n  <p>Now the question is, can I structure my code so that the pure and IO versions don't completely duplicate the core logic?</p>\n</blockquote>\n\n<p>You'll be interested in <a href=\"http://hackage.haskell.org/package/base-4.9.1.0/docs/Control-Monad.html#v:filterM\" rel=\"nofollow noreferrer\"><code>filterM</code></a>. Then, you can get both the functionality of <code>filterIO</code> by using the <code>IO</code> monad and the pure functionality using the <a href=\"https://hackage.haskell.org/package/base-4.9.1.0/docs/Data-Functor-Identity.html#t:Identity\" rel=\"nofollow noreferrer\"><code>Identity</code></a> monad. Of course, for the pure case, you now have to pay the extra price of wrapping/unwrapping (or <code>coerce</code>ing) the <code>Identity</code> wrapper. (Side remark: since <code>Identity</code> is a <code>newtype</code> this is only a code readability cost, not a runtime one.)</p>\n\n<pre><code> ghci&gt; data Color = Red | Green | Blue deriving (Read, Show, Eq)\n</code></pre>\n\n<p>Here is a monadic example (note that the lines containing only <code>Red</code>, <code>Blue</code>, and <code>Blue</code> are user-entered at the prompt):</p>\n\n<pre><code> ghci&gt; filterM (\\x -&gt; do y&lt;-readLn; pure (x==y)) [Red,Green,Blue]\n Red\n Blue\n Blue\n [Red,Blue] :: IO [Color]\n</code></pre>\n\n<p>Here is a pure example:</p>\n\n<pre><code> ghci&gt; filterM (\\x -&gt; Identity (x /= Green)) [Red,Green,Blue]\n Identity [Red,Blue] :: Identity [Color]\n</code></pre>\n"}, {"tags": [], "owner": {"reputation": 100892, "user_id": 745903, "user_type": "registered", "accept_rate": 74, "profile_image": "https://www.gravatar.com/avatar/50933f6638836741e620669b3940410e?s=128&d=identicon&r=PG", "display_name": "leftaroundabout", "link": "https://stackoverflow.com/users/745903/leftaroundabout"}, "is_accepted": false, "score": 1, "last_activity_date": 1485200476, "last_edit_date": 1485200476, "creation_date": 1485199774, "answer_id": 41814131, "question_id": 41812122, "link": "https://stackoverflow.com/questions/41812122/how-to-interact-with-pure-algorithm-in-io-code/41814131#41814131", "title": "How to interact with pure algorithm in IO code", "body": "<p>As already said, you can use <code>filterM</code> for this specific task. However, it is usually better to keep with Haskell's characteristic strict seperation of IO and calculations. In your case, you can just tick off all necessary <code>IO</code> in one go and then do the interesting filtering in nice, reliable, easily testable pure code (i.e. here, simply with the normal <code>filter</code>):</p>\n\n<pre><code>type A = Int\ntype Annotated = (A, Bool)\n\np' :: Annotated -&gt; Bool\np' = snd\n\nmain :: IO ()\nmain = do \n  candidates &lt;- forM [1..100] $ \\n -&gt; do\n      permitted &lt;- p n\n      return (n, permitted)\n  print $ fst &lt;$&gt; filter p' candidates\n</code></pre>\n\n<p>Here, we first annotate each number with a flag indicating what the environment says. This flag can then simply be read out in the actual filtering step, without requiring any further IO.</p>\n\n<p>In short, this would be written:</p>\n\n<pre><code>main :: IO ()\nmain = do \n  candidates &lt;- forM [1..100] $ \\n -&gt; (n,) &lt;$&gt; p n\n  print $ fst &lt;$&gt; filter snd candidates\n</code></pre>\n\n<hr>\n\n<p>While it is not feasible for this specific task, I'd also add that you <em>can</em> in principle achieve the <code>IO</code> seperation with something like your <code>p'</code>. This requires that the type <code>A</code> is \u201csmall enough\u201d that you can evaluate the predicate with <em>all</em> values that are possible at all. For instance,</p>\n\n<pre><code>import qualified Data.Map as Map\n\ntype A = Char\n\np' :: IO (A -&gt; Bool)\np' = (Map.!) . Map.fromList &lt;$&gt; mapM (\\c -&gt; (c,) &lt;$&gt; p c) ['\\0'..]\n</code></pre>\n\n<p>This evaluates the predicate once for <em>all</em> of the 1114112 chars there are and stores the results in a lookup table.</p>\n"}], "owner": {"reputation": 853, "user_id": 385711, "user_type": "registered", "accept_rate": 89, "profile_image": "https://www.gravatar.com/avatar/2f0abd395a12c96554142e3c2cad59df?s=128&d=identicon&r=PG", "display_name": "Chris", "link": "https://stackoverflow.com/users/385711/chris"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 189, "favorite_count": 0, "accepted_answer_id": 41812966, "answer_count": 2, "score": 2, "last_activity_date": 1485200633, "creation_date": 1485192436, "last_edit_date": 1485199243, "question_id": 41812122, "link": "https://stackoverflow.com/questions/41812122/how-to-interact-with-pure-algorithm-in-io-code", "title": "How to interact with pure algorithm in IO code", "body": "<p>To illustrate the point with a trivial example, say I have implemented <code>filter</code>:</p>\n\n<pre class=\"lang-hs prettyprint-override\"><code>filter :: (a -&gt; Bool) -&gt; [a] -&gt; [a]\n</code></pre>\n\n<p>And I have a predicate <code>p</code> that interacts with the real world:</p>\n\n<pre class=\"lang-hs prettyprint-override\"><code>p :: a -&gt; IO Bool\n</code></pre>\n\n<p>How do it make it work with <code>filter</code> without writing a separate implementation:</p>\n\n<pre class=\"lang-hs prettyprint-override\"><code>filterIO :: (a -&gt; IO Bool) -&gt; [a] -&gt; IO [a]\n</code></pre>\n\n<p>Presumably if I can turn <code>p</code> into <code>p'</code>:</p>\n\n<pre class=\"lang-hs prettyprint-override\"><code>p': IO (a -&gt; Bool)\n</code></pre>\n\n<p>Then I can do</p>\n\n<pre class=\"lang-hs prettyprint-override\"><code>main :: IO ()\nmain = do \n  p'' &lt;- p'\n  print $ filter p'' [1..100]\n</code></pre>\n\n<p>But I haven't been able to find the conversion.</p>\n\n<p><strong>Edited:</strong> \nAs people have pointed out in the comment, such a conversion doesn't make sense as it would break the encapsulation of the IO Monad.</p>\n\n<p>Now the question is, can I structure my code so that the pure and IO versions don't completely duplicate the core logic?</p>\n"}, {"tags": ["list", "function", "haskell"], "comments": [{"owner": {"reputation": 31243, "user_id": 2751851, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/4ddc0.png?s=128&g=1", "display_name": "duplode", "link": "https://stackoverflow.com/users/2751851/duplode"}, "edited": false, "score": 3, "creation_date": 1485189176, "post_id": 41810985, "comment_id": 70810261, "body": "Your function exists in <code>Data.List</code> as <a href=\"http://hackage.haskell.org/package/base-4.9.1.0/docs/Data-List.html#v:mapAccumL\" rel=\"nofollow noreferrer\"><code>mapAccumL</code></a>."}, {"owner": {"reputation": 7873, "user_id": 2225104, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/195de66794c596e35bc145c80e9f5515?s=128&d=identicon&r=PG", "display_name": "BitTickler", "link": "https://stackoverflow.com/users/2225104/bittickler"}, "edited": false, "score": 0, "creation_date": 1485189240, "post_id": 41810985, "comment_id": 70810300, "body": "Is that not simply a fold? <code>exec values b0 = fst $ foldl (\\(out,b) v -&gt; let (o,b&#39;) =f v b in (out ++ [o],b&#39;) ([],b0) values</code> ? The only bad part is that it is not appending on the front here..."}, {"owner": {"reputation": 15757, "user_id": 176841, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/45a168cb9eb8454d66c78f18e29d9342?s=128&d=identicon&r=PG", "display_name": "jberryman", "link": "https://stackoverflow.com/users/176841/jberryman"}, "edited": false, "score": 1, "creation_date": 1485191872, "post_id": 41810985, "comment_id": 70811978, "body": "It&#39;s not clear what you&#39;re asking, as you&#39;ve already implemented the function. Next time you can put the type signature you want into hoogle to find what you&#39;re looking for"}], "answers": [{"comments": [{"owner": {"reputation": 31243, "user_id": 2751851, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/4ddc0.png?s=128&g=1", "display_name": "duplode", "link": "https://stackoverflow.com/users/2751851/duplode"}, "reply_to_user": {"reputation": 3303, "user_id": 1361532, "user_type": "registered", "accept_rate": 71, "profile_image": "https://www.gravatar.com/avatar/733f00fe978dd7a7ce42de3bb9734f6d?s=128&d=identicon&r=PG", "display_name": "Shawn", "link": "https://stackoverflow.com/users/1361532/shawn"}, "edited": false, "score": 6, "creation_date": 1485198442, "post_id": 41812341, "comment_id": 70815596, "body": "@Shawn This provides an answer to the question, even if it is a very terse one. @MigMit It would be a good idea to add some further explanation, as the relationship between <code>State</code> and the list function in the question likely won&#39;t be obvious to the OP, who seems to be a beginner."}], "tags": [], "owner": {"reputation": 1679, "user_id": 1722752, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/ef35ad86b627ba3176b6aea8a184f51c?s=128&d=identicon&r=PG", "display_name": "MigMit", "link": "https://stackoverflow.com/users/1722752/migmit"}, "is_accepted": true, "score": 0, "last_activity_date": 1485252669, "last_edit_date": 1485252669, "creation_date": 1485193161, "answer_id": 41812341, "question_id": 41810985, "link": "https://stackoverflow.com/questions/41810985/modeling-recursive-fmap-sort-of-over-a-list/41812341#41812341", "title": "Modeling recursive fmap (sort of) over a list", "body": "<p>It's <code>mapM</code> for the <code>State</code> monad.</p>\n\n<p>OK, expanding a little.</p>\n\n<p>Let's first enter this into ghci and see the type of the <code>exec</code> function:</p>\n\n<pre><code>Prelude&gt; let {exec _ [] _ = []; exec f (x:xs) b = let (x',b') = f x b in x':(exec f xs b')}\nPrelude&gt; :t exec\nexec :: (t2 -&gt; t1 -&gt; (t, t1)) -&gt; [t2] -&gt; t1 -&gt; [t]\n</code></pre>\n\n<p>It's almost as you described, except that <code>t</code> and <code>t2</code> don't have to be of the same type. That's good.</p>\n\n<p>Now, another observation: we actually lose information, when we do what you describe. Specifically, we throw away the last value of <code>b</code> (or <code>t</code>, as ghci calls it). Let us preserve it for a moment; we can always throw it away later:</p>\n\n<pre><code>exec' _ [] b = ([], b)\nexec' f (x:xs) b =\n  let (x',b') = f x b\n      (xs', b'') = exec' f xs b'\n  in (x':xs', b'')\n</code></pre>\n\n<p>And ghci says</p>\n\n<pre><code>Prelude&gt; :t exec'\nexec' :: (t2 -&gt; t1 -&gt; (t, t1)) -&gt; [t2] -&gt; t1 -&gt; ([t], t1)\n</code></pre>\n\n<p>Than we can define</p>\n\n<pre><code>exec f xs b = fst $ exec' f xs b\n</code></pre>\n\n<p>But now the type of <code>exec'</code> contains a clear pattern. We can make it more explicit:</p>\n\n<pre><code>type S b c = b -&gt; (c, b)\nexec' :: (a -&gt; S b c) -&gt; [a] -&gt; S b [c]\n</code></pre>\n\n<p>And now it's clear that <code>S</code> is almost exactly the <code>State</code> monad (well, it's actual definition in a modern setting is a bit more complicated, but not much: <a href=\"https://hackage.haskell.org/package/mtl-2.2.1/docs/Control-Monad-State-Lazy.html#t:StateT\" rel=\"nofollow noreferrer\">https://hackage.haskell.org/package/mtl-2.2.1/docs/Control-Monad-State-Lazy.html#t:StateT</a>); really, it's just a newtype:</p>\n\n<pre><code>newtype State b c = State {runState :: b -&gt; (c, b)}\n</code></pre>\n\n<p>And if we generalize the type of exec' to use an arbitrary monad instead of <code>State</code>, we get</p>\n\n<pre><code>Monad m =&gt; (a -&gt; m c) -&gt; [a] -&gt; m [c]\n</code></pre>\n\n<p>Of course, we can't know for sure that such a thing actually exists, since we only have an implementation for the <code>State</code> monad, but... it does. It's called <code>mapM</code> (again, it's actual definition in the modern setting is more complicated: <a href=\"https://hackage.haskell.org/package/base-4.9.1.0/docs/Prelude.html#v:mapM\" rel=\"nofollow noreferrer\">https://hackage.haskell.org/package/base-4.9.1.0/docs/Prelude.html#v:mapM</a>) \u2014 which makes sense, since without a monad it would be just</p>\n\n<pre><code>(a -&gt; c) -&gt; [a] -&gt; [c]\n</code></pre>\n\n<p>and that's exactly the type of <code>map</code>.</p>\n\n<p>Of course, you can't be sure that <code>exec'</code> IS <code>mapM</code> without examining the latter's implementation. But in Haskell it just often happens that things that have the same type, if it's reasonably generic, are one and the same.</p>\n\n<p>It also makes sense that <code>State</code> monad would be involved somehow \u2014 after all, you DO use <code>b</code> as a state, changing it as you go through the list.</p>\n\n<p>So, if <code>exec'</code> is <code>mapM</code>, how do we get back to <code>exec</code>? Well, we need to go from the monadic value <code>State b [c]</code> to just <code>[c]</code>, feeding it some <code>b</code>. We can \u2014 again \u2014 generalize; let's say, we go from <code>State b d</code> to <code>d</code>, without mentioning the list. And again \u2014 there is a function like that, it's called <code>evalState</code>: <a href=\"https://hackage.haskell.org/package/mtl-2.2.1/docs/Control-Monad-State-Lazy.html#v:evalState\" rel=\"nofollow noreferrer\">https://hackage.haskell.org/package/mtl-2.2.1/docs/Control-Monad-State-Lazy.html#v:evalState</a>.</p>\n\n<p>So, finally, we are able to produce the final result:</p>\n\n<pre><code>eval f xs b = evalState (mapM (\\x -&gt; state (\\b -&gt; f x b)) xs) b\n</code></pre>\n\n<p>which we can shorten to</p>\n\n<pre><code>eval f xs b = evalState (mapM (\\x -&gt; state (f x)) xs) b\n</code></pre>\n\n<p>or just</p>\n\n<pre><code>eval f xs = evalState (mapM (state . f) xs)\n</code></pre>\n\n<p>or even</p>\n\n<pre><code>eval f = evalState . mapM (state . f)\n</code></pre>\n\n<p>We can make it completely point-free, but that would be pointless (and contain too many points):</p>\n\n<pre><code>eval = (evalState .) . mapM . (state .)\n</code></pre>\n"}], "owner": {"reputation": 325, "user_id": 6307462, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/86c0a6c9d84223ab345ded7b20b35788?s=128&d=identicon&r=PG", "display_name": "Sam Coutteau", "link": "https://stackoverflow.com/users/6307462/sam-coutteau"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 116, "favorite_count": 0, "accepted_answer_id": 41812341, "answer_count": 1, "score": 0, "last_activity_date": 1485252669, "creation_date": 1485188715, "last_edit_date": 1485189566, "question_id": 41810985, "link": "https://stackoverflow.com/questions/41810985/modeling-recursive-fmap-sort-of-over-a-list", "title": "Modeling recursive fmap (sort of) over a list", "body": "<p>I was wondering what the best way is to implement the following problem in a functional programming language (in this example Haskell):</p>\n\n<p>You have a function (or a 'way') that turns 2 inputs, with the type <code>a</code> and <code>b</code>, in 2 ouputs of the same type (ex: Half adder). Lets call it <code>f</code>\nin Haskell it would have this sort of type signature\n<code>a -&gt; b -&gt; (a, b)</code></p>\n\n<p>And you have a list with elements of type <code>a</code>. (or another type of data structure).</p>\n\n<p>Now if supplied with an initial <code>b</code> I want the following thing to happen (concept explained with recursive implementation):</p>\n\n<p>Execute <code>f</code> with the initial <code>b</code> and the first element, modify the <code>b</code> and the element with the output of the function and repeat for the next element.</p>\n\n<p>In Haskell:</p>\n\n<pre><code>exec _ [] _     = []\nexec f (x:xs) b = let (x',b') = f x b in x':(exec f xs b')\n</code></pre>\n\n<p>What would be the best/most efficient way to model this sort of behavior.</p>\n"}, {"tags": ["haskell", "jpeg", "bytestring"], "comments": [{"owner": {"reputation": 43759, "user_id": 1651941, "user_type": "registered", "accept_rate": 97, "profile_image": "https://www.gravatar.com/avatar/a513bc1fa519d2fcf5e4e0d9b5500101?s=128&d=identicon&r=PG", "display_name": "Sibi", "link": "https://stackoverflow.com/users/1651941/sibi"}, "edited": false, "score": 2, "creation_date": 1485183458, "post_id": 41808675, "comment_id": 70806431, "body": "Any specific reason for using the <code>http</code> library instead of other modern ones present ? Note that the package doesn&#39;t support https and is mostly in the maintenance phase."}, {"owner": {"reputation": 5352, "user_id": 4896150, "user_type": "registered", "accept_rate": 43, "profile_image": "https://www.gravatar.com/avatar/74d0c938f3f71d6ee14db4f6b9d222c2?s=128&d=identicon&r=PG&f=1", "display_name": "Anton Harald", "link": "https://stackoverflow.com/users/4896150/anton-harald"}, "reply_to_user": {"reputation": 43759, "user_id": 1651941, "user_type": "registered", "accept_rate": 97, "profile_image": "https://www.gravatar.com/avatar/a513bc1fa519d2fcf5e4e0d9b5500101?s=128&d=identicon&r=PG", "display_name": "Sibi", "link": "https://stackoverflow.com/users/1651941/sibi"}, "edited": false, "score": 0, "creation_date": 1485183737, "post_id": 41808675, "comment_id": 70806632, "body": "No there is no reason. Was just a lack of information. Actually I just found out now about the HTTPS, which I&#39;d definitely need. HTTP-Conduit then? Or what would you suggest?"}, {"owner": {"reputation": 3231, "user_id": 1013393, "user_type": "registered", "accept_rate": 60, "profile_image": "https://www.gravatar.com/avatar/7bca51e5ae3eb8dc24a98616b4e5d6fd?s=128&d=identicon&r=PG", "display_name": "sjakobi", "link": "https://stackoverflow.com/users/1013393/sjakobi"}, "edited": false, "score": 2, "creation_date": 1485187820, "post_id": 41808675, "comment_id": 70809351, "body": "http-client or http-conduit: <a href=\"https://haskell-lang.org/library/http-client\" rel=\"nofollow noreferrer\">Here</a>&#39;s a tutorial for the two."}], "owner": {"reputation": 5352, "user_id": 4896150, "user_type": "registered", "accept_rate": 43, "profile_image": "https://www.gravatar.com/avatar/74d0c938f3f71d6ee14db4f6b9d222c2?s=128&d=identicon&r=PG&f=1", "display_name": "Anton Harald", "link": "https://stackoverflow.com/users/4896150/anton-harald"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 107, "favorite_count": 0, "answer_count": 0, "score": 0, "last_activity_date": 1485181753, "creation_date": 1485181753, "question_id": 41808675, "link": "https://stackoverflow.com/questions/41808675/receive-bytestring-by-http-request", "title": "Receive ByteString by HTTP Request", "body": "<p>I'm trying to download an JPG image with an HTTP request in a way that it can be decoded for further processing.</p>\n\n<p>It looks like a combination of the <a href=\"http://hackage.haskell.org/package/HTTP\" rel=\"nofollow noreferrer\">HTTP</a> and the <a href=\"http://hackage.haskell.org/package/stb-image\" rel=\"nofollow noreferrer\">stb-image</a> package should do the trick.</p>\n\n<p>The latter provides a decoding function:</p>\n\n<pre><code>decodeImage :: ByteString -&gt; IO (Either String Image)\n</code></pre>\n\n<p>Whereas the ByteString must be strict.</p>\n\n<p>The former promises in their docs, that the 'representation of the bytes flowing' is extrensible via a type class, whereas ByteString and String are already provided by their lib. Here is an example of receiving a String:</p>\n\n<pre><code>do\n  rsp &lt;- Network.HTTP.simpleHTTP (getRequest \"http://url.sth/img.jpg\")\n  fmap (take 100) (getResponseBody rsp)\n</code></pre>\n\n<p>I could not figure out how to configure the request in order to receive a ByteString. Could someone help me out here?</p>\n\n<p><em>Bonus question:</em> It looks like a Byte String is a good choice for this kind of data. Can someone explain the reason for this? And also, in which way it differs from a ByteArray.</p>\n"}, {"tags": ["haskell", "types", "monads", "applicative"], "answers": [{"tags": [], "owner": {"reputation": 384463, "user_id": 1126841, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/fa05233b2357f8d11c22ef4cfc7bb85c?s=128&d=identicon&r=PG", "display_name": "chepner", "link": "https://stackoverflow.com/users/1126841/chepner"}, "is_accepted": true, "score": 2, "last_activity_date": 1485190709, "last_edit_date": 1485190709, "creation_date": 1485188824, "answer_id": 41811014, "question_id": 41808563, "link": "https://stackoverflow.com/questions/41808563/understanding-different-monadic-and-applicative-binds-combinators-in-the-context/41811014#41811014", "title": "Understanding different monadic and applicative binds/combinators in the context of a data type constructor?", "body": "<p><code>:&gt;&gt;=</code> doesn't actually do anything with its arguments; it simply creates a new value of type <code>MyExample e i</code> that you could later <em>interpret</em> as a call to <code>&gt;&gt;=</code>, but you could do practically anything you want with it using a different interpreter.</p>\n"}], "owner": {"reputation": 2691, "user_id": 5477287, "user_type": "registered", "accept_rate": 87, "profile_image": "https://i.stack.imgur.com/yKMgF.jpg?s=128&g=1", "display_name": "Babra Cunningham", "link": "https://stackoverflow.com/users/5477287/babra-cunningham"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 69, "favorite_count": 1, "accepted_answer_id": 41811014, "answer_count": 1, "score": 0, "last_activity_date": 1485190709, "creation_date": 1485181398, "question_id": 41808563, "link": "https://stackoverflow.com/questions/41808563/understanding-different-monadic-and-applicative-binds-combinators-in-the-context", "title": "Understanding different monadic and applicative binds/combinators in the context of a data type constructor?", "body": "<p>I've been given the following piece of code, which I am trying to get my head around:</p>\n\n<pre><code>data MyExample e i = MyExample (CustomMonad e i)\n   | forall b. MyExample e b :&gt;&gt;= (b -&gt; CustomMonad e b)\n   | forall b. (MyExample e (b -&gt; a)) :&lt;*&gt; (MyExample e b)\n   | forall b. (b -&gt; a) :&lt;$&gt; (MyExample e b)\n</code></pre>\n\n<p>1) What do <code>:&gt;&gt;=</code>, <code>:&lt;*&gt;</code> and <code>:&lt;$&gt;</code> do differently, as opposed to </p>\n\n<p>Monadic bind <code>&gt;&gt;=</code></p>\n\n<pre><code>exampleFunction :: Int -&gt; Maybe Int\nexampleFunction el = Just (el + 100)\nmain = do \n  result &lt;- exampleFunction &gt;&gt;= exampleFunction 21\n</code></pre>\n\n<p>Applicative combinators <code>&lt;*&gt;</code> and <code>&lt;$&gt;</code></p>\n\n<pre><code>exampleFunction :: Int -&gt; Maybe Int\nexampleFunction el = Just el\nmain = do \n result &lt;- pure exampleFunction &lt;$&gt; (+) &lt;*&gt; (ExampleType 2) &lt;*&gt; (ExampleType 4)\n</code></pre>\n\n<p>2)  Am I right in saying the following:</p>\n\n<p>a) <code>MyExample (CustomMonad e i)</code> is constructing the <code>CustomMonad</code> type with e and i, then wrapping this in the <code>MyExample</code> context?</p>\n\n<p>b) <code>forall b. MyExample e b :&gt;&gt;= (b -&gt; CustomMonad e b)</code> is taking a <code>(MyExample e i)</code> then taking b and inputting this into a function (<code>b -&gt; CustomMonad e b</code>) that constructs a <code>(CustomMonad e b)</code>? </p>\n\n<p>c) <code>forall b. (MyExample e (b -&gt; a)) :&lt;*&gt; (MyExample eb)</code> is taking a <code>MyExample</code> constructed with a value <code>e</code> and a function <code>(b -&gt; a)</code> and perform <em>some kind</em> of applicative combinator operation with a <code>MyExample e b</code>?</p>\n\n<p>d) <code>forall b. (b -&gt; a) :&lt;$&gt; (MyExample e b)</code> is passing some result from <code>(MyExample e b)</code> to a function <code>(b -&gt; a)</code></p>\n\n<p>Additionally, am I right in saying the use of <code>forall b</code> is ensuring that <code>b</code> is the same type throughout the operation?</p>\n"}, {"tags": ["haskell", "haskell-snap-framework", "heist"], "answers": [{"tags": [], "owner": {"reputation": 1227, "user_id": 5053374, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/efe57f0998df065470ff42c938f781cf?s=128&d=identicon&r=PG", "display_name": "Libby", "link": "https://stackoverflow.com/users/5053374/libby"}, "is_accepted": true, "score": 3, "last_activity_date": 1485183117, "creation_date": 1485183117, "answer_id": 41809155, "question_id": 41808501, "link": "https://stackoverflow.com/questions/41808501/html-doctype-rendered-with-snap-heist-template/41809155#41809155", "title": "HTML doctype rendered with Snap / Heist template", "body": "<p>Your first example isn't valid HTML. I think you want:</p>\n\n<pre><code>&lt;!DOCTYPE html&gt;\n&lt;html&gt;\n&lt;/html&gt;\n</code></pre>\n\n<p>The doctype is not the same as an opening <code>&lt;html&gt;</code> tag. </p>\n\n<p>Browsers are really permissive, so they'll accept your version without complaint, but Interpreted Heist tries to parse templates into valid HTML, so it chokes on an ending tag (<code>&lt;/html&gt;</code>) without the correct opening tag first.</p>\n"}], "owner": {"reputation": 19307, "user_id": 1663462, "user_type": "registered", "accept_rate": 78, "profile_image": "https://www.gravatar.com/avatar/c30e0fa0f3a065c038c633a95066d299?s=128&d=identicon&r=PG", "display_name": "Chris Stryczynski", "link": "https://stackoverflow.com/users/1663462/chris-stryczynski"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 59, "favorite_count": 0, "accepted_answer_id": 41809155, "answer_count": 1, "score": 0, "last_activity_date": 1485183117, "creation_date": 1485181218, "question_id": 41808501, "link": "https://stackoverflow.com/questions/41808501/html-doctype-rendered-with-snap-heist-template", "title": "HTML doctype rendered with Snap / Heist template", "body": "<p>I'm having issues with <a href=\"https://hackage.haskell.org/package/snap-1.0.0.1/docs/Snap-Snaplet-Heist-Interpreted.html#v:render\" rel=\"nofollow noreferrer\">https://hackage.haskell.org/package/snap-1.0.0.1/docs/Snap-Snaplet-Heist-Interpreted.html#v:render</a> when trying to render a template. The issue only occurs if I have the following as the contents of the template:</p>\n\n<pre><code>&lt;!DOCTYPE html&gt;\n&lt;/html&gt;\n</code></pre>\n\n<p>while the following content renders fine</p>\n\n<pre><code>&lt;html&gt;\n&lt;/html&gt;\n</code></pre>\n\n<p>So it seems to be something to do with the HTML doctype.</p>\n\n<p>The exception that occurs:</p>\n\n<pre><code>*** Exception: \nInitializer threw an exception...\n/home/chris/Projects/Haskell/pkgscrape/Snap/snaplets/heist/templates/compareForm.tpl \"/home/chris/Projects/Haskell/pkgscrape/Snap/snaplets/heist/templates/compareForm.tpl\" (line 21, column 2):\nunexpected \"/\"\nCallStack (from HasCallStack):\n  error, called at src/Snap/Snaplet/Heist/Internal.hs:74:35 in snap-1.0.0.1-6iNEjVc81Z8CCk3FAMxZ8z:Snap.Snaplet.Heist.Internal\n\n...but before it died it generated the following output:\nInitializing myapp @ /\nInitializing heist @ /heist\n\n\nCallStack (from HasCallStack):\n  error, called at src/Snap/Snaplet/Internal/Initializer.hs:597:13 in snap-1.0.0.1-6iNEjVc81Z8CCk3FAMxZ8z:Snap.Snaplet.Internal.Initializer\n</code></pre>\n"}, {"tags": ["haskell", "layout", "xmonad", "profanity"], "answers": [{"tags": [], "owner": {"reputation": 24266, "user_id": 946226, "user_type": "registered", "accept_rate": 59, "profile_image": "https://www.gravatar.com/avatar/5823d09208b1e4b63bbfcd189492032c?s=128&d=identicon&r=PG", "display_name": "Joachim Breitner", "link": "https://stackoverflow.com/users/946226/joachim-breitner"}, "is_accepted": true, "score": 4, "last_activity_date": 1487481351, "creation_date": 1487481351, "answer_id": 42323900, "question_id": 41806091, "link": "https://stackoverflow.com/questions/41806091/how-to-set-height-of-roster-in-xmonad-withim-layout/42323900#42323900", "title": "How to set height of roster in xmonad withIM layout", "body": "<p>Have you tried pulling the <code>avoidStruts</code> further out; something along these lines:</p>\n\n<pre><code>  verticalLayout = spacing sPx $ reflectHoriz $ Tall 1 0.03 0.5\n  verticalLayoutLargeScreen = spacing sPx $ ThreeCol 1 0.03 0.5\n  horizontalLayout = spacing sPx $ Mirror $ Tall 1 0.03 0.5\n  webdevLayout = spacing sPx $ Tall 1 0.03 0.63\n  fullscreenLayout = noBorders $ fullscreenFull $ Full\n\n  myLayout =\n      onWorkspace \"2:web\" (webdevLayout ||| fullscreenLayout) $\n      avoidStruts $\n      reflectHoriz $\n      withIM (3%7) (ClassName \"Profanity\") $\n          verticalLayoutLargeScreen |||\n          Grid |||\n          Full |||\n          verticalLayout |||\n          horizontalLayout |||\n          fullscreenLayout\n</code></pre>\n"}], "owner": {"reputation": 1940, "user_id": 5773806, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/438f0f7a7ca24486577712c68a9cb131?s=128&d=identicon&r=PG&f=1", "display_name": "GiftZwergrapper", "link": "https://stackoverflow.com/users/5773806/giftzwergrapper"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 150, "favorite_count": 0, "accepted_answer_id": 42323900, "answer_count": 1, "score": 3, "last_activity_date": 1586246082, "creation_date": 1485173526, "last_edit_date": 1586246082, "question_id": 41806091, "link": "https://stackoverflow.com/questions/41806091/how-to-set-height-of-roster-in-xmonad-withim-layout", "title": "How to set height of roster in xmonad withIM layout", "body": "<p>I am using the withIM layout in xmonad and I am using conky and dzen, which results in the roster overlaying the conky/dzen bar, while other windows are not overlapping. I am using <code>profanity</code> within <code>st</code> as IM.</p>\n\n<p>I searched a while for a solution to change the height, but I didn't find anything useful. My layout configuration looks like this:</p>\n\n<pre><code>  --\n  -- Layouts\n  --\n\n  sPx = 1\n\n  verticalLayout = spacing sPx $ avoidStruts $ reflectHoriz $ Tall 1 0.03 0.5\n  verticalLayoutLargeScreen = spacing sPx $ avoidStruts $ ThreeCol 1 0.03 0.5\n  horizontalLayout = spacing sPx $ avoidStruts $ Mirror $ Tall 1 0.03 0.5\n  webdevLayout = spacing sPx $ avoidStruts $ Tall 1 0.03 0.63\n  fullscreenLayout = noBorders $ fullscreenFull $ Full\n\n  myLayout =\n      onWorkspace \"2:web\" (webdevLayout ||| fullscreenLayout) $ reflectHoriz $\n                      (withIM (3%7) (ClassName \"Profanity\")\n                      (verticalLayoutLargeScreen ||| Grid ||| Full |||\n                      verticalLayout ||| horizontalLayout ||| fullscreenLayout))\n</code></pre>\n"}, {"tags": ["haskell", "scope", "hakyll"], "comments": [{"owner": {"reputation": 4630, "user_id": 160386, "user_type": "registered", "accept_rate": 85, "profile_image": "https://www.gravatar.com/avatar/b6044f355342bb055fbb03804d9673e3?s=128&d=identicon&r=PG", "display_name": "Jan Tojnar", "link": "https://stackoverflow.com/users/160386/jan-tojnar"}, "edited": false, "score": 0, "creation_date": 1485187790, "post_id": 41801461, "comment_id": 70809318, "body": "<code>(&lt;&gt;)</code> is from <a href=\"https://hackage.haskell.org/package/base-4.9.1.0/docs/Data-Monoid.html#v:-60--62-\" rel=\"nofollow noreferrer\"><code>Data.Monoid</code></a>."}, {"owner": {"reputation": 13379, "user_id": 1033027, "user_type": "registered", "accept_rate": 91, "profile_image": "https://www.gravatar.com/avatar/b56ea1c43a4ecb1060ec8bcb8d2bce78?s=128&d=identicon&r=PG", "display_name": "Jules", "link": "https://stackoverflow.com/users/1033027/jules"}, "reply_to_user": {"reputation": 4630, "user_id": 160386, "user_type": "registered", "accept_rate": 85, "profile_image": "https://www.gravatar.com/avatar/b6044f355342bb055fbb03804d9673e3?s=128&d=identicon&r=PG", "display_name": "Jan Tojnar", "link": "https://stackoverflow.com/users/160386/jan-tojnar"}, "edited": false, "score": 0, "creation_date": 1485208688, "post_id": 41801461, "comment_id": 70820998, "body": "@JanTojnar I looked it up on Hoogle, and it was available in both <code>template-haskell Language.Haskell.TH.PprLib</code> and <code>pretty Text.PrettyPrint.HughesPJ, pretty Text.PrettyPrint</code>."}, {"owner": {"reputation": 4630, "user_id": 160386, "user_type": "registered", "accept_rate": 85, "profile_image": "https://www.gravatar.com/avatar/b6044f355342bb055fbb03804d9673e3?s=128&d=identicon&r=PG", "display_name": "Jan Tojnar", "link": "https://stackoverflow.com/users/160386/jan-tojnar"}, "edited": false, "score": 0, "creation_date": 1485216303, "post_id": 41801461, "comment_id": 70823892, "body": "Most often, you will see <code>(&lt;&gt;)</code> used as <code>mappend</code>. For example, it can be used for joining <a href=\"https://hackage.haskell.org/package/text-1.2.2.1/docs/Data-Text.html#t:Text\" rel=\"nofollow noreferrer\"><code>Text</code></a> or, as in your example, for building <a href=\"https://hackage.haskell.org/package/hakyll-4.9.5.0/docs/Hakyll-Web-Template-Context.html#t:Context\" rel=\"nofollow noreferrer\"><code>Context</code></a>, both of which are <code>Monoid</code> instances."}, {"owner": {"reputation": 4630, "user_id": 160386, "user_type": "registered", "accept_rate": 85, "profile_image": "https://www.gravatar.com/avatar/b6044f355342bb055fbb03804d9673e3?s=128&d=identicon&r=PG", "display_name": "Jan Tojnar", "link": "https://stackoverflow.com/users/160386/jan-tojnar"}, "edited": false, "score": 0, "creation_date": 1485216723, "post_id": 41801461, "comment_id": 70824013, "body": "Actually, in modern Haskell, <code>(&lt;&gt;)</code> is an operation on <a href=\"https://hackage.haskell.org/package/base-4.9.1.0/docs/Data-Semigroup.html#t:Semigroup\" rel=\"nofollow noreferrer\"><code>Semigroup</code></a>"}, {"owner": {"reputation": 13379, "user_id": 1033027, "user_type": "registered", "accept_rate": 91, "profile_image": "https://www.gravatar.com/avatar/b56ea1c43a4ecb1060ec8bcb8d2bce78?s=128&d=identicon&r=PG", "display_name": "Jules", "link": "https://stackoverflow.com/users/1033027/jules"}, "reply_to_user": {"reputation": 4630, "user_id": 160386, "user_type": "registered", "accept_rate": 85, "profile_image": "https://www.gravatar.com/avatar/b6044f355342bb055fbb03804d9673e3?s=128&d=identicon&r=PG", "display_name": "Jan Tojnar", "link": "https://stackoverflow.com/users/160386/jan-tojnar"}, "edited": false, "score": 0, "creation_date": 1485217402, "post_id": 41801461, "comment_id": 70824194, "body": "Honest question: is this particularly relevant beyond semantics? The operators from <code>Language.Haskell</code> and <code>Text.PrettyPrint</code> both seem to do what I need them to do."}, {"owner": {"reputation": 4630, "user_id": 160386, "user_type": "registered", "accept_rate": 85, "profile_image": "https://www.gravatar.com/avatar/b6044f355342bb055fbb03804d9673e3?s=128&d=identicon&r=PG", "display_name": "Jan Tojnar", "link": "https://stackoverflow.com/users/160386/jan-tojnar"}, "edited": false, "score": 0, "creation_date": 1485225512, "post_id": 41801461, "comment_id": 70826296, "body": "They really should not work at all. They are defined to work on <code>Doc</code>: <code>(&lt;&gt;) :: Doc -&gt; Doc -&gt; Doc</code>"}], "answers": [{"tags": [], "owner": {"reputation": 2019, "user_id": 5800895, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/0cab3b0361b7e54267c70c02754f21de?s=128&d=identicon&r=PG&f=1", "display_name": "Derek Elkins left SE", "link": "https://stackoverflow.com/users/5800895/derek-elkins-left-se"}, "is_accepted": true, "score": 2, "last_activity_date": 1485162415, "creation_date": 1485162415, "answer_id": 41802523, "question_id": 41801461, "link": "https://stackoverflow.com/questions/41801461/how-can-i-include-post-teasers-in-my-installation/41802523#41802523", "title": "How can I include post teasers in my installation?", "body": "<p>The tutorial page isn't a complete example.  <code>item</code> isn't a reference to some function. It's just a placeholder name for an <a href=\"https://hackage.haskell.org/package/hakyll-4.9.4.0/docs/Hakyll-Core-Item.html#t:Item\" rel=\"nofollow noreferrer\"><code>Item</code></a>.  Usually you'll get it from <a href=\"https://hackage.haskell.org/package/hakyll-4.9.4.0/docs/Hakyll-Web-Pandoc.html#v:pandocCompiler\" rel=\"nofollow noreferrer\"><code>pandocCompiler</code></a> or one of the <a href=\"https://hackage.haskell.org/package/hakyll-4.9.4.0/docs/Hakyll-Core-Compiler.html\" rel=\"nofollow noreferrer\">many other \"compilers\"</a>.  In this example, <a href=\"https://hackage.haskell.org/package/hakyll-4.9.4.0/docs/Hakyll-Web-Template.html#v:loadAndApplyTemplate\" rel=\"nofollow noreferrer\"><code>loadAndApplyTemplate</code></a> is just like any other use of it. The only difference is that <code>$teaser$</code> will be bound to the teaser text in the template.</p>\n\n<p>That said, this isn't that great of an example since you usually want to use the teaser text on page listing multiple posts.  This will probably involve using <a href=\"https://hackage.haskell.org/package/hakyll-4.9.4.0/docs/Hakyll-Web-Template-Context.html#v:listField\" rel=\"nofollow noreferrer\"><code>listField</code></a> to make a collection of posts that you will iterate upon in the template.  For example, this is the rule for my index page:</p>\n\n<pre><code>match \"index.html\" $ do\n    route idRoute\n    compile $ do\n        posts &lt;- fmap (take indexRecentPostCount) . recentFirst =&lt;&lt; loadAllSnapshots postsPattern \"postContent\"\n        let indexCtx =\n                constField \"title\" \"Home\" &lt;&gt;\n                baseCtx\n\n        getResourceBody\n            &gt;&gt;= applyAsTemplate (listField \"posts\" (teaserField \"teaser\" \"postContent\" &lt;&gt; postCtx) (return posts) &lt;&gt; indexCtx)\n            &gt;&gt;= loadAndApplyDefaultTemplate indexCtx\n            &gt;&gt;= relativizeUrls\n</code></pre>\n\n<p>The \"item\" in this case is what <a href=\"https://hackage.haskell.org/package/hakyll-4.9.4.0/docs/Hakyll-Core-Compiler.html#v:getResourceBody\" rel=\"nofollow noreferrer\"><code>getResourceBody</code></a> returns, i.e. the body of <code>index.html</code>.  This binds <code>$posts$</code> to a list of posts.  Ignoring the metadata, my <code>index.html</code> is just:</p>\n\n<pre><code>$for(posts)$\n    $partial(\"templates/teaser.html\")$\n$endfor$\n</code></pre>\n\n<p><code>$teaser$</code> is then bound in the <code>template/teaser.html</code> template.</p>\n"}], "owner": {"reputation": 13379, "user_id": 1033027, "user_type": "registered", "accept_rate": 91, "profile_image": "https://www.gravatar.com/avatar/b56ea1c43a4ecb1060ec8bcb8d2bce78?s=128&d=identicon&r=PG", "display_name": "Jules", "link": "https://stackoverflow.com/users/1033027/jules"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 130, "favorite_count": 0, "accepted_answer_id": 41802523, "answer_count": 1, "score": 0, "last_activity_date": 1496559773, "creation_date": 1485157890, "last_edit_date": 1496559773, "question_id": 41801461, "link": "https://stackoverflow.com/questions/41801461/how-can-i-include-post-teasers-in-my-installation", "title": "How can I include post teasers in my installation?", "body": "<p>I'm following <a href=\"https://jaspervdj.be/hakyll/tutorials/using-teasers-in-hakyll.html#gluing-together\" rel=\"nofollow noreferrer\">the official instructions on the Hakyll site</a> to get post teasers up and running on my site. Unfortunately, I've hit a snag, and the instructions aren't much help.</p>\n\n<p>I'm getting an out-of-scope error for the <code>item</code> value referenced in this snippet:</p>\n\n<pre><code>loadAndApplyTemplate\n     \"template/postitem.html\"\n     (teaserField \"teaser\" \"content\" &lt;&gt; defaultContext)\n     item\n</code></pre>\n\n<p>When embedding it into my <code>site.hs</code>. On a side note for reproducibility's sake, it also wasn't made clear where the <code>&lt;&gt;</code> operator came from; this required the import of one of Literate Haskell's modules.</p>\n\n<p>It's completely unclear where this reference to <code>item</code> came from, and because it's a fairly common word, I have to sift through thousands of results even when using <code>find</code> and <code>grep</code> on my machine.</p>\n\n<p>What should I declare or import to gain access to <code>item</code> here?</p>\n"}, {"tags": ["haskell"], "comments": [{"owner": {"reputation": 13734, "user_id": 938694, "user_type": "registered", "accept_rate": 59, "profile_image": "https://www.gravatar.com/avatar/b6678a430a805dd78366d6e135b49f2d?s=128&d=identicon&r=PG", "display_name": "Cubic", "link": "https://stackoverflow.com/users/938694/cubic"}, "edited": false, "score": 1, "creation_date": 1485165030, "post_id": 41798769, "comment_id": 70794238, "body": "If you&#39;re worried about the LGPL license note that all you need to do to comply to that is A: Not ship your binaries (e.g. common case of running a webserver) or B: Just ship object code along with your binaries; All you need to do to comply with LGPL is to allow people to link against a different compatible version of the LGPL library."}], "answers": [{"comments": [{"owner": {"reputation": 62421, "user_id": 216164, "user_type": "registered", "accept_rate": 89, "profile_image": "https://www.gravatar.com/avatar/786f224adbe0784cdf7d0f15476061fe?s=128&d=identicon&r=PG", "display_name": "Thomas M. DuBuisson", "link": "https://stackoverflow.com/users/216164/thomas-m-dubuisson"}, "edited": false, "score": 2, "creation_date": 1485154499, "post_id": 41799768, "comment_id": 70789350, "body": "Yes, I&#39;ve done that before and it works fine... except for a few libraries that depend on <code>integer-gmp</code>.  Text was one of those up till I patched it (and then someone fixed my patch).  Sadly the set of packages doing this seems to be <a href=\"http://packdeps.haskellers.com/reverse/integer-gmp\" rel=\"nofollow noreferrer\">growing</a>."}, {"owner": {"reputation": 44013, "user_id": 1477667, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/trgKM.jpg?s=128&g=1", "display_name": "dfeuer", "link": "https://stackoverflow.com/users/1477667/dfeuer"}, "reply_to_user": {"reputation": 62421, "user_id": 216164, "user_type": "registered", "accept_rate": 89, "profile_image": "https://www.gravatar.com/avatar/786f224adbe0784cdf7d0f15476061fe?s=128&d=identicon&r=PG", "display_name": "Thomas M. DuBuisson", "link": "https://stackoverflow.com/users/216164/thomas-m-dubuisson"}, "edited": false, "score": 0, "creation_date": 1485162221, "post_id": 41799768, "comment_id": 70792538, "body": "@ThomasMDuBuisson, that list includes <code>bytestring</code>, which is pretty critical. If it really depends on <code>integer-gmp</code>, that&#39;ll block up an awful lot of other libraries."}, {"owner": {"reputation": 62421, "user_id": 216164, "user_type": "registered", "accept_rate": 89, "profile_image": "https://www.gravatar.com/avatar/786f224adbe0784cdf7d0f15476061fe?s=128&d=identicon&r=PG", "display_name": "Thomas M. DuBuisson", "link": "https://stackoverflow.com/users/216164/thomas-m-dubuisson"}, "edited": false, "score": 1, "creation_date": 1485185307, "post_id": 41799768, "comment_id": 70807630, "body": "It, and several others, have an integer-simple flag."}, {"owner": {"reputation": 5900, "user_id": 931154, "user_type": "registered", "accept_rate": 97, "profile_image": "https://i.stack.imgur.com/bTrZd.jpg?s=128&g=1", "display_name": "Gregory Nisbet", "link": "https://stackoverflow.com/users/931154/gregory-nisbet"}, "edited": false, "score": 0, "creation_date": 1485278323, "post_id": 41799768, "comment_id": 70855355, "body": "Perhaps a bit off-topic, but I thought ghc was migrating to shake. Is the shake-based build system going to honor the same environment variables?"}, {"owner": {"reputation": 44013, "user_id": 1477667, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/trgKM.jpg?s=128&g=1", "display_name": "dfeuer", "link": "https://stackoverflow.com/users/1477667/dfeuer"}, "reply_to_user": {"reputation": 5900, "user_id": 931154, "user_type": "registered", "accept_rate": 97, "profile_image": "https://i.stack.imgur.com/bTrZd.jpg?s=128&g=1", "display_name": "Gregory Nisbet", "link": "https://stackoverflow.com/users/931154/gregory-nisbet"}, "edited": false, "score": 1, "creation_date": 1485291900, "post_id": 41799768, "comment_id": 70863174, "body": "@GregoryNisbet, GHC is migrating to Shake (I think that&#39;s expected to happen in 8.4). I don&#39;t know how the configuration options will work, but I&#39;m confident you&#39;ll be able to set them one way or another! It may still be done with <code>configure</code>, for all I know."}], "tags": [], "owner": {"reputation": 44013, "user_id": 1477667, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/trgKM.jpg?s=128&g=1", "display_name": "dfeuer", "link": "https://stackoverflow.com/users/1477667/dfeuer"}, "is_accepted": true, "score": 3, "last_activity_date": 1485149381, "creation_date": 1485149381, "answer_id": 41799768, "question_id": 41798769, "link": "https://stackoverflow.com/questions/41798769/haskell-ghc-create-executable-not-depending-on-gmp/41799768#41799768", "title": "Haskell GHC create executable not depending on GMP?", "body": "<p>I'm not at all sure of this, but it seems likely that you can do it by telling GHC to use <code>integer-simple</code> instead of <code>integer-gmp</code> when you build GHC. Specifically, configure <code>INTEGER_LIBRARY=integer-simple</code>. See <code>mk/config.mk.in</code> in the GHC source tree.</p>\n"}], "owner": {"reputation": 5900, "user_id": 931154, "user_type": "registered", "accept_rate": 97, "profile_image": "https://i.stack.imgur.com/bTrZd.jpg?s=128&g=1", "display_name": "Gregory Nisbet", "link": "https://stackoverflow.com/users/931154/gregory-nisbet"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 322, "favorite_count": 2, "accepted_answer_id": 41799768, "answer_count": 1, "score": 3, "last_activity_date": 1485149381, "creation_date": 1485141234, "last_edit_date": 1485144343, "question_id": 41798769, "link": "https://stackoverflow.com/questions/41798769/haskell-ghc-create-executable-not-depending-on-gmp", "title": "Haskell GHC create executable not depending on GMP?", "body": "<p>I have a simple program that doesn't appear to use libgmp at all.</p>\n\n<pre><code>-- Sample.hs\nmain = putStrLn \"hi\"\n</code></pre>\n\n<p>If I compile it using the default options on Linux</p>\n\n<pre><code>$ ghc Sample.hs\n</code></pre>\n\n<p>This produces an executable called <code>Sample</code>. I wanted to see what libraries were required by a simple program that doesn't make use of arbitrary precision integers.</p>\n\n<pre><code>$ ldd Sample | sed -e 's/[(].*[)]/(0x000...)/'\n        linux-vdso.so.1 (0x000...)\n        libgmp.so.10 =&gt; /usr/lib64/libgmp.so.10 (0x000...)\n        libm.so.6 =&gt; /lib64/libm.so.6 (0x000...)\n        librt.so.1 =&gt; /lib64/librt.so.1 (0x000...)\n        libdl.so.2 =&gt; /lib64/libdl.so.2 (0x000...)\n        libc.so.6 =&gt; /lib64/libc.so.6 (0x000...)\n        /lib64/ld-linux-x86-64.so.2 (0x000...)\n        libpthread.so.0 =&gt; /lib64/libpthread.so.0 (0x000...)\n</code></pre>\n\n<p>Is there some flag I can pass to GHC to tell it not to produce an executable depending on the <code>libgmp.so</code> library. I don't want to statically link libgmp in, ideally I'd like to configure GHC not to emit code that depends on that library at all. I'm okay with some reduced functionality such as an error if I attempt to use an <code>Integer</code> or something like that.</p>\n"}, {"tags": ["haskell", "routes", "hakyll"], "answers": [{"comments": [{"owner": {"reputation": 2141, "user_id": 1664572, "user_type": "registered", "accept_rate": 85, "profile_image": "https://www.gravatar.com/avatar/c2bee27fdb72050b60a3c6aae64b474f?s=128&d=identicon&r=PG", "display_name": "wizzup", "link": "https://stackoverflow.com/users/1664572/wizzup"}, "edited": false, "score": 0, "creation_date": 1485148734, "post_id": 41798187, "comment_id": 70787454, "body": "If I have <code>stack exec site watch</code> running, do I still need to <code>build&#47;rebuild</code>, and do I need to restart <code>watch</code>?"}, {"owner": {"reputation": 4630, "user_id": 160386, "user_type": "registered", "accept_rate": 85, "profile_image": "https://www.gravatar.com/avatar/b6044f355342bb055fbb03804d9673e3?s=128&d=identicon&r=PG", "display_name": "Jan Tojnar", "link": "https://stackoverflow.com/users/160386/jan-tojnar"}, "reply_to_user": {"reputation": 2141, "user_id": 1664572, "user_type": "registered", "accept_rate": 85, "profile_image": "https://www.gravatar.com/avatar/c2bee27fdb72050b60a3c6aae64b474f?s=128&d=identicon&r=PG", "display_name": "wizzup", "link": "https://stackoverflow.com/users/1664572/wizzup"}, "edited": false, "score": 1, "creation_date": 1485187631, "post_id": 41798187, "comment_id": 70809197, "body": "I extended the answer."}], "tags": [], "owner": {"reputation": 4630, "user_id": 160386, "user_type": "registered", "accept_rate": 85, "profile_image": "https://www.gravatar.com/avatar/b6044f355342bb055fbb03804d9673e3?s=128&d=identicon&r=PG", "display_name": "Jan Tojnar", "link": "https://stackoverflow.com/users/160386/jan-tojnar"}, "is_accepted": true, "score": 4, "last_activity_date": 1485187608, "last_edit_date": 1485187608, "creation_date": 1485136084, "answer_id": 41798187, "question_id": 41798047, "link": "https://stackoverflow.com/questions/41798047/hakyll-not-updating-with-new-routes/41798187#41798187", "title": "Hakyll not updating with new routes", "body": "<p><code>stack exec site rebuild</code> rebuilds only the site data (the files generated inside the destination directory, <code>_site</code> by default). Whenever you change your site source, you will need to issue <code>stack build</code>.</p>\n\n<p>If you were running the <code>watch</code> server, restart it \u2013 <code>stack build</code> creates a new <code>site</code> executable, it will not restart old running instances.</p>\n\n<p>If you only added new rules, executing <code>site rebuild</code> after the <code>site</code> was built should not be needed, <code>site build</code> or <code>site watch</code> should notice that the files are missing in the \u2018cache\u2019. If you modified existing rules, however, you will need to let Hakyll know the files are no longer up to date. Cleaning the site using <code>site clean</code> or <code>site rebuild</code> will force the Hakyll to re-generate everything. When you have large site and only few files affected by the change, you can also re-save them or change their modification time (e.g. using <code>touch</code> command) to save time.</p>\n"}], "owner": {"reputation": 13379, "user_id": 1033027, "user_type": "registered", "accept_rate": 91, "profile_image": "https://www.gravatar.com/avatar/b56ea1c43a4ecb1060ec8bcb8d2bce78?s=128&d=identicon&r=PG", "display_name": "Jules", "link": "https://stackoverflow.com/users/1033027/jules"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 160, "favorite_count": 0, "accepted_answer_id": 41798187, "answer_count": 1, "score": 2, "last_activity_date": 1485187608, "creation_date": 1485134849, "question_id": 41798047, "link": "https://stackoverflow.com/questions/41798047/hakyll-not-updating-with-new-routes", "title": "Hakyll not updating with new routes", "body": "<p>I'm trying to use Hakyll for the first time. Following the tutorials on <a href=\"https://jaspervdj.be/hakyll/tutorials/03-rules-routes-compilers.html\" rel=\"nofollow noreferrer\">the official site</a>, I'm trying to extend the route handling images to work with fonts. I've changed the code in <code>site.hs</code> to this:</p>\n\n<pre><code>match (\"images/*\" .||. \"fonts/*\") $ do\n     route idRoute\n     compile copyFileCompiler\n</code></pre>\n\n<p>In the <code>fonts</code> directory, I've got a number of <code>.ttf</code> font files whose permissions and owners match the rest of the site's static files (all of which work properly).</p>\n\n<p>For some reason though, after rebuilding the site (with <code>stack exec site rebuild</code>), these updates aren't reflected in the binary, and routes to <code>fonts/*</code> result in a 404.</p>\n\n<p>How can I get Hakyll to load fonts?</p>\n"}, {"tags": ["haskell", "currying", "partial-application"], "comments": [{"owner": {"reputation": 2141, "user_id": 1664572, "user_type": "registered", "accept_rate": 85, "profile_image": "https://www.gravatar.com/avatar/c2bee27fdb72050b60a3c6aae64b474f?s=128&d=identicon&r=PG", "display_name": "wizzup", "link": "https://stackoverflow.com/users/1664572/wizzup"}, "edited": false, "score": 2, "creation_date": 1485149727, "post_id": 41797838, "comment_id": 70787763, "body": "You might want to know there is a haskell wiki <a href=\"https://wiki.haskell.org/Pointfree\" rel=\"nofollow noreferrer\">page</a> on this."}], "answers": [{"tags": [], "owner": {"reputation": 314794, "user_id": 67579, "user_type": "registered", "accept_rate": 81, "profile_image": "https://i.stack.imgur.com/BJXub.png?s=128&g=1", "display_name": "Willem Van Onsem", "link": "https://stackoverflow.com/users/67579/willem-van-onsem"}, "is_accepted": false, "score": 4, "last_activity_date": 1485133490, "last_edit_date": 1485133490, "creation_date": 1485133185, "answer_id": 41797853, "question_id": 41797838, "link": "https://stackoverflow.com/questions/41797838/how-to-with-partial-function-application-in-haskell/41797853#41797853", "title": "How To with Partial Function Application in Haskell", "body": "<p>Haskell has the \"<em>dot operator</em>\" or \"<em>function composition</em>\" <a href=\"http://hackage.haskell.org/packages/archive/base/latest/doc/html/Prelude.html#v:-46-\" rel=\"nofollow noreferrer\"><code>(.) :: (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c</code></a> for this:</p>\n\n<pre><code>ltest50 n = take 50 (iterate ltestonce n)\n</code></pre>\n\n<p>is equivalent to:</p>\n\n<pre><code>ltest50 = take 50 . iterate ltestonce\n</code></pre>\n\n<p><code>(.)</code> is defined as:</p>\n\n<pre><code>(.) :: (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c\n(.) f g x = f (g x)\n</code></pre>\n\n<p>or a bit shorter:</p>\n\n<pre><code>(.) :: (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c\n(.) f g x = f $ g x\n</code></pre>\n\n<p>Since it is a symbol placed between brackets, that means it can be used as <code>.</code> as an infix operator, so:</p>\n\n<pre><code>ltest50 = take 50 . iterate ltestonce\n</code></pre>\n\n<p>is \"<em>syntactical sugar</em>\" for:</p>\n\n<pre><code>ltest50 = (.) (take 50) (iterate ltestonce)\n</code></pre>\n\n<p>At least in Flanders (the Dutch part of Belgium) the operator is sometimes informally called \"after\" because you apply <code>f</code> after you have applied <code>g</code> on a variable.</p>\n"}], "owner": {"reputation": 111, "user_id": 4586632, "user_type": "registered", "accept_rate": 0, "profile_image": "https://www.gravatar.com/avatar/1ef8a257abcede4daee9fba747dad5cc?s=128&d=identicon&r=PG&f=1", "display_name": "brander", "link": "https://stackoverflow.com/users/4586632/brander"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 242, "favorite_count": 0, "answer_count": 1, "score": 2, "last_activity_date": 1529038099, "creation_date": 1485133043, "last_edit_date": 1529038099, "question_id": 41797838, "link": "https://stackoverflow.com/questions/41797838/how-to-with-partial-function-application-in-haskell", "title": "How To with Partial Function Application in Haskell", "body": "<p>I am trying to use partial application to shorten the following valid function definition:</p>\n\n<pre><code>ltest50 n = take 50 (iterate ltestonce n)\n</code></pre>\n\n<p>I thought something like:</p>\n\n<pre><code>ltest50 = take 50 (iterate ltestonce)\n</code></pre>\n\n<p>or</p>\n\n<pre><code>ltest50 = take 50 (iterate ltestonce$)\n</code></pre>\n\n<p>would do the trick, but no joy. What is the best way to do this in Haskell?</p>\n"}, {"tags": ["haskell", "monads", "monad-transformers"], "answers": [{"comments": [{"owner": {"reputation": 37219, "user_id": 1523776, "user_type": "moderator", "accept_rate": 87, "profile_image": "https://www.gravatar.com/avatar/b3e0b5c8e42a8c38009ef2d969f8dabb?s=128&d=identicon&r=PG", "display_name": "Benjamin Hodgson", "link": "https://stackoverflow.com/users/1523776/benjamin-hodgson"}, "edited": false, "score": 3, "creation_date": 1485169147, "post_id": 41803584, "comment_id": 70796992, "body": "This is an application of the co-Yoneda lemma."}, {"owner": {"reputation": 2226, "user_id": 2246434, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/bTuEI.jpg?s=128&g=1", "display_name": "Julia Path", "link": "https://stackoverflow.com/users/2246434/julia-path"}, "reply_to_user": {"reputation": 37219, "user_id": 1523776, "user_type": "moderator", "accept_rate": 87, "profile_image": "https://www.gravatar.com/avatar/b3e0b5c8e42a8c38009ef2d969f8dabb?s=128&d=identicon&r=PG", "display_name": "Benjamin Hodgson", "link": "https://stackoverflow.com/users/1523776/benjamin-hodgson"}, "edited": false, "score": 0, "creation_date": 1485173483, "post_id": 41803584, "comment_id": 70799657, "body": "@BenjaminHodgson Thank you, I wondered if it already existed and had a name."}], "tags": [], "owner": {"reputation": 2226, "user_id": 2246434, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/bTuEI.jpg?s=128&g=1", "display_name": "Julia Path", "link": "https://stackoverflow.com/users/2246434/julia-path"}, "is_accepted": false, "score": 0, "last_activity_date": 1485214457, "last_edit_date": 1495540433, "creation_date": 1485165711, "answer_id": 41803584, "question_id": 41797501, "link": "https://stackoverflow.com/questions/41797501/implementing-an-mfunctor-instance-for-rvart/41803584#41803584", "title": "Implementing an MFunctor instance for RVarT", "body": "<p>I found a trick that works for this and similar cases if you do not need to be able to actually use a value <code>RVarT m</code> without a monad instance for <code>m</code>. It works by deferring the application of the natural transformation until we actually need to get out a value. It would still be nice if there was a proper instance.</p>\n\n<pre><code>{-# LANGUAGE RankNTypes, ExistentialQuantification #-}\n\nimport Data.RVar\nimport Control.Monad.Trans.Class (lift)\nimport Control.Monad.Morph\nimport Control.Monad (ap)\n\nhoistRVarT :: Monad m =&gt; (forall t. n t -&gt; m t) -&gt; RVarT n a -&gt; RVarT m a\nhoistRVarT f = sampleRVarTWith (lift . f)\n\ndata RVarTFun m a = forall n. RVarTFun \n  { transformation :: forall t. n t -&gt; m t\n  , rvart :: RVarT n a }\n\n-- You can only get a value out if you have a monad for m.\ngetRVarTFun :: Monad m =&gt; RVarTFun m a -&gt; RVarT m a\ngetRVarTFun (RVarTFun t ma) = hoistRVarT t ma\n\nwrapRVarTFun :: RVarT m a -&gt; RVarTFun m a\nwrapRVarTFun = RVarTFun id\n\n-- Actually the result is slightly stronger than MFunctor because we don't need\n-- a Monad on n.\nhoistRVarTFun :: (forall t. n t -&gt; m t) -&gt; RVarTFun n a -&gt; RVarTFun m a\nhoistRVarTFun f (RVarTFun t nx) = RVarTFun (f . t) nx\n\ninstance MFunctor RVarTFun where\n  hoist = hoistRVarTFun\n</code></pre>\n\n<p>A more general implementation of this can be found <a href=\"https://stackoverflow.com/questions/21391770/why-does-mfunctors-hoist-not-have-monad-n-constraint/41816815#41816815\">here</a>.</p>\n"}, {"tags": [], "owner": {"reputation": 448, "user_id": 4416280, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/0c4e7c5ba681838526fb520fc8f36dec?s=128&d=identicon&r=PG&f=1", "display_name": "Zemyla", "link": "https://stackoverflow.com/users/4416280/zemyla"}, "is_accepted": true, "score": 1, "last_activity_date": 1488683893, "creation_date": 1488683893, "answer_id": 42604118, "question_id": 41797501, "link": "https://stackoverflow.com/questions/41797501/implementing-an-mfunctor-instance-for-rvart/42604118#42604118", "title": "Implementing an MFunctor instance for RVarT", "body": "<p><code>RVarT m a</code> is a <code>newtype</code> for <code>PromptT Prim m a</code>, where <code>PromptT</code> is defined in <a href=\"https://hackage.haskell.org/package/MonadPrompt-1.0.0.5/docs/Control-Monad-Prompt.html\" rel=\"nofollow noreferrer\"><code>Control.Monad.Prompt</code></a>. <code>PromptT Prim m a</code> is a <code>newtype</code> for <code>Prompt (Lift Prim m) a</code>. This, in turn, is a <code>newtype</code> for</p>\n\n<pre><code>forall b. (a -&gt; b) -&gt; (forall x. Lift Prim m x -&gt; (x -&gt; b) -&gt; b) -&gt; b\n</code></pre>\n\n<p>You can unwrap the whole thing with <code>unsafeCoerce</code>:</p>\n\n<pre><code>fromRVarT :: RVarT m a -&gt; (a -&gt; b) -&gt; (forall x. Lift Prim m x -&gt; (x -&gt; b) -&gt; b) -&gt; b\nfromRVarT = unsafeCoerce\n\ntoRVarT :: (forall b. (a -&gt; b) -&gt; (forall x. Lift Prim m x -&gt; (x -&gt; b) -&gt; b) -&gt; b) -&gt; RVarT m a\ntoRVarT = unsafeCoerce\n</code></pre>\n\n<p><code>Prim</code> isn't exported, but since you shouldn't need to touch it in the first place, and you're assembling and disassembling the whole thing with <code>unsafeCoerce</code>, you can just define:</p>\n\n<pre><code>data Prim a\n</code></pre>\n\n<p>You can write an <code>MFunctor</code> instance for <code>Lift</code>:</p>\n\n<pre><code>instance MFunctor (Lift f) where\n  hoist _ (Effect p) = Effect p\n  hoist phi (Lift m) = Lift (phi m)\n</code></pre>\n\n<p>And then you can unwrap the <code>RVarT</code>, hoist all the <code>Lift</code>s passed to its prompting function, and wrap it again:</p>\n\n<pre><code>instance MFunctor RVarT where\n  hoist phi rv = toRVarT $ \\done prm -&gt; fromRVarT rv done (\\l -&gt; prm $ hoist phi l)\n</code></pre>\n"}], "owner": {"reputation": 2226, "user_id": 2246434, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/bTuEI.jpg?s=128&g=1", "display_name": "Julia Path", "link": "https://stackoverflow.com/users/2246434/julia-path"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 86, "favorite_count": 1, "accepted_answer_id": 42604118, "answer_count": 2, "score": 4, "last_activity_date": 1488683893, "creation_date": 1485129396, "last_edit_date": 1485130277, "question_id": 41797501, "link": "https://stackoverflow.com/questions/41797501/implementing-an-mfunctor-instance-for-rvart", "title": "Implementing an MFunctor instance for RVarT", "body": "<p>Is it possible to implement an <a href=\"https://hackage.haskell.org/package/mmorph-1.0.9/docs/Control-Monad-Morph.html#t:MFunctor\" rel=\"nofollow noreferrer\"><code>MFunctor</code></a> instance for <a href=\"https://hackage.haskell.org/package/rvar-0.2.0.3/docs/Data-RVar.html#t:RVarT\" rel=\"nofollow noreferrer\"><code>RVarT</code></a>?</p>\n\n<p>So far I've come up with the following:</p>\n\n<pre><code>{-# LANGUAGE RankNTypes #-}\nimport Data.RVar                        -- from rvar\nimport Control.Monad.Trans.Class (lift) -- from transformers\n\nhoistRVarT :: Monad m =&gt; (forall t. n t -&gt; m t) -&gt; RVarT n a -&gt; RVarT m a\nhoistRVarT f rv = sampleRVarTWith (lift . f) rv\n</code></pre>\n\n<p>However this can not be used as a definition of <code>hoist</code> for <code>MFunctor</code>, due to the <code>Monad</code> constraint on <code>m</code> incurred by <code>lift</code>. The problem is, that I couldn't find another way to lift the the resulting monad into <code>RVarT</code> without <code>lift</code>. But I think conceptually it should be possible, since <code>RVarT</code> should be similar to <code>StateT</code> and there is an <code>MFunctor</code> instance for <code>StateT</code>. The problem is that I couldn't find anything in the API of <code>rvar</code> or <code>random-fu</code> which exposed such functionality.</p>\n"}, {"tags": ["haskell", "monads", "monad-transformers"], "comments": [{"owner": {"reputation": 24211, "user_id": 1364288, "user_type": "registered", "accept_rate": 88, "profile_image": "https://i.stack.imgur.com/JVtNl.png?s=128&g=1", "display_name": "danidiaz", "link": "https://stackoverflow.com/users/1364288/danidiaz"}, "edited": false, "score": 2, "creation_date": 1485122772, "post_id": 41796511, "comment_id": 70781568, "body": "When <code>StateT g (Either e) t</code> fails, it doesn&#39;t provide any state. What should the corresponding <code>ExceptT e (StateT g Identity) t</code> do?"}, {"owner": {"reputation": 100185, "user_id": 3234959, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/93bb12ca0f93dfddb33880316f7e66c2?s=128&d=identicon&r=PG&f=1", "display_name": "chi", "link": "https://stackoverflow.com/users/3234959/chi"}, "edited": false, "score": 0, "creation_date": 1485122966, "post_id": 41796511, "comment_id": 70781632, "body": "I can&#39;t recall the exact definitions, but can&#39;t the first monad fail depending on the state (e.g. if the state is an even number), when the second one can not?"}], "answers": [{"comments": [{"owner": {"reputation": 24211, "user_id": 1364288, "user_type": "registered", "accept_rate": 88, "profile_image": "https://i.stack.imgur.com/JVtNl.png?s=128&g=1", "display_name": "danidiaz", "link": "https://stackoverflow.com/users/1364288/danidiaz"}, "edited": false, "score": 1, "creation_date": 1485201356, "post_id": 41797344, "comment_id": 70817155, "body": "I think <code>stateTEitherToExceptTState</code> is not a valid monad morphism. If <code>m</code> is an action that doesn&#39;t fail, and <code>f</code> a Kleisli arrow that always fails, <code>morph (m &gt;&gt;= f)</code> is not equal to <code>morph m &gt;= morph . f</code>."}], "tags": [], "owner": {"reputation": 37219, "user_id": 1523776, "user_type": "moderator", "accept_rate": 87, "profile_image": "https://www.gravatar.com/avatar/b3e0b5c8e42a8c38009ef2d969f8dabb?s=128&d=identicon&r=PG", "display_name": "Benjamin Hodgson", "link": "https://stackoverflow.com/users/1523776/benjamin-hodgson"}, "is_accepted": true, "score": 11, "last_activity_date": 1485135154, "last_edit_date": 1495541396, "creation_date": 1485127830, "answer_id": 41797344, "question_id": 41796511, "link": "https://stackoverflow.com/questions/41796511/swap-inner-and-outer-monads/41797344#41797344", "title": "Swap inner and outer monads", "body": "<p><a href=\"https://stackoverflow.com/a/7042674/1523776\">You can't exchange an arbitrary pair of monads</a>. But you can exchange these two particular monads. It's easiest to understand if you expand the <code>newtype</code>s in the definitions of those monad transformers.</p>\n\n<p>Given</p>\n\n<pre><code>newtype StateT s m a = StateT { runStateT :: s -&gt; m (s, a) }\n</code></pre>\n\n<p>and</p>\n\n<pre><code>newtype ExceptT e m a = ExceptT { runExceptT :: m (Either e a) }\n</code></pre>\n\n<p>expanding the <code>newtype</code>s in your first type expression gives us the isomorphism</p>\n\n<pre><code>StateT s (Either e) a   &lt;-&gt;   s -&gt; Either e (s, a)\n</code></pre>\n\n<p>whereas for the second we get</p>\n\n<pre><code>ExceptT e (StateT s Identity) a   &lt;-&gt;   s -&gt; (s, Either e a)\n</code></pre>\n\n<p>Note that <code>Either e (s, a)</code> may or may not contain an <code>s</code>, whereas <code>(s, Either e a)</code> always does. Now, one can go from the latter to the former just by <code>traverse</code>ing the tuple inside the function, but going the other way requires some domain-specific reasoning: if the computation throws an error then we should plumb the state through unchanged to the catcher of the error. (Is this the right thing to do? I find it rather debatable.)</p>\n\n<pre><code>stateTEitherToExceptTState :: (s -&gt; Either e (s, a)) -&gt; (s -&gt; (s, Either e a))\nstateTEitherToExceptTState f s =\n    case f s of\n         Left e -&gt; (s, Left e)\n         Right sa -&gt; fmap Right sa\n</code></pre>\n"}], "owner": {"reputation": 19532, "user_id": 570689, "user_type": "registered", "accept_rate": 85, "profile_image": "https://www.gravatar.com/avatar/4eed5285039322bafbeee9102367b0a4?s=128&d=identicon&r=PG", "display_name": "\u0414\u041c\u0418\u0422\u0420\u0418\u0419 \u041c\u0410\u041b\u0418\u041a\u041e\u0412", "link": "https://stackoverflow.com/users/570689/%d0%94%d0%9c%d0%98%d0%a2%d0%a0%d0%98%d0%99-%d0%9c%d0%90%d0%9b%d0%98%d0%9a%d0%9e%d0%92"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 897, "favorite_count": 0, "accepted_answer_id": 41797344, "answer_count": 1, "score": 6, "last_activity_date": 1485135154, "creation_date": 1485121716, "question_id": 41796511, "link": "https://stackoverflow.com/questions/41796511/swap-inner-and-outer-monads", "title": "Swap inner and outer monads", "body": "<p>How to convert <code>StateT g (Either E) T</code> to <code>ExceptT E (StateT g Identity) T</code>?</p>\n\n<p>Probably, some mix of <code>traverse</code> and <code>hoist</code> could be useful here.</p>\n"}, {"tags": ["haskell"], "comments": [{"owner": {"reputation": 314794, "user_id": 67579, "user_type": "registered", "accept_rate": 81, "profile_image": "https://i.stack.imgur.com/BJXub.png?s=128&g=1", "display_name": "Willem Van Onsem", "link": "https://stackoverflow.com/users/67579/willem-van-onsem"}, "edited": false, "score": 2, "creation_date": 1485110009, "post_id": 41794633, "comment_id": 70777431, "body": "It is very unclear what you want, do you want to zip some strings? Please show us the full expected output."}, {"owner": {"reputation": 3148, "user_id": 4125633, "user_type": "registered", "accept_rate": 67, "profile_image": "https://www.gravatar.com/avatar/7f4383d9ff9fd3d3e3b35694bae38e99?s=128&d=identicon&r=PG&f=1", "display_name": "jublikon", "link": "https://stackoverflow.com/users/4125633/jublikon"}, "reply_to_user": {"reputation": 314794, "user_id": 67579, "user_type": "registered", "accept_rate": 81, "profile_image": "https://i.stack.imgur.com/BJXub.png?s=128&g=1", "display_name": "Willem Van Onsem", "link": "https://stackoverflow.com/users/67579/willem-van-onsem"}, "edited": false, "score": 0, "creation_date": 1485110136, "post_id": 41794633, "comment_id": 70777483, "body": "Every program can be run in call-by-value and in call-by-name strategy. I do not understand how to write down the steps the program runs for call-by-name strategy. I hope it is more clear what I mean."}, {"owner": {"reputation": 29444, "user_id": 3072788, "user_type": "registered", "accept_rate": 82, "profile_image": "https://www.gravatar.com/avatar/220a45c2fcff7e7358d144551b116205?s=128&d=identicon&r=PG&f=1", "display_name": "Alec", "link": "https://stackoverflow.com/users/3072788/alec"}, "edited": false, "score": 5, "creation_date": 1485110531, "post_id": 41794633, "comment_id": 70777616, "body": "This isn&#39;t really Haskell. I&#39;m not even sure it really belongs on Stackoverflow... Maybe cs.stackexchange?"}], "answers": [{"tags": [], "owner": {"reputation": 339851, "user_id": 149392, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/7a561ec0875fcbbe3066ea8fe288ec77?s=128&d=identicon&r=PG", "display_name": "sepp2k", "link": "https://stackoverflow.com/users/149392/sepp2k"}, "is_accepted": true, "score": 2, "last_activity_date": 1485179019, "creation_date": 1485179019, "answer_id": 41807822, "question_id": 41794633, "link": "https://stackoverflow.com/questions/41794633/find-outmost-evaluation-haskell/41807822#41807822", "title": "find outmost evaluation (Haskell)", "body": "<blockquote>\n  <p>How can I get outermost (call-by-name) stept by step evaluation? I do not understand how I can do that if repeat needs specified values to work and they are not given until the inner part is not evaluated.</p>\n</blockquote>\n\n<p>You don't need the values to expand the function call - you can just pass in the unevaluated expressions. And then you only evaluate those expressions when it's necessary for <code>if</code>s, pattern matches or primitive functions. That's how call-by-name evaluation works.</p>\n\n<p>So your first step would be to take the body of <code>repeat</code>, replace each occurrence of <code>x</code> with <code>second (doubleEach [2,3,5])</code> and each occurrence of <code>n</code> with <code>second [3, 1, 4]</code>. Then you'll need to evaluate the <code>if</code> condition and then you proceed with the body of the <code>if</code>.</p>\n"}], "owner": {"reputation": 3148, "user_id": 4125633, "user_type": "registered", "accept_rate": 67, "profile_image": "https://www.gravatar.com/avatar/7f4383d9ff9fd3d3e3b35694bae38e99?s=128&d=identicon&r=PG&f=1", "display_name": "jublikon", "link": "https://stackoverflow.com/users/4125633/jublikon"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 105, "favorite_count": 0, "accepted_answer_id": 41807822, "answer_count": 1, "score": 0, "last_activity_date": 1485179019, "creation_date": 1485109735, "last_edit_date": 1485110012, "question_id": 41794633, "link": "https://stackoverflow.com/questions/41794633/find-outmost-evaluation-haskell", "title": "find outmost evaluation (Haskell)", "body": "<p>I have some Haskell code and need to write down <strong>Leftmost-innermost</strong> (call by value) and <strong>outermost</strong> (call-by-name): </p>\n\n<pre><code>second :: [Int] -&gt; Int\nsecond []           = 0\nsecond (_:[])       = 0\nsecond (_:x:xs)     = x\n\ndoubleEach :: [Int] -&gt; [Int]\ndoubleEach []           = []\ndoubleEach (x:xs) = x * 2 : (doubleEach xs)\n\nrepeat :: Int -&gt; Int -&gt; [Int]\nrepeat x n = if n &gt; 0 then x : (repeat x (n-1)) else []\n\n\nrepeat ( second (doubleEach [2,3,5] )) ( second [3, 1, 4] )\n</code></pre>\n\n<p><strong>innermost</strong> (call-by-value): </p>\n\n<pre><code>1. repeat (second (doubleEach [2,3,5] )) (second [3,1,4])\n2. repeat (second 4 : doubleEach [3,5])) (1)\n3. repeat (second (4 : 6 : d [5])) (1)\n4. repeat (second ( 4 : 6 : 10 )) (1)\n5. repeat (6) (1)\n6. [6]\n</code></pre>\n\n<p><strong>Question</strong>: How can I get outermost (call-by-name) stept by step evaluation? I do not understand how I can do that if repeat needs specified values to work and they are not given until the inner part is not evaluated. </p>\n"}, {"tags": ["haskell"], "comments": [{"owner": {"reputation": 29444, "user_id": 3072788, "user_type": "registered", "accept_rate": 82, "profile_image": "https://www.gravatar.com/avatar/220a45c2fcff7e7358d144551b116205?s=128&d=identicon&r=PG&f=1", "display_name": "Alec", "link": "https://stackoverflow.com/users/3072788/alec"}, "edited": false, "score": 0, "creation_date": 1485104153, "post_id": 41793562, "comment_id": 70775455, "body": "This is all happening in GHCi, right? There is special behaviour you get in this context that has to do with GHCi being in the process of inferring. Add a type annotation and all will be well."}, {"owner": {"reputation": 29444, "user_id": 3072788, "user_type": "registered", "accept_rate": 82, "profile_image": "https://www.gravatar.com/avatar/220a45c2fcff7e7358d144551b116205?s=128&d=identicon&r=PG&f=1", "display_name": "Alec", "link": "https://stackoverflow.com/users/3072788/alec"}, "edited": false, "score": 1, "creation_date": 1485105056, "post_id": 41793562, "comment_id": 70775789, "body": "As a side note - this is a very good question, that is very hard to search for - please post back if you feel that the linked question isn&#39;t a duplicate!"}], "owner": {"reputation": 697, "user_id": 5821028, "user_type": "registered", "accept_rate": 46, "profile_image": "https://www.gravatar.com/avatar/f02b2f13bdf83954535307af466460a7?s=128&d=identicon&r=PG&f=1", "display_name": "eii0000", "link": "https://stackoverflow.com/users/5821028/eii0000"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 40, "favorite_count": 0, "closed_date": 1485104226, "answer_count": 0, "score": 2, "last_activity_date": 1485103735, "creation_date": 1485103735, "question_id": 41793562, "link": "https://stackoverflow.com/questions/41793562/ioref-couldnt-match", "closed_reason": "Duplicate", "title": "IORef couldn&#39;t match", "body": "<p>While writing a doubly linked list code using IORef, I hit the following problem. \nFirst I created a mutable Queue data type with links to queue front and back</p>\n\n<pre><code>data Tree a = T { prev::IORef (Tree a), next::IORef (Tree a), val::a } | Empty\ndata Queue a = Q { front::IORef (Tree a), back::IORef (Tree a) }\ne &lt;- newIORef Empty\nq = Q e e\n</code></pre>\n\n<p>Then I tried pushing an Int value but I can't.</p>\n\n<pre><code>t = T e e (1::Int)\n</code></pre>\n\n<p>This returns</p>\n\n<pre><code>\u03bb: :t T e e (1::Int)\n\n&lt;interactive&gt;:1:3: error:\n    \u2022 Couldn't match type \u2018GHC.Prim.Any\u2019 with \u2018Int\u2019\n      Expected type: IORef (Tree Int)\n        Actual type: IORef (Tree GHC.Prim.Any)\n    \u2022 In the first argument of \u2018T\u2019, namely \u2018e\u2019\n      In the expression: T e e (1 :: Int)\n\u03bb: \n</code></pre>\n\n<p>It looks like Empty has a type \"GHC.Prim.Any... which does not match other conventional types.  Is there any way to create Empty type that matches anything else?</p>\n"}, {"tags": ["haskell", "polymorphism", "monomorphism", "haxl"], "answers": [{"comments": [{"owner": {"reputation": 37219, "user_id": 1523776, "user_type": "moderator", "accept_rate": 87, "profile_image": "https://www.gravatar.com/avatar/b3e0b5c8e42a8c38009ef2d969f8dabb?s=128&d=identicon&r=PG", "display_name": "Benjamin Hodgson", "link": "https://stackoverflow.com/users/1523776/benjamin-hodgson"}, "reply_to_user": {"reputation": 2691, "user_id": 5477287, "user_type": "registered", "accept_rate": 87, "profile_image": "https://i.stack.imgur.com/yKMgF.jpg?s=128&g=1", "display_name": "Babra Cunningham", "link": "https://stackoverflow.com/users/5477287/babra-cunningham"}, "edited": false, "score": 0, "creation_date": 1485169582, "post_id": 41795005, "comment_id": 70797255, "body": "@BabraCunningham No: you wrote down version which attempted to match a parameter inside the <code>MakeRequest</code> constructor (you had <code>(BlockedFetch&#39; (MakeRequest int) returnVal)</code>. <code>MakeRequest</code> is a nullary constructor."}, {"owner": {"reputation": 2691, "user_id": 5477287, "user_type": "registered", "accept_rate": 87, "profile_image": "https://i.stack.imgur.com/yKMgF.jpg?s=128&g=1", "display_name": "Babra Cunningham", "link": "https://stackoverflow.com/users/5477287/babra-cunningham"}, "edited": false, "score": 0, "creation_date": 1485170423, "post_id": 41795005, "comment_id": 70797786, "body": "I see! I&#39;ve changed implementation to <code>implementation sem (BlockedFetch (MakeRequest) returnVal) =</code>... was this what you meant by &quot;match on the MakeRequest&quot; ?"}], "tags": [], "owner": {"reputation": 37219, "user_id": 1523776, "user_type": "moderator", "accept_rate": 87, "profile_image": "https://www.gravatar.com/avatar/b3e0b5c8e42a8c38009ef2d969f8dabb?s=128&d=identicon&r=PG", "display_name": "Benjamin Hodgson", "link": "https://stackoverflow.com/users/1523776/benjamin-hodgson"}, "is_accepted": true, "score": 3, "last_activity_date": 1485169500, "last_edit_date": 1485169500, "creation_date": 1485111945, "answer_id": 41795005, "question_id": 41793449, "link": "https://stackoverflow.com/questions/41793449/using-monomorphic-functions-with-polymorphic-haxl-library/41795005#41795005", "title": "Using monomorphic functions with polymorphic Haxl library?", "body": "<p><a href=\"https://hackage.haskell.org/package/haxl-0.5.0.0/docs/src/Haxl-Core-Types.html#BlockedFetch\" rel=\"nofollow noreferrer\">The <code>BlockedFetch</code> constructor</a> existentially quantifies <code>a</code>:</p>\n\n<pre><code>data BlockedFetch r = forall a. BlockedFetch (r a) (ResultVar a)\n</code></pre>\n\n<p>This means that whoever creates a <code>BlockedFetch</code> gets to choose what <code>a</code> is, but upon unpacking a <code>BlockedFetch</code> <code>a</code> is kept abstract and won't unify with anything else.</p>\n\n<p>However, you do get access to the <code>r</code> type. By choosing <code>r</code> to be a GADT you can constrain <code>a</code> to be (one of a set of) particular type(s), and recover that information by matching on the constructor(s) of your GADT. You don't have to rewrite any Haxl code - it was designed to allow you to plug in your own <code>r</code>!</p>\n\n<p>In this instance, I see that you've already got 90% of the way there:</p>\n\n<pre><code>data HttpRequest a where\n    MakeRequest :: HttpRequest Int\n</code></pre>\n\n<p>So when you match on the <code>MakeRequest</code> constructor you gain the knowledge that <code>a ~ Int</code>.</p>\n\n<pre><code>implementation :: QSem -&gt; BlockedFetch' HTTPRequest -&gt; IO(Async())\n                               -- match the MakeRequest constructor\nimplementation sem (BlockedFetch' MakeRequest returnVal) =\n    -- as before\n</code></pre>\n"}], "owner": {"reputation": 2691, "user_id": 5477287, "user_type": "registered", "accept_rate": 87, "profile_image": "https://i.stack.imgur.com/yKMgF.jpg?s=128&g=1", "display_name": "Babra Cunningham", "link": "https://stackoverflow.com/users/5477287/babra-cunningham"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 75, "favorite_count": 1, "accepted_answer_id": 41795005, "answer_count": 1, "score": 1, "last_activity_date": 1485169500, "creation_date": 1485103102, "last_edit_date": 1485112204, "question_id": 41793449, "link": "https://stackoverflow.com/questions/41793449/using-monomorphic-functions-with-polymorphic-haxl-library", "title": "Using monomorphic functions with polymorphic Haxl library?", "body": "<p>I'm using the Haxl library and I'm trying to implement <code>fetchHTML</code> concurrently:</p>\n\n<pre><code>import Data.Aeson\nimport Control.Concurrent.Async\nimport Control.Concurrent.QSem\nimport Haxl.Core\nimport Haxl.Prelude\n\ninstance DataSource' u HTTPRequest where \n  fetch = metaImplementation\n\ndata HTTPRequest a where\n  MakeRequest :: HTTPRequest Int\n\ninstance StateKey HTTPRequest where --Link HTTPRequest to State class\n   data State HTTPRequest =\n    HTTPRequestState {threadNum :: Int}\n\ninitialiseState :: Int -&gt; IO (State HTTPRequest)\ninitialiseState threads = do\n   return HTTPRequestState {threadNum = threads}\n\nmetaImplementation :: State HTTPRequest -&gt; Flags -&gt; u -&gt; [BlockedFetch' HTTPRequest] -&gt; PerformFetch \nmetaImplementation HTTPRequestState{..} _flags user bfs =\nAsyncFetch $ \\inner -&gt; do\n    sem &lt;- newQSem threadNum\n    asyncs &lt;- mapM (implementation sem) bfs\n    inner\n    mapM_ wait asyncs\n\nimplementation :: QSem -&gt; BlockedFetch' HTTPRequest -&gt; IO(Async())\nimplementation sem (BlockedFetch' request returnVal) = \n   async $ bracket_ (waitQSem sem) (signalQSem sem) $ do\n      e &lt;- Control.Exception.try $ \n         fetchHTML\n      case e of \n        Left ex -&gt; putFailure returnVal (ex :: SomeException)\n        Right el -&gt; putSuccess returnVal el\n\n\nfetchHTML :: IO Int\nfetchHTML = do\n    res &lt;- get \"https://example.com\"\n    let resBody = res ^. responseBody \n    return (200)\n\nmakeHTTPRequest :: GenHaxl u Int --Perform concurrent fetches\nmakeHTTPRequest = dataFetch (MakeRequest)\n</code></pre>\n\n<p>The problem I'm facing is that Haxl's <code>BlockedFetch</code> is polymorphic: </p>\n\n<pre><code>BlockedFetch :: forall (r :: * -&gt; *) a.  r a -&gt; ResultVar a -&gt; BlockedFetch r\n</code></pre>\n\n<p>Yet I wish <code>fetchHTML</code> to be monomorphic (only return an Int):</p>\n\n<pre><code>fetchHTML :: IO Int \nfetchHTML = do\n   res &lt;- get \"https://www.bbc.com\"\n   let resBody = res ^. responseBody \n   return (200)\n</code></pre>\n\n<p>So I get the following error when I attempt to compile:</p>\n\n<pre><code>  Couldn't match expected type \u2018a\u2019 with actual type \u2018Int\u2019\n    \u2018a\u2019 is a rigid type variable bound by\n    a pattern with constructor:\n      BlockedFetch :: forall (r :: * -&gt; *) a.\n                      r a -&gt; ResultVar a -&gt; BlockedFetch r,\n    in an equation for \u2018implementation\u2019\n</code></pre>\n\n<p>Initially I thought I could re-define <code>BlockedFetch</code> as so:</p>\n\n<pre><code>data BlockedFetch' a where --Custom monomorphic implementation of BlockedFetch \n   BlockedFetch' :: HTTPRequest Int -&gt; ResultVar Int -&gt; BlockedFetch' HTTPRequest\n</code></pre>\n\n<p>However, then that requires a new implementation of <code>DataSource</code>, to enable it to receive my custom <code>BlockFetch'</code>:</p>\n\n<pre><code>class (DataSourceName r, StateKey r) =&gt; DataSource' u r where \n   fetch :: State r -&gt; Flags -&gt; u -&gt; [BlockedFetch' r] -&gt; PerformFetch\n</code></pre>\n\n<p><strong>Clearly, this will just affect backwards and require me to re-write the entire Haxl module!</strong></p>\n\n<p>My questions are:</p>\n\n<p>1) Is there a simple way to make <code>fetchHTML</code> polymorphic? (I'm not too concerned about what it returns, just it returns <em>something</em> when it's finished)</p>\n\n<p>2) What is the general approach by Haskell programmers when faced with this sort of problem?</p>\n"}, {"tags": ["haskell", "generics", "enums"], "answers": [{"tags": [], "owner": {"reputation": 29444, "user_id": 3072788, "user_type": "registered", "accept_rate": 82, "profile_image": "https://www.gravatar.com/avatar/220a45c2fcff7e7358d144551b116205?s=128&d=identicon&r=PG&f=1", "display_name": "Alec", "link": "https://stackoverflow.com/users/3072788/alec"}, "is_accepted": true, "score": 4, "last_activity_date": 1485107594, "creation_date": 1485107594, "answer_id": 41794251, "question_id": 41793202, "link": "https://stackoverflow.com/questions/41793202/is-it-possible-to-re-implement-enum-deriving-using-ghc-generics/41794251#41794251", "title": "Is it possible to re-implement `Enum` deriving using GHC generics", "body": "<p>GHC derives <code>Generic</code> such that the L and R variants form a tree where the leaves are in <code>Enum</code> order. Consider the following example (with trimmed output):</p>\n\n<pre><code>ghci&gt; data D = A | B | C | D | E deriving (Generic)\nghci&gt; from A\nL1 (L1 U1)\nghci&gt; from B\nL1 (R1 U1)\nghci&gt; from C\nR1 (L1 U1)\nghci&gt; from D\nR1 (R1 (L1 U1))\nghci&gt; from E\nR1 (R1 (R1 U1)))\n</code></pre>\n\n<p>Notice that if you arranged these as a tree, <code>toEnum `map` [1..]</code> is going to be the left to right traversal of the leaves. With that intuition, we'll start by defining a <code>GLeaves</code> class which counts the number of leaves that a generic type (not a value!) has in its tree.</p>\n\n<pre><code>{-# LANGUAGE ScopedTypeVariables, PolyKinds, TypeApplications, TypeOperators,\n             DefaultSignatures, FlexibleContexts, TypeFamilies #-}\n\nimport GHC.Generics\nimport Data.Proxy\n\nclass GLeaves f where\n  -- | Counts the number of \"leaves\" (i.e. U1's) in the type `f`\n  gSize :: Proxy f -&gt; Int\n\ninstance GLeaves U1 where\n  gSize _ = 1\n\ninstance GLeaves x =&gt; GLeaves (M1 i t x) where\n  gSize _ = gSize (Proxy :: Proxy x)\n\ninstance (GLeaves x, GLeaves y) =&gt; GLeaves (x :+: y) where\n  gSize _ = gSize (Proxy :: Proxy x) + gSize (Proxy :: Proxy y)\n</code></pre>\n\n<p>Now, we are in shape to define <code>GEnum</code>. As is usual with this setup, we define our class <code>Enum'</code> and have default signatures that rely on <code>GEnum</code>.</p>\n\n<pre><code>class Enum' a where\n  toEnum' :: Int -&gt; a\n  fromEnum' :: a -&gt; Int\n\n  default toEnum' :: (Generic a, GEnum (Rep a)) =&gt; Int -&gt; a\n  toEnum' = to . gToEnum\n\n  default fromEnum' :: (Generic a, GEnum (Rep a)) =&gt; a -&gt; Int\n  fromEnum' = gFromEnum . from\n\nclass GEnum f where\n  gFromEnum :: f p -&gt; Int\n  gToEnum :: Int -&gt; f p\n</code></pre>\n\n<p>Finally, we get to the good stuff. For <code>U1</code> and <code>M1</code>, <code>gFromEnum</code> and <code>gToEnum</code> are both straightforward. For <code>:+:</code>, <code>gFromEnum</code> needs to find all of the leaves to the left of it, so if it is the right subtree we add the size of the left subtree (and if it is the left subtree we add nothing). Similarly, <code>gToEnum</code>, checks whether it belong in the left or right subtree by checking if it is smaller than the number of leaves in the left subtree.</p>\n\n<pre><code>instance GEnum U1 where\n  gFromEnum U1 = 0\n\n  gToEnum n = if n == 0 then U1 else error \"Outside enumeration range\"\n\ninstance GEnum f =&gt; GEnum (M1 i t f) where\n  gFromEnum (M1 x) = gFromEnum x\n\n  gToEnum n = M1 (gToEnum n)\n\ninstance (GLeaves x, GEnum x, GEnum y) =&gt; GEnum (x :+: y) where\n  gFromEnum (L1 x) = gFromEnum x\n  gFromEnum (R1 y) = gSize (Proxy :: Proxy x) + gFromEnum y\n\n  gToEnum n = let s = gSize (Proxy :: Proxy x)\n              in if n &lt; s then L1 (gToEnum n) else R1 (gToEnum (n - s))\n</code></pre>\n\n<p>Finally, you can test this in GHCi:</p>\n\n<pre><code>ghci&gt; :set -XDeriveAnyClass -XDeriveGeneric\nghci&gt; data D = A | B | C | D | E deriving (Show, Generic, Enum, Enum')\nghci&gt; toEnum `map` [0 .. 4] :: [D]\n[A,B,C,D,E]\nghci&gt; toEnum' `map` [0 .. 4] :: [D]\n[A,B,C,D,E]\nghci&gt; fromEnum `map` [A .. E] :: [Int]\n[A,B,C,D,E]\nghci&gt; fromEnum' `map` [A .. E] :: [Int]\n[A,B,C,D,E]\n</code></pre>\n\n<h3>Performance</h3>\n\n<p>You may be thinking to yourself: this is super inefficient! We end up recalculating a bunch of sizes over and over - the worst case performance is at least <code>O(n^2)</code>. The catch is that (hopefully), GHC will be able to optimize/inline the hell out of our specific <code>Enum'</code> instances until there is <em>nothing left of the initial <code>Generic</code> structure</em>.</p>\n"}, {"tags": [], "owner": {"reputation": 19084, "user_id": 1482749, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/7ff9982206dde8c2bbb151a7305c00f3?s=128&d=identicon&r=PG", "display_name": "kosmikus", "link": "https://stackoverflow.com/users/1482749/kosmikus"}, "is_accepted": false, "score": 2, "last_activity_date": 1485242334, "creation_date": 1485242334, "answer_id": 41822243, "question_id": 41793202, "link": "https://stackoverflow.com/questions/41793202/is-it-possible-to-re-implement-enum-deriving-using-ghc-generics/41822243#41822243", "title": "Is it possible to re-implement `Enum` deriving using GHC generics", "body": "<p>Enum is one of many examples that are slightly awkward to write using the standard GHC Generics representation, because a lot of the structure of datatypes is left implicit (e.g. how sum and product constructors are nested, and where metadata occurs).</p>\n\n<p>With <a href=\"https://hackage.haskell.org/package/generics-sop\" rel=\"nofollow noreferrer\">generics-sop</a>, you can (re-)define generic Enum instances in a slightly more straight-forward way:</p>\n\n<pre><code>{-# LANGUAGE ConstraintKinds, DataKinds, DeriveGeneric #-}\n{-# LANGUAGE FlexibleContexts, GADTs, PolyKinds #-}\n{-# LANGUAGE TypeApplications, TypeOperators #-}\n\nimport Generics.SOP\nimport qualified GHC.Generics as GHC\n</code></pre>\n\n<p>We define a type synonym that captures what it means to be an enumeration type:</p>\n\n<pre><code>type IsEnumType a = All ((~) '[]) (Code a)\n</code></pre>\n\n<p>(Unfortunately, the <code>(~) '[]</code> construction triggers a bug in GHC 8.0.1, but it works fine in GHC 8.0.2.) In generics-sop, the <em>code</em> of a datatype is a type-level list of lists. The outer list contains an element for each constructor, the inner lists contain the types of the constructor arguments. The <code>IsEnumType</code> constraint says that all of the inner lists have to be empty, which means that none of the constructors must have any arguments.</p>\n\n<pre><code>gfromEnum :: (Generic a, IsEnumType a) =&gt; a -&gt; Int\ngfromEnum = conIndex . unSOP . from\n  where\n    conIndex :: NS f xs -&gt; Int\n    conIndex (Z _) = 0\n    conIndex (S i) = 1 + conIndex i\n</code></pre>\n\n<p>The function <code>from</code> turns a value into a sum-of-products representation, and <code>unSOP</code> strips the outer constructor. We then have a sum structure to traverse. The <code>NS</code> datatype representing n-ary sums has constructors <code>Z</code> and <code>S</code> that indicate exactly which constructor is being used, so we can simply traverse and count.</p>\n\n<pre><code>gtoEnum :: (Generic a, IsEnumType a) =&gt; Int -&gt; a\ngtoEnum i =\n  to (SOP (apInjs_NP (hcpure (Proxy @ ((~) '[])) Nil) !! i))\n</code></pre>\n\n<p>Here, the <code>apInjs_NP (hcpure ...)</code> call produces the representations of\nempty constructor applications for all constructors of the datatype. Unlike the <code>gfromEnum</code> function, this actually makes use of the <code>IsEnumType</code> constraint to be type correct (because we rely on the fact that none of the constructors take any arguments). We then selected the <code>i</code>-th constructor out of the list and turn it back from the generic representation to the actual type by applying first <code>SOP</code> and then <code>to</code>.</p>\n\n<p>To apply it to your sample type, you have to instantiate it to both GHC's and generic-sop's <code>Generic</code> classes (or you can use TH for this, too):</p>\n\n<pre><code>data Foo = Foo | Bar | Baz | Quux\n  deriving (Show, Eq, GHC.Generic)\n\ninstance Generic Foo\n</code></pre>\n\n<p>Then you can test it:</p>\n\n<pre><code>GHCi&gt; gfromEnum Baz\n2\nGHCi&gt; gtoEnum 2 :: Foo\nBaz\n</code></pre>\n\n<p>If you want, you can make <code>gfromEnum</code> and <code>gtoEnum</code> the default definitions for an Enum-like class, just as with GHC Generics.</p>\n"}], "owner": {"reputation": 7134, "user_id": 3687048, "user_type": "registered", "accept_rate": 96, "profile_image": "https://i.stack.imgur.com/i0GDr.jpg?s=128&g=1", "display_name": "Mark Karpov", "link": "https://stackoverflow.com/users/3687048/mark-karpov"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 172, "favorite_count": 0, "accepted_answer_id": 41794251, "answer_count": 2, "score": 5, "last_activity_date": 1485242334, "creation_date": 1485101622, "question_id": 41793202, "link": "https://stackoverflow.com/questions/41793202/is-it-possible-to-re-implement-enum-deriving-using-ghc-generics", "title": "Is it possible to re-implement `Enum` deriving using GHC generics", "body": "<p>Is it possible to re-implement deriving of <code>Enum</code> type class using GHC\ngenerics?</p>\n\n<p>At first, it looks easy:</p>\n\n\n\n<pre class=\"lang-hs prettyprint-override\"><code>data Foo -- representation without metadata (wrong):\n  = Foo  -- L1 U1\n  | Bar  -- R1 (L1 U1)\n  | Baz  -- R1 (R1 (L1 U1))\n  | Quux -- R1 (R1 (R1 U1))\n  deriving (Show, Eq, Generic)\n\n-- Rep Foo p = (U1 :+: (U1 :+: (U1 :+: U1))) p\n\ninstance Enum Foo where\n  toEnum   = undefined -- FIXME\n  fromEnum = gfromEnum . from\n\nclass GEnum f where\n  gfromEnum :: f p -&gt; Int\n\ninstance GEnum U1 where\n  gfromEnum U1 = 0\n\ninstance GEnum f =&gt; GEnum (M1 i t f) where\n  gfromEnum (M1 x) = gfromEnum x\n\ninstance (GEnum x, GEnum y) =&gt; GEnum (x :+: y) where\n  gfromEnum (L1 x) = gfromEnum x\n  gfromEnum (R1 y) = 1 + gfromEnum y\n</code></pre>\n\n<p>However, this is not going to work:</p>\n\n<pre class=\"lang-hs prettyprint-override\"><code>\u03bb&gt; fromEnum Foo\n0\n\u03bb&gt; fromEnum Bar\n1\n\u03bb&gt; fromEnum Baz\n1\n\u03bb&gt; fromEnum Quux\n2\n</code></pre>\n\n<p>This is because we can't rely on how arguments of <code>(:+:)</code> are grouped. In\nthis case it seems they are nested like this:</p>\n\n<pre class=\"lang-hs prettyprint-override\"><code>((U1 :+: U1) :+: (U1 :+: U1)) p\n</code></pre>\n\n<p>So, is it possible to derive <code>Enum</code> using <code>Generics</code>? If yes, how?</p>\n"}, {"tags": ["haskell", "haskell-snap-framework"], "answers": [{"comments": [{"owner": {"reputation": 777, "user_id": 5303318, "user_type": "registered", "accept_rate": 62, "profile_image": "https://lh6.googleusercontent.com/-qykohYXsIz0/AAAAAAAAAAI/AAAAAAAAADc/G9CJWc1s3dM/photo.jpg?sz=128", "display_name": "milad zahedi", "link": "https://stackoverflow.com/users/5303318/milad-zahedi"}, "edited": false, "score": 0, "creation_date": 1485844290, "post_id": 41945433, "comment_id": 71081606, "body": "I should have asked, what are the benefits of warpping a library in a snaplet ? now I know that snap provides ways to read config data and stuff like that."}, {"owner": {"reputation": 7154, "user_id": 527460, "user_type": "registered", "accept_rate": 88, "profile_image": "https://www.gravatar.com/avatar/0cece5abd2f9ad9056f5ac3830ac0bfe?s=128&d=identicon&r=PG", "display_name": "mightybyte", "link": "https://stackoverflow.com/users/527460/mightybyte"}, "reply_to_user": {"reputation": 777, "user_id": 5303318, "user_type": "registered", "accept_rate": 62, "profile_image": "https://lh6.googleusercontent.com/-qykohYXsIz0/AAAAAAAAAAI/AAAAAAAAADc/G9CJWc1s3dM/photo.jpg?sz=128", "display_name": "milad zahedi", "link": "https://stackoverflow.com/users/5303318/milad-zahedi"}, "edited": false, "score": 0, "creation_date": 1485905702, "post_id": 41945433, "comment_id": 71117400, "body": "The benefits of wrapping in a snaplet are pretty much what is described in the <a href=\"http://snapframework.com/docs/tutorials/snaplets-tutorial\" rel=\"nofollow noreferrer\">snaplet tutorial</a>, which is basically: automatic installation of filesystem resources, config file management, and automatically defining routes."}], "tags": [], "owner": {"reputation": 7154, "user_id": 527460, "user_type": "registered", "accept_rate": 88, "profile_image": "https://www.gravatar.com/avatar/0cece5abd2f9ad9056f5ac3830ac0bfe?s=128&d=identicon&r=PG", "display_name": "mightybyte", "link": "https://stackoverflow.com/users/527460/mightybyte"}, "is_accepted": true, "score": 1, "last_activity_date": 1485810477, "creation_date": 1485810477, "answer_id": 41945433, "question_id": 41792917, "link": "https://stackoverflow.com/questions/41792917/snap-snaplets-benefits-of-warpping-a-db-package-in-a-snaplet/41945433#41945433", "title": "snap snaplets : benefits of warpping a DB package in a snaplet", "body": "<p>The advantage is kind of the same as with using any other library--roughly that you won't have to write the code that the package author put in the package.  I haven't looked at the mongodb snaplets in years, but this will probably be some code to read config data from the config file, set up the DB connections, etc.</p>\n"}], "owner": {"reputation": 777, "user_id": 5303318, "user_type": "registered", "accept_rate": 62, "profile_image": "https://lh6.googleusercontent.com/-qykohYXsIz0/AAAAAAAAAAI/AAAAAAAAADc/G9CJWc1s3dM/photo.jpg?sz=128", "display_name": "milad zahedi", "link": "https://stackoverflow.com/users/5303318/milad-zahedi"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 41, "favorite_count": 0, "accepted_answer_id": 41945433, "answer_count": 1, "score": 1, "last_activity_date": 1485810477, "creation_date": 1485099907, "last_edit_date": 1485100386, "question_id": 41792917, "link": "https://stackoverflow.com/questions/41792917/snap-snaplets-benefits-of-warpping-a-db-package-in-a-snaplet", "title": "snap snaplets : benefits of warpping a DB package in a snaplet", "body": "<p>I want to run a web API with snap and I am going to use mongoDB. The hackage provides a well designed package named The mongoDB package. What benefits will I get if I use mongoDB package wrapped in a snaplet as opposed to use it alone.</p>\n"}, {"tags": ["arrays", "haskell", "run-length-encoding", "repa"], "comments": [{"owner": {"reputation": 178, "user_id": 4556658, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/176748782a450651ab1ef750943e5f35?s=128&d=identicon&r=PG&f=1", "display_name": "sdx23", "link": "https://stackoverflow.com/users/4556658/sdx23"}, "edited": false, "score": 0, "creation_date": 1485103680, "post_id": 41792899, "comment_id": 70775281, "body": "Is your array onedimensional? If not: Do you want the encoding for each row or for the onedimensional representation of the n-dim thing?"}, {"owner": {"reputation": 303, "user_id": 4173209, "user_type": "registered", "accept_rate": 89, "profile_image": "https://www.gravatar.com/avatar/caf52eb0e43490cabe3bb0cc1f850dfc?s=128&d=identicon&r=PG&f=1", "display_name": "Valerie94", "link": "https://stackoverflow.com/users/4173209/valerie94"}, "reply_to_user": {"reputation": 178, "user_id": 4556658, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/176748782a450651ab1ef750943e5f35?s=128&d=identicon&r=PG&f=1", "display_name": "sdx23", "link": "https://stackoverflow.com/users/4556658/sdx23"}, "edited": false, "score": 0, "creation_date": 1485105877, "post_id": 41792899, "comment_id": 70776027, "body": "@sdx23 My array is one-dimensional."}, {"owner": {"reputation": 29444, "user_id": 3072788, "user_type": "registered", "accept_rate": 82, "profile_image": "https://www.gravatar.com/avatar/220a45c2fcff7e7358d144551b116205?s=128&d=identicon&r=PG&f=1", "display_name": "Alec", "link": "https://stackoverflow.com/users/3072788/alec"}, "edited": false, "score": 0, "creation_date": 1485108090, "post_id": 41792899, "comment_id": 70776738, "body": "Repa is not made for this sort of thing. You would be better using just about anything else... Why do you need repa?"}, {"owner": {"reputation": 303, "user_id": 4173209, "user_type": "registered", "accept_rate": 89, "profile_image": "https://www.gravatar.com/avatar/caf52eb0e43490cabe3bb0cc1f850dfc?s=128&d=identicon&r=PG&f=1", "display_name": "Valerie94", "link": "https://stackoverflow.com/users/4173209/valerie94"}, "reply_to_user": {"reputation": 29444, "user_id": 3072788, "user_type": "registered", "accept_rate": 82, "profile_image": "https://www.gravatar.com/avatar/220a45c2fcff7e7358d144551b116205?s=128&d=identicon&r=PG&f=1", "display_name": "Alec", "link": "https://stackoverflow.com/users/3072788/alec"}, "edited": false, "score": 0, "creation_date": 1485111232, "post_id": 41792899, "comment_id": 70777830, "body": "@Alec Because processing a large list of data is too slow. I&#39;ve already implemented a large part of my program using Repa and it seems to be about 3 times faster than my list implementation. Why isn&#39;t Repa made for this sort of thing? Every tutorial you can find demonstrates Repa&#39;s power by an example in image processing. So if I have an image (as an array), can&#39;t I compress it (via run-length encoding) using Repa?"}, {"owner": {"reputation": 29444, "user_id": 3072788, "user_type": "registered", "accept_rate": 82, "profile_image": "https://www.gravatar.com/avatar/220a45c2fcff7e7358d144551b116205?s=128&d=identicon&r=PG&f=1", "display_name": "Alec", "link": "https://stackoverflow.com/users/3072788/alec"}, "edited": false, "score": 0, "creation_date": 1485111367, "post_id": 41792899, "comment_id": 70777867, "body": "@Valerie94 Repa is good at parallel maps/folds, while this is a necessarily sequential fold. That said, your setup makes sense."}, {"owner": {"reputation": 13807, "user_id": 2407038, "user_type": "registered", "accept_rate": 64, "profile_image": "https://www.gravatar.com/avatar/538f6f4a9aa43841841de7d8e8b169fc?s=128&d=identicon&r=PG&f=1", "display_name": "user2407038", "link": "https://stackoverflow.com/users/2407038/user2407038"}, "edited": false, "score": 0, "creation_date": 1485193569, "post_id": 41792899, "comment_id": 70812900, "body": "Use <a href=\"https://hackage.haskell.org/package/repa-3.4.1.2/docs/Data-Array-Repa.html#t:D\" rel=\"nofollow noreferrer\">toFunction</a> (or e.g. <code>delay</code>) and work with the function - most repa functions won&#39;t help you here, as your operation isn&#39;t (at least as stated) parallelizable."}], "answers": [{"comments": [{"owner": {"reputation": 23444, "user_id": 414413, "user_type": "registered", "accept_rate": 79, "profile_image": "https://www.gravatar.com/avatar/6de2113f01432aa844dc85070ff33e89?s=128&d=identicon&r=PG", "display_name": "Cirdec", "link": "https://stackoverflow.com/users/414413/cirdec"}, "edited": false, "score": 0, "creation_date": 1485208054, "post_id": 41813693, "comment_id": 70820699, "body": "I wonder how that compares to the more general <code>map (length &amp;&amp;&amp; head) . group . toList</code>"}, {"owner": {"reputation": 303, "user_id": 4173209, "user_type": "registered", "accept_rate": 89, "profile_image": "https://www.gravatar.com/avatar/caf52eb0e43490cabe3bb0cc1f850dfc?s=128&d=identicon&r=PG&f=1", "display_name": "Valerie94", "link": "https://stackoverflow.com/users/4173209/valerie94"}, "reply_to_user": {"reputation": 23444, "user_id": 414413, "user_type": "registered", "accept_rate": 79, "profile_image": "https://www.gravatar.com/avatar/6de2113f01432aa844dc85070ff33e89?s=128&d=identicon&r=PG", "display_name": "Cirdec", "link": "https://stackoverflow.com/users/414413/cirdec"}, "edited": false, "score": 1, "creation_date": 1485266058, "post_id": 41813693, "comment_id": 70846742, "body": "@Cirdec The setup is as follows: 1. I read all the samples from a file and convert them to Booleans. 2. I call runLength to calculate the run-length encoding. 3. I print the result to the stdout.  Using my function, this takes 0.013s on average. Using your function, this takes 0.249s on average. With your function, I still have to extract the run-lengths for the True values from the result."}], "tags": [], "owner": {"reputation": 303, "user_id": 4173209, "user_type": "registered", "accept_rate": 89, "profile_image": "https://www.gravatar.com/avatar/caf52eb0e43490cabe3bb0cc1f850dfc?s=128&d=identicon&r=PG&f=1", "display_name": "Valerie94", "link": "https://stackoverflow.com/users/4173209/valerie94"}, "is_accepted": true, "score": 0, "last_activity_date": 1485198010, "creation_date": 1485198010, "answer_id": 41813693, "question_id": 41792899, "link": "https://stackoverflow.com/questions/41792899/run-length-encoding-of-a-repa-array/41813693#41813693", "title": "Run-length encoding of a Repa array", "body": "<p>I'm currently just iterating over the array and returning a list without using any <code>Repa</code> function. I'm working on <code>Boolean</code>s instead of 1's and 0's but the algorithm is the same. I'm converting this list to a <code>Repa</code> Array afterwards.</p>\n\n<pre><code>runLength :: Array U DIM1 Bool -&gt; [Length]\nrunLength arr = go ([], 0, False) 0 arr\n  where\n    Z :. n = extent arr\n    go :: Accumulator -&gt; Int -&gt; Array U DIM1 Bool -&gt; [Length]\n    go !acc@(xs, c, b) !i !arr | i == n = if c &gt; 0 then c:xs else xs\n                               | otherwise =\n                                 if unsafeIndex arr (Z :. i)\n                                 then if b\n                                      then go (xs, c+1, b) (i+1) arr\n                                      else go (xs, 1, True) (i+1) arr\n                                 else if b\n                                      then go (c:xs, 0, False) (i+1) arr\n                                      else go (xs, 0, False) (i+1) arr\n</code></pre>\n"}], "owner": {"reputation": 303, "user_id": 4173209, "user_type": "registered", "accept_rate": 89, "profile_image": "https://www.gravatar.com/avatar/caf52eb0e43490cabe3bb0cc1f850dfc?s=128&d=identicon&r=PG&f=1", "display_name": "Valerie94", "link": "https://stackoverflow.com/users/4173209/valerie94"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 173, "favorite_count": 0, "accepted_answer_id": 41813693, "answer_count": 1, "score": 0, "last_activity_date": 1485198010, "creation_date": 1485099779, "last_edit_date": 1485105901, "question_id": 41792899, "link": "https://stackoverflow.com/questions/41792899/run-length-encoding-of-a-repa-array", "title": "Run-length encoding of a Repa array", "body": "<p>I have a one-dimensional <code>Repa</code> array that consists of 0's and 1's and I want to calculate its run-length encoding. \nE.g.: Turn <code>[0,0,1,1,1,0,0,0,1,0,1,1] into [2,3,3,1,1,2]</code> or something similar. (I'm using a list representation because of readability)</p>\n\n<p>Ideally, I would like the run-length of the 1's and ignore the 0's. \nSo <code>[0,0,1,1,1,0,0,0,1,0,1,1] becomes [3,1,2]</code>. </p>\n\n<p>I would like the result to be a (<code>Repa</code>) array as well. </p>\n\n<p>How can I do this using <code>Repa</code>? I can't use <code>map</code> or <code>traverse</code> since they only give me one element at a time. I could try to <code>fold</code> with some special kind of accumulator but that doesn't seem to be ideal and I don't know it it's even possible (due to monad laws). </p>\n"}, {"tags": ["haskell", "recursion"], "answers": [{"comments": [{"owner": {"reputation": 68, "user_id": 7453834, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/f55f74b22f7a443280b5ebe12faf942e?s=128&d=identicon&r=PG&f=1", "display_name": "Hasan Mozumder", "link": "https://stackoverflow.com/users/7453834/hasan-mozumder"}, "edited": false, "score": 0, "creation_date": 1485099677, "post_id": 41792655, "comment_id": 70773889, "body": "thank you so much for your replay,Your code is very good.However ,it dose&#39;t fulfill the last condition . When there are no more elements in one of the lists, it stops.your code give the output like this:[1,2,3,4] [6,7,8 ]= [1,6,2,7,3,8,4],but it should be  [1,6,2,7,3,8]"}, {"owner": {"reputation": 37219, "user_id": 1523776, "user_type": "moderator", "accept_rate": 87, "profile_image": "https://www.gravatar.com/avatar/b3e0b5c8e42a8c38009ef2d969f8dabb?s=128&d=identicon&r=PG", "display_name": "Benjamin Hodgson", "link": "https://stackoverflow.com/users/1523776/benjamin-hodgson"}, "reply_to_user": {"reputation": 68, "user_id": 7453834, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/f55f74b22f7a443280b5ebe12faf942e?s=128&d=identicon&r=PG&f=1", "display_name": "Hasan Mozumder", "link": "https://stackoverflow.com/users/7453834/hasan-mozumder"}, "edited": false, "score": 0, "creation_date": 1485099773, "post_id": 41792655, "comment_id": 70773919, "body": "I&#39;m sure you can figure out how to modify the code to fit the exercise."}], "tags": [], "owner": {"reputation": 37219, "user_id": 1523776, "user_type": "moderator", "accept_rate": 87, "profile_image": "https://www.gravatar.com/avatar/b3e0b5c8e42a8c38009ef2d969f8dabb?s=128&d=identicon&r=PG", "display_name": "Benjamin Hodgson", "link": "https://stackoverflow.com/users/1523776/benjamin-hodgson"}, "is_accepted": true, "score": 3, "last_activity_date": 1485098748, "last_edit_date": 1485098748, "creation_date": 1485098438, "answer_id": 41792655, "question_id": 41792586, "link": "https://stackoverflow.com/questions/41792586/how-to-create-a-list-from-two-list-and-the-element-from-those-list-alternatively/41792655#41792655", "title": "How to create a list from two list and the element from those list alternatively", "body": "<p>Your <code>interChange</code> is the same as the Prelude's <a href=\"http://hackage.haskell.org/package/base-4.9.1.0/docs/Prelude.html#v:zip\" rel=\"nofollow noreferrer\"><code>zip</code></a>.</p>\n\n<pre><code>ghci&gt; zip [1,2,3] [\"wibble\", \"wobble\", \"wubble\"]\n[(1,\"wibble\"),(2,\"wobble\"),(3,\"wubble\")]\n</code></pre>\n\n<p>To write the function you specified, you in fact need a pair of lists <em>of the same type</em>. We're outputting a list of a particular type, so all of the elements going into that list must have that type as well.</p>\n\n<pre><code>interleave :: [a] -&gt; [a] -&gt; [a]\n</code></pre>\n\n<p>You can implement this in a recursive fashion by passing around a <code>Bool</code> indicating which list you should take the next element from:</p>\n\n<pre><code>interleave = go True\n    where go _ [] ys = ys\n          go _ xs [] = xs\n          go True (x:xs) ys = x : go False xs ys\n          go False xs (y:ys) = y : go True xs ys\n</code></pre>\n\n<p>Evaluation ping-pongs between the last two clauses of <code>go</code> until either one of the input lists is empty, whereupon we just return the rest of the other one. (If you wanted it to behave more like <code>zip</code> you could have it truncate the output by returning <code>[]</code> instead of <code>xs</code> or <code>ys</code> in those cases.)</p>\n\n<hr>\n\n<p>But I always recommend avoiding recursion to program at a higher level where possible. We can write this function as a pipeline:</p>\n\n<ol>\n<li>Pair up the elements of the input lists using <code>zip</code></li>\n<li>Turn each tuple in the resulting list into a two-element list: <code>map (\\(x, y) -&gt; [x, y])</code></li>\n<li>Flatten the resulting list-of-lists using <code>concat</code></li>\n</ol>\n\n<p>So the code looks like this:</p>\n\n<pre><code>interleave xs ys = concat $ map (\\(x, y) -&gt; [x, y]) $ zip xs ys\n</code></pre>\n\n<p>I find this code much easier to understand than the recursive code, which requires you to reason about the flow of control - it's just a sequence of high-level instructions.</p>\n\n<p>Incidentally, you can elide the intermediate <code>map</code> by dragging it into either the <code>concat</code> or the <code>zip</code>:</p>\n\n<pre><code>interleave xs ys = concatMap (\\(x, y) -&gt; [x, y]) $ zip xs ys\ninterleave xs ys = concat $ zipWith (\\(x, y) -&gt; [x, y]) xs ys\n</code></pre>\n"}, {"tags": [], "owner": {"reputation": 14485, "user_id": 190376, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/cd8280c5e1491b8cf55760750ed97dec?s=128&d=identicon&r=PG", "display_name": "Reid Barton", "link": "https://stackoverflow.com/users/190376/reid-barton"}, "is_accepted": false, "score": 2, "last_activity_date": 1485099403, "creation_date": 1485099403, "answer_id": 41792839, "question_id": 41792586, "link": "https://stackoverflow.com/questions/41792586/how-to-create-a-list-from-two-list-and-the-element-from-those-list-alternatively/41792839#41792839", "title": "How to create a list from two list and the element from those list alternatively", "body": "<p>When <code>interChange</code> is called with two nonempty lists <code>(x:xs)</code> and <code>(y:ys)</code>, the output should be a list starting with <code>x</code> and then <code>y</code> and then more stuff. So you should write something like</p>\n\n<pre><code>interChange (x:xs) (y:ys) =  x : y : ...\n</code></pre>\n"}], "owner": {"reputation": 68, "user_id": 7453834, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/f55f74b22f7a443280b5ebe12faf942e?s=128&d=identicon&r=PG&f=1", "display_name": "Hasan Mozumder", "link": "https://stackoverflow.com/users/7453834/hasan-mozumder"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 655, "favorite_count": 0, "accepted_answer_id": 41792655, "answer_count": 2, "score": 2, "last_activity_date": 1485099403, "creation_date": 1485098081, "question_id": 41792586, "link": "https://stackoverflow.com/questions/41792586/how-to-create-a-list-from-two-list-and-the-element-from-those-list-alternatively", "title": "How to create a list from two list and the element from those list alternatively", "body": "<p>I'm new in Haskell. I'm trying to Use recursion to write a function which, given two lists (they need to be of the same type), interleaves their elements (takes elements alternating between the first and the second list) . When there are no more elements in one of the lists, it stops and the result is the list achieved that far.</p>\n\n<pre><code>interChange :: [a] -&gt; [b] -&gt;[(a,b)]\ninterChange _ [] = []\ninterChange [] _ = []\ninterChange (x:xs) (y:ys) =  (x,y) : interChange xs ys\n</code></pre>\n\n<p>example of my output:</p>\n\n<pre><code>interChange [1,2,3] [4,5,6]\n [(1,4),(2,5),(3,6)]\n</code></pre>\n\n<p>example of the needed output is:</p>\n\n<pre><code>interChange [1,2,3] [4,5,6]\n[1,4,2,5,3,6]\n</code></pre>\n\n<p>Thanks for your help</p>\n"}, {"tags": ["haskell", "recursion"], "answers": [{"comments": [{"owner": {"reputation": 1232, "user_id": 7453707, "user_type": "registered", "accept_rate": 72, "profile_image": "https://lh4.googleusercontent.com/-ga6gJDP75pc/AAAAAAAAAAI/AAAAAAAAAO0/pIEgPij3PqU/photo.jpg?sz=128", "display_name": "ShocKwav3_", "link": "https://stackoverflow.com/users/7453707/shockwav3"}, "edited": false, "score": 0, "creation_date": 1485095548, "post_id": 41791977, "comment_id": 70772606, "body": "i tried to do &#39;dateDistance (fy,fm,fd) (sy,sm,sd) n     |(fy == sy &amp;&amp; fm == sm &amp;&amp; sd == fd) = n     |otherwise = dateDistance nextDate (fy,fm,fd) (sy,sm,sd) . n+1      where n = 0&#39;      but it did not work. is it wrong how i write? @Paul"}, {"owner": {"reputation": 178, "user_id": 4556658, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/176748782a450651ab1ef750943e5f35?s=128&d=identicon&r=PG&f=1", "display_name": "sdx23", "link": "https://stackoverflow.com/users/4556658/sdx23"}, "edited": false, "score": 0, "creation_date": 1485095704, "post_id": 41791977, "comment_id": 70772644, "body": "In this case you need to leave out the where-clause and just supply 0 from a wrapper. E.g. rename <code>dateDistance</code> to <code>dateDistanceGo</code> and define <code>dateDistance f s = dateDistanceGo f s 0</code>."}, {"owner": {"reputation": 1232, "user_id": 7453707, "user_type": "registered", "accept_rate": 72, "profile_image": "https://lh4.googleusercontent.com/-ga6gJDP75pc/AAAAAAAAAAI/AAAAAAAAAO0/pIEgPij3PqU/photo.jpg?sz=128", "display_name": "ShocKwav3_", "link": "https://stackoverflow.com/users/7453707/shockwav3"}, "reply_to_user": {"reputation": 178, "user_id": 4556658, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/176748782a450651ab1ef750943e5f35?s=128&d=identicon&r=PG&f=1", "display_name": "sdx23", "link": "https://stackoverflow.com/users/4556658/sdx23"}, "edited": false, "score": 0, "creation_date": 1485097853, "post_id": 41791977, "comment_id": 70773320, "body": "could you elaborate a little bit as a answer . i am very new in haskell and functional programming. @sdx23"}, {"owner": {"reputation": 16362, "user_id": 49220, "user_type": "registered", "accept_rate": 56, "profile_image": "https://www.gravatar.com/avatar/431cd43aaf713caa80316e852a87a840?s=128&d=identicon&r=PG", "display_name": "Paul Johnson", "link": "https://stackoverflow.com/users/49220/paul-johnson"}, "edited": false, "score": 0, "creation_date": 1485098448, "post_id": 41791977, "comment_id": 70773517, "body": "Actually sdx23&#39;s answer below is better."}], "tags": [], "owner": {"reputation": 16362, "user_id": 49220, "user_type": "registered", "accept_rate": 56, "profile_image": "https://www.gravatar.com/avatar/431cd43aaf713caa80316e852a87a840?s=128&d=identicon&r=PG", "display_name": "Paul Johnson", "link": "https://stackoverflow.com/users/49220/paul-johnson"}, "is_accepted": false, "score": 1, "last_activity_date": 1485094693, "creation_date": 1485094693, "answer_id": 41791977, "question_id": 41791904, "link": "https://stackoverflow.com/questions/41791904/how-to-count-the-recursion-times-in-haskell/41791977#41791977", "title": "How to count the recursion times in Haskell?", "body": "<p>You need to pass the \"n\" explicitly through the recursive calls. Make it an extra parameter of your <code>dateDistance</code> function and put <code>n+1</code> in the recursive call. Then call it with an initial value of 0.</p>\n\n<p>You can rename the <code>dateDistance</code> function to something else and rewrite <code>dateDistance</code> to call it with the initial value of 0.</p>\n"}, {"comments": [{"owner": {"reputation": 1232, "user_id": 7453707, "user_type": "registered", "accept_rate": 72, "profile_image": "https://lh4.googleusercontent.com/-ga6gJDP75pc/AAAAAAAAAAI/AAAAAAAAAO0/pIEgPij3PqU/photo.jpg?sz=128", "display_name": "ShocKwav3_", "link": "https://stackoverflow.com/users/7453707/shockwav3"}, "edited": false, "score": 0, "creation_date": 1485095895, "post_id": 41792033, "comment_id": 70772697, "body": "1. fy,fm,fd is the starting year,month,day and sy,sm,sd is the target date. when both are equal then its not zero its the total recursion steps.i put n=0 there just te see if the syntax is okay. but i want to increment n each step until the recursion stops and then show the total value of n as the total distance. 2. f1 is one recursion step."}, {"owner": {"reputation": 16362, "user_id": 49220, "user_type": "registered", "accept_rate": 56, "profile_image": "https://www.gravatar.com/avatar/431cd43aaf713caa80316e852a87a840?s=128&d=identicon&r=PG", "display_name": "Paul Johnson", "link": "https://stackoverflow.com/users/49220/paul-johnson"}, "edited": false, "score": 1, "creation_date": 1485098579, "post_id": 41792033, "comment_id": 70773570, "body": "You are thinking in imperative terms, which is not how Haskell works. The answer for two dates the same is zero.  The answer for any other pair of dates is one plus the answer for the day after the first date."}], "tags": [], "owner": {"reputation": 178, "user_id": 4556658, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/176748782a450651ab1ef750943e5f35?s=128&d=identicon&r=PG&f=1", "display_name": "sdx23", "link": "https://stackoverflow.com/users/4556658/sdx23"}, "is_accepted": true, "score": 2, "last_activity_date": 1485094996, "creation_date": 1485094996, "answer_id": 41792033, "question_id": 41791904, "link": "https://stackoverflow.com/questions/41791904/how-to-count-the-recursion-times-in-haskell/41792033#41792033", "title": "How to count the recursion times in Haskell?", "body": "<p>Actually, you don't need to remember it, even though you could do so, by passing it from call to call as an argument.</p>\n\n<p>Let's answer two questions:</p>\n\n<ol>\n<li><p>What is the base case of your recursion?\nExactly, when both dates are equal; the distance is 0 then.</p></li>\n<li><p>What is one recursion step?\nWell, if the dates f and s are not equal, we search for the nextDate (rather next-day!), lets call it f1. f1 is one day distant from f, but one day nearer to s. f2 ( = <code>nextDate f1</code>) is two days from f, but even nearer to s. So: <code>dateDistance f s = 1 + dateDistance f1 s</code> and <code>dateDistance f1 s = 1 + dateDistance f2 s</code>.</p></li>\n</ol>\n"}], "owner": {"reputation": 1232, "user_id": 7453707, "user_type": "registered", "accept_rate": 72, "profile_image": "https://lh4.googleusercontent.com/-ga6gJDP75pc/AAAAAAAAAAI/AAAAAAAAAO0/pIEgPij3PqU/photo.jpg?sz=128", "display_name": "ShocKwav3_", "link": "https://stackoverflow.com/users/7453707/shockwav3"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 1267, "favorite_count": 0, "accepted_answer_id": 41792033, "answer_count": 2, "score": 1, "last_activity_date": 1485094996, "creation_date": 1485094223, "question_id": 41791904, "link": "https://stackoverflow.com/questions/41791904/how-to-count-the-recursion-times-in-haskell", "title": "How to count the recursion times in Haskell?", "body": "<p>I am trying to write a function, given two dates, calculates the distance (in days) between the two dates, using recursion. The function <code>dateDistance</code> takes two dates and uses <code>nextDate</code> to find the next valid date. <code>goodDate</code> makes sure its a valid date.</p>\n\n<p>I am trying to get the result by counting recursions and returning the count. Each time the recursion happens the count variable <code>n</code> should increase and at the end of the recursion when it reaches the end condition <code>(fy == sy &amp;&amp; fm == sm &amp;&amp; sd == fd) = n</code> it shall return the <code>n</code>. </p>\n\n<pre><code>   leapYear x = if ((x `mod` 4) == 0) &amp;&amp; ((x `mod` 100) /= 0) || ((x `mod` 400) == 0) \n                 then True\n                 else False\n\n    goodDate (y,m,d)\n        | (d&lt;1 || m&gt;12 || m&lt;1 || y==0) = False\n        | m `elem` [1,3,5,7,8,10,12] = d&lt;32\n        | m `elem` [4,6,9,11] = d&lt;31\n        | leapYear y = d&lt;30\n        | otherwise= d&lt;29 \n\n    nextDate (y,m,d) =\n      if goodDate(y,m,(d+1)) \n      then (y,m,(d+1))\n      else if goodDate(y,(m+1),1)\n           then (y,(m+1),1)\n           else ((y+1),1,1)\n\n\n\n    dateDistance (fy,fm,fd) (sy,sm,sd) \n    |(fy == sy &amp;&amp; fm == sm &amp;&amp; sd == fd) = n\n    |otherwise = dateDistance nextDate (fy,fm,fd) (sy,sm,sd)\n     where n = 0\n</code></pre>\n"}, {"tags": ["haskell", "recursion", "lazy-evaluation"], "comments": [{"owner": {"reputation": 27561, "user_id": 214446, "user_type": "registered", "accept_rate": 74, "profile_image": "https://www.gravatar.com/avatar/5deb6b87326686b1f2e9fdb37ceac210?s=128&d=identicon&r=PG", "display_name": "mb21", "link": "https://stackoverflow.com/users/214446/mb21"}, "edited": false, "score": 0, "creation_date": 1485095386, "post_id": 41791588, "comment_id": 70772560, "body": "not sure about this case (probably the first version gets unrolled to basically a loop while the second keeps allocating stack frames) see <a href=\"http://stackoverflow.com/questions/13042353/does-haskell-have-tail-recursive-optimization\" title=\"does haskell have tail recursive optimization\">stackoverflow.com/questions/13042353/&hellip;</a> for a similar case..."}, {"owner": {"reputation": 384463, "user_id": 1126841, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/fa05233b2357f8d11c22ef4cfc7bb85c?s=128&d=identicon&r=PG", "display_name": "chepner", "link": "https://stackoverflow.com/users/1126841/chepner"}, "edited": false, "score": 0, "creation_date": 1485095435, "post_id": 41791588, "comment_id": 70772580, "body": "I have a feeling it must be related to currying, as the overflow example builds up the thunks in the first argument."}, {"owner": {"reputation": 178, "user_id": 4556658, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/176748782a450651ab1ef750943e5f35?s=128&d=identicon&r=PG&f=1", "display_name": "sdx23", "link": "https://stackoverflow.com/users/4556658/sdx23"}, "edited": false, "score": 0, "creation_date": 1485095494, "post_id": 41791588, "comment_id": 70772595, "body": "Please include ghci version information. For me this doesn&#39;t happen, but allocation fails instead (7.6.3)."}, {"owner": {"reputation": 145, "user_id": 6447617, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/b7355c1fcb1a8116434c59f652328b2e?s=128&d=identicon&r=PG&f=1", "display_name": "Finn M", "link": "https://stackoverflow.com/users/6447617/finn-m"}, "edited": false, "score": 0, "creation_date": 1485096358, "post_id": 41791588, "comment_id": 70772840, "body": "well in my case both are already TCO aren&#39;t they? and in those answers it even specifically says to make the accumulation argument strict, which I do not for the first example and it still works. That&#39;s practically the root of my confusion."}], "answers": [{"comments": [{"owner": {"reputation": 145, "user_id": 6447617, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/b7355c1fcb1a8116434c59f652328b2e?s=128&d=identicon&r=PG&f=1", "display_name": "Finn M", "link": "https://stackoverflow.com/users/6447617/finn-m"}, "edited": false, "score": 0, "creation_date": 1485096869, "post_id": 41792170, "comment_id": 70773010, "body": "Yes, makes 100% sense, so one big number was not enough to test it :P"}], "tags": [], "owner": {"reputation": 14485, "user_id": 190376, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/cd8280c5e1491b8cf55760750ed97dec?s=128&d=identicon&r=PG", "display_name": "Reid Barton", "link": "https://stackoverflow.com/users/190376/reid-barton"}, "is_accepted": true, "score": 6, "last_activity_date": 1485095776, "creation_date": 1485095776, "answer_id": 41792170, "question_id": 41791588, "link": "https://stackoverflow.com/questions/41791588/how-does-argument-passing-order-affect-lazy-evaluation-in-haskell/41792170#41792170", "title": "How does argument passing order affect lazy evaluation in Haskell?", "body": "<p>First, notice that the difference between your two versions is quantitative, not qualitative. The first will stack overflow on an input of <code>40000000</code>, and the second will complete successfully on an input of <code>10000000</code>. It looks like the second version uses twice as much stack as the first.</p>\n\n<p>Basically, the reason is that, if we introduce the notation <code>{n}</code> for the thunks that live in the <code>x</code> and <code>y</code> arguments, your first version does</p>\n\n<pre><code>fib2 {n} {n+1} 0 = {n}\nfib2 {n} {n+1} z = let {n+2} = (+) {n} {n+1}    -- build a thunk\n                    in fib2 {n+1} {n+2} (z - 1)\n</code></pre>\n\n<p>while the second version does</p>\n\n<pre><code>fib2 {n+1} {n} 0 = {n+1}\nfib2 {n+1} {n} z = let {n+2} = (+) {n+1} {n}    -- build a thunk\n                    in fib2 {n+2} {n+1} (z - 1)\n</code></pre>\n\n<p>Now consider what happens when the <code>fib2</code> recursion finishes and it's time to evaluate <code>{n}</code> (or <code>{n+1}</code>; let's just ignore this difference). Each of the thunks <code>{0}</code>, ..., <code>{n}</code> will get evaluated just once, in some order. It happens that <code>(+)</code> evaluates its left argument first, then its right argument. For definiteness, let's just take <code>n = 6</code>. The evaluation looks like</p>\n\n<pre><code>{6} = (+) {4} {5}\n... {4} = (+) {2} {3}\n... ... {2} = (+) {0} {1}\n... ... ... {0} = 0\n... ... ... {1} = 1\n... ... {2} = 1\n... ... {3} = (+) {1} {2}\n... ... ... {1} = 1\n... ... ... {2} = 1   -- we already calculated it\n... ... {3} = 2\n... {4} = 3\n... {5} = ......\n</code></pre>\n\n<p>The stack will never get deeper than <code>n/2</code> levels, since we recurse from <code>{n}</code> to <code>{n-2}</code> first and when we need to compute <code>{n-1}</code> we have already computed <code>{n-2}</code>.</p>\n\n<p>In contrast, in the second version we recurse from <code>{n}</code> to <code>{n-1}</code> first, so the stack will have <code>n</code> levels.</p>\n"}], "owner": {"reputation": 145, "user_id": 6447617, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/b7355c1fcb1a8116434c59f652328b2e?s=128&d=identicon&r=PG&f=1", "display_name": "Finn M", "link": "https://stackoverflow.com/users/6447617/finn-m"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 128, "favorite_count": 2, "accepted_answer_id": 41792170, "answer_count": 1, "score": 8, "last_activity_date": 1485096452, "creation_date": 1485092408, "last_edit_date": 1485096452, "question_id": 41791588, "link": "https://stackoverflow.com/questions/41791588/how-does-argument-passing-order-affect-lazy-evaluation-in-haskell", "title": "How does argument passing order affect lazy evaluation in Haskell?", "body": "<p>I've been trying to understand lazy evaluation in Haskell and I understood it basically as only evaluate when you have to. But when trying to implement fibonacci efficiently I came across this (weird?) behaviour:\nThis Implementation:</p>\n\n<pre><code>--wrapper function used by both implementations\nfib :: Int -&gt; Int\nfib x = if x &lt; 0 then 0 else fib2 0 1 x\n\nfib2 :: Int -&gt; Int -&gt; Int -&gt; Int\nfib2 x y 0 = x\nfib2 x y z = fib2 y (x + y) (z - 1)\n</code></pre>\n\n<p>will work even when called with </p>\n\n<pre><code>fib 20000000\n&gt; -70318061090422843\n</code></pre>\n\n<p>while swapping the passed arguments in the recursive call:</p>\n\n<pre><code>fib2 :: Int -&gt; Int -&gt; Int -&gt; Int\nfib2 x y 0 = x\nfib2 x y z = fib2 (x + y) x (z - 1)\n</code></pre>\n\n<p>results in:</p>\n\n<pre><code>fib 20000000\n&gt;*** Exception: stack overflow\n</code></pre>\n\n<p>Why don't I have to tell the compiler to eagerly evaluate in the first example?\nWhy does the second example not work while the first does?</p>\n\n<p>I used the GHCi 8.0.1 on Windows 10 for this.</p>\n"}, {"tags": ["string", "haskell", "prefixes"], "answers": [{"comments": [{"owner": {"reputation": 43, "user_id": 7163068, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/5c53e72578f731d47d08d3cd5e6fbe1b?s=128&d=identicon&r=PG", "display_name": "Dystr", "link": "https://stackoverflow.com/users/7163068/dystr"}, "edited": false, "score": 0, "creation_date": 1485094489, "post_id": 41791906, "comment_id": 70772245, "body": "Ok, this was enlightening. I think I just learned something about how the &quot;:&quot; operator works.  Many thanks!"}, {"owner": {"reputation": 581, "user_id": 6178240, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/CRJ95.jpg?s=128&g=1", "display_name": "MiFi", "link": "https://stackoverflow.com/users/6178240/mifi"}, "edited": false, "score": 1, "creation_date": 1581358090, "post_id": 41791906, "comment_id": 106397699, "body": "Apostrophe is missing in recursive function call in prefixes&#39;."}], "tags": [], "owner": {"reputation": 1386, "user_id": 301503, "user_type": "registered", "accept_rate": 92, "profile_image": "https://www.gravatar.com/avatar/07a7b11ea0dd5127e2333f6ef46254f8?s=128&d=identicon&r=PG", "display_name": "Ingdas", "link": "https://stackoverflow.com/users/301503/ingdas"}, "is_accepted": false, "score": 1, "last_activity_date": 1583412893, "last_edit_date": 1583412893, "creation_date": 1485094259, "answer_id": 41791906, "question_id": 41791489, "link": "https://stackoverflow.com/questions/41791489/list-of-prefixes-in-haskell/41791906#41791906", "title": "List of prefixes in haskell", "body": "<p>I don't think this code does what you think it does. You try to pattern match the list x with the pattern [x], which captures the element of a singleton list. If i fix your code like this, it works:</p>\n\n<pre><code>prefixess x [] = x\nprefixess [] s = prefixess [s] s\nprefixess x s  = prefixess ((init s):x) (init s)\nprefixes s = prefixess [] s\n</code></pre>\n\n<p>This gives the following result:</p>\n\n<pre><code>Main&gt; prefixes \"stackoverflow\"\n[\"\",\"s\",\"st\",\"sta\",\"stac\",\"stack\",\"stacko\",\"stackov\",\"stackove\",\"stackover\",\"stackoverf\",\"stackoverfl\",\"stackoverflo\",\"stackoverflow\"]\n</code></pre>\n\n<p>But you don't really need an accumulator for a function which calculates prefixes, I would write it like this:</p>\n\n<pre><code>prefixes' (x:xs) = [] : (map (x:) (prefixes' xs))\nprefixes' [] = [[]]\n</code></pre>\n\n<p>This function is also available under the name \"inits\" in Data.List</p>\n\n<pre><code>Main&gt; import Data.List\nMain Data.List&gt; inits \"stackoverflow\"\n[\"\",\"s\",\"st\",\"sta\",\"stac\",\"stack\",\"stacko\",\"stackov\",\"stackove\",\"stackover\",\"stackoverf\",\"stackoverfl\",\"stackoverflo\",\"stackoverflow\"]\n</code></pre>\n"}, {"tags": [], "owner": {"reputation": 581, "user_id": 6178240, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/CRJ95.jpg?s=128&g=1", "display_name": "MiFi", "link": "https://stackoverflow.com/users/6178240/mifi"}, "is_accepted": false, "score": 0, "last_activity_date": 1581358211, "creation_date": 1581358211, "answer_id": 60156065, "question_id": 41791489, "link": "https://stackoverflow.com/questions/41791489/list-of-prefixes-in-haskell/60156065#60156065", "title": "List of prefixes in haskell", "body": "<p>Point-free style solution for genereting list of all prefixes:</p>\n\n<pre><code>prefixes = foldr (\\el acc -&gt; [] : map (el:) acc) [[]] \n</code></pre>\n"}], "owner": {"reputation": 43, "user_id": 7163068, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/5c53e72578f731d47d08d3cd5e6fbe1b?s=128&d=identicon&r=PG", "display_name": "Dystr", "link": "https://stackoverflow.com/users/7163068/dystr"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 1943, "favorite_count": 0, "answer_count": 2, "score": 0, "last_activity_date": 1583412893, "creation_date": 1485091795, "question_id": 41791489, "link": "https://stackoverflow.com/questions/41791489/list-of-prefixes-in-haskell", "title": "List of prefixes in haskell", "body": "<p>I am to write a function which returns a list of all prefixes of a given string.</p>\n\n<p>This is where I'm at so far. </p>\n\n<pre><code>prefixess [x] [] = [x]\nprefixess [] s = prefixess [s] s\nprefixess [x] s  = prefixess [x, (init s)] (init s)\nprefixes s = prefixess [] s\n</code></pre>\n\n<p>It compiles, but when I try running it on a string I get this:</p>\n\n<pre><code>Couldn't match type \u2018Char\u2019 with \u2018[t]\u2019\nExpected type: [[t]]\n  Actual type: [Char]\nRelevant bindings include\n  it :: [t] -&gt; [[t]] (bound at &lt;interactive&gt;:18:1)\nIn the first argument of \u2018prefixess\u2019, namely \u2018\"abcde\"\u2019\nIn the expression: prefixess \"abcde\"\nIn an equation for \u2018it\u2019: it = prefixess \"abcde\"\n</code></pre>\n\n<p>I am out of ideas. Any hints?</p>\n"}, {"tags": ["arrays", "haskell", "bytestring", "repa"], "comments": [{"owner": {"reputation": 29444, "user_id": 3072788, "user_type": "registered", "accept_rate": 82, "profile_image": "https://www.gravatar.com/avatar/220a45c2fcff7e7358d144551b116205?s=128&d=identicon&r=PG&f=1", "display_name": "Alec", "link": "https://stackoverflow.com/users/3072788/alec"}, "edited": false, "score": 1, "creation_date": 1485084883, "post_id": 41790219, "comment_id": 70769516, "body": "If your program is small, it might be nice to post (or link) it too. It&#39;ll make our answer much more concrete (and verifiable)."}, {"owner": {"user_type": "does_not_exist", "display_name": "user7420876"}, "reply_to_user": {"reputation": 29444, "user_id": 3072788, "user_type": "registered", "accept_rate": 82, "profile_image": "https://www.gravatar.com/avatar/220a45c2fcff7e7358d144551b116205?s=128&d=identicon&r=PG&f=1", "display_name": "Alec", "link": "https://stackoverflow.com/users/3072788/alec"}, "edited": false, "score": 0, "creation_date": 1485086985, "post_id": 41790219, "comment_id": 70770068, "body": "@Alec I&#39;m sorry, but I&#39;m not allowed to share the code."}], "answers": [{"tags": [], "owner": {"reputation": 8621, "user_id": 1848029, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/qfjAy.jpg?s=128&g=1", "display_name": "lehins", "link": "https://stackoverflow.com/users/1848029/lehins"}, "is_accepted": true, "score": 1, "last_activity_date": 1485086468, "last_edit_date": 1485086468, "creation_date": 1485085890, "answer_id": 41790535, "question_id": 41790219, "link": "https://stackoverflow.com/questions/41790219/reading-samples-from-a-file-into-an-array/41790535#41790535", "title": "Reading samples, from a file, into an array", "body": "<p>Repa is actually capable of operating on ByteString as a backend for an array. So you can start processing ByteString in parallel right of the bet by  trying something along those lines:</p>\n\n<pre><code>#!/usr/bin/env stack\n-- stack runghc --package repa\n\nimport Data.ByteString as BS\nimport Data.Array.Repa as R\nimport Data.Array.Repa.Repr.ByteString as R\n\ngetFloatsArr :: ByteString -&gt; Array D DIM1 Float\ngetFloatsArr bs = R.traverse strArr (\\(Z :. n) -&gt; Z :. (n `div` 3)) getFloat where\n  strArr = R.fromByteString (Z :. BS.length bs) bs\n  getFloat getWord8 (Z :. k) =\n    toFloat (getWord8 (Z :. k*3)) (getWord8 (Z :. k*3+1)) (getWord8 (Z :. k*3+2))\n  toFloat = undefined -- convert to `Float` from 3 `Word8`s\n\nprocessFurther :: Array U DIM1 Float -&gt; a\nprocessFurther = undefined\n\nmain :: IO ()\nmain = do\n  bs &lt;- BS.readFile \"file.txt\"\n  arr &lt;- R.computeUnboxedP $ getFloatsArr bs\n  processFurther arr\n  return ()\n</code></pre>\n"}], "owner": {"user_type": "does_not_exist", "display_name": "user7420876"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 58, "favorite_count": 1, "accepted_answer_id": 41790535, "answer_count": 1, "score": 2, "last_activity_date": 1485086468, "creation_date": 1485083795, "question_id": 41790219, "link": "https://stackoverflow.com/questions/41790219/reading-samples-from-a-file-into-an-array", "title": "Reading samples, from a file, into an array", "body": "<p>I've written a program that analyzes sample data that is contained an a file. Currently, my program reads the samples into a list and I perform the further analyzation/processing on the list of samples (<code>[Float]</code>). </p>\n\n<p>I'm not quite happy with the performance and I'm thinking about using Arrays instead of lists for better performance. I'm also looking into parallelizing my implementation and <code>Data.Array.Repa</code> looks promising. </p>\n\n<p>Currently, reading from the file goes something like this: </p>\n\n<ol>\n<li>I read all the samples into a <code>ByteString</code>, using <code>hGet</code>.</li>\n<li>I know each sample is represented by 3 bytes, so I group the <code>ByteString</code> into a list of <code>ByteString</code>s of 3.</li>\n<li>I map my <code>toFloat</code> function on the list of <code>ByteString</code>s to get a list of <code>Float</code>s. </li>\n</ol>\n\n<p>This results in the <code>[Float]</code> that I analyze to get the desired information.</p>\n\n<p>I'm wondering at which step in this process I should start using an Array. I first thought about using the <code>listArray</code> function to transform my <code>[Float]</code> into an array of floats. I'm not sure, but this doesn't seem to be the most efficient way. </p>\n\n<p>Would it be possible to use <code>Data.Array.Repa.fromFunction</code> to construct the array right after step 2 and skip the intermediate <code>[Float]</code>? For the function, could I use something like <code>(map toFloat bsList)</code>? Where <code>bsList</code> is the list of <code>ByteString</code>s after grouping. </p>\n\n<p>Or is there a way to read the samples directly into an array? </p>\n"}, {"tags": ["haskell", "types", "gadt"], "comments": [{"owner": {"reputation": 100185, "user_id": 3234959, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/93bb12ca0f93dfddb33880316f7e66c2?s=128&d=identicon&r=PG&f=1", "display_name": "chi", "link": "https://stackoverflow.com/users/3234959/chi"}, "edited": false, "score": 1, "creation_date": 1485078442, "post_id": 41789354, "comment_id": 70767869, "body": "This is impossible, there is no way to return a polymorphic value in <code>D a</code>, unless it&#39;s bottom. If/when we get <code>pi</code> types (non-erased types), then it will be possible to write <code>x :: pi a. D a</code>"}, {"owner": {"reputation": 29444, "user_id": 3072788, "user_type": "registered", "accept_rate": 82, "profile_image": "https://www.gravatar.com/avatar/220a45c2fcff7e7358d144551b116205?s=128&d=identicon&r=PG&f=1", "display_name": "Alec", "link": "https://stackoverflow.com/users/3072788/alec"}, "edited": false, "score": 1, "creation_date": 1485079852, "post_id": 41789354, "comment_id": 70768208, "body": "Also, as unpleasant as it is, <code>D Any</code> is a valid type. <code>DataKinds</code> still allows type-level undefined..."}, {"owner": {"reputation": 20310, "user_id": 525980, "user_type": "registered", "accept_rate": 48, "profile_image": "https://www.gravatar.com/avatar/8dafe66793ee2f32192e9fcefb389a12?s=128&d=identicon&r=PG", "display_name": "Clinton", "link": "https://stackoverflow.com/users/525980/clinton"}, "edited": false, "score": 0, "creation_date": 1485079952, "post_id": 41789354, "comment_id": 70768233, "body": "I don&#39;t mind that being undefined, as long as <code>x :: D True</code> and <code>x :: D False</code> are defined."}, {"owner": {"reputation": 28873, "user_id": 1068232, "user_type": "registered", "accept_rate": 79, "profile_image": "https://www.gravatar.com/avatar/2a0a145ce58c20013969fe3f203531da?s=128&d=identicon&r=PG", "display_name": "Andr&#225;s Kov&#225;cs", "link": "https://stackoverflow.com/users/1068232/andr%c3%a1s-kov%c3%a1cs"}, "edited": false, "score": 0, "creation_date": 1485080426, "post_id": 41789354, "comment_id": 70768321, "body": "GHC has no knowledge that <code>a :: Bool</code> can  only be <code>True</code> or <code>False</code>. Dispatching on <code>a :: Bool</code> is not possible in any way, since it&#39;s erased at runtime. You need at least <code>x :: SingI a =&gt; D a</code> or <code>x :: Sing a -&gt; D a</code> if you want dispatch."}, {"owner": {"reputation": 20310, "user_id": 525980, "user_type": "registered", "accept_rate": 48, "profile_image": "https://www.gravatar.com/avatar/8dafe66793ee2f32192e9fcefb389a12?s=128&d=identicon&r=PG", "display_name": "Clinton", "link": "https://stackoverflow.com/users/525980/clinton"}, "edited": false, "score": 0, "creation_date": 1485082883, "post_id": 41789354, "comment_id": 70768977, "body": "If <code>a</code> is erased at runtime, how does dispatch work for class methods? Or is the type saved for types with class constraints?"}, {"owner": {"reputation": 12941, "user_id": 292731, "user_type": "registered", "accept_rate": 89, "profile_image": "https://www.gravatar.com/avatar/e3f90adedab79538799e2375a9731920?s=128&d=identicon&r=PG", "display_name": "Justin L.", "link": "https://stackoverflow.com/users/292731/justin-l"}, "edited": false, "score": 1, "creation_date": 1485083356, "post_id": 41789354, "comment_id": 70769120, "body": "@Clinton Explicit dictionaries are passed, and types are erased.  For example, for something like <code>Show a =&gt; a -&gt; IO ()</code>, it&#39;s more or less implemented as <code>(a -&gt; String) -&gt; a -&gt; IO ()</code>.  The actual class method implementations themselves are passed in as arguments, so the types don&#39;t have to."}], "answers": [{"comments": [{"owner": {"reputation": 37219, "user_id": 1523776, "user_type": "moderator", "accept_rate": 87, "profile_image": "https://www.gravatar.com/avatar/b3e0b5c8e42a8c38009ef2d969f8dabb?s=128&d=identicon&r=PG", "display_name": "Benjamin Hodgson", "link": "https://stackoverflow.com/users/1523776/benjamin-hodgson"}, "edited": false, "score": 0, "creation_date": 1485084273, "post_id": 41790046, "comment_id": 70769362, "body": "This answer would be improved with a demonstration of the type class technique."}, {"owner": {"reputation": 29444, "user_id": 3072788, "user_type": "registered", "accept_rate": 82, "profile_image": "https://www.gravatar.com/avatar/220a45c2fcff7e7358d144551b116205?s=128&d=identicon&r=PG&f=1", "display_name": "Alec", "link": "https://stackoverflow.com/users/3072788/alec"}, "reply_to_user": {"reputation": 37219, "user_id": 1523776, "user_type": "moderator", "accept_rate": 87, "profile_image": "https://www.gravatar.com/avatar/b3e0b5c8e42a8c38009ef2d969f8dabb?s=128&d=identicon&r=PG", "display_name": "Benjamin Hodgson", "link": "https://stackoverflow.com/users/1523776/benjamin-hodgson"}, "edited": false, "score": 0, "creation_date": 1485085839, "post_id": 41790046, "comment_id": 70769733, "body": "@BenjaminHodgson Updated accordingly."}], "tags": [], "owner": {"reputation": 29444, "user_id": 3072788, "user_type": "registered", "accept_rate": 82, "profile_image": "https://www.gravatar.com/avatar/220a45c2fcff7e7358d144551b116205?s=128&d=identicon&r=PG&f=1", "display_name": "Alec", "link": "https://stackoverflow.com/users/3072788/alec"}, "is_accepted": false, "score": 8, "last_activity_date": 1485104448, "last_edit_date": 1485104448, "creation_date": 1485082682, "answer_id": 41790046, "question_id": 41789354, "link": "https://stackoverflow.com/questions/41789354/polymorphic-result-type-gadt-function/41790046#41790046", "title": "Polymorphic result type GADT function", "body": "<p>This requires dependent types - there is no way around it. In Idris, a Haskell-like dependently typed language you can write this just fine:</p>\n\n<pre><code>data D : Bool -&gt; Type where\n  D1 : D True\n  D2 : D False\n\n-- The `{ .. }` mean the argument is inferred.\nx : {a : Bool} -&gt; D a\nx {a = True} = D1\nx {a = False} = D2\n</code></pre>\n\n<p>In Haskell, the only way you can dispatch based on type at runtime is through type classes, so you need a constraint. In fact, as @Andr\u00e1s points out there is <a href=\"http://hackage.haskell.org/package/singletons-2.2/docs/Data-Singletons.html#t:SingI\" rel=\"nofollow noreferrer\"><code>SingI</code></a> that is made for this (it comes from a package <a href=\"http://hackage.haskell.org/package/singletons\" rel=\"nofollow noreferrer\"><code>singletons</code></a> which deals exactly with this sort of problem).</p>\n\n<p>In your case, that would be:</p>\n\n<pre><code>{-# LANGUAGE GADTs, TypeInType, ScopedTypeVariables #-}\n\nimport Data.Singletons.Prelude   \n\ndata D (a :: Bool) where\n  D1 :: D True\n  D2 :: D False\n\nx :: forall a. SingI a =&gt; D a\nx = case sing :: Sing a of\n      STrue -&gt; D1\n      SFalse -&gt; D2\n</code></pre>\n\n<p>It might be worth mentioning that although there is a <code>SingI</code> constraint, it has all of the appropriate instances already defined with it. Anything else that is a valid <code>D</code> type but not with a <code>Bool</code> argument (like <code>D Any</code>) fails at compile time (there is simply no <code>SingI</code> instance found).</p>\n\n<pre><code>ghci&gt; let _ = x :: D True\nghci&gt; let _ = x :: D False\nghci&gt; let _ = x :: D Any\n&lt;interactive&gt; error:\n  \u2022 No instance for (SingI Any) arising from a use of \u2018x\u2019\n  \u2022 In the expression: x :: D Any\n    In a pattern binding: _ = x :: D Any\n</code></pre>\n"}], "owner": {"reputation": 20310, "user_id": 525980, "user_type": "registered", "accept_rate": 48, "profile_image": "https://www.gravatar.com/avatar/8dafe66793ee2f32192e9fcefb389a12?s=128&d=identicon&r=PG", "display_name": "Clinton", "link": "https://stackoverflow.com/users/525980/clinton"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 143, "favorite_count": 0, "answer_count": 1, "score": 3, "last_activity_date": 1485104448, "creation_date": 1485077779, "last_edit_date": 1485086126, "question_id": 41789354, "link": "https://stackoverflow.com/questions/41789354/polymorphic-result-type-gadt-function", "title": "Polymorphic result type GADT function", "body": "<p>In the following code, what can I replace <code>x = ...</code>. Note that I don't want to put a class restriction on <code>a</code> (of course, <code>a</code> is of kind <code>Bool</code> already anyway so can only take one of two types).</p>\n\n<pre><code>{-# LANGUAGE GADTs #-}\n{-# LANGUAGE DataKinds #-}\n{-# LANGUAGE KindSignatures #-}\n\ndata D (a :: Bool) where\n  D1 :: D True\n  D2 :: D False\n\nx :: D a\nx = ...\n</code></pre>\n\n<p>Basically, with GADTs like this it's easy to do polymorphism on the input (just match on the appropriate constructors) but I want to use polymorphism in the output.</p>\n"}, {"tags": ["haskell"], "comments": [{"owner": {"reputation": 29444, "user_id": 3072788, "user_type": "registered", "accept_rate": 82, "profile_image": "https://www.gravatar.com/avatar/220a45c2fcff7e7358d144551b116205?s=128&d=identicon&r=PG&f=1", "display_name": "Alec", "link": "https://stackoverflow.com/users/3072788/alec"}, "edited": false, "score": 0, "creation_date": 1485075688, "post_id": 41789041, "comment_id": 70767281, "body": "Are these homework questions?"}, {"owner": {"reputation": 151, "user_id": 5293973, "user_type": "registered", "accept_rate": 0, "profile_image": "https://www.gravatar.com/avatar/f1eaae0559197cfe5639f6a3879d6d27?s=128&d=identicon&r=PG&f=1", "display_name": "Atir", "link": "https://stackoverflow.com/users/5293973/atir"}, "reply_to_user": {"reputation": 29444, "user_id": 3072788, "user_type": "registered", "accept_rate": 82, "profile_image": "https://www.gravatar.com/avatar/220a45c2fcff7e7358d144551b116205?s=128&d=identicon&r=PG&f=1", "display_name": "Alec", "link": "https://stackoverflow.com/users/3072788/alec"}, "edited": false, "score": 0, "creation_date": 1485077743, "post_id": 41789041, "comment_id": 70767714, "body": "The questions came about while trying to do Homework 1 of the cis194 course, but they are actually general questions&#39; regarding Haskell and CodeWorld - API"}], "answers": [{"comments": [{"owner": {"reputation": 151, "user_id": 5293973, "user_type": "registered", "accept_rate": 0, "profile_image": "https://www.gravatar.com/avatar/f1eaae0559197cfe5639f6a3879d6d27?s=128&d=identicon&r=PG&f=1", "display_name": "Atir", "link": "https://stackoverflow.com/users/5293973/atir"}, "edited": false, "score": 0, "creation_date": 1485087010, "post_id": 41790553, "comment_id": 70770079, "body": "Thank you for your answer,however, you missed answering my two questions or I did not understand them. My Questions referred to the &quot;trafficController&quot; and its usage as input to the animation function. The &quot;trafficController&quot; function which by its definition should receive an input parameter (t) while in its actual usage receive none, and still all the code works perfectly"}, {"owner": {"reputation": 29209, "user_id": 495796, "user_type": "registered", "accept_rate": 79, "profile_image": "https://www.gravatar.com/avatar/86637c99f25d60157aa0f2e7eab90148?s=128&d=identicon&r=PG", "display_name": "Robin Green", "link": "https://stackoverflow.com/users/495796/robin-green"}, "edited": false, "score": 0, "creation_date": 1485089601, "post_id": 41790553, "comment_id": 70770820, "body": "It does receive an input parameter. It is passed to <code>animationOf</code> as a function. You can see more clearly what is going on by doing eta expansion: <code>animationOf trafficController</code> means the same as <code>animationOf (\\x -&gt; trafficController x)</code>, by eta expansion."}, {"owner": {"reputation": 153048, "user_id": 9204, "user_type": "registered", "accept_rate": 82, "profile_image": "https://www.gravatar.com/avatar/c79937a093ff9e963c563e22cd385f30?s=128&d=identicon&r=PG", "display_name": "Alexey Romanov", "link": "https://stackoverflow.com/users/9204/alexey-romanov"}, "reply_to_user": {"reputation": 151, "user_id": 5293973, "user_type": "registered", "accept_rate": 0, "profile_image": "https://www.gravatar.com/avatar/f1eaae0559197cfe5639f6a3879d6d27?s=128&d=identicon&r=PG&f=1", "display_name": "Atir", "link": "https://stackoverflow.com/users/5293973/atir"}, "edited": false, "score": 0, "creation_date": 1485099915, "post_id": 41790553, "comment_id": 70773968, "body": "@Atir I&#39;ve extended the answers. Hopefully it&#39;s more clear now. Note that 1. is the answer to your first question, and 2. to the second one."}], "tags": [], "owner": {"reputation": 153048, "user_id": 9204, "user_type": "registered", "accept_rate": 82, "profile_image": "https://www.gravatar.com/avatar/c79937a093ff9e963c563e22cd385f30?s=128&d=identicon&r=PG", "display_name": "Alexey Romanov", "link": "https://stackoverflow.com/users/9204/alexey-romanov"}, "is_accepted": false, "score": 1, "last_activity_date": 1485099822, "last_edit_date": 1485099822, "creation_date": 1485085999, "answer_id": 41790553, "question_id": 41789041, "link": "https://stackoverflow.com/questions/41789041/cis-upenn-edu-cis194-haskell-basics-functions-and-pictures/41790553#41790553", "title": "cis.upenn.edu cis194 Haskell Basics: Functions and Pictures", "body": "<ol>\n<li><p><code>animationOf</code>'s type is <a href=\"https://hackage.haskell.org/package/codeworld-api-0.2.0.0/docs/CodeWorld.html\" rel=\"nofollow noreferrer\"><code>(Double -&gt; Picture) -&gt; IO ()</code></a>. This means its argument has to have type <code>Double -&gt; Picture</code>, i.e. it must be a function from <code>Double</code> to <code>Picture</code>. <code>trafficController</code> is a function with precisely this type. Note that <code>trafficController t</code> (for some <code>Double</code> <code>t</code>) isn't: it's a <code>Picture</code>!</p></li>\n<li><p>The definition of <code>animationOf</code>, which you can find <a href=\"https://hackage.haskell.org/package/codeworld-api-0.2.0.0/docs/src/CodeWorld-Driver.html\" rel=\"nofollow noreferrer\">here</a>. If you look into what it does with its argument, and then the functions it calls, etc., it ultimately calls its parameter (<code>trafficController</code> in this case) with different <code>t</code> repeatedly. However, it requires tracing a few steps, and I wouldn't recommend it at this stage.</p></li>\n</ol>\n"}], "owner": {"reputation": 151, "user_id": 5293973, "user_type": "registered", "accept_rate": 0, "profile_image": "https://www.gravatar.com/avatar/f1eaae0559197cfe5639f6a3879d6d27?s=128&d=identicon&r=PG&f=1", "display_name": "Atir", "link": "https://stackoverflow.com/users/5293973/atir"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 113, "favorite_count": 0, "answer_count": 1, "score": 1, "last_activity_date": 1485099822, "creation_date": 1485075219, "last_edit_date": 1485075316, "question_id": 41789041, "link": "https://stackoverflow.com/questions/41789041/cis-upenn-edu-cis194-haskell-basics-functions-and-pictures", "title": "cis.upenn.edu cis194 Haskell Basics: Functions and Pictures", "body": "<h3>Animations</h3>\n\n<p>Now the traffic light is green, but we want it to switch to red every now and then. The CodeWorld API not only allows us to draw drawings, but also to run animations. What is an animation? It is a picture that changes over time, where time can conveniently be understood as the number of seconds since the start of the animation.</p>\n\n<p>In imperative language, one would probably have a <code>getCurrentTime()</code> function and call that from somewhere in our drawing generating. This is not possible nor desirable in a pure functional language, as it would be a hidden side effect. Instead, the time is provided as a parameter.</p>\n\n<p>So here this codes makes the traffic light switch every three seconds:</p>\n\n<pre><code>trafficController :: Double -&gt; Picture\ntrafficController t\n  | round (t/3) `mod` 2 == 0 = trafficLight True\n  | otherwise                = trafficLight False\n\nmain :: IO ()\nmain = animationOf trafficController\n</code></pre>\n\n<h3>Questions:</h3>\n\n<ol>\n<li>How can the function <code>trafficController</code> work without the <code>t</code> input in the <code>main</code> statement if it is defined (above) to work with time parameter?</li>\n<li>What makes the <code>t</code> parameter increment all the time ?</li>\n</ol>\n"}, {"tags": ["scala", "haskell", "lazy-evaluation", "evaluation"], "answers": [{"comments": [{"owner": {"reputation": 40406, "user_id": 336527, "user_type": "registered", "accept_rate": 86, "profile_image": "https://www.gravatar.com/avatar/4a57f523157ebdf6e5a9662d2e8754b9?s=128&d=identicon&r=PG", "display_name": "max", "link": "https://stackoverflow.com/users/336527/max"}, "edited": false, "score": 0, "creation_date": 1485046187, "post_id": 41786178, "comment_id": 70762212, "body": "Apart from caching, aren&#39;t <i>call by name</i> and <i>call by need</i> equivalent?"}, {"owner": {"reputation": 29444, "user_id": 3072788, "user_type": "registered", "accept_rate": 82, "profile_image": "https://www.gravatar.com/avatar/220a45c2fcff7e7358d144551b116205?s=128&d=identicon&r=PG&f=1", "display_name": "Alec", "link": "https://stackoverflow.com/users/3072788/alec"}, "reply_to_user": {"reputation": 40406, "user_id": 336527, "user_type": "registered", "accept_rate": 86, "profile_image": "https://www.gravatar.com/avatar/4a57f523157ebdf6e5a9662d2e8754b9?s=128&d=identicon&r=PG", "display_name": "max", "link": "https://stackoverflow.com/users/336527/max"}, "edited": false, "score": 0, "creation_date": 1485046366, "post_id": 41786178, "comment_id": 70762243, "body": "@max Sort of... Minus the fact that call-name in Scala is only supported at call site as opposed lazy is supported at definition site only"}, {"owner": {"reputation": 40406, "user_id": 336527, "user_type": "registered", "accept_rate": 86, "profile_image": "https://www.gravatar.com/avatar/4a57f523157ebdf6e5a9662d2e8754b9?s=128&d=identicon&r=PG", "display_name": "max", "link": "https://stackoverflow.com/users/336527/max"}, "edited": false, "score": 0, "creation_date": 1485046957, "post_id": 41786178, "comment_id": 70762337, "body": "Also, quoting @user7337271 answer: <code>in Haskell side effects are explicit. Scala is much more pragmatic and there is no explicit way to model side effects</code>; is this the main reason Scala chose its default evaluation to be call-by-name rather than call-by-need (given that functions with side effects cannot be memoized)? Or was it also due to space or other considerations?"}, {"owner": {"reputation": 57219, "user_id": 33796, "user_type": "registered", "accept_rate": 70, "profile_image": "https://www.gravatar.com/avatar/08727b23ba62e634b32988cdff082663?s=128&d=identicon&r=PG", "display_name": "luqui", "link": "https://stackoverflow.com/users/33796/luqui"}, "reply_to_user": {"reputation": 40406, "user_id": 336527, "user_type": "registered", "accept_rate": 86, "profile_image": "https://www.gravatar.com/avatar/4a57f523157ebdf6e5a9662d2e8754b9?s=128&d=identicon&r=PG", "display_name": "max", "link": "https://stackoverflow.com/users/336527/max"}, "edited": false, "score": 0, "creation_date": 1485047130, "post_id": 41786178, "comment_id": 70762366, "body": "@max, well, in a language with side-effects, you might not want caching.  For example if you&#39;re writing a function which is supposed to evaluate its argument multiple times, e.g. some kind of looping function.  If the function wants to cache it it always can explicitly, whereas you can&#39;t go the other way around. Call-by-name is thereby more expressive.  In Haskell this is not done because functions do not have side-effects, so there is no difference in expressiveness and you might as well cache to save work."}, {"owner": {"reputation": 29444, "user_id": 3072788, "user_type": "registered", "accept_rate": 82, "profile_image": "https://www.gravatar.com/avatar/220a45c2fcff7e7358d144551b116205?s=128&d=identicon&r=PG&f=1", "display_name": "Alec", "link": "https://stackoverflow.com/users/3072788/alec"}, "reply_to_user": {"reputation": 40406, "user_id": 336527, "user_type": "registered", "accept_rate": 86, "profile_image": "https://www.gravatar.com/avatar/4a57f523157ebdf6e5a9662d2e8754b9?s=128&d=identicon&r=PG", "display_name": "max", "link": "https://stackoverflow.com/users/336527/max"}, "edited": false, "score": 0, "creation_date": 1485047218, "post_id": 41786178, "comment_id": 70762386, "body": "@max Scala chose its default evaluation to be call-by-value, not call-by-name. In general, call-by-value is easier to reason about when you have side-effects. Since Scala wanted to interop with Java, side-effects are sort of necessary."}, {"owner": {"reputation": 29444, "user_id": 3072788, "user_type": "registered", "accept_rate": 82, "profile_image": "https://www.gravatar.com/avatar/220a45c2fcff7e7358d144551b116205?s=128&d=identicon&r=PG&f=1", "display_name": "Alec", "link": "https://stackoverflow.com/users/3072788/alec"}, "reply_to_user": {"reputation": 57219, "user_id": 33796, "user_type": "registered", "accept_rate": 70, "profile_image": "https://www.gravatar.com/avatar/08727b23ba62e634b32988cdff082663?s=128&d=identicon&r=PG", "display_name": "luqui", "link": "https://stackoverflow.com/users/33796/luqui"}, "edited": false, "score": 0, "creation_date": 1485047321, "post_id": 41786178, "comment_id": 70762404, "body": "@luqui Yes. Very important catch there. And in the 5 minute window. :)"}, {"owner": {"reputation": 8861, "user_id": 561382, "user_type": "registered", "accept_rate": 62, "profile_image": "https://i.stack.imgur.com/FC1BR.jpg?s=128&g=1", "display_name": "Victor Moroz", "link": "https://stackoverflow.com/users/561382/victor-moroz"}, "edited": false, "score": 0, "creation_date": 1485048169, "post_id": 41786178, "comment_id": 70762551, "body": "If you advocating against <code>lazy</code> objects, you should advocate against call-by-name too. It creates at least one extra object (a function). In many cases readability is much more important than GC troubles or a few extra cycles."}, {"owner": {"reputation": 29444, "user_id": 3072788, "user_type": "registered", "accept_rate": 82, "profile_image": "https://www.gravatar.com/avatar/220a45c2fcff7e7358d144551b116205?s=128&d=identicon&r=PG&f=1", "display_name": "Alec", "link": "https://stackoverflow.com/users/3072788/alec"}, "reply_to_user": {"reputation": 8861, "user_id": 561382, "user_type": "registered", "accept_rate": 62, "profile_image": "https://i.stack.imgur.com/FC1BR.jpg?s=128&g=1", "display_name": "Victor Moroz", "link": "https://stackoverflow.com/users/561382/victor-moroz"}, "edited": false, "score": 0, "creation_date": 1485048320, "post_id": 41786178, "comment_id": 70762569, "body": "@VictorMoroz Yeah, but call by name is per call, unlike lazy evaluation. It makes is much easier to debug. And both cause GC trouble."}, {"owner": {"reputation": 40406, "user_id": 336527, "user_type": "registered", "accept_rate": 86, "profile_image": "https://www.gravatar.com/avatar/4a57f523157ebdf6e5a9662d2e8754b9?s=128&d=identicon&r=PG", "display_name": "max", "link": "https://stackoverflow.com/users/336527/max"}, "edited": false, "score": 0, "creation_date": 1485055294, "post_id": 41786178, "comment_id": 70763701, "body": "To add to your cons for lazy evaluation, wouldn&#39;t space be one of them? I mean, in a silly example, if you evaluate <code>a * n</code> using a recursive function <code>f(a, n) = f(a, n-1) * a if n &gt; 0 else 1</code> (pseudocode), then lazy evaluation would require <code>O(n)</code> space while either call-by-value or call-by-name would only need O(1) space. I know this precise example should be taken care of by TCO, but I imagine sometimes TCO won&#39;t be able to optimize this extra space usage away?"}, {"owner": {"reputation": 29444, "user_id": 3072788, "user_type": "registered", "accept_rate": 82, "profile_image": "https://www.gravatar.com/avatar/220a45c2fcff7e7358d144551b116205?s=128&d=identicon&r=PG&f=1", "display_name": "Alec", "link": "https://stackoverflow.com/users/3072788/alec"}, "reply_to_user": {"reputation": 40406, "user_id": 336527, "user_type": "registered", "accept_rate": 86, "profile_image": "https://www.gravatar.com/avatar/4a57f523157ebdf6e5a9662d2e8754b9?s=128&d=identicon&r=PG", "display_name": "max", "link": "https://stackoverflow.com/users/336527/max"}, "edited": false, "score": 0, "creation_date": 1485055649, "post_id": 41786178, "comment_id": 70763752, "body": "@max Fair enough. Yes, these things are a big (if not too frequent) problem in Haskell. They are called space leaks."}, {"owner": {"reputation": 2019, "user_id": 5800895, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/0cab3b0361b7e54267c70c02754f21de?s=128&d=identicon&r=PG&f=1", "display_name": "Derek Elkins left SE", "link": "https://stackoverflow.com/users/5800895/derek-elkins-left-se"}, "edited": false, "score": 0, "creation_date": 1485063812, "post_id": 41786178, "comment_id": 70765117, "body": "While laziness is the cause of the stack overflow in some uses of <code>foldl</code>, laziness is also the reason some uses of <code>foldr</code> <i>don&#39;t</i> stack overflow.  You can say eagerness is the cause of the stack overflow in <code>foldr</code> (in an eager language)."}, {"owner": {"reputation": 100185, "user_id": 3234959, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/93bb12ca0f93dfddb33880316f7e66c2?s=128&d=identicon&r=PG&f=1", "display_name": "chi", "link": "https://stackoverflow.com/users/3234959/chi"}, "edited": false, "score": 0, "creation_date": 1485076438, "post_id": 41786178, "comment_id": 70767438, "body": "AFAICS, call-by-name in Algol60 allowed more than what Scala does, e.g. <a href=\"https://en.wikipedia.org/wiki/Jensen&#39;s_Device\" rel=\"nofollow noreferrer\">Jensen&#39;s device</a>. Thanks to the substitution-based semantics, a call like <code>f(i,a(i))</code> behaves in a subtle way when <code>f</code> assigns to <code>i</code>: when that happens <code>a(i)</code> changes according to the new value of <code>i</code>. Essentially, this is more than by-reference. Scala does not allow to assign to <code>i</code> (unless you wrap it in some object, I guess, and pass its reference instead)."}, {"owner": {"reputation": 29444, "user_id": 3072788, "user_type": "registered", "accept_rate": 82, "profile_image": "https://www.gravatar.com/avatar/220a45c2fcff7e7358d144551b116205?s=128&d=identicon&r=PG&f=1", "display_name": "Alec", "link": "https://stackoverflow.com/users/3072788/alec"}, "reply_to_user": {"reputation": 100185, "user_id": 3234959, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/93bb12ca0f93dfddb33880316f7e66c2?s=128&d=identicon&r=PG&f=1", "display_name": "chi", "link": "https://stackoverflow.com/users/3234959/chi"}, "edited": false, "score": 0, "creation_date": 1485076732, "post_id": 41786178, "comment_id": 70767505, "body": "@chi Neat, and frightening to think about debugging! IIRC, the choice to have call by name be the default strategy in ALGOL60 was controversial - there is some evidence and finger pointing (something about a certain more influential member making this choice without consulting the committee)."}], "tags": [], "owner": {"reputation": 29444, "user_id": 3072788, "user_type": "registered", "accept_rate": 82, "profile_image": "https://www.gravatar.com/avatar/220a45c2fcff7e7358d144551b116205?s=128&d=identicon&r=PG&f=1", "display_name": "Alec", "link": "https://stackoverflow.com/users/3072788/alec"}, "is_accepted": true, "score": 13, "last_activity_date": 1485056025, "last_edit_date": 1485056025, "creation_date": 1485045924, "answer_id": 41786178, "question_id": 41785985, "link": "https://stackoverflow.com/questions/41785985/call-by-name-in-scala-vs-lazy-evaluation-in-haskell/41786178#41786178", "title": "Call-by-name in Scala vs lazy evaluation in Haskell?", "body": "<p>There is some breadth in the names given to the evaluation strategies, but they come down to roughly this:</p>\n\n<ul>\n<li><p><strong>call by name</strong> an argument is pretty much just substituted into the function body in whatever (unevaluated) form it was in when the function was called. That means it may need to be evaluated multiple times in the body.</p>\n\n<p>In Scala, you write this as:</p>\n\n<pre><code>scala&gt; def f(x:=&gt; Int): Int = x + x\nscala&gt; f({ println(\"evaluated\"); 1 })\nevaluated\nevaluated\n2\n</code></pre>\n\n<p>In Haskell you have no built in way of doing this, but you could always represent call-by-name values as functions of type <code>() -&gt; a</code>. This is a bit more blurry though, because of referential transparency - you won't be able to test this out the way you would with Scala (and the compiler might optimize away the \"by name\" part of your call).</p></li>\n<li><p><strong>call by need</strong> (lazy... sort of) an argument is not evaluated when the function is called, but on the first time is is needed. At that moment, it is also cached. Afterwards, whenever the argument is needed again, the cached value is looked up.</p>\n\n<p>In Scala, you don't declare your function arguments to be lazy, you make a declaration lazy:</p>\n\n<pre><code>scala&gt; lazy x: Int = { println(\"evaluated\"); 1 }\nscala&gt; x + x\nevaluated\n2\n</code></pre>\n\n<p>In Haskell this is how all functions work by default.</p></li>\n<li><p><strong>call by value</strong> (eager, what almost every language does) arguments are evaluated when the function is called, even if the function doesn't end up using those arguments.</p>\n\n<p>In Scala this is how functions work by default.</p>\n\n<pre><code>scala&gt; def f(x: Int): Int = x + x\nscala&gt; f({ println(\"evaluated\"); 1 })\nevaluated\n2\n</code></pre>\n\n<p>In Haskell, you can force this behaviour with bang patterns on function arguments:</p>\n\n<pre><code>ghci&gt; :{\nghci&gt; f :: Int -&gt; Int\nghci&gt; f !x = x\nghci&gt; :}\n</code></pre></li>\n</ul>\n\n<h1>So if call by need (lazy) does as much or less evaluation (as either of the other strategies), why use anything else?</h1>\n\n<p>Lazy evaluation is tough to reason about unless you have referential transparency, because then you need to figure out exactly <em>when</em> your lazy value was evaluated. Since Scala is built to interoperate with Java, it needs to support imperative, side-effectful programming. As a consequence, it is in many cases <em>not</em> a good idea to use <code>lazy</code> in Scala.</p>\n\n<p>Furthermore, <code>lazy</code> has a performance overhead: you need to have an extra indirection to check if the value has been already evaluated or not. In Scala, that translates to a bunch more objects, which puts an even greater strain on the garbage collector.</p>\n\n<p>Finally, there are cases where having lazy evaluation leaves \"space\" leaks. For example, in Haskell, folding a large list of numbers from the right by adding them together is a bad idea because Haskell will build up this gigantic series of lazy calls to <code>(+)</code> before evaluating them (when in reality you just need it to have an accumulator. A famous example of space issues you get even in simple contexts is <a href=\"https://wiki.haskell.org/Foldr_Foldl_Foldl&#39;\"><code>foldr</code> vs <code>foldl</code> vs <code>foldl'</code></a>.</p>\n"}, {"comments": [{"owner": {"reputation": 29444, "user_id": 3072788, "user_type": "registered", "accept_rate": 82, "profile_image": "https://www.gravatar.com/avatar/220a45c2fcff7e7358d144551b116205?s=128&d=identicon&r=PG&f=1", "display_name": "Alec", "link": "https://stackoverflow.com/users/3072788/alec"}, "edited": false, "score": 0, "creation_date": 1485047135, "post_id": 41786284, "comment_id": 70762367, "body": "But Scala <i>does</i> have lazy evaluation... And IIRC it does under the hood something similar. And it <i>does</i> cause massive headaches and GC."}, {"owner": {"reputation": 8861, "user_id": 561382, "user_type": "registered", "accept_rate": 62, "profile_image": "https://i.stack.imgur.com/FC1BR.jpg?s=128&g=1", "display_name": "Victor Moroz", "link": "https://stackoverflow.com/users/561382/victor-moroz"}, "reply_to_user": {"reputation": 29444, "user_id": 3072788, "user_type": "registered", "accept_rate": 82, "profile_image": "https://www.gravatar.com/avatar/220a45c2fcff7e7358d144551b116205?s=128&d=identicon&r=PG&f=1", "display_name": "Alec", "link": "https://stackoverflow.com/users/3072788/alec"}, "edited": false, "score": 0, "creation_date": 1485047995, "post_id": 41786284, "comment_id": 70762512, "body": "@Alec Scala doesn&#39;t have <i>combinable</i> lazy evaluation like Haskell. So I would consider original leftaroundabout statement true (no &quot;proper&quot; lazy evaluation). Simple wrapper is not enough to be considered &quot;proper&quot; in Haskell sense."}, {"owner": {"reputation": 29444, "user_id": 3072788, "user_type": "registered", "accept_rate": 82, "profile_image": "https://www.gravatar.com/avatar/220a45c2fcff7e7358d144551b116205?s=128&d=identicon&r=PG&f=1", "display_name": "Alec", "link": "https://stackoverflow.com/users/3072788/alec"}, "reply_to_user": {"reputation": 8861, "user_id": 561382, "user_type": "registered", "accept_rate": 62, "profile_image": "https://i.stack.imgur.com/FC1BR.jpg?s=128&g=1", "display_name": "Victor Moroz", "link": "https://stackoverflow.com/users/561382/victor-moroz"}, "edited": false, "score": 0, "creation_date": 1485048122, "post_id": 41786284, "comment_id": 70762543, "body": "@VictorMoroz Interesting. What is &quot;combinable&quot; lazy evaluation?"}, {"owner": {"reputation": 8861, "user_id": 561382, "user_type": "registered", "accept_rate": 62, "profile_image": "https://i.stack.imgur.com/FC1BR.jpg?s=128&g=1", "display_name": "Victor Moroz", "link": "https://stackoverflow.com/users/561382/victor-moroz"}, "reply_to_user": {"reputation": 29444, "user_id": 3072788, "user_type": "registered", "accept_rate": 82, "profile_image": "https://www.gravatar.com/avatar/220a45c2fcff7e7358d144551b116205?s=128&d=identicon&r=PG&f=1", "display_name": "Alec", "link": "https://stackoverflow.com/users/3072788/alec"}, "edited": false, "score": 0, "creation_date": 1485048956, "post_id": 41786284, "comment_id": 70762692, "body": "@Alec In Scala <code>lazy val x = 1; f(x + x)</code> will evaluate <code>x</code> when calling <code>f</code> (unless <code>f</code> takes call-by-name parameters), in Haskell it will create a promise (thunk) to compute <code>f(x + x)</code> which is lazy too. It will be evaluated when you force it, resulting in &quot;unwinding&quot; a chain of thunks. You can try to create a chain of <code>lazy</code> declarations in Scala, but it&#39;s not very convenient."}, {"owner": {"reputation": 100892, "user_id": 745903, "user_type": "registered", "accept_rate": 74, "profile_image": "https://www.gravatar.com/avatar/50933f6638836741e620669b3940410e?s=128&d=identicon&r=PG", "display_name": "leftaroundabout", "link": "https://stackoverflow.com/users/745903/leftaroundabout"}, "reply_to_user": {"reputation": 8861, "user_id": 561382, "user_type": "registered", "accept_rate": 62, "profile_image": "https://i.stack.imgur.com/FC1BR.jpg?s=128&g=1", "display_name": "Victor Moroz", "link": "https://stackoverflow.com/users/561382/victor-moroz"}, "edited": false, "score": 1, "creation_date": 1485049179, "post_id": 41786284, "comment_id": 70762731, "body": "@VictorMoroz: I don&#39;t know enough about Scala to be sure, but \u2013 wouldn&#39;t wrapping <i>everything</i> in <code>lazy</code> give essentially the same, \u201ccombinable laziness\u201d semantics as we have in Haskell (modulo a heck lot of overhead and unsafety)?"}, {"owner": {"reputation": 8861, "user_id": 561382, "user_type": "registered", "accept_rate": 62, "profile_image": "https://i.stack.imgur.com/FC1BR.jpg?s=128&g=1", "display_name": "Victor Moroz", "link": "https://stackoverflow.com/users/561382/victor-moroz"}, "edited": false, "score": 0, "creation_date": 1485050032, "post_id": 41786284, "comment_id": 70762875, "body": "Also I would need to use only call-by-name parameters in methods, no functions (function parameters don&#39;t have call-by-name equivalent AFAIK), no libraries. I guess it&#39;s about the same as making Haskell strict."}], "tags": [], "owner": {"reputation": 100892, "user_id": 745903, "user_type": "registered", "accept_rate": 74, "profile_image": "https://www.gravatar.com/avatar/50933f6638836741e620669b3940410e?s=128&d=identicon&r=PG", "display_name": "leftaroundabout", "link": "https://stackoverflow.com/users/745903/leftaroundabout"}, "is_accepted": false, "score": 4, "last_activity_date": 1485047804, "last_edit_date": 1495540888, "creation_date": 1485047060, "answer_id": 41786284, "question_id": 41785985, "link": "https://stackoverflow.com/questions/41785985/call-by-name-in-scala-vs-lazy-evaluation-in-haskell/41786284#41786284", "title": "Call-by-name in Scala vs lazy evaluation in Haskell?", "body": "<p>I don't know why Scala <del>doesn't have</del><sup>Turns out it <em>does</em></sup> \u201cproper\u201d lazy evaluation \u2013 likely it's just not so simple to implement, especially when you want the language to interact smoothly with the JVM.</p>\n\n<p>Call-by-name is (as you've observed) not equivalent to lazy evaluation, but to replacing an argument of type <code>a</code> with an argument of type <code>() -&gt; a</code>. Such a function contains the same amount of information as a plain <code>a</code> value (the types are isomorphic), but to actually get at that value you always need to apply the function to the <code>()</code> dummy argument. When you evaluate the function twice, you'll get <a href=\"https://en.wikipedia.org/wiki/Referential_transparency\" rel=\"nofollow noreferrer\">twice the same result</a>, but it must each time be calculated anew (since <a href=\"https://stackoverflow.com/questions/5749039/automatic-memoizing-in-functional-programming-languages\">automatically memoising functions is not feasible</a>).</p>\n\n<p>Lazy evaluation is equivalent to replacing an argument of type <code>a</code> with an argument of a type that behaves like the following OO class:</p>\n\n<pre><code>class Lazy&lt;A&gt; {\n  function&lt;A()&gt; computer;\n  option&lt;A&gt; containedValue;\n public:\n  Lazy(function&lt;A()&gt; computer):\n       computer = computer\n     , containerValue = Nothing\n     {}\n  A operator()() {\n    if isNothing(containedValue) {\n      containedValue = Just(computer());\n    }\n    return fromJust(containedValue);\n  }\n}\n</code></pre>\n\n<p>This is essentially just a memoisation-wrapper around the specific call-by-name\u2013function type. What's not so nice is that this wrapper relies in a fundamental way on side-effects: when the lazy value is first evaluated, you must mutate the <code>containedValue</code> to represent the fact that the value is now known. Haskell has this mechanism hard-baked at the heart of its runtime, well-tested for thread-safety etc.. But in a language that tries to use an imperative VM as openly as possible, it would probably cause massive headaches if these spurious mutations were interleaved with the explicit side-effects. Especially, because the really interesting applications of lazyness don't just have a single function argument lazy (that wouldn't buy you much) but scatter lazy values all through the spine of a deep data structure. In the end, it's not just one delay-function that you evaluate later than entering the lazy function, it's a whole <em>torrent</em> of nested calls to such functions (indeed, possibly infinitely many!) as the lazy data structure is consumed.</p>\n\n<p>So, Scala avoids the dangers of this by not making anything lazy by default, though as Alec says it does offer a <code>lazy</code> keyword that basically adds a memoised-function wrapper like the above to a value.</p>\n"}, {"tags": [], "owner": {"reputation": 153048, "user_id": 9204, "user_type": "registered", "accept_rate": 82, "profile_image": "https://www.gravatar.com/avatar/c79937a093ff9e963c563e22cd385f30?s=128&d=identicon&r=PG", "display_name": "Alexey Romanov", "link": "https://stackoverflow.com/users/9204/alexey-romanov"}, "is_accepted": false, "score": 3, "last_activity_date": 1485072129, "creation_date": 1485072129, "answer_id": 41788654, "question_id": 41785985, "link": "https://stackoverflow.com/questions/41785985/call-by-name-in-scala-vs-lazy-evaluation-in-haskell/41788654#41788654", "title": "Call-by-name in Scala vs lazy evaluation in Haskell?", "body": "<p>This may be useful and doesn't really fit in a comment.</p>\n\n<p>You can write a function in Scala which behaves like Haskell's call-by-need (for arguments) by making the arguments call-by-name and evaluating them lazily at the start of the function:</p>\n\n<pre><code>def foo(x: =&gt; Int) = {\n  lazy val _x = x\n  // make sure you only use _x below, not x\n}\n</code></pre>\n"}], "owner": {"reputation": 40406, "user_id": 336527, "user_type": "registered", "accept_rate": 86, "profile_image": "https://www.gravatar.com/avatar/4a57f523157ebdf6e5a9662d2e8754b9?s=128&d=identicon&r=PG", "display_name": "max", "link": "https://stackoverflow.com/users/336527/max"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 1324, "favorite_count": 1, "accepted_answer_id": 41786178, "answer_count": 3, "score": 11, "last_activity_date": 1485072129, "creation_date": 1485044059, "last_edit_date": 1495541342, "question_id": 41785985, "link": "https://stackoverflow.com/questions/41785985/call-by-name-in-scala-vs-lazy-evaluation-in-haskell", "title": "Call-by-name in Scala vs lazy evaluation in Haskell?", "body": "<p>Haskell's lazy evaluation <a href=\"https://en.wikibooks.org/wiki/Haskell/Graph_reduction#Lazy_eval_.3C_Eager_eval\" rel=\"nofollow noreferrer\">will never</a> take more evaluation steps than the eager evaluation.</p>\n\n<p>On the other hand, Scala's call-by-name evaluation <a href=\"https://stackoverflow.com/a/17901633/336527\">may require</a> more evaluation steps than call-by-value (if the short-circuit benefits are more than offset by the cost of repeated calculations).</p>\n\n<p>I thought call-by-name is roughly equivalent to lazy evaluation. Why then such a difference in the time guarantee? </p>\n\n<p>I am guessing that maybe Haskell language specifies that memoization must be used during evaluation; but in that case, why doesn't Scala do the same?</p>\n"}, {"tags": ["haskell", "types"], "answers": [{"comments": [{"owner": {"reputation": 29444, "user_id": 3072788, "user_type": "registered", "accept_rate": 82, "profile_image": "https://www.gravatar.com/avatar/220a45c2fcff7e7358d144551b116205?s=128&d=identicon&r=PG&f=1", "display_name": "Alec", "link": "https://stackoverflow.com/users/3072788/alec"}, "edited": false, "score": 0, "creation_date": 1485038317, "post_id": 41785301, "comment_id": 70760554, "body": "I was about to ask about why the answer was so short. :) Holding my horses!"}, {"owner": {"reputation": 3129, "user_id": 1209187, "user_type": "registered", "accept_rate": 82, "profile_image": "https://www.gravatar.com/avatar/6ecfd8b651b364bb2fa5346dc58f34d6?s=128&d=identicon&r=PG", "display_name": "KenavR", "link": "https://stackoverflow.com/users/1209187/kenavr"}, "edited": false, "score": 0, "creation_date": 1485039493, "post_id": 41785301, "comment_id": 70760814, "body": "Thanks for the great answer. Can I reference the <i>constructors</i> in any way? Is it possible to define a function that returns a <code>Club</code> or should I just use <code>Suit</code> everywhere?"}, {"owner": {"reputation": 57219, "user_id": 33796, "user_type": "registered", "accept_rate": 70, "profile_image": "https://www.gravatar.com/avatar/08727b23ba62e634b32988cdff082663?s=128&d=identicon&r=PG", "display_name": "luqui", "link": "https://stackoverflow.com/users/33796/luqui"}, "edited": false, "score": 0, "creation_date": 1485041499, "post_id": 41785301, "comment_id": 70761247, "body": "You can&#39;t talk about the constructors at the type level (except as I showed in the GADT example, but I wouldn&#39;t worry about that until you&#39;re quite a bit more experienced), just use <code>Suit</code>."}, {"owner": {"reputation": 384463, "user_id": 1126841, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/fa05233b2357f8d11c22ef4cfc7bb85c?s=128&d=identicon&r=PG", "display_name": "chepner", "link": "https://stackoverflow.com/users/1126841/chepner"}, "edited": false, "score": 2, "creation_date": 1485042443, "post_id": 41785301, "comment_id": 70761480, "body": "A function can return a <code>Club</code> in the same way a function can return the number 3 or the string <code>&quot;foo&quot;</code>: for example, <code>f :: Int -&gt; Suit; f 0 = Club; f 1 = Diamond; f 2 = Heart; f 3 = Spade</code>. In a very real sense, defining a new type adds new literals to the language. <code>Suit</code> isn&#39;t just a set of integer-valued variables; it is an entire distinct type with its own constants."}, {"owner": {"reputation": 955, "user_id": 817658, "user_type": "registered", "accept_rate": 84, "profile_image": "https://www.gravatar.com/avatar/9a03bfe9e020bce25a7fac210bdeff84?s=128&d=identicon&r=PG", "display_name": "nclark", "link": "https://stackoverflow.com/users/817658/nclark"}, "edited": false, "score": 1, "creation_date": 1485101254, "post_id": 41785301, "comment_id": 70774381, "body": "Closest thing in imperative languageso is an enum."}], "tags": [], "owner": {"reputation": 57219, "user_id": 33796, "user_type": "registered", "accept_rate": 70, "profile_image": "https://www.gravatar.com/avatar/08727b23ba62e634b32988cdff082663?s=128&d=identicon&r=PG", "display_name": "luqui", "link": "https://stackoverflow.com/users/33796/luqui"}, "is_accepted": true, "score": 5, "last_activity_date": 1485038587, "last_edit_date": 1485038587, "creation_date": 1485038249, "answer_id": 41785301, "question_id": 41785205, "link": "https://stackoverflow.com/questions/41785205/subtypes-with-own-show-and-usable-in-other-module/41785301#41785301", "title": "&quot;SubTypes&quot; with own Show and usable in other Module", "body": "<p>Yes it sounds like you don't really understand the type system.  I will try my best to clarify where I think you are going wrong.  In your example</p>\n\n<pre><code>data Suit = Club | Diamond | Heart | Spade\n</code></pre>\n\n<p>There is only one type, and that is <code>Suit</code>.  <code>Club</code>, <code>Diamond</code>, etc. are not types at all, and you will confuse yourself if you refer to them as \"sub-types\".  The proper name for them is <em>constructors</em>, and they are essentially values of type <code>Suit</code></p>\n\n<pre><code>Club :: Suit\nDiamond :: Suit\n...\n</code></pre>\n\n<p>So you can't really implement a <code>Show</code> instance for \"each one\", you can only implement a <code>Show</code> instance for the whole type <code>Suit</code>, in the usual way, by pattern matching on the constructors:</p>\n\n<pre><code>instance Show Suit where\n    show Club = \"Clubs\"\n    show Diamond = \"Diamonds\"\n    show Heart = \"Heart\"\n    show Spade = \"Spade\"\n</code></pre>\n\n<p>This defines a single function <code>show</code> on the type <code>Suit -&gt; String</code>, again there is no \"sub-type\" anything going on.  I wonder if this was all you were looking for.  </p>\n\n<p>Since you mention datakinds, using the constructors at the type level still does not make them types -- they are still values of type <code>Suit</code>.  An example of using them at the type level is to index a GADT by these:</p>\n\n<pre><code>data Card :: Suit -&gt; * where\n    QueenOfSpades :: Card Spade\n    OtherCard :: Int -&gt; Card s   -- we'd want to encode the suit s at the data\n                                 -- level too using a singleton, out of scope\n                                 -- for this post\n</code></pre>\n\n<p>But this is fairly advanced stuff and probably not what you are looking for.</p>\n\n<p>I hope this clarifies things a little.</p>\n"}], "owner": {"reputation": 3129, "user_id": 1209187, "user_type": "registered", "accept_rate": 82, "profile_image": "https://www.gravatar.com/avatar/6ecfd8b651b364bb2fa5346dc58f34d6?s=128&d=identicon&r=PG", "display_name": "KenavR", "link": "https://stackoverflow.com/users/1209187/kenavr"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 55, "favorite_count": 0, "accepted_answer_id": 41785301, "answer_count": 1, "score": 1, "last_activity_date": 1485038587, "creation_date": 1485037604, "question_id": 41785205, "link": "https://stackoverflow.com/questions/41785205/subtypes-with-own-show-and-usable-in-other-module", "title": "&quot;SubTypes&quot; with own Show and usable in other Module", "body": "<p>I am pretty sure my problem stems from the fact that I am new to Haskell and do not understand the type system completely.</p>\n\n<p>I will use the example used in Haskell's wiki on the type topic</p>\n\n<p>The following Type is defined </p>\n\n<pre><code> data Suit = Club | Diamond | Heart | Spade\n</code></pre>\n\n<p>Now the first issue is, I would like to implement <code>Show</code> for every \"sub-type\" (Club, Diamond, Heart, Spade) but this doesn't seem to work because it is a <code>DataKinds</code>. So I split it up into their own types. (The properties don't make much sense but I added them to be closer to the real code)</p>\n\n<pre><code>data ClubType = ClubType {\n  clubName :: String,\n  icon :: String\n} \ninstance Show ClubType where\n  show (ClubType cn i) = \"name: \" ++ cn ++ \", icon: \" ++ i\n</code></pre>\n\n<p>Using them in the Suit type</p>\n\n<pre><code>data Suit = Club ClubType \n          | Diamond DiamondType \n          | Heart HeartType \n          | Spade SpadeType\n</code></pre>\n\n<p>Now I want to use Suit and the \"Sub-Types\" (Club, Diamond, Heart, Spade) in a different <code>module</code>. I exported just <code>Suit (..)</code>.</p>\n\n<p><strong>Usage</strong></p>\n\n<pre><code>import Module1 (Suit(..))\n\ngetSuit :: String -&gt; Suit\ngetSuit \"Club\" = getClub\ngetSuit \"Heart\" = getHeart\n...\n\ngetClub :: () -&gt; Club\n</code></pre>\n\n<p>Now again <code>Club</code>, <code>Heart</code>, <code>Diamond</code> and <code>Spade</code> cannot be used because they are <code>DataKinds</code>. How do I use the \"sub-types\"? Do I need to export all types? If I do, does it conform with the return type of <code>getSuit</code>?</p>\n\n<p>(Sorry if the example doesn't make a whole lot of sense, but I hope you can follow my desired result)</p>\n\n<p>thanks</p>\n"}, {"tags": ["haskell"], "comments": [{"owner": {"reputation": 29444, "user_id": 3072788, "user_type": "registered", "accept_rate": 82, "profile_image": "https://www.gravatar.com/avatar/220a45c2fcff7e7358d144551b116205?s=128&d=identicon&r=PG&f=1", "display_name": "Alec", "link": "https://stackoverflow.com/users/3072788/alec"}, "edited": false, "score": 1, "creation_date": 1485036679, "post_id": 41785007, "comment_id": 70760141, "body": "Your identation is the only thing that looks wrong. Otherwise, this works for me"}, {"owner": {"reputation": 623, "user_id": 5910215, "user_type": "registered", "accept_rate": 87, "profile_image": "https://www.gravatar.com/avatar/62487068172a6c63ecc4f2e13d4b2a8f?s=128&d=identicon&r=PG&f=1", "display_name": "khaled omar", "link": "https://stackoverflow.com/users/5910215/khaled-omar"}, "reply_to_user": {"reputation": 29444, "user_id": 3072788, "user_type": "registered", "accept_rate": 82, "profile_image": "https://www.gravatar.com/avatar/220a45c2fcff7e7358d144551b116205?s=128&d=identicon&r=PG&f=1", "display_name": "Alec", "link": "https://stackoverflow.com/users/3072788/alec"}, "edited": false, "score": 0, "creation_date": 1485036739, "post_id": 41785007, "comment_id": 70760151, "body": "in which block?"}, {"owner": {"reputation": 29444, "user_id": 3072788, "user_type": "registered", "accept_rate": 82, "profile_image": "https://www.gravatar.com/avatar/220a45c2fcff7e7358d144551b116205?s=128&d=identicon&r=PG&f=1", "display_name": "Alec", "link": "https://stackoverflow.com/users/3072788/alec"}, "edited": false, "score": 0, "creation_date": 1485036954, "post_id": 41785007, "comment_id": 70760214, "body": "I think your <code>let</code> should be on the same line as the <code>=</code>. In your place, however, I would just use a <code>where</code> instead of a <code>let</code>."}, {"owner": {"reputation": 314794, "user_id": 67579, "user_type": "registered", "accept_rate": 81, "profile_image": "https://i.stack.imgur.com/BJXub.png?s=128&g=1", "display_name": "Willem Van Onsem", "link": "https://stackoverflow.com/users/67579/willem-van-onsem"}, "edited": false, "score": 0, "creation_date": 1485037519, "post_id": 41785007, "comment_id": 70760370, "body": "Do you always want to log the steps, or just for now? Otherwise you could use <code>trace</code>."}, {"owner": {"reputation": 623, "user_id": 5910215, "user_type": "registered", "accept_rate": 87, "profile_image": "https://www.gravatar.com/avatar/62487068172a6c63ecc4f2e13d4b2a8f?s=128&d=identicon&r=PG&f=1", "display_name": "khaled omar", "link": "https://stackoverflow.com/users/5910215/khaled-omar"}, "edited": false, "score": 0, "creation_date": 1485037688, "post_id": 41785007, "comment_id": 70760409, "body": "I want always to log the steps"}, {"owner": {"reputation": 57219, "user_id": 33796, "user_type": "registered", "accept_rate": 70, "profile_image": "https://www.gravatar.com/avatar/08727b23ba62e634b32988cdff082663?s=128&d=identicon&r=PG", "display_name": "luqui", "link": "https://stackoverflow.com/users/33796/luqui"}, "edited": false, "score": 0, "creation_date": 1485037881, "post_id": 41785007, "comment_id": 70760448, "body": "Also works for me, after indenting everything after <code>let x = ...</code>.  Yes the type of <code>mapM_ putStrLn $ snd $ runWriter (fixedPoint&#39; cos 1)</code> is <code>IO ()</code> so it will always &quot;return&quot; the empty tuple, but there should be some output, too.  Would you mind posting a transcript of your ghci session or however you run this?"}, {"owner": {"reputation": 623, "user_id": 5910215, "user_type": "registered", "accept_rate": 87, "profile_image": "https://www.gravatar.com/avatar/62487068172a6c63ecc4f2e13d4b2a8f?s=128&d=identicon&r=PG&f=1", "display_name": "khaled omar", "link": "https://stackoverflow.com/users/5910215/khaled-omar"}, "edited": false, "score": 0, "creation_date": 1485038209, "post_id": 41785007, "comment_id": 70760527, "body": "do you mean by session the version of GHC, if yes , I am using Haskell for Mac editor which uses GHC compiler version 7.10.3"}, {"owner": {"reputation": 126897, "user_id": 791604, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/ce991df7a056248d5e4f6fc3659ba733?s=128&d=identicon&r=PG", "display_name": "Daniel Wagner", "link": "https://stackoverflow.com/users/791604/daniel-wagner"}, "edited": false, "score": 0, "creation_date": 1485042779, "post_id": 41785007, "comment_id": 70761562, "body": "Call the function this way instead: <code>let (result, report) = runWriter (fixedPoint&#39; cos 1) in mapM_ putStrLn report &gt;&gt; return result</code>."}], "owner": {"reputation": 623, "user_id": 5910215, "user_type": "registered", "accept_rate": 87, "profile_image": "https://www.gravatar.com/avatar/62487068172a6c63ecc4f2e13d4b2a8f?s=128&d=identicon&r=PG&f=1", "display_name": "khaled omar", "link": "https://stackoverflow.com/users/5910215/khaled-omar"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 65, "favorite_count": 0, "answer_count": 0, "score": 0, "last_activity_date": 1485035925, "creation_date": 1485035925, "question_id": 41785007, "link": "https://stackoverflow.com/questions/41785007/function-with-monad-writer-does-not-return-result", "title": "function with monad writer does not return result", "body": "<p>I was trying to implement <code>fixed point</code> function  as the below </p>\n\n<pre><code>fixedPoint  :: (Fractional a,Ord a ) =&gt; (a  -&gt; a ) -&gt; a -&gt; a \nfixedPoint f initialGuess= let x= f initialGuess\n                       in if (closeEnough initialGuess x) \n                       then x\n                       else fixedPoint f x \n</code></pre>\n\n<p>this function works perfectly when calling it for <code>fixedPoint cos 1</code> and return <code>0.7390851699445544</code> however, I wanted to log the steps done by the function and add it into in string using the writer monad, the adjusted function is as per the below </p>\n\n<pre><code>fixedPoint'  :: (Fractional a,Ord a,Show a) =&gt; (a -&gt; a ) -&gt; a -&gt; Writer [String] a \nfixedPoint' f initialGuess= \nlet x = f initialGuess \nin \nif (closeEnough initialGuess x ) then\n  do\n    tell [\"Ending with\" ++ show initialGuess]\n    return x\nelse\n  do\n    result &lt;- fixedPoint' f x\n    tell [\"Trying Guess\" ++ show initialGuess]\n    return result\n</code></pre>\n\n<p>when calling the function <code>mapM_ putStrLn $ snd $ runWriter (fixedPoint' cos 1)</code> it return the empty tuple</p>\n"}, {"tags": ["haskell", "servant"], "comments": [{"owner": {"reputation": 7714, "user_id": 149901, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/d1a6db7a9fb5385fde6ba426e27d5ac6?s=128&d=identicon&r=PG", "display_name": "ondra", "link": "https://stackoverflow.com/users/149901/ondra"}, "edited": false, "score": 1, "creation_date": 1485024674, "post_id": 41783071, "comment_id": 70756431, "body": "How does the <code>Routes</code> look like? I&#39;m not sure if this was resolved in the new versions of servant, but you couldn&#39;t have a <code>Raw</code> endpoint in the routes; if you did, the result was a weird type error."}, {"owner": {"reputation": 2207, "user_id": 575152, "user_type": "registered", "accept_rate": 87, "profile_image": "https://www.gravatar.com/avatar/5e0170ce985a52a6af02b95baa38e1ae?s=128&d=identicon&r=PG", "display_name": "Savanni D&#39;Gerinel", "link": "https://stackoverflow.com/users/575152/savanni-dgerinel"}, "reply_to_user": {"reputation": 7714, "user_id": 149901, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/d1a6db7a9fb5385fde6ba426e27d5ac6?s=128&d=identicon&r=PG", "display_name": "ondra", "link": "https://stackoverflow.com/users/149901/ondra"}, "edited": false, "score": 0, "creation_date": 1485024732, "post_id": 41783071, "comment_id": 70756444, "body": "Turns out that is the correct answer! Could you upgrade your reply to an answer so I can give you credit?"}], "answers": [{"tags": [], "owner": {"reputation": 7714, "user_id": 149901, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/d1a6db7a9fb5385fde6ba426e27d5ac6?s=128&d=identicon&r=PG", "display_name": "ondra", "link": "https://stackoverflow.com/users/149901/ondra"}, "is_accepted": true, "score": 4, "last_activity_date": 1485024882, "creation_date": 1485024882, "answer_id": 41783201, "question_id": 41783071, "link": "https://stackoverflow.com/questions/41783071/how-do-i-resolve-a-type-error-using-enter-from-the-servant-library/41783201#41783201", "title": "How do I resolve a type error using Enter from the Servant library?", "body": "<p>You cannot have a <code>Raw</code> endpoint in the Api type. The way to do it is to get the Raw endpoint out of the <code>handlers</code> and call it e.g.</p>\n\n<pre><code>server c = enter runApp (handlers c) :&lt;|&gt; handleRaw\n</code></pre>\n"}], "owner": {"reputation": 2207, "user_id": 575152, "user_type": "registered", "accept_rate": 87, "profile_image": "https://www.gravatar.com/avatar/5e0170ce985a52a6af02b95baa38e1ae?s=128&d=identicon&r=PG", "display_name": "Savanni D&#39;Gerinel", "link": "https://stackoverflow.com/users/575152/savanni-dgerinel"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 171, "favorite_count": 0, "accepted_answer_id": 41783201, "answer_count": 1, "score": 0, "last_activity_date": 1485024882, "creation_date": 1485024112, "question_id": 41783071, "link": "https://stackoverflow.com/questions/41783071/how-do-i-resolve-a-type-error-using-enter-from-the-servant-library", "title": "How do I resolve a type error using Enter from the Servant library?", "body": "<p>I'm trying to use the <code>enter</code> function to allow me to run my API handlers with one set of exceptions that I'll translate to Servant at a high level, but I'm having troubles with a type match.</p>\n\n<p>Given this minimal set of definitions:</p>\n\n<pre><code>-- server :: Config -&gt; Server Routes\nserver :: Config -&gt; ServerT Routes (ExceptT ServantErr IO)\nserver c = enter runApp (handlers c)\n\n-- runApp :: AppM :~&gt; Handler\nrunApp :: ExceptT AppErr IO :~&gt; ExceptT ServantErr IO\nrunApp = Nat undefined\n\nhandlers :: Config -&gt; ServerT Routes (ExceptT AppErr IO)\nhandlers = undefined\n</code></pre>\n\n<p>I end up with this type error:</p>\n\n<pre><code>Couldn't match type `IO' with `ExceptT ServantErr IO'\narising from a functional dependency between:\n  constraint `servant-0.7.1:Servant.Utils.Enter.Enter\n                (IO ResponseReceived)\n                (ExceptT AppErr IO :~&gt; ExceptT ServantErr IO)\n                (IO ResponseReceived)'\n    arising from a use of `enter'\n  instance `servant-0.7.1:Servant.Utils.Enter.Enter\n              (m a) (m :~&gt; n) (n a)'\n    at &lt;no location info&gt;\nIn the expression: enter runApp (handlers c)\nIn an equation for `server': server c = enter runApp (handlers c)\n</code></pre>\n\n<p>The exception comes from the line with the call to <code>enter</code>. For reference, the declaration of <code>enter</code>:</p>\n\n<pre><code>class Enter typ arg ret | typ arg -&gt; ret, typ ret -&gt; arg where\n  enter :: arg -&gt; typ -&gt; ret\n\ninstance Enter (m a) (m :~&gt; n) (n a) where\n  -- enter :: (m :~&gt; n) -&gt; m a -&gt; n a\n</code></pre>\n\n<p>So, when I call <code>enter runApp</code>, I expect the types to go as such:</p>\n\n<pre><code>enter :: (m :~&gt; n) -&gt; m a -&gt; n a\nenter (runApp :: m ~ ExceptT AppErr IO :~&gt; n ~ ExceptT ServantErr IO) :: ExceptT AppErr IO a -&gt; ExceptT ServantErr IO a\n</code></pre>\n\n<p>(where above I used <code>n ~ ExceptT ServantErr IO</code> to illustrate my type substitutions)</p>\n\n<p>And in reality, I know from other code (that I have tried to mimic, and I don't understand where I went wrong), that <code>enter runApp</code> should/must have this type:</p>\n\n<pre><code>enter runApp :: ServerT Routes (ExceptT AppErr IO a) -&gt; ServerT Routes (ExceptT ServantErr IO a)\n</code></pre>\n\n<p>So, the questions are legion:</p>\n\n<ul>\n<li>what are the actual types of <code>enter runApp</code> (not what ghci will give me, but a more descriptive explanation)?</li>\n<li>where is that (IO ResponseReceived) constraint coming from?</li>\n<li>how do I tweak the above code to work such that the entire handler gets passed through the natural transformation?</li>\n</ul>\n"}, {"tags": ["function", "haskell", "lambda", "anonymous-function"], "comments": [{"owner": {"reputation": 314794, "user_id": 67579, "user_type": "registered", "accept_rate": 81, "profile_image": "https://i.stack.imgur.com/BJXub.png?s=128&g=1", "display_name": "Willem Van Onsem", "link": "https://stackoverflow.com/users/67579/willem-van-onsem"}, "edited": false, "score": 1, "creation_date": 1485018206, "post_id": 41781995, "comment_id": 70754239, "body": "Why would it return <code>Peter</code>?"}, {"owner": {"reputation": 384463, "user_id": 1126841, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/fa05233b2357f8d11c22ef4cfc7bb85c?s=128&d=identicon&r=PG", "display_name": "chepner", "link": "https://stackoverflow.com/users/1126841/chepner"}, "edited": false, "score": 0, "creation_date": 1485018268, "post_id": 41781995, "comment_id": 70754261, "body": "What is the type and purpose of <code>enterName</code>? It would appear to be <code>enterName :: String -&gt; String -&gt; TelephoneBook -&gt; TelephoneBook</code>, but then why would you expect applying the new <code>TelephoneBook</code> value to an empty string to return <code>&quot;Peter&quot;</code>?"}, {"owner": {"reputation": 113, "user_id": 7200922, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/c9yJO.jpg?s=128&g=1", "display_name": "Fireapprentice", "link": "https://stackoverflow.com/users/7200922/fireapprentice"}, "edited": false, "score": 0, "creation_date": 1485018368, "post_id": 41781995, "comment_id": 70754285, "body": "In the example we had given of a console in which they typed the above shown it returned the name, so I implemented it as follows: &#39;putName :: String -&gt; String -&gt; Telephonebook -&gt; TelephoneBook&#39; (this was given) &#39;putName a b c = (\\x -&gt; b)&#39; &lt;- my code"}, {"owner": {"reputation": 384463, "user_id": 1126841, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/fa05233b2357f8d11c22ef4cfc7bb85c?s=128&d=identicon&r=PG", "display_name": "chepner", "link": "https://stackoverflow.com/users/1126841/chepner"}, "edited": false, "score": 0, "creation_date": 1485018414, "post_id": 41781995, "comment_id": 70754299, "body": "And what is <code>putName</code> supposed to do? Why does it take 3 arguments if it ignores two of them?"}, {"owner": {"reputation": 314794, "user_id": 67579, "user_type": "registered", "accept_rate": 81, "profile_image": "https://i.stack.imgur.com/BJXub.png?s=128&g=1", "display_name": "Willem Van Onsem", "link": "https://stackoverflow.com/users/67579/willem-van-onsem"}, "edited": false, "score": 0, "creation_date": 1485018425, "post_id": 41781995, "comment_id": 70754305, "body": "@Fapprentice: but then you completely forget about the original telephone book and furthermore all elements will map on Peter here..."}, {"owner": {"reputation": 314794, "user_id": 67579, "user_type": "registered", "accept_rate": 81, "profile_image": "https://i.stack.imgur.com/BJXub.png?s=128&g=1", "display_name": "Willem Van Onsem", "link": "https://stackoverflow.com/users/67579/willem-van-onsem"}, "reply_to_user": {"reputation": 384463, "user_id": 1126841, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/fa05233b2357f8d11c22ef4cfc7bb85c?s=128&d=identicon&r=PG", "display_name": "chepner", "link": "https://stackoverflow.com/users/1126841/chepner"}, "edited": false, "score": 0, "creation_date": 1485018451, "post_id": 41781995, "comment_id": 70754313, "body": "@chepner: I think he wants to say <code>enterName</code> and add a name to the book."}, {"owner": {"reputation": 113, "user_id": 7200922, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/c9yJO.jpg?s=128&g=1", "display_name": "Fireapprentice", "link": "https://stackoverflow.com/users/7200922/fireapprentice"}, "edited": false, "score": 0, "creation_date": 1485018544, "post_id": 41781995, "comment_id": 70754337, "body": "what was given were the following: <code>enterName :: String -&gt; String -&gt; Telebook -&gt; Telebook</code> and the type <code>type Telebook = String -&gt; String</code> as well as <code>search:: String -&gt; Telebook -&gt; String</code> I kinda when of what..."}, {"owner": {"reputation": 113, "user_id": 7200922, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/c9yJO.jpg?s=128&g=1", "display_name": "Fireapprentice", "link": "https://stackoverflow.com/users/7200922/fireapprentice"}, "reply_to_user": {"reputation": 314794, "user_id": 67579, "user_type": "registered", "accept_rate": 81, "profile_image": "https://i.stack.imgur.com/BJXub.png?s=128&g=1", "display_name": "Willem Van Onsem", "link": "https://stackoverflow.com/users/67579/willem-van-onsem"}, "edited": false, "score": 0, "creation_date": 1485018632, "post_id": 41781995, "comment_id": 70754368, "body": "@Willem Van Onsem could you further elaborate why everything would map on peter in this case - that sounds like being a huge issue I haven&#39;t noticed yet"}, {"owner": {"reputation": 384463, "user_id": 1126841, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/fa05233b2357f8d11c22ef4cfc7bb85c?s=128&d=identicon&r=PG", "display_name": "chepner", "link": "https://stackoverflow.com/users/1126841/chepner"}, "reply_to_user": {"reputation": 314794, "user_id": 67579, "user_type": "registered", "accept_rate": 81, "profile_image": "https://i.stack.imgur.com/BJXub.png?s=128&g=1", "display_name": "Willem Van Onsem", "link": "https://stackoverflow.com/users/67579/willem-van-onsem"}, "edited": false, "score": 0, "creation_date": 1485018706, "post_id": 41781995, "comment_id": 70754393, "body": "@WillemVanOnsem I realize that. It&#39;s not clear that the OP does, though."}, {"owner": {"reputation": 113, "user_id": 7200922, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/c9yJO.jpg?s=128&g=1", "display_name": "Fireapprentice", "link": "https://stackoverflow.com/users/7200922/fireapprentice"}, "edited": false, "score": 0, "creation_date": 1485018909, "post_id": 41781995, "comment_id": 70754453, "body": "I will be meeting with other students and trying to figure out the problem, I hope I explained it clearly enough to understand if not I am very sorry. Still thank you for taking the time to help :)"}, {"owner": {"reputation": 384463, "user_id": 1126841, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/fa05233b2357f8d11c22ef4cfc7bb85c?s=128&d=identicon&r=PG", "display_name": "chepner", "link": "https://stackoverflow.com/users/1126841/chepner"}, "edited": false, "score": 0, "creation_date": 1485019292, "post_id": 41781995, "comment_id": 70754584, "body": "One thing I may have missed or forgotten (but appears to be addressed by Willem Van Onsem in his answer): were you <i>give</i> the type <code>type TelephoneBook = String -&gt; String</code>, or is that how you decided to implement the type?"}, {"owner": {"reputation": 113, "user_id": 7200922, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/c9yJO.jpg?s=128&g=1", "display_name": "Fireapprentice", "link": "https://stackoverflow.com/users/7200922/fireapprentice"}, "edited": false, "score": 0, "creation_date": 1485091057, "post_id": 41781995, "comment_id": 70771226, "body": "I was given this type, in all functions we were given how to implement them (the <code>myfuction :: String -&gt; Telbook</code> etc was always given"}], "answers": [{"comments": [{"owner": {"reputation": 113, "user_id": 7200922, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/c9yJO.jpg?s=128&g=1", "display_name": "Fireapprentice", "link": "https://stackoverflow.com/users/7200922/fireapprentice"}, "edited": false, "score": 0, "creation_date": 1485019180, "post_id": 41782207, "comment_id": 70754543, "body": "Wow, this was fast :) thank you very much, I don&#39;t know HashMaps and querys yet so I&#39;ll habe to have a look into that! But your explanation makes sense"}], "tags": [], "owner": {"reputation": 314794, "user_id": 67579, "user_type": "registered", "accept_rate": 81, "profile_image": "https://i.stack.imgur.com/BJXub.png?s=128&g=1", "display_name": "Willem Van Onsem", "link": "https://stackoverflow.com/users/67579/willem-van-onsem"}, "is_accepted": true, "score": 1, "last_activity_date": 1485018985, "last_edit_date": 1495541333, "creation_date": 1485018985, "answer_id": 41782207, "question_id": 41781995, "link": "https://stackoverflow.com/questions/41781995/accessing-a-function-that-has-been-called/41782207#41782207", "title": "Accessing a function, that has been called", "body": "<p>Given that you say <code>Telephonebook</code> is a type alias <code>String -&gt; String</code>, I think you want to compose a function that maps names onto telephone number. So that if you lookup <code>\"Peter\"</code> from the book, it returns <code>\"4232\"</code>.</p>\n\n<p>Now if you want to search for a name, all you have to do is <em>call</em> the query on the telephonebook. So <code>searchFkt</code> would look like:</p>\n\n<pre><code>searchFkt :: String -&gt; Telephonebook -&gt; String\nsearchFkt query book = book query\n</code></pre>\n\n<p>Nevertheless based on your comments, I think you made an error in your <code>enterName</code> program. <a href=\"https://stackoverflow.com/questions/41781995/accessing-a-function-that-has-been-called#comment70754285_41781995\">Here</a> you say you implemented it as:</p>\n\n<pre><code>putName :: String -&gt; String -&gt; Telephonebook -&gt; Telephonebook\nputName name number oldbook = \\x -&gt; number\n</code></pre>\n\n<p>(I took the liberty to rename <code>a</code>, <code>b</code> and <code>c</code>.). As you can see, <code>name</code> and <code>oldbook</code> are not even mentioned in the right side of the expression. As a result Haskell forgets about these: it thus means that nor <code>name</code>, nor <code>oldbook</code> play any part in the construction of the new book.</p>\n\n<p>A better way would be to implement it as:</p>\n\n<pre><code>putName :: String -&gt; String -&gt; Phonebook -&gt; Phonebook\nputName name number oldbook = newbook\n    where newbook query | query == name = number\n                        | otherwise = oldbook query\n</code></pre>\n\n<p>In other words you construct a new function <code>newbook</code> that takes as input a <code>query</code> (the name you are supposed to resolve). In case <code>query</code> is equal to the given new <code>name</code>, it returns the <code>number</code>; otherwise it asks the <code>oldbook</code> to handle it further.</p>\n\n<p>Finally I think it is not a good idea to implement the phonebook as a function <code>String -&gt; String</code>, because a next task might be to implement a reverse lookup operation, in which case you are lost. It is better to implement it as a list of tuples like <code>[(String,String)]</code> (of course hashmaps, etc. would be more ideal).</p>\n"}, {"tags": [], "owner": {"reputation": 384463, "user_id": 1126841, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/fa05233b2357f8d11c22ef4cfc7bb85c?s=128&d=identicon&r=PG", "display_name": "chepner", "link": "https://stackoverflow.com/users/1126841/chepner"}, "is_accepted": false, "score": 2, "last_activity_date": 1485019052, "creation_date": 1485019052, "answer_id": 41782220, "question_id": 41781995, "link": "https://stackoverflow.com/questions/41781995/accessing-a-function-that-has-been-called/41782220#41782220", "title": "Accessing a function, that has been called", "body": "<p>This isn't an answer, per se, but an attempt to clarify what your assignment appears to be, both for your sake and the sake of others trying to read your question(s).</p>\n\n<hr>\n\n<p>The ultimate goal of your assignment appears to be to implement a phone book using a function; a hard-coded example might be</p>\n\n<pre><code>type TelephoneBook = String -&gt; String\n\nmyPhoneBook :: TelephoneBook\nmyPhoneBook \"Peter\" = \"4232\"\nmyPhoneBook \"Alice\" = \"23213\"\n</code></pre>\n\n<p>Note that this is only a partial function; it is not defined at all for the vast majority of possible names.</p>\n\n<p>One problem with this approach is that it doesn't allow for a truly empty phone book, since you can't define a function that doesn't actually do <em>anything</em>. So, we'll replace that with an \"empty\" book that returns a default value for any name not already in the phone book:</p>\n\n<pre><code>-- Not ideal, but it's the best we can do given the constraints\n-- imposed by the given type.\nempty :: TelephoneBook\nempty _ = \"not found\"\n</code></pre>\n\n<p>Your goal is to write a function <code>enterName</code> that takes a name, a phone number, and an <em>existing</em> phone book, and returns a new phone book that is the same as the old one, but with one new entry (that overrides any previous entry with the same name. That is,</p>\n\n<pre><code>empty \"Peter\" == \"not found\"\n(enterName \"Peter\" \"1234\" empty) \"Peter\" == \"1234\"\n(enterName \"Peter\" \"1234\" empty) \"Bob\" == \"not found\"\n(enterName \"Bob\" \"9876\" (enterName \"Peter\" \"1234\" empty)) \"Bob\" == \"9876\"\n</code></pre>\n\n<p>Your <code>enterName</code> function has type <code>String -&gt; String -&gt; TelephoneBook -&gt; TelephoneBook</code>, meaning it takes three arguments, and it needs to actually do something with all three of them.</p>\n\n<pre><code>enterName :: String -&gt; String -&gt; TelephoneBook -&gt; TelephoneBook\nenterName name number phonebook = ...\n</code></pre>\n\n<p>Likewise, your <code>searchFkt :: String -&gt; TelephoneBook -&gt; String</code> function takes a name and a phone book and returns the number associated with that name in the book. </p>\n\n<pre><code>searchFkt :: String -&gt; TelephoneBook -&gt; String\nsearchFkt name book = ...\n</code></pre>\n\n<p>Given the definition of <code>TelephoneBook</code> above and the examples of its use, it should be obvious how to implement <code>searchFkt</code>.</p>\n"}], "owner": {"reputation": 113, "user_id": 7200922, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/c9yJO.jpg?s=128&g=1", "display_name": "Fireapprentice", "link": "https://stackoverflow.com/users/7200922/fireapprentice"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 90, "favorite_count": 0, "accepted_answer_id": 41782207, "answer_count": 2, "score": -2, "last_activity_date": 1485019052, "creation_date": 1485017632, "last_edit_date": 1485018180, "question_id": 41781995, "link": "https://stackoverflow.com/questions/41781995/accessing-a-function-that-has-been-called", "title": "Accessing a function, that has been called", "body": "<p>I am currently trying to figure out a way to writer a \"telephone book\". (It's a task from university so I would appreciate a tip rather than a full solution) </p>\n\n<p>I created a function which enables the user to write in several names as follows:</p>\n\n<p>(It had to be solves like this, because we had to use <code>type TelephoneBook = String -&gt; String</code>)</p>\n\n<pre><code>(enterName \"Peter\" \"4232\" (enterName \"Alice\" \"23213\" emptyBook)) \"\"\n</code></pre>\n\n<p>This would then return <code>Peter</code>.</p>\n\n<p>Well now I am supposed to be able to access this data and search for a name and then retrieve a Number.\nMy current Idea is as follows: </p>\n\n<pre><code>searchFkt :: String -&gt; TelephoneBook -&gt; String\nsearchFkt a b \n | (a == book \"\") = a         --Iam fully aware that this doesn't work\n | otherwise = \"not found\" \n</code></pre>\n\n<p>I am aware that the second part doesn't work like that (<code>searchFkt :: String -&gt; TelephoneBook -&gt; String</code> was given as well), however I have no clue how to implement this and I really need help, because I have been looking through books and trying to wrap myself around how to solve this for hours.</p>\n\n<p>Thanks in advance</p>\n\n<p>Ps: I want to understand how this works and not just have a solution, so maybe a reference to what to read would be helpful as well :)</p>\n"}, {"tags": ["haskell", "recursion"], "comments": [{"owner": {"reputation": 1414, "user_id": 6564029, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/WxyK5.jpg?s=128&g=1", "display_name": "Michail", "link": "https://stackoverflow.com/users/6564029/michail"}, "edited": false, "score": 0, "creation_date": 1485015498, "post_id": 41781460, "comment_id": 70753225, "body": "It&#39;s not the most convenient thing, but you could change your function to take an extra argument, in which you&#39;ll store current recursion depth, and to return tuple <code>(actualResult, finalRecursionDepth)</code>."}, {"owner": {"reputation": 109, "user_id": 6917467, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/8d2aa2193b4faf2f3a08b1faa9ec4aea?s=128&d=identicon&r=PG&f=1", "display_name": "Yassine Boutabia", "link": "https://stackoverflow.com/users/6917467/yassine-boutabia"}, "reply_to_user": {"reputation": 1414, "user_id": 6564029, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/WxyK5.jpg?s=128&g=1", "display_name": "Michail", "link": "https://stackoverflow.com/users/6564029/michail"}, "edited": false, "score": 1, "creation_date": 1485016079, "post_id": 41781460, "comment_id": 70753459, "body": "This is actually what I need. can you please elaborate. @Michail"}, {"owner": {"reputation": 1414, "user_id": 6564029, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/WxyK5.jpg?s=128&g=1", "display_name": "Michail", "link": "https://stackoverflow.com/users/6564029/michail"}, "edited": false, "score": 0, "creation_date": 1485017086, "post_id": 41781460, "comment_id": 70753812, "body": "I have written an answer. It&#39;s a bit too big to place it in a comment (even if max comment length allows it)."}], "answers": [{"tags": [], "owner": {"reputation": 384463, "user_id": 1126841, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/fa05233b2357f8d11c22ef4cfc7bb85c?s=128&d=identicon&r=PG", "display_name": "chepner", "link": "https://stackoverflow.com/users/1126841/chepner"}, "is_accepted": false, "score": 2, "last_activity_date": 1485015905, "last_edit_date": 1485015905, "creation_date": 1485015510, "answer_id": 41781605, "question_id": 41781460, "link": "https://stackoverflow.com/questions/41781460/how-to-calculate-how-many-recursive-calls-happened-in-this-haskell-function/41781605#41781605", "title": "How to calculate how many recursive calls happened in this Haskell function?", "body": "<p>For a list with <code>n</code> elements, there are <code>n-1</code> recursive calls. To make it easier to see, we'll rewrite the function slightly. (We can ignore empty list for this.)</p>\n\n<pre><code>maximum' [x] = x\nmaximum' (x:xs) = if x &gt; maxTail then x else maxTail\n                  where maxTail = maximum' xs\n</code></pre>\n\n<p>A recursive call is made when the tail of the argument is not empty. (Note that a function that was defined for the empty list as well would make <code>n</code> recursive calls on a list with <code>n</code> items.)</p>\n\n<p>We can expand a call to a 3-item list, for example:</p>\n\n<pre><code>maximum' [1,2,3] = if 1 &gt; maxTail then 1 else maxTail where maxTail = maximum' [2,3]\n maximum' [2,3] = if 2 &gt; maxTail then 2 else maxTail where maxTail = maximum' [3]\n  maximum' [3] = 3\n</code></pre>\n"}, {"comments": [{"owner": {"reputation": 384463, "user_id": 1126841, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/fa05233b2357f8d11c22ef4cfc7bb85c?s=128&d=identicon&r=PG", "display_name": "chepner", "link": "https://stackoverflow.com/users/1126841/chepner"}, "edited": false, "score": 0, "creation_date": 1485024083, "post_id": 41781871, "comment_id": 70756224, "body": "Carrying the depth is useful both for informational purposes and, in some cases, necessary for implementing the function. (Bounded depth-first search of a tree comes to mind.)"}], "tags": [], "owner": {"reputation": 1414, "user_id": 6564029, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/WxyK5.jpg?s=128&g=1", "display_name": "Michail", "link": "https://stackoverflow.com/users/6564029/michail"}, "is_accepted": false, "score": 3, "last_activity_date": 1485017351, "last_edit_date": 1485017351, "creation_date": 1485017020, "answer_id": 41781871, "question_id": 41781460, "link": "https://stackoverflow.com/questions/41781460/how-to-calculate-how-many-recursive-calls-happened-in-this-haskell-function/41781871#41781871", "title": "How to calculate how many recursive calls happened in this Haskell function?", "body": "<p>You can rewrite your function to carry information about recursion depth in an extra argument, and return it as second (or first, if you so prefer) element of a tuple:</p>\n\n<pre><code>maximum' :: (Ord a) =&gt; [a] -&gt; Int -&gt; (a, Int)\nmaximum' [] _ = error \"maximum of empty list\"  \nmaximum' [x] n = (x, n)\nmaximum' (x:xs) n   \n    | x &gt; fst maxTail = (x, snd maxTail)\n    | otherwise = maxTail  \n    where maxTail = maximum' xs (n + 1)\n</code></pre>\n\n<p>Then you can call the function with <code>maximum' lst 0</code> or <code>maximum' lst 1</code> depending on whether or not you want the first call to count as a recursion level.</p>\n\n<p>It can be done with any recursive function, but it's probably not necessary in your case. As chepner wrote, the answer is known without extra computations.</p>\n"}, {"comments": [{"owner": {"reputation": 57219, "user_id": 33796, "user_type": "registered", "accept_rate": 70, "profile_image": "https://www.gravatar.com/avatar/08727b23ba62e634b32988cdff082663?s=128&d=identicon&r=PG", "display_name": "luqui", "link": "https://stackoverflow.com/users/33796/luqui"}, "edited": false, "score": 0, "creation_date": 1485044663, "post_id": 41783816, "comment_id": 70761953, "body": "Using <code>Writer (Sum Int)</code> is probably more appropriate than <code>State Int</code>"}], "tags": [], "owner": {"reputation": 2863, "user_id": 2297560, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/948d4a17494b3c616a0873453b74670c?s=128&d=identicon&r=PG", "display_name": "user2297560", "link": "https://stackoverflow.com/users/2297560/user2297560"}, "is_accepted": true, "score": 1, "last_activity_date": 1485028447, "creation_date": 1485028447, "answer_id": 41783816, "question_id": 41781460, "link": "https://stackoverflow.com/questions/41781460/how-to-calculate-how-many-recursive-calls-happened-in-this-haskell-function/41783816#41783816", "title": "How to calculate how many recursive calls happened in this Haskell function?", "body": "<p>Do you love functional programming? Do you love imperative programming? Why not have both! Here's a recursive-imperative way to count the recursion depth.</p>\n\n<pre><code>{-# LANGUAGE FlexibleContexts #-}\n\nimport Control.Monad.State\n\nmaximumWithCount :: (Ord a, MonadState Int m) =&gt; [a] -&gt; m a\nmaximumWithCount xs = case xs of\n  [] -&gt; error \"empty list\"\n  [x] -&gt; return x\n  (x:xs) -&gt; do\n    modify (+1)  -- increment the counter because we're recursing!\n    y &lt;- maximumWithCount xs\n    return $ max x y\n\n\u03bb runState (maximumWithCount [1,2,3,4,5,4,3,2,1]) 0\n(5,8)\n</code></pre>\n"}, {"tags": [], "owner": {"reputation": 24211, "user_id": 1364288, "user_type": "registered", "accept_rate": 88, "profile_image": "https://i.stack.imgur.com/JVtNl.png?s=128&g=1", "display_name": "danidiaz", "link": "https://stackoverflow.com/users/1364288/danidiaz"}, "is_accepted": false, "score": 2, "last_activity_date": 1485090860, "creation_date": 1485090860, "answer_id": 41791334, "question_id": 41781460, "link": "https://stackoverflow.com/questions/41781460/how-to-calculate-how-many-recursive-calls-happened-in-this-haskell-function/41791334#41791334", "title": "How to calculate how many recursive calls happened in this Haskell function?", "body": "<p>This is a digression on <strong>Michail</strong>'s and <strong>user2297560</strong>'s answers.</p>\n\n<p>What if, instead of rewriting the function from scratch to add tracking functionality, we could reuse the original implementation and \"instrument\" it in some way?</p>\n\n<p>We could write a base function that</p>\n\n<ul>\n<li>Is monadic, but polymorphic on the monad.</li>\n<li>Is defined using anonymous recursion, with the help of <code>fix</code>.</li>\n</ul>\n\n<p>For example:</p>\n\n<pre><code>import Data.Function(fix)\nimport Data.Functor.Identity\n\nmaximumAux :: (Monad m,Ord a) \n           =&gt; ([a] -&gt; m a) \n           -&gt;  [a] -&gt; m a  \nmaximumAux _ [] = error \"maximum of empty list\"  \nmaximumAux _ [x] = return x  \nmaximumAux recurse (x:xs) = \n    do maxTail &lt;- recurse xs\n       return (max x maxTail)\n\nmaximumPure :: Ord a =&gt; [a] -&gt; a\nmaximumPure as = runIdentity (fix maximumAux as)\n</code></pre>\n\n<p>And then instrument it like this, reusing the original logic:</p>\n\n<pre><code>maximumInstrumented :: (Ord a, Show a) =&gt; [a] -&gt; IO a\nmaximumInstrumented = fix (instrument maximumAux)\n    where\n    instrument auxf iorecurse as = \n        do print $ \"starting call with params \" ++ show as\n           a &lt;- auxf iorecurse as\n           print $ \"ending call with value\" ++ show a\n           return a\n</code></pre>\n\n<p>But perhaps defining functions as \"monadic by default\" isn't too practical.</p>\n"}], "owner": {"reputation": 109, "user_id": 6917467, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/8d2aa2193b4faf2f3a08b1faa9ec4aea?s=128&d=identicon&r=PG&f=1", "display_name": "Yassine Boutabia", "link": "https://stackoverflow.com/users/6917467/yassine-boutabia"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 670, "favorite_count": 1, "accepted_answer_id": 41783816, "answer_count": 4, "score": 2, "last_activity_date": 1485090860, "creation_date": 1485014683, "question_id": 41781460, "link": "https://stackoverflow.com/questions/41781460/how-to-calculate-how-many-recursive-calls-happened-in-this-haskell-function", "title": "How to calculate how many recursive calls happened in this Haskell function?", "body": "<p>I've been trying to figure this out for a couple of hours now. \nI need to calculate how many recursive calls happened using a certain function:</p>\n\n<pre><code>maximum' :: (Ord a) =&gt; [a] -&gt; a  \nmaximum' [] = error \"maximum of empty list\"  \nmaximum' [x] = x  \nmaximum' (x:xs)   \n    | x &gt; maxTail = x  \n    | otherwise = maxTail  \n    where maxTail = maximum' xs  \n</code></pre>\n\n<p>Many thanks in advance</p>\n"}, {"tags": ["haskell"], "comments": [{"owner": {"reputation": 2863, "user_id": 2297560, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/948d4a17494b3c616a0873453b74670c?s=128&d=identicon&r=PG", "display_name": "user2297560", "link": "https://stackoverflow.com/users/2297560/user2297560"}, "edited": false, "score": 2, "creation_date": 1485029687, "post_id": 41781394, "comment_id": 70758042, "body": "You might want to take a look at the <code>accelerate</code> library and its CUDA backend."}], "answers": [{"comments": [{"owner": {"reputation": 3436, "user_id": 4364027, "user_type": "registered", "accept_rate": 64, "profile_image": "https://www.gravatar.com/avatar/e84dbb0e9c838c25bbb70b326fd696aa?s=128&d=identicon&r=PG&f=1", "display_name": "Marko Grdinic", "link": "https://stackoverflow.com/users/4364027/marko-grdinic"}, "edited": false, "score": 0, "creation_date": 1485020639, "post_id": 41782205, "comment_id": 70755089, "body": "This seems promising, but I am not sure I understand what type families are supposed to be about, or whether I want a solution such as this. Instead of a GADT encoding I&#39;ve been considering a finally tagless one as well which would allow me to use typeclass instances to map the tuples. I want to comment more, but I&#39;ll save it for later as I obviously need to read some type family tutorials. Right now I am in the middle of it."}, {"owner": {"reputation": 11612, "user_id": 204218, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/3ee571049ff6ff0361be53e554b877e6?s=128&d=identicon&r=PG", "display_name": "adamse", "link": "https://stackoverflow.com/users/204218/adamse"}, "reply_to_user": {"reputation": 3436, "user_id": 4364027, "user_type": "registered", "accept_rate": 64, "profile_image": "https://www.gravatar.com/avatar/e84dbb0e9c838c25bbb70b326fd696aa?s=128&d=identicon&r=PG&f=1", "display_name": "Marko Grdinic", "link": "https://stackoverflow.com/users/4364027/marko-grdinic"}, "edited": false, "score": 0, "creation_date": 1485020859, "post_id": 41782205, "comment_id": 70755160, "body": "Typefamilies are like functions from one type to another. <code>map_into_prim_adj</code> will have different types depending on what the input was so I used a type family to calculate the correct result type."}, {"owner": {"reputation": 3436, "user_id": 4364027, "user_type": "registered", "accept_rate": 64, "profile_image": "https://www.gravatar.com/avatar/e84dbb0e9c838c25bbb70b326fd696aa?s=128&d=identicon&r=PG&f=1", "display_name": "Marko Grdinic", "link": "https://stackoverflow.com/users/4364027/marko-grdinic"}, "edited": false, "score": 0, "creation_date": 1485021496, "post_id": 41782205, "comment_id": 70755391, "body": "So it receives <code>(x, y)</code> it will turn it into <code>((x, x), (y, y))</code>? The tutorials seem fairly difficult, and I am having difficulty wrapping my head around this on such a short notice. ...Actually looking at the above in <code>CudaVariable (ResType x)</code>, is <code>ResType</code> the function and <code>x</code> the input?"}], "tags": [], "owner": {"reputation": 11612, "user_id": 204218, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/3ee571049ff6ff0361be53e554b877e6?s=128&d=identicon&r=PG", "display_name": "adamse", "link": "https://stackoverflow.com/users/204218/adamse"}, "is_accepted": true, "score": 2, "last_activity_date": 1485034134, "last_edit_date": 1485034134, "creation_date": 1485018978, "answer_id": 41782205, "question_id": 41781394, "link": "https://stackoverflow.com/questions/41781394/how-to-do-a-generic-tuple-map-using-a-gadt/41782205#41782205", "title": "How to do a generic tuple map using a GADT?", "body": "<p>I'm not really sure what you're doing exactly but here is how you could type <code>map_into_prim_adj</code> using the <a href=\"http://downloads.haskell.org/~ghc/master/users-guide/glasgow_exts.html#synonym-families\" rel=\"nofollow noreferrer\"><code>TypeFamilies</code></a> language extension:</p>\n\n<pre><code>type family ResType t :: * where\n  ResType (x, y) = ((x, x), (y, y))\n  ResType (x, y, z) = ((x, x), (y, y), (z, z))\n  -- ...\n\nmap_into_prim_adj :: CudaVariable x -&gt; CudaVariable (ResType x)\nmap_into_prim_adj x =\n  let f = varar1d_into_prim_adj in\n  case x of\n    VarTuple2 a b -&gt; VarTuple2 (f a) (f b)\n    VarTuple3 a b c -&gt; VarTuple3 (f a) (f b) (f c)\n    -- ...\n</code></pre>\n\n<p><em>A little explanation</em>. A type family is sort of like a function from types to types. In <code>map_into_prim_adj</code> if <code>x</code> is a <code>VarTuple2</code> the type of <code>x</code> would be <code>CudaVariable (a, b)</code> and the argument to <code>ResType</code> would therefore be <code>(a, b)</code> which will match the first equation of <code>ResType</code> giving us an output type of <code>((a, a), (b, b))</code>.</p>\n"}], "owner": {"reputation": 3436, "user_id": 4364027, "user_type": "registered", "accept_rate": 64, "profile_image": "https://www.gravatar.com/avatar/e84dbb0e9c838c25bbb70b326fd696aa?s=128&d=identicon&r=PG&f=1", "display_name": "Marko Grdinic", "link": "https://stackoverflow.com/users/4364027/marko-grdinic"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 95, "favorite_count": 0, "accepted_answer_id": 41782205, "answer_count": 1, "score": 1, "last_activity_date": 1485034134, "creation_date": 1485014293, "last_edit_date": 1485014646, "question_id": 41781394, "link": "https://stackoverflow.com/questions/41781394/how-to-do-a-generic-tuple-map-using-a-gadt", "title": "How to do a generic tuple map using a GADT?", "body": "<pre><code>{-# LANGUAGE ScopedTypeVariables #-}\n{-# LANGUAGE GADTs #-}\n{-# LANGUAGE NoMonomorphismRestriction #-}\n{-# LANGUAGE OverloadedStrings #-}\n\nmodule Main where\n\nimport qualified Data.ByteString.Char8 as B\nimport Data.ByteString (ByteString)\n\ninfixl 1 |&gt;\n(|&gt;) = flip ($)\n\ndata CudaVarAr2d x where VarAr2d :: CudaVarScalar Int -&gt; CudaVarScalar Int -&gt; ByteString -&gt; CudaVarAr2d x\ndata CudaVarAr1d x where VarAr1d :: CudaVarScalar Int -&gt; ByteString -&gt; CudaVarAr1d x\ndata CudaVarScalar x where VarScalar :: ByteString -&gt; CudaVarScalar x\n\ndata CudaVariable x where\n  VarAr2d' :: CudaVarAr2d x -&gt; CudaVariable x\n  VarAr1d' :: CudaVarAr1d x -&gt; CudaVariable x\n  VarScalar' :: CudaVarScalar x -&gt; CudaVariable x\n  VarTuple2 :: CudaVariable x -&gt; CudaVariable y -&gt; CudaVariable (x,y)\n  VarTuple3 :: CudaVariable x -&gt; CudaVariable y -&gt; CudaVariable z -&gt; CudaVariable (x,y,z)\n\nsize = VarScalar \"size\"\nx1 = VarAr1d' $ VarAr1d size \"x1\"\nx2 = VarAr1d' $ VarAr1d size \"x2\"\ninp = VarTuple2 x1 x2\n\no1 = VarAr1d' $ VarAr1d size \"o1\"\no2 = VarAr1d' $ VarAr1d size \"o2\"\noutp = VarTuple2 o1 o2\n\n-- Later I intend to cover all the cases.\nvarar1d_into_prim_adj :: CudaVariable x -&gt; CudaVariable (x,x)\nvarar1d_into_prim_adj (VarAr1d' (VarAr1d size name)) = VarTuple2 x1 x2 where\n  f suffix = VarAr1d' (VarAr1d size ([name,suffix] |&gt; B.concat))\n  x1 = f \"_primal\"\n  x2 = f \"_adjoint\"\n\n--map_into_prim_adj :: CudaVariable x -&gt; CudaVariable x\nmap_into_prim_adj x =\n  let f = varar1d_into_prim_adj in\n  case x of\n    VarTuple2 a b -&gt; VarTuple2 (f a) (f b)\n    VarTuple3 a b c -&gt; VarTuple3 (f a) (f b) (f c)\n\nmain :: IO ()\nmain = print \"Hello\"\n</code></pre>\n\n<p>This thing with the tuples killed me in F#-land when I was making an interface for the Cuda compiler, so I am looking for more fertile ground in Haskell-land. I have no idea how to express the type for <code>map_into_prim_adj</code> and I was hoping the compiler would do it for me, but that was not the case.</p>\n\n<p>The ultimate goal of this would be to write something like </p>\n\n<pre><code>cuda_map_fb \n    (\\(x,y) -&gt; x * y)) \n    (\\((x_primal,x_adjoint),(y_primal,y_adjoint)) error -&gt; do\n        set x_adjoint (x_adjoint + error * y_primal)\n        set y_adjoint (y_adjoint + error * x_primal))\n</code></pre>\n\n<p>And have it be typechecked and sent to the compiler, but first I need to figure out how to map a tuple into a primal and an adjoint first. What I am trying to do is a tiny embedded Cuda compiler for a automatic differentiation/deep learning library.</p>\n"}, {"tags": ["haskell", "monoids"], "answers": [{"tags": [], "owner": {"reputation": 37219, "user_id": 1523776, "user_type": "moderator", "accept_rate": 87, "profile_image": "https://www.gravatar.com/avatar/b3e0b5c8e42a8c38009ef2d969f8dabb?s=128&d=identicon&r=PG", "display_name": "Benjamin Hodgson", "link": "https://stackoverflow.com/users/1523776/benjamin-hodgson"}, "is_accepted": true, "score": 3, "last_activity_date": 1485014917, "last_edit_date": 1485014917, "creation_date": 1485014412, "answer_id": 41781416, "question_id": 41781041, "link": "https://stackoverflow.com/questions/41781041/apply-a-list-of-boolean-functions-to-two-arguments-in-haskell/41781416#41781416", "title": "Apply a list of Boolean functions to two arguments in Haskell", "body": "<p>This is the sort of code that writes itself - you just have to make the types join up. But there are a couple of standard tools (namely <code>Applicative</code> and <code>Traversable</code>) which you can use to make your code shorter.</p>\n\n<p>In the <a href=\"https://hackage.haskell.org/package/base-4.9.1.0/docs/Data-Traversable.html\" rel=\"nofollow noreferrer\"><code>Data.Traversable</code></a> module lives <code>sequenceA :: (Traversable t, Applicative f) =&gt; t (f a) -&gt; f (t a)</code>. When specialised to <code>[]</code>'s instance of <code>Traversable</code> and the function applicative <code>(-&gt;) r</code> we get:</p>\n\n<pre><code>sequenceA :: [r -&gt; a] -&gt; r -&gt; [a]\n</code></pre>\n\n<p>So <code>sequenceA</code> yanks <code>-&gt;</code> out of <code>[]</code>, applying each function in the list to a fixed argument.</p>\n\n<pre><code>sequenceA [(&lt; 7), (&gt; 7), (== 7)] :: (Num n, Ord n) =&gt; n -&gt; [Bool]\n-- equivalent to:\n\\n -&gt; map ($ n) [(&lt; 7), (&gt; 7), (== 7)]\n</code></pre>\n\n<p>So your first function can be written as</p>\n\n<pre><code>f :: (Num n, Ord n) =&gt; n -&gt; Bool\nf = and . sequenceA [(&lt; 7), (&gt; 7), (== 7)]\n</code></pre>\n\n<p>I'm using <a href=\"http://hackage.haskell.org/package/base-4.9.1.0/docs/Prelude.html#v:and\" rel=\"nofollow noreferrer\"><code>and</code></a> instead of <code>mconcat . map (All .)</code>.</p>\n\n<p>For your second function, <code>uncurry</code> is the right tool. We have to map <code>uncurry</code> over the list of binary functions to get a list of unary functions of tuples, so that we can hoist the single argument out using <code>sequenceA</code>. Because <code>traverse f = sequenceA . map f</code> we can write it as:</p>\n\n<pre><code>g :: Ord n =&gt; n -&gt; n -&gt; Bool\ng = curry $ and . traverse uncurry [(&lt;), (&gt;), (==)]\n</code></pre>\n\n<p>(NB, for any correctly-implemented instance of <code>Ord</code>, <code>&gt;</code> and <code>&lt;</code> should be mutually exclusive. So both of these functions will always return <code>False</code>.)</p>\n"}, {"tags": [], "owner": {"reputation": 100185, "user_id": 3234959, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/93bb12ca0f93dfddb33880316f7e66c2?s=128&d=identicon&r=PG&f=1", "display_name": "chi", "link": "https://stackoverflow.com/users/3234959/chi"}, "is_accepted": false, "score": 1, "last_activity_date": 1485018528, "creation_date": 1485018528, "answer_id": 41782134, "question_id": 41781041, "link": "https://stackoverflow.com/questions/41781041/apply-a-list-of-boolean-functions-to-two-arguments-in-haskell/41782134#41782134", "title": "Apply a list of Boolean functions to two arguments in Haskell", "body": "<p>A close alternative to the original code:</p>\n\n<pre><code>mconcat (map (\\f a b -&gt; All (f a b)) [(&lt;),(&lt;=)]) 3 4\n</code></pre>\n\n<p>One can further rewrite <code>\\f a b -&gt; All (f a b)</code> in pointless style:</p>\n\n<pre><code>mconcat (map ((.) (All .)) [(&lt;),(&lt;=)]) 3 4\n</code></pre>\n"}], "owner": {"reputation": 187, "user_id": 3226024, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/1edfef0d41e7a9e1990382ca8a123d45?s=128&d=identicon&r=PG", "display_name": "Jan Hlavacek", "link": "https://stackoverflow.com/users/3226024/jan-hlavacek"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 390, "favorite_count": 0, "accepted_answer_id": 41781416, "answer_count": 2, "score": 1, "last_activity_date": 1485018528, "creation_date": 1485012179, "question_id": 41781041, "link": "https://stackoverflow.com/questions/41781041/apply-a-list-of-boolean-functions-to-two-arguments-in-haskell", "title": "Apply a list of Boolean functions to two arguments in Haskell", "body": "<p>I have a list of functions of type <code>a -&gt; b -&gt; Bool</code>, and am trying to apply them to two inputs and combine the results with <code>All</code> or <code>Any</code>.  I have this working with functions of one variable:</p>\n\n<pre><code>mconcat (map (All . ) [(&lt;7),(&gt;7),(==7)]) $ 6\n</code></pre>\n\n<p>but I cannot figure out how to do the same with two variable functions. </p>\n\n<p>This works:</p>\n\n<pre><code>mconcat (map (All . ) (map (uncurry) [(&lt;),(&gt;),(==)])) $ (,) 6 7\n</code></pre>\n\n<p>but it looks to me like an ugly workaround.</p>\n\n<p>Is there a better way to do this?</p>\n"}, {"tags": ["haskell", "typeclass"], "comments": [{"owner": {"reputation": 14582, "user_id": 2225384, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/f30b04ed4d0b3fc4bc791a28815f34ca?s=128&d=identicon&r=PG", "display_name": "Rein Henrichs", "link": "https://stackoverflow.com/users/2225384/rein-henrichs"}, "edited": false, "score": 0, "creation_date": 1485054096, "post_id": 41780607, "comment_id": 70763529, "body": "&quot;Basic equality&quot; is a pretty strange form of equality."}], "answers": [{"tags": [], "owner": {"reputation": 100892, "user_id": 745903, "user_type": "registered", "accept_rate": 74, "profile_image": "https://www.gravatar.com/avatar/50933f6638836741e620669b3940410e?s=128&d=identicon&r=PG", "display_name": "leftaroundabout", "link": "https://stackoverflow.com/users/745903/leftaroundabout"}, "is_accepted": true, "score": 3, "last_activity_date": 1485011941, "creation_date": 1485011941, "answer_id": 41781006, "question_id": 41780607, "link": "https://stackoverflow.com/questions/41780607/automatically-recognizing-types-when-using-typeclass-instances/41781006#41781006", "title": "Automatically recognizing types when using typeclass instances?", "body": "<p><code>Red</code> etc. are <em>monomorphic</em> values, i.e. they have a concrete type</p>\n\n<pre><code>Red :: Colour\n</code></pre>\n\n<p>So when <code>Red</code> turns up in your code, the compiler knows immediately what type it is, and it can use this information to infer what typeclass instance to use for e.g. <code>BasicEquality</code>.</p>\n\n<p>OTOH, numeric literals like <code>100</code> have the <em>polymorphic</em> type <code>Num a =&gt; a</code>. The reason is that we want to be able to write</p>\n\n<pre><code>Prelude&gt; replicate 3 'q'\n\"qqq\"\n</code></pre>\n\n<p>as well as</p>\n\n<pre><code>Prelude&gt; sqrt 3\n1.7320508075688772\n</code></pre>\n\n<p>If <code>3</code> had simply the type <code>Int</code>, the latter would not work, because <code>sqrt</code> expects a type of e.g. <code>Double</code>. Since numerical literals are actually polymorphic, this doesn't matter.</p>\n\n<p>The trouble in your case is that <code>isEqual</code> is <em>also</em> polymorphic. There are thus multiple different types the compiler could select. Image you also had</p>\n\n<pre><code>instance BasicEquality Integer where\n  isEqual 50 1000     = True\n  isEqual _ _         = False\n</code></pre>\n\n<p>then <code>isEqual 100 100</code> could be interpreted as either <code>isEqual (100 :: Int) 100</code> (which is <code>True</code>) or <code>isEqual (100 :: Integer) 100</code> (which is false).</p>\n\n<p>In practice, this is seldom so much of an issue, because you won't be comparing different numerical <em>literals</em> (these are already known, so you could as well simply hard-code the result!) but at most one literal with one variable in your program, and that variable will usually have already a type determined from the context. For instance,</p>\n\n<pre><code>*Main&gt; let b = length \"foobar\"\n*Main&gt; isEqual 4 b\nFalse\n</code></pre>\n\n<p>works without any signature.</p>\n"}], "owner": {"reputation": 2691, "user_id": 5477287, "user_type": "registered", "accept_rate": 87, "profile_image": "https://i.stack.imgur.com/yKMgF.jpg?s=128&g=1", "display_name": "Babra Cunningham", "link": "https://stackoverflow.com/users/5477287/babra-cunningham"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 33, "favorite_count": 1, "accepted_answer_id": 41781006, "answer_count": 1, "score": 0, "last_activity_date": 1485011941, "creation_date": 1485009511, "question_id": 41780607, "link": "https://stackoverflow.com/questions/41780607/automatically-recognizing-types-when-using-typeclass-instances", "title": "Automatically recognizing types when using typeclass instances?", "body": "<p>I'm going over some basic typeclass implementations: </p>\n\n<pre><code>data Colour = Red | Green | Black\n\nclass BasicEquality a where\n   isEqual :: a -&gt; a -&gt; Bool\n\ninstance BasicEquality Bool where\n  isEqual True True    = True\n  isEqual False True   = True\n  isEqual True False   = True\n  isEqual _ _          = False\n\ninstance BasicEquality Colour where\n  isEqual Red Green    = True\n  isEqual _ _          = False\n\ninstance BasicEquality Int where\n  isEqual 100 100     = True\n  isEqual _ _         = False\n\nmain = do \n  print $ isEqual Red Green //Output: True\n  print $ isEqual 100 100 //Output: Error Ambiguous type variable \u2018a0\u2019 arising from a use of \u2018isEqual\u2019\n</code></pre>\n\n<p>Clearly, this works when I specify <code>print $ isEqual (100 :: Int) (100 :: Int)</code></p>\n\n<p>Why does Haskell implicitly recognise that <code>Red</code> and <code>Green</code> are <code>Colours</code> yet requires me to specifically bind <code>100</code> to <code>Int</code>?</p>\n"}, {"tags": ["haskell"], "comments": [{"owner": {"reputation": 314794, "user_id": 67579, "user_type": "registered", "accept_rate": 81, "profile_image": "https://i.stack.imgur.com/BJXub.png?s=128&g=1", "display_name": "Willem Van Onsem", "link": "https://stackoverflow.com/users/67579/willem-van-onsem"}, "edited": false, "score": 0, "creation_date": 1485002763, "post_id": 41779339, "comment_id": 70749391, "body": "I find it a bit odd that you return a tuple of three values. Why do you need to calculate return these three?"}], "answers": [{"tags": [], "owner": {"reputation": 11612, "user_id": 204218, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/3ee571049ff6ff0361be53e554b877e6?s=128&d=identicon&r=PG", "display_name": "adamse", "link": "https://stackoverflow.com/users/204218/adamse"}, "is_accepted": false, "score": 3, "last_activity_date": 1485003944, "last_edit_date": 1485003944, "creation_date": 1485002168, "answer_id": 41779425, "question_id": 41779339, "link": "https://stackoverflow.com/questions/41779339/haskell-euclid-algorithm-greatest-common-divisors-of-two-integers/41779425#41779425", "title": "Haskell euclid algorithm greatest common divisors of two integers", "body": "<p>To use functions as infix operators you need to surround them with <code>`</code>, not <code>'</code>:</p>\n\n<pre><code>eGCD :: Integer -&gt; Integer -&gt; (Integer, Integer, Integer)\neGCD 0 b = (b, 0, 1)\neGCD a b = let (g, s, t) = eGCD (b `mod` a) a\n       in (g, t - (b `div` a) * s, s)\n</code></pre>\n\n<p><code>'</code> are used for character literals.</p>\n"}, {"tags": [], "owner": {"reputation": 314794, "user_id": 67579, "user_type": "registered", "accept_rate": 81, "profile_image": "https://i.stack.imgur.com/BJXub.png?s=128&g=1", "display_name": "Willem Van Onsem", "link": "https://stackoverflow.com/users/67579/willem-van-onsem"}, "is_accepted": false, "score": 3, "last_activity_date": 1485016373, "last_edit_date": 1485016373, "creation_date": 1485003217, "answer_id": 41779598, "question_id": 41779339, "link": "https://stackoverflow.com/questions/41779339/haskell-euclid-algorithm-greatest-common-divisors-of-two-integers/41779598#41779598", "title": "Haskell euclid algorithm greatest common divisors of two integers", "body": "<p>@adamse already answered the solution to the syntax error: backquotes (<code>`</code>) should be used instead of single quotes (<code>'</code>) for infix operators.</p>\n\n<p>Nevertheless it is strange you return three integers? Based on the quoted question, the following program should do:</p>\n\n<pre><code>eGCD :: Integer -&gt; Integer -&gt; Integer\neGCD 0 b = b\neGCD a b = eGCD (b `mod` a) a\n</code></pre>\n\n<p>This also allows the use of <em>tail recursion</em> which will probably improve the program's performance.</p>\n\n<p>Finally you can <em>generalize</em> your program by using the <code>Integral</code> class instead of integers:</p>\n\n<pre><code>eGCD :: Integral i =&gt; i -&gt; i -&gt; i\neGCD 0 b = b\neGCD a b = eGCD (b `mod` a) a\n</code></pre>\n\n<p>This works since <code>0</code> is a <code>Num</code> (and <code>Integral</code> is a <code>Num</code>) and <code>mod</code> can operate on any kind of types <code>i</code> that are <code>Integral</code>.</p>\n"}], "owner": {"reputation": 71, "user_id": 7312363, "user_type": "registered", "accept_rate": 0, "profile_image": "https://www.gravatar.com/avatar/a7a3433b26cc5a4309e199fd68b3ecfc?s=128&d=identicon&r=PG&f=1", "display_name": "bindubill", "link": "https://stackoverflow.com/users/7312363/bindubill"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 2104, "favorite_count": 0, "answer_count": 2, "score": 2, "last_activity_date": 1485016373, "creation_date": 1485001660, "last_edit_date": 1485002737, "question_id": 41779339, "link": "https://stackoverflow.com/questions/41779339/haskell-euclid-algorithm-greatest-common-divisors-of-two-integers", "title": "Haskell euclid algorithm greatest common divisors of two integers", "body": "<blockquote>\n  <p>Write a Haskell program egcd using Euclid's algorithm to to determine the greatest common divisor of two integers</p>\n</blockquote>\n\n<p>My program:</p>\n\n<pre><code>eGCD :: Integer -&gt; Integer -&gt; (Integer, Integer, Integer)\neGCD 0 b = (b, 0, 1)\neGCD a b = let (g, s, t) = eGCD (b 'mod' a) a\n       in (g, t - (b 'div' a) * s, s)\n</code></pre>\n\n<p>but  when run it in WinGHCI, it errors:</p>\n\n<pre><code> Prelude&gt; :load C:\\HaskellProject\\egcd.hs\n\n C:\\HaskellProject\\egcd.hs:3:36: error:\n    ? Syntax error on 'mod'\n      Perhaps you intended to use TemplateHaskell or TemplateHaskellQuotes\n    ? In the Template Haskell quotation 'mod'\n    [1 of 1] Compiling Main             ( C:\\HaskellProject\\egcd.hs, interpreted )\n Failed, modules loaded: none.\n</code></pre>\n"}, {"tags": ["haskell"], "comments": [{"owner": {"reputation": 314794, "user_id": 67579, "user_type": "registered", "accept_rate": 81, "profile_image": "https://i.stack.imgur.com/BJXub.png?s=128&g=1", "display_name": "Willem Van Onsem", "link": "https://stackoverflow.com/users/67579/willem-van-onsem"}, "edited": false, "score": 0, "creation_date": 1484999197, "post_id": 41778853, "comment_id": 70748381, "body": "@YassineBotabia: changing it to <code>||</code> would in fact change the semantics and generate errors. Furthemore the error is not with the <code>x = </code> on the first line, but the one on the second line."}, {"owner": {"reputation": 109, "user_id": 6917467, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/8d2aa2193b4faf2f3a08b1faa9ec4aea?s=128&d=identicon&r=PG&f=1", "display_name": "Yassine Boutabia", "link": "https://stackoverflow.com/users/6917467/yassine-boutabia"}, "reply_to_user": {"reputation": 314794, "user_id": 67579, "user_type": "registered", "accept_rate": 81, "profile_image": "https://i.stack.imgur.com/BJXub.png?s=128&g=1", "display_name": "Willem Van Onsem", "link": "https://stackoverflow.com/users/67579/willem-van-onsem"}, "edited": false, "score": 0, "creation_date": 1485001027, "post_id": 41778853, "comment_id": 70748896, "body": "I realized shortly after puting. that&#39;s true."}], "answers": [{"comments": [{"owner": {"reputation": 109, "user_id": 6917467, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/8d2aa2193b4faf2f3a08b1faa9ec4aea?s=128&d=identicon&r=PG&f=1", "display_name": "Yassine Boutabia", "link": "https://stackoverflow.com/users/6917467/yassine-boutabia"}, "edited": false, "score": 0, "creation_date": 1485000218, "post_id": 41778928, "comment_id": 70748684, "body": "Thanks you so much for your help."}], "tags": [], "owner": {"reputation": 100185, "user_id": 3234959, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/93bb12ca0f93dfddb33880316f7e66c2?s=128&d=identicon&r=PG&f=1", "display_name": "chi", "link": "https://stackoverflow.com/users/3234959/chi"}, "is_accepted": true, "score": 4, "last_activity_date": 1484999093, "creation_date": 1484999093, "answer_id": 41778928, "question_id": 41778853, "link": "https://stackoverflow.com/questions/41778853/haskell-if-else-statement-with-multiple-conditions/41778928#41778928", "title": "haskell if else statement with multiple conditions", "body": "<p>Just remove <code>x =</code>. (Why did you write that?)</p>\n\n<pre><code>list = [\"Jan\",\"Feb\",\"Mar\",\"April\",\"May\",\"Jun\",\"Jul\",\"Aug\",\"Sep\",\"Oct\",\"Nov\",\"Dec\"]\nmonth x = if x&lt;13 &amp;&amp; x&gt;0\n          then list !! (x-1)\n          else \"Not a month\"\n</code></pre>\n"}, {"comments": [{"owner": {"reputation": 109, "user_id": 6917467, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/8d2aa2193b4faf2f3a08b1faa9ec4aea?s=128&d=identicon&r=PG&f=1", "display_name": "Yassine Boutabia", "link": "https://stackoverflow.com/users/6917467/yassine-boutabia"}, "edited": false, "score": 0, "creation_date": 1485000192, "post_id": 41778941, "comment_id": 70748675, "body": "Thank you so much. x= was my error. and you are right I just started functional programming."}], "tags": [], "owner": {"reputation": 314794, "user_id": 67579, "user_type": "registered", "accept_rate": 81, "profile_image": "https://i.stack.imgur.com/BJXub.png?s=128&g=1", "display_name": "Willem Van Onsem", "link": "https://stackoverflow.com/users/67579/willem-van-onsem"}, "is_accepted": false, "score": 2, "last_activity_date": 1485002540, "last_edit_date": 1485002540, "creation_date": 1484999136, "answer_id": 41778941, "question_id": 41778853, "link": "https://stackoverflow.com/questions/41778853/haskell-if-else-statement-with-multiple-conditions/41778941#41778941", "title": "haskell if else statement with multiple conditions", "body": "<p>Well you write:</p>\n\n<pre>\nmonth x = if x0\n          then <b>x = </b>list !! (x-1)\n          else \"Not a month\"\n</pre>\n\n<p>You probably are used to the imperative world (C++, Java,...) where there are <em>variables</em> that you can set and set to other values. In a functional and by extent declarative language, a variable is only set once.</p>\n\n<p>Furthermore there is no need to set <code>x</code> to a value, you only have to return <code>list!!(x-1)</code> so:</p>\n\n<pre><code>month x = if x&lt;13 &amp;&amp; x&gt;0\n          then list !! (x-1)\n          else \"Not a month\"\n</code></pre>\n\n<p>should work.</p>\n\n<p>An - in my opinion - more elegant way to write this however is using guards:</p>\n\n<pre><code>month x | x &gt; 0 &amp;&amp; x &lt; 13 = list !! (x-1)\n        | otherwise = \"not a month\"\n</code></pre>\n"}, {"comments": [{"owner": {"reputation": 109, "user_id": 6917467, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/8d2aa2193b4faf2f3a08b1faa9ec4aea?s=128&d=identicon&r=PG&f=1", "display_name": "Yassine Boutabia", "link": "https://stackoverflow.com/users/6917467/yassine-boutabia"}, "edited": false, "score": 0, "creation_date": 1485001351, "post_id": 41779082, "comment_id": 70748988, "body": "Thank you Barbra, you comments are very helpful ."}, {"owner": {"reputation": 384463, "user_id": 1126841, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/fa05233b2357f8d11c22ef4cfc7bb85c?s=128&d=identicon&r=PG", "display_name": "chepner", "link": "https://stackoverflow.com/users/1126841/chepner"}, "edited": false, "score": 1, "creation_date": 1485006549, "post_id": 41779082, "comment_id": 70750473, "body": "<code>Maybe String</code> should absolutely be used here, since <code>&quot;Not a month&quot;</code> is not, in fact, a month."}], "tags": [], "owner": {"reputation": 2691, "user_id": 5477287, "user_type": "registered", "accept_rate": 87, "profile_image": "https://i.stack.imgur.com/yKMgF.jpg?s=128&g=1", "display_name": "Babra Cunningham", "link": "https://stackoverflow.com/users/5477287/babra-cunningham"}, "is_accepted": false, "score": 3, "last_activity_date": 1485000869, "last_edit_date": 1485000869, "creation_date": 1484999942, "answer_id": 41779082, "question_id": 41778853, "link": "https://stackoverflow.com/questions/41778853/haskell-if-else-statement-with-multiple-conditions/41779082#41779082", "title": "haskell if else statement with multiple conditions", "body": "<p>Using guards is the best strategy here:</p>\n\n<pre><code>month x | x &gt; 0 &amp;&amp; x &lt; 13      = list !! (x - 1)\n        |otherwise             = \"Error\"\n</code></pre>\n\n<p>You could also use <code>Maybe</code> for this type of operation:</p>\n\n<pre><code>mylist = [\"Jan\",\"Feb\",\"Mar\",\"April\", \"May\", \"Jun\",\"Jul\",\"Aug\",\"Sep\",\"Oct\",\"Nov\",\"Dec\"]\n\nexampleFunc :: [String] -&gt; Int -&gt; Maybe String\nexampleFunc li int\n   | int &gt; 0 &amp;&amp; int &lt; 13    = Just (li !! (int - 1))\n   | otherwise              = Nothing\n</code></pre>\n\n<p>Using <code>Maybe</code> allows you to return a standard value (<code>Nothing</code>) in the event of an <code>otherwise</code> condition.</p>\n"}, {"tags": [], "owner": {"reputation": 893, "user_id": 6248287, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/tPegr.jpg?s=128&g=1", "display_name": "\u019b\u019b\u019b", "link": "https://stackoverflow.com/users/6248287/%c6%9b%c6%9b%c6%9b"}, "is_accepted": false, "score": 1, "last_activity_date": 1485014130, "creation_date": 1485014130, "answer_id": 41781371, "question_id": 41778853, "link": "https://stackoverflow.com/questions/41778853/haskell-if-else-statement-with-multiple-conditions/41781371#41781371", "title": "haskell if else statement with multiple conditions", "body": "<p>You can also write it like this:</p>\n\n<pre><code>month = [\"Jan\",\"Feb\",\"Mar\",\"April\", \"May\", \"Jun\",\"Jul\",\"Aug\",\"Sep\",\"Oct\",\"Nov\",\"Dec\"]\ngetMonth k = lookup k $ zip [1..] month\n</code></pre>\n"}], "owner": {"reputation": 109, "user_id": 6917467, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/8d2aa2193b4faf2f3a08b1faa9ec4aea?s=128&d=identicon&r=PG&f=1", "display_name": "Yassine Boutabia", "link": "https://stackoverflow.com/users/6917467/yassine-boutabia"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 637, "favorite_count": 0, "accepted_answer_id": 41778928, "answer_count": 4, "score": 0, "last_activity_date": 1485014130, "creation_date": 1484998638, "question_id": 41778853, "link": "https://stackoverflow.com/questions/41778853/haskell-if-else-statement-with-multiple-conditions", "title": "haskell if else statement with multiple conditions", "body": "<p>the goal is to Write a function that, given an integer between 1 and 12 evaluates to the name of the related month (1->January, etc.) Else, it may evaluate to \"Incorrect month number\".\nThis is my code:</p>\n\n<pre><code>list = [\"Jan\",\"Feb\",\"Mar\",\"April\", \"May\", \"Jun\",\"Jul\",\"Aug\",\"Sep\",\"Oct\",\"Nov\",\"Dec\"]\nmonth x = if x&lt;13 &amp;&amp; x&gt;0\n          then x = list !! (x-1)\n          else \"Not a month\"\n</code></pre>\n\n<p>this is the error msg: parse error on input \"=\"</p>\n\n<p>Many thanks for your help</p>\n"}, {"tags": ["haskell"], "comments": [{"owner": {"reputation": 40537, "user_id": 465378, "user_type": "registered", "accept_rate": 85, "profile_image": "https://www.gravatar.com/avatar/c03b8d34978563858020eff0d14cc17b?s=128&d=identicon&r=PG", "display_name": "Alexis King", "link": "https://stackoverflow.com/users/465378/alexis-king"}, "edited": false, "score": 3, "creation_date": 1484995659, "post_id": 41778406, "comment_id": 70747415, "body": "The second line in your <code>do</code> block isn\u2019t doing any I/O, so the result is pure, and you shouldn\u2019t use the <code>&lt;-</code> to indicate a monadic bind. Instead, write <code>let sUp = [toUpper c | c &lt;- s]</code>, or even better, ditch the list comprehension and just write <code>let sUp = map toUpper s</code>."}], "answers": [{"comments": [{"owner": {"reputation": 40537, "user_id": 465378, "user_type": "registered", "accept_rate": 85, "profile_image": "https://www.gravatar.com/avatar/c03b8d34978563858020eff0d14cc17b?s=128&d=identicon&r=PG", "display_name": "Alexis King", "link": "https://stackoverflow.com/users/465378/alexis-king"}, "edited": false, "score": 5, "creation_date": 1484996258, "post_id": 41778470, "comment_id": 70747573, "body": "I\u2019m not entirely convinced the latter example is \u201cmore Haskell style\u201d, though it might appeal to a specific subgroup of Haskellers. I think the first is more clear, especially for a learner, though I would still suggest <code>map</code> over the list comprehension."}, {"owner": {"reputation": 314794, "user_id": 67579, "user_type": "registered", "accept_rate": 81, "profile_image": "https://i.stack.imgur.com/BJXub.png?s=128&g=1", "display_name": "Willem Van Onsem", "link": "https://stackoverflow.com/users/67579/willem-van-onsem"}, "reply_to_user": {"reputation": 40537, "user_id": 465378, "user_type": "registered", "accept_rate": 85, "profile_image": "https://www.gravatar.com/avatar/c03b8d34978563858020eff0d14cc17b?s=128&d=identicon&r=PG", "display_name": "Alexis King", "link": "https://stackoverflow.com/users/465378/alexis-king"}, "edited": false, "score": 1, "creation_date": 1484996413, "post_id": 41778470, "comment_id": 70747605, "body": "@AlexisKing: I provided some information regarding <code>map</code> and <code>&gt;&gt;=</code>. Furthermore note that a significant part of the Haskell community <a href=\"https://wiki.haskell.org/Do_notation_considered_harmful\" rel=\"nofollow noreferrer\">*considers <code>do</code> harmful</a>. It gives the idea that <code>do</code> is something special whereas it is only monadic calls behind the curtains."}, {"owner": {"reputation": 40537, "user_id": 465378, "user_type": "registered", "accept_rate": 85, "profile_image": "https://www.gravatar.com/avatar/c03b8d34978563858020eff0d14cc17b?s=128&d=identicon&r=PG", "display_name": "Alexis King", "link": "https://stackoverflow.com/users/465378/alexis-king"}, "edited": false, "score": 2, "creation_date": 1484996551, "post_id": 41778470, "comment_id": 70747644, "body": "I think that wiki article\u2019s existence does indeed demonstrate that <i>some</i> people in the Haskell community consider <code>do</code> harmful, but a single wiki page doesn\u2019t give much indication that a \u201csignificant portion\u201d agrees with its contents. It\u2019s a wiki, after all."}, {"owner": {"reputation": 314794, "user_id": 67579, "user_type": "registered", "accept_rate": 81, "profile_image": "https://i.stack.imgur.com/BJXub.png?s=128&g=1", "display_name": "Willem Van Onsem", "link": "https://stackoverflow.com/users/67579/willem-van-onsem"}, "reply_to_user": {"reputation": 40537, "user_id": 465378, "user_type": "registered", "accept_rate": 85, "profile_image": "https://www.gravatar.com/avatar/c03b8d34978563858020eff0d14cc17b?s=128&d=identicon&r=PG", "display_name": "Alexis King", "link": "https://stackoverflow.com/users/465378/alexis-king"}, "edited": false, "score": 0, "creation_date": 1484996799, "post_id": 41778470, "comment_id": 70747721, "body": "@AlexisKing: see also <a href=\"http://syntaxfree.wordpress.com/2006/12/12/do-notation-considered-harmful/\" rel=\"nofollow noreferrer\">this</a>, and <a href=\"http://stackoverflow.com/questions/16726659/should-do-notation-be-avoided-in-haskell\">this</a>. I think the main problem with <code>do</code> is that people first of all think that monads are only useful for IO, etc. whereas one can do impressive things with them from the moment they realize it is all functional programming behind it."}, {"owner": {"reputation": 40537, "user_id": 465378, "user_type": "registered", "accept_rate": 85, "profile_image": "https://www.gravatar.com/avatar/c03b8d34978563858020eff0d14cc17b?s=128&d=identicon&r=PG", "display_name": "Alexis King", "link": "https://stackoverflow.com/users/465378/alexis-king"}, "edited": false, "score": 7, "creation_date": 1484997036, "post_id": 41778470, "comment_id": 70747785, "body": "I don\u2019t take umbrage at the alternative suggestion, I just think implying that much of the Haskell community finds <code>do</code> unidiomatic and something to be avoided is misleading. Your second example has another implicit transformation in it, which removes the explicit binding of <code>s</code>. As a rather seasoned Haskeller, I would probably write it your way, but I would not have any problem with the version using <code>do</code>, and I think it is overzealous to suggest that someone is not writing \u201creal\u201d Haskell if they use <code>do</code>."}, {"owner": {"reputation": 13734, "user_id": 938694, "user_type": "registered", "accept_rate": 59, "profile_image": "https://www.gravatar.com/avatar/b6678a430a805dd78366d6e135b49f2d?s=128&d=identicon&r=PG", "display_name": "Cubic", "link": "https://stackoverflow.com/users/938694/cubic"}, "edited": false, "score": 1, "creation_date": 1484998874, "post_id": 41778470, "comment_id": 70748267, "body": "There&#39;s nothing wrong with <code>do</code>, the problem is primarily with its usage in <i>teaching</i>. If you understand how the <code>do</code> syntax operates there&#39;s no reason not to use it, it <i>is</i> much more convenient for writing and reading most of the time."}, {"owner": {"reputation": 384463, "user_id": 1126841, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/fa05233b2357f8d11c22ef4cfc7bb85c?s=128&d=identicon&r=PG", "display_name": "chepner", "link": "https://stackoverflow.com/users/1126841/chepner"}, "edited": false, "score": 1, "creation_date": 1485006977, "post_id": 41778470, "comment_id": 70750615, "body": "@WillemVanOnsem One of your links for evidence that <code>do</code> is considered harmful is a Stack Overflow question asking if it is harmful, and <i>none</i> of the answers support that conclusion, and to the contrary point out that <code>do</code> makes longer monadic compositions more readable."}], "tags": [], "owner": {"reputation": 314794, "user_id": 67579, "user_type": "registered", "accept_rate": 81, "profile_image": "https://i.stack.imgur.com/BJXub.png?s=128&g=1", "display_name": "Willem Van Onsem", "link": "https://stackoverflow.com/users/67579/willem-van-onsem"}, "is_accepted": true, "score": 0, "last_activity_date": 1484998991, "last_edit_date": 1484998991, "creation_date": 1484995912, "answer_id": 41778470, "question_id": 41778406, "link": "https://stackoverflow.com/questions/41778406/couldnt-convert-an-io-string-to-char-in-haskell/41778470#41778470", "title": "Couldn&#39;t convert an IO String to [Char] in Haskell", "body": "<p>The second line is not an IO Monadic operation, it is simply list comprehension, so you should write it as:</p>\n\n<pre><code>import Data.Char\n\nioFile f1 f2 = do\n            s &lt;- readFile f1\n            writeFile f2 [toUpper c | c &lt;- s]\n</code></pre>\n\n<p>A significant part of the Haskell community however <a href=\"https://wiki.haskell.org/Do_notation_considered_harmful\" rel=\"nofollow noreferrer\">considers <code>do</code> harmful</a> and thus would prefer to see:</p>\n\n<pre><code>ioFile f1 f2 = readFile f1 &gt;&gt;= \\s -&gt; writeFile f2 $ map toUpper s\n</code></pre>\n\n<p>or even shorter:</p>\n\n<pre><code>ioFile f1 f2 = readFile f1 &gt;&gt;= writeFile f2 . map toUpper\n</code></pre>\n\n<p>with <a href=\"http://hackage.haskell.org/packages/archive/base/latest/doc/html/Prelude.html#v:map\" rel=\"nofollow noreferrer\"><code>map :: (a -&gt; b) -&gt; [a] -&gt; [b]</code></a> you apply the given function (in this case <code>toUpper</code>) to every element of the given list and generate a list of results. <a href=\"http://hackage.haskell.org/packages/archive/base/latest/doc/html/Prelude.html#v:-62--62--61-\" rel=\"nofollow noreferrer\"><code>(&gt;&gt;=) :: Monad m =&gt; m a -&gt; (a -&gt; m b) -&gt; m b</code></a> informally is equivalent to calling the given right operand function on the \"result\" of the left monad. So <code>c &gt;&gt;= f</code> is equivalent to:</p>\n\n<pre><code>do\n    x &lt;- c\n    f x\n</code></pre>\n"}, {"tags": [], "owner": {"reputation": 13734, "user_id": 938694, "user_type": "registered", "accept_rate": 59, "profile_image": "https://www.gravatar.com/avatar/b6678a430a805dd78366d6e135b49f2d?s=128&d=identicon&r=PG", "display_name": "Cubic", "link": "https://stackoverflow.com/users/938694/cubic"}, "is_accepted": false, "score": 2, "last_activity_date": 1484998775, "creation_date": 1484998775, "answer_id": 41778878, "question_id": 41778406, "link": "https://stackoverflow.com/questions/41778406/couldnt-convert-an-io-string-to-char-in-haskell/41778878#41778878", "title": "Couldn&#39;t convert an IO String to [Char] in Haskell", "body": "<p>You can't bind a 'pure' value like <code>sUp &lt;- [toUpper c | c &lt;- s]</code> this way. Note that unlike what the accepted answer does suggest, that doesn't mean you can't give it a name. For one, there's the <code>return</code> function that lifts a pure value to <code>IO</code> (or any monad really, but we're in <code>IO</code> right now), so <code>sUp &lt;- return [toUpper c | c &lt;- s]</code> <em>does</em> work. There's also a variant of the let syntax that pretty much does that: <code>let sUp = [toUpper c  | c &lt;- s]</code>.</p>\n"}], "owner": {"reputation": 91, "user_id": 6542453, "user_type": "registered", "accept_rate": 56, "profile_image": "https://www.gravatar.com/avatar/ecc896c6aac5ea73c520da4d6b79f4c3?s=128&d=identicon&r=PG&f=1", "display_name": "user6542453", "link": "https://stackoverflow.com/users/6542453/user6542453"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 350, "favorite_count": 0, "accepted_answer_id": 41778470, "answer_count": 2, "score": 0, "last_activity_date": 1484998991, "creation_date": 1484995541, "question_id": 41778406, "link": "https://stackoverflow.com/questions/41778406/couldnt-convert-an-io-string-to-char-in-haskell", "title": "Couldn&#39;t convert an IO String to [Char] in Haskell", "body": "<p>I wrote this simple function that takes two file names (String) and wrote the content of the first file into the second file applying <code>toUpper</code> to each character.</p>\n\n<pre><code>import Data.Char\n\nioFile f1 f2 = do\n            s &lt;- readFile f1\n            sUp &lt;- [toUpper c | c &lt;- s]\n            writeFile f2 sUp\n</code></pre>\n\n<p>But the interpreter raise an error</p>\n\n<pre><code>Couldn't match expected type \u2018IO String\u2019 with actual type \u2018[Char]\u2019\nIn a stmt of a 'do' block: sUp &lt;- [toUpper c | c &lt;- s]\nIn the expression:\n  do { s &lt;- readFile f1;\n       sUp &lt;- [toUpper c | c &lt;- s];\n       writeFile f2 sUp }\nIn an equation for \u2018ioFile\u2019:\n    ioFile f1 f2\n      = do { s &lt;- readFile f1;\n             sUp &lt;- [toUpper c | c &lt;- s];\n             writeFile f2 sUp }\n</code></pre>\n\n<p>How can I use <code>s</code> as a <code>[Char]</code> instead of <code>IO String</code>?</p>\n"}, {"tags": ["haskell", "haddock", "type-kinds", "polykinds"], "answers": [{"comments": [{"owner": {"reputation": 100185, "user_id": 3234959, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/93bb12ca0f93dfddb33880316f7e66c2?s=128&d=identicon&r=PG&f=1", "display_name": "chi", "link": "https://stackoverflow.com/users/3234959/chi"}, "edited": false, "score": 2, "creation_date": 1484995217, "post_id": 41778294, "comment_id": 70747282, "body": "Agreed, I also consider this a bug. Maybe using <code>Category @k (Coercion k)</code> would be a better notation."}, {"owner": {"reputation": 24028, "user_id": 383200, "user_type": "registered", "accept_rate": 60, "profile_image": "https://www.gravatar.com/avatar/a9dc722f936cb1059adaae4fe39c07f0?s=128&d=identicon&r=PG", "display_name": "Carl", "link": "https://stackoverflow.com/users/383200/carl"}, "edited": false, "score": 0, "creation_date": 1485031823, "post_id": 41778294, "comment_id": 70758628, "body": "There are cases where it needs to specify the kind of type variables that aren&#39;t present in the type.  That combination makes it really hard to find a sane way to document."}], "tags": [], "owner": {"reputation": 40537, "user_id": 465378, "user_type": "registered", "accept_rate": 85, "profile_image": "https://www.gravatar.com/avatar/c03b8d34978563858020eff0d14cc17b?s=128&d=identicon&r=PG", "display_name": "Alexis King", "link": "https://stackoverflow.com/users/465378/alexis-king"}, "is_accepted": true, "score": 5, "last_activity_date": 1484994956, "last_edit_date": 1592644375, "creation_date": 1484994956, "answer_id": 41778294, "question_id": 41778182, "link": "https://stackoverflow.com/questions/41778182/what-does-star-or-other-kinds-mean-in-an-instance-list-of-haddock/41778294#41778294", "title": "What does * (star) or other kinds mean in an instance list of haddock", "body": "<p><a href=\"https://mail.haskell.org/pipermail/haskell-cafe/2017-January/125985.html\" rel=\"noreferrer\">To quote Richard Eisenberg\u2019s recent post on the haskell-cafe mailing list</a>:</p>\n<blockquote>\n<p>Haddock struggles sometimes to render types with <code>-XPolyKinds</code> enabled. The problem is that GHC generally does not require kind arguments to be written and it does not print them out (unless you say <code>-fprint-explicit-kinds</code>). But Haddock, I believe, prints out kinds whenever <code>-XPolyKinds</code> is on. So the two different definitions are really the same: it's just that one module has <code>-XPolyKinds</code> and the other doesn't.</p>\n<p>The <code>*</code> is the kind of ordinary types. So <code>Int</code> has kind <code>*</code> (we write <code>Int :: *</code>) while <code>Maybe</code> has kind <code>* -&gt; *</code>. <code>Typeable</code> actually has kind <code>forall k. k -&gt; Constraint</code>, meaning that it's polykinded. In the first snippet below, the <code>*</code> argument to <code>Typeable</code> instantiates <code>k</code> with <code>*</code>, because type variable a has kind <code>*</code>.</p>\n</blockquote>\n<p>So yes, as you guessed, it has to do with <code>PolyKinds</code>. Haddock renders these poly-kinded types with a sort of \u201cexplicit kind application\u201d. It just so happens that <code>Category</code> is poly-kinded, having the kind <code>forall k. (k -&gt; k -&gt; *) -&gt; Constraint</code>, so Haddock renders the kind application alongside each instance.</p>\n<p>In my opinion, this is a bug or misfeature of Haddock, since there is no equivalent source code analog as far as I know. It is confusing, and I don\u2019t know of a better way to understand it than to recognize the way it usually manifests and visually infer what\u2019s going on from the context.</p>\n"}], "owner": {"reputation": 2226, "user_id": 2246434, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/bTuEI.jpg?s=128&g=1", "display_name": "Julia Path", "link": "https://stackoverflow.com/users/2246434/julia-path"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 352, "favorite_count": 0, "accepted_answer_id": 41778294, "answer_count": 1, "score": 6, "last_activity_date": 1484996751, "creation_date": 1484994196, "last_edit_date": 1484996751, "question_id": 41778182, "link": "https://stackoverflow.com/questions/41778182/what-does-star-or-other-kinds-mean-in-an-instance-list-of-haddock", "title": "What does * (star) or other kinds mean in an instance list of haddock", "body": "<p>Browsing the haddocks of various packages I often come along instance documentations that look like this (<a href=\"https://hackage.haskell.org/package/base-4.9.0.0/docs/Control-Category.html\" rel=\"nofollow noreferrer\">Control.Category</a>):</p>\n\n<pre><code>Category k (Coercion k)\nCategory * (-&gt;)\n</code></pre>\n\n<p>or this (<a href=\"https://hackage.haskell.org/package/transformers-0.5.2.0/docs/Control-Monad-Trans-Identity.html\" rel=\"nofollow noreferrer\">Control.Monad.Trans.Identity</a>):</p>\n\n<pre><code>MonadTrans (IdentityT *)\n</code></pre>\n\n<p>What exactly here does the kind signature mean? It doesn't show up in the source, but I have already noticed that it seems to occur in modules that use the <em>PolyKinds</em> extension. I suspect it is probably like a TypeApplication but with a kind. So that e.g. the last example means that <code>IdentityT</code> is a monad transformer if it's first argument has kind <code>*</code>.</p>\n\n<p>So my questions are:</p>\n\n<ul>\n<li>Is my interpretation correct and what exactly does the kind signature refer to?</li>\n<li>In the first <code>Category</code> instance, how am I supposed to know that <code>k</code> is a kind and not a type? Or do I just have to know the arity of <code>Category</code>?</li>\n<li>What is the source code analog to this syntax?</li>\n</ul>\n\n<p>I am not asking for an explanation of kinds.</p>\n"}, {"tags": ["haskell", "memory"], "comments": [{"owner": {"reputation": 29966, "user_id": 637669, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/0227e5d5eaceb8ae2f751df38d421764?s=128&d=identicon&r=PG", "display_name": "arrowd", "link": "https://stackoverflow.com/users/637669/arrowd"}, "edited": false, "score": 0, "creation_date": 1484991113, "post_id": 41777675, "comment_id": 70746155, "body": "I suspect this is because <code>Bool</code> is a boxed type."}, {"owner": {"reputation": 3392, "user_id": 7175117, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/Tfz44.png?s=128&g=1", "display_name": "freestyle", "link": "https://stackoverflow.com/users/7175117/freestyle"}, "edited": false, "score": 3, "creation_date": 1484991545, "post_id": 41777675, "comment_id": 70746273, "body": "Maybe it because traditionally boolean type in C is int."}, {"owner": {"reputation": 3392, "user_id": 7175117, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/Tfz44.png?s=128&g=1", "display_name": "freestyle", "link": "https://stackoverflow.com/users/7175117/freestyle"}, "edited": false, "score": 0, "creation_date": 1484991867, "post_id": 41777675, "comment_id": 70746349, "body": "And really you need a bit to store boolean value, so a byte is big too."}, {"owner": {"reputation": 100185, "user_id": 3234959, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/93bb12ca0f93dfddb33880316f7e66c2?s=128&d=identicon&r=PG&f=1", "display_name": "chi", "link": "https://stackoverflow.com/users/3234959/chi"}, "edited": false, "score": 2, "creation_date": 1484994810, "post_id": 41777675, "comment_id": 70747169, "body": "Even in C99 there&#39;s a <code>_Bool</code> type whose size is &gt;=1. New GCCs define that as 1, but pre-C99 GCCs defined <code>typedef int _Bool</code>, making it whatever <code>sizeof(int)</code> is on your system, 4 is common."}, {"owner": {"reputation": 100892, "user_id": 745903, "user_type": "registered", "accept_rate": 74, "profile_image": "https://www.gravatar.com/avatar/50933f6638836741e620669b3940410e?s=128&d=identicon&r=PG", "display_name": "leftaroundabout", "link": "https://stackoverflow.com/users/745903/leftaroundabout"}, "reply_to_user": {"reputation": 3392, "user_id": 7175117, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/Tfz44.png?s=128&g=1", "display_name": "freestyle", "link": "https://stackoverflow.com/users/7175117/freestyle"}, "edited": false, "score": 0, "creation_date": 1508231092, "post_id": 41777675, "comment_id": 80519064, "body": "@freestyle re \u201ca byte is big too\u201d \u2013 the C++ Standard Template Library found it a good idea to <a href=\"http://en.cppreference.com/w/cpp/container/vector_bool\" rel=\"nofollow noreferrer\">\u201coptimise\u201d vectors of bool</a> for this reason, so each element would asymptotically only take up one bit. This turned out to be a major headache in many applications and is now widely considered to have been a bad idea. (I reckon it would be less problematic in Haskell, though, but then, we don&#39;t like booleans very much anyway, so...)"}, {"owner": {"reputation": 3392, "user_id": 7175117, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/Tfz44.png?s=128&g=1", "display_name": "freestyle", "link": "https://stackoverflow.com/users/7175117/freestyle"}, "reply_to_user": {"reputation": 100892, "user_id": 745903, "user_type": "registered", "accept_rate": 74, "profile_image": "https://www.gravatar.com/avatar/50933f6638836741e620669b3940410e?s=128&d=identicon&r=PG", "display_name": "leftaroundabout", "link": "https://stackoverflow.com/users/745903/leftaroundabout"}, "edited": false, "score": 0, "creation_date": 1508242947, "post_id": 41777675, "comment_id": 80526332, "body": "@leftaroundabout I don&#39;t know exactly why in C++ the vector of <code>Bool</code> led to the problem, but I assume that this is because the interface assumed the possibility of addressing (by the pointer or C++ reference) the element of the vector, which is not possible in a simple way if elements stored as bit sequence. But in Haskell we addressing to element by it index and I believe we can represent <code>vector Bool</code> as bit sequence. But is it necessary? I don&#39;t know."}], "answers": [{"comments": [{"owner": {"reputation": 100185, "user_id": 3234959, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/93bb12ca0f93dfddb33880316f7e66c2?s=128&d=identicon&r=PG&f=1", "display_name": "chi", "link": "https://stackoverflow.com/users/3234959/chi"}, "edited": false, "score": 2, "creation_date": 1484994894, "post_id": 41778237, "comment_id": 70747187, "body": "I winder why that was chosen, though, when <code>char</code> would have been fine for that."}, {"owner": {"reputation": 19480, "user_id": 2491900, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/W8FMW.jpg?s=128&g=1", "display_name": "shree.pat18", "link": "https://stackoverflow.com/users/2491900/shree-pat18"}, "reply_to_user": {"reputation": 100185, "user_id": 3234959, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/93bb12ca0f93dfddb33880316f7e66c2?s=128&d=identicon&r=PG&f=1", "display_name": "chi", "link": "https://stackoverflow.com/users/3234959/chi"}, "edited": false, "score": 0, "creation_date": 1484995111, "post_id": 41778237, "comment_id": 70747253, "body": "@chi Yeah, I&#39;ve been trying to check if there&#39;s anything in the mailing lists/other places about the choice"}, {"owner": {"reputation": 1972, "user_id": 1747134, "user_type": "registered", "accept_rate": 93, "profile_image": "https://www.gravatar.com/avatar/696bad3bd2c5e16ded04f3cdf436623f?s=128&d=identicon&r=PG", "display_name": "user1747134", "link": "https://stackoverflow.com/users/1747134/user1747134"}, "edited": false, "score": 0, "creation_date": 1484995735, "post_id": 41778237, "comment_id": 70747438, "body": "So maybe I could rephrase the orignal question to: Why it&#39;s not <code>sizeOf _ = sizeOf (undefined::HTYPE_CHAR)</code>?"}, {"owner": {"reputation": 19480, "user_id": 2491900, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/W8FMW.jpg?s=128&g=1", "display_name": "shree.pat18", "link": "https://stackoverflow.com/users/2491900/shree-pat18"}, "edited": false, "score": 0, "creation_date": 1484995776, "post_id": 41778237, "comment_id": 70747450, "body": "In which case, I suppose you would need to contact the creators (not sure if they are on SO)"}], "tags": [], "owner": {"reputation": 19480, "user_id": 2491900, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/W8FMW.jpg?s=128&g=1", "display_name": "shree.pat18", "link": "https://stackoverflow.com/users/2491900/shree-pat18"}, "is_accepted": false, "score": 1, "last_activity_date": 1484994576, "creation_date": 1484994576, "answer_id": 41778237, "question_id": 41777675, "link": "https://stackoverflow.com/questions/41777675/large-size-of-bool-in-foreign-storable/41778237#41778237", "title": "Large size of Bool in Foreign.Storable", "body": "<p>From the <a href=\"https://hackage.haskell.org/package/base-4.9.1.0/docs/src/Foreign.Storable.html#Storable\" rel=\"nofollow noreferrer\">source</a>, we have:</p>\n\n<pre><code>instance Storable Bool where\n   sizeOf _ = sizeOf (undefined::HTYPE_INT)\n</code></pre>\n\n<p>And <code>HTYPE_INT</code> is defined in <a href=\"https://hackage.haskell.org/package/base-4.5.0.0/src/include/HsBaseConfig.h\" rel=\"nofollow noreferrer\">HsBaseConfig.h</a> as:</p>\n\n<pre><code>/* Define to Haskell type for int */\n#define HTYPE_INT Int32\n</code></pre>\n\n<p>This could give you the result 4, although I believe this value should be implementation-specific.</p>\n"}, {"tags": [], "owner": {"reputation": 507, "user_id": 1699488, "user_type": "registered", "accept_rate": 80, "profile_image": "https://www.gravatar.com/avatar/a8324cbee30924bddc32c054d19b182e?s=128&d=identicon&r=PG", "display_name": "Lemming", "link": "https://stackoverflow.com/users/1699488/lemming"}, "is_accepted": false, "score": 2, "last_activity_date": 1508225951, "creation_date": 1508225951, "answer_id": 46784931, "question_id": 41777675, "link": "https://stackoverflow.com/questions/41777675/large-size-of-bool-in-foreign-storable/46784931#46784931", "title": "Large size of Bool in Foreign.Storable", "body": "<p>Starting with GHC-8.2/base-4.10, there is the type <code>CBool</code> that only needs one byte when stored via <code>Storable</code>.</p>\n\n<p><a href=\"https://hackage.haskell.org/package/base-4.10.0.0/docs/Foreign-C-Types.html#t:CBool\" rel=\"nofollow noreferrer\">https://hackage.haskell.org/package/base-4.10.0.0/docs/Foreign-C-Types.html#t:CBool</a></p>\n\n<p>Alternatively, there is the new package <code>bool8</code>. It provides a wrapper type around <code>Bool</code> and its <code>Storable</code> instance uses only one byte.</p>\n\n<p><a href=\"https://hackage.haskell.org/package/bool8\" rel=\"nofollow noreferrer\">https://hackage.haskell.org/package/bool8</a></p>\n"}], "owner": {"reputation": 1972, "user_id": 1747134, "user_type": "registered", "accept_rate": 93, "profile_image": "https://www.gravatar.com/avatar/696bad3bd2c5e16ded04f3cdf436623f?s=128&d=identicon&r=PG", "display_name": "user1747134", "link": "https://stackoverflow.com/users/1747134/user1747134"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 122, "favorite_count": 0, "answer_count": 2, "score": 3, "last_activity_date": 1508225951, "creation_date": 1484990619, "question_id": 41777675, "link": "https://stackoverflow.com/questions/41777675/large-size-of-bool-in-foreign-storable", "title": "Large size of Bool in Foreign.Storable", "body": "<p>I see:</p>\n\n<pre><code>GHCi&gt; import Foreign.Storable\nGHCi&gt; sizeOf False\n4\n</code></pre>\n\n<p>I expected it to be 1. But I thought it perhaps carries some pointer or something that forces it to be bigger. But it does not seem to be necessary:</p>\n\n<pre><code>GHCi&gt; import Data.Word\nGHCi&gt; sizeOf (0 :: Word8)\n1\n</code></pre>\n\n<p>What is it that forces <code>Bool</code> to be stored this big? It seems like a huge waste of memory.</p>\n"}, {"tags": ["haskell", "ghc", "currying", "pointfree", "partial-application"], "answers": [{"comments": [{"owner": {"reputation": 14585, "user_id": 568785, "user_type": "registered", "accept_rate": 93, "profile_image": "https://www.gravatar.com/avatar/88c6371f6a47841abde4c60dd8a2f964?s=128&d=identicon&r=PG", "display_name": "Bailey Parker", "link": "https://stackoverflow.com/users/568785/bailey-parker"}, "edited": false, "score": 0, "creation_date": 1484989356, "post_id": 41777371, "comment_id": 70745747, "body": "+1 (+ more if I could!) Thanks for a really clear explanation. I see why GHC doesn&#39;t make this optimization by default given the general case. I forgot to mention that I tried using <code>($!)</code> to force strict evaluation of the sort. I must&#39;ve been doing it wrong, because lo and behold <code>($!)</code> is just another spelling of the let construct you suggested!"}, {"owner": {"reputation": 100185, "user_id": 3234959, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/93bb12ca0f93dfddb33880316f7e66c2?s=128&d=identicon&r=PG&f=1", "display_name": "chi", "link": "https://stackoverflow.com/users/3234959/chi"}, "reply_to_user": {"reputation": 14585, "user_id": 568785, "user_type": "registered", "accept_rate": 93, "profile_image": "https://www.gravatar.com/avatar/88c6371f6a47841abde4c60dd8a2f964?s=128&d=identicon&r=PG", "display_name": "Bailey Parker", "link": "https://stackoverflow.com/users/568785/bailey-parker"}, "edited": false, "score": 0, "creation_date": 1484992406, "post_id": 41777371, "comment_id": 70746506, "body": "@BaileyParker Actually, <code>let</code> does not force evaluation immediately, while <code>$!</code> does force the argument. <code>let x = e in f x + g x</code> will evaluate <code>e</code> only when it is needed by <code>f,g</code>, but will save its value in memory for the second call."}], "tags": [], "owner": {"reputation": 100185, "user_id": 3234959, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/93bb12ca0f93dfddb33880316f7e66c2?s=128&d=identicon&r=PG&f=1", "display_name": "chi", "link": "https://stackoverflow.com/users/3234959/chi"}, "is_accepted": true, "score": 2, "last_activity_date": 1484988823, "last_edit_date": 1484988823, "creation_date": 1484988392, "answer_id": 41777371, "question_id": 41777169, "link": "https://stackoverflow.com/questions/41777169/point-free-style-required-for-optimized-curry/41777371#41777371", "title": "Point Free Style Required for Optimized Curry", "body": "<p>If I understand correctly, you are looking for this:</p>\n\n<pre><code>contrived :: Ord a =&gt; [a] -&gt; [a] -&gt; [a]\ncontrived a = let a' = sort a in \\b -&gt; a' ++ b\n                    -- or ... in (a' ++)\n</code></pre>\n\n<p>If you want the sort to be computed only once, it has to be done before the <code>\\b</code>.</p>\n\n<p>You are correct in that a compiler could optimize this. This is known as the \"full laziness\" optimization.</p>\n\n<p>If I remember correctly, GHC does not always do it because it's not always an actual optimization, in the general case. Consider the contrived example</p>\n\n<pre><code>foo :: Int -&gt; Int -&gt; Int\nfoo x y = let a = [1..x] in length a + y\n</code></pre>\n\n<p>When passing both arguments, the above code works in constant space: the list elements are immediately garbage collected as they are produced.</p>\n\n<p>When partially applying <code>x</code>, the closure for <code>foo x</code> only requires O(1) memory, since the list is not yet generated. Code like</p>\n\n<pre><code>let f = foo 1000 in f 10 + f 20  -- (*)\n</code></pre>\n\n<p>still run in constant space.</p>\n\n<p>Instead, if we wrote</p>\n\n<pre><code>foo :: Int -&gt; Int -&gt; Int\nfoo x = let a = [1..x] in (length a +)\n</code></pre>\n\n<p>then <code>(*)</code> would no longer run in constant space. The first call <code>f 10</code> would allocate a 1000-long list, and keep it in memory for the second call <code>f 20</code>.</p>\n\n<hr>\n\n<p>Note that your partial application</p>\n\n<pre><code>... = (++) (sort a)\n</code></pre>\n\n<p>essentially means</p>\n\n<pre><code>... = let a' = sort a in \\b -&gt; a' ++ b\n</code></pre>\n\n<p>since argument passing involves a binding, as in <code>let</code>. So, the result of your <code>sort a</code> is kept around for all the future calls.</p>\n"}], "owner": {"reputation": 14585, "user_id": 568785, "user_type": "registered", "accept_rate": 93, "profile_image": "https://www.gravatar.com/avatar/88c6371f6a47841abde4c60dd8a2f964?s=128&d=identicon&r=PG", "display_name": "Bailey Parker", "link": "https://stackoverflow.com/users/568785/bailey-parker"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 68, "favorite_count": 0, "accepted_answer_id": 41777371, "answer_count": 1, "score": 2, "last_activity_date": 1484988823, "creation_date": 1484986593, "question_id": 41777169, "link": "https://stackoverflow.com/questions/41777169/point-free-style-required-for-optimized-curry", "title": "Point Free Style Required for Optimized Curry", "body": "<p>Say we have a (contrived) function like so:</p>\n\n<pre><code>import Data.List (sort)\n\ncontrived :: Ord a =&gt; [a] -&gt; [a] -&gt; [a]\ncontrived a b = (sort a) ++ b\n</code></pre>\n\n<p>And we partially apply it to use elsewhere, eg:</p>\n\n<pre><code>map (contrived [3,2,1]) [[4],[5],[6]]\n</code></pre>\n\n<p>On the surface, this works as one would expect:</p>\n\n<pre><code>[[1,2,3,4],[1,2,3,5],[1,2,3,6]]\n</code></pre>\n\n<p>However, if we throw some <code>trace</code>s in:</p>\n\n<pre><code>import Debug.Trace (trace)\n\ncontrived :: Ord a =&gt; [a] -&gt; [a] -&gt; [a]\ncontrived a b = (trace \"sorted\" $ sort a) ++ b\nmap (contrived $ trace \"a value\" [3,2,1]) [[4],[5],[6]]\n</code></pre>\n\n<p>We see that the first list passed into <code>contrived</code> is evaluated only once, but it is sorted for each item in <code>[4,5,6]</code>:</p>\n\n<pre><code>[sorted\na value\n[1,2,3,4],sorted\n[1,2,3,5],sorted\n[1,2,3,6]]\n</code></pre>\n\n<p>Now, <code>contrived</code> can be rather simply translated to point-free style:</p>\n\n<pre><code>contrived :: Ord a =&gt; [a] -&gt; [a] -&gt; [a]\ncontrived a = (++) (sort a)\n</code></pre>\n\n<p>Which when partially applied:</p>\n\n<pre><code>map (contrived [3,2,1]) [4,5,6]\n</code></pre>\n\n<p>Still works as we expect:</p>\n\n<pre><code>[[1,2,3,4],[1,2,3,5],[1,2,3,6]]\n</code></pre>\n\n<p>But if we again add <code>trace</code>s:</p>\n\n<pre><code>contrived :: Ord a =&gt; [a] -&gt; [a] -&gt; [a]\ncontrived a = (++) (trace \"sorted\" $ sort a)\nmap (contrived $ trace \"a value\" [3,2,1]) [[4],[5],[6]]\n</code></pre>\n\n<p>We see that now the first list passed into <code>contrived</code> is evaluated <strong>and sorted</strong> only once:</p>\n\n<pre><code>[sorted\na value\n[1,2,3,4],[1,2,3,5],[1,2,3,6]]\n</code></pre>\n\n<p>Why is this so? Since the translation into pointfree style is so trivial, why can't GHC deduce that it only needs to sort <code>a</code> once in the first version of <code>contrived</code>?</p>\n\n<hr>\n\n<p><strong>Note:</strong> I know that for this rather trivial example, it's probably preferable to use pointfree style. This is a contrived example that I've simplified quite a bit. The real function that I'm having the issue with is less clear (in my opinion) when expressed in pointfree style:</p>\n\n<pre><code>realFunction a b = conditionOne &amp;&amp; conditionTwo\n  where conditionOne = map (something a) b\n        conditionTwo = somethingElse a b\n</code></pre>\n\n<p>In pointfree style, this requires writing an ugly wrapper (<code>both</code>) around <code>(&amp;&amp;)</code>:</p>\n\n<pre><code>realFunction a = both conditionOne conditionTwo\n  where conditionOne = map (something a)\n        conditionTwo = somethingElse a\n        both f g x = (f x) &amp;&amp; (g x)\n</code></pre>\n\n<p>As an aside, I'm also not sure why the <code>both</code> wrapper works; the pointfree style of <code>realFunction</code> behaves like the pointfree style version of <code>contrived</code> in that the partial application is only evaluated once (ie. if <code>something</code> sorted <code>a</code> it would only do so once). It appears that since <code>both</code> is not pointfree, Haskell should have the same issue that it had with the non-pointfree <code>contrived</code>.</p>\n"}, {"tags": ["haskell"], "comments": [{"owner": {"reputation": 2141, "user_id": 1664572, "user_type": "registered", "accept_rate": 85, "profile_image": "https://www.gravatar.com/avatar/c2bee27fdb72050b60a3c6aae64b474f?s=128&d=identicon&r=PG", "display_name": "wizzup", "link": "https://stackoverflow.com/users/1664572/wizzup"}, "edited": false, "score": 0, "creation_date": 1484986447, "post_id": 41776876, "comment_id": 70745141, "body": "related question about <a href=\"http://stackoverflow.com/questions/8274650/in-haskell-when-do-we-use-in-with-let\">let</a>"}], "answers": [{"comments": [{"owner": {"reputation": 1220, "user_id": 3564318, "user_type": "registered", "accept_rate": 94, "profile_image": "https://i.stack.imgur.com/HpcZE.jpg?s=128&g=1", "display_name": "Pragyaditya Das", "link": "https://stackoverflow.com/users/3564318/pragyaditya-das"}, "edited": false, "score": 0, "creation_date": 1484984592, "post_id": 41776921, "comment_id": 70744727, "body": "Got it...thanks :) Can you tell me why this happens? Or can you point me into the direction into how can I learn more?"}, {"owner": {"reputation": 19480, "user_id": 2491900, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/W8FMW.jpg?s=128&g=1", "display_name": "shree.pat18", "link": "https://stackoverflow.com/users/2491900/shree-pat18"}, "reply_to_user": {"reputation": 1220, "user_id": 3564318, "user_type": "registered", "accept_rate": 94, "profile_image": "https://i.stack.imgur.com/HpcZE.jpg?s=128&g=1", "display_name": "Pragyaditya Das", "link": "https://stackoverflow.com/users/3564318/pragyaditya-das"}, "edited": false, "score": 1, "creation_date": 1484984639, "post_id": 41776921, "comment_id": 70744743, "body": "Sure, here&#39;s the link: <a href=\"https://www.haskell.org/tutorial/patterns.html\" rel=\"nofollow noreferrer\">haskell.org/tutorial/patterns.html</a>. Look at section 4.5"}, {"owner": {"reputation": 7872, "user_id": 440302, "user_type": "registered", "accept_rate": 92, "profile_image": "https://www.gravatar.com/avatar/e785baf6d4a2626b8649d5b538c51858?s=128&d=identicon&r=PG", "display_name": "Rufflewind", "link": "https://stackoverflow.com/users/440302/rufflewind"}, "reply_to_user": {"reputation": 1220, "user_id": 3564318, "user_type": "registered", "accept_rate": 94, "profile_image": "https://i.stack.imgur.com/HpcZE.jpg?s=128&g=1", "display_name": "Pragyaditya Das", "link": "https://stackoverflow.com/users/3564318/pragyaditya-das"}, "edited": false, "score": 2, "creation_date": 1484986977, "post_id": 41776921, "comment_id": 70745246, "body": "@PragyadityaDas Bare <code>let</code> expressions are not allowed to appear at the top level of a module but they can appear inside expressions (<code>let x = 42 in x * x</code>) or <code>do</code> blocks (<code>do { let x = 42; print x; }</code>)."}], "tags": [], "owner": {"reputation": 19480, "user_id": 2491900, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/W8FMW.jpg?s=128&g=1", "display_name": "shree.pat18", "link": "https://stackoverflow.com/users/2491900/shree-pat18"}, "is_accepted": true, "score": 3, "last_activity_date": 1484986720, "last_edit_date": 1484986720, "creation_date": 1484984458, "answer_id": 41776921, "question_id": 41776876, "link": "https://stackoverflow.com/questions/41776876/haskell-boolean-expressions-parse-error-possibly-incorrect-indentation-or-mis/41776921#41776921", "title": "Haskell boolean expressions : parse error (possibly incorrect indentation or mismatched brackets)", "body": "<p>You don't need to use <code>let</code>. Just define the function and call it in <code>main</code> i.e.</p>\n\n<pre><code>area r = pi * r ^ 2\n\nmain = print (area 5 &lt; 50)\n</code></pre>\n"}], "owner": {"reputation": 1220, "user_id": 3564318, "user_type": "registered", "accept_rate": 94, "profile_image": "https://i.stack.imgur.com/HpcZE.jpg?s=128&g=1", "display_name": "Pragyaditya Das", "link": "https://stackoverflow.com/users/3564318/pragyaditya-das"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 126, "favorite_count": 0, "accepted_answer_id": 41776921, "answer_count": 1, "score": 0, "last_activity_date": 1484986720, "creation_date": 1484984162, "question_id": 41776876, "link": "https://stackoverflow.com/questions/41776876/haskell-boolean-expressions-parse-error-possibly-incorrect-indentation-or-mis", "title": "Haskell boolean expressions : parse error (possibly incorrect indentation or mismatched brackets)", "body": "<p>I am trying out my hands on Haskell. </p>\n\n<p>I wrote the code and saved it as : <code>boolean.hs</code></p>\n\n<p>The code is: </p>\n\n<pre><code>let area r = pi * r ^ 2\nmain = print(area 5 &lt; 50)\n</code></pre>\n\n<p>When I do, <code>ghc -o boolean boolean.hs</code></p>\n\n<p>I get an error message :</p>\n\n<pre><code>[1 of 1] Compiling Main             ( boolean.hs, boolean.o )\n\nboolean.hs:2:1:\n    parse error (possibly incorrect indentation or mismatched brackets)\n</code></pre>\n\n<p>It would be great if somebody helped me see how this error can be tackled. </p>\n\n<p>I went through <a href=\"https://en.wikibooks.org/wiki/Haskell/Indentation\" rel=\"nofollow noreferrer\">Haskell|Wikibooks|Identation</a>, and changed the code to :</p>\n\n<pre><code>let \n    area r = pi * r ^ 2\nmain = \n    print(area 5 &lt; 50)\n</code></pre>\n\n<p>And still got : </p>\n\n<pre><code>[1 of 1] Compiling Main             ( boolean.hs, boolean.o )\n\nboolean.hs:3:1:\n    parse error (possibly incorrect indentation or mismatched brackets)\n</code></pre>\n\n<p>Regards. :)</p>\n"}, {"tags": ["haskell", "dependency-management", "haskell-stack", "hakyll"], "comments": [{"owner": {"reputation": 3231, "user_id": 1013393, "user_type": "registered", "accept_rate": 60, "profile_image": "https://www.gravatar.com/avatar/7bca51e5ae3eb8dc24a98616b4e5d6fd?s=128&d=identicon&r=PG", "display_name": "sjakobi", "link": "https://stackoverflow.com/users/1013393/sjakobi"}, "edited": false, "score": 1, "creation_date": 1485017926, "post_id": 41776516, "comment_id": 70754145, "body": "I understand now that the the purpose of <code>stack install hakyll</code> is to get the <code>hakyll-init</code> binary. The command failed because <code>hakyll-4.9.3.0</code> isn&#39;t compatible with the resolver set in your stack.yaml (probably <code>~&#47;.stack&#47;global-project&#47;stack.yaml</code>). <code>hakyll-4.9.3.0</code> is included in <a href=\"https://www.stackage.org/nightly-2017-01-17\" rel=\"nofollow noreferrer\">nightly-2017-01-17</a> though, so you can <code>stack --resolver nightly-2017-01-17 install hakyll</code>. The rest of <a href=\"https://jaspervdj.be/hakyll/tutorials/01-installation.html\" rel=\"nofollow noreferrer\">the instructions</a> should work roughly as written."}, {"owner": {"reputation": 3231, "user_id": 1013393, "user_type": "registered", "accept_rate": 60, "profile_image": "https://www.gravatar.com/avatar/7bca51e5ae3eb8dc24a98616b4e5d6fd?s=128&d=identicon&r=PG", "display_name": "sjakobi", "link": "https://stackoverflow.com/users/1013393/sjakobi"}, "edited": false, "score": 0, "creation_date": 1485119822, "post_id": 41776516, "comment_id": 70780627, "body": "BTW there&#39;s <a href=\"https://github.com/commercialhaskell/stack/issues/2656\" rel=\"nofollow noreferrer\">a proposal for a <code>--solver</code> flag</a> that should make installing executables with stack much easier."}], "answers": [{"comments": [{"owner": {"reputation": 13734, "user_id": 938694, "user_type": "registered", "accept_rate": 59, "profile_image": "https://www.gravatar.com/avatar/b6678a430a805dd78366d6e135b49f2d?s=128&d=identicon&r=PG", "display_name": "Cubic", "link": "https://stackoverflow.com/users/938694/cubic"}, "edited": false, "score": 0, "creation_date": 1485010336, "post_id": 41778926, "comment_id": 70751687, "body": "You can install packages with <code>stack install</code> though, it just doesn&#39;t make the installed packages available to the project."}, {"owner": {"reputation": 3231, "user_id": 1013393, "user_type": "registered", "accept_rate": 60, "profile_image": "https://www.gravatar.com/avatar/7bca51e5ae3eb8dc24a98616b4e5d6fd?s=128&d=identicon&r=PG", "display_name": "sjakobi", "link": "https://stackoverflow.com/users/1013393/sjakobi"}, "reply_to_user": {"reputation": 13734, "user_id": 938694, "user_type": "registered", "accept_rate": 59, "profile_image": "https://www.gravatar.com/avatar/b6678a430a805dd78366d6e135b49f2d?s=128&d=identicon&r=PG", "display_name": "Cubic", "link": "https://stackoverflow.com/users/938694/cubic"}, "edited": false, "score": 0, "creation_date": 1485012600, "post_id": 41778926, "comment_id": 70752343, "body": "@Cubic That depends on what you mean by &quot;install packages&quot;. How do you understand it?"}, {"owner": {"reputation": 13734, "user_id": 938694, "user_type": "registered", "accept_rate": 59, "profile_image": "https://www.gravatar.com/avatar/b6678a430a805dd78366d6e135b49f2d?s=128&d=identicon&r=PG", "display_name": "Cubic", "link": "https://stackoverflow.com/users/938694/cubic"}, "edited": false, "score": 2, "creation_date": 1485013369, "post_id": 41778926, "comment_id": 70752582, "body": "I can <code>stack install &lt;some-package-name&gt;</code>, that package will be downloaded, built, I can execute any binaries that are part of the package with <code>stack exec</code>... if there&#39;s another way to interpret &quot;install packages&quot; I&#39;m not aware of it."}], "tags": [], "owner": {"reputation": 3231, "user_id": 1013393, "user_type": "registered", "accept_rate": 60, "profile_image": "https://www.gravatar.com/avatar/7bca51e5ae3eb8dc24a98616b4e5d6fd?s=128&d=identicon&r=PG", "display_name": "sjakobi", "link": "https://stackoverflow.com/users/1013393/sjakobi"}, "is_accepted": false, "score": 3, "last_activity_date": 1484999085, "creation_date": 1484999085, "answer_id": 41778926, "question_id": 41776516, "link": "https://stackoverflow.com/questions/41776516/stack-not-resolving-dependencies-properly/41778926#41778926", "title": "Stack not resolving dependencies properly", "body": "<p>Dependency management with stack is meant to be reproducible and declarative, that means that a stack project will only compile once all dependencies are recorded in the .cabal file(s) of the project and once the stack.yaml of the project defines versions for these dependencies either in the <a href=\"https://docs.haskellstack.org/en/stable/yaml_configuration/#resolver\" rel=\"nofollow noreferrer\"><code>resolver</code></a> or the <a href=\"https://docs.haskellstack.org/en/stable/yaml_configuration/#extra-deps\" rel=\"nofollow noreferrer\"><code>extra-deps</code></a> section.</p>\n\n<p>Your confusion seems to stem from a misunderstanding of what <code>stack install</code> does. The command line help has this to say about it:</p>\n\n<pre><code>  build                    Build the package(s) in this directory/configuration\n  install                  Shortcut for 'build --copy-bins'\n...\n  --[no-]copy-bins         Enable/disable copying binaries to the local-bin-path\n                           (see 'stack path')\n</code></pre>\n\n<p><code>stack install</code> does <em>not</em> save any dependencies.</p>\n\n<p>So the proper way of making hakyll available as a dependency to your code is:</p>\n\n<ul>\n<li><p>Create a proper stack project with <code>stack init</code> if you already have a Cabal package, or <code>stack new</code> if you don't.</p></li>\n<li><p>Add <code>hakyll</code> to the library or executable <code>build-depends</code> in your .cabal file.</p></li>\n<li><p>Attempt to <code>stack build</code> and follow the instructions in any error messages until all issues are resolved.</p></li>\n</ul>\n"}, {"tags": [], "owner": {"reputation": 13379, "user_id": 1033027, "user_type": "registered", "accept_rate": 91, "profile_image": "https://www.gravatar.com/avatar/b56ea1c43a4ecb1060ec8bcb8d2bce78?s=128&d=identicon&r=PG", "display_name": "Jules", "link": "https://stackoverflow.com/users/1033027/jules"}, "is_accepted": true, "score": 2, "last_activity_date": 1485026346, "creation_date": 1485026346, "answer_id": 41783455, "question_id": 41776516, "link": "https://stackoverflow.com/questions/41776516/stack-not-resolving-dependencies-properly/41783455#41783455", "title": "Stack not resolving dependencies properly", "body": "<p>A simpler solution than @sjakobi's in this case was to specify a resolver as a command line option when starting a new Stack project:</p>\n\n<pre><code>stack install hakyll --resolver=5.11 --install-ghc\n</code></pre>\n"}], "owner": {"reputation": 13379, "user_id": 1033027, "user_type": "registered", "accept_rate": 91, "profile_image": "https://www.gravatar.com/avatar/b56ea1c43a4ecb1060ec8bcb8d2bce78?s=128&d=identicon&r=PG", "display_name": "Jules", "link": "https://stackoverflow.com/users/1033027/jules"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 1031, "favorite_count": 1, "accepted_answer_id": 41783455, "answer_count": 2, "score": 5, "last_activity_date": 1485026346, "creation_date": 1484981181, "last_edit_date": 1485000475, "question_id": 41776516, "link": "https://stackoverflow.com/questions/41776516/stack-not-resolving-dependencies-properly", "title": "Stack not resolving dependencies properly", "body": "<p>I'm trying to set up <a href=\"https://jaspervdj.be/hakyll/tutorials/01-installation.html\" rel=\"nofollow noreferrer\">Hakyll</a> on a fresh Ubuntu 16.04 instance, but I can't seem to get the Stack-based setup instructions right.</p>\n\n<p>Starting out with <code>stack install hakyll</code>, I get:</p>\n\n<pre><code>Error: While constructing the build plan, the following exceptions were encountered:\n\nIn the dependencies for hakyll-4.9.3.0:\n    http-conduit-2.1.11 must match &gt;=2.2 &amp;&amp; &lt;2.3 (latest applicable is 2.2.3)\n\nPlan construction failed.\n</code></pre>\n\n<p>I got a similar error when tying to <code>stack-install http-conduit-2.1.11</code>, this time with:</p>\n\n<pre><code>Error: While constructing the build plan, the following exceptions were encountered:\n\nIn the dependencies for http-conduit-2.2.3:\n    http-client-0.4.31.2 must match &gt;=0.5 &amp;&amp; &lt;0.6 (latest applicable is 0.5.5)\n    http-client-tls-0.2.4.1 must match &gt;=0.3 &amp;&amp; &lt;0.4 (latest applicable is 0.3.3.1)\n\nPlan construction failed.\n</code></pre>\n\n<p>After resolving dependencies for this (also using Stack), I tried once again to <code>stack install http-conduit-2.1.11</code>, but I once again got the same dependency error.</p>\n\n<p>The packages <code>http-client-0.4.31.2</code> and <code>http-client-tls-0.2.4.1</code> appear in my <code>~/.stack/precompiled/x86_64-linux/ghc-8.0.1/1.24.0.0/</code>, which isn't explicitly in my <code>$PATH</code>, however that feels like an extremely hacky solution, and I haven't found any documentation recommending this approach.</p>\n\n<p>How can I correctly install Hakyll on my machine?</p>\n"}, {"tags": ["haskell", "scientific-software"], "comments": [{"owner": {"reputation": 314794, "user_id": 67579, "user_type": "registered", "accept_rate": 81, "profile_image": "https://i.stack.imgur.com/BJXub.png?s=128&g=1", "display_name": "Willem Van Onsem", "link": "https://stackoverflow.com/users/67579/willem-van-onsem"}, "edited": false, "score": 0, "creation_date": 1484957924, "post_id": 41774327, "comment_id": 70740185, "body": "Could you provide the link to the article where they discuss the problematic issue with the division? I&#39;m interested to take a look in it myself."}, {"owner": {"reputation": 1225, "user_id": 1553313, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/c254d80f35c4c00cf529252f98f23fea?s=128&d=identicon&r=PG", "display_name": "m-renaud", "link": "https://stackoverflow.com/users/1553313/m-renaud"}, "reply_to_user": {"reputation": 314794, "user_id": 67579, "user_type": "registered", "accept_rate": 81, "profile_image": "https://i.stack.imgur.com/BJXub.png?s=128&g=1", "display_name": "Willem Van Onsem", "link": "https://stackoverflow.com/users/67579/willem-van-onsem"}, "edited": false, "score": 0, "creation_date": 1484960346, "post_id": 41774327, "comment_id": 70740665, "body": "There wasn&#39;t an article that I saw but my understanding is that the conversion from a rational number requires long division which does not terminate on infinitely repeating decimal numbers (<a href=\"https://en.wikipedia.org/wiki/Repeating_decimal#Every_rational_number_is_either_a_terminating_or_repeating_decimal\" rel=\"nofollow noreferrer\">en.wikipedia.org/wiki/&hellip;</a>). Looking at the source it&#39;s obvious why it diverges, so I was hoping someone knew of an algorithm that did not diverge. There is a <code>fromRationalRepetend</code> in the package which may be useful but wanted to see if the problem had been solved already before rolling my own solution."}], "owner": {"reputation": 1225, "user_id": 1553313, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/c254d80f35c4c00cf529252f98f23fea?s=128&d=identicon&r=PG", "display_name": "m-renaud", "link": "https://stackoverflow.com/users/1553313/m-renaud"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 103, "favorite_count": 1, "answer_count": 0, "score": 1, "last_activity_date": 1484957336, "creation_date": 1484957336, "question_id": 41774327, "link": "https://stackoverflow.com/questions/41774327/division-on-data-scientific-diverges-with-infinite-decimal-expansion", "title": "Division on Data.Scientific diverges with infinite decimal expansion", "body": "<p>So, I recently started using the <a href=\"https://hackage.haskell.org/package/scientific\" rel=\"nofollow noreferrer\">scientific</a> package because it provides arbitrary precision numbers through <code>Data.Scientific</code> which I haven't seen anywhere else. One issue that I've run into is the divergence of division <code>/</code> (which is indeed warned about in the documentation) when property testing my code with QuickCheck. I'm using the <code>Arbitrary</code> instance from <a href=\"https://hackage.haskell.org/package/quickcheck-instances\" rel=\"nofollow noreferrer\">quickcheck-instances</a>.</p>\n\n<p>I don't have very much formal (read: none) experience with scientific computing so I was wondering if there is any best practices for handling this case. Is there some decent algorithm for performing this operation with possibly a small loss of precision or some way of detecting this ahead of time and returning <code>Nothing</code> or something equivalent when the result would be ill-defined.</p>\n\n<p>Alternatively, (not as ideal) can I just exclude numbers with infinite decimal expansions from my QuickCheck tests so they don't hang forever? This obviously has the downside that it only treats the symptom and a user of the code could still cause divergence if they passed in \"bad\" data.</p>\n\n<p>Any suggestions would be greatly appreciated :)</p>\n"}, {"tags": ["haskell", "pattern-matching", "typeclass"], "answers": [{"comments": [{"owner": {"reputation": 314794, "user_id": 67579, "user_type": "registered", "accept_rate": 81, "profile_image": "https://i.stack.imgur.com/BJXub.png?s=128&g=1", "display_name": "Willem Van Onsem", "link": "https://stackoverflow.com/users/67579/willem-van-onsem"}, "edited": false, "score": 0, "creation_date": 1484939719, "post_id": 41770839, "comment_id": 70733060, "body": "Hah, I had exactly the same idea :)"}, {"owner": {"reputation": 951, "user_id": 6253996, "user_type": "registered", "accept_rate": 75, "profile_image": "https://i.stack.imgur.com/XUk8U.jpg?s=128&g=1", "display_name": "bzim", "link": "https://stackoverflow.com/users/6253996/bzim"}, "edited": false, "score": 0, "creation_date": 1484940752, "post_id": 41770839, "comment_id": 70733540, "body": "I don&#39;t want that the elements have all the same type."}, {"owner": {"reputation": 314794, "user_id": 67579, "user_type": "registered", "accept_rate": 81, "profile_image": "https://i.stack.imgur.com/BJXub.png?s=128&g=1", "display_name": "Willem Van Onsem", "link": "https://stackoverflow.com/users/67579/willem-van-onsem"}, "reply_to_user": {"reputation": 951, "user_id": 6253996, "user_type": "registered", "accept_rate": 75, "profile_image": "https://i.stack.imgur.com/XUk8U.jpg?s=128&g=1", "display_name": "bzim", "link": "https://stackoverflow.com/users/6253996/bzim"}, "edited": false, "score": 0, "creation_date": 1484940989, "post_id": 41770839, "comment_id": 70733645, "body": "@BrunoCorr&#234;aZimmermann: That&#39;s more or less impossible with Haskell: Haskell is statically typed. You could define a list of <code>Either a b</code> types such that each element is either type <code>a</code> or <code>b</code>. But in Haskell you know in advance the type of elements. If you want this flexibility, you should use a dynamically typed language like Python."}, {"owner": {"reputation": 11612, "user_id": 204218, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/3ee571049ff6ff0361be53e554b877e6?s=128&d=identicon&r=PG", "display_name": "adamse", "link": "https://stackoverflow.com/users/204218/adamse"}, "reply_to_user": {"reputation": 951, "user_id": 6253996, "user_type": "registered", "accept_rate": 75, "profile_image": "https://i.stack.imgur.com/XUk8U.jpg?s=128&g=1", "display_name": "bzim", "link": "https://stackoverflow.com/users/6253996/bzim"}, "edited": false, "score": 0, "creation_date": 1484941173, "post_id": 41770839, "comment_id": 70733724, "body": "@BrunoCorr&#234;aZimmermann: that is very tricky. Perhaps you can make do with a type <code>data Option = B Bool | I Int | S String</code> and <code>data OptionsList = Empty | OptionsList Option OptionsList</code>? If that doesn&#39;t suffice you would have to look into something called heterogenous lists, which are possible to use in Haskell but very nice. I would try to find another solution for your use case."}, {"owner": {"reputation": 951, "user_id": 6253996, "user_type": "registered", "accept_rate": 75, "profile_image": "https://i.stack.imgur.com/XUk8U.jpg?s=128&g=1", "display_name": "bzim", "link": "https://stackoverflow.com/users/6253996/bzim"}, "edited": false, "score": 0, "creation_date": 1484941201, "post_id": 41770839, "comment_id": 70733733, "body": "But I was able to indeed create a list like that with this data. The problem is just in its stringizing. I can make a list to be stringized as <code>{0, {&quot;test&quot;, {True, }}}</code>. What I want is <code>{0, {&quot;test&quot;, {True}}}</code>. The problem is the additional comma, because a value created with EmptyOpt is stringified as ``."}, {"owner": {"reputation": 951, "user_id": 6253996, "user_type": "registered", "accept_rate": 75, "profile_image": "https://i.stack.imgur.com/XUk8U.jpg?s=128&g=1", "display_name": "bzim", "link": "https://stackoverflow.com/users/6253996/bzim"}, "edited": false, "score": 0, "creation_date": 1484941291, "post_id": 41770839, "comment_id": 70733778, "body": "I know that Haskell is statically typed, but this is the fun. Creating tricks."}, {"owner": {"reputation": 75362, "user_id": 625403, "user_type": "registered", "accept_rate": 82, "profile_image": "https://www.gravatar.com/avatar/786eed7da67079cb5d63a49d469af25b?s=128&d=identicon&r=PG", "display_name": "amalloy", "link": "https://stackoverflow.com/users/625403/amalloy"}, "edited": false, "score": 0, "creation_date": 1484941552, "post_id": 41770839, "comment_id": 70733907, "body": "The problem is not only in creating lists with this type, but also in consuming them. They are pretty easy to create (eg by adding a special type-level Nil to indicate the end of a list), but you end up with awkward types like <code>DynList Int (DynList String (DynList Bool Nil))</code>, which means that you must know at compile time the length of the list and the types of all its elements: it might as well just be a single data constructor at that point, since it doesn&#39;t have the runtime flexibility a list does."}, {"owner": {"reputation": 11612, "user_id": 204218, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/3ee571049ff6ff0361be53e554b877e6?s=128&d=identicon&r=PG", "display_name": "adamse", "link": "https://stackoverflow.com/users/204218/adamse"}, "reply_to_user": {"reputation": 75362, "user_id": 625403, "user_type": "registered", "accept_rate": 82, "profile_image": "https://www.gravatar.com/avatar/786eed7da67079cb5d63a49d469af25b?s=128&d=identicon&r=PG", "display_name": "amalloy", "link": "https://stackoverflow.com/users/625403/amalloy"}, "edited": false, "score": 0, "creation_date": 1484941686, "post_id": 41770839, "comment_id": 70733969, "body": "See the update, perhaps that would work for you? But this suffers from the problems @amalloy mentions."}, {"owner": {"reputation": 951, "user_id": 6253996, "user_type": "registered", "accept_rate": 75, "profile_image": "https://i.stack.imgur.com/XUk8U.jpg?s=128&g=1", "display_name": "bzim", "link": "https://stackoverflow.com/users/6253996/bzim"}, "edited": false, "score": 0, "creation_date": 1484942825, "post_id": 41770839, "comment_id": 70734473, "body": "My idea was to build a list for any type. But I think I&#39;ll give up and do something like: <code>Option = OptInt Int | OptStr String | OptBool Bool</code>"}, {"owner": {"reputation": 29444, "user_id": 3072788, "user_type": "registered", "accept_rate": 82, "profile_image": "https://www.gravatar.com/avatar/220a45c2fcff7e7358d144551b116205?s=128&d=identicon&r=PG&f=1", "display_name": "Alec", "link": "https://stackoverflow.com/users/3072788/alec"}, "edited": false, "score": 1, "creation_date": 1484945774, "post_id": 41770839, "comment_id": 70735846, "body": "I would hardly call <code>FlexibleInstances</code> instances frightening. It is one of the most benign extensions - I usually wish it was enabled by default."}, {"owner": {"reputation": 11612, "user_id": 204218, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/3ee571049ff6ff0361be53e554b877e6?s=128&d=identicon&r=PG", "display_name": "adamse", "link": "https://stackoverflow.com/users/204218/adamse"}, "reply_to_user": {"reputation": 29444, "user_id": 3072788, "user_type": "registered", "accept_rate": 82, "profile_image": "https://www.gravatar.com/avatar/220a45c2fcff7e7358d144551b116205?s=128&d=identicon&r=PG&f=1", "display_name": "Alec", "link": "https://stackoverflow.com/users/3072788/alec"}, "edited": false, "score": 0, "creation_date": 1484946808, "post_id": 41770839, "comment_id": 70736287, "body": "@Alec you&#39;re right. But <code>OverlappingInstances</code> are slightly scarier I believe."}], "tags": [], "owner": {"reputation": 11612, "user_id": 204218, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/3ee571049ff6ff0361be53e554b877e6?s=128&d=identicon&r=PG", "display_name": "adamse", "link": "https://stackoverflow.com/users/204218/adamse"}, "is_accepted": true, "score": 6, "last_activity_date": 1484946873, "last_edit_date": 1484946873, "creation_date": 1484939696, "answer_id": 41770839, "question_id": 41770707, "link": "https://stackoverflow.com/questions/41770707/pattern-matching-of-instance-implementation/41770839#41770839", "title": "Pattern matching of instance implementation", "body": "<p><em>An update for your update.</em> You can make it work if you are willing to turn on some extensions:</p>\n\n<pre><code>{-# LANGUAGE FlexibleInstances #-}\n\ndata EmptyOpt = EmptyOpt\n\ndata OptionList a b =\n  OptionList a b\n  deriving (Read)\n\ninstance (Show a, Show b) =&gt; Show (OptionList a b) where\n  show (OptionList a b) = \"{ \" ++ show a ++ \", \" ++ show b ++ \" }\"\n\ninstance {-# OVERLAPPING  #-} (Show a) =&gt; Show (OptionList a EmptyOpt) where\n  show (OptionList a EmptyOpt) = \"{ \" ++ show a ++ \" }\"\n\n(+:) :: a -&gt; b -&gt; (OptionList a b)\ninfixr 5 +:\nt1 +: t2 = OptionList t1 t2\n\ntest = 0 +: \"test\" +: True +: EmptyOpt\n</code></pre>\n\n<p>But personally I would try to make do with something like</p>\n\n<pre><code>data Option = B Bool | I Int | S String\ndata OptionsList = Empty | OptionsList Option OptionsList\n</code></pre>\n\n<hr>\n\n<p>Your trouble is that the instance head (<code>(Show a, Show b) =&gt; Show (OptionList a b)</code>) says that you are implementing <code>Show</code> for <code>OptionList a b</code> where <code>a</code> and <code>b</code> are any types with <code>Show</code> instances, but in your implementation you require that both <code>a</code> and <code>b</code> actually are of type <code>OptionList</code>. </p>\n\n<p>Perhaps you would change your type to be more like an ordinary list:</p>\n\n<pre><code>data OptionList a\n  = EmptyOpt\n  | OptionList { optListHead :: a\n              ,  optListTail :: OptionList a}\n  deriving (Read)\n</code></pre>\n\n<p>Then you can have an instance:</p>\n\n<pre><code>instance (Show a) =&gt; Show (OptionList a) where\n  show (OptionList a EmptyOpt) = \"{\" ++ show a ++\"}\"\n  show (OptionList a b) = \"{\"++ show a ++ \", \" ++ show b ++\"}\"\n  show EmptyOpt = \"\"\n</code></pre>\n"}, {"tags": [], "owner": {"reputation": 314794, "user_id": 67579, "user_type": "registered", "accept_rate": 81, "profile_image": "https://i.stack.imgur.com/BJXub.png?s=128&g=1", "display_name": "Willem Van Onsem", "link": "https://stackoverflow.com/users/67579/willem-van-onsem"}, "is_accepted": false, "score": 3, "last_activity_date": 1484939700, "creation_date": 1484939700, "answer_id": 41770841, "question_id": 41770707, "link": "https://stackoverflow.com/questions/41770707/pattern-matching-of-instance-implementation/41770841#41770841", "title": "Pattern matching of instance implementation", "body": "<p>The problem is that in your instance declaration:</p>\n\n<pre>\ninstance (Show a, Show b) => Show (OptionList a b) where\n    show (OptionList a <b>EmptyOpt</b>) = \"{\" ++ (show a) ++\"}\"\n    show (OptionList <b>EmptyOpt</b> b) = \"{\" ++ (show b) ++\"}\"\n    show (OptionList a b) = \"{\"++ (show a) ++ \", \" ++ (show b) ++\"}\"\n    show EmptyOpt = \"\"\n</pre>\n\n<p>You <strong>use dataconstructors</strong>. Therefore Haskell derives - correctly - that you actually define a <code>show</code> over <code>OptionList (OptionList c d) (OptionList e f)</code>: after all <code>EmptyOpt</code> is a construct of <code>OptionList a b</code>, so <strong>you cannot use these as arguments</strong> since in the head of your instance you say you are going to define the instance for <code>OptionList a b</code> with generic <code>a</code> and <code>b</code>.</p>\n\n<p>So it is not clear for me what you aim to do; modifying it to:</p>\n\n<pre><code>instance (Show a, Show b, Show c, Show d) =&gt; Show (OptionList (OptionList a b) (OptionList c d)) where\n</code></pre>\n\n<p>would not help either, since the structure is recursive, and you thus would define the instance with infinite recursive depth.</p>\n\n<p>The only thing that seems reasonable to me, is that your data definition is wrong, and should be something like:</p>\n\n<pre><code>data OptionList a = EmptyOpt | OptionList { optListHead :: a, optListTail :: OptionList a }\n</code></pre>\n\n<p>in which case, you can define it as:</p>\n\n<pre><code>instance Show a =&gt; Show (OptionList a) where\n    show (OptionList a b) = \"{\"++ show a ++ \", \" ++ show b ++\"}\"\n    show EmptyOpt = \"\"\n</code></pre>\n\n<p>or something along these lines.</p>\n"}, {"tags": [], "owner": {"reputation": 951, "user_id": 6253996, "user_type": "registered", "accept_rate": 75, "profile_image": "https://i.stack.imgur.com/XUk8U.jpg?s=128&g=1", "display_name": "bzim", "link": "https://stackoverflow.com/users/6253996/bzim"}, "is_accepted": false, "score": 0, "last_activity_date": 1484943156, "creation_date": 1484943156, "answer_id": 41771639, "question_id": 41770707, "link": "https://stackoverflow.com/questions/41770707/pattern-matching-of-instance-implementation/41771639#41771639", "title": "Pattern matching of instance implementation", "body": "<p>My idea was to create a type independent list. And this list's elements were supposed to hold any type declared. But I will give up and do something like a C Union:</p>\n\n<pre><code>data Option = OptStr String | OptInt Int | OptBool Bool\n</code></pre>\n"}], "owner": {"reputation": 951, "user_id": 6253996, "user_type": "registered", "accept_rate": 75, "profile_image": "https://i.stack.imgur.com/XUk8U.jpg?s=128&g=1", "display_name": "bzim", "link": "https://stackoverflow.com/users/6253996/bzim"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 948, "favorite_count": 0, "accepted_answer_id": 41770839, "answer_count": 3, "score": 3, "last_activity_date": 1484952285, "creation_date": 1484939117, "last_edit_date": 1484952285, "question_id": 41770707, "link": "https://stackoverflow.com/questions/41770707/pattern-matching-of-instance-implementation", "title": "Pattern matching of instance implementation", "body": "<p>I'm trying to implement show method of a data type.</p>\n\n<pre><code>data OptionList a b = EmptyOpt | OptionList { optListHead :: a, optListTail :: b } deriving (Read)\n\ninstance (Show a, Show b) =&gt; Show (OptionList a b) where\n    show (OptionList a EmptyOpt) = \"{\" ++ (show a) ++\"}\"\n    show (OptionList EmptyOpt b) = \"{\" ++ (show b) ++\"}\"\n    show (OptionList a b) = \"{\"++ (show a) ++ \", \" ++ (show b) ++\"}\"\n    show EmptyOpt = \"\"\n</code></pre>\n\n<p>I want the OptionList not to show a comma if one of <code>a</code> or <code>b</code> has a value constructed by EmptyOpt. But the compiler shows the following error:</p>\n\n<pre><code>OptionList.hs:11:28:\n    Couldn't match expected type \u2018b\u2019\n                with actual type \u2018OptionList t0 t1\u2019\n      \u2018b\u2019 is a rigid type variable bound by\n          the instance declaration at OptionList.hs:10:10\n    Relevant bindings include\n      show :: OptionList a b -&gt; String (bound at OptionList.hs:11:9)\n    In the pattern: EmptyOpt\n    In the pattern: OptionList a EmptyOpt\n    In an equation for \u2018show\u2019:\n        show (OptionList a EmptyOpt) = \"{\" ++ (show a) ++ \"}\"\n\nOptionList.hs:12:26:\n    Couldn't match expected type \u2018a\u2019\n                with actual type \u2018OptionList t2 t3\u2019\n      \u2018a\u2019 is a rigid type variable bound by\n          the instance declaration at OptionList.hs:10:10\n    Relevant bindings include\n      show :: OptionList a b -&gt; String (bound at OptionList.hs:11:9)\n    In the pattern: EmptyOpt\n    In the pattern: OptionList EmptyOpt b\n    In an equation for \u2018show\u2019:\n        show (OptionList EmptyOpt b) = \"{\" ++ (show b) ++ \"}\"\n</code></pre>\n\n<p><em>UPDATE</em>: OptionList is supposed to be something like a typeless list.</p>\n\n<pre><code>(+:) :: a -&gt; b -&gt; (OptionList a b)\ninfixr 5 +:\nt1 +: t2 = OptionList t1 t2\n</code></pre>\n\n<p>So, a list like: <code>0 +: \"test\" +: True</code> would be defined like <code>OptionList Int (OptionList String (OptionList Bool EmptyOpt))</code> And would be <code>show</code>n as <code>{0, {\"test\", {True}}}</code></p>\n"}, {"tags": ["function", "haskell", "lambda", "anonymous-function"], "comments": [{"owner": {"reputation": 16233, "user_id": 4253229, "user_type": "registered", "accept_rate": 83, "profile_image": "https://lh4.googleusercontent.com/-e2FAQvlj5CQ/AAAAAAAAAAI/AAAAAAAAAqM/TlSnekirgNE/photo.jpg?sz=128", "display_name": "Eugene Sh.", "link": "https://stackoverflow.com/users/4253229/eugene-sh"}, "edited": false, "score": 1, "creation_date": 1484937622, "post_id": 41770300, "comment_id": 70732052, "body": "What is &quot;store&quot;? What is &quot;2x Strings&quot;?"}, {"owner": {"reputation": 314794, "user_id": 67579, "user_type": "registered", "accept_rate": 81, "profile_image": "https://i.stack.imgur.com/BJXub.png?s=128&g=1", "display_name": "Willem Van Onsem", "link": "https://stackoverflow.com/users/67579/willem-van-onsem"}, "edited": false, "score": 2, "creation_date": 1484937745, "post_id": 41770300, "comment_id": 70732118, "body": "Is this an obfuscation of the <code>Phonebook</code> exercise?"}, {"owner": {"reputation": 75362, "user_id": 625403, "user_type": "registered", "accept_rate": 82, "profile_image": "https://www.gravatar.com/avatar/786eed7da67079cb5d63a49d469af25b?s=128&d=identicon&r=PG", "display_name": "amalloy", "link": "https://stackoverflow.com/users/625403/amalloy"}, "edited": false, "score": 1, "creation_date": 1484938214, "post_id": 41770300, "comment_id": 70732341, "body": "It looks like the same assignment as the recent question <a href=\"http://stackoverflow.com/questions/41753366/identifying-input-values-for-which-a-function-does-not-generate-a-specific-outpu\" title=\"identifying input values for which a function does not generate a specific outpu\">stackoverflow.com/questions/41753366/&hellip;</a>"}, {"owner": {"reputation": 384463, "user_id": 1126841, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/fa05233b2357f8d11c22ef4cfc7bb85c?s=128&d=identicon&r=PG", "display_name": "chepner", "link": "https://stackoverflow.com/users/1126841/chepner"}, "edited": false, "score": 0, "creation_date": 1484938497, "post_id": 41770300, "comment_id": 70732472, "body": "<code>a</code> refers to a single string, not a function. It&#39;s not a valid argument to <code>myCode</code> in the binding to <code>b</code>. Even if it was, the result of <code>myCode</code> is a value of type <code>MyType</code>, which is applicable to <i>one</i> value, not 4. You appear to have a severe misunderstanding of how functions are defined and applied, and that is making it extremely difficult to decipher what you are trying to do."}], "answers": [{"comments": [{"owner": {"reputation": 113, "user_id": 7200922, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/c9yJO.jpg?s=128&g=1", "display_name": "Fireapprentice", "link": "https://stackoverflow.com/users/7200922/fireapprentice"}, "edited": false, "score": 0, "creation_date": 1485005238, "post_id": 41771075, "comment_id": 70750110, "body": "So easy to guess the task - must be a common one :) Thank you very much for your help"}], "tags": [], "owner": {"reputation": 1392, "user_id": 5198575, "user_type": "registered", "profile_image": "https://lh6.googleusercontent.com/-RAYCSjVZdnQ/AAAAAAAAAAI/AAAAAAAAClo/VQ8V_H3l8O8/photo.jpg?sz=128", "display_name": "trevor cook", "link": "https://stackoverflow.com/users/5198575/trevor-cook"}, "is_accepted": true, "score": 1, "last_activity_date": 1484960019, "last_edit_date": 1484960019, "creation_date": 1484940783, "answer_id": 41771075, "question_id": 41770300, "link": "https://stackoverflow.com/questions/41770300/haskell-have-a-function-call-a-function/41771075#41771075", "title": "Haskell - have a function call a function", "body": "<p>From the question linked by amalloy in the comments, it looks like you are trying to build a phonebook based on a continuation passing style like paradigm.</p>\n\n<p>Basically, what is supposed to happen for your type</p>\n\n<pre><code>myCode :: String -&gt; String -&gt; MyType -&gt; MyType\n</code></pre>\n\n<p>is that you will generate a piece of data <code>dat = myCode a b pb</code>, which is of type <code>MyType</code>. So, you can query <code>dat</code> with an <code>s :: String</code> and it will output another <code>String</code>. In the operation of <code>dat s</code>, if you expand it to the definition, </p>\n\n<pre><code>dat s = myCode a b pb s\n</code></pre>\n\n<p>you have access to three strings, <code>a</code>, <code>b</code>, and whatever <code>pb s</code> returns. You will build up functionality recursively, either by doing something with <code>a</code> <code>b</code> and <code>s</code>, or pushing it down the road to <code>pb</code>, letting the continuation handle it. </p>\n\n<p>Hope this helps without giving too much away.</p>\n"}], "owner": {"reputation": 113, "user_id": 7200922, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/c9yJO.jpg?s=128&g=1", "display_name": "Fireapprentice", "link": "https://stackoverflow.com/users/7200922/fireapprentice"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 1008, "favorite_count": 0, "accepted_answer_id": 41771075, "answer_count": 1, "score": 0, "last_activity_date": 1484960019, "creation_date": 1484937414, "question_id": 41770300, "link": "https://stackoverflow.com/questions/41770300/haskell-have-a-function-call-a-function", "title": "Haskell - have a function call a function", "body": "<p>we are currently sitting on a task from university, which we don't fully understand (please no solution but only ideas or suggestions).</p>\n\n<p>What is given is a type: </p>\n\n<pre><code>type MyType = String -&gt; String\n</code></pre>\n\n<p>Now we are trying to be able to have a function, which takes 2 Strings and a function (the type) and then gives a function (type)</p>\n\n<pre><code>myCode :: String -&gt; String -&gt; MyType -&gt; MyType\n</code></pre>\n\n<p>and we already implemented a function, which can be used as MyType one: </p>\n\n<pre><code>emptyString :: MyType\nemptyString :: (\\a -&gt; \"\")\n</code></pre>\n\n<p>The task is to be able to store several 2x Strings. This is our current idea:</p>\n\n<pre><code>myCode :: String -&gt; String -&gt; MyType -&gt;MyType\nmyCode a b c = (\\x -&gt; b)\n</code></pre>\n\n<p>in this case we have an input String, which is \"Hello\" and another one which is \"World\" and then as c we put in the \"emptyString\". \nThis works for one String, because when we type the following in the console: </p>\n\n<pre><code>a = (myCode \"Hello\" \"World\" emptyString) \"\"\n</code></pre>\n\n<p>we get \"World\" on input \"a\". Now the hard part: We should be able to store several of these (searching them is another task, not needed right now). We thought we might be able to use \"a\" now when declaring another variable:</p>\n\n<pre><code>b = (myCode \"1\" \"2\" a) \"Hello\" \"World\" emptyString \"\")\n</code></pre>\n\n<p>This would call in \"b\" the function saved as \"a\" and within this the \"emptyString\". \nAs you may have guessed - it doesn't work! And we are really at a loss on how to carry on from now.</p>\n\n<p>When you reached this part, it means you took the time to understand our complicated explanation of our task - thanks a lot. </p>\n\n<p>Thanks for suggestions and help in advance!</p>\n"}, {"tags": ["haskell", "binary-tree", "binary-search-tree"], "comments": [{"owner": {"reputation": 181215, "user_id": 82294, "user_type": "registered", "accept_rate": 67, "profile_image": "https://www.gravatar.com/avatar/5c5f910416e2b92bb73fa59c56fe695d?s=128&d=identicon&r=PG", "display_name": "Dietrich Epp", "link": "https://stackoverflow.com/users/82294/dietrich-epp"}, "edited": false, "score": 0, "creation_date": 1484935256, "post_id": 41769575, "comment_id": 70730822, "body": "There are some extra parentheses in your code, here is what it looks like cleaned up: <a href=\"http://pastebin.com/vpNKvDW7\" rel=\"nofollow noreferrer\">pastebin.com/vpNKvDW7</a>"}, {"owner": {"reputation": 100185, "user_id": 3234959, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/93bb12ca0f93dfddb33880316f7e66c2?s=128&d=identicon&r=PG&f=1", "display_name": "chi", "link": "https://stackoverflow.com/users/3234959/chi"}, "edited": false, "score": 1, "creation_date": 1484946293, "post_id": 41769575, "comment_id": 70736062, "body": "I don&#39;t think you actually <i>need</i> to call <code>insert 5 Node Leaf 2 Leaf</code> without parentheses. This looks as a XY problem to me -- as if you needed something completely different, but only mentioned parentheses. What are you actually trying to achieve with that?"}], "answers": [{"tags": [], "owner": {"reputation": 339851, "user_id": 149392, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/7a561ec0875fcbbe3066ea8fe288ec77?s=128&d=identicon&r=PG", "display_name": "sepp2k", "link": "https://stackoverflow.com/users/149392/sepp2k"}, "is_accepted": false, "score": 6, "last_activity_date": 1484934968, "creation_date": 1484934968, "answer_id": 41769685, "question_id": 41769575, "link": "https://stackoverflow.com/questions/41769575/what-is-the-correct-way-to-define-an-argument-in-haskell-function/41769685#41769685", "title": "what is the correct way to define an argument in Haskell function", "body": "<p><code>insert 5 Node Leaf 2 Leaf</code> calls the <code>insert</code> function with 5 arguments, not two. If you want this to work, the only way is to define <code>insert</code> to take 5 arguments.</p>\n\n<p>There's no way to make both <code>insert 5 Node Leaf 2 Leaf</code> and <code>insert 5 (Node Leaf 2 Leaf)</code> work nor is there a way to make the 5-argument version work with smaller or larger trees, so there'd be very little point to it.</p>\n\n<p>If you want to avoid parentheses, you could just use <code>$</code> instead:</p>\n\n<pre><code>insert 5 $ Node Leaf 2 Leaf\n</code></pre>\n"}, {"tags": [], "owner": {"reputation": 1392, "user_id": 5198575, "user_type": "registered", "profile_image": "https://lh6.googleusercontent.com/-RAYCSjVZdnQ/AAAAAAAAAAI/AAAAAAAAClo/VQ8V_H3l8O8/photo.jpg?sz=128", "display_name": "trevor cook", "link": "https://stackoverflow.com/users/5198575/trevor-cook"}, "is_accepted": false, "score": 1, "last_activity_date": 1484935850, "creation_date": 1484935850, "answer_id": 41769899, "question_id": 41769575, "link": "https://stackoverflow.com/questions/41769575/what-is-the-correct-way-to-define-an-argument-in-haskell-function/41769899#41769899", "title": "what is the correct way to define an argument in Haskell function", "body": "<p>I have a feeling what you want is impossible. With parenthesis, insert has a type <code>insert::a -&gt; BinaryTree a -&gt; BinaryTree a</code> (Constraints elided for clarity). However, without parenthesis the type would be: <code>insert::a -&gt; (BinaryTree a -&gt; a -&gt; BinaryTree a -&gt; BinaryTree a) -&gt; BinaryTree a -&gt; a -&gt; BinaryTree a -&gt; BinaryTree a</code></p>\n\n<p>To get you closer, however, there's a few options I can suggest.</p>\n\n<p>First, use the low-precedence application operator <code>$</code></p>\n\n<pre><code>insert 5 $ Node Leaf 2 Leaf\n</code></pre>\n\n<p>Second, you might bind the new sub-tree by using a <code>let</code>, or <code>where</code> clause</p>\n\n<pre><code>let t = Node Leaf 2 Leaf\nin  insert 5 t\n</code></pre>\n\n<p>or </p>\n\n<pre><code>insert 5 t\n  where t = Node Leaf 2 Leaf\n</code></pre>\n\n<p>Third, use a one argument constructor, but this again needs parentheses or <code>$</code>.</p>\n\n<pre><code>node n = Node Leaf n Leaf\n--One of the following\ninsert 5 . node $ 2\n(insert 5 . node) 2\ninsert 5 (node 2)\n</code></pre>\n"}], "owner": {"reputation": 11, "user_id": 7012747, "user_type": "registered", "accept_rate": 0, "profile_image": "https://www.gravatar.com/avatar/292280aa41f1c2660241442a5c88040a?s=128&d=identicon&r=PG&f=1", "display_name": "ro.Loon", "link": "https://stackoverflow.com/users/7012747/ro-loon"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 71, "favorite_count": 0, "answer_count": 2, "score": 0, "last_activity_date": 1484935850, "creation_date": 1484934518, "question_id": 41769575, "link": "https://stackoverflow.com/questions/41769575/what-is-the-correct-way-to-define-an-argument-in-haskell-function", "title": "what is the correct way to define an argument in Haskell function", "body": "<p>I'm working with binary search trees in Haskell.</p>\n\n<p>Here is the code I wrote</p>\n\n<pre><code>data BinaryTree a = Leaf | Node (BinaryTree a) a (BinaryTree a)\n deriving (Show, Eq)\n  insert :: (Ord a, Eq a) =&gt; a -&gt; BinaryTree a -&gt; BinaryTree a\n  insert e (Leaf)= (Node Leaf e Leaf)\n  insert e (Node n1 a n2) \n      | e&lt;a=(Node (insert e n1) a n2)\n      | otherwise = (Node n1 a (insert e n2))\n</code></pre>\n\n<p>So basically this piece of code inserts the element in the BST and it works fine if the second argument is locked inside the parentheses (e.g <code>insert 5 (Node Leaf 2 Leaf)</code>),but in order to obtain what I want, I need my program to work in both cases, when the second argument in inside parentheses and when it isn't (e.g. <code>insert 5 Node Leaf 2 Leaf</code>) \nCan you advise something on how this code can be rewritten in order to obtain what is described above</p>\n"}, {"tags": ["haskell", "window-managers", "xmonad"], "comments": [{"owner": {"reputation": 126897, "user_id": 791604, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/ce991df7a056248d5e4f6fc3659ba733?s=128&d=identicon&r=PG", "display_name": "Daniel Wagner", "link": "https://stackoverflow.com/users/791604/daniel-wagner"}, "edited": false, "score": 1, "creation_date": 1484938994, "post_id": 41769170, "comment_id": 70732712, "body": "You might like <a href=\"http://hackage.haskell.org/package/xmonad-contrib-0.12/docs/XMonad-Actions-GridSelect.html#v:goToSelected\" rel=\"nofollow noreferrer\"><code>goToSelected</code></a>, which will show a grid of window titles. Navigate the grid with your arrow keys and choose a window to jump to the workspace for that window. Does that seem like a starting point?"}], "answers": [{"tags": [], "owner": {"reputation": 1940, "user_id": 5773806, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/438f0f7a7ca24486577712c68a9cb131?s=128&d=identicon&r=PG&f=1", "display_name": "GiftZwergrapper", "link": "https://stackoverflow.com/users/5773806/giftzwergrapper"}, "is_accepted": false, "score": 1, "last_activity_date": 1486996046, "creation_date": 1486996046, "answer_id": 42206436, "question_id": 41769170, "link": "https://stackoverflow.com/questions/41769170/xmonad-overview-of-all-currently-opened-windows/42206436#42206436", "title": "XMonad: Overview of All Currently Opened Windows", "body": "<p>You could use <code>xmobar</code> for this purpose, if right configured, it shows your current workspace(s) and all workspaces that have open windows or programs in it.</p>\n\n<p>Looks like this:\n<a href=\"https://i.stack.imgur.com/a3Ivy.png\" rel=\"nofollow noreferrer\"><img src=\"https://i.stack.imgur.com/a3Ivy.png\" alt=\"xmobar example\"></a></p>\n\n<p>And this is the config for it:</p>\n\n<p><code>xmonad.hs</code>:</p>\n\n<pre><code> main = do\n   xmproc &lt;- spawnPipe \"/usr/bin/xmobar /home/svoelkl/.xmobarrc\"\n   status &lt;- spawnPipe myDzenStatus\n   conky  &lt;- spawnPipe myDzenConky\n   xmonad $ defaultConfig\n              { manageHook = manageSpawn &lt;+&gt; myManageHook &lt;+&gt; manageDocks,\n                layoutHook = myLayout,\n                logHook = dynamicLogWithPP xmobarPP {\n                            ppOutput = hPutStrLn xmproc,\n                            ppLayout = (\\ x -&gt; \"\"),\n                            ppTitle = xmobarColor \"#b2ed00\" \"\"\n                          } &gt;&gt; updatePointer (Relative 0.99 0.99),\n                modMask = mod4Mask,\n                borderWidth = 4,\n                normalBorderColor = \"#777777\",\n                focusedBorderColor = \"#ccff00\",\n                workspaces = myWorkspaces,\n                focusFollowsMouse = True,\n                terminal = \"x-terminal-emulator\"\n              }\n              `removeKeys` myRemoveKeys\n              `additionalKeys` myAdditionalKeys\n</code></pre>\n\n<p><code>.xmobarrc</code>:</p>\n\n<pre><code> Config { position = TopSize L 90 24\n        , lowerOnStart = True\n        , bgColor = \"black\"\n        , fgColor = \"grey\"\n        , commands = [ Run Date \"%a %_d %l:%M\" \"date\" 10\n                     , Run StdinReader\n                     , Run BatteryP [\"BAT0\"]\n                       [\"-t\", \"&lt;acstatus&gt;&lt;watts&gt; (&lt;left&gt;%)\",\n                        \"-L\", \"10\", \"-H\", \"80\", \"-p\", \"3\",\n                        \"--\", \"-O\", \"&lt;fc=#b2ed00&gt;On&lt;/fc&gt; -\", \"-o\", \"\",\n                        \"-L\", \"-15\", \"-H\", \"-5\",\n                        \"-l\", \"red\", \"-m\", \"blue\", \"-h\", \"green\"]\n                        600\n                     ]\n        , template = \"%StdinReader% }{ %battery% &lt;fc=#ee9a00&gt;%date%&lt;/fc&gt;\"\n        }\n</code></pre>\n"}, {"tags": [], "owner": {"reputation": 19307, "user_id": 1663462, "user_type": "registered", "accept_rate": 78, "profile_image": "https://www.gravatar.com/avatar/c30e0fa0f3a065c038c633a95066d299?s=128&d=identicon&r=PG", "display_name": "Chris Stryczynski", "link": "https://stackoverflow.com/users/1663462/chris-stryczynski"}, "is_accepted": false, "score": 1, "last_activity_date": 1493558998, "creation_date": 1493558998, "answer_id": 43706940, "question_id": 41769170, "link": "https://stackoverflow.com/questions/41769170/xmonad-overview-of-all-currently-opened-windows/43706940#43706940", "title": "XMonad: Overview of All Currently Opened Windows", "body": "<p>XMonad is only a windows manager. You'll need something like xmobar/tint2/dzen to display the currently running applications.</p>\n\n<p>An example of tint2:\n<a href=\"https://i.stack.imgur.com/GGQSP.jpg\" rel=\"nofollow noreferrer\"><img src=\"https://i.stack.imgur.com/GGQSP.jpg\" alt=\"enter image description here\"></a></p>\n"}, {"tags": [], "owner": {"reputation": 11, "user_id": 8924545, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/e0d8681db8bff70074d4b07266141e32?s=128&d=identicon&r=PG&f=1", "display_name": "Dmitry Tron", "link": "https://stackoverflow.com/users/8924545/dmitry-tron"}, "is_accepted": false, "score": 0, "last_activity_date": 1607121285, "creation_date": 1607121285, "answer_id": 65151691, "question_id": 41769170, "link": "https://stackoverflow.com/questions/41769170/xmonad-overview-of-all-currently-opened-windows/65151691#65151691", "title": "XMonad: Overview of All Currently Opened Windows", "body": "<p>You can use  <a href=\"https://hackage.haskell.org/package/xmonad-contrib-0.13/docs/XMonad-Actions-GridSelect.html\" rel=\"nofollow noreferrer\">XMonad.Actions.GridSelect</a> from xmonad-contrib. It will provide you with simple pop-up menu, similar to alt-tab menu in more 'traditional' GUI enviroinments.\nJust add that keybinding</p>\n<pre><code>((modm, xK_g), goToSelected defaultGSConfig)\n</code></pre>\n<p>as explained in the link above.</p>\n<p>Also check out <a href=\"https://hackage.haskell.org/package/xmonad-contrib-0.13/docs/XMonad-Actions-TreeSelect.html\" rel=\"nofollow noreferrer\">XMonad.Actions.TreeSelect</a>, this might be closer to what you want.</p>\n"}], "owner": {"reputation": 5352, "user_id": 4896150, "user_type": "registered", "accept_rate": 43, "profile_image": "https://www.gravatar.com/avatar/74d0c938f3f71d6ee14db4f6b9d222c2?s=128&d=identicon&r=PG&f=1", "display_name": "Anton Harald", "link": "https://stackoverflow.com/users/4896150/anton-harald"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 1460, "favorite_count": 0, "answer_count": 3, "score": 2, "last_activity_date": 1607121285, "creation_date": 1484932993, "question_id": 41769170, "link": "https://stackoverflow.com/questions/41769170/xmonad-overview-of-all-currently-opened-windows", "title": "XMonad: Overview of All Currently Opened Windows", "body": "<p>In XMonad is there any way to see an overview of all the currently used workspaces including their current windows at a time?</p>\n\n<p>I think it's a very practical piece of software but I have not found any extension that does something like this. Unless you do remember on which workspace you put all your windows, you end up cycling through the workspaces in order to find one particular window.</p>\n\n<p>I'm thinking for instance of one extra workspace (maybe accessed by MOD-0) which gives you the overview. It could maybe even include some thumbnails of the open workspaces. But for the start a text based summary of the window titles would be ok. Does anybody know if this is existing? Or - if not - could anybody give me a rough direction where to start developing an extension/module doing this, maybe another extension that could be used as a point of departure or so.</p>\n"}, {"tags": ["haskell", "recursion"], "comments": [{"owner": {"reputation": 384463, "user_id": 1126841, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/fa05233b2357f8d11c22ef4cfc7bb85c?s=128&d=identicon&r=PG", "display_name": "chepner", "link": "https://stackoverflow.com/users/1126841/chepner"}, "edited": false, "score": 4, "creation_date": 1484932545, "post_id": 41769014, "comment_id": 70729505, "body": "Show the code you have so far."}, {"owner": {"reputation": 339851, "user_id": 149392, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/7a561ec0875fcbbe3066ea8fe288ec77?s=128&d=identicon&r=PG", "display_name": "sepp2k", "link": "https://stackoverflow.com/users/149392/sepp2k"}, "edited": false, "score": 1, "creation_date": 1484932553, "post_id": 41769014, "comment_id": 70729509, "body": "If it only ever gives you the result of the base case, that sounds like the non-base case just recurs without doing anything with the result, but you should really show your code, so we can tell for sure."}], "answers": [{"tags": [], "owner": {"reputation": 181215, "user_id": 82294, "user_type": "registered", "accept_rate": 67, "profile_image": "https://www.gravatar.com/avatar/5c5f910416e2b92bb73fa59c56fe695d?s=128&d=identicon&r=PG", "display_name": "Dietrich Epp", "link": "https://stackoverflow.com/users/82294/dietrich-epp"}, "is_accepted": true, "score": 4, "last_activity_date": 1484934680, "creation_date": 1484934680, "answer_id": 41769615, "question_id": 41769014, "link": "https://stackoverflow.com/questions/41769014/using-recursion-in-haskell/41769615#41769615", "title": "Using recursion in haskell", "body": "<p>Here's an analysis:</p>\n\n<pre><code>add :: Nat -&gt; Nat -&gt; Nat\n\n-- 0 + 0 = 0, looks good\nadd Zero   Zero = Zero\n\n-- 0 + (1 + i) = 1 + (i - 1), wait, what?  No.\nadd Zero   (Succ i) =  Succ(pred i)\n\n-- (1 + i) + 0 = 1 + (i - 1), again, no.\nadd (Succ i) Zero = Succ(pred i)\n\n-- (1 + i) + (1 + j) = 1 + (i + j), no.\nadd (Succ i) (Succ j) = Succ(add i j)\n</code></pre>\n\n<p>You can see that it's a bit more obvious what is wrong when you translate it back into ordinary algebra.</p>\n\n<p>Hint: You don't need to call <code>pred</code>, and you don't need more than two cases.</p>\n\n<p>Also note that this is weird formatting:</p>\n\n<pre><code>Succ(pred i)\nSucc(Zero)\n</code></pre>\n\n<p>Haskell should look like this:</p>\n\n<pre><code>Succ (pred i)\nSucc Zero\n</code></pre>\n"}], "owner": {"reputation": 225, "user_id": 7020730, "user_type": "registered", "accept_rate": 89, "profile_image": "https://www.gravatar.com/avatar/33decfaa1ab02bc7fbf8f0794fc86882?s=128&d=identicon&r=PG&f=1", "display_name": "Dringo", "link": "https://stackoverflow.com/users/7020730/dringo"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 236, "favorite_count": 0, "accepted_answer_id": 41769615, "answer_count": 1, "score": 0, "last_activity_date": 1484934680, "creation_date": 1484932408, "last_edit_date": 1484934375, "question_id": 41769014, "link": "https://stackoverflow.com/questions/41769014/using-recursion-in-haskell", "title": "Using recursion in haskell", "body": "<p>Hi all so I have this homework assignment in Haskell where we have to work with the Nat Data type which only gives <code>Zero</code> and <code>Succ(n)</code> for one. So one is <code>Succ(Zero)</code>, two is <code>Succ(Succ(Zero))</code> and so on. We are also supposed to add subtract multiply these data types recursively. </p>\n\n<p>One of the problems look like this </p>\n\n<pre><code>--Add two natural numbers.\n--\n--   `&gt;&gt;&gt; add one two`\n--   Succ (Succ (Succ Zero))\n--\n--   `&gt;&gt;&gt; add Zero one == one`\n--   True\n--\n--   `&gt;&gt;&gt; add two two == four`\n--   True\n--\n--   `&gt;&gt;&gt; add two three == add three two`\n--   True\n--\n</code></pre>\n\n<p>My problem is when I am doing recursion I have a base case, but as I call it it just returns the base case and doesn't particularly bubble back up. </p>\n\n<p>Any help or explanation on how to recursion in Haskell with pattern matching would be appreciated</p>\n\n<p>EDIT: The code I have is</p>\n\n<pre><code>add :: Nat -&gt; Nat -&gt; Nat\nadd Zero   Zero = Zero\nadd Zero   (Succ i) =  Succ(pred i)\nadd (Succ i) Zero = Succ(pred i)\nadd (Succ i) (Succ j) = Succ(add i j)\n</code></pre>\n\n<p>Where pred is another function </p>\n\n<pre><code>pred :: Nat -&gt; Nat\npred Zero = Zero\npred (Succ Zero) = Zero\npred (Succ i) = Succ(pred i)\n</code></pre>\n"}, {"tags": ["haskell", "ghc", "compiler-warnings"], "answers": [{"tags": [], "owner": {"reputation": 8237, "user_id": 2900502, "user_type": "registered", "accept_rate": 73, "profile_image": "https://i.stack.imgur.com/R1OjD.jpg?s=128&g=1", "display_name": "Shersh", "link": "https://stackoverflow.com/users/2900502/shersh"}, "is_accepted": true, "score": 24, "last_activity_date": 1586360781, "last_edit_date": 1586360781, "creation_date": 1484951451, "answer_id": 41773411, "question_id": 41768887, "link": "https://stackoverflow.com/questions/41768887/how-can-i-disable-haskell-warning-in-small-block/41773411#41773411", "title": "How can I disable Haskell warning in small block?", "body": "<p>No, you can't currently in GHC 8.10.1</p>\n\n<p>The <code>{-# OPTIONS_GHC #-}</code> pragma is file-header only and applies to the whole module. And there are no such pragmas (or other ways) to suppress warnings in specific locations. You can check the full list of pragmas in the Haskell user guide:</p>\n\n<p><a href=\"https://downloads.haskell.org/~ghc/latest/docs/html/users_guide/glasgow_exts.html#pragmas\" rel=\"nofollow noreferrer\">https://downloads.haskell.org/~ghc/latest/docs/html/users_guide/glasgow_exts.html#pragmas</a></p>\n\n<p>The list of warnings might also be interesting:</p>\n\n<p><a href=\"https://downloads.haskell.org/~ghc/latest/docs/html/users_guide/using-warnings.html\" rel=\"nofollow noreferrer\">https://downloads.haskell.org/~ghc/latest/docs/html/users_guide/using-warnings.html</a></p>\n"}], "owner": {"reputation": 453, "user_id": 2756490, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/31bd5947bf7793136ae44e307a2455f4?s=128&d=identicon&r=PG", "display_name": "juhyung park", "link": "https://stackoverflow.com/users/2756490/juhyung-park"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 4767, "favorite_count": 1, "accepted_answer_id": 41773411, "answer_count": 1, "score": 30, "last_activity_date": 1586360781, "creation_date": 1484931938, "last_edit_date": 1499319403, "question_id": 41768887, "link": "https://stackoverflow.com/questions/41768887/how-can-i-disable-haskell-warning-in-small-block", "title": "How can I disable Haskell warning in small block?", "body": "<p>I want to disable warning only some block of code.</p>\n\n<p>I searched Google but only find file scope or global scope disable method.\nUsing cabal file or pragma </p>\n\n<pre><code>{-# OPTIONS_GHC #-}\n</code></pre>\n\n<p>Can I disable warning for specific function?</p>\n"}, {"tags": ["debugging", "haskell", "monads"], "comments": [{"owner": {"reputation": 29444, "user_id": 3072788, "user_type": "registered", "accept_rate": 82, "profile_image": "https://www.gravatar.com/avatar/220a45c2fcff7e7358d144551b116205?s=128&d=identicon&r=PG&f=1", "display_name": "Alec", "link": "https://stackoverflow.com/users/3072788/alec"}, "edited": false, "score": 0, "creation_date": 1484927225, "post_id": 41766230, "comment_id": 70726328, "body": "If you are going to make your question about a specific parse it might be helpful to say <a href=\"https://hackage.haskell.org/package/polyparse/docs/Text-ParserCombinators-Poly-Plain.html\" rel=\"nofollow noreferrer\">which</a> <a href=\"https://hackage.haskell.org/package/polyparse/docs/Text-ParserCombinators-HuttonMeijer.html\" rel=\"nofollow noreferrer\">one</a> you <a href=\"https://hackage.haskell.org/package/polyparse/docs/Text-ParserCombinators-HuttonMeijerWallace.html\" rel=\"nofollow noreferrer\">mean</a>. These parsers look nastier to debug because their main fields are functions. You&#39;d have to pattern match against the parser to extract the function, then test that it is correct based on input/outputs."}, {"owner": {"reputation": 1106, "user_id": 4197293, "user_type": "registered", "accept_rate": 83, "profile_image": "https://www.gravatar.com/avatar/fdd3542179c9735316f934724992b7ce?s=128&d=identicon&r=PG", "display_name": "jeiea", "link": "https://stackoverflow.com/users/4197293/jeiea"}, "reply_to_user": {"reputation": 29444, "user_id": 3072788, "user_type": "registered", "accept_rate": 82, "profile_image": "https://www.gravatar.com/avatar/220a45c2fcff7e7358d144551b116205?s=128&d=identicon&r=PG&f=1", "display_name": "Alec", "link": "https://stackoverflow.com/users/3072788/alec"}, "edited": false, "score": 0, "creation_date": 1484929752, "post_id": 41766230, "comment_id": 70727893, "body": "@Alec: I&#39;m not asking specific parse, and aren&#39;t those three same from view of monadic structure? And I&#39;m sorry but I can&#39;t understand well the meaning of pattern matching against the parser."}, {"owner": {"reputation": 29444, "user_id": 3072788, "user_type": "registered", "accept_rate": 82, "profile_image": "https://www.gravatar.com/avatar/220a45c2fcff7e7358d144551b116205?s=128&d=identicon&r=PG&f=1", "display_name": "Alec", "link": "https://stackoverflow.com/users/3072788/alec"}, "edited": false, "score": 0, "creation_date": 1484930061, "post_id": 41766230, "comment_id": 70728077, "body": "They are similar (I mean they <i>are</i> all parsers ;)). But yeah, looks like for the package you may have to play with the opaque function, checking that it is right by feeding it inputs and verifying the outputs. Some other parser libraries like <a href=\"https://hackage.haskell.org/package/megaparsec-5.1.2/docs/Text-Megaparsec.html#g:6\" rel=\"nofollow noreferrer\"><code>megaparsec</code></a> provide functions to help you debug your parsers."}], "owner": {"reputation": 1106, "user_id": 4197293, "user_type": "registered", "accept_rate": 83, "profile_image": "https://www.gravatar.com/avatar/fdd3542179c9735316f934724992b7ce?s=128&d=identicon&r=PG", "display_name": "jeiea", "link": "https://stackoverflow.com/users/4197293/jeiea"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 85, "favorite_count": 0, "answer_count": 0, "score": 0, "last_activity_date": 1484929002, "creation_date": 1484923397, "last_edit_date": 1484929002, "question_id": 41766230, "link": "https://stackoverflow.com/questions/41766230/how-can-i-debug-haskell-monad-implementation-or-view-inner-information", "title": "How can I debug haskell monad implementation (or view inner information)", "body": "<p>I used to write code using parser combinator library <code>polyparse</code>.\nI could see intermediate evaulation result with ghci debugger, but it was confined to what my code use. In other words, I couldn't inspect <code>polyparse</code>'s <code>Parser</code> monad's inner information.</p>\n\n<p>For example I can see only one character which a parser process, but not more. It is difficult to know exactly where the parser is parsing. In other cases, there was a time I misunderstood a <code>polyparse</code>'s function and it took a long time to fix it due to opacity of monad evaluation.</p>\n\n<p>I even unpacked <code>polyparse</code> package and set breakpoint to <code>Parser</code> monad instance, but it wasn't allowed.\nMaybe using other good library can be one of alternative, but I want to know there's solution with <code>polyparse</code> library, and general one.</p>\n"}, {"tags": ["haskell", "pattern-matching"], "answers": [{"comments": [{"owner": {"reputation": 951, "user_id": 6253996, "user_type": "registered", "accept_rate": 75, "profile_image": "https://i.stack.imgur.com/XUk8U.jpg?s=128&g=1", "display_name": "bzim", "link": "https://stackoverflow.com/users/6253996/bzim"}, "edited": false, "score": 0, "creation_date": 1484935709, "post_id": 41764495, "comment_id": 70731051, "body": "Thanks! I updated the code as suggested but more errors appeared. See my edit"}, {"owner": {"reputation": 75362, "user_id": 625403, "user_type": "registered", "accept_rate": 82, "profile_image": "https://www.gravatar.com/avatar/786eed7da67079cb5d63a49d469af25b?s=128&d=identicon&r=PG", "display_name": "amalloy", "link": "https://stackoverflow.com/users/625403/amalloy"}, "reply_to_user": {"reputation": 951, "user_id": 6253996, "user_type": "registered", "accept_rate": 75, "profile_image": "https://i.stack.imgur.com/XUk8U.jpg?s=128&g=1", "display_name": "bzim", "link": "https://stackoverflow.com/users/6253996/bzim"}, "edited": false, "score": 0, "creation_date": 1484936897, "post_id": 41764495, "comment_id": 70731689, "body": "@BrunoCorr&#234;aZimmermann That &quot;update&quot; would be better as a new question, since it is about a new problem with new code. But a small hint: in your <code>show</code> implementation, you have two arbitrary types <code>a</code> and <code>b</code>, and all that you know is that they can be <code>show</code>n. Why do you think you can pattern-match them against a constructor of type <code>OptionList</code>?"}, {"owner": {"reputation": 951, "user_id": 6253996, "user_type": "registered", "accept_rate": 75, "profile_image": "https://i.stack.imgur.com/XUk8U.jpg?s=128&g=1", "display_name": "bzim", "link": "https://stackoverflow.com/users/6253996/bzim"}, "edited": false, "score": 2, "creation_date": 1484938131, "post_id": 41764495, "comment_id": 70732296, "body": "Ok! Sorry. I&#39;ll make a new question"}], "tags": [], "owner": {"reputation": 100185, "user_id": 3234959, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/93bb12ca0f93dfddb33880316f7e66c2?s=128&d=identicon&r=PG&f=1", "display_name": "chi", "link": "https://stackoverflow.com/users/3234959/chi"}, "is_accepted": true, "score": 7, "last_activity_date": 1484920651, "last_edit_date": 1484920651, "creation_date": 1484917734, "answer_id": 41764495, "question_id": 41764189, "link": "https://stackoverflow.com/questions/41764189/pattern-overlapping-why-is-it-happening/41764495#41764495", "title": "Pattern overlapping, why is it happening?", "body": "<p>In the line </p>\n\n<pre><code>show (OptionList voidOption a) = \"{\" ++ (show a) ++\"}\"\n</code></pre>\n\n<p><code>voidOption</code> is a fresh local variable, like <code>a</code> is. It bears no relations with the <code>voidOption</code> variable defined below. Essentially, the line above is equivalent to</p>\n\n<pre><code>show (OptionList b a) = \"{\" ++ (show a) ++\"}\"\n</code></pre>\n\n<p>hence, it always matches and overlaps with the following lines.</p>\n\n<p>It's easy to remember this if we regards all the variables in patterns as variables <em>defined by the pattern</em>. In a sense they are values going \"out\" the pattern, not \"in\".</p>\n\n<p>Turning on warnings (<code>-Wall</code>) should warn you about this mistake, since the new local binding for <code>voidOption</code> shadows the global one.</p>\n\n<p>In patterns, you should use the <code>EmptyOpt</code> constructor instead. E.g.</p>\n\n<pre><code>show (OptionList EmptyOpt a) = \"{\" ++ (show a) ++\"}\"\n</code></pre>\n"}], "owner": {"reputation": 951, "user_id": 6253996, "user_type": "registered", "accept_rate": 75, "profile_image": "https://i.stack.imgur.com/XUk8U.jpg?s=128&g=1", "display_name": "bzim", "link": "https://stackoverflow.com/users/6253996/bzim"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 172, "favorite_count": 0, "accepted_answer_id": 41764495, "answer_count": 1, "score": 2, "last_activity_date": 1484939831, "creation_date": 1484916774, "last_edit_date": 1484939831, "question_id": 41764189, "link": "https://stackoverflow.com/questions/41764189/pattern-overlapping-why-is-it-happening", "title": "Pattern overlapping, why is it happening?", "body": "<p>I have a file OptionList.hs, with a new datatype named OptionList. I Want to hide the EmptyOpt when an OptionList is showed:</p>\n\n<pre><code>module OptionList (\n    OptionList,\n    voidOption,\n    (+:)\n) where\n\n\ndata OptionList a b = EmptyOpt | OptionList { optListHead :: a, optListTail :: b } deriving (Read)\n\ninstance (Show a, Show b) =&gt; Show (OptionList a b) where\n    show (OptionList voidOption a) = \"{\" ++ (show a) ++\"}\"\n    show (OptionList a voidOption) = \"{\" ++ (show a) ++\"}\"\n    show (OptionList a b) = \"{\"++ (show a) ++ \", \" ++ (show b) ++\"}\"\n    show voidOption = \"\"\n\n\n\n\nvoidOption::(OptionList Int Int)\nvoidOption = EmptyOpt\n\n\n\n(+:) :: a -&gt; b -&gt; (OptionList a b)\ninfixr 5 +:\nt1 +: t2 = OptionList t1 t2\n</code></pre>\n\n<p>And then I have the main file <code>todo.hs</code></p>\n\n<pre><code>import OptionList\n\n\nmain = do\n    print ( 0 +: \"test\" +: voidOption )\n</code></pre>\n\n<p>But the compiler is telling that the pattern matching in OptionList.hs are overlapped:</p>\n\n<pre><code>OptionList.hs:12:9: Warning:\n    Pattern match(es) are overlapped\n    In an equation for \u2018show\u2019:\n        show (OptionList a voidOption) = ...\n        show (OptionList a b) = ...\n</code></pre>\n\n<p>And when I execute it, it is indeed overlapped. It produces the following output:</p>\n\n<pre><code>{{}}\n</code></pre>\n\n<p>(I wanted it to be <code>{0, {\"test\"}}</code>)</p>\n\n<p>But why are these pattern overlapping?</p>\n"}, {"tags": ["haskell"], "comments": [{"owner": {"reputation": 314794, "user_id": 67579, "user_type": "registered", "accept_rate": 81, "profile_image": "https://i.stack.imgur.com/BJXub.png?s=128&g=1", "display_name": "Willem Van Onsem", "link": "https://stackoverflow.com/users/67579/willem-van-onsem"}, "edited": false, "score": 0, "creation_date": 1484911745, "post_id": 41762557, "comment_id": 70716542, "body": "Do you want to generate a function for <b>every</b> combination, or more a <code>zip</code> style?"}, {"owner": {"reputation": 91, "user_id": 6542453, "user_type": "registered", "accept_rate": 56, "profile_image": "https://www.gravatar.com/avatar/ecc896c6aac5ea73c520da4d6b79f4c3?s=128&d=identicon&r=PG&f=1", "display_name": "user6542453", "link": "https://stackoverflow.com/users/6542453/user6542453"}, "reply_to_user": {"reputation": 314794, "user_id": 67579, "user_type": "registered", "accept_rate": 81, "profile_image": "https://i.stack.imgur.com/BJXub.png?s=128&g=1", "display_name": "Willem Van Onsem", "link": "https://stackoverflow.com/users/67579/willem-van-onsem"}, "edited": false, "score": 0, "creation_date": 1484911954, "post_id": 41762557, "comment_id": 70716655, "body": "A function for every combination :)"}], "answers": [{"comments": [{"owner": {"reputation": 91, "user_id": 6542453, "user_type": "registered", "accept_rate": 56, "profile_image": "https://www.gravatar.com/avatar/ecc896c6aac5ea73c520da4d6b79f4c3?s=128&d=identicon&r=PG&f=1", "display_name": "user6542453", "link": "https://stackoverflow.com/users/6542453/user6542453"}, "edited": false, "score": 0, "creation_date": 1484929437, "post_id": 41762912, "comment_id": 70727700, "body": "Thanks, explained very well."}, {"owner": {"reputation": 75362, "user_id": 625403, "user_type": "registered", "accept_rate": 82, "profile_image": "https://www.gravatar.com/avatar/786eed7da67079cb5d63a49d469af25b?s=128&d=identicon&r=PG", "display_name": "amalloy", "link": "https://stackoverflow.com/users/625403/amalloy"}, "edited": false, "score": 0, "creation_date": 1484937045, "post_id": 41762912, "comment_id": 70731767, "body": "I would call that a shortening, not an optimization. It is no faster (of course), and the version with <code>\\x y -&gt; ...</code> is very clearly a function that wants two arguments, so I would call it more optimal in the only way that matters here: legibility."}, {"owner": {"reputation": 314794, "user_id": 67579, "user_type": "registered", "accept_rate": 81, "profile_image": "https://i.stack.imgur.com/BJXub.png?s=128&g=1", "display_name": "Willem Van Onsem", "link": "https://stackoverflow.com/users/67579/willem-van-onsem"}, "reply_to_user": {"reputation": 75362, "user_id": 625403, "user_type": "registered", "accept_rate": 82, "profile_image": "https://www.gravatar.com/avatar/786eed7da67079cb5d63a49d469af25b?s=128&d=identicon&r=PG", "display_name": "amalloy", "link": "https://stackoverflow.com/users/625403/amalloy"}, "edited": false, "score": 0, "creation_date": 1484937104, "post_id": 41762912, "comment_id": 70731800, "body": "@amalloy: changed it to <i>syntactically shorten</i>, better?"}, {"owner": {"reputation": 75362, "user_id": 625403, "user_type": "registered", "accept_rate": 82, "profile_image": "https://www.gravatar.com/avatar/786eed7da67079cb5d63a49d469af25b?s=128&d=identicon&r=PG", "display_name": "amalloy", "link": "https://stackoverflow.com/users/625403/amalloy"}, "edited": false, "score": 0, "creation_date": 1484937284, "post_id": 41762912, "comment_id": 70731888, "body": "If you must. I&#39;d rather just not suggest the shorter, less readable version at all. Why stop where you have, instead of recommending <code>(. h) . f . g</code>?"}, {"owner": {"reputation": 314794, "user_id": 67579, "user_type": "registered", "accept_rate": 81, "profile_image": "https://i.stack.imgur.com/BJXub.png?s=128&g=1", "display_name": "Willem Van Onsem", "link": "https://stackoverflow.com/users/67579/willem-van-onsem"}, "reply_to_user": {"reputation": 75362, "user_id": 625403, "user_type": "registered", "accept_rate": 82, "profile_image": "https://www.gravatar.com/avatar/786eed7da67079cb5d63a49d469af25b?s=128&d=identicon&r=PG", "display_name": "amalloy", "link": "https://stackoverflow.com/users/625403/amalloy"}, "edited": false, "score": 0, "creation_date": 1484937450, "post_id": 41762912, "comment_id": 70731965, "body": "@amalloy: because based on the question, I don&#39;t think this is currently the level of Haskell we should introduce; each answer should try to push the user one level higher, not 3 :)"}], "tags": [], "owner": {"reputation": 314794, "user_id": 67579, "user_type": "registered", "accept_rate": 81, "profile_image": "https://i.stack.imgur.com/BJXub.png?s=128&g=1", "display_name": "Willem Van Onsem", "link": "https://stackoverflow.com/users/67579/willem-van-onsem"}, "is_accepted": true, "score": 7, "last_activity_date": 1484937082, "last_edit_date": 1484937082, "creation_date": 1484912654, "answer_id": 41762912, "question_id": 41762557, "link": "https://stackoverflow.com/questions/41762557/function-composition-with-lists/41762912#41762912", "title": "Function composition with lists", "body": "<p>Well you can simply <strong>put a lambda expression in the head</strong> of the list comprehension:</p>\n\n<pre><code>composeF fs gs hs = [ \\x y -&gt; f (g x) (h y) | f &lt;- fs, g &lt;- gs, h &lt;- hs]\n</code></pre>\n\n<p>I also took the liberty to rename the given lists to <code>fs</code>, <code>gs</code> and <code>hs</code> since these are usually names reserved for functions (but evidently there is nothing wrong with <code>as</code>, <code>bs</code> and <code>cs</code>, you only give the reader a hint about the type of objects you want to process). In that case <code>composeF</code> has type:</p>\n\n<pre><code>composeF :: [t1 -&gt; t2 -&gt; t] -&gt; [t3 -&gt; t1] -&gt; [t4 -&gt; t2] -&gt; [t3 -&gt; t4 -&gt; t]\n</code></pre>\n\n<p>Which seems the requested type.</p>\n\n<p>You can syntactically shorten your lambda expression a bit further into:</p>\n\n<pre><code>\\x -&gt; f (g x) . h\n</code></pre>\n\n<p>so:</p>\n\n<pre><code>composeF fs gs hs = [ \\x -&gt; f (g x) . h | f &lt;- fs, g &lt;- gs, h &lt;- hs]\n</code></pre>\n\n<p>Note that you will construct a function for <strong>every combination</strong> so given <code>fs</code> has length 3, <code>gs</code> has length 5 and <code>hs</code> has length 8, the generated list will have 3 &times; 5 &times; 8 = 120 elements.</p>\n"}], "owner": {"reputation": 91, "user_id": 6542453, "user_type": "registered", "accept_rate": 56, "profile_image": "https://www.gravatar.com/avatar/ecc896c6aac5ea73c520da4d6b79f4c3?s=128&d=identicon&r=PG&f=1", "display_name": "user6542453", "link": "https://stackoverflow.com/users/6542453/user6542453"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 88, "favorite_count": 0, "accepted_answer_id": 41762912, "answer_count": 1, "score": 1, "last_activity_date": 1484937082, "creation_date": 1484911553, "last_edit_date": 1484922652, "question_id": 41762557, "link": "https://stackoverflow.com/questions/41762557/function-composition-with-lists", "title": "Function composition with lists", "body": "<p>I want to create a function that receive three lists: the first is a list of binary functions, the second and the third are lists of unary functions.\nThe results must be like this:</p>\n\n<pre><code> \\x y -&gt; f (g x) (h y)\n</code></pre>\n\n<p>This is a test I have done...</p>\n\n<pre><code>composeF xa xb xc = [a . (b c) | a &lt;- xa, b &lt;- xb, c &lt;- xc]\n</code></pre>\n\n<p>... but I don't know how to correctly compose those functions.</p>\n"}, {"tags": ["haskell"], "comments": [{"owner": {"reputation": 29444, "user_id": 3072788, "user_type": "registered", "accept_rate": 82, "profile_image": "https://www.gravatar.com/avatar/220a45c2fcff7e7358d144551b116205?s=128&d=identicon&r=PG&f=1", "display_name": "Alec", "link": "https://stackoverflow.com/users/3072788/alec"}, "edited": false, "score": 5, "creation_date": 1484904021, "post_id": 41759839, "comment_id": 70711567, "body": "On of the slightly more confusing things with <code>Functor</code>, <code>Applicative</code> and <code>Monad</code> is that the type you give it actually has to have kind <code>* -&gt; *</code> - it needs to be expecting a type variable. In vanilla Haskell, kinds are simply inferred. Looking at the <code>Functor</code> class, you&#39;ll notice that <code>f</code> is always applied to a type variable. That let&#39;s the compiler infer that <code>f</code> has kind <code>* -&gt; *</code>. That means things like <code>Maybe</code>, lists, <code>IO</code>, etc. NOT <code>Bool</code>, <code>Int</code>, <code>()</code>, etc."}, {"owner": {"reputation": 48938, "user_id": 246886, "user_type": "registered", "accept_rate": 94, "profile_image": "https://www.gravatar.com/avatar/dd1ebaade6623fc538fb8af3338e730d?s=128&d=identicon&r=PG", "display_name": "Jon Purdy", "link": "https://stackoverflow.com/users/246886/jon-purdy"}, "edited": false, "score": 0, "creation_date": 1484907164, "post_id": 41759839, "comment_id": 70713515, "body": "<a href=\"https://hackage.haskell.org/package/base-4.9.1.0/docs/Data-Functor-Identity.html\" rel=\"nofollow noreferrer\"><code>Identity</code></a> has functor/applicative/monad instances similar to this. For example, <code>runIdentity (fmap (+ 5) (pure 2 :: Identity Int)) == 7</code>."}], "answers": [{"tags": [], "owner": {"reputation": 94713, "user_id": 1139697, "user_type": "registered", "accept_rate": 86, "profile_image": "https://www.gravatar.com/avatar/5f136ddb684f39aaee1c028ee1950f6f?s=128&d=identicon&r=PG", "display_name": "Zeta", "link": "https://stackoverflow.com/users/1139697/zeta"}, "is_accepted": false, "score": 9, "last_activity_date": 1484906670, "creation_date": 1484906670, "answer_id": 41760879, "question_id": 41759839, "link": "https://stackoverflow.com/questions/41759839/whats-wrong-instance-functor-int-where/41760879#41760879", "title": "What&#39;s wrong instance Functor Int where", "body": "<p>What is so interesting about <code>Maybe a</code>, <code>[a]</code>, <code>Either e a</code>, <code>IO a</code>? The type takes an additional parameter. That is, <code>Maybe</code> on its own isn't a type. You have to use another type e.g. <code>Int</code> to actually get a type: <code>Maybe Int</code>.</p>\n\n<p>Let's have a look at <code>Functor</code>'s definition:</p>\n\n<pre><code>class Functor f where\n    fmap :: (a -&gt; b) -&gt; f a -&gt; f b\n              --        ^^^    ^^^\n</code></pre>\n\n<p>Whatever you use for <code>f</code> must be able to use a type. And <code>Int Int</code> or <code>Int ()</code> is not a type, because <code>Int</code> is already at kind <code>*</code>. You cannot construct another type by applying <code>Int</code> on something else.</p>\n\n<p><code>Maybe</code> on the other hand is of kind <code>* -&gt; *</code>. It takes a type (e.g. <code>Double</code>) and returns a type, <code>Maybe Double</code>:</p>\n\n<pre><code>-- using pseudo kind-signatures\nMaybe        :: * -&gt; *\nDouble       :: *\nMaybe Double ::      *\n</code></pre>\n\n<p>All that because our <code>f</code> takes an <code>a</code> in the signature of <code>fmap</code>.</p>\n\n<p>So no. You cannot make any regular type (of kind <code>*</code>)  an instance of <code>Functor</code>.</p>\n"}, {"tags": [], "owner": {"reputation": 893, "user_id": 6248287, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/tPegr.jpg?s=128&g=1", "display_name": "\u019b\u019b\u019b", "link": "https://stackoverflow.com/users/6248287/%c6%9b%c6%9b%c6%9b"}, "is_accepted": false, "score": 0, "last_activity_date": 1484928728, "creation_date": 1484928728, "answer_id": 41767927, "question_id": 41759839, "link": "https://stackoverflow.com/questions/41759839/whats-wrong-instance-functor-int-where/41767927#41767927", "title": "What&#39;s wrong instance Functor Int where", "body": "<pre><code>class Functor f where\n    fmap :: (a -&gt; b) -&gt; f a -&gt; f b\n</code></pre>\n\n<p>functor <code>f</code> maps types to types - it maps <code>a</code> to <code>f a</code> and <code>b</code> to <code>f b</code>. That means f can't be a concrete type such as Int; it has to be a type that takes another type as a parameter. You can think of <code>f</code> as a function on types.</p>\n"}], "owner": {"reputation": 31, "user_id": 7424698, "user_type": "registered", "profile_image": "https://lh6.googleusercontent.com/-GQ9cOboj06c/AAAAAAAAAAI/AAAAAAAAADo/zi48sqg0TgI/photo.jpg?sz=128", "display_name": "\uae40\uac15\ud0dc", "link": "https://stackoverflow.com/users/7424698/%ea%b9%80%ea%b0%95%ed%83%9c"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 178, "favorite_count": 0, "answer_count": 2, "score": 3, "last_activity_date": 1484928728, "creation_date": 1484903458, "question_id": 41759839, "link": "https://stackoverflow.com/questions/41759839/whats-wrong-instance-functor-int-where", "title": "What&#39;s wrong instance Functor Int where", "body": "<p>What's wrong instance Functor Int where</p>\n\n<pre><code>instance Functor Int where\n  fmap f a = f a\n</code></pre>\n\n<p>Expected kind ...</p>\n\n<p>I can't make monad int , applicative int, functor int</p>\n"}, {"tags": ["web-services", "haskell", "haskell-spock"], "comments": [{"owner": {"reputation": 2221, "user_id": 448591, "user_type": "registered", "accept_rate": 93, "profile_image": "https://www.gravatar.com/avatar/5520f21f2e367d78c29d08d3b30b954f?s=128&d=identicon&r=PG", "display_name": "Jakob Runge", "link": "https://stackoverflow.com/users/448591/jakob-runge"}, "edited": false, "score": 0, "creation_date": 1484906269, "post_id": 41758623, "comment_id": 70712959, "body": "Hm. I can reproduce but am not certain yet how the problem arises. I see when using <a href=\"https://hackage.haskell.org/package/Spock-0.10.0.1/docs/Web-Spock-Shared.html#g:3\" rel=\"nofollow noreferrer\">request</a> instead of <code>body</code>, that the <code>requestBodyLength</code> and <code>Content-Length</code> fields are set to the correct length, but the content doesn&#39;t show up so far."}, {"owner": {"reputation": 685, "user_id": 1023188, "user_type": "registered", "accept_rate": 67, "profile_image": "https://i.stack.imgur.com/0bfuS.jpg?s=128&g=1", "display_name": "agrafix", "link": "https://stackoverflow.com/users/1023188/agrafix"}, "edited": false, "score": 2, "creation_date": 1484911400, "post_id": 41758623, "comment_id": 70716350, "body": "Can you try this using master? I&#39;ve done some changes and added test cases: <a href=\"https://github.com/agrafix/Spock/blob/46a86e1a109ff74f44168d3373fdb9ed0dd87f71/Spock-core/test/Web/Spock/FrameworkSpecHelper.hs#L79-L82\" rel=\"nofollow noreferrer\">github.com/agrafix/Spock/blob/&hellip;</a>"}, {"owner": {"reputation": 1750, "user_id": 3929481, "user_type": "registered", "accept_rate": 12, "profile_image": "https://i.stack.imgur.com/3ZrH1.jpg?s=128&g=1", "display_name": "mcmayer", "link": "https://stackoverflow.com/users/3929481/mcmayer"}, "edited": false, "score": 0, "creation_date": 1484979352, "post_id": 41758623, "comment_id": 70743727, "body": "Yes that works! Thanks a lot!"}], "owner": {"reputation": 1750, "user_id": 3929481, "user_type": "registered", "accept_rate": 12, "profile_image": "https://i.stack.imgur.com/3ZrH1.jpg?s=128&g=1", "display_name": "mcmayer", "link": "https://stackoverflow.com/users/3929481/mcmayer"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 514, "favorite_count": 0, "answer_count": 0, "score": 3, "last_activity_date": 1484979580, "creation_date": 1484898879, "last_edit_date": 1484979580, "question_id": 41758623, "link": "https://stackoverflow.com/questions/41758623/haskell-spock-how-to-get-the-raw-request-body", "title": "Haskell Spock: How to get the raw request body", "body": "<p>The <a href=\"https://hackage.haskell.org/package/Spock-core-0.11.0.0/docs/src/Web-Spock-Internal-CoreAction.html#body\" rel=\"nofollow noreferrer\">body</a> function in <a href=\"https://hackage.haskell.org/package/Spock-core-0.11.0.0/docs/Web-Spock-Action.html\" rel=\"nofollow noreferrer\">Web.Spock.Action</a> is supposed to return the raw request body. However, it just doesn't seem to be doing that:</p>\n\n<pre><code>{-# LANGUAGE OverloadedStrings #-}\nmodule Main where\n\nimport Data.Text.Encoding (decodeUtf8)\nimport Debug.Trace        (trace)\nimport Web.Spock\nimport Web.Spock.Config\n\napp :: SpockM () () () ()\napp = do\n    get root $ text \"Hello!\"\n    post \"test\" $ do\n        b &lt;- body       -- b is always \"\"!\n        text $ trace (\"b=\"++show b) decodeUtf8 b\n\nmain :: IO ()\nmain = do\n       spockCfg &lt;- defaultSpockCfg () PCNoDatabase ()\n       runSpock 3000 (spock spockCfg app)\n</code></pre>\n\n<p>A <code>curl --data 123123 localhost:3000/test</code> returns nothing, and the <code>trace</code> output confirms that <code>b</code> is an empty string.</p>\n\n<pre><code>Spock is running on port 3000\nb=\"\"\n</code></pre>\n\n<p>The equivalent <a href=\"https://hackage.haskell.org/package/scotty\" rel=\"nofollow noreferrer\">Scotty</a> app works just fine:</p>\n\n<pre><code>{-# LANGUAGE OverloadedStrings #-}\nmodule Main where\n\nimport Data.Text.Lazy.Encoding (decodeUtf8)\nimport Web.Scotty\n\nmain = scotty 3000 $ do\n    get \"/\" $ text \"Hello!\"\n    post \"/test\" $  do\n        b &lt;- body       -- works fine\n        text $ decodeUtf8 b\n</code></pre>\n\n<p>I absolutely can't see what I'm doing wrong. Any input would be highly appreciated!</p>\n\n<p><strong>Update</strong>: Above example will work with <code>Spock &gt;= 0.12.0.0</code>! </p>\n"}, {"tags": ["haskell"], "answers": [{"comments": [{"owner": {"reputation": 22589, "user_id": 1085573, "user_type": "registered", "accept_rate": 80, "profile_image": "https://i.stack.imgur.com/VJ6tk.png?s=128&g=1", "display_name": "Yuushi", "link": "https://stackoverflow.com/users/1085573/yuushi"}, "edited": false, "score": 0, "creation_date": 1484897493, "post_id": 41758131, "comment_id": 70708180, "body": "Thanks for the extra info about <code>coerce</code> and <code>Down</code>, that&#39;s very helpful."}, {"owner": {"reputation": 100185, "user_id": 3234959, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/93bb12ca0f93dfddb33880316f7e66c2?s=128&d=identicon&r=PG&f=1", "display_name": "chi", "link": "https://stackoverflow.com/users/3234959/chi"}, "edited": false, "score": 0, "creation_date": 1484902202, "post_id": 41758131, "comment_id": 70710449, "body": "Indeed, <code>coerce</code> is really great for this kind of wrappers."}, {"owner": {"reputation": 56659, "user_id": 450128, "user_type": "registered", "accept_rate": 62, "profile_image": "https://www.gravatar.com/avatar/2f72b3fdc99fe9fd1bbeb2f9da1d2c0a?s=128&d=identicon&r=PG", "display_name": "Ben", "link": "https://stackoverflow.com/users/450128/ben"}, "edited": false, "score": 2, "creation_date": 1484903543, "post_id": 41758131, "comment_id": 70711245, "body": "If I was rolling my own set parameterized by the comparison function, I&#39;d want to have it tied to a <b>type</b> parameter, not just a field. Otherwise you can&#39;t e.g. rule out unioning sets with different comparisons (probably end up reinserting everything from the right set using the left order, losing commuativity and maybe some tree graft optimizations). Probably I&#39;d just add a type parameter for a newtype to transparently wrap/unwrap and use the existing Set for everything under the hood."}, {"owner": {"reputation": 29444, "user_id": 3072788, "user_type": "registered", "accept_rate": 82, "profile_image": "https://www.gravatar.com/avatar/220a45c2fcff7e7358d144551b116205?s=128&d=identicon&r=PG&f=1", "display_name": "Alec", "link": "https://stackoverflow.com/users/3072788/alec"}, "reply_to_user": {"reputation": 56659, "user_id": 450128, "user_type": "registered", "accept_rate": 62, "profile_image": "https://www.gravatar.com/avatar/2f72b3fdc99fe9fd1bbeb2f9da1d2c0a?s=128&d=identicon&r=PG", "display_name": "Ben", "link": "https://stackoverflow.com/users/450128/ben"}, "edited": false, "score": 0, "creation_date": 1484903752, "post_id": 41758131, "comment_id": 70711388, "body": "@Ben Yeah, that was the point I was trying to get at in my first bullet. You somehow want to have that universality property, otherwise all hell breaks lose. (Or at least name the instances as Idris does)"}, {"owner": {"reputation": 100185, "user_id": 3234959, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/93bb12ca0f93dfddb33880316f7e66c2?s=128&d=identicon&r=PG&f=1", "display_name": "chi", "link": "https://stackoverflow.com/users/3234959/chi"}, "reply_to_user": {"reputation": 56659, "user_id": 450128, "user_type": "registered", "accept_rate": 62, "profile_image": "https://www.gravatar.com/avatar/2f72b3fdc99fe9fd1bbeb2f9da1d2c0a?s=128&d=identicon&r=PG", "display_name": "Ben", "link": "https://stackoverflow.com/users/450128/ben"}, "edited": false, "score": 1, "creation_date": 1484915633, "post_id": 41758131, "comment_id": 70718965, "body": "@Ben That&#39;s a very good point. Until now I never realized that e.g. Java <code>TreeSet</code> has no &quot;set-specific&quot; intersection method, only one taking a generic <code>Collection</code>. Indeed, Java can not assume the comparator is the same for two sets of the same type. This might lead to a less efficient algorithm -- Haskell <code>Data.Set</code> guarantees O(m*log(nm + 1)) where m is the smaller set size."}], "tags": [], "owner": {"reputation": 29444, "user_id": 3072788, "user_type": "registered", "accept_rate": 82, "profile_image": "https://www.gravatar.com/avatar/220a45c2fcff7e7358d144551b116205?s=128&d=identicon&r=PG&f=1", "display_name": "Alec", "link": "https://stackoverflow.com/users/3072788/alec"}, "is_accepted": true, "score": 9, "last_activity_date": 1484896979, "creation_date": 1484896979, "answer_id": 41758131, "question_id": 41757868, "link": "https://stackoverflow.com/questions/41757868/using-different-ordering-for-sets/41758131#41758131", "title": "Using different Ordering for Sets", "body": "<p>No, this is really the way to go. Yes, having a <code>newtype</code> is sometimes annoying but you get some big benefits:</p>\n\n<ul>\n<li>When you see a <code>Set a</code> and you know <code>a</code>, you immediately know what type of comparison it uses (sort of the same way that purity makes code more readable by not making you have to trace execution). You don't have to know where that <code>Set a</code> comes from.</li>\n<li>For many cases, you can <a href=\"https://hackage.haskell.org/package/base-4.9.1.0/docs/Data-Coerce.html#v:coerce\" rel=\"noreferrer\"><code>coerce</code></a> your way through multiple newtypes at once. For example, I can turn <code>xs = [1,2,3] :: Int</code> into <code>ys = [ReverseInt 1, ReverseInt 2, ReverseInt 3] :: [ReverseInt]</code> just using <code>ys = coerce xs :: [ReverseInt]</code>. Unfortunately, that isn't the case for <code>Set</code> (and it shouldn't - you'd need the coercion function to be monotonic to not screw up the data structure invariants, and there is not yet a way to express that in the type system).</li>\n<li><code>newtype</code>s end up being more composable than you expect. For example, the <code>ReverseInt</code> type you made already exists in a form that generalizes to reversing <em>any</em> type with an <code>Ord</code> constraint: it is called <a href=\"https://hackage.haskell.org/package/base-4.9.1.0/docs/Data-Ord.html#t:Down\" rel=\"noreferrer\"><code>Down</code></a>. To be explicit, you could use <code>Down Int</code> instead of <code>ReversedInt</code>, and you get the instance you wrote out for free!</li>\n</ul>\n\n<p>Of course, if you still feel very strongly about this, nothing is stopping you from writing your version of <code>Set</code> which has to have a field which is the comparison function it uses. Something like</p>\n\n<pre><code>data Set a = Set { comparisionKey :: a -&gt; a -&gt; Ordering\n                 , ...\n                 }\n</code></pre>\n\n<p>Then, every time you make a <code>Set</code>, you would have to pass in the comparison key.</p>\n"}], "owner": {"reputation": 22589, "user_id": 1085573, "user_type": "registered", "accept_rate": 80, "profile_image": "https://i.stack.imgur.com/VJ6tk.png?s=128&g=1", "display_name": "Yuushi", "link": "https://stackoverflow.com/users/1085573/yuushi"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 105, "favorite_count": 0, "accepted_answer_id": 41758131, "answer_count": 1, "score": 4, "last_activity_date": 1484896979, "creation_date": 1484895813, "question_id": 41757868, "link": "https://stackoverflow.com/questions/41757868/using-different-ordering-for-sets", "title": "Using different Ordering for Sets", "body": "<p>I was reading a Chapter 2 of Purely Functional Data Structures, which talks about unordered sets implemented as binary search trees. The code is written in ML, and ends up showing a <code>signature ORDERED</code> and a <code>functor UnbalancedSet(Element: ORDERED): SET</code>. Coming from more of a C++ background, this makes sense to me; custom comparison function objects form part of the type and can be passed in at construction time, and this seems fairly analogous to the ML functor way of doing things.</p>\n\n<p>When it comes to Haskell, it seems the behavior depends only on the <code>Ord</code> instance, so if I wanted to have a set that had its order reversed, it seems like I'd have to use a <code>newtype</code> instance, e.g.</p>\n\n<pre><code>newtype ReverseInt = ReverseInt Int deriving (Eq, Show)\n\ninstance Ord ReverseInt where\n    compare (ReverseInt a) (ReverseInt b)  \n        | a == b = EQ\n        | a &lt; b  = GT\n        | a &gt; b  = LT\n</code></pre>\n\n<p>which I could then use in a set:</p>\n\n<pre><code>let x = Set.fromList $ map ReverseInt [1..5]\n</code></pre>\n\n<p>Is there any better way of doing this sort of thing that doesn't resort to using <code>newtype</code> to create a different <code>Ord</code> instance?</p>\n"}, {"tags": ["json", "rest", "haskell", "error-handling", "servant"], "answers": [{"tags": [], "owner": {"reputation": 9772, "user_id": 3963, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/9pDQ8.png?s=128&g=1", "display_name": "hao", "link": "https://stackoverflow.com/users/3963/hao"}, "is_accepted": true, "score": 6, "last_activity_date": 1484893755, "last_edit_date": 1484893755, "creation_date": 1484875706, "answer_id": 41754629, "question_id": 41753516, "link": "https://stackoverflow.com/questions/41753516/custom-json-errors-for-servant-server/41754629#41754629", "title": "Custom JSON errors for Servant-server", "body": "<h2>First, some language extensions</h2>\n\n<pre><code>{-# LANGUAGE FlexibleContexts      #-}\n{-# LANGUAGE FlexibleInstances     #-}\n{-# LANGUAGE MultiParamTypeClasses #-}\n{-# LANGUAGE OverloadedStrings     #-}\n{-# LANGUAGE ScopedTypeVariables   #-}\n{-# LANGUAGE TypeFamilies          #-}\n{-# LANGUAGE TypeOperators         #-}\n{-# LANGUAGE UndecidableInstances  #-}\n{-# LANGUAGE ViewPatterns          #-}\n</code></pre>\n\n<h2>Now then</h2>\n\n<p>Unfortunately this is more difficult than it should be. Servant, while well-designed and the composition of small logical parts, is very opinionated about how HTTP services should operate. The default implementation of <code>ReqBody</code>, which you are probably using, is hard-coded to spit out a text string.</p>\n\n<p>However, we can switch out <code>ReqBody</code> for our own data type:</p>\n\n<pre><code>module Body where\n\nimport Control.Monad.Trans (liftIO)\nimport Data.Proxy (Proxy(..))\nimport Network.Wai (lazyRequestBody)\n\nimport Data.Aeson\nimport Servant.API\nimport Servant.Server\nimport Servant.Server.Internal\n\ndata Body a\ninstance (FromJSON a, HasServer api context) =&gt; HasServer (Body a :&gt; api) context where\n  type ServerT (Body a :&gt; api) m = a -&gt; ServerT api m\n\n  route Proxy context subserver =\n    route (Proxy :: Proxy api) context (addBodyCheck subserver (withRequest bodyCheck))\n    where\n      bodyCheck request = do\n        body &lt;- liftIO (lazyRequestBody request)\n        case eitherDecode body of\n          Left (BodyError -&gt; e) -&gt;\n            delayedFailFatal err400 { errBody = encode e }\n          Right v -&gt;\n            return v\n</code></pre>\n\n<p>In this very brief amount of code a lot is happening:</p>\n\n<ul>\n<li><p>We are teaching the <code>servant-server</code> package on how to handle our new datatype when it appears in the type resolution for <code>serve (Proxy :: Proxy (Body foo :&gt; bar)) server</code>.</p></li>\n<li><p>We have ripped most of the code from <a href=\"https://github.com/haskell-servant/servant/blob/v0.8.1/servant-server/src/Servant/Server/Internal.hs#L430\" rel=\"noreferrer\">the v0.8.1 release of <code>ReqBody</code></a>.</p></li>\n<li><p>We are adding a function to the pipeline that processes request bodies.</p></li>\n<li><p>In it, we attempt to decode to the <code>a</code> parameter of <code>Body</code>. On failure, we spit out a JSON blob and an HTTP 400.</p></li>\n<li><p>We are entirely ignoring content-type headers here, for brevity.</p></li>\n</ul>\n\n<p>Here is the type of the JSON blob:</p>\n\n<pre><code>newtype BodyError = BodyError String\ninstance ToJSON BodyError where\n  toJSON (BodyError b) = object [\"error\" .= b]\n</code></pre>\n\n<p>Most of this machinery is internal to <code>servant-server</code> and underdocumented and rather fragile. For example, already I see that the code diverges on <code>master</code> branch and the arity of my <code>addBodyCheck</code> has changed.</p>\n\n<p>Though the Servant project is still quite young and remarkably ambitious, I have to say that the aesthetics and robustness of this solution are definitely underwhelming.</p>\n\n<h2>To test this</h2>\n\n<p>We will need a Main module:</p>\n\n<pre><code>{-# LANGUAGE DataKinds             #-}\n{-# LANGUAGE TypeOperators         #-}\nmodule Main where\nimport Data.Proxy (Proxy(..))\nimport Network.Wai.Handler.Warp (run)\nimport Servant.API\nimport Servant.Server\n\nimport Body\n\ntype API = Body [Int] :&gt; Post '[JSON] [Int]\n\nserver :: Server API\nserver = pure\n\nmain :: IO ()\nmain = do\n  putStrLn \"running on port 8000\"\n  run 8000 (serve (Proxy :: Proxy API) server)\n</code></pre>\n\n<p>And a shell:</p>\n\n<pre><code>~ \u276f\u276f\u276f curl -i -XPOST 'http://localhost:8000/'\nHTTP/1.1 400 Bad Request\nTransfer-Encoding: chunked\nDate: Fri, 20 Jan 2017 01:18:57 GMT\nServer: Warp/3.2.9\n\n{\"error\":\"Error in $: not enough input\"}%\n\n~ \u276f\u276f\u276f curl -id 'hey' -XPOST 'http://localhost:8000/'\nHTTP/1.1 400 Bad Request\nTransfer-Encoding: chunked\nDate: Fri, 20 Jan 2017 01:19:02 GMT\nServer: Warp/3.2.9\n\n{\"error\":\"Error in $: Failed reading: not a valid json value\"}%\n\n~ \u276f\u276f\u276f curl -id '[1,2,3]' -XPOST 'http://localhost:8000/'\nHTTP/1.1 200 OK\nTransfer-Encoding: chunked\nDate: Fri, 20 Jan 2017 01:19:07 GMT\nServer: Warp/3.2.9\nContent-Type: application/json\n\n[1,2,3]%\n</code></pre>\n\n<p>Ta-da!</p>\n\n<p>You should be able to run all this code on LTS-7.16.</p>\n\n<h2>What did we learn</h2>\n\n<p>(1) Servant and Haskell are fun.</p>\n\n<p>(2) The typeclass machinery of Servant allows for a kind of plug-and-play when it comes to the types you specify in your API. We can take out <code>ReqBody</code> and replace it with our own; on a project I did at work we even replaced the Servant verbs (<code>GET</code>, <code>POST</code>, ...) with our own. We wrote new content types and we even did something similar with <code>ReqBody</code> like you saw here.</p>\n\n<p>(3) It is the remarkable ability of the GHC compiler that we can destructure types during compile-time to influence runtime behavior in a safe and logically sound way. That we can express a tree of API routes at the type-level and then walk over them using typeclass instances, accumulating a server type using type families, is a wonderfully elegant way to build a well-typed web service.</p>\n\n \n"}, {"tags": [], "owner": {"reputation": 97, "user_id": 594712, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/266afa3fd63f97c25fc5dc4b5305235c?s=128&d=identicon&r=PG", "display_name": "codedmart", "link": "https://stackoverflow.com/users/594712/codedmart"}, "is_accepted": false, "score": 3, "last_activity_date": 1485017473, "creation_date": 1485017473, "answer_id": 41781962, "question_id": 41753516, "link": "https://stackoverflow.com/questions/41753516/custom-json-errors-for-servant-server/41781962#41781962", "title": "Custom JSON errors for Servant-server", "body": "<p>\nCurrently right now I just handle this in middleware. I do something like the following:</p>\n\n<pre class=\"lang-hs prettyprint-override\"><code>{-# LANGUAGE OverloadedStrings #-}\n{-# LANGUAGE FlexibleContexts #-}\n\nmodule Lib.ErrorResponse where\n\nimport Data.Text.Lazy.Encoding (decodeUtf8)\nimport Data.ByteString.Lazy (toStrict)\nimport Blaze.ByteString.Builder (toLazyByteString)\nimport Blaze.ByteString.Builder.ByteString (fromByteString)\nimport Network.Wai\nimport Network.Wai.Internal\nimport Network.HTTP.Types\nimport Data.Text\nimport Data.Aeson\nimport qualified Data.Text.Lazy as TL\n\ncustomError :: Application -&gt; Application\ncustomError = modifyResponse responseModifier\n\nresponseModifier :: Response -&gt; Response\nresponseModifier r\n  | responseStatus r == status400 &amp;&amp; not (isCustomMessage r \"Bad Request\") =\n    buildResponse status400 \"Bad Request\" (customErrorBody r \"BadRequest\") 400\n  | responseStatus r == status403 =\n    buildResponse status403 \"Forbidden\" \"Forbidden\" 400\n  | responseStatus r == status404 =\n    buildResponse status404 \"Not Found\" \"Not Found\" 404\n  | responseStatus r == status405 =\n    buildResponse status405 \"Method Not Allowed\" \"Method Not Allowed\" 405\n  | otherwise = r\n\ncustomErrorBody :: Response -&gt; Text -&gt; Text\ncustomErrorBody (ResponseBuilder _ _ b) _ = TL.toStrict $ decodeUtf8 $ toLazyByteString b\ncustomErrorBody (ResponseRaw _ res) e = customErrorBody res e\ncustomErrorBody _ e = e\n\nisCustomMessage :: Response -&gt; Text -&gt; Bool\nisCustomMessage r m = \"{\\\"error\\\":\" `isInfixOf` customErrorBody r m\n\nbuildResponse :: Status -&gt; Text -&gt; Text -&gt; Int -&gt; Response\nbuildResponse st err msg cde = responseBuilder st\n  [(\"Content-Type\", \"application/json\")]\n  (fromByteString . toStrict . encode $ object\n    [ \"error\" .= err\n    , \"message\" .= msg\n    , \"statusCode\" .= cde\n    ]\n  )\n</code></pre>\n\n<p>And then I can use just like any other middleware:</p>\n\n<pre class=\"lang-hs prettyprint-override\"><code>run 8000 . customError $ serve api server\n</code></pre>\n"}, {"comments": [{"owner": {"reputation": 1200, "user_id": 62657, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/24e30ea2f4bfda89a9a915dd18247d05?s=128&d=identicon&r=PG", "display_name": "Jeremy", "link": "https://stackoverflow.com/users/62657/jeremy"}, "edited": false, "score": 1, "creation_date": 1525825227, "post_id": 46876046, "comment_id": 87505420, "body": "How does this apply to the question of catching parsing errors? Nothing is going to call <code>throwJsonError</code> except user code right?"}], "tags": [], "owner": {"reputation": 535, "user_id": 1409625, "user_type": "registered", "accept_rate": 50, "profile_image": "https://www.gravatar.com/avatar/5eddce6dc824dc9d4fee793692422b85?s=128&d=identicon&r=PG", "display_name": "mmai", "link": "https://stackoverflow.com/users/1409625/mmai"}, "is_accepted": false, "score": -1, "last_activity_date": 1508687356, "creation_date": 1508687356, "answer_id": 46876046, "question_id": 41753516, "link": "https://stackoverflow.com/questions/41753516/custom-json-errors-for-servant-server/46876046#46876046", "title": "Custom JSON errors for Servant-server", "body": "<p>Taking inspiration from @codedmart I also use a middleware, but it does not construct the json, it only changes the content type of the response when there is an error, and keep the original error message.</p>\n\n<pre><code>startApp :: IO ()\nstartApp = run 8081 . (modifyResponse errorHeadersToJson) $ serve api server\n\nerrorHeadersToJson :: Response -&gt; Response\nerrorHeadersToJson r\n  | responseStatus r == status200 = r\n  | otherwise = mapResponseHeaders text2json r\n\ntext2json :: ResponseHeaders -&gt; ResponseHeaders\ntext2json h = Map.assocs (Map.fromList [(\"Content-Type\", \"application/json\")] `Map.union` Map.fromList h)\n</code></pre>\n\n<p>The json is built beforehand with a function overriding the Servant throwError function.</p>\n\n<pre><code>data ServerError = ServerError\n  { statusCode        :: Int\n  , error :: String\n  , message  :: String\n  } deriving (Eq, Show)\n\n$(deriveJSON defaultOptions ''ServerError)\n\nthrowJsonError :: ServantErr -&gt; String -&gt; Servant.Handler b\nthrowJsonError err \"\" = throwError $ err { errBody = encode $ ServerError (errHTTPCode err) (\"Server error\"::String) (show $ errBody err) }\nthrowJsonError err message = throwError $ err { errBody = encode $ ServerError (errHTTPCode err) (\"Server error\"::String) message }\n</code></pre>\n\n<p>then I can throw any error with a custom message, it will be served as a json with the correct content-type :</p>\n\n<pre><code>throwJsonError err500 \"Oh no !\"\n</code></pre>\n"}], "owner": {"reputation": 14449, "user_id": 105678, "user_type": "registered", "accept_rate": 89, "profile_image": "https://www.gravatar.com/avatar/859da59b3e4097fa659aabb55412de10?s=128&d=identicon&r=PG", "display_name": "Sean Clark Hess", "link": "https://stackoverflow.com/users/105678/sean-clark-hess"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 1398, "favorite_count": 1, "accepted_answer_id": 41754629, "answer_count": 3, "score": 6, "last_activity_date": 1508687356, "creation_date": 1484868073, "last_edit_date": 1484926338, "question_id": 41753516, "link": "https://stackoverflow.com/questions/41753516/custom-json-errors-for-servant-server", "title": "Custom JSON errors for Servant-server", "body": "<p>When using <a href=\"https://haskell-servant.readthedocs.io/en/stable/\" rel=\"nofollow noreferrer\">servant</a>, I'd like to return all errors as JSON. Currently, if a request fails to parse, I see an error message like this, returned as plain text</p>\n\n<pre><code>Failed reading: not a valid json value\n</code></pre>\n\n<p>Instead I would like to return this as <code>application/json</code></p>\n\n<pre><code>{\"error\":\"Failed reading: not a valid json value\"}\n</code></pre>\n\n<p>How can I do this? The docs say <code>ServantErr</code> is the default error type, and I can certainly respond with custom errors inside my handlers, but if parsing fails I don't see how I can return a custom error. </p>\n"}, {"tags": ["haskell", "functional-programming"], "comments": [{"owner": {"reputation": 126897, "user_id": 791604, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/ce991df7a056248d5e4f6fc3659ba733?s=128&d=identicon&r=PG", "display_name": "Daniel Wagner", "link": "https://stackoverflow.com/users/791604/daniel-wagner"}, "edited": false, "score": 1, "creation_date": 1484874658, "post_id": 41753366, "comment_id": 70701371, "body": "Once you have completed your pedagogical exercise, you might like to look into <a href=\"http://hackage.haskell.org/package/containers-0.5.9.1/docs/Data-Map-Lazy.html\" rel=\"nofollow noreferrer\"><code>Map</code></a>, or <a href=\"http://hackage.haskell.org/package/total-map-0.0.6/docs/Data-TotalMap.html\" rel=\"nofollow noreferrer\"><code>TMap</code></a> for a more advanced usage that abolishes the distinction between &quot;don&#39;t have that <code>String</code>&quot; and &quot;have that <code>String</code> but it maps to <code>&quot;not found&quot;</code>&quot;."}], "answers": [{"comments": [{"owner": {"reputation": 75362, "user_id": 625403, "user_type": "registered", "accept_rate": 82, "profile_image": "https://www.gravatar.com/avatar/786eed7da67079cb5d63a49d469af25b?s=128&d=identicon&r=PG", "display_name": "amalloy", "link": "https://stackoverflow.com/users/625403/amalloy"}, "edited": false, "score": 1, "creation_date": 1484891465, "post_id": 41755532, "comment_id": 70705756, "body": "<code>singleton</code> seems like a weird primitive to use here. Why not instead define <code>empty = Dict $ const Nothing</code>, and then call <code>insert</code> on that? That avoids the duplication between <code>insert</code> and <code>singleton</code>."}, {"owner": {"reputation": 100185, "user_id": 3234959, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/93bb12ca0f93dfddb33880316f7e66c2?s=128&d=identicon&r=PG&f=1", "display_name": "chi", "link": "https://stackoverflow.com/users/3234959/chi"}, "edited": false, "score": 0, "creation_date": 1484906583, "post_id": 41755532, "comment_id": 70713148, "body": "Nice! I would also be tempted to use <code>Dict ((k -&gt; Bool) -&gt; [v])</code> since many keys satisfy a predicate, in general. This makes it possible to recover the support set as <code>someDict (const True)</code>. (Of course, in the long run inserting/deleting a key will still lead to a slower and slower dictionary -- a real Map would still be better)"}, {"owner": {"reputation": 2863, "user_id": 2297560, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/948d4a17494b3c616a0873453b74670c?s=128&d=identicon&r=PG", "display_name": "user2297560", "link": "https://stackoverflow.com/users/2297560/user2297560"}, "reply_to_user": {"reputation": 100185, "user_id": 3234959, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/93bb12ca0f93dfddb33880316f7e66c2?s=128&d=identicon&r=PG&f=1", "display_name": "chi", "link": "https://stackoverflow.com/users/3234959/chi"}, "edited": false, "score": 0, "creation_date": 1484912695, "post_id": 41755532, "comment_id": 70717133, "body": "@chi That&#39;s quite clever. I&#39;ll leave it as an exercise for the reader ;)"}], "tags": [], "owner": {"reputation": 2863, "user_id": 2297560, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/948d4a17494b3c616a0873453b74670c?s=128&d=identicon&r=PG", "display_name": "user2297560", "link": "https://stackoverflow.com/users/2297560/user2297560"}, "is_accepted": true, "score": 2, "last_activity_date": 1484912318, "last_edit_date": 1484912318, "creation_date": 1484882412, "answer_id": 41755532, "question_id": 41753366, "link": "https://stackoverflow.com/questions/41753366/identifying-input-values-for-which-a-function-does-not-generate-a-specific-outpu/41755532#41755532", "title": "Identifying input values for which a function does NOT generate a specific output", "body": "<p>Your design is hard-coded such that the only criteria for finding a key is by presenting the same exact key. What you need is a more flexible approach that lets you provide a criteria other than equality. I took the liberty of making your code more general and using more conventional names for the functions:</p>\n\n<pre><code>import Prelude hiding (lookup)\n\n-- instead of k -&gt; Maybe v, we represent the dictionary as\n-- (k -&gt; Bool) -&gt; Maybe v where k -&gt; Bool is the criteria\n-- on which to match the key. by using Maybe v we can signal\n-- that no qualifying key was found by returning Nothing\n-- instead of \"not found\"\nnewtype Dict k v = Dict ((k -&gt; Bool) -&gt; Maybe v)\n\nempty :: Dict k v\nempty = Dict $ const Nothing\n\n-- insert a new key/value pair\ninsert :: k -&gt; v -&gt; Dict k v -&gt; Dict k v\ninsert k v d = Dict $ \\f -&gt; if f k then Just v else lookupBy f d\n\n-- lookup using the given criteria\nlookupBy :: (k -&gt; Bool) -&gt; Dict k v -&gt; Maybe v\nlookupBy f (Dict d) = d f\n\n-- lookup using the default criteria (equality with some given key)\nlookup :: Eq k =&gt; k -&gt; Dict k v -&gt; Maybe v\nlookup k = lookupBy (k==)\n\n-- your criteria\nstartsWith :: String -&gt; String -&gt; Bool\nstartsWith s = undefined -- TODO\n\nlookupByPrefix :: String -&gt; Dict String v -&gt; Maybe v\nlookupByPrefix = lookupBy . startsWith\n</code></pre>\n\n<p>I should mention that while this is a great exercise for functional programming practice and general brain-expansion, it's a terrible way to implement a map. A list of pairs is equivalent and easier to understand.</p>\n\n<p>As a side note, we can easily define an instance of <code>Functor</code> for this type:</p>\n\n<pre><code>instance Functor (Dict k) where\n  fmap f d = Dict $ \\g -&gt; fmap f (lookupBy g d)\n</code></pre>\n"}], "owner": {"reputation": 367, "user_id": 5929023, "user_type": "registered", "accept_rate": 88, "profile_image": "https://www.gravatar.com/avatar/374f88c63b3ab0372758b9fa9ba865cc?s=128&d=identicon&r=PG&f=1", "display_name": "galliwuzz", "link": "https://stackoverflow.com/users/5929023/galliwuzz"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 102, "favorite_count": 0, "accepted_answer_id": 41755532, "answer_count": 1, "score": 0, "last_activity_date": 1484912318, "creation_date": 1484867250, "question_id": 41753366, "link": "https://stackoverflow.com/questions/41753366/identifying-input-values-for-which-a-function-does-not-generate-a-specific-outpu", "title": "Identifying input values for which a function does NOT generate a specific output", "body": "<p>I built a data structure in form of a function that outputs certain strings in response to certain input strings like this:</p>\n\n<pre><code>type mydict = String -&gt; String\n\nemptydict :: mydict\nemptydict _ = \"not found\"\n</code></pre>\n\n<p>Now I can add entries into this dictionary by doing the following:</p>\n\n<pre><code>addentry :: String -&gt; String -&gt; mydict -&gt; mydict\naddentry s1 s2 d s \n| s1 == s = s2\n| otherwise = d s\n</code></pre>\n\n<p>To look for s2's I can simply enter s1 and look in my dictionary</p>\n\n<pre><code> looky :: String -&gt; mydict -&gt; String\n looky s1 d = d s1  --gives s2\n</code></pre>\n\n<p>My goal is now to create another function <code>patternmatch</code> in which I can check which s1's are associated with an s2 that starts with a certain pattern. Now the pattern matching itself isn't the problem, but I am not sure how can I keep track of the entries I entered, i.e. for which input is the output not <code>\"not found\"</code> ? </p>\n\n<p>My idea was to try to keep track of all the s1's I entered in the <code>addentry</code> function and add them to a separate list. In <code>patternmatch</code> I would feed the list elements to <code>looky</code>, such that I can get back the associated s2's and check whether they match the pattern. </p>\n\n<p>So my questions:</p>\n\n<p>1) Is this list building approach good or is there a better way of identifying the inputs for which a function is defined as something other than <code>\"not found\"</code>?</p>\n\n<p>2) If it is the right approach, how would I keep track of the s1's? I was thinking something like:</p>\n\n<pre><code>addentry s1 s2 d s\n| last (save s1) == s = s2\n| otherwise = d s1\n</code></pre>\n\n<p>And then <code>save s1</code> being a function generating the list with all s1's. <code>last (save s1)</code> would then return the most recent <code>s1</code>. Would appreciate any help on implementing <code>save s1</code> or other directions going from here. Thanks a lot.</p>\n"}, {"tags": ["haskell", "pattern-synonyms"], "comments": [{"owner": {"reputation": 37219, "user_id": 1523776, "user_type": "moderator", "accept_rate": 87, "profile_image": "https://www.gravatar.com/avatar/b3e0b5c8e42a8c38009ef2d969f8dabb?s=128&d=identicon&r=PG", "display_name": "Benjamin Hodgson", "link": "https://stackoverflow.com/users/1523776/benjamin-hodgson"}, "edited": false, "score": 0, "creation_date": 1484871772, "post_id": 41753345, "comment_id": 70700583, "body": "Does it work if you change <code>viewEqT</code> to use <code>Proxy</code>?"}, {"owner": {"reputation": 40537, "user_id": 465378, "user_type": "registered", "accept_rate": 85, "profile_image": "https://www.gravatar.com/avatar/c03b8d34978563858020eff0d14cc17b?s=128&d=identicon&r=PG", "display_name": "Alexis King", "link": "https://stackoverflow.com/users/465378/alexis-king"}, "reply_to_user": {"reputation": 37219, "user_id": 1523776, "user_type": "moderator", "accept_rate": 87, "profile_image": "https://www.gravatar.com/avatar/b3e0b5c8e42a8c38009ef2d969f8dabb?s=128&d=identicon&r=PG", "display_name": "Benjamin Hodgson", "link": "https://stackoverflow.com/users/1523776/benjamin-hodgson"}, "edited": false, "score": 0, "creation_date": 1484871855, "post_id": 41753345, "comment_id": 70700602, "body": "@BenjaminHodgson I couldn\u2019t figure out a way to get a pattern synonym to take an expression as an \u201cargument\u201d to be used in a view pattern instead of taking patterns, so <code>Proxy</code> didn\u2019t seem to help."}, {"owner": {"reputation": 100185, "user_id": 3234959, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/93bb12ca0f93dfddb33880316f7e66c2?s=128&d=identicon&r=PG&f=1", "display_name": "chi", "link": "https://stackoverflow.com/users/3234959/chi"}, "edited": false, "score": 0, "creation_date": 1484913880, "post_id": 41753345, "comment_id": 70717894, "body": "It seems that pattern synonyms only allow information to get &quot;out&quot; of them. I.e. we can&#39;t define <code>f (Plus1 5) = ...</code> where <code>Plus1 n = ((== n+1) -&gt; True)</code>. Here <code>n</code> must be an &quot;out&quot; pattern, not an input value. IIRC in Scala and extractor objects this is possible (albeit in Haskell we have view patterns which can do the same with a more verbose syntax). It would also be nice to type-apply in patterns like <code>EqT @ Int n</code> but <code>@</code> in patterns already means something else, and again this would be an &quot;in&quot; type argument."}, {"owner": {"reputation": 40537, "user_id": 465378, "user_type": "registered", "accept_rate": 85, "profile_image": "https://www.gravatar.com/avatar/c03b8d34978563858020eff0d14cc17b?s=128&d=identicon&r=PG", "display_name": "Alexis King", "link": "https://stackoverflow.com/users/465378/alexis-king"}, "reply_to_user": {"reputation": 100185, "user_id": 3234959, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/93bb12ca0f93dfddb33880316f7e66c2?s=128&d=identicon&r=PG&f=1", "display_name": "chi", "link": "https://stackoverflow.com/users/3234959/chi"}, "edited": false, "score": 0, "creation_date": 1484938369, "post_id": 41753345, "comment_id": 70732403, "body": "I\u2019ve opened GHC tickets <a href=\"https://ghc.haskell.org/trac/ghc/ticket/13158\" rel=\"nofollow noreferrer\">#13158</a> and <a href=\"https://ghc.haskell.org/trac/ghc/ticket/13159\" rel=\"nofollow noreferrer\">#13159</a> related to this issue, the former related to this program not typechecking and the latter related to @chi\u2019s request for visible type application in patterns."}], "answers": [{"tags": [], "owner": {"reputation": 1020, "user_id": 500060, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/c122862374667042520953c02df7d7ed?s=128&d=identicon&r=PG", "display_name": "glguy", "link": "https://stackoverflow.com/users/500060/glguy"}, "is_accepted": false, "score": 0, "last_activity_date": 1485024026, "creation_date": 1485024026, "answer_id": 41783052, "question_id": 41753345, "link": "https://stackoverflow.com/questions/41753345/how-can-i-write-this-pattern-synonym-without-ambiguous-type-errors/41783052#41783052", "title": "How can I write this pattern synonym without ambiguous type errors?", "body": "<p>If the goal is to find some clean syntax to implement your <code>evilId</code> function, you can write it like this:</p>\n\n<pre><code>{-# Language ScopedTypeVariables, GADTs, TypeApplications #-}\n\nmodule Demo where\n\nimport Data.Typeable\n\nevilId :: forall a. Typeable a =&gt; a -&gt; a\nevilId x\n  | Just Refl &lt;- eqT @a @Int    = x+1\n  | Just Refl &lt;- eqT @a @String = reverse x\n  | otherwise                   = x\n</code></pre>\n\n<p>This doesn't help with the ambiguities surrounding your pattern synonyms, unfortunately.</p>\n"}], "owner": {"reputation": 40537, "user_id": 465378, "user_type": "registered", "accept_rate": 85, "profile_image": "https://www.gravatar.com/avatar/c03b8d34978563858020eff0d14cc17b?s=128&d=identicon&r=PG", "display_name": "Alexis King", "link": "https://stackoverflow.com/users/465378/alexis-king"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 178, "favorite_count": 1, "answer_count": 1, "score": 5, "last_activity_date": 1485024026, "creation_date": 1484867139, "question_id": 41753345, "link": "https://stackoverflow.com/questions/41753345/how-can-i-write-this-pattern-synonym-without-ambiguous-type-errors", "title": "How can I write this pattern synonym without ambiguous type errors?", "body": "<p>Using <code>ViewPatterns</code> and <code>Data.Typeable</code>, I\u2019ve managed to write a function that allows me to write something resembling case analysis on types. Observe:</p>\n\n<pre><code>{-# LANGUAGE GADTs, PatternSynonyms, RankNTypes, ScopedTypeVariables\n           , TypeApplications, TypeOperators, ViewPatterns #-}\n\nimport Data.Typeable\n\nviewEqT :: forall b a. (Typeable a, Typeable b) =&gt; a -&gt; Maybe ((a :~: b), b)\nviewEqT x = case eqT @a @b of\n  Just Refl -&gt; Just (Refl, x)\n  Nothing -&gt; Nothing\n\nevilId :: Typeable a =&gt; a -&gt; a\nevilId (viewEqT @Int -&gt; Just (Refl, n)) = n + 1\nevilId (viewEqT @String -&gt; Just (Refl, str)) = reverse str\nevilId x = x\n</code></pre>\n\n<p>The above <code>evilId</code> function is very evil, indeed, since it uses <code>Typeable</code> to completely subvert parametricity:</p>\n\n<pre><code>ghci&gt; evilId True\nTrue\nghci&gt; evilId \"hello\"\n\"olleh\"\n</code></pre>\n\n<p>Since I love being evil, I am very pleased with this, but the above syntax is very noisy. I would love to be able to write the same code more clearly, so I decided to write a pattern synonym:</p>\n\n<pre><code>pattern EqT :: forall b a. (Typeable a, Typeable b) =&gt; (a ~ b) =&gt; b -&gt; a\npattern EqT x &lt;- (viewEqT @b -&gt; Just (Refl, x))\n</code></pre>\n\n<p>I figured that I would be able to use this pattern synonym to make my evil case analysis much easier to read:</p>\n\n<pre><code>evilId :: Typeable a =&gt; a -&gt; a\nevilId (EqT (n :: Int)) = n + 1\nevilId (EqT (str :: String)) = reverse str\nevilId x = x\n</code></pre>\n\n<p>Sadly, this does not work at all. GHC does not seem to consult my type annotations before typechecking the pattern, so it believes <code>b</code> is an ambiguous variable in each pattern. Is there any way I can cleanly wrap these patterns with a pattern synonym, or will I be stuck with my longer view patterns?</p>\n"}, {"tags": ["haskell", "state-monad", "free-monad"], "comments": [{"owner": {"reputation": 14485, "user_id": 190376, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/cd8280c5e1491b8cf55760750ed97dec?s=128&d=identicon&r=PG", "display_name": "Reid Barton", "link": "https://stackoverflow.com/users/190376/reid-barton"}, "edited": false, "score": 0, "creation_date": 1484865599, "post_id": 41751854, "comment_id": 70698596, "body": "Meta-comment: surely these questions must all be a duplicate of something?"}], "answers": [{"comments": [{"owner": {"reputation": 1835, "user_id": 3907685, "user_type": "registered", "accept_rate": 87, "profile_image": "https://www.gravatar.com/avatar/4a9d7cdfc525e689e6baefb7d2158fb0?s=128&d=identicon&r=PG", "display_name": "Chris Penner", "link": "https://stackoverflow.com/users/3907685/chris-penner"}, "edited": false, "score": 0, "creation_date": 1484861281, "post_id": 41751993, "comment_id": 70696526, "body": "That&#39;s great to know; but how can I fix it?"}, {"owner": {"reputation": 126897, "user_id": 791604, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/ce991df7a056248d5e4f6fc3659ba733?s=128&d=identicon&r=PG", "display_name": "Daniel Wagner", "link": "https://stackoverflow.com/users/791604/daniel-wagner"}, "reply_to_user": {"reputation": 1835, "user_id": 3907685, "user_type": "registered", "accept_rate": 87, "profile_image": "https://www.gravatar.com/avatar/4a9d7cdfc525e689e6baefb7d2158fb0?s=128&d=identicon&r=PG", "display_name": "Chris Penner", "link": "https://stackoverflow.com/users/3907685/chris-penner"}, "edited": false, "score": 0, "creation_date": 1484861363, "post_id": 41751993, "comment_id": 70696560, "body": "@ChrisPenner Not many choices. I&#39;ll add a short bit to my answer."}, {"owner": {"reputation": 1835, "user_id": 3907685, "user_type": "registered", "accept_rate": 87, "profile_image": "https://www.gravatar.com/avatar/4a9d7cdfc525e689e6baefb7d2158fb0?s=128&d=identicon&r=PG", "display_name": "Chris Penner", "link": "https://stackoverflow.com/users/3907685/chris-penner"}, "edited": false, "score": 0, "creation_date": 1484861427, "post_id": 41751993, "comment_id": 70696584, "body": "The heart of the question is that I&#39;d love to embed state monads inside my Free Monad; so if I can do that cleanly then I&#39;m happy; though it seems like a bit of an oversight if there&#39;s no way to get this to work;"}, {"owner": {"reputation": 126897, "user_id": 791604, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/ce991df7a056248d5e4f6fc3659ba733?s=128&d=identicon&r=PG", "display_name": "Daniel Wagner", "link": "https://stackoverflow.com/users/791604/daniel-wagner"}, "reply_to_user": {"reputation": 1835, "user_id": 3907685, "user_type": "registered", "accept_rate": 87, "profile_image": "https://www.gravatar.com/avatar/4a9d7cdfc525e689e6baefb7d2158fb0?s=128&d=identicon&r=PG", "display_name": "Chris Penner", "link": "https://stackoverflow.com/users/3907685/chris-penner"}, "edited": false, "score": 0, "creation_date": 1484861514, "post_id": 41751993, "comment_id": 70696645, "body": "@ChrisPenner You definitely can&#39;t embed state monad<b>s</b> and use <code>MonadState</code> -- the fundep on <code>MonadState</code> says that any given monad can only have one type of state. This is important for reducing the number of type annotations needed when using the class methods."}, {"owner": {"reputation": 1835, "user_id": 3907685, "user_type": "registered", "accept_rate": 87, "profile_image": "https://www.gravatar.com/avatar/4a9d7cdfc525e689e6baefb7d2158fb0?s=128&d=identicon&r=PG", "display_name": "Chris Penner", "link": "https://stackoverflow.com/users/3907685/chris-penner"}, "edited": false, "score": 0, "creation_date": 1484861933, "post_id": 41751993, "comment_id": 70696866, "body": "If I deparameterize the type to just <code>Toy</code> and restrict it to <code>Int</code> as the state then MonadState should be able to uniquely determine <code>Toy -&gt; Int</code>; is that correct? I still have a tough time believing that you can&#39;t embed mtl operations in Free; seems like such a useful case! How does everyone else do state inside their Free monads and DSLs? The newtype version doesn&#39;t look too bad though so I&#39;ll give it a try!"}, {"owner": {"reputation": 1835, "user_id": 3907685, "user_type": "registered", "accept_rate": 87, "profile_image": "https://www.gravatar.com/avatar/4a9d7cdfc525e689e6baefb7d2158fb0?s=128&d=identicon&r=PG", "display_name": "Chris Penner", "link": "https://stackoverflow.com/users/3907685/chris-penner"}, "edited": false, "score": 0, "creation_date": 1484862704, "post_id": 41751993, "comment_id": 70697258, "body": "Newtypes work without too much trouble! I&#39;m still curious as to other discussions around this; so I&#39;m going to leave the question open a bit longer, but this definitely helped! Thanks!"}, {"owner": {"reputation": 126897, "user_id": 791604, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/ce991df7a056248d5e4f6fc3659ba733?s=128&d=identicon&r=PG", "display_name": "Daniel Wagner", "link": "https://stackoverflow.com/users/791604/daniel-wagner"}, "reply_to_user": {"reputation": 1835, "user_id": 3907685, "user_type": "registered", "accept_rate": 87, "profile_image": "https://www.gravatar.com/avatar/4a9d7cdfc525e689e6baefb7d2158fb0?s=128&d=identicon&r=PG", "display_name": "Chris Penner", "link": "https://stackoverflow.com/users/3907685/chris-penner"}, "edited": false, "score": 0, "creation_date": 1484863596, "post_id": 41751993, "comment_id": 70697690, "body": "@ChrisPenner Having <i>a</i> state is fine (even when the choice is parameterized as in your example), using a newtype like in this answer. It&#39;s just multiple state types that are a problem."}], "tags": [], "owner": {"reputation": 126897, "user_id": 791604, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/ce991df7a056248d5e4f6fc3659ba733?s=128&d=identicon&r=PG", "display_name": "Daniel Wagner", "link": "https://stackoverflow.com/users/791604/daniel-wagner"}, "is_accepted": true, "score": 4, "last_activity_date": 1484861444, "last_edit_date": 1484861444, "creation_date": 1484861210, "answer_id": 41751993, "question_id": 41751854, "link": "https://stackoverflow.com/questions/41751854/why-am-i-getting-overlapping-instances-error-when-one-doesnt-match/41751993#41751993", "title": "Why am I getting &#39;Overlapping instances&#39; error when one doesn&#39;t match?", "body": "<p>The instance context (the <code>(Functor m, MonadState s m)</code> bit) is simply ignored when choosing instances. This is to prevent the compiler from having to do a potentially costly backtracking search to choose an instance. So if two instances apply and one is ruled out only because of an instance context, as in your case, it's an overlap.</p>\n\n<p>This is an unfortunate part of the design of mtl, and one I think each Haskell programmer has bumped up against at some point or other. There's not a lot of choices for fixes; generally you add a newtype and give your instance, as in</p>\n\n<pre><code>newtype FreeToy s a = FreeToy (Free (Toy s) a)\ninstance MonadState s (FreeToy s) where -- ...\n</code></pre>\n"}], "owner": {"reputation": 1835, "user_id": 3907685, "user_type": "registered", "accept_rate": 87, "profile_image": "https://www.gravatar.com/avatar/4a9d7cdfc525e689e6baefb7d2158fb0?s=128&d=identicon&r=PG", "display_name": "Chris Penner", "link": "https://stackoverflow.com/users/3907685/chris-penner"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 81, "favorite_count": 0, "accepted_answer_id": 41751993, "answer_count": 1, "score": 3, "last_activity_date": 1484861444, "creation_date": 1484860583, "question_id": 41751854, "link": "https://stackoverflow.com/questions/41751854/why-am-i-getting-overlapping-instances-error-when-one-doesnt-match", "title": "Why am I getting &#39;Overlapping instances&#39; error when one doesn&#39;t match?", "body": "<p>I'm attempting to allow embedding a state monad in my Free monad; here's my simple attempt:</p>\n\n<pre><code>{-# language FlexibleInstances, MultiParamTypeClasses #-}\nmodule Main where\n\nimport Control.Monad.Free\nimport Control.Monad.State\nimport Data.Bifunctor\n\ndata Toy state next =\n      Output String next\n    | LiftState (state -&gt; (next, state))\n    | Done\n\ninstance Functor (Toy s) where\n  fmap f (Output str next) = Output str $ f next\n  fmap f (LiftState stateF) = LiftState (first f . stateF)\n  fmap f Done = Done\n\ninstance MonadState s (Free (Toy s)) where\n  state = overState\n\noverState :: (s -&gt; (a, s)) -&gt; Free (Toy s) a\noverState = liftF . LiftState\n\noutput :: Show a =&gt; a -&gt; Free (Toy s) ()\noutput x = liftF $ Output (show x) ()\n\ndone :: Free (Toy s) r\ndone = liftF Done\n\nprogram :: Free (Toy Int) ()\nprogram = do\n  start &lt;- get\n  output start\n  modify ((+10) :: (Int -&gt; Int))\n  end &lt;- get\n  output end\n  done\n\ninterpret :: (Show r) =&gt; Free (Toy s) r -&gt; s -&gt; IO ()\ninterpret (Free (LiftState stateF)) s = let (next, newS) = stateF s\n                                         in interpret next newS\ninterpret (Free (Output str next)) s = print str &gt;&gt; interpret next s\ninterpret (Free Done) s = return ()\ninterpret (Pure x) s = print x\n\nmain :: IO ()\nmain = interpret program (5 :: Int)\n</code></pre>\n\n<p>I get the error:</p>\n\n<pre><code>\u2022 Overlapping instances for MonadState Int (Free (Toy Int))\n    arising from a use of \u2018get\u2019\n  Matching instances:\n    instance [safe] (Functor m, MonadState s m) =&gt;\n                    MonadState s (Free m)\n      -- Defined in \u2018Control.Monad.Free\u2019\n    instance MonadState s (Free (Toy s))\n      -- Defined at app/Main.hs:18:10\n\u2022 In a stmt of a 'do' block: start &lt;- get\n  In the expression:\n    do { start &lt;- get;\n         output start;\n         modify ((+ 10) :: Int -&gt; Int);\n         end &lt;- get;\n         .... }\n  In an equation for \u2018program\u2019:\n      program\n        = do { start &lt;- get;\n               output start;\n               modify ((+ 10) :: Int -&gt; Int);\n               .... }\n</code></pre>\n\n<p>As far as I can gather; it's trying to apply this instance:</p>\n\n<pre><code>(Functor m, MonadState s m) =&gt; MonadState s (Free m)\n</code></pre>\n\n<p>from the\n<a href=\"https://hackage.haskell.org/package/free-3.4.2/docs/Control-Monad-Free.html\" rel=\"nofollow noreferrer\">free package here</a>; however in this case it would have to match <code>Free (Toy s)</code> and there's no <code>MonadState s (Toy s)</code> as required so I don't understand why it thinks that it applies.</p>\n\n<p>If I remove my instance definition I get:</p>\n\n<pre><code>\u2022 No instance for (MonadState Int (Toy Int))\n    arising from a use of \u2018modify\u2019\n</code></pre>\n\n<p>Which supports my thought that the other instance doesn't actually apply; How can I get this to compile using my specified instance? And can you explain why this is occurring? Is it due to <code>FlexibleInstances</code> being used?</p>\n\n<p>Thanks!</p>\n"}, {"tags": ["haskell", "exception-handling", "monad-transformers"], "comments": [{"owner": {"reputation": 126897, "user_id": 791604, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/ce991df7a056248d5e4f6fc3659ba733?s=128&d=identicon&r=PG", "display_name": "Daniel Wagner", "link": "https://stackoverflow.com/users/791604/daniel-wagner"}, "edited": false, "score": 2, "creation_date": 1484861643, "post_id": 41751698, "comment_id": 70696719, "body": "<a href=\"http://hackage.haskell.org/package/errors-2.1.2/docs/Control-Error-Util.html#v:tryIO\" rel=\"nofollow noreferrer\">tryIO</a>?"}, {"owner": {"reputation": 4593, "user_id": 2289983, "user_type": "registered", "accept_rate": 92, "profile_image": "https://i.stack.imgur.com/LG4hj.jpg?s=128&g=1", "display_name": "Damian Nadales", "link": "https://stackoverflow.com/users/2289983/damian-nadales"}, "reply_to_user": {"reputation": 126897, "user_id": 791604, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/ce991df7a056248d5e4f6fc3659ba733?s=128&d=identicon&r=PG", "display_name": "Daniel Wagner", "link": "https://stackoverflow.com/users/791604/daniel-wagner"}, "edited": false, "score": 0, "creation_date": 1484861847, "post_id": 41751698, "comment_id": 70696829, "body": "How would you use it in this example?"}, {"owner": {"reputation": 126897, "user_id": 791604, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/ce991df7a056248d5e4f6fc3659ba733?s=128&d=identicon&r=PG", "display_name": "Daniel Wagner", "link": "https://stackoverflow.com/users/791604/daniel-wagner"}, "edited": false, "score": 0, "creation_date": 1484863635, "post_id": 41751698, "comment_id": 70697715, "body": "<code>queryServer = tryIO . fetchSomething</code>"}, {"owner": {"reputation": 4593, "user_id": 2289983, "user_type": "registered", "accept_rate": 92, "profile_image": "https://i.stack.imgur.com/LG4hj.jpg?s=128&g=1", "display_name": "Damian Nadales", "link": "https://stackoverflow.com/users/2289983/damian-nadales"}, "reply_to_user": {"reputation": 126897, "user_id": 791604, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/ce991df7a056248d5e4f6fc3659ba733?s=128&d=identicon&r=PG", "display_name": "Daniel Wagner", "link": "https://stackoverflow.com/users/791604/daniel-wagner"}, "edited": false, "score": 0, "creation_date": 1484901084, "post_id": 41751698, "comment_id": 70709893, "body": "But this would require that I change <code>Message</code> to <code>IOException</code> in the constraints above. I don&#39;t know if you&#39;re implying that I should do this anyway."}, {"owner": {"reputation": 4593, "user_id": 2289983, "user_type": "registered", "accept_rate": 92, "profile_image": "https://i.stack.imgur.com/LG4hj.jpg?s=128&g=1", "display_name": "Damian Nadales", "link": "https://stackoverflow.com/users/2289983/damian-nadales"}, "reply_to_user": {"reputation": 126897, "user_id": 791604, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/ce991df7a056248d5e4f6fc3659ba733?s=128&d=identicon&r=PG", "display_name": "Daniel Wagner", "link": "https://stackoverflow.com/users/791604/daniel-wagner"}, "edited": false, "score": 0, "creation_date": 1484902123, "post_id": 41751698, "comment_id": 70710409, "body": "And the other problem with using <code>tryIO</code> is that I cannot longer leave <code>m</code> abstract, but I have to use <code>ExceptT</code> as <code>m</code> instead."}, {"owner": {"reputation": 126897, "user_id": 791604, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/ce991df7a056248d5e4f6fc3659ba733?s=128&d=identicon&r=PG", "display_name": "Daniel Wagner", "link": "https://stackoverflow.com/users/791604/daniel-wagner"}, "edited": false, "score": 0, "creation_date": 1484929050, "post_id": 41751698, "comment_id": 70727442, "body": "If <code>tryIO</code> isn&#39;t exactly the combinator you want, write exactly the combinator you want!"}], "owner": {"reputation": 4593, "user_id": 2289983, "user_type": "registered", "accept_rate": 92, "profile_image": "https://i.stack.imgur.com/LG4hj.jpg?s=128&g=1", "display_name": "Damian Nadales", "link": "https://stackoverflow.com/users/2289983/damian-nadales"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 187, "favorite_count": 0, "answer_count": 0, "score": 2, "last_activity_date": 1484859907, "creation_date": 1484859907, "last_edit_date": 1495540376, "question_id": 41751698, "link": "https://stackoverflow.com/questions/41751698/dealing-with-io-exceptions-inside-the-monaderror", "title": "Dealing with IO exceptions inside the MonadError", "body": "<p>I'm writing a function that queries a REST end-point to fetch some data, say <code>queryServer</code>:</p>\n\n<pre><code>queryServer :: (MonadIO m, MonadError Message m) =&gt; URL -&gt; m String\n</code></pre>\n\n<p>The reason why I want to use the <code>MonadError</code> from <code>Control.Monad.Except</code> is that I want to have the short-circuiting behavior of this monad. So for instance it can be used as follows:</p>\n\n<pre><code>queryServers :: (MonadIO m, MonadError Message m) =&gt; m (String, String)\nqueryServers = do\n  res0 &lt;- queryServer \"server0\" \n  res1 &lt;- queryServer \"server1\"\n  return (res0, res1)\n</code></pre>\n\n<p>In this way, I do not have to worry about catching exceptions originated at <code>queryServer</code> and the function fails as soon as an error is encountered. </p>\n\n<p>The problem I have with this approach (and there might be others I'm unaware of) is that I have to use some boilerplate to catch the IO exceptions and re-throw them with <code>throwError</code>:</p>\n\n<pre><code>queryServer url = do\n  result &lt;- liftIO $ try (fetchSomething url)\n  case result of\n    Left (e :: IOException) -&gt; throwError \"error when fetching\"\n    Right sth -&gt; return sth\n\nfetchSomething :: URL -&gt; IO String\nfetchSomething = undefined\n</code></pre>\n\n<p>I've seen several questions regarding the proper use of exceptions in Haskell, like <a href=\"https://stackoverflow.com/questions/25752900/exceptions-and-monad-transformers\">this one</a>, however none of them deals with the <code>MonadError</code>.</p>\n\n<p>What is the right way to dealing with IO exceptions within the `MonadError?</p>\n"}, {"tags": ["haskell"], "comments": [{"owner": {"reputation": 57219, "user_id": 33796, "user_type": "registered", "accept_rate": 70, "profile_image": "https://www.gravatar.com/avatar/08727b23ba62e634b32988cdff082663?s=128&d=identicon&r=PG", "display_name": "luqui", "link": "https://stackoverflow.com/users/33796/luqui"}, "edited": false, "score": 0, "creation_date": 1484865624, "post_id": 41750998, "comment_id": 70698607, "body": "A class with only one instance is just a complicated way to write a function. <code>instance ... =&gt; MonadStore m</code> says &quot;every type constructor <code>m</code> is a <code>MonadStore</code> instance in the following way&quot; (and only later are constraints resolved).  Such instances are almost never what you want -- instances should be like <code>instance ... =&gt; MonadStore (Something ...)</code>, where <code>Something</code> is a concrete type/constructor."}], "owner": {"reputation": 815, "user_id": 245743, "user_type": "registered", "accept_rate": 89, "profile_image": "https://www.gravatar.com/avatar/11a87619d08da72466e99e16453ea318?s=128&d=identicon&r=PG", "display_name": "ppb", "link": "https://stackoverflow.com/users/245743/ppb"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 77, "favorite_count": 0, "answer_count": 0, "score": 1, "last_activity_date": 1484857361, "creation_date": 1484857361, "question_id": 41750998, "link": "https://stackoverflow.com/questions/41750998/how-can-i-make-this-code-more-polymorphic", "title": "How can I make this code more polymorphic?", "body": "<p>I'm working with the following code:</p>\n\n<pre class=\"lang-hs prettyprint-override\"><code>{-# LANGUAGE FlexibleContexts #-}\n{-# LANGUAGE FlexibleInstances #-}\n{-# LANGUAGE FunctionalDependencies #-}\n{-# LANGUAGE GADTs #-}\n{-# LANGUAGE GeneralizedNewtypeDeriving #-}\n{-# LANGUAGE MultiParamTypeClasses #-}\n{-# LANGUAGE NoImplicitPrelude #-}\n{-# LANGUAGE OverloadedStrings #-}\n{-# LANGUAGE QuasiQuotes #-}\n{-# LANGUAGE ScopedTypeVariables #-}\n{-# LANGUAGE TemplateHaskell #-}\n{-# LANGUAGE TypeFamilies #-}\n{-# LANGUAGE UndecidableInstances #-}\n\nmodule Lib where\n\nimport           Protolude hiding (from, try)\n\nimport           Control.Exception.Safe\nimport           Database.Esqueleto\nimport           Database.Persist.TH\n\nnewtype PingId =\n  PingId Int\n  deriving (Enum, Eq, Integral, Num, Ord, Real, Show)\n\ndata Ping = Ping\n  {\n  } deriving (Show)\n\nshare [mkPersist sqlSettings] [persistLowerCase|\nDbPing sql=pings\n|]\n\npingToDbPing :: Ping -&gt; DbPing\npingToDbPing _ = undefined\n\nclass (PersistEntity b, ToBackendKey SqlBackend b) =&gt;\n      ToPersistEntity a b | a -&gt; b where\n  toPersistEntity :: a -&gt; b\n\ntype family FromKey a :: * where\n  FromKey DbPingId = PingId\n\ninstance ToPersistEntity Ping DbPing where\n  toPersistEntity = pingToDbPing\n\ndata DbConfig = DbConfig\n  { dbConnectionPool :: ConnectionPool\n  }\n\nrunDB\n  :: (MonadIO m, MonadReader DbConfig m)\n  =&gt; SqlPersistT IO b -&gt; m b\nrunDB q = do\n  pool &lt;- asks dbConnectionPool\n  liftIO $ runSqlPool q pool\n\nsaveDB\n  :: ( Exception e\n     , ToPersistEntity value record\n     , Num (FromKey (Key record))\n     , MonadCatch m\n     , MonadIO m\n     , MonadReader DbConfig m\n     , FromKey (Key record) ~ key\n     )\n  =&gt; value -&gt; m (Either e key)\nsaveDB x =\n  fmap (fromIntegral . fromSqlKey) &lt;$&gt;\n  try (liftIO . evaluate =&lt;&lt; runDB (insert (toPersistEntity x)))\n</code></pre>\n\n<p>In short I have domain objects (e.g <code>Ping</code>), <code>ToPersistEntity</code> type class to convert those into their database representation, <code>FromKey</code> type family to map between database / domain object id's, and <code>saveDB</code> function that works for anything satisfying those criteria.</p>\n\n<p>As the next step I wish to create a type class to abstract persisting the objects so that my other functions can be polymorphic in <code>MonadStore</code> and I can have different instances for use in my application and for testing. For use in my app I would like to reuse the generic <code>saveDB</code> function. Ideally I would like to have something along the lines of:</p>\n\n<pre class=\"lang-hs prettyprint-override\"><code>class (Monad m) =&gt;\n      MonadStore m where\n  save\n    :: (Exception e)\n    =&gt; value -&gt; m (Either e key)\n</code></pre>\n\n<p>with <code>save</code> type class method delegating to <code>saveDB</code> when used in my application. That works fine if I make type class methods specialised to specific types such as <code>Ping</code> and <code>PingId</code>.</p>\n\n<pre class=\"lang-hs prettyprint-override\"><code>class (Monad m) =&gt;\n      MonadStore m where\n  savePing\n    :: (Exception e)\n    =&gt; Ping -&gt; m (Either e PingId)\n\ninstance (MonadCatch m, MonadIO m, Monad m, MonadReader DbConfig m) =&gt;\n         MonadStore m where\n  savePing = saveDB\n</code></pre>\n\n<p>but has the drawback of having to define a new method for each of my objects.</p>\n\n<p>Trying to define my desired instance:</p>\n\n<pre class=\"lang-hs prettyprint-override\"><code>instance (MonadCatch m, MonadIO m, Monad m, MonadReader DbConfig m) =&gt;\n         MonadStore m where\n  save = saveDB\n</code></pre>\n\n<p>produces a type error:</p>\n\n<pre><code>/home/ppb/Code/haskell/test/src/Lib.hs:86:10: error:\n    \u2022 Couldn't match type \u2018key\u2019 with \u2018FromKey (Key record0)\u2019\n        arising from a use of \u2018saveDB\u2019\n      \u2018key\u2019 is a rigid type variable bound by\n        the type signature for:\n          save :: forall e value key.\n                  Exception e =&gt;\n                  value -&gt; m (Either e key)\n        at src/Lib.hs:86:3\n    \u2022 In the expression: saveDB\n      In an equation for \u2018save\u2019: save = saveDB\n      In the instance declaration for \u2018MonadStore m\u2019\n    \u2022 Relevant bindings include\n        save :: value -&gt; m (Either e key) (bound at src/Lib.hs:86:3)\n</code></pre>\n\n<p>and no matter what I try I can't figure out how to make a valid instance where <code>save</code> delegates to <code>saveDB</code>. Is there any way I could make this work? I'm also interested to better understand the error the compiler produces.</p>\n"}, {"tags": ["list", "function", "haskell", "search", "tuples"], "comments": [{"owner": {"reputation": 1414, "user_id": 6564029, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/WxyK5.jpg?s=128&g=1", "display_name": "Michail", "link": "https://stackoverflow.com/users/6564029/michail"}, "edited": false, "score": 0, "creation_date": 1484853285, "post_id": 41749542, "comment_id": 70692072, "body": "As it is, your <code>insert</code> just discards existing entries. You are looking for <code>(name, number) : phonebook</code> rather than just <code>[(name, number)]</code>"}, {"owner": {"reputation": 314794, "user_id": 67579, "user_type": "registered", "accept_rate": 81, "profile_image": "https://i.stack.imgur.com/BJXub.png?s=128&g=1", "display_name": "Willem Van Onsem", "link": "https://stackoverflow.com/users/67579/willem-van-onsem"}, "edited": false, "score": 0, "creation_date": 1484853704, "post_id": 41749542, "comment_id": 70692288, "body": "Your <code>emptPhonebook</code> actually has an entry."}, {"owner": {"reputation": 314794, "user_id": 67579, "user_type": "registered", "accept_rate": 81, "profile_image": "https://i.stack.imgur.com/BJXub.png?s=128&g=1", "display_name": "Willem Van Onsem", "link": "https://stackoverflow.com/users/67579/willem-van-onsem"}, "edited": false, "score": 1, "creation_date": 1484853847, "post_id": 41749542, "comment_id": 70692365, "body": "If I remember correctly, you are already the third one asking for related questions. See for instance <a href=\"http://stackoverflow.com/questions/41696230/haskell-phonebook-adding-elements?s=1|0.0000\">here</a>."}, {"owner": {"reputation": 37, "user_id": 7442604, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/58fcce2425f6509e1fe489a8febf9442?s=128&d=identicon&r=PG&f=1", "display_name": "J.Dean", "link": "https://stackoverflow.com/users/7442604/j-dean"}, "edited": false, "score": 0, "creation_date": 1484853990, "post_id": 41749542, "comment_id": 70692443, "body": "thanks Michail! your solution solves the main Problem. But now the result is [(&quot;Dad&quot;,&quot;90213&quot;),(&quot;mum&quot;,&quot;8912&quot;),(&quot;&quot;,&quot;&quot;)] insted of                                [(&quot;Dad&quot;,&quot;90213&quot;),(&quot;mum&quot;,&quot;8912&quot;)]. Do you know a better solution for emptyPhonebook?"}, {"owner": {"reputation": 37, "user_id": 7442604, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/58fcce2425f6509e1fe489a8febf9442?s=128&d=identicon&r=PG&f=1", "display_name": "J.Dean", "link": "https://stackoverflow.com/users/7442604/j-dean"}, "reply_to_user": {"reputation": 314794, "user_id": 67579, "user_type": "registered", "accept_rate": 81, "profile_image": "https://i.stack.imgur.com/BJXub.png?s=128&g=1", "display_name": "Willem Van Onsem", "link": "https://stackoverflow.com/users/67579/willem-van-onsem"}, "edited": false, "score": 0, "creation_date": 1484854261, "post_id": 41749542, "comment_id": 70692621, "body": "@WillemVanOnsem My question is a Little bit different, because i&#39;m tring to create a &quot;Phonebook&quot; as a list of tuples and the other guy as a function. I can&#39;t derive or use this way of thinking for my Programm."}, {"owner": {"reputation": 314794, "user_id": 67579, "user_type": "registered", "accept_rate": 81, "profile_image": "https://i.stack.imgur.com/BJXub.png?s=128&g=1", "display_name": "Willem Van Onsem", "link": "https://stackoverflow.com/users/67579/willem-van-onsem"}, "edited": false, "score": 0, "creation_date": 1484854392, "post_id": 41749542, "comment_id": 70692693, "body": "@J.Dean: yeah but you had a &quot;J. Doe&quot; and a &quot;John Doe&quot; (although I currently fail to find his/her question) who implemented it as a list of tuples as well. Now there is a &quot;J.Dean&quot; , so I expect the next one to be &quot;John Dean&quot; :)."}, {"owner": {"reputation": 37, "user_id": 7442604, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/58fcce2425f6509e1fe489a8febf9442?s=128&d=identicon&r=PG&f=1", "display_name": "J.Dean", "link": "https://stackoverflow.com/users/7442604/j-dean"}, "edited": false, "score": 0, "creation_date": 1484857412, "post_id": 41749542, "comment_id": 70694496, "body": "Possible duplicate of <a href=\"http://stackoverflow.com/questions/41696230/haskell-phonebook-adding-elements\">Haskell Phonebook adding elements</a>"}, {"owner": {"reputation": 37, "user_id": 7442604, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/58fcce2425f6509e1fe489a8febf9442?s=128&d=identicon&r=PG&f=1", "display_name": "J.Dean", "link": "https://stackoverflow.com/users/7442604/j-dean"}, "reply_to_user": {"reputation": 314794, "user_id": 67579, "user_type": "registered", "accept_rate": 81, "profile_image": "https://i.stack.imgur.com/BJXub.png?s=128&g=1", "display_name": "Willem Van Onsem", "link": "https://stackoverflow.com/users/67579/willem-van-onsem"}, "edited": false, "score": 1, "creation_date": 1484935265, "post_id": 41749542, "comment_id": 70730832, "body": "@WillemVanOnsem haha i&#39;ve needed a quick name to ask my question and i saw the question of John Doe before, so i think i got inspired. By the way do you know a way to implement a function, which checks whether a string starts with certain chars. I Need this function as an extension for my phonebook :D"}, {"owner": {"reputation": 314794, "user_id": 67579, "user_type": "registered", "accept_rate": 81, "profile_image": "https://i.stack.imgur.com/BJXub.png?s=128&g=1", "display_name": "Willem Van Onsem", "link": "https://stackoverflow.com/users/67579/willem-van-onsem"}, "edited": false, "score": 0, "creation_date": 1484935362, "post_id": 41749542, "comment_id": 70730877, "body": "@J.Dean: Without wanting to be rude, I think it is SO&#39;s policy to ask different questions for - well - different questions such that people can easily find them :)"}], "answers": [{"comments": [{"owner": {"reputation": 37, "user_id": 7442604, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/58fcce2425f6509e1fe489a8febf9442?s=128&d=identicon&r=PG&f=1", "display_name": "J.Dean", "link": "https://stackoverflow.com/users/7442604/j-dean"}, "edited": false, "score": 0, "creation_date": 1484930279, "post_id": 41750274, "comment_id": 70728186, "body": "is there a possibility to avoid the error and  instead of this return a string ?"}, {"owner": {"reputation": 314794, "user_id": 67579, "user_type": "registered", "accept_rate": 81, "profile_image": "https://i.stack.imgur.com/BJXub.png?s=128&g=1", "display_name": "Willem Van Onsem", "link": "https://stackoverflow.com/users/67579/willem-van-onsem"}, "reply_to_user": {"reputation": 37, "user_id": 7442604, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/58fcce2425f6509e1fe489a8febf9442?s=128&d=identicon&r=PG&f=1", "display_name": "J.Dean", "link": "https://stackoverflow.com/users/7442604/j-dean"}, "edited": false, "score": 0, "creation_date": 1484930313, "post_id": 41750274, "comment_id": 70728208, "body": "@J.Dean: what should the string look like?"}, {"owner": {"reputation": 314794, "user_id": 67579, "user_type": "registered", "accept_rate": 81, "profile_image": "https://i.stack.imgur.com/BJXub.png?s=128&g=1", "display_name": "Willem Van Onsem", "link": "https://stackoverflow.com/users/67579/willem-van-onsem"}, "reply_to_user": {"reputation": 37, "user_id": 7442604, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/58fcce2425f6509e1fe489a8febf9442?s=128&d=identicon&r=PG&f=1", "display_name": "J.Dean", "link": "https://stackoverflow.com/users/7442604/j-dean"}, "edited": false, "score": 0, "creation_date": 1484930734, "post_id": 41750274, "comment_id": 70728449, "body": "@J.Dean: but you don&#39;t have any number in that case: the program errors if it cannot find the number."}, {"owner": {"reputation": 37, "user_id": 7442604, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/58fcce2425f6509e1fe489a8febf9442?s=128&d=identicon&r=PG&f=1", "display_name": "J.Dean", "link": "https://stackoverflow.com/users/7442604/j-dean"}, "edited": false, "score": 0, "creation_date": 1484931085, "post_id": 41750274, "comment_id": 70728657, "body": "I mean something like | query == name = number | search query other == name = number | otherwise &quot;error&quot;. In this wrong Code it only search the first entry. I Need the correct Version of this, where the programm search in all tuples in the list. thanks for the fast answers!"}], "tags": [], "owner": {"reputation": 314794, "user_id": 67579, "user_type": "registered", "accept_rate": 81, "profile_image": "https://i.stack.imgur.com/BJXub.png?s=128&g=1", "display_name": "Willem Van Onsem", "link": "https://stackoverflow.com/users/67579/willem-van-onsem"}, "is_accepted": false, "score": 2, "last_activity_date": 1484931405, "last_edit_date": 1484931405, "creation_date": 1484854794, "answer_id": 41750274, "question_id": 41749542, "link": "https://stackoverflow.com/questions/41749542/haskell-create-a-phonebook-as-a-list-of-tuples/41750274#41750274", "title": "Haskell create a Phonebook as a list of tuples", "body": "<p>A lot of things are wrong with your code:</p>\n\n<ul>\n<li><p>Your <code>emptyPhonebook</code> actually is not empty: indeed you have defined one tuple in it: the one with an empty string as both the name and the phone number. You can correct this to:</p>\n\n<pre><code>emptyPhonebook :: Phonebook\nemptyPhonebook = []\n</code></pre></li>\n<li><p>Your insertion method <code>insert</code> actually creates a <code>Phonebook</code> with one entry: the one you want to add, the remainder of the phonebook is ignored. You can use the CONS (<code>(:)</code>) function for this:</p>\n\n<pre><code>insert :: String -&gt; String -&gt; Phonebook -&gt; Phonebook\ninsert name number = (:) (name,number)\n</code></pre></li>\n</ul>\n\n<p>Now to answer the main question. First of all, most Haskell programmers consider <code>if</code> to be rather <em>un</em>-Haskell: in Haskell one uses <em>pattern matching</em> and <em>guards</em> to set constraints on rules.</p>\n\n<p>Since your search is probably supposed to error when it does not find a person with that name (you did not specify this), there are actually two code paths we have to consider:</p>\n\n<ul>\n<li>the one where we are given a non-empty list where the first element matches our search: in that case we return the corresponding number; and</li>\n<li>the one where the name does not match in which case we simply continue our search in th tail of the given list.</li>\n</ul>\n\n<p>These rules in Haskell look like:</p>\n\n<pre><code>search query ((name,number):other) = ...\n</code></pre>\n\n<p>Now in case <code>query</code> and <code>name</code> match, we thus should return the number so:</p>\n\n<pre><code>search query ((name,number):other) | query == name = number\n</code></pre>\n\n<p>In the other case, we recursively continue our noble quest:</p>\n\n<pre><code>search query ((name,number):other) | otherwise = search query other\n</code></pre>\n\n<p>So putting it together, you get:</p>\n\n<pre><code>search :: String -&gt; Phonebook -&gt; String\nsearch query ((name,number):other) | query == name = number\n                                   | otherwise = search query other\n</code></pre>\n\n<p>This will return the number given it is in the phonebook, and otherwise error.</p>\n\n<p><strong>EDIT</strong>:</p>\n\n<p>Given you want to return <code>\"error\"</code> (as a string) when the search fails, you only have to add an additional rule:</p>\n\n<pre><code>search _ [] = \"error\"\n</code></pre>\n\n<p>So putting it all together gives:</p>\n\n<pre><code>search :: String -&gt; Phonebook -&gt; String\nsearch query ((name,number):other) | query == name = number\n                                   | otherwise = search query other\nsearch _     [] = \"error\"\n</code></pre>\n"}, {"tags": [], "owner": {"reputation": 494, "user_id": 5447207, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/d96199ece7ba3bc4f3c1d97d645f5fad?s=128&d=identicon&r=PG", "display_name": "Bargros", "link": "https://stackoverflow.com/users/5447207/bargros"}, "is_accepted": false, "score": 0, "last_activity_date": 1486718024, "last_edit_date": 1486718024, "creation_date": 1484872217, "answer_id": 41754146, "question_id": 41749542, "link": "https://stackoverflow.com/questions/41749542/haskell-create-a-phonebook-as-a-list-of-tuples/41754146#41754146", "title": "Haskell create a Phonebook as a list of tuples", "body": "<p>As already mentioned your insert function is incomplete, otherwise no matter what you try to insert to it it'll only have 1 record, so if you try to search for a specific contact in your phonebook it'll only retrieve the only 1. But I won't answer that as that has already been answered.</p>\n\n<p>Then just apply simple recursion over your phonebook</p>\n\n<pre><code>search :: String -&gt; Phonebook -&gt; String\nsearch name ((contactName, contactNumber):phonebook) = if contactName == name then contactNumber else search name phonebook \n</code></pre>\n\n<p>or you can use filter</p>\n\n<pre><code>search :: String -&gt; Phonebook -&gt; String\nsearch name phonebook = snd . head . filter ((==name) . fst) $ phonebook\n</code></pre>\n\n<p>The only problem with the second option that it will retrieve the first contact with the same name and it might not be the one we're querying for, a solution to this would be to use <code>Either String phonebook</code> as the return type if there is more than one individual with the same name, so this:</p>\n\n<pre><code>search :: String -&gt; Phonebook -&gt; Either String phonebook\nsearch name phonebook = let getContacts nm contacts = filter ((==nm) . fst) $ contacts\n                    in case (length $ getContacts name phonebook) == 1 of\n                             True -&gt; Left $ snd . head . getContacts name $ phonebook\n                             False -&gt; Right $ (getContacts name) $ phonebook\n</code></pre>\n\n<p>Ignore the last one, is untested and I don't think is exactly what you want, I just added this just in case as extra.</p>\n"}], "owner": {"reputation": 37, "user_id": 7442604, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/58fcce2425f6509e1fe489a8febf9442?s=128&d=identicon&r=PG&f=1", "display_name": "J.Dean", "link": "https://stackoverflow.com/users/7442604/j-dean"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 373, "favorite_count": 0, "answer_count": 2, "score": 1, "last_activity_date": 1486718024, "creation_date": 1484852045, "last_edit_date": 1484852529, "question_id": 41749542, "link": "https://stackoverflow.com/questions/41749542/haskell-create-a-phonebook-as-a-list-of-tuples", "title": "Haskell create a Phonebook as a list of tuples", "body": "<p>I need to create a phonebook as a list of tuples:</p>\n\n<pre><code>type Phonebook :: [(String,String)]\n</code></pre>\n\n<p>As you can see in the code, the first element should represent the name and the second element the number. So the result of</p>\n\n<pre><code>Main&gt; phonebookone = insert \"Dad\" \"90213\" (insert \"mum\" \"8912\" emptyPhonebook)\nMain&gt; phonebookone\n</code></pre>\n\n<p>should be <code>[(\"Dad\",\"90213\"),(\"mum\",\"8912\")]</code> but I only get <code>[(\"Dad\",\"90213\")]</code></p>\n\n<p>My code:</p>\n\n<pre><code>emptyPhonebook :: Phonebook\nemptyPhonebook = [(\"\",\"\")]\n\ninsert :: String -&gt; String -&gt; Phonebook -&gt; Phonebook\ninsert name number phonebook = [(name,number)]\n</code></pre>\n\n<p>Also i need to create a function <code>search</code>, which search for numbers or better if the first element of a tuple exists in the list and is the same like the String, who you search for, it will result the second element of the tuple.</p>\n\n<p>So it should be:</p>\n\n<pre><code>Main&gt; search \"Dad\" phonebook\n\"90213\"\n</code></pre>\n\n<p>My unfinished code for this:</p>\n\n<pre><code>search :: String -&gt; Phonebook -&gt; String\nsearch name phonebook = if ..???\n</code></pre>\n"}, {"tags": ["haskell", "haskell-stack", "stackage"], "comments": [{"owner": {"reputation": 3231, "user_id": 1013393, "user_type": "registered", "accept_rate": 60, "profile_image": "https://www.gravatar.com/avatar/7bca51e5ae3eb8dc24a98616b4e5d6fd?s=128&d=identicon&r=PG", "display_name": "sjakobi", "link": "https://stackoverflow.com/users/1013393/sjakobi"}, "edited": false, "score": 1, "creation_date": 1484849567, "post_id": 41748468, "comment_id": 70690114, "body": "I think this can be done with a bit of work. Here are a few relevant links: <a href=\"https://docs.haskellstack.org/en/stable/yaml_configuration/#urls\" rel=\"nofollow noreferrer\">docs.haskellstack.org/en/stable/yaml_configuration/#urls</a>, <a href=\"https://docs.haskellstack.org/en/stable/yaml_configuration/#setup-info\" rel=\"nofollow noreferrer\">docs.haskellstack.org/en/stable/yaml_configuration/#setup-in&zwnj;&#8203;fo</a>. Packages are usually downloaded from <a href=\"https://s3.amazonaws.com/hackage.fpcomplete.com\" rel=\"nofollow noreferrer\">s3.amazonaws.com/hackage.fpcomplete.com</a>, but I think it would only take a small patch to make that configurable."}, {"owner": {"reputation": 3231, "user_id": 1013393, "user_type": "registered", "accept_rate": 60, "profile_image": "https://www.gravatar.com/avatar/7bca51e5ae3eb8dc24a98616b4e5d6fd?s=128&d=identicon&r=PG", "display_name": "sjakobi", "link": "https://stackoverflow.com/users/1013393/sjakobi"}, "edited": false, "score": 1, "creation_date": 1484850725, "post_id": 41748468, "comment_id": 70690718, "body": "To increase your reach you could also post to <a href=\"https://groups.google.com/forum/#!forum/haskell-stack\" rel=\"nofollow noreferrer\">groups.google.com/forum/#!forum/haskell-stack</a> and <a href=\"https://groups.google.com/forum/#!forum/stackage\" rel=\"nofollow noreferrer\">groups.google.com/forum/#!forum/stackage</a>."}, {"owner": {"reputation": 101, "user_id": 7253660, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/0b37834f84248e284269093f343304b5?s=128&d=identicon&r=PG&f=1", "display_name": "dpacbach", "link": "https://stackoverflow.com/users/7253660/dpacbach"}, "reply_to_user": {"reputation": 3231, "user_id": 1013393, "user_type": "registered", "accept_rate": 60, "profile_image": "https://www.gravatar.com/avatar/7bca51e5ae3eb8dc24a98616b4e5d6fd?s=128&d=identicon&r=PG", "display_name": "sjakobi", "link": "https://stackoverflow.com/users/1013393/sjakobi"}, "edited": false, "score": 0, "creation_date": 1484935503, "post_id": 41748468, "comment_id": 70730937, "body": "@sjakobi Thanks -- I&#39;ll post to those groups as well."}], "owner": {"reputation": 101, "user_id": 7253660, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/0b37834f84248e284269093f343304b5?s=128&d=identicon&r=PG&f=1", "display_name": "dpacbach", "link": "https://stackoverflow.com/users/7253660/dpacbach"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 211, "favorite_count": 3, "answer_count": 0, "score": 6, "last_activity_date": 1484853897, "creation_date": 1484848287, "last_edit_date": 1484853897, "question_id": 41748468, "link": "https://stackoverflow.com/questions/41748468/haskell-stack-local-server", "title": "Haskell Stack Local Server", "body": "<p>I am behind a firewall with strict rules about downloading software from the internet, so I would like to know if it is possible to download an entire stackage LTS snapshot in one go and serve it on a local server, to which we could then point the stack tool.</p>\n\n<p>By \"snapshot\" I would be referring to the source code for all packages because ideally we'd need to draw from that local server to build on multiple (stack-supported) platforms (Linux, Windows).</p>\n\n<p>For example, it would be nice to be able to go to a new machine within the firewall, then run \"stack new\", then edit the yaml file to point it to a local stackage server with given resolver number, then it would just behave normally from then on, except always downloading packages from the local server.</p>\n\n<p>What about compilers?  I know that stack also downloads the compilers, so I guess those would have to be included in the downloaded snapshot-package for various platforms right?</p>\n\n<p>Thank you</p>\n"}, {"tags": ["list", "haskell", "pattern-matching"], "comments": [{"owner": {"reputation": 14582, "user_id": 2225384, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/f30b04ed4d0b3fc4bc791a28815f34ca?s=128&d=identicon&r=PG", "display_name": "Rein Henrichs", "link": "https://stackoverflow.com/users/2225384/rein-henrichs"}, "edited": false, "score": 1, "creation_date": 1484859595, "post_id": 41747644, "comment_id": 70695625, "body": "You can&#39;t define functions that start with a capital letter. That is reserved for data constructors. Your indentation will also cause a syntax error. In the future, please paste your actual, compiling code verbatim."}], "answers": [{"comments": [{"owner": {"reputation": 113, "user_id": 7200922, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/c9yJO.jpg?s=128&g=1", "display_name": "Fireapprentice", "link": "https://stackoverflow.com/users/7200922/fireapprentice"}, "edited": false, "score": 0, "creation_date": 1484845840, "post_id": 41747719, "comment_id": 70688066, "body": "I tried that, by adding   &quot; patternFinder n [] = xs&quot; , however I always got variable not in scope..."}, {"owner": {"reputation": 113, "user_id": 7200922, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/c9yJO.jpg?s=128&g=1", "display_name": "Fireapprentice", "link": "https://stackoverflow.com/users/7200922/fireapprentice"}, "edited": false, "score": 0, "creation_date": 1484845930, "post_id": 41747719, "comment_id": 70688124, "body": "Must be a problem, which relates to me first emptying the list and then trying to write in it again, however I don&#39;t know how to solve that problem ..."}, {"owner": {"reputation": 113, "user_id": 7200922, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/c9yJO.jpg?s=128&g=1", "display_name": "Fireapprentice", "link": "https://stackoverflow.com/users/7200922/fireapprentice"}, "edited": false, "score": 0, "creation_date": 1484846010, "post_id": 41747719, "comment_id": 70688165, "body": "Ugh, dammit - still learning so I will try to work on that, but if I get those right it should work?"}, {"owner": {"reputation": 34669, "user_id": 34409, "user_type": "registered", "accept_rate": 64, "profile_image": "https://www.gravatar.com/avatar/4dfdadcd9bb62300eb1a54f02fe5dc18?s=128&d=identicon&r=PG", "display_name": "Chad Gilbert", "link": "https://stackoverflow.com/users/34409/chad-gilbert"}, "reply_to_user": {"reputation": 113, "user_id": 7200922, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/c9yJO.jpg?s=128&g=1", "display_name": "Fireapprentice", "link": "https://stackoverflow.com/users/7200922/fireapprentice"}, "edited": false, "score": 0, "creation_date": 1484846152, "post_id": 41747719, "comment_id": 70688232, "body": "I&#39;ve added an example that fixes your syntax errors but I&#39;m curious - did your example actually compile? And if so, what compiler are you using?"}, {"owner": {"reputation": 113, "user_id": 7200922, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/c9yJO.jpg?s=128&g=1", "display_name": "Fireapprentice", "link": "https://stackoverflow.com/users/7200922/fireapprentice"}, "edited": false, "score": 0, "creation_date": 1484846492, "post_id": 41747719, "comment_id": 70688384, "body": "yes it did, I am using geany, is there any other you could recommend?"}, {"owner": {"reputation": 113, "user_id": 7200922, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/c9yJO.jpg?s=128&g=1", "display_name": "Fireapprentice", "link": "https://stackoverflow.com/users/7200922/fireapprentice"}, "edited": false, "score": 0, "creation_date": 1484846683, "post_id": 41747719, "comment_id": 70688492, "body": "Oh and one more thing, isn&#39;t do used to execute several patterns (for example here in an if statement) where pattern matching is not possible (or is it)?"}, {"owner": {"reputation": 34669, "user_id": 34409, "user_type": "registered", "accept_rate": 64, "profile_image": "https://www.gravatar.com/avatar/4dfdadcd9bb62300eb1a54f02fe5dc18?s=128&d=identicon&r=PG", "display_name": "Chad Gilbert", "link": "https://stackoverflow.com/users/34409/chad-gilbert"}, "reply_to_user": {"reputation": 113, "user_id": 7200922, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/c9yJO.jpg?s=128&g=1", "display_name": "Fireapprentice", "link": "https://stackoverflow.com/users/7200922/fireapprentice"}, "edited": false, "score": 0, "creation_date": 1484846700, "post_id": 41747719, "comment_id": 70688503, "body": "Industry standard is GHC. I&#39;ve never heard of geany and if it accepts otherwise-invalid Haskell code like you posted, I&#39;d strongly advise against it because there is little community support. I&#39;d recommend <a href=\"https://docs.haskellstack.org\" rel=\"nofollow noreferrer\">Stack</a> for the easiest platform (it uses GHC but is easiest to get started with)"}, {"owner": {"reputation": 34669, "user_id": 34409, "user_type": "registered", "accept_rate": 64, "profile_image": "https://www.gravatar.com/avatar/4dfdadcd9bb62300eb1a54f02fe5dc18?s=128&d=identicon&r=PG", "display_name": "Chad Gilbert", "link": "https://stackoverflow.com/users/34409/chad-gilbert"}, "reply_to_user": {"reputation": 113, "user_id": 7200922, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/c9yJO.jpg?s=128&g=1", "display_name": "Fireapprentice", "link": "https://stackoverflow.com/users/7200922/fireapprentice"}, "edited": false, "score": 0, "creation_date": 1484846754, "post_id": 41747719, "comment_id": 70688528, "body": "<code>do</code> is not for pattern matching. It is <a href=\"https://en.wikibooks.org/wiki/Haskell/do_notation\" rel=\"nofollow noreferrer\">syntactic sugar for monad binding functions</a>"}, {"owner": {"reputation": 113, "user_id": 7200922, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/c9yJO.jpg?s=128&g=1", "display_name": "Fireapprentice", "link": "https://stackoverflow.com/users/7200922/fireapprentice"}, "edited": false, "score": 0, "creation_date": 1484846766, "post_id": 41747719, "comment_id": 70688539, "body": "Thanks for the great help :D"}], "tags": [], "owner": {"reputation": 34669, "user_id": 34409, "user_type": "registered", "accept_rate": 64, "profile_image": "https://www.gravatar.com/avatar/4dfdadcd9bb62300eb1a54f02fe5dc18?s=128&d=identicon&r=PG", "display_name": "Chad Gilbert", "link": "https://stackoverflow.com/users/34409/chad-gilbert"}, "is_accepted": false, "score": 2, "last_activity_date": 1484846120, "last_edit_date": 1484846120, "creation_date": 1484845770, "answer_id": 41747719, "question_id": 41747644, "link": "https://stackoverflow.com/questions/41747644/haskell-error-non-exhausive-patterns-in-function/41747719#41747719", "title": "Haskell error: Non-exhausive patterns in function", "body": "<p>You are not the case of the second argument being the empty list. In order to be exhaustive, you have to handle this pattern:</p>\n\n\n\n<pre class=\"lang-hs prettyprint-override\"><code>patternFinder n []\n</code></pre>\n\n<p>You've also got other syntax errors. Function names must start with a lowercase letter, signatures are separated by <code>-&gt;</code>, not <code>,</code>, and you don't need a <code>do</code> statement because you're not in a monad context. It should probably look more like this:</p>\n\n<pre class=\"lang-hs prettyprint-override\"><code>patternFinder :: String -&gt; [(String, String)] -&gt; [(String, String)]\npatternFinder n [] = []\npatternFinder n ((b,a) : xs) = \n    if patternFits n a\n    then (b,a) : xs\n    else patternFinder n xs\n</code></pre>\n"}, {"comments": [{"owner": {"reputation": 113, "user_id": 7200922, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/c9yJO.jpg?s=128&g=1", "display_name": "Fireapprentice", "link": "https://stackoverflow.com/users/7200922/fireapprentice"}, "edited": false, "score": 0, "creation_date": 1484851811, "post_id": 41748964, "comment_id": 70691325, "body": "Wow this is well explained and I was actually trying to figure out how this works right now - thanks for the good help :)"}], "tags": [], "owner": {"reputation": 1392, "user_id": 5198575, "user_type": "registered", "profile_image": "https://lh6.googleusercontent.com/-RAYCSjVZdnQ/AAAAAAAAAAI/AAAAAAAAClo/VQ8V_H3l8O8/photo.jpg?sz=128", "display_name": "trevor cook", "link": "https://stackoverflow.com/users/5198575/trevor-cook"}, "is_accepted": true, "score": 2, "last_activity_date": 1484859394, "last_edit_date": 1484859394, "creation_date": 1484850000, "answer_id": 41748964, "question_id": 41747644, "link": "https://stackoverflow.com/questions/41747644/haskell-error-non-exhausive-patterns-in-function/41748964#41748964", "title": "Haskell error: Non-exhausive patterns in function", "body": "<p>From the text of your question, it seems like you want a simple filter based on the second term of each pair.</p>\n\n<pre><code>patternFinder n = filter (patternFits n . snd)\n</code></pre>\n\n<p>As an illustration of how this works. </p>\n\n<pre><code>filter ((==1) . snd) [('a',1),('b',2),('c',1)]\n</code></pre>\n\n<p>returns <code>[('a',1),('c',1)]</code></p>\n\n<p>In Chad Gilberts answer, however, there is no recursion in the then clause:</p>\n\n<pre><code>if patternFits n a\nthen (b,a) : xs\nelse patternFinder n xs\n</code></pre>\n\n<p>This will return the suffix of the list after the first match. If this is the intended behavior, you could use instead:</p>\n\n<pre><code>patternFinder n = dropwhile (not . patternFits n . snd)\n</code></pre>\n\n<p>As an example of this:</p>\n\n<pre><code>dropWhile (not . (==2) . snd) [('a',1),('b',2),('c',1)]\n</code></pre>\n\n<p>returns <code>[('b',2),('c',1)]</code></p>\n\n<p>Also, in the text of your question you require that the list you entered will be empty. Note that these functions do nothing to the original list but return new lists. </p>\n"}], "owner": {"reputation": 113, "user_id": 7200922, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/c9yJO.jpg?s=128&g=1", "display_name": "Fireapprentice", "link": "https://stackoverflow.com/users/7200922/fireapprentice"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 52, "favorite_count": 0, "accepted_answer_id": 41748964, "answer_count": 2, "score": 0, "last_activity_date": 1484859394, "creation_date": 1484845556, "last_edit_date": 1484852297, "question_id": 41747644, "link": "https://stackoverflow.com/questions/41747644/haskell-error-non-exhausive-patterns-in-function", "title": "Haskell error: Non-exhausive patterns in function", "body": "<p>I am trying to implement a list, which searches for a certain pattern in a Tuple (goes through the list of Tuples, empties this and then writes those in, which match the pattern) in the end the list I entered will be empty and then it writes the matching Tuples in this list. </p>\n\n<p>(The functions used do all work - the mistake is in this part)</p>\n\n<pre><code>PatternFinder :: String -&gt; [(String, String)] , [(String, String)]\nPatternFinder = n ((b,a) : xs) = \nif PatternFits n a\nthen do \n PatternFinder n xs\n (b,a) : xs\nelse PatternFinder n xs\n</code></pre>\n"}, {"tags": ["haskell", "data-structures", "lazy-evaluation"], "comments": [{"owner": {"reputation": 100185, "user_id": 3234959, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/93bb12ca0f93dfddb33880316f7e66c2?s=128&d=identicon&r=PG&f=1", "display_name": "chi", "link": "https://stackoverflow.com/users/3234959/chi"}, "edited": false, "score": 4, "creation_date": 1484839168, "post_id": 41744953, "comment_id": 70683480, "body": "I think this should be read as &quot;evaluated <i>at least</i> to WHNF&quot;. They will be evaluated more than that according to their <code>Ord</code> instance, I guess."}, {"owner": {"reputation": 15757, "user_id": 176841, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/45a168cb9eb8454d66c78f18e29d9342?s=128&d=identicon&r=PG", "display_name": "jberryman", "link": "https://stackoverflow.com/users/176841/jberryman"}, "edited": false, "score": 0, "creation_date": 1484839223, "post_id": 41744953, "comment_id": 70683531, "body": "I agree ^ see: <a href=\"https://hackage.haskell.org/package/containers-0.5.9.1/docs/src/Data.Set.Internal.html#insert\" rel=\"nofollow noreferrer\">hackage.haskell.org/package/containers-0.5.9.1/docs/src/&hellip;</a>"}], "answers": [{"tags": [], "owner": {"reputation": 24266, "user_id": 946226, "user_type": "registered", "accept_rate": 59, "profile_image": "https://www.gravatar.com/avatar/5823d09208b1e4b63bbfcd189492032c?s=128&d=identicon&r=PG", "display_name": "Joachim Breitner", "link": "https://stackoverflow.com/users/946226/joachim-breitner"}, "is_accepted": true, "score": 6, "last_activity_date": 1484844526, "creation_date": 1484844526, "answer_id": 41747300, "question_id": 41744953, "link": "https://stackoverflow.com/questions/41744953/why-is-evaluating-keys-to-whnfs-enough-to-construct-sets-in-haskell/41747300#41747300", "title": "Why is evaluating keys to WHNFs enough to construct Sets in Haskell?", "body": "<p>To expand on @chi\u2019s comment: This only means that keys are at least evaluated to WHNF. Often, they might be evaluated always once they are compared, but not always. Let\u2019s invoke <a href=\"http://felsin9.de/nnis/ghc-vis/\"><code>ghc-heap-view</code></a> and look at a few examples:</p>\n\n<p>Prelimaries:</p>\n\n<pre><code>~ $ ghci\nGHCi, version 8.0.1: http://www.haskell.org/ghc/  :? for help\nPrelude&gt; :script /home/jojo/.cabal/share/x86_64-linux-ghc-8.0.1/ghc-heap-view-0.5.7/ghci\nPrelude&gt; import qualified Data.Set as S\n</code></pre>\n\n<p><code>singleton</code> does not fully evaluate its argument (the <code>_bco</code> is a thunk):</p>\n\n<pre><code>Prelude S&gt; let t = [True, True &amp;&amp; True] -- a thunk in a list\nPrelude S&gt; let s1 = S.singleton t\nPrelude S&gt; s1 `seq` ()\n()\nPrelude S&gt; :printHeap s1\nlet x1 = True()\n    x2 = Tip()\nin Bin [x1,(_bco _fun)()] x2 x2 1\n</code></pre>\n\n<p>And even inserting another element will not fully evaluate the second elements in the list, as they can be distinguished already by looking at the first element:</p>\n\n<pre><code>Prelude S&gt; let t2 = [False, False &amp;&amp; False] -- a thunk in another  list\nPrelude S&gt; let s2 = S.insert t2 s1\nPrelude S&gt; s2 `seq` ()\n()\nPrelude S&gt; :printHeap s2\nlet x1 = True()\n    x2 = toArray (0 words) \n    f1 = _fun\n    x3 = []\n    x4 = False()\n    x5 = Tip()\nin Bin (x1 : (_bco f1)() : x3) (Bin (x4 : (_bco f1)() : x3) x5 x5 1) x5 2\n</code></pre>\n\n<p>But inserting <code>t2</code> again will now force the second element of that list:</p>\n\n<pre><code>Prelude S&gt; let s3 = S.insert t2 s2\nPrelude S&gt; s3 `seq` ()\n()\nPrelude S&gt; :printHeap s3\nlet x1 = True()\n    x2 = []\n    x3 = False()\n    x4 = Tip()\nin Bin (x1 : (_bco _fun)() : x2) (Bin (x3 : _bh x3 : x2) x4 x4 1) x4 2\n</code></pre>\n\n<p>So you cannot rely on <code>Data.Set</code> to evaluate the keys fully as you store them. If you want that, you need to use, for example, <code>(singleton $!! t1)</code> and <code>(insert $!! t2)</code>.</p>\n\n<p>(If someone wants to replace the <code>ghc-heap-view</code> output in this answer with <a href=\"http://felsin9.de/nnis/ghc-vis/\"><code>ghc-vis</code></a> graphs, feel free to do so :-)).</p>\n"}, {"tags": [], "owner": {"reputation": 34889, "user_id": 86604, "user_type": "registered", "accept_rate": 80, "profile_image": "https://www.gravatar.com/avatar/329af917389e6cf8e146c03012f5319a?s=128&d=identicon&r=PG", "display_name": "Ingo", "link": "https://stackoverflow.com/users/86604/ingo"}, "is_accepted": false, "score": 1, "last_activity_date": 1484859850, "last_edit_date": 1484859850, "creation_date": 1484859433, "answer_id": 41751561, "question_id": 41744953, "link": "https://stackoverflow.com/questions/41744953/why-is-evaluating-keys-to-whnfs-enough-to-construct-sets-in-haskell/41751561#41751561", "title": "Why is evaluating keys to WHNFs enough to construct Sets in Haskell?", "body": "<p>There may be data types usable as keys that don't need to  evaluate everything they contain to determine equality or order. Lists are no such types, of course.</p>\n\n<p>However, while lists must be fully evaluated to find equality, they don't necessary need to in order to find non-equality. That is, we wouldn't expect that</p>\n\n<pre><code>[1..] == [2..]\n</code></pre>\n\n<p>computes forever. Likewise with</p>\n\n<pre><code>[] == [(40+2)..]\n</code></pre>\n\n<p>Here it is enough to get WHNF of the second list to find that it is not equal to the first one. We need not bother to compute <code>40+2</code>, much less the succeeding elements.</p>\n"}], "owner": {"reputation": 95, "user_id": 4342337, "user_type": "registered", "accept_rate": 75, "profile_image": "https://i.stack.imgur.com/X6GXo.png?s=128&g=1", "display_name": "raviqqe", "link": "https://stackoverflow.com/users/4342337/raviqqe"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 195, "favorite_count": 0, "accepted_answer_id": 41747300, "answer_count": 2, "score": 6, "last_activity_date": 1484859850, "creation_date": 1484837941, "question_id": 41744953, "link": "https://stackoverflow.com/questions/41744953/why-is-evaluating-keys-to-whnfs-enough-to-construct-sets-in-haskell", "title": "Why is evaluating keys to WHNFs enough to construct Sets in Haskell?", "body": "<p><a href=\"https://hackage.haskell.org/package/containers-0.5.9.1/docs/Data-Set.html\" rel=\"noreferrer\">Haskell's Data.Set page</a> says:</p>\n\n<blockquote>\n  <p>Key arguments are evaluated to WHNF</p>\n</blockquote>\n\n<p>in its \"Strictness properties\" section.</p>\n\n<p>However, I wonder why WHNF is enough to construct Sets. For example, to construct an instance of <code>Set [Int]</code>, we must evaluate its elements of Lists of Ints deeply to compare them.</p>\n"}, {"tags": ["performance", "haskell", "monads", "unboxing"], "comments": [{"owner": {"reputation": 31243, "user_id": 2751851, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/4ddc0.png?s=128&g=1", "display_name": "duplode", "link": "https://stackoverflow.com/users/2751851/duplode"}, "edited": false, "score": 1, "creation_date": 1484833896, "post_id": 41743198, "comment_id": 70679599, "body": "The lack of the instance for <code>U.Vector</code> has to do with the <code>Unbox</code> constraint on the elements. See <a href=\"http://stackoverflow.com/q/36322904/2751851\"><i>Why are unboxed arrays not an instance of foldable?</i></a> (the answer, by Snoyman, also includes some relevant comments about <i>mono-traversable</i>)."}, {"owner": {"reputation": 100892, "user_id": 745903, "user_type": "registered", "accept_rate": 74, "profile_image": "https://www.gravatar.com/avatar/50933f6638836741e620669b3940410e?s=128&d=identicon&r=PG", "display_name": "leftaroundabout", "link": "https://stackoverflow.com/users/745903/leftaroundabout"}, "reply_to_user": {"reputation": 31243, "user_id": 2751851, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/4ddc0.png?s=128&g=1", "display_name": "duplode", "link": "https://stackoverflow.com/users/2751851/duplode"}, "edited": false, "score": 3, "creation_date": 1484835689, "post_id": 41743198, "comment_id": 70680863, "body": "Sure, but that&#39;s not what I&#39;m asking about. I don&#39;t need an actual <code>Traversable</code> instance, I just need an efficient traversal! And <code>mono-traversable</code> doesn&#39;t offer this."}, {"owner": {"reputation": 31243, "user_id": 2751851, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/4ddc0.png?s=128&g=1", "display_name": "duplode", "link": "https://stackoverflow.com/users/2751851/duplode"}, "edited": false, "score": 0, "creation_date": 1484838056, "post_id": 41743198, "comment_id": 70682653, "body": "Oops -- I didn&#39;t notice the &quot;obviously&quot; in your first paragraph :)"}, {"owner": {"reputation": 14582, "user_id": 2225384, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/f30b04ed4d0b3fc4bc791a28815f34ca?s=128&d=identicon&r=PG", "display_name": "Rein Henrichs", "link": "https://stackoverflow.com/users/2225384/rein-henrichs"}, "edited": false, "score": 0, "creation_date": 1484851927, "post_id": 41743198, "comment_id": 70691391, "body": "Hmm... If it fuses reliably then I suppose there&#39;s not much incentive to look for a different--presumably harder, if not impossible--solution."}, {"owner": {"reputation": 14485, "user_id": 190376, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/cd8280c5e1491b8cf55760750ed97dec?s=128&d=identicon&r=PG", "display_name": "Reid Barton", "link": "https://stackoverflow.com/users/190376/reid-barton"}, "edited": false, "score": 0, "creation_date": 1484855240, "post_id": 41743198, "comment_id": 70693167, "body": "There seems to be an implicit assumption here that the <code>Traversable</code> instances for records with many fields are &quot;efficient&quot; in some sense. In fact I wouldn&#39;t be surprised if traversing a 100-element vector (with the above implementation that converts to and from lists) was cheaper than the derived instance for a record with 100 fields, at least for certain monads."}, {"owner": {"reputation": 100892, "user_id": 745903, "user_type": "registered", "accept_rate": 74, "profile_image": "https://www.gravatar.com/avatar/50933f6638836741e620669b3940410e?s=128&d=identicon&r=PG", "display_name": "leftaroundabout", "link": "https://stackoverflow.com/users/745903/leftaroundabout"}, "reply_to_user": {"reputation": 14485, "user_id": 190376, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/cd8280c5e1491b8cf55760750ed97dec?s=128&d=identicon&r=PG", "display_name": "Reid Barton", "link": "https://stackoverflow.com/users/190376/reid-barton"}, "edited": false, "score": 0, "creation_date": 1484856179, "post_id": 41743198, "comment_id": 70693750, "body": "@ReidBarton aha... whence do you infer that implicit assumption? I didn&#39;t have any thought about records with many fields here."}, {"owner": {"reputation": 14485, "user_id": 190376, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/cd8280c5e1491b8cf55760750ed97dec?s=128&d=identicon&r=PG", "display_name": "Reid Barton", "link": "https://stackoverflow.com/users/190376/reid-barton"}, "edited": false, "score": 0, "creation_date": 1484865439, "post_id": 41743198, "comment_id": 70698522, "body": "Well I guess I don&#39;t understand the question. It&#39;s obviously possible to traverse an array, since the code you pasted does it. There must be some other constraint... but what?"}, {"owner": {"reputation": 28873, "user_id": 1068232, "user_type": "registered", "accept_rate": 79, "profile_image": "https://www.gravatar.com/avatar/2a0a145ce58c20013969fe3f203531da?s=128&d=identicon&r=PG", "display_name": "Andr&#225;s Kov&#225;cs", "link": "https://stackoverflow.com/users/1068232/andr%c3%a1s-kov%c3%a1cs"}, "reply_to_user": {"reputation": 14485, "user_id": 190376, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/cd8280c5e1491b8cf55760750ed97dec?s=128&d=identicon&r=PG", "display_name": "Reid Barton", "link": "https://stackoverflow.com/users/190376/reid-barton"}, "edited": false, "score": 0, "creation_date": 1484868154, "post_id": 41743198, "comment_id": 70699568, "body": "@ReidBarton traversing without creating an intermediate list, for example? Mutable arrays + <code>unsafeDupablePerformIO</code> + <code>unsafeFreeze</code> could do it, I think."}, {"owner": {"reputation": 28873, "user_id": 1068232, "user_type": "registered", "accept_rate": 79, "profile_image": "https://www.gravatar.com/avatar/2a0a145ce58c20013969fe3f203531da?s=128&d=identicon&r=PG", "display_name": "Andr&#225;s Kov&#225;cs", "link": "https://stackoverflow.com/users/1068232/andr%c3%a1s-kov%c3%a1cs"}, "reply_to_user": {"reputation": 14485, "user_id": 190376, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/cd8280c5e1491b8cf55760750ed97dec?s=128&d=identicon&r=PG", "display_name": "Reid Barton", "link": "https://stackoverflow.com/users/190376/reid-barton"}, "edited": false, "score": 0, "creation_date": 1484868755, "post_id": 41743198, "comment_id": 70699737, "body": "@ReidBarton on a second though, it&#39;s no good, for example we can&#39;t use destructive update when we traverse in the list applicative."}], "answers": [{"tags": [], "owner": {"reputation": 2226, "user_id": 2246434, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/bTuEI.jpg?s=128&g=1", "display_name": "Julia Path", "link": "https://stackoverflow.com/users/2246434/julia-path"}, "is_accepted": false, "score": 2, "last_activity_date": 1484873636, "last_edit_date": 1484873636, "creation_date": 1484871066, "answer_id": 41753975, "question_id": 41743198, "link": "https://stackoverflow.com/questions/41743198/why-is-it-impossible-to-applicative-traverse-arrays-or-is-it/41753975#41753975", "title": "Why is it impossible to Applicative-traverse arrays? (Or is it?)", "body": "<p>After reading through the relevant source of <code>vector</code> and trying to make <code>mapM</code> work with <code>Applicative</code> I think the reason why <code>Data.Vector.Unboxed.Vector</code> doesn't have a <code>traverse :: (Applicative f, Unbox a, Unbox b) -&gt; (a -&gt; f b) -&gt; Vector a -&gt; f (Vector b)</code> function and <code>Data.Vector.Vector</code> doesn't have a native <code>traverse</code> is the fusion code. The offender is the following <code>Stream</code> type:</p>\n\n<pre><code>-- Data/Vector/Fusion/Stream/Monadic.hs  Line: 137\n\n-- | Result of taking a single step in a stream\ndata Step s a where\n  Yield :: a -&gt; s -&gt; Step s a\n  Skip  :: s -&gt; Step s a\n  Done  :: Step s a\n\n-- | Monadic streams\ndata Stream m a = forall s. Stream (s -&gt; m (Step s a)) s\n</code></pre>\n\n<p>This is used internally to implement <code>mapM</code>. The <code>m</code> will be the same as from your initial call to <code>Data.Vector.Unboxed.mapM</code>. But because the spine of this stream is inside the <code>m</code> functor, it is not possible to work with it if you only have an applicative for <code>m</code>.</p>\n\n<p>See also this issue on the <code>vector</code> GitHub repo: <a href=\"https://github.com/haskell/vector/issues/132\" rel=\"nofollow noreferrer\">Weaken constraint on mapM</a>.</p>\n\n<p>Disclaimer: I don't really know how fusion works. I don't know how <code>vector</code> works.</p>\n"}], "owner": {"reputation": 100892, "user_id": 745903, "user_type": "registered", "accept_rate": 74, "profile_image": "https://www.gravatar.com/avatar/50933f6638836741e620669b3940410e?s=128&d=identicon&r=PG", "display_name": "leftaroundabout", "link": "https://stackoverflow.com/users/745903/leftaroundabout"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 245, "favorite_count": 2, "answer_count": 1, "score": 11, "last_activity_date": 1484873636, "creation_date": 1484833207, "question_id": 41743198, "link": "https://stackoverflow.com/questions/41743198/why-is-it-impossible-to-applicative-traverse-arrays-or-is-it", "title": "Why is it impossible to Applicative-traverse arrays? (Or is it?)", "body": "<p>While pondering how to best map, i.e. <code>traverse</code>, an <code>a -&gt; Maybe a</code>-Kleisli over an <a href=\"http://hackage.haskell.org/package/vector-0.12.0.0/docs/Data-Vector-Unboxed.html#t:Vector\">unboxed vector</a>, I looked for an existing implementation. Obviously <code>U.Vector</code> is not <code>Traversable</code>, but <a href=\"http://hackage.haskell.org/package/vector-0.12.0.0/docs/Data-Vector-Unboxed.html#g:22\">it does supply a <code>mapM</code></a>, which for <code>Maybe</code> of course works just fine.</p>\n\n<p>But the question is: is the <code>Monad</code> constraint really needed? Well, it turns out that even <a href=\"http://hackage.haskell.org/package/vector-0.12.0.0/docs/src/Data.Vector.html#line-427\">boxed vectors cheat for the <code>Traversable</code> instance</a>: they really just traverse a <em>list</em>, which they convert from/to:</p>\n\n<pre><code>instance Traversable.Traversable Vector where\n  {-# INLINE traverse #-}\n  traverse f xs = Data.Vector.fromList Applicative.&lt;$&gt; Traversable.traverse f (toList xs)\n</code></pre>\n\n<p><code>mono-traversable</code> <a href=\"http://hackage.haskell.org/package/mono-traversable-1.0.1/docs/src/Data-MonoTraversable.html#line-998\">does the same thing also for unboxed vectors</a>; here this seems even more gruesome performance-wise.</p>\n\n<p>Now, I wouldn't be surprised if <code>vector</code> was actually able to fuse many of these hacked traversals into a far more efficient form, but still \u2013 there seems to be a fundamental problem, preventing us from implementing a traversal on an array right away. Is there any \u201cdeep reason\u201d for this inability?</p>\n"}, {"tags": ["haskell"], "comments": [{"owner": {"reputation": 314794, "user_id": 67579, "user_type": "registered", "accept_rate": 81, "profile_image": "https://i.stack.imgur.com/BJXub.png?s=128&g=1", "display_name": "Willem Van Onsem", "link": "https://stackoverflow.com/users/67579/willem-van-onsem"}, "edited": false, "score": 4, "creation_date": 1484833067, "post_id": 41743056, "comment_id": 70679059, "body": "Is this not simpy what you could do with an enum and use a function that maps it to ints if you want to do arithmetic on them?"}], "answers": [{"comments": [{"owner": {"reputation": 5139, "user_id": 705510, "user_type": "registered", "accept_rate": 89, "profile_image": "https://i.stack.imgur.com/7xrNQ.png?s=128&g=1", "display_name": "McBear Holden", "link": "https://stackoverflow.com/users/705510/mcbear-holden"}, "edited": false, "score": 0, "creation_date": 1484837509, "post_id": 41743793, "comment_id": 70682211, "body": "Is it possible to show a quick example of dependent type in use here? Indeed there are quite many values for the rank value."}, {"owner": {"reputation": 384463, "user_id": 1126841, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/fa05233b2357f8d11c22ef4cfc7bb85c?s=128&d=identicon&r=PG", "display_name": "chepner", "link": "https://stackoverflow.com/users/1126841/chepner"}, "reply_to_user": {"reputation": 5139, "user_id": 705510, "user_type": "registered", "accept_rate": 89, "profile_image": "https://i.stack.imgur.com/7xrNQ.png?s=128&g=1", "display_name": "McBear Holden", "link": "https://stackoverflow.com/users/705510/mcbear-holden"}, "edited": false, "score": 2, "creation_date": 1484838541, "post_id": 41743793, "comment_id": 70683024, "body": "It&#39;s possible, but not be me :) I was attempting to veil my ignorance by being vague."}, {"owner": {"reputation": 5139, "user_id": 705510, "user_type": "registered", "accept_rate": 89, "profile_image": "https://i.stack.imgur.com/7xrNQ.png?s=128&g=1", "display_name": "McBear Holden", "link": "https://stackoverflow.com/users/705510/mcbear-holden"}, "edited": false, "score": 0, "creation_date": 1484839860, "post_id": 41743793, "comment_id": 70684011, "body": "It&#39;s Okay. At least it&#39;s a good pointer. I&#39;ll dig a little deeper"}, {"owner": {"reputation": 62421, "user_id": 216164, "user_type": "registered", "accept_rate": 89, "profile_image": "https://www.gravatar.com/avatar/786f224adbe0784cdf7d0f15476061fe?s=128&d=identicon&r=PG", "display_name": "Thomas M. DuBuisson", "link": "https://stackoverflow.com/users/216164/thomas-m-dubuisson"}, "reply_to_user": {"reputation": 5139, "user_id": 705510, "user_type": "registered", "accept_rate": 89, "profile_image": "https://i.stack.imgur.com/7xrNQ.png?s=128&g=1", "display_name": "McBear Holden", "link": "https://stackoverflow.com/users/705510/mcbear-holden"}, "edited": false, "score": 0, "creation_date": 1484852492, "post_id": 41743793, "comment_id": 70691661, "body": "@osager and others.  For a refinement type example please see my answer using Liquid Haskell."}], "tags": [], "owner": {"reputation": 384463, "user_id": 1126841, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/fa05233b2357f8d11c22ef4cfc7bb85c?s=128&d=identicon&r=PG", "display_name": "chepner", "link": "https://stackoverflow.com/users/1126841/chepner"}, "is_accepted": false, "score": 8, "last_activity_date": 1484834882, "creation_date": 1484834882, "answer_id": 41743793, "question_id": 41743056, "link": "https://stackoverflow.com/questions/41743056/how-to-limit-a-int-field-to-a-range-of-values/41743793#41743793", "title": "How to limit a Int field to a range of values?", "body": "<p>For something so small, you should define a precise type:</p>\n\n<pre><code>data Rank = RankNegOne | RankOne | RankThree  -- There are probably better names\ndata User = User { uRank :: Rank, uProgress :: Int }\n</code></pre>\n\n<p>Haskell doesn't force you to encode everything as a subset of the integers; take advantage of it!</p>\n\n<p>For larger subsets where this would be unwieldy, you are looking for a <em>dependent type</em>, which (until recently?) is not supported by Haskell directly.</p>\n"}, {"comments": [{"owner": {"reputation": 1392, "user_id": 5198575, "user_type": "registered", "profile_image": "https://lh6.googleusercontent.com/-RAYCSjVZdnQ/AAAAAAAAAAI/AAAAAAAAClo/VQ8V_H3l8O8/photo.jpg?sz=128", "display_name": "trevor cook", "link": "https://stackoverflow.com/users/5198575/trevor-cook"}, "edited": false, "score": 2, "creation_date": 1484859770, "post_id": 41743896, "comment_id": 70695739, "body": "Smart constructors are often used in conjunction with module export lists: module MyMod(Rank,myRank) where.. will not export the constructor UnsafeMkRank, disallowing you from using it in other modules, in case you (or other users) ever forget how to make good Rank."}], "tags": [], "owner": {"reputation": 2567, "user_id": 3780203, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/b3f3f9ab585dc56fa27e203ce4eb27fd?s=128&d=identicon&r=PG&f=1", "display_name": "ephrion", "link": "https://stackoverflow.com/users/3780203/ephrion"}, "is_accepted": true, "score": 10, "last_activity_date": 1484835166, "creation_date": 1484835166, "answer_id": 41743896, "question_id": 41743056, "link": "https://stackoverflow.com/questions/41743056/how-to-limit-a-int-field-to-a-range-of-values/41743896#41743896", "title": "How to limit a Int field to a range of values?", "body": "<p>Defining a small sum type is the best answer for this specific question. You can also use <code>newtype</code> with smart constructors to achieve this effect. </p>\n\n<pre><code>newtype Rank = UnsafeMkRank { unRank :: Int }\n\nmkRank :: Int -&gt; Maybe Rank\nmkRank i \n    | i `elem` [-1, 1, 3] = Just (UnsafeMkRank i)\n    | otherwise = Nothing\n</code></pre>\n\n<p>Now, provided you only use the safe <code>mkRank</code> constructor, you can assume that your <code>Rank</code> values have the <code>Int</code> values you want.</p>\n"}, {"tags": [], "owner": {"reputation": 62421, "user_id": 216164, "user_type": "registered", "accept_rate": 89, "profile_image": "https://www.gravatar.com/avatar/786f224adbe0784cdf7d0f15476061fe?s=128&d=identicon&r=PG", "display_name": "Thomas M. DuBuisson", "link": "https://stackoverflow.com/users/216164/thomas-m-dubuisson"}, "is_accepted": false, "score": 5, "last_activity_date": 1484853224, "last_edit_date": 1484853224, "creation_date": 1484852441, "answer_id": 41749649, "question_id": 41743056, "link": "https://stackoverflow.com/questions/41743056/how-to-limit-a-int-field-to-a-range-of-values/41749649#41749649", "title": "How to limit a Int field to a range of values?", "body": "<p>Liquid Haskell, which adds refinement types on top of Haskell, can do this.  See the correct section of the tutorial <a href=\"http://ucsd-progsys.github.io/liquidhaskell-tutorial/05-datatypes.html\" rel=\"nofollow noreferrer\">here</a>.</p>\n\n<p>First you define your data type as normal.</p>\n\n<pre><code>module User where\n\ndata User = User { uRank     :: Int\n                 , uProgress :: Int\n                 }\n</code></pre>\n\n<p>Next we define your restriction as a refinement type.  Liquid Haskell users comment annotations with syntax <code>{-@ blah @-}</code>.  We'll define your odd restriction of <code>-1, 1, 3</code> first with the <code>RestrictedInt</code> type:</p>\n\n<pre><code>{-@ type RestrictedInt = {v : Int | v == -1 || v == 1 || v == 3} @-}\n</code></pre>\n\n<p>That is, the <code>RestrictedInt</code> is an <code>Int</code> that is either <code>-1</code>, <code>1</code>, or <code>3</code>.  Notice you could easily write ranges and other restrictions, it doesn't have to be some mindless enumeration of legitimate values.</p>\n\n<p>Now we re-define your data type in our refinement language using this restricted int type:</p>\n\n<pre><code>{-@ data User = User { uRank     :: RestrictedInt\n                     , uProgress :: Int }\n  @-}\n</code></pre>\n\n<p>This is similar to your definition but with the restriction type instead of just <code>Int</code>.  We could have inlined the restriction instead of having a type alias but then your <code>User</code> data type would be pretty unreadable.</p>\n\n<p>You can define good values and the <code>liquid</code> tool will not complain:</p>\n\n<pre><code>goodValue :: User\ngoodValue = User 1 12\n</code></pre>\n\n<p>But bad values result in an error:</p>\n\n<pre><code>badValue :: User\nbadValue = User 10 12\n</code></pre>\n\n<p><code>$ liquid so.hs</code> (or your editor's integration, if you have that setup) produces:</p>\n\n<pre><code>**** RESULT: UNSAFE ************************************************************\n\n\n so.hs:16:12-18: Error: Liquid Type Mismatch\n\n 16 | badValue = User 10 12\n                 ^^^^^^^\n\n   Inferred type\n     VV : {VV : GHC.Types.Int | VV == ?a}\n\n   not a subtype of Required type\n     VV : {VV : GHC.Types.Int | VV == (-1)\n                                || (VV == 1\n                                    || VV == 3)}\n\n   In Context\n     ?a := {?a : GHC.Types.Int | ?a == (10 : int)}\n</code></pre>\n"}], "owner": {"reputation": 5139, "user_id": 705510, "user_type": "registered", "accept_rate": 89, "profile_image": "https://i.stack.imgur.com/7xrNQ.png?s=128&g=1", "display_name": "McBear Holden", "link": "https://stackoverflow.com/users/705510/mcbear-holden"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 1524, "favorite_count": 2, "accepted_answer_id": 41743896, "answer_count": 3, "score": 9, "last_activity_date": 1489428844, "creation_date": 1484832759, "last_edit_date": 1489428844, "question_id": 41743056, "link": "https://stackoverflow.com/questions/41743056/how-to-limit-a-int-field-to-a-range-of-values", "title": "How to limit a Int field to a range of values?", "body": "<p>In my Data</p>\n\n<pre><code>data User = User { uRank :: Int, uProgress :: Int }\n</code></pre>\n\n<p>I want to limit <code>uRank</code> to a list of values [-1, 1, 3], for example.</p>\n\n<p>How do I do this?</p>\n"}, {"tags": ["haskell"], "comments": [{"owner": {"reputation": 2970, "user_id": 2928766, "user_type": "registered", "accept_rate": 89, "profile_image": "https://www.gravatar.com/avatar/3c5d36ca80eccb125ee34991165d481e?s=128&d=identicon&r=PG", "display_name": "Rodrigo Ribeiro", "link": "https://stackoverflow.com/users/2928766/rodrigo-ribeiro"}, "edited": false, "score": 0, "creation_date": 1484829298, "post_id": 41741681, "comment_id": 70676534, "body": "Have you considered to write it as a <code>fold</code>? Using the pattern <code>foldr step base</code> you can write any function like this on lists."}, {"owner": {"reputation": 15757, "user_id": 176841, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/45a168cb9eb8454d66c78f18e29d9342?s=128&d=identicon&r=PG", "display_name": "jberryman", "link": "https://stackoverflow.com/users/176841/jberryman"}, "edited": false, "score": 0, "creation_date": 1484842329, "post_id": 41741681, "comment_id": 70685745, "body": "In case it&#39;s not clear from chi&#39;s answer <code>takeWhile</code> and other <code>base</code> functions are not magic: they&#39;re implemented in haskell and you can view the source, copy-paste and modify them, etc. Most are one-liners."}], "answers": [{"comments": [{"owner": {"reputation": 16776, "user_id": 1620081, "user_type": "registered", "accept_rate": 79, "profile_image": "https://www.gravatar.com/avatar/bc22b26eca68dab55ec4fe491495951e?s=128&d=identicon&r=PG", "display_name": "Augustin Riedinger", "link": "https://stackoverflow.com/users/1620081/augustin-riedinger"}, "edited": false, "score": 0, "creation_date": 1484830345, "post_id": 41741957, "comment_id": 70677211, "body": "Thanks! I realize I&#39;m not comfortable yet enough with <code>foldr</code>. I thought of <code>takeWhileOneMore p list = take (fromJust . findIndex (not. p) list) list</code> since. It is also correct, right? How do you compare the 2 solutions?"}, {"owner": {"reputation": 100185, "user_id": 3234959, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/93bb12ca0f93dfddb33880316f7e66c2?s=128&d=identicon&r=PG&f=1", "display_name": "chi", "link": "https://stackoverflow.com/users/3234959/chi"}, "reply_to_user": {"reputation": 16776, "user_id": 1620081, "user_type": "registered", "accept_rate": 79, "profile_image": "https://www.gravatar.com/avatar/bc22b26eca68dab55ec4fe491495951e?s=128&d=identicon&r=PG", "display_name": "Augustin Riedinger", "link": "https://stackoverflow.com/users/1620081/augustin-riedinger"}, "edited": false, "score": 2, "creation_date": 1484831693, "post_id": 41741957, "comment_id": 70678146, "body": "@AugustinRiedinger <code>fromJust</code> is best to be avoided. It will crash your program when fed with <code>Nothing</code>. All the potentially-crashing functions like <code>head, tail, fromJust, ...</code> are rarely needed, and usually it&#39;s better to work pretending they don&#39;t exist, exploiting pattern matching and/or safer (&quot;total&quot;) functions. I added a more basic alternative above, without <code>foldr</code>."}], "tags": [], "owner": {"reputation": 100185, "user_id": 3234959, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/93bb12ca0f93dfddb33880316f7e66c2?s=128&d=identicon&r=PG&f=1", "display_name": "chi", "link": "https://stackoverflow.com/users/3234959/chi"}, "is_accepted": true, "score": 7, "last_activity_date": 1484831766, "last_edit_date": 1484831766, "creation_date": 1484829322, "answer_id": 41741957, "question_id": 41741681, "link": "https://stackoverflow.com/questions/41741681/haskell-takewhile-1/41741957#41741957", "title": "Haskell takeWhile + 1", "body": "<p>You can roll your own.</p>\n\n<pre><code>takeWhileOneMore :: (a -&gt; Bool) -&gt; [a] -&gt; [a]\ntakeWhileOneMore p = foldr (\\x ys -&gt; if p x then x:ys else [x]) []\n</code></pre>\n\n<p>Compare it with</p>\n\n<pre><code>takeWhile :: (a -&gt; Bool) -&gt; [a] -&gt; [a]\ntakeWhile p = foldr (\\x ys -&gt; if p x then x:ys else []) []\n</code></pre>\n\n<p>Explicit recursion would also be fine for this.</p>\n\n<pre><code>takeWhileOneMore :: (a -&gt; Bool) -&gt; [a] -&gt; [a]\ntakeWhileOneMore p [] = []\ntakeWhileOneMore p (x:xs) = \n   if p x\n   then x : takeWhileOneMore p xs\n   else [x]\n</code></pre>\n"}, {"tags": [], "owner": {"reputation": 1780, "user_id": 4168972, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/fc92e82d2eb21eb030d4c133c70ff554?s=128&d=identicon&r=PG&f=1", "display_name": "David Fletcher", "link": "https://stackoverflow.com/users/4168972/david-fletcher"}, "is_accepted": false, "score": 9, "last_activity_date": 1484832659, "creation_date": 1484832659, "answer_id": 41743022, "question_id": 41741681, "link": "https://stackoverflow.com/questions/41741681/haskell-takewhile-1/41743022#41743022", "title": "Haskell takeWhile + 1", "body": "<p>You can use <code>span</code> or <code>break</code>.</p>\n\n<pre><code>\u03bb&gt; span (/=3) [1..10]\n([1,2],[3,4,5,6,7,8,9,10])\n</code></pre>\n\n<p>So you can do something like this:</p>\n\n<pre><code>takeWhileInc :: (a -&gt; Bool) -&gt; [a] -&gt; [a]\ntakeWhileInc p xs = case zs of [] -&gt; error \"not found\"\n                               (z:_) -&gt; ys ++ [z]\n  where\n    (ys, zs) = span p xs\n</code></pre>\n\n<p>(Or whatever you want to happen when <code>zs</code> is empty because no <code>3</code>\nwas found.)</p>\n"}, {"tags": [], "owner": {"reputation": 62421, "user_id": 216164, "user_type": "registered", "accept_rate": 89, "profile_image": "https://www.gravatar.com/avatar/786f224adbe0784cdf7d0f15476061fe?s=128&d=identicon&r=PG", "display_name": "Thomas M. DuBuisson", "link": "https://stackoverflow.com/users/216164/thomas-m-dubuisson"}, "is_accepted": false, "score": 2, "last_activity_date": 1484982767, "creation_date": 1484982767, "answer_id": 41776706, "question_id": 41741681, "link": "https://stackoverflow.com/questions/41741681/haskell-takewhile-1/41776706#41776706", "title": "Haskell takeWhile + 1", "body": "<p>I like to use the base function more than many people do, such as re-using <code>takeWhile</code> in an intelligent way to get the desired result.  For example, you can create a new list of predicates with the first element being <code>True</code> and <code>takeWhile</code> this list is true:</p>\n\n<pre><code>takeWhileP1 p xs = map snd (takeWhile fst (zip (True:map p xs) xs)\n</code></pre>\n\n<p>This generalizes nicely as well (not necessarily efficient in this form):</p>\n\n<pre><code>takeWhilePlusN n p xs = map snd (takeWhile fst (zip (replicate n True ++ map p xs) xs))\n</code></pre>\n\n<p>Or perhaps easier to read:</p>\n\n<pre><code>takeWhilePlusN n p xs =\n  let preds     = replicate n True ++ map p xs\n      annotated = zip preds xs\n  in map snd (takeWhile fst annotated)\n</code></pre>\n\n<p>And the result:</p>\n\n<pre><code>*Main&gt; takeWhilePlusN 3 (&lt;5) [1..10]\n[1,2,3,4,5,6,7]\n*Main&gt; takeWhilePlusN 1 (&lt;5) [1..10]\n[1,2,3,4,5]\n*Main&gt; takeWhileP1 (&lt;5) [1..10]\n[1,2,3,4,5]\n*Main&gt; takeWhile (&lt;5) [1..10]\n[1,2,3,4]\n</code></pre>\n"}], "owner": {"reputation": 16776, "user_id": 1620081, "user_type": "registered", "accept_rate": 79, "profile_image": "https://www.gravatar.com/avatar/bc22b26eca68dab55ec4fe491495951e?s=128&d=identicon&r=PG", "display_name": "Augustin Riedinger", "link": "https://stackoverflow.com/users/1620081/augustin-riedinger"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 2984, "favorite_count": 0, "accepted_answer_id": 41741957, "answer_count": 3, "score": 6, "last_activity_date": 1484982767, "creation_date": 1484828405, "question_id": 41741681, "link": "https://stackoverflow.com/questions/41741681/haskell-takewhile-1", "title": "Haskell takeWhile + 1", "body": "<p>How can I write a takeWhile that would keep the first element that doesn't match the condition?</p>\n\n<p>Example (obviously my example is trickier than this) :</p>\n\n<p>Instead of <code>takeWhile (\\\u00d7 - &gt; x! = 3) [1..10]</code> to return <code>[1,2]</code> I need <code>[1,2,3]</code>.</p>\n\n<p>I thought of <code>(takeWhile  myFunc myList) ++ [find myFunc myList]</code> but it means I need to go through my list 2 times... </p>\n\n<p>Any idea? </p>\n"}]