[{"tags": ["haskell"], "comments": [{"owner": {"reputation": 171740, "user_id": 869736, "user_type": "registered", "accept_rate": 82, "profile_image": "https://www.gravatar.com/avatar/671f732e3c68c387c702112a30e5ebd8?s=128&d=identicon&r=PG&f=1", "display_name": "Louis Wasserman", "link": "https://stackoverflow.com/users/869736/louis-wasserman"}, "edited": false, "score": 6, "creation_date": 1426114395, "post_id": 28998884, "comment_id": 46245709, "body": "The right side of <code>&lt;-</code> has to have a monad type, and <code>1</code> is just a bare <code>Int</code>, not something in a monad.  <code>do</code> is only something you use with monads, and you&#39;re not doing anything monadic here."}, {"owner": {"reputation": 10593, "user_id": 4621513, "user_type": "registered", "accept_rate": 77, "profile_image": "https://i.stack.imgur.com/uCfJK.png?s=128&g=1", "display_name": "mkrieger1", "link": "https://stackoverflow.com/users/4621513/mkrieger1"}, "edited": false, "score": 2, "creation_date": 1426114504, "post_id": 28998884, "comment_id": 46245749, "body": "Are you aware that what you probably want can simply be written as <code>func = 1</code>?"}, {"owner": {"reputation": 1125, "user_id": 777085, "user_type": "registered", "accept_rate": 68, "profile_image": "https://www.gravatar.com/avatar/5112855aef89ec6bf599252fbae5eca7?s=128&d=identicon&r=PG", "display_name": "xcoder", "link": "https://stackoverflow.com/users/777085/xcoder"}, "reply_to_user": {"reputation": 10593, "user_id": 4621513, "user_type": "registered", "accept_rate": 77, "profile_image": "https://i.stack.imgur.com/uCfJK.png?s=128&g=1", "display_name": "mkrieger1", "link": "https://stackoverflow.com/users/4621513/mkrieger1"}, "edited": false, "score": 0, "creation_date": 1426114628, "post_id": 28998884, "comment_id": 46245804, "body": "@mkrieger1 it&#39;s just for a demo"}, {"owner": {"reputation": 81, "user_id": 1074540, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/d3e84fe1963fc2c059181b8e435b435e?s=128&d=identicon&r=PG", "display_name": "Jared Simpson", "link": "https://stackoverflow.com/users/1074540/jared-simpson"}, "edited": false, "score": 1, "creation_date": 1426115863, "post_id": 28998884, "comment_id": 46246268, "body": "<code>func = do  x &lt;- return 1; return x</code>"}, {"owner": {"reputation": 2422, "user_id": 1276441, "user_type": "registered", "accept_rate": 88, "profile_image": "https://www.gravatar.com/avatar/a1ed120c8ab66ed191f289cafa0b58ee?s=128&d=identicon&r=PG", "display_name": "chamini2", "link": "https://stackoverflow.com/users/1276441/chamini2"}, "reply_to_user": {"reputation": 81, "user_id": 1074540, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/d3e84fe1963fc2c059181b8e435b435e?s=128&d=identicon&r=PG", "display_name": "Jared Simpson", "link": "https://stackoverflow.com/users/1074540/jared-simpson"}, "edited": false, "score": 1, "creation_date": 1426116284, "post_id": 28998884, "comment_id": 46246458, "body": "@JaredSimpson, your proposed &quot;solution&quot; has errors:   <b>1.</b> It doesn&#39;t type-check, since <code>func</code> is of type <code>:: Int</code>, note that <code>Int</code> is not in a monad.   <b>2.</b> If it were in a monad, it just doesn&#39;t make sense to take the <code>1</code> out of the monad to just re-insert it with another return, we would do <code>func = return 1</code>."}, {"owner": {"reputation": 44013, "user_id": 1477667, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/trgKM.jpg?s=128&g=1", "display_name": "dfeuer", "link": "https://stackoverflow.com/users/1477667/dfeuer"}, "edited": false, "score": 3, "creation_date": 1426116745, "post_id": 28998884, "comment_id": 46246621, "body": "Have you tried one of the fine Haskell tutorials available? I&#39;d recommend starting with that; these kinds of questions are not ideal for SO."}], "answers": [{"tags": [], "owner": {"reputation": 339851, "user_id": 149392, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/7a561ec0875fcbbe3066ea8fe288ec77?s=128&d=identicon&r=PG", "display_name": "sepp2k", "link": "https://stackoverflow.com/users/149392/sepp2k"}, "is_accepted": false, "score": 4, "last_activity_date": 1426116935, "last_edit_date": 1592644375, "creation_date": 1426116935, "answer_id": 28999415, "question_id": 28998884, "link": "https://stackoverflow.com/questions/28998884/haskell-do-block-return-error/28999415#28999415", "title": "Haskell do-block return error", "body": "<p>There are two problems with your code:</p>\n<ol>\n<li><p>The right side of <code>&lt;-</code> must have the type <code>m a</code> where <code>a</code> is an arbitrary type (that then becomes the type of the left side) and <code>m</code> is the monad that the do-block belongs to. In your case the type of the right side is <code>1</code>, which does not have that type.</p>\n<p>If all you want to do is to bind a value to <code>x</code>, you need to use <code>let x = 1</code>, not <code>&lt;-</code>.</p>\n</li>\n<li><p>The type of <code>return</code> is <code>Monad m =&gt; a -&gt; m a</code>, so if we take the type of <code>x</code> to be <code>Int</code>, the type of <code>return x</code> is <code>Monad m =&gt; m Int</code>. But according to your type signature, you just want the type to be <code>Int</code>, not <code>m Int</code>. Therefore you shouldn't use <code>return</code> (or <code>do</code>-notation for that matter).</p>\n</li>\n</ol>\n<p>The correct way to write the definition that you're trying to write would be:</p>\n<pre><code>f = 1\n</code></pre>\n<p>or if you want to have a local <code>x</code></p>\n<pre><code>f =\n  let x = 1 in\n  x\n</code></pre>\n<p>or</p>\n<pre><code>f = x\n  where x = 1\n</code></pre>\n"}], "owner": {"reputation": 1125, "user_id": 777085, "user_type": "registered", "accept_rate": 68, "profile_image": "https://www.gravatar.com/avatar/5112855aef89ec6bf599252fbae5eca7?s=128&d=identicon&r=PG", "display_name": "xcoder", "link": "https://stackoverflow.com/users/777085/xcoder"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 174, "favorite_count": 0, "answer_count": 1, "score": -2, "last_activity_date": 1426116935, "creation_date": 1426114226, "question_id": 28998884, "link": "https://stackoverflow.com/questions/28998884/haskell-do-block-return-error", "title": "Haskell do-block return error", "body": "<p>I have a simple function:</p>\n\n<pre><code>func :: Int\nfunc = do\n  x &lt;- 1\n  return x\n</code></pre>\n\n<p>But I got an error message as follows:</p>\n\n<pre><code> Couldn't match type \u2018m0 b0\u2019 with \u2018Int\u2019\n</code></pre>\n\n<p>What's wrong with my function?</p>\n"}, {"tags": ["haskell", "typeclass"], "comments": [{"owner": {"reputation": 171740, "user_id": 869736, "user_type": "registered", "accept_rate": 82, "profile_image": "https://www.gravatar.com/avatar/671f732e3c68c387c702112a30e5ebd8?s=128&d=identicon&r=PG&f=1", "display_name": "Louis Wasserman", "link": "https://stackoverflow.com/users/869736/louis-wasserman"}, "edited": false, "score": 2, "creation_date": 1426113603, "post_id": 28998729, "comment_id": 46245387, "body": "You can&#39;t match against a class.  You can have an <code>isTrue</code> method in your typeclass and check against that, but you can&#39;t pattern match against the result of a method."}, {"owner": {"reputation": 25144, "user_id": 477476, "user_type": "registered", "accept_rate": 85, "profile_image": "https://i.stack.imgur.com/Qf4TT.png?s=128&g=1", "display_name": "Cactus", "link": "https://stackoverflow.com/users/477476/cactus"}, "edited": false, "score": 4, "creation_date": 1426124300, "post_id": 28998729, "comment_id": 46248759, "body": "It&#39;s not implemented yet, but there&#39;s an open <a href=\"https://ghc.haskell.org/trac/ghc/ticket/8583\" rel=\"nofollow noreferrer\">GHC ticket</a> to add typeclass-associated pattern synonyms to the <code>PatternSynonyms</code> language extension."}], "answers": [{"comments": [{"owner": {"reputation": 42094, "user_id": 828361, "user_type": "registered", "accept_rate": 44, "profile_image": "https://www.gravatar.com/avatar/6a82397672dcc1fca31c32508ef0798b?s=128&d=identicon&r=PG", "display_name": "pigworker", "link": "https://stackoverflow.com/users/828361/pigworker"}, "edited": false, "score": 0, "creation_date": 1426113914, "post_id": 28998802, "comment_id": 46245495, "body": "But then you might have to compute <code>asBool</code> of the argument twice."}, {"owner": {"reputation": 17809, "user_id": 1088108, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/63781cd38e91aa346a3849bc3ef3e550?s=128&d=identicon&r=PG&f=1", "display_name": "&#216;rjan Johansen", "link": "https://stackoverflow.com/users/1088108/%c3%98rjan-johansen"}, "reply_to_user": {"reputation": 42094, "user_id": 828361, "user_type": "registered", "accept_rate": 44, "profile_image": "https://www.gravatar.com/avatar/6a82397672dcc1fca31c32508ef0798b?s=128&d=identicon&r=PG", "display_name": "pigworker", "link": "https://stackoverflow.com/users/828361/pigworker"}, "edited": false, "score": 3, "creation_date": 1426118930, "post_id": 28998802, "comment_id": 46247319, "body": "@pigworker &quot;When the same view function is applied in multiple branches of a function definition or a case expression (e.g., in size above), GHC makes an attempt to collect these applications into a single nested case expression, so that the view function is only applied once.&quot; Although there are limits, the above case should work fine."}, {"owner": {"reputation": 42094, "user_id": 828361, "user_type": "registered", "accept_rate": 44, "profile_image": "https://www.gravatar.com/avatar/6a82397672dcc1fca31c32508ef0798b?s=128&d=identicon&r=PG", "display_name": "pigworker", "link": "https://stackoverflow.com/users/828361/pigworker"}, "reply_to_user": {"reputation": 17809, "user_id": 1088108, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/63781cd38e91aa346a3849bc3ef3e550?s=128&d=identicon&r=PG&f=1", "display_name": "&#216;rjan Johansen", "link": "https://stackoverflow.com/users/1088108/%c3%98rjan-johansen"}, "edited": false, "score": 3, "creation_date": 1426119182, "post_id": 28998802, "comment_id": 46247400, "body": "@&#216;rjanJohansen The fact that it takes compiler voodoo to fix its consequences suggests that it may be a misfeature. Better to be explicit about doing the computation once."}], "tags": [], "owner": {"reputation": 64805, "user_id": 286871, "user_type": "registered", "accept_rate": 77, "profile_image": "https://i.stack.imgur.com/xNBpr.png?s=128&g=1", "display_name": "Tikhon Jelvis", "link": "https://stackoverflow.com/users/286871/tikhon-jelvis"}, "is_accepted": true, "score": 5, "last_activity_date": 1426113826, "creation_date": 1426113826, "answer_id": 28998802, "question_id": 28998729, "link": "https://stackoverflow.com/questions/28998729/how-to-pattern-match-against-a-typeclass-value/28998802#28998802", "title": "How to pattern match against a typeclass value?", "body": "<p>You can't match against a typeclass value like this. Typeclasses abstract over the actual underlying type while pattern matching would expose it.</p>\n\n<p>However, you can still get the same behavior and some nice syntax with the <a href=\"https://downloads.haskell.org/~ghc/7.4.2/docs/html/users_guide/syntax-extns.html#view-patterns\" rel=\"noreferrer\"><code>ViewPatterns</code></a> extension. The idea is to include a function which takes your abstract value and gives you a value of a concrete type that represents a view into the structure:</p>\n\n<pre><code>class (Bool a) where\n  true   :: a\n  false  :: a\n  asBool :: a -&gt; Bool\n</code></pre>\n\n<p>Now you can use the <code>asBool</code> function in a pattern match as a view pattern:</p>\n\n<pre><code>not :: Bool a =&gt; a -&gt; a\nnot (asBool -&gt; True)  = false\nnot (asBool -&gt; False) = true\n</code></pre>\n\n<p>However, note that this could result in <code>asBool</code> being computed twice which could be an issue if it hides an expensive computation.</p>\n"}, {"tags": [], "owner": {"reputation": 11986, "user_id": 3237465, "user_type": "registered", "accept_rate": 76, "profile_image": "https://i.stack.imgur.com/vOArX.png?s=128&g=1", "display_name": "user3237465", "link": "https://stackoverflow.com/users/3237465/user3237465"}, "is_accepted": false, "score": 1, "last_activity_date": 1426131901, "last_edit_date": 1426131901, "creation_date": 1426130629, "answer_id": 29001349, "question_id": 28998729, "link": "https://stackoverflow.com/questions/28998729/how-to-pattern-match-against-a-typeclass-value/29001349#29001349", "title": "How to pattern match against a typeclass value?", "body": "<p>In</p>\n\n<pre><code>class CBool a where\n    cfalse :: a\n    ctrue  :: a\n</code></pre>\n\n<p><code>cfalse</code> and <code>ctrue</code> are members of a type <code>a</code>, but this type can contain elements, that are not <code>cfalse</code> and <code>ctrue</code>. For example</p>\n\n<pre><code>instance CBool Int where\n    cfalse = 0\n    ctrue  = 1\n</code></pre>\n\n<p>What should <code>cnot 2</code> be? <code>Nothing</code> is a good option. Then <code>cnot 0 = Just 1</code> and <code>cnot 1 = Just 0</code>. So</p>\n\n<pre><code>cnot :: (CBool a, Eq a) =&gt; a -&gt; Maybe a\ncnot x | x == cfalse = Just ctrue\n       | x == ctrue  = Just cfalse\n       | otherwise   = Nothing\n</code></pre>\n\n<hr>\n\n<p>But there is another way:</p>\n\n<pre><code>class CIBool a where\n    citrue  :: a 'True\n    cifalse :: a 'False\n\ntype family Not (b :: Bool) :: Bool where\n    Not False = True\n    Not True  = False\n\ndata Booley :: Bool -&gt; * where\n  Falsey :: Booley False\n  Truey  :: Booley True\n\ncinot :: CIBool a =&gt; Booley b -&gt; a b -&gt; a (Not b)\ncinot Falsey _ = citrue\ncinot Truey  _ = cifalse\n</code></pre>\n\n<p>Here <code>CIBool</code> is indexed by <code>Bool</code>, <code>Booley</code> is a singleton and <code>cinot</code> is sort of dependently typed. It's possible to derive <code>CIBool</code> from <code>CBool</code>:</p>\n\n<pre><code>newtype a :@ b = Tag { detag :: a }\n    deriving Eq\n\ninstance CBool a =&gt; CIBool ((:@) a) where\n    cifalse = Tag cfalse\n    citrue  = Tag ctrue\n</code></pre>\n\n<p><code>(:@)</code> could be defined as a type family, since it's simply <code>Const</code>, but I prefer to avoid type families as much as possible. If</p>\n\n<pre><code>zero :: Int :@ False\nzero = cifalse\n\none  :: Int :@ True\none  = citrue\n</code></pre>\n\n<p>then <code>cinot Falsey zero == one</code> and <code>cinot Truey one == zero</code>.</p>\n\n<p>Note however, that while this is a type error:</p>\n\n<pre><code>zero' :: Int :@ True\nzero' = cifalse\n</code></pre>\n\n<p>we can define <code>zero'</code> like this:</p>\n\n<pre><code>zero' :: Int :@ True\nzero' = Tag 0\n</code></pre>\n\n<p>and then <code>cinot Truey zero' == zero</code>, which is senseless. Hence the <code>Tag</code> constructor should be mentioned only in the <code>CIBool</code> instance definition.</p>\n\n<p>Extensions used: <code>{-# LANGUAGE GADTs, KindSignatures, DataKinds, PolyKinds, TypeFamilies, TypeOperators #-}</code>.</p>\n"}], "owner": {"reputation": 44680, "user_id": 1031791, "user_type": "registered", "accept_rate": 54, "profile_image": "https://www.gravatar.com/avatar/fb710534fda446d2286074bb7692e65a?s=128&d=identicon&r=PG", "display_name": "MaiaVictor", "link": "https://stackoverflow.com/users/1031791/maiavictor"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 178, "favorite_count": 0, "accepted_answer_id": 28998802, "answer_count": 2, "score": 3, "last_activity_date": 1426131901, "creation_date": 1426113553, "question_id": 28998729, "link": "https://stackoverflow.com/questions/28998729/how-to-pattern-match-against-a-typeclass-value", "title": "How to pattern match against a typeclass value?", "body": "<p>Suppose that I define a typeclass in Haskell, </p>\n\n<pre><code>class (Bool a) where\n    false :: a\n    true  :: a\n</code></pre>\n\n<p>In order to define a generic <code>not</code> operation for any <code>Bool</code>, one would need to pattern match against its potential values:</p>\n\n<pre><code>not :: Bool a =&gt; a \u2192 a\nnot true  = false\nnot false = true\n</code></pre>\n\n<p>That doesn't compile, though. How can I get it to work?</p>\n"}, {"tags": ["opengl", "haskell", "glut"], "comments": [{"owner": {"reputation": 38487, "user_id": 2327517, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/0Bulc.jpg?s=128&g=1", "display_name": "derhass", "link": "https://stackoverflow.com/users/2327517/derhass"}, "edited": false, "score": 6, "creation_date": 1426115715, "post_id": 28998375, "comment_id": 46246211, "body": "You don&#39;t provide any surface normals."}, {"owner": {"reputation": 13734, "user_id": 938694, "user_type": "registered", "accept_rate": 59, "profile_image": "https://www.gravatar.com/avatar/b6678a430a805dd78366d6e135b49f2d?s=128&d=identicon&r=PG", "display_name": "Cubic", "link": "https://stackoverflow.com/users/938694/cubic"}, "reply_to_user": {"reputation": 38487, "user_id": 2327517, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/0Bulc.jpg?s=128&g=1", "display_name": "derhass", "link": "https://stackoverflow.com/users/2327517/derhass"}, "edited": false, "score": 1, "creation_date": 1426125131, "post_id": 28998375, "comment_id": 46248961, "body": "@derhass I&#39;m gonna take a wild guess and assume that he&#39;s not gonna know what that means either."}, {"owner": {"reputation": 4013, "user_id": 317984, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/03acf15ac1b2ad1a70e50fe985e11441?s=128&d=identicon&r=PG", "display_name": "martingw", "link": "https://stackoverflow.com/users/317984/martingw"}, "edited": false, "score": 1, "creation_date": 1426142424, "post_id": 28998375, "comment_id": 46253552, "body": "Guessed correctly, but know I have something to google :-) Thanks"}, {"owner": {"reputation": 41485, "user_id": 2521214, "user_type": "registered", "accept_rate": 71, "profile_image": "https://i.stack.imgur.com/nd58V.jpg?s=128&g=1", "display_name": "Spektre", "link": "https://stackoverflow.com/users/2521214/spektre"}, "edited": false, "score": 1, "creation_date": 1426148044, "post_id": 28998375, "comment_id": 46255789, "body": "@martingw added answer tried to explain normals as simple as I could hope it helps"}], "answers": [{"tags": [], "owner": {"reputation": 41485, "user_id": 2521214, "user_type": "registered", "accept_rate": 71, "profile_image": "https://i.stack.imgur.com/nd58V.jpg?s=128&g=1", "display_name": "Spektre", "link": "https://stackoverflow.com/users/2521214/spektre"}, "is_accepted": true, "score": 4, "last_activity_date": 1469266334, "last_edit_date": 1495540733, "creation_date": 1426147236, "answer_id": 29004546, "question_id": 28998375, "link": "https://stackoverflow.com/questions/28998375/understanding-lighting-in-opengl/29004546#29004546", "title": "Understanding lighting in OpenGL", "body": "<ol>\n<li><p><strong>Surface normals are crucial for lighting equations</strong></p>\n\n<p>Normal to surface is vector perpendicular to surface. For triangle is computed by cross product of any its 2 vertices vectors so if triangle points are <code>p0,p1,p2</code> then normal is <code>n=cross(p1-p0,p2-p1)</code> or any other combination.</p>\n\n<p>Normals tells which way is pixel/face/polygon turned usually dot product with light direction is computed by render engine that gives a <code>cos(angle_between light and surface normal)</code>. This number is the scale of amount of light hitting the surface when multiplied with light source strength you got the light color ...\nwith combination of surface color render get the pixel color there are many light models this one was very simple (normal shading).</p>\n\n<p>To make the dot product work the normal should be unit vector so divide it by its length <code>n=n/|n|</code></p>\n\n<p>Here small example of normals</p>\n\n<p><img src=\"https://i.stack.imgur.com/7qpxv.png\" alt=\"example\"></p>\n\n<p><strong>For sphere the normal is easy</strong> normal <code>n</code> for any point <code>p</code> is  <code>n=(p-center)/radius</code></p></li>\n<li><p><strong>If normal does not correspond with surface</strong></p>\n\n<p>then you can do light effects like visually smooth sharp edges of mesh.  for example how Look here:</p>\n\n<ul>\n<li><a href=\"https://stackoverflow.com/a/21930058/2521214\">smoothing normals</a></li>\n</ul>\n\n<p>also the exact opposite can be achieved (smooth mesh but sharp edge render)</p></li>\n<li><p><strong>OpenGL interface</strong></p>\n\n<p>old style gl uses something like <code>glNormal3f(nx,ny,nz);</code> The <strong>VBO/VAO</strong>/arrays knows normals too. In new style <code>glNormal</code> is depreceated like most parameters so you need to bind it to your custom layout on your own</p></li>\n<li><p><strong>Normal direction</strong></p>\n\n<p>any surface has 2 possible direction of perpendicular normal to it. Usually the one pointing outwards from mesh is used. Sometimes for 3D curves is double sided material used that means that the dot product is handled as <code>abs</code> value so it does not matter which way the normal is pointing. Without this the opposite side of surface will be always dark</p>\n\n<p><strong>So if you have normals and no lighting is visible then try to negate normals</strong></p></li>\n</ol>\n"}], "owner": {"reputation": 4013, "user_id": 317984, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/03acf15ac1b2ad1a70e50fe985e11441?s=128&d=identicon&r=PG", "display_name": "martingw", "link": "https://stackoverflow.com/users/317984/martingw"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 605, "favorite_count": 0, "accepted_answer_id": 29004546, "answer_count": 1, "score": 5, "last_activity_date": 1469266334, "creation_date": 1426111897, "last_edit_date": 1426194754, "question_id": 28998375, "link": "https://stackoverflow.com/questions/28998375/understanding-lighting-in-opengl", "title": "Understanding lighting in OpenGL", "body": "<p>I am trying to create a 3D sphere out of a bunch of triangles with Haskell / GLUT. It works quite nicely: The green one is \"my\" sphere, the red one is done with GLUT's renderObject Sphere'. And I can see \"my\" sphere is really 3D when I move the camera around, so that's fine. </p>\n\n<p>So why does the GLUT one has nice lighting, and mine has not? (I'm a newbie and do not really know what I'm doing below in initGL, copied that stuff from Hackage's cuboid package...) </p>\n\n<p><img src=\"https://i.stack.imgur.com/zc500.png\" alt=\"Nice and not-so-nice Spheres\"></p>\n\n<p>Here's the code:</p>\n\n<pre><code>module Main where\n\nimport Graphics.UI.GLUT \n\nmain :: IO ()\nmain = do\n  initGL\n  displayCallback $= render\n  mainLoop\n\ninitGL :: IO ()\ninitGL = do\n    getArgsAndInitialize\n    initialDisplayMode $= [DoubleBuffered]\n    createWindow \"Chip!\"\n    initialDisplayMode $= [ WithDepthBuffer ]\n    depthFunc          $= Just Less\n    clearColor         $= Color4 0 0 0 0\n    light (Light 0)    $= Enabled\n    lighting           $= Enabled \n    lightModelAmbient  $= Color4 0.5 0.5 0.5 1 \n    diffuse (Light 0)  $= Color4 1 1 1 1\n    blend              $= Enabled\n    blendFunc          $= (SrcAlpha, OneMinusSrcAlpha) \n    colorMaterial      $= Just (FrontAndBack, AmbientAndDiffuse)\n    reshapeCallback    $= Just resizeScene\n    return () \n\nrender :: DisplayCallback\nrender = do\n    clear [ ColorBuffer, DepthBuffer ]\n\n    loadIdentity\n\n    color $ Color3 (1 :: GLdouble) 1 1\n    position (Light 0) $= Vertex4 0 50 (50) 1  \n\n    preservingMatrix $ do \n        translate $ Vector3 ((-0.5) :: GLfloat) (-0.5) (-5)\n        color green\n        ball 12 8 0.03\n\n    preservingMatrix $ do \n        translate $ Vector3 (0.5 :: GLfloat) 0.5 (-5)\n        color red\n        renderObject Solid (Sphere' 0.25 20 20)\n\n    flush\n    swapBuffers\n    where green  = Color4 0.8 1.0 0.7 0.9 :: Color4 GLdouble\n          red    = Color4 1.0 0.7 0.8 1.0 :: Color4 GLdouble\n\nvertex3f :: (GLfloat, GLfloat, GLfloat) -&gt; IO ()\nvertex3f (x, y, z) = vertex $ Vertex3 x y z\n\nupperInnerCircle :: Int -&gt; [(GLfloat, GLfloat)]\nupperInnerCircle numSegs =\n    concat [[(0,0)\n            ,(cos a, sqrt(1-(cos a)*(cos a)))\n            ,(cos b, sqrt(1-(cos b)*(cos b)))] \n                 | (a,b)&lt;-as ]\n    where \n        seg'=pi/(fromIntegral numSegs)\n        as = [(fromIntegral n * seg', fromIntegral (n+1) * seg') | n&lt;-[0..numSegs-1]]\n\nlowerInnerCircle :: Int -&gt; [(GLfloat, GLfloat)]\nlowerInnerCircle numSegs =\n    map (\\(x,y) -&gt; (x,-y)) $ upperInnerCircle numSegs\n\ninnerCircle :: Int -&gt; [(GLfloat, GLfloat)]\ninnerCircle numSegs = upperInnerCircle numSegs ++ (lowerInnerCircle numSegs)\n\nupperOutSegment :: Int -&gt; Int -&gt; Int -&gt; [(GLfloat, GLfloat)]\nupperOutSegment numSegs ring seg =\n   [x,y,u, u,v,y]\n    where \n        seg'=pi/(fromIntegral numSegs)\n        (a, b)  = (fromIntegral seg * seg', fromIntegral (seg+1) * seg')\n        x =  (fromIntegral ring * cos a, fromIntegral ring * sqrt(1-(cos a)*(cos a)))\n        y = (fromIntegral ring * cos b, fromIntegral ring * sqrt(1-(cos b)*(cos b)))\n        u =  (fromIntegral (ring+1) * cos a, fromIntegral (ring+1) * sqrt(1-(cos a)*(cos a)))\n        v = (fromIntegral (ring+1) * cos b, fromIntegral (ring+1) * sqrt(1-(cos b)*(cos b)))\n\nlowerOutSegment :: Int -&gt; Int -&gt; Int -&gt; [(GLfloat, GLfloat)]\nlowerOutSegment numSegs ring seg =\n    map (\\(x,y) -&gt; (x,-y)) $ upperOutSegment numSegs ring seg \n\noutSegment :: Int -&gt; Int -&gt; Int -&gt; [(GLfloat, GLfloat)]\noutSegment numSegs ring seg = upperOutSegment numSegs ring seg ++ (lowerOutSegment numSegs ring seg)\n\nouterRing :: Int -&gt; Int -&gt; [(GLfloat, GLfloat)]\nouterRing numSegs ring =\n    concat [outSegment numSegs ring n | n&lt;-[0..numSegs-1]] \n\nball numSegs numRings factor =\n  let ips = innerCircle numSegs\n      ops = concat [outerRing numSegs i | i&lt;-[1..numRings]]\n      height dir ps = \n           map (\\(x,y) -&gt; \n                  let dist = sqrt(x*x+y*y)/(fromIntegral (numRings+1))\n                      height' = sqrt(1.001-dist*dist)*factor*(fromIntegral (numRings+1))\n                  in (x*factor,y*factor,dir*height')) $ ps\n      ups = height 1 $ ips ++ ops\n      lps = height (-1) $ ips ++ ops\n  in  renderPrimitive Triangles $ mapM_ vertex3f (ups++lps)\n\n\nresizeScene :: Size -&gt; IO ()\nresizeScene (Size w 0) = resizeScene (Size w 1) -- prevent divide by zero\nresizeScene s@(Size width height) = do\n  viewport   $= (Position 0 0, s)\n  matrixMode $= Projection\n  loadIdentity\n  perspective 45 (w2/h2) 1 1000\n  matrixMode $= Modelview 0\n  flush\n where\n   w2 = half width\n   h2 = half height\n   half z = realToFrac z / 2\n</code></pre>\n\n<p>EDIT: Works now, thanks to Spektre!</p>\n\n<p>Here's the pic:</p>\n\n<p><img src=\"https://i.stack.imgur.com/p9Hir.png\" alt=\"Nice!\"></p>\n\n<p>And here's the code:</p>\n\n<pre><code>module Main where\n\nimport Graphics.UI.GLUT \n\nmain :: IO ()\nmain = do\n  initGL\n  displayCallback $= render\n  mainLoop\n\ninitGL :: IO ()\ninitGL = do\n    getArgsAndInitialize\n    initialDisplayMode $= [DoubleBuffered]\n    createWindow \"Chip!\"\n    initialDisplayMode $= [ WithDepthBuffer ]\n    depthFunc          $= Just Less\n    clearColor         $= Color4 0 0 0 0\n    light (Light 0)    $= Enabled\n    lighting           $= Enabled \n    lightModelAmbient  $= Color4 0.5 0.5 0.5 1 \n    diffuse (Light 0)  $= Color4 1 1 1 1\n    blend              $= Enabled\n    blendFunc          $= (SrcAlpha, OneMinusSrcAlpha) \n    colorMaterial      $= Just (FrontAndBack, AmbientAndDiffuse)\n    reshapeCallback    $= Just resizeScene\n    return () \n\nrender :: DisplayCallback\nrender = do\n    clear [ ColorBuffer, DepthBuffer ]\n\n    loadIdentity\n\n    color $ Color3 (1 :: GLdouble) 1 1\n    position (Light 0) $= Vertex4 0 50 (50) 1  \n\n    preservingMatrix $ do \n        translate $ Vector3 ((-0.5) :: GLfloat) (-0.5) (-5)\n        color green\n        ball 12 8 0.03\n\n    preservingMatrix $ do \n        translate $ Vector3 (0.5 :: GLfloat) 0.5 (-5)\n        color red\n        renderObject Solid (Sphere' 0.25 20 20)\n\n    flush\n    swapBuffers\n    where green  = Color4 0.8 1.0 0.7 0.9 :: Color4 GLdouble\n          red    = Color4 1.0 0.7 0.8 1.0 :: Color4 GLdouble\n\npushTriangle :: ((GLfloat, GLfloat, GLfloat) \n                ,(GLfloat, GLfloat, GLfloat) \n                ,(GLfloat, GLfloat, GLfloat)) -&gt; \n                IO ()\npushTriangle (p0, p1, p2) = do\n    let (_,d0,_)=p0\n    let (_,d1,_)=p1\n    let (_,d2,_)=p2\n\n    --if it points upwards, reverse normal\n    let d=if d0+d1+d2&gt;0 then (-1) else 1\n    let n = cross (minus p1 p0) (minus p2 p1)\n    let nL = 1/lenVec n\n    let (n1, n2, n3) = scaleVec n (nL*d)\n    normal $ Normal3 n1 n2 n3\n\n    vertex3f p0\n    vertex3f p1\n    vertex3f p2\n\nvertex3f :: (GLfloat, GLfloat, GLfloat) -&gt; IO ()\nvertex3f (x, y, z) = \n   vertex $ Vertex3 x y z\n\nlenVec (a1,a2,a3) = sqrt $ a1*a1 + a2*a2 + a3*a3\n\nscaleVec (a1,a2,a3) x = (a1*x,a2*x,a3*x)\n\ncross (a1,a2,a3) (b1,b2,b3) =\n   (a2*b3-a3*b2\n   ,a3*b1-a1*b3\n   ,a1*b2-a2*b1)\n\nminus (a1,a2,a3) (b1,b2,b3) =\n  (a1-b1, a2-b2, a3-b3)\n\nupperInnerCircle :: Int -&gt; [(GLfloat, GLfloat)]\nupperInnerCircle numSegs =\n    concat [[(cos a, sqrt(1-(cos a)*(cos a)))\n            ,(0,0)\n            ,(cos b, sqrt(1-(cos b)*(cos b)))] \n                 | (a,b)&lt;-as ]\n    where \n        seg'=pi/(fromIntegral numSegs)\n        as = [(fromIntegral n * seg', fromIntegral (n+1) * seg') | n&lt;-[0..numSegs-1]]\n\nlowerInnerCircle :: Int -&gt; [(GLfloat, GLfloat)]\nlowerInnerCircle numSegs =\n    map (\\(x,y) -&gt; (x,-y)) $ upperInnerCircle numSegs\n\ninnerCircle :: Int -&gt; [(GLfloat, GLfloat)]\ninnerCircle numSegs = upperInnerCircle numSegs ++ (lowerInnerCircle numSegs)\n\nupperOutSegment :: Int -&gt; Int -&gt; Int -&gt; [(GLfloat, GLfloat)]\nupperOutSegment numSegs ring seg =\n   [x,y,u, v,u,y]\n    where \n        seg'=pi/(fromIntegral numSegs)\n        (a, b)  = (fromIntegral seg * seg', fromIntegral (seg+1) * seg')\n        x =  (fromIntegral ring * cos a, fromIntegral ring * sqrt(1-(cos a)*(cos a)))\n        y = (fromIntegral ring * cos b, fromIntegral ring * sqrt(1-(cos b)*(cos b)))\n        u =  (fromIntegral (ring+1) * cos a, fromIntegral (ring+1) * sqrt(1-(cos a)*(cos a)))\n        v = (fromIntegral (ring+1) * cos b, fromIntegral (ring+1) * sqrt(1-(cos b)*(cos b)))\n\nlowerOutSegment :: Int -&gt; Int -&gt; Int -&gt; [(GLfloat, GLfloat)]\nlowerOutSegment numSegs ring seg =\n    map (\\(x,y) -&gt; (x,-y)) $ upperOutSegment numSegs ring seg \n\noutSegment :: Int -&gt; Int -&gt; Int -&gt; [(GLfloat, GLfloat)]\noutSegment numSegs ring seg = upperOutSegment numSegs ring seg ++ (lowerOutSegment numSegs ring seg)\n\nouterRing :: Int -&gt; Int -&gt; [(GLfloat, GLfloat)]\nouterRing numSegs ring =\n    concat [outSegment numSegs ring n | n&lt;-[0..numSegs-1]] \n\nball numSegs numRings factor =\n  let ips = innerCircle numSegs\n      ops = concat [outerRing numSegs i | i&lt;-[1..numRings]]\n      height dir ps = \n           map (\\(x,y) -&gt; \n                  let dist = sqrt(x*x+y*y)/(fromIntegral (numRings+1))\n                      height' = sqrt(1.001-dist*dist)*factor*(fromIntegral (numRings+1))\n                  in (x*factor,y*factor,dir*height')) $ ps\n      ups = height 1 $ ips ++ ops\n      lps = height (-1) $ ips ++ ops\n  in  renderPrimitive Triangles $ mapM_ pushTriangle (toTriples (ups++lps))\n\ntoTriples :: [a] -&gt; [(a,a,a)]\ntoTriples [] = []\ntoTriples (a:b:c:rest) = (a,b,c):toTriples rest \n\nresizeScene :: Size -&gt; IO ()\nresizeScene (Size w 0) = resizeScene (Size w 1) -- prevent divide by zero\nresizeScene s@(Size width height) = do\n  viewport   $= (Position 0 0, s)\n  matrixMode $= Projection\n  loadIdentity\n  perspective 45 (w2/h2) 1 1000\n  matrixMode $= Modelview 0\n  flush\n where\n   w2 = half width\n   h2 = half height\n   half z = realToFrac z / 2\n</code></pre>\n"}, {"tags": ["haskell"], "comments": [{"owner": {"reputation": 81337, "user_id": 91757, "user_type": "registered", "accept_rate": 85, "profile_image": "https://www.gravatar.com/avatar/afaf752cb41c3968dbd570c6f6fa0dc3?s=128&d=identicon&r=PG", "display_name": "Frerich Raabe", "link": "https://stackoverflow.com/users/91757/frerich-raabe"}, "edited": false, "score": 2, "creation_date": 1426109713, "post_id": 28997603, "comment_id": 46243757, "body": "I&#39;m curious - why do you want to do this?"}], "answers": [{"comments": [{"owner": {"reputation": 1125, "user_id": 777085, "user_type": "registered", "accept_rate": 68, "profile_image": "https://www.gravatar.com/avatar/5112855aef89ec6bf599252fbae5eca7?s=128&d=identicon&r=PG", "display_name": "xcoder", "link": "https://stackoverflow.com/users/777085/xcoder"}, "edited": false, "score": 0, "creation_date": 1426109335, "post_id": 28997684, "comment_id": 46243595, "body": "What if the String type becomes a custom type?"}, {"owner": {"reputation": 153048, "user_id": 9204, "user_type": "registered", "accept_rate": 82, "profile_image": "https://www.gravatar.com/avatar/c79937a093ff9e963c563e22cd385f30?s=128&d=identicon&r=PG", "display_name": "Alexey Romanov", "link": "https://stackoverflow.com/users/9204/alexey-romanov"}, "reply_to_user": {"reputation": 1125, "user_id": 777085, "user_type": "registered", "accept_rate": 68, "profile_image": "https://www.gravatar.com/avatar/5112855aef89ec6bf599252fbae5eca7?s=128&d=identicon&r=PG", "display_name": "xcoder", "link": "https://stackoverflow.com/users/777085/xcoder"}, "edited": false, "score": 0, "creation_date": 1426109612, "post_id": 28997684, "comment_id": 46243721, "body": "It wouldn&#39;t make any difference."}, {"owner": {"reputation": 56659, "user_id": 450128, "user_type": "registered", "accept_rate": 62, "profile_image": "https://www.gravatar.com/avatar/2f72b3fdc99fe9fd1bbeb2f9da1d2c0a?s=128&d=identicon&r=PG", "display_name": "Ben", "link": "https://stackoverflow.com/users/450128/ben"}, "reply_to_user": {"reputation": 1125, "user_id": 777085, "user_type": "registered", "accept_rate": 68, "profile_image": "https://www.gravatar.com/avatar/5112855aef89ec6bf599252fbae5eca7?s=128&d=identicon&r=PG", "display_name": "xcoder", "link": "https://stackoverflow.com/users/777085/xcoder"}, "edited": false, "score": 1, "creation_date": 1426110577, "post_id": 28997684, "comment_id": 46244138, "body": "@xcoder You can do this by using custom type which <i>stores</i> the function <code>concat</code> and the string arguments, instead of actually applying concat. Then you can count the number of concats in that data structure, and separately also ask for the string that would be produced by actually applying concat. That&#39;s basically @dfeur&#39;s answer. But without having made special arrangements up front, no there&#39;s no way to tell what operations were used to come up with a given value (of <i>any</i> type)."}, {"owner": {"reputation": 1125, "user_id": 777085, "user_type": "registered", "accept_rate": 68, "profile_image": "https://www.gravatar.com/avatar/5112855aef89ec6bf599252fbae5eca7?s=128&d=identicon&r=PG", "display_name": "xcoder", "link": "https://stackoverflow.com/users/777085/xcoder"}, "reply_to_user": {"reputation": 56659, "user_id": 450128, "user_type": "registered", "accept_rate": 62, "profile_image": "https://www.gravatar.com/avatar/2f72b3fdc99fe9fd1bbeb2f9da1d2c0a?s=128&d=identicon&r=PG", "display_name": "Ben", "link": "https://stackoverflow.com/users/450128/ben"}, "edited": false, "score": 0, "creation_date": 1426111089, "post_id": 28997684, "comment_id": 46244395, "body": "@Ben I think thats the key issue. How can you count in the structure w/o actually calling the function? We cannot pattern match =["}, {"owner": {"reputation": 171740, "user_id": 869736, "user_type": "registered", "accept_rate": 82, "profile_image": "https://www.gravatar.com/avatar/671f732e3c68c387c702112a30e5ebd8?s=128&d=identicon&r=PG&f=1", "display_name": "Louis Wasserman", "link": "https://stackoverflow.com/users/869736/louis-wasserman"}, "reply_to_user": {"reputation": 1125, "user_id": 777085, "user_type": "registered", "accept_rate": 68, "profile_image": "https://www.gravatar.com/avatar/5112855aef89ec6bf599252fbae5eca7?s=128&d=identicon&r=PG", "display_name": "xcoder", "link": "https://stackoverflow.com/users/777085/xcoder"}, "edited": false, "score": 2, "creation_date": 1426111966, "post_id": 28997684, "comment_id": 46244795, "body": "@xcoder: Haskell is pretty deliberately designed so you can&#39;t.  That&#39;s referential transparency: you can&#39;t determine how a value was computed; replacing an expression with its result always preserves behavior."}], "tags": [], "owner": {"reputation": 153048, "user_id": 9204, "user_type": "registered", "accept_rate": 82, "profile_image": "https://www.gravatar.com/avatar/c79937a093ff9e963c563e22cd385f30?s=128&d=identicon&r=PG", "display_name": "Alexey Romanov", "link": "https://stackoverflow.com/users/9204/alexey-romanov"}, "is_accepted": false, "score": 6, "last_activity_date": 1426110023, "last_edit_date": 1426110023, "creation_date": 1426109194, "answer_id": 28997684, "question_id": 28997603, "link": "https://stackoverflow.com/questions/28997603/haskell-counting-number-of-function-call/28997684#28997684", "title": "Haskell counting number of function call", "body": "<p>Putting aside that <code>var</code> has the wrong type, you can't. </p>\n\n<p>Reason 1: You can write exactly the same function as <code>var</code> without ever calling <code>concat</code>. Assuming the obvious definition of <code>concat</code>:</p>\n\n<pre><code>var1 = \"a\" ++ \"b\" ++ \"c\"\n</code></pre>\n\n<p>or</p>\n\n<pre><code>var2 = \"abc\"\n</code></pre>\n\n<p>In fact, the compiler will turn your <code>var</code> into <code>var2</code> when you compile with optimizations!</p>\n\n<p>Reason 2: What if the number of calls to <code>concat</code> depends on the arguments? What should </p>\n\n<pre><code>func f \n  where f x y = if x == \"\" then y else (concat x y)\n</code></pre>\n\n<p>return? </p>\n"}, {"tags": [], "owner": {"reputation": 44013, "user_id": 1477667, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/trgKM.jpg?s=128&g=1", "display_name": "dfeuer", "link": "https://stackoverflow.com/users/1477667/dfeuer"}, "is_accepted": false, "score": 6, "last_activity_date": 1426110196, "last_edit_date": 1426110196, "creation_date": 1426109890, "answer_id": 28997884, "question_id": 28997603, "link": "https://stackoverflow.com/questions/28997603/haskell-counting-number-of-function-call/28997884#28997884", "title": "Haskell counting number of function call", "body": "<p>The right way to do this is to replace <code>concat :: String -&gt; String -&gt; String</code> with <code>concatA :: String -&gt; String -&gt; f (String)</code>, for some appropriate <code>Applicative</code> <code>f</code>. For example, you could use <code>Writer</code>:</p>\n\n<pre><code>concatW :: String -&gt; String -&gt; Writer Int String\nconcatW s1 s2 = Writer (s1++s2, Sum 1)\n</code></pre>\n\n<p>Now</p>\n\n<pre><code>concatW s1 s2 &gt;&gt;= concatW s3 &gt;&gt;= concatW s4\n</code></pre>\n\n<p>Or</p>\n\n<pre><code>(&lt;=) &lt;$&gt; concatW s1 s2 &lt;*&gt; concatW s3 s4\n</code></pre>\n\n<p>will count things for you.</p>\n\n<hr>\n\n<p>If you are interested in how many times your function is called for debugging purposes, you may want to use <code>trace</code> from <code>Debug.Trace</code>. You may also want to use the profiler and annotate the function as a cost center. You could even use <code>unsafePerformIO</code> if you're crazy. But these are not things that should generally appear in a released program.</p>\n"}], "owner": {"reputation": 1125, "user_id": 777085, "user_type": "registered", "accept_rate": 68, "profile_image": "https://www.gravatar.com/avatar/5112855aef89ec6bf599252fbae5eca7?s=128&d=identicon&r=PG", "display_name": "xcoder", "link": "https://stackoverflow.com/users/777085/xcoder"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 715, "favorite_count": 0, "answer_count": 2, "score": 1, "last_activity_date": 1426110196, "creation_date": 1426108898, "question_id": 28997603, "link": "https://stackoverflow.com/questions/28997603/haskell-counting-number-of-function-call", "title": "Haskell counting number of function call", "body": "<p>Say I have a function <code>concat :: String -&gt; String -&gt; String</code>. So,</p>\n\n<pre><code>var :: String\nvar = concat (concat \"a\" \"b\") \"c\")  -- \"abc\"\n</code></pre>\n\n<p>Now, I have a function which I want to use to calculate how many times concat is called:</p>\n\n<pre><code>func :: (String-&gt;String-&gt;String) -&gt; Int\n</code></pre>\n\n<p>So, <code>func var</code> should return 2.</p>\n\n<p>How should I get this value and at the same time perform the concat?</p>\n"}, {"tags": ["haskell"], "comments": [{"owner": {"reputation": 100185, "user_id": 3234959, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/93bb12ca0f93dfddb33880316f7e66c2?s=128&d=identicon&r=PG&f=1", "display_name": "chi", "link": "https://stackoverflow.com/users/3234959/chi"}, "edited": false, "score": 3, "creation_date": 1426107584, "post_id": 28996956, "comment_id": 46242580, "body": "Are you trying to invert a function using pattern matching? If so, this can&#39;t feasibly work (and is consequently disallowed in Haskell). What would <code>f (const 3 x) = x</code> produce if I evaluated <code>f 3</code> ?"}, {"owner": {"reputation": 171740, "user_id": 869736, "user_type": "registered", "accept_rate": 82, "profile_image": "https://www.gravatar.com/avatar/671f732e3c68c387c702112a30e5ebd8?s=128&d=identicon&r=PG&f=1", "display_name": "Louis Wasserman", "link": "https://stackoverflow.com/users/869736/louis-wasserman"}, "edited": false, "score": 1, "creation_date": 1426107628, "post_id": 28996956, "comment_id": 46242605, "body": "Haskell is a referentially transparent language, which means <code>f1</code> can&#39;t tell whether its argument came from <code>f3</code> or from some other computation."}], "answers": [{"comments": [{"owner": {"reputation": 1125, "user_id": 777085, "user_type": "registered", "accept_rate": 68, "profile_image": "https://www.gravatar.com/avatar/5112855aef89ec6bf599252fbae5eca7?s=128&d=identicon&r=PG", "display_name": "xcoder", "link": "https://stackoverflow.com/users/777085/xcoder"}, "edited": false, "score": 0, "creation_date": 1426109209, "post_id": 28997575, "comment_id": 46243518, "body": "Thanks a lot for your explanation, it;s really clear and now I understand why I can&#39;t do this. Regarding the problem, I have raised another question which make it clearer why I want to count the occurrence of f3. link: <a href=\"http://stackoverflow.com/questions/28997603/haskell-counting-number-of-function-call\" title=\"haskell counting number of function call\">stackoverflow.com/questions/28997603/&hellip;</a>"}], "tags": [], "owner": {"reputation": 56659, "user_id": 450128, "user_type": "registered", "accept_rate": 62, "profile_image": "https://www.gravatar.com/avatar/2f72b3fdc99fe9fd1bbeb2f9da1d2c0a?s=128&d=identicon&r=PG", "display_name": "Ben", "link": "https://stackoverflow.com/users/450128/ben"}, "is_accepted": true, "score": 7, "last_activity_date": 1426108787, "creation_date": 1426108787, "answer_id": 28997575, "question_id": 28996956, "link": "https://stackoverflow.com/questions/28996956/pattern-match-haskell-higher-order-function/28997575#28997575", "title": "Pattern match Haskell Higher order function?", "body": "<p>You can't pattern match on a function. For (almost) any given function, there are an infinite number of ways to define the same function. And it turns out to be mathematically impossible for a computer to always be able to say whether a given definition expresses the same function as another definition. This also means that Haskell would be unable to reliably tell whether a function matches a pattern; so the language simply doesn't allow it.</p>\n\n<p>A pattern must be <em>either</em> a single variable <em>or</em> a constructor applied to some other patterns. Remembering that constructor start with upper case letters and variables start with lower case letters, your pattern <code>f3 a n i</code> is invalid; the \"head\" of the pattern <code>f3</code> is a variable, but it's also applied to <code>a</code>, <code>n</code>, and <code>i</code>. That's the error message you're getting.</p>\n\n<p>Since functions don't have constructors, it follows that the <em>only</em> pattern that can match a function is a single variable; that matches all functions (of the right type to be passed to the pattern, anyway). That's how Haskell enforces the \"no pattern matching against functions\" rule. Basically, in a higher order function there's no way to tell anything at all about the function you've been given <em>except</em> to apply it to something and see what it does.</p>\n\n<p>The function <code>f1</code> has type <code>MyType -&gt; Int</code>. This is equivalent to <code>(Int -&gt; Bool) -&gt; Int</code>. So it takes a <em>single</em> function argument of type <code>Int -&gt; Bool</code>. I would expect an equation for <code>f1</code> to look like:</p>\n\n<pre><code>f1 f = ...\n</code></pre>\n\n<p>You don't need to \"check\" whether it's an <code>Int -&gt; Bool</code> function by pattern matching; the type <em>guarantees</em> that it will be.</p>\n\n<p>You can't tell <em>which</em> one it is; but that's generally the whole point of taking a function as an argument (so that the caller can pick <em>any</em> function they like knowing that you'll use them all the same way).</p>\n\n<p>I'm not sure what you mean by \"I want to know how many f3 is there\". <code>f1</code> always receives a <em>single</em> function, and <code>f3</code> is not a function of the right type to be passed to <code>f1</code> at all (it's a <code>MyType -&gt; MyType -&gt; MyType</code>, not a <code>MyType</code>).</p>\n"}, {"tags": [], "owner": {"reputation": 64094, "user_id": 476408, "user_type": "registered", "accept_rate": 70, "profile_image": "https://www.gravatar.com/avatar/2bc1bffafe7aa29ef900b98d1fd1e94e?s=128&d=identicon&r=PG", "display_name": "J. Abrahamson", "link": "https://stackoverflow.com/users/476408/j-abrahamson"}, "is_accepted": false, "score": 4, "last_activity_date": 1426109398, "creation_date": 1426109398, "answer_id": 28997745, "question_id": 28996956, "link": "https://stackoverflow.com/questions/28996956/pattern-match-haskell-higher-order-function/28997745#28997745", "title": "Pattern match Haskell Higher order function?", "body": "<p>Once a function has been applied its syntactic form is lost. There is now way, should I provide you <code>2 + 3</code> to distinguish what you get from just <code>5</code>. It <em>could</em> have arisen from <code>2 + 3</code>, or <code>3 + 2</code>, or the mere constant <code>5</code>.</p>\n\n<p>If you need to capture syntactic structure then you need to work with syntactic structure.</p>\n\n<pre><code>data Exp = I Int | Plus Exp Exp\n\njustFive :: Exp\njustFive = I 5\n\ntwoPlusThree :: Exp\ntwoPlusThree = I 2 `Plus` I 3\n\nthreePlusTwo :: Exp\nthreePlusTwo = I 2 `Plus` I 3\n</code></pre>\n\n<p>Here the data type <code>Exp</code> captures numeric <em>expressions</em> and we can pattern match upon them:</p>\n\n<pre><code>isTwoPlusThree :: Exp -&gt; Bool\nisTwoPlusThree (Plus (I 2) (I 3)) = True\nisTwoPlusThree _ = False\n</code></pre>\n\n<p>But wait, why am I distinguishing between \"constructors\" which I can pattern match on and.... \"<em>other</em> syntax\" which I cannot?</p>\n\n<p>Essentially, constructors are inert. The behavior of <code>Plus x y</code> is... to do nothing at all, to merely remain as a box with two slots called \"<code>Plus _ _</code>\" and plug the two slots with the values represented by <code>x</code> and <code>y</code>.</p>\n\n<p>On the other hand, function application is the furthest thing from inert! When you apply an expression to a function that function <code>(\\x -&gt; ...)</code> replaces the <code>x</code>es within its body with the applied value. This <em>dynamic reduction</em> behavior means that there is no way to get a hold of \"function applications\". They vanish into thing air as soon as you look at them.</p>\n"}], "owner": {"reputation": 1125, "user_id": 777085, "user_type": "registered", "accept_rate": 68, "profile_image": "https://www.gravatar.com/avatar/5112855aef89ec6bf599252fbae5eca7?s=128&d=identicon&r=PG", "display_name": "xcoder", "link": "https://stackoverflow.com/users/777085/xcoder"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 526, "favorite_count": 1, "accepted_answer_id": 28997575, "answer_count": 2, "score": 3, "last_activity_date": 1426109398, "creation_date": 1426106593, "last_edit_date": 1426107378, "question_id": 28996956, "link": "https://stackoverflow.com/questions/28996956/pattern-match-haskell-higher-order-function", "title": "Pattern match Haskell Higher order function?", "body": "<p>Imagine I have a custom type and two functions:</p>\n\n<pre><code>type MyType = Int -&gt; Bool\n\nf1 :: MyType -&gt; Int\nf3 :: MyType -&gt; MyType -&gt; MyType\n</code></pre>\n\n<p>I tried to pattern match as follows:</p>\n\n<pre><code>f1 (f3 a b i) = 1\n</code></pre>\n\n<p>But it failed with error: <code>Parse error in pattern: f1</code>. What is the proper way to do the above?? Basically, I want to know how many f3 is there (as a and b maybe f3 or some other functions).</p>\n"}, {"tags": ["algorithm", "sorting", "haskell", "functional-programming", "mergesort"], "comments": [{"owner": {"reputation": 46235, "user_id": 2541573, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/Z1qtP.png?s=128&g=1", "display_name": "jub0bs", "link": "https://stackoverflow.com/users/2541573/jub0bs"}, "edited": false, "score": 1, "creation_date": 1426092381, "post_id": 28992450, "comment_id": 46233074, "body": "Irrespective of whether <code>mergeSortOfficial</code> indeed implements MergeSort or not, what strikes me is that it recomputes the length of the list (twice!) at each call. That&#39;s very inefficient; the length should be computed once and for all at the beginning."}, {"owner": {"reputation": 2627, "user_id": 215924, "user_type": "registered", "accept_rate": 76, "profile_image": "https://www.gravatar.com/avatar/db83b716acfe0f3a1de6faa176d63fca?s=128&d=identicon&r=PG&f=1", "display_name": "Squidly", "link": "https://stackoverflow.com/users/215924/squidly"}, "edited": false, "score": 1, "creation_date": 1426092459, "post_id": 28992450, "comment_id": 46233129, "body": "Doesn&#39;t this belongs on codereview?"}, {"owner": {"reputation": 94553, "user_id": 775806, "user_type": "registered", "accept_rate": 96, "profile_image": "https://i.stack.imgur.com/XNd2C.png?s=128&g=1", "display_name": "n. &#39;pronouns&#39; m.", "link": "https://stackoverflow.com/users/775806/n-pronouns-m"}, "edited": false, "score": 5, "creation_date": 1426092800, "post_id": 28992450, "comment_id": 46233357, "body": "A merge sort divides the input in two <i>equal</i> (or almost equal) parts. This is important. You always &quot;merge&quot; with a one-element list. This doesn&#39;t have the required asymptotic complexity."}, {"owner": {"reputation": 94553, "user_id": 775806, "user_type": "registered", "accept_rate": 96, "profile_image": "https://i.stack.imgur.com/XNd2C.png?s=128&g=1", "display_name": "n. &#39;pronouns&#39; m.", "link": "https://stackoverflow.com/users/775806/n-pronouns-m"}, "reply_to_user": {"reputation": 2627, "user_id": 215924, "user_type": "registered", "accept_rate": 76, "profile_image": "https://www.gravatar.com/avatar/db83b716acfe0f3a1de6faa176d63fca?s=128&d=identicon&r=PG&f=1", "display_name": "Squidly", "link": "https://stackoverflow.com/users/215924/squidly"}, "edited": false, "score": 2, "creation_date": 1426093066, "post_id": 28992450, "comment_id": 46233554, "body": "@MrBones not really. This code isn&#39;t working, for some definition of &quot;working&quot;, so the question belongs here."}, {"owner": {"reputation": 94553, "user_id": 775806, "user_type": "registered", "accept_rate": 96, "profile_image": "https://i.stack.imgur.com/XNd2C.png?s=128&g=1", "display_name": "n. &#39;pronouns&#39; m.", "link": "https://stackoverflow.com/users/775806/n-pronouns-m"}, "edited": false, "score": 0, "creation_date": 1426093664, "post_id": 28992450, "comment_id": 46233967, "body": "If you want to work bottom-up from a list of one-element lists, you can. You have a list of lists. Merge each even-numbered element with its odd-numbered neighbour. Repeat until you have just one list left."}, {"owner": {"reputation": 24028, "user_id": 383200, "user_type": "registered", "accept_rate": 60, "profile_image": "https://www.gravatar.com/avatar/a9dc722f936cb1059adaae4fe39c07f0?s=128&d=identicon&r=PG", "display_name": "Carl", "link": "https://stackoverflow.com/users/383200/carl"}, "edited": false, "score": 0, "creation_date": 1426095040, "post_id": 28992450, "comment_id": 46234964, "body": "Bottom-up is definitely the way to go. Then you never need to count elements at all."}, {"owner": {"reputation": 100185, "user_id": 3234959, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/93bb12ca0f93dfddb33880316f7e66c2?s=128&d=identicon&r=PG&f=1", "display_name": "chi", "link": "https://stackoverflow.com/users/3234959/chi"}, "edited": false, "score": 2, "creation_date": 1426096431, "post_id": 28992450, "comment_id": 46235882, "body": "I believe this is insertion sort in disguise: merges are done in the form <code>merge list [x]</code> which amounts to inserting <code>x</code> into an ordered <code>list</code>. The current code looks O(n^2)."}, {"owner": {"reputation": 61419, "user_id": 849891, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/MbEO3.png?s=128&g=1", "display_name": "Will Ness", "link": "https://stackoverflow.com/users/849891/will-ness"}, "edited": false, "score": 1, "creation_date": 1426101659, "post_id": 28992450, "comment_id": 46239143, "body": "stable bottom-up mergesort:  <a href=\"https://en.wikipedia.org/w/index.php?title=Haskell_98_features#Mergesort\" rel=\"nofollow noreferrer\">en.wikipedia.org/w/&hellip;</a>"}], "answers": [{"comments": [{"owner": {"reputation": 61419, "user_id": 849891, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/MbEO3.png?s=128&g=1", "display_name": "Will Ness", "link": "https://stackoverflow.com/users/849891/will-ness"}, "edited": false, "score": 0, "creation_date": 1426101148, "post_id": 28993888, "comment_id": 46238857, "body": "with this twisting top-down split, the sort is not stable. It&#39;s better to split in half without measuring the length at all, by advancing <i>two</i> pointers, one at twice the speed of the other. bottom-up is best, esp. as you can separate out the &quot;runs&quot; in the initial pass, like is done in <a href=\"https://hackage.haskell.org/package/data-ordlist-0.4.7.0/docs/Data-List-Ordered.html#v:nubSort\" rel=\"nofollow noreferrer\">data-ordlist&#39;s <code>nubSort</code></a>."}, {"owner": {"reputation": 983, "user_id": 3069376, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/e8074e4e3db3437023bdfc884a50e0e9?s=128&d=identicon&r=PG&f=1", "display_name": "user3069376", "link": "https://stackoverflow.com/users/3069376/user3069376"}, "edited": false, "score": 0, "creation_date": 1426102025, "post_id": 28993888, "comment_id": 46239351, "body": "Thanks for explaining. Just a small thing: Of course your second line should be:   foldl merge [] [[2], [1], [4], [3]] ==  instead of  foldl merge [] [[1], [2], [3], [4]] =="}, {"owner": {"reputation": 28873, "user_id": 1068232, "user_type": "registered", "accept_rate": 79, "profile_image": "https://www.gravatar.com/avatar/2a0a145ce58c20013969fe3f203531da?s=128&d=identicon&r=PG", "display_name": "Andr&#225;s Kov&#225;cs", "link": "https://stackoverflow.com/users/1068232/andr%c3%a1s-kov%c3%a1cs"}, "reply_to_user": {"reputation": 61419, "user_id": 849891, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/MbEO3.png?s=128&g=1", "display_name": "Will Ness", "link": "https://stackoverflow.com/users/849891/will-ness"}, "edited": false, "score": 0, "creation_date": 1426104459, "post_id": 28993888, "comment_id": 46240796, "body": "@WillNess that&#39;s a very nice idea! I added a split like that to the answer."}, {"owner": {"reputation": 46235, "user_id": 2541573, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/Z1qtP.png?s=128&g=1", "display_name": "jub0bs", "link": "https://stackoverflow.com/users/2541573/jub0bs"}, "edited": false, "score": 0, "creation_date": 1426187721, "post_id": 28993888, "comment_id": 46280746, "body": "@Andr&#225;sKov&#225;cs Where is <code>merge</code> defined, in your last code block?"}, {"owner": {"reputation": 28873, "user_id": 1068232, "user_type": "registered", "accept_rate": 79, "profile_image": "https://www.gravatar.com/avatar/2a0a145ce58c20013969fe3f203531da?s=128&d=identicon&r=PG", "display_name": "Andr&#225;s Kov&#225;cs", "link": "https://stackoverflow.com/users/1068232/andr%c3%a1s-kov%c3%a1cs"}, "reply_to_user": {"reputation": 46235, "user_id": 2541573, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/Z1qtP.png?s=128&g=1", "display_name": "jub0bs", "link": "https://stackoverflow.com/users/2541573/jub0bs"}, "edited": false, "score": 0, "creation_date": 1426187867, "post_id": 28993888, "comment_id": 46280814, "body": "@Jubobs it&#39;s assumed the same as in the question."}, {"owner": {"reputation": 46235, "user_id": 2541573, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/Z1qtP.png?s=128&g=1", "display_name": "jub0bs", "link": "https://stackoverflow.com/users/2541573/jub0bs"}, "edited": false, "score": 0, "creation_date": 1426188057, "post_id": 28993888, "comment_id": 46280904, "body": "@Andr&#225;sKov&#225;cs Thanks for clarifying."}], "tags": [], "owner": {"reputation": 28873, "user_id": 1068232, "user_type": "registered", "accept_rate": 79, "profile_image": "https://www.gravatar.com/avatar/2a0a145ce58c20013969fe3f203531da?s=128&d=identicon&r=PG", "display_name": "Andr&#225;s Kov&#225;cs", "link": "https://stackoverflow.com/users/1068232/andr%c3%a1s-kov%c3%a1cs"}, "is_accepted": true, "score": 7, "last_activity_date": 1426104471, "last_edit_date": 1426104471, "creation_date": 1426096332, "answer_id": 28993888, "question_id": 28992450, "link": "https://stackoverflow.com/questions/28992450/is-this-a-correctly-implemented-mergesort-in-haskell/28993888#28993888", "title": "Is this a correctly implemented mergesort in Haskell?", "body": "<p><code>myMergeSort</code> is not a correct merge sort. It is a correct <a href=\"http://en.wikipedia.org/wiki/Insertion_sort\" rel=\"nofollow\">insertion sort</a> though. We start with an empty list, then insert the elements one-by-one into the correct position:</p>\n\n<pre><code>myMergeSort [2, 1, 4, 3] == \nfoldl merge [] [[2], [1], [4], [3]] ==\n((([] `merge` [2]) `merge` [1]) `merge` [4]) `merge` [3] == \n(([2] `merge` [1]) `merge` [4]) `merge` [3]\n([1, 2] `merge` [4]) `merge` [3] == \n[1, 2, 4] `merge` [3] == \n[1, 2, 3, 4]\n</code></pre>\n\n<p>Since each insertion takes linear time, the whole sort is quadratic. </p>\n\n<p><code>mergeSortOfficial</code> is technically right, but it's inefficient. <code>length</code> takes linear time, and it's called at each level of recursion for the total length of the list. <code>take</code> and <code>drop</code> are also linear. The overall complexity remains the optimal <code>n * log n</code>, but we run a couple of unnecessary circles. </p>\n\n<p>If we stick to top-down merging, we could do better with splitting the list to a list of elements with even indices and another with odd indices. Splitting is still linear, but it's only a single traversal instead of two (<code>length</code> and then <code>take</code> / <code>drop</code> in the <code>official</code> sort). </p>\n\n<pre><code>split :: [a] -&gt; ([a], [a])\nsplit = go [] [] where\n  go as bs []     = (as, bs)\n  go as bs (x:xs) = go (x:bs) as xs\n\nmergeSortOfficial :: [Int] -&gt; [Int]\nmergeSortOfficial [] = []\nmergeSortOfficial (x : []) = [x]\nmergeSortOfficial xs = \n  let (as, bs) = split xs in\n    merge (mergeSortOfficial as) (mergeSortOfficial bs)\n</code></pre>\n\n<p>As WillNess noted in the comments, the above <code>split</code> yields an unstable sort. We can use a stable alternative:</p>\n\n<pre><code>import Control.Arrow\n\nstableSplit :: [a] -&gt; ([a], [a])\nstableSplit xs = go xs xs where\n    go (x:xs) (_:_:ys) = first (x:) (go xs ys)\n    go xs     ys       = ([], xs)\n</code></pre>\n\n<p>The best way is probably doing a bottom-up merge. It's the approach the <a href=\"https://hackage.haskell.org/package/base-4.7.0.2/docs/src/Data-List.html#sort\" rel=\"nofollow\"><code>sort</code></a> in <code>Data.List</code> takes. Here we merge consecutive pairs of lists until there is only a single list left:</p>\n\n<pre><code>mergeSort :: Ord a =&gt; [a] -&gt; [a]\nmergeSort [] = []\nmergeSort xs = mergeAll (map (:[]) xs) where\n    mergePairs (x:y:ys) = merge x y : mergePairs ys\n    mergePairs xs       = xs\n\n    mergeAll [xs] = xs\n    mergeAll xs   = mergeAll (mergePairs xs)\n</code></pre>\n\n<p><code>Data.List.sort</code> works largely the same as above, except it starts with finding descending and ascending runs in the input instead of just creating singleton lists from the elements.</p>\n"}, {"comments": [{"owner": {"reputation": 46235, "user_id": 2541573, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/Z1qtP.png?s=128&g=1", "display_name": "jub0bs", "link": "https://stackoverflow.com/users/2541573/jub0bs"}, "edited": false, "score": 3, "creation_date": 1426097734, "post_id": 28994079, "comment_id": 46236737, "body": "<i>That&#39;s insertionSort, which is essentially the same algorithm as bubbleSort, depending on how you stare at it.</i> How do <i>you</i> stare at it? Bubble Sort and Insertion Sort may both have worst-case quadratic time complexity, but they&#39;re not the same algorithm."}, {"owner": {"reputation": 28873, "user_id": 1068232, "user_type": "registered", "accept_rate": 79, "profile_image": "https://www.gravatar.com/avatar/2a0a145ce58c20013969fe3f203531da?s=128&d=identicon&r=PG", "display_name": "Andr&#225;s Kov&#225;cs", "link": "https://stackoverflow.com/users/1068232/andr%c3%a1s-kov%c3%a1cs"}, "edited": false, "score": 0, "creation_date": 1426098228, "post_id": 28994079, "comment_id": 46237023, "body": "Note: an advantage of sorting via <code>Tree</code> is that it&#39;s quite obviously terminating (all recursive calls are structural). That might not be a big deal in Haskell, but it&#39;s nice in total langauges like Coq and Agda."}, {"owner": {"reputation": 44013, "user_id": 1477667, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/trgKM.jpg?s=128&g=1", "display_name": "dfeuer", "link": "https://stackoverflow.com/users/1477667/dfeuer"}, "edited": false, "score": 0, "creation_date": 1426100629, "post_id": 28994079, "comment_id": 46238532, "body": "Is that <code>mappend</code> associative? I could be convinced, but it&#39;s not obvious."}, {"owner": {"reputation": 44013, "user_id": 1477667, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/trgKM.jpg?s=128&g=1", "display_name": "dfeuer", "link": "https://stackoverflow.com/users/1477667/dfeuer"}, "edited": false, "score": 0, "creation_date": 1426103234, "post_id": 28994079, "comment_id": 46240078, "body": "Unrelatedly, this is making me wonder if it would be possible to write an interesting incremental quicksort for <code>Data.Sequence</code> using median-of-medians to choose pivots and getting just precise enough to build 2-3 trees."}, {"owner": {"reputation": 42094, "user_id": 828361, "user_type": "registered", "accept_rate": 44, "profile_image": "https://www.gravatar.com/avatar/6a82397672dcc1fca31c32508ef0798b?s=128&d=identicon&r=PG", "display_name": "pigworker", "link": "https://stackoverflow.com/users/828361/pigworker"}, "reply_to_user": {"reputation": 46235, "user_id": 2541573, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/Z1qtP.png?s=128&g=1", "display_name": "jub0bs", "link": "https://stackoverflow.com/users/2541573/jub0bs"}, "edited": false, "score": 1, "creation_date": 1426107587, "post_id": 28994079, "comment_id": 46242581, "body": "@Jubobs They have the same structure of comparisons and the same dataflow. See <a href=\"http://stackoverflow.com/a/21879087/828361\">this related answer of mine</a>. We call it insertion sort when we focus on saying where each input goes, and we call it bubble sort when we focus on saying where each output comes from, but it&#39;s the same process."}], "tags": [], "owner": {"reputation": 42094, "user_id": 828361, "user_type": "registered", "accept_rate": 44, "profile_image": "https://www.gravatar.com/avatar/6a82397672dcc1fca31c32508ef0798b?s=128&d=identicon&r=PG", "display_name": "pigworker", "link": "https://stackoverflow.com/users/828361/pigworker"}, "is_accepted": false, "score": 10, "last_activity_date": 1426096868, "creation_date": 1426096868, "answer_id": 28994079, "question_id": 28992450, "link": "https://stackoverflow.com/questions/28992450/is-this-a-correctly-implemented-mergesort-in-haskell/28994079#28994079", "title": "Is this a correctly implemented mergesort in Haskell?", "body": "<p>No, that's not <strong>mergeSort</strong>. That's <strong>insertionSort</strong>, which is essentially the same algorithm as <strong>bubbleSort</strong>, depending on how you stare at it. At each step, a singleton list is <code>merge</code>d with the accumulated ordered-list-so-far, so, effectively, the element of that singleton is inserted.</p>\n\n<p>As other commenters have already observed, to get <strong>mergeSort</strong> (and in particular, its efficiency), it's necessary to divide the problem repeatedly into roughly equal parts (rather than \"one element\" and \"the rest\"). The \"official\" solution gives a rather clunky way to do that. I quite like</p>\n\n<pre><code>foldr (\\ x (ys, zs) -&gt; (x : zs, ys)) ([], [])\n</code></pre>\n\n<p>as a way to split a list in two, not in the middle, but into elements in even and odd positions.</p>\n\n<p>If, like me, you like to have structure up front where you can see it, you can make ordered lists a <code>Monoid</code>.</p>\n\n<pre><code>import Data.Monoid\nimport Data.Foldable\nimport Control.Newtype\n\nnewtype Merge x = Merge {merged :: [x]}\ninstance Newtype (Merge x) [x] where\n  pack = Merge\n  unpack = merged\n\ninstance Ord x =&gt; Monoid (Merge x) where\n  mempty = Merge []\n  mappend (Merge xs) (Merge ys) = Merge (merge xs ys) where\n    -- merge is as you defined it\n</code></pre>\n\n<p>And now you have insertion sort just by</p>\n\n<pre><code>ala' Merge foldMap (:[]) :: [x] -&gt; [x]\n</code></pre>\n\n<p>One way to get the divide-and-conquer structure of mergeSort is to make it a data structure: binary trees.</p>\n\n<pre><code>data Tree x = None | One x | Node (Tree x) (Tree x) deriving Foldable\n</code></pre>\n\n<p>I haven't enforced a balancing invariant here, but I could. The point is that the same operation as before has another type</p>\n\n<pre><code>ala' Merge foldMap (:[]) :: Tree x -&gt; [x]\n</code></pre>\n\n<p>which merges lists collected from a treelike arrangement of elements. To obtain said arrangements, think \"what's cons for <code>Tree</code>?\" and make sure you keep your balance, by the same kind of twistiness I used in the above \"dividing\" operation.</p>\n\n<pre><code>twistin :: x -&gt; Tree x -&gt; Tree x   -- a very cons-like type\ntwistin x None        = One x\ntwistin x (One y)     = Node (One x) (One y)\ntwistin x (Node l r)  = Node (twistin x r) l\n</code></pre>\n\n<p>Now you have mergeSort by building a binary tree, then merging it.</p>\n\n<pre><code>mergeSort :: Ord x =&gt; [x] -&gt; [x]\nmergeSort = ala' Merge foldMap (:[]) . foldr twistin None\n</code></pre>\n\n<p>Of course, introducing the intermediate data structure has curiosity value, but you can easily cut it out and get something like</p>\n\n<pre><code>mergeSort :: Ord x =&gt; [x] -&gt; [x]\nmergeSort []   = []\nmergeSort [x]  = [x]\nmergeSort xs   = merge (mergeSort ys) (mergeSort zs) where\n  (ys, zs) = foldr (\\ x (ys, zs) -&gt; (x : zs, ys)) ([], []) xs\n</code></pre>\n\n<p>where the tree has become the recursion structure of the program.</p>\n"}], "owner": {"reputation": 983, "user_id": 3069376, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/e8074e4e3db3437023bdfc884a50e0e9?s=128&d=identicon&r=PG&f=1", "display_name": "user3069376", "link": "https://stackoverflow.com/users/3069376/user3069376"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 1009, "favorite_count": 2, "accepted_answer_id": 28993888, "answer_count": 2, "score": 2, "last_activity_date": 1426104471, "creation_date": 1426092200, "question_id": 28992450, "link": "https://stackoverflow.com/questions/28992450/is-this-a-correctly-implemented-mergesort-in-haskell", "title": "Is this a correctly implemented mergesort in Haskell?", "body": "<p>I could not find my code anywhere on the net, so can you please tell me why or why not the function <strong>myMergeSort</strong> is a mergesort? I know my function <strong>myMergeSort</strong> sorts, but am not sure if it really sorts using the mergesort algorithm or if it is a different algorithm. I just began with Haskell a few days ago.</p>\n\n<pre><code>merge xs [] = xs\nmerge [] ys = ys\nmerge (x : xs) (y : ys)\n    | x &lt;= y = x : merge xs (y : ys)\n    | otherwise = y : merge (x : xs) ys\n\nmyMergeSort :: [Int] -&gt; [Int]\nmyMergeSort [] = []\nmyMergeSort (x:[]) = [x]\nmyMergeSort (x:xs) = foldl merge [] (map (\\x -&gt; [x]) (x:xs))\n</code></pre>\n\n<p>I have no questions about the <strong>merge</strong> function.</p>\n\n<p>The following function <strong>mergeSortOfficial</strong> was the solution presented to us, I understand it but am not sure if I am implementing the mergesort algorithm in my function <strong>myMergeSort</strong> correctly or not.</p>\n\n<p>Official solution - implemenation:</p>\n\n<pre><code>mergeSortOfficial [] = []\nmergeSortOfficial (x : []) = [x]\nmergeSortOfficial xs = merge\n    (mergeSortOfficial (take ((length xs) \u2018div\u2018 2) xs))\n    (mergeSortOfficial (drop ((length xs) \u2018div\u2018 2) xs))\n</code></pre>\n"}, {"tags": ["scala", "haskell"], "comments": [{"owner": {"reputation": 64094, "user_id": 476408, "user_type": "registered", "accept_rate": 70, "profile_image": "https://www.gravatar.com/avatar/2bc1bffafe7aa29ef900b98d1fd1e94e?s=128&d=identicon&r=PG", "display_name": "J. Abrahamson", "link": "https://stackoverflow.com/users/476408/j-abrahamson"}, "edited": false, "score": 0, "creation_date": 1426096289, "post_id": 28992186, "comment_id": 46235788, "body": "It may be valuable to examine the Haskell &quot;errors&quot; package: <a href=\"http://hackage.haskell.org/package/errors\" rel=\"nofollow noreferrer\">hackage.haskell.org/package/errors</a>. You also generally ought to be replacing your calls to map with flatMap."}, {"owner": {"reputation": 1186, "user_id": 2220509, "user_type": "registered", "accept_rate": 37, "profile_image": "https://www.gravatar.com/avatar/d03eae74086fb336dbab9aed59cd59aa?s=128&d=identicon&r=PG", "display_name": "David H", "link": "https://stackoverflow.com/users/2220509/david-h"}, "edited": false, "score": 0, "creation_date": 1426098137, "post_id": 28992186, "comment_id": 46236972, "body": "if you will use flatMap, you cannot know what is the error for example list1.get(key1).flatMap(key=&gt;list2.get(key))  in case of None, you cannot know why its none, does it because of list1 or list2 ?"}], "answers": [{"comments": [{"owner": {"reputation": 1186, "user_id": 2220509, "user_type": "registered", "accept_rate": 37, "profile_image": "https://www.gravatar.com/avatar/d03eae74086fb336dbab9aed59cd59aa?s=128&d=identicon&r=PG", "display_name": "David H", "link": "https://stackoverflow.com/users/2220509/david-h"}, "edited": false, "score": 0, "creation_date": 1426139669, "post_id": 28995642, "comment_id": 46252585, "body": "good idea, but i think you have been confused with either convention ,Left- represent error ,Right - success"}, {"owner": {"reputation": 10394, "user_id": 1151929, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/922d81e934a0f2e3eb8b2c2d18022830?s=128&d=identicon&r=PG", "display_name": "sarveshseri", "link": "https://stackoverflow.com/users/1151929/sarveshseri"}, "reply_to_user": {"reputation": 1186, "user_id": 2220509, "user_type": "registered", "accept_rate": 37, "profile_image": "https://www.gravatar.com/avatar/d03eae74086fb336dbab9aed59cd59aa?s=128&d=identicon&r=PG", "display_name": "David H", "link": "https://stackoverflow.com/users/2220509/david-h"}, "edited": false, "score": 0, "creation_date": 1426145939, "post_id": 28995642, "comment_id": 46254908, "body": "Yes... convention... We should follow convention... But I like to do the opposite because roads in India are left-side drive, thus somehow for me right feels like the error path."}], "tags": [], "owner": {"reputation": 10394, "user_id": 1151929, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/922d81e934a0f2e3eb8b2c2d18022830?s=128&d=identicon&r=PG", "display_name": "sarveshseri", "link": "https://stackoverflow.com/users/1151929/sarveshseri"}, "is_accepted": false, "score": 1, "last_activity_date": 1426102142, "creation_date": 1426102142, "answer_id": 28995642, "question_id": 28992186, "link": "https://stackoverflow.com/questions/28992186/where-to-handle-monad-fails/28995642#28995642", "title": "Where to handle monad fails?", "body": "<p><code>Either</code> can be one of the better solutions for such cases,</p>\n\n<pre><code>// Explicit errors\nobject MyErrors {\n    trait MyError\n    object ServerNotIdentifiedError extends MyError\n    object CanNotGetValueFromServerError extends MyError\n    object ValueProcessingFailedError extends MyError \n}\n\nval server: Either[ Server, MyError ] = serverList.get(\"serverId\").match {\n  case Some( server ) =&gt; Left( server )\n  case None =&gt; Right( ServerNotIdentifiedError )\n}\n\n// assuming getDataFromServer returns Try[ Value ]\nval value:Either[ Value, MyError ] = getDataFromServer( serverId ) match {\n  case Success( value ) =&gt; Left( value ),\n  case Failure( ex ) =&gt; {\n    ex.printStackTrace();\n    Right( CanNotGetValueFromServerError )\n  }  \n}\n\n// assuming processValue returns Try[ OtherValue ]\nval processedValue: Either[ OtherValue, MyError ] = value match {\n  case Left( value ) =&gt; processValue(value) match {\n    case Success( otherValue ) =&gt; Left( otherValue )\n    case Failure( ex ) =&gt; {\n      ex.printStackTrace()\n      Right( ValueProcessingFailedError )\n    }\n  }\n  case _ =&gt; value\n}\n</code></pre>\n"}, {"comments": [{"owner": {"reputation": 1186, "user_id": 2220509, "user_type": "registered", "accept_rate": 37, "profile_image": "https://www.gravatar.com/avatar/d03eae74086fb336dbab9aed59cd59aa?s=128&d=identicon&r=PG", "display_name": "David H", "link": "https://stackoverflow.com/users/2220509/david-h"}, "edited": false, "score": 0, "creation_date": 1426139434, "post_id": 28997620, "comment_id": 46252515, "body": "its would be great if you can let me full example ! i would be glad to see that. its also can learn me why and where to use Applicative"}], "tags": [], "owner": {"reputation": 44013, "user_id": 1477667, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/trgKM.jpg?s=128&g=1", "display_name": "dfeuer", "link": "https://stackoverflow.com/users/1477667/dfeuer"}, "is_accepted": false, "score": 0, "last_activity_date": 1426108940, "creation_date": 1426108940, "answer_id": 28997620, "question_id": 28992186, "link": "https://stackoverflow.com/questions/28992186/where-to-handle-monad-fails/28997620#28997620", "title": "Where to handle monad fails?", "body": "<p>In Haskell, this is generally done with <code>Either</code>, <code>EitherT</code>, or <code>ExceptT</code> (<code>EitherT</code> and <code>ExceptT</code> are monad transformers and are almost identical). You can use <code>do</code> notation with any of these to string together actions that may fail and get out either a final result or information about the failure. In some situations, it can be nice use <code>Applicative</code> operators instead. For example,</p>\n\n<pre><code>f &lt;$&gt; e1 &lt;*&gt; e2 &lt;*&gt; e3\n</code></pre>\n\n<p>will calculate <code>e1</code>, <code>e2</code>, and <code>e3</code>, stopping if any fail, and if all succeeded will combine the results with <code>f</code>. You can even bring <code>Alternative</code> into the mix:</p>\n\n<pre><code>f &lt;$&gt; e1 &lt;*&gt; (e2 &lt;|&gt; e3)\n</code></pre>\n"}], "owner": {"reputation": 1186, "user_id": 2220509, "user_type": "registered", "accept_rate": 37, "profile_image": "https://www.gravatar.com/avatar/d03eae74086fb336dbab9aed59cd59aa?s=128&d=identicon&r=PG", "display_name": "David H", "link": "https://stackoverflow.com/users/2220509/david-h"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 161, "favorite_count": 0, "answer_count": 2, "score": 1, "last_activity_date": 1426108940, "creation_date": 1426091448, "last_edit_date": 1426091723, "question_id": 28992186, "link": "https://stackoverflow.com/questions/28992186/where-to-handle-monad-fails", "title": "Where to handle monad fails?", "body": "<p>I want to know what is the best way  in order to write code using monads(Option,Try,Either).\nMy first impression was that those monads should let me write the logic and  ignore errors, then based on the type result I would better know what happened. \nI will give an example </p>\n\n<pre><code>val a:Option[Something] = list.get(\"key\")\n</code></pre>\n\n<p>now I can operate on my value like I have it with map and flatMap<br>\nat the end of the code, if I have None it means the list doesnt have the \"key\". \nThis workflow works only when you have small logic.\nbut how should I write code if I have a lot of logic\ni.e :</p>\n\n<pre><code>val server:Option[Server] = serverList.get(\"serverId\")\nval value:Option[Try[Value]] = serverList.map(serverId=&gt;getDataFromServer(serverId))\nval processedValue:Option[Try[Some[OtherValue]]] = value.map(server =&gt; server.map( value=&gt; processValue(value))\n</code></pre>\n\n<p>now when handling error I will do something like:</p>\n\n<pre><code>processedValueOption match { \n   case None=&gt; .... // server is not identified\n   case Some(Failure(e)) =&gt;  //error to get value from server\n   case .......\n}\n</code></pre>\n\n<p>Actually my types let me know what is the error at the end of my code. \nBut it's becoming very complex types when you have big logic. \nHow do you think I should write the code? Should I handle errors when I write the logic in order to get simple types?</p>\n"}, {"tags": ["list", "haskell", "monads"], "comments": [{"owner": {"reputation": 507143, "user_id": 1048572, "user_type": "registered", "accept_rate": 77, "profile_image": "https://www.gravatar.com/avatar/7f2c4de95e8f4f8f5a71c3aaf0ed312a?s=128&d=identicon&r=PG", "display_name": "Bergi", "link": "https://stackoverflow.com/users/1048572/bergi"}, "edited": false, "score": 5, "creation_date": 1426083998, "post_id": 28989206, "comment_id": 46226886, "body": "First of all, you don&#39;t want to use <code>all (== True)</code> but <code>and</code> :-)"}, {"owner": {"reputation": 100892, "user_id": 745903, "user_type": "registered", "accept_rate": 74, "profile_image": "https://www.gravatar.com/avatar/50933f6638836741e620669b3940410e?s=128&d=identicon&r=PG", "display_name": "leftaroundabout", "link": "https://stackoverflow.com/users/745903/leftaroundabout"}, "edited": false, "score": 5, "creation_date": 1426084529, "post_id": 28989206, "comment_id": 46227289, "body": "Indeed, more generally: equality comparison on booleans is almost always needless. If it wasn&#39;t for <code>and</code>, you could still just write <code>all id</code>."}, {"owner": {"reputation": 126897, "user_id": 791604, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/ce991df7a056248d5e4f6fc3659ba733?s=128&d=identicon&r=PG", "display_name": "Daniel Wagner", "link": "https://stackoverflow.com/users/791604/daniel-wagner"}, "edited": false, "score": 1, "creation_date": 1426103773, "post_id": 28989206, "comment_id": 46240407, "body": "Your implementation does not &quot;short-circuit&quot; correctly: while the pure computation short-circuits, it must run all the side effects first. See <a href=\"http://hackage.haskell.org/package/monad-loops-0.4.2.1/docs/Control-Monad-Loops.html\" rel=\"nofollow noreferrer\"><code>andM</code></a> from the monad-loops package (and its brother, <code>allM</code>) for a version that only does as many side-effects as necessary to know the answer."}], "answers": [{"tags": [], "owner": {"reputation": 507143, "user_id": 1048572, "user_type": "registered", "accept_rate": 77, "profile_image": "https://www.gravatar.com/avatar/7f2c4de95e8f4f8f5a71c3aaf0ed312a?s=128&d=identicon&r=PG", "display_name": "Bergi", "link": "https://stackoverflow.com/users/1048572/bergi"}, "is_accepted": false, "score": 5, "last_activity_date": 1426087135, "last_edit_date": 1426087135, "creation_date": 1426084657, "answer_id": 28989511, "question_id": 28989206, "link": "https://stackoverflow.com/questions/28989206/how-to-use-all-with-a-monadic-function/28989511#28989511", "title": "How to use all with a monadic function?", "body": "<p>If you are already using <code>do</code>-notation, I wouldn't bother with <code>liftM</code> at all. Just go for</p>\n\n<pre><code>g xs = do cnds &lt;- mapM f xs\n          return $ if and cnds\n                     then 42\n                     else 0\n</code></pre>\n\n<hr>\n\n<p>Alternatively, if you want a lazy <code>all</code> that does not run all of the monads, I think you'll need to write it your own.</p>\n\n<pre><code>allM f xs = foldr (\\x acc -&gt; do b &lt;- f x; if b then return True else acc) (return True) xs\n\ng = fmap (\\cnd -&gt; if cnd then 42 else 0) . allM f\n\n-- much nicer with `bool`:\n\nallM f = foldr (\\x acc -&gt; f x &gt;&gt;= bool (return True) acc) (return True)\ng = fmap (bool 42 0) . allM f\n</code></pre>\n"}, {"comments": [{"owner": {"reputation": 100892, "user_id": 745903, "user_type": "registered", "accept_rate": 74, "profile_image": "https://www.gravatar.com/avatar/50933f6638836741e620669b3940410e?s=128&d=identicon&r=PG", "display_name": "leftaroundabout", "link": "https://stackoverflow.com/users/745903/leftaroundabout"}, "edited": false, "score": 0, "creation_date": 1426084942, "post_id": 28989571, "comment_id": 46227574, "body": "While you introduce <code>Control.Applicative</code>: it&#39;s worth noting that the function doesn&#39;t seem to need the <code>Monad</code> constraint \u2013 <code>Applicative</code> is sufficient for what <code>g</code> does (with <a href=\"http://hackage.haskell.org/package/base-4.7.0.2/docs/Data-Traversable.html#v:traverse\" rel=\"nofollow noreferrer\"><code>traverse</code></a> instead of <code>mapM</code>). So even if <code>f</code> needs <code>Monad</code>, it&#39;s better to keep the operators in <code>g</code> on that more basic level."}, {"owner": {"reputation": 51584, "user_id": 839246, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/9b0573c2b936b12828dd1e4cc04206dc?s=128&d=identicon&r=PG&f=1", "display_name": "bheklilr", "link": "https://stackoverflow.com/users/839246/bheklilr"}, "reply_to_user": {"reputation": 100892, "user_id": 745903, "user_type": "registered", "accept_rate": 74, "profile_image": "https://www.gravatar.com/avatar/50933f6638836741e620669b3940410e?s=128&d=identicon&r=PG", "display_name": "leftaroundabout", "link": "https://stackoverflow.com/users/745903/leftaroundabout"}, "edited": false, "score": 0, "creation_date": 1426085053, "post_id": 28989571, "comment_id": 46227666, "body": "@leftaroundabout The monad constraint comes from <code>f</code> rather than <code>mapM</code>.  It could be that <code>f</code>&#39;s constraint could be relaxed to <code>Applicative f =&gt; a -&gt; f Bool</code>, but that&#39;s unknown at this time."}, {"owner": {"reputation": 1452, "user_id": 538973, "user_type": "registered", "accept_rate": 79, "profile_image": "https://www.gravatar.com/avatar/f2dc3b359948acc418b091aef228d384?s=128&d=identicon&r=PG", "display_name": "RasmusWL", "link": "https://stackoverflow.com/users/538973/rasmuswl"}, "edited": false, "score": 0, "creation_date": 1426086175, "post_id": 28989571, "comment_id": 46228541, "body": "<code>and &lt;$&gt; mapM f xs</code> was really what I was looking for, great!"}, {"owner": {"reputation": 507143, "user_id": 1048572, "user_type": "registered", "accept_rate": 77, "profile_image": "https://www.gravatar.com/avatar/7f2c4de95e8f4f8f5a71c3aaf0ed312a?s=128&d=identicon&r=PG", "display_name": "Bergi", "link": "https://stackoverflow.com/users/1048572/bergi"}, "edited": false, "score": 1, "creation_date": 1426086229, "post_id": 28989571, "comment_id": 46228587, "body": "+1 for the <code>bool</code> function, but I think <code>bool 0 42 &lt;$&gt; and &lt;$&gt; mapM f xs</code> is really confusing as it uses <code>&lt;$&gt;</code> over two different Functor instances."}, {"owner": {"reputation": 51584, "user_id": 839246, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/9b0573c2b936b12828dd1e4cc04206dc?s=128&d=identicon&r=PG&f=1", "display_name": "bheklilr", "link": "https://stackoverflow.com/users/839246/bheklilr"}, "reply_to_user": {"reputation": 507143, "user_id": 1048572, "user_type": "registered", "accept_rate": 77, "profile_image": "https://www.gravatar.com/avatar/7f2c4de95e8f4f8f5a71c3aaf0ed312a?s=128&d=identicon&r=PG", "display_name": "Bergi", "link": "https://stackoverflow.com/users/1048572/bergi"}, "edited": false, "score": 0, "creation_date": 1426086375, "post_id": 28989571, "comment_id": 46228692, "body": "@Bergi What two functor instances?  It&#39;s the same functor instance, since it can also be represented as <code>bool 0 42 . and &lt;$&gt; mapM f xs</code> using the functor law <code>fmap f . fmap g = fmap (f . g)</code>, unless I&#39;m mistaken and this is parsed as <code>(bool 0 42 &lt;$&gt; and) &lt;$&gt; mapM f xs</code>, but in that case the <code>&lt;$&gt;</code> gets specialized to <code>.</code> anyway, giving it the same equational meaning."}, {"owner": {"reputation": 507143, "user_id": 1048572, "user_type": "registered", "accept_rate": 77, "profile_image": "https://www.gravatar.com/avatar/7f2c4de95e8f4f8f5a71c3aaf0ed312a?s=128&d=identicon&r=PG", "display_name": "Bergi", "link": "https://stackoverflow.com/users/1048572/bergi"}, "edited": false, "score": 0, "creation_date": 1426086592, "post_id": 28989571, "comment_id": 46228858, "body": "Yes, <code>&lt;$&gt;</code> is left-associative so this is parsed <code>(bool 0 42 &lt;$&gt; and) &lt;$&gt; mapM f xs</code>. And the first <code>&lt;$&gt;</code> is specialised to <code>.</code>, while the second is specialised to <code>liftM</code>!"}, {"owner": {"reputation": 51584, "user_id": 839246, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/9b0573c2b936b12828dd1e4cc04206dc?s=128&d=identicon&r=PG&f=1", "display_name": "bheklilr", "link": "https://stackoverflow.com/users/839246/bheklilr"}, "reply_to_user": {"reputation": 507143, "user_id": 1048572, "user_type": "registered", "accept_rate": 77, "profile_image": "https://www.gravatar.com/avatar/7f2c4de95e8f4f8f5a71c3aaf0ed312a?s=128&d=identicon&r=PG", "display_name": "Bergi", "link": "https://stackoverflow.com/users/1048572/bergi"}, "edited": false, "score": 1, "creation_date": 1426090546, "post_id": 28989571, "comment_id": 46231778, "body": "@Bergi Gotcha.  Still, you can transform between the two using equational reasoning pretty easily, but it does use both functor instances the way I&#39;ve written it.  I honestly don&#39;t mind the style since it just looks like you&#39;re just replacing <code>$</code> with <code>&lt;$&gt;</code>."}], "tags": [], "owner": {"reputation": 51584, "user_id": 839246, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/9b0573c2b936b12828dd1e4cc04206dc?s=128&d=identicon&r=PG&f=1", "display_name": "bheklilr", "link": "https://stackoverflow.com/users/839246/bheklilr"}, "is_accepted": true, "score": 5, "last_activity_date": 1426084805, "creation_date": 1426084805, "answer_id": 28989571, "question_id": 28989206, "link": "https://stackoverflow.com/questions/28989206/how-to-use-all-with-a-monadic-function/28989571#28989571", "title": "How to use all with a monadic function?", "body": "<p>If you <code>import Control.Applicative</code> and <code>Data.Bool</code> (if using <code>base &gt;= 4.7</code>), then you could write it as</p>\n\n<pre><code>g xs = bool 0 42 &lt;$&gt; and &lt;$&gt; mapM f xs\n-- Or equivalently\n-- g xs = bool 0 42 . and &lt;$&gt; mapM f xs\n-- g = fmap (bool 0 42 . and) . mapM f\n</code></pre>\n\n<p>But I don't think this gains you a whole lot.  Instead, you could also pull that <code>return</code> outside the <code>if-then-else</code>:</p>\n\n<pre><code>g xs = do cnd &lt;- and &lt;$&gt; mapM f xs\n          return $ if cnd then 42 else 0\n</code></pre>\n\n<p>Or even</p>\n\n<pre><code>g xs = do ys &lt;- mapM f xs\n          return $ if and ys then 42 else 0\n</code></pre>\n\n<p>I think one of the last two versions is what most people would be more comfortable seeing, although the last one just looks a bit weird for English speakers with the \"if and foo then bar else baz\"</p>\n"}], "owner": {"reputation": 1452, "user_id": 538973, "user_type": "registered", "accept_rate": 79, "profile_image": "https://www.gravatar.com/avatar/f2dc3b359948acc418b091aef228d384?s=128&d=identicon&r=PG", "display_name": "RasmusWL", "link": "https://stackoverflow.com/users/538973/rasmuswl"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 105, "favorite_count": 0, "accepted_answer_id": 28989571, "answer_count": 2, "score": 2, "last_activity_date": 1426087135, "creation_date": 1426083831, "last_edit_date": 1426084490, "question_id": 28989206, "link": "https://stackoverflow.com/questions/28989206/how-to-use-all-with-a-monadic-function", "title": "How to use all with a monadic function?", "body": "<p>I have found myself in a situation where I want to use <code>all</code> with a monadic function. In my mind this didn't really turn out too pretty:</p>\n\n<pre><code>f :: Monad m =&gt; a -&gt; m Bool\n\ng :: Monad m =&gt; [a] -&gt; m Int\ng xs = do cnd &lt;- liftM (all (== True)) $ mapM f xs\n          if cnd\n           then return 42\n           else return 0\n</code></pre>\n\n<p>Is there a Better\u2122 way to do this?</p>\n"}, {"tags": ["haskell"], "comments": [{"owner": {"reputation": 43759, "user_id": 1651941, "user_type": "registered", "accept_rate": 97, "profile_image": "https://www.gravatar.com/avatar/a513bc1fa519d2fcf5e4e0d9b5500101?s=128&d=identicon&r=PG", "display_name": "Sibi", "link": "https://stackoverflow.com/users/1651941/sibi"}, "edited": false, "score": 0, "creation_date": 1426082977, "post_id": 28988677, "comment_id": 46226096, "body": "What does you want the <code>inverseShow</code> to do ?"}, {"owner": {"reputation": 69792, "user_id": 493122, "user_type": "registered", "accept_rate": 96, "profile_image": "https://www.gravatar.com/avatar/1f90ae01c2e24801c2df9189179b0ccd?s=128&d=identicon&r=PG", "display_name": "Shoe", "link": "https://stackoverflow.com/users/493122/shoe"}, "edited": false, "score": 4, "creation_date": 1426083365, "post_id": 28988677, "comment_id": 46226400, "body": "You can&#39;t have an heterogeneous list of different types. So I&#39;m not sure what the hypothesis is here."}, {"owner": {"reputation": 21, "user_id": 3848960, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/8817a9969fdfc921cc52cfb88670270d?s=128&d=identicon&r=PG&f=1", "display_name": "mwaddoups", "link": "https://stackoverflow.com/users/3848960/mwaddoups"}, "reply_to_user": {"reputation": 43759, "user_id": 1651941, "user_type": "registered", "accept_rate": 97, "profile_image": "https://www.gravatar.com/avatar/a513bc1fa519d2fcf5e4e0d9b5500101?s=128&d=identicon&r=PG", "display_name": "Sibi", "link": "https://stackoverflow.com/users/1651941/sibi"}, "edited": false, "score": 0, "creation_date": 1426084248, "post_id": 28988677, "comment_id": 46227089, "body": "@Sibi You have <code>a</code> and a function <code>String -&gt; String</code>. You want to turn this function into something which still implements <code>Show</code> but has the effect of applying that function afterwards. I guess you could type <code>inverseShow</code> like <code>inverseShow :: (String -&gt; String) -&gt; a -&gt; InverseShow f a</code> where <code>show InverseShow f a = f . show a</code>. Probably inverseShow is not the best name for this!"}, {"owner": {"reputation": 490, "user_id": 635669, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/d0408d7a07f6d5460814d9016aef947c?s=128&d=identicon&r=PG", "display_name": "Guiraldelli", "link": "https://stackoverflow.com/users/635669/guiraldelli"}, "edited": false, "score": 0, "creation_date": 1426084486, "post_id": 28988677, "comment_id": 46227257, "body": "As far as I understand, your problem is: you have 5 elements of different types (<code>a</code>, <code>b</code>, <code>c</code>, <code>d</code>, <code>e</code>) and want to keep them in a list? Well, as Jeffrey pointed out, it isn&#39;t possible in Haskell, because all the elements of a list must have the same type. <i>However</i>, you could use a tuple for it. Or you could use a data type for it. Storing them as <code>String</code>s in a list isn&#39;t the idiomatic Haskell way, if that is your question."}, {"owner": {"reputation": 23444, "user_id": 414413, "user_type": "registered", "accept_rate": 79, "profile_image": "https://www.gravatar.com/avatar/6de2113f01432aa844dc85070ff33e89?s=128&d=identicon&r=PG", "display_name": "Cirdec", "link": "https://stackoverflow.com/users/414413/cirdec"}, "edited": false, "score": 2, "creation_date": 1426085277, "post_id": 28988677, "comment_id": 46227837, "body": "It is usually a &quot;best practice&quot; to look for an ordinary value level solution to a problem before using type level or quantified constraint level programming, like building actual <a href=\"https://hackage.haskell.org/package/HList-0.3.4.1/docs/Data-HList-HList.html\" rel=\"nofollow noreferrer\">heterogenous lists</a> or using existential qualification (which is completely pointless for <code>Show</code>). What <i>problem</i> are you trying to solve?"}, {"owner": {"reputation": 21, "user_id": 3848960, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/8817a9969fdfc921cc52cfb88670270d?s=128&d=identicon&r=PG&f=1", "display_name": "mwaddoups", "link": "https://stackoverflow.com/users/3848960/mwaddoups"}, "edited": false, "score": 0, "creation_date": 1426086197, "post_id": 28988677, "comment_id": 46228550, "body": "I&#39;ve edited the question with a &#39;solution&#39; to the problem I was trying to solve, though looking back it does feel like an overcomplication. Particularly since my main problem was just trying to write cleaner code than writing <code>show</code> 5 times..."}], "answers": [{"comments": [{"owner": {"reputation": 21, "user_id": 3848960, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/8817a9969fdfc921cc52cfb88670270d?s=128&d=identicon&r=PG&f=1", "display_name": "mwaddoups", "link": "https://stackoverflow.com/users/3848960/mwaddoups"}, "edited": false, "score": 0, "creation_date": 1426087547, "post_id": 28990244, "comment_id": 46229562, "body": "<code>zipwith ($)</code> is really nice. This is also much more normal logic than my approach. Nice answer!"}], "tags": [], "owner": {"reputation": 23444, "user_id": 414413, "user_type": "registered", "accept_rate": 79, "profile_image": "https://www.gravatar.com/avatar/6de2113f01432aa844dc85070ff33e89?s=128&d=identicon&r=PG", "display_name": "Cirdec", "link": "https://stackoverflow.com/users/414413/cirdec"}, "is_accepted": true, "score": 7, "last_activity_date": 1426086431, "creation_date": 1426086431, "answer_id": 28990244, "question_id": 28988677, "link": "https://stackoverflow.com/questions/28988677/how-to-apply-a-function-to-one-element-in-a-heterogeneous-list/28990244#28990244", "title": "How to apply a function to one element in a heterogeneous list?", "body": "<p>If you have 5 items, <code>a</code>, <code>b</code>, <code>c</code>, <code>d</code>, and <code>e</code> and the only thing you know about them is that they have <code>Show</code> instances, you can put everything<sup>\u2020</sup>  you know about them in a list by <code>show</code>ing them before you put them in the list.</p>\n\n<pre><code>items :: [String]\nitems = [show a, show b, show c, show d, show e]\n</code></pre>\n\n<p>If you want to do different things to the different elements of the list, like add a space before the third one, you can make a list of the different things to do.</p>\n\n<pre><code>changes :: [String -&gt; String]\nchanges = [id, id, (++) \" \", id, id]\n</code></pre>\n\n<p>Then apply the <code>changes</code> to the <code>items</code> in the list by zipping the two lists together, applying (with <code>$</code>) the change to the corresponding item.</p>\n\n<pre><code>changed :: [String]\nchanged = zipWith ($) changes items\n</code></pre>\n\n<hr>\n\n<p><sup>\u2020</sup>Techically <code>Show</code> has two other methods than <code>show</code> which would be captured by existential quantification, <a href=\"http://hackage.haskell.org/package/base-4.7.0.2/docs/Prelude.html#v:showsPrec\"><code>showsPrec</code></a> and <a href=\"http://hackage.haskell.org/package/base-4.7.0.2/docs/Prelude.html#v:showList\"><code>showList :: [a] -&gt; ShowS</code></a>. An existentially qualified <code>showList</code> is completely useless, the only thing you can do with it is repeat the same element over and over again (<code>showList []</code>, <code>showList [x]</code>, <code>showList[x,x]</code>, etc) because you can't prove that any other items have the same type to be put in a list with it. If you need <code>showsPrec</code> you don't need <code>show</code> because <code>show = ($ \"\") . showsPrec 0</code>. </p>\n"}], "owner": {"reputation": 21, "user_id": 3848960, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/8817a9969fdfc921cc52cfb88670270d?s=128&d=identicon&r=PG&f=1", "display_name": "mwaddoups", "link": "https://stackoverflow.com/users/3848960/mwaddoups"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 152, "favorite_count": 0, "accepted_answer_id": 28990244, "answer_count": 1, "score": 0, "last_activity_date": 1426086431, "creation_date": 1426082537, "last_edit_date": 1426086076, "question_id": 28988677, "link": "https://stackoverflow.com/questions/28988677/how-to-apply-a-function-to-one-element-in-a-heterogeneous-list", "title": "How to apply a function to one element in a heterogeneous list?", "body": "<p>So I'm trying to work out the most haskell-ish way to do the following (as still a reasonable beginner):</p>\n\n<p>You have a heterogeneous list with different types inside. In my code I'm using <code>Show</code>. What I want to achieve is to do something to one element in this list as well after showing it. Currently you would write (naively)</p>\n\n<pre><code>[show a, show b, (++) \" \" $ show c, show d, show e]\n</code></pre>\n\n<p>Is there some way to pack the function <code>(++) \" \"</code> with the value <code>c</code> so you could write something like</p>\n\n<pre><code>map show [a, b, inverseShow ((++) \" \") c, d, e] -- not real haskell\n</code></pre>\n\n<p>or is this not possible in the language?</p>\n\n<p>I am aware you can use existential quantifiers to get part way there</p>\n\n<pre><code>data ShowBox = forall s. Show s =&gt; SB s\ninstance Show ShowBox where show (SB s) = show s\n\nmap show [SB a, SB b, SB c, SB d, SB e]\n</code></pre>\n\n<p>but I'm struggling to see how to move from this to my desired functionality in the 'best practice' way?</p>\n\n<p>EDIT: After reading the comments below, I've pretty much come to the conclusion this is not the best way to write the code. Below is an implementation of the sort of behaviour I wanted:</p>\n\n<pre><code>{-# LANGUAGE ExistentialQuantification #-}\n\ndata ShowAndTell = forall s. Show s =&gt; STell s (String -&gt; String)\ninstance Show ShowAndTell where show (STell s f) = f $ (show s)\n\nst :: (Show a) =&gt; a -&gt; ShowAndTell\nst a = STell a id\n\naddSpace :: String -&gt; String\naddSpace x = x ++ \" \"\n\nmain = (mapM_ putStrLn) . (map show) $ [st \"1\", st 3, STell 5.5 addSpace]\n</code></pre>\n\n<p>This outputs <code>\"1\"</code>,<code>3</code>,<code>5.5</code> but could be described as rather ugly!</p>\n"}, {"tags": ["performance", "haskell", "parallel-processing"], "comments": [{"owner": {"reputation": 13626, "user_id": 492865, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/5c69a2080e68c8606961a18aba3a08ec?s=128&d=identicon&r=PG", "display_name": "Yuras", "link": "https://stackoverflow.com/users/492865/yuras"}, "edited": false, "score": 1, "creation_date": 1426064095, "post_id": 28981974, "comment_id": 46213539, "body": "Did you try threadscope? <a href=\"https://wiki.haskell.org/ThreadScope\" rel=\"nofollow noreferrer\">wiki.haskell.org/ThreadScope</a>"}, {"owner": {"reputation": 716, "user_id": 1995474, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/ae968c7b168bb164fc30f3e3254a8478?s=128&d=identicon&r=PG", "display_name": "Stephan", "link": "https://stackoverflow.com/users/1995474/stephan"}, "reply_to_user": {"reputation": 13626, "user_id": 492865, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/5c69a2080e68c8606961a18aba3a08ec?s=128&d=identicon&r=PG", "display_name": "Yuras", "link": "https://stackoverflow.com/users/492865/yuras"}, "edited": false, "score": 0, "creation_date": 1426065295, "post_id": 28981974, "comment_id": 46214285, "body": "Yes, I have used it before, and just now tried it on this code. It does give some insights, in particular it shows how often the GC interrupts things, but the overall time spent in GC is not so large, as seen in the above stats outputs. Threadscope also confirms that most of the time, all four threads are in full use, but my main question is why the overall workload (CPU time) is so much bigger than with the single-threaded code (35s vs. 20s), not sure how threadscope can help me there."}, {"owner": {"reputation": 27942, "user_id": 96982, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/rX1ss.png?s=128&g=1", "display_name": "GS - Apologise to Monica", "link": "https://stackoverflow.com/users/96982/gs-apologise-to-monica"}, "edited": false, "score": 6, "creation_date": 1426065612, "post_id": 28981974, "comment_id": 46214488, "body": "Can you share some actual code that exhibits this behaviour?"}, {"owner": {"reputation": 13626, "user_id": 492865, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/5c69a2080e68c8606961a18aba3a08ec?s=128&d=identicon&r=PG", "display_name": "Yuras", "link": "https://stackoverflow.com/users/492865/yuras"}, "edited": false, "score": 0, "creation_date": 1426066394, "post_id": 28981974, "comment_id": 46214992, "body": "It could be an overhead of context switches because of GC. Could you please paste GC and memory stats (number of GC per generation, total allocated, copied and resident memory)."}, {"owner": {"reputation": 716, "user_id": 1995474, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/ae968c7b168bb164fc30f3e3254a8478?s=128&d=identicon&r=PG", "display_name": "Stephan", "link": "https://stackoverflow.com/users/1995474/stephan"}, "edited": false, "score": 0, "creation_date": 1426068053, "post_id": 28981974, "comment_id": 46216011, "body": "just posted the full stats output"}, {"owner": {"reputation": 13626, "user_id": 492865, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/5c69a2080e68c8606961a18aba3a08ec?s=128&d=identicon&r=PG", "display_name": "Yuras", "link": "https://stackoverflow.com/users/492865/yuras"}, "edited": false, "score": 2, "creation_date": 1426070529, "post_id": 28981974, "comment_id": 46217538, "body": "I&#39;m sure you reached memory throughput limit. Probably you are allocating data, but don&#39;t use it immediately. Try biographical memory profiling."}, {"owner": {"reputation": 22266, "user_id": 649287, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/7c0ea0055b84020bf860c05f53ba53d5?s=128&d=identicon&r=PG", "display_name": "augustss", "link": "https://stackoverflow.com/users/649287/augustss"}, "reply_to_user": {"reputation": 13626, "user_id": 492865, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/5c69a2080e68c8606961a18aba3a08ec?s=128&d=identicon&r=PG", "display_name": "Yuras", "link": "https://stackoverflow.com/users/492865/yuras"}, "edited": false, "score": 0, "creation_date": 1426097478, "post_id": 28981974, "comment_id": 46236568, "body": "I agree with @Yuras, I would not be surprised if the slowdown is due to hardware limitations.  You&#39;d have to find instruction and cycle counts to decide that."}, {"owner": {"reputation": 27942, "user_id": 96982, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/rX1ss.png?s=128&g=1", "display_name": "GS - Apologise to Monica", "link": "https://stackoverflow.com/users/96982/gs-apologise-to-monica"}, "edited": false, "score": 0, "creation_date": 1426195593, "post_id": 28981974, "comment_id": 46284585, "body": "I&#39;m voting to close for now because there isn&#39;t enough information to actually answer the question, all we can do is guess. Happy to retract/reopen if the question becomes more specific."}, {"owner": {"reputation": 716, "user_id": 1995474, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/ae968c7b168bb164fc30f3e3254a8478?s=128&d=identicon&r=PG", "display_name": "Stephan", "link": "https://stackoverflow.com/users/1995474/stephan"}, "edited": false, "score": 0, "creation_date": 1426202894, "post_id": 28981974, "comment_id": 46287513, "body": "OK, fair enough. Sorry I couldn&#39;t come up with a short example, the real code is too involved. Anyway, the comments helped me already. Thanks!"}, {"owner": {"reputation": 13626, "user_id": 492865, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/5c69a2080e68c8606961a18aba3a08ec?s=128&d=identicon&r=PG", "display_name": "Yuras", "link": "https://stackoverflow.com/users/492865/yuras"}, "reply_to_user": {"reputation": 27942, "user_id": 96982, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/rX1ss.png?s=128&g=1", "display_name": "GS - Apologise to Monica", "link": "https://stackoverflow.com/users/96982/gs-apologise-to-monica"}, "edited": false, "score": 0, "creation_date": 1426240033, "post_id": 28981974, "comment_id": 46299510, "body": "@GaneshSittampalam I disagree. I&#39;m not sure my explanation is correct, but it is definitely not a guess."}, {"owner": {"reputation": 27942, "user_id": 96982, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/rX1ss.png?s=128&g=1", "display_name": "GS - Apologise to Monica", "link": "https://stackoverflow.com/users/96982/gs-apologise-to-monica"}, "edited": false, "score": 0, "creation_date": 1426267700, "post_id": 28981974, "comment_id": 46317456, "body": "OK, I&#39;ve retracted my vote, though it still feels a bit too vague to me."}], "answers": [{"comments": [{"owner": {"reputation": 445, "user_id": 189176, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/274a52c00e4f37979f33423fc8acf371?s=128&d=identicon&r=PG", "display_name": "Carter Tazio Schonwald", "link": "https://stackoverflow.com/users/189176/carter-tazio-schonwald"}, "edited": false, "score": 2, "creation_date": 1426258391, "post_id": 29029072, "comment_id": 46311401, "body": "from a cursory google: modern ram has a bandwidth of roughly 5-10Gb/sec, while l2 cache and l1 cache have a throughput in the 200-1000gb/sec range on some modern systems, and l3 cache is 50-100gb/s. Thus, there might be a bit of a performance cliff the moment the nursery is larger than your systems L3 cache."}, {"owner": {"reputation": 716, "user_id": 1995474, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/ae968c7b168bb164fc30f3e3254a8478?s=128&d=identicon&r=PG", "display_name": "Stephan", "link": "https://stackoverflow.com/users/1995474/stephan"}, "edited": false, "score": 0, "creation_date": 1426377073, "post_id": 29029072, "comment_id": 46348505, "body": "Thanks, Yuras and Carter. I will check via biographical profiling and get back here to check whether this answer is correct, it makes sense!"}, {"owner": {"reputation": 27942, "user_id": 96982, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/rX1ss.png?s=128&g=1", "display_name": "GS - Apologise to Monica", "link": "https://stackoverflow.com/users/96982/gs-apologise-to-monica"}, "edited": false, "score": 1, "creation_date": 1426512302, "post_id": 29029072, "comment_id": 46389162, "body": "If this theory is correct, you should be able to reproduce the slowdown by running n copies of your single-threaded setup in different processes simultaneously - might be worth giving that a go."}, {"owner": {"reputation": 716, "user_id": 1995474, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/ae968c7b168bb164fc30f3e3254a8478?s=128&d=identicon&r=PG", "display_name": "Stephan", "link": "https://stackoverflow.com/users/1995474/stephan"}, "edited": false, "score": 0, "creation_date": 1433499146, "post_id": 29029072, "comment_id": 49389785, "body": "OK, it all makes sense, although I couldn&#39;t really prove this hypothesis. I mark this as answered as its be the best guess we have. Thanks!"}, {"owner": {"reputation": 716, "user_id": 1995474, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/ae968c7b168bb164fc30f3e3254a8478?s=128&d=identicon&r=PG", "display_name": "Stephan", "link": "https://stackoverflow.com/users/1995474/stephan"}, "edited": false, "score": 0, "creation_date": 1444124111, "post_id": 29029072, "comment_id": 53757699, "body": "OK. After some time I reimplemented my code using mutable state which is a lot more efficient in memory usage. And now it turns out that the overhead vanished, and speed gain by parallelisation is almost linear. So I think that shows that memory throughput was a major issue! Thanks!"}], "tags": [], "owner": {"reputation": 13626, "user_id": 492865, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/5c69a2080e68c8606961a18aba3a08ec?s=128&d=identicon&r=PG", "display_name": "Yuras", "link": "https://stackoverflow.com/users/492865/yuras"}, "is_accepted": true, "score": 3, "last_activity_date": 1426239870, "creation_date": 1426239870, "answer_id": 29029072, "question_id": 28981974, "link": "https://stackoverflow.com/questions/28981974/how-to-reduce-haskells-parallelization-overhead/29029072#29029072", "title": "How to reduce Haskell&#39;s parallelization overhead?", "body": "<p>I see people are voting to close the question because there is not enough details, but I believe the answer can be found using the already provided information (though more details are always welcome.)</p>\n\n<p>My nose tells me that you are limited by memory throughput. I'll try to describe why I think so, but I'm not a hardware expert, so I could be partially or totally wrong. After all, it is based on my personal set of hardware architecture myths.</p>\n\n<p>Lets assume that the limit is somewhere in between 50-100Gb per second (I'm not sure it is correct number, please correct me if you have better one.)</p>\n\n<p>You are allocating 54Gb in 10 sec (the <code>-N4</code> case), so you have 5Gb/sec throughput. It is pretty high, but usually it is not an issue on itself.</p>\n\n<p>Most of allocations are usually short living, and they are GC'd once the gen0 allocation area (nursery) is filled up. By default the nursery size is 512 Kb, so all the allocations occur in L2 cache. So short living data will never go into the main memory, that is why it is almost free.</p>\n\n<p>But you increased nursery size to 100Mb. It will not fit the L2 cache, and will be transfered to the main memory. That is already a bad sign.</p>\n\n<p>Well, 5Gb/sec is far from the limit. But there is a reason why you increased the nursery size -- your data is not short living. It will be used somewhere else after some lag. That means that this 54Gb will be loaded from the main memory back to caches sooner or later. So you have 10Gb/sec throughput at least.</p>\n\n<p>It is still far from the limit, but note, that it is the best-case scenario -- sequential memory access pattern. In reality you are accessing memory in random order, so the same cache lines are loaded and unloaded multiple times, and you easily reach 100Gb/sec.</p>\n\n<p>To fix the issue, you should identify why our data is not short living and try to fix that. If that is not possible, you can try to increase data locality and change memory access pattern to make it sequential.</p>\n\n<p>I'd like to know what hardware experts think about my naive explanation :)</p>\n"}], "owner": {"reputation": 716, "user_id": 1995474, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/ae968c7b168bb164fc30f3e3254a8478?s=128&d=identicon&r=PG", "display_name": "Stephan", "link": "https://stackoverflow.com/users/1995474/stephan"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 280, "favorite_count": 2, "accepted_answer_id": 29029072, "answer_count": 1, "score": 12, "last_activity_date": 1426239870, "creation_date": 1426063599, "last_edit_date": 1426067974, "question_id": 28981974, "link": "https://stackoverflow.com/questions/28981974/how-to-reduce-haskells-parallelization-overhead", "title": "How to reduce Haskell&#39;s parallelization overhead?", "body": "<p>I am trying to understand Haskell's parallelization performance.</p>\n\n<p>I have a long list (length >1000) that I am evaluating in parallel, using parallel's <code>parMap</code>.</p>\n\n<p>Here is the full stats output using <code>+RTS -s</code> for a single thread (EDIT: full stats output):</p>\n\n<pre><code>        54,248,802,288 bytes allocated in the heap\n           324,451,424 bytes copied during GC\n             2,970,272 bytes maximum residency (4 sample(s))\n                52,064 bytes maximum slop\n                   217 MB total memory in use (1 MB lost due to fragmentation)\n\n                                          Tot time (elapsed)  Avg pause  Max pause\n        Gen  0       251 colls,     0 par    1.45s    1.49s     0.0059s    0.0290s\n        Gen  1         4 colls,     0 par    0.03s    0.05s     0.0125s    0.0319s\n\n        TASKS: 4 (1 bound, 3 peak workers (3 total), using -N1)\n\n        SPARKS: 6688 (0 converted, 0 overflowed, 0 dud, 1439 GC'd, 5249 fizzled)\n\n        INIT    time    0.00s  (  0.03s elapsed)\n        MUT     time   19.76s  ( 20.20s elapsed)\n        GC      time    1.48s  (  1.54s elapsed)\n        EXIT    time    0.00s  (  0.00s elapsed)\n        Total   time   21.25s  ( 21.78s elapsed)\n\n        Alloc rate    2,745,509,084 bytes per MUT second\n\n        Productivity  93.0% of total user, 90.8% of total elapsed\n\n      gc_alloc_block_sync: 0\n      whitehole_spin: 0\n      gen[0].sync: 0\n      gen[1].sync: 0\n</code></pre>\n\n<p>If I run on two threads, using <code>+RTS -N2</code>, I get:</p>\n\n<pre><code>        54,336,738,680 bytes allocated in the heap\n           346,562,320 bytes copied during GC\n             5,437,368 bytes maximum residency (5 sample(s))\n               120,000 bytes maximum slop\n                   432 MB total memory in use (0 MB lost due to fragmentation)\n\n                                          Tot time (elapsed)  Avg pause  Max pause\n        Gen  0       127 colls,   127 par    2.07s    0.99s     0.0078s    0.0265s\n        Gen  1         5 colls,     4 par    0.08s    0.04s     0.0080s    0.0118s\n\n        Parallel GC work balance: 41.39% (serial 0%, perfect 100%)\n\n        TASKS: 6 (1 bound, 5 peak workers (5 total), using -N2)\n\n        SPARKS: 6688 (6628 converted, 0 overflowed, 0 dud, 0 GC'd, 60 fizzled)\n\n        INIT    time    0.00s  (  0.01s elapsed)\n        MUT     time   25.31s  ( 13.35s elapsed)\n        GC      time    2.15s  (  1.03s elapsed)\n        EXIT    time    0.01s  (  0.01s elapsed)\n        Total   time   27.48s  ( 14.40s elapsed)\n\n        Alloc rate    2,146,509,982 bytes per MUT second\n\n        Productivity  92.2% of total user, 175.9% of total elapsed\n\n      gc_alloc_block_sync: 19922\n      whitehole_spin: 0\n      gen[0].sync: 1\n      gen[1].sync: 0\n</code></pre>\n\n<p>and on four threads:</p>\n\n<pre><code>        54,307,370,096 bytes allocated in the heap\n           367,282,056 bytes copied during GC\n             8,561,960 bytes maximum residency (6 sample(s))\n             3,885,784 bytes maximum slop\n                   860 MB total memory in use (0 MB lost due to fragmentation)\n\n                                          Tot time (elapsed)  Avg pause  Max pause\n        Gen  0        62 colls,    62 par    2.45s    0.70s     0.0113s    0.0179s\n        Gen  1         6 colls,     5 par    0.20s    0.07s     0.0112s    0.0146s\n\n        Parallel GC work balance: 40.57% (serial 0%, perfect 100%)\n\n        TASKS: 10 (1 bound, 9 peak workers (9 total), using -N4)\n\n        SPARKS: 6688 (6621 converted, 0 overflowed, 0 dud, 3 GC'd, 64 fizzled)\n\n        INIT    time    0.01s  (  0.01s elapsed)\n        MUT     time   37.26s  ( 10.95s elapsed)\n        GC      time    2.65s  (  0.77s elapsed)\n        EXIT    time    0.01s  (  0.01s elapsed)\n        Total   time   39.94s  ( 11.76s elapsed)\n\n        Alloc rate    1,457,427,453 bytes per MUT second\n\n        Productivity  93.4% of total user, 317.2% of total elapsed\n\n      gc_alloc_block_sync: 23494\n      whitehole_spin: 0\n      gen[0].sync: 10527\n      gen[1].sync: 38\n</code></pre>\n\n<p>So according to the elapsed time (the last number in each output), with two cores the program takes ~66% of the single-threaded version, and with four cores it takes 54% of the time. This speedup is not too bad, but far worse than the theoretically expected linear improvement with the number of cores, which would result in 25% runtime with four cores.</p>\n\n<p>Now, when looking at the above statistic outputs, I can see that the actual working CPU time for the program (the rows starting with <code>MUT</code>) increases remarkably with using more cores. With 1, 2 and 4 cores I get a CPU time of 19.76s, 25.31s and 37.26s, and this increase is what is - I believe - eating up my parallelization performance.</p>\n\n<p>The typical reasons for such a CPU runtime overhead with multiple cores that come to my mind are:</p>\n\n<ul>\n<li>too fine granularity of workload distribution. However, I tried the same program using <code>parListChunked</code> from the <code>parallel</code> package, with a chunk size of 10. But the result is very similar, so I do not at the moment think that the overhead is due to a too fine granularity.</li>\n<li>Garbage collection: This was a big performance killer for my code in the past, but since I increased the GC size to 100Mb the total time spent in GC is quite small, as seen in the stats above.</li>\n</ul>\n\n<p>What are other reasons for such a strong overhead, and how can I mitigate them?</p>\n"}, {"tags": ["haskell", "rdf", "linked-data"], "comments": [{"owner": {"reputation": 40039, "user_id": 699224, "user_type": "registered", "accept_rate": 67, "profile_image": "https://www.gravatar.com/avatar/4feb08afcd7c57acb72bd49fc2bf834d?s=128&d=identicon&r=PG", "display_name": "DNA", "link": "https://stackoverflow.com/users/699224/dna"}, "edited": false, "score": 0, "creation_date": 1426235337, "post_id": 28979071, "comment_id": 46297109, "body": "What&#39;s the exact data you are are querying? - can you show us the relevant triples (just the ones that ought to match your query)?"}, {"owner": {"reputation": 2550, "user_id": 1366643, "user_type": "registered", "accept_rate": 53, "profile_image": "https://i.stack.imgur.com/QFRXO.jpg?s=128&g=1", "display_name": "Herokiller", "link": "https://stackoverflow.com/users/1366643/herokiller"}, "reply_to_user": {"reputation": 40039, "user_id": 699224, "user_type": "registered", "accept_rate": 67, "profile_image": "https://www.gravatar.com/avatar/4feb08afcd7c57acb72bd49fc2bf834d?s=128&d=identicon&r=PG", "display_name": "DNA", "link": "https://stackoverflow.com/users/699224/dna"}, "edited": false, "score": 0, "creation_date": 1426236921, "post_id": 28979071, "comment_id": 46297859, "body": "@DNA I want to get &quot;<a href=\"http://live.dbpedia.org/resource/Madrid\" rel=\"nofollow noreferrer\">live.dbpedia.org/resource/Madrid</a>&quot;, by &quot;<a href=\"http://live.dbpedia.org/resource/Spain\" rel=\"nofollow noreferrer\">live.dbpedia.org/resource/Spain</a>&quot; and &quot;<a href=\"http://live.dbpedia.org/property/capital\" rel=\"nofollow noreferrer\">live.dbpedia.org/property/capital</a>&quot;"}, {"owner": {"reputation": 40039, "user_id": 699224, "user_type": "registered", "accept_rate": 67, "profile_image": "https://www.gravatar.com/avatar/4feb08afcd7c57acb72bd49fc2bf834d?s=128&d=identicon&r=PG", "display_name": "DNA", "link": "https://stackoverflow.com/users/699224/dna"}, "edited": false, "score": 0, "creation_date": 1426244671, "post_id": 28979071, "comment_id": 46302260, "body": "Note that the data contains both an <code>ns2</code> prefix, mapped to <code>http:&#47;&#47;live.dbpedia.org&#47;property&#47;</code> and an <code>ns3</code> prefix, mapped to <code>http:&#47;&#47;live.dbpedia.org&#47;ontology&#47;</code> and the Spain resource has both an <code>ns2:capital</code> and an <code>ns3:capital</code> property (both pointing to Madrid)"}, {"owner": {"reputation": 2550, "user_id": 1366643, "user_type": "registered", "accept_rate": 53, "profile_image": "https://i.stack.imgur.com/QFRXO.jpg?s=128&g=1", "display_name": "Herokiller", "link": "https://stackoverflow.com/users/1366643/herokiller"}, "reply_to_user": {"reputation": 40039, "user_id": 699224, "user_type": "registered", "accept_rate": 67, "profile_image": "https://www.gravatar.com/avatar/4feb08afcd7c57acb72bd49fc2bf834d?s=128&d=identicon&r=PG", "display_name": "DNA", "link": "https://stackoverflow.com/users/699224/dna"}, "edited": false, "score": 0, "creation_date": 1426245419, "post_id": 28979071, "comment_id": 46302669, "body": "@DNA but I know I need this <a href=\"http://live.dbpedia.org/property/capital\" rel=\"nofollow noreferrer\">live.dbpedia.org/property/capital</a> one, and cannot get real uri only &quot;ns3:string&quot; thing"}], "answers": [{"tags": [], "owner": {"reputation": 1722, "user_id": 1526266, "user_type": "registered", "accept_rate": 76, "profile_image": "https://i.stack.imgur.com/1HT7M.jpg?s=128&g=1", "display_name": "Rob Stewart", "link": "https://stackoverflow.com/users/1526266/rob-stewart"}, "is_accepted": false, "score": 1, "last_activity_date": 1445346393, "creation_date": 1445346393, "answer_id": 33237500, "question_id": 28979071, "link": "https://stackoverflow.com/questions/28979071/how-to-get-data-from-rdf-in-haskell-rdf4h/33237500#33237500", "title": "How to get data from rdf in haskell rdf4h", "body": "<p>This appears to be a shortcoming in the rdf4h API. For now, the way to write your query is:</p>\n\n<pre><code>Right (rdf::TriplesGraph) &lt;- parseURL\n           (XmlParser Nothing Nothing)\n           \"http://live.dbpedia.org/data/Spain.rdf\"\nlet c = query rdf\n          (Just (UNode \"http://live.dbpedia.org/resource/Spain\"))\n          (Just (UNode \"ns2:capital\"))\n          Nothing\n</code></pre>\n\n<p>I'll look to add a function to the API:</p>\n\n<pre><code>queryExpanded :: rdf -&gt; Maybe Node -&gt; Maybe Node -&gt; Maybe Node -&gt; Triples\n</code></pre>\n\n<p>Which would, when its implemented in the future, let you write:</p>\n\n<pre><code>let c = queryExpanded rdf\n          (Just (UNode \"http://live.dbpedia.org/resource/Spain\"))\n          (Just (UNode \"http://live.dbpedia.org/property/capital\"))\n          Nothing\n</code></pre>\n"}], "owner": {"reputation": 2550, "user_id": 1366643, "user_type": "registered", "accept_rate": 53, "profile_image": "https://i.stack.imgur.com/QFRXO.jpg?s=128&g=1", "display_name": "Herokiller", "link": "https://stackoverflow.com/users/1366643/herokiller"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 171, "favorite_count": 0, "answer_count": 1, "score": 2, "last_activity_date": 1445346393, "creation_date": 1426050995, "last_edit_date": 1426312487, "question_id": 28979071, "link": "https://stackoverflow.com/questions/28979071/how-to-get-data-from-rdf-in-haskell-rdf4h", "title": "How to get data from rdf in haskell rdf4h", "body": "<p>Im trying to get the capital of the country from rdf using rdf4h</p>\n\n<pre><code>Right (rdf::TriplesGraph) &lt;- parseURL (XmlParser Nothing Nothing) \"http://live.dbpedia.org/data/Spain.rdf\"\n\nlet c = query rdf (Just (UNode \"http://live.dbpedia.org/resource/Spain\"))  (Just (UNode \"http://live.dbpedia.org/property/capital\")) Nothing\n</code></pre>\n\n<p>but it returns empty list</p>\n\n<p>I can see that it has triple with </p>\n\n<pre><code>\"ns3:string\" \n</code></pre>\n\n<p>predicate, instead of </p>\n\n<pre><code>\"http://live.dbpedia.org/property/capital\"\n</code></pre>\n\n<p>after parsing URL, </p>\n\n<p>How should I resolve this or am I missing some other method?</p>\n\n<p>Edit: found this function</p>\n\n<pre><code>uniqTriplesOf :: rdf -&gt; Triples\n</code></pre>\n\n<p>which does expand the namespaces, now the question is how can I query this rdf by full uris</p>\n"}, {"tags": ["haskell", "typeclass", "applicative"], "answers": [{"comments": [{"owner": {"reputation": 40537, "user_id": 465378, "user_type": "registered", "accept_rate": 85, "profile_image": "https://www.gravatar.com/avatar/c03b8d34978563858020eff0d14cc17b?s=128&d=identicon&r=PG", "display_name": "Alexis King", "link": "https://stackoverflow.com/users/465378/alexis-king"}, "edited": false, "score": 0, "creation_date": 1426050714, "post_id": 28979004, "comment_id": 46208385, "body": "Why specially <code>IO</code>? Is that just an arbitrary default?"}, {"owner": {"reputation": 44013, "user_id": 1477667, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/trgKM.jpg?s=128&g=1", "display_name": "dfeuer", "link": "https://stackoverflow.com/users/1477667/dfeuer"}, "reply_to_user": {"reputation": 40537, "user_id": 465378, "user_type": "registered", "accept_rate": 85, "profile_image": "https://www.gravatar.com/avatar/c03b8d34978563858020eff0d14cc17b?s=128&d=identicon&r=PG", "display_name": "Alexis King", "link": "https://stackoverflow.com/users/465378/alexis-king"}, "edited": false, "score": 1, "creation_date": 1426050936, "post_id": 28979004, "comment_id": 46208464, "body": "@AlexisKing, it is a convenient default for the sort of interactive development people tend to do with GHCi. There is no <code>main</code> in GHCi, and it would be annoying to have to invoke some  special interpreter command to execute an <code>IO</code> action."}, {"owner": {"reputation": 17809, "user_id": 1088108, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/63781cd38e91aa346a3849bc3ef3e550?s=128&d=identicon&r=PG&f=1", "display_name": "&#216;rjan Johansen", "link": "https://stackoverflow.com/users/1088108/%c3%98rjan-johansen"}, "edited": false, "score": 1, "creation_date": 1426050987, "post_id": 28979004, "comment_id": 46208482, "body": "With <code>IO</code> actions and only <code>IO</code> actions, it <i>executes</i> them as well as evaluating, so they need to be treated specially. That it also defaults generic <code>Applicative&#47;Monad</code> actions to it is probably just a nice side effect, although one that is explicitly mentioned in the manual."}, {"owner": {"reputation": 40537, "user_id": 465378, "user_type": "registered", "accept_rate": 85, "profile_image": "https://www.gravatar.com/avatar/c03b8d34978563858020eff0d14cc17b?s=128&d=identicon&r=PG", "display_name": "Alexis King", "link": "https://stackoverflow.com/users/465378/alexis-king"}, "reply_to_user": {"reputation": 44013, "user_id": 1477667, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/trgKM.jpg?s=128&g=1", "display_name": "dfeuer", "link": "https://stackoverflow.com/users/1477667/dfeuer"}, "edited": false, "score": 0, "creation_date": 1426051016, "post_id": 28979004, "comment_id": 46208491, "body": "@dfeuer Ooh, I see, that makes sense. It assumes IO because it needs to in order for interactive evaluations that yield IO to be executed."}], "tags": [], "owner": {"reputation": 17809, "user_id": 1088108, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/63781cd38e91aa346a3849bc3ef3e550?s=128&d=identicon&r=PG&f=1", "display_name": "&#216;rjan Johansen", "link": "https://stackoverflow.com/users/1088108/%c3%98rjan-johansen"}, "is_accepted": false, "score": 7, "last_activity_date": 1426050652, "last_edit_date": 1592644375, "creation_date": 1426050652, "answer_id": 28979004, "question_id": 28978857, "link": "https://stackoverflow.com/questions/28978857/how-does-ghci-print-partially-applied-values-created-from-pure/28979004#28979004", "title": "How does GHCi print partially-applied values created from &quot;pure&quot;?", "body": "<p>When you give a value of ambiguous type to the GHCi prompt to evaluate, it tries to default the type in various ways.  In particular, it tries whether it can fit an <code>IO a</code> type, in case you want to execute an IO action (see <a href=\"https://downloads.haskell.org/%7Eghc/latest/docs/html/users_guide/interactive-evaluation.html#actions-at-prompt\" rel=\"noreferrer\">the GHC manual</a>).  In your case, <code>pure A</code> defaults to the type <code>IO T</code>.  Also:</p>\n<blockquote>\n<p>Furthermore, GHCi will print the result of the I/O action if (and only if):</p>\n<ul>\n<li>The result type is an instance of <code>Show</code>.</li>\n<li>The result type is not <code>()</code>.</li>\n</ul>\n</blockquote>\n"}, {"tags": [], "owner": {"reputation": 44013, "user_id": 1477667, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/trgKM.jpg?s=128&g=1", "display_name": "dfeuer", "link": "https://stackoverflow.com/users/1477667/dfeuer"}, "is_accepted": true, "score": 15, "last_activity_date": 1426099224, "last_edit_date": 1426099224, "creation_date": 1426050742, "answer_id": 28979021, "question_id": 28978857, "link": "https://stackoverflow.com/questions/28978857/how-does-ghci-print-partially-applied-values-created-from-pure/28979021#28979021", "title": "How does GHCi print partially-applied values created from &quot;pure&quot;?", "body": "<p>GHCi is a little bit peculiar. In particular, when you type an expression at the prompt, it tries to interpret it in two different ways, in order:</p>\n\n<ol>\n<li>As an <code>IO</code> action to execute.</li>\n<li>As a value to print out.</li>\n</ol>\n\n<p>Since <code>IO</code> is <code>Applicative</code>, it is interpreting <code>pure A</code> as an <code>IO</code> action producing something of type <code>T</code>. It executes that action (which does nothing), and since the result is not in <code>Show</code>, it does not print anything out. If you make <code>T</code> an instance of <code>Show</code>, then it kindly prints out the result for you.</p>\n\n<p>When you write <code>pure A 0</code>, GHCi sees this:</p>\n\n<pre><code>pure :: Applicative f =&gt; a -&gt; f a\npure A :: Applicative f =&gt; f T\n</code></pre>\n\n<p>And since you apply <code>pure A</code> to <code>0</code>, <code>pure A</code> must be a function <code>a-&gt;b</code> for some types <code>a</code> and <code>b</code>, and <code>a</code> must contain <code>0</code>.</p>\n\n<pre><code>(Num a, Applicative f) =&gt; f T ~ (a -&gt; b)\n</code></pre>\n\n<p>(Note that <code>x ~ y</code> means that <code>x</code> and <code>y</code> unify\u2014they can be made to have the same type.)</p>\n\n<p>Thus we must have <code>f ~ ((-&gt;) a)</code> and <code>T ~ b</code>, so in fact GHC infers that, in this context,</p>\n\n<pre><code>pure A :: Num a =&gt; ((-&gt;) a) T\n</code></pre>\n\n<p>Which we can rewrite as</p>\n\n<pre><code>pure A :: Num a =&gt; a -&gt; T\n</code></pre>\n\n<p>Well, <code>(-&gt;) a</code> is an instance of <code>Applicative</code>, namely \"reader\", so this is okay. When we apply <code>pure A</code> to <code>0</code> we get something of type <code>T</code>, namely <code>A</code>. This <em>cannot</em> be interpreted as an <code>IO</code> action, of course, so if <code>T</code> is not an instance of <code>Show</code>, GHCi will complain.</p>\n"}], "owner": {"reputation": 40537, "user_id": 465378, "user_type": "registered", "accept_rate": 85, "profile_image": "https://www.gravatar.com/avatar/c03b8d34978563858020eff0d14cc17b?s=128&d=identicon&r=PG", "display_name": "Alexis King", "link": "https://stackoverflow.com/users/465378/alexis-king"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 143, "favorite_count": 0, "accepted_answer_id": 28979021, "answer_count": 2, "score": 6, "last_activity_date": 1426099224, "creation_date": 1426049795, "question_id": 28978857, "link": "https://stackoverflow.com/questions/28978857/how-does-ghci-print-partially-applied-values-created-from-pure", "title": "How does GHCi print partially-applied values created from &quot;pure&quot;?", "body": "<p>I've been playing around with <code>Applicative</code> instances in order to figure out how they work. However, I honestly don't understand this behavior.</p>\n\n<p>If I define my own datatype, then apply <code>pure</code> to it with no other arguments, nothing prints out, but it errors if I try to apply something to the result.</p>\n\n<pre><code>ghci&gt; data T = A\nghci&gt; pure A\nghci&gt; pure A 0\n\n&lt;interactive&gt;:21:1:\n    No instance for (Show T) arising from a use of \u2018print\u2019\n    In a stmt of an interactive GHCi command: print it\n</code></pre>\n\n<p>However, if I make <code>T</code> an instance of <code>Show</code>, then <code>A</code> is printed out in both cases.</p>\n\n<pre><code>ghci&gt; data T = A deriving (Show)\nghci&gt; pure A\nA\nghci&gt; pure A 0\nA\n</code></pre>\n\n<p>What I really don't understand is how <code>pure A</code> can be a value that is printed differently between the two cases. Isn't <code>pure A</code> partially applied?</p>\n\n<p>I do understand why calling <code>pure A 0</code> errors in the first example and doesn't in the second\u2014that makes sense to me. That's using the <code>((-&gt;) r)</code> instance of <code>Applicative</code>, so it simply yields a function that always returns <code>A</code>.</p>\n\n<p>But how is <code>pure</code> instantiated with only one value when the type of the applicative itself isn't yet known? Furthermore, how can GHC possibly print this value?</p>\n"}, {"tags": ["haskell"], "comments": [{"owner": {"reputation": 347, "user_id": 4522343, "user_type": "registered", "accept_rate": 94, "profile_image": "https://www.gravatar.com/avatar/120005cd79a0d28edb0c6273127ecc39?s=128&d=identicon&r=PG&f=1", "display_name": "Chalupa", "link": "https://stackoverflow.com/users/4522343/chalupa"}, "reply_to_user": {"reputation": 204954, "user_id": 1903116, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/w6Ffg.jpg?s=128&g=1", "display_name": "thefourtheye", "link": "https://stackoverflow.com/users/1903116/thefourtheye"}, "edited": false, "score": 0, "creation_date": 1426045853, "post_id": 28978230, "comment_id": 46207163, "body": "no, i want three outputs only, i want it to take a name from u, combine it with a verb in v and combine that with a DIFFERENT name from u."}, {"owner": {"reputation": 23444, "user_id": 414413, "user_type": "registered", "accept_rate": 79, "profile_image": "https://www.gravatar.com/avatar/6de2113f01432aa844dc85070ff33e89?s=128&d=identicon&r=PG", "display_name": "Cirdec", "link": "https://stackoverflow.com/users/414413/cirdec"}, "edited": false, "score": 1, "creation_date": 1426046481, "post_id": 28978230, "comment_id": 46207304, "body": "In the unfortunately deleted answer, the author was assuming you actually constructed a tuple like you indicate in the title and example. To do so you&#39;d change the expression for the result of the list comprehension from e.g. <code>u1 ++ &quot; &quot; ++ v ++ &quot; &quot; ++ u2</code> to <code>(u1, v, u2)</code>. The first of those has the type <code>[Char]</code> while the second one has the type <code>([Char], [Char], [Char])</code>."}, {"owner": {"reputation": 347, "user_id": 4522343, "user_type": "registered", "accept_rate": 94, "profile_image": "https://www.gravatar.com/avatar/120005cd79a0d28edb0c6273127ecc39?s=128&d=identicon&r=PG&f=1", "display_name": "Chalupa", "link": "https://stackoverflow.com/users/4522343/chalupa"}, "reply_to_user": {"reputation": 23444, "user_id": 414413, "user_type": "registered", "accept_rate": 79, "profile_image": "https://www.gravatar.com/avatar/6de2113f01432aa844dc85070ff33e89?s=128&d=identicon&r=PG", "display_name": "Cirdec", "link": "https://stackoverflow.com/users/414413/cirdec"}, "edited": false, "score": 0, "creation_date": 1426046774, "post_id": 28978230, "comment_id": 46207369, "body": "thanks, this comment actually helped a lot"}], "answers": [{"tags": [], "owner": {"reputation": 23444, "user_id": 414413, "user_type": "registered", "accept_rate": 79, "profile_image": "https://www.gravatar.com/avatar/6de2113f01432aa844dc85070ff33e89?s=128&d=identicon&r=PG", "display_name": "Cirdec", "link": "https://stackoverflow.com/users/414413/cirdec"}, "is_accepted": true, "score": 4, "last_activity_date": 1426084575, "last_edit_date": 1426084575, "creation_date": 1426045952, "answer_id": 28978281, "question_id": 28978230, "link": "https://stackoverflow.com/questions/28978230/tuples-in-haskell/28978281#28978281", "title": "Tuples in Haskell", "body": "<p>First, let's define the names so we can use them more than once</p>\n\n<pre><code>&gt; let names = [\"fluffy\", \"bunny\", \"monkey\"]\n</code></pre>\n\n<p>We can use <code>names</code> twice in a list comprehension, once to get the first unique-name <code>u1</code>, and again to get a second name, <code>u2</code>.</p>\n\n<pre><code>&gt; let fun = [ u1 ++ \" \" ++ v ++ \" \" ++ u2 | u1 &lt;- names, v &lt;- [\"eats\", \"feeds\", \"loves\"], u2 &lt;- names]\n</code></pre>\n\n<p>This results in 27 different strings</p>\n\n<pre><code>&gt; fun\n[\"fluffy eats fluffy\",\"fluffy eats bunny\",\"fluffy eats monkey\",\"fluffy feeds fluffy\",\"fluffy feeds bunny\",\"fluffy feeds monkey\",\"bunny eats fluffy\",\"bunny eats bunny\",\"bunny eats monkey\",\"bunny feeds fluffy\",\"bunny feeds bunny\",\"bunny feeds monkey\",\"monkey eats fluffy\",\"monkey eats bunny\",\"monkey eats monkey\",\"monkey feeds fluffy\",\"monkey feeds bunny\",\"monkey feeds monkey\"]\n</code></pre>\n\n<p>If <code>\"fluffy eats fluffy\"</code> is a little too wierd, we can make sure the two names are different by adding a condition, <code>u1 /= u2</code>.</p>\n\n<pre><code>&gt; let fun = [ u1 ++ \" \" ++ v ++ \" \" ++ u2 | u1 &lt;- names, v &lt;- [\"eats\", \"feeds\", \"loves\"], u2 &lt;- names, u1 /= u2]\n</code></pre>\n\n<p>This results in only 18 different strings.</p>\n\n<pre><code>&gt; fun\n[\"fluffy eats bunny\",\"fluffy eats monkey\",\"fluffy feeds bunny\",\"fluffy feeds monkey\",\"bunny eats fluffy\",\"bunny eats monkey\",\"bunny feeds fluffy\",\"bunny feeds monkey\",\"monkey eats fluffy\",\"monkey eats bunny\",\"monkey feeds fluffy\",\"monkey feeds bunny\"]\n</code></pre>\n"}], "owner": {"reputation": 347, "user_id": 4522343, "user_type": "registered", "accept_rate": 94, "profile_image": "https://www.gravatar.com/avatar/120005cd79a0d28edb0c6273127ecc39?s=128&d=identicon&r=PG&f=1", "display_name": "Chalupa", "link": "https://stackoverflow.com/users/4522343/chalupa"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 167, "favorite_count": 0, "accepted_answer_id": 28978281, "answer_count": 1, "score": 1, "last_activity_date": 1426084575, "creation_date": 1426045583, "last_edit_date": 1426077347, "question_id": 28978230, "link": "https://stackoverflow.com/questions/28978230/tuples-in-haskell", "title": "Tuples in Haskell", "body": "<p>I'd like to write a function that combines a unique-name in list <code>u</code> with a verb in list <code>v</code> with another unique-name in u so that i'd get 3 outputs like this:</p>\n\n<pre><code>[ (\"fluffy\", \"loves\", \"monkey\"), (\"bunny\", \"feeds\", \"fluffy\"), \n  (\"bunny\", \"feeds\", \"monkey\") ]\n</code></pre>\n\n<p>The only thing is I don't know how to get it so that the second unique-name it gives me is different than the first. Here's my code:</p>\n\n<pre><code>let fun = [ u ++ \" \" ++ v ++ \" \" ++ u | u &lt;- [\"fluffy\", \"bunny\", \"monkey\"], v &lt;- [\"eats\", \"feeds\", \"loves\"]]\nlet funThree = take 3 (cycle fun)\n</code></pre>\n\n<p>Currently my output is this:</p>\n\n<pre><code>[\"fluffy eats fluffy\",\"fluffy feeds fluffy\",\"fluffy loves fluffy\"]\n</code></pre>\n"}, {"tags": ["haskell"], "comments": [{"owner": {"reputation": 1365, "user_id": 536017, "user_type": "registered", "accept_rate": 96, "profile_image": "https://www.gravatar.com/avatar/5a8149f6e0f3f0276a525bf9a76a5397?s=128&d=identicon&r=PG", "display_name": "danem", "link": "https://stackoverflow.com/users/536017/danem"}, "edited": false, "score": 0, "creation_date": 1426041336, "post_id": 28977452, "comment_id": 46206118, "body": "You are missing a comma after &quot;Emma&quot; and before &quot;Cowboys &amp; Aliens&quot;. Oh, you are missing commas with each newline. Also, you haven&#39;t constructed your film values, all you&#39;ve defined is a list of strings."}, {"owner": {"reputation": 41, "user_id": 4656504, "user_type": "registered", "accept_rate": 50, "profile_image": "https://www.gravatar.com/avatar/253d2e29a758b74cda85d9e6a8b2c63f?s=128&d=identicon&r=PG&f=1", "display_name": "Dipz", "link": "https://stackoverflow.com/users/4656504/dipz"}, "reply_to_user": {"reputation": 1365, "user_id": 536017, "user_type": "registered", "accept_rate": 96, "profile_image": "https://www.gravatar.com/avatar/5a8149f6e0f3f0276a525bf9a76a5397?s=128&d=identicon&r=PG", "display_name": "danem", "link": "https://stackoverflow.com/users/536017/danem"}, "edited": false, "score": 0, "creation_date": 1426101699, "post_id": 28977452, "comment_id": 46239162, "body": "ahh I see it. thanks very much"}], "answers": [{"tags": [], "owner": {"reputation": 293, "user_id": 3926155, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/47bae4f76436f8feaa99fe75612fcf97?s=128&d=identicon&r=PG", "display_name": "Noah Halford", "link": "https://stackoverflow.com/users/3926155/noah-halford"}, "is_accepted": false, "score": 3, "last_activity_date": 1426041594, "creation_date": 1426041594, "answer_id": 28977663, "question_id": 28977452, "link": "https://stackoverflow.com/questions/28977452/haskell-syntax-error/28977663#28977663", "title": "Haskell: Syntax Error", "body": "<p>The problem has to do with the indentation in your list. Haskell cares a lot about whitespace, and if you continue onto a second line, then you need to indent. Also, make sure that your lists of strings are actually lists. A different issue is that you need a constructor in your data declaration. Try something like this:</p>\n\n<pre><code>data Film = Film String [String] Int [String]\n    deriving (Eq,Ord,Show,Read) \n\ntestDatabase :: [Film]\ntestDatabase = [Film \"Casino Royale\" \n    [\"Daniel Craig\", \"Eva Green\", \"Judi Dench\"]\n    2006\n    [\"Garry\", \"Dave\", \"Zoe\", \"Kevin\", \"Emma\"]\n    , Film \"Cowboys &amp; Aliens\"\n    [\"Harrison Ford\", \"Daniel Craig\", \"Olivia Wilde\"]\n    2011\n    [\"Bill\", \"Jo\", \"Garry\", \"Kevin\", \"Olga\", \"Liz\"]]\n</code></pre>\n"}], "owner": {"reputation": 41, "user_id": 4656504, "user_type": "registered", "accept_rate": 50, "profile_image": "https://www.gravatar.com/avatar/253d2e29a758b74cda85d9e6a8b2c63f?s=128&d=identicon&r=PG&f=1", "display_name": "Dipz", "link": "https://stackoverflow.com/users/4656504/dipz"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 58, "favorite_count": 0, "answer_count": 1, "score": 0, "last_activity_date": 1426041594, "creation_date": 1426040070, "question_id": 28977452, "link": "https://stackoverflow.com/questions/28977452/haskell-syntax-error", "title": "Haskell: Syntax Error", "body": "<p>here is my code for my film Data Type and a database to hold it</p>\n\n<pre><code>data Film = String [String] Int [String]\n    deriving (Eq,Ord,Show,Read) \n\ntestDatabase :: [Film]\ntestDatabase = [\"Casino Royale\" \n\"Daniel Craig\", \"Eva Green\", \"Judi Dench\"\n2006\n\"Garry\", \"Dave\", \"Zoe\", \"Kevin\", \"Emma\"\n\n\"Cowboys &amp; Aliens\"\n\"Harrison Ford\", \"Daniel Craig\", \"Olivia Wilde\"\n2011\n\"Bill\", \"Jo\", \"Garry\", \"Kevin\", \"Olga\", \"Liz\"]\n</code></pre>\n\n<p>and i keep getting this error </p>\n\n<pre><code>parse error (possibly incorrect indentation or mismatched brackets)\n</code></pre>\n\n<p>No idea why its giving me that. ANy help guys?</p>\n"}, {"tags": ["haskell"], "comments": [{"owner": {"reputation": 1365, "user_id": 536017, "user_type": "registered", "accept_rate": 96, "profile_image": "https://www.gravatar.com/avatar/5a8149f6e0f3f0276a525bf9a76a5397?s=128&d=identicon&r=PG", "display_name": "danem", "link": "https://stackoverflow.com/users/536017/danem"}, "edited": false, "score": 3, "creation_date": 1426037997, "post_id": 28976620, "comment_id": 46205301, "body": "Well, not knowing all of the details, it looks like your function type check, &quot;eventually&quot;. You just need to define a base case at some point and return either a &quot;Good Value&quot; or &quot;Error String&quot;. Also, you might want to try using the Either monad to clarify your code a bit, for example: <a href=\"http://lpaste.net/252351829973663744\" rel=\"nofollow noreferrer\">lpaste.net/252351829973663744</a> With that said, it is a bit hard to know exactly what you are asking here."}, {"owner": {"reputation": 23444, "user_id": 414413, "user_type": "registered", "accept_rate": 79, "profile_image": "https://www.gravatar.com/avatar/6de2113f01432aa844dc85070ff33e89?s=128&d=identicon&r=PG", "display_name": "Cirdec", "link": "https://stackoverflow.com/users/414413/cirdec"}, "edited": false, "score": 1, "creation_date": 1426043801, "post_id": 28976620, "comment_id": 46206714, "body": "What is <code>av</code>? What is <code>ClosureV</code>? What&#39;s the purpose of <code>++ &quot;Error&quot;</code> and <code>++ &quot;error&quot;</code>; are you trying to add a trace to the site of the error in the error message?"}], "answers": [{"tags": [], "owner": {"reputation": 23444, "user_id": 414413, "user_type": "registered", "accept_rate": 79, "profile_image": "https://www.gravatar.com/avatar/6de2113f01432aa844dc85070ff33e89?s=128&d=identicon&r=PG", "display_name": "Cirdec", "link": "https://stackoverflow.com/users/414413/cirdec"}, "is_accepted": false, "score": 1, "last_activity_date": 1426089952, "creation_date": 1426089952, "answer_id": 28991646, "question_id": 28976620, "link": "https://stackoverflow.com/questions/28976620/haskell-error-handler/28991646#28991646", "title": "Haskell Error Handler", "body": "<p>You have almost made your first monad.</p>\n\n<p>Let's look at the body of <code>evaluate (Call fun arg) env</code>.</p>\n\n<pre><code>evaluate (Call fun arg) env =\n  case evaluate fun env of\n    Error msg -&gt; Error msg\n    Good func -&gt;\n      case evaluate arg env of\n        Error msg -&gt; Error msg\n        Good arg0 -&gt;\n          ...\n</code></pre>\n\n<p>There's a pattern here. If we laid the two <code>case</code>s over the top of each other it would look like the following, where the first mess of <code>\u2588\u2588\u2588</code> comes from typing the word <code>arg</code> over the top of <code>fun</code> and the second mess comes from typing the word <code>arg0</code> over the top of <code>func</code></p>\n\n<pre><code>case evaluate \u2588\u2588\u2588 env of\n  Error msg -&gt; Error msg\n  Good \u2588\u2588\u2588\u2588 -&gt;\n    ...\n</code></pre>\n\n<p>In both cases, we are examining some <code>Checked a</code>. We are passing into the case expression some <code>Checked</code> value and doing something else, that also results in some checked value, if the checked value is <code>Good</code>. Let's ignore everything from the <code>evaluate</code> part</p>\n\n<pre><code>case \u2588\u2588\u2588 of\n  Error msg -&gt; Error msg\n  Good \u2588\u2588\u2588\u2588 -&gt;\n    ...\n</code></pre>\n\n<p>We are using this pattern repeatedly, so let's extract it.</p>\n\n<pre><code>whenGood :: Checked a -&gt; (a -&gt; Checked b) -&gt; Checked b\nwhenGood checked next = case checked of\n                            Error msg -&gt; Error msg\n                            Good  x   -&gt; next  x\n</code></pre>\n\n<p>Now we can write <code>evaluate (Call fun arg) env</code> equivalently as</p>\n\n<pre><code>evaluate (Call fun arg) env =\n    whenGood (evaluate fun env) $ \\func -&gt;\n      whenGood (evaulate arg env) $ \\arg0 -&gt;\n        ...\n</code></pre>\n\n<p>We don't need the indentation (lambdas extend as far right as possible), and can write <code>whenGood</code> as an infix operator. This looks very nice.</p>\n\n<pre><code>evaluate (Call fun arg) env =\n    evaluate fun env `whenGood` \\func -&gt;\n    evaluate arg env `whenGood` \\arg0 -&gt;\n    ...\n</code></pre>\n\n<p>The type of whenGood matches the type of <code>&gt;&gt;=</code> for a <code>Monad</code>.</p>\n\n<pre><code>whenGood ::            Checked a -&gt; (a -&gt; Checked b) -&gt; Checked b\n(&gt;&gt;=)    :: Monad m =&gt; m       a -&gt; (a -&gt; m       b) -&gt; m       b\n</code></pre>\n\n<p>To define a <code>Monad</code> we also need a <code>return</code> with the type <code>a -&gt; m a</code>. Your <code>Good</code> constructor puts a value <code>a</code> into a <code>Checked a</code>.</p>\n\n<pre><code>return :: Monad m =&gt; a -&gt; m       a\nGood   ::            a -&gt; Checked a\n</code></pre>\n\n<p>I'll assert that <code>whenGood</code> and <code>Good</code> obey the <a href=\"http://hackage.haskell.org/package/base-4.7.0.2/docs/Control-Monad.html#t:Monad\" rel=\"nofollow\"><code>Monad</code> laws</a> for <code>(&gt;&gt;=)</code> and <code>return</code>, so we can make a <code>Monad</code> instance for <code>Checked</code><sup>\u2020</sup></p>\n\n<pre><code>instance Monad Checked where\n    return = Good\n    (&gt;&gt;=)  = whenGood\n</code></pre>\n\n<p>Having a <code>Monad</code> instance means that we can use any of the <a href=\"http://hackage.haskell.org/packages/archive/base/latest/doc/html/Control-Monad.html\" rel=\"nofollow\">functions defined in general for <code>Monad</code>s</a>. It also lets us write our <code>evaluate (Call fun arg) env</code> with the more familiar <code>&gt;&gt;=</code> operator in place of <code>whenGood</code>.</p>\n\n<pre><code>evaluate (Call fun arg) env =\n    evaluate fun env &gt;&gt;= \\func -&gt;\n    evaluate arg env &gt;&gt;= \\arg0 -&gt;\n    ...\n</code></pre>\n\n<p>Or even in <code>do</code> notation</p>\n\n<pre><code>evaluate (Call fun arg) env =\n  do\n    func &lt;- evaluate fun env\n    arg0 &lt;- evaluate arg env\n    ...\n</code></pre>\n\n<hr>\n\n<p><sup>\u2020</sup>If you have a newer GHC it might complain that <code>Monad</code>s need an <code>Applicative</code> instance, if so you can make the default one.</p>\n\n<pre><code>import Control.Applicative\nimport Control.Monad\n\ninstance Functor Checked where\n    fmap = liftM\n\ninstance Applicative Checked where\n    pure  = return\n    (&lt;*&gt;) = ap\n</code></pre>\n"}], "owner": {"reputation": 11, "user_id": 4656317, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/55604ed3af253b1e4bbeb79d9775fd6b?s=128&d=identicon&r=PG&f=1", "display_name": "cohilla", "link": "https://stackoverflow.com/users/4656317/cohilla"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 80, "favorite_count": 1, "answer_count": 1, "score": 1, "last_activity_date": 1426089952, "creation_date": 1426034379, "last_edit_date": 1426034843, "question_id": 28976620, "link": "https://stackoverflow.com/questions/28976620/haskell-error-handler", "title": "Haskell Error Handler", "body": "<p>I'm making a feeble attempt at writing a error handler in Haskell. My Haskell skills are quite abysmal. Can some knowledgable person tell me how to correct this evaluation?</p>\n\n<pre><code>data Checked a = Good a | Error String\n\nevaluate :: Exp -&gt; Env -&gt; Checked Value\nevaluate (Call fun arg) env =\n  case evaluate fun env of\n    Error msg -&gt; Error (msg ++ \"Error\")\n    Good func -&gt;\n      case evaluate arg env of\n        Error msg -&gt; Error (msg ++ \"error\")\n        Good arg0 -&gt; \n          let ClosureV x body env' = av\n            evaluate body ((x, arg0) : env')\n</code></pre>\n\n<p>I know it needs to return a Checked Value, but not sure how to write that in.</p>\n"}, {"tags": ["haskell", "haskell-platform", "template-haskell"], "answers": [{"comments": [{"owner": {"reputation": 23444, "user_id": 414413, "user_type": "registered", "accept_rate": 79, "profile_image": "https://www.gravatar.com/avatar/6de2113f01432aa844dc85070ff33e89?s=128&d=identicon&r=PG", "display_name": "Cirdec", "link": "https://stackoverflow.com/users/414413/cirdec"}, "edited": false, "score": 0, "creation_date": 1426034395, "post_id": 28975606, "comment_id": 46204293, "body": "You can also replace <code>foldMap</code> with <code>concatMap</code> and get rid of the <code>Data.Foldable</code> import entirely."}, {"owner": {"reputation": 21417, "user_id": 925978, "user_type": "registered", "accept_rate": 84, "profile_image": "https://www.gravatar.com/avatar/06e4467a5bd1538a92cefb20db07897a?s=128&d=identicon&r=PG&f=1", "display_name": "crockeea", "link": "https://stackoverflow.com/users/925978/crockeea"}, "reply_to_user": {"reputation": 57, "user_id": 4656096, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/aMsj5.jpg?s=128&g=1", "display_name": "Tasos Barlas", "link": "https://stackoverflow.com/users/4656096/tasos-barlas"}, "edited": false, "score": 2, "creation_date": 1426035693, "post_id": 28975606, "comment_id": 46204687, "body": "@dontask You would greatly benefit from a Haskell tutorial, which you can find out more about <a href=\"http://stackoverflow.com/a/1016986/925978\">here</a>."}, {"owner": {"reputation": 57, "user_id": 4656096, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/aMsj5.jpg?s=128&g=1", "display_name": "Tasos Barlas", "link": "https://stackoverflow.com/users/4656096/tasos-barlas"}, "edited": false, "score": 0, "creation_date": 1426040919, "post_id": 28975606, "comment_id": 46206022, "body": "Another question I have is this.do u know how could I use this function to make a call with a given co-actor?im saying this because I don&#39;t know how to do it if I assign it to a variable which doesn&#39;t have anything to do with the calculation of the expression.in other words,does my code fully work ?(given what I want it to do?)"}, {"owner": {"reputation": 21417, "user_id": 925978, "user_type": "registered", "accept_rate": 84, "profile_image": "https://www.gravatar.com/avatar/06e4467a5bd1538a92cefb20db07897a?s=128&d=identicon&r=PG&f=1", "display_name": "crockeea", "link": "https://stackoverflow.com/users/925978/crockeea"}, "reply_to_user": {"reputation": 57, "user_id": 4656096, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/aMsj5.jpg?s=128&g=1", "display_name": "Tasos Barlas", "link": "https://stackoverflow.com/users/4656096/tasos-barlas"}, "edited": false, "score": 1, "creation_date": 1426046818, "post_id": 28975606, "comment_id": 46207383, "body": "@dontask 1. Unclear what you&#39;re asking. 2. You have to do your own homework. 3. Read a tutorial. 4. You *might*(???) be looking for a <code>let</code> statement? 5. Read a tutorial."}], "tags": [], "owner": {"reputation": 21417, "user_id": 925978, "user_type": "registered", "accept_rate": 84, "profile_image": "https://www.gravatar.com/avatar/06e4467a5bd1538a92cefb20db07897a?s=128&d=identicon&r=PG&f=1", "display_name": "crockeea", "link": "https://stackoverflow.com/users/925978/crockeea"}, "is_accepted": false, "score": 1, "last_activity_date": 1426035624, "last_edit_date": 1495535200, "creation_date": 1426028169, "answer_id": 28975606, "question_id": 28975541, "link": "https://stackoverflow.com/questions/28975541/give-without-duplicates-the-names-of-actors-who-have-co-starred-in-at-least-on/28975606#28975606", "title": "give (without duplicates) the names of actors who have co-starred in at least one film with a particular actor", "body": "<p>As the error says, </p>\n\n<pre><code> Ambiguous occurrence `elem'\n It could refer to either `Data.List.elem',\n                          imported from `Data.List' \n                          (and originally defined in `GHC.List')\n                       or `Data.Foldable.elem',\n                          imported from `Data.Foldable'\n</code></pre>\n\n<p>The problem is that the function <code>elem</code> is defined and exported in modules <code>Data.List</code> and <code>Data.Foldable</code>. You need to qualify the occurrence of <code>elem</code> (or <code>`elem`</code>, in infix notation) to <code>Data.List.elem</code>, if that's the version you want.</p>\n\n<p>Alternatively, you can qualify you imports instead:</p>\n\n<pre><code>import Data.List\nimport qualified Data.Foldable as DF\n</code></pre>\n\n<p>This means you can use <code>elem</code> from <code>Data.List</code> unqualified as <code>elem</code>, but if you want to use the <code>Data.Foldable</code> version, you have to use the qualified version <code>DF.elem</code> (or <code>`DF.elem`</code>, in infix notation). The downside is that you also have to qualify every other use of a <code>Data.Foldable</code> function.</p>\n\n<p>Alternatively, you can hide <code>elem</code> in <code>Data.Foldable</code>:</p>\n\n<pre><code>import Data.List -- import all of Data.List unqualified\nimport Data.Foldable hiding (elem) -- import all of Data.Foldable unqualified, but hide `elem`.\n</code></pre>\n\n<p><a href=\"https://wiki.haskell.org/Import\" rel=\"nofollow noreferrer\">This link</a> has everything you'll need. There are also many SO questions about qualifying namespaces, for example <a href=\"https://stackoverflow.com/questions/741184/how-do-i-write-the-qualified-name-of-a-symbol-in-haskell\">here</a>.</p>\n"}], "owner": {"reputation": 57, "user_id": 4656096, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/aMsj5.jpg?s=128&g=1", "display_name": "Tasos Barlas", "link": "https://stackoverflow.com/users/4656096/tasos-barlas"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 129, "favorite_count": 0, "answer_count": 1, "score": -2, "last_activity_date": 1439504857, "creation_date": 1426027837, "last_edit_date": 1439504857, "question_id": 28975541, "link": "https://stackoverflow.com/questions/28975541/give-without-duplicates-the-names-of-actors-who-have-co-starred-in-at-least-on", "title": "give (without duplicates) the names of actors who have co-starred in at least one film with a particular actor", "body": "<p>I'm writing a movie database with Haskell. Like the title says, I am trying to give (without duplicates) the names of actors who have co-starred in at least one film with a particular actor.</p>\n\n<p>Here's my code until now:</p>\n\n<pre><code>import Text.Printf\nimport Data.List\nimport Data.Ord\nimport Data.Foldable \n\ntype Title = String\ntype Actor = String\ntype Cast = [Actor]\ntype Year = Int\ntype Fan = String\ntype Fans = [Fan]\ntype Period = (Year, Year)\n\ndata Film = Film Title Cast Year Fans\nderiving(Show,Read,Eq)\n\n\n\n\ntestDatabase :: [Film]\ntestDatabase = [(Film \"Casino Royale\" [\"Daniel Craig\", \"Eva Green\", \"Judi Dench\"] 2006 [\"Garry\", \"Dave\", \"Zoe\", \"Kevin\", \"Emma\"]),       \n            (Film \"Cowboys &amp; Aliens\" [\"Harrison Ford\", \"Daniel Craig\", \"Olivia Wilde\"] 2011 [\"Bill\", \"Jo\", \"Garry\", \"Kevin\", \"Olga\", \"Liz\"]),         \n            (Film \"Catch Me If You Can\" [\"Leonardo DiCaprio\", \"Tom Hanks\"] 2002 [\"Zoe\", \"Heidi\", \"Jo\", \"Emma\", \"Liz\", \"Sam\", \"Olga\", \"Kevin\", \"Tim\"]),\n            (Film \"Mamma Mia!\" [\"Meryl Streep\", \"Pierce Brosnan\", \"Colin Firth\"] 2008 [\"Kevin\", \"Jo\", \"Liz\", \"Amy\", \"Sam\", \"Zoe\"]),\n            (Film \"Titanic\" [\"Leonardo DiCaprio\", \"Kate Winslet\"] 1997 [\"Zoe\", \"Amy\", \"Heidi\", \"Jo\", \"Megan\", \"Olga\"]),\n            (Film \"Quantum of Solace\" [\"Daniel Craig\", \"Judi Dench\"] 2008 [\"Bill\", \"Olga\", \"Tim\", \"Zoe\", \"Paula\"])]\n\ncoactors :: Actor -&gt; [Film] -&gt; [Actor]  \ncoactors [] = []\ncoactors a -&gt; filter (/= a) . nub . concatMap (\\(Film _ c _ _) -&gt; if a     `elem` c then c else [])\n</code></pre>\n\n<p>This is my try for a function that does what I said above. It doesn't work, and I don't know why. Can anyone provide me with correction that will make the function work?</p>\n"}, {"tags": ["haskell", "digestive-functors"], "comments": [{"owner": {"reputation": 62282, "user_id": 1652962, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/2cf5a0741f183379686fe0995ffc27ae?s=128&d=identicon&r=PG", "display_name": "cimmanon", "link": "https://stackoverflow.com/users/1652962/cimmanon"}, "edited": false, "score": 1, "creation_date": 1452427842, "post_id": 28973312, "comment_id": 57156201, "body": "This doesn&#39;t exactly answer your question, but you might be interested in this pull request:  <a href=\"https://github.com/jaspervdj/digestive-functors/pull/125\" rel=\"nofollow noreferrer\">github.com/jaspervdj/digestive-functors/pull/125</a>.  Have you seen this answer <a href=\"http://stackoverflow.com/a/17820115/1652962\">stackoverflow.com/a/17820115/1652962</a> ?"}], "owner": {"reputation": 86, "user_id": 1440103, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/1b7ec8efa1f77ec791d541cce6ce091a?s=128&d=identicon&r=PG", "display_name": "Simon", "link": "https://stackoverflow.com/users/1440103/simon"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 183, "favorite_count": 0, "answer_count": 0, "score": 3, "last_activity_date": 1426773001, "creation_date": 1426018713, "last_edit_date": 1426773001, "question_id": 28973312, "link": "https://stackoverflow.com/questions/28973312/digestive-functors-multiple-file-upload-field", "title": "Digestive functors: multiple file upload field?", "body": "<p>I'm trying to recreate fairly standard image / file upload functionality whereby a given field allows the uploading of one or more files / images with something like an \"add another file\" button and/or the ability to replace existing files.</p>\n\n<p>I have file uploads working and I have multiple subforms working, but I can't get multiple subforms working with file input.</p>\n\n<p>I have created an example (shown below) heavily based on <a href=\"https://github.com/jaspervdj/digestive-functors/blob/master/examples/dynamic-list.hs\" rel=\"nofollow\">examples/dynamic-list.hs</a> which highlights the problem, which appears to be that postForm returns an appropriate FilePath in the view but does not return it in the \"result\". </p>\n\n<p>Another problem with dynamic-list.hs is that it only shows a trivial use case using static data. Having an actual dynamic form where the data changes in response to user input is significantly more complicated, so I'm hoping that I can hammer out a more comprehensive version of dynamic-list.hs which would be (much) more helpful to beginners. </p>\n\n<p>My code so far:</p>\n\n<pre><code>{-# LANGUAGE OverloadedStrings, PackageImports, TupleSections, ScopedTypeVariables, DeriveDataTypeable, TypeSynonymInstances, FlexibleInstances #-}\n\nmodule Handler.Test where\n\nimport           Prelude hiding (div, span)\nimport           Control.Applicative\nimport           Control.Monad\nimport           Control.Monad.Trans\n\nimport           Data.Maybe\nimport           Data.Text hiding (unlines, intercalate, concat)\nimport           Data.Text.Encoding\n\nimport           Snap.Core hiding (method)\nimport           Snap.Snaplet\n\n------------------------------------------------------------------------------\nimport           Heist.Splices.Html\nimport           Text.Digestive\nimport           Text.Digestive.Snap \nimport           Text.Digestive.Heist\nimport           Text.Blaze.Html5 as H\nimport           Text.Digestive.Blaze.Html5 as DH\nimport qualified Text.Blaze.Html5.Attributes as A\nimport           Text.Digestive.Form\nimport           Text.Digestive.Util\n\nimport           Text.Blaze.Renderer.XmlHtml\n\nimport Data.List as L\n------------------------------------------------------------------------------\nimport Application\n\nimport Helpers.Forms\nimport Helpers.Theme\nimport Debug.Trace\n------------------------------------------------------------------------------\n\nhandleEntityTest :: Handler App App ()\nhandleEntityTest = undefined\n\ntype Product = Text\ntype Quantity = Int\n--------------------------------------------------------------------------------\ndata Order = Order {\n    orderName  :: Text\n  , orderItems :: [OrderItem]\n} deriving (Show)\n\ndata OrderItem = OrderItem\n  { orderProduct :: Text\n  , orderQuantity :: Quantity\n  , orderFile :: Maybe FilePath\n  } deriving (Show)\n--------------------------------------------------------------------------------\n\norderForm :: Monad m =&gt; Order -&gt; Form Html m Order\norderForm order = Order \n  &lt;$&gt; \"orderName\" .: text (Just $ orderName order)\n  &lt;*&gt; \"orderItems\" .: listOf orderItemForm (Just $ orderItems order)\n\norderItemForm :: Monad m =&gt; Formlet Html m OrderItem\norderItemForm def = OrderItem\n  &lt;$&gt; \"product\" .: text (orderProduct &lt;$&gt; def)\n  &lt;*&gt; \"quantity\" .: stringRead \"Can't parse quantity\" (orderQuantity &lt;$&gt; def)\n  &lt;*&gt; \"file\" .: file\n--------------------------------------------------------------------------------\norderView :: View H.Html -&gt; H.Html\norderView view = do\n  DH.form view \"\" $ do\n    DH.label \"name\" view \"Order name: \"\n    DH.inputText \"orderName\" view\n    H.br    \n    DH.label \"orderItems.indices\" view \"(Usually hidden) Indices: \"\n    DH.inputText \"orderItems.indices\" view\n    H.br\n    mapM_ orderItemView $ listSubViews \"orderItems\" view\n    H.br\n    DH.inputSubmit \"Submit\"     \n\norderItemView :: View H.Html -&gt; H.Html\norderItemView view = do\n  childErrorList \"\" view\n  DH.label \"product\" view \"Product: \"\n  DH.inputText \"product\" view\n  H.br\n  DH.label \"quantity\" view \"Quantity: \"\n  DH.inputText \"quantity\" view\n  H.br\n  DH.label \"file\" view \"file\"\n  DH.inputFile \"file\" view  \n  H.br\n-------------------------------------------------------\n\nhandleTest :: Handler App App ()\nhandleTest = do\n  r &lt;- runFormWith defaultFormConfig \"test\" $ orderForm $ Order \"test form\" [(OrderItem \"\" 0 Nothing)]\n  case r of\n    (view, Nothing) -&gt; do\n      -- GET\n      renderPageHtml \"Initial form view\" $ toHtml $ orderView $ debugForm view\n      -- POST  \n    (view, Just order) -&gt; do\n      s &lt;- runFormWith (defaultFormConfig { method = Just Get }) \"test\" $ orderForm $ order {orderItems = ((orderItems order) ++ [(OrderItem \"\" 0 Nothing)]) }\n      case s of \n        (view', Nothing) -&gt; do\n          renderPageHtml \"Subsequent form view\" $ html \n            where \n              html = do\n                p $ do \n                  mapM_ div [ br, br, br\n                     , orderView $ debugForm view'\n                     , toHtml $ show order\n                    ]\n        (view', Just order) -&gt; do\n          renderPageHtml \"Subsequent form view\" $ p \"This shouldn't ever happen\"\n\n------------------------------------------------------------\ndebugForm :: View Html -&gt; View Html\ndebugForm v = trace (t) v\n  where \n    showTuple (path,input) = (\"path : \" ++ (show path) ++ \"=\" ++ (show input))\n    t = unlines $ [\n          (\"\"), (\"\")\n        , (\"viewName : \" ++ (unpack $ viewName v)  )\n        , (\"viewMethod : \" ++ (show $ viewMethod v)  )\n        , (\"viewContext : \" ++ (show $ viewContext v)  )\n        --, (\"viewInput : \" ++ (unlines $ fmap (\\(path, input) -&gt; (show path) ++ \"=\" ++ (show input) ) $ viewInput v  ))\n        , (\"viewInput : \" ++ (unlines $ fmap showTuple $ viewInput v  ))\n        , (\"debugViews : \" ++ (unlines $ fmap show $ debugViewPaths v) )\n      ]\n</code></pre>\n"}, {"tags": ["haskell", "typeclass"], "answers": [{"comments": [{"owner": {"reputation": 44013, "user_id": 1477667, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/trgKM.jpg?s=128&g=1", "display_name": "dfeuer", "link": "https://stackoverflow.com/users/1477667/dfeuer"}, "edited": false, "score": 0, "creation_date": 1426106430, "post_id": 28972876, "comment_id": 46241935, "body": "Overloading a function the wrong way will always break code. What are you trying to say?"}], "tags": [], "owner": {"reputation": 51584, "user_id": 839246, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/9b0573c2b936b12828dd1e4cc04206dc?s=128&d=identicon&r=PG&f=1", "display_name": "bheklilr", "link": "https://stackoverflow.com/users/839246/bheklilr"}, "is_accepted": false, "score": 9, "last_activity_date": 1426018205, "last_edit_date": 1426018205, "creation_date": 1426017135, "answer_id": 28972876, "question_id": 28972612, "link": "https://stackoverflow.com/questions/28972612/typeclasses-function-with-default-implementation-vs-separate-function/28972876#28972876", "title": "Typeclasses: function with default implementation vs separate function", "body": "<p>Including a function in the definition of a typeclass means that it can be overridden.  In this case, you would need for it to be inside the <code>Graph</code> typeclass since it returns a <code>Graph g =&gt; g</code>, and each specific instance of <code>Graph</code> would need to know how to construct that value.  Alternatively, you could specify a function in the typeclass for the purpose of constructing values of type <code>Graph g =&gt; g</code> and then <code>insertNode</code> could use that function in its result.</p>\n\n<p>Keeping a function outside of the typeclass means that it can't be modified, but also that it doesn't clutter up the class.  Consider as an example the <code>mapM</code> function.  There's no need for this to be in the <code>Monad</code> class, and you probably don't want people writing their own implementations of <code>mapM</code>, it should do the same thing in all contexts.  As another example, consider the function</p>\n\n<pre><code>-- f(x) = 1 + 3x^2 - 5x^3 + 10x^4\naPoly :: Num a =&gt; a -&gt; a\naPoly x = 1 + 3 * x * x - 5 * x * x * x + 10 * x * x * x * x\n</code></pre>\n\n<p>Obviously <code>aPoly</code> shouldn't be part of the <code>Num</code> typeclass, it's just a random function that happens to use <code>Num</code> methods.  It has nothing to do with what it means to be a <code>Num</code>.</p>\n\n<p>Really, it comes down to design.  Functions are usually specified within a typeclass if they are integral to what it means to be an instance of that typeclass.  Sometimes functions are included in a typeclass but with a default definition so that a specific type can overload it to make it more efficient, but for the most part it makes sense to keep class members at a minimum.  One way to look at it is by asking the question \"Can this function be implemented with only the constraint of the class?\"  If the answer is no, it should be in the class.  If the answer is yes, the vast majority of the time it means that the function should be moved outside of the class.  Only when there is value gained from being able to overload it should it be moved into the class.  If overloading that function can break other code that expects it to behave a particular way, then it shouldn't be overloaded.</p>\n\n<p>Another case to consider is when you have functions in your typeclass that have sane defaults, but those defaults are mutually dependent.  Taking the <code>Num</code> class as an example, you have</p>\n\n<pre><code>class Num a where\n    (+) :: a -&gt; a -&gt; a\n    (*) :: a -&gt; a -&gt; a\n    (-) :: a -&gt; a -&gt; a\n    a - b = a + negate b\n    negate :: a -&gt; a\n    negate a = 0 - a\n    abs :: a -&gt; a\n    signum :: a -&gt; a\n    fromInteger :: Integer -&gt; a\n</code></pre>\n\n<p>Notice that <code>(-)</code> and <code>negate</code> are both implemented in terms of each other.  If you make your own numeric type then you would need to implement either or both of <code>(-)</code> and <code>negate</code>, since otherwise you'll have an infinite loop on your hands.  These are useful functions to overload, though, so they both stay inside the typeclass.</p>\n"}, {"comments": [{"owner": {"reputation": 17809, "user_id": 1088108, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/63781cd38e91aa346a3849bc3ef3e550?s=128&d=identicon&r=PG&f=1", "display_name": "&#216;rjan Johansen", "link": "https://stackoverflow.com/users/1088108/%c3%98rjan-johansen"}, "edited": false, "score": 2, "creation_date": 1426029327, "post_id": 28974252, "comment_id": 46202708, "body": "Minor quibble: <code>&lt;,&gt;</code> isn&#39;t a legal operator name."}, {"owner": {"reputation": 28456, "user_id": 1094403, "user_type": "registered", "accept_rate": 83, "profile_image": "https://www.gravatar.com/avatar/3770aa7eae5c211921493abd0d2c9f5a?s=128&d=identicon&r=PG", "display_name": "Luis Casillas", "link": "https://stackoverflow.com/users/1094403/luis-casillas"}, "reply_to_user": {"reputation": 17809, "user_id": 1088108, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/63781cd38e91aa346a3849bc3ef3e550?s=128&d=identicon&r=PG&f=1", "display_name": "&#216;rjan Johansen", "link": "https://stackoverflow.com/users/1088108/%c3%98rjan-johansen"}, "edited": false, "score": 0, "creation_date": 1426104718, "post_id": 28974252, "comment_id": 46240934, "body": "@&#216;rjanJohansen: D&#39;oh!  I changed it to <code>fpair</code> (made up name, a bit of an analogy to <code>fmap</code>)."}, {"owner": {"reputation": 2628, "user_id": 1031434, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/15f496f9b9b31303923658f3a02254c1?s=128&d=identicon&r=PG", "display_name": "timdiels", "link": "https://stackoverflow.com/users/1031434/timdiels"}, "edited": false, "score": 0, "creation_date": 1426172735, "post_id": 28974252, "comment_id": 46271491, "body": "What&#39;s the advantage of keeping type classes minimal when your additions to the minimum have a default implementation based on the minimal interface?"}, {"owner": {"reputation": 17809, "user_id": 1088108, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/63781cd38e91aa346a3849bc3ef3e550?s=128&d=identicon&r=PG&f=1", "display_name": "&#216;rjan Johansen", "link": "https://stackoverflow.com/users/1088108/%c3%98rjan-johansen"}, "reply_to_user": {"reputation": 2628, "user_id": 1031434, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/15f496f9b9b31303923658f3a02254c1?s=128&d=identicon&r=PG", "display_name": "timdiels", "link": "https://stackoverflow.com/users/1031434/timdiels"}, "edited": false, "score": 0, "creation_date": 1426180930, "post_id": 28974252, "comment_id": 46277057, "body": "@timdiels I can think of (1) Less cognitive load (2) Sometimes typeclass dictionaries are constructed at runtime, in which case minimal ones would be more efficient."}], "tags": [], "owner": {"reputation": 28456, "user_id": 1094403, "user_type": "registered", "accept_rate": 83, "profile_image": "https://www.gravatar.com/avatar/3770aa7eae5c211921493abd0d2c9f5a?s=128&d=identicon&r=PG", "display_name": "Luis Casillas", "link": "https://stackoverflow.com/users/1094403/luis-casillas"}, "is_accepted": true, "score": 11, "last_activity_date": 1426104676, "last_edit_date": 1426104676, "creation_date": 1426022261, "answer_id": 28974252, "question_id": 28972612, "link": "https://stackoverflow.com/questions/28972612/typeclasses-function-with-default-implementation-vs-separate-function/28974252#28974252", "title": "Typeclasses: function with default implementation vs separate function", "body": "<p>I think there are a few elements in tension here.  There's the general idea that type class definitions ought to be <strong>minimal</strong>, and only contain <strong>independent</strong> functions.  As bhelkir's answer explains, if your class supports functions <code>a</code>, <code>b</code> and <code>c</code>, but <code>c</code> can be implemented in terms of <code>a</code> and <code>b</code>, that's an argument for defining <code>c</code> outside of the class.</p>\n\n<p>But this general idea runs into a few other conflicting issues.</p>\n\n<p>First, there is often more than one minimal set of operations that can equivalently define the same class.  The classic definition of <code>Monad</code> in Haskell is this (cleaned up a bit):</p>\n\n<pre><code>class Monad m where\n    return :: a -&gt; m a\n    (&gt;&gt;=) :: m a -&gt; (a -&gt; m b) -&gt; m b\n</code></pre>\n\n<p>But it's well known that there are alternative definitions, like this one:</p>\n\n<pre><code>class Applicative m =&gt; Monad m where\n    join :: m (m a) -&gt; m a\n</code></pre>\n\n<p><code>return</code> and <code>&gt;&gt;=</code> are sufficient to implement <code>join</code>, but <code>fmap</code>, <code>pure</code> and <code>join</code> are also sufficient to implement <code>&gt;&gt;=</code>.</p>\n\n<p>A similar thing with <code>Applicative</code>.  This is the canonical Haskell definition:</p>\n\n<pre><code>class Functor f =&gt; Applicative f where\n    pure  :: a -&gt; f a\n    (&lt;*&gt;) :: f (a -&gt; b) -&gt; f a -&gt; f b\n</code></pre>\n\n<p>But any of the following is equivalent:</p>\n\n<pre><code>class Functor f =&gt; Applicative f where\n    unit  :: f ()\n    (&lt;*&gt;) :: f (a -&gt; b) -&gt; f a -&gt; f b\n\nclass Functor f =&gt; Applicative f where\n    pure  :: a -&gt; f a\n    fpair :: f a -&gt; f b -&gt; f (a, b)\n\nclass Functor f =&gt; Applicative f where\n    unit  :: f ()\n    fpair :: f a -&gt; f b -&gt; f (a, b)\n\nclass Functor f =&gt; Applicative f where\n    unit  :: f ()\n    liftA2 :: (a -&gt; b -&gt; c) -&gt; f a -&gt; f b -&gt; f c\n</code></pre>\n\n<p>Given any of these class definitions, you can write any of the methods in any of the others as a derived function outside the class.  Why was the first one picked?  I can't answer authoritatively, but I think it brings us to the third point: <strong>performance considerations</strong>.  The <code>fpair</code> operation in many of those combines the <code>f a</code> and <code>f b</code> values by creating tuples, but for most uses of the <code>Applicative</code> class we don't actually want those tuples, we just want to combine values drawn from <code>f a</code> and <code>f b</code>; the canonical definition allows us to choose what function to do this combination with.</p>\n\n<p>Another performance consideration is that even if some methods in a class may be definable in terms of others, these generic definitions may not be optimal for all instances of the class.  If we take <code>Foldable</code> as an example, <code>foldMap</code> and <code>foldr</code> are interdefinable, but some types support one more efficiently than the other.  So often we have non-minimal class definitions to allow the instances to provide optimized implementations of methods.</p>\n"}], "owner": {"reputation": 2628, "user_id": 1031434, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/15f496f9b9b31303923658f3a02254c1?s=128&d=identicon&r=PG", "display_name": "timdiels", "link": "https://stackoverflow.com/users/1031434/timdiels"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 1348, "favorite_count": 2, "accepted_answer_id": 28974252, "answer_count": 2, "score": 14, "last_activity_date": 1426104676, "creation_date": 1426016267, "last_edit_date": 1426016778, "question_id": 28972612, "link": "https://stackoverflow.com/questions/28972612/typeclasses-function-with-default-implementation-vs-separate-function", "title": "Typeclasses: function with default implementation vs separate function", "body": "<p>When defining a typeclass, how do you decide between including/excluding a function in the typeclass' definition? For example, what are the differences between these 2 cases:</p>\n\n<pre><code>class Graph g where\n    ...\n\n    insertNode :: g -&gt; Node -&gt; g\n    insertNode graph node = ...\n</code></pre>\n\n<p>vs </p>\n\n<pre><code>class Graph g where\n    ...\n\ninsertNode :: (Graph g) =&gt; g -&gt; Node -&gt; g\ninsertNode graph node = ...\n</code></pre>\n"}, {"tags": ["haskell", "monads"], "comments": [{"owner": {"reputation": 51584, "user_id": 839246, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/9b0573c2b936b12828dd1e4cc04206dc?s=128&d=identicon&r=PG&f=1", "display_name": "bheklilr", "link": "https://stackoverflow.com/users/839246/bheklilr"}, "edited": false, "score": 0, "creation_date": 1426012849, "post_id": 28971572, "comment_id": 46194525, "body": "<code>Maybe</code> is defined in <code>base</code>, monad transformers generally come from a library like <code>transformers</code> or <code>mtl</code>.  The <code>Error</code> monad also comes from a library, along with <code>State</code>, <code>Reader</code>, and <code>Writer</code>.  In this case, <code>Maybe</code> and <code>MaybeT</code> are the odd ones out."}, {"owner": {"reputation": 171740, "user_id": 869736, "user_type": "registered", "accept_rate": 82, "profile_image": "https://www.gravatar.com/avatar/671f732e3c68c387c702112a30e5ebd8?s=128&d=identicon&r=PG&f=1", "display_name": "Louis Wasserman", "link": "https://stackoverflow.com/users/869736/louis-wasserman"}, "edited": false, "score": 1, "creation_date": 1426012923, "post_id": 28971572, "comment_id": 46194561, "body": "<code>MaybeT Identity a</code> is equivalent to <code>Maybe a</code> -- it reduces to a newtype <code>MaybeT</code> around <code>Identity (Maybe a)</code> -- but it&#39;s not literally the same thing, partially because <code>Maybe</code> is treated as a data structure first and a monad second."}, {"owner": {"reputation": 126897, "user_id": 791604, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/ce991df7a056248d5e4f6fc3659ba733?s=128&d=identicon&r=PG", "display_name": "Daniel Wagner", "link": "https://stackoverflow.com/users/791604/daniel-wagner"}, "edited": false, "score": 2, "creation_date": 1426013912, "post_id": 28971572, "comment_id": 46195097, "body": "&quot;An example would be <code>type Maybe a = MaybeT Identity a</code>.&quot; <a href=\"http://hackage.haskell.org/package/base-4.7.0.2/docs/src/Data-Maybe.html#Maybe\" rel=\"nofollow noreferrer\">No</a>, but a correct example would be <a href=\"http://hackage.haskell.org/package/transformers-0.4.3.0/docs/src/Control-Monad-Trans-State-Lazy.html#State\" rel=\"nofollow noreferrer\"><code>type State s = StateT s Identity</code></a>."}], "answers": [{"tags": [], "owner": {"reputation": 21417, "user_id": 925978, "user_type": "registered", "accept_rate": 84, "profile_image": "https://www.gravatar.com/avatar/06e4467a5bd1538a92cefb20db07897a?s=128&d=identicon&r=PG&f=1", "display_name": "crockeea", "link": "https://stackoverflow.com/users/925978/crockeea"}, "is_accepted": false, "score": 2, "last_activity_date": 1426016206, "creation_date": 1426016206, "answer_id": 28972593, "question_id": 28971572, "link": "https://stackoverflow.com/questions/28971572/deriving-a-base-monad-using-a-monad-transformer-and-the-identity-monad/28972593#28972593", "title": "Deriving a base monad using a monad transformer and the identity monad", "body": "<p>The <code>Maybe</code> monad is not defined as <code>MaybeT Identity a</code> for backwards compatibility, since <code>Maybe</code> was part of GHC long before <code>MaybeT</code>.</p>\n\n<p>You are correct that using a monad transformer with <code>Identity</code> would not result in a type constructor that can be matched on. Fortunately, I've never had to pattern match on monad constructors when using the monad transformer paradigm. Instead, you can use <code>do</code> notation and monad operations (<code>liftM</code>, <code>runReaderT</code>, etc).</p>\n"}, {"comments": [{"owner": {"reputation": 13734, "user_id": 938694, "user_type": "registered", "accept_rate": 59, "profile_image": "https://www.gravatar.com/avatar/b6678a430a805dd78366d6e135b49f2d?s=128&d=identicon&r=PG", "display_name": "Cubic", "link": "https://stackoverflow.com/users/938694/cubic"}, "edited": false, "score": 1, "creation_date": 1426021112, "post_id": 28972830, "comment_id": 46199158, "body": "Are you confusing <code>Maybe</code> with <code>Either</code> here? <code>Maybe</code> has neither <code>Left</code> nor <code>Right</code> constructors. Losing pattern matching on maybe probably wouldn&#39;t be a huge loss anyway, since utility functions like <code>maybe</code> and <code>fromMaybe</code> are already part of base."}, {"owner": {"reputation": 44013, "user_id": 1477667, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/trgKM.jpg?s=128&g=1", "display_name": "dfeuer", "link": "https://stackoverflow.com/users/1477667/dfeuer"}, "edited": false, "score": 0, "creation_date": 1426049860, "post_id": 28972830, "comment_id": 46208119, "body": "I sometimes <i>wish</i> <code>StateT</code> were abstract. Some people are foolish enough to pattern match on it, and send everyone else racing around looking up which component of the result tuple is which."}], "tags": [], "owner": {"reputation": 100185, "user_id": 3234959, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/93bb12ca0f93dfddb33880316f7e66c2?s=128&d=identicon&r=PG&f=1", "display_name": "chi", "link": "https://stackoverflow.com/users/3234959/chi"}, "is_accepted": true, "score": 3, "last_activity_date": 1426022907, "last_edit_date": 1426022907, "creation_date": 1426017001, "answer_id": 28972830, "question_id": 28971572, "link": "https://stackoverflow.com/questions/28971572/deriving-a-base-monad-using-a-monad-transformer-and-the-identity-monad/28972830#28972830", "title": "Deriving a base monad using a monad transformer and the identity monad", "body": "<p>Different approaches are being used here.</p>\n\n<p>Sometimes, the base monad <code>Foo</code> is defined in terms of its transformer as <code>FooT Identity</code>. For example, <a href=\"http://hackage.haskell.org/package/transformers-0.4.3.0/docs/src/Control-Monad-Trans-State-Lazy.html#State\" rel=\"nofollow\"><code>State</code></a> from transformer package, as Daniel Wagner points out.</p>\n\n<p>Other times, the base monad <code>Foo</code> is defined independently. In these cases, it usually happens that <code>Foo</code> and <code>FooT Indentity</code> are distinct types, which however are <em>isomorphic</em>. This means that you can convert between both types without losing any information.</p>\n\n<p>I guess that since <code>Maybe</code> is defined in the Haskell report as a <code>Prelude</code> type, we can not easily redefine it as the isomorphic <code>MaybeT Identity</code>. Indeed, since it's common to destruct/eliminate values in <code>Maybe a</code> by pattern matching against <code>Nothing</code> and <code>Just _</code>, we can't use another definition. If we <em>had</em> user-definable patterns we could use <code>pattern Just x = Module.Just (Identity x)</code>, but we have not these (for now).</p>\n\n<p>Instead, other monads such as <code>State</code> are not in the <code>Prelude</code>, nor in the Haskell report. They are also not typically destructed via pattern matching by whomever is importing <code>Control.Monad.State</code>. In such cases, it felt less harmful to move to the <code>StateT Identity</code> variant.</p>\n"}], "owner": {"reputation": 1795, "user_id": 1839343, "user_type": "registered", "accept_rate": 93, "profile_image": "https://www.gravatar.com/avatar/b26d97dd045ce61904e7c6d1a9775e0c?s=128&d=identicon&r=PG", "display_name": "jules", "link": "https://stackoverflow.com/users/1839343/jules"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 152, "favorite_count": 1, "accepted_answer_id": 28972830, "answer_count": 2, "score": 3, "last_activity_date": 1426022907, "creation_date": 1426012671, "last_edit_date": 1495541966, "question_id": 28971572, "link": "https://stackoverflow.com/questions/28971572/deriving-a-base-monad-using-a-monad-transformer-and-the-identity-monad", "title": "Deriving a base monad using a monad transformer and the identity monad", "body": "<p>I read (for example <a href=\"https://wiki.haskell.org/All_About_Monads#The_Identity_monad\" rel=\"nofollow noreferrer\">here</a> and <a href=\"https://stackoverflow.com/questions/15946633/monad-transformers-with-identity-monad\">here</a>) that all of the base monads \n(<code>Mabye</code>, <code>Error</code>, ...) are derived from their corresponding monad transformers \n(<code>MaybeT</code>, <code>ErrorT</code>, ...) using the identity monad <code>Identity</code>. An example would be:</p>\n\n<pre><code>type Maybe a = MaybeT Identity a\n</code></pre>\n\n<p>But that of course doesn't result in a constructor for <code>Maybe a</code>.\nAnd in the <a href=\"https://hackage.haskell.org/package/transformers-0.4.0.0/docs/src/Control-Monad-Trans-Maybe.html\" rel=\"nofollow noreferrer\">sources</a> <code>MaybeT</code> is defined as <code>newtype MaybeT m a = MaybeT (m (Maybe a))</code>.</p>\n\n<p>Am I missing something important? \nHow could one derive a base monad using the corresponding monad transformer and the identitiy monad resulting in a concrete<br>\nconstructor that can be matched against?</p>\n"}, {"tags": ["haskell", "dictionary"], "comments": [{"owner": {"reputation": 51584, "user_id": 839246, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/9b0573c2b936b12828dd1e4cc04206dc?s=128&d=identicon&r=PG&f=1", "display_name": "bheklilr", "link": "https://stackoverflow.com/users/839246/bheklilr"}, "edited": false, "score": 0, "creation_date": 1426012429, "post_id": 28971336, "comment_id": 46194311, "body": "Have you tried the <code>update</code> function?  Something like <code>addE k k1 v = M.update (Just . M.insert k1 v)</code> should work."}, {"owner": {"reputation": 100185, "user_id": 3234959, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/93bb12ca0f93dfddb33880316f7e66c2?s=128&d=identicon&r=PG&f=1", "display_name": "chi", "link": "https://stackoverflow.com/users/3234959/chi"}, "edited": false, "score": 2, "creation_date": 1426015344, "post_id": 28971336, "comment_id": 46195878, "body": "A map of maps is fine, but depending on what you actually do with it, you might want a <code>Map (Key,Key1) Int</code> instead."}], "answers": [{"tags": [], "owner": {"reputation": 171740, "user_id": 869736, "user_type": "registered", "accept_rate": 82, "profile_image": "https://www.gravatar.com/avatar/671f732e3c68c387c702112a30e5ebd8?s=128&d=identicon&r=PG&f=1", "display_name": "Louis Wasserman", "link": "https://stackoverflow.com/users/869736/louis-wasserman"}, "is_accepted": true, "score": 3, "last_activity_date": 1426013465, "creation_date": 1426013465, "answer_id": 28971794, "question_id": 28971336, "link": "https://stackoverflow.com/questions/28971336/modifying-map-of-maps-in-haskell/28971794#28971794", "title": "modifying Map of Maps in Haskell", "body": "<pre><code>addE :: Key -&gt; Key1 -&gt; Int -&gt; MyMap -&gt; MyMap\naddE k k1 v = M.alter (Just . M.insert k1 v . fromMaybe M.empty) k\n</code></pre>\n"}], "owner": {"reputation": 950, "user_id": 890355, "user_type": "registered", "accept_rate": 67, "profile_image": "https://www.gravatar.com/avatar/4438b0be49fef6107f36fbddf30266b9?s=128&d=identicon&r=PG", "display_name": "AdelNick", "link": "https://stackoverflow.com/users/890355/adelnick"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 203, "favorite_count": 0, "accepted_answer_id": 28971794, "answer_count": 1, "score": 2, "last_activity_date": 1426013465, "creation_date": 1426011867, "question_id": 28971336, "link": "https://stackoverflow.com/questions/28971336/modifying-map-of-maps-in-haskell", "title": "modifying Map of Maps in Haskell", "body": "<p>What would be a proper way of working with a map of maps in Haskell?\nAssuming that I want to have something like</p>\n\n<pre><code>import qualified Data.Map as M\n\ntype Key1   = String\ntype MyMap1 = M.Map Key1 Int\ntype Key    = String\ntype MyMap  = M.Map Key MyMap1\n</code></pre>\n\n<p>how am I supposed to implement the function which adds elements into the map?\nThe best I can think of is</p>\n\n<pre><code>addE :: Key -&gt; Key1 -&gt; Int -&gt; MyMap -&gt; MyMap\naddE k k1 v = M.insertWith M.union k (M.singleton k1 v)\n</code></pre>\n\n<p>but <code>M.union</code> gives me <em>O(n)</em> complexity instead of expected <em>O(log n)</em></p>\n\n<p>Is there a better way to do this or another data structure that should be used instead?</p>\n"}, {"tags": ["list", "haskell", "tuples"], "comments": [{"owner": {"reputation": 41, "user_id": 4654496, "user_type": "registered", "accept_rate": 12, "profile_image": "https://www.gravatar.com/avatar/b8c2b376cf0ceb00e1f208413ace6399?s=128&d=identicon&r=PG&f=1", "display_name": "Dave5678", "link": "https://stackoverflow.com/users/4654496/dave5678"}, "reply_to_user": {"reputation": 51584, "user_id": 839246, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/9b0573c2b936b12828dd1e4cc04206dc?s=128&d=identicon&r=PG&f=1", "display_name": "bheklilr", "link": "https://stackoverflow.com/users/839246/bheklilr"}, "edited": false, "score": 0, "creation_date": 1426000450, "post_id": 28967214, "comment_id": 46186407, "body": "well i tried writing a function:         <code>titleOnly :: (t, a, y, f) -&gt; (t, f)        titleOnly (t, _, _, f) -&gt; (t, f)</code>  and then i tried using the titleOnly to call givenUser so it then only print the title and fan but this didnt work"}, {"owner": {"reputation": 41, "user_id": 4654496, "user_type": "registered", "accept_rate": 12, "profile_image": "https://www.gravatar.com/avatar/b8c2b376cf0ceb00e1f208413ace6399?s=128&d=identicon&r=PG&f=1", "display_name": "Dave5678", "link": "https://stackoverflow.com/users/4654496/dave5678"}, "reply_to_user": {"reputation": 51584, "user_id": 839246, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/9b0573c2b936b12828dd1e4cc04206dc?s=128&d=identicon&r=PG&f=1", "display_name": "bheklilr", "link": "https://stackoverflow.com/users/839246/bheklilr"}, "edited": false, "score": 0, "creation_date": 1426000762, "post_id": 28967214, "comment_id": 46186653, "body": "sorry done this now @bheklilr"}, {"owner": {"reputation": 51584, "user_id": 839246, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/9b0573c2b936b12828dd1e4cc04206dc?s=128&d=identicon&r=PG&f=1", "display_name": "bheklilr", "link": "https://stackoverflow.com/users/839246/bheklilr"}, "edited": false, "score": 0, "creation_date": 1426001155, "post_id": 28967214, "comment_id": 46186932, "body": "I would recommend using the actual type aliases instead of what you have. Try <code>filmTitle :: Film -&gt; Title</code>; <code>filmTitle (t, _, _, _) = t</code>. This is basically what you have, I changed the function name and it&#39;s only getting the title of a film. You can define <code>filmActor</code>, <code>filmYear</code>, and <code>filmFans</code> very similarly through pattern matching.  If you wanted to get both the title and the fans of all the films in your database, you could then combine <code>filmTitle</code> and <code>filmFans</code> into a new function, but this would often be done with a lambda, such as <code>map (\\f -&gt; (filmTitle f, filmFans f)) filmDatabase</code>."}, {"owner": {"reputation": 41, "user_id": 4654496, "user_type": "registered", "accept_rate": 12, "profile_image": "https://www.gravatar.com/avatar/b8c2b376cf0ceb00e1f208413ace6399?s=128&d=identicon&r=PG&f=1", "display_name": "Dave5678", "link": "https://stackoverflow.com/users/4654496/dave5678"}, "reply_to_user": {"reputation": 51584, "user_id": 839246, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/9b0573c2b936b12828dd1e4cc04206dc?s=128&d=identicon&r=PG&f=1", "display_name": "bheklilr", "link": "https://stackoverflow.com/users/839246/bheklilr"}, "edited": false, "score": 0, "creation_date": 1426001348, "post_id": 28967214, "comment_id": 46187064, "body": "okay I see what you have done to only get the film name, but how do i apply this function of <code>filmTitle</code> to my <code>givenUser</code> function used above"}, {"owner": {"reputation": 51584, "user_id": 839246, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/9b0573c2b936b12828dd1e4cc04206dc?s=128&d=identicon&r=PG&f=1", "display_name": "bheklilr", "link": "https://stackoverflow.com/users/839246/bheklilr"}, "edited": false, "score": 0, "creation_date": 1426001440, "post_id": 28967214, "comment_id": 46187132, "body": "Your <code>givenUser</code> function returns a <code>[Film]</code>.  Try checking the type of the <code>map</code> I gave you above in GHCi with <code>:type map (\\f -&gt; (filmTitle f, filmFans f))</code>.  Also remember that <code>type Database = [Film]</code>."}, {"owner": {"reputation": 41, "user_id": 4654496, "user_type": "registered", "accept_rate": 12, "profile_image": "https://www.gravatar.com/avatar/b8c2b376cf0ceb00e1f208413ace6399?s=128&d=identicon&r=PG&f=1", "display_name": "Dave5678", "link": "https://stackoverflow.com/users/4654496/dave5678"}, "reply_to_user": {"reputation": 51584, "user_id": 839246, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/9b0573c2b936b12828dd1e4cc04206dc?s=128&d=identicon&r=PG&f=1", "display_name": "bheklilr", "link": "https://stackoverflow.com/users/839246/bheklilr"}, "edited": false, "score": 0, "creation_date": 1426001927, "post_id": 28967214, "comment_id": 46187444, "body": "I see, I am new to Haskell and the types confuse me, your explanation really helped. Thank you"}, {"owner": {"reputation": 51584, "user_id": 839246, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/9b0573c2b936b12828dd1e4cc04206dc?s=128&d=identicon&r=PG&f=1", "display_name": "bheklilr", "link": "https://stackoverflow.com/users/839246/bheklilr"}, "edited": false, "score": 0, "creation_date": 1426003190, "post_id": 28967214, "comment_id": 46188294, "body": "You&#39;ll find that as you learn Haskell the types are very important.  It is far more important than in any other language I&#39;ve used what the types of values and functions are.  Whenever you see something new in Haskell, try using <code>:info symbol_name</code> (or just <code>;i</code>) or <code>:type symbol_name</code> (or just <code>:t</code>) in GHCi to get more information about it.  The types are very rigid in Haskell so it&#39;s useful to know a bit more about them when possible."}], "answers": [{"comments": [{"owner": {"reputation": 41, "user_id": 4654496, "user_type": "registered", "accept_rate": 12, "profile_image": "https://www.gravatar.com/avatar/b8c2b376cf0ceb00e1f208413ace6399?s=128&d=identicon&r=PG&f=1", "display_name": "Dave5678", "link": "https://stackoverflow.com/users/4654496/dave5678"}, "edited": false, "score": 0, "creation_date": 1426001887, "post_id": 28967699, "comment_id": 46187425, "body": "Thank you, i am just getting my head around higher order functions so forget about them when it comes to having to use them. This really made things clear thank you."}], "tags": [], "owner": {"reputation": 12213, "user_id": 671703, "user_type": "registered", "accept_rate": 92, "profile_image": "https://www.gravatar.com/avatar/96ac349a9c65277e304401ea92a62ff4?s=128&d=identicon&r=PG", "display_name": "pat", "link": "https://stackoverflow.com/users/671703/pat"}, "is_accepted": false, "score": 1, "last_activity_date": 1426001358, "creation_date": 1426001358, "answer_id": 28967699, "question_id": 28967214, "link": "https://stackoverflow.com/questions/28967214/how-to-display-only-the-title-from-the-tuple-in-haskell/28967699#28967699", "title": "how to display only the title from the tuple in haskell?", "body": "<p>You can create a function that, given a <code>Film</code>, returns its title:</p>\n\n<pre><code>filmTitle :: Film -&gt; Title\nfilmTitle (t, _, _, _) = t\n</code></pre>\n\n<p>And then map this function over the list of <code>Film</code>s returned by <code>givenUser</code>.</p>\n\n<pre><code>givenUserTitles :: Fan -&gt; [Title]\ngivenUserTitles fan = map filmTitle (givenUser fan)\n</code></pre>\n"}, {"tags": [], "owner": {"reputation": 777, "user_id": 3900056, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/45ff0756018a3a41955b5d29e3ab63fb?s=128&d=identicon&r=PG&f=1", "display_name": "zcleghern", "link": "https://stackoverflow.com/users/3900056/zcleghern"}, "is_accepted": false, "score": 1, "last_activity_date": 1426001616, "creation_date": 1426001616, "answer_id": 28967790, "question_id": 28967214, "link": "https://stackoverflow.com/questions/28967214/how-to-display-only-the-title-from-the-tuple-in-haskell/28967790#28967790", "title": "how to display only the title from the tuple in haskell?", "body": "<p>To get the first item in a tuple, use <code>fst</code>.  You can get the second item with <code>snd</code>, which is useful because many times you will use ordered pairs as tuples.  The most readable way to get the title out of the tuple I think would be:</p>\n\n<pre><code>title :: Film -&gt; Title\ntitle (t,_,_,_) = t\n</code></pre>\n\n<p>To get the fans,</p>\n\n<pre><code>fans :: Film -&gt; Fans\nfans (_,_,_,f) = f\n</code></pre>\n\n<p>Now what you want to do is match up a fan with all of the titles they are a fan of, correct?  This means that you will need to check each film title if the fan is a member of the list of fans.  You can do this with the <code>elem</code> function.</p>\n\n<p>Let me know if any of this does or doesn't work!</p>\n"}, {"tags": [], "owner": {"reputation": 20862, "user_id": 376113, "user_type": "registered", "accept_rate": 72, "profile_image": "https://www.gravatar.com/avatar/d3a5bd12fe6d876527a3cf4ac0de5fc6?s=128&d=identicon&r=PG", "display_name": "mb14", "link": "https://stackoverflow.com/users/376113/mb14"}, "is_accepted": false, "score": 1, "last_activity_date": 1426011603, "creation_date": 1426011603, "answer_id": 28971243, "question_id": 28967214, "link": "https://stackoverflow.com/questions/28967214/how-to-display-only-the-title-from-the-tuple-in-haskell/28971243#28971243", "title": "how to display only the title from the tuple in haskell?", "body": "<p>Using the <code>lens</code> package (not that I'm saying that you should use it), you can use <code>_1</code>, <code>_2</code> etc ...</p>\n\n<p>Example</p>\n\n<pre><code>(\"title\", \"actor\", \"year\", \"fans\") ^. _4\n&gt;&gt;&gt; \"fan\".\n</code></pre>\n\n<p>However, in that situtation, you probably should use a record.</p>\n"}], "owner": {"reputation": 41, "user_id": 4654496, "user_type": "registered", "accept_rate": 12, "profile_image": "https://www.gravatar.com/avatar/b8c2b376cf0ceb00e1f208413ace6399?s=128&d=identicon&r=PG&f=1", "display_name": "Dave5678", "link": "https://stackoverflow.com/users/4654496/dave5678"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 89, "favorite_count": 0, "answer_count": 3, "score": 1, "last_activity_date": 1426011603, "creation_date": 1425999971, "last_edit_date": 1426000738, "question_id": 28967214, "link": "https://stackoverflow.com/questions/28967214/how-to-display-only-the-title-from-the-tuple-in-haskell", "title": "how to display only the title from the tuple in haskell?", "body": "<p>I have the following code which creates the database...</p>\n\n<pre><code>type Title = String\ntype Singer = [String]\ntype Year = Int\ntype Fan = String\ntype Fans = [Fan]\n\ntype Film = (Title, Actor, Year, Fans)\n\ntype Database = [Film]  \n\nfilmDatabase :: Database\nfilmDatabase = [(\"Wrapped up\", [\"Olly Murs\"], 2014, [\"Garry\", \"Dave\", \"Zoe\", \"Kevin\", \"Emma\"]),\n            (\"Someone Like you\", [\"Adele\"], 2011, [\"Bill\", \"Jo\", \"Garry\", \"Kevin\", \"Olga\", \"Liz\"]),\n</code></pre>\n\n<p>I then have used the following code to search for A fan and display all the music they like. </p>\n\n<pre><code>fanOfFilms :: Fan -&gt; Film -&gt; Bool \nfanOfFilms fan (t, _, _, f) \n  |elem fan f = True\n  |otherwise = False\n\ngivenUser :: Fan -&gt;[Film]\ngivenUser fan = filter (fanOfFilms fan) testDatabase\n</code></pre>\n\n<p>I want to now take this code and make it only display the titles. How do i do this? I have tried using map and tried to use pattern matching but cannot get it to work?!</p>\n\n<p>code I tried </p>\n\n<pre><code>   titleOnly :: (t, a, y, f) -&gt; (t, f)\n   titleOnly (t, _, _, f) = (t, f)`\n</code></pre>\n\n<p>I then tried linking this to FansFilms but it looks messy and i don't know how to correctly </p>\n"}, {"tags": ["haskell"], "comments": [{"owner": {"reputation": 22266, "user_id": 649287, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/7c0ea0055b84020bf860c05f53ba53d5?s=128&d=identicon&r=PG", "display_name": "augustss", "link": "https://stackoverflow.com/users/649287/augustss"}, "edited": false, "score": 4, "creation_date": 1425997740, "post_id": 28966276, "comment_id": 46184324, "body": "First, why do you write <code>data T s</code>, don&#39;t you mean <code>data T</code>?  The <code>s</code> is purely phantom as it&#39;s not the same <code>s</code> as used in the constructor.  Second, you can&#39;t derive <code>Eq</code>, since there&#39;s no guarantee that <code>value</code> and <code>value&#39;</code> will have the same type, so how do you compare them then?  You can do it by adding <code>Typeable</code> to the constraints and use <code>cast</code> to do a type conversion, but you have to write the <code>Eq</code> instance yourself."}, {"owner": {"reputation": 1131, "user_id": 2615160, "user_type": "registered", "accept_rate": 79, "profile_image": "https://www.gravatar.com/avatar/6c82d2b99325ea24eedae70d7ea24bc8?s=128&d=identicon&r=PG", "display_name": "Sergey Sosnin", "link": "https://stackoverflow.com/users/2615160/sergey-sosnin"}, "reply_to_user": {"reputation": 22266, "user_id": 649287, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/7c0ea0055b84020bf860c05f53ba53d5?s=128&d=identicon&r=PG", "display_name": "augustss", "link": "https://stackoverflow.com/users/649287/augustss"}, "edited": false, "score": 0, "creation_date": 1425998315, "post_id": 28966276, "comment_id": 46184746, "body": "Yes, data T s it&#39;s my mistake, I&#39;ll try to use typecasting"}, {"owner": {"reputation": 11986, "user_id": 3237465, "user_type": "registered", "accept_rate": 76, "profile_image": "https://i.stack.imgur.com/vOArX.png?s=128&g=1", "display_name": "user3237465", "link": "https://stackoverflow.com/users/3237465/user3237465"}, "edited": false, "score": 0, "creation_date": 1425999390, "post_id": 28966276, "comment_id": 46185624, "body": "Are you sure you need this <code>forall</code>? Maybe <code>data T s = (Show s, Eq s) =&gt; T (String, s)</code> is what you are looking for?"}, {"owner": {"reputation": 1131, "user_id": 2615160, "user_type": "registered", "accept_rate": 79, "profile_image": "https://www.gravatar.com/avatar/6c82d2b99325ea24eedae70d7ea24bc8?s=128&d=identicon&r=PG", "display_name": "Sergey Sosnin", "link": "https://stackoverflow.com/users/2615160/sergey-sosnin"}, "reply_to_user": {"reputation": 11986, "user_id": 3237465, "user_type": "registered", "accept_rate": 76, "profile_image": "https://i.stack.imgur.com/vOArX.png?s=128&g=1", "display_name": "user3237465", "link": "https://stackoverflow.com/users/3237465/user3237465"}, "edited": false, "score": 0, "creation_date": 1425999704, "post_id": 28966276, "comment_id": 46185850, "body": "@user3237465  I have to use heterogeneous lists  in my project."}, {"owner": {"reputation": 51584, "user_id": 839246, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/9b0573c2b936b12828dd1e4cc04206dc?s=128&d=identicon&r=PG&f=1", "display_name": "bheklilr", "link": "https://stackoverflow.com/users/839246/bheklilr"}, "edited": false, "score": 2, "creation_date": 1426000693, "post_id": 28966276, "comment_id": 46186606, "body": "@SergeySosnin Are you sure you have to use heterogeneous lists?  I won&#39;t argue if you have already determined that it&#39;s the best way, but quite often I see heterogeneous lists being used where they just make things more complicated."}, {"owner": {"reputation": 11986, "user_id": 3237465, "user_type": "registered", "accept_rate": 76, "profile_image": "https://i.stack.imgur.com/vOArX.png?s=128&g=1", "display_name": "user3237465", "link": "https://stackoverflow.com/users/3237465/user3237465"}, "edited": false, "score": 0, "creation_date": 1426001312, "post_id": 28966276, "comment_id": 46187037, "body": "@Sergey Sosnin, then you can use actual heterogeneous lists like this: <a href=\"http://ideone.com/6PPDLu\" rel=\"nofollow noreferrer\">ideone.com/6PPDLu</a>"}], "answers": [{"tags": [], "owner": {"reputation": 64094, "user_id": 476408, "user_type": "registered", "accept_rate": 70, "profile_image": "https://www.gravatar.com/avatar/2bc1bffafe7aa29ef900b98d1fd1e94e?s=128&d=identicon&r=PG", "display_name": "J. Abrahamson", "link": "https://stackoverflow.com/users/476408/j-abrahamson"}, "is_accepted": false, "score": 2, "last_activity_date": 1426000946, "creation_date": 1426000946, "answer_id": 28967569, "question_id": 28966276, "link": "https://stackoverflow.com/questions/28966276/existentialquantification-and-eq-instance/28967569#28967569", "title": "&quot;ExistentialQuantification&quot; and Eq instance", "body": "<p>Each time you \"open\" an existential data type you expose a piece of data whose type has been forgotten. To handle this, Haskell must establish a type for this data from nothing and therefore it produces a completely unique, fresh type variable.</p>\n\n<p>This means that if you open two different existentials then the fresh types will not coincide no matter what you do. This is the meaning of the error messages you received.</p>\n\n<p>This is also, of course, the correct behavior. For instance, all we need to use your <code>T</code> constructor are instances of <code>Show</code> and <code>Eq</code>. Both <code>Int</code> and <code>String</code> satisfy this so the following are both valid values</p>\n\n<pre><code>data T = forall s. (Show s,Eq s) =&gt; T (String,s)\n\nx, y :: T\nx = T (\"string\", \"string\")\ny = T (\"int\", 3)\n</code></pre>\n\n<p>but we cannot expect that the <code>Eq</code> instance for either <code>String</code> or <code>Int</code> is sufficient to compare <code>3 == \"string\"</code> as your instance <code>Eq T</code> attempts to do.</p>\n\n<p>So how can this be resolved? We need an notion of equality which works regardless of the type of the data being stored inside of <code>T</code>. To do so we can establish a projection, e.g.</p>\n\n<pre><code>data T = forall s . T String s (s -&gt; (String, Int))\n</code></pre>\n\n<p>where the third parameter to <code>T</code> is a function which produces both the values <code>show</code>n representation and an integer hash value which we'll use for equality</p>\n\n<pre><code>instance Eq T where\n  T nm1 s1 f1 = T nm2 s2 f2 = \n    nm1 == nm2 &amp;&amp; snd (f1 s1) == snd (f2 s2)\n</code></pre>\n\n<p>Now this works but the representation raises an issue\u2014if the <em>only</em> thing we can do with our anonymously-typed value is apply it to its copatriot anonymously-typed function... then why not just do that in the first place?</p>\n\n<pre><code>data T = T String String Int\n\nt :: Show s =&gt; String -&gt; s -&gt; (s -&gt; Int) -&gt; T\nt nm s f = T nm (show s) (f s)\n</code></pre>\n"}, {"tags": [], "owner": {"reputation": 22266, "user_id": 649287, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/7c0ea0055b84020bf860c05f53ba53d5?s=128&d=identicon&r=PG", "display_name": "augustss", "link": "https://stackoverflow.com/users/649287/augustss"}, "is_accepted": true, "score": 3, "last_activity_date": 1426011978, "creation_date": 1426011978, "answer_id": 28971368, "question_id": 28966276, "link": "https://stackoverflow.com/questions/28966276/existentialquantification-and-eq-instance/28971368#28971368", "title": "&quot;ExistentialQuantification&quot; and Eq instance", "body": "<p>To expand on my comment, here's how you can do it</p>\n\n<pre><code>{-# LANGUAGE ExistentialQuantification #-}\nmodule E where\nimport Data.Typeable\n\ndata T = forall s. (Show s, Eq s, Typeable s) =&gt; T String s\n\ninstance Eq T where\n    T name value == T name' value' = name == name' &amp;&amp; maybe False (== value') (cast value)\n</code></pre>\n\n<p>This assumes that if the types in the existential are different then the values should not compare equal.</p>\n"}], "owner": {"reputation": 1131, "user_id": 2615160, "user_type": "registered", "accept_rate": 79, "profile_image": "https://www.gravatar.com/avatar/6c82d2b99325ea24eedae70d7ea24bc8?s=128&d=identicon&r=PG", "display_name": "Sergey Sosnin", "link": "https://stackoverflow.com/users/2615160/sergey-sosnin"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 183, "favorite_count": 1, "accepted_answer_id": 28971368, "answer_count": 2, "score": 1, "last_activity_date": 1426011978, "creation_date": 1425997463, "question_id": 28966276, "link": "https://stackoverflow.com/questions/28966276/existentialquantification-and-eq-instance", "title": "&quot;ExistentialQuantification&quot; and Eq instance", "body": "<p>When I tried to use <code>ExistentialQuantification</code> I faced with a problem</p>\n\n<p>Let's suppose you have a type</p>\n\n<pre><code>data T s = forall s. (Show s,Eq s) =&gt; T (String,s)\n</code></pre>\n\n<p>I want to write an instance <code>Eq</code> for this type, say:</p>\n\n<pre><code>instance Eq (T a) where\n    (T (name,value)) == (T (name',value'))  | (name /= name') = False\n                                            | otherwise = value == value'\n</code></pre>\n\n<p>but it fails:</p>\n\n<pre><code>Could not deduce (s1 ~ s)\nfrom the context (Show s, Eq s)\n</code></pre>\n\n<p>Another instance declaration </p>\n\n<pre><code>instance Eq a =&gt; Eq (T a) where\n</code></pre>\n\n<p>results the same error:</p>\n\n<pre><code>   Could not deduce (s1 ~ s)\n    from the context (Eq a)\n</code></pre>\n"}, {"tags": ["string", "haskell", "unicode", "io", "newline"], "answers": [{"comments": [{"owner": {"reputation": 4530, "user_id": 94687, "user_type": "registered", "accept_rate": 45, "profile_image": "https://www.gravatar.com/avatar/ef249e4381c9d55297cddc4bd5b5c3c2?s=128&d=identicon&r=PG", "display_name": "imz -- Ivan Zakharyaschev", "link": "https://stackoverflow.com/users/94687/imz-ivan-zakharyaschev"}, "edited": false, "score": 0, "creation_date": 1426017163, "post_id": 28968258, "comment_id": 46196932, "body": "In my case, I&#39;m printing encoded JSON (for debugging mostly). And I&#39;m overwhelmed with the compiler warnings about deprecation. Adding a newline to the construction function (<code>encode :: (ToJSON a) =&gt; a -&gt; ByteString</code>) is not easiliy accessible at all. Now at least I now what the underlying problem, so I won&#39;t be afraid of using ByteString everywhere else."}, {"owner": {"reputation": 126897, "user_id": 791604, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/ce991df7a056248d5e4f6fc3659ba733?s=128&d=identicon&r=PG", "display_name": "Daniel Wagner", "link": "https://stackoverflow.com/users/791604/daniel-wagner"}, "reply_to_user": {"reputation": 4530, "user_id": 94687, "user_type": "registered", "accept_rate": 45, "profile_image": "https://www.gravatar.com/avatar/ef249e4381c9d55297cddc4bd5b5c3c2?s=128&d=identicon&r=PG", "display_name": "imz -- Ivan Zakharyaschev", "link": "https://stackoverflow.com/users/94687/imz-ivan-zakharyaschev"}, "edited": false, "score": 0, "creation_date": 1426017391, "post_id": 28968258, "comment_id": 46197069, "body": "@imz--IvanZakharyaschev Adding a newline should be as easy as <code>encode foo &lt;&gt; bar</code>, where <code>foo</code> is your value whose type is an instance of <code>ToJSON</code> and <code>bar</code> is the encoding of a newline in whatever encoding JSON uses (probably UTF8?)."}, {"owner": {"reputation": 4530, "user_id": 94687, "user_type": "registered", "accept_rate": 45, "profile_image": "https://www.gravatar.com/avatar/ef249e4381c9d55297cddc4bd5b5c3c2?s=128&d=identicon&r=PG", "display_name": "imz -- Ivan Zakharyaschev", "link": "https://stackoverflow.com/users/94687/imz-ivan-zakharyaschev"}, "edited": false, "score": 0, "creation_date": 1426102206, "post_id": 28968258, "comment_id": 46239466, "body": "I think module <code>Data.ByteString.Lazy.UTF8</code> from <a href=\"http://hackage.haskell.org/package/utf8-string\" rel=\"nofollow noreferrer\">utf8-string</a> would be a proper place for such a <code>putStrLn</code>: it works exactly with the lazy bytestrings, and already <a href=\"http://hackage.haskell.org/package/utf8-string-1/docs/Data-ByteString-Lazy-UTF8.html\" rel=\"nofollow noreferrer\">has</a> functions (which are absent in the basic <code>Data.ByteString.Lazy</code>) which deal with newlines, namely: <code>lines</code>. (I&#39;ve already used <code>Data.ByteString.Lazy.UTF8</code> to convert between <code>String</code> and <code>ByteString</code> in both directions; other methods were Unicode-buggy, even IRC an <code>IsString</code> instance...)"}], "tags": [], "owner": {"reputation": 126897, "user_id": 791604, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/ce991df7a056248d5e4f6fc3659ba733?s=128&d=identicon&r=PG", "display_name": "Daniel Wagner", "link": "https://stackoverflow.com/users/791604/daniel-wagner"}, "is_accepted": true, "score": 3, "last_activity_date": 1426002849, "creation_date": 1426002849, "answer_id": 28968258, "question_id": 28965426, "link": "https://stackoverflow.com/questions/28965426/what-are-the-safer-and-correct-alternatives-to-deprecated-data-bytestring-lazy/28968258#28968258", "title": "What are the safer and correct alternatives to deprecated `Data.ByteString.Lazy.putStrLn` and why?", "body": "<p>The deprecated <code>putStrLn</code> assumes it knows how to encode the <code>'\\n'</code> character. None of the other functions you listed assume anything about encoding; they just hand off the bytes you pass them. (It is your job to ensure those bytes are correct for the encoding you intend to use.) I agree that the <code>.Char8</code> module isn't so hot -- it uses the <code>latin1</code> encoding throughout, which doesn't pass the 21st century test. You consider this code:</p>\n\n<pre><code>ByteString.putStr myString &gt;&gt; System.IO.putStrLn \"\"\n</code></pre>\n\n<p>I do not recommend this: it gives you an opportunity to have a mismatch between the encoding you used to construct <code>myString</code> and the encoding that <code>System.IO.putStrLn</code> is using. Instead, ensure that <code>myString</code> has an encoded newline in it at the end.</p>\n"}], "owner": {"reputation": 4530, "user_id": 94687, "user_type": "registered", "accept_rate": 45, "profile_image": "https://www.gravatar.com/avatar/ef249e4381c9d55297cddc4bd5b5c3c2?s=128&d=identicon&r=PG", "display_name": "imz -- Ivan Zakharyaschev", "link": "https://stackoverflow.com/users/94687/imz-ivan-zakharyaschev"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 157, "favorite_count": 0, "accepted_answer_id": 28968258, "answer_count": 1, "score": 4, "last_activity_date": 1426002849, "creation_date": 1425995125, "question_id": 28965426, "link": "https://stackoverflow.com/questions/28965426/what-are-the-safer-and-correct-alternatives-to-deprecated-data-bytestring-lazy", "title": "What are the safer and correct alternatives to deprecated `Data.ByteString.Lazy.putStrLn` and why?", "body": "<p>I wonder why <code>Data.ByteString.Lazy.putStrLn</code> is deprecated, but\n<code>Data.ByteString.Lazy.putStr</code> and <code>Data.ByteString.Lazy.hPutStr</code> are\nnot?</p>\n\n<pre><code>-- | A synonym for @hPut@, for compatibility\n--\nhPutStr :: Handle -&gt; ByteString -&gt; IO ()\nhPutStr = hPut\n\n-- | Write a ByteString to stdout\nputStr :: ByteString -&gt; IO ()\nputStr = hPut stdout\n\n-- | Write a ByteString to stdout, appending a newline byte\n--\nputStrLn :: ByteString -&gt; IO ()\nputStrLn ps = hPut stdout ps &gt;&gt; hPut stdout (singleton 0x0a)\n\n{-# DEPRECATED putStrLn\n\"Use Data.ByteString.Lazy.Char8.putStrLn instead. (Functions that rely on ASCII encodings belong in Data.ByteString.Lazy.Char8)\"\n  #-}\n\n-- | The interact function takes a function of type @ByteString -&gt; ByteString@\n-- as its argument. The entire input from the standard input device is passed\n-- to this function as its argument, and the resulting string is output on the\n-- standard output device.\n</code></pre>\n\n<p>I thought that that's because the characters stored in the string\nwon't be output correctly if you do not specify the encoding\nexplicitly.</p>\n\n<p>But then this should apply to all these functions.</p>\n\n<p>Now I suspect that only the newline character is the reason for\nconsidering this function bad.</p>\n\n<p>Then, I could simply do</p>\n\n<pre><code>Data.ByteString.Lazy.putStr myString &gt;&gt; System.IO.putStrLn \"\"\n</code></pre>\n\n<p>and feel safe about not losing information when doing the output?</p>\n\n<p>The <code>.Char8</code> variant feels somehow dangerous.</p>\n"}, {"tags": ["haskell"], "comments": [{"owner": {"reputation": 8334, "user_id": 1432801, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/c925b2538b1f594a81f6ef2922c15e1d?s=128&d=identicon&r=PG", "display_name": "Jon Surrell", "link": "https://stackoverflow.com/users/1432801/jon-surrell"}, "edited": false, "score": 5, "creation_date": 1425992662, "post_id": 28964454, "comment_id": 46180619, "body": "What are the errors?"}, {"owner": {"reputation": 8334, "user_id": 1432801, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/c925b2538b1f594a81f6ef2922c15e1d?s=128&d=identicon&r=PG", "display_name": "Jon Surrell", "link": "https://stackoverflow.com/users/1432801/jon-surrell"}, "edited": false, "score": 0, "creation_date": 1425993034, "post_id": 28964454, "comment_id": 46180848, "body": "A simple test shows these functions are giving similar results, call the functions <code>isPrime</code> and <code>isPrime&#39;</code>: <code>take 1 $ filter (\\x -&gt; isPrime x &amp;&amp; not (isPrime&#39; x)) [1..100000]</code> returns <code>[]</code>."}], "answers": [{"comments": [{"owner": {"reputation": 125, "user_id": 2307394, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/12I2D.jpg?s=128&g=1", "display_name": "Noah", "link": "https://stackoverflow.com/users/2307394/noah"}, "edited": false, "score": 0, "creation_date": 1425994450, "post_id": 28965052, "comment_id": 46181876, "body": "Oh, thanks for you answer, I think that there is something wrong with my type. Since sqrt is called, x is treated as a floating point value. but a mod function is also called, and thus the problem occurs."}, {"owner": {"reputation": 125, "user_id": 2307394, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/12I2D.jpg?s=128&g=1", "display_name": "Noah", "link": "https://stackoverflow.com/users/2307394/noah"}, "edited": false, "score": 0, "creation_date": 1425994511, "post_id": 28965052, "comment_id": 46181930, "body": "I changed my code like this:    isPrime = \\x -&gt; length (filter (\\y -&gt; (floor x) <code>mod</code> y == 0) [2..(floor(sqrt x))]) == 0"}, {"owner": {"reputation": 22266, "user_id": 649287, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/7c0ea0055b84020bf860c05f53ba53d5?s=128&d=identicon&r=PG", "display_name": "augustss", "link": "https://stackoverflow.com/users/649287/augustss"}, "reply_to_user": {"reputation": 125, "user_id": 2307394, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/12I2D.jpg?s=128&g=1", "display_name": "Noah", "link": "https://stackoverflow.com/users/2307394/noah"}, "edited": false, "score": 1, "creation_date": 1425994877, "post_id": 28965052, "comment_id": 46182215, "body": "@Noah That&#39;s probably not what you want, you want the argument to be of an integral type.  Try to define a square root function that works on integral values, and then use that."}], "tags": [], "owner": {"reputation": 807, "user_id": 1278218, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/dc600c707e4f698ad2e6d0a1b9d9f119?s=128&d=identicon&r=PG", "display_name": "erdeszt", "link": "https://stackoverflow.com/users/1278218/erdeszt"}, "is_accepted": true, "score": 2, "last_activity_date": 1426012619, "last_edit_date": 1426012619, "creation_date": 1425994148, "answer_id": 28965052, "question_id": 28964454, "link": "https://stackoverflow.com/questions/28964454/why-my-isprime-function-cant-work/28965052#28965052", "title": "Why my isPrime Function can&#39;t work?", "body": "<p>Your second function get's a strange type inferred without signatures: </p>\n\n<pre><code>isPrime :: (RealFrac a, Integral a, Floating a) =&gt; a -&gt; Bool\n</code></pre>\n\n<p>I'm not sure that any type is an instance of all those classes(Int and Double are definitely not). So your function is fine you just can't provide a value that it's operating on.</p>\n"}], "owner": {"reputation": 125, "user_id": 2307394, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/12I2D.jpg?s=128&g=1", "display_name": "Noah", "link": "https://stackoverflow.com/users/2307394/noah"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 159, "favorite_count": 0, "accepted_answer_id": 28965052, "answer_count": 1, "score": -2, "last_activity_date": 1426012619, "creation_date": 1425992586, "last_edit_date": 1425993844, "question_id": 28964454, "link": "https://stackoverflow.com/questions/28964454/why-my-isprime-function-cant-work", "title": "Why my isPrime Function can&#39;t work?", "body": "<p>I have my isPrime function in haskell like this:</p>\n\n<pre><code>isPrime = \\x -&gt; length (filter (\\y -&gt; x `mod` y == 0) [2..(x - 1)]) == 0\n</code></pre>\n\n<p>And it works fine. </p>\n\n<p>But when I was about to optimize the function like this:</p>\n\n<pre><code>isPrime = \\x -&gt; length (filter (\\y -&gt; x `mod` y == 0) [2..(floor(sqrt x))]) == 0\n</code></pre>\n\n<p>Some error occur, why would that happen? </p>\n\n<p>Well, the Error code is:</p>\n\n<pre><code>Euler.hs:34:41:\n    No instance for (Integral a0) arising from a use of \u2018mod\u2019\n    The type variable \u2018a0\u2019 is ambiguous\n    Relevant bindings include\n      y :: a0 (bound at Euler.hs:34:34)\n      x :: a0 (bound at Euler.hs:34:12)\n      isPrime :: a0 -&gt; Bool (bound at Euler.hs:34:1)\n    Note: there are several potential instances:\n      instance Integral Int -- Defined in \u2018GHC.Real\u2019\n      instance Integral Integer -- Defined in \u2018GHC.Real\u2019\n      instance Integral GHC.Types.Word -- Defined in \u2018GHC.Real\u2019\n    In the first argument of \u2018(==)\u2019, namely \u2018x `mod` y\u2019\n    In the expression: x `mod` y == 0\n    In the first argument of \u2018filter\u2019, namely \u2018(\\ y -&gt; x `mod` y == 0)\n\nEuler.hs:34:49:\n    No instance for (Eq a0) arising from a use of \u2018==\u2019\n    The type variable \u2018a0\u2019 is ambiguous\n    Relevant bindings include\n      y :: a0 (bound at Euler.hs:34:34)\n      x :: a0 (bound at Euler.hs:34:12)\n      isPrime :: a0 -&gt; Bool (bound at Euler.hs:34:1)\n    Note: there are several potential instances:\n      instance Eq a =&gt; Eq (GHC.Real.Ratio a) -- Defined in \u2018GHC.Real\u2019\n      instance Eq () -- Defined in \u2018GHC.Classes\u2019\n      instance (Eq a, Eq b) =&gt; Eq (a, b) -- Defined in \u2018GHC.Classes\u2019\n      ...plus 23 others\n    In the expression: x `mod` y == 0\n    In the first argument of \u2018filter\u2019, namely \u2018(\\ y -&gt; x `mod` y == 0)\n    In the first argument of \u2018length\u2019, namely\n      \u2018(filter (\\ y -&gt; x `mod` y == 0) [2 .. (floor (sqrt x))])\u2019\n\nEuler.hs:34:52:\n    No instance for (Num a0) arising from the literal \u20180\u2019\n    The type variable \u2018a0\u2019 is ambiguous\n    Relevant bindings include\n      y :: a0 (bound at Euler.hs:34:34)\n      x :: a0 (bound at Euler.hs:34:12)\n      isPrime :: a0 -&gt; Bool (bound at Euler.hs:34:1)\n    Note: there are several potential instances:\n      instance Num Double -- Defined in \u2018GHC.Float\u2019\n      instance Num Float -- Defined in \u2018GHC.Float\u2019\n      instance Integral a =&gt; Num (GHC.Real.Ratio a)\n        -- Defined in \u2018GHC.Real\u2019\n      ...plus three others\n    In the second argument of \u2018(==)\u2019, namely \u20180\u2019\n    In the expression: x `mod` y == 0\n    In the first argument of \u2018filter\u2019, namely \u2018(\\ y -&gt; x `mod` y == 0)\n\nEuler.hs:34:55:\n    No instance for (Enum a0)\n      arising from the arithmetic sequence \u20182 .. (floor (sqrt x))\u2019\n    The type variable \u2018a0\u2019 is ambiguous\n    Relevant bindings include\n      x :: a0 (bound at Euler.hs:34:12)\n      isPrime :: a0 -&gt; Bool (bound at Euler.hs:34:1)\n    Note: there are several potential instances:\n      instance Enum Double -- Defined in \u2018GHC.Float\u2019\n      instance Enum Float -- Defined in \u2018GHC.Float\u2019\n      instance Integral a =&gt; Enum (GHC.Real.Ratio a)\n        -- Defined in \u2018GHC.Real\u2019\n      ...plus 7 others\n    In the second argument of \u2018filter\u2019, namely\n      \u2018[2 .. (floor (sqrt x))]\u2019\n    In the first argument of \u2018length\u2019, namely\n      \u2018(filter (\\ y -&gt; x `mod` y == 0) [2 .. (floor (sqrt x))])\u2019\n    In the first argument of \u2018(==)\u2019, namely\n      \u2018length (filter (\\ y -&gt; x `mod` y == 0) [2 .. (floor (sqrt x))])\u2019\n\nEuler.hs:34:60:\n    No instance for (RealFrac a0) arising from a use of \u2018floor\u2019\n    The type variable \u2018a0\u2019 is ambiguous\n    Relevant bindings include\n      x :: a0 (bound at Euler.hs:34:12)\n      isPrime :: a0 -&gt; Bool (bound at Euler.hs:34:1)\n    Note: there are several potential instances:\n      instance RealFrac Double -- Defined in \u2018GHC.Float\u2019\n      instance RealFrac Float -- Defined in \u2018GHC.Float\u2019\n      instance Integral a =&gt; RealFrac (GHC.Real.Ratio a)\n        -- Defined in \u2018GHC.Real\u2019\n    In the expression: (floor (sqrt x))\n    In the second argument of \u2018filter\u2019, namely\n      \u2018[2 .. (floor (sqrt x))]\u2019\n    In the first argument of \u2018length\u2019, namely\n      \u2018(filter (\\ y -&gt; x `mod` y == 0) [2 .. (floor (sqrt x))])\u2019\n\nEuler.hs:34:66:\n    No instance for (Floating a0) arising from a use of \u2018sqrt\u2019\n    The type variable \u2018a0\u2019 is ambiguous\n    Relevant bindings include\n      x :: a0 (bound at Euler.hs:34:12)\n      isPrime :: a0 -&gt; Bool (bound at Euler.hs:34:1)\n    Note: there are several potential instances:\n      instance Floating Double -- Defined in \u2018GHC.Float\u2019\n      instance Floating Float -- Defined in \u2018GHC.Float\u2019\n    In the first argument of \u2018floor\u2019, namely \u2018(sqrt x)\u2019\n    In the expression: (floor (sqrt x))\n    In the second argument of \u2018filter\u2019, namely\n      \u2018[2 .. (floor (sqrt x))]\u2019\nFailed, modules loaded: none.\n</code></pre>\n\n<p>It seems that there are some problems with the mod function and floor function? </p>\n"}, {"tags": ["database", "haskell", "sqlite"], "answers": [{"comments": [{"owner": {"reputation": 729, "user_id": 2181977, "user_type": "registered", "accept_rate": 86, "profile_image": "https://www.gravatar.com/avatar/0b84fe9137990458c9a91dcadd10579c?s=128&d=identicon&r=PG", "display_name": "Fredrik Karlsson", "link": "https://stackoverflow.com/users/2181977/fredrik-karlsson"}, "edited": false, "score": 0, "creation_date": 1425987092, "post_id": 28961375, "comment_id": 46176995, "body": "Thanks! Coming back to Haskell again after some time away, I forgot about the value of type signatures even (or especially) in short pieces of code designed for figuring out how something works."}], "tags": [], "owner": {"reputation": 153048, "user_id": 9204, "user_type": "registered", "accept_rate": 82, "profile_image": "https://www.gravatar.com/avatar/c79937a093ff9e963c563e22cd385f30?s=128&d=identicon&r=PG", "display_name": "Alexey Romanov", "link": "https://stackoverflow.com/users/9204/alexey-romanov"}, "is_accepted": true, "score": 3, "last_activity_date": 1425983567, "creation_date": 1425983567, "answer_id": 28961375, "question_id": 28960386, "link": "https://stackoverflow.com/questions/28960386/haskell-sqlite3-code/28961375#28961375", "title": "Haskell sqlite3 code", "body": "<p>The issue is the type of <code>execParamStatement :: SQLiteResult a =&gt; SQLiteHandle -&gt; String -&gt; [(String,Value)] -&gt; IO (Either String [[Row a]])</code>. It means the caller can choose any <code>a</code>, so far as it is an instance of <code>SQLiteResult</code>. However, since you aren't actually using <code>b</code> for anything, the compiler just assigns a type variable <code>a0</code> to it.</p>\n\n<p>You need to specify the type (most likely you want <code>Value</code> for <code>a</code>), either through actually using the result of <code>execParamStatement</code> or with <code>execParamStatement conn statement [(\":n\", Text \"First words\")] :: IO (Either String [[Row Value]])</code>. </p>\n"}], "owner": {"reputation": 729, "user_id": 2181977, "user_type": "registered", "accept_rate": 86, "profile_image": "https://www.gravatar.com/avatar/0b84fe9137990458c9a91dcadd10579c?s=128&d=identicon&r=PG", "display_name": "Fredrik Karlsson", "link": "https://stackoverflow.com/users/2181977/fredrik-karlsson"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 384, "favorite_count": 0, "accepted_answer_id": 28961375, "answer_count": 1, "score": 0, "last_activity_date": 1425983567, "creation_date": 1425980669, "question_id": 28960386, "link": "https://stackoverflow.com/questions/28960386/haskell-sqlite3-code", "title": "Haskell sqlite3 code", "body": "<p>I'm trying to figure out how to use the sqlite moduls for haskell. This is my basic code:</p>\n\n<pre><code>import Database.SQLite\n\nfirstTry str = do \n    conn &lt;- openConnection $ \"/Users/frkkan96/Documents/src/umecore-hs/testdata/ume.umedb\"\n    statement &lt;- return $ \"select * from segments where label = :n ;\"\n    b &lt;- execParamStatement conn statement [(\":n\", Text \"First words\")]\n    closeConnection conn\n</code></pre>\n\n<p>Now, this does not compile (ghci):</p>\n\n<pre><code>sqlitetest.hs:6:9:\n    No instance for (SQLiteResult a0)\n      arising from a use of `execParamStatement'\n    In a stmt of a 'do' block:\n      execParamStatement conn statement [(\":n\", Text \"First words\")]\n    In the expression:\n      do { conn &lt;- openConnection\n                   $ \"/Users/frkkan96/Documents/src/umecore-hs/testdata/ume.umedb\";\n           statement &lt;- return $ \"select * from segments where label = :n ;\";\n           execParamStatement conn statement [(\":n\", Text \"First words\")];\n           closeConnection conn }\n    In an equation for `firstTry':\n        firstTry str\n          = do { conn &lt;- openConnection\n                         $ \"/Users/frkkan96/Documents/src/umecore-hs/testdata/ume.umedb\";\n                 statement &lt;- return $ \"select * from segments where label = :n ;\";\n                 execParamStatement conn statement [(\":n\", Text \"First words\")];\n                 .... }\n</code></pre>\n\n<p>Not sure what to do with that though. <code>execParamStatement_</code> works, but of course does not return anything, which makes it less useful for understanding how to get data out of the database.</p>\n"}, {"tags": ["haskell"], "answers": [{"tags": [], "owner": {"reputation": 507143, "user_id": 1048572, "user_type": "registered", "accept_rate": 77, "profile_image": "https://www.gravatar.com/avatar/7f2c4de95e8f4f8f5a71c3aaf0ed312a?s=128&d=identicon&r=PG", "display_name": "Bergi", "link": "https://stackoverflow.com/users/1048572/bergi"}, "is_accepted": true, "score": 13, "last_activity_date": 1425995494, "last_edit_date": 1425995494, "creation_date": 1425955415, "answer_id": 28955286, "question_id": 28955226, "link": "https://stackoverflow.com/questions/28955226/converting-do-notation-to-v-map/28955286#28955286", "title": "Converting `do notation` to &gt;&gt;= v. map", "body": "<p><code>do</code> notation maps to monadic functions, so strictly you'd write</p>\n\n<pre><code> return 1 &gt;&gt;= (\\a -&gt; [10, 20] &gt;&gt;= (\\b -&gt; return $ a+b ))\n</code></pre>\n\n<p>Now, you can replace that <code>&gt;&gt;= \u2026 return</code> by just <a href=\"http://hackage.haskell.org/package/base-4.7.0.2/docs/Control-Monad.html#v:fmap\" rel=\"nofollow noreferrer\"><code>fmap</code></a></p>\n\n<pre><code> return 1 &gt;&gt;= (\\x -&gt; fmap (\\y -&gt; x+y) [10, 20])\n</code></pre>\n\n<p>and use sections, and scrap that constant <code>1</code> right into the function</p>\n\n<pre><code> fmap (1+) [10, 20]\n</code></pre>\n\n<p>Alternatively, if you really want to take your first summand from a list, I'd recommend to use <a href=\"http://hackage.haskell.org/package/base-4.7.0.2/docs/Control-Monad.html#v:liftM2\" rel=\"nofollow noreferrer\"><code>liftM2</code></a>:</p>\n\n<pre><code> liftM2 (+) [1] [10, 20]\n</code></pre>\n\n<p>A bit more idiomatic than this, and with the same results, is the <a href=\"http://hackage.haskell.org/package/base-4.7.0.2/docs/Control-Applicative.html\" rel=\"nofollow noreferrer\"><code>Applicative</code></a> instance of lists:</p>\n\n<pre><code>(+) &lt;$&gt; [1] &lt;*&gt; [10, 20]\n</code></pre>\n"}], "owner": {"reputation": 37991, "user_id": 409976, "user_type": "registered", "accept_rate": 68, "profile_image": "https://www.gravatar.com/avatar/9ccda0b49cc974197399eae01ebd6850?s=128&d=identicon&r=PG", "display_name": "Kevin Meredith", "link": "https://stackoverflow.com/users/409976/kevin-meredith"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 86, "favorite_count": 0, "accepted_answer_id": 28955286, "answer_count": 1, "score": 3, "last_activity_date": 1425995494, "creation_date": 1425954953, "question_id": 28955226, "link": "https://stackoverflow.com/questions/28955226/converting-do-notation-to-v-map", "title": "Converting `do notation` to &gt;&gt;= v. map", "body": "<p>Given the following <code>do notation</code> code:</p>\n\n<pre><code>do\n a &lt;- return 1\n b &lt;- [10,20]\n return $ a+b\n</code></pre>\n\n<p>Is there a more idiomatic conversion:</p>\n\n<pre><code>ghci&gt; return 1 &gt;&gt;= (\\x -&gt; map (+x) [10, 20])\n[11,21]\n</code></pre>\n\n<p>versus</p>\n\n<pre><code>ghci&gt; return 1 &gt;&gt;= (\\x -&gt; [10, 20] &gt;&gt;= (\\y -&gt; [y+x]))\n[11,21]\n</code></pre>\n"}, {"tags": ["haskell", "monads"], "answers": [{"comments": [{"owner": {"reputation": 1260, "user_id": 1467419, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/78cfc322a3cc06cd4d310515286e3c78?s=128&d=identicon&r=PG", "display_name": "d3dave", "link": "https://stackoverflow.com/users/1467419/d3dave"}, "edited": false, "score": 0, "creation_date": 1425955204, "post_id": 28955206, "comment_id": 46163962, "body": "Thanks! I wasn&#39;t familiar with the <code>~</code> syntax."}], "tags": [], "owner": {"reputation": 17809, "user_id": 1088108, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/63781cd38e91aa346a3849bc3ef3e550?s=128&d=identicon&r=PG&f=1", "display_name": "&#216;rjan Johansen", "link": "https://stackoverflow.com/users/1088108/%c3%98rjan-johansen"}, "is_accepted": true, "score": 9, "last_activity_date": 1425954871, "creation_date": 1425954871, "answer_id": 28955206, "question_id": 28955137, "link": "https://stackoverflow.com/questions/28955137/why-does-this-function-not-fail-immediately/28955206#28955206", "title": "Why does this function not fail immediately?", "body": "<p>The line</p>\n\n<pre><code>let l1:l2:ls = lines str\n</code></pre>\n\n<p>means that to evaluate even just <code>l1</code>, the <em>whole</em> pattern <code>l1:l2:ls</code> needs to match, which means that a check needs to be done that <code>str</code> actually contains at least two lines.  With lazy input, that causes the behavior you see.</p>\n\n<p>You can fix it with an explicitly lazy pattern that defers the check for the second line:</p>\n\n<pre><code>let l1 : ~(l2:ls) = lines str\n</code></pre>\n\n<p>or, since a top pattern in a let is implicitly lazy, you could split it up like:</p>\n\n<pre><code>let l1:ls' = lines str\n    l2:ls = ls'\n</code></pre>\n"}], "owner": {"reputation": 1260, "user_id": 1467419, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/78cfc322a3cc06cd4d310515286e3c78?s=128&d=identicon&r=PG", "display_name": "d3dave", "link": "https://stackoverflow.com/users/1467419/d3dave"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 92, "favorite_count": 0, "accepted_answer_id": 28955206, "answer_count": 1, "score": 1, "last_activity_date": 1425954871, "creation_date": 1425954242, "question_id": 28955137, "link": "https://stackoverflow.com/questions/28955137/why-does-this-function-not-fail-immediately", "title": "Why does this function not fail immediately?", "body": "<p>I have the following piece of code. <code>main</code> gets the <code>stdin</code> text and sequences it through <code>g</code>, after which <code>f</code> prints it's output and returns an appropriate <code>ExitCode</code> which is commited using <code>exitWith</code>.</p>\n\n<p>My question is why does this program, when run with the sample input, not terminate immediately after the first line (<code>test</code>) is entered, but only fails after it reads the second line (<code>test2</code>)? What I want to happen is for the <code>g</code> function to return immediately after <code>parse1</code> returns <code>Left \"left: test\"</code> and not wait until the second line is entered.</p>\n\n<p>Code:</p>\n\n<pre><code>import System.Exit\nimport Control.Monad\nimport Data.Either\n\ntype ErrType = String\n\nparse1 :: String -&gt; Either ErrType Int\nparse1 \"test\" = Left \"left: test\"\nparse1 _ = Left \"left\"\n\nparse2 :: String -&gt; Either ErrType Char\nparse2 s = Right (head s)\n\ng :: String -&gt; Either String String\ng str =\n  let l1:l2:ls = lines str\n  in either (Left . show) (Right . show) $ do\n    a &lt;- parse1 l1\n    b &lt;- parse2 l2\n    return \"placeholder\"\n\nmain = getContents &gt;&gt;= f.g &gt;&gt;= exitWith\n  where f (Right s) = putStrLn s &gt;&gt; return ExitSuccess\n        f (Left s) = putStrLn s &gt;&gt; return (ExitFailure 1)\n</code></pre>\n\n<p>Standard input stream:</p>\n\n<pre><code>test\ntest2\n</code></pre>\n"}, {"tags": ["haskell"], "comments": [{"owner": {"reputation": 10378, "user_id": 2476735, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/39e9447bbc32246fcd23b76b5e946618?s=128&d=identicon&r=PG&f=1", "display_name": "David Young", "link": "https://stackoverflow.com/users/2476735/david-young"}, "edited": false, "score": 4, "creation_date": 1425957107, "post_id": 28955122, "comment_id": 46164368, "body": "I would start by checking the types of <code>ex3</code>, <code>runContT</code> and <code>runContT ex3</code> in GHCi."}, {"owner": {"reputation": 51584, "user_id": 839246, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/9b0573c2b936b12828dd1e4cc04206dc?s=128&d=identicon&r=PG&f=1", "display_name": "bheklilr", "link": "https://stackoverflow.com/users/839246/bheklilr"}, "edited": false, "score": 2, "creation_date": 1425960788, "post_id": 28955122, "comment_id": 46165268, "body": "The error tells you precisely, the <code>runContT</code> function is expecting a function of type <code>Integer -&gt; String</code>, but you&#39;ve provided it a function of type <code>Integer -&gt; Integer</code>.  My guess is that this comes from the <code>ContT (\\fred -&gt; &quot;escape&quot;)</code> line, since that is a function <code>Integer -&gt; String</code>.  Change <code>\\fred -&gt; &quot;escape&quot;</code> to <code>\\fred -&gt; 1</code> and see if the type error goes away."}], "answers": [{"tags": [], "owner": {"reputation": 5184, "user_id": 1935631, "user_type": "registered", "accept_rate": 87, "profile_image": "https://www.gravatar.com/avatar/0e4d0d6c5ce5e9350cacc818ee350347?s=128&d=identicon&r=PG", "display_name": "Sassa NF", "link": "https://stackoverflow.com/users/1935631/sassa-nf"}, "is_accepted": false, "score": 1, "last_activity_date": 1426008685, "last_edit_date": 1426008685, "creation_date": 1425992870, "answer_id": 28964561, "question_id": 28955122, "link": "https://stackoverflow.com/questions/28955122/continuation-monad-int-and-string/28964561#28964561", "title": "Continuation Monad - Int and String", "body": "<p>First, let's see how <code>Cont</code> is defined:</p>\n\n<pre><code>data Cont r a = Cont {runCont :: (a -&gt; r) -&gt; r}\n</code></pre>\n\n<p>If you zoom in onto this declaration, you will see that <code>Cont</code> wraps a function that, given a function <code>(a-&gt;r)</code> produces <code>r</code>. In other words, it \"hides\" a value of type <code>a</code> (or <code>r</code>) \"inside\" <code>runCont</code>. So the presence of <code>Cont (\\fred -&gt; \"escape\")</code> (<code>fred</code> is a function, and is ignored) in the <code>do</code> expression tells us that <code>r</code> is <code>String</code>, and <code>runCont</code> of the entire expression is fixed to return a value of type <code>String</code>, and can only accept a function of type <code>a-&gt;String</code> for some <code>a</code>, which we'll need to work out.</p>\n\n<p>Now let's see what <code>return</code> is like:</p>\n\n<pre><code>instance Monad (Cont r) where\n    return x = Cont ($ x)  -- given a function, pass x to it\n    (Cont m) &gt;&gt;= f = -- f :: a -&gt; Cont r b, which roughly means\n                     -- f :: a -&gt; (b-&gt;r) -&gt; r\n                     -- which would roughly be Cont (\\g -&gt; m (flip f g))\n                     -- notice we pass f to m: f is the stuff that needs\n                     -- executing when m needs to; f is continuation of m\n                     let h g x = let (Cont n) = f x -- unwrap (b-&gt;r)-&gt;r\n                                 in n g\n                     in Cont (m . h)\n    -- or Cont (\\g -&gt; m (($ g) . runCont . f)), if that's easier to read\n</code></pre>\n\n<p>Notice how <code>&gt;&gt;=</code> works. If <code>m</code> does not use the function passed to it - remember, <code>runCont</code> may \"hide\" the value of type <code>r</code> directly, not necessarily the value of type <code>a</code> - then the \"continuation\" (<code>fred</code> in <code>Cont (\\fred -&gt; \"escape\")</code>) is not invoked, and you will observe \"escape\".</p>\n\n<p>So, <code>a &lt;- return 1</code> means <code>a :: Integer</code>, and clearly, <code>b &lt;- Cont (\\_ -&gt; \"escape\")</code> does not mean <code>b :: String</code> - instead, <code>b</code> may be of any type - function <code>fred</code> passed to <code>Cont</code> is ignored, so any function returning <code>String</code> will work - but the type of <code>b</code> is fixed by the remainder of the expression. <code>return $ a + b</code> simply means <code>Cont String Integer</code> - since <code>a</code> is <code>Integer</code>, so <code>b</code> is fixed to be <code>Integer</code>, too.</p>\n\n<p>Also, observe that by definition <code>show</code> in <code>runCont ex3 show</code> is destined as the continuation of the last line of the <code>do</code> expression: it is meant for the line <code>return $ a+b</code>, so you are meant to pass the function of type <code>Integer -&gt; r</code> because <code>a+b</code> is <code>Integer</code>, and you are meant to pass a function of type <code>a -&gt; String</code> because <code>r</code> is fixed by the expression <code>b &lt;- Cont (\\_ -&gt; \"escape\")</code>.</p>\n\n<p>The whole expression then is equivalent to the following:</p>\n\n<pre><code>do\n  a &lt;- return 1\n  b &lt;- Cont (\\_ -&gt; \"escape\")\n  return $ (a+b)\n==\n  return 1 &gt;&gt;= (\\a -&gt; (Cont (\\_ -&gt; \"escape\") &gt;&gt;= (\\b -&gt; return (a+b))))\n== -- apply return rule\n  Cont ($ 1) &gt;&gt;= (\\a -&gt; (Cont (\\_ -&gt; \"escape\") &gt;&gt;= \n                        (\\b -&gt; Cont ($ (a+b)))))\n== -- apply &gt;&gt;= rule\n  Cont (\\g -&gt; ($ 1) (($ g) . runCont . (\\a -&gt; (Cont (\\_ -&gt; \"escape\") &gt;&gt;= \n                                              (\\b -&gt; Cont ($ (a+b)))))))\n== -- apply &gt;&gt;= rule\n  Cont (\\g -&gt; ($ 1) (($ g) . runCont . (\\a -&gt; (Cont (\\h -&gt; \n        (\\_ -&gt; \"escape\") (($ h) . runCont . (\\b -&gt; Cont ($ (a+b)))))))))\n== -- (\\_ -&gt; x) y == x\n  Cont (\\g -&gt; ($ 1) (($ g) . runCont . (\\a -&gt; (Cont (\\h -&gt; \"escape\")))))\n== -- marking unused variables with \"_\" for clarity\n  Cont (\\g -&gt; ($ 1) (($ g) . runCont . (\\_ -&gt; (Cont (\\_ -&gt; \"escape\")))))\n== -- ($ y) (\\_ -&gt; x) == x\n  Cont (\\g -&gt; ($ g) $ runCont (Cont (\\_ -&gt; \"escape\")))\n== -- runCont (Cont x) == x\n  Cont (\\g -&gt; ($ g) (\\_ -&gt; \"escape\"))\n== -- ($ y) (\\_ -&gt; x) == x\n  Cont (\\_ -&gt; \"escape\")\n</code></pre>\n"}], "owner": {"reputation": 37991, "user_id": 409976, "user_type": "registered", "accept_rate": 68, "profile_image": "https://www.gravatar.com/avatar/9ccda0b49cc974197399eae01ebd6850?s=128&d=identicon&r=PG", "display_name": "Kevin Meredith", "link": "https://stackoverflow.com/users/409976/kevin-meredith"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 109, "favorite_count": 0, "answer_count": 1, "score": 1, "last_activity_date": 1426008685, "creation_date": 1425954124, "question_id": 28955122, "link": "https://stackoverflow.com/questions/28955122/continuation-monad-int-and-string", "title": "Continuation Monad - Int and String", "body": "<p><a href=\"http://blog.sigfpe.com/2008/12/mother-of-all-monads.html\" rel=\"nofollow\">The Mother of all Monads</a> article presents this code:</p>\n\n<pre><code>ex3 = do\n  a &lt;- return 1\n  b &lt;- ContT (\\fred -&gt; \"escape\")\n  return $ a+b\n</code></pre>\n\n<p>Then I can execute it:</p>\n\n<pre><code>ghci&gt; runContT ex3 show\n\"escape\"\n</code></pre>\n\n<p>But I can't run:</p>\n\n<pre><code>ghci&gt; runContT ex3 id\n\n&lt;interactive&gt;:51:14:\n    Couldn't match type \u2018[Char]\u2019 with \u2018Integer\u2019\n    Expected type: Integer -&gt; [Char]\n      Actual type: Integer -&gt; Integer\n    In the second argument of \u2018runContT\u2019, namely \u2018id\u2019\n    In the expression: runContT ex3 id\n</code></pre>\n\n<p>How does <code>return $ a+b</code> type-check? </p>\n\n<p>What's going on in <code>runCont ex3 show</code>? How about <code>runCont ex3 id</code> - it looks like it can't take <code>Int + [Char]</code> - but why did it compile?</p>\n"}, {"tags": ["haskell"], "answers": [{"comments": [{"owner": {"reputation": 347, "user_id": 4522343, "user_type": "registered", "accept_rate": 94, "profile_image": "https://www.gravatar.com/avatar/120005cd79a0d28edb0c6273127ecc39?s=128&d=identicon&r=PG&f=1", "display_name": "Chalupa", "link": "https://stackoverflow.com/users/4522343/chalupa"}, "edited": false, "score": 0, "creation_date": 1425954474, "post_id": 28955138, "comment_id": 46163805, "body": "what is &quot;isAlphaNum&quot; ?"}, {"owner": {"reputation": 347, "user_id": 4522343, "user_type": "registered", "accept_rate": 94, "profile_image": "https://www.gravatar.com/avatar/120005cd79a0d28edb0c6273127ecc39?s=128&d=identicon&r=PG&f=1", "display_name": "Chalupa", "link": "https://stackoverflow.com/users/4522343/chalupa"}, "edited": false, "score": 0, "creation_date": 1425954539, "post_id": 28955138, "comment_id": 46163820, "body": "I don&#39;t have any numbers in my string"}, {"owner": {"reputation": 7189, "user_id": 2898458, "user_type": "registered", "accept_rate": 89, "profile_image": "https://www.gravatar.com/avatar/bc37a9f235a6fa726c8047459ecf0a3f?s=128&d=identicon&r=PG", "display_name": "randomusername", "link": "https://stackoverflow.com/users/2898458/randomusername"}, "reply_to_user": {"reputation": 347, "user_id": 4522343, "user_type": "registered", "accept_rate": 94, "profile_image": "https://www.gravatar.com/avatar/120005cd79a0d28edb0c6273127ecc39?s=128&d=identicon&r=PG&f=1", "display_name": "Chalupa", "link": "https://stackoverflow.com/users/4522343/chalupa"}, "edited": false, "score": 1, "creation_date": 1425954802, "post_id": 28955138, "comment_id": 46163884, "body": "Then just use <code>isAlpha</code> instead"}, {"owner": {"reputation": 347, "user_id": 4522343, "user_type": "registered", "accept_rate": 94, "profile_image": "https://www.gravatar.com/avatar/120005cd79a0d28edb0c6273127ecc39?s=128&d=identicon&r=PG&f=1", "display_name": "Chalupa", "link": "https://stackoverflow.com/users/4522343/chalupa"}, "edited": false, "score": 0, "creation_date": 1425954923, "post_id": 28955138, "comment_id": 46163908, "body": "that&#39;s not splitting it by vowels though...that&#39;s what my problem is"}, {"owner": {"reputation": 7189, "user_id": 2898458, "user_type": "registered", "accept_rate": 89, "profile_image": "https://www.gravatar.com/avatar/bc37a9f235a6fa726c8047459ecf0a3f?s=128&d=identicon&r=PG", "display_name": "randomusername", "link": "https://stackoverflow.com/users/2898458/randomusername"}, "reply_to_user": {"reputation": 347, "user_id": 4522343, "user_type": "registered", "accept_rate": 94, "profile_image": "https://www.gravatar.com/avatar/120005cd79a0d28edb0c6273127ecc39?s=128&d=identicon&r=PG&f=1", "display_name": "Chalupa", "link": "https://stackoverflow.com/users/4522343/chalupa"}, "edited": false, "score": 4, "creation_date": 1425955022, "post_id": 28955138, "comment_id": 46163925, "body": "@Chalupa Stackoverflow is a question and answer site, we do not do your homework for you.  Have you considered taking my example and substituting <code>isAlpha</code> with a different function?"}, {"owner": {"reputation": 347, "user_id": 4522343, "user_type": "registered", "accept_rate": 94, "profile_image": "https://www.gravatar.com/avatar/120005cd79a0d28edb0c6273127ecc39?s=128&d=identicon&r=PG&f=1", "display_name": "Chalupa", "link": "https://stackoverflow.com/users/4522343/chalupa"}, "edited": false, "score": 0, "creation_date": 1425955471, "post_id": 28955138, "comment_id": 46164023, "body": "you mean i should write my own or is there a predefined one?"}, {"owner": {"reputation": 44013, "user_id": 1477667, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/trgKM.jpg?s=128&g=1", "display_name": "dfeuer", "link": "https://stackoverflow.com/users/1477667/dfeuer"}, "reply_to_user": {"reputation": 347, "user_id": 4522343, "user_type": "registered", "accept_rate": 94, "profile_image": "https://www.gravatar.com/avatar/120005cd79a0d28edb0c6273127ecc39?s=128&d=identicon&r=PG&f=1", "display_name": "Chalupa", "link": "https://stackoverflow.com/users/4522343/chalupa"}, "edited": false, "score": 1, "creation_date": 1425962597, "post_id": 28955138, "comment_id": 46165720, "body": "@Chalupa, think carefully: is grouping things by whether or not they are vowels in English something that&#39;s really likely to be of sufficient general utility to bother putting in a package intended for public use?"}, {"owner": {"reputation": 7189, "user_id": 2898458, "user_type": "registered", "accept_rate": 89, "profile_image": "https://www.gravatar.com/avatar/bc37a9f235a6fa726c8047459ecf0a3f?s=128&d=identicon&r=PG", "display_name": "randomusername", "link": "https://stackoverflow.com/users/2898458/randomusername"}, "reply_to_user": {"reputation": 347, "user_id": 4522343, "user_type": "registered", "accept_rate": 94, "profile_image": "https://www.gravatar.com/avatar/120005cd79a0d28edb0c6273127ecc39?s=128&d=identicon&r=PG&f=1", "display_name": "Chalupa", "link": "https://stackoverflow.com/users/4522343/chalupa"}, "edited": false, "score": 0, "creation_date": 1425997705, "post_id": 28955138, "comment_id": 46184300, "body": "@Chalupa If you are still lost for an answer, then see my edits and review your haskell."}, {"owner": {"reputation": 54864, "user_id": 404970, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/o6X94.jpg?s=128&g=1", "display_name": "molbdnilo", "link": "https://stackoverflow.com/users/404970/molbdnilo"}, "edited": false, "score": 0, "creation_date": 1425998737, "post_id": 28955138, "comment_id": 46185094, "body": "@randomusername I usually blame the hardware. Or sunspots. ;-)"}], "tags": [], "owner": {"reputation": 7189, "user_id": 2898458, "user_type": "registered", "accept_rate": 89, "profile_image": "https://www.gravatar.com/avatar/bc37a9f235a6fa726c8047459ecf0a3f?s=128&d=identicon&r=PG", "display_name": "randomusername", "link": "https://stackoverflow.com/users/2898458/randomusername"}, "is_accepted": true, "score": 6, "last_activity_date": 1426000997, "last_edit_date": 1426000997, "creation_date": 1425954246, "answer_id": 28955138, "question_id": 28955012, "link": "https://stackoverflow.com/questions/28955012/groupby-function-in-haskell/28955138#28955138", "title": "groupBy function in Haskell", "body": "<p>Like this</p>\n\n<pre><code>ghci&gt; import Data.Char\nghci&gt; import Data.List\nghci&gt; groupBy (const isAlphaNum) \"A bunch of words and numbers34\"\n[\"A\",\" bunch\",\" of\",\" words\",\" and\",\" numbers34\"]\n</code></pre>\n\n<p>Or</p>\n\n<pre><code>ghci&gt; groupBy (const isAlpha) \"A bunch of words and numbers34\"\n[\"A\",\" bunch\",\" of\",\" words\",\" and\",\" numbers\",\"3\",\"4\"]\n</code></pre>\n\n<p><strong>Edit:</strong> Since there has been no indication that a solution has been found to the extended problem, in the interest of keeping up the standard of SO I shall complete the answer to the problem:</p>\n\n<pre><code>import Data.List\n\nisVowel :: Char -&gt; Bool\nisVowel c = c `elem` \"aeiouy\"\n\nbothVowelConsonant :: Char -&gt; Char -&gt; Bool\nbothVowelConsonant a b = all isVowel [a,b] || not (any isVowel [a,b])\n\nsplitByVowel :: String -&gt; [String]\nsplitByVowel s = groupBy bothVowelConsonant s\n</code></pre>\n"}], "owner": {"reputation": 347, "user_id": 4522343, "user_type": "registered", "accept_rate": 94, "profile_image": "https://www.gravatar.com/avatar/120005cd79a0d28edb0c6273127ecc39?s=128&d=identicon&r=PG&f=1", "display_name": "Chalupa", "link": "https://stackoverflow.com/users/4522343/chalupa"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 1325, "favorite_count": 0, "accepted_answer_id": 28955138, "answer_count": 1, "score": 1, "last_activity_date": 1426000997, "creation_date": 1425953411, "question_id": 28955012, "link": "https://stackoverflow.com/questions/28955012/groupby-function-in-haskell", "title": "groupBy function in Haskell", "body": "<p>I know the Data.List module comes with the predefined function groupBy which i want to use to split a string into groups of consecutive vowels and non-vowels. the format of the function groupBy is as follows:</p>\n\n<pre><code>groupBy :: (a -&gt; a -&gt; Bool) -&gt; [a] -&gt; [[a]]\n</code></pre>\n\n<p>How can I use this format to do the splitting for a string? \nThanks</p>\n"}, {"tags": ["haskell"], "comments": [{"owner": {"reputation": 13807, "user_id": 2407038, "user_type": "registered", "accept_rate": 64, "profile_image": "https://www.gravatar.com/avatar/538f6f4a9aa43841841de7d8e8b169fc?s=128&d=identicon&r=PG&f=1", "display_name": "user2407038", "link": "https://stackoverflow.com/users/2407038/user2407038"}, "edited": false, "score": 18, "creation_date": 1425946855, "post_id": 28954085, "comment_id": 46161817, "body": "<a href=\"https://wiki.haskell.org/Monomorphism_restriction\" rel=\"nofollow noreferrer\">Monomorphism restriction</a>"}, {"owner": {"reputation": 10378, "user_id": 2476735, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/39e9447bbc32246fcd23b76b5e946618?s=128&d=identicon&r=PG&f=1", "display_name": "David Young", "link": "https://stackoverflow.com/users/2476735/david-young"}, "edited": false, "score": 2, "creation_date": 1425949766, "post_id": 28954085, "comment_id": 46162693, "body": "It&#39;s a shame that it&#39;s hard to search for this kind of problem on Stack Overflow, especially considering how many people run into it (<a href=\"http://stackoverflow.com/search?tab=newest&amp;q=%5bhaskell%5d%20monomorphism\">stackoverflow.com/&hellip;</a>). You would only know the best keyword (monomorphism) if you already know the solution."}, {"owner": {"reputation": 64805, "user_id": 286871, "user_type": "registered", "accept_rate": 77, "profile_image": "https://i.stack.imgur.com/xNBpr.png?s=128&g=1", "display_name": "Tikhon Jelvis", "link": "https://stackoverflow.com/users/286871/tikhon-jelvis"}, "reply_to_user": {"reputation": 10378, "user_id": 2476735, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/39e9447bbc32246fcd23b76b5e946618?s=128&d=identicon&r=PG&f=1", "display_name": "David Young", "link": "https://stackoverflow.com/users/2476735/david-young"}, "edited": false, "score": 6, "creation_date": 1425950184, "post_id": 28954085, "comment_id": 46162805, "body": "@DavidYoung: Honestly, this is mostly GHCs fault. Much of this could be avoided if the error message gave you a hint that the MMR could be at fault."}], "owner": {"reputation": 7193, "user_id": 363663, "user_type": "registered", "accept_rate": 71, "profile_image": "https://www.gravatar.com/avatar/c59cd40f0edcd3feea80c7ca09bc8e76?s=128&d=identicon&r=PG", "display_name": "sof", "link": "https://stackoverflow.com/users/363663/sof"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 86, "favorite_count": 0, "closed_date": 1426688115, "answer_count": 0, "score": 1, "last_activity_date": 1537301156, "creation_date": 1425946672, "last_edit_date": 1537301156, "question_id": 28954085, "link": "https://stackoverflow.com/questions/28954085/why-type-inference-from-pointfree-source-code-dysfunctional", "closed_reason": "Duplicate", "title": "Why type inference from pointfree source code dysfunctional?", "body": "<p>To test the <code>type inference</code> on Haskell I wrote simple function aliases in <code>pointfree</code> style below, then tried to load their source files to <code>GHCi 7.8.3</code>. Why was it consequently broken on <code>add'</code> and <code>compare'</code>?</p>\n\n<pre><code>id' = id\n\nGHCi&gt; :t id'\nGHCi&gt; id' :: a -&gt; a\n\nadd' = (+)\n\nGHCi&gt; :t add'\nGHCi&gt; add' :: Integer -&gt; Integer -&gt; Integer\n\ncompare' = compare\n\nGHCi&gt; type variable is ambiguous\n</code></pre>\n\n<p>It would work well if I had typed them directly on <code>GHCi</code> e.g.</p>\n\n<pre><code>GHCi&gt; let add' = (+)\n\nGHCi&gt; let compare' = compare\n</code></pre>\n\n<p>or changed the source code to <code>pointful</code> style e.g.</p>\n\n<pre><code>add' x y = x + y\n\ncompare' x y = compare x y \n</code></pre>\n\n<p><strong>Solution</strong></p>\n\n<p>Add the directive <code>{-# LANGUAGE NoMonomorphismRestriction #-}</code> to the affected source files.</p>\n"}, {"tags": ["haskell", "recursion"], "answers": [{"comments": [{"owner": {"reputation": 347, "user_id": 4522343, "user_type": "registered", "accept_rate": 94, "profile_image": "https://www.gravatar.com/avatar/120005cd79a0d28edb0c6273127ecc39?s=128&d=identicon&r=PG&f=1", "display_name": "Chalupa", "link": "https://stackoverflow.com/users/4522343/chalupa"}, "edited": false, "score": 0, "creation_date": 1425942759, "post_id": 28953400, "comment_id": 46160485, "body": "where would i need to write this line?"}, {"owner": {"reputation": 357162, "user_id": 28804, "user_type": "registered", "accept_rate": 74, "profile_image": "https://www.gravatar.com/avatar/015c999a9db79ffb3030b3cc207d0be8?s=128&d=identicon&r=PG", "display_name": "mipadi", "link": "https://stackoverflow.com/users/28804/mipadi"}, "reply_to_user": {"reputation": 347, "user_id": 4522343, "user_type": "registered", "accept_rate": 94, "profile_image": "https://www.gravatar.com/avatar/120005cd79a0d28edb0c6273127ecc39?s=128&d=identicon&r=PG&f=1", "display_name": "Chalupa", "link": "https://stackoverflow.com/users/4522343/chalupa"}, "edited": false, "score": 2, "creation_date": 1425943172, "post_id": 28953400, "comment_id": 46160630, "body": "@Chalupa: It&#39;s another function definition, so, I guess, wherever you&#39;re defining functions."}, {"owner": {"reputation": 347, "user_id": 4522343, "user_type": "registered", "accept_rate": 94, "profile_image": "https://www.gravatar.com/avatar/120005cd79a0d28edb0c6273127ecc39?s=128&d=identicon&r=PG&f=1", "display_name": "Chalupa", "link": "https://stackoverflow.com/users/4522343/chalupa"}, "edited": false, "score": 0, "creation_date": 1425943310, "post_id": 28953400, "comment_id": 46160679, "body": "I don&#39;t understand this solution because intSquareRoot takes an int, so how can i use map with something that&#39;s only an int?"}, {"owner": {"reputation": 357162, "user_id": 28804, "user_type": "registered", "accept_rate": 74, "profile_image": "https://www.gravatar.com/avatar/015c999a9db79ffb3030b3cc207d0be8?s=128&d=identicon&r=PG", "display_name": "mipadi", "link": "https://stackoverflow.com/users/28804/mipadi"}, "reply_to_user": {"reputation": 347, "user_id": 4522343, "user_type": "registered", "accept_rate": 94, "profile_image": "https://www.gravatar.com/avatar/120005cd79a0d28edb0c6273127ecc39?s=128&d=identicon&r=PG&f=1", "display_name": "Chalupa", "link": "https://stackoverflow.com/users/4522343/chalupa"}, "edited": false, "score": 3, "creation_date": 1425943382, "post_id": 28953400, "comment_id": 46160702, "body": "@Chalupa: <code>map</code> take a function and a list, and applies the function to each element in the list (returning a new list). So if you pass <code>arraySquareRoot</code> a list of ints, then map will apply <code>intSquareRoot</code> to each element of that list (an int)."}], "tags": [], "owner": {"reputation": 357162, "user_id": 28804, "user_type": "registered", "accept_rate": 74, "profile_image": "https://www.gravatar.com/avatar/015c999a9db79ffb3030b3cc207d0be8?s=128&d=identicon&r=PG", "display_name": "mipadi", "link": "https://stackoverflow.com/users/28804/mipadi"}, "is_accepted": false, "score": 4, "last_activity_date": 1425942534, "creation_date": 1425942534, "answer_id": 28953400, "question_id": 28953351, "link": "https://stackoverflow.com/questions/28953351/how-to-modify-this-haskell-square-root-function-to-take-an-array/28953400#28953400", "title": "How to modify this Haskell square root function to take an array", "body": "<p>You can use <code>map</code>:</p>\n\n<pre><code>arraySquareRoot = map intSquareRoot\n</code></pre>\n"}, {"comments": [{"owner": {"reputation": 347, "user_id": 4522343, "user_type": "registered", "accept_rate": 94, "profile_image": "https://www.gravatar.com/avatar/120005cd79a0d28edb0c6273127ecc39?s=128&d=identicon&r=PG&f=1", "display_name": "Chalupa", "link": "https://stackoverflow.com/users/4522343/chalupa"}, "edited": false, "score": 0, "creation_date": 1425943725, "post_id": 28953523, "comment_id": 46160811, "body": "So would it look something like thi? intListSquareRoot :: [Int] -&gt; [Int] intListSquareRoot n = try n where   try i   | i<i>i &gt; n   = try (i - 1)            | i</i>i &lt;= n  = i"}, {"owner": {"reputation": 23444, "user_id": 414413, "user_type": "registered", "accept_rate": 79, "profile_image": "https://www.gravatar.com/avatar/6de2113f01432aa844dc85070ff33e89?s=128&d=identicon&r=PG", "display_name": "Cirdec", "link": "https://stackoverflow.com/users/414413/cirdec"}, "reply_to_user": {"reputation": 347, "user_id": 4522343, "user_type": "registered", "accept_rate": 94, "profile_image": "https://www.gravatar.com/avatar/120005cd79a0d28edb0c6273127ecc39?s=128&d=identicon&r=PG&f=1", "display_name": "Chalupa", "link": "https://stackoverflow.com/users/4522343/chalupa"}, "edited": false, "score": 1, "creation_date": 1425943849, "post_id": 28953523, "comment_id": 46160852, "body": "@Chalupa No, there&#39;s an <code>intListSquareRoot :: [Int] -&gt; [Int]</code> already defined in this answer."}, {"owner": {"reputation": 100185, "user_id": 3234959, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/93bb12ca0f93dfddb33880316f7e66c2?s=128&d=identicon&r=PG&f=1", "display_name": "chi", "link": "https://stackoverflow.com/users/3234959/chi"}, "reply_to_user": {"reputation": 347, "user_id": 4522343, "user_type": "registered", "accept_rate": 94, "profile_image": "https://www.gravatar.com/avatar/120005cd79a0d28edb0c6273127ecc39?s=128&d=identicon&r=PG&f=1", "display_name": "Chalupa", "link": "https://stackoverflow.com/users/4522343/chalupa"}, "edited": false, "score": 3, "creation_date": 1425943951, "post_id": 28953523, "comment_id": 46160889, "body": "@Chalupa This answer suggests that you should <i>not</i> define <code>intListSquareRoot</code> at all -- you can directly use the original function and <code>map</code>: for instance <code>map intSquareRoot [16,36,25]</code> returns <code>[4,6,5]</code>."}, {"owner": {"reputation": 347, "user_id": 4522343, "user_type": "registered", "accept_rate": 94, "profile_image": "https://www.gravatar.com/avatar/120005cd79a0d28edb0c6273127ecc39?s=128&d=identicon&r=PG&f=1", "display_name": "Chalupa", "link": "https://stackoverflow.com/users/4522343/chalupa"}, "reply_to_user": {"reputation": 23444, "user_id": 414413, "user_type": "registered", "accept_rate": 79, "profile_image": "https://www.gravatar.com/avatar/6de2113f01432aa844dc85070ff33e89?s=128&d=identicon&r=PG", "display_name": "Cirdec", "link": "https://stackoverflow.com/users/414413/cirdec"}, "edited": false, "score": 0, "creation_date": 1425943967, "post_id": 28953523, "comment_id": 46160895, "body": "@cirdec i know i was talking about what my function would look like"}, {"owner": {"reputation": 23444, "user_id": 414413, "user_type": "registered", "accept_rate": 79, "profile_image": "https://www.gravatar.com/avatar/6de2113f01432aa844dc85070ff33e89?s=128&d=identicon&r=PG", "display_name": "Cirdec", "link": "https://stackoverflow.com/users/414413/cirdec"}, "reply_to_user": {"reputation": 347, "user_id": 4522343, "user_type": "registered", "accept_rate": 94, "profile_image": "https://www.gravatar.com/avatar/120005cd79a0d28edb0c6273127ecc39?s=128&d=identicon&r=PG&f=1", "display_name": "Chalupa", "link": "https://stackoverflow.com/users/4522343/chalupa"}, "edited": false, "score": 3, "creation_date": 1425944227, "post_id": 28953523, "comment_id": 46160992, "body": "@Chalupa You&#39;ve already defined <code>intSquareRoot</code>. Leave it alone. If you need to <i>change</i> something you&#39;ve already made to do something else, you are probably doing something wrong. Ask yourself, is there anything wrong about the design of <code>intSquareRoot</code>? No, it&#39;s about as simple as possible; there&#39;s nothing wrong with it. That means you should be looking for a way to <i>reuse</i> it rather than trying to <i>change</i> it."}], "tags": [], "owner": {"reputation": 100892, "user_id": 745903, "user_type": "registered", "accept_rate": 74, "profile_image": "https://www.gravatar.com/avatar/50933f6638836741e620669b3940410e?s=128&d=identicon&r=PG", "display_name": "leftaroundabout", "link": "https://stackoverflow.com/users/745903/leftaroundabout"}, "is_accepted": true, "score": 8, "last_activity_date": 1425945528, "last_edit_date": 1425945528, "creation_date": 1425943217, "answer_id": 28953523, "question_id": 28953351, "link": "https://stackoverflow.com/questions/28953351/how-to-modify-this-haskell-square-root-function-to-take-an-array/28953523#28953523", "title": "How to modify this Haskell square root function to take an array", "body": "<h2>Don't.</h2>\n\n<p>The idea of &ldquo;looping through some collection&rdquo;, putting each result in the corresponding slot of its input, is a somewhat trivial, extremely common pattern. Patterns are for OO programmers. In Haskell, when there's a pattern, we want to <em>abstract</em> over it, i.e. give it a simple name that we can always re-use without extra boilerplate.</p>\n\n<p>This particular &ldquo;pattern&rdquo; is the <em>functor</em> operation<sup>1</sup>. For lists it's called</p>\n\n<pre><code>map :: (a-&gt;b) -&gt; [a]-&gt;[b]\n</code></pre>\n\n<p>more generally (e.g. it'll also work with real arrays; lists aren't actually arrays),</p>\n\n<pre><code>class Functor f where\n  fmap :: (a-&gt;b) -&gt; f a-&gt;f b\n</code></pre>\n\n<p>So instead of defining an extra function</p>\n\n<pre><code>intListSquareRoot :: [Int] -&gt; [Int]\nintListSquareRoot = ...\n</code></pre>\n\n<p>you simply use <code>map intSquareRoot</code> right where you wanted to use that function.</p>\n\n<p>Of course, you could also define that &ldquo;lifted&rdquo; version of <code>intSquareRoot</code>,</p>\n\n<pre><code>intListSquareRoot = map intSquareRoot\n</code></pre>\n\n<p>but that gains you practically nothing over simply inlining the <code>map</code> call right where you need it.</p>\n\n<hr>\n\n<h2>If you insist</h2>\n\n<p>That said... it's of course valid to wonder how <code>map</code> itself works. Well, you can manually &ldquo;loop&rdquo; through a list by recursion:</p>\n\n<pre><code>map' :: (a-&gt;b) -&gt; [a]-&gt;[b]\nmap' _ [] = []\nmap' f (x:xs) = f x : map' f xs\n</code></pre>\n\n<p>Now, you could inline your specific function here</p>\n\n<pre><code>intListSquareRoot' :: [Int] -&gt; [Int]\nintListSquareRoot' [] = []\nintListSquareRoot' (x:xs) = intSquareRoot x : intListSquareRoot' xs\n</code></pre>\n\n<p>This is not only much more clunky and awkward than quickly inserting the <code>map</code> magic word, it will also often be slower: compilers such as GHC can make better optimisations when they work on higher-level concepts<sup>2</sup> such as folds, than when they have to work again and again with manually defined recursion.</p>\n\n<hr>\n\n<p><sup>1</sup><sub>Not to be confused what many C++ programmers call a &ldquo;<a href=\"https://en.wikipedia.org/wiki/Function_object\" rel=\"nofollow\">functor</a>&rdquo;. Haskell uses the word in the <a href=\"https://en.wikipedia.org/wiki/Functor\" rel=\"nofollow\">correct mathematical sense</a>, which comes from category theory.</sub></p>\n\n<p><sup>2</sup><sub>This is why languages such as Matlab and APL actually achieve decent performance for special applications, although they are dynamically-typed, interpreted languages: they have this special case of &ldquo;vector looping&rdquo; hard-coded into their very syntax. (Unfortunately, this is pretty much the <em>only</em> thing they can do well...)</sub></p>\n"}], "owner": {"reputation": 347, "user_id": 4522343, "user_type": "registered", "accept_rate": 94, "profile_image": "https://www.gravatar.com/avatar/120005cd79a0d28edb0c6273127ecc39?s=128&d=identicon&r=PG&f=1", "display_name": "Chalupa", "link": "https://stackoverflow.com/users/4522343/chalupa"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 224, "favorite_count": 0, "accepted_answer_id": 28953523, "answer_count": 2, "score": 0, "last_activity_date": 1563081332, "creation_date": 1425942202, "last_edit_date": 1563081332, "question_id": 28953351, "link": "https://stackoverflow.com/questions/28953351/how-to-modify-this-haskell-square-root-function-to-take-an-array", "title": "How to modify this Haskell square root function to take an array", "body": "<p>I have a function that will take and int and return its square root. However now i want to modify it so that it takes an array of integers and gives back an array with the square roots of the elements of the first array. I know Haskell does not use loops so how can this modification be done? Thanks. </p>\n\n<pre><code>intSquareRoot :: Int -&gt; Int\nintSquareRoot n = try n where\n  try i   | i*i &gt; n   = try (i - 1) \n          | i*i &lt;= n  = i\n</code></pre>\n"}, {"tags": ["haskell", "design-patterns", "io", "functional-programming"], "comments": [{"owner": {"reputation": 23444, "user_id": 414413, "user_type": "registered", "accept_rate": 79, "profile_image": "https://www.gravatar.com/avatar/6de2113f01432aa844dc85070ff33e89?s=128&d=identicon&r=PG", "display_name": "Cirdec", "link": "https://stackoverflow.com/users/414413/cirdec"}, "edited": false, "score": 0, "creation_date": 1425940212, "post_id": 28952699, "comment_id": 46159471, "body": "I presume that <code>choose</code> is the only thing that uses <code>IO</code>?"}, {"owner": {"reputation": 44680, "user_id": 1031791, "user_type": "registered", "accept_rate": 54, "profile_image": "https://www.gravatar.com/avatar/fb710534fda446d2286074bb7692e65a?s=128&d=identicon&r=PG", "display_name": "MaiaVictor", "link": "https://stackoverflow.com/users/1031791/maiavictor"}, "reply_to_user": {"reputation": 23444, "user_id": 414413, "user_type": "registered", "accept_rate": 79, "profile_image": "https://www.gravatar.com/avatar/6de2113f01432aa844dc85070ff33e89?s=128&d=identicon&r=PG", "display_name": "Cirdec", "link": "https://stackoverflow.com/users/414413/cirdec"}, "edited": false, "score": 0, "creation_date": 1425940397, "post_id": 28952699, "comment_id": 46159554, "body": "Yes, it presumably asks the user which monster it wants to kill, <code>choose :: (Show a, Read a) =&gt; [a] -&gt; IO a</code>, something like that. Of course, later on there could be other IO using primitives I&#39;m not thinking right now."}], "answers": [{"tags": [], "owner": {"reputation": 8676, "user_id": 1113881, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/sBc0F.jpg?s=128&g=1", "display_name": "CR Drost", "link": "https://stackoverflow.com/users/1113881/cr-drost"}, "is_accepted": false, "score": 2, "last_activity_date": 1425944683, "creation_date": 1425944683, "answer_id": 28953770, "question_id": 28952699, "link": "https://stackoverflow.com/questions/28952699/on-haskell-how-do-you-make-an-ai-control-a-function-using-io-or-how-do-you-pr/28953770#28953770", "title": "On Haskell, how do you make an AI control a function using IO (or, how do you properly redesign it)?", "body": "<p>It's not so crazy to leave the <code>IO</code> in there; it's the easiest way to get random numbers too. </p>\n\n<p>What you need to do is to pass <code>choose</code> (and whatever else is needed) as parameters into the function, so that you are accepting a parameter <code>choose :: Game -&gt; [Monster] -&gt; IO Monster</code> which you don't specify in advance. You might even specify these as their own <code>newtype</code>: </p>\n\n<pre><code>newtype MonsterChooser = MonsterChooser (Game -&gt; [Monster] -&gt; IO Monster)\n\nuserMonsterChooser = MonsterChooser $ \\_ monsters -&gt; loopUntilJust $ do\n    let indices = zip ['a'..'z'] monsters\n    putStrLn \"Choose a monster to target:\"\n    putStrLn $ unlines $ map (\\(i, monster) -&gt; i : '.' : ' ' : show monster) indices\n    index &lt;- getLine\n    return $ lookup (trim (lowercase index)) indices\n\nloopUntilJust :: (Monad m) =&gt; m (Maybe x) -&gt; m x\nloopUntilJust mmx = do\n    mx &lt;- mmx\n    case mx of Nothing -&gt; loopUntilJust mmx\n               Just x  -&gt; return x\n</code></pre>\n\n<p>So that's a bit of a more sophisticated example, allowing you to specify a MonsterChooser. The AI gets to look at the whole <code>Game</code> before choosing a monster; the user is just asked what they want to do. Then <code>sendMonsterToGraveyard :: MonsterChooser -&gt; Game -&gt; IO Monster</code> is sufficiently generic that you do not need to worry.</p>\n"}, {"tags": [], "owner": {"reputation": 23895, "user_id": 472416, "user_type": "registered", "accept_rate": 79, "profile_image": "https://www.gravatar.com/avatar/aa78d79fb4238d200e26fb87e3de947b?s=128&d=identicon&r=PG", "display_name": "utdemir", "link": "https://stackoverflow.com/users/472416/utdemir"}, "is_accepted": false, "score": 1, "last_activity_date": 1425978388, "last_edit_date": 1491982276, "creation_date": 1425978388, "answer_id": 28959686, "question_id": 28952699, "link": "https://stackoverflow.com/questions/28952699/on-haskell-how-do-you-make-an-ai-control-a-function-using-io-or-how-do-you-pr/28959686#28959686", "title": "On Haskell, how do you make an AI control a function using IO (or, how do you properly redesign it)?", "body": "<p>This is a good place to use a DSL.</p>\n\n<p>Basically, you can just define your actions and write different interpreters for those actions, you should have something like that as result:</p>\n\n<pre><code>chooseMonster :: Game Monster \nchooseMonster = do\n  monsters &lt;- monstersInPlay\n  monster &lt;- chooseMonster\n  sendToGraveyard monster\n\ninterpretPlayer = interpret game go\n  where go action = case action of\n    chooseMonster -&gt; getMonsterFromUser\n    ...\n\ninterpretAI = interpret game go\n  where go action = case action of\n    chooseMonster -&gt; calculateBestMonster\n    ...\n</code></pre>\n\n<p>Actually, IO is just the same thing, the only difference is that the IO action is interpreted by Haskell's runtime system. Just like that <code>Game</code> is an action, and <code>interpretPlayer</code> and <code>interpretAI</code> is different ways of executing those actions.</p>\n\n<p>The <a href=\"http://hackage.haskell.org/package/free\" rel=\"nofollow noreferrer\">free</a> and <a href=\"http://hackage.haskell.org/package/operational\" rel=\"nofollow noreferrer\">operational</a> packages provide an easy way to create DSL's like that. Also, you can look at <a href=\"https://softwareengineering.stackexchange.com/questions/242795/what-is-the-free-monad-interpreter-pattern\">https://softwareengineering.stackexchange.com/questions/242795/what-is-the-free-monad-interpreter-pattern</a> .</p>\n"}], "owner": {"reputation": 44680, "user_id": 1031791, "user_type": "registered", "accept_rate": 54, "profile_image": "https://www.gravatar.com/avatar/fb710534fda446d2286074bb7692e65a?s=128&d=identicon&r=PG", "display_name": "MaiaVictor", "link": "https://stackoverflow.com/users/1031791/maiavictor"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 115, "favorite_count": 0, "answer_count": 2, "score": 2, "last_activity_date": 1425978388, "creation_date": 1425939050, "last_edit_date": 1425940035, "question_id": 28952699, "link": "https://stackoverflow.com/questions/28952699/on-haskell-how-do-you-make-an-ai-control-a-function-using-io-or-how-do-you-pr", "title": "On Haskell, how do you make an AI control a function using IO (or, how do you properly redesign it)?", "body": "<p>Suppose you must define a procedure that depends on a specific decision. For example:</p>\n\n<pre><code>sendMonsterToGraveyard :: Game -&gt; IO Game\nsendMonsterToGraveyard game = do\n    let monsters = monstersInPlay game\n    monster &lt;- choose monsters\n    sendToGraveyard game monster\n</code></pre>\n\n<p>This function is an \"effect\" of an hypothetical game that lets the player chose one monster to kill. The problem with that design is that we are coupling the effect to the IO monad. What if, later on, we decide that we want an AI to use that effect (and, thus, chose a monster to kill)? That would be impossible other than making the AI aware of the terminal, but that doesn't sound robust. What is, thus, a proper way to redesign this pattern so that a game effect can be encoded without coupling it to the IO monad specifically? </p>\n\n<p><em>Note: I'm asking this upon request as a follow-up of my previous question. One of the answers actually provides a good solution for this issue, but, since it wasn't specifically addressed on the question, we decided it would be better to create a new one.</em></p>\n"}, {"tags": ["list", "haskell"], "answers": [{"comments": [{"owner": {"reputation": 51, "user_id": 4474250, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/0864e3343a73ae10c5f15155c1097612?s=128&d=identicon&r=PG&f=1", "display_name": "Tom", "link": "https://stackoverflow.com/users/4474250/tom"}, "edited": false, "score": 0, "creation_date": 1425932902, "post_id": 28951107, "comment_id": 46156081, "body": "Oh yes i see my mistake thank you! Types in haskell confuse me as i am very new to it!"}], "tags": [], "owner": {"reputation": 45741, "user_id": 744178, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/a3193139ea494c45e63752504f5ff1f2?s=128&d=identicon&r=PG", "display_name": "jwodder", "link": "https://stackoverflow.com/users/744178/jwodder"}, "is_accepted": true, "score": 3, "last_activity_date": 1425932706, "creation_date": 1425932706, "answer_id": 28951107, "question_id": 28951064, "link": "https://stackoverflow.com/questions/28951064/how-do-i-display-my-list-as-a-string-in-haskell/28951107#28951107", "title": "How do i display my list as a string in haskell?", "body": "<p>You've declared <code>filmsAsString</code> to be of type <code>[Film] -&gt; String</code>, yet its argument is clearly just a <code>Film</code>.</p>\n"}, {"tags": [], "owner": {"reputation": 1452, "user_id": 538973, "user_type": "registered", "accept_rate": 79, "profile_image": "https://www.gravatar.com/avatar/f2dc3b359948acc418b091aef228d384?s=128&d=identicon&r=PG", "display_name": "RasmusWL", "link": "https://stackoverflow.com/users/538973/rasmuswl"}, "is_accepted": false, "score": 0, "last_activity_date": 1425932999, "creation_date": 1425932999, "answer_id": 28951168, "question_id": 28951064, "link": "https://stackoverflow.com/questions/28951064/how-do-i-display-my-list-as-a-string-in-haskell/28951168#28951168", "title": "How do i display my list as a string in haskell?", "body": "<p>You should do this instead</p>\n\n<pre><code>filmAsString :: Film -&gt; String\nfilmAsString (t, a, y, f) = unlines [titleAsString t, actorsAsString a, yearAsString y, fansAsString f]\n\ndatabaseAsString :: Database -&gt; String\ndatabaseAsString = unlines . map filmAsString\n</code></pre>\n"}], "owner": {"reputation": 51, "user_id": 4474250, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/0864e3343a73ae10c5f15155c1097612?s=128&d=identicon&r=PG&f=1", "display_name": "Tom", "link": "https://stackoverflow.com/users/4474250/tom"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 116, "favorite_count": 0, "accepted_answer_id": 28951107, "answer_count": 2, "score": 0, "last_activity_date": 1425932999, "creation_date": 1425932523, "last_edit_date": 1425932596, "question_id": 28951064, "link": "https://stackoverflow.com/questions/28951064/how-do-i-display-my-list-as-a-string-in-haskell", "title": "How do i display my list as a string in haskell?", "body": "<p>Here is the code i have used to build the list.</p>\n\n<pre><code>type Title = String\ntype Actor = [String]\ntype Year = Int\ntype Fans = [String]\ntype Film = (Title, Actor, Year, Fans)\n\ntype Database = [Film]  \nfilmDatabase :: Database\nfilmDatabase = [(\"Casino Royale\", [\"Daniel Craig\", \"Eva Green\", \"Judi Dench\"], 2006, [\"Garry\", \"Dave\", \"Zoe\", \"Kevin\", \"Emma\"])...]\n</code></pre>\n\n<p>below is the code i Am using to try and display the list as the string.</p>\n\n<pre><code>titleAsString :: Title -&gt; String\ntitleAsString = show\n\nactorsAsString :: Actor -&gt; String\nactorsAsString = intercalate \", \" . map show\n\nyearAsString :: Year -&gt; String\nyearAsString = show\n\nfansAsString :: Fans -&gt; String\nfansAsString = intercalate \", \" . map show\n\nfilmsAsString :: [Film] -&gt; String\nfilmsAsString (t, a, y, f) = unlines [titleAsString t, actorsAsString a, yearAsString y, fansAsString f]\n\nfilmsAsStringDB = unlines . map filmsAsString\n</code></pre>\n\n<p>here is the error message i get..</p>\n\n<pre><code> Couldn't match type \u2018(Title, Actor, Year, Fans)\u2019 with \u2018Char\u2019\n    Expected type: Title\n      Actual type: [Film]\n    In the first argument of \u2018titleAsString\u2019, namely \u2018t\u2019\n    In the expression: titleAsString t\n</code></pre>\n\n<p>I think the problem is i haven't converted them all to a string but i'm not sure how to...</p>\n"}, {"tags": ["haskell", "lambda", "functional-programming", "scheme", "monads"], "comments": [{"owner": {"reputation": 64805, "user_id": 286871, "user_type": "registered", "accept_rate": 77, "profile_image": "https://i.stack.imgur.com/xNBpr.png?s=128&g=1", "display_name": "Tikhon Jelvis", "link": "https://stackoverflow.com/users/286871/tikhon-jelvis"}, "edited": false, "score": 9, "creation_date": 1425929797, "post_id": 28949826, "comment_id": 46154489, "body": "The documents you were reading were likely misleading. Monads are a very abstract idea and, unfortunately, abstract ideas attract all sorts of unintentional misinformation. I don&#39;t want to try explaining it myself and potentially contribute to more confusion (which is why I don&#39;t want to write a full answer), so I&#39;ll just link you to a well-regarded article for building up an intuition about monads: <a href=\"http://blog.sigfpe.com/2006/08/you-could-have-invented-monads-and.html\" rel=\"nofollow noreferrer\">&quot;You Could Have Invented Monads! (And Maybe You Already Have.)&quot;</a>."}, {"owner": {"reputation": 40537, "user_id": 465378, "user_type": "registered", "accept_rate": 85, "profile_image": "https://www.gravatar.com/avatar/c03b8d34978563858020eff0d14cc17b?s=128&d=identicon&r=PG", "display_name": "Alexis King", "link": "https://stackoverflow.com/users/465378/alexis-king"}, "reply_to_user": {"reputation": 64805, "user_id": 286871, "user_type": "registered", "accept_rate": 77, "profile_image": "https://i.stack.imgur.com/xNBpr.png?s=128&g=1", "display_name": "Tikhon Jelvis", "link": "https://stackoverflow.com/users/286871/tikhon-jelvis"}, "edited": false, "score": 1, "creation_date": 1425929884, "post_id": 28949826, "comment_id": 46154533, "body": "Not quite. Monads can be used for dumb sequencing, but they&#39;re more about what happens <i>in between</i> each operation than the sequencing itself (they&#39;ve been referred to as &quot;programmable semicolons&quot;). The article @Tikhon referred to is a great one, though, and I&#39;d definitely recommend it."}, {"owner": {"reputation": 363, "user_id": 4334680, "user_type": "registered", "accept_rate": 33, "profile_image": "https://www.gravatar.com/avatar/9b476e9ef1dd19513621f371386d5cf9?s=128&d=identicon&r=PG&f=1", "display_name": "Alex M.", "link": "https://stackoverflow.com/users/4334680/alex-m"}, "edited": false, "score": 0, "creation_date": 1552237052, "post_id": 28949826, "comment_id": 96924881, "body": "To whom it may be of interest: there is a whole timeline of monad explanatory articles available: <a href=\"https://wiki.haskell.org/Monad_tutorials_timeline\" rel=\"nofollow noreferrer\">wiki.haskell.org/Monad_tutorials_timeline</a> :) ."}], "answers": [{"tags": [], "owner": {"reputation": 8676, "user_id": 1113881, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/sBc0F.jpg?s=128&g=1", "display_name": "CR Drost", "link": "https://stackoverflow.com/users/1113881/cr-drost"}, "is_accepted": false, "score": 9, "last_activity_date": 1425932736, "last_edit_date": 1592644375, "creation_date": 1425932736, "answer_id": 28951115, "question_id": 28949826, "link": "https://stackoverflow.com/questions/28949826/lambda-expressions-as-monads-in-scheme/28951115#28951115", "title": "Lambda expressions as monads in Scheme?", "body": "<h1>Sequential Evaluation</h1>\n<p>So, sequential evaluation of expressions is not characteristic of monads, but of <em>functions</em>. From the moment you write <code>f (g x)</code> (Haskell) or <code>(f (g x))</code> (Scheme) you have sequenced <code>g</code> as happening before <code>f</code>. In Haskell we instead do this with sequencing operators like <code>(then f g)</code> and <code>(bind f (lambda (x) (make-g x)))</code> but you can do it however you'd like.</p>\n<p>The confusion is: monads <em>come with a generic notation</em> in Haskell at least, and this generic notation puts statements in imperative order. From a Scheme perspective this is a macro <code>do</code> which rewrites:</p>\n<pre><code>(do\n    (put-string &quot;Hey, what's your name?&quot;)\n    (into x get-line)\n    (put-string (string-append &quot;Hi, &quot; x &quot;!&quot;)))\n</code></pre>\n<p>to</p>\n<pre><code>(then \n    (put-string &quot;Hey, what's your name?&quot;)\n    (bind get-line (lambda (x) \n        (put-string (string-append &quot;Hi, &quot; x &quot;!&quot;)))))\n</code></pre>\n<p>Notice that lambdas get &quot;flattened&quot; and replaced with some new symbol &quot;into&quot;. (Actually in Haskell we'd say &quot;from&quot; but it's an infix operator, not a prefix operator.)</p>\n<h1>What a Monad Is</h1>\n<p>So what <strong>is</strong> a monad, really? Well, first off, let's define their part of speech: monads are <strong>adjectives</strong>, like the adjective &quot;blue&quot;. I can have a blue wagon, or a blue wheel. Monads are <strong>functors</strong>, meaning that given the function from wagons to their wheels, I can give you functions from <em>blue</em> wagons to their <em>blue</em> wheels. So functions can &quot;operate under them&quot;. But monads have two special properties. First we have an idea which only applies to &quot;blue&quot; if we make the idea <em>unusually abstract and metaphysical</em>: the adjective must be <strong>able to be applied to any value</strong> in the language. So you don't just have blue wagons and blue wheels, but also blue functions, blue programs which print &quot;Hello, World!&quot; to the screen, blue everything. Second off the adjective must be <strong>condensable</strong> in the sense that given a <em>blue</em> blue wagon, you can just give me a <em>blue</em> wagon.</p>\n<p>One adjective which does this is &quot;a nullable...&quot;. You can always take any value and produce a new, nullable value based on it: just start accepting and detecting null values! If you're in a statically-typed language where things aren't nullable by default, then this is significant. This adjective is a functor: given a function, we just transform null to null and anything else we transform with the function. It is condensable because if we have a &quot;nullable nullable string&quot; that's reducible to a nullable string: take the &quot;null&quot; and &quot;not-null null&quot; values to &quot;null&quot; and the &quot;not-null not-null string&quot; to &quot;not-null string&quot;. Finally, to represent any string as a nullable string, convert it to &quot;not-null string&quot;. This is called the <code>Maybe</code> monad. It's actually a specialized case of the <code>Either y</code> monad, which could hold a <code>y</code>.</p>\n<p>Another adjective which does this is &quot;a list of...&quot;. To apply a function under the adjective, apply it to all members of the list. To condense a list-of-lists into a list, concatenate its elements. To create a list of <code>x</code>'s from any <code>x</code>, give me back the one-element list. This is called the &quot;list monad&quot;. Writing this way is a lot like writing list comprehensions, and in fact is isomorphic to Clojure transducers, so you get maps &amp; filters for free.</p>\n<p>Another adjective which does this is &quot;a function from s to an s and a...&quot;. To create one of these from any <code>x</code>, just pair the incoming state with the <code>x</code>. To apply a function, just apply it to the appropriate side of the output pair. Easy peasy. Finally, if you have the convoluted <code>s -&gt; (s, s -&gt; (s, a))</code> situation, construct an <code>s -&gt; (s, a)</code> by feeding the incoming s to the convoluted function, taking the s that comes out of that and feeding it to the <code>s -&gt; (s, a)</code> which comes out of it. This gives you the <code>(s, a)</code> that you need to return. This is called the &quot;<code>State s</code> monad&quot; because you can envision the &quot;s&quot; as a typed state.</p>\n<p>Another adjective which does this is &quot;a program which returns a&quot;. If you have an int, we can construct a program which does nothing and returns that int. If you have a program which returns an int and a function from ints to something else, we can do the program, then apply the function to the output of the program. Finally, if you have &quot;a program which returns a program which returns an int,&quot; just form a program which runs the outer program to compute the inner one, and then runs the inner one. This is called the <code>IO x</code> monad. (Similarly with promises: a promised promised x is not much different from a promised x.)</p>\n<p>You can see that it's a very broad pattern, and it doesn't always clearly involve &quot;sequence&quot;.</p>\n<h1>Comparing Scheme to Haskell</h1>\n<p>Once you understand that Haskell describes all its I/O operations by containing <em>programs as values</em> and then combining them together, you realize that basically <strong>we do functional I/O by becoming a macro language</strong>. The macro language doesn't do <em>any</em> I/O by itself, but you use it to construct programs which do your I/O for you. You feed those into the compiler, and the compiler produces the actual program which does what you want it to do. Interpreters get a little more dicey because the interpreter needs to say &quot;if I see a value which is not a program, I will try to print that; if I see a value which <em>is</em> a program, I will try to run that program and then print that.&quot; This means that the syntax at the command prompt is subtly different from the syntax in a file.</p>\n<p>Once you understand that Haskell is a metaprogramming environment where we're constructing a program-as-a-value, you will understand how Haskell does functional I/O and you'll see the programmable syntax for &quot;monads&quot; as a meta-metaprogramming design. This design is much less complicated than macros (which we also have in Haskell; it's called &quot;Template Haskell&quot;) but gets the job done for a lot of useful cases. And it's essentially about overloading, at some level, what &quot;a; b; c; d&quot; means to be dependent on the (common) outermost adjective of the types of a, b, c, and d. For I/O it means &quot;do a, then do b, then...&quot;; for states it means &quot;thread the state produced by a into b, then the state produced by b into c, then...&quot;; for nullables it means &quot;do a, if that's not null use it to do b, if that's not null use it to do c...&quot;. For lists it's a Cartesian product of the constituent lists, &quot;pair up everything in all the ways.&quot;</p>\n"}], "owner": {"reputation": 363, "user_id": 4334680, "user_type": "registered", "accept_rate": 33, "profile_image": "https://www.gravatar.com/avatar/9b476e9ef1dd19513621f371386d5cf9?s=128&d=identicon&r=PG&f=1", "display_name": "Alex M.", "link": "https://stackoverflow.com/users/4334680/alex-m"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 1035, "favorite_count": 3, "answer_count": 1, "score": 1, "last_activity_date": 1425932736, "creation_date": 1425927808, "question_id": 28949826, "link": "https://stackoverflow.com/questions/28949826/lambda-expressions-as-monads-in-scheme", "title": "Lambda expressions as monads in Scheme?", "body": "<p>I was reading some documents on the web that were trying to present the concept of monad for Scheme programmers. The core idea was that in non-imperative programming monads are used to express the \"flow of computation\", that is to enforce a sequential evaluation of expressions. Then it struck me: since the body of a lambda expression is evaluated sequentially, should one understand that monads would be superfluous in Scheme? Are lambda bodies evaluated differently in other languages (Haskell, for instance, or ML)?</p>\n"}, {"tags": ["list", "haskell", "tuples"], "comments": [{"owner": {"reputation": 51584, "user_id": 839246, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/9b0573c2b936b12828dd1e4cc04206dc?s=128&d=identicon&r=PG&f=1", "display_name": "bheklilr", "link": "https://stackoverflow.com/users/839246/bheklilr"}, "edited": false, "score": 2, "creation_date": 1425911026, "post_id": 28944300, "comment_id": 46142784, "body": "Yes, it is possible.  Just write a function <code>prettyPrintDB :: Database -&gt; String</code>, then you can do <code>putStrLn $ prettyPrintDB testDatabase</code> to print it to the screen.  It might be easier to also write <code>prettyPrint</code> functions for your other types so that you can combine them together to write <code>prettyPrintDB</code>."}, {"owner": {"reputation": 287, "user_id": 4300537, "user_type": "registered", "accept_rate": 100, "profile_image": "https://graph.facebook.com/713271201/picture?type=large", "display_name": "Adam Piper", "link": "https://stackoverflow.com/users/4300537/adam-piper"}, "reply_to_user": {"reputation": 51584, "user_id": 839246, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/9b0573c2b936b12828dd1e4cc04206dc?s=128&d=identicon&r=PG&f=1", "display_name": "bheklilr", "link": "https://stackoverflow.com/users/839246/bheklilr"}, "edited": false, "score": 0, "creation_date": 1425916454, "post_id": 28944300, "comment_id": 46146653, "body": "I don&#39;t really understand how to do that, sorry, I am very new to Haskell so I will be struggling"}, {"owner": {"reputation": 51584, "user_id": 839246, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/9b0573c2b936b12828dd1e4cc04206dc?s=128&d=identicon&r=PG&f=1", "display_name": "bheklilr", "link": "https://stackoverflow.com/users/839246/bheklilr"}, "edited": false, "score": 1, "creation_date": 1425918386, "post_id": 28944300, "comment_id": 46147929, "body": "Start by implementing <code>prettyPrintTitle :: Title -&gt; String</code>.  For this, the implementation should be really simple since the title is already in the format you want.  Then do <code>prettyPrintActors :: Actors -&gt; String</code> which turns a list of strings into a comma separated string (look at <code>Data.List.intercalate</code>).  Do the same for <code>Year</code> and <code>Fans</code>, then you can write <code>prettyPrintFilm :: Film -&gt; String</code>; <code>prettyPrintFilm (t, a, y, f) = unlines [prettyPrintTitle t, prettyPrintActors a, prettyPrintYear y, prettyPrintFans f]</code>.  Finally, <code>prettyPrintDB = unlines . map prettyPrintFilm</code>."}, {"owner": {"reputation": 62252, "user_id": 1435869, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/TrEd9.jpg?s=128&g=1", "display_name": "karakfa", "link": "https://stackoverflow.com/users/1435869/karakfa"}, "edited": false, "score": 0, "creation_date": 1425933226, "post_id": 28944300, "comment_id": 46156235, "body": "<code>pp :: Film -&gt; String;  pp (t,a,y,f) = i &quot;\\n&quot; [t, i &quot;, &quot; a, show y, i &quot;, &quot; f]     where i x = intercalate x</code>"}], "answers": [{"comments": [{"owner": {"reputation": 287, "user_id": 4300537, "user_type": "registered", "accept_rate": 100, "profile_image": "https://graph.facebook.com/713271201/picture?type=large", "display_name": "Adam Piper", "link": "https://stackoverflow.com/users/4300537/adam-piper"}, "edited": false, "score": 0, "creation_date": 1425914920, "post_id": 28944686, "comment_id": 46145586, "body": "Is it possible to do this without using the extensions and without using instance?"}, {"owner": {"reputation": 43759, "user_id": 1651941, "user_type": "registered", "accept_rate": 97, "profile_image": "https://www.gravatar.com/avatar/a513bc1fa519d2fcf5e4e0d9b5500101?s=128&d=identicon&r=PG", "display_name": "Sibi", "link": "https://stackoverflow.com/users/1651941/sibi"}, "reply_to_user": {"reputation": 287, "user_id": 4300537, "user_type": "registered", "accept_rate": 100, "profile_image": "https://graph.facebook.com/713271201/picture?type=large", "display_name": "Adam Piper", "link": "https://stackoverflow.com/users/4300537/adam-piper"}, "edited": false, "score": 0, "creation_date": 1425915371, "post_id": 28944686, "comment_id": 46145895, "body": "@AdamPiper You can use the bheklir&#39;s approach for that."}, {"owner": {"reputation": 14582, "user_id": 2225384, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/f30b04ed4d0b3fc4bc791a28815f34ca?s=128&d=identicon&r=PG", "display_name": "Rein Henrichs", "link": "https://stackoverflow.com/users/2225384/rein-henrichs"}, "edited": false, "score": 0, "creation_date": 1425931430, "post_id": 28944686, "comment_id": 46155368, "body": "Yes, just use your own types instead of type synonyms."}], "tags": [], "owner": {"reputation": 43759, "user_id": 1651941, "user_type": "registered", "accept_rate": 97, "profile_image": "https://www.gravatar.com/avatar/a513bc1fa519d2fcf5e4e0d9b5500101?s=128&d=identicon&r=PG", "display_name": "Sibi", "link": "https://stackoverflow.com/users/1651941/sibi"}, "is_accepted": false, "score": 1, "last_activity_date": 1425911906, "creation_date": 1425911906, "answer_id": 28944686, "question_id": 28944300, "link": "https://stackoverflow.com/questions/28944300/is-it-possible-to-turn-a-list-in-haskell-into-a-string-of-the-elemnts-within/28944686#28944686", "title": "Is it possible to turn a list in Haskell into a string of the elemnts within?", "body": "<p>One way would be to write your own <code>Show</code> instance for <code>Film</code>. But you need to enable some extensions:</p>\n\n<pre><code>{-#LANGUAGE TypeSynonymInstances#-}\n{-#LANGUAGE FlexibleInstances#-}\n{-#LANGUAGE OverlappingInstances#-}\n</code></pre>\n\n<p>Then you create an instance of <code>Show</code>:</p>\n\n<pre><code>instance Show Film where\n    show (t,a,y,f) = t ++ \"\\n\" ++ actors ++ \"\\n\" ++ (show y) ++ \"\\n\" ++ fans\n        where actors = intercalate \", \" a\n              fans = intercalate \", \"  f\n</code></pre>\n\n<p>Demo in <code>ghci</code>:</p>\n\n<pre><code>\u03bb&gt; mapM_ (\\x -&gt; (putStrLn $ show x) &gt;&gt; putStrLn \"\") testDatabase\nCasino Royale\nDaniel Craig, Eva Green\n2006\nGarry, Dave\n\nTitanic\nLeonardo DiCaprio, Kate Winslet\n1997\nZoe, Amy\n</code></pre>\n\n<p>I would suggest you to break your <code>(a,b,c,d)</code> type to a record data structure. That is more preferable.</p>\n"}, {"tags": [], "owner": {"reputation": 287, "user_id": 4300537, "user_type": "registered", "accept_rate": 100, "profile_image": "https://graph.facebook.com/713271201/picture?type=large", "display_name": "Adam Piper", "link": "https://stackoverflow.com/users/4300537/adam-piper"}, "is_accepted": true, "score": 0, "last_activity_date": 1426873135, "creation_date": 1426873135, "answer_id": 29172649, "question_id": 28944300, "link": "https://stackoverflow.com/questions/28944300/is-it-possible-to-turn-a-list-in-haskell-into-a-string-of-the-elemnts-within/29172649#29172649", "title": "Is it possible to turn a list in Haskell into a string of the elemnts within?", "body": "<p>I was able to produce the outcome that I wanted by using @karakfa's approach in the comments of the original post:</p>\n\n<pre><code>pp :: Film -&gt; String; pp (t,a,y,f) = i \"\\n\" [t, i \", \" a, show y, i \", \" f] where i x = intercalate x\n</code></pre>\n"}], "owner": {"reputation": 287, "user_id": 4300537, "user_type": "registered", "accept_rate": 100, "profile_image": "https://graph.facebook.com/713271201/picture?type=large", "display_name": "Adam Piper", "link": "https://stackoverflow.com/users/4300537/adam-piper"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 130, "favorite_count": 0, "accepted_answer_id": 29172649, "answer_count": 2, "score": 0, "last_activity_date": 1426873135, "creation_date": 1425910867, "question_id": 28944300, "link": "https://stackoverflow.com/questions/28944300/is-it-possible-to-turn-a-list-in-haskell-into-a-string-of-the-elemnts-within", "title": "Is it possible to turn a list in Haskell into a string of the elemnts within?", "body": "<p>I have a small film \"database\" which is just a list and each element in the list is a tuple.</p>\n\n<p>I would like to display the list in a string as an easy to read format so for example each data item in the list should be displayed as follows:</p>\n\n<pre><code>Casino Royale\nDaniel Craig, Eva Green\n2006\nGarry, Dave\n\nTitanic\nLeonardo DiCaprio, Kate Winslet\n1997\nZoe, Amy\n</code></pre>\n\n<p>Here is the code I am using:</p>\n\n<pre><code>type Title = String\ntype Actors = [String]\ntype Year = Int\ntype Fans = [String]\ntype Film = (Title, Actors, Year, Fans)\ntype Database = [Film]\n\ntestDatabase :: Database\ntestDatabase = [(\"Casino Royale\", [\"Daniel Craig\", \"Eva Green\"], 2006,[\"Garry\", \"Dave\"]),\n                (\"Titanic\", [\"Leonardo DiCaprio\", \"Kate Winslet\"], 1997, [\"Zoe\", \"Amy\"]),\n....\n]\n</code></pre>\n"}, {"tags": ["haskell"], "comments": [{"owner": {"reputation": 33202, "user_id": 987185, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/e4c92f75eac948cee7e7e8913f9aa379?s=128&d=identicon&r=PG", "display_name": "musically_ut", "link": "https://stackoverflow.com/users/987185/musically-ut"}, "edited": false, "score": 5, "creation_date": 1425899195, "post_id": 28940381, "comment_id": 46135595, "body": "That is approximately the algorithm that Haskell uses for figuring out the types of expressions. For more detailed description of the idea you intuited, read about <a href=\"http://en.wikipedia.org/wiki/Unification_%28computer_science%29#Application:_Type_inference\" rel=\"nofollow noreferrer\">Unification</a>."}], "answers": [{"tags": [], "owner": {"reputation": 100892, "user_id": 745903, "user_type": "registered", "accept_rate": 74, "profile_image": "https://www.gravatar.com/avatar/50933f6638836741e620669b3940410e?s=128&d=identicon&r=PG", "display_name": "leftaroundabout", "link": "https://stackoverflow.com/users/745903/leftaroundabout"}, "is_accepted": true, "score": 4, "last_activity_date": 1425900163, "creation_date": 1425900163, "answer_id": 28940805, "question_id": 28940381, "link": "https://stackoverflow.com/questions/28940381/haskell-how-to-infer-the-type-of-action/28940805#28940805", "title": "Haskell - How to infer the type of action", "body": "<p>Essentially, all of that. In this example, there's a whole bunch of ways in which Haskell can infer the type.</p>\n\n<p>(In addition to what you said: all actions in a <code>do</code> block must be <em>in the same monad</em>; the first <code>putStrLn \"Enter your guess: \"</code> already gives you that <code>doGuessing</code> is in the <code>IO</code> monad (i.e. <code>IO a</code> for some yet unknown <code>a</code>. The <code>()</code> yielded by the <code>putStrLn</code> is not relevant here).<br>The same goes for <code>guess &lt;- getLine</code>, this is also an <code>IO</code> action.)</p>\n\n<p>The great thing about a Hindley-Milner type system such as Haskell is that there is not a single &ldquo;route&rdquo; for how type information travels through the code. It's not that type information is in some way attached to values, like in a dynamic language. (The kind of type inference that C++ or Java uses is basically a &ldquo;pre-simulation&rdquo; of that dynamic-type flow.)\n<br>Rather, the compiler gathers all information it can find, anywhere, and combines it to infer the type of the whole expression. As musically_ut already remarked in the comments, this is done through <a href=\"http://en.wikipedia.org/wiki/Unification_%28computer_science%29#Application:_Type_inference\" rel=\"nofollow\">type unification</a>.</p>\n"}], "owner": {"reputation": 3369, "user_id": 645703, "user_type": "registered", "accept_rate": 54, "profile_image": "https://www.gravatar.com/avatar/53dff9cde38dd11e5e3f2368a3da1193?s=128&d=identicon&r=PG", "display_name": "Matt Elson", "link": "https://stackoverflow.com/users/645703/matt-elson"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 98, "favorite_count": 0, "accepted_answer_id": 28940805, "answer_count": 1, "score": 3, "last_activity_date": 1425900163, "creation_date": 1425898883, "question_id": 28940381, "link": "https://stackoverflow.com/questions/28940381/haskell-how-to-infer-the-type-of-action", "title": "Haskell - How to infer the type of action", "body": "<p>An example from Wikibooks (<a href=\"http://en.wikibooks.org/wiki/Haskell/Simple_input_and_output\" rel=\"nofollow\">http://en.wikibooks.org/wiki/Haskell/Simple_input_and_output</a>)</p>\n\n<pre><code>doGuessing num = do\n   putStrLn \"Enter your guess:\"\n   guess &lt;- getLine\n   if (read guess) &lt; num\n     then do putStrLn \"Too low!\"\n             doGuessing num\n     else if (read guess) &gt; num\n            then do putStrLn \"Too high!\"\n                    doGuessing num\n            else putStrLn \"You Win!\"\n</code></pre>\n\n<p>Wikibooks says 'doGuessing num' has type IO () in the outer \"then\" branch.</p>\n\n<pre><code>  do putStrLn \"Too low!\"\n     doGuessing num\n</code></pre>\n\n<p>I don't understand why 'doGuessing num' has type IO (), and just guess this is because:</p>\n\n<pre><code> 1)the last \"else\" brance (putStrLn \"You Win!\") has type IO ().\n 2)in Haskell, \"then\" branch and the \"else\" branch have the same type.\n 3)the final action (putStrLn \"You Win!\") defines the type of the whole do block.\n</code></pre>\n\n<p>so 'doGuessing num' has type IO ().</p>\n\n<p>I am not sure my understanding is right. Actions is new for me, please correct me if I am wrong. </p>\n"}, {"tags": ["string", "haskell", "hash", "hex", "sha"], "answers": [{"comments": [{"owner": {"reputation": 126897, "user_id": 791604, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/ce991df7a056248d5e4f6fc3659ba733?s=128&d=identicon&r=PG", "display_name": "Daniel Wagner", "link": "https://stackoverflow.com/users/791604/daniel-wagner"}, "reply_to_user": {"reputation": 729, "user_id": 2181977, "user_type": "registered", "accept_rate": 86, "profile_image": "https://www.gravatar.com/avatar/0b84fe9137990458c9a91dcadd10579c?s=128&d=identicon&r=PG", "display_name": "Fredrik Karlsson", "link": "https://stackoverflow.com/users/2181977/fredrik-karlsson"}, "edited": false, "score": 1, "creation_date": 1425928249, "post_id": 28937278, "comment_id": 46153674, "body": "@FredrikKarlsson In case you didn&#39;t notice, Carl updated his solution to answer that question."}], "tags": [], "owner": {"reputation": 24028, "user_id": 383200, "user_type": "registered", "accept_rate": 60, "profile_image": "https://www.gravatar.com/avatar/a9dc722f936cb1059adaae4fe39c07f0?s=128&d=identicon&r=PG", "display_name": "Carl", "link": "https://stackoverflow.com/users/383200/carl"}, "is_accepted": false, "score": 3, "last_activity_date": 1425888153, "last_edit_date": 1425888153, "creation_date": 1425887506, "answer_id": 28937278, "question_id": 28937109, "link": "https://stackoverflow.com/questions/28937109/hex-form-for-a-sha1-hash-of-a-string/28937278#28937278", "title": "Hex form for a sha1 hash of a String?", "body": "<p>That particular implementation of <code>printf</code> in Haskell isn't type-safe. You've run into that problem. The <code>%x</code> specifier requires a number, but you're passing it a string.</p>\n\n<p>Assuming you're using the <code>cryptohash</code> package, the best way to get a hex representation is using the functions in <code>Crypto.Hash</code>, something sort of like this:</p>\n\n<pre><code>import Crypto.Hash\n\nsha1Hex :: ByteString -&gt; ByteString\nsha1Hex s = digestToHexByteString (hash s :: Digest SHA1)\n</code></pre>\n"}, {"tags": [], "owner": {"reputation": 30377, "user_id": 369198, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/71596bb1ca3ba3aa4400c3f407baec9f?s=128&d=identicon&r=PG", "display_name": "Michael Snoyman", "link": "https://stackoverflow.com/users/369198/michael-snoyman"}, "is_accepted": true, "score": 2, "last_activity_date": 1425887943, "creation_date": 1425887943, "answer_id": 28937377, "question_id": 28937109, "link": "https://stackoverflow.com/questions/28937109/hex-form-for-a-sha1-hash-of-a-string/28937377#28937377", "title": "Hex form for a sha1 hash of a String?", "body": "<p>I'd recommend using the <a href=\"http://www.stackage.org/haddock/nightly-2015-03-08/base16-bytestring-0.1.1.6/Data-ByteString-Base16.html\" rel=\"nofollow\">base16-bytestring</a> package. Note that you'll need to turn your <code>String</code> into a <code>ByteString</code>, which I'd recommend doing as a UTF8 encoding. Altogether, this would look something like:</p>\n\n<pre><code>Data.Text.unpack . decodeUtf8 . Base16.encode . encodeUtf8 . Data.Text.pack\n</code></pre>\n\n<p>If you just stick with <code>Text</code> instead of <code>String</code> (which I'd recommend), you can leave off the <code>unpack</code> and <code>pack</code>.</p>\n"}], "owner": {"reputation": 729, "user_id": 2181977, "user_type": "registered", "accept_rate": 86, "profile_image": "https://www.gravatar.com/avatar/0b84fe9137990458c9a91dcadd10579c?s=128&d=identicon&r=PG", "display_name": "Fredrik Karlsson", "link": "https://stackoverflow.com/users/2181977/fredrik-karlsson"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 680, "favorite_count": 0, "accepted_answer_id": 28937377, "answer_count": 2, "score": 1, "last_activity_date": 1425888153, "creation_date": 1425886664, "question_id": 28937109, "link": "https://stackoverflow.com/questions/28937109/hex-form-for-a-sha1-hash-of-a-string", "title": "Hex form for a sha1 hash of a String?", "body": "<p>I need a sha1 hash of a string in HEX form. This is the basic code:</p>\n\n<pre><code>import Data.ByteString.UTF8\nimport Crypto.Hash.SHA1 (hash)\n\ntoArgs :: String -&gt; (String,String)\ntoArgs str = let h = show .  hash . fromString $ str\n    in (str,h)\n</code></pre>\n\n<p>Which produces the hash, but in a form like this:</p>\n\n<pre><code>$ toArgs \"Hejsan\"\n(\"Hejsan\",\"\\\"A\\\\CAN]]\\\\131\\\\168\\\\210|\\\\n\\\\NUL\\\\NAK\\\\187j\\\\181Q\\\\STX\\\\146o\\\\fP\\\"\")\n</code></pre>\n\n<p>I tried converting it to HEX using printf:</p>\n\n<pre><code>import Data.ByteString.UTF8\nimport Crypto.Hash.SHA1 (hash)\nimport Text.Printf (printf)\n\ntoArgs :: String -&gt; (String,String)\ntoArgs str = let h = printf \"%02x\" $ show . hash . fromString $ str\n    in (str,h)\n</code></pre>\n\n<p>which compiles, but throws an exception when executed:</p>\n\n<pre><code>toArgs \"Hejsan\"\n(\"Hejsan\",\"*** Exception: Printf.printf: bad argument\n</code></pre>\n\n<p>Any ideas?</p>\n"}, {"tags": ["haskell", "design-patterns", "functional-programming", "dsl"], "comments": [{"owner": {"reputation": 28873, "user_id": 1068232, "user_type": "registered", "accept_rate": 79, "profile_image": "https://www.gravatar.com/avatar/2a0a145ce58c20013969fe3f203531da?s=128&d=identicon&r=PG", "display_name": "Andr&#225;s Kov&#225;cs", "link": "https://stackoverflow.com/users/1068232/andr%c3%a1s-kov%c3%a1cs"}, "edited": false, "score": 1, "creation_date": 1425885993, "post_id": 28936501, "comment_id": 46128964, "body": "<code>MonadRandom</code> is not a monad but a type class for monads supporting random number generation. You can use <code>erk</code> without change in a wide range of monad transformer stacks."}], "answers": [{"comments": [{"owner": {"reputation": 44680, "user_id": 1031791, "user_type": "registered", "accept_rate": 54, "profile_image": "https://www.gravatar.com/avatar/fb710534fda446d2286074bb7692e65a?s=128&d=identicon&r=PG", "display_name": "MaiaVictor", "link": "https://stackoverflow.com/users/1031791/maiavictor"}, "edited": false, "score": 0, "creation_date": 1425932245, "post_id": 28938727, "comment_id": 46155794, "body": "Hi! Interesting, thank you. One thing I haven&#39;t anticipated, though, is: what if I later on want an AI to control the behavior of a player? That is - suppose that I define a card effect that depends on a player choice as <code>(MonadIO m) =&gt; Player -&gt; m Player</code>. Doesn&#39;t that make the card unplayable without a human inputing the IO on the console?"}, {"owner": {"reputation": 64805, "user_id": 286871, "user_type": "registered", "accept_rate": 77, "profile_image": "https://i.stack.imgur.com/xNBpr.png?s=128&g=1", "display_name": "Tikhon Jelvis", "link": "https://stackoverflow.com/users/286871/tikhon-jelvis"}, "reply_to_user": {"reputation": 44680, "user_id": 1031791, "user_type": "registered", "accept_rate": 54, "profile_image": "https://www.gravatar.com/avatar/fb710534fda446d2286074bb7692e65a?s=128&d=identicon&r=PG", "display_name": "MaiaVictor", "link": "https://stackoverflow.com/users/1031791/maiavictor"}, "edited": false, "score": 0, "creation_date": 1425932448, "post_id": 28938727, "comment_id": 46155879, "body": "@Viclib: If the definition of the card uses something like <code>getLine</code> internally then yes, it will be tied to console IO. You could have an AI as an external program that communicates exactly the same way as a player, but that&#39;s awkward and limiting. I could probably think about some better ways to organize code like that, but it would take a bit of time and a comment is a bad place for it. I suggest you ask another question about this specific issue."}, {"owner": {"reputation": 44680, "user_id": 1031791, "user_type": "registered", "accept_rate": 54, "profile_image": "https://www.gravatar.com/avatar/fb710534fda446d2286074bb7692e65a?s=128&d=identicon&r=PG", "display_name": "MaiaVictor", "link": "https://stackoverflow.com/users/1031791/maiavictor"}, "edited": false, "score": 0, "creation_date": 1425937501, "post_id": 28938727, "comment_id": 46158357, "body": "Okay. Thank you! Also, once again, I think both answers are equally correct, but SO doesn&#39;t allow me to sign both. I guess I should open a question on Meta."}], "tags": [], "owner": {"reputation": 64805, "user_id": 286871, "user_type": "registered", "accept_rate": 77, "profile_image": "https://i.stack.imgur.com/xNBpr.png?s=128&g=1", "display_name": "Tikhon Jelvis", "link": "https://stackoverflow.com/users/286871/tikhon-jelvis"}, "is_accepted": false, "score": 5, "last_activity_date": 1425893580, "creation_date": 1425893580, "answer_id": 28938727, "question_id": 28936501, "link": "https://stackoverflow.com/questions/28936501/on-haskell-what-is-the-linguistic-way-to-represent-a-card-effect-for-a-card-gam/28938727#28938727", "title": "On Haskell, what is the linguistic way to represent a card effect for a card game?", "body": "<p>This is one of the engineering problems the <code>mtl</code> library was designed to solve. It looks like you're already using it, but don't realize its full potential.</p>\n\n<p>The idea is to make monad transformer stacks easier to work with using typeclasses. A problem with normal monad transformer stacks is that you have to know <em>all</em> of the transformers you're using when you write a function, and changing the stack of transformers changes how lifts work. <code>mtl</code> solves this by defining a typeclass for each transformer it has. This lets you write functions that have a class constraint for each transformer it requires but can work on <em>any</em> stack of transformers that includes at least those.</p>\n\n<p>This means that you can freely write functions with different sets of constraints and then use them with your game monad, as long as you game monad has <em>at least</em> those capabilities.</p>\n\n<p>For example, you could have </p>\n\n<pre><code>erk  :: MonadRandom m =&gt; ...\nincr :: MonadState GameState m =&gt; ...\nerr  :: MonadError GameError m =&gt; ...\nlots :: (MonadRandom m, MonadState GameState m) =&gt; ...\n</code></pre>\n\n<p>and define your <code>Game a</code> type to support all of those:</p>\n\n<pre><code>type Game a = forall g. RandT g (StateT GameState (ErrorT GameError IO)) a\n</code></pre>\n\n<p>You'd be able to use all of these interchangeably within <code>Game</code>, because <code>Game</code> belongs to all of those typeclasses. Moreover, you wouldn't have to change anything except the definition of <code>Game</code> if you wanted to add more capabilities.</p>\n\n<p>There's one important limitation to keep in mind: you can only access one instance of each transformer. This means that you can only have one <code>StateT</code> and one <code>ErrorT</code> in your whole stack. This is why <code>StateT</code> uses a custom <code>GameState</code> type: you can just put all of the different things you may want to store throughout your game into that one type so that you only need one <code>StateT</code>. (<code>GameError</code> does the same for <code>ErrorT</code>.)</p>\n\n<p>For code like this, you can get away with just using the <code>Game</code> type directly when you define your functions:</p>\n\n<pre><code>flipCoin :: Game a -&gt; Game a -&gt; Game a\nflipCoin a b = ...\n</code></pre>\n\n<p>Since <code>getRandom</code> has a type polymorphic over <code>m</code> itself, it will work with whatever <code>Game</code> happens to be as long as it has <em>at least</em> a <code>RandT</code> (or something equivalent) inside.</p>\n\n<p>So, to answer you question, you can just rely on the existing <code>mtl</code> typeclasses to take care of this. All of the primitive operations like <code>getRandom</code> are polymorphic over their monad, so they will work with whatever stack you end up with in the end. Just wrap all your transformers into a type of your own (<code>Game</code>), and you're all set.</p>\n"}, {"comments": [{"owner": {"reputation": 44680, "user_id": 1031791, "user_type": "registered", "accept_rate": 54, "profile_image": "https://www.gravatar.com/avatar/fb710534fda446d2286074bb7692e65a?s=128&d=identicon&r=PG", "display_name": "MaiaVictor", "link": "https://stackoverflow.com/users/1031791/maiavictor"}, "edited": false, "score": 0, "creation_date": 1425940827, "post_id": 28940826, "comment_id": 46159715, "body": "That is a great answer! I&#39;m still trying to find the relationship between this approach and free monads."}, {"owner": {"reputation": 23816, "user_id": 572606, "user_type": "registered", "accept_rate": 81, "profile_image": "https://www.gravatar.com/avatar/c20a126ad0dce40e8fc4a43456107919?s=128&d=identicon&r=PG", "display_name": "shang", "link": "https://stackoverflow.com/users/572606/shang"}, "reply_to_user": {"reputation": 44680, "user_id": 1031791, "user_type": "registered", "accept_rate": 54, "profile_image": "https://www.gravatar.com/avatar/fb710534fda446d2286074bb7692e65a?s=128&d=identicon&r=PG", "display_name": "MaiaVictor", "link": "https://stackoverflow.com/users/1031791/maiavictor"}, "edited": false, "score": 0, "creation_date": 1425987385, "post_id": 28940826, "comment_id": 46177153, "body": "Free monads are essentially isomorphic to the operational monad. I just personally find the operational package easier to explain and use."}], "tags": [], "owner": {"reputation": 23816, "user_id": 572606, "user_type": "registered", "accept_rate": 81, "profile_image": "https://www.gravatar.com/avatar/c20a126ad0dce40e8fc4a43456107919?s=128&d=identicon&r=PG", "display_name": "shang", "link": "https://stackoverflow.com/users/572606/shang"}, "is_accepted": false, "score": 3, "last_activity_date": 1425902581, "last_edit_date": 1425902581, "creation_date": 1425900240, "answer_id": 28940826, "question_id": 28936501, "link": "https://stackoverflow.com/questions/28936501/on-haskell-what-is-the-linguistic-way-to-represent-a-card-effect-for-a-card-gam/28940826#28940826", "title": "On Haskell, what is the linguistic way to represent a card effect for a card game?", "body": "<p>This sounds like a good use-case for the <a href=\"http://hackage.haskell.org/package/operational\" rel=\"nofollow\"><code>operational</code></a> package. It lets you define a monad as a set of operations and their return types using a GADT and you can then easily build an interpreter function like the <code>runGame</code> function you suggested. For example:</p>\n\n<pre><code>{-# LANGUAGE GADTs #-}\n\nimport Control.Monad.Operational\nimport System.Random\n\ndata Player = Player {\n    _hand :: [Card],\n    _deck :: [Card],\n    _board :: [Card]}\n\ndata Coin = Head | Tail\n\ndata CardOp a where\n    FlipCoin    :: CardOp Coin\n    ShuffleDeck :: CardOp ()\n\ntype CardAction = Program CardOp\n\nflipCoin :: CardAction Coin\nflipCoin = singleton FlipCoin\n\nshuffleDeck :: CardAction ()\nshuffleDeck = singleton ShuffleDeck\n\nerk :: CardAction ()\nerk = do\n    coin &lt;- flipCoin\n    case coin of\n        Head -&gt; shuffleDeck\n        Tail -&gt; return ()\n\nrunGame :: RandomGen g =&gt; g -&gt; CardAction a -&gt; Player -&gt; Player\nrunGame = step where\n    step g action player = case view action of\n        Return _ -&gt; player\n        FlipCoin :&gt;&gt;= continue -&gt;\n            let (heads, g') = random g \n                coin = if heads then Head else Tail\n            in  step g' (continue coin) player\n        ...etc...\n</code></pre>\n\n<p>However, you might also want to consider just describing all your card actions as a simple ADT without do-syntax. I.e.</p>\n\n<pre><code>data CardAction\n    = CoinFlip CardAction CardAction\n    | ShuffleDeck\n    |\u00a0DoNothing\n\nerk :: CardAction\nerk = CoinFlip ShuffleDeck DoNothing\n</code></pre>\n\n<p>You can easily write an interpreter for the ADT and as a bonus you can also e.g. generate the card's rule text automatically. </p>\n"}], "owner": {"reputation": 44680, "user_id": 1031791, "user_type": "registered", "accept_rate": 54, "profile_image": "https://www.gravatar.com/avatar/fb710534fda446d2286074bb7692e65a?s=128&d=identicon&r=PG", "display_name": "MaiaVictor", "link": "https://stackoverflow.com/users/1031791/maiavictor"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 271, "favorite_count": 1, "answer_count": 2, "score": 5, "last_activity_date": 1425924345, "creation_date": 1425883736, "last_edit_date": 1425924345, "question_id": 28936501, "link": "https://stackoverflow.com/questions/28936501/on-haskell-what-is-the-linguistic-way-to-represent-a-card-effect-for-a-card-gam", "title": "On Haskell, what is the linguistic way to represent a card effect for a card game?", "body": "<p>I have a simple one-player Card Game:</p>\n\n<pre><code>data Player = Player {\n    _hand :: [Card],\n    _deck :: [Card],\n    _board :: [Card]}\n$(makeLenses ''Player)\n</code></pre>\n\n<p>Some cards have an effect. For example, \"Erk\" is a card with the following effect:</p>\n\n<pre><code>Flip a coin. If heads, shuffle your deck.\n</code></pre>\n\n<p>I've implemented it as such:</p>\n\n<pre><code>shuffleDeck :: (MonadRandom m, Functor m) =&gt; Player -&gt; m Player\nshuffleDeck = deck shuffleM\n\nrandomCoin :: (MonadRandom m) =&gt; m Coin\nrandomCoin = getRandom\n\nflipCoin :: (MonadRandom m) =&gt; m a -&gt; m a -&gt; m a\nflipCoin head tail = randomCoin &gt;&gt;= branch where\n    branch Head = head\n    branch Tail = tail\n\n-- Flip a coin. If heads, shuffle your deck.\nerk :: (MonadRandom m, Functor m) =&gt; Player -&gt; m Player\nerk player = flipCoin (deck shuffleM player) (return player)\n</code></pre>\n\n<p>While this certainly does the job, I find an issue on the forced coupling to the <code>Random</code> library. What if I later on have a card that depends on another monad? Then I'd have to rewrite the definition of every card defined so far (so they have the same type). I'd prefer a way to describe the logic of my game entirely independent from the Random (and any other). Something like that:</p>\n\n<pre><code>erk :: CardAction\nerk = do\n    coin &lt;- flipCoin\n    case coin of\n        Head -&gt; shuffleDeck\n        Tail -&gt; doNothing\n</code></pre>\n\n<p>I could, later on, have a <code>runGame</code> function that does the connection.</p>\n\n<pre><code>runGame :: (RandomGen g) =&gt; g -&gt; CardAction -&gt; Player -&gt; Player\n</code></pre>\n\n<p>I'm not sure that would help. What is the correct, linguistic way to deal with this pattern?</p>\n"}, {"tags": ["haskell"], "answers": [{"comments": [{"owner": {"reputation": 19084, "user_id": 1482749, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/7ff9982206dde8c2bbb151a7305c00f3?s=128&d=identicon&r=PG", "display_name": "kosmikus", "link": "https://stackoverflow.com/users/1482749/kosmikus"}, "edited": false, "score": 2, "creation_date": 1425897290, "post_id": 28934198, "comment_id": 46134544, "body": "And if you actually want to use the continuation monad, you can say something like <code>runCont ex1 id</code> or even <code>runCont ex1 print</code>."}], "tags": [], "owner": {"reputation": 64805, "user_id": 286871, "user_type": "registered", "accept_rate": 77, "profile_image": "https://i.stack.imgur.com/xNBpr.png?s=128&g=1", "display_name": "Tikhon Jelvis", "link": "https://stackoverflow.com/users/286871/tikhon-jelvis"}, "is_accepted": true, "score": 11, "last_activity_date": 1425866402, "creation_date": 1425866402, "answer_id": 28934198, "question_id": 28934042, "link": "https://stackoverflow.com/questions/28934042/making-new-monad-cont-with-contt-constructor/28934198#28934198", "title": "Making new Monad Cont with ContT Constructor", "body": "<p>The problem is that <code>ex1</code> as an expression works for <em>any</em> monad, and the monad used is not specified. The type of <code>ex1</code> could very well be <code>ex1 :: (Num b, Monad m) =&gt; m b</code> but, because of the <a href=\"https://wiki.haskell.org/Monomorphism_restriction\">dreaded monomorphism restriction</a>, GHC cannot infer this polymorphic type and so the result is ambiguous.</p>\n\n<p>You could get it to compile either by giving it an explicit type signature or disabling the monomorphism restriction:</p>\n\n<pre><code>{-# LANGUAGE NoMonomorphismRestriction #-}\n</code></pre>\n\n<p>When you use this in GHCi, it will automatically default the value of <code>ex1</code> to <code>IO Int</code> because of the <a href=\"https://downloads.haskell.org/~ghc/latest/docs/html/users_guide/interactive-evaluation.html#extended-default-rules\">extended default rules</a>:</p>\n\n<pre><code>*Main&gt; ex1\n11\n</code></pre>\n\n<p>These rules exist to make ghci usable as a calculator and prompt for doing IO stuff. </p>\n\n<p>You should also try it with some other monads to see what happens:</p>\n\n<pre><code>*Main&gt; ex1 :: [Int]\n[11]\n*Main&gt; ex1 :: Maybe Int\nJust 11\n</code></pre>\n"}], "owner": {"reputation": 37991, "user_id": 409976, "user_type": "registered", "accept_rate": 68, "profile_image": "https://www.gravatar.com/avatar/9ccda0b49cc974197399eae01ebd6850?s=128&d=identicon&r=PG", "display_name": "Kevin Meredith", "link": "https://stackoverflow.com/users/409976/kevin-meredith"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 138, "favorite_count": 0, "accepted_answer_id": 28934198, "answer_count": 1, "score": 3, "last_activity_date": 1425866402, "creation_date": 1425865162, "question_id": 28934042, "link": "https://stackoverflow.com/questions/28934042/making-new-monad-cont-with-contt-constructor", "title": "Making new Monad Cont with ContT Constructor", "body": "<p>I started to read <a href=\"http://blog.sigfpe.com/2008/12/mother-of-all-monads.html\" rel=\"nofollow\">The Mother of All Monads</a>, and typed out this example:</p>\n\n<pre><code>import Control.Monad.Cont\n\nex1 = do\n  a &lt;- return 1\n  b &lt;- return 10\n  return $ a+b\n</code></pre>\n\n<p>But I got a compile-time error:</p>\n\n<pre><code>ghci&gt; :l ContMonad.hs \n[1 of 1] Compiling Main             ( ContMonad.hs, interpreted )\n\nContMonad.hs:4:4:\n    No instance for (Monad m0) arising from a do statement\n    The type variable \u2018m0\u2019 is ambiguous\n    Relevant bindings include\n      ex1 :: m0 Integer (bound at ContMonad.hs:3:1)\n    Note: there are several potential instances:\n      instance Monad ((-&gt;) r) -- Defined in \u2018GHC.Base\u2019\n      instance Monad IO -- Defined in \u2018GHC.Base\u2019\n      instance Monad [] -- Defined in \u2018GHC.Base\u2019\n      ...plus six others\n    In a stmt of a 'do' block: a &lt;- return 1\n    In the expression:\n      do { a &lt;- return 1;\n           b &lt;- return 10;\n           return $ a + b }\n    In an equation for \u2018ex1\u2019:\n        ex1\n          = do { a &lt;- return 1;\n                 b &lt;- return 10;\n                 return $ a + b }\nFailed, modules loaded: none.\n</code></pre>\n\n<p>How can I get this simple example to type-check?</p>\n"}, {"tags": ["haskell", "type-level-computation", "hlist"], "comments": [{"owner": {"reputation": 100185, "user_id": 3234959, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/93bb12ca0f93dfddb33880316f7e66c2?s=128&d=identicon&r=PG&f=1", "display_name": "chi", "link": "https://stackoverflow.com/users/3234959/chi"}, "edited": false, "score": 0, "creation_date": 1425850191, "post_id": 28932054, "comment_id": 46119929, "body": "The uncurry was not taken from the github repo you link. It is also equal to curry, so it looks wrong (?)."}, {"owner": {"reputation": 826, "user_id": 1279710, "user_type": "registered", "accept_rate": 78, "profile_image": "https://www.gravatar.com/avatar/439c16dfeff3f906d93cf7f4499d44f4?s=128&d=identicon&r=PG", "display_name": "purefn", "link": "https://stackoverflow.com/users/1279710/purefn"}, "reply_to_user": {"reputation": 100185, "user_id": 3234959, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/93bb12ca0f93dfddb33880316f7e66c2?s=128&d=identicon&r=PG&f=1", "display_name": "chi", "link": "https://stackoverflow.com/users/3234959/chi"}, "edited": false, "score": 0, "creation_date": 1425865225, "post_id": 28932054, "comment_id": 46123837, "body": "@chi Yes, sorry. I was pulling from two different sources and they named things differently and I didn&#39;t copy/paste correctly. Updated."}, {"owner": {"reputation": 44013, "user_id": 1477667, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/trgKM.jpg?s=128&g=1", "display_name": "dfeuer", "link": "https://stackoverflow.com/users/1477667/dfeuer"}, "edited": false, "score": 2, "creation_date": 1425868194, "post_id": 28932054, "comment_id": 46124476, "body": "This looks pretty much the same as <a href=\"http://jaspervdj.be/posts/2014-10-17-generalizing-function-composition.html\" rel=\"nofollow noreferrer\">generalized function composition</a>. The trouble that leads that implementation to overlapping instances is presumably going to bite you too: the uncurried version works in a closed kind (nice), and the version with explicit <code>Compose</code> works with a specific type (nice), but trying to deal with &quot;looks like a function&quot; vs. &quot;doesn&#39;t look like a function&quot; is a bit yucky."}, {"owner": {"reputation": 826, "user_id": 1279710, "user_type": "registered", "accept_rate": 78, "profile_image": "https://www.gravatar.com/avatar/439c16dfeff3f906d93cf7f4499d44f4?s=128&d=identicon&r=PG", "display_name": "purefn", "link": "https://stackoverflow.com/users/1279710/purefn"}, "reply_to_user": {"reputation": 25144, "user_id": 477476, "user_type": "registered", "accept_rate": 85, "profile_image": "https://i.stack.imgur.com/Qf4TT.png?s=128&g=1", "display_name": "Cactus", "link": "https://stackoverflow.com/users/477476/cactus"}, "edited": false, "score": 0, "creation_date": 1426182892, "post_id": 28932054, "comment_id": 46278099, "body": "@Cactus Adding a <code>Rep as</code> as an argument would be fine. I&#39;m also interested seeing the <code>Data.Singletons</code> approach."}], "answers": [{"tags": [], "owner": {"reputation": 25144, "user_id": 477476, "user_type": "registered", "accept_rate": 85, "profile_image": "https://i.stack.imgur.com/Qf4TT.png?s=128&g=1", "display_name": "Cactus", "link": "https://stackoverflow.com/users/477476/cactus"}, "is_accepted": true, "score": 2, "last_activity_date": 1426210933, "creation_date": 1426210933, "answer_id": 29023489, "question_id": 28932054, "link": "https://stackoverflow.com/questions/28932054/can-hlistelim-be-composed-with-another-function/29023489#29023489", "title": "Can HListElim be composed with another function?", "body": "<p>GHC is right in this case: the basic problem is that because type families need not be injective, <code>HListElim as a</code> doesn't specify what the <code>as</code> are. (To see why, consider that <code>HListElim '[] (a -&gt; b) ~ HListElim '[a] b</code>). </p>\n\n<p>You can get around this if you are willing to add an extra <code>Sing</code>leton argument to <code>hListCompose</code> to give the <code>HList</code> explicitly:</p>\n\n<pre><code>{-# LANGUAGE ScopedTypeVariables #-}\nhListCompose :: forall a b as. Sing as -&gt; (a -&gt; b) -&gt; HListElim as a -&gt; HListElim as b\nhListCompose s f = go s\n  where\n    go :: forall ts. Sing ts -&gt; HListElim ts a -&gt; HListElim ts b\n    go SNil = f\n    go (SCons _ ts) = \\g x -&gt; go ts (g x)\n</code></pre>\n"}], "owner": {"reputation": 826, "user_id": 1279710, "user_type": "registered", "accept_rate": 78, "profile_image": "https://www.gravatar.com/avatar/439c16dfeff3f906d93cf7f4499d44f4?s=128&d=identicon&r=PG", "display_name": "purefn", "link": "https://stackoverflow.com/users/1279710/purefn"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 73, "favorite_count": 0, "accepted_answer_id": 29023489, "answer_count": 1, "score": 3, "last_activity_date": 1426210933, "creation_date": 1425849813, "last_edit_date": 1426210689, "question_id": 28932054, "link": "https://stackoverflow.com/questions/28932054/can-hlistelim-be-composed-with-another-function", "title": "Can HListElim be composed with another function?", "body": "<p>Given </p>\n\n<pre><code>{-# LANGUAGE TypeFamilies, KindSignatures #-}\n{-# LANGUAGE GADTs, DataKinds, TypeOperators #-}\n\nimport Data.HList\nimport Data.Singletons\nimport Data.Singletons.Prelude.List\n\ntype family HListElim (ts :: [*]) (a :: *) :: * where\n    HListElim '[] a = a\n    HListElim (t ': ts) a = t -&gt; HListElim ts a\n\nhListUncurry :: HListElim ts a -&gt; HList ts -&gt; a\nhListUncurry f HNil = f\nhListUncurry f (HCons x xs) = hListUncurry (f x) xs\n\nhListCurryExpl :: Sing ts -&gt; (HList ts -&gt; a) -&gt; HListElim ts a\nhListCurryExpl SNil f = f HNil\nhListCurryExpl (SCons _ r) f = \\x -&gt; hListCurryExpl r (f . HCons x)\n\nhListCurry :: SingI ts =&gt; (HList ts -&gt; a) -&gt; HListElim ts a\nhListCurry = hListCurryExpl sing\n</code></pre>\n\n<p>(adapted from <a href=\"https://gist.github.com/timjb/516f04808f0c4aa90c26\" rel=\"nofollow\">https://gist.github.com/timjb/516f04808f0c4aa90c26</a> and <a href=\"https://github.com/agrafix/reroute/blob/master/src/Data/HVect.hs\" rel=\"nofollow\">reroute</a>)</p>\n\n<p>I'd like to be able to write a function like the following</p>\n\n<pre><code>hListCompose :: (a -&gt; b) -&gt; HListElim as a -&gt; HListElim as b\n</code></pre>\n\n<p>My first attempt was </p>\n\n<pre><code>hListCompose f g = hListCurry (fmap f (hListUncurry g))\n</code></pre>\n\n<p>But GHC is telling me that  </p>\n\n<pre><code>Could not deduce (HListElim ts0 b ~ HListElim ts b)\nfrom the context (HasRep ts)\n  bound by the inferred type for \u2018hListCompose\u2019:\n             HasRep ts =&gt; (a -&gt; b) -&gt; HListElim ts a -&gt; HListElim ts b\n  at src/Webcrank/Wai/T.hs:64:1-55\nNB: \u2018HListElim\u2019 is a type function, and may not be injective\nThe type variable \u2018ts0\u2019 is ambiguous\nExpected type: (a -&gt; b) -&gt; HListElim ts a -&gt; HListElim ts b\n  Actual type: (a -&gt; b) -&gt; HListElim ts0 a -&gt; HListElim ts0 b\nWhen checking that \u2018hListCompose\u2019\n  has the inferred type \u2018forall (ts :: [*]) a b.\n                         SingI ts =&gt;\n                         (a -&gt; b) -&gt; HListElim ts a -&gt; HListElim ts b\u2019\nProbable cause: the inferred type is ambiguous\n</code></pre>\n\n<p>Is this even possible?</p>\n"}, {"tags": ["haskell", "lambda"], "comments": [{"owner": {"reputation": 8676, "user_id": 1113881, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/sBc0F.jpg?s=128&g=1", "display_name": "CR Drost", "link": "https://stackoverflow.com/users/1113881/cr-drost"}, "edited": false, "score": 0, "creation_date": 1425940392, "post_id": 28931477, "comment_id": 46159550, "body": "You need to ask your professor/teacher about the &quot;if a de Bruijn term is closed&quot; part, because as far as I can tell you don&#39;t have the structure to reliably do <code>lam2b</code> if that lambda is not closed. What you need to unclose them is to either add another constructor <code>BFree Int | BVar Int | ...</code> or, as one paper does, to add a type parameter <code>data BTerm v = BVar v | BLam (BTerm (Maybe v)) | BApp BTerm BTerm</code> . The <code>Maybe</code> then uses <code>Just x</code> to indicate freedom or <code>Nothing</code> to indicate boundness."}], "answers": [{"comments": [{"owner": {"reputation": 44013, "user_id": 1477667, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/trgKM.jpg?s=128&g=1", "display_name": "dfeuer", "link": "https://stackoverflow.com/users/1477667/dfeuer"}, "edited": false, "score": 2, "creation_date": 1425862050, "post_id": 28932044, "comment_id": 46123154, "body": "Let me guess: starting with 0 is cleaner when you use types to guarantee the De Bruijn indices are all in bounds?"}, {"owner": {"reputation": 23444, "user_id": 414413, "user_type": "registered", "accept_rate": 79, "profile_image": "https://www.gravatar.com/avatar/6de2113f01432aa844dc85070ff33e89?s=128&d=identicon&r=PG", "display_name": "Cirdec", "link": "https://stackoverflow.com/users/414413/cirdec"}, "reply_to_user": {"reputation": 44013, "user_id": 1477667, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/trgKM.jpg?s=128&g=1", "display_name": "dfeuer", "link": "https://stackoverflow.com/users/1477667/dfeuer"}, "edited": false, "score": 0, "creation_date": 1425864425, "post_id": 28932044, "comment_id": 46123682, "body": "@dfeuer No, I like <code>0</code> because lists are indexed starting at <code>0</code>. If you are binding variables (alpha-reducing) and have a list <code>bindings</code> of what to bind them to where the most recently bound variable is at the head of the list and you are looking at <code>Var v</code> then the one you are looking for is <code>bindings !! v</code>."}, {"owner": {"reputation": 23444, "user_id": 414413, "user_type": "registered", "accept_rate": 79, "profile_image": "https://www.gravatar.com/avatar/6de2113f01432aa844dc85070ff33e89?s=128&d=identicon&r=PG", "display_name": "Cirdec", "link": "https://stackoverflow.com/users/414413/cirdec"}, "reply_to_user": {"reputation": 44013, "user_id": 1477667, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/trgKM.jpg?s=128&g=1", "display_name": "dfeuer", "link": "https://stackoverflow.com/users/1477667/dfeuer"}, "edited": false, "score": 0, "creation_date": 1425870923, "post_id": 28932044, "comment_id": 46125134, "body": "@dfeuer You can see a simple example of keeping a list of bindings in <i>(spoilers ahead)</i> <a href=\"https://gist.github.com/Cedev/087c3e50ecc53e0f04e9\" rel=\"nofollow noreferrer\">implementing <code>db2lam</code> for this homework problem</a>. In this case the bindings are just to the new variable names for the usual lambda terms. If type checking I&#39;d probably start with 1, leaving 0 for those terms whose maximum index didn&#39;t escape; it&#39;s a clever idea and I&#39;m not sure entirely how I&#39;d go about it."}], "tags": [], "owner": {"reputation": 23444, "user_id": 414413, "user_type": "registered", "accept_rate": 79, "profile_image": "https://www.gravatar.com/avatar/6de2113f01432aa844dc85070ff33e89?s=128&d=identicon&r=PG", "display_name": "Cirdec", "link": "https://stackoverflow.com/users/414413/cirdec"}, "is_accepted": false, "score": 3, "last_activity_date": 1425864568, "last_edit_date": 1425864568, "creation_date": 1425849723, "answer_id": 28932044, "question_id": 28931477, "link": "https://stackoverflow.com/questions/28931477/haskell-convert-de-bruijn-terms-to-lambda-terms-and-vice-versa/28932044#28932044", "title": "Haskell - Convert De Bruijn terms to Lambda terms (and vice-versa)", "body": "<p>A variable with a <a href=\"http://en.wikipedia.org/wiki/De_Bruijn_index\" rel=\"nofollow\">De Bruijn index</a> refers to the lambda that many steps away from it. The simplest example is <code>BLam (BVar 0)</code>, which is the identity function. (I like to start counting at <code>0</code> <em>skipped</em> lambdas, other authors start counting at the <code>1</code>st lambda.) The variable <code>BVar 0</code> is bound by the lambda with no lambdas in-between.</p>\n\n<p>A variable in the usual lambda terms refers to the closest lambda with the same name. The simplest example is the identity function <code>Lam 1 (Var 1)</code>, which can be written using any variable name we want; <code>Lam 2 (Var 2)</code>, <code>Lam 3 (Var 3)</code>, ... are all the same identity function. The lambdas in the usual lambda terms need to know the name of the variable they are binding. The lambdas in the De Bruijn indexed terms didn't need a variable name, they always start binding the variable <code>BVar 0</code>.</p>\n"}, {"tags": [], "owner": {"reputation": 64094, "user_id": 476408, "user_type": "registered", "accept_rate": 70, "profile_image": "https://www.gravatar.com/avatar/2bc1bffafe7aa29ef900b98d1fd1e94e?s=128&d=identicon&r=PG", "display_name": "J. Abrahamson", "link": "https://stackoverflow.com/users/476408/j-abrahamson"}, "is_accepted": true, "score": 5, "last_activity_date": 1425874987, "creation_date": 1425874987, "answer_id": 28935221, "question_id": 28931477, "link": "https://stackoverflow.com/questions/28931477/haskell-convert-de-bruijn-terms-to-lambda-terms-and-vice-versa/28935221#28935221", "title": "Haskell - Convert De Bruijn terms to Lambda terms (and vice-versa)", "body": "<p>Essentially your assignment is asking you to explore the difference between \"named\" and \"nameless\" lambda calculi implementations. Typically when we, as humans, write lambda terms we write them using named variables like</p>\n\n<pre><code>(\\g -&gt; (\\f -&gt; f (\\x -&gt; g x))) (\\m -&gt; m)\n</code></pre>\n\n<p>which works under the assumption that whenever a name is \"bound\" by a lambda then we can go and uniquely track down all of the places where that name is being used in the body of the lambda. In particular, concepts like \"shadowing\" become important.</p>\n\n<p>As a small side tangent, it's always important to note that when we're writing down named lambda terms that they are non-unique. If we're really pedantic then we'd note that <code>(\\x -&gt; x)</code> and <code>(\\y -&gt; y)</code> are different terms. We understand that they ultimately represent the same \"process\", though and so introduce the notion of <em>alpha-equivalence</em> to handle the fact that two similar named lambda terms might actually be functionally identical. This is the statement that named lambda terms are \"unique up to renaming\" where \"renaming\" works the way you think it ought to.</p>\n\n<p>A more important facet of named lambda terms is \"capture via substitution\", a flaw in naive implementations. In particular, while alpha-equivalence suggests that two terms are equal up to renaming, this can be violated by certain pathological, <em>clashing</em> renamings such as</p>\n\n<pre><code>(\\x -&gt; (\\q -&gt; q x))  ====&gt;  (\\x -&gt; (\\x -&gt; x x))\n</code></pre>\n\n<p>While renaming <code>q -&gt; x</code> might feel permissible, because I changed how the <code>q</code>-lambda term \"captures\" variables it caused the meaning of my program to change. This is obviously pathological here, but it's also fairly easy to accidentally enact when implementing substitution.</p>\n\n<p>Capture-avoiding substitution is generally an important thing to enact. As fragments of your LC ADT move around and are interpreted in their new, substituted contexts their meaning changes and that change must be accounted for. That said, capture-avoiding substitutions using named terms can be expensive because one must be know the context of the entire term to recognize which names are at risk of capture.</p>\n\n<p>So for these two reasons, the need for alpha-equivalence and the risk of capturing, named terms, despite their human-language familiarity, are not always the best choice.</p>\n\n<p>So now we turn to nameless terms. The de Bruijn terms your assignment asks you to implement are a nameless variety. In particular, if you look at the ADT it's clear that the <code>BLam</code>s no longer specify which variable is bound by them---we're instead forced to determine the meaning of variables from the structure of the ADT alone.</p>\n\n<p>In particular, the rule is that variables are pointers to the lambda which bound them. A <code>BVar n</code> binds to the lambda which is <code>n</code> <code>BLam</code>s above it. So if we were to make a translator from named to nameless terms they'd look like</p>\n\n<pre><code>(\\x -&gt; x)            ===&gt;  (\\ 0)\n(\\x -&gt; (\\q -&gt; q x))  ===&gt;  (\\ (\\ 0 1))\n\n(\\g -&gt; (\\f -&gt; f (\\x -&gt; g x))) (\\m -&gt; m)\n===&gt;\n(\\ (\\ 0 (\\ 2 0))) (\\ 0)\n</code></pre>\n\n<p>Nameless terms are kind of difficult to read as humans, but they have two nice qualities:</p>\n\n<ol>\n<li>There is no such thing as alpha-equivalence any longer; two nameless terms represent the same computation exactly when they are structurally equal</li>\n<li>As variables are very systematically \"named\" due exactly to the structure of the term implementing capture avoidance is somewhat simpler.</li>\n</ol>\n"}, {"tags": [], "owner": {"reputation": 2501, "user_id": 2868481, "user_type": "registered", "accept_rate": 48, "profile_image": "https://www.gravatar.com/avatar/d32920192c6bebcffb83fffd557b9553?s=128&d=identicon&r=PG&f=1", "display_name": "d8d0d65b3f7cf42", "link": "https://stackoverflow.com/users/2868481/d8d0d65b3f7cf42"}, "is_accepted": false, "score": 2, "last_activity_date": 1426259326, "last_edit_date": 1426259326, "creation_date": 1425891733, "answer_id": 28938229, "question_id": 28931477, "link": "https://stackoverflow.com/questions/28931477/haskell-convert-de-bruijn-terms-to-lambda-terms-and-vice-versa/28938229#28938229", "title": "Haskell - Convert De Bruijn terms to Lambda terms (and vice-versa)", "body": "<p>(generic answer to all homework-type questions)</p>\n\n<p>\"This assignment is way over my head at this time.\" </p>\n\n<p>Are you sure? Your teacher sets these assignments for a reason: they have a connection to the lecture. There's a 99.99 percent chance that you can do them with the knowledge you have. </p>\n\n<p>Check your lecture notes, check the references that were given in the lecture (that means, go to the library). I am pretty sure that the answer to \"what's the difference between a De Bruijn term and a Lambda term?\" is in there somewhere.</p>\n\n<p>If you don't find it after a reasonable effort, then check with your fellow students, then with your teaching assistant, then with your teacher. </p>\n\n<p>Sadly, SO tolerates (even attracts) homework type questions (and rewards answering them) for reasons that are obvious (it increases their click count). This is helping SO (in the short term), but not the students (in the long run).</p>\n"}], "owner": {"reputation": 131, "user_id": 3780328, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/152df6dbebc18a711b69a1b117a3e82a?s=128&d=identicon&r=PG", "display_name": "EvilBlob", "link": "https://stackoverflow.com/users/3780328/evilblob"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 1784, "favorite_count": 1, "accepted_answer_id": 28935221, "answer_count": 3, "score": 1, "last_activity_date": 1426259326, "creation_date": 1425846285, "last_edit_date": 1425849106, "question_id": 28931477, "link": "https://stackoverflow.com/questions/28931477/haskell-convert-de-bruijn-terms-to-lambda-terms-and-vice-versa", "title": "Haskell - Convert De Bruijn terms to Lambda terms (and vice-versa)", "body": "<p>I have an assignment to write a Haskell program capable of converting De Bruijn terms to Lambda terms, and to convert Lambda terms into De Bruijn terms, and also to check if the terms are 'closed'.</p>\n\n<p>I am not looking for someone to do this assignment for me, but any assistance would be greatly appreciated! I am largely clueless about how to even get started with this.</p>\n\n<p>So, my biggest questions are: what's the difference between a De Bruijn term and a Lambda term?\nI understand what it means for a variable to be 'closed', but how could I check for that in Haskell?</p>\n\n<p>Any other assistance that you can think of would be greatly appreciated.</p>\n\n<p>Here is the full assignment:</p>\n\n<blockquote>\n  <p>The (usual) lambda terms are defined as the data type:</p>\n\n<pre><code>data Term = Var Int | Lam Int Term | App Term Term deriving (Eq, Show, Read)\n</code></pre>\n  \n  <p>where variables are represented as integers. A term is called closed\n  if for every <code>i</code> in <code>Var i</code> there's a term of the from <code>Lam i &lt;subterm&gt;</code> on\n  the path from it to the root, providing it a binding.</p>\n  \n  <p>De Bruijn terms are defined as the data type:</p>\n\n<pre><code>data BTerm =BVar Int | BLam BTerm | BApp BTerm BTerm deriving (Eq,  Show, Read)\n</code></pre>\n  \n  <p>Write a Haskell function <code>db2lam</code> that transforms a de Bruijn term into\n  a lambda term. Write a Haskell function <code>lam2db</code> that transforms a\n  lambda term into a Bruijn term.</p>\n  \n  <p>Write a function <code>isClosed</code> that tests if a lambda term is closed. Write\n  a function <code>isClosed</code> that tests if a de Bruijn term is closed.</p>\n  \n  <p>Chose one of the following two subjects:</p>\n  \n  <p>a) Implement normal order beta reduction for de Bruijn terms\n  b) Implement normal order beta reduction for (the usual) lambda terms</p>\n</blockquote>\n\n<p>Thanks a lot for any assistance(Large or small)! I'm in the early stages of learning Haskell, so sorry for being so unsure! This assignment is way over my head at this time.</p>\n"}, {"tags": ["haskell"], "comments": [{"owner": {"reputation": 126897, "user_id": 791604, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/ce991df7a056248d5e4f6fc3659ba733?s=128&d=identicon&r=PG", "display_name": "Daniel Wagner", "link": "https://stackoverflow.com/users/791604/daniel-wagner"}, "edited": false, "score": 1, "creation_date": 1425848633, "post_id": 28931148, "comment_id": 46119376, "body": "While I expect it could be done with some expensive search through the multiplication table, I would suggest talking to your TA/professor/whoever assigned this. Perhaps they overlooked what was needed, and they will definitely know what is ethical to reveal and what isn&#39;t in a way we can&#39;t."}, {"owner": {"reputation": 44013, "user_id": 1477667, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/trgKM.jpg?s=128&g=1", "display_name": "dfeuer", "link": "https://stackoverflow.com/users/1477667/dfeuer"}, "edited": false, "score": 0, "creation_date": 1426198496, "post_id": 28931148, "comment_id": 46285861, "body": "Can you think of a faster way to count the divisors? Can you separate the different pieces of this code into separate functions? If I were in your shoes, I&#39;d probably write three functions here instead of one. One of the nice things about functional programming is that it makes it easy to break programs into little pieces. You should take advantage of that! I recently wrote several pages of code to implement one function. When I was finished, I realized I could use several of the big pieces I&#39;d written, unchanged, to implement another function. Save time!"}], "answers": [{"tags": [], "owner": {"reputation": 37486, "user_id": 371753, "user_type": "registered", "accept_rate": 83, "profile_image": "https://i.stack.imgur.com/znFEK.jpg?s=128&g=1", "display_name": "sclv", "link": "https://stackoverflow.com/users/371753/sclv"}, "is_accepted": false, "score": 1, "last_activity_date": 1426195549, "creation_date": 1426195549, "answer_id": 29020508, "question_id": 28931148, "link": "https://stackoverflow.com/questions/28931148/haskell-operation-definition-could-not-deduce-eq-a-arising-from-a-use-of/29020508#29020508", "title": "Haskell operation definition: Could not deduce (Eq a) arising from a use of `==&#39; from the context (Num a)", "body": "<p>Until recently, <code>Eq</code> was a superclass of <code>Num</code>. I bet the assignment dates back to when that was the case. You should let the person who gave the assignment know that the signature is no longer sufficient in modern GHC.</p>\n\n<p>Furthermore, that signature would <em>never</em> have worked without <code>Integral</code> for <code>mod</code>!</p>\n\n<p>So I bet this is just an oversight on their part.</p>\n"}], "owner": {"reputation": 21, "user_id": 4647493, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/b304116726139ac425e1ef6f12b129b8?s=128&d=identicon&r=PG&f=1", "display_name": "Certanata", "link": "https://stackoverflow.com/users/4647493/certanata"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 364, "favorite_count": 0, "answer_count": 1, "score": 0, "last_activity_date": 1426195549, "creation_date": 1425844426, "last_edit_date": 1425847096, "question_id": 28931148, "link": "https://stackoverflow.com/questions/28931148/haskell-operation-definition-could-not-deduce-eq-a-arising-from-a-use-of", "title": "Haskell operation definition: Could not deduce (Eq a) arising from a use of `==&#39; from the context (Num a)", "body": "<p>I need to define an operation (&lt;-&lt;) that returns True for a &lt;-&lt; b if the number of real divisors of b is greater than the number of divisors of a. I also need to use the declaration:</p>\n\n<pre><code>(&lt;-&lt;) :: Num a =&gt; a -&gt; a -&gt; Bool\n</code></pre>\n\n<p>I tried the following expression:</p>\n\n<pre><code>a &lt;-&lt; b = ((length [x | x&lt;-[2..b-1], b `mod` x == 0]) &gt; (length [x | x&lt;-[1..a], a `mod` x == 0]))\n</code></pre>\n\n<p>and it works fine, but only if I don't use the declaration I was given. With that, I get the usual errors like</p>\n\n<pre><code>Could not deduce (Enum a) arising from the arithmetic sequence 2 .. b - 1 from the context (Num a)\nCould not deduce (Integral a) arising from a use of mod from the context (Num a)\nCould not deduce (Eq a) arising from a use of == from the context (Num a)\n</code></pre>\n\n<p>I know that I can get rid of the error by modifying the declaration, or even removing it completely, but my task is to write an expression with that declaration. How is that possible?</p>\n"}, {"tags": ["haskell", "types", "monads", "mutation", "st"], "comments": [{"owner": {"reputation": 100185, "user_id": 3234959, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/93bb12ca0f93dfddb33880316f7e66c2?s=128&d=identicon&r=PG&f=1", "display_name": "chi", "link": "https://stackoverflow.com/users/3234959/chi"}, "edited": false, "score": 4, "creation_date": 1425843101, "post_id": 28930848, "comment_id": 46117559, "body": "Maybe <a href=\"http://stackoverflow.com/a/28840303/3234959\">this answer</a> of mine partially answers this."}, {"owner": {"reputation": 327, "user_id": 1179127, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/oxV4A.jpg?s=128&g=1", "display_name": "Alex Beal", "link": "https://stackoverflow.com/users/1179127/alex-beal"}, "reply_to_user": {"reputation": 100185, "user_id": 3234959, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/93bb12ca0f93dfddb33880316f7e66c2?s=128&d=identicon&r=PG&f=1", "display_name": "chi", "link": "https://stackoverflow.com/users/3234959/chi"}, "edited": false, "score": 0, "creation_date": 1425846775, "post_id": 28930848, "comment_id": 46118762, "body": "Thanks! That&#39;s a nice explanation."}, {"owner": {"reputation": 60057, "user_id": 1333025, "user_type": "registered", "accept_rate": 65, "profile_image": "https://www.gravatar.com/avatar/79ab43010f900324ac5e2de19a2916cb?s=128&d=identicon&r=PG", "display_name": "Petr", "link": "https://stackoverflow.com/users/1333025/petr"}, "edited": false, "score": 0, "creation_date": 1426975233, "post_id": 28930848, "comment_id": 46591800, "body": "@AlexBeal close as duplicate then?"}], "owner": {"reputation": 327, "user_id": 1179127, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/oxV4A.jpg?s=128&g=1", "display_name": "Alex Beal", "link": "https://stackoverflow.com/users/1179127/alex-beal"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 91, "favorite_count": 0, "closed_date": 1428441985, "answer_count": 0, "score": 6, "last_activity_date": 1425842556, "creation_date": 1425842556, "question_id": 28930848, "link": "https://stackoverflow.com/questions/28930848/sts-use-of-rankntypes-to-make-its-interface-pure", "closed_reason": "Duplicate", "title": "ST&#39;s use of RankNTypes to make its interface pure", "body": "<p>As I understand it, Haskell's ST monad is unique in that it allows me to describe a computation that locally uses mutable memory, but still presents a pure interface. That is, it allows me to mutate memory so long as that mutation doesn't escape the computation. The simplest example of this would be something like:</p>\n\n<pre><code>runST $ newSTRef \"trying to return a memory reference.\"\n</code></pre>\n\n<p>This results in a compile time error (how cool!):</p>\n\n<pre><code>Couldn't match type \u2018a\u2019 with \u2018STRef s a0\u2019\n  because type variable \u2018s\u2019 would escape its scope\nThis (rigid, skolem) type variable is bound by\n  a type expected by the context: ST s a\n  at &lt;interactive&gt;:1:1-18\nExpected type: ST s a\n  Actual type: ST s (STRef s a0)\nIn the second argument of \u2018($)\u2019, namely \u2018newSTRef 0\u2019\nIn the expression: runST $ newSTRef 0\n</code></pre>\n\n<p>My understanding is that if a mutable reference is allowed to escape the computation, it could be mutated elsewhere, and my ST computation might no longer have a pure interface (it might return different values on different invocations).</p>\n\n<p>My question is: How is this implemented? I see that the definition of runST and newSTRef make heavy use of RankNTypes, but I'm having trouble understanding how these types produce the compile error above.</p>\n"}, {"tags": ["haskell", "records", "higher-order-functions", "function-composition", "lenses"], "comments": [{"owner": {"reputation": 14485, "user_id": 190376, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/cd8280c5e1491b8cf55760750ed97dec?s=128&d=identicon&r=PG", "display_name": "Reid Barton", "link": "https://stackoverflow.com/users/190376/reid-barton"}, "edited": false, "score": 3, "creation_date": 1425836631, "post_id": 28929468, "comment_id": 46115268, "body": "<code>statusCode</code> must be a lens, not the record field selector. I guess they must have hid the field selector and exported a lens of the same name; pretty confusing if you ask me. (Or wrote a custom Show instance.)"}, {"owner": {"reputation": 4530, "user_id": 94687, "user_type": "registered", "accept_rate": 45, "profile_image": "https://www.gravatar.com/avatar/ef249e4381c9d55297cddc4bd5b5c3c2?s=128&d=identicon&r=PG", "display_name": "imz -- Ivan Zakharyaschev", "link": "https://stackoverflow.com/users/94687/imz-ivan-zakharyaschev"}, "reply_to_user": {"reputation": 14485, "user_id": 190376, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/cd8280c5e1491b8cf55760750ed97dec?s=128&d=identicon&r=PG", "display_name": "Reid Barton", "link": "https://stackoverflow.com/users/190376/reid-barton"}, "edited": false, "score": 0, "creation_date": 1425836977, "post_id": 28929468, "comment_id": 46115384, "body": "@ReidBarton That must be a part of the puzzle. Since I know very little about lenses, my question is also a question about the underlying idea: how normal function composition can be used for accessing the structure in reverse order? (This reminds me continuation-passing style a bit.)"}, {"owner": {"reputation": 64094, "user_id": 476408, "user_type": "registered", "accept_rate": 70, "profile_image": "https://www.gravatar.com/avatar/2bc1bffafe7aa29ef900b98d1fd1e94e?s=128&d=identicon&r=PG", "display_name": "J. Abrahamson", "link": "https://stackoverflow.com/users/476408/j-abrahamson"}, "edited": false, "score": 3, "creation_date": 1425837438, "post_id": 28929468, "comment_id": 46115517, "body": "That&#39;s essentially correct. Lenses are kind of like CPS computations of a kind so they, as a side effect, flip function composition."}], "answers": [{"tags": [], "owner": {"reputation": 28873, "user_id": 1068232, "user_type": "registered", "accept_rate": 79, "profile_image": "https://www.gravatar.com/avatar/2a0a145ce58c20013969fe3f203531da?s=128&d=identicon&r=PG", "display_name": "Andr&#225;s Kov&#225;cs", "link": "https://stackoverflow.com/users/1068232/andr%c3%a1s-kov%c3%a1cs"}, "is_accepted": false, "score": 13, "last_activity_date": 1425884300, "last_edit_date": 1425884300, "creation_date": 1425839148, "answer_id": 28930213, "question_id": 28929468, "link": "https://stackoverflow.com/questions/28929468/how-haskells-composing-lenses-using-function-composition-with-that-weird-orde/28930213#28930213", "title": "How Haskell&#39;s &quot;composing lenses using function composition&quot; with that weird order of arguments could be implemented?", "body": "<p>The right reading of <code>r ^. responseStatus . statusCode</code> is <code>r ^. (responseStatus . statusCode)</code>. This is only natural, since function composition returns a function when applied to two arguments, thus <code>(r ^. responseStatus) . statusCode</code> must return a function, as opposed to any value that could be printed out. </p>\n\n<p>This still leaves open the question why lenses compose in the \"wrong\" order. Since the implementation of lenses is a bit magical, let's look at a simpler example.</p>\n\n<p><code>first</code> is a function that maps over the first element of a pair:</p>\n\n<pre><code>first :: (a -&gt; b) -&gt; (a, c) -&gt; (b, c)\nfirst f (a, b) = (f a, b)\n</code></pre>\n\n<p>What does <code>map . first</code> do? <code>first</code> takes a function acting on the first element, and returns a function acting on a pair, which is more apparent if we parenthesize the type this way:</p>\n\n<pre><code>first :: (a -&gt; b) -&gt; ((a, c) -&gt; (b, c))\n</code></pre>\n\n<p>Also, recall the type of <code>map</code>:</p>\n\n<pre><code>map :: (a -&gt; b) -&gt; ([a] -&gt; [b])\n</code></pre>\n\n<p><code>map</code> takes a function acting on an element and returns a function acting on a list. Now, <code>f . g</code> works by first applying <code>g</code> and then feeding the result to <code>f</code>. So <code>map . first</code> takes a function acting on some element type, converts it to a function acting on pairs, then converts it to a function acting on lists of pairs. </p>\n\n<pre><code>(map . first) :: (a -&gt; b) -&gt; [(a, c)] -&gt; [(b, c)]\n</code></pre>\n\n<p><code>first</code> and <code>map</code> both turn functions acting on a part of a structure to functions acting on the whole structure. In <code>map . first</code>, what is the whole structure for <code>first</code> becomes the focus for <code>map</code>.</p>\n\n<pre><code>(map . first) (+10) [(0, 2), (3, 4)] == [(10, 2), (13, 4)]\n</code></pre>\n\n<p>Now take a look at the type of lenses:</p>\n\n<pre><code>type Lens = forall f. Functor f =&gt; (a -&gt; f b) -&gt; (s -&gt; f t)\n</code></pre>\n\n<p>Try to ignore the <code>Functor</code> bits for now. If we squint slightly, this resembles the types for <code>map</code> and <code>first</code>. And it happens so that lenses also convert functions acting on parts of structures into function acting on whole structures. In the signature above <code>s</code> denotes the whole structure and <code>a</code> denotes a part of it. Since our input function can change the type of <code>a</code> to <code>b</code> (as indicated by <code>a -&gt; f b</code>), we also need the <code>t</code> parameter, which roughly means \"the type of <code>s</code> after we changed <code>a</code> to <code>b</code> inside it\". </p>\n\n<p><code>statusCode</code> is a lens that converts a function acting on an <code>Int</code> to a function acting on a <code>Status</code>:</p>\n\n<pre><code>statusCode :: Functor f =&gt; (Int -&gt; f Int) -&gt; (Status -&gt; f Status)\n</code></pre>\n\n<p><code>responseStatus</code> converts a function acting on a <code>Status</code> to a function acting on a <code>Response</code>:</p>\n\n<pre><code>responseStatus :: Functor f =&gt; (Status -&gt; f Status) -&gt; (Response -&gt; f Response)\n</code></pre>\n\n<p>The type of <code>responseStatus . statusCode</code> follows the same pattern as we've seen with <code>map . first</code>:</p>\n\n<pre><code>responseStatus . statusCode :: Functor f =&gt; (Int -&gt; f Int) -&gt; (Response -&gt; f Response)\n</code></pre>\n\n<hr>\n\n<p>It remains to be seen how exactly <code>^.</code> works. It's intimately tied to the core mechanic and magic of lenses; I will not reiterate it here, since there are quite a few writings about it. For an introduction I recommend looking at <a href=\"http://blog.jakubarnold.cz/2014/07/14/lens-tutorial-introduction-part-1.html\" rel=\"noreferrer\">this one</a> and <a href=\"http://artyom.me/lens-over-tea-1\" rel=\"noreferrer\">this one</a>, and you could also watch <a href=\"https://skillsmatter.com/skillscasts/4251-lenses-compositional-data-access-and-manipulation\" rel=\"noreferrer\">this excellent video.</a></p>\n"}], "owner": {"reputation": 4530, "user_id": 94687, "user_type": "registered", "accept_rate": 45, "profile_image": "https://www.gravatar.com/avatar/ef249e4381c9d55297cddc4bd5b5c3c2?s=128&d=identicon&r=PG", "display_name": "imz -- Ivan Zakharyaschev", "link": "https://stackoverflow.com/users/94687/imz-ivan-zakharyaschev"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 584, "favorite_count": 1, "answer_count": 1, "score": 11, "last_activity_date": 1425884300, "creation_date": 1425835086, "last_edit_date": 1425836673, "question_id": 28929468, "link": "https://stackoverflow.com/questions/28929468/how-haskells-composing-lenses-using-function-composition-with-that-weird-orde", "title": "How Haskell&#39;s &quot;composing lenses using function composition&quot; with that weird order of arguments could be implemented?", "body": "<p>I've been reading <a href=\"http://www.serpentine.com/wreq/tutorial.html\">A wreq tutorial</a>:</p>\n\n<blockquote>\n  <p>A lens provides a way to focus on a portion of a Haskell value. For\n  example, the <code>Response</code> type has a <code>responseStatus</code> lens, which\n  focuses on the status information returned by the server.</p>\n\n<pre><code>ghci&gt; r ^. responseStatus\nStatus {statusCode = 200, statusMessage = \"OK\"}\n</code></pre>\n  \n  <p>The <code>^.</code> operator takes a value as its first argument, a lens as its\n  second, and returns the portion of the value focused on by the lens.</p>\n  \n  <p>We compose lenses using function composition, which allows us to\n  easily focus on part of a deeply nested structure.</p>\n\n<pre><code>ghci&gt; r ^. responseStatus . statusCode\n200\n</code></pre>\n</blockquote>\n\n<p>I can't come up with a way how function composition done with this order of arguments could treat the nesting structure in that order.</p>\n\n<p>Look: <code>r ^. responseStatus . statusCode</code> could be either <code>r ^. (responseStatus . statusCode)</code> or <code>(r ^. responseStatus) . statusCode</code>.</p>\n\n<p>In the first one says we construct a function which <strong>first</strong> treats <code>statusCode</code> (gets it from the record <code>Status</code>? -- as I can deduce from the shown value <code>Status {statusCode = 200, statusMessage = \"OK\"}</code>), and then passes it to <code>responseStatus</code> which must treat the response status. So, it's the other way round: in reality, the status code is a part of the response status.</p>\n\n<p>The second reading also doesn't make sense to me because it treats the status code first, too.</p>\n"}, {"tags": ["c", "haskell", "ubuntu"], "comments": [{"owner": {"reputation": 10320, "user_id": 453616, "user_type": "registered", "accept_rate": 88, "profile_image": "https://www.gravatar.com/avatar/f5c35ad8a6275273c50d1274fd549d84?s=128&d=identicon&r=PG", "display_name": "gspr", "link": "https://stackoverflow.com/users/453616/gspr"}, "edited": false, "score": 1, "creation_date": 1425832119, "post_id": 28928844, "comment_id": 46113477, "body": "You need the headers as well. Since you seem to be running Debian or a derivative, look at the package libv4l-dev."}, {"owner": {"reputation": 375, "user_id": 4232796, "user_type": "registered", "accept_rate": 25, "profile_image": "https://www.gravatar.com/avatar/42912716b8f59e0f6cfd0cbbe6a74bdf?s=128&d=identicon&r=PG&f=1", "display_name": "Kyle McKean", "link": "https://stackoverflow.com/users/4232796/kyle-mckean"}, "reply_to_user": {"reputation": 10320, "user_id": 453616, "user_type": "registered", "accept_rate": 88, "profile_image": "https://www.gravatar.com/avatar/f5c35ad8a6275273c50d1274fd549d84?s=128&d=identicon&r=PG", "display_name": "gspr", "link": "https://stackoverflow.com/users/453616/gspr"}, "edited": false, "score": 0, "creation_date": 1425832559, "post_id": 28928844, "comment_id": 46113641, "body": "@gspr That tip worked now the package complies but when it tries to build it fails and I get this warning <code>Warning: Couldn&#39;t figure out LLVM version! Make sure you have installed LLVM</code> how do i install LLVM?"}, {"owner": {"reputation": 10320, "user_id": 453616, "user_type": "registered", "accept_rate": 88, "profile_image": "https://www.gravatar.com/avatar/f5c35ad8a6275273c50d1274fd549d84?s=128&d=identicon&r=PG", "display_name": "gspr", "link": "https://stackoverflow.com/users/453616/gspr"}, "edited": false, "score": 0, "creation_date": 1425833176, "post_id": 28928844, "comment_id": 46113889, "body": "This is not really a programming question anymore, but Ubuntu ships various LLVM versions in the packages named &quot;llvm-&lt;version&gt;&quot;. Remember that GHC is sometimes picky about which version to use though."}, {"owner": {"reputation": 375, "user_id": 4232796, "user_type": "registered", "accept_rate": 25, "profile_image": "https://www.gravatar.com/avatar/42912716b8f59e0f6cfd0cbbe6a74bdf?s=128&d=identicon&r=PG&f=1", "display_name": "Kyle McKean", "link": "https://stackoverflow.com/users/4232796/kyle-mckean"}, "reply_to_user": {"reputation": 10320, "user_id": 453616, "user_type": "registered", "accept_rate": 88, "profile_image": "https://www.gravatar.com/avatar/f5c35ad8a6275273c50d1274fd549d84?s=128&d=identicon&r=PG", "display_name": "gspr", "link": "https://stackoverflow.com/users/453616/gspr"}, "edited": false, "score": 0, "creation_date": 1425833714, "post_id": 28928844, "comment_id": 46114133, "body": "@gspr what would be a good forum to ask this question in because google isnt being very helpful?"}, {"owner": {"reputation": 501, "user_id": 2623183, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/f681c02a87bdc9d1320f2ca5f36767d4?s=128&d=identicon&r=PG", "display_name": "phil", "link": "https://stackoverflow.com/users/2623183/phil"}, "edited": false, "score": 1, "creation_date": 1425836989, "post_id": 28928844, "comment_id": 46115392, "body": "Try &#39;ask ubuntu&#39; also on the stackexchange site/app"}, {"owner": {"reputation": 375, "user_id": 4232796, "user_type": "registered", "accept_rate": 25, "profile_image": "https://www.gravatar.com/avatar/42912716b8f59e0f6cfd0cbbe6a74bdf?s=128&d=identicon&r=PG&f=1", "display_name": "Kyle McKean", "link": "https://stackoverflow.com/users/4232796/kyle-mckean"}, "reply_to_user": {"reputation": 501, "user_id": 2623183, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/f681c02a87bdc9d1320f2ca5f36767d4?s=128&d=identicon&r=PG", "display_name": "phil", "link": "https://stackoverflow.com/users/2623183/phil"}, "edited": false, "score": 0, "creation_date": 1425848331, "post_id": 28928844, "comment_id": 46119303, "body": "@rhubarbdog I disagree with putting this on the ubuntu ask forums because this deals specifically with cabal-instal"}], "owner": {"reputation": 375, "user_id": 4232796, "user_type": "registered", "accept_rate": 25, "profile_image": "https://www.gravatar.com/avatar/42912716b8f59e0f6cfd0cbbe6a74bdf?s=128&d=identicon&r=PG&f=1", "display_name": "Kyle McKean", "link": "https://stackoverflow.com/users/4232796/kyle-mckean"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 62, "favorite_count": 0, "answer_count": 0, "score": 0, "last_activity_date": 1425831911, "creation_date": 1425831911, "question_id": 28928844, "link": "https://stackoverflow.com/questions/28928844/haskell-package-repa-v4l2-depends-on-a-c-libary-v4l2", "title": "Haskell package repa-v4l2 depends on a c libary v4l2", "body": "<p>I am trying to install the repa-v4l2 package on Ubuntu linux. \nIf I run <code>sudo cabal install repa-v4l2</code> I get a missing c library error telling me I am missing the v4l2 library. After some searching I found the library is called <code>libv4l-0</code>. I tried to install this library but apt-get told me the package was already installed.</p>\n"}, {"tags": ["haskell"], "answers": [{"tags": [], "owner": {"reputation": 23444, "user_id": 414413, "user_type": "registered", "accept_rate": 79, "profile_image": "https://www.gravatar.com/avatar/6de2113f01432aa844dc85070ff33e89?s=128&d=identicon&r=PG", "display_name": "Cirdec", "link": "https://stackoverflow.com/users/414413/cirdec"}, "is_accepted": false, "score": 2, "last_activity_date": 1425851781, "last_edit_date": 1495542133, "creation_date": 1425851458, "answer_id": 28932311, "question_id": 28928750, "link": "https://stackoverflow.com/questions/28928750/how-to-display-a-word-for-a-limited-time-in-haskell/28932311#28932311", "title": "How to display a word for a limited time in Haskell", "body": "<p>There is a operating system buffer between input and output from programs and the console presented to the user. As explained in the <a href=\"https://stackoverflow.com/questions/13190314/haskell-do-monad-io-happens-out-of-order\">answers to another question</a>, the <code>IO</code> actions like <code>putStr</code> that write to the console only send the data to the buffer; they don't necessarily force the operating system to \"flush\" the buffer and send the data on to the user. If you pay close attention while the program is running you'll see that nothing is displayed for the first 3 seconds, then it jumps straight to <code>\"bra jobbat\"</code> without ever displaying <code>\"hej\"</code>. <code>\"hej\"</code> was sent to the buffer to display before waiting, but it wasn't flushed until later. You can tell the operating system to flush the buffer with <a href=\"http://hackage.haskell.org/packages/archive/base/latest/doc/html/System-IO.html#v:hFlush\" rel=\"nofollow noreferrer\"><code>hflush</code></a> from <code>System.IO</code>. You need to flush the buffer for standard output, <a href=\"http://hackage.haskell.org/packages/archive/base/latest/doc/html/System-IO.html#v:stdout\" rel=\"nofollow noreferrer\"><code>stdout</code></a>.</p>\n\n<pre><code>import System.Console.ANSI\nimport Control.Concurrent\nimport System.IO\n\nmain = do\n putStr \"hej\"\n hFlush stdout\n threadDelay 3000000 ; clearLine\n putStr \"bra jobbat\"\n hFlush stdout\n</code></pre>\n"}], "owner": {"reputation": 59, "user_id": 4646996, "user_type": "registered", "profile_image": "https://graph.facebook.com/10155327131990249/picture?type=large", "display_name": "Sara", "link": "https://stackoverflow.com/users/4646996/sara"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 134, "favorite_count": 0, "answer_count": 1, "score": 2, "last_activity_date": 1425851781, "creation_date": 1425831355, "last_edit_date": 1425834117, "question_id": 28928750, "link": "https://stackoverflow.com/questions/28928750/how-to-display-a-word-for-a-limited-time-in-haskell", "title": "How to display a word for a limited time in Haskell", "body": "<p>We are superduper-beginners in Haskell and are struggling with a school project. Our goal is to create a working memory test. We have finished everything but the last piece of the puzzle. We want the program to show one word for about a second, and then disappear. Then we want this to be repeated 25 times, for all the 25 words we want to include in the test. </p>\n\n<p>We've been trying to use threadDelay and clearLine without success. Any help we could get is much appreciated, is there some sort of magic function in HASKELL we could use?</p>\n\n<p>This is the only thing we have left to solve.</p>\n\n<p>Hope someone can help us.</p>\n\n<p>/Sara</p>\n\n<p>This is the program so far: </p>\n\n<pre><code>import Data.List\n\nmain :: IO Int\nmain =\n do\n  putStrLn \"Hej och v\u00e4lkommen! Du ska nu f\u00e5 testa ditt arbetsminne, i ett litet test. Du kommer f\u00e5 25 ord presenterade f\u00f6r dig, ett \u00e5t g\u00e5ngen. Du ska f\u00f6rs\u00f6ka komma ih\u00e5g s\u00e5 m\u00e5nga ord som m\u00f6jligt. N\u00e4r du k\u00e4nner dig redo, skriv ditt namn och tryck Enter.\" --Translation: Hello, this is a working memory test blablabla when ready print redo\n  name &lt;- getLine\n  text &lt;- readFile \"ord.txt\" \n  let ord = words text\n  putStrLn \"Vilka ord kommer du ih\u00e5g? Skriv ner de ord du kommer ih\u00e5g, med sm\u00e5 bokst\u00e4ver och mellanslag, utan kommatecken.\" --Translation: What words do you remember\n  s &lt;- getLine\n  let svar = words s\n  let result1 = map (\\x -&gt; elem x ord) svar\n  let result = filter (\\x -&gt; x == True) result1\n  putStrLn (name ++ \"! Av 25 ord kom du ih\u00e5g:\") --Translation: Out of 25 words you remembered...\n  return $ length result\n</code></pre>\n\n<p>We want the part where the words are shown between \"name &lt;- getLine\" and\n\"text &lt;- readFile \"ord.txt\" this is what we have tried:</p>\n\n<pre><code>import System.Console.ANSI\nimport Control.Concurrent\n\nmain = do\n putStr \"hej\"\n threadDelay 3000000 ; clearLine\n putStr \"bra jobbat\"\n</code></pre>\n\n<p>We've been trying different locations for threadDelay but it doesn't do what we want it to do. </p>\n"}, {"tags": ["haskell", "emacs", "org-mode", "org-babel"], "answers": [{"comments": [{"owner": {"reputation": 822, "user_id": 200916, "user_type": "registered", "accept_rate": 88, "profile_image": "https://www.gravatar.com/avatar/68b75a235d71e5dacec3e2778a561775?s=128&d=identicon&r=PG", "display_name": "codygman", "link": "https://stackoverflow.com/users/200916/codygman"}, "edited": false, "score": 1, "creation_date": 1426099971, "post_id": 28937723, "comment_id": 46238143, "body": "I do wonder how tangle handles extracting this to a source file since <code>let f</code> would be invalid in a Haskell source file. For those not familiar with tangle: <a href=\"http://orgmode.org/manual/Extracting-source-code.html\" rel=\"nofollow noreferrer\">orgmode.org/manual/Extracting-source-code.html</a>"}], "tags": [], "owner": {"reputation": 822, "user_id": 200916, "user_type": "registered", "accept_rate": 88, "profile_image": "https://www.gravatar.com/avatar/68b75a235d71e5dacec3e2778a561775?s=128&d=identicon&r=PG", "display_name": "codygman", "link": "https://stackoverflow.com/users/200916/codygman"}, "is_accepted": true, "score": 3, "last_activity_date": 1425889556, "creation_date": 1425889556, "answer_id": 28937723, "question_id": 28927716, "link": "https://stackoverflow.com/questions/28927716/org-babel-for-haskell-not-works-of-eval-haskell-block/28937723#28937723", "title": "org-babel for haskell not works of eval haskell block", "body": "<pre><code>#+BEGIN_SRC haskell\nimport Data.Function (fix)\n\nf :: Int -&gt; Int\nlet f = (+ 1)\n\nmain :: IO ()\nmain = do\n      putStrLn $ show $ f 1\n#+END_SRC\n\n#+RESULTS:\n: 2\n</code></pre>\n\n<p>Org's babel mode is running the Haskell code with ghci. In ghci you are required to use let to declare functions.</p>\n"}, {"comments": [{"owner": {"reputation": 677, "user_id": 3536806, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/1c5321e2babfa1c70186599163a3c188?s=128&d=identicon&r=PG&f=1", "display_name": "Dominik Schrempf", "link": "https://stackoverflow.com/users/3536806/dominik-schrempf"}, "edited": false, "score": 2, "creation_date": 1500562737, "post_id": 40920873, "comment_id": 77403097, "body": "This saved my day after trying around for 2 hours ... thanks."}], "tags": [], "owner": {"reputation": 419, "user_id": 2552681, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/S6MOJ.jpg?s=128&g=1", "display_name": "Mario Rom&#225;n", "link": "https://stackoverflow.com/users/2552681/mario-rom%c3%a1n"}, "is_accepted": false, "score": 5, "last_activity_date": 1480628323, "creation_date": 1480628323, "answer_id": 40920873, "question_id": 28927716, "link": "https://stackoverflow.com/questions/28927716/org-babel-for-haskell-not-works-of-eval-haskell-block/40920873#40920873", "title": "org-babel for haskell not works of eval haskell block", "body": "<p>In this <a href=\"http://quickhack.net/nom/blog/2012-08-31-org-babel-and-haskell.html\" rel=\"noreferrer\">article</a>, Yoshinari Nomura describes a way to evaluate Haskell blocks using <code>runhaskell</code> via a Ruby script. I do not understand japanese, so I cannot translate the details, but the method has allowed me to run haskell blocks without having to write specifically for the interpreter.</p>\n"}], "owner": {"reputation": 5756, "user_id": 1436450, "user_type": "registered", "accept_rate": 63, "profile_image": "https://www.gravatar.com/avatar/49ade21b14846e41684616c6e7209db3?s=128&d=identicon&r=PG", "display_name": "Chinaxing", "link": "https://stackoverflow.com/users/1436450/chinaxing"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 906, "favorite_count": 1, "accepted_answer_id": 28937723, "answer_count": 2, "score": 5, "last_activity_date": 1480628323, "creation_date": 1425825911, "question_id": 28927716, "link": "https://stackoverflow.com/questions/28927716/org-babel-for-haskell-not-works-of-eval-haskell-block", "title": "org-babel for haskell not works of eval haskell block", "body": "<p>I am use org-mode blogging, I use org-babel to evaluate the code as following : </p>\n\n<pre><code>#+BEGIN_SRC haskell\nimport Data.Function (fix)\n\nf :: Int -&gt; Int\nf = (+ 1)\n\nmain :: IO ()\nmain = do\n      putStrLn $ show $ f 1\n#+END_SRC\n\n#+RESULTS:\n: &lt;interactive&gt;:9:25: Not in scope: \u2018f\u2019\n</code></pre>\n\n<p>I found the org-babel for haskell use infer-haskell mode to start session and eval the code. I also say the session was created, and if I don't define the function but directly putStrLn \"hello\" , it works.</p>\n\n<p>hope anyone can fix the bug :)</p>\n"}, {"tags": ["haskell", "command-line-arguments", "applicative"], "answers": [{"comments": [{"owner": {"reputation": 23329, "user_id": 115432, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/eca023f50940b65931dfe75a03e6e00a?s=128&d=identicon&r=PG", "display_name": "Kathy Van Stone", "link": "https://stackoverflow.com/users/115432/kathy-van-stone"}, "edited": false, "score": 1, "creation_date": 1548442778, "post_id": 28927848, "comment_id": 95556956, "body": "What if you need a variable amount of arguments grouped together (as in a number of unix commands that take a list of file names at the end)?"}, {"owner": {"reputation": 19084, "user_id": 1482749, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/7ff9982206dde8c2bbb151a7305c00f3?s=128&d=identicon&r=PG", "display_name": "kosmikus", "link": "https://stackoverflow.com/users/1482749/kosmikus"}, "reply_to_user": {"reputation": 23329, "user_id": 115432, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/eca023f50940b65931dfe75a03e6e00a?s=128&d=identicon&r=PG", "display_name": "Kathy Van Stone", "link": "https://stackoverflow.com/users/115432/kathy-van-stone"}, "edited": false, "score": 1, "creation_date": 1548445333, "post_id": 28927848, "comment_id": 95558044, "body": "Parsers are an instance of <code>Applicative</code>, so you can use functions like <code>many</code> or <code>some</code> to allow a variable number of arguments."}, {"owner": {"reputation": 23329, "user_id": 115432, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/eca023f50940b65931dfe75a03e6e00a?s=128&d=identicon&r=PG", "display_name": "Kathy Van Stone", "link": "https://stackoverflow.com/users/115432/kathy-van-stone"}, "edited": false, "score": 1, "creation_date": 1548786127, "post_id": 28927848, "comment_id": 95664762, "body": "Thanks! Those were the functions I was missing."}], "tags": [], "owner": {"reputation": 19084, "user_id": 1482749, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/7ff9982206dde8c2bbb151a7305c00f3?s=128&d=identicon&r=PG", "display_name": "kosmikus", "link": "https://stackoverflow.com/users/1482749/kosmikus"}, "is_accepted": true, "score": 5, "last_activity_date": 1425826711, "creation_date": 1425826711, "answer_id": 28927848, "question_id": 28927358, "link": "https://stackoverflow.com/questions/28927358/how-to-get-leftover-arguments-in-optparse-applicative/28927848#28927848", "title": "how to get &quot;leftover arguments&quot; in optparse-applicative?", "body": "<p>Positional arguments are part of the parser specification. They are not returned separately by the function that runs the parser. The functions <code>argument</code> and <code>strArgument</code> can be used to add a parser for a positional argument to the specification. </p>\n"}], "owner": {"reputation": 2501, "user_id": 2868481, "user_type": "registered", "accept_rate": 48, "profile_image": "https://www.gravatar.com/avatar/d32920192c6bebcffb83fffd557b9553?s=128&d=identicon&r=PG&f=1", "display_name": "d8d0d65b3f7cf42", "link": "https://stackoverflow.com/users/2868481/d8d0d65b3f7cf42"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 462, "favorite_count": 1, "accepted_answer_id": 28927848, "answer_count": 1, "score": 7, "last_activity_date": 1441538781, "creation_date": 1425823661, "last_edit_date": 1441538781, "question_id": 28927358, "link": "https://stackoverflow.com/questions/28927358/how-to-get-leftover-arguments-in-optparse-applicative", "title": "how to get &quot;leftover arguments&quot; in optparse-applicative?", "body": "<p>I am trying to use optparse-applicative.\nHow can I access arguments that are not options?\n(From <code>prog --foo --bar=42 baz</code>, I want to get <code>[\"baz\"]</code>)</p>\n\n<p>All the the \"high level\" functions <a href=\"https://hackage.haskell.org/package/optparse-applicative-0.11.0.2/docs/Options-Applicative-Extra.html\" rel=\"nofollow\">https://hackage.haskell.org/package/optparse-applicative-0.11.0.2/docs/Options-Applicative-Extra.html</a>\nreturn <code>a</code> where I want <code>(a,[String])</code>.</p>\n\n<p>There is some low-level function <a href=\"https://hackage.haskell.org/package/optparse-applicative-0.11.0.2/docs/Options-Applicative-Common.html#v:runParser\" rel=\"nofollow\">https://hackage.haskell.org/package/optparse-applicative-0.11.0.2/docs/Options-Applicative-Common.html#v:runParser</a> but I cannot call it directly because of its type. And indeed I do want to re-use all the plumbing that is in <a href=\"https://hackage.haskell.org/package/optparse-applicative-0.11.0.2/docs/src/Options-Applicative-Extra.html#execParser\" rel=\"nofollow\">https://hackage.haskell.org/package/optparse-applicative-0.11.0.2/docs/src/Options-Applicative-Extra.html#execParser</a> .</p>\n"}, {"tags": ["performance", "haskell", "functional-programming"], "comments": [{"owner": {"reputation": 204954, "user_id": 1903116, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/w6Ffg.jpg?s=128&g=1", "display_name": "thefourtheye", "link": "https://stackoverflow.com/users/1903116/thefourtheye"}, "edited": false, "score": 0, "creation_date": 1425820915, "post_id": 28926864, "comment_id": 46109805, "body": "Can you elaborate a bit, with an example?"}, {"owner": {"reputation": 22266, "user_id": 649287, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/7c0ea0055b84020bf860c05f53ba53d5?s=128&d=identicon&r=PG", "display_name": "augustss", "link": "https://stackoverflow.com/users/649287/augustss"}, "edited": false, "score": 1, "creation_date": 1425823588, "post_id": 28926864, "comment_id": 46110601, "body": "I&#39;d be surprised if you can find an example where they differ in performance."}, {"owner": {"reputation": 12058, "user_id": 205756, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/3c43a4d8967538063b38e41f4559a975?s=128&d=identicon&r=PG", "display_name": "alternative", "link": "https://stackoverflow.com/users/205756/alternative"}, "edited": false, "score": 2, "creation_date": 1425825878, "post_id": 28926864, "comment_id": 46111329, "body": "You can be as detailed as you want here, but the answer ultimately is &quot;No&quot; based on the fact that it would just be ridiculous for them to have differing performance. Quite frankly this is like asking if &quot;++i&quot; or &quot;i++&quot; is faster; sure, one of them might be faster without trivial optimizations, but under any reasonable compiler you don&#39;t derive your performance from trivialities like this."}, {"owner": {"reputation": 44013, "user_id": 1477667, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/trgKM.jpg?s=128&g=1", "display_name": "dfeuer", "link": "https://stackoverflow.com/users/1477667/dfeuer"}, "edited": false, "score": 0, "creation_date": 1425829120, "post_id": 28926864, "comment_id": 46112375, "body": "Surely you mean <code>(foo . bar . baz) value</code>."}, {"owner": {"reputation": 1414, "user_id": 2156925, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/ee041d4510b80b51b16002867ba30663?s=128&d=identicon&r=PG", "display_name": "Mickael Bergeron N&#233;ron", "link": "https://stackoverflow.com/users/2156925/mickael-bergeron-n%c3%a9ron"}, "reply_to_user": {"reputation": 44013, "user_id": 1477667, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/trgKM.jpg?s=128&g=1", "display_name": "dfeuer", "link": "https://stackoverflow.com/users/1477667/dfeuer"}, "edited": false, "score": 0, "creation_date": 1425829658, "post_id": 28926864, "comment_id": 46112572, "body": "@dfeuer Yes thanks, corrected."}, {"owner": {"reputation": 507143, "user_id": 1048572, "user_type": "registered", "accept_rate": 77, "profile_image": "https://www.gravatar.com/avatar/7f2c4de95e8f4f8f5a71c3aaf0ed312a?s=128&d=identicon&r=PG", "display_name": "Bergi", "link": "https://stackoverflow.com/users/1048572/bergi"}, "edited": false, "score": 0, "creation_date": 1425829832, "post_id": 28926864, "comment_id": 46112644, "body": "Oh, have you tried <code>foo (bar (baz value)))</code>?"}, {"owner": {"reputation": 1414, "user_id": 2156925, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/ee041d4510b80b51b16002867ba30663?s=128&d=identicon&r=PG", "display_name": "Mickael Bergeron N&#233;ron", "link": "https://stackoverflow.com/users/2156925/mickael-bergeron-n%c3%a9ron"}, "reply_to_user": {"reputation": 507143, "user_id": 1048572, "user_type": "registered", "accept_rate": 77, "profile_image": "https://www.gravatar.com/avatar/7f2c4de95e8f4f8f5a71c3aaf0ed312a?s=128&d=identicon&r=PG", "display_name": "Bergi", "link": "https://stackoverflow.com/users/1048572/bergi"}, "edited": false, "score": 0, "creation_date": 1425830165, "post_id": 28926864, "comment_id": 46112772, "body": "@Bergi This one handicaps readability too much for my taste."}], "answers": [{"comments": [{"owner": {"reputation": 1414, "user_id": 2156925, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/ee041d4510b80b51b16002867ba30663?s=128&d=identicon&r=PG", "display_name": "Mickael Bergeron N&#233;ron", "link": "https://stackoverflow.com/users/2156925/mickael-bergeron-n%c3%a9ron"}, "edited": false, "score": 0, "creation_date": 1425821258, "post_id": 28926943, "comment_id": 46109884, "body": "What do you mean by &quot;nearly certainly&quot;? Are there cases where the compiler won&#39;t inline?"}, {"owner": {"reputation": 153048, "user_id": 9204, "user_type": "registered", "accept_rate": 82, "profile_image": "https://www.gravatar.com/avatar/c79937a093ff9e963c563e22cd385f30?s=128&d=identicon&r=PG", "display_name": "Alexey Romanov", "link": "https://stackoverflow.com/users/9204/alexey-romanov"}, "reply_to_user": {"reputation": 1414, "user_id": 2156925, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/ee041d4510b80b51b16002867ba30663?s=128&d=identicon&r=PG", "display_name": "Mickael Bergeron N&#233;ron", "link": "https://stackoverflow.com/users/2156925/mickael-bergeron-n%c3%a9ron"}, "edited": false, "score": 0, "creation_date": 1425821669, "post_id": 28926943, "comment_id": 46110010, "body": "@MickaelBergeronN&#233;ron I&#39;ve edited the answer to be a bit more explicit."}, {"owner": {"reputation": 5359, "user_id": 582917, "user_type": "registered", "accept_rate": 81, "profile_image": "https://www.gravatar.com/avatar/98a347823cd1db90af884b227a29c29e?s=128&d=identicon&r=PG", "display_name": "CMCDragonkai", "link": "https://stackoverflow.com/users/582917/cmcdragonkai"}, "edited": false, "score": 0, "creation_date": 1464193881, "post_id": 28926943, "comment_id": 62388235, "body": "What about lists? Do intermediate lists get created in-between each application or composition? What about stream fusion?"}], "tags": [], "owner": {"reputation": 153048, "user_id": 9204, "user_type": "registered", "accept_rate": 82, "profile_image": "https://www.gravatar.com/avatar/c79937a093ff9e963c563e22cd385f30?s=128&d=identicon&r=PG", "display_name": "Alexey Romanov", "link": "https://stackoverflow.com/users/9204/alexey-romanov"}, "is_accepted": false, "score": 15, "last_activity_date": 1425836956, "last_edit_date": 1425836956, "creation_date": 1425821201, "answer_id": 28926943, "question_id": 28926864, "link": "https://stackoverflow.com/questions/28926864/haskell-function-composition-vs-function-application-when-it-comes-to-p/28926943#28926943", "title": "Haskell: function composition (.) vs function application ($) when it comes to performance?", "body": "<p>If you are compiling with optimizations (<code>-O2</code>), GHC will nearly certainly inline both <code>.</code> and <code>$</code> and produce <code>foo (bar (baz value))</code> in both cases (and then optimize it further). \"Nearly\" is just in case; inlining is one of most basic optimizations GHC does, and both <code>.</code> and <code>$</code> are very simple and inlining them should always be a win, but I may not be thinking of some particular case. (One case I <em>can</em> think of when inlining them is harder is when they are partially applied, or passed to a higher-order function, but that's not the example given; or there could be a <a href=\"https://downloads.haskell.org/~ghc/latest/docs/html/users_guide/rewrite-rules.html\" rel=\"noreferrer\">rewrite rule</a> which fires <em>before</em> inlining and only covers one of these cases.) </p>\n\n<p>However, you can always test it in your specific situation using e.g. <a href=\"http://www.serpentine.com/criterion/\" rel=\"noreferrer\">Criterion</a>. You can also verify that inlining happened by <a href=\"https://stackoverflow.com/questions/10693638/how-to-dump-ghc-simplifier-output-in-human-readable-form\">asking GHC to output Core files</a>.</p>\n"}], "owner": {"reputation": 1414, "user_id": 2156925, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/ee041d4510b80b51b16002867ba30663?s=128&d=identicon&r=PG", "display_name": "Mickael Bergeron N&#233;ron", "link": "https://stackoverflow.com/users/2156925/mickael-bergeron-n%c3%a9ron"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 422, "favorite_count": 2, "answer_count": 1, "score": 6, "last_activity_date": 1425836956, "creation_date": 1425820733, "last_edit_date": 1425829622, "question_id": 28926864, "link": "https://stackoverflow.com/questions/28926864/haskell-function-composition-vs-function-application-when-it-comes-to-p", "title": "Haskell: function composition (.) vs function application ($) when it comes to performance?", "body": "<p>In Haskell, when performance matters and using dollars or dots are both valid options, is one better than the other? Will one result in a performance gain over the other?</p>\n\n<p>For example, given <code>(foo . bar. baz) value</code> and <code>foo $ bar $ baz value</code>, is one faster than the other?</p>\n"}, {"tags": ["algorithm", "haskell", "functional-programming"], "comments": [{"owner": {"reputation": 204954, "user_id": 1903116, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/w6Ffg.jpg?s=128&g=1", "display_name": "thefourtheye", "link": "https://stackoverflow.com/users/1903116/thefourtheye"}, "edited": false, "score": 0, "creation_date": 1425800181, "post_id": 28924111, "comment_id": 46104839, "body": "If you don&#39;t mind, can you please explain how <code>(filter (&#47;= x) list)</code> works? I see that <code>x</code> is <code>list</code> (as per the previous line) and you are trying to filter the elements from <code>list</code> which are not equal to <code>list</code>?"}, {"owner": {"reputation": 23444, "user_id": 414413, "user_type": "registered", "accept_rate": 79, "profile_image": "https://www.gravatar.com/avatar/6de2113f01432aa844dc85070ff33e89?s=128&d=identicon&r=PG", "display_name": "Cirdec", "link": "https://stackoverflow.com/users/414413/cirdec"}, "edited": false, "score": 0, "creation_date": 1425800499, "post_id": 28924111, "comment_id": 46104885, "body": "A good implementation of <code>permutations</code> or <code>combinations</code> probably shouldn&#39;t require either <code>Eq</code> or <code>Ord</code> instances unless you are trying to do something more sophisticated so that <code>permuations [1,1] = [[1,1]]</code>."}, {"owner": {"reputation": 44680, "user_id": 1031791, "user_type": "registered", "accept_rate": 54, "profile_image": "https://www.gravatar.com/avatar/fb710534fda446d2286074bb7692e65a?s=128&d=identicon&r=PG", "display_name": "MaiaVictor", "link": "https://stackoverflow.com/users/1031791/maiavictor"}, "reply_to_user": {"reputation": 23444, "user_id": 414413, "user_type": "registered", "accept_rate": 79, "profile_image": "https://www.gravatar.com/avatar/6de2113f01432aa844dc85070ff33e89?s=128&d=identicon&r=PG", "display_name": "Cirdec", "link": "https://stackoverflow.com/users/414413/cirdec"}, "edited": false, "score": 0, "creation_date": 1425801429, "post_id": 28924111, "comment_id": 46105060, "body": "@Cirdec hm makes sense. I guess you are right."}, {"owner": {"reputation": 44680, "user_id": 1031791, "user_type": "registered", "accept_rate": 54, "profile_image": "https://www.gravatar.com/avatar/fb710534fda446d2286074bb7692e65a?s=128&d=identicon&r=PG", "display_name": "MaiaVictor", "link": "https://stackoverflow.com/users/1031791/maiavictor"}, "reply_to_user": {"reputation": 204954, "user_id": 1903116, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/w6Ffg.jpg?s=128&g=1", "display_name": "thefourtheye", "link": "https://stackoverflow.com/users/1903116/thefourtheye"}, "edited": false, "score": 2, "creation_date": 1425801502, "post_id": 28924111, "comment_id": 46105073, "body": "@thefourtheye no, here <code>x</code> is just an element of the list (<code>1</code> or <code>2</code> or <code>3</code>...). This is actually a dirty and wrong way to remove an element from a list, i.e., <code>filter (&#47;= 2) [1,2,3,4] == [1,3,4]</code>. I believe there are better alternatives. Notice that the monad instance of lists is implemented so that <code>x &lt;- list</code> causes <code>x</code> to be each element of <code>list</code> nondeterministically, as if that line split the program in different universes."}, {"owner": {"reputation": 204954, "user_id": 1903116, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/w6Ffg.jpg?s=128&g=1", "display_name": "thefourtheye", "link": "https://stackoverflow.com/users/1903116/thefourtheye"}, "edited": false, "score": 1, "creation_date": 1425801584, "post_id": 28924111, "comment_id": 46105098, "body": "@Viclib So, <code>x  &lt;- list</code> will be iterating the <code>list</code> and give <code>x</code> a new value from <code>list</code> every time?"}, {"owner": {"reputation": 44680, "user_id": 1031791, "user_type": "registered", "accept_rate": 54, "profile_image": "https://www.gravatar.com/avatar/fb710534fda446d2286074bb7692e65a?s=128&d=identicon&r=PG", "display_name": "MaiaVictor", "link": "https://stackoverflow.com/users/1031791/maiavictor"}, "reply_to_user": {"reputation": 204954, "user_id": 1903116, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/w6Ffg.jpg?s=128&g=1", "display_name": "thefourtheye", "link": "https://stackoverflow.com/users/1903116/thefourtheye"}, "edited": false, "score": 1, "creation_date": 1425801639, "post_id": 28924111, "comment_id": 46105108, "body": "@thefourtheye yes, that&#39;s what the list monad does. Try this on ghci: <code>do { x &lt;- [1,2]; y &lt;- [3,4]; return (x,y) }</code>. The result is: <code>[(1,3),(1,4),(2,3),(2,4)]</code>."}, {"owner": {"reputation": 44680, "user_id": 1031791, "user_type": "registered", "accept_rate": 54, "profile_image": "https://www.gravatar.com/avatar/fb710534fda446d2286074bb7692e65a?s=128&d=identicon&r=PG", "display_name": "MaiaVictor", "link": "https://stackoverflow.com/users/1031791/maiavictor"}, "reply_to_user": {"reputation": 204954, "user_id": 1903116, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/w6Ffg.jpg?s=128&g=1", "display_name": "thefourtheye", "link": "https://stackoverflow.com/users/1903116/thefourtheye"}, "edited": false, "score": 0, "creation_date": 1425801688, "post_id": 28924111, "comment_id": 46105122, "body": "@thefourtheye no problems :)"}, {"owner": {"reputation": 2300, "user_id": 2437292, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/PjYDO.jpg?s=128&g=1", "display_name": "sashas", "link": "https://stackoverflow.com/users/2437292/sashas"}, "edited": false, "score": 0, "creation_date": 1425801734, "post_id": 28924111, "comment_id": 46105131, "body": "@Viclib does the input list to combinotorics have all unique elements ?"}, {"owner": {"reputation": 44680, "user_id": 1031791, "user_type": "registered", "accept_rate": 54, "profile_image": "https://www.gravatar.com/avatar/fb710534fda446d2286074bb7692e65a?s=128&d=identicon&r=PG", "display_name": "MaiaVictor", "link": "https://stackoverflow.com/users/1031791/maiavictor"}, "edited": false, "score": 0, "creation_date": 1425801767, "post_id": 28924111, "comment_id": 46105138, "body": "Yes, I should&#39;ve used a set actually."}, {"owner": {"reputation": 2300, "user_id": 2437292, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/PjYDO.jpg?s=128&g=1", "display_name": "sashas", "link": "https://stackoverflow.com/users/2437292/sashas"}, "edited": false, "score": 0, "creation_date": 1425802207, "post_id": 28924111, "comment_id": 46105225, "body": "Just coming from a noob not so familiar with functional programming but combinations ( say r out of n ) can be found out by picking the sorted first r elements of all permutations and inserting in a set ( so duplicates are not there ) although it might be an overkill in terms of time"}], "answers": [{"comments": [{"owner": {"reputation": 44680, "user_id": 1031791, "user_type": "registered", "accept_rate": 54, "profile_image": "https://www.gravatar.com/avatar/fb710534fda446d2286074bb7692e65a?s=128&d=identicon&r=PG", "display_name": "MaiaVictor", "link": "https://stackoverflow.com/users/1031791/maiavictor"}, "edited": false, "score": 0, "creation_date": 1425829232, "post_id": 28925067, "comment_id": 46112414, "body": "No problems! But I commented below the original thread the list can&#39;t contain duplicate elements. You are right, though: I should&#39;ve used a set to make this clearer. Thanks for the concern! Anyway, if anyone is curious, in order to fix this issue on my code, instead of filtering, just remove the element by its index. One could, for example, write a monad instance for sets which provided not only the element but the &quot;rest&quot; of the list."}, {"owner": {"reputation": 37219, "user_id": 1523776, "user_type": "moderator", "accept_rate": 87, "profile_image": "https://www.gravatar.com/avatar/b3e0b5c8e42a8c38009ef2d969f8dabb?s=128&d=identicon&r=PG", "display_name": "Benjamin Hodgson", "link": "https://stackoverflow.com/users/1523776/benjamin-hodgson"}, "reply_to_user": {"reputation": 44680, "user_id": 1031791, "user_type": "registered", "accept_rate": 54, "profile_image": "https://www.gravatar.com/avatar/fb710534fda446d2286074bb7692e65a?s=128&d=identicon&r=PG", "display_name": "MaiaVictor", "link": "https://stackoverflow.com/users/1031791/maiavictor"}, "edited": false, "score": 0, "creation_date": 1425829820, "post_id": 28925067, "comment_id": 46112641, "body": "I don&#39;t think such a monad exists"}], "tags": [], "owner": {"reputation": 37219, "user_id": 1523776, "user_type": "moderator", "accept_rate": 87, "profile_image": "https://www.gravatar.com/avatar/b3e0b5c8e42a8c38009ef2d969f8dabb?s=128&d=identicon&r=PG", "display_name": "Benjamin Hodgson", "link": "https://stackoverflow.com/users/1523776/benjamin-hodgson"}, "is_accepted": false, "score": 5, "last_activity_date": 1425826941, "last_edit_date": 1425826941, "creation_date": 1425807678, "answer_id": 28925067, "question_id": 28924111, "link": "https://stackoverflow.com/questions/28924111/generalizing-a-combinatoric-function/28925067#28925067", "title": "Generalizing a combinatoric function?", "body": "<p>This isn't a direct answer to your question (sorry), but I don't think your code is correct. The <code>Eq</code> and <code>Ord</code> constraints tipped me off - they shouldn't be necessary - so I wrote a couple of <a href=\"https://hackage.haskell.org/package/QuickCheck\" rel=\"nofollow\">QuickCheck</a> properties.</p>\n\n<pre><code>prop_numberOfPermutations xs = length (permutations xs) === factorial (length xs)\n    where _ = (xs :: [Int])  -- force xs to be instantiated to [Int]\n\nprop_numberOfCombinations (Positive n) (NonEmpty xs) = n &lt;= length xs ==&gt;\n        length (combinations n xs) === choose (length xs) n\n    where _ = (xs :: [Int])\n\n\nfactorial :: Int -&gt; Int\nfactorial x = foldr (*) 1 [1..x]\n\nchoose :: Int -&gt; Int -&gt; Int\nchoose n 0 = 1\nchoose 0 r = 0\nchoose n r = choose (n-1) (r-1) * n `div` r\n</code></pre>\n\n<p>The first property checks that <a href=\"http://en.wikipedia.org/wiki/Factorial#Applications\" rel=\"nofollow\">the number of permutations of a list of length <code>n</code> is <code>n!</code></a>. The second checks that <a href=\"http://en.wikipedia.org/wiki/Combination#Number_of_k-combinations\" rel=\"nofollow\">the number of r-combinations of a list of length <code>n</code> is <code>C(n, r)</code></a>. Both of these properties fail when I run them against your definitions:</p>\n\n<pre><code>ghci&gt; quickCheck prop_numberOfPermutations\n*** Failed! Falsifiable (after 5 tests and 4 shrinks):    \n[0,0,0]\n3 /= 6\nghci&gt; quickCheck prop_numberOfCombinations \n*** Failed! Falsifiable (after 4 tests and 1 shrink):     \nPositive {getPositive = 2}\nNonEmpty {getNonEmpty = [3,3]}\n0 /= 1\n</code></pre>\n\n<p>It looks like your functions fail when the input list contains duplicate elements. Writing an abstraction for an incorrect implementation isn't a good idea - don't try and run before you can walk! You might find it helpful to read <a href=\"http://hackage.haskell.org/package/base-4.7.0.2/docs/src/Data-List.html#permutations\" rel=\"nofollow\">the source code</a> for the standard library's definition of <a href=\"http://hackage.haskell.org/package/base-4.7.0.2/docs/Data-List.html#v:permutations\" rel=\"nofollow\"><code>permutations</code></a>, which does not have an <code>Eq</code> constraint.</p>\n"}, {"tags": [], "owner": {"reputation": 60057, "user_id": 1333025, "user_type": "registered", "accept_rate": 65, "profile_image": "https://www.gravatar.com/avatar/79ab43010f900324ac5e2de19a2916cb?s=128&d=identicon&r=PG", "display_name": "Petr", "link": "https://stackoverflow.com/users/1333025/petr"}, "is_accepted": true, "score": 1, "last_activity_date": 1425848328, "last_edit_date": 1425848328, "creation_date": 1425846477, "answer_id": 28931510, "question_id": 28924111, "link": "https://stackoverflow.com/questions/28924111/generalizing-a-combinatoric-function/28931510#28931510", "title": "Generalizing a combinatoric function?", "body": "<p>First let's improve the original functions. You assume that all elements are distinct wrt their equality for <code>permutations</code>, and that they're distinct and have an ordering for <code>combinations</code>. These constraints aren't necessary and as described in the other answer, the code can produce wrong results. Following the <a href=\"https://en.wikipedia.org/wiki/Robustness_principle\" rel=\"nofollow\">robustness principle</a>, let's accept just unconstrained lists. For this we'll need a helper function that produces all possible splits of a list:</p>\n\n<pre><code>split :: [a] -&gt; [([a], a, [a])]\nsplit = loop []\n  where\n    loop _  []      = []\n    loop rs (x:xs)  = (rs, x, xs) : loop (x:rs) xs\n</code></pre>\n\n<p>Note that the implementation causes prefixes returned by this function to be reversed, but it's nothing we require.</p>\n\n<p>This allows us to write generic <code>permutations</code> and <code>combinations</code>.</p>\n\n<pre><code>permutations :: [a] -&gt; [[a]]\npermutations [] = [[]]\npermutations list = do\n    (pre, x, post) &lt;- split list\n    -- reversing 'pre' isn't really necessary, but makes the output\n    -- order natural\n    xs &lt;- permutations (reverse pre ++ post)\n    return (x : xs)\n\ncombinations :: Int -&gt; [a] -&gt; [[a]]\ncombinations 0 _ = [[]]\ncombinations n list = do\n    (_, x, post) &lt;- split list\n    xs &lt;- combinations (n-1) post\n    return (x : xs)\n</code></pre>\n\n<p>Now what they have in common:</p>\n\n<ul>\n<li>At each step they pick an element to output,</li>\n<li>update the list of elements to pick from and</li>\n<li>stop after some condition is met.</li>\n</ul>\n\n<p>The last point is a bit problematic, as for <code>permutations</code> we end once the list to choose from is empty, while for <code>combinations</code> we have a counter. This is probably the reason why it was difficult to generalize. We can work around this by realizing that for <code>permutations</code> the number of steps is equal to the length of the input list, so we can express the condition in the number of repetitions.</p>\n\n<p>For such problems it's often very convenient to express them using <code>StateT s []</code> monad, where <code>s</code> is the state we're working with. In our case it'll be the list of elements to choose from. The core of our combinatorial functions can be then expressed with <code>StateT [a] [] a</code>: pick an element from the state and update the state for the next step. Since the stateful computations all happen in the <code>[]</code> monad, we automatically branch all possibilities. With that, we can define a generic function:</p>\n\n<pre><code>import Control.Monad.State\n\ncombinatoric :: Int -&gt; StateT [a] [] b -&gt; [a] -&gt; [[b]]\ncombinatoric n k = evalStateT $ replicateM n k\n</code></pre>\n\n<p>And then define <code>permutations</code> and <code>combinations</code> by specifying the appropriate number of repetitions and what's the core <code>StateT [a] [] a</code> function:</p>\n\n<pre><code>permutations' :: [a] -&gt; [[a]]\npermutations' xs = combinatoric (length xs) f xs\n  where\n    f = StateT $ map (\\(pre, x, post) -&gt; (x, reverse pre ++ post)) . split\n\n\ncombinations' :: Int -&gt; [a] -&gt; [[a]]\ncombinations' n xs = combinatoric n f xs\n  where\n    f = StateT $ map (\\(_, x, post) -&gt; (x, post)) . split\n</code></pre>\n"}], "owner": {"reputation": 44680, "user_id": 1031791, "user_type": "registered", "accept_rate": 54, "profile_image": "https://www.gravatar.com/avatar/fb710534fda446d2286074bb7692e65a?s=128&d=identicon&r=PG", "display_name": "MaiaVictor", "link": "https://stackoverflow.com/users/1031791/maiavictor"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 129, "favorite_count": 0, "accepted_answer_id": 28931510, "answer_count": 2, "score": 3, "last_activity_date": 1425848328, "creation_date": 1425799517, "last_edit_date": 1495542504, "question_id": 28924111, "link": "https://stackoverflow.com/questions/28924111/generalizing-a-combinatoric-function", "title": "Generalizing a combinatoric function?", "body": "<p>I've been solving a few combinatoric problems on Haskell, so I wrote down those 2 functions:</p>\n\n<pre><code>permutations :: (Eq a) =&gt; [a] -&gt; [[a]]\npermutations [] = [[]]\npermutations list = do\n    x  &lt;- list\n    xs &lt;- permutations (filter (/= x) list)\n    return (x : xs)\n\ncombinations :: (Eq a, Ord a) =&gt; Int -&gt; [a] -&gt; [[a]]\ncombinations 0 _ = [[]]\ncombinations n list = do\n    x  &lt;- list\n    xs &lt;- combinations (n-1) (filter (&gt; x) list)\n    return (x : xs)\n</code></pre>\n\n<p>Which works as follows:</p>\n\n<pre><code>*Main&gt; permutations [1,2,3]\n[[1,2,3],[1,3,2],[2,1,3],[2,3,1],[3,1,2],[3,2,1]]\n*Main&gt; combinations 2 [1,2,3,4]\n[[1,2],[1,3],[1,4],[2,3],[2,4],[3,4]]\n</code></pre>\n\n<p>Those were uncomfortably similar, so I <strong>had</strong> to abstract it. I wrote the following abstraction:</p>\n\n<pre><code>combinatoric next [] = [[]]\ncombinatoric next list = do\n    x  &lt;- list\n    xs &lt;- combinatoric next (next x list)\n    return (x : xs)\n</code></pre>\n\n<p>Which receives a function that controls how to filter the elements of the list. It can be used to easily define permutations:</p>\n\n<pre><code>permutations :: (Eq a) =&gt; [a] -&gt; [[a]]\npermutations = combinatoric (\\ x ls -&gt; filter (/= x) ls)\n</code></pre>\n\n<p>But I couldn't define <code>combinations</code> this way since it carries an state (<code>n</code>). I could extend the <code>combinatoric</code> with an additional state argument, but that'd become too clunky and I remember such approach was not necessary <a href=\"https://stackoverflow.com/questions/28533221/since-fold-isnt-powerful-enough-to-write-a-tree-pretty-printer-with-indentati\">in a somewhat similar situation</a>. Thus, I wonder: is it possible to define <code>combinations</code> using <code>combinatorics</code>? If not, what is a better abstraction of <code>combinatorics</code> which successfully subsumes both functions?</p>\n"}, {"tags": ["haskell", "maybe"], "answers": [{"comments": [{"owner": {"reputation": 48938, "user_id": 246886, "user_type": "registered", "accept_rate": 94, "profile_image": "https://www.gravatar.com/avatar/dd1ebaade6623fc538fb8af3338e730d?s=128&d=identicon&r=PG", "display_name": "Jon Purdy", "link": "https://stackoverflow.com/users/246886/jon-purdy"}, "edited": false, "score": 0, "creation_date": 1425793613, "post_id": 28923474, "comment_id": 46103707, "body": "OP may have intended to use <code>fromJust</code> instead of <code>fromMaybe</code>."}, {"owner": {"reputation": 57219, "user_id": 33796, "user_type": "registered", "accept_rate": 70, "profile_image": "https://www.gravatar.com/avatar/08727b23ba62e634b32988cdff082663?s=128&d=identicon&r=PG", "display_name": "luqui", "link": "https://stackoverflow.com/users/33796/luqui"}, "reply_to_user": {"reputation": 48938, "user_id": 246886, "user_type": "registered", "accept_rate": 94, "profile_image": "https://www.gravatar.com/avatar/dd1ebaade6623fc538fb8af3338e730d?s=128&d=identicon&r=PG", "display_name": "Jon Purdy", "link": "https://stackoverflow.com/users/246886/jon-purdy"}, "edited": false, "score": 3, "creation_date": 1425793715, "post_id": 28923474, "comment_id": 46103723, "body": "I&#39;m being a little sneaky, I don&#39;t want them to know about that godless &quot;function&quot;. :-P"}, {"owner": {"reputation": 62421, "user_id": 216164, "user_type": "registered", "accept_rate": 89, "profile_image": "https://www.gravatar.com/avatar/786f224adbe0784cdf7d0f15476061fe?s=128&d=identicon&r=PG", "display_name": "Thomas M. DuBuisson", "link": "https://stackoverflow.com/users/216164/thomas-m-dubuisson"}, "reply_to_user": {"reputation": 6557, "user_id": 2495795, "user_type": "registered", "accept_rate": 87, "profile_image": "https://www.gravatar.com/avatar/13606de0b736d7191e2cf2bfea1d4fda?s=128&d=identicon&r=PG", "display_name": "BufBills", "link": "https://stackoverflow.com/users/2495795/bufbills"}, "edited": false, "score": 1, "creation_date": 1425794046, "post_id": 28923474, "comment_id": 46103787, "body": "@BufBills Yes, that is still wrong.  Function application is <code>f a b</code> not <code>f (a (b))</code>."}], "tags": [], "owner": {"reputation": 57219, "user_id": 33796, "user_type": "registered", "accept_rate": 70, "profile_image": "https://www.gravatar.com/avatar/08727b23ba62e634b32988cdff082663?s=128&d=identicon&r=PG", "display_name": "luqui", "link": "https://stackoverflow.com/users/33796/luqui"}, "is_accepted": false, "score": 8, "last_activity_date": 1425793162, "creation_date": 1425793162, "answer_id": 28923474, "question_id": 28923403, "link": "https://stackoverflow.com/questions/28923403/how-can-i-print-a-maybe/28923474#28923474", "title": "How can I print a Maybe?", "body": "<pre><code>show fromMaybe (findKey \"penny\" phoneBook)\n</code></pre>\n\n<p>passes two arguments to <code>show</code>: the first is <code>fromMaybe</code> and the second is <code>findKey \"penny\" phoneBook</code>.  You need to parenthesize to only pass one:</p>\n\n<pre><code>show (fromMaybe (findKey \"penny\" phoneBook))\n</code></pre>\n\n<p>But there is another problem.  <a href=\"http://hackage.haskell.org/package/base-4.7.0.2/docs/Data-Maybe.html#v:fromMaybe\"><code>fromMaybe</code></a> takes two arguments, and you have only given it one.  Its first argument should be a default value to return if the maybe turns out to be <code>Nothing</code>.</p>\n"}, {"tags": [], "owner": {"reputation": 204954, "user_id": 1903116, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/w6Ffg.jpg?s=128&g=1", "display_name": "thefourtheye", "link": "https://stackoverflow.com/users/1903116/thefourtheye"}, "is_accepted": true, "score": 7, "last_activity_date": 1425794301, "last_edit_date": 1592644375, "creation_date": 1425793886, "answer_id": 28923532, "question_id": 28923403, "link": "https://stackoverflow.com/questions/28923403/how-can-i-print-a-maybe/28923532#28923532", "title": "How can I print a Maybe?", "body": "<p>You have to understand how <a href=\"https://hackage.haskell.org/package/base-4.2.0.1/docs/Data-Maybe.html#v%3AfromMaybe\" rel=\"noreferrer\"><code>fromMaybe</code></a> works, first. Quoting the documentation,</p>\n<blockquote>\n<p>The <code>fromMaybe</code> function <em>takes a default value and and <code>Maybe</code> value</em>. If the <code>Maybe</code> is <code>Nothing</code>, it returns the default values; otherwise, it returns the value contained in the <code>Maybe</code>.</p>\n</blockquote>\n<p>So, you need to pass two values to <code>fromMaybe</code>, and the first one is the default value to be used, in case the <code>Maybe</code> turns out to be <code>Nothing</code>. But in your case, you are only passing one argument,</p>\n<pre><code>fromMaybe (findKey &quot;penny&quot; phoneBook)\nfromMaybe (findKey &quot;bonny&quot; phoneBook)\n</code></pre>\n<p>You are just passing the actual <code>Maybe</code> value to used, the default value is missing. So, change it to something like</p>\n<pre><code>fromMaybe &quot;Not Found&quot; (findKey &quot;penny&quot; phoneBook)\nfromMaybe &quot;Not Found&quot; (findKey &quot;bonny&quot; phoneBook)\n</code></pre>\n<p>Now we are fine with the <code>fromMaybe</code> part. But, it still is going to fail, if your code is like this</p>\n<pre><code>show fromMaybe &quot;Not Found&quot; (findKey &quot;penny&quot; phoneBook)\nshow fromMaybe &quot;Not Found&quot; (findKey &quot;bonny&quot; phoneBook)\n</code></pre>\n<p>because, it means that, you are passing three arguments to <code>show</code>, namely <code>fromMaybe</code>, <code>&quot;Not Found&quot;</code> and <code>(findKey &quot;penny&quot; phoneBook)</code>. But <code>show</code> expects only one value. Quoting the <a href=\"http://hackage.haskell.org/package/base-4.7.0.2/docs/Prelude.html#v:show\" rel=\"noreferrer\"><code>show</code> documentation</a>,</p>\n<blockquote>\n<p><strong><code>show :: a -&gt; String</code></strong></p>\n<p>A specialised variant of <code>showsPrec</code>, using precedence context zero, and returning an ordinary String.</p>\n</blockquote>\n<p>It just expects only value and returns a <code>String</code>. So you need to pass just the value returned by <code>fromMaybe</code>, like this</p>\n<pre><code>show (fromMaybe &quot;Not Found&quot; (findKey &quot;penny&quot; phoneBook))\nshow (fromMaybe &quot;Not Found&quot; (findKey &quot;bonny&quot; phoneBook))\n</code></pre>\n<p>Still it will fail, because <code>putStrLn</code> expects only one argument, as per <a href=\"http://hackage.haskell.org/package/base-4.7.0.2/docs/Prelude.html#v:putStrLn\" rel=\"noreferrer\">the documentation</a>,</p>\n<blockquote>\n<p><strong><code>putStrLn :: String -&gt; IO ()</code></strong></p>\n<p>The same as <code>putStr</code>, but adds a newline character.</p>\n</blockquote>\n<p>So, you just need to pass the result of <code>show</code> to <code>putStrLn</code>, like this</p>\n<pre><code>putStrLn (show (fromMaybe &quot;Not Found&quot; (findKey &quot;penny&quot; phoneBook)))\nputStrLn (show (fromMaybe &quot;Not Found&quot; (findKey &quot;bonny&quot; phoneBook)))\n</code></pre>\n<p>Now, it will print,</p>\n<pre><code>hello\n&quot;Not Found&quot;\n&quot;092-1029&quot;\n</code></pre>\n<p><strong>Note 1:</strong> If you don't like to have so many brackets, you can use the <code>$</code> operator, which does the implicit function application. Quoting the docs of <a href=\"http://hackage.haskell.org/package/base-4.7.0.2/docs/Prelude.html#v:-36-\" rel=\"noreferrer\"><code>$</code></a>,</p>\n<blockquote>\n<p><strong><code>($) :: (a -&gt; b) -&gt; a -&gt; b</code></strong></p>\n<p>Application operator. This operator is redundant, since ordinary application <code>(f x)</code> means the same as <code>(f $ x)</code>. However, <code>$</code> has low, right-associative binding precedence, so it sometimes allows parentheses to be omitted; for example:</p>\n<pre><code>   f $ g $ h x  =  f (g (h x))\n</code></pre>\n<p>It is also useful in higher-order situations, such as <code>map ($ 0) xs</code>, or <code>zipWith ($) fs xs</code>.</p>\n</blockquote>\n<p>So, you can simply drop the unnecessary parens and write your code like this</p>\n<pre><code>putStrLn $ show $ fromMaybe &quot;Not Found&quot; (findKey &quot;penny&quot; phoneBook)\nputStrLn $ show $ fromMaybe &quot;Not Found&quot; (findKey &quot;bonny&quot; phoneBook)\n</code></pre>\n<p><strong>Note 2:</strong> In this particular case, since your <code>fromMaybe</code> already returns a <code>[Char]</code>, you can simply skip <code>show</code> and pass the result of <code>fromMaybe</code> to <code>putStrLn</code>, like this</p>\n<pre><code>putStrLn $ fromMaybe &quot;Not Found&quot; (findKey &quot;penny&quot; phoneBook)\nputStrLn $ fromMaybe &quot;Not Found&quot; (findKey &quot;bonny&quot; phoneBook)\n</code></pre>\n"}], "owner": {"reputation": 6557, "user_id": 2495795, "user_type": "registered", "accept_rate": 87, "profile_image": "https://www.gravatar.com/avatar/13606de0b736d7191e2cf2bfea1d4fda?s=128&d=identicon&r=PG", "display_name": "BufBills", "link": "https://stackoverflow.com/users/2495795/bufbills"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 666, "favorite_count": 0, "accepted_answer_id": 28923532, "answer_count": 2, "score": 1, "last_activity_date": 1425794384, "creation_date": 1425792336, "last_edit_date": 1425794384, "question_id": 28923403, "link": "https://stackoverflow.com/questions/28923403/how-can-i-print-a-maybe", "title": "How can I print a Maybe?", "body": "<pre><code>import Data.List\nimport Data.Char\nimport Data.Maybe\n\n\n\nphoneBook = \n    [(\"betty\", \"555-2928\")\n    ,(\"bonny\", \"092-1029\")\n    ,(\"pasty\", \"493-9202\")\n    ]\n\nfindKey :: (Eq k) =&gt; k -&gt;  [(k,v)] -&gt; Maybe v\nfindKey key [] = Nothing\nfindKey key ((k,v):xs) \n     | key == k = Just v\n     | otherwise = findKey key xs\n\nmain :: IO()\nmain = do\n    putStrLn \"hello\"\n\n    putStrLn (show fromMaybe (findKey \"penny\" phoneBook))\n    putStrLn (show fromMaybe (findKey \"bonny\" phoneBook))\n</code></pre>\n\n<p>==============================================================</p>\n\n<pre class=\"lang-none prettyprint-override\"><code>dictionary.hs:24:22:\n    Couldn't match type `Maybe [Char]' with `[Char]'\n    Expected type: String\n      Actual type: Maybe [Char]\n    In the return type of a call of `findKey'\n    In the first argument of `putStrLn', namely\n      `((findKey \"bonny\" phoneBook))'\n    In a stmt of a 'do' block: putStrLn ((findKey \"bonny\" phoneBook))\n</code></pre>\n\n<p>why my <code>putStrLn</code> throw error when I try to print value get from <code>fromMaybe</code>?</p>\n"}, {"tags": ["haskell", "aeson"], "comments": [{"owner": {"reputation": 25144, "user_id": 477476, "user_type": "registered", "accept_rate": 85, "profile_image": "https://i.stack.imgur.com/Qf4TT.png?s=128&g=1", "display_name": "Cactus", "link": "https://stackoverflow.com/users/477476/cactus"}, "edited": false, "score": 0, "creation_date": 1425789342, "post_id": 28923006, "comment_id": 46103097, "body": "Sounds like the basic motivating use case of <a href=\"https://hackage.haskell.org/package/lens\" rel=\"nofollow noreferrer\">lens</a>"}, {"owner": {"reputation": 1435, "user_id": 3792504, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/e1e342dc9ed03c2039e7cde0dab4214e?s=128&d=identicon&r=PG&f=1", "display_name": "TheCriticalImperitive", "link": "https://stackoverflow.com/users/3792504/thecriticalimperitive"}, "reply_to_user": {"reputation": 25144, "user_id": 477476, "user_type": "registered", "accept_rate": 85, "profile_image": "https://i.stack.imgur.com/Qf4TT.png?s=128&g=1", "display_name": "Cactus", "link": "https://stackoverflow.com/users/477476/cactus"}, "edited": false, "score": 0, "creation_date": 1425789899, "post_id": 28923006, "comment_id": 46103185, "body": "@Cactus would that involve creating a <code>Getter</code> over the <code>ByteString</code>? My only experience with lenses has been with records, so I&#39;m not really sure how that would work."}, {"owner": {"reputation": 25144, "user_id": 477476, "user_type": "registered", "accept_rate": 85, "profile_image": "https://i.stack.imgur.com/Qf4TT.png?s=128&g=1", "display_name": "Cactus", "link": "https://stackoverflow.com/users/477476/cactus"}, "edited": false, "score": 0, "creation_date": 1425790051, "post_id": 28923006, "comment_id": 46103208, "body": "No, I&#39;d just parse it into the generic JSON representation (Aeson&#39;s <code>Value</code>) and then do the drilldown (with the <code>lens</code> tools) on the <code>Value</code>."}, {"owner": {"reputation": 1435, "user_id": 3792504, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/e1e342dc9ed03c2039e7cde0dab4214e?s=128&d=identicon&r=PG&f=1", "display_name": "TheCriticalImperitive", "link": "https://stackoverflow.com/users/3792504/thecriticalimperitive"}, "reply_to_user": {"reputation": 25144, "user_id": 477476, "user_type": "registered", "accept_rate": 85, "profile_image": "https://i.stack.imgur.com/Qf4TT.png?s=128&g=1", "display_name": "Cactus", "link": "https://stackoverflow.com/users/477476/cactus"}, "edited": false, "score": 0, "creation_date": 1425791642, "post_id": 28923006, "comment_id": 46103441, "body": "Alright, so having had a look at <code>Data.Aeson.Lens</code>, I&#39;ve managed to get it to work with: <code>bstr ^? key (pack &quot;result&quot;) &gt;&gt;= \\obj -&gt; obj ^? key (pack &quot;bar&quot;)</code>. Unless there&#39;s some other way without needing <code>Data.Aeson.Lens</code>?"}, {"owner": {"reputation": 1435, "user_id": 3792504, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/e1e342dc9ed03c2039e7cde0dab4214e?s=128&d=identicon&r=PG&f=1", "display_name": "TheCriticalImperitive", "link": "https://stackoverflow.com/users/3792504/thecriticalimperitive"}, "reply_to_user": {"reputation": 25144, "user_id": 477476, "user_type": "registered", "accept_rate": 85, "profile_image": "https://i.stack.imgur.com/Qf4TT.png?s=128&g=1", "display_name": "Cactus", "link": "https://stackoverflow.com/users/477476/cactus"}, "edited": false, "score": 0, "creation_date": 1425791714, "post_id": 28923006, "comment_id": 46103450, "body": "Also, thanks for the heads up about lens. Did you want to put down an answer for future readers?"}, {"owner": {"reputation": 25144, "user_id": 477476, "user_type": "registered", "accept_rate": 85, "profile_image": "https://i.stack.imgur.com/Qf4TT.png?s=128&g=1", "display_name": "Cactus", "link": "https://stackoverflow.com/users/477476/cactus"}, "edited": false, "score": 0, "creation_date": 1425819626, "post_id": 28923006, "comment_id": 46109457, "body": "Sorry, I only have actual hands-on experience using <code>fclabels</code>, so I can&#39;t help you with the specifics."}, {"owner": {"reputation": 25144, "user_id": 477476, "user_type": "registered", "accept_rate": 85, "profile_image": "https://i.stack.imgur.com/Qf4TT.png?s=128&g=1", "display_name": "Cactus", "link": "https://stackoverflow.com/users/477476/cactus"}, "edited": false, "score": 0, "creation_date": 1425819662, "post_id": 28923006, "comment_id": 46109469, "body": "If you use <code>OverloadedStrings</code>, you can at least get rid of those <code>pack</code> calls."}], "answers": [{"tags": [], "owner": {"reputation": 1585, "user_id": 1413081, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/1d8d1f596731eaae04f3ade303d211ca?s=128&d=identicon&r=PG", "display_name": "Reite", "link": "https://stackoverflow.com/users/1413081/reite"}, "is_accepted": true, "score": 3, "last_activity_date": 1425822047, "creation_date": 1425822047, "answer_id": 28927083, "question_id": 28923006, "link": "https://stackoverflow.com/questions/28923006/isolate-a-single-value-from-a-nested-json-response-in-aeson/28927083#28927083", "title": "Isolate a single value from a nested JSON response in Aeson", "body": "<p>You can do this with or without lens. Lenses are nice because they allow you to compose the lenses you write with other lenses later. However if you don't need this it might be overkill.</p>\n\n<p>First realize that when you write a <code>FromJSON</code> instance you write a function with this signature <code>parseJSON :: Value -&gt; Parser a</code>. You can easily write these functions without using the FromJSON typeclass. What you actually want to do is write 2 parsers like this, then compose them.</p>\n\n<p>First you need to write the one that will look up a 'bar' in a object and parse it to a <code>Double</code>:</p>\n\n<pre><code>parseBar :: Value -&gt; Parser Double\nparseBar (Object o) = o .: \"bar\" &gt;&gt;= maybe (fail \"Not a double\") return . maybeRead . unpack\nparseBar _          = fail \"Expected an object.\"\n</code></pre>\n\n<p>Now you can write another function that uses this function to parse a more nested value:</p>\n\n<pre><code>parseNested :: Value -&gt; Parser Double\nparseNested (Object o) = o .: \"result\" &gt;&gt;= parseBar\nparseNested _          = fail \"Expected an object.\"\n</code></pre>\n\n<p>Now we write a utility function that runs the parser on a <code>ByteString</code>:</p>\n\n<pre><code>runParser :: (Value -&gt; Parser a) -&gt; BL.ByteString -&gt; Maybe a \nrunParser p bs = decode bs &gt;&gt;= parseMaybe p\n</code></pre>\n\n<p>Now we can use this function with the parsers we defined above to parse the json values like this:</p>\n\n<pre><code>testParseBar = runParser parseBar \"{\\\"foo\\\":\\\"xyz\\\",\\\"bar\\\":\\\"0.0000012\\\"}\"\ntestParseNested = runParser parseNested \"{\\\"success\\\":\\\"true\\\",\\\"message\\\":\\\"\\\",\\\"result\\\":{\\\"foo\\\":\\\"xyz\\\",\\\"bar\\\":\\\"0.0000012\\\"}}\"\n</code></pre>\n\n<p>Note that you can also use the <code>Alternative</code> instance on Parsers to create one parser that will parse either of these values:</p>\n\n<pre><code>parseBarOrNested :: Value -&gt; Parser Double\nparseBarOrNested v = parseBar v &lt;|&gt; parseNested v\n</code></pre>\n\n<p>This parser will try the bar parser first, if it doesnt work it will use the nested parser.</p>\n\n<pre><code>testBarOrNestedBar = runParser parseBarOrNested \"{\\\"foo\\\":\\\"xyz\\\",\\\"bar\\\":\\\"0.0000012\\\"}\"\ntestBarOrNestednested = runParser parseBarOrNested \"{\\\"success\\\":\\\"true\\\",\\\"message\\\":\\\"\\\",\\\"result\\\":{\\\"foo\\\":\\\"xyz\\\",\\\"bar\\\":\\\"0.0000012\\\"}}\"\n</code></pre>\n\n<p>Here is the complete code with pragmas and imports:</p>\n\n<pre><code>{-# LANGUAGE OverloadedStrings #-}\n\nimport Data.Aeson\nimport Data.Aeson.Types\nimport Control.Applicative\n\nimport qualified Data.ByteString.Lazy as BL\nimport Data.Text (unpack)\n\n-- Replace with your implementation\nmaybeRead = Just . read\n\n\nparseBar :: Value -&gt; Parser Double\nparseBar (Object o) = o .: \"bar\" &gt;&gt;= maybe (fail \"Not a double\") return . maybeRead . unpack\nparseBar _          = fail \"Expected an object.\"\n\nparseNested :: Value -&gt; Parser Double\nparseNested (Object o) = o .: \"result\" &gt;&gt;= parseBar\nparseNested _          = fail \"Expected an object.\"\n\nparseBarOrNested :: Value -&gt; Parser Double\nparseBarOrNested v = parseBar v &lt;|&gt; parseNested v\n\nrunParser :: (Value -&gt; Parser a) -&gt; BL.ByteString -&gt; Maybe a \nrunParser p bs = decode bs &gt;&gt;= parseMaybe p\n\n\ntestParseBar = runParser parseBar \"{\\\"foo\\\":\\\"xyz\\\",\\\"bar\\\":\\\"0.0000012\\\"}\"\n\ntestParseNested = runParser parseNested \"{\\\"success\\\":\\\"true\\\",\\\"message\\\":\\\"\\\",\\\"result\\\":{\\\"foo\\\":\\\"xyz\\\",\\\"bar\\\":\\\"0.0000012\\\"}}\"\n\ntestBarOrNestedBar = runParser parseBarOrNested \"{\\\"foo\\\":\\\"xyz\\\",\\\"bar\\\":\\\"0.0000012\\\"}\"\n\ntestBarOrNestednested = runParser parseBarOrNested \"{\\\"success\\\":\\\"true\\\",\\\"message\\\":\\\"\\\",\\\"result\\\":{\\\"foo\\\":\\\"xyz\\\",\\\"bar\\\":\\\"0.0000012\\\"}}\"\n</code></pre>\n"}], "owner": {"reputation": 1435, "user_id": 3792504, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/e1e342dc9ed03c2039e7cde0dab4214e?s=128&d=identicon&r=PG&f=1", "display_name": "TheCriticalImperitive", "link": "https://stackoverflow.com/users/3792504/thecriticalimperitive"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 442, "favorite_count": 1, "accepted_answer_id": 28927083, "answer_count": 1, "score": 1, "last_activity_date": 1425822047, "creation_date": 1425788081, "last_edit_date": 1425788589, "question_id": 28923006, "link": "https://stackoverflow.com/questions/28923006/isolate-a-single-value-from-a-nested-json-response-in-aeson", "title": "Isolate a single value from a nested JSON response in Aeson", "body": "<p>I'm working with a couple of JSON based APIs and the vast majority of the time I only need to extract a single value from the JSON response. E.g. with <code>{\"foo\":\"xyz\",\"bar\":\"0.0000012\"}</code> I only need the value of <code>bar</code>.</p>\n\n<p>To accommodate this I've written functions to extract the information I need:</p>\n\n<pre><code>-- | Isolate a Double based on a key from a JSON encoded ByteString\nisolateDouble :: String -&gt; B.ByteString -&gt; Maybe Double\nisolateDouble k bstr = isolateString k bstr &gt;&gt;= maybeRead\n\n-- | Isolate a String based on a key from a JSON encoded ByteString\nisolateString :: String -&gt; B.ByteString -&gt; Maybe String\nisolateString k bstr = decode bstr &gt;&gt;= parseMaybe (\\obj -&gt; obj .: pack k :: Parser String)\n</code></pre>\n\n<p>Unfortunately, one of the APIs sends the response like this:\n<code>{\"success\":\"true\",\"message\":\"\",\"result\":{\"foo\":\"xyz\",\"bar\":\"0.0000012\"}}</code></p>\n\n<p>Obviously passing that to <code>isolateDouble \"bar\"</code> results in <code>Nothing</code></p>\n\n<p>I think the last time I did this I wrote <code>fromJSON</code> instances for both levels of the response like so:</p>\n\n<pre><code>data Response = Response !Text !Text !Result\n\ninstance FromJSON Response where\n   parseJSON (Object v) = Response &lt;$&gt; v .: \"success\" &lt;*&gt; v .: \"message\" &lt;*&gt; v .: \"result\"\n   parseJSON _ = mzero\n\ndata Result = Result !Text !Text\n\ninstance FromJSON Result where\n   parseJSON (Object v) = Result &lt;$&gt; v .: \"foo\" &lt;*&gt; v .: \"bar\"\n   parseJSON _ = mzero\n</code></pre>\n\n<p>But then I would have to repeat that for dozens of different API calls. I know I can also use derive generics, but unfortunately some of the indexes in the JSON responses have clashing names like \"id\".</p>\n\n<p>Given all that, what would be the best way to isolate a single value from a nested JSON response?</p>\n"}, {"tags": ["scala", "haskell", "monads"], "comments": [{"owner": {"reputation": 64094, "user_id": 476408, "user_type": "registered", "accept_rate": 70, "profile_image": "https://www.gravatar.com/avatar/2bc1bffafe7aa29ef900b98d1fd1e94e?s=128&d=identicon&r=PG", "display_name": "J. Abrahamson", "link": "https://stackoverflow.com/users/476408/j-abrahamson"}, "edited": false, "score": 10, "creation_date": 1425787017, "post_id": 28922566, "comment_id": 46102781, "body": "Reminds me offhand of Swiestera&#39;s <a href=\"http://journals.cambridge.org/action/displayAbstract?fromPage=online&amp;aid=1899152\" rel=\"nofollow noreferrer\">Data Types a la Carte</a> which uses a type class prolog trick to slot effects into the right place in a stack."}, {"owner": {"reputation": 682, "user_id": 1202527, "user_type": "registered", "accept_rate": 83, "profile_image": "https://www.gravatar.com/avatar/eace1736cd5e31e6c5288e363ed669ea?s=128&d=identicon&r=PG", "display_name": "Brian", "link": "https://stackoverflow.com/users/1202527/brian"}, "edited": false, "score": 0, "creation_date": 1425837141, "post_id": 28922566, "comment_id": 46115440, "body": "This was the correct answer. This is what helped me: <a href=\"http://okmij.org/ftp/Haskell/extensible/ALaCarte.hs\" rel=\"nofollow noreferrer\">okmij.org/ftp/Haskell/extensible/ALaCarte.hs</a>   Thanks so much for leading me to the answer"}, {"owner": {"reputation": 84731, "user_id": 510937, "user_type": "registered", "accept_rate": 80, "profile_image": "https://www.gravatar.com/avatar/70b13a9ae1aae1ca1aa6ac8dab4643f2?s=128&d=identicon&r=PG", "display_name": "Bakuriu", "link": "https://stackoverflow.com/users/510937/bakuriu"}, "edited": false, "score": 1, "creation_date": 1440266375, "post_id": 28922566, "comment_id": 52206118, "body": "@Brian If you have solved your problem could you provide an answer to the question and accept it?"}, {"owner": {"reputation": 44013, "user_id": 1477667, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/trgKM.jpg?s=128&g=1", "display_name": "dfeuer", "link": "https://stackoverflow.com/users/1477667/dfeuer"}, "edited": false, "score": 0, "creation_date": 1502986756, "post_id": 28922566, "comment_id": 78438198, "body": "What do you mean by <code>Program :: Coproduct Interaction (Coproduct Auth Logging) a</code>? That&#39;s not a valid kind signature, nor the type of a data constructor. Is it supposed to be some newtype declaration?"}], "answers": [{"tags": [], "owner": {"reputation": 14853, "user_id": 380734, "user_type": "registered", "accept_rate": 81, "profile_image": "https://www.gravatar.com/avatar/a9d59056728e13c07fc6286b21eb9324?s=128&d=identicon&r=PG", "display_name": "Noel M", "link": "https://stackoverflow.com/users/380734/noel-m"}, "is_accepted": true, "score": 1, "last_activity_date": 1446155376, "creation_date": 1446155376, "answer_id": 33425225, "question_id": 28922566, "link": "https://stackoverflow.com/questions/28922566/interpreter-auto-selection-via-free-monad-and-coproduct/33425225#33425225", "title": "Interpreter auto-selection via Free Monad and Coproduct", "body": "<p><em>Filling out the answer section from the comments to the original question...</em></p>\n\n<p>The original Haskell paper can be found here: <a href=\"http://journals.cambridge.org/action/displayAbstract?fromPage=online&amp;aid=1899152\" rel=\"nofollow\">Data Types \u00e0 la Carte</a></p>\n\n<p>A Haskell implementation can be found here: <a href=\"http://okmij.org/ftp/Haskell/extensible/ALaCarte.hs\" rel=\"nofollow\">ALaCarte.hs</a></p>\n"}], "owner": {"reputation": 682, "user_id": 1202527, "user_type": "registered", "accept_rate": 83, "profile_image": "https://www.gravatar.com/avatar/eace1736cd5e31e6c5288e363ed669ea?s=128&d=identicon&r=PG", "display_name": "Brian", "link": "https://stackoverflow.com/users/1202527/brian"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 575, "favorite_count": 2, "accepted_answer_id": 33425225, "answer_count": 1, "score": 21, "last_activity_date": 1502973033, "creation_date": 1425783175, "last_edit_date": 1502973033, "question_id": 28922566, "link": "https://stackoverflow.com/questions/28922566/interpreter-auto-selection-via-free-monad-and-coproduct", "title": "Interpreter auto-selection via Free Monad and Coproduct", "body": "<p>I am playing with app architecture and free monads in haskell. I've got it down, except for how to lift my \"instruction\" into the correct slot of my coproduct without explicitly giving the full Left/Right path.</p>\n\n<p>Here's the haskell example I've been working from: <a href=\"https://gist.github.com/aaronlevin/87465696ba6c554bc72b#file-reasonable-hs\" rel=\"nofollow noreferrer\">https://gist.github.com/aaronlevin/87465696ba6c554bc72b#file-reasonable-hs</a></p>\n\n<p>Here, to inject types into the coproduct, we explicitly mention the path.</p>\n\n<p>For instance:</p>\n\n<pre><code>Program :: Coproduct Interaction (Coproduct Auth Logging) a\nlogC :: (Functor f) =&gt; (forall a. Logging a -&gt; f a) -&gt; String -&gt; Free f ()\n\nlogger :: String -&gt; Free Program ()\nlogger = logC (Program . Coproduct . Right . Coproduct . Right)\n</code></pre>\n\n<p>Here, logger has to be put in the right slot in the coproduct manually with <code>Coproduct . Right . Coproduct . Right</code></p>\n\n<p>Runar's talk in scala uses implicit type conversions and an Inject typeclass to achieve this result: <a href=\"https://gist.github.com/runarorama/a8fab38e473fafa0921d#file-gistfile1-scala-L119\" rel=\"nofollow noreferrer\">https://gist.github.com/runarorama/a8fab38e473fafa0921d#file-gistfile1-scala-L119</a></p>\n\n<p>In short, I'm wondering if there's a way to do this in haskell.</p>\n"}, {"tags": ["list", "sorting", "haskell"], "comments": [{"owner": {"reputation": 1050, "user_id": 2514756, "user_type": "registered", "accept_rate": 90, "profile_image": "https://i.stack.imgur.com/9TPkc.jpg?s=128&g=1", "display_name": "Ra1nWarden", "link": "https://stackoverflow.com/users/2514756/ra1nwarden"}, "edited": false, "score": 0, "creation_date": 1425782846, "post_id": 28922514, "comment_id": 46102087, "body": "Because it is trying to be stable."}, {"owner": {"reputation": 46235, "user_id": 2541573, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/Z1qtP.png?s=128&g=1", "display_name": "jub0bs", "link": "https://stackoverflow.com/users/2541573/jub0bs"}, "edited": false, "score": 2, "creation_date": 1425783109, "post_id": 28922514, "comment_id": 46102127, "body": "If you use <code>&lt;</code> instead of <code>&lt;=</code>, the resulting list will be an ascending version of the original list <i>but with all duplicates removed</i>. However, removing dupes is not what sorting is about."}, {"owner": {"reputation": 6557, "user_id": 2495795, "user_type": "registered", "accept_rate": 87, "profile_image": "https://www.gravatar.com/avatar/13606de0b736d7191e2cf2bfea1d4fda?s=128&d=identicon&r=PG", "display_name": "BufBills", "link": "https://stackoverflow.com/users/2495795/bufbills"}, "reply_to_user": {"reputation": 46235, "user_id": 2541573, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/Z1qtP.png?s=128&g=1", "display_name": "jub0bs", "link": "https://stackoverflow.com/users/2541573/jub0bs"}, "edited": false, "score": 0, "creation_date": 1425783383, "post_id": 28922514, "comment_id": 46102185, "body": "@Jubobs but,, is it keep including the &quot;x&quot;? I don&#39;t get that part. How to get rid of one each time."}, {"owner": {"reputation": 46235, "user_id": 2541573, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/Z1qtP.png?s=128&g=1", "display_name": "jub0bs", "link": "https://stackoverflow.com/users/2541573/jub0bs"}, "edited": false, "score": 0, "creation_date": 1425783544, "post_id": 28922514, "comment_id": 46102206, "body": "@BufBills Not sure what you mean... Sorting, strictly speaking, is not about dropping dupes; the resulting list should just be a sorted version of the list you pass to <code>quicksort</code>; the two lists should have the same length. By the way, you&#39;re missing a function call; it should be <code>quicksort smallerOrEqual ++ [x] ++ quicksort larger</code>"}, {"owner": {"reputation": 6557, "user_id": 2495795, "user_type": "registered", "accept_rate": 87, "profile_image": "https://www.gravatar.com/avatar/13606de0b736d7191e2cf2bfea1d4fda?s=128&d=identicon&r=PG", "display_name": "BufBills", "link": "https://stackoverflow.com/users/2495795/bufbills"}, "edited": false, "score": 0, "creation_date": 1425783637, "post_id": 28922514, "comment_id": 46102224, "body": "thanks Jubobs. I got it!"}], "answers": [{"comments": [{"owner": {"reputation": 46235, "user_id": 2541573, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/Z1qtP.png?s=128&g=1", "display_name": "jub0bs", "link": "https://stackoverflow.com/users/2541573/jub0bs"}, "edited": false, "score": 0, "creation_date": 1425784108, "post_id": 28922612, "comment_id": 46102313, "body": "You don&#39;t need those brackets: <code>quicksort smallerOrEqual ++ [x] ++ quicksort larger</code> works fine, because function application has higher precedence that the infix operator <code>++</code>."}, {"owner": {"reputation": 204954, "user_id": 1903116, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/w6Ffg.jpg?s=128&g=1", "display_name": "thefourtheye", "link": "https://stackoverflow.com/users/1903116/thefourtheye"}, "reply_to_user": {"reputation": 46235, "user_id": 2541573, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/Z1qtP.png?s=128&g=1", "display_name": "jub0bs", "link": "https://stackoverflow.com/users/2541573/jub0bs"}, "edited": false, "score": 0, "creation_date": 1425784149, "post_id": 28922612, "comment_id": 46102316, "body": "@Jubobs Yup, we don&#39;t need them. But it might help him understand the mistake, right? Anyway, I included the bracket-less version also now :)"}, {"owner": {"reputation": 100185, "user_id": 3234959, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/93bb12ca0f93dfddb33880316f7e66c2?s=128&d=identicon&r=PG&f=1", "display_name": "chi", "link": "https://stackoverflow.com/users/3234959/chi"}, "edited": false, "score": 2, "creation_date": 1425809109, "post_id": 28922612, "comment_id": 46106808, "body": "&quot;List of numbers smaller than or equal to the pivot element&quot; is a bit misleading, because it implies that it contains the pivot itself, which is then added again in point 2 hence leading to duplication. The crucial part is that this list is obtained as a filter over the tail <code>xs</code>, and not over the whole original list <code>x:xs</code>."}, {"owner": {"reputation": 204954, "user_id": 1903116, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/w6Ffg.jpg?s=128&g=1", "display_name": "thefourtheye", "link": "https://stackoverflow.com/users/1903116/thefourtheye"}, "reply_to_user": {"reputation": 100185, "user_id": 3234959, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/93bb12ca0f93dfddb33880316f7e66c2?s=128&d=identicon&r=PG&f=1", "display_name": "chi", "link": "https://stackoverflow.com/users/3234959/chi"}, "edited": false, "score": 0, "creation_date": 1425809451, "post_id": 28922612, "comment_id": 46106876, "body": "@chi You are right. I wanted to make exactly that point clearly. That is why I added those points. I edited them now. Please check if it is fine."}, {"owner": {"reputation": 100185, "user_id": 3234959, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/93bb12ca0f93dfddb33880316f7e66c2?s=128&d=identicon&r=PG&f=1", "display_name": "chi", "link": "https://stackoverflow.com/users/3234959/chi"}, "edited": false, "score": 0, "creation_date": 1425810622, "post_id": 28922612, "comment_id": 46107096, "body": "@thefourtheye Much better."}], "tags": [], "owner": {"reputation": 204954, "user_id": 1903116, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/w6Ffg.jpg?s=128&g=1", "display_name": "thefourtheye", "link": "https://stackoverflow.com/users/1903116/thefourtheye"}, "is_accepted": true, "score": 5, "last_activity_date": 1425809413, "last_edit_date": 1425809413, "creation_date": 1425783649, "answer_id": 28922612, "question_id": 28922514, "link": "https://stackoverflow.com/questions/28922514/haskell-quick-sort-why-the-first-let-uses-instead-of/28922612#28922612", "title": "haskell quick sort, why the first let uses &lt;= instead of &lt;?", "body": "<blockquote>\n  <p>I think &lt;= will duplicate that x many times</p>\n</blockquote>\n\n<p>No, it will not. Let us understand what exactly is happening here. You are basically partitioning your list into three parts.</p>\n\n<ol>\n<li><p>List of numbers smaller than or equal to the pivot element (excluding the first element, since that is the pivot element)</p></li>\n<li><p>The pivot element itself (the first element in the list)</p></li>\n<li><p>List of numbers greater than the pivot element</p></li>\n</ol>\n\n<p>So, in your case, the partitioned list becomes like this</p>\n\n<pre><code>[1, 4, 3] ++ [5] ++ [9, 6, 7]\n</code></pre>\n\n<p>Consider a case like this, <code>quicksort [5, 1, 5, 9, 8, 5, 3, 6, 4]</code>. Then, your program will partition it into something like this</p>\n\n<pre><code>smallerOrEqual ++ [x] ++ larger\n</code></pre>\n\n<p>Since <code>smallerOrEqual</code> and <code>larger</code> work with <code>xs</code>, which doesn't have the <code>x</code>, there is no duplication as such. Now, the partitioned list, after the filtering, becomes</p>\n\n<pre><code>[1, 5, 5, 3, 4] ++ [5] ++ [9, 8, 6]\n</code></pre>\n\n<p>See? There is no duplication, just partitioning.</p>\n\n<p><strong>Note:</strong> Your program has a serious bug. Check this line</p>\n\n<pre><code>quicksort smallerOrEqual ++ [x] ++ larger\n</code></pre>\n\n<p>It basically works like this</p>\n\n<pre><code>(quicksort smallerOrEqual) ++ [x] ++ larger\n</code></pre>\n\n<p>So, the <code>larger</code> list is never sorted. You recursively have to sort both the smaller list and the greater list and finally merge them in to one. So, it should have been</p>\n\n<pre><code>(quicksort smallerOrEqual) ++ [x] ++ (quicksort larger)\n</code></pre>\n\n<p>which can be written without the brackets like this</p>\n\n<pre><code>quicksort smallerOrEqual ++ [x] ++ quicksort larger\n</code></pre>\n"}], "owner": {"reputation": 6557, "user_id": 2495795, "user_type": "registered", "accept_rate": 87, "profile_image": "https://www.gravatar.com/avatar/13606de0b736d7191e2cf2bfea1d4fda?s=128&d=identicon&r=PG", "display_name": "BufBills", "link": "https://stackoverflow.com/users/2495795/bufbills"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 244, "favorite_count": 0, "accepted_answer_id": 28922612, "answer_count": 1, "score": 3, "last_activity_date": 1425816542, "creation_date": 1425782720, "last_edit_date": 1425816542, "question_id": 28922514, "link": "https://stackoverflow.com/questions/28922514/haskell-quick-sort-why-the-first-let-uses-instead-of", "title": "haskell quick sort, why the first let uses &lt;= instead of &lt;?", "body": "<pre><code>quicksort :: (Ord a) =&gt; [a] -&gt; [a]\nquicksort [] = []\nquicksort (x:xs) =\n    let smallerOrEqual = [a | a &lt;- xs, a &lt;= x]\n        larger = [a | a &lt;- xs, a &gt; x]\n    in quicksort smallerOrEqual ++ [x] ++ larger\n\nmain = do\n    let a = [ 5, 1, 9, 4, 6, 7, 3]\n    print  $ quicksort a\n</code></pre>\n\n<p>in Haskell quick sort, why the first <code>let</code> uses <code>&lt;=</code> instead of <code>&lt;</code>? I think <code>&lt;=</code> will duplicate that <code>x</code> many times. Why not?</p>\n"}, {"tags": ["haskell"], "answers": [{"tags": [], "owner": {"reputation": 339851, "user_id": 149392, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/7a561ec0875fcbbe3066ea8fe288ec77?s=128&d=identicon&r=PG", "display_name": "sepp2k", "link": "https://stackoverflow.com/users/149392/sepp2k"}, "is_accepted": true, "score": 16, "last_activity_date": 1425769216, "creation_date": 1425769216, "answer_id": 28921073, "question_id": 28920994, "link": "https://stackoverflow.com/questions/28920994/why-does-ghc-say-that-these-two-types-are-different-how-can-i-get-them-to-be-th/28921073#28921073", "title": "Why does GHC say that these two types are different? How can I get them to be the same?", "body": "<p>Your definition of the type class makes no restrictions on what <code>b</code> can be, meaning that the user should be allowed to pick any type for <code>b</code> he wants. Of course your instance definition does not allow that, which is why it is rejected.</p>\n\n<p>What you want to say is \"a is parametrized over a type b, and that's the type b that I want to use\". And here's how you say that:</p>\n\n<pre><code>class Query a where\n  filter  :: a b -&gt; (b -&gt; Bool) -&gt; [b]\n</code></pre>\n\n<p>And then you write <code>instance Query Segment</code> rather than <code>instance Query (Segment t)</code> because the <code>a</code> in the type class definition now just stands for <code>Segment</code> and the <code>b</code> stands for <code>t</code>.</p>\n"}], "owner": {"reputation": 8238, "user_id": 116154, "user_type": "registered", "accept_rate": 91, "profile_image": "https://www.gravatar.com/avatar/67e3cdb502d7abded72424b29683b1b3?s=128&d=identicon&r=PG", "display_name": "Christopher", "link": "https://stackoverflow.com/users/116154/christopher"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 135, "favorite_count": 0, "accepted_answer_id": 28921073, "answer_count": 1, "score": 4, "last_activity_date": 1425769216, "creation_date": 1425768656, "question_id": 28920994, "link": "https://stackoverflow.com/questions/28920994/why-does-ghc-say-that-these-two-types-are-different-how-can-i-get-them-to-be-th", "title": "Why does GHC say that these two types are different? How can I get them to be the same?", "body": "<p>I have defined a class:</p>\n\n<pre><code>class Query a where\n  filter  :: a -&gt; (b -&gt; Bool) -&gt; [b]\n  ifilter :: a -&gt; (b -&gt; Bool) -&gt; [(b, Int64)]\n</code></pre>\n\n<p>And I have a user defined type:</p>\n\n<pre><code>data Segment a = Segment {\n  extents :: [Extent],\n  array   :: [a]\n} deriving(Eq, Show)\n</code></pre>\n\n<p>Finally, I have tried to make Segment an instance of Query:</p>\n\n<pre><code>instance Query (Segment a) where\n  filter  = filterSegment\n  ifilter = ifilterSegment\n</code></pre>\n\n<p>The functions filter and ifilter both take a (Segment a) and a function (a->Bool) and return either [a] or [(a,Int64)].</p>\n\n<p>However, I get the following errors:</p>\n\n<pre><code>Couldn't match type `a' with `b'\n      `a' is a rigid type variable bound by\n          the instance declaration at src/Store/DataColumn.hs:19:10\n      `b' is a rigid type variable bound by\n          the type signature for filter :: Segment a -&gt; (b -&gt; Bool) -&gt; [b]\n          at src/Store/DataColumn.hs:20:3\n    Expected type: Segment a -&gt; (b -&gt; Bool) -&gt; [b]\n      Actual type: Segment a -&gt; (a -&gt; Bool) -&gt; [a]\n    In the expression: filterSegment\n    In an equation for `filter': filter = filterSegment\n    In the instance declaration for `Query (Segment a)'\n\nCouldn't match type `a' with `b'\n      `a' is a rigid type variable bound by\n          the instance declaration at src/Store/DataColumn.hs:19:10\n      `b' is a rigid type variable bound by\n          the type signature for\n            ifilter :: Segment a -&gt; (b -&gt; Bool) -&gt; [(b, Int64)]\n          at src/Store/DataColumn.hs:21:3\n    Expected type: Segment a -&gt; (b -&gt; Bool) -&gt; [(b, Int64)]\n      Actual type: Segment a -&gt; (a -&gt; Bool) -&gt; [(a, Int64)]\n    In the expression: ifilterSegment\n    In an equation for `ifilter': ifilter = ifilterSegment\n    In the instance declaration for `Query (Segment a)'\n</code></pre>\n\n<p>I'm not really sure what I'm missing here. I do want the 'a' from (Segment a) to be same 'a' in (a->Bool), [a], and [(a, Int64)]. However, I can't figure out how to do that. Any help would be appreciated.  </p>\n"}, {"tags": ["haskell"], "comments": [{"owner": {"reputation": 10378, "user_id": 2476735, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/39e9447bbc32246fcd23b76b5e946618?s=128&d=identicon&r=PG&f=1", "display_name": "David Young", "link": "https://stackoverflow.com/users/2476735/david-young"}, "edited": false, "score": 2, "creation_date": 1425767348, "post_id": 28920631, "comment_id": 46098898, "body": "The problem is that <code>sortBy (compare . reverse)</code> doesn&#39;t always put equivalent strings next to each other. The result of <code>sortBy (compare . reverse)  $ permutations [&#39;a&#39;..&#39;c&#39;]</code> is <code>[&quot;acb&quot;,&quot;bac&quot;,&quot;abc&quot;,&quot;cba&quot;,&quot;bca&quot;,&quot;cab&quot;]</code>. I <i>think</i> this means that the transitive property of a partial order is violated."}, {"owner": {"reputation": 100185, "user_id": 3234959, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/93bb12ca0f93dfddb33880316f7e66c2?s=128&d=identicon&r=PG&f=1", "display_name": "chi", "link": "https://stackoverflow.com/users/3234959/chi"}, "edited": false, "score": 3, "creation_date": 1425771970, "post_id": 28920631, "comment_id": 46100112, "body": "<code>sortBy x</code> requires <code>x</code> to be an ordering relation (a total order, according to the <a href=\"http://hackage.haskell.org/package/base-4.7.0.2/docs/Data-List.html#v:sortBy\" rel=\"nofollow noreferrer\">docs</a>). <code>compare . reverse</code> is not even transitive."}, {"owner": {"reputation": 100185, "user_id": 3234959, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/93bb12ca0f93dfddb33880316f7e66c2?s=128&d=identicon&r=PG&f=1", "display_name": "chi", "link": "https://stackoverflow.com/users/3234959/chi"}, "edited": false, "score": 3, "creation_date": 1425772280, "post_id": 28920631, "comment_id": 46100174, "body": "What about using <code>intersect ss (map reverse ss)</code>? I&#39;d optimize this writing my own variant of <code>intersect</code> exploiting <code>Ord</code> (or passing through <code>Data.Set</code> is I felt lazy). The library <code>intersect</code> is only O(n^2), so we can improve on that."}, {"owner": {"reputation": 46235, "user_id": 2541573, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/Z1qtP.png?s=128&g=1", "display_name": "jub0bs", "link": "https://stackoverflow.com/users/2541573/jub0bs"}, "edited": false, "score": 0, "creation_date": 1425784404, "post_id": 28920631, "comment_id": 46102353, "body": "@sof As chi wrote, you should use another data structure than a list, for better efficiency."}, {"owner": {"reputation": 13362, "user_id": 260584, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/63f9744d1d903eef5f9954fa31d25a26?s=128&d=identicon&r=PG", "display_name": "erisco", "link": "https://stackoverflow.com/users/260584/erisco"}, "edited": false, "score": 0, "creation_date": 1425792705, "post_id": 28920631, "comment_id": 46103567, "body": "Is &quot;race&quot; and &quot;car&quot; a palindromic word pair?"}, {"owner": {"reputation": 7193, "user_id": 363663, "user_type": "registered", "accept_rate": 71, "profile_image": "https://www.gravatar.com/avatar/c59cd40f0edcd3feea80c7ca09bc8e76?s=128&d=identicon&r=PG", "display_name": "sof", "link": "https://stackoverflow.com/users/363663/sof"}, "edited": false, "score": 0, "creation_date": 1425793125, "post_id": 28920631, "comment_id": 46103625, "body": "No, not in this case. But it&#39;s just a hypothetical problem of mine as said at the beginning."}, {"owner": {"reputation": 46235, "user_id": 2541573, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/Z1qtP.png?s=128&g=1", "display_name": "jub0bs", "link": "https://stackoverflow.com/users/2541573/jub0bs"}, "edited": false, "score": 0, "creation_date": 1425832309, "post_id": 28920631, "comment_id": 46113545, "body": "@sof The &quot;tuned working code&quot; should go in an answer, not in the question. Also, you&#39;re reversing words more than needed; you could do better."}], "answers": [{"comments": [{"owner": {"reputation": 7193, "user_id": 363663, "user_type": "registered", "accept_rate": 71, "profile_image": "https://www.gravatar.com/avatar/c59cd40f0edcd3feea80c7ca09bc8e76?s=128&d=identicon&r=PG", "display_name": "sof", "link": "https://stackoverflow.com/users/363663/sof"}, "edited": false, "score": 0, "creation_date": 1425834921, "post_id": 28928949, "comment_id": 46114621, "body": "Thanks, your using built-in constructs seems order of magnitude more performant than my own handcraft."}], "tags": [], "owner": {"reputation": 94553, "user_id": 775806, "user_type": "registered", "accept_rate": 96, "profile_image": "https://i.stack.imgur.com/XNd2C.png?s=128&g=1", "display_name": "n. &#39;pronouns&#39; m.", "link": "https://stackoverflow.com/users/775806/n-pronouns-m"}, "is_accepted": true, "score": 2, "last_activity_date": 1425832424, "creation_date": 1425832424, "answer_id": 28928949, "question_id": 28920631, "link": "https://stackoverflow.com/questions/28920631/finding-all-palindromic-word-pairs/28928949#28928949", "title": "Finding all palindromic word pairs", "body": "<pre><code>import Data.List\nimport Data.Ord\n\n-- find classes of equivalence by comparing canonical forms (CF)\nfindEquivalentSets :: Ord b =&gt; (a-&gt;b) -&gt; [a] -&gt; [[a]]\nfindEquivalentSets toCanonical =\n\n      filter ((&gt;=2) . length)                            -- has more than one\n                                                         -- with the same CF?\n\n    . groupBy ((((== EQ) .) .) (comparing toCanonical))  -- group by CF\n\n    . sortBy (comparing toCanonical)                     -- compare CFs\n\nfindPalindromes :: Ord a =&gt; [[a]] -&gt; [[[a]]]\nfindPalindromes = findEquivalentSets (\\x -&gt; min x (reverse x))\n</code></pre>\n\n<p>This function lets us find many kinds of equivalence as long as we can assign some effectively computable canonical form (CF) to our elements.</p>\n\n<p>When looking for palindromic pairs, two strings are equivalent if one is a reverse of the other. The CF is the lexicographically smaller string.</p>\n\n<pre><code>findAnagrams :: Ord a =&gt; [[a]] -&gt; [[[a]]]\nfindAnagrams = findEquivalentSets sort\n</code></pre>\n\n<p>In this example, two strings are equivalent if one is an anagram of the other. The CF is the sorted string (banana \u2192 aaabnn).</p>\n\n<p>Likewise we can find SOUNDEX equivalents and whatnot.</p>\n\n<p>This is not terribly efficient as one needs to compute the CF on each comparison. We can cache it, at the expense of readability.</p>\n\n<pre><code>findEquivalentSets :: Ord b =&gt; (a-&gt;b) -&gt; [a] -&gt; [[a]]\nfindEquivalentSets toCanonical =\n\n          map (map fst)                               -- strip CF\n\n        . filter ((&gt;=2) . length)                     -- has more than one\n                                                      -- with the same CF?\n\n        . groupBy ((((== EQ) .) .) (comparing snd))   -- group by CF\n\n        . sortBy (comparing snd)                      -- compare CFs\n\n        . map (\\x -&gt; (x, toCanonical x))              -- pair the element with its CF\n</code></pre>\n"}, {"comments": [{"owner": {"reputation": 7193, "user_id": 363663, "user_type": "registered", "accept_rate": 71, "profile_image": "https://www.gravatar.com/avatar/c59cd40f0edcd3feea80c7ca09bc8e76?s=128&d=identicon&r=PG", "display_name": "sof", "link": "https://stackoverflow.com/users/363663/sof"}, "edited": false, "score": 0, "creation_date": 1425923237, "post_id": 28934712, "comment_id": 46150968, "body": "Thanks for the enlightening pivot idea in clear text."}], "tags": [], "owner": {"reputation": 29579, "user_id": 3525, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/c3ae6a1b8d708b79b6b85ecc365266a4?s=128&d=identicon&r=PG", "display_name": "joel.neely", "link": "https://stackoverflow.com/users/3525/joel-neely"}, "is_accepted": false, "score": 1, "last_activity_date": 1425905398, "last_edit_date": 1425905398, "creation_date": 1425870656, "answer_id": 28934712, "question_id": 28920631, "link": "https://stackoverflow.com/questions/28920631/finding-all-palindromic-word-pairs/28934712#28934712", "title": "Finding all palindromic word pairs", "body": "<p>Here's an approach you might want to consider.</p>\n\n<p>Using <code>sort</code> implies that there's some keying function <code>word2key</code> that yields the same value for both words of a palindromic pair. The first one that comes to mind for me is</p>\n\n<pre><code>word2key w = min w (reverse w)\n</code></pre>\n\n<p>So, map the keying function over the list of words, sort, group by equality, take groups of length 2, and then recover the two words from the key (using the fact that the key is either equal to the word or its reverse.</p>\n\n<p>Writing that, with a couple of local definitions for clarity, gives:</p>\n\n<pre><code>findPals :: (Ord a, Eq a) =&gt; [[a]] -&gt; [[[a]]]\nfindPals = map (key2words . head) .\n           filter ((== 2) . length) .\n           groupBy (==) .\n           sort .\n           (map word2key)\n  where word2key w = min w (reverse w)\n        key2words k = [k, reverse k]\n</code></pre>\n\n<p><strong>Edit:</strong></p>\n\n<p>I posted my answer in a stale window without refreshing, so missed the very nice response from n.m. above.</p>\n\n<p><em>Mea culpa</em>.</p>\n\n<p>So I'll atone by mentioning that both answers are variations on the well-known (in Perl circles) \"<a href=\"http://en.wikipedia.org/wiki/Schwartzian_transform\" rel=\"nofollow\">Schwartzian transform</a>\" which itself applies a common Mathematical pattern -- <code>h = f' . g . f</code> -- translate a task to an alternate representation in which the task is easier, do the work, then translate back to the original representation.</p>\n\n<p>The Schwartzian transform tuples up a value with its corresponding key, sorts by the key, then pulls the original value back out of the key/value tuple.</p>\n\n<p>The little hack I included above was based on the fact that <code>key2words</code> is the non-deterministic inverse relation of <code>word2key</code>. It is only valid when two words have the same key, but that's exactly the case in the question, and is insured by the <code>filter</code>.</p>\n\n<pre><code>overAndBack :: (Ord b, Eq c) =&gt; (a -&gt; b) -&gt; ([b] -&gt; [c]) -&gt; (c -&gt; d) -&gt; [a] -&gt; [d]\noverAndBack f g f' = map f' . g . sort . map f\n\nfindPalPairs :: (Ord a, Eq a) =&gt; [[a]] -&gt; [[[a]]]\nfindPalPairs = overAndBack over just2 back\n  where over w = min w (reverse w)\n        just2  = filter ((== 2) . length) . groupBy (==)\n        back   = (\\k -&gt; [k, reverse k]) . head\n</code></pre>\n\n<p>Which demos as</p>\n\n<pre><code>*Main&gt; findPalPairs $ words \"I saw no cat was on a chair\"\n[[\"no\",\"on\"],[\"saw\",\"was\"]]\n</code></pre>\n\n<p>Thanks for the nice question.</p>\n"}], "owner": {"reputation": 7193, "user_id": 363663, "user_type": "registered", "accept_rate": 71, "profile_image": "https://www.gravatar.com/avatar/c59cd40f0edcd3feea80c7ca09bc8e76?s=128&d=identicon&r=PG", "display_name": "sof", "link": "https://stackoverflow.com/users/363663/sof"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 391, "favorite_count": 0, "accepted_answer_id": 28928949, "answer_count": 2, "score": 0, "last_activity_date": 1426088313, "creation_date": 1425766341, "last_edit_date": 1426088313, "question_id": 28920631, "link": "https://stackoverflow.com/questions/28920631/finding-all-palindromic-word-pairs", "title": "Finding all palindromic word pairs", "body": "<p>I came up with an unreal problem: finding all palindromic word pairs in a vocabulary, so I wrote the solution below,</p>\n\n<pre class=\"lang-hs prettyprint-override\"><code>import Data.List\n\nfindParis :: Ord a =&gt; [[a]] -&gt; [[[a]]]\n\nfindPairs ss =\n  filter ((== 2) . length) \n    . groupBy ((==) . reverse) \n    . sortBy (compare . reverse) \n    $ ss\n\nmain = do\n  print . findPairs . permutations $ ['a'..'c'] \n\n-- malfunctioning: only got partial results [[\"abc\",\"cba\"]]\n-- expected: [[\"abc\",\"cba\"],[\"bac\",\"cab\"],[\"bca\",\"acb\"]]\n</code></pre>\n\n<p>Could you help correct it if worthy of trying? </p>\n\n<p><strong>@Solution</strong></p>\n\n<p>Having benefited from <code>@David Young @chi</code> comments the tuned working code goes below, </p>\n\n<pre class=\"lang-hs prettyprint-override\"><code>import Data.List (delete)\nimport Data.Set hiding (delete, map)\n\nfindPairs :: Ord a =&gt; [[a]] -&gt; [([a], [a])]\n\nfindPairs ss =\n  let\n    f [] = []\n    f (x : xs) =\n      let y = reverse x\n      in\n        if x /= y\n        then\n          let ss' = delete y xs\n          in (x, y) : f ss'\n        else f xs\n  in\n    f . toList\n      . intersection (fromList ss)\n      $ fromList (map reverse ss)\n</code></pre>\n"}, {"tags": ["haskell", "frp", "netwire"], "comments": [{"owner": {"reputation": 23444, "user_id": 414413, "user_type": "registered", "accept_rate": 79, "profile_image": "https://www.gravatar.com/avatar/6de2113f01432aa844dc85070ff33e89?s=128&d=identicon&r=PG", "display_name": "Cirdec", "link": "https://stackoverflow.com/users/414413/cirdec"}, "edited": false, "score": 0, "creation_date": 1425776082, "post_id": 28918915, "comment_id": 46100919, "body": "I don&#39;t think this is possible with netwire or any of the other modern FRP libraries. These libraries make a concerted effort to avoid time and space leaks by avoiding providing a <code>Monad</code> instance or anything equivalent. This means that it is not in general possible to turn a <code>Wire ... (Wire ... a)</code> into a <code>Wire a</code>."}], "answers": [{"tags": [], "owner": {"reputation": 2567, "user_id": 994206, "user_type": "registered", "accept_rate": 84, "profile_image": "https://www.gravatar.com/avatar/699bacad8f85a069dda312cc29e03baa?s=128&d=identicon&r=PG", "display_name": "Mokosha", "link": "https://stackoverflow.com/users/994206/mokosha"}, "is_accepted": true, "score": 2, "last_activity_date": 1425785519, "last_edit_date": 1425785519, "creation_date": 1425776061, "answer_id": 28921902, "question_id": 28918915, "link": "https://stackoverflow.com/questions/28918915/haskell-netwire-wires-of-wires/28921902#28921902", "title": "Haskell Netwire: wires of wires", "body": "<p>The problem is that the wires generated from the events are not persistent. A given value of type <code>Wire s e m a b</code> is actually an <em>instance in time</em> of a function that produces a value of type <code>b</code> from a value of type <code>a</code>. Since Haskell uses immutable values, in order to step wires, you have to do something with the resulting wire from <code>stepWire</code> otherwise you get the same output for the same input. Take a look at the results from <code>myList</code>:</p>\n\n<pre><code>Event 1: [for 10 . pure 0 --&gt; pure 0]\nEvent 2: [for 10 . pure 5 --&gt; pure 0, for 10 . pure 0 --&gt; pure 0]\nEvent 3: [for 10 . pure 10 --&gt; pure 0, for 10 . pure 5 --&gt; pure 0, for 10 . pure 0 --&gt; pure 0]\n... etc\n</code></pre>\n\n<p>When you step each of these wires, you're only going to get <code>[.., 10, 5, 0]</code> every time because you're reusing the original value of the <code>for 10 . pure x --&gt; pure 0</code> wire. Look at the signature for <code>stepWire</code>:</p>\n\n<pre><code>stepWire :: Monad m =&gt; Wire s e m a b -&gt; s -&gt; Either e a -&gt; m (Either e b, Wire s e m a b)\n</code></pre>\n\n<p>This means that for a statement such as</p>\n\n<pre><code>(result, w') &lt;- stepWire w dt (Right underfined)\n</code></pre>\n\n<p>... the <code>w'</code> should be used the next time you need to call <code>stepWire</code>, because it is the behavior at the next instance in time. If you have a wire that produces wires, then you need to offload the produced wires somewhere so that they can be processed separately.</p>\n\n<p>For a program that (I believe) gives you the behavior you want, please refer to <a href=\"https://gist.github.com/Mokosha/6a78c84a26971251c771\" rel=\"nofollow\">this code</a>.</p>\n\n<pre><code>$ ghc -o test test.hs\n[1 of 1] Compiling Main             ( test.hs, test.o )\nLinking test ...\n$ ./test\n[0]\n[5,0]\n[10,5,0]\n[15,10,0,0]\n[20,15,0,0,0]\n...\n</code></pre>\n"}, {"tags": [], "owner": {"reputation": 23444, "user_id": 414413, "user_type": "registered", "accept_rate": 79, "profile_image": "https://www.gravatar.com/avatar/6de2113f01432aa844dc85070ff33e89?s=128&d=identicon&r=PG", "display_name": "Cirdec", "link": "https://stackoverflow.com/users/414413/cirdec"}, "is_accepted": false, "score": 2, "last_activity_date": 1425779318, "last_edit_date": 1495539820, "creation_date": 1425779318, "answer_id": 28922218, "question_id": 28918915, "link": "https://stackoverflow.com/questions/28918915/haskell-netwire-wires-of-wires/28922218#28922218", "title": "Haskell Netwire: wires of wires", "body": "<p>As <a href=\"https://stackoverflow.com/a/28921902/414413\">Mokosha suggested</a>, we can keep the state of the wires we already know about from previous events and introduce the wires from the newest event. For example, if we already know about no events, and get a list with one wire in it, we should use the new wire.</p>\n\n<pre><code>      [] -- we already know about\nw0' : [] -- we got as input\nw0' : [] -- what we should keep\n</code></pre>\n\n<p>If we already know about a wire or wires and find out about even more wires, we need to keep the wires we already know about and add the new wires we just found out about.</p>\n\n<pre><code>            w2  : w1  : w0  : [] -- we already know about\nw4' : w3' : w2' : w1' : w0' : [] -- we got as input\nw4' : w3' : w2  : w1  : w0  : [] -- what we should keep\n</code></pre>\n\n<p>This is easier to define from the front end of the list. The first argument will be a prefix of the result. If there are any of the second argument left over, we'll add them to the end of the list.</p>\n\n<pre><code>makePrefixOf :: [a] -&gt; [a] -&gt; [a]\nmakePrefixOf [] ys = ys\nmakePrefixOf xs [] = xs\nmakePrefixOf (x:xs) (_:ys) = x:makePrefixOf xs ys\n</code></pre>\n\n<p>We can define the same thing for the back end of a list by reversing the inputs and the outputs. The first argument will be a suffix of the result, if there are any extra of the second agument, they are added to the front of the list.</p>\n\n<pre><code>makeSuffixOf :: [a] -&gt; [a] -&gt; [a]\nmakeSuffixOf xs ys = reverse $ makePrefixOf (reverse xs) (reverse ys)\n</code></pre>\n\n<p>Now we can implement <code>myNums</code> keeping track of which <code>oldWires</code> we already have state for.</p>\n\n<pre><code>myNums :: (Monad m, HasTime t s) =&gt; Wire s () m [Wire s () m a b] [b]\nmyNums = go []\n  where\n    go oldWires = mkGen $ \\dt newWires -&gt; do\n        let wires = makeSuffixOf oldWires newWires\n        stepped &lt;- mapM (\\w -&gt; stepWire w dt $ Right undefined) wires\n        let alive = [ (r, w) | (Right r, w) &lt;- stepped ]\n        return (Right (map fst alive), go (map snd alive))\n</code></pre>\n\n<p>If we want to be pedantic, we should use a list of <code>Maybe</code> wires so that when the wire is no longer alive we can leave behind a <code>Nothing</code> in its place so that the lists of wires still match up. If we do this, even with a clever representation for the state, we will leak space when wires die. Their original definition will still be hanging around in the list being accumulated by <code>eventList</code>.</p>\n\n<p>This gives the desired output of</p>\n\n<pre><code>            [ 0]\n         [ 5, 0]\n      [10, 5, 0]\n   [15,10, 0, 0]\n[20,15, 0, 0, 0]\n</code></pre>\n"}], "owner": {"reputation": 7504, "user_id": 154744, "user_type": "registered", "accept_rate": 80, "profile_image": "https://www.gravatar.com/avatar/acb0a7915c4da197560413a262d31b18?s=128&d=identicon&r=PG", "display_name": "bstamour", "link": "https://stackoverflow.com/users/154744/bstamour"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 377, "favorite_count": 1, "accepted_answer_id": 28921902, "answer_count": 2, "score": 4, "last_activity_date": 1425785519, "creation_date": 1425755837, "question_id": 28918915, "link": "https://stackoverflow.com/questions/28918915/haskell-netwire-wires-of-wires", "title": "Haskell Netwire: wires of wires", "body": "<p>I'm playing around with the netwire package trying to get a feel for FRP, and I have a quick question.</p>\n\n<p>Starting with the following simple wires, I'm able to emit an event every 5 seconds (approx)</p>\n\n<pre><code>myWire :: (Monad m, HasTime t s) =&gt; Wire s () m a Float\nmyWire = timeF\n\nmyWire' :: (Monad m, HasTime t s) =&gt; Wire s () m a Int\nmyWire' = fmap round myWire\n\nmyEvent :: (Monad m, HasTime t s) =&gt; Wire s () m a (Event Int)\nmyEvent = periodic 5 . myWire'\n</code></pre>\n\n<p>This is pretty nice and straight forward, but what I want to do next is map each event produced to a wire, that I can then watch update. I have an accumulator function like the following:</p>\n\n<pre><code>eventList :: (Monad m, HasTime t s) \n            =&gt; Wire s () m a (Event [Wire s () m a Int])\neventList = accumE go [] . myEvent\n  where go soFar x = f x : soFar\n        f x = for 10 . pure x --&gt; pure 0\n</code></pre>\n\n<p>I then introduce a new wire that will inhibit until the <code>eventList</code> starts triggering events, like so:</p>\n\n<pre><code>myList :: (Monad m, HasTime t s) =&gt; Wire s () m a [Wire s () m a Int]\nmyList = asSoonAs . eventList\n</code></pre>\n\n<p>So I've gone from events to a wire containing a list of wires. Finally, I introduce a wire to step each of these wires and produce a list of results:</p>\n\n<pre><code>myNums :: (Monad m, HasTime t s) =&gt; Wire s () m [Wire s () m a Int] [Int]\nmyNums = mkGen $ \\dt wires -&gt; do\n  stepped &lt;- mapM (\\w -&gt; stepWire w dt $ Right undefined) wires\n  let alive = [ (r, w) | (Right r, w) &lt;- stepped ]\n  return (Right (map fst alive), myNums)\n\nmyNumList :: (Monad m, HasTime t s) =&gt; Wire s () m a [Int]\nmyNumList = myNums . myList\n</code></pre>\n\n<p>And finally, I have my main routine to test it all out:</p>\n\n<pre><code>main = testWire clockSession_ myNumList\n</code></pre>\n\n<p>What I expect to see is a growing list, where each element in the list will show it's creation time for 10 seconds, after which the element will show a zero. What I'm getting instead is a growing list of static values. For example, what I expect to see after a few steps is</p>\n\n<pre><code>[0]\n[5, 0]\n[10, 5, 0]\n[15, 10, 0, 0]\n</code></pre>\n\n<p>and so on. What I'm actually seeing is</p>\n\n<pre><code>[0]\n[5, 0]\n[10, 5, 0]\n[15, 10, 5, 0]\n</code></pre>\n\n<p>So I know my accumulator function is working: every event created is being converted into a wire. But what I'm not seeing are these wires emitting different values over time. My statement <code>for 10 . pure x --&gt; pure 0</code> should be switching them over to emitting 0 after the time has elapsed.</p>\n\n<p>I am still new to FRP, so I may be fundamentally misunderstanding something important about it (probably the case.)</p>\n"}, {"tags": ["haskell"], "comments": [{"owner": {"reputation": 9485, "user_id": 20371, "user_type": "registered", "accept_rate": 88, "profile_image": "https://www.gravatar.com/avatar/32c7a412ad0caf812ae974df5eb8ffcd?s=128&d=identicon&r=PG", "display_name": "Yawar", "link": "https://stackoverflow.com/users/20371/yawar"}, "edited": false, "score": 3, "creation_date": 1425751452, "post_id": 28918173, "comment_id": 46093948, "body": "Yeah, use a <code>let</code> or <code>where</code> clause in the definition of <code>myLength</code>."}, {"owner": {"reputation": 2179, "user_id": 412549, "user_type": "registered", "accept_rate": 50, "profile_image": "https://www.gravatar.com/avatar/a194a155579e30bda0926705aeb9d165?s=128&d=identicon&r=PG&f=1", "display_name": "Franky", "link": "https://stackoverflow.com/users/412549/franky"}, "edited": false, "score": 1, "creation_date": 1425752977, "post_id": 28918173, "comment_id": 46094471, "body": "<code>innerLength xs n+1</code> is parsed as <code>(innerLength xs n)+1</code>, this is <i>not</i> tail-recursive."}, {"owner": {"reputation": 100185, "user_id": 3234959, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/93bb12ca0f93dfddb33880316f7e66c2?s=128&d=identicon&r=PG&f=1", "display_name": "chi", "link": "https://stackoverflow.com/users/3234959/chi"}, "reply_to_user": {"reputation": 2179, "user_id": 412549, "user_type": "registered", "accept_rate": 50, "profile_image": "https://www.gravatar.com/avatar/a194a155579e30bda0926705aeb9d165?s=128&d=identicon&r=PG&f=1", "display_name": "Franky", "link": "https://stackoverflow.com/users/412549/franky"}, "edited": false, "score": 0, "creation_date": 1425753219, "post_id": 28918173, "comment_id": 46094547, "body": "What @Franky says, moreover <code>innerLength [] _ = 0</code> throws away the accumulator instead of returning it. It should be <code>innerLength [] n = n</code>. I&#39;d also be tempted to use strict application in the recursive case e.g. <code>innerLength (_:xs) n = innerLength xs $! n+1</code>"}, {"owner": {"reputation": 549, "user_id": 4396823, "user_type": "registered", "accept_rate": 83, "profile_image": "https://www.gravatar.com/avatar/e7493ed20de304e4d88666ff6977ae33?s=128&d=identicon&r=PG&f=1", "display_name": "Steve", "link": "https://stackoverflow.com/users/4396823/steve"}, "reply_to_user": {"reputation": 2179, "user_id": 412549, "user_type": "registered", "accept_rate": 50, "profile_image": "https://www.gravatar.com/avatar/a194a155579e30bda0926705aeb9d165?s=128&d=identicon&r=PG&f=1", "display_name": "Franky", "link": "https://stackoverflow.com/users/412549/franky"}, "edited": false, "score": 0, "creation_date": 1425759310, "post_id": 28918173, "comment_id": 46096517, "body": "@Franky Thanks for pointing that out. That seems to be a constant headache for me with haskell."}], "answers": [{"comments": [{"owner": {"reputation": 1650, "user_id": 1292223, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/98458fe74447603906e51a6f74039c4a?s=128&d=identicon&r=PG", "display_name": "kini", "link": "https://stackoverflow.com/users/1292223/kini"}, "edited": false, "score": 0, "creation_date": 1425752664, "post_id": 28918352, "comment_id": 46094369, "body": "Well, <code>innerLength [] n = n</code>, really."}, {"owner": {"reputation": 1367, "user_id": 1160885, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/dc61c1b2045efa54375188bdb6a33945?s=128&d=identicon&r=PG", "display_name": "Jedai", "link": "https://stackoverflow.com/users/1160885/jedai"}, "edited": false, "score": 2, "creation_date": 1425755705, "post_id": 28918352, "comment_id": 46095350, "body": "Haskell style often name the auxiliary function just &quot;go&quot; or &quot;aux&quot; since its scope is limited to the function and the alternative is just a repetition of the function name slightly modified, which doesn&#39;t bring any readability benefits. Only the top level functions usually get explicit signatures, it is considered that local variables are close enough to the potential problems that they don&#39;t need one (except if you wish to clarify a particularly obscure type)."}], "tags": [], "owner": {"reputation": 69792, "user_id": 493122, "user_type": "registered", "accept_rate": 96, "profile_image": "https://www.gravatar.com/avatar/1f90ae01c2e24801c2df9189179b0ccd?s=128&d=identicon&r=PG", "display_name": "Shoe", "link": "https://stackoverflow.com/users/493122/shoe"}, "is_accepted": true, "score": 2, "last_activity_date": 1425753114, "last_edit_date": 1495541572, "creation_date": 1425752336, "answer_id": 28918352, "question_id": 28918173, "link": "https://stackoverflow.com/questions/28918173/haskell-tail-recursive-inner-functions/28918352#28918352", "title": "Haskell Tail Recursive Inner Functions", "body": "<p>Yes, you can either use <code>let</code>:</p>\n\n<pre><code>myLength :: [a]  -&gt; Int\nmyLength x = \n    let innerLength :: [a] -&gt; Int -&gt; Int  -- Tail recursive inner call\n        innerLength [] n      = n\n        innerLength (x:xs) n  = innerLength xs (n+1)\n    in innerLength x 0\n</code></pre>\n\n<p><kbd><a href=\"http://coliru.stacked-crooked.com/a/f919c3a17ee2a58a\" rel=\"nofollow noreferrer\">Live demo</a></kbd></p>\n\n<p>or <code>where</code>:</p>\n\n<pre><code>myLength :: [a]  -&gt; Int\nmyLength x = innerLength x 0\n    where innerLength :: [a] -&gt; Int -&gt; Int  -- Tail recursive inner call\n          innerLength [] n      = n\n          innerLength (x:xs) n  = innerLength xs (n+1)\n</code></pre>\n\n<p><kbd><a href=\"http://coliru.stacked-crooked.com/a/b5243f5d172deaaf\" rel=\"nofollow noreferrer\">Live demo</a></kbd></p>\n\n<p>See <a href=\"https://stackoverflow.com/q/4362328/493122\">here</a> for the difference between the two.</p>\n"}], "owner": {"reputation": 549, "user_id": 4396823, "user_type": "registered", "accept_rate": 83, "profile_image": "https://www.gravatar.com/avatar/e7493ed20de304e4d88666ff6977ae33?s=128&d=identicon&r=PG&f=1", "display_name": "Steve", "link": "https://stackoverflow.com/users/4396823/steve"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 377, "favorite_count": 1, "accepted_answer_id": 28918352, "answer_count": 1, "score": 2, "last_activity_date": 1425753114, "creation_date": 1425751302, "question_id": 28918173, "link": "https://stackoverflow.com/questions/28918173/haskell-tail-recursive-inner-functions", "title": "Haskell Tail Recursive Inner Functions", "body": "<p>Coming from a Scala background I'm pretty used to using tail recursion to write stuff that can't be easily represented using another method. Let's say I want to calculate the length of a list, but I don't want to use a fold. I want to do it in a natural tail recursive way. I thought of this way:</p>\n\n<pre><code>myLength :: [a]  -&gt; Int\nmyLength x    = innerLength x 0\n\ninnerLength :: [a] -&gt; Int -&gt; Int  -- Tail recursive inner call\ninnerLength [] _      = 0\ninnerLength (x:xs) n  = innerLength xs n+1\n</code></pre>\n\n<p>and this works fine. But it isn't very readable that innerLength is really the tail recursive inner call to count the list members and it seems like innerLength is scoped in such a way someone could just use innerLength instead of the better myLength.</p>\n\n<p>Is there a better way to do this?</p>\n"}, {"tags": ["haskell", "stm", "tvar"], "comments": [{"owner": {"reputation": 100185, "user_id": 3234959, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/93bb12ca0f93dfddb33880316f7e66c2?s=128&d=identicon&r=PG&f=1", "display_name": "chi", "link": "https://stackoverflow.com/users/3234959/chi"}, "edited": false, "score": 1, "creation_date": 1425753472, "post_id": 28918151, "comment_id": 46094621, "body": "Are you passing a lot of <code>IntMap</code>s instead of a <code>MudData</code>? Would the latter be an option? Hard to tell without seeing some code -- can you share a small snippet showing a case where the helper needs so many arguments?"}, {"owner": {"reputation": 44013, "user_id": 1477667, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/trgKM.jpg?s=128&g=1", "display_name": "dfeuer", "link": "https://stackoverflow.com/users/1477667/dfeuer"}, "edited": false, "score": 1, "creation_date": 1425753888, "post_id": 28918151, "comment_id": 46094741, "body": "Yep, that&#39;s definitely code smell. Nope, I don&#39;t know the right way to fix it."}, {"owner": {"reputation": 20862, "user_id": 376113, "user_type": "registered", "accept_rate": 72, "profile_image": "https://www.gravatar.com/avatar/d3a5bd12fe6d876527a3cf4ac0de5fc6?s=128&d=identicon&r=PG", "display_name": "mb14", "link": "https://stackoverflow.com/users/376113/mb14"}, "edited": false, "score": 0, "creation_date": 1425755041, "post_id": 28918151, "comment_id": 46095125, "body": "I&#39;m not really familiar with TVar but can&#39;t you factorize it ? ie remove all the TVar from MUDData, and use (TVar MUDData) where needed ?"}, {"owner": {"reputation": 44013, "user_id": 1477667, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/trgKM.jpg?s=128&g=1", "display_name": "dfeuer", "link": "https://stackoverflow.com/users/1477667/dfeuer"}, "reply_to_user": {"reputation": 20862, "user_id": 376113, "user_type": "registered", "accept_rate": 72, "profile_image": "https://www.gravatar.com/avatar/d3a5bd12fe6d876527a3cf4ac0de5fc6?s=128&d=identicon&r=PG", "display_name": "mb14", "link": "https://stackoverflow.com/users/376113/mb14"}, "edited": false, "score": 1, "creation_date": 1425756396, "post_id": 28918151, "comment_id": 46095553, "body": "@mb14, that&#39;s presumably troublesome because it increases contention."}, {"owner": {"reputation": 23444, "user_id": 414413, "user_type": "registered", "accept_rate": 79, "profile_image": "https://www.gravatar.com/avatar/6de2113f01432aa844dc85070ff33e89?s=128&d=identicon&r=PG", "display_name": "Cirdec", "link": "https://stackoverflow.com/users/414413/cirdec"}, "reply_to_user": {"reputation": 100185, "user_id": 3234959, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/93bb12ca0f93dfddb33880316f7e66c2?s=128&d=identicon&r=PG&f=1", "display_name": "chi", "link": "https://stackoverflow.com/users/3234959/chi"}, "edited": false, "score": 1, "creation_date": 1425756485, "post_id": 28918151, "comment_id": 46095578, "body": "@chi The reason he can&#39;t pass a <code>MudData</code> is the helper functions are pure and the <code>MudData</code> has lots of <code>TVar</code>s for granularity. The pure helper functions may only be used on subsets of the <code>MudData</code>, so adding another data structure (or a type parameter to <code>MudData</code>) won&#39;t help - reading all the <code>TVar</code>s to create that one single structure would eliminate the granularity."}, {"owner": {"reputation": 523, "user_id": 1739395, "user_type": "registered", "accept_rate": 89, "profile_image": "https://www.gravatar.com/avatar/f6877c2a0e8b24a4b4c9b4700d33846e?s=128&d=identicon&r=PG", "display_name": "the-konapie", "link": "https://stackoverflow.com/users/1739395/the-konapie"}, "reply_to_user": {"reputation": 20862, "user_id": 376113, "user_type": "registered", "accept_rate": 72, "profile_image": "https://www.gravatar.com/avatar/d3a5bd12fe6d876527a3cf4ac0de5fc6?s=128&d=identicon&r=PG", "display_name": "mb14", "link": "https://stackoverflow.com/users/376113/mb14"}, "edited": false, "score": 1, "creation_date": 1425756521, "post_id": 28918151, "comment_id": 46095589, "body": "@mb14 That is an option, but then I would be locking on the entire world data instead of just what pieces are required on a case-by-case basis."}, {"owner": {"reputation": 523, "user_id": 1739395, "user_type": "registered", "accept_rate": 89, "profile_image": "https://www.gravatar.com/avatar/f6877c2a0e8b24a4b4c9b4700d33846e?s=128&d=identicon&r=PG", "display_name": "the-konapie", "link": "https://stackoverflow.com/users/1739395/the-konapie"}, "reply_to_user": {"reputation": 23444, "user_id": 414413, "user_type": "registered", "accept_rate": 79, "profile_image": "https://www.gravatar.com/avatar/6de2113f01432aa844dc85070ff33e89?s=128&d=identicon&r=PG", "display_name": "Cirdec", "link": "https://stackoverflow.com/users/414413/cirdec"}, "edited": false, "score": 0, "creation_date": 1425756942, "post_id": 28918151, "comment_id": 46095710, "body": "@Cirdec Right, thanks for that explanation."}, {"owner": {"reputation": 20862, "user_id": 376113, "user_type": "registered", "accept_rate": 72, "profile_image": "https://www.gravatar.com/avatar/d3a5bd12fe6d876527a3cf4ac0de5fc6?s=128&d=identicon&r=PG", "display_name": "mb14", "link": "https://stackoverflow.com/users/376113/mb14"}, "edited": false, "score": 0, "creation_date": 1425757285, "post_id": 28918151, "comment_id": 46095822, "body": "I see, however, adding &quot;granularity&quot; to locks usually quickly endup with  deadlocks."}, {"owner": {"reputation": 100185, "user_id": 3234959, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/93bb12ca0f93dfddb33880316f7e66c2?s=128&d=identicon&r=PG&f=1", "display_name": "chi", "link": "https://stackoverflow.com/users/3234959/chi"}, "reply_to_user": {"reputation": 20862, "user_id": 376113, "user_type": "registered", "accept_rate": 72, "profile_image": "https://www.gravatar.com/avatar/d3a5bd12fe6d876527a3cf4ac0de5fc6?s=128&d=identicon&r=PG", "display_name": "mb14", "link": "https://stackoverflow.com/users/376113/mb14"}, "edited": false, "score": 2, "creation_date": 1425757455, "post_id": 28918151, "comment_id": 46095883, "body": "@mb14 <code>TVar</code>s ensure deadlock freedom, since they can only be accessed in STM transactions."}, {"owner": {"reputation": 100185, "user_id": 3234959, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/93bb12ca0f93dfddb33880316f7e66c2?s=128&d=identicon&r=PG&f=1", "display_name": "chi", "link": "https://stackoverflow.com/users/3234959/chi"}, "reply_to_user": {"reputation": 23444, "user_id": 414413, "user_type": "registered", "accept_rate": 79, "profile_image": "https://www.gravatar.com/avatar/6de2113f01432aa844dc85070ff33e89?s=128&d=identicon&r=PG", "display_name": "Cirdec", "link": "https://stackoverflow.com/users/414413/cirdec"}, "edited": false, "score": 0, "creation_date": 1425758041, "post_id": 28918151, "comment_id": 46096108, "body": "@Cirdec Why do these helpers have to be pure? One option could be to pass <code>TVar IntMap</code>s (or <code>MudData</code> carrying all the <code>TVar</code>s) and rewrite the helpers inside the <code>STM</code> monad so that they can actually read the data. Maybe with lenses and some applicative syntax one can reduce the <code>readTVar</code> boilerplate. (Here I am doing wild guesses, I admit.)"}, {"owner": {"reputation": 23444, "user_id": 414413, "user_type": "registered", "accept_rate": 79, "profile_image": "https://www.gravatar.com/avatar/6de2113f01432aa844dc85070ff33e89?s=128&d=identicon&r=PG", "display_name": "Cirdec", "link": "https://stackoverflow.com/users/414413/cirdec"}, "reply_to_user": {"reputation": 100185, "user_id": 3234959, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/93bb12ca0f93dfddb33880316f7e66c2?s=128&d=identicon&r=PG&f=1", "display_name": "chi", "link": "https://stackoverflow.com/users/3234959/chi"}, "edited": false, "score": 1, "creation_date": 1425758665, "post_id": 28918151, "comment_id": 46096324, "body": "@chi I misunderstood what you were suggesting. I though you were suggesting the same thing as @mb14. With <a href=\"http://stackoverflow.com/a/28919284/414413\">a little abstraction</a>, the helper functions can both be pure, operating on a <code>MudData</code> without <code>TVar</code>s like @mb14 suggested and be passed the whole <code>MudData</code>, <code>TVar</code>s and all, like you suggest."}, {"owner": {"reputation": 31301, "user_id": 1598537, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/c214754fba6f3a238a93af85a0ab4f58?s=128&d=identicon&r=PG", "display_name": "AndrewC", "link": "https://stackoverflow.com/users/1598537/andrewc"}, "edited": false, "score": 0, "creation_date": 1425761728, "post_id": 28918151, "comment_id": 46097234, "body": "Very thoughtful question."}, {"owner": {"reputation": 60057, "user_id": 1333025, "user_type": "registered", "accept_rate": 65, "profile_image": "https://www.gravatar.com/avatar/79ab43010f900324ac5e2de19a2916cb?s=128&d=identicon&r=PG", "display_name": "Petr", "link": "https://stackoverflow.com/users/1333025/petr"}, "edited": false, "score": 1, "creation_date": 1425848018, "post_id": 28918151, "comment_id": 46119192, "body": "Not directly related, but for writing a MUD you might be interested in using <a href=\"https://wiki.haskell.org/Functional_Reactive_Programming\" rel=\"nofollow noreferrer\">functional reactive programming</a> techniques or libraries such as <a href=\"https://wiki.haskell.org/Netwire\" rel=\"nofollow noreferrer\">Netwire</a>."}], "answers": [{"comments": [{"owner": {"reputation": 523, "user_id": 1739395, "user_type": "registered", "accept_rate": 89, "profile_image": "https://www.gravatar.com/avatar/f6877c2a0e8b24a4b4c9b4700d33846e?s=128&d=identicon&r=PG", "display_name": "the-konapie", "link": "https://stackoverflow.com/users/1739395/the-konapie"}, "edited": false, "score": 1, "creation_date": 1425759585, "post_id": 28919284, "comment_id": 46096587, "body": "Wow! Thank you for taking the time to write a detailed answer. I get the general idea, but I&#39;m going to have to study how the abstraction works and play with some code to fully grok this. But this is neat; I would never have thought of this."}], "tags": [], "owner": {"reputation": 23444, "user_id": 414413, "user_type": "registered", "accept_rate": 79, "profile_image": "https://www.gravatar.com/avatar/6de2113f01432aa844dc85070ff33e89?s=128&d=identicon&r=PG", "display_name": "Cirdec", "link": "https://stackoverflow.com/users/414413/cirdec"}, "is_accepted": false, "score": 22, "last_activity_date": 1425763410, "last_edit_date": 1425763410, "creation_date": 1425758200, "answer_id": 28919284, "question_id": 28918151, "link": "https://stackoverflow.com/questions/28918151/haskell-code-littered-with-tvar-operations-and-functions-taking-many-arguments/28919284#28919284", "title": "Haskell code littered with TVar operations and functions taking many arguments: code smell?", "body": "<p>The solution to this problem is in changing the pure helper functions. We don't really want them to be pure, we want to leak out a single side-effect - whether or not they read specific pieces of data.</p>\n\n<p>Let's say we have a pure function that uses only clothing and coins:</p>\n\n<pre><code>moreVanityThanWealth :: IntMap Clothing -&gt; IntMap Coins -&gt; Bool\nmoreVanityThanWealth clothing coins = ...\n</code></pre>\n\n<p>It's usually nice to know that a function only cares about e.g. clothing and coins, but in your case this knowledge is irrelevant and is just creating headaches. We are going to deliberately forget this detail. If we followed mb14's suggestion, we would pass an entire pure <code>MudData'</code> like the following to the helper functions.</p>\n\n<pre><code>data MudData' = MudData' { _armorTbl    :: IntMap Armor\n                         , _clothingTbl :: IntMap Clothing\n                         , _coinsTbl    :: IntMap Coins\n\nmoreVanityThanWealth :: MudData' -&gt; Bool\nmoreVanityThanWealth md =\n    let clothing = _clothingTbl md\n        coins    = _coinsTbl    md\n    in  ...\n</code></pre>\n\n<p><code>MudData</code> and <code>MudData'</code> are almost identical to each other. One of them wraps its fields in <code>TVar</code>s and the other one doesn't. We can modify <code>MudData</code> so that it takes an extra type parameter (of kind <code>* -&gt; *</code>) for what to wrap the fields in. <code>MudData</code> will have the slightly unusual kind <code>(* -&gt; *) -&gt; *</code>, which is closely related to lenses but doesn't have much library support. I call this pattern a <em>Model</em>.</p>\n\n<pre><code>data MudData f = MudData { _armorTbl    :: f (IntMap Armor)\n                         , _clothingTbl :: f (IntMap Clothing)\n                         , _coinsTbl    :: f (IntMap Coins)\n</code></pre>\n\n<p>We can recover the original <code>MudData</code> with <code>MudData TVar</code>. We can recreate the pure version by wrapping the fields in <a href=\"https://hackage.haskell.org/package/transformers-0.4.0.0/docs/Data-Functor-Identity.html\"><code>Identity</code></a>, <code>newtype Identity a = Identity {runIdentity :: a}</code>. In terms of <code>MudData Identity</code>, our function would be written as </p>\n\n<pre><code>moreVanityThanWealth :: MudData Identity -&gt; Bool\nmoreVanityThanWealth md =\n    let clothing = runIdentity . _clothingTbl $ md\n        coins    = runIdentity . _coinsTbl    $ md\n    in  ...\n</code></pre>\n\n<p>We've successfully forgotten which parts of the <code>MudData</code> we've used, but now we don't have the lock granularity we want. We need to recover, as a side effect, exactly what we just forgot. If we wrote the <code>STM</code> version of the helper it would look like</p>\n\n<pre><code>moreVanityThanWealth :: MudData TVar -&gt; STM Bool\nmoreVanityThanWealth md =\n    do\n        clothing &lt;- readTVar . _clothingTbl $ md\n        coins    &lt;- readTVar . _coinsTbl    $ md\n        return ...\n</code></pre>\n\n<p>This <code>STM</code> version for <code>MudData TVar</code> is almost exactly the same as the pure version we just wrote for <code>MudData Identity</code>. They only differ by the type of the reference (<code>TVar</code> vs. <code>Identity</code>), what function we use to get the values out of the references (<code>readTVar</code> vs <code>runIdentity</code>), and how the result is returned (in <code>STM</code> or as a plain value). It would be nice if the same function could be used to provide both. We are going to extract what is common between the two functions. To do so, we'll introduce a type class <code>MonadReadRef r m</code> for the <code>Monad</code>s we can read some type of reference from. <code>r</code> is the type of the reference, <code>readRef</code> is the function to get the values out of the references, and <code>m</code> is how the result is returned. The following <code>MonadReadRef</code> is closely related to the <a href=\"https://hackage.haskell.org/package/ref-fd-0.4/docs/Control-Monad-Ref.html#t:MonadRef\"><code>MonadRef</code></a> class from <a href=\"https://hackage.haskell.org/package/ref-fd\">ref-fd</a>.</p>\n\n<pre><code>{-# LANGUAGE FunctionalDependencies #-}\n\nclass Monad m =&gt; MonadReadRef r m | m -&gt; r where\n    readRef :: r a -&gt; m a\n</code></pre>\n\n<p>As long as code is parameterized over all <code>MonadReadRef r m</code>s, it is pure. We can see this by running it with the following instance of <code>MonadReadRef</code> for ordinary values held in an <code>Identity</code>. The <code>id</code> in <code>readRef = id</code> is the same as <code>return . runIdentity</code>.</p>\n\n<pre><code>instance MonadReadRef Identity Identity where\n    readRef = id\n</code></pre>\n\n<p>We'll rewrite <code>moreVanityThanWealth</code> in terms of <code>MonadReadRef</code>.</p>\n\n<pre><code>moreVanityThanWealth :: MonadReadRef r m =&gt; MudData r -&gt; m Bool\nmoreVanityThanWealth md =\n    do\n        clothing &lt;- readRef . _clothingTbl $ md\n        coins    &lt;- readRef . _coinsTbl    $ md\n        return ...\n</code></pre>\n\n<p>When we add a <code>MonadReadRef</code> instance for <code>TVar</code>s in <code>STM</code>, we can use these \"pure\" computations in <code>STM</code> but leak the side-effect of which <code>TVar</code>s were read.</p>\n\n<pre><code>instance MonadReadRef TVar STM where\n    readRef = readTVar\n</code></pre>\n"}, {"comments": [{"owner": {"reputation": 523, "user_id": 1739395, "user_type": "registered", "accept_rate": 89, "profile_image": "https://www.gravatar.com/avatar/f6877c2a0e8b24a4b4c9b4700d33846e?s=128&d=identicon&r=PG", "display_name": "the-konapie", "link": "https://stackoverflow.com/users/1739395/the-konapie"}, "edited": false, "score": 3, "creation_date": 1425764210, "post_id": 28919903, "comment_id": 46097976, "body": "Thank you for your thoughtful reply. I think you really hit the nail on the head: I didn&#39;t base my decision to use multiple TVars on any benchmarking. In truth, my game will probably never have enough simultaneous players to create serious contention over a single lock. Still, I wanted to do things &quot;the best way&quot; and write a server that is scalable. But the &quot;best way&quot; I envisioned ended up biting me. I may have  just learned another lesson the hard way."}], "tags": [], "owner": {"reputation": 60057, "user_id": 1333025, "user_type": "registered", "accept_rate": 65, "profile_image": "https://www.gravatar.com/avatar/79ab43010f900324ac5e2de19a2916cb?s=128&d=identicon&r=PG", "display_name": "Petr", "link": "https://stackoverflow.com/users/1333025/petr"}, "is_accepted": true, "score": 16, "last_activity_date": 1450268181, "last_edit_date": 1491982276, "creation_date": 1425761798, "answer_id": 28919903, "question_id": 28918151, "link": "https://stackoverflow.com/questions/28918151/haskell-code-littered-with-tvar-operations-and-functions-taking-many-arguments/28919903#28919903", "title": "Haskell code littered with TVar operations and functions taking many arguments: code smell?", "body": "<p>Yes, this obviously makes your code complex and clutters the important code with a lot of boilerplate details. And functions with more than 4 arguments are a sign of problems.</p>\n\n<p>I'd ask the question: <strong>Do you really gain anything by having separate <code>TVar</code>s?</strong> Isn't it a case of <a href=\"https://softwareengineering.stackexchange.com/q/80084/61231\">premature optimization</a>? Before taking such a design decision as splitting your data structure among multiple separate <code>TVar</code>s, I'd definitely do some measurements (see <a href=\"https://hackage.haskell.org/package/criterion\" rel=\"nofollow noreferrer\">criterion</a>). You can create a sample test that models the expected number of concurrent threads and frequency of data updates and check what are you really gaining or losing by having multiple <code>TVar</code>s vs a single one vs an <code>IORef</code>.</p>\n\n<p>Keep in mind:</p>\n\n<ul>\n<li>If there are multiple threads competing for common locks in a <code>STM</code> transaction, the transactions can get restarted several times before they manage to successfully complete. So under some circumstances, having multiple locks can actually make things worse.</li>\n<li>If there is ultimately just one data structure that you need to synchronize, you might consider using a single <a href=\"https://hackage.haskell.org/package/base-4.7.0.2/docs/Data-IORef.html\" rel=\"nofollow noreferrer\"><code>IORef</code></a> instead. It's atomic operations are very fast, which could compensate for having a single central lock.</li>\n<li>In Haskell it's surprisingly difficult for a pure function to block an atomic <code>STM</code> or a <code>IORef</code> transaction for a long time. The reason is laziness: You only need to create thunks within such a transaction, not to evaluate them. This is true in particular for a single atomic <code>IORef</code>. The thunks are evaluated outside such transactions (by a thread that inspects them, or you can decide to force them at some point, if you need more control; this can be desired in your case, as if your system evolves without anybody observing it, you can easily accumulate unevaluated thunks).</li>\n</ul>\n\n<hr>\n\n<p>If it turns out that having multiple <code>TVar</code>s is indeed crucial, then I'd probably write all the code in a custom monad (as described by @Cirdec while I was writing my answer), whose implementation would be hidden from the main code, and which would provide functions for reading (and perhaps also writing) parts of the state. It'd then be run as a single <code>STM</code> transaction, reading and writing only what's needed, and you could have a pure version of the monad for testing.</p>\n"}], "owner": {"reputation": 523, "user_id": 1739395, "user_type": "registered", "accept_rate": 89, "profile_image": "https://www.gravatar.com/avatar/f6877c2a0e8b24a4b4c9b4700d33846e?s=128&d=identicon&r=PG", "display_name": "the-konapie", "link": "https://stackoverflow.com/users/1739395/the-konapie"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 714, "favorite_count": 6, "accepted_answer_id": 28919903, "answer_count": 2, "score": 14, "last_activity_date": 1450268181, "creation_date": 1425751188, "question_id": 28918151, "link": "https://stackoverflow.com/questions/28918151/haskell-code-littered-with-tvar-operations-and-functions-taking-many-arguments", "title": "Haskell code littered with TVar operations and functions taking many arguments: code smell?", "body": "<p>I'm writing a MUD server in Haskell (MUD = Multi User Dungeon: basically, a multi-user text adventure/role-playing game). The game world data/state is represented in about 15 different <code>IntMap</code>s. My monad transformer stack looks like this: <code>ReaderT MudData IO</code>, where the <code>MudData</code> type is a record type containing the <code>IntMap</code>s, each in its own <code>TVar</code> (I'm using STM for concurrency):</p>\n\n<pre><code>data MudData = MudData { _armorTblTVar    :: TVar (IntMap Armor)\n                       , _clothingTblTVar :: TVar (IntMap Clothing)\n                       , _coinsTblTVar    :: TVar (IntMap Coins)\n</code></pre>\n\n<p>...and so on. (I'm using lenses, thus the underscores.)</p>\n\n<p>Some functions need certain <code>IntMap</code>s, while other functions need others. Thus, having each <code>IntMap</code> in its own <code>TVar</code> provides granularity.</p>\n\n<p>However, a pattern has emerged in my code. In the functions that handle player commands, I need to read (and sometimes later write) to my <code>TVar</code>s within the STM monad. Thus these functions end up having an STM helper defined in their <code>where</code> blocks. These STM helpers often have quite a few <code>readTVar</code> operations in them, as most commands need to access a handful of the <code>IntMap</code>s. Furthermore, a function for a given command may call out to a number of pure helper functions that also need some or all of the <code>IntMap</code>s. These pure helper functions thus sometimes end up taking a lot of arguments (sometimes over 10).</p>\n\n<p>So, my code has become \"littered\" with lots of <code>readTVar</code> expressions and functions that take a large number of arguments. Here are my questions: is this a code smell? Am I missing some abstraction that would make my code more elegant? Is there a more ideal way to structure my data/code?</p>\n\n<p>Thanks!</p>\n"}, {"tags": ["haskell", "configuration", "yesod", "typeclass"], "answers": [{"comments": [{"owner": {"reputation": 44013, "user_id": 1477667, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/trgKM.jpg?s=128&g=1", "display_name": "dfeuer", "link": "https://stackoverflow.com/users/1477667/dfeuer"}, "edited": false, "score": 0, "creation_date": 1425832171, "post_id": 28918816, "comment_id": 46113498, "body": "I can see from the warnings in the documentation that <code>Given</code> is some sort of horrible hack, but I can&#39;t understand what it actually does. The type of <code>give</code> makes no sense to me. Could you try to explain it?"}, {"owner": {"reputation": 490, "user_id": 232505, "user_type": "registered", "accept_rate": 78, "profile_image": "https://www.gravatar.com/avatar/469b3f103adeae0ecf1c91c55cd17c58?s=128&d=identicon&r=PG", "display_name": "Simon Lindgren", "link": "https://stackoverflow.com/users/232505/simon-lindgren"}, "edited": false, "score": 0, "creation_date": 1425943266, "post_id": 28918816, "comment_id": 46160663, "body": "I had some issues using Given (I tried that first, since it seemed the nicest wrt minimal changes necessary). The documentation speaks of instances in scope, which is not clear to me. Especially how/if that limits what can be done with it and where it can be used."}], "tags": [], "owner": {"reputation": 23444, "user_id": 414413, "user_type": "registered", "accept_rate": 79, "profile_image": "https://www.gravatar.com/avatar/6de2113f01432aa844dc85070ff33e89?s=128&d=identicon&r=PG", "display_name": "Cirdec", "link": "https://stackoverflow.com/users/414413/cirdec"}, "is_accepted": true, "score": 4, "last_activity_date": 1425763814, "last_edit_date": 1425763814, "creation_date": 1425755064, "answer_id": 28918816, "question_id": 28917645, "link": "https://stackoverflow.com/questions/28917645/a-typeclass-instance-that-needs-configuration-data-what-are-my-options/28918816#28918816", "title": "A typeclass instance that needs configuration data. What are my options?", "body": "<p>I'm going to simplify the problem so that we only need core libraries. We want to change how we <code>Show</code> a <code>MarkdownText</code> based on some <code>ExampleSettings</code> that contain a <code>prefix</code> and a <code>suffix</code>.</p>\n\n<pre><code>{-# LANGUAGE OverloadedStrings #-}\n\nimport Data.Text as T\nimport Data.Monoid\nimport Data.String\n\nnewtype MarkdownText = MarkdownText { rawMarkdown :: T.Text}\n\ninstance IsString MarkdownText where\n    fromString = MarkdownText . fromString\n\ndata ExampleSettings = ExampleSettings { prefix :: T.Text, suffix :: T.Text }\ndef = ExampleSettings \"\" \"\"\n\nemphasise = def { prefix = \"*\", suffix = \"*\" }\n\nshowWithSettings :: ExampleSettings -&gt; T.Text -&gt; String\nshowWithSettings set = show . (\\x -&gt; prefix set &lt;&gt; x &lt;&gt; suffix set)\n\ninstance Show MarkdownText where\n    show = showWithSettings def . rawMarkdown\n\nmain = print $ MarkdownText \"Hello World\"\n</code></pre>\n\n<p>There are a number of options for how to solve this problem, first at the value level, then at the type level, and finally globally at the type level.</p>\n\n<h3>Add a field</h3>\n\n<p>We have a few options for how we can proceed. The simplest option is to add the setting at the value level. We'll wrap up the settings with the <code>MarkdownText</code>.</p>\n\n<pre><code>data ConfiguredMarkdownText = ConfiguredMarkdownText {\n                                  markdownText :: MarkdownText,\n                                  settings :: ExampleSettings }\n\ninstance Show ConfiguredMarkdownText where\n    show t = showWithSettings (settings t) (rawMarkdown . markdownText $ t)\n\nmain = print $ ConfiguredMarkdownText \"Hello World\" emphasise\n</code></pre>\n\n<p>For convenience, we added an <code>IsString</code> instance for <code>MarkdownText</code> in the first section.</p>\n\n<h3>Add a type parameter</h3>\n\n<p>We could carry the extra data we need around at the type level instead of at the value level. We add a type parameter to <code>MarkdownText</code> to indicate which settings to use.</p>\n\n<pre><code>newtype MarkdownText s = MarkdownText { rawMarkdown :: T.Text}\n</code></pre>\n\n<p>We make types to represent the possible settings</p>\n\n<pre><code>data Def = Def\ndata Emphasise = Emphasise\n</code></pre>\n\n<p>We can add a type class for types that determine settings, and instances for the possible settings.</p>\n\n<pre><code>{-# LANGUAGE FunctionalDependencies #-}\n\nclass Setting v k | k -&gt; v where\n    setting :: proxy k -&gt; v\n\ninstance Setting ExampleSettings Def where\n    setting _ = def\n\ninstance Setting ExampleSettings Emphasise where\n    setting _ = emphasise\n</code></pre>\n\n<p>We can <code>Show</code> any <code>MarkdownText s</code> as long as <code>s</code> provides the <code>Setting</code>.</p>\n\n<pre><code>{-# LANGUAGE FlexibleContexts #-}\n{-# LANGUAGE UndecidableInstances #-}\n\ninstance (Setting ExampleSettings s) =&gt; Show (MarkdownText s) where\n    show t = showWithSettings (setting t) (rawMarkdown t)\n\nmain = print (\"Hello World\" :: MarkdownText Emphasise)\n</code></pre>\n\n<p><code>MarkdownText :: * -&gt; *</code> requires a slightly different <code>IsString</code> instance.</p>\n\n<pre><code>instance IsString (MarkdownText s) where\n    fromString = MarkdownText . fromString\n</code></pre>\n\n<h3>Reflect the value from a type parameter</h3>\n\n<p>The <a href=\"https://hackage.haskell.org/package/reflection\" rel=\"nofollow\">reflection</a> package provides a way to temporarily associate a value with a type. This lets us do the same thing as in the previous example, but without needing to make types of our own to represent the settings.</p>\n\n<pre><code>import Data.Reflection\n</code></pre>\n\n<p>We start by adding an extra type parameter to <code>MarkdownText</code>, the same as in the previous section.</p>\n\n<pre><code>newtype MarkdownText s = MarkdownText { rawMarkdown :: T.Text}\n</code></pre>\n\n<p>The reflection package defines a class, <a href=\"https://hackage.haskell.org/package/reflection-1.5.1.1/docs/Data-Reflection.html#t:Reifies\" rel=\"nofollow\"><code>Reifies</code></a>, that is almost identical to the <code>Setting</code> class we made for the previous section. This lets us jump straight to defining the <code>Show</code> instance.</p>\n\n<pre><code>{-# LANGUAGE FlexibleContexts #-}\n{-# LANGUAGE UndecidableInstances #-}\n\ninstance (Reifies s ExampleSettings) =&gt; Show (MarkdownText s) where\n    show t = showWithSettings (reflect t) (rawMarkdown t)\n</code></pre>\n\n<p>We'll define a little convenience function to tag the type parameter of <code>MarkdownText</code>s</p>\n\n<pre><code>markdownText :: proxy s -&gt; T.Text -&gt; MarkdownText s\nmarkdownText _ = MarkdownText\n</code></pre>\n\n<p>and complete the example of setting the <code>ExampleSettings</code> to be used when showing a <code>MarkdownText</code>. We provide the reified value with <a href=\"https://hackage.haskell.org/package/reflection-1.5.1.1/docs/Data-Reflection.html#v:reify\" rel=\"nofollow\"><code>reify :: a -&gt; (forall s. Reifies s a =&gt; Proxy s -&gt; r) -&gt; r</code></a>, which passes back a proxy for the type the value has been reified to.</p>\n\n<pre><code>main = reify emphasise (\\p -&gt; print (markdownText p \"Hello World\"))\n</code></pre>\n\n<p>This has an advantage over the simpler version from the next section; multiple settings can be used for <code>MarkdownText</code>s with different type parameters.</p>\n\n<pre><code>main = reify emphasise $ \\p1 -&gt;\n       reify def $ \\p2 -&gt;\n       do\n           print (markdownText p1 \"Hello World\")\n           print (markdownText p2 \"Goodbye\")\n</code></pre>\n\n<h3>Reflect a global configuration</h3>\n\n<p>The reflection package also defines a simpler class, <a href=\"https://hackage.haskell.org/package/reflection-1.5.1.1/docs/Data-Reflection.html#t:Given\" rel=\"nofollow\"><code>Given</code></a>. It's defined as  <code>class Given a where given :: a</code>. It represents values that can be determined from the type of the value itself. This allows us to provide a single global configuration value for a specific type, like <code>ExampleSettings</code>. We can jump straight to writing the show instance for <code>MarkdownText</code>.</p>\n\n<pre><code>{-# LANGUAGE FlexibleContexts #-}\n{-# LANGUAGE UndecidableInstances #-}\n\ninstance (Given ExampleSettings) =&gt; Show (MarkdownText) where\n    show = showWithSettings given . rawMarkdown\n</code></pre>\n\n<p>We provide the <code>given</code> <code>ExampleSettings</code> with <a href=\"https://hackage.haskell.org/package/reflection-1.5.1.1/docs/Data-Reflection.html#v:give\" rel=\"nofollow\"><code>give :: a -&gt; (Given a =&gt; r) -&gt; r</code></a>.</p>\n\n<pre><code>main = give emphasise $ print (MarkdownText \"Hello World\")\n</code></pre>\n"}], "owner": {"reputation": 490, "user_id": 232505, "user_type": "registered", "accept_rate": 78, "profile_image": "https://www.gravatar.com/avatar/469b3f103adeae0ecf1c91c55cd17c58?s=128&d=identicon&r=PG", "display_name": "Simon Lindgren", "link": "https://stackoverflow.com/users/232505/simon-lindgren"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 131, "favorite_count": 2, "accepted_answer_id": 28918816, "answer_count": 1, "score": 3, "last_activity_date": 1425763814, "creation_date": 1425748578, "question_id": 28917645, "link": "https://stackoverflow.com/questions/28917645/a-typeclass-instance-that-needs-configuration-data-what-are-my-options", "title": "A typeclass instance that needs configuration data. What are my options?", "body": "<p>Using yesod and persistent, I made what I think is a handy type to handle Markdown data:</p>\n\n<pre><code>{-# LANGUAGE OverloadedStrings #-}\n\nmodule Utils.MarkdownText where\n\nimport Prelude\nimport Data.Text.Lazy\nimport Data.Text as T\nimport Database.Persist\nimport Database.Persist.Sql\nimport Text.Blaze\nimport Text.Markdown\n\nnewtype MarkdownText = MarkdownText { rawMarkdown :: T.Text }\n\ninstance PersistField MarkdownText  where\n    toPersistValue = PersistText . rawMarkdown\n\n    fromPersistValue (PersistText val) = Right $ MarkdownText { rawMarkdown = val }\n    fromPersistValue _ = Left \"invalid type\"\n\ninstance PersistFieldSql MarkdownText where\n    sqlType _ = SqlString\n\ninstance ToMarkup MarkdownText where\n    toMarkup = (markdown def) . fromStrict . rawMarkdown\n\n    preEscapedToMarkup = toMarkup . rawMarkdown\n</code></pre>\n\n<p>You may notice in the <code>ToMarkup</code> instance I use <code>def</code> to get markdown parameters. If I would like to change these settings, and not have it hardcoded in this module, what are my options?</p>\n\n<p>I have considered the option of making <code>MarkdownText</code> take the settings information as a parameter, but what other options are there (if any)?</p>\n"}, {"tags": ["haskell", "conduit"], "answers": [{"comments": [{"owner": {"reputation": 523, "user_id": 1739395, "user_type": "registered", "accept_rate": 89, "profile_image": "https://www.gravatar.com/avatar/f6877c2a0e8b24a4b4c9b4700d33846e?s=128&d=identicon&r=PG", "display_name": "the-konapie", "link": "https://stackoverflow.com/users/1739395/the-konapie"}, "edited": false, "score": 0, "creation_date": 1425750938, "post_id": 28917805, "comment_id": 46093774, "body": "Hi! Thanks for your response! Indeed, thus far I&#39;ve been trying to use Conduit for operations that inevitably require data to all be in memory at once, so I&#39;m probably not applying the library to situations it was meant to handle per se.  Thanks for providing sample code."}, {"owner": {"reputation": 30377, "user_id": 369198, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/71596bb1ca3ba3aa4400c3f407baec9f?s=128&d=identicon&r=PG", "display_name": "Michael Snoyman", "link": "https://stackoverflow.com/users/369198/michael-snoyman"}, "reply_to_user": {"reputation": 523, "user_id": 1739395, "user_type": "registered", "accept_rate": 89, "profile_image": "https://www.gravatar.com/avatar/f6877c2a0e8b24a4b4c9b4700d33846e?s=128&d=identicon&r=PG", "display_name": "the-konapie", "link": "https://stackoverflow.com/users/1739395/the-konapie"}, "edited": false, "score": 0, "creation_date": 1425789370, "post_id": 28917805, "comment_id": 46103103, "body": "There&#39;s no problem doing that for learning purposes, in fact it&#39;s a good approach. I just wanted to make clear that this wasn&#39;t a great example of conduit&#39;s power/weight ratio."}], "tags": [], "owner": {"reputation": 30377, "user_id": 369198, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/71596bb1ca3ba3aa4400c3f407baec9f?s=128&d=identicon&r=PG", "display_name": "Michael Snoyman", "link": "https://stackoverflow.com/users/369198/michael-snoyman"}, "is_accepted": true, "score": 3, "last_activity_date": 1425749400, "creation_date": 1425749400, "answer_id": 28917805, "question_id": 28917108, "link": "https://stackoverflow.com/questions/28917108/haskell-conduit-having-a-sink-return-a-value-based-on-the-values-from-upstream/28917805#28917805", "title": "Haskell Conduit: having a Sink return a value based on the values from upstream", "body": "<p>This isn't really a good example for where conduit actually provides a lot of value, at least not the way you're looking at it right now. Specifically, you're trying to use the <code>read</code> function, which requires that the entire value be in memory. Additionally, your current error handling behavior is a bit loose. Essentially, you're just going to get an <code>read: no parse</code> error if there's anything unexpected in the content.</p>\n\n<p>However, there <em>is</em> a way we can play with this in conduit and be meaningful: by parsing the <code>ByteString</code> byte-by-byte ourselves and avoiding the <code>read</code> function. Fortunately, this pattern falls into a standard left fold, which the conduit-combinators package provides a perfect function for (element-wise left fold in a conduit, aka <code>foldlCE</code>):</p>\n\n<pre><code>{-# LANGUAGE OverloadedStrings #-}\nimport Conduit\nimport Data.Word8\nimport qualified Data.ByteString as S\n\nsinkInt :: Monad m =&gt; Consumer S.ByteString m Int\nsinkInt =\n    foldlCE go 0\n  where\n    go total w\n        | _0 &lt;= w &amp;&amp; w &lt;= _9 =\n            total * 10 + (fromIntegral $ w - _0)\n        | otherwise = error $ \"Invalid byte: \" ++ show w\n\nmain :: IO ()\nmain = do\n    x &lt;- yieldMany [\"1234\", \"5678\"] $$ sinkInt\n    print x\n</code></pre>\n\n<p>There are plenty of caveats that go along with this: it will simply throw an exception if there are unexpected bytes, and it doesn't handle integer overflow at all (though fixing <em>that</em> is just a matter of replacing <code>Int</code> with <code>Integer</code>). It's important to note that, since the in-memory string representation of a valid 32- or 64-bit int is always going to be tiny, conduit is overkill for this problem, though I hope that this code gives some guidance on how to generally write conduit code.</p>\n"}], "owner": {"reputation": 523, "user_id": 1739395, "user_type": "registered", "accept_rate": 89, "profile_image": "https://www.gravatar.com/avatar/f6877c2a0e8b24a4b4c9b4700d33846e?s=128&d=identicon&r=PG", "display_name": "the-konapie", "link": "https://stackoverflow.com/users/1739395/the-konapie"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 319, "favorite_count": 0, "accepted_answer_id": 28917805, "answer_count": 1, "score": 3, "last_activity_date": 1425749400, "creation_date": 1425745783, "question_id": 28917108, "link": "https://stackoverflow.com/questions/28917108/haskell-conduit-having-a-sink-return-a-value-based-on-the-values-from-upstream", "title": "Haskell Conduit: having a Sink return a value based on the values from upstream", "body": "<p>I've been trying to use the Conduit library to do some simple I/O involving files, but I'm having a hard time.</p>\n\n<p>I have a text file containing nothing but a few digits such as <code>1234</code>. I have a function that reads the file using <code>readFile</code> (no conduits), and returns <code>Maybe Int</code> (<code>Nothing</code> is returned when the file actually doesn't exist). I'm trying to write a version of this function that uses conduits, and I just can't figure it out.</p>\n\n<p>Here is what I have:</p>\n\n<pre><code>import Control.Monad.Trans.Resource\nimport Data.Conduit\nimport Data.Functor\nimport System.Directory\nimport qualified Data.ByteString.Char8 as B\nimport qualified Data.Conduit.Binary as CB\nimport qualified Data.Conduit.Text as CT\nimport qualified Data.Text as T\n\nmyFile :: FilePath\nmyFile = \"numberFile\"\n\nwithoutConduit :: IO (Maybe Int)\nwithoutConduit = do\n    doesExist &lt;- doesFileExist myFile\n    if doesExist\n      then Just . read &lt;$&gt; readFile myFile\n      else return Nothing\n\nwithConduit :: IO (Maybe Int)\nwithConduit = do\n    doesExist &lt;- doesFileExist myFile\n    if doesExist\n      then runResourceT $ source $$ conduit =$ sink\n      else return Nothing\n  where\n    source :: Source (ResourceT IO) B.ByteString\n    source = CB.sourceFile myFile\n\n    conduit :: Conduit B.ByteString (ResourceT IO) T.Text\n    conduit = CT.decodeUtf8\n\n    sink :: Sink T.Text (ResourceT IO) (Maybe Int)\n    sink = awaitForever $ \\txt -&gt; let num = read . T.unpack $ txt :: Int\n                                  in -- I don't know what to do here...\n</code></pre>\n\n<p>Could someone please help me complete the <code>sink</code> function?\nThanks!</p>\n"}, {"tags": ["haskell", "ubuntu", "supercollider"], "comments": [{"owner": {"reputation": 13807, "user_id": 2407038, "user_type": "registered", "accept_rate": 64, "profile_image": "https://www.gravatar.com/avatar/538f6f4a9aa43841841de7d8e8b169fc?s=128&d=identicon&r=PG&f=1", "display_name": "user2407038", "link": "https://stackoverflow.com/users/2407038/user2407038"}, "edited": false, "score": 0, "creation_date": 1425762650, "post_id": 28916854, "comment_id": 46097528, "body": "bitSizeMaybe is only present after base 4.7.0.0 - ghc 7.6.3 comes with base  4.6. I would say this is a majour error on the library implementors part. There may be an older version of hsc3 that was intended to work with ghc 7.6.3 - you could try that. Otherwise, you&#39;ll have to edit the source code or update ghc."}, {"owner": {"reputation": 27, "user_id": 3869303, "user_type": "registered", "profile_image": "https://graph.facebook.com/1599977816/picture?type=large", "display_name": "As&#237; Maull&#243; Josetustra", "link": "https://stackoverflow.com/users/3869303/as%c3%ad-maull%c3%b3-josetustra"}, "reply_to_user": {"reputation": 13807, "user_id": 2407038, "user_type": "registered", "accept_rate": 64, "profile_image": "https://www.gravatar.com/avatar/538f6f4a9aa43841841de7d8e8b169fc?s=128&d=identicon&r=PG&f=1", "display_name": "user2407038", "link": "https://stackoverflow.com/users/2407038/user2407038"}, "edited": false, "score": 0, "creation_date": 1425765281, "post_id": 28916854, "comment_id": 46098289, "body": "Thanks, I&#39;d never have guessed! I managed to install ghc 7.8, but both cabal and the terminal still access 7.6 - how do you uninstall a specific version of ghc?"}, {"owner": {"reputation": 13807, "user_id": 2407038, "user_type": "registered", "accept_rate": 64, "profile_image": "https://www.gravatar.com/avatar/538f6f4a9aa43841841de7d8e8b169fc?s=128&d=identicon&r=PG&f=1", "display_name": "user2407038", "link": "https://stackoverflow.com/users/2407038/user2407038"}, "edited": false, "score": 0, "creation_date": 1425770346, "post_id": 28916854, "comment_id": 46099708, "body": "If you&#39;ve installed the Haskell Platform, it comes with an uninstaller (at least on windows). The simplest way is to just delete the ghc and cabal directories."}], "owner": {"reputation": 27, "user_id": 3869303, "user_type": "registered", "profile_image": "https://graph.facebook.com/1599977816/picture?type=large", "display_name": "As&#237; Maull&#243; Josetustra", "link": "https://stackoverflow.com/users/3869303/as%c3%ad-maull%c3%b3-josetustra"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 42, "favorite_count": 0, "answer_count": 0, "score": 0, "last_activity_date": 1425747033, "creation_date": 1425744308, "last_edit_date": 1425747033, "question_id": 28916854, "link": "https://stackoverflow.com/questions/28916854/haskell-installing-hsc3-in-kxstudio-ubuntu", "title": "(Haskell) Installing hsc3 in KXStudio (Ubuntu)", "body": "<p>I'm trying to install <code>hsc3</code> following this tutorial:\n<a href=\"http://rd.slavepianos.org/?t=hsc3-texts&amp;e=lhs/hsc3-tutorial.lhs\" rel=\"nofollow\">http://rd.slavepianos.org/?t=hsc3-texts&amp;e=lhs/hsc3-tutorial.lhs</a></p>\n\n<p>But I get this error: </p>\n\n<blockquote>\n  <p>Sound/SC3/UGen/Type.hs:482:5:\n      <code>bitSizeMaybe' is not a (visible) method of class</code>Bits'</p>\n  \n  <p>Failed to install hsc3-0.16\n  cabal: </p>\n  \n  <p>Error: some packages failed to install:\n  hsc3-0.16 failed during the building phase. The exception was:\n  ExitFailure 1</p>\n</blockquote>\n\n<p>Tried both the <code>\"cabal install hsc3\"</code> method and downloading from the <code>darcs</code> repository.</p>\n\n<blockquote>\n  <p>GHC --version is 7.6.3</p>\n</blockquote>\n\n<p>I'm probably missing something trivial.</p>\n"}, {"tags": ["haskell"], "answers": [{"tags": [], "owner": {"reputation": 158, "user_id": 2512259, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/1a349b2b2439bbd5e39f6944fa1f5bdf?s=128&d=identicon&r=PG", "display_name": "Sebastiaan", "link": "https://stackoverflow.com/users/2512259/sebastiaan"}, "is_accepted": false, "score": 2, "last_activity_date": 1425742970, "creation_date": 1425742970, "answer_id": 28916613, "question_id": 28916291, "link": "https://stackoverflow.com/questions/28916291/associativity-of/28916613#28916613", "title": "Associativity of -&gt;", "body": "<p>The -> operator is right associative. Here is a place where that's documented:\n<a href=\"https://wiki.haskell.org/Partial_application\" rel=\"nofollow\">https://wiki.haskell.org/Partial_application</a></p>\n\n<p>There are two reasons why :i (>>=) and :i (->) are different:</p>\n\n<ul>\n<li>(>>=) is a function, but (->) can only occur in the type of a\nfunction</li>\n<li>(>>=) is actually defined somewhere (for each Monad type),\nbut (->) is built-in</li>\n</ul>\n\n<p>Why does right associativity makes sense? Whenever a function has an argument which is a function itself, you want to make this explicit. Take for example \"map\":</p>\n\n<pre><code>:t map\nmap :: (a -&gt; b) -&gt; [a] -&gt; [b]\n</code></pre>\n\n<p>Map is a function which takes two arguments, the first is of the type (a -> b), so it is clearly a function, and the second is of the type [a]. It returns [b]. We could of course (since -> is right-associative) read Map as having the type:</p>\n\n<pre><code>map :: (a -&gt; b) -&gt; ([a] -&gt; [b])\n</code></pre>\n\n<p>While this is precisely the same type, we now read map as taking one argument, which is a function of the type (a -> b), and returning another function, which is of type ([a] -> [b]). These two ways to understand the type of map are described in the partial application article above.</p>\n"}, {"comments": [{"owner": {"reputation": 44013, "user_id": 1477667, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/trgKM.jpg?s=128&g=1", "display_name": "dfeuer", "link": "https://stackoverflow.com/users/1477667/dfeuer"}, "edited": false, "score": 0, "creation_date": 1425743684, "post_id": 28916648, "comment_id": 46091234, "body": "It seems to be in section 10.5: context-free syntax. <code>type</code>, <code>btype</code>, and <code>atype</code> productions, and maybe a bit more."}, {"owner": {"reputation": 69792, "user_id": 493122, "user_type": "registered", "accept_rate": 96, "profile_image": "https://www.gravatar.com/avatar/1f90ae01c2e24801c2df9189179b0ccd?s=128&d=identicon&r=PG", "display_name": "Shoe", "link": "https://stackoverflow.com/users/493122/shoe"}, "reply_to_user": {"reputation": 44013, "user_id": 1477667, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/trgKM.jpg?s=128&g=1", "display_name": "dfeuer", "link": "https://stackoverflow.com/users/1477667/dfeuer"}, "edited": false, "score": 0, "creation_date": 1425743773, "post_id": 28916648, "comment_id": 46091261, "body": "@dfeuer Nope, page 38 from the link."}, {"owner": {"reputation": 44013, "user_id": 1477667, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/trgKM.jpg?s=128&g=1", "display_name": "dfeuer", "link": "https://stackoverflow.com/users/1477667/dfeuer"}, "edited": false, "score": 0, "creation_date": 1425743811, "post_id": 28916648, "comment_id": 46091273, "body": "Sorry, I meant the specific productions."}], "tags": [], "owner": {"reputation": 69792, "user_id": 493122, "user_type": "registered", "accept_rate": 96, "profile_image": "https://www.gravatar.com/avatar/1f90ae01c2e24801c2df9189179b0ccd?s=128&d=identicon&r=PG", "display_name": "Shoe", "link": "https://stackoverflow.com/users/493122/shoe"}, "is_accepted": true, "score": 5, "last_activity_date": 1425753380, "last_edit_date": 1425753380, "creation_date": 1425743173, "answer_id": 28916648, "question_id": 28916291, "link": "https://stackoverflow.com/questions/28916291/associativity-of/28916648#28916648", "title": "Associativity of -&gt;", "body": "<p>From the <a href=\"https://www.haskell.org/onlinereport/haskell2010/haskellch4.html#x10-630004.1\" rel=\"nofollow noreferrer\">Haskell 2010 Language Report</a> at \u00a74.1.2 (Syntax of Types), page 38:</p>\n\n<blockquote>\n  <p>A function type has the form <code>t1 -&gt; t2</code>, which is equivalent to the type <code>(-&gt;) t1 t2</code>. Function arrows associate to the right. For example, <code>Int -&gt; Int -&gt; Float</code> means <code>Int -&gt; (Int -&gt; Float)</code>.</p>\n</blockquote>\n\n<p>Here you can find the context in the report:</p>\n\n<p><img src=\"https://i.stack.imgur.com/DUmY8.png\" alt=\"Image showing the context in which the quote above was taken\"></p>\n"}, {"tags": [], "owner": {"reputation": 17809, "user_id": 1088108, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/63781cd38e91aa346a3849bc3ef3e550?s=128&d=identicon&r=PG&f=1", "display_name": "&#216;rjan Johansen", "link": "https://stackoverflow.com/users/1088108/%c3%98rjan-johansen"}, "is_accepted": false, "score": 4, "last_activity_date": 1425745940, "last_edit_date": 1425745940, "creation_date": 1425745082, "answer_id": 28916978, "question_id": 28916291, "link": "https://stackoverflow.com/questions/28916291/associativity-of/28916978#28916978", "title": "Associativity of -&gt;", "body": "<p>The other answers apply to the standard language, in which <code>-&gt;</code> is the only infix type operator and so may be considered pure syntax.  However, GHC has the <code>TypeOperators</code> extension, so then it's a bit more subtle.  <a href=\"https://downloads.haskell.org/~ghc/latest/docs/html/users_guide/data-type-extensions.html#infix-tycons\" rel=\"nofollow\">From the manual</a>:</p>\n\n<blockquote>\n  <ul>\n  <li>Function arrow is <code>infixr</code> with fixity 0. (This might change; I'm not sure what it should be.)</li>\n  </ul>\n</blockquote>\n\n<p>Given this it might be considered a bug that it doesn't list the fixity with <code>:i</code>. (Edit: Made a <a href=\"https://ghc.haskell.org/trac/ghc/ticket/10145#ticket\" rel=\"nofollow\">ticket</a>.)</p>\n"}], "owner": {"reputation": 43759, "user_id": 1651941, "user_type": "registered", "accept_rate": 97, "profile_image": "https://www.gravatar.com/avatar/a513bc1fa519d2fcf5e4e0d9b5500101?s=128&d=identicon&r=PG", "display_name": "Sibi", "link": "https://stackoverflow.com/users/1651941/sibi"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 207, "favorite_count": 1, "accepted_answer_id": 28916648, "answer_count": 3, "score": 3, "last_activity_date": 1425753380, "creation_date": 1425741049, "question_id": 28916291, "link": "https://stackoverflow.com/questions/28916291/associativity-of", "title": "Associativity of -&gt;", "body": "<p>For monad bind operator, I can find that it's associativity is left from <code>ghci</code> using:</p>\n\n<pre><code>\u03bb&gt; :i (&gt;&gt;=)\nclass Monad (m :: * -&gt; *) where\n  (&gt;&gt;=) :: m a -&gt; (a -&gt; m b) -&gt; m b\n  ...\n    -- Defined in \u2018GHC.Base\u2019\ninfixl 1 &gt;&gt;=\n</code></pre>\n\n<p>But the same doesn't work for <code>-&gt;</code>:</p>\n\n<pre><code>\u03bb&gt; :i (-&gt;)\ndata (-&gt;) a b   -- Defined in \u2018GHC.Prim\u2019\ninstance Monad ((-&gt;) r) -- Defined in \u2018GHC.Base\u2019\ninstance Functor ((-&gt;) r) -- Defined in \u2018GHC.Base\u2019\n</code></pre>\n\n<p>Where exactly it's associativity is documented (Link to Haskell report is welcome, but I was not able to find there in my attempt) ? </p>\n"}, {"tags": ["image", "haskell"], "comments": [{"owner": {"reputation": 1367, "user_id": 1160885, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/dc61c1b2045efa54375188bdb6a33945?s=128&d=identicon&r=PG", "display_name": "Jedai", "link": "https://stackoverflow.com/users/1160885/jedai"}, "edited": false, "score": 2, "creation_date": 1425753837, "post_id": 28915099, "comment_id": 46094719, "body": "I would suggest profiling as a first step maybe ? Because I don&#39;t really see why this would be so slow except if <code>generateImage</code> was very hard to optimize (you <i>are</i> compiling this with -O2, right ?) or your <code>f</code> was doing some strange business (can you show its code ?)."}, {"owner": {"reputation": 233, "user_id": 4389564, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/iHnQR.png?s=128&g=1", "display_name": "Month", "link": "https://stackoverflow.com/users/4389564/month"}, "reply_to_user": {"reputation": 1367, "user_id": 1160885, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/dc61c1b2045efa54375188bdb6a33945?s=128&d=identicon&r=PG", "display_name": "Jedai", "link": "https://stackoverflow.com/users/1160885/jedai"}, "edited": false, "score": 0, "creation_date": 1425797029, "post_id": 28915099, "comment_id": 46104281, "body": "Yes, I&#39;m compiling with O2, I&#39;ve found it to have tremendious deffrence) I&#39;ve included code and profiling results to the post."}, {"owner": {"reputation": 23444, "user_id": 414413, "user_type": "registered", "accept_rate": 79, "profile_image": "https://www.gravatar.com/avatar/6de2113f01432aa844dc85070ff33e89?s=128&d=identicon&r=PG", "display_name": "Cirdec", "link": "https://stackoverflow.com/users/414413/cirdec"}, "edited": false, "score": 0, "creation_date": 1425799471, "post_id": 28915099, "comment_id": 46104725, "body": "What are the contents of <code>config.txt</code>? How large are the polynomials for <code>eval</code>? You may be spending a lot of time computing the degree over and over again (<code>fromIntegral (length ps)</code>)."}, {"owner": {"reputation": 233, "user_id": 4389564, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/iHnQR.png?s=128&g=1", "display_name": "Month", "link": "https://stackoverflow.com/users/4389564/month"}, "edited": false, "score": 0, "creation_date": 1425800607, "post_id": 28915099, "comment_id": 46104904, "body": "It&#39;s really small:  256 256 &#39;\\n&#39;  -1 -1 &#39;\\n&#39;  1 1 &#39;\\n&#39;  1 0 0 1 &#39;\\n&#39;   i.e, is 256x256 pixels, 3rd degree polynomial."}, {"owner": {"reputation": 233, "user_id": 4389564, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/iHnQR.png?s=128&g=1", "display_name": "Month", "link": "https://stackoverflow.com/users/4389564/month"}, "edited": false, "score": 0, "creation_date": 1425801943, "post_id": 28915099, "comment_id": 46105180, "body": "Cirdec, however, by replacing  &quot;p * z ** (fromIntegral (length ps) )&quot; with &quot;p * (z ^ (length ps))&quot; I&#39;ve obtained 20% speedup. Tnanks for the idea!"}, {"owner": {"reputation": 1367, "user_id": 1160885, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/dc61c1b2045efa54375188bdb6a33945?s=128&d=identicon&r=PG", "display_name": "Jedai", "link": "https://stackoverflow.com/users/1160885/jedai"}, "edited": false, "score": 1, "creation_date": 1425807569, "post_id": 28915099, "comment_id": 46106458, "body": "<code>eval</code> is a classic, the efficient way to compute it is : <code>eval cs z = foldl&#39; (\\beg c -&gt; beg * z + c) cs</code>. That should already help a lot."}, {"owner": {"reputation": 1367, "user_id": 1160885, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/dc61c1b2045efa54375188bdb6a33945?s=128&d=identicon&r=PG", "display_name": "Jedai", "link": "https://stackoverflow.com/users/1160885/jedai"}, "edited": false, "score": 1, "creation_date": 1425809017, "post_id": 28915099, "comment_id": 46106787, "body": "Though if you really wanted something competitive, the way to go would probably be to start by compiling JIT your polynomials to function (with <a href=\"https://hackage.haskell.org/package/llvm-general\" rel=\"nofollow noreferrer\">llvm</a> for example)."}, {"owner": {"reputation": 233, "user_id": 4389564, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/iHnQR.png?s=128&g=1", "display_name": "Month", "link": "https://stackoverflow.com/users/4389564/month"}, "edited": false, "score": 0, "creation_date": 1425829238, "post_id": 28915099, "comment_id": 46112416, "body": "Changing eval to <code>eval cs z = foldl1 (\\beg c -&gt; beg * z + c) cs</code> sped up things almost 30%, thank you! I do beleve that it should be <code>foldl1</code>, not <code>foldl&#39;</code>, right? The CPU load is still low, though("}, {"owner": {"reputation": 1367, "user_id": 1160885, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/dc61c1b2045efa54375188bdb6a33945?s=128&d=identicon&r=PG", "display_name": "Jedai", "link": "https://stackoverflow.com/users/1160885/jedai"}, "edited": false, "score": 0, "creation_date": 1425834621, "post_id": 28915099, "comment_id": 46114492, "body": "<code>foldl1&#39;</code> rather than <code>foldl1</code> if you wish to be explicit on the strictness (it is vaguely possible that -O2 is already doing the right transformation but not certain, so it is better to use Data.List.foldl1&#39; )"}, {"owner": {"reputation": 233, "user_id": 4389564, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/iHnQR.png?s=128&g=1", "display_name": "Month", "link": "https://stackoverflow.com/users/4389564/month"}, "edited": false, "score": 0, "creation_date": 1425836479, "post_id": 28915099, "comment_id": 46115211, "body": "Changing from <code>foldl1&#39;</code> to <code>foldl1</code> did not affect the perfomance, so I guess O2 really does that as you say."}, {"owner": {"reputation": 23444, "user_id": 414413, "user_type": "registered", "accept_rate": 79, "profile_image": "https://www.gravatar.com/avatar/6de2113f01432aa844dc85070ff33e89?s=128&d=identicon&r=PG", "display_name": "Cirdec", "link": "https://stackoverflow.com/users/414413/cirdec"}, "edited": false, "score": 0, "creation_date": 1425957267, "post_id": 28915099, "comment_id": 46164399, "body": "What version of ghc are you using? On my machine with ghc 7.8.3, your update 2 code runs for images up to at least 5020x5020 without overflowing the stack, even with the stack size set to only 8 megabytes with <code>+RTS -k8M</code>. (You can compile in the <code>-N</code> option with <code>-with-rtsopts=-N</code>)."}, {"owner": {"reputation": 233, "user_id": 4389564, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/iHnQR.png?s=128&g=1", "display_name": "Month", "link": "https://stackoverflow.com/users/4389564/month"}, "edited": false, "score": 0, "creation_date": 1425962569, "post_id": 28915099, "comment_id": 46165713, "body": "I&#39;m using  7.4.1.  I was able to run 2048x2048 with -k8M, it took almost 10 minutes, yet the CPU was loaded so I guess the parallelesation was succesfull) Strange though that 8M is very close to default value and yet it&#39;s enough. Thank you!"}], "answers": [{"comments": [{"owner": {"reputation": 233, "user_id": 4389564, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/iHnQR.png?s=128&g=1", "display_name": "Month", "link": "https://stackoverflow.com/users/4389564/month"}, "edited": false, "score": 0, "creation_date": 1425797165, "post_id": 28919863, "comment_id": 46104304, "body": "I&#39;ve tried your code, it compiled but provided excatly the same work time as generateImage. I&#39;ve added -threaded flag and run the program with +RTS -N, with diffrent Ns, and no change in perfomance was achived at all :( I&#39;m running Core i7, so CPU should handle threads. Also I&#39;ve added profiling results for my code to post."}, {"owner": {"reputation": 1367, "user_id": 1160885, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/dc61c1b2045efa54375188bdb6a33945?s=128&d=identicon&r=PG", "display_name": "Jedai", "link": "https://stackoverflow.com/users/1160885/jedai"}, "edited": false, "score": 0, "creation_date": 1425815510, "post_id": 28919863, "comment_id": 46108357, "body": "Given that this code is creating one spark per pixel, I&#39;m a bit surprised it doesn&#39;t do much worse than the original.... Almost certainly, the right way to proceed would only be to do this in chunks (by creating a <code>newMutableImage</code> and populating it with unsafe operations in several threads, of course with a safe encapsulation). But if you have to generate many images, the right course would simply be to generate several image in parallel rather than trying to generate each image in parallel..."}, {"owner": {"reputation": 233, "user_id": 4389564, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/iHnQR.png?s=128&g=1", "display_name": "Month", "link": "https://stackoverflow.com/users/4389564/month"}, "edited": false, "score": 0, "creation_date": 1425829451, "post_id": 28919863, "comment_id": 46112492, "body": "I want to render one high-quality image (something like 5000x5000) rather than a series of images... Do I understand right that this <code>newMutableImage</code> should be inherited somehow from Codec&#39;s Image?"}, {"owner": {"reputation": 1367, "user_id": 1160885, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/dc61c1b2045efa54375188bdb6a33945?s=128&d=identicon&r=PG", "display_name": "Jedai", "link": "https://stackoverflow.com/users/1160885/jedai"}, "edited": false, "score": 0, "creation_date": 1425834857, "post_id": 28919863, "comment_id": 46114587, "body": "Inherited isn&#39;t the right word. <code>MutableImage</code> are another type from JuicyPixel that can be modified in-place (only in the ST monad though, to guarantee that any function that manipulate them internally will be pure externally). Read the code of <a href=\"https://hackage.haskell.org/package/JuicyPixels-3.2.3/docs/src/Codec-Picture-Types.html#generateImage\" rel=\"nofollow noreferrer\"><code>generateImage</code></a> and other similar functions to see how they could be used (or directly the mutable vector that are part of them)."}, {"owner": {"reputation": 23444, "user_id": 414413, "user_type": "registered", "accept_rate": 79, "profile_image": "https://www.gravatar.com/avatar/6de2113f01432aa844dc85070ff33e89?s=128&d=identicon&r=PG", "display_name": "Cirdec", "link": "https://stackoverflow.com/users/414413/cirdec"}, "reply_to_user": {"reputation": 233, "user_id": 4389564, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/iHnQR.png?s=128&g=1", "display_name": "Month", "link": "https://stackoverflow.com/users/4389564/month"}, "edited": false, "score": 0, "creation_date": 1425848786, "post_id": 28919863, "comment_id": 46119434, "body": "@Month The work can be partitioned into a smaller number of pieces without resorting to using mutable data structures, see my updated answer. This incurs additional overhead (as does any parallelism); it might be less than the overhead of a spark per pixel In general, parallelizing code will only be advantageous when the cost of the work to be done dominates the cost of parallelism."}, {"owner": {"reputation": 233, "user_id": 4389564, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/iHnQR.png?s=128&g=1", "display_name": "Month", "link": "https://stackoverflow.com/users/4389564/month"}, "edited": false, "score": 0, "creation_date": 1425879613, "post_id": 28919863, "comment_id": 46126986, "body": "@Cirdec, I&#39;ve run your code and increased the perfomance almost two times for images with sides from 256x256 to 1024x1024, with perfomance impoving more as image get bigger. However, when I try to run it on 2048x2048 image, it either fails with message <code>Stack space overflow: current size 8388608 bytes.</code> or tries to alloctae something like 3.5 Gb in RAM, after what the OS (Debian in my case) kills it. What can cause such huge memory consumption?"}, {"owner": {"reputation": 23444, "user_id": 414413, "user_type": "registered", "accept_rate": 79, "profile_image": "https://www.gravatar.com/avatar/6de2113f01432aa844dc85070ff33e89?s=128&d=identicon&r=PG", "display_name": "Cirdec", "link": "https://stackoverflow.com/users/414413/cirdec"}, "reply_to_user": {"reputation": 233, "user_id": 4389564, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/iHnQR.png?s=128&g=1", "display_name": "Month", "link": "https://stackoverflow.com/users/4389564/month"}, "edited": false, "score": 0, "creation_date": 1425881370, "post_id": 28919863, "comment_id": 46127448, "body": "@Month I think I messed up <code>mkArrayPar</code>; it was still making too many sparks. There&#39;s a new <code>mkArrayPar</code> in the answer. All of the pixels have to be put into lists, which can be many times bigger than the array, the overhead from that might be too much. A quick estimate puts it at <code>(8+8+8+8+8)*2048*2048</code> bytes or about 160 megabytes for the lists."}, {"owner": {"reputation": 233, "user_id": 4389564, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/iHnQR.png?s=128&g=1", "display_name": "Month", "link": "https://stackoverflow.com/users/4389564/month"}, "edited": false, "score": 0, "creation_date": 1425882669, "post_id": 28919863, "comment_id": 46127821, "body": "@Cirdec thank you for an update, but the problem remains in the updated code: it fails on my PC on 2048x2048 images with <code>Stack space overflow: current size 8388608 bytes.</code>. However, now doesn&#39;t try to allocate huge amout of RAM)"}, {"owner": {"reputation": 23444, "user_id": 414413, "user_type": "registered", "accept_rate": 79, "profile_image": "https://www.gravatar.com/avatar/6de2113f01432aa844dc85070ff33e89?s=128&d=identicon&r=PG", "display_name": "Cirdec", "link": "https://stackoverflow.com/users/414413/cirdec"}, "reply_to_user": {"reputation": 233, "user_id": 4389564, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/iHnQR.png?s=128&g=1", "display_name": "Month", "link": "https://stackoverflow.com/users/4389564/month"}, "edited": false, "score": 0, "creation_date": 1425918023, "post_id": 28919863, "comment_id": 46147719, "body": "@Month Can you update the code in the question with what you are using now (<code>eval</code>, any other changes you&#39;ve made to the fractal part) and include either the problematic <code>Params</code> or <code>config.txt</code>?"}, {"owner": {"reputation": 233, "user_id": 4389564, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/iHnQR.png?s=128&g=1", "display_name": "Month", "link": "https://stackoverflow.com/users/4389564/month"}, "edited": false, "score": 0, "creation_date": 1425952645, "post_id": 28919863, "comment_id": 46163392, "body": "@Cirdec, sure. I&#39;ve update the post (<b>UPDATE 2</b>) with the new code based on your new <code>generateImagePar</code>."}], "tags": [], "owner": {"reputation": 23444, "user_id": 414413, "user_type": "registered", "accept_rate": 79, "profile_image": "https://www.gravatar.com/avatar/6de2113f01432aa844dc85070ff33e89?s=128&d=identicon&r=PG", "display_name": "Cirdec", "link": "https://stackoverflow.com/users/414413/cirdec"}, "is_accepted": true, "score": 1, "last_activity_date": 1425881087, "last_edit_date": 1425881087, "creation_date": 1425761627, "answer_id": 28919863, "question_id": 28915099, "link": "https://stackoverflow.com/questions/28915099/creating-image-from-function-in-parallel/28919863#28919863", "title": "Creating image from function in parallel", "body": "<p>You can calculate the pixels in parallel before generating the image. To make the pixel lookup for <code>generateImage</code> simple, we'll stuff all of the pixels into an <a href=\"https://hackage.haskell.org/package/array-0.5.0.0/docs/Data-Array.html\" rel=\"nofollow\"><code>Array</code></a>.</p>\n\n<pre><code>{-# LANGUAGE RankNTypes #-}\n\nimport Data.Array\nimport Control.Parallel.Strategies\n</code></pre>\n\n<p>To generate the image in parallel, we'll calculate the pixels in parallel for each boint within the <a href=\"https://hackage.haskell.org/package/base-4.7.0.0/docs/Data-Ix.html#v:range\" rel=\"nofollow\"><code>range</code></a> of the <code>bounds</code> of the image. We'll build a temporary <code>Array</code> to hold all the pixels. The array's lookup function, <a href=\"https://hackage.haskell.org/package/array-0.5.0.0/docs/Data-Array.html#v:-33-\" rel=\"nofollow\"><code>!</code></a> will provide an efficient lookup function to pass to <code>generateImage</code>.</p>\n\n<pre><code>generateImagePar :: forall a . Pixel a  =&gt; (Int -&gt; Int -&gt; a) -&gt; Int -&gt; Int -&gt; Image a\ngenerateImagePar f w h = generateImage f' w h\n    where\n        bounds     = ((0, 0), (w-1,h-1))\n        pixels     = parMap rseq (uncurry f) (range bounds)\n        pixelArray = listArray bounds pixels\n        f'         = curry (pixelArray !)\n</code></pre>\n\n<p>We can then write your example in terms of <code>generateImagePar</code>.</p>\n\n<pre><code>writePng \"test.png\" $ generateImagePar f width height\n</code></pre>\n\n<p>This may be no faster and may in fact be slower than using <code>generateImage</code>. It's important to profile your code to understand <em>why</em> it is slow before attempting to improve its performance. For example, if your program is memory starved or is thrashing resources, using <code>generateImagePar</code> will certainly be slower than using <code>generateImage</code>.</p>\n\n<h3>Partitioning the work</h3>\n\n<p>We can partition the work into chunks to reduce the number of sparks without resorting to any sort of mutable data structure. First we'll define the class of indexes whose ranges can be divided into partitions. We'll define a default for dividing up numeric ranges.</p>\n\n<pre><code>class Ix a =&gt; Partitionable a where\n    partition :: Int -&gt; (a, a) -&gt; [(a, a)]\n\n    default partition :: (Num a) =&gt; Int -&gt; (a, a) -&gt; [(a, a)]\n    partition n r@(l,_) = zipWith (\\x y -&gt; (x, x+y-1)) starts steps\n        where\n            (span, longerSpans) = rangeSize r `quotRem` n\n            steps = zipWith (+) (replicate (min (rangeSize r) n) (fromIntegral span)) (replicate longerSpans 1 ++ repeat 0)\n            starts = scanl (+) l steps\n</code></pre>\n\n<p><code>Int</code>s (and any other <code>Num</code>) can be made <code>Partitionable</code> using the default implementation.</p>\n\n<pre><code>instance Partitionable Int\n</code></pre>\n\n<p>Index products can be partitioned by first partitioning the first dimension, and then partitioning the second dimension if there aren't enough possible divisions in the first dimension.</p>\n\n<pre><code>instance (Partitionable a, Partitionable b) =&gt; Partitionable (a, b) where\n    partition n ((x0,y0), (x1, y1)) = do\n        xr'@(x0', x1') &lt;- partition n (x0, x1)\n        let n' = n * rangeSize xr' `div` rangeSize (x0, x1)\n        (y0', y1') &lt;- partition n' (y0, y1)\n        return ((x0', y0'), (x1', y1'))\n</code></pre>\n\n<p>We can build an array in parallel by partitioning the work into units and sparking each work unit.</p>\n\n<pre><code>mkArrayPar :: (Partitionable i) =&gt; Int -&gt; Strategy e -&gt; (i, i) -&gt; (i -&gt; e) -&gt; Array i e\nmkArrayPar n s bounds f = listArray bounds (concat workUnits)\n    where\n        partitions = partition n bounds\n        workUnits  = parMap (evalList s) (map f . range) partitions\n</code></pre>\n\n<p>Now we can define <code>generateImagePar</code> in terms of making an array in parallel. A good number of partitions is a small multiple of the number of actual processors, <a href=\"http://hackage.haskell.org/package/base-4.7.0.2/docs/GHC-Conc-Sync.html#v:numCapabilities\" rel=\"nofollow\"><code>numCapabilities</code></a>; we'll start up to <code>1</code> partition per processor.</p>\n\n<pre><code>import GHC.Conc (numCapabilities)\n\ngenerateImagePar :: forall a . Pixel a  =&gt; (Int -&gt; Int -&gt; a) -&gt; Int -&gt; Int -&gt; Image a\ngenerateImagePar f w h = generateImage f' w h\n    where\n        bounds = ((0, 0), (w-1,h-1))\n        pixels = mkArrayPar numCapabilities rseq bounds (uncurry f)\n        f'     = curry (pixels !)\n</code></pre>\n"}], "owner": {"reputation": 233, "user_id": 4389564, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/iHnQR.png?s=128&g=1", "display_name": "Month", "link": "https://stackoverflow.com/users/4389564/month"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 551, "favorite_count": 1, "accepted_answer_id": 28919863, "answer_count": 1, "score": 2, "last_activity_date": 1425952534, "creation_date": 1425732983, "last_edit_date": 1425952534, "question_id": 28915099, "link": "https://stackoverflow.com/questions/28915099/creating-image-from-function-in-parallel", "title": "Creating image from function in parallel", "body": "<p>I'm writting a parogram in Haskell that creates a fractal and writes to a PNG file. I have a function </p>\n\n<pre><code>f:: Int-&gt;Int-&gt;PixelRGB8\n</code></pre>\n\n<p>which calcualtes color of the pixel with given image coordinates. (The output color format, PixelRGB8, is not important, I can easilly change it to, say, RGB tuple or anything).</p>\n\n<p>Using Codec.Picture, I can write</p>\n\n<pre><code>writePng \"test.png\" $ generateImage f width height \n</code></pre>\n\n<p>which indeed writes the desired image file. However, it works very slowly and I can see that my CPU load is low. I want to use parallel computations, since the computation of each pixel value does not depend on its neighbors. As far as I can see, Codec.Picture does not provide any means to do it. I understand how parMap works, but I can't see a way to apply it here. I think one possible solution  is to use repa.DevIL, but I'm kinda lost in its multidimusional arrays notation which looks like an overkill in my case. So, the question is: how to construct an image file from given function using parallel?</p>\n\n<p><strong>UPDATE</strong>. Here's a complete code (function 'extract' is ommited because it's long and called only one time):</p>\n\n<pre><code>import Data.Complex\nimport System.IO\nimport Data.List.Split\nimport Codec.Picture\n\neval:: (Floating a) =&gt; [a] -&gt; a -&gt; a\neval [p] _    = p\neval (p:ps) z = p * z ** (fromIntegral (length ps) ) + (eval ps z)\n\ntype Comp = Complex Double\n\n-- func, der, z, iter\nconvergesOrNot:: (Comp -&gt; Comp) -&gt; (Comp -&gt; Comp) -&gt; Comp-&gt;Int -&gt; Int\nconvergesOrNot _ _ _ 0 = 0\nconvergesOrNot f d z iter | realPart (abs (f z) ) &lt; 1e-6 = 1\n              | otherwise = convergesOrNot f d (z - (f z)/(d z)) (iter-1)\n\n-- x, y, f,d, xMin, xMin, stepX, stepY\ngetPixel:: Int-&gt;Int-&gt;(Comp-&gt;Comp)-&gt;(Comp-&gt;Comp)-&gt;Double-&gt;Double-&gt;Double-&gt;Double-&gt;PixelRGB8\ngetPixel x y f d xMin yMin stepX stepY | convergesOrNot f d z 16 == 1 = PixelRGB8 255 255 255\n                       | otherwise = PixelRGB8 0 0 0\n    where\n        real = xMin + (fromIntegral x)*stepX\n        imag = yMin + (fromIntegral y)*stepY\n        z = real :+ imag; \n\ndata Params = Params{f :: [Comp],\n             d :: [Comp],\n             xMin::Double,\n             yMin::Double,\n             stepX::Double,\n             stepY::Double,\n             width::Int,\n             height::Int        \n            } deriving (Show)\n\ngetPixelParams:: Int-&gt;Int-&gt;Params-&gt;PixelRGB8\ngetPixelParams x y params = getPixel x y func derv (xMin params) (yMin params) (stepX params) (stepY params)\n    where\n        func = \\z -&gt; eval (f params) z\n        derv = \\z -&gt; eval (d params) z\n\nmain = do\n    handle &lt;- openFile \"config.txt\" ReadMode\n    config &lt;- hGetContents handle\n    let params = extract config\n    writePng \"test.png\" $ generateImage (\\x y -&gt; getPixelParams x y params) (width params) (height params)\n    hClose handle\n</code></pre>\n\n<p>The profiling shows that most of the time is spent in eval function. Result (the .prof file ) is as follows (it's only the top part of file, the rest is bunch of zeroes):</p>\n\n<pre><code>COST CENTRE                                       MODULE                               no.     entries  %time %alloc   %time %alloc\n\nMAIN                                              MAIN                                  91           0    0.0    0.0   100.0  100.0\n main                                             Main                                 183           0    0.0    0.0    99.9  100.0\n  main.\\                                          Main                                 244           0    0.0    0.0     0.0    0.0\n   getPixelParams                                 Main                                 245           0    0.0    0.0     0.0    0.0\n    getPixelParams.derv                           Main                                 269           1    0.0    0.0     0.0    0.0\n    getPixelParams.func                           Main                                 246           1    0.0    0.0     0.0    0.0\n  generateImage                                   Codec.Picture.Types                  199           1    0.0    0.0    99.8   99.9\n   generateImage.generated                        Codec.Picture.Types                  234           1    0.0    0.0    99.8   99.9\n    generateImage.generated.lineGenerator         Codec.Picture.Types                  238         257    0.0    0.0    99.8   99.9\n     generateImage.generated.lineGenerator.column Codec.Picture.Types                  239       65792    0.5    0.8    99.8   99.9\n      unsafeWritePixel                            Codec.Picture.Types                  275       65536    0.0    0.0     0.0    0.0\n      main.\\                                      Main                                 240       65536    0.1    0.0    99.2   99.1\n       getPixelParams                             Main                                 241       65536    0.7    0.0    99.1   99.1\n        getPixelParams.derv                       Main                                 270           0    0.2    0.0    19.3   18.5\n         getPixelParams.derv.\\                    Main                                 271      463922    0.2    0.0    19.2   18.5\n          eval                                    Main                                 272     1391766   18.9   18.5    18.9   18.5\n        getPixelParams.func                       Main                                 247           0    0.5    0.0    62.3   59.0\n         getPixelParams.func.\\                    Main                                 248      993380    0.4    0.0    61.8   59.0\n          eval                                    Main                                 249     3973520   61.4   59.0    61.4   59.0\n        getPixel                                  Main                                 242       65536    0.2    0.0    16.7   21.5\n         getPixel.imag                            Main                                 262         256    0.0    0.0     0.0    0.0\n         getPixel.z                               Main                                 261       65536    0.1    0.1     0.1    0.1\n         getPixel.real                            Main                                 251       65536    0.2    0.1     0.2    0.1\n         convergesOrNot                           Main                                 243      531889   16.3   21.3    16.3   21.3\n</code></pre>\n\n<p><strong>UPDATE 2</strong> After a number of changes from @Cirdec and @Jedai, the code looks like this:</p>\n\n<pre><code>import Data.Complex\nimport System.IO\nimport Data.List.Split\nimport qualified Data.List as DL \n\nimport Codec.Picture\nimport Codec.Picture.Types\n\nimport Control.Parallel\nimport Data.Array\nimport Control.Parallel.Strategies\n\nimport GHC.Conc (numCapabilities)\n\nclass Ix a =&gt; Partitionable a where\n    partition :: Int -&gt; (a, a) -&gt; [(a, a)]\n\n    default partition :: (Num a) =&gt; Int -&gt; (a, a) -&gt; [(a, a)]\n    partition n r@(l,_) = zipWith (\\x y -&gt; (x, x+y-1)) starts steps\n        where\n            (span, longerSpans) = rangeSize r `quotRem` n\n            steps = zipWith (+) (replicate (min (rangeSize r) n) (fromIntegral span)) (replicate longerSpans 1 ++ repeat 0)\n            starts = scanl (+) l steps\n\ninstance Partitionable Int\n\ninstance (Partitionable a, Partitionable b) =&gt; Partitionable (a, b) where\n    partition n ((x0,y0), (x1, y1)) = do\n        xr'@(x0', x1') &lt;- partition n (x0, x1)\n        let n' = n * rangeSize xr' `div` rangeSize (x0, x1)\n        (y0', y1') &lt;- partition n' (y0, y1)\n        return ((x0', y0'), (x1', y1'))       \n\nmkArrayPar :: (Partitionable i) =&gt; Int -&gt; Strategy e -&gt; (i, i) -&gt; (i -&gt; e) -&gt; Array i e\nmkArrayPar n s bounds f = listArray bounds (concat workUnits)\n    where\n        partitions = partition n bounds\n        workUnits  = parMap (evalList s) (map f . range) partitions\n\ngenerateImagePar :: forall a . Pixel a  =&gt; (Int -&gt; Int -&gt; a) -&gt; Int -&gt; Int -&gt; Image a\ngenerateImagePar f w h = generateImage f' w h\n    where\n        bounds = ((0, 0), (w-1,h-1))\n        pixels = mkArrayPar numCapabilities rseq bounds (uncurry f)\n        f'     = curry (pixels !)\n\n--\n--  Newton\n--\neval:: (Floating a) =&gt; [a] -&gt; a -&gt; a\neval cs z = DL.foldl1' (\\acc c -&gt; acc * z + c) cs\n\ndiff:: (Floating a) =&gt; [a] -&gt; [a]\ndiff [p] = []\ndiff (p:ps) =  [(fromIntegral (length ps) )*p] ++ diff ps\n\ntype Comp = Complex Double\n\nconvergesOrNot:: (Comp -&gt; Comp) -&gt; (Comp -&gt; Comp) -&gt; Comp-&gt;Int -&gt; Int\nconvergesOrNot _ _ _ 0 = 0\nconvergesOrNot f d z iter | realPart (abs (f z) ) &lt; 1e-6 = 1\n              | otherwise = convergesOrNot f d (z - (f z)/(d z)) (iter-1)\n\n-- x, y, f,d, xMin, xMin, stepX, stepY\ngetPixel:: Int-&gt;Int-&gt;(Comp-&gt;Comp)-&gt;(Comp-&gt;Comp)-&gt;Double-&gt;Double-&gt;Double-&gt;Double-&gt;PixelRGB8\ngetPixel x y f d xMin yMin stepX stepY | convergesOrNot f d z 16 == 1 = PixelRGB8 255 255 255\n                       | otherwise = PixelRGB8 0 0 0\n    where\n        real = xMin + (fromIntegral x)*stepX\n        imag = yMin + (fromIntegral y)*stepY\n        z = real :+ imag; \n\ndata Params = Params{f :: [Comp],\n             d :: [Comp],\n             xMin::Double,\n             yMin::Double,\n             stepX::Double,\n             stepY::Double,\n             width::Int,\n             height::Int        \n            } deriving (Show)\n\nextract:: String -&gt; Params\nextract config = Params poly deriv xMin yMin stepX stepY width height\n    where \n        lines = splitOn \"\\n\" config\n        wh = splitOn \" \" (lines !! 0) \n        width  = read (wh !! 0) :: Int\n        height = read (wh !! 1) :: Int\n        bottomLeft = splitOn \" \" (lines !! 1)\n        upperRight = splitOn \" \" (lines !! 2)\n        xMin = read $ (bottomLeft !! 0) :: Double\n        yMin = read $ (bottomLeft !! 1) :: Double\n        xMax = read $ (upperRight !! 0) :: Double\n        yMax = read $ (upperRight !! 1) :: Double\n        stepX = (xMax - xMin)/(fromIntegral width)\n        stepY = (yMax - yMin)/(fromIntegral height)     \n        poly = map (\\x -&gt; (read x :: Double) :+ 0) (splitOn \" \" (lines !! 3))\n        deriv = diff poly\n\ngetPixelParams:: Int-&gt;Int-&gt;Params-&gt;PixelRGB8\ngetPixelParams x y params = getPixel x y func derv (xMin params) (yMin params) (stepX params) (stepY params)\n    where\n        func = \\z -&gt; eval (f params) z\n        derv = \\z -&gt; eval (d params) z\n\nmain = do\n    handle &lt;- openFile \"config.txt\" ReadMode\n    config &lt;- hGetContents handle\n    let params = extract config\n    writePng \"test.png\" $ generateImagePar (\\x y -&gt; getPixelParams x y params) (width params) (height params)\n    hClose handle\n</code></pre>\n\n<p>I compile it with</p>\n\n<pre><code>ghc O2  -threaded  -rtsopts -XDefaultSignatures -XExistentialQuantification partNewton.hs -o newton\n</code></pre>\n\n<p>and I run it with <code>./newton +RTS -N</code>. But when I run it on config</p>\n\n<pre><code>2048 2048\n-1 -1\n1 1\n1 0 0 1\n</code></pre>\n\n<p>it results in error </p>\n\n<pre><code>Stack space overflow: current size 8388608 bytes.\n</code></pre>\n"}, {"tags": ["haskell"], "answers": [{"tags": [], "owner": {"reputation": 28873, "user_id": 1068232, "user_type": "registered", "accept_rate": 79, "profile_image": "https://www.gravatar.com/avatar/2a0a145ce58c20013969fe3f203531da?s=128&d=identicon&r=PG", "display_name": "Andr&#225;s Kov&#225;cs", "link": "https://stackoverflow.com/users/1068232/andr%c3%a1s-kov%c3%a1cs"}, "is_accepted": false, "score": 8, "last_activity_date": 1425729798, "creation_date": 1425729798, "answer_id": 28914677, "question_id": 28914619, "link": "https://stackoverflow.com/questions/28914619/guards-in-pattern-match-in-let-binding/28914677#28914677", "title": "guards in pattern match in let binding", "body": "<p>Guards in <code>let</code>-s mean \"if the condition evaluates to True, bind lhs to rhs\". Since Haskell <code>let</code>-s are recursive, <code>let (a,b) | a == b = (0,0) in (a,b)</code> first tries to evaluate <code>a == b</code> with <code>a</code> and <code>b</code> pointing back to the variables just being defined, which can be evaluated by checking again <code>a == b</code> in the guard, and this results in a loop. It's a loop for the same reason <code>let x = x in x</code> results in a loop when trying to force <code>x</code>. </p>\n"}, {"tags": [], "owner": {"reputation": 100185, "user_id": 3234959, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/93bb12ca0f93dfddb33880316f7e66c2?s=128&d=identicon&r=PG&f=1", "display_name": "chi", "link": "https://stackoverflow.com/users/3234959/chi"}, "is_accepted": false, "score": 6, "last_activity_date": 1425758124, "last_edit_date": 1425758124, "creation_date": 1425730296, "answer_id": 28914744, "question_id": 28914619, "link": "https://stackoverflow.com/questions/28914619/guards-in-pattern-match-in-let-binding/28914744#28914744", "title": "guards in pattern match in let binding", "body": "<p>The let is equivalent to</p>\n\n<pre><code>let (a,b) = if a==b \n            then (0,0) \n            else error \"non exhaustive...\"\n</code></pre>\n\n<p>which shows its recursive nature more clearly.</p>\n\n<p>Your misunderstanding comes from your let-to-case translation, which is not correct in the presence of guards (or recursion). To see why, think about how one would translate the following:</p>\n\n<pre><code>let (a,b) | condition1 = (0,0)\n          | condition2 = (1,1)\n</code></pre>\n\n<p>The above can't be rewritten as something like <code>case (0,0) of (a,b) -&gt; ...</code> or <code>case (1,1) of (a,b) -&gt; ...</code>, since you need to evaluate the conditions before choosing between <code>(0,0)</code> and <code>(1,1)</code>.</p>\n"}], "owner": {"reputation": 2501, "user_id": 2868481, "user_type": "registered", "accept_rate": 48, "profile_image": "https://www.gravatar.com/avatar/d32920192c6bebcffb83fffd557b9553?s=128&d=identicon&r=PG&f=1", "display_name": "d8d0d65b3f7cf42", "link": "https://stackoverflow.com/users/2868481/d8d0d65b3f7cf42"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 564, "favorite_count": 1, "answer_count": 2, "score": 3, "last_activity_date": 1425758124, "creation_date": 1425729417, "question_id": 28914619, "link": "https://stackoverflow.com/questions/28914619/guards-in-pattern-match-in-let-binding", "title": "guards in pattern match in let binding", "body": "<p>I am surprised by the semantics of this (third expression below). Start here:</p>\n\n<pre><code>Prelude&gt; let (a,b) = (0,0) in (a,b)\n(0,0)\n</code></pre>\n\n<p>That's fine. Now add a guard, and it's still fine:</p>\n\n<pre><code>Prelude&gt; let (a,b) | True = (0,0) in (a,b)\n(0,0)\n</code></pre>\n\n<p>Now change the guard, and be surprised:</p>\n\n<pre><code>Prelude&gt; let (a,b) | a == b = (0,0) in (a,b)\n(^CInterrupted.\n</code></pre>\n\n<p>How come? - This works:</p>\n\n<pre><code>Prelude&gt; case (0,0) of (a,b) | a == b -&gt; (a,b)\n(0,0)\n</code></pre>\n"}, {"tags": ["haskell"], "answers": [{"comments": [{"owner": {"reputation": 366, "user_id": 661582, "user_type": "registered", "accept_rate": 80, "profile_image": "https://www.gravatar.com/avatar/581b0d6be0953275b3cf9e5e58fe6838?s=128&d=identicon&r=PG", "display_name": "Calle", "link": "https://stackoverflow.com/users/661582/calle"}, "edited": false, "score": 0, "creation_date": 1425743446, "post_id": 28915797, "comment_id": 46091159, "body": "Thanks! I had the feeling that it should be doable with the monadic things, but couldn&#39;t piece it together, I have to read up on the state monad."}, {"owner": {"reputation": 44013, "user_id": 1477667, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/trgKM.jpg?s=128&g=1", "display_name": "dfeuer", "link": "https://stackoverflow.com/users/1477667/dfeuer"}, "edited": false, "score": 0, "creation_date": 1425744110, "post_id": 28915797, "comment_id": 46091354, "body": "You probably should get down dirty with stream bundles if you really want to make a general purpose one."}, {"owner": {"reputation": 28873, "user_id": 1068232, "user_type": "registered", "accept_rate": 79, "profile_image": "https://www.gravatar.com/avatar/2a0a145ce58c20013969fe3f203531da?s=128&d=identicon&r=PG", "display_name": "Andr&#225;s Kov&#225;cs", "link": "https://stackoverflow.com/users/1068232/andr%c3%a1s-kov%c3%a1cs"}, "edited": false, "score": 0, "creation_date": 1425752434, "post_id": 28915797, "comment_id": 46094270, "body": "That&#39;s right, but I&#39;m not familiar with writing stream fusion code. At least the <code>mapM</code> solution is streaming, I believe. BTW the latest <code>vector</code> doesn&#39;t have stream bundles."}], "tags": [], "owner": {"reputation": 28873, "user_id": 1068232, "user_type": "registered", "accept_rate": 79, "profile_image": "https://www.gravatar.com/avatar/2a0a145ce58c20013969fe3f203531da?s=128&d=identicon&r=PG", "display_name": "Andr&#225;s Kov&#225;cs", "link": "https://stackoverflow.com/users/1068232/andr%c3%a1s-kov%c3%a1cs"}, "is_accepted": true, "score": 2, "last_activity_date": 1425743514, "last_edit_date": 1495540613, "creation_date": 1425737685, "answer_id": 28915797, "question_id": 28914539, "link": "https://stackoverflow.com/questions/28914539/data-vector-mapping-with-accumulator/28915797#28915797", "title": "Data.Vector, mapping with accumulator", "body": "<p>The simplest solution would be to reverse your scheme and have the least significant bits on the front of the vector, like this:</p>\n\n<pre><code>inc &lt;False, False, False&gt; == &lt;True, False, False&gt;\n</code></pre>\n\n<p>The reason is that <a href=\"https://hackage.haskell.org/package/vector-0.10.12.2/docs/Data-Vector-Unboxed.html#g:22\" rel=\"nofollow noreferrer\"><code>mapM</code></a> and <a href=\"https://hackage.haskell.org/package/vector-0.10.12.2/docs/Data-Vector-Unboxed.html#g:10\" rel=\"nofollow noreferrer\"><code>unfoldr</code></a> are both suitable for defining <code>inc</code> with this bit ordering, but not with the other order, and there aren't reversed versions of these functions in <code>vector</code>. As an example, <code>mapM</code> lets us implement <code>inc</code> with the help of the State monad:</p>\n\n<pre><code>import Control.Monad.State\nimport qualified Data.Vector.Unboxed as V\n\ninc :: V.Vector Bool -&gt; V.Vector Bool\ninc v = evalState (V.mapM go v) True where\n  go acc = state $ \\x -&gt; (x /= acc, x &amp;&amp; acc)\n</code></pre>\n\n<p>Alternatively, we could do two reversals to get back to the original ordering. That would be asymptotically the same, but practically significantly slower. </p>\n\n<p>Of course, we can still do a lower-level implementation for <code>mapAccumR</code>. This necessitates working in the <code>ST</code> monad with mutable vectors, which isn't particularly hard, but it's not trivial either. There isn't a lot of material online on the ST monad; on Stack Overflow you may <a href=\"https://stackoverflow.com/questions/12468622/how-does-the-st-monad-work\">benefit from reading this question</a> and optionally following the links from there. I try to comment on the important parts in the <code>mapAccumR</code> implementation below.</p>\n\n<pre><code>-- we need this so we can annotate objects in the ST monad with\n-- the right parameters\n{-# LANGUAGE ScopedTypeVariables #-}\n\nimport Control.Monad.ST.Strict\nimport qualified Data.Vector.Unboxed as V\nimport qualified Data.Vector.Unboxed.Mutable as MV\n\n-- note that I explicitly introduce the type variables\n-- with forall. This - in conjunction with ScopedTypeVariables - \n-- lets us refer to the type variables in the function body.\nmapAccumR ::\n  forall x y acc.\n  (V.Unbox x, V.Unbox y) =&gt;\n  (acc -&gt; x -&gt; (acc, y)) -&gt; acc -&gt; V.Vector x -&gt; (acc, V.Vector y)\nmapAccumR f acc v = runST $ do\n  let len = V.length v\n\n  -- Allocate a mutable unboxed vector of v's size.\n  -- We need to annotate the \"s\" parameter here, so we can\n  -- refer to it in the type of \"go\".\n  (mv :: MV.STVector s y) &lt;- MV.unsafeNew len\n\n  -- iterate through the new vector in reverse order,\n  -- updating the elements according to mapAccumR's logic.\n  let go :: Int -&gt; acc -&gt; ST s acc\n      go i acc | i &lt; 0 = return acc\n      go i acc = do\n        -- y comes from the old vector\n        -- we can access it via the immutable API\n        let (acc' , y) = f acc (V.unsafeIndex v i)\n        -- but we must do mutable writes on the new vector\n        MV.unsafeWrite mv i y\n        go (i - 1) acc'\n\n  acc' &lt;- go (len - 1) acc\n\n  -- \"unsafeFreeze\" converts the mutable vector to\n  -- an immutable one in-place.\n  v'   &lt;- V.unsafeFreeze mv\n  return (acc', v')\n</code></pre>\n"}], "owner": {"reputation": 366, "user_id": 661582, "user_type": "registered", "accept_rate": 80, "profile_image": "https://www.gravatar.com/avatar/581b0d6be0953275b3cf9e5e58fe6838?s=128&d=identicon&r=PG", "display_name": "Calle", "link": "https://stackoverflow.com/users/661582/calle"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 197, "favorite_count": 2, "accepted_answer_id": 28915797, "answer_count": 1, "score": 4, "last_activity_date": 1425743514, "creation_date": 1425728857, "last_edit_date": 1425732813, "question_id": 28914539, "link": "https://stackoverflow.com/questions/28914539/data-vector-mapping-with-accumulator", "title": "Data.Vector, mapping with accumulator", "body": "<p>I would like to do a map with an accumulator on Data.Vector.</p>\n\n<p>I want to write the function inc:</p>\n\n<pre><code>inc :: Vector.Vector Bool -&gt; Vector.Vector Bool\n</code></pre>\n\n<p>which \"adds one\" to the vector, e.g.:</p>\n\n<pre><code>inc &lt;False, False, False&gt; = &lt;False, False, True&gt;\ninc &lt;False, False, True&gt; = &lt;False, True, False&gt;\ninc &lt;True, True, True&gt; = &lt;False, False, False&gt;\n</code></pre>\n\n<p>If there was something like Data.List's mapAccumR, say with type:</p>\n\n<pre><code>mapAccumR :: (acc -&gt; x -&gt; (acc, y)) -&gt; acc -&gt; Vector x -&gt; (acc, Vector y)\n</code></pre>\n\n<p>this could be done with</p>\n\n<pre><code>inc = snd . Vector.mapAccumR inc' True\n  where\n    inc' x y = (x &amp;&amp; y, (x || y) &amp;&amp; (not (x &amp;&amp; y)))\n</code></pre>\n\n<p>but I can't figure it out how to do it with what is in Data.Vector.Unboxed. Is it possible?</p>\n"}, {"tags": ["haskell", "optimization", "expression"], "comments": [{"owner": {"reputation": 2001, "user_id": 988361, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/9a433a44669c3a5dd72fb9065ec52b81?s=128&d=identicon&r=PG", "display_name": "egdmitry", "link": "https://stackoverflow.com/users/988361/egdmitry"}, "reply_to_user": {"reputation": 15683, "user_id": 46571, "user_type": "registered", "accept_rate": 94, "profile_image": "https://www.gravatar.com/avatar/79eede5b02caa81db17f34026b24a734?s=128&d=identicon&r=PG", "display_name": "pyon", "link": "https://stackoverflow.com/users/46571/pyon"}, "edited": false, "score": 0, "creation_date": 1425725017, "post_id": 28913860, "comment_id": 46086114, "body": "I compiled and timed: got 1s for 10000000 and 12.94s for 100000000. Looks pretty linear. How did you get your result?"}, {"owner": {"reputation": 15683, "user_id": 46571, "user_type": "registered", "accept_rate": 94, "profile_image": "https://www.gravatar.com/avatar/79eede5b02caa81db17f34026b24a734?s=128&d=identicon&r=PG", "display_name": "pyon", "link": "https://stackoverflow.com/users/46571/pyon"}, "edited": false, "score": 0, "creation_date": 1425726487, "post_id": 28913860, "comment_id": 46086526, "body": "Never mind, what I said is totally bogus."}], "answers": [{"comments": [{"owner": {"reputation": 2001, "user_id": 988361, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/9a433a44669c3a5dd72fb9065ec52b81?s=128&d=identicon&r=PG", "display_name": "egdmitry", "link": "https://stackoverflow.com/users/988361/egdmitry"}, "edited": false, "score": 0, "creation_date": 1425726375, "post_id": 28914066, "comment_id": 46086503, "body": "Hmm, I can see how it can calculate an element in the list by index in N steps, but how does it calculate all elements when <code>take</code> is called? It seems that in the thunks expression the part that is a calculation for <code>N+1</code> is not shared with the one for <code>N</code>. What would be the proper way to test that it really is O(N^2) when taking first N number? I was doing <code>(sum . take 100000000) natural</code>."}, {"owner": {"reputation": 100892, "user_id": 745903, "user_type": "registered", "accept_rate": 74, "profile_image": "https://www.gravatar.com/avatar/50933f6638836741e620669b3940410e?s=128&d=identicon&r=PG", "display_name": "leftaroundabout", "link": "https://stackoverflow.com/users/745903/leftaroundabout"}, "reply_to_user": {"reputation": 2001, "user_id": 988361, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/9a433a44669c3a5dd72fb9065ec52b81?s=128&d=identicon&r=PG", "display_name": "egdmitry", "link": "https://stackoverflow.com/users/988361/egdmitry"}, "edited": false, "score": 0, "creation_date": 1425726609, "post_id": 28914066, "comment_id": 46086563, "body": "Hm, it looks indeed like summing the first <i>N</i> elements can <i>still</i> be done in <i>O</i> (<i>N</i>). That&#39;s remarkable! Can&#39;t say right now how this works..."}, {"owner": {"reputation": 1367, "user_id": 1160885, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/dc61c1b2045efa54375188bdb6a33945?s=128&d=identicon&r=PG", "display_name": "Jedai", "link": "https://stackoverflow.com/users/1160885/jedai"}, "edited": false, "score": 2, "creation_date": 1425752627, "post_id": 28914066, "comment_id": 46094351, "body": "All those computations are <i>shared</i>, there is only one <code>minc</code> list, and there&#39;s no need to recompute its content at several points."}], "tags": [], "owner": {"reputation": 100892, "user_id": 745903, "user_type": "registered", "accept_rate": 74, "profile_image": "https://www.gravatar.com/avatar/50933f6638836741e620669b3940410e?s=128&d=identicon&r=PG", "display_name": "leftaroundabout", "link": "https://stackoverflow.com/users/745903/leftaroundabout"}, "is_accepted": false, "score": 2, "last_activity_date": 1425726786, "last_edit_date": 1425726786, "creation_date": 1425725310, "answer_id": 28914066, "question_id": 28913860, "link": "https://stackoverflow.com/questions/28913860/what-optimization-technique-does-ghci-use-to-speed-up-recursive-map/28914066#28914066", "title": "What optimization technique does ghci use to speed up recursive map?", "body": "<blockquote>\n  <p>to build each new number <code>n</code> in the list is has to unfold an expression <code>n</code> times which gives us <em>O</em>(<em>N</em><sup>2</sup>) complexity.</p>\n</blockquote>\n\n<p>Not quite. The complexity of unfolding the first <em>N</em> numbers this way is indeed <em>O</em>(<em>N</em><sup>2</sup>)<sup><strong>Apparently I'm wrong here</strong>[1]</sup>. But if you request <em>only</em> the <em>N</em>-th number, then it actually evaluates like this:</p>\n\n<pre><code>(!!n) $ 1:minc(1:minc(1:minc(1:minc(1:minc(1:minc(1:minc(1:minc(1:minc...\n(!!n-1) $ minc(1:minc(1:minc(1:minc(1:minc(1:minc(1:minc(1:minc(1:minc...\n(!!n-1) $ (1+1):minc(minc(1:minc(1:minc(1:minc(1:minc(1:minc(1:minc(1:minc...\n            -- note that `(1+1)` isn't actually calculated!\n(!!n-2) $ minc(minc(1:minc(1:minc(1:minc(1:minc(1:minc(1:minc(1:minc...\n(!!n-2) $ ((1+1)+1):minc(minc(minc(1:minc(1:minc(1:minc(1:minc(1:minc(1:minc...\n            -- again, neither of the additions is actually calculated.\n(!!n-3) $ minc(minc(minc(1:minc(1:minc(1:minc(1:minc(1:minc(1:minc...\n(!!n-3) $ ((...)+1):minc(minc(minc(minc(1:minc(1:minc(1:minc(1:minc(1:minc...\n...\n(!!n-n) $ ((...+1)+1) : minc(minc(...minc(minc(1:minc(...\n           \u2570\u2500 n \u2500\u256f\n(!!0) $ (n+1) : _\nn+1\n</code></pre>\n\n<p>Which takes only a fixed number of two steps per increase in <em>N</em>, plus <em>N</em> additions once it's reached the index &ndash; that's still <em>O</em>(<em>N</em>) all in all.</p>\n\n<p>The crucial thing here is that basically, <code>map</code> is only applied once to the entire list. It's completely lazy, i.e. to yield a <code>_:_</code> thunk it only needs to know that the list has at least <em>length</em> 1, but the actual elements don't matter at all.</p>\n\n<p>This way, what we've written as <code>minc(minc(...(minc(1 : ...</code> is replaced by <code>(... + 1) : minc(...</code> in only one step.</p>\n\n<hr>\n\n<p><sup>[1]</sup><sub>Turns out that even if we <em>sum</em> the first <em>N</em> numbers, it's done in <em>O</em>(<em>N</em>). I don't know how.</sub></p>\n"}, {"comments": [{"owner": {"reputation": 2001, "user_id": 988361, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/9a433a44669c3a5dd72fb9065ec52b81?s=128&d=identicon&r=PG", "display_name": "egdmitry", "link": "https://stackoverflow.com/users/988361/egdmitry"}, "edited": false, "score": 1, "creation_date": 1425766795, "post_id": 28917947, "comment_id": 46098741, "body": "Indeed, having linear complexity in my example means there is some kind of list sharing going on. But how does GHC know specifically when and how to optimize? Does it specifically look for such cases? GHC doesn&#39;t even normally do common subexpression elimination, so I am surprised some kind of memoization is done here."}, {"owner": {"reputation": 17809, "user_id": 1088108, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/63781cd38e91aa346a3849bc3ef3e550?s=128&d=identicon&r=PG&f=1", "display_name": "&#216;rjan Johansen", "link": "https://stackoverflow.com/users/1088108/%c3%98rjan-johansen"}, "reply_to_user": {"reputation": 2001, "user_id": 988361, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/9a433a44669c3a5dd72fb9065ec52b81?s=128&d=identicon&r=PG", "display_name": "egdmitry", "link": "https://stackoverflow.com/users/988361/egdmitry"}, "edited": false, "score": 0, "creation_date": 1425776112, "post_id": 28917947, "comment_id": 46100927, "body": "@egdmitry It isn&#39;t really optimization, it is just laziness (which includes not evaluating an expression <i>more</i> than once) and thunks referring circularly to themselves because they&#39;re defined that way. Basically it&#39;s what every Haskell compiler is expected to do even if it&#39;s <i>not</i> being particularly clever."}, {"owner": {"reputation": 1367, "user_id": 1160885, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/dc61c1b2045efa54375188bdb6a33945?s=128&d=identicon&r=PG", "display_name": "Jedai", "link": "https://stackoverflow.com/users/1160885/jedai"}, "edited": false, "score": 5, "creation_date": 1425808187, "post_id": 28917947, "comment_id": 46106600, "body": "There is no &quot;optimization&quot; at play here, the only reason the evaluation is shared is because there is only one <code>natural</code>, only one place in memory where this list exists. At first it is only a thunk <code>1:minc natural</code> but when you evaluate the second element, it becomes a list of 1 cons <code>map (+1) (1: ref to tail of natural)</code> then 1 cons 2 cons <code>map (+1) (2: ref to tail of tail of natural)</code>, as you see the next step will be O(1), and so on."}, {"owner": {"reputation": 2001, "user_id": 988361, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/9a433a44669c3a5dd72fb9065ec52b81?s=128&d=identicon&r=PG", "display_name": "egdmitry", "link": "https://stackoverflow.com/users/988361/egdmitry"}, "edited": false, "score": 0, "creation_date": 1426303635, "post_id": 28917947, "comment_id": 46329631, "body": "Interestingly, <code>test x = x : map (+1) (test x)</code> is O(N^2). So once there is an argument GHC doesn&#39;t see that this is the same thunk?"}, {"owner": {"reputation": 640, "user_id": 949024, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/3d81f9bcedb04a5e043fc9edd218ad83?s=128&d=identicon&r=PG", "display_name": "Alex", "link": "https://stackoverflow.com/users/949024/alex"}, "edited": false, "score": 0, "creation_date": 1426332631, "post_id": 28917947, "comment_id": 46335049, "body": "That is correct. GHC will generally only share thunks if they directly refer to the same thing. Your test will gain the sharing if we write <code>test x = let test&#39; = x : map (+1)  test&#39; in x</code>. In this case we can see test&#39; can be shared. This transformation is call the static argument transformation and there has been talk about enabaling it in GHC <a href=\"https://ghc.haskell.org/trac/ghc/ticket/9374\" rel=\"nofollow noreferrer\">here</a>"}], "tags": [], "owner": {"reputation": 640, "user_id": 949024, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/3d81f9bcedb04a5e043fc9edd218ad83?s=128&d=identicon&r=PG", "display_name": "Alex", "link": "https://stackoverflow.com/users/949024/alex"}, "is_accepted": true, "score": 5, "last_activity_date": 1425750085, "creation_date": 1425750085, "answer_id": 28917947, "question_id": 28913860, "link": "https://stackoverflow.com/questions/28913860/what-optimization-technique-does-ghci-use-to-speed-up-recursive-map/28917947#28917947", "title": "What optimization technique does ghci use to speed up recursive map?", "body": "<p>The list of naturals is being shared between each recursive step. The graph is evaluated like this.</p>\n\n<pre><code>1:map (+1) _\n ^         |\n `---------'\n\n1: (2 : map (+1) _)\n      ^          |\n      `----------'\n\n1: (2 : (3 : map (+1) _)\n           ^          |\n           `----------'\n</code></pre>\n\n<p>This sharing means that the code uses O(n) time rather than the expected O(N^2). </p>\n"}], "owner": {"reputation": 2001, "user_id": 988361, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/9a433a44669c3a5dd72fb9065ec52b81?s=128&d=identicon&r=PG", "display_name": "egdmitry", "link": "https://stackoverflow.com/users/988361/egdmitry"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 157, "favorite_count": 0, "accepted_answer_id": 28917947, "answer_count": 2, "score": 4, "last_activity_date": 1425750085, "creation_date": 1425723881, "question_id": 28913860, "link": "https://stackoverflow.com/questions/28913860/what-optimization-technique-does-ghci-use-to-speed-up-recursive-map", "title": "What optimization technique does ghci use to speed up recursive map?", "body": "<p>Say I have the following function:</p>\n\n<pre><code>minc = map (+1)\nnatural = 1:minc natural\n</code></pre>\n\n<p>It seems like it unfolds like this:</p>\n\n<pre><code>1:minc(1:minc(1:minc(1:minc(1:minc(1:minc(1:minc(1:minc(1:minc(1:minc...\n1:2:minc(minc(1:minc(1:minc(1:minc(1:minc(1:minc(1:minc(1:minc(1:minc...\n1:2:minc(2:minc(2:minc(2:minc(2:minc(2:minc(2:minc(2:minc(2:minc(minc...\n1:2:3:minc(3:minc(3:minc(3:minc(3:minc(3:minc(3:minc(3:minc(minc(minc...\n...                                                                \n</code></pre>\n\n<p>Although it's lazily evaluated, to build each new number <code>n</code> in the list is has to unfold an expression <code>n</code> times which gives us <code>O(N^2)</code> complexity. But by the execution time I can see that the real complexity is still linear!</p>\n\n<p>Which optimization does Haskell use in this case and how does it unfold this expression?</p>\n"}, {"tags": ["list", "haskell"], "comments": [{"owner": {"reputation": 1367, "user_id": 1160885, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/dc61c1b2045efa54375188bdb6a33945?s=128&d=identicon&r=PG", "display_name": "Jedai", "link": "https://stackoverflow.com/users/1160885/jedai"}, "edited": false, "score": 1, "creation_date": 1425753065, "post_id": 28913578, "comment_id": 46094499, "body": "last is in fact a very bad function, it&#39;s <i>partial</i>, it has no proper evaluation for an empty list so the only choice is to error out (either implicitly with a non-exhaustive pattern or explicitly with an <code>error &quot;last doesn&#39;t work on an empty list&quot;</code> which is slightly better but still crummy to debug in big programs). It&#39;s one of those functions you shouldn&#39;t use, like <code>head</code> or <code>tail</code>. If you need a safe last, I would advise looking at the <a href=\"http://hackage.haskell.org/package/safe\" rel=\"nofollow noreferrer\">safe</a> library for <i>total</i> alternatives with saner types. Of course, for an exercise that doesn&#39;t matter much ! :)"}, {"owner": {"reputation": 44013, "user_id": 1477667, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/trgKM.jpg?s=128&g=1", "display_name": "dfeuer", "link": "https://stackoverflow.com/users/1477667/dfeuer"}, "edited": false, "score": 0, "creation_date": 1427000238, "post_id": 28913578, "comment_id": 46596331, "body": "Just for fun, can you write <code>myLast :: [a] -&gt; Maybe a</code> using <code>foldl</code> and no explicit recursion?"}], "answers": [{"comments": [{"owner": {"reputation": 94713, "user_id": 1139697, "user_type": "registered", "accept_rate": 86, "profile_image": "https://www.gravatar.com/avatar/5f136ddb684f39aaee1c028ee1950f6f?s=128&d=identicon&r=PG", "display_name": "Zeta", "link": "https://stackoverflow.com/users/1139697/zeta"}, "edited": false, "score": 2, "creation_date": 1425722629, "post_id": 28913634, "comment_id": 46085495, "body": "I would add something like: &quot;After all, how do you chose the last element of an empty list? How do you chose <i>any</i> element of an empty list? There is no sensible choice. However, you could change the type of your function a little bit to <code>myLast :: [a] -&gt; Maybe a</code> and either return <code>Just x</code> or <code>Nothing</code>&quot;."}, {"owner": {"reputation": 549, "user_id": 4396823, "user_type": "registered", "accept_rate": 83, "profile_image": "https://www.gravatar.com/avatar/e7493ed20de304e4d88666ff6977ae33?s=128&d=identicon&r=PG&f=1", "display_name": "Steve", "link": "https://stackoverflow.com/users/4396823/steve"}, "reply_to_user": {"reputation": 94713, "user_id": 1139697, "user_type": "registered", "accept_rate": 86, "profile_image": "https://www.gravatar.com/avatar/5f136ddb684f39aaee1c028ee1950f6f?s=128&d=identicon&r=PG", "display_name": "Zeta", "link": "https://stackoverflow.com/users/1139697/zeta"}, "edited": false, "score": 0, "creation_date": 1425722672, "post_id": 28913634, "comment_id": 46085510, "body": "@Zeta I come from a Scala background. That makes ALOT more sense."}], "tags": [], "owner": {"reputation": 133611, "user_id": 152602, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/7f370b4bd787fc68f9f62d9c6781cb79?s=128&d=identicon&r=PG", "display_name": "Lee", "link": "https://stackoverflow.com/users/152602/lee"}, "is_accepted": true, "score": 5, "last_activity_date": 1425722808, "last_edit_date": 1425722808, "creation_date": 1425722483, "answer_id": 28913634, "question_id": 28913578, "link": "https://stackoverflow.com/questions/28913578/how-do-i-handle-an-empty-list-in-my-own-version-of-last/28913634#28913634", "title": "How do I handle an empty list in my own version of `last`?", "body": "<p>If you have an empty list then you can't return an <code>a</code> since there is none to return. You could encode this possibility in the type of <code>myLast</code> by returning a <code>Maybe a</code> instead of an <code>a</code>. Then you could return <code>Nothing</code> if the list is empty:</p>\n\n<pre><code>myLast :: a -&gt; Maybe a\nmyLast [] = Nothing\n</code></pre>\n\n<p>If you can't change the type of the function, your only option is to raise an error:</p>\n\n<pre><code>myLast [] = error \"Empty list\"\n</code></pre>\n"}, {"tags": [], "owner": {"reputation": 204954, "user_id": 1903116, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/w6Ffg.jpg?s=128&g=1", "display_name": "thefourtheye", "link": "https://stackoverflow.com/users/1903116/thefourtheye"}, "is_accepted": false, "score": 2, "last_activity_date": 1426996151, "last_edit_date": 1426996151, "creation_date": 1425722678, "answer_id": 28913660, "question_id": 28913578, "link": "https://stackoverflow.com/questions/28913578/how-do-i-handle-an-empty-list-in-my-own-version-of-last/28913660#28913660", "title": "How do I handle an empty list in my own version of `last`?", "body": "<p>Your type signature says</p>\n\n<pre><code>myLast :: [a] -&gt; a\n</code></pre>\n\n<p>if you pass a list to <code>myList</code>, it will give you back a single element of the type of elements in the list. But, your definition says</p>\n\n<pre><code>myLast [] = []\n</code></pre>\n\n<p>if you pass an empty list, it ll return you an empty list. In the signature you mentioned a single element but while defining you are saying a list. That is why Haskell is complaining about that line.</p>\n\n<p>But when you remove that definition, and call <code>myLast</code> with an empty list, it couldn't match the input with any of the patterns defined for <code>myLast</code>. That is why it is failing with</p>\n\n<pre class=\"lang-none prettyprint-override\"><code>Non-exhaustive patterns in function myLast\n</code></pre>\n\n<p>In this particular case, you have no valid input to work on. So, it is better throw an error, like this</p>\n\n<pre><code>myLast [] = error \"Atleast one element should be there to find the last element\"\n</code></pre>\n"}], "owner": {"reputation": 549, "user_id": 4396823, "user_type": "registered", "accept_rate": 83, "profile_image": "https://www.gravatar.com/avatar/e7493ed20de304e4d88666ff6977ae33?s=128&d=identicon&r=PG&f=1", "display_name": "Steve", "link": "https://stackoverflow.com/users/4396823/steve"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 298, "favorite_count": 0, "accepted_answer_id": 28913634, "answer_count": 2, "score": 1, "last_activity_date": 1426996151, "creation_date": 1425722166, "last_edit_date": 1425722860, "question_id": 28913578, "link": "https://stackoverflow.com/questions/28913578/how-do-i-handle-an-empty-list-in-my-own-version-of-last", "title": "How do I handle an empty list in my own version of `last`?", "body": "<p>I'm having trouble getting this simple Haskell function to compile. It is from 99 Haskell Problems, where one should implement <code>last</code>. I've written the following version:</p>\n\n<pre><code> myLast :: [a] -&gt; a\n myLast []     = []       \n myLast (x:[]) = x          \n myLast (x:xs) = myLast(xs) \n</code></pre>\n\n<p>However, I get an error if I load it into GHCi:</p>\n\n<pre><code>Couldn't match expected type `a' with actual type `[t0]'\n  `a' is a rigid type variable bound by\n      the type signature for myLast :: [a] -&gt; a at problem1.hs:1:11\nRelevant bindings include\n  myLast :: [a] -&gt; a (bound at problem1.hs:3:1)\nIn the expression: []\nIn an equation for `myLast': myLast [] = []\nFailed, modules loaded: none.\n</code></pre>\n\n<p>Which tells me that </p>\n\n<pre><code>myLast[]    = [] \n</code></pre>\n\n<p>is the problem.</p>\n\n<p>If I remove it, it gets interpreted correctly. But if I pass the empty list</p>\n\n<pre><code>Prelude&gt; myLast []\n</code></pre>\n\n<p>I get</p>\n\n<pre><code>&gt; Non-exhaustive patterns in function myLast\n</code></pre>\n\n<p>Which makes sense, because I don't have the empty list in the matching criteria. Can anyone explain this error to me and how to fix it?</p>\n"}, {"tags": ["haskell", "pattern-matching"], "answers": [{"comments": [{"owner": {"reputation": 12941, "user_id": 292731, "user_type": "registered", "accept_rate": 89, "profile_image": "https://www.gravatar.com/avatar/e3f90adedab79538799e2375a9731920?s=128&d=identicon&r=PG", "display_name": "Justin L.", "link": "https://stackoverflow.com/users/292731/justin-l"}, "edited": false, "score": 0, "creation_date": 1425777758, "post_id": 28912080, "comment_id": 46101234, "body": "Hi, this is a good answer, but I think I am more interested in the case where I&#39;m going to be matching no matter what, and there will only ever be one pattern.  If that&#39;s the case, when <i>shouldn&#39;t</i> i use the lazy pattern match?"}], "tags": [], "owner": {"reputation": 48938, "user_id": 246886, "user_type": "registered", "accept_rate": 94, "profile_image": "https://www.gravatar.com/avatar/dd1ebaade6623fc538fb8af3338e730d?s=128&d=identicon&r=PG", "display_name": "Jon Purdy", "link": "https://stackoverflow.com/users/246886/jon-purdy"}, "is_accepted": false, "score": 7, "last_activity_date": 1425709644, "creation_date": 1425709644, "answer_id": 28912080, "question_id": 28911959, "link": "https://stackoverflow.com/questions/28911959/situations-to-not-use-lazy-pattern-matching-on-tuples/28912080#28912080", "title": "Situations to (not) use lazy pattern matching on tuples", "body": "<p>You wouldn\u2019t want to use lazy pattern matching if you wanted to do any strict matching inside the lazy pattern. For example, given these definitions:</p>\n\n<pre><code>foo' (Just x, Just y) = Just (x + y)\nfoo' _ = Nothing\n\nfoo ~(Just x, Just y) = Just (x + y)\nfoo _ = Nothing\n</code></pre>\n\n<p><code>foo' (Just 5, Nothing)</code> gives <code>Nothing</code>, but <code>foo (Just 5, Nothing)</code> throws a runtime error\u2014and additionally gives a compile-time warning that the <code>_</code> case is redundant because the <code>~(\u2026)</code> case is irrefutable.</p>\n\n<p>It pretty much only makes sense to use lazy pattern matching when you know the pattern will always match, basically meaning that you\u2019re only using single-constructor types such as <code>(,)</code> throughout the lazy pattern.</p>\n"}, {"comments": [{"owner": {"reputation": 12941, "user_id": 292731, "user_type": "registered", "accept_rate": 89, "profile_image": "https://www.gravatar.com/avatar/e3f90adedab79538799e2375a9731920?s=128&d=identicon&r=PG", "display_name": "Justin L.", "link": "https://stackoverflow.com/users/292731/justin-l"}, "edited": false, "score": 0, "creation_date": 1425777705, "post_id": 28912126, "comment_id": 46101224, "body": "So...why can&#39;t we always use the lazy one?  When is the strict one preferred?"}, {"owner": {"reputation": 707, "user_id": 646408, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/e62561db40e46118628b31cba87840d6?s=128&d=identicon&r=PG", "display_name": "lpsmith", "link": "https://stackoverflow.com/users/646408/lpsmith"}, "edited": false, "score": 1, "creation_date": 1425820265, "post_id": 28912126, "comment_id": 46109621, "body": "The performance of the lazy bind given above is truly terrible for typical (i.e. non-exotic) use cases.   In my past experience,  using the strict bind instead often speeds up programs by a factor of anywhere from 10x to 50x."}, {"owner": {"reputation": 12941, "user_id": 292731, "user_type": "registered", "accept_rate": 89, "profile_image": "https://www.gravatar.com/avatar/e3f90adedab79538799e2375a9731920?s=128&d=identicon&r=PG", "display_name": "Justin L.", "link": "https://stackoverflow.com/users/292731/justin-l"}, "reply_to_user": {"reputation": 707, "user_id": 646408, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/e62561db40e46118628b31cba87840d6?s=128&d=identicon&r=PG", "display_name": "lpsmith", "link": "https://stackoverflow.com/users/646408/lpsmith"}, "edited": false, "score": 0, "creation_date": 1425879859, "post_id": 28912126, "comment_id": 46127049, "body": "@lpsmith so you&#39;re saying that it&#39;s <i>always</i> preferred, unless you want bottoms to be okay?"}, {"owner": {"reputation": 707, "user_id": 646408, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/e62561db40e46118628b31cba87840d6?s=128&d=identicon&r=PG", "display_name": "lpsmith", "link": "https://stackoverflow.com/users/646408/lpsmith"}, "edited": false, "score": 1, "creation_date": 1425907211, "post_id": 28912126, "comment_id": 46140177, "body": "Well,  in the case of the state monad, I would say as fairly firm rule of thumb,  yes.   I would be interested in any exceptions that you might discover.  In the context of your original question, however,  the performance difference is often not nearly so dramatic.   For whatever reasons,  the lazy state monad is a particularly pathological case,  at least when used from a typical imperative mindset."}], "tags": [], "owner": {"reputation": 24211, "user_id": 1364288, "user_type": "registered", "accept_rate": 88, "profile_image": "https://i.stack.imgur.com/JVtNl.png?s=128&g=1", "display_name": "danidiaz", "link": "https://stackoverflow.com/users/1364288/danidiaz"}, "is_accepted": false, "score": 7, "last_activity_date": 1425709931, "creation_date": 1425709931, "answer_id": 28912126, "question_id": 28911959, "link": "https://stackoverflow.com/questions/28911959/situations-to-not-use-lazy-pattern-matching-on-tuples/28912126#28912126", "title": "Situations to (not) use lazy pattern matching on tuples", "body": "<p>One example is the State monad. The strict/lazy versions of the State monad are distinguished by how they pattern-match on the (value, state) pair during binds.</p>\n\n<p><a href=\"http://hackage.haskell.org/package/transformers-0.4.2.0/docs/src/Control-Monad-Trans-State-Strict.html#state\">Strict</a> State monad:</p>\n\n<pre><code>m &gt;&gt;= k  = StateT $ \\ s -&gt; do\n    (a, s') &lt;- runStateT m s\n    runStateT (k a) s\n</code></pre>\n\n<p><a href=\"http://hackage.haskell.org/package/transformers-0.4.2.0/docs/src/Control-Monad-Trans-State-Lazy.html#state\">Lazy</a> State monad:</p>\n\n<pre><code>m &gt;&gt;= k  = StateT $ \\ s -&gt; do\n    ~(a, s') &lt;- runStateT m s\n    runStateT (k a) s'\n</code></pre>\n\n<p>The lazy pattern match in the lazy State monad lets you define strange programs  like this one (taken from <a href=\"http://blog.melding-monads.com/2009/12/30/fun-with-the-lazy-state-monad/\">this blog post</a> at Melding Monads):</p>\n\n<pre><code>pro :: State [Bool] ()\npro = do\n   pro\n   s &lt;- get\n   put (True : s)\n</code></pre>\n\n<p>The program generates a lazy infinite list of <code>True</code> values using \"head recursion\". The same program using the strict State monad would blow the stack before generating anything.</p>\n"}, {"tags": [], "owner": {"reputation": 44013, "user_id": 1477667, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/trgKM.jpg?s=128&g=1", "display_name": "dfeuer", "link": "https://stackoverflow.com/users/1477667/dfeuer"}, "is_accepted": false, "score": 1, "last_activity_date": 1425826975, "last_edit_date": 1425826975, "creation_date": 1425711625, "answer_id": 28912329, "question_id": 28911959, "link": "https://stackoverflow.com/questions/28911959/situations-to-not-use-lazy-pattern-matching-on-tuples/28912329#28912329", "title": "Situations to (not) use lazy pattern matching on tuples", "body": "<p>Laziness has performance costs. Sometimes, it has performance benefits. There's a reason the strict <code>State</code> monad danidiaz mentions exists; delaying and delaying means eventually you may run out of memory, or get bad cache performance. You have to think about what's going on in each case. A good rule of thumb is that pattern matches should be strict unless there's a specific reason to make them lazy. When in doubt, or when performance is critical, try benchmarking and/or profiling with both ways.</p>\n"}, {"tags": [], "owner": {"reputation": 60057, "user_id": 1333025, "user_type": "registered", "accept_rate": 65, "profile_image": "https://www.gravatar.com/avatar/79ab43010f900324ac5e2de19a2916cb?s=128&d=identicon&r=PG", "display_name": "Petr", "link": "https://stackoverflow.com/users/1333025/petr"}, "is_accepted": false, "score": 0, "last_activity_date": 1425935114, "creation_date": 1425935114, "answer_id": 28951729, "question_id": 28911959, "link": "https://stackoverflow.com/questions/28911959/situations-to-not-use-lazy-pattern-matching-on-tuples/28951729#28951729", "title": "Situations to (not) use lazy pattern matching on tuples", "body": "<p>An example where <code>~</code> is needed: Thanks to laziness, you can fold over an infinite structure like this to get the first element:</p>\n\n<pre><code>foldMap (First . Just) [(1::Int)..]\n</code></pre>\n\n<p>However, if you want use the <code>Monoid</code> instance of <code>(a, b)</code> to compute two such results at once, it fails:</p>\n\n<pre><code>foldMap (\\x -&gt; (First (Just x), First (Just x))) [(1::Int)..]\n</code></pre>\n\n<p>never finishes. The reason is non-lazy pattern match in the definition of <code>mappend</code> for <code>(,)</code>:</p>\n\n<blockquote>\n<pre><code> instance (Monoid a, Monoid b) =&gt; Monoid (a,b) where\n    mempty = (mempty, mempty)\n    (a1,b1) `mappend` (a2,b2) = (a1 `mappend` a2, b1 `mappend` b2)\n</code></pre>\n</blockquote>\n\n<p>However, defining the same monoid with lazy matching as</p>\n\n<pre><code>newtype LazyTuple a b = LazyTuple (a, b)\n  deriving (Eq, Ord, Show, Read)\n\ninstance (Monoid a, Monoid b) =&gt; Monoid (LazyTuple a b) where\n    mempty = LazyTuple (mempty, mempty)\n    LazyTuple (~(x1, y1)) `mappend` LazyTuple (~(x2, y2))\n      = LazyTuple (x1 &lt;&gt; x2, y1 &lt;&gt; y2)\n</code></pre>\n\n<p>works as expected:</p>\n\n<pre><code>foldMap (\\x -&gt; LazyTuple (First (Just x), First (Just x))) [(1::Int)..]\n</code></pre>\n\n<p>finishes immediately.</p>\n"}], "owner": {"reputation": 12941, "user_id": 292731, "user_type": "registered", "accept_rate": 89, "profile_image": "https://www.gravatar.com/avatar/e3f90adedab79538799e2375a9731920?s=128&d=identicon&r=PG", "display_name": "Justin L.", "link": "https://stackoverflow.com/users/292731/justin-l"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 421, "favorite_count": 1, "answer_count": 4, "score": 7, "last_activity_date": 1425935114, "creation_date": 1425708456, "last_edit_date": 1425777662, "question_id": 28911959, "link": "https://stackoverflow.com/questions/28911959/situations-to-not-use-lazy-pattern-matching-on-tuples", "title": "Situations to (not) use lazy pattern matching on tuples", "body": "<p>From what I can understand, lazy pattern matching on tuples is just deferring the resolving of the <code>(,)</code> constructor...if we use the two fields immediately, is there really any downside?  It will be resolved anyway...</p>\n\n<p>Is there any reason to <em>not</em> use the lazy pattern match?</p>\n\n<pre><code>foo ~(x, y) = x + y\n-- vs\nfoo (x, y)  = x + y\n</code></pre>\n\n<p>When would you ever prefer to use the second?</p>\n\n<p>EDIT: I'm specifically interested in the case where there will only be one pattern and the pattern will always match.</p>\n"}, {"tags": ["haskell", "functional-programming"], "comments": [{"owner": {"reputation": 57219, "user_id": 33796, "user_type": "registered", "accept_rate": 70, "profile_image": "https://www.gravatar.com/avatar/08727b23ba62e634b32988cdff082663?s=128&d=identicon&r=PG", "display_name": "luqui", "link": "https://stackoverflow.com/users/33796/luqui"}, "edited": false, "score": 0, "creation_date": 1425708992, "post_id": 28911846, "comment_id": 46082665, "body": "Because <code>x</code> is not defined.  You probably want <code>treeSum</code> to take <code>x</code> as an argument, which in Haskell is written <code>treeSum x = ...</code>.  Exercise: what will the type of <code>x</code> be?"}, {"owner": {"reputation": 1387, "user_id": 4616611, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/90099c6ce97d206fcac50806bf8c74da?s=128&d=identicon&r=PG&f=1", "display_name": "Teodorico Levoff", "link": "https://stackoverflow.com/users/4616611/teodorico-levoff"}, "reply_to_user": {"reputation": 57219, "user_id": 33796, "user_type": "registered", "accept_rate": 70, "profile_image": "https://www.gravatar.com/avatar/08727b23ba62e634b32988cdff082663?s=128&d=identicon&r=PG", "display_name": "luqui", "link": "https://stackoverflow.com/users/33796/luqui"}, "edited": false, "score": 0, "creation_date": 1425709122, "post_id": 28911846, "comment_id": 46082686, "body": "Ah oops. So I tried, treeSum  x = sumTree (toList x), isn&#39;t working too"}, {"owner": {"reputation": 1387, "user_id": 4616611, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/90099c6ce97d206fcac50806bf8c74da?s=128&d=identicon&r=PG&f=1", "display_name": "Teodorico Levoff", "link": "https://stackoverflow.com/users/4616611/teodorico-levoff"}, "reply_to_user": {"reputation": 57219, "user_id": 33796, "user_type": "registered", "accept_rate": 70, "profile_image": "https://www.gravatar.com/avatar/08727b23ba62e634b32988cdff082663?s=128&d=identicon&r=PG", "display_name": "luqui", "link": "https://stackoverflow.com/users/33796/luqui"}, "edited": false, "score": 0, "creation_date": 1425709269, "post_id": 28911846, "comment_id": 46082718, "body": "The type of x will be a Maybe Integer, my desired output?"}], "answers": [{"comments": [{"owner": {"reputation": 1387, "user_id": 4616611, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/90099c6ce97d206fcac50806bf8c74da?s=128&d=identicon&r=PG&f=1", "display_name": "Teodorico Levoff", "link": "https://stackoverflow.com/users/4616611/teodorico-levoff"}, "edited": false, "score": 0, "creation_date": 1425710034, "post_id": 28912103, "comment_id": 46082836, "body": "<a href=\"http://stackoverflow.com/questions/28894252/haskell-sum-values-in-a-tree\" title=\"haskell sum values in a tree\">stackoverflow.com/questions/28894252/&hellip;</a> trying to do this question really."}, {"owner": {"reputation": 1657, "user_id": 4183787, "user_type": "registered", "accept_rate": 62, "profile_image": "https://i.stack.imgur.com/XedpJ.png?s=128&g=1", "display_name": "zigazou", "link": "https://stackoverflow.com/users/4183787/zigazou"}, "reply_to_user": {"reputation": 1387, "user_id": 4616611, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/90099c6ce97d206fcac50806bf8c74da?s=128&d=identicon&r=PG&f=1", "display_name": "Teodorico Levoff", "link": "https://stackoverflow.com/users/4616611/teodorico-levoff"}, "edited": false, "score": 0, "creation_date": 1425711466, "post_id": 28912103, "comment_id": 46083119, "body": "With all the answers you get for that previous question, it&#39;s even less clear what you miss to achieve your goal. Have you seen that <a href=\"http://hackage.haskell.org/package/base-4.7.0.2/docs/Data-Foldable.html\" rel=\"nofollow noreferrer\">hackage.haskell.org/package/base-4.7.0.2/docs/&hellip;</a> gives an example that nearly does what you want to do ?"}, {"owner": {"reputation": 1657, "user_id": 4183787, "user_type": "registered", "accept_rate": 62, "profile_image": "https://i.stack.imgur.com/XedpJ.png?s=128&g=1", "display_name": "zigazou", "link": "https://stackoverflow.com/users/4183787/zigazou"}, "reply_to_user": {"reputation": 1387, "user_id": 4616611, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/90099c6ce97d206fcac50806bf8c74da?s=128&d=identicon&r=PG&f=1", "display_name": "Teodorico Levoff", "link": "https://stackoverflow.com/users/4616611/teodorico-levoff"}, "edited": false, "score": 0, "creation_date": 1425711612, "post_id": 28912103, "comment_id": 46083151, "body": "Could you give examples of trees you will be working on and what you expect the functions to return ?"}], "tags": [], "owner": {"reputation": 1657, "user_id": 4183787, "user_type": "registered", "accept_rate": 62, "profile_image": "https://i.stack.imgur.com/XedpJ.png?s=128&g=1", "display_name": "zigazou", "link": "https://stackoverflow.com/users/4183787/zigazou"}, "is_accepted": true, "score": 1, "last_activity_date": 1425709795, "creation_date": 1425709795, "answer_id": 28912103, "question_id": 28911846, "link": "https://stackoverflow.com/questions/28911846/calling-helper-functions-within-functions-haskell/28912103#28912103", "title": "Calling Helper functions within functions - Haskell", "body": "<p>What Haskell is telling you by saying <code>Not in scope</code> is that <code>x</code> is defined nowhere else.</p>\n\n<p>You should write something like:</p>\n\n<pre><code>treeSum x = sumTree (toList x)\n</code></pre>\n\n<p>The problem you will then face is a type error. <code>toList</code> takes a <code>Tree</code> and returns a <code>List</code> of <code>Integer</code> but <code>sumTree</code> is waiting for a <code>Tree</code>, not a list of <code>Integer</code>.</p>\n\n<p>To be honest, What you\u2019re trying to do is not really clear.</p>\n\n<p>Note: you should avoid having both <code>sumTree</code> and <code>treeSum</code> defined in your code because you will loose yourself and everyone who will try and read your code.</p>\n"}], "owner": {"reputation": 1387, "user_id": 4616611, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/90099c6ce97d206fcac50806bf8c74da?s=128&d=identicon&r=PG&f=1", "display_name": "Teodorico Levoff", "link": "https://stackoverflow.com/users/4616611/teodorico-levoff"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 1305, "favorite_count": 0, "accepted_answer_id": 28912103, "answer_count": 1, "score": 0, "last_activity_date": 1425709795, "creation_date": 1425707437, "last_edit_date": 1425708476, "question_id": 28911846, "link": "https://stackoverflow.com/questions/28911846/calling-helper-functions-within-functions-haskell", "title": "Calling Helper functions within functions - Haskell", "body": "<p>I have 3 functions, the first one is a </p>\n\n<pre><code>toList :: Tree -&gt; [Integer]\n</code></pre>\n\n<p>the second is </p>\n\n<pre><code>sumTree :: Tree -&gt; Maybe Integer\n</code></pre>\n\n<p>which sums a the elements in a tree, filtering for some edge cases. My main function is </p>\n\n<pre><code>treeSum :: Tree -&gt; Maybe Integer\n</code></pre>\n\n<p>which I want to call the toList on the input to Tree then call sumTree on the output of the previous call. I don't know how to structure it together elegantly. What I did was</p>\n\n<pre><code>treeSum = sumTree (toList x)\n</code></pre>\n\n<p>but I am getting <code>x</code> not in scope.</p>\n"}, {"tags": ["haskell"], "comments": [{"owner": {"reputation": 23444, "user_id": 414413, "user_type": "registered", "accept_rate": 79, "profile_image": "https://www.gravatar.com/avatar/6de2113f01432aa844dc85070ff33e89?s=128&d=identicon&r=PG", "display_name": "Cirdec", "link": "https://stackoverflow.com/users/414413/cirdec"}, "edited": false, "score": 0, "creation_date": 1425706602, "post_id": 28911723, "comment_id": 46082236, "body": "What do you mean by &quot;For each word of the bitfile ...&quot;? Are there multiple data structures other than the one included here, or are you extracting the same structure over and over again? If there are multiple data structures, it might be worth including another one to demonstrate what you are trying to generalize away."}, {"owner": {"reputation": 23444, "user_id": 414413, "user_type": "registered", "accept_rate": 79, "profile_image": "https://www.gravatar.com/avatar/6de2113f01432aa844dc85070ff33e89?s=128&d=identicon&r=PG", "display_name": "Cirdec", "link": "https://stackoverflow.com/users/414413/cirdec"}, "edited": false, "score": 0, "creation_date": 1425707390, "post_id": 28911723, "comment_id": 46082378, "body": "In particular, are bits <code>[0..2]</code> and <code>[7..15]</code> used to determine that you are looking at a <code>MOD_REG</code> or are they always the same when you already know you are dealing with a <code>MOD_REG</code>?"}, {"owner": {"reputation": 43, "user_id": 4643289, "user_type": "registered", "profile_image": "https://lh4.googleusercontent.com/-YBRRgE_k6KE/AAAAAAAAAAI/AAAAAAAAAAA/MGC-_BLf-ts/photo.jpg?sz=128", "display_name": "Antti Siponen", "link": "https://stackoverflow.com/users/4643289/antti-siponen"}, "reply_to_user": {"reputation": 23444, "user_id": 414413, "user_type": "registered", "accept_rate": 79, "profile_image": "https://www.gravatar.com/avatar/6de2113f01432aa844dc85070ff33e89?s=128&d=identicon&r=PG", "display_name": "Cirdec", "link": "https://stackoverflow.com/users/414413/cirdec"}, "edited": false, "score": 0, "creation_date": 1425768623, "post_id": 28911723, "comment_id": 46099277, "body": "There are 28 such data structures, nothing impossible to write out the &quot;hard way&quot; (in fact all are done now), but it just kept me thinking that there could be a better way. When dealing with register data I already know beforehand which register I am looking at. The packet format around these register words gives me an address for each."}, {"owner": {"reputation": 43, "user_id": 4643289, "user_type": "registered", "profile_image": "https://lh4.googleusercontent.com/-YBRRgE_k6KE/AAAAAAAAAAI/AAAAAAAAAAA/MGC-_BLf-ts/photo.jpg?sz=128", "display_name": "Antti Siponen", "link": "https://stackoverflow.com/users/4643289/antti-siponen"}, "reply_to_user": {"reputation": 23444, "user_id": 414413, "user_type": "registered", "accept_rate": 79, "profile_image": "https://www.gravatar.com/avatar/6de2113f01432aa844dc85070ff33e89?s=128&d=identicon&r=PG", "display_name": "Cirdec", "link": "https://stackoverflow.com/users/414413/cirdec"}, "edited": false, "score": 0, "creation_date": 1425770260, "post_id": 28911723, "comment_id": 46099689, "body": "The register bits with fixed values are reserved and required to hold those values, but of course somebody might once find out what they configure and then it would be nice to be able to easily extend the correspondin datatype and functions"}], "answers": [{"comments": [{"owner": {"reputation": 43, "user_id": 4643289, "user_type": "registered", "profile_image": "https://lh4.googleusercontent.com/-YBRRgE_k6KE/AAAAAAAAAAI/AAAAAAAAAAA/MGC-_BLf-ts/photo.jpg?sz=128", "display_name": "Antti Siponen", "link": "https://stackoverflow.com/users/4643289/antti-siponen"}, "edited": false, "score": 0, "creation_date": 1425834926, "post_id": 28923145, "comment_id": 46114623, "body": "Thank you very much for your work here. Your answer is clear and extremely well presented. This cleanly eliminates repeating the bit level operations for each new structure. I am still wondering about the symmetry between the &quot;put&quot; and &quot;get&quot; functions though. The bitfield lengths and ordering need to be given twice like in my original program. Here it is of course less of a problem as the amount of code around that repeated information is dramatically reduced and it is easier to quickly assess it&#39;s correctness."}, {"owner": {"reputation": 23444, "user_id": 414413, "user_type": "registered", "accept_rate": 79, "profile_image": "https://www.gravatar.com/avatar/6de2113f01432aa844dc85070ff33e89?s=128&d=identicon&r=PG", "display_name": "Cirdec", "link": "https://stackoverflow.com/users/414413/cirdec"}, "reply_to_user": {"reputation": 43, "user_id": 4643289, "user_type": "registered", "profile_image": "https://lh4.googleusercontent.com/-YBRRgE_k6KE/AAAAAAAAAAI/AAAAAAAAAAA/MGC-_BLf-ts/photo.jpg?sz=128", "display_name": "Antti Siponen", "link": "https://stackoverflow.com/users/4643289/antti-siponen"}, "edited": false, "score": 0, "creation_date": 1425845024, "post_id": 28923145, "comment_id": 46118186, "body": "@AnttiSiponen You may be interested in the <a href=\"http://www.informatik.uni-marburg.de/~rendel/unparse/\" rel=\"nofollow noreferrer\">invertible syntax paper</a> and <a href=\"https://hackage.haskell.org/package/invertible-syntax\" rel=\"nofollow noreferrer\">corresponding library</a>. It&#39;s a bit much for answering this question, and I have personal reservations about the simple representation with <code>Maybe</code>. It seems like there should be a more general <code>Lens</code>/<code>Prism</code>/<code>remit</code> solution without resorting to choosing specific error types (which all the existing libraries do)."}], "tags": [], "owner": {"reputation": 23444, "user_id": 414413, "user_type": "registered", "accept_rate": 79, "profile_image": "https://www.gravatar.com/avatar/6de2113f01432aa844dc85070ff33e89?s=128&d=identicon&r=PG", "display_name": "Cirdec", "link": "https://stackoverflow.com/users/414413/cirdec"}, "is_accepted": true, "score": 3, "last_activity_date": 1425789494, "creation_date": 1425789494, "answer_id": 28923145, "question_id": 28911723, "link": "https://stackoverflow.com/questions/28911723/haskell-bitfields-and-bit-level-protocols/28923145#28923145", "title": "Haskell bitfields and bit level protocols", "body": "<p>We're going to make our own library for reading from and writing to things that are <a href=\"https://hackage.haskell.org/package/base-4.7.0.2/docs/Data-Bits.html#t:Bits\" rel=\"nofollow\"><code>Bits</code></a>. It will be structured much like the binary package or the example code for serializing generics. We won't be taking advantage of generics because there's too much extra information beyond that available from the type that we need in order to know how to read and write the values. We are going to read the data via a monadic reader that we will get for free from the <a href=\"https://hackage.haskell.org/package/free-4.11/docs/Control-Monad-Free.html#t:Free\" rel=\"nofollow\"><code>Free</code></a> monad.</p>\n\n<pre><code>{-# LANGUAGE RankNTypes #-}\n{-# LANGUAGE DeriveFunctor #-}\n\nimport Data.Word\nimport Data.Bits\n\nimport Control.Monad.Free\nimport Control.Applicative\n\nimport Data.Monoid\n</code></pre>\n\n<h3>Reading</h3>\n\n<p>To get the monad for free, we need to define a base functor for reading from bits. <code>GetF</code> is our base functor. The only operation we perform is <code>Get</code>ing (reading) a number of bits. This will give us some value that we know will have both <code>Bits</code> and <code>Integral</code> instances, from which we need to determine what to do next.</p>\n\n<pre><code>data GetF next = Get Int (forall b. (Bits b, Integral b) =&gt; b -&gt; next)\n    deriving (Functor)\n\ntype Get = Free GetF\n</code></pre>\n\n<p>We get all of the instances we need for <code>Get</code> for free.</p>\n\n<p>Before continuing, we are going to adopt the convention of reading from and writing to the least significant bit end of the type. The next bit to read is always bit <code>0</code> and the last bit written was always bit <code>0</code>.</p>\n\n<p>To run a get computation, we need the following little interpreter. If we have a <code>Pure</code> result we return it. When we are instructed to <code>Get</code> bits to read we mask that number of the bits and run the function to figure out what to do next. We then run the resulting <code>Get</code> with that many bits shifted off the right.</p>\n\n<pre><code>runGet :: (Bits b, Integral b) =&gt; b -&gt; Get a -&gt; a\nrunGet bits (Pure a) = a\nrunGet bits (Free (Get l f)) = runGet (shiftR bits l) $ f (bits .&amp;. oneBits l)\n</code></pre>\n\n<p><code>oneBits</code> fills the specified number of least significant bits with <code>1</code>s.</p>\n\n<pre><code>oneBits :: Bits b =&gt; Int -&gt; b\noneBits n | n &lt;= 0 = zeroBits\noneBits n          = let (q, r) = n `quotRem` 2\n                         bq     = oneBits q\n                     in bit 0 .|. shiftL (bq .|. shiftL bq q) r\n</code></pre>\n\n<h3>Writing</h3>\n\n<p>When we put (write) bits, we need to provide the number of bits to write and the bits for any type that has both <code>Bits</code> and <code>Integeral</code> instances.</p>\n\n<pre><code>data Put = Put Int (forall b. (Bits b, Integral b) =&gt; b)\n</code></pre>\n\n<p>When we are paranoid building a <code>Put</code>, we'll mask the bits when we build it to make sure there aren't extra bits being put outside the length.</p>\n\n<pre><code>mkPut :: Int -&gt; (forall b. (Bits b, Integral b) =&gt; b) -&gt; Put\nmkPut l bits = Put l (bits .&amp;. oneBits l)\n</code></pre>\n\n<p>The only instance we need for <code>Put</code> is a <code>Monoid</code> so we can write one thing after another.</p>\n\n<pre><code>instance Monoid Put where\n    mempty = Put 0 0\n    Put l1 bits1 `mappend` Put l2 bits2 = Put (l1 + l2) (bits1 .|. shiftL bits2 l1)\n</code></pre>\n\n<h3>Helpers</h3>\n\n<p>We're going to write a few helper functions for building <code>Get</code>s and <code>Put</code>s. Most of the data you are encoding or decoding are <code>Enum</code>s of various bit lengths. <code>getEnum</code> will build the <code>Get</code> to go from <code>Integral</code> <code>Bits</code> to an <code>Enum</code>. It's essentially your <code>getName</code> wrapped up along with how many bits to get. <code>putEnum</code> wraps the bits to put up along with their length.</p>\n\n<pre><code>getEnum :: Enum e =&gt; Int -&gt; Get e\ngetEnum l = Free (Get l (Pure . toEnum . fromIntegral))\n\nputEnum :: Enum e =&gt; Int -&gt; e -&gt; Put\nputEnum l x = mkPut l (fromIntegral . fromEnum $ x)\n</code></pre>\n\n<p>You also need to skip bits when reading some structures. <code>getSkip</code> skips bits without doing anything with them. <code>putSkip</code> puts the same number of <code>0</code> bits; <code>putSkip1</code> puts the same number of <code>1</code> bits.</p>\n\n<pre><code>getSkip :: Int -&gt; Get ()\ngetSkip l = Free (Get l (const (Pure ())))\n\nputSkip :: Int -&gt; Put\nputSkip l = Put l 0\n\nputSkip1 :: Int -&gt; Put\nputSkip1 l = Put l (oneBits l)\n</code></pre>\n\n<h3>MOD_REG</h3>\n\n<p>At the very beginning, we chose to read from and write to the least significant bit. Due to this choice of convention, we're going to make the data types with the least significant field first. Here's <code>ModReg</code>, which represents a <code>MOD_REG</code> structure. The boot mode, which is stored in less significant bits, is the first field in the structure.</p>\n\n<pre><code>data ModReg = ModReg {bootmode :: Bootmode, newMode :: NewMode} deriving (Show, Eq)\ndata Bootmode = SerialM | SpiM | BpiUp | InternalM | ReservedMode \n                | Jtag  | ParallelS | SerialS \n                deriving (Show, Eq, Enum)\ndata NewMode = NoNewMode | NewMode deriving (Show, Eq, Enum)\n</code></pre>\n\n<p>I'm going to add a type class for things that can be written to or read from <code>Bits</code>, not because we want to use the type class, but simply so I don't need to come up with a name for all of these.</p>\n\n<pre><code>class Encodeable a where\n    put :: a -&gt; Put\n    get :: Get a\n</code></pre>\n\n<p>We can now read and write the <code>ModReg</code> structure least significant bits first. The trick with the <code>ModReg</code> constructor in the second line is why I put the fields in least significant bit first order.</p>\n\n<pre><code>instance Encodeable ModReg where\n    put mr =           putSkip1 3 &lt;&gt;  putEnum 3 (bootmode mr) &lt;&gt;  putEnum 1 (newMode mr)\n    get    = ModReg &lt;$ getSkip  3 &lt;*&gt; getEnum 3               &lt;*&gt; getEnum 1\n</code></pre>\n\n<h3>Running Example</h3>\n\n<p>For a complete, running example it will be nice to be able to pretty-print the bits in a <code>Bits</code>. We'll print them with the most significant bit first.</p>\n\n<pre><code>import Data.List (intercalate)\n\nshowBitsN :: Bits b =&gt; Int -&gt; b -&gt; String\nshowBitsN n b = \"[\" ++ intercalate \" \" (map (\\x -&gt; if testBit b x then \"1\" else \"0\") [n,n-1..0]) ++ \"]\"\n\nshowBits :: FiniteBits b =&gt; b -&gt; String\nshowBits b = showBitsN (finiteBitSize b) b\n</code></pre>\n\n<p>Our example will make a <code>ModReg</code> with the <code>Jtag</code> flag <code>1 0 1</code> in bits 3 through 5 and the <code>NewMode</code> flag <code>1</code> in bit 6. We'll convert it to a <code>Word16</code> then convert it back again.</p>\n\n<pre><code>main = do \n    let mr = ModReg Jtag NewMode \n    print mr\n    let x = runPut (put mr) :: Word16\n    putStrLn $ showBits x\n    let mr' = runGet x get :: ModReg\n    print mr'\n</code></pre>\n\n<p>This results in the expected output</p>\n\n<pre><code>ModReg {bootmode = Jtag, newMode = NewMode}\n111\n[0 0 0 0 0 0 0 0 0 0 1 1 0 1 1 1 1]\nModReg {bootmode = Jtag, newMode = NewMode}\n</code></pre>\n\n<p>If we instead put two <code>ModReg</code>s in a row into a <code>Word32</code> we'll get a little surprise.</p>\n\n<pre><code>main = do \n    let (mr1, mr2) = (ModReg Jtag NewMode, ModReg BpiUp NoNewMode)\n    let x = runPut (put mr1 &lt;&gt; put mr2) :: Word32\n    print x\n    putStrLn $ showBits x\n    let mr' = runGet x (get &gt;&gt;= \\a -&gt; get &gt;&gt;= \\b -&gt; return (a, b)) :: (ModReg, ModReg)\n    print mr'\n</code></pre>\n\n<p>Instead of two <code>Word16</code>s next to each other, all of the set bits fit into less than half of the space.</p>\n\n<pre><code>3055\n[0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 1 0 1 1 1 1 1 0 1 1 1 1]\n(ModReg {bootmode = Jtag, newMode = NewMode},ModReg {bootmode = BpiUp, newMode = NoNewMode})\n</code></pre>\n\n<p>If we want to use our <code>get</code> and <code>put</code> for <code>ModReg</code> this way, we need to add the <code>skip</code>s for the most significant bits.</p>\n\n<pre><code>instance Encodeable ModReg where\n    put mr =           putSkip1 3 &lt;&gt;  putEnum 3 (bootmode mr) &lt;&gt;  putEnum 1 (newMode mr) &lt;&gt; putSkip 9\n    get    = ModReg &lt;$ getSkip  3 &lt;*&gt; getEnum 3               &lt;*&gt; getEnum 1              &lt;* getSkip 9\n</code></pre>\n\n<p>Now a <code>ModReg</code> is written 16 bits wide.</p>\n\n<pre><code>1507439\n[0 0 0 0 0 0 0 0 0 0 0 0 1 0 1 1 1 0 0 0 0 0 0 0 0 0 1 1 0 1 1 1 1]\n(ModReg {bootmode = Jtag, newMode = NewMode},ModReg {bootmode = BpiUp, newMode = NoNewMode})\n</code></pre>\n"}], "owner": {"reputation": 43, "user_id": 4643289, "user_type": "registered", "profile_image": "https://lh4.googleusercontent.com/-YBRRgE_k6KE/AAAAAAAAAAI/AAAAAAAAAAA/MGC-_BLf-ts/photo.jpg?sz=128", "display_name": "Antti Siponen", "link": "https://stackoverflow.com/users/4643289/antti-siponen"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 486, "favorite_count": 0, "accepted_answer_id": 28923145, "answer_count": 1, "score": 4, "last_activity_date": 1425789494, "creation_date": 1425706120, "last_edit_date": 1425768784, "question_id": 28911723, "link": "https://stackoverflow.com/questions/28911723/haskell-bitfields-and-bit-level-protocols", "title": "Haskell bitfields and bit level protocols", "body": "<p>I am working on generating and parsing an existing binary format (Xilinx FPGA bitfiles) using Haskell. At the moment my data structures and operations look like this:</p>\n\n<pre><code>getCode = fromIntegral.fromEnum\ngetName = toEnum.fromIntegral\n\n--          1 1 1 1 1 1\n--          5 4 3 2 1 0 9 8 7 6 5 4 3 2 1 0\n-- MOD_REG  -------------------------------\n--          0 0 0 0 0 0 0 0 0 N B B B 1 1 1 \n--                            M M M M\n--                              2 1 0\n\ndata NewMode = NoNewMode | NewMode deriving (Show, Eq, Enum)\ndata Bootmode = SerialM | SpiM | BpiUp | InternalM | ReservedMode \n                | Jtag  | ParallelS | SerialS \n                deriving (Show, Eq, Enum)\nmodeCode :: NewMode -&gt; Bootmode -&gt; Word16\nmodeCode newmode bootmode = (shiftL (getCode newmode) 6) .|. \n                            (shiftL (getCode bootmode) 3) .|. 0x7 \ncodeMode :: Word16 -&gt; (NewMode, Bootmode)\ncodeMode w = (getName $ shiftR w 6 .&amp;. 0x0001, \n              getName $ shiftR w 3 .&amp;. 0x0007)\n</code></pre>\n\n<p>For each different configuration register word present in the device I have written a very similar set of lines (more examples at the bottom). Only the amount of shift and the number of bits in the AND mask change. I have a feeling that it should be somehow possible to eliminate this repetition that is annoying to type out and an easy source for hard to find bugs.</p>\n\n<p>My first intuition was to add a type class \"Bitfield\" that each individual register word (or rather the datatype representing one) in the bitfile would be an instance of and that would allow me to only type out a representation of the structure of the word and from that I could somehow have default implementations for generating and parsing. I couldn't figure out how to bend the standard class system to do this, but is there some combination of type system extensions/generics/existentials/ghc-extras that would eventually allow me to replace those generating and parsing functions in the code with something like </p>\n\n<pre><code>class Bitfield t where\n  representation :: something\n  toBits :: t -&gt; Int\n  fromBits :: Int -&gt; t\n  toBits = something (using representation)\n  fromBits = something (using representation)\n\n\ninstance Bitfield ModReg where\n  representation = something\n</code></pre>\n\n<p>and afterwards simply have toBits and fromBits in my use? Somehow this looks almost exactly like the Ghc.Generics tutorial example with serialization of arbitrary datatypes to binary. Still I didn't quite manage to apply it to my case.</p>\n\n<p>Below are some more examples of generate and parse functions for other registers to show the repetition I am talking about. In the actual full code there are many more. Also see how the bit positions and field lengths are embedded in the functions and repeated in each, doubling the number of opportunities to make mistakes that the compiler cannot catch.</p>\n\n<pre><code>--          1 1 1 1 1 1\n--          5 4 3 2 1 0 9 8 7 6 5 4 3 2 1 0\n-- CTL_REG  -------------------------------\n--          0 0 0 0 0 0 0 0 E 0 S S P I 0 G \n--                          M   B B E C   T\n--                              1 0 R P   S\n\ndata EnMboot = DisMboot | EnMboot deriving (Show, Eq, Enum)\ndata Sbits = ReadWrite | IcapOnly | CrcOnly deriving (Show, Eq, Enum)\ndata Persist = NoPersist | Persist deriving (Show, Eq, Enum)\ndata Icap = NoIcap | Icap deriving (Show, Eq, Enum)\ndata GtsUserB = IoHighZ | IoActive deriving (Show, Eq, Enum)\nctlCode :: EnMboot -&gt; Sbits -&gt; Persist -&gt; Icap -&gt; GtsUserB -&gt; Word16\nctlCode enmboot sbits persist icap gtsuserb = \n  (shiftL (getCode enmboot) 7) .|.\n  (shiftL (getCode sbits) 4) .|.\n  (shiftL (getCode persist) 3) .|.\n  (shiftL (getCode icap) 2) .|.\n  (getCode gtsuserb)\ncodeCtl :: Word16 -&gt; (EnMboot,Sbits,Persist,Icap,GtsUserB)\ncodeCtl w = \n  (getName $ shiftR w 7 .&amp;. 0x0001,\n   getName $ shiftR w 4 .&amp;. 0x0003,\n   getName $ shiftR w 3 .&amp;. 0x0001,\n   getName $ shiftR w 2 .&amp;. 0x0001,\n   getName $ w .&amp;. 0x0001)\n\n\n--          1 1 1 1 1 1\n--          5 4 3 2 1 0 9 8 7 6 5 4 3 2 1 0\n-- COR_REG1 -------------------------------\n--          D 0 1 1 1 1 1 1 0 0 0 C D D S S \n--          A                     R P D C C      \n--                                C     1 0   \n\ndata DriveAwake = OpenDrainAwake | DriveAwake deriving (Show, Eq, Enum)\ndata CrcBypass = CrcEnabled | CrcDisabled deriving (Show, Eq, Enum)\ndata DonePipe = NoDonePipe | DonePipe deriving (Show, Eq, Enum)\ndata DriveDone = OpenDrainDone | DriveDone  deriving (Show, Eq, Enum)\ndata SsClkSrc = Cclk | UserClk | JtagClk deriving (Show, Eq, Enum)\ncor1Code :: DriveAwake -&gt; CrcBypass -&gt; DonePipe -&gt; DriveDone -&gt; \n            SsClkSrc -&gt; Word16\ncor1Code driveawake crcbypass donepipe drivedone ssclksrc =\n  (shiftL (getCode driveawake) 15) .|.\n  0x2F00 .|.\n  (shiftL (getCode crcbypass) 4) .|.\n  (shiftL (getCode donepipe) 3) .|.\n  (shiftL (getCode drivedone) 2) .|.\n  (getCode ssclksrc)\ncodeCor1 :: Word16 -&gt; (DriveAwake,CrcBypass,DonePipe,DriveDone,SsClkSrc)\ncodeCor1 w = \n  (getName $ shiftR w 15 .&amp;. 0x0001,\n   getName $ shiftR w 4 .&amp;. 0x0001,\n   getName $ shiftR w 3 .&amp;. 0x0001,\n   getName $ shiftR w 2 .&amp;. 0x0001,\n   getName $ w .&amp;. 0x0003)\n</code></pre>\n"}, {"tags": ["python", "json", "haskell"], "comments": [{"owner": {"reputation": 43759, "user_id": 1651941, "user_type": "registered", "accept_rate": 97, "profile_image": "https://www.gravatar.com/avatar/a513bc1fa519d2fcf5e4e0d9b5500101?s=128&d=identicon&r=PG", "display_name": "Sibi", "link": "https://stackoverflow.com/users/1651941/sibi"}, "edited": false, "score": 0, "creation_date": 1425707376, "post_id": 28911684, "comment_id": 46082375, "body": "I would suggest to use wreq which is a more modern and suitalble library for this: <a href=\"http://www.serpentine.com/wreq/\" rel=\"nofollow noreferrer\">serpentine.com/wreq</a>"}, {"owner": {"reputation": 1556, "user_id": 1684354, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/5601bae4a82262e2d26ebb9da9b17f0b?s=128&d=identicon&r=PG", "display_name": "iced", "link": "https://stackoverflow.com/users/1684354/iced"}, "edited": false, "score": 0, "creation_date": 1425708668, "post_id": 28911684, "comment_id": 46082613, "body": "and you certainly do not need json-rpc ;)"}, {"owner": {"reputation": 399, "user_id": 3857075, "user_type": "registered", "accept_rate": 57, "profile_image": "https://i.stack.imgur.com/ofemI.jpg?s=128&g=1", "display_name": "Animesh Saxena", "link": "https://stackoverflow.com/users/3857075/animesh-saxena"}, "edited": false, "score": 0, "creation_date": 1425711193, "post_id": 28911684, "comment_id": 46083061, "body": "doesn&#39;t work...this same python request reports error in haskell..."}, {"owner": {"reputation": 399, "user_id": 3857075, "user_type": "registered", "accept_rate": 57, "profile_image": "https://i.stack.imgur.com/ofemI.jpg?s=128&g=1", "display_name": "Animesh Saxena", "link": "https://stackoverflow.com/users/3857075/animesh-saxena"}, "edited": false, "score": 0, "creation_date": 1425711250, "post_id": 28911684, "comment_id": 46083074, "body": "[{&quot;u1&quot;:[&quot;a1&quot;], &quot;bt&quot;:[&quot;C&quot;], &quot;p&quot;:[&quot;1&quot;], &quot;b2&quot;:[&quot;0.25&quot;], &quot;dd&quot;:[&quot;5m&quot;],&quot;cur&quot;:[&quot;ud&quot;],&quot;cs&quot;:[&quot;10&quot;]}, [&quot;?shortcode_info&quot;, &quot;?okpr&quot;]]"}, {"owner": {"reputation": 399, "user_id": 3857075, "user_type": "registered", "accept_rate": 57, "profile_image": "https://i.stack.imgur.com/ofemI.jpg?s=128&g=1", "display_name": "Animesh Saxena", "link": "https://stackoverflow.com/users/3857075/animesh-saxena"}, "edited": false, "score": 0, "creation_date": 1425711275, "post_id": 28911684, "comment_id": 46083077, "body": "post &quot;<a href=\"http://ipaddress:port/\" rel=\"nofollow noreferrer\">ipaddress:port</a>&quot; [{&quot;u1&quot;:[&quot;a1&quot;], &quot;bt&quot;:[&quot;C&quot;], &quot;p&quot;:[&quot;1&quot;], &quot;b2&quot;:[&quot;0.25&quot;], &quot;dd&quot;:[&quot;5m&quot;],&quot;cur&quot;:[&quot;ud&quot;],&quot;cs&quot;:[&quot;10&quot;]}, [&quot;?shortcode_info&quot;, &quot;?okpr&quot;]]  gives errro"}, {"owner": {"reputation": 399, "user_id": 3857075, "user_type": "registered", "accept_rate": 57, "profile_image": "https://i.stack.imgur.com/ofemI.jpg?s=128&g=1", "display_name": "Animesh Saxena", "link": "https://stackoverflow.com/users/3857075/animesh-saxena"}, "edited": false, "score": 0, "creation_date": 1425711285, "post_id": 28911684, "comment_id": 46083081, "body": "&lt;interactive&gt;:13:9: parse error on input \u2018{\u2019"}, {"owner": {"reputation": 399, "user_id": 3857075, "user_type": "registered", "accept_rate": 57, "profile_image": "https://i.stack.imgur.com/ofemI.jpg?s=128&g=1", "display_name": "Animesh Saxena", "link": "https://stackoverflow.com/users/3857075/animesh-saxena"}, "edited": false, "score": 0, "creation_date": 1425711328, "post_id": 28911684, "comment_id": 46083091, "body": "the exact same request goes through with python where i specify the method name to call, here its a bit confusion coz even json is giving error"}, {"owner": {"reputation": 325, "user_id": 2841309, "user_type": "registered", "accept_rate": 48, "profile_image": "https://www.gravatar.com/avatar/8dd89b9b62cd483082b3f1a20acff659?s=128&d=identicon&r=PG&f=1", "display_name": "coffeequant", "link": "https://stackoverflow.com/users/2841309/coffeequant"}, "edited": false, "score": 0, "creation_date": 1425951671, "post_id": 28911684, "comment_id": 46163157, "body": "Can anyone post a proper code?"}], "answers": [{"comments": [{"owner": {"reputation": 399, "user_id": 3857075, "user_type": "registered", "accept_rate": 57, "profile_image": "https://i.stack.imgur.com/ofemI.jpg?s=128&g=1", "display_name": "Animesh Saxena", "link": "https://stackoverflow.com/users/3857075/animesh-saxena"}, "edited": false, "score": 0, "creation_date": 1426038879, "post_id": 28973417, "comment_id": 46205526, "body": "Thanks for your reply! Actually I realized yesterday that python client was using netstrings. The server just expects netstrings, so trying to understand how the server works. On python side I used the library jsonrpc_ns, which works fine"}], "tags": [], "owner": {"reputation": 1657, "user_id": 4183787, "user_type": "registered", "accept_rate": 62, "profile_image": "https://i.stack.imgur.com/XedpJ.png?s=128&g=1", "display_name": "zigazou", "link": "https://stackoverflow.com/users/4183787/zigazou"}, "is_accepted": true, "score": 5, "last_activity_date": 1426019084, "creation_date": 1426019084, "answer_id": 28973417, "question_id": 28911684, "link": "https://stackoverflow.com/questions/28911684/how-to-make-json-request-in-haskell/28973417#28973417", "title": "how to make json request in haskell?", "body": "<p>Here's a working example doing a <code>POST</code> query on <code>httpbin.org</code>:</p>\n\n<pre><code>{-# LANGUAGE OverloadedStrings #-}\nmodule Main where\n\nimport Network.Wreq\nimport Control.Lens\nimport Data.Aeson.Lens\nimport qualified Data.Text as T\nimport Data.Aeson\n\nmain = do\n    r &lt;- post \"http://httpbin.org/post\" (toJSON (T.unpack \"123\"))\n\n    let datas = r ^. responseBody . key \"data\" . _String\n        ua    = r ^. responseBody . key \"headers\" . key \"User-Agent\" . _String\n\n    (putStrLn . T.unpack) datas\n    (putStrLn . T.unpack) ua\n</code></pre>\n\n<p>It should print something like:</p>\n\n<pre><code>\"123\"\nhaskell wreq-0.3.0.1\n</code></pre>\n\n<p>I tried it with URLs of the form <code>http://127.0.0.1:80</code> and it gave the same result.</p>\n\n<p>Have you tried to use <code>curl</code> in your shell to see if it exhibits the same behavior ?\nIs it possible that the server answers only if some header fields are present or set at a specific value ?</p>\n"}], "owner": {"reputation": 399, "user_id": 3857075, "user_type": "registered", "accept_rate": 57, "profile_image": "https://i.stack.imgur.com/ofemI.jpg?s=128&g=1", "display_name": "Animesh Saxena", "link": "https://stackoverflow.com/users/3857075/animesh-saxena"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 1198, "favorite_count": 2, "accepted_answer_id": 28973417, "answer_count": 1, "score": 3, "last_activity_date": 1426019084, "creation_date": 1425705574, "last_edit_date": 1425972772, "question_id": 28911684, "link": "https://stackoverflow.com/questions/28911684/how-to-make-json-request-in-haskell", "title": "how to make json request in haskell?", "body": "<p>I have a server which accepts json requests and they work fine with python client. I am trying to do the same thing in haskell.</p>\n\n<p>For instance my python client has following code</p>\n\n<pre><code>conn = JSONRPCProxy(\"XXX.XX.XX.XX\", 5050, \"2.0\", 120)\nprint conn.request('show_attrs', [{\"shortcode\":\"CODEWORD1\",\"fx\":'CD2'}, [\"?queryattr\", \"queryname\"]]);\n</code></pre>\n\n<p>I want to send out the same query using haskell and get json back as result. Not worried about json parsing as of now!</p>\n\n<p>I tried Network.Wreq and it kinda works but always gives no response</p>\n\n<pre><code>data MyPriceRequest = MyRequestRequest { method::String,id::Int} deriving (Show,Generic)\n\ninstance ToJSON MyPriceRequest\nr &lt;- post \"http://IP.IP.IP.IP:port/\" (toJSON (MyRequestRequest  \"codeword\" [\"\"] 1))\n\n*** Exception: NoResponseDataReceived\n</code></pre>\n\n<p>I get exception but same code works with python</p>\n\n<p>In python it works with...</p>\n\n<pre><code>conn = JSONRPCProxy(\"IP.IP.IP.IP\", port, \"2.0\", 120)\nprint conn.request('codeword', []);\n</code></pre>\n"}, {"tags": ["haskell", "functional-programming"], "comments": [{"owner": {"reputation": 11780, "user_id": 2827654, "user_type": "registered", "accept_rate": 57, "profile_image": "https://www.gravatar.com/avatar/a171742e9c31a541d4d2031af932e94a?s=128&d=identicon&r=PG&f=1", "display_name": "jamshidh", "link": "https://stackoverflow.com/users/2827654/jamshidh"}, "edited": false, "score": 0, "creation_date": 1425698557, "post_id": 28911006, "comment_id": 46080847, "body": "pattern matching could be your friend here...."}, {"owner": {"reputation": 25144, "user_id": 477476, "user_type": "registered", "accept_rate": 85, "profile_image": "https://i.stack.imgur.com/Qf4TT.png?s=128&g=1", "display_name": "Cactus", "link": "https://stackoverflow.com/users/477476/cactus"}, "edited": false, "score": 3, "creation_date": 1425704981, "post_id": 28911006, "comment_id": 46081968, "body": "No problem with doing it for learning, but for production use, you should be aware that <code>Either</code> is a <a href=\"https://hackage.haskell.org/package/bifunctors/docs/Data-Bifunctor.html\" rel=\"nofollow noreferrer\">bifunctor</a> so this is just <code>bimap</code> at <code>Either</code>."}, {"owner": {"reputation": 1387, "user_id": 4616611, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/90099c6ce97d206fcac50806bf8c74da?s=128&d=identicon&r=PG&f=1", "display_name": "Teodorico Levoff", "link": "https://stackoverflow.com/users/4616611/teodorico-levoff"}, "edited": false, "score": 0, "creation_date": 1425706643, "post_id": 28911006, "comment_id": 46082241, "body": "I used bheklilr help below, but seem to be getting some errors if maybe you could help me out?"}], "answers": [{"comments": [{"owner": {"reputation": 1387, "user_id": 4616611, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/90099c6ce97d206fcac50806bf8c74da?s=128&d=identicon&r=PG&f=1", "display_name": "Teodorico Levoff", "link": "https://stackoverflow.com/users/4616611/teodorico-levoff"}, "edited": false, "score": 0, "creation_date": 1425700309, "post_id": 28911041, "comment_id": 46081105, "body": "Now what we have left to do, is check the inner type if its capable and then map?"}, {"owner": {"reputation": 51584, "user_id": 839246, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/9b0573c2b936b12828dd1e4cc04206dc?s=128&d=identicon&r=PG&f=1", "display_name": "bheklilr", "link": "https://stackoverflow.com/users/839246/bheklilr"}, "reply_to_user": {"reputation": 1387, "user_id": 4616611, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/90099c6ce97d206fcac50806bf8c74da?s=128&d=identicon&r=PG&f=1", "display_name": "Teodorico Levoff", "link": "https://stackoverflow.com/users/4616611/teodorico-levoff"}, "edited": false, "score": 0, "creation_date": 1425700459, "post_id": 28911041, "comment_id": 46081129, "body": "@TeodoricoLevoff That&#39;s what <code>Left</code> and <code>Right</code> do, they select the type of the contents.  The definition of <code>EIther</code> is <code>data Either a b = Left a | Right b</code>.  The contents in <code>Left</code> can only be of type <code>a</code>, and the contents in <code>Right</code> can only be of type <code>b</code>."}, {"owner": {"reputation": 1387, "user_id": 4616611, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/90099c6ce97d206fcac50806bf8c74da?s=128&d=identicon&r=PG&f=1", "display_name": "Teodorico Levoff", "link": "https://stackoverflow.com/users/4616611/teodorico-levoff"}, "edited": false, "score": 0, "creation_date": 1425701716, "post_id": 28911041, "comment_id": 46081318, "body": "Ah right, so then what is left is to map the Either value to the function. Something like, ... = Left z where z = xz x, I think I butchered the syntax, but I want to map the Either value to that function for both Left and Right."}, {"owner": {"reputation": 51584, "user_id": 839246, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/9b0573c2b936b12828dd1e4cc04206dc?s=128&d=identicon&r=PG&f=1", "display_name": "bheklilr", "link": "https://stackoverflow.com/users/839246/bheklilr"}, "reply_to_user": {"reputation": 1387, "user_id": 4616611, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/90099c6ce97d206fcac50806bf8c74da?s=128&d=identicon&r=PG&f=1", "display_name": "Teodorico Levoff", "link": "https://stackoverflow.com/users/4616611/teodorico-levoff"}, "edited": false, "score": 0, "creation_date": 1425701760, "post_id": 28911041, "comment_id": 46081327, "body": "@TeodoricoLevoff You&#39;re on the right track, I&#39;ll say that."}, {"owner": {"reputation": 1387, "user_id": 4616611, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/90099c6ce97d206fcac50806bf8c74da?s=128&d=identicon&r=PG&f=1", "display_name": "Teodorico Levoff", "link": "https://stackoverflow.com/users/4616611/teodorico-levoff"}, "edited": false, "score": 0, "creation_date": 1425702331, "post_id": 28911041, "comment_id": 46081432, "body": "So, like mapAorB xz yw (Left x) = Left z where z = xz x                                             mapAorB xz yw (Right y) = Right w where w = yw y . bheklilr, based on the steps done, we started off pattern matching checking both the left and right if the inner type is compatible, and then the next step is to do the map part? I can&#39;t see anymore steps. Also, is the syntax for calling the map correct? Thanks"}, {"owner": {"reputation": 51584, "user_id": 839246, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/9b0573c2b936b12828dd1e4cc04206dc?s=128&d=identicon&r=PG&f=1", "display_name": "bheklilr", "link": "https://stackoverflow.com/users/839246/bheklilr"}, "reply_to_user": {"reputation": 1387, "user_id": 4616611, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/90099c6ce97d206fcac50806bf8c74da?s=128&d=identicon&r=PG&f=1", "display_name": "Teodorico Levoff", "link": "https://stackoverflow.com/users/4616611/teodorico-levoff"}, "edited": false, "score": 0, "creation_date": 1425702480, "post_id": 28911041, "comment_id": 46081465, "body": "@TeodoricoLevoff Try it out.  You can use it as <code>mapAorB f1 f2 (Left someValue)</code> or <code>mapAorB f1 f2 (Right anotherValue)</code>."}, {"owner": {"reputation": 1387, "user_id": 4616611, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/90099c6ce97d206fcac50806bf8c74da?s=128&d=identicon&r=PG&f=1", "display_name": "Teodorico Levoff", "link": "https://stackoverflow.com/users/4616611/teodorico-levoff"}, "reply_to_user": {"reputation": 51584, "user_id": 839246, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/9b0573c2b936b12828dd1e4cc04206dc?s=128&d=identicon&r=PG&f=1", "display_name": "bheklilr", "link": "https://stackoverflow.com/users/839246/bheklilr"}, "edited": false, "score": 0, "creation_date": 1425702774, "post_id": 28911041, "comment_id": 46081518, "body": "Let us <a href=\"http://chat.stackoverflow.com/rooms/72448/discussion-between-teodorico-levoff-and-bheklilr\">continue this discussion in chat</a>."}], "tags": [], "owner": {"reputation": 51584, "user_id": 839246, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/9b0573c2b936b12828dd1e4cc04206dc?s=128&d=identicon&r=PG&f=1", "display_name": "bheklilr", "link": "https://stackoverflow.com/users/839246/bheklilr"}, "is_accepted": true, "score": 5, "last_activity_date": 1425698764, "creation_date": 1425698764, "answer_id": 28911041, "question_id": 28911006, "link": "https://stackoverflow.com/questions/28911006/haskell-either-map-only-one/28911041#28911041", "title": "Haskell - Either Map Only One", "body": "<p>Start by writing out all the arguments to the function</p>\n\n<pre><code>mapAorB :: (x -&gt; z) -&gt; (y -&gt; w) -&gt; Either x y -&gt; Either z w\nmapAorB xz yw eitherxy = undefined\n</code></pre>\n\n<p>Then determine if any arguments can be matched on.  Here, only <code>Either</code> can be.  Expand the argument into pattern cases:</p>\n\n<pre><code>mapAorB xz yw (Left x) = undefined\nmapAorB xz yw (Right y) = undefined\n</code></pre>\n\n<p>By the specification for the function, we know that if we input <code>Left x</code> then we'll get <code>Left z</code>, and similarly if we input <code>Right y</code> it'll return <code>Right w</code>.  That gives an extra hint:</p>\n\n<pre><code>mapAorB xz yw (Left x) = Left z where z = undefined\nmapAorB xz yw (Right y) = Right w where w = undefined\n</code></pre>\n\n<p>So how would you define <code>z</code> and <code>w</code>?</p>\n"}], "owner": {"reputation": 1387, "user_id": 4616611, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/90099c6ce97d206fcac50806bf8c74da?s=128&d=identicon&r=PG&f=1", "display_name": "Teodorico Levoff", "link": "https://stackoverflow.com/users/4616611/teodorico-levoff"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 387, "favorite_count": 0, "accepted_answer_id": 28911041, "answer_count": 1, "score": 1, "last_activity_date": 1425698799, "creation_date": 1425698390, "last_edit_date": 1425698799, "question_id": 28911006, "link": "https://stackoverflow.com/questions/28911006/haskell-either-map-only-one", "title": "Haskell - Either Map Only One", "body": "<p>I want to write a function which consumes an <code>Either</code> value, and two functions. It applies only one of the functions based on which one is compatible with the inner type. Totally struggling with implementing this one. </p>\n\n<pre><code>mapAorB :: (x -&gt; z) -&gt; (y -&gt; w) -&gt; Either x y -&gt; Either z w\n</code></pre>\n"}, {"tags": ["haskell"], "answers": [{"comments": [{"owner": {"reputation": 1089, "user_id": 3681109, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/d676ca6572e75e842ca0fa3e9e82d1bb?s=128&d=identicon&r=PG&f=1", "display_name": "genisage", "link": "https://stackoverflow.com/users/3681109/genisage"}, "edited": false, "score": 1, "creation_date": 1425698420, "post_id": 28910989, "comment_id": 46080828, "body": "If you don&#39;t feel like manually unwrapping maybes, <code>liftA div a b</code> is probably the way to go."}, {"owner": {"reputation": 15, "user_id": 3755403, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/dab3156d75660677ae7fcaa44b9f9d9c?s=128&d=identicon&r=PG&f=1", "display_name": "WhatDoor", "link": "https://stackoverflow.com/users/3755403/whatdoor"}, "reply_to_user": {"reputation": 1089, "user_id": 3681109, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/d676ca6572e75e842ca0fa3e9e82d1bb?s=128&d=identicon&r=PG&f=1", "display_name": "genisage", "link": "https://stackoverflow.com/users/3681109/genisage"}, "edited": false, "score": 0, "creation_date": 1425698686, "post_id": 28910989, "comment_id": 46080863, "body": "Thanks for the solution, but im not sure what @genisage means by that... Also, can you elaborate a simple way to extract Maybe Values?"}, {"owner": {"reputation": 13734, "user_id": 938694, "user_type": "registered", "accept_rate": 59, "profile_image": "https://www.gravatar.com/avatar/b6678a430a805dd78366d6e135b49f2d?s=128&d=identicon&r=PG", "display_name": "Cubic", "link": "https://stackoverflow.com/users/938694/cubic"}, "reply_to_user": {"reputation": 15, "user_id": 3755403, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/dab3156d75660677ae7fcaa44b9f9d9c?s=128&d=identicon&r=PG&f=1", "display_name": "WhatDoor", "link": "https://stackoverflow.com/users/3755403/whatdoor"}, "edited": false, "score": 0, "creation_date": 1425698912, "post_id": 28910989, "comment_id": 46080911, "body": "@WhatDoor You&#39;re unwrapping maybe values in your question."}, {"owner": {"reputation": 11780, "user_id": 2827654, "user_type": "registered", "accept_rate": 57, "profile_image": "https://www.gravatar.com/avatar/a171742e9c31a541d4d2031af932e94a?s=128&d=identicon&r=PG&f=1", "display_name": "jamshidh", "link": "https://stackoverflow.com/users/2827654/jamshidh"}, "edited": false, "score": 0, "creation_date": 1425699120, "post_id": 28910989, "comment_id": 46080949, "body": "@WhatDoor- A clean way to unwrap would be to use <code>case</code> and pattern matching, or just use pattern matching at the function definition level.  A less clean way would be to use <code>fromJust</code> (which can crash if you accidentally give a <code>Nothing</code>)...."}], "tags": [], "owner": {"reputation": 11780, "user_id": 2827654, "user_type": "registered", "accept_rate": 57, "profile_image": "https://www.gravatar.com/avatar/a171742e9c31a541d4d2031af932e94a?s=128&d=identicon&r=PG&f=1", "display_name": "jamshidh", "link": "https://stackoverflow.com/users/2827654/jamshidh"}, "is_accepted": true, "score": 2, "last_activity_date": 1425698186, "creation_date": 1425698186, "answer_id": 28910989, "question_id": 28910956, "link": "https://stackoverflow.com/questions/28910956/haskell-couldnt-match-expected-type-involving-maybe/28910989#28910989", "title": "Haskell Couldn&#39;t match expected type involving maybe", "body": "<p>In <code>maybe_divide</code>, the types of <code>a</code> and <code>b</code> are <code>Maybe Integer</code>....  You can not divide <code>Maybe Integer</code>s</p>\n\n<pre><code>a `div` b --won't work\n</code></pre>\n\n<p>You will have to \"unwrap\" the <code>Maybe</code> values, extract the <code>Integer</code>s before you use them in <code>div</code>.  (There are a few ways to do this, including pattern matching).</p>\n"}], "owner": {"reputation": 15, "user_id": 3755403, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/dab3156d75660677ae7fcaa44b9f9d9c?s=128&d=identicon&r=PG&f=1", "display_name": "WhatDoor", "link": "https://stackoverflow.com/users/3755403/whatdoor"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 1978, "favorite_count": 0, "accepted_answer_id": 28910989, "answer_count": 1, "score": 1, "last_activity_date": 1425698186, "creation_date": 1425697795, "question_id": 28910956, "link": "https://stackoverflow.com/questions/28910956/haskell-couldnt-match-expected-type-involving-maybe", "title": "Haskell Couldn&#39;t match expected type involving maybe", "body": "<p>I am currently learning Haskell and I have run into a problem but I don't really understand what is the problem. When I compile the code below, it tells me \"Couldnt match expected type 'integer' with actual type 'Maybe Integer'\" for line 17:19 and again the same error for 17:27.</p>\n\n<pre><code>maybe_divide :: Maybe Integer -&gt; Maybe Integer -&gt; Maybe Integer\nmaybe_divide a b = case valid_div a b of\nTrue  -&gt; Just (a `div` b)\nFalse -&gt; Nothing\n\nvalid_div :: Maybe Integer -&gt; Maybe Integer -&gt; Bool\nvalid_div a b\n    | a == Nothing = False\n    | b == Nothing = False\n    | b == Just 0  = False\n    | otherwise = True\n</code></pre>\n\n<p>Any help would be appreciated. Thanks</p>\n"}, {"tags": ["haskell"], "comments": [{"owner": {"reputation": 339851, "user_id": 149392, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/7a561ec0875fcbbe3066ea8fe288ec77?s=128&d=identicon&r=PG", "display_name": "sepp2k", "link": "https://stackoverflow.com/users/149392/sepp2k"}, "edited": false, "score": 1, "creation_date": 1425693989, "post_id": 28910522, "comment_id": 46080121, "body": "Do you really mean <code>[a:b]</code> or rather <code>[a,b]</code>? Or maybe <code>a:b</code>?"}, {"owner": {"reputation": 1251, "user_id": 3973371, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/eb6b82669e037ed73e47d6532ef2c246?s=128&d=identicon&r=PG&f=1", "display_name": "bmaderbacher", "link": "https://stackoverflow.com/users/3973371/bmaderbacher"}, "edited": false, "score": 2, "creation_date": 1425694316, "post_id": 28910522, "comment_id": 46080177, "body": "do is no monad, but syntactic sugar for functions operating on monads. I don&#39;t understand what&#39;s your question, could you clarify what you want to achieve and where you have problems."}, {"owner": {"reputation": 64094, "user_id": 476408, "user_type": "registered", "accept_rate": 70, "profile_image": "https://www.gravatar.com/avatar/2bc1bffafe7aa29ef900b98d1fd1e94e?s=128&d=identicon&r=PG", "display_name": "J. Abrahamson", "link": "https://stackoverflow.com/users/476408/j-abrahamson"}, "edited": false, "score": 2, "creation_date": 1425697298, "post_id": 28910522, "comment_id": 46080647, "body": "<code>fun1 x1 x2 = (\\a b -&gt; [a:b]) &lt;$&gt; fun2 x1 &lt;*&gt; fun3 x2</code>"}], "answers": [{"tags": [], "owner": {"reputation": 11780, "user_id": 2827654, "user_type": "registered", "accept_rate": 57, "profile_image": "https://www.gravatar.com/avatar/a171742e9c31a541d4d2031af932e94a?s=128&d=identicon&r=PG&f=1", "display_name": "jamshidh", "link": "https://stackoverflow.com/users/2827654/jamshidh"}, "is_accepted": true, "score": 3, "last_activity_date": 1425694084, "creation_date": 1425694084, "answer_id": 28910605, "question_id": 28910522, "link": "https://stackoverflow.com/questions/28910522/what-is-the-equivalence-of-do-monad-in-haskell/28910605#28910605", "title": "what is the equivalence of do monad in haskell", "body": "<p>You can expand the do notation using the bind operator</p>\n\n<pre><code>fun2 x1 &gt;&gt;= \\a -&gt; fun3 x2 &gt;&gt;= \\b -&gt; return [a:b]\n</code></pre>\n\n<p>but this seems way less clear to me....</p>\n\n<p>(as per @sepp2k's comment, note that the example will compile, but might not have the type you intended it to)</p>\n"}], "owner": {"reputation": 241, "user_id": 3271548, "user_type": "registered", "accept_rate": 79, "profile_image": "https://www.gravatar.com/avatar/d97ffd1ec9eb3f67f4d3be300d53dce2?s=128&d=identicon&r=PG&f=1", "display_name": "Myke", "link": "https://stackoverflow.com/users/3271548/myke"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 83, "favorite_count": 0, "accepted_answer_id": 28910605, "answer_count": 1, "score": 0, "last_activity_date": 1425694084, "creation_date": 1425693128, "question_id": 28910522, "link": "https://stackoverflow.com/questions/28910522/what-is-the-equivalence-of-do-monad-in-haskell", "title": "what is the equivalence of do monad in haskell", "body": "<p>Say I have a function that calls other functions</p>\n\n<pre><code>fun1 x1 x2 = do\n    a &lt;- fun2 x1\n    b &lt;- fun3 x2\n    return [a:b]\n</code></pre>\n\n<p>Is there any short representation for this function.</p>\n"}, {"tags": ["haskell", "case", "pattern-guards"], "comments": [{"owner": {"reputation": 100185, "user_id": 3234959, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/93bb12ca0f93dfddb33880316f7e66c2?s=128&d=identicon&r=PG&f=1", "display_name": "chi", "link": "https://stackoverflow.com/users/3234959/chi"}, "edited": false, "score": 1, "creation_date": 1425691249, "post_id": 28910242, "comment_id": 46079612, "body": "Guards are used to restrict patterns further: you don&#39;t need guards in the example above. So... what are you trying to obtain, exactly?"}, {"owner": {"reputation": 13807, "user_id": 2407038, "user_type": "registered", "accept_rate": 64, "profile_image": "https://www.gravatar.com/avatar/538f6f4a9aa43841841de7d8e8b169fc?s=128&d=identicon&r=PG&f=1", "display_name": "user2407038", "link": "https://stackoverflow.com/users/2407038/user2407038"}, "edited": false, "score": 0, "creation_date": 1425692373, "post_id": 28910242, "comment_id": 46079828, "body": "Remove all of the pipe characters (<code>|</code>) and your code will compile."}, {"owner": {"reputation": 44013, "user_id": 1477667, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/trgKM.jpg?s=128&g=1", "display_name": "dfeuer", "link": "https://stackoverflow.com/users/1477667/dfeuer"}, "reply_to_user": {"reputation": 100185, "user_id": 3234959, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/93bb12ca0f93dfddb33880316f7e66c2?s=128&d=identicon&r=PG&f=1", "display_name": "chi", "link": "https://stackoverflow.com/users/3234959/chi"}, "edited": false, "score": 0, "creation_date": 1425717628, "post_id": 28910242, "comment_id": 46084330, "body": "@chi, this looks like an attempt to use ML syntax in Haskell."}, {"owner": {"reputation": 100185, "user_id": 3234959, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/93bb12ca0f93dfddb33880316f7e66c2?s=128&d=identicon&r=PG&f=1", "display_name": "chi", "link": "https://stackoverflow.com/users/3234959/chi"}, "reply_to_user": {"reputation": 44013, "user_id": 1477667, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/trgKM.jpg?s=128&g=1", "display_name": "dfeuer", "link": "https://stackoverflow.com/users/1477667/dfeuer"}, "edited": false, "score": 0, "creation_date": 1425718629, "post_id": 28910242, "comment_id": 46084541, "body": "@dfeuer I thought the same, but then the comment about guards vs patterns confused me."}], "answers": [{"tags": [], "owner": {"reputation": 3611, "user_id": 1029158, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/YmuXk.jpg?s=128&g=1", "display_name": "DiegoNolan", "link": "https://stackoverflow.com/users/1029158/diegonolan"}, "is_accepted": false, "score": 2, "last_activity_date": 1425706730, "creation_date": 1425706730, "answer_id": 28911786, "question_id": 28910242, "link": "https://stackoverflow.com/questions/28910242/haskell-pattern-syntax-in-expression-context/28911786#28911786", "title": "Haskell: Pattern Syntax in expression context:_", "body": "<p>As mentioned in the post guards are not needed for pattern matching. You can remove some cases that are superfluous.</p>\n\n<pre><code>maybe_divide :: Maybe Integer -&gt; Maybe Integer -&gt; Maybe Integer\nmaybe_divide a b = case (a, b) of\n                    (Just _, Just 0) -&gt; Nothing\n                    (Just n, Just d) -&gt; Just (n `div` d)\n                    _ -&gt; Nothing\n</code></pre>\n\n<p>But You don't have to write that function at all. Because Maybe is a Monad you can just write this.</p>\n\n<pre><code>maybeDivide :: Integer -&gt; Integer -&gt; Maybe Integer\nmaybeDivide _ 0 = Nothing\nmaybeDivide n d = Just (n `div` d)\n</code></pre>\n\n<p>And then to get your version of maybe_divide you can write this.</p>\n\n<pre><code>maybe_divide' :: Maybe Integer -&gt; Maybe Integer -&gt; Maybe Integer\nmaybe_divide' a b = a &gt;&gt;= (\\n -&gt; b &gt;&gt;= (\\d -&gt; maybeDivide n d))\n</code></pre>\n\n<p>Which may be easier to read as this.</p>\n\n<pre><code>maybe_divide'' :: Maybe Integer -&gt; Maybe Integer -&gt; Maybe Integer\nmaybe_divide'' a b = do\n    n &lt;- a\n    d &lt;- b\n    maybeDivide n d \n</code></pre>\n"}], "owner": {"reputation": 11, "user_id": 4643025, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/a97d40b1f01a0196197789fd1331c0a5?s=128&d=identicon&r=PG&f=1", "display_name": "akikaaa", "link": "https://stackoverflow.com/users/4643025/akikaaa"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 611, "favorite_count": 0, "answer_count": 1, "score": 1, "last_activity_date": 1425706730, "creation_date": 1425690513, "last_edit_date": 1425691235, "question_id": 28910242, "link": "https://stackoverflow.com/questions/28910242/haskell-pattern-syntax-in-expression-context", "title": "Haskell: Pattern Syntax in expression context:_", "body": "<p>I a fresh man in Haskell. Here is my program :</p>\n\n<pre><code>maybe_divide :: Maybe Integer -&gt; Maybe Integer -&gt; Maybe Integer\nmaybe_divide a b = case (a, b) of  \n (Just a, Just b)\n | (Just a, Just b)            \n | (Nothing, _)    -&gt; Nothing\n | (_, Just 0)     -&gt; Nothing\n | (_, Nothing)    -&gt; Nothing\n | (Just a,Just b) -&gt; Just (a `div` b)\n</code></pre>\n\n<p>The compiler shows that: pattern syntax in expression context:_.\nWhen I just use case without guards it works. Why it doesn't work within guards?</p>\n"}, {"tags": ["haskell", "monads", "do-notation"], "comments": [{"owner": {"reputation": 100185, "user_id": 3234959, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/93bb12ca0f93dfddb33880316f7e66c2?s=128&d=identicon&r=PG&f=1", "display_name": "chi", "link": "https://stackoverflow.com/users/3234959/chi"}, "edited": false, "score": 2, "creation_date": 1425690963, "post_id": 28910076, "comment_id": 46079552, "body": "Even in the IO monad, what is guaranteed is that the effects of the IO actions are sequenced in order. Evaluation order is still unknown, e.g. <code>print (1+2) ; print (3+4)</code> does not force an execution ordering between the sums. Note that even in low-level languages such as C there would be no ordering guarantee: the compiler would be free to evaluate any sum first, since they have no side effects. In a purely functional language, no-side-effects is the norm (unlike C), so even more ordering options are made available to the compiler (e.g. <code>print (f 1); print (f 2)</code> can call <code>f</code> in any order)."}, {"owner": {"reputation": 43759, "user_id": 1651941, "user_type": "registered", "accept_rate": 97, "profile_image": "https://www.gravatar.com/avatar/a513bc1fa519d2fcf5e4e0d9b5500101?s=128&d=identicon&r=PG", "display_name": "Sibi", "link": "https://stackoverflow.com/users/1651941/sibi"}, "reply_to_user": {"reputation": 100185, "user_id": 3234959, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/93bb12ca0f93dfddb33880316f7e66c2?s=128&d=identicon&r=PG&f=1", "display_name": "chi", "link": "https://stackoverflow.com/users/3234959/chi"}, "edited": false, "score": 0, "creation_date": 1425768897, "post_id": 28910076, "comment_id": 46099345, "body": "@chi I think for a code like this: <code>print (1 + 2) &gt;&gt; exitSuccess &gt;&gt; print (3 + undefined)</code>, the output will be always <code>3 *** Exception: ExitSuccess</code>. <code>3 + undefined</code> will never be evaluated because of lazy evaluation unless the monadic action forces it. What do you think ?"}, {"owner": {"reputation": 100185, "user_id": 3234959, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/93bb12ca0f93dfddb33880316f7e66c2?s=128&d=identicon&r=PG&f=1", "display_name": "chi", "link": "https://stackoverflow.com/users/3234959/chi"}, "reply_to_user": {"reputation": 43759, "user_id": 1651941, "user_type": "registered", "accept_rate": 97, "profile_image": "https://www.gravatar.com/avatar/a513bc1fa519d2fcf5e4e0d9b5500101?s=128&d=identicon&r=PG", "display_name": "Sibi", "link": "https://stackoverflow.com/users/1651941/sibi"}, "edited": false, "score": 0, "creation_date": 1425770965, "post_id": 28910076, "comment_id": 46099874, "body": "@Sibi Yes, I would expect GHC to do that. But, theoretically speaking, GHC could use some static analysis to guarantee that <code>3+4</code> is error-free (total) and reorder / parallelize its execution. Or just reorder suppressing exceptions. The main showstopper to this approach AFAICS is that it is not always an optimization: sometimes optimistic evaluation can lead to memory leaks :-/"}], "answers": [{"comments": [{"owner": {"reputation": 75362, "user_id": 625403, "user_type": "registered", "accept_rate": 82, "profile_image": "https://www.gravatar.com/avatar/786eed7da67079cb5d63a49d469af25b?s=128&d=identicon&r=PG", "display_name": "amalloy", "link": "https://stackoverflow.com/users/625403/amalloy"}, "edited": false, "score": 1, "creation_date": 1425694669, "post_id": 28910388, "comment_id": 46080237, "body": "This seems to me like it just distracts from the actual question, since evaluation order isn&#39;t relevant here. You could just as well write <code>do {let {x = undefined}; y &lt;- Nothing; return $ x + y}</code>, and get the same result, but this has nothing to do with the order of evaluation of the two statements."}, {"owner": {"reputation": 43759, "user_id": 1651941, "user_type": "registered", "accept_rate": 97, "profile_image": "https://www.gravatar.com/avatar/a513bc1fa519d2fcf5e4e0d9b5500101?s=128&d=identicon&r=PG", "display_name": "Sibi", "link": "https://stackoverflow.com/users/1651941/sibi"}, "reply_to_user": {"reputation": 75362, "user_id": 625403, "user_type": "registered", "accept_rate": 82, "profile_image": "https://www.gravatar.com/avatar/786eed7da67079cb5d63a49d469af25b?s=128&d=identicon&r=PG", "display_name": "amalloy", "link": "https://stackoverflow.com/users/625403/amalloy"}, "edited": false, "score": 0, "creation_date": 1425763239, "post_id": 28910388, "comment_id": 46097682, "body": "@amalloy I have expanded the answer to include more details. Let me know if this improves or else I will try to expand it more."}], "tags": [], "owner": {"reputation": 43759, "user_id": 1651941, "user_type": "registered", "accept_rate": 97, "profile_image": "https://www.gravatar.com/avatar/a513bc1fa519d2fcf5e4e0d9b5500101?s=128&d=identicon&r=PG", "display_name": "Sibi", "link": "https://stackoverflow.com/users/1651941/sibi"}, "is_accepted": true, "score": 6, "last_activity_date": 1425763073, "last_edit_date": 1425763073, "creation_date": 1425691896, "answer_id": 28910388, "question_id": 28910076, "link": "https://stackoverflow.com/questions/28910076/is-it-true-that-order-of-execution-inside-a-do-block-doesnt-depend-on-the-state/28910388#28910388", "title": "Is it true that order of execution inside a do block doesn&#39;t depend on the statement order?", "body": "<p>What it says is that the order of statements doesn't influence the evaluation criteria. As @chi points out in IO monad effects are sequenced in order but their evaluation order is still not known. An example of a monad which will make the concept clear:</p>\n\n<pre><code>test = do\n  x &lt;- Just (2 + undefined)\n  y &lt;- Nothing\n  return (x + y)\n</code></pre>\n\n<p>In ghci:</p>\n\n<pre><code>\u03bb&gt; test\nNothing\n</code></pre>\n\n<p>The above code has three statements. It can be de-sugared into the following form:</p>\n\n<pre><code>Just (2 + undefined) &gt;&gt;= \\x -&gt; Nothing &gt;&gt;= \\y -&gt; return (x + y)\n</code></pre>\n\n<p>Now since <code>(&gt;&gt;=)</code> is left associative, it will be evaluated like this:</p>\n\n<p><code>(Just (2 + undefined) &gt;&gt;= \\x -&gt; Nothing) &gt;&gt;= \\y -&gt; return (x + y)</code></p>\n\n<p>Note that <code>Maybe</code> monad is defined like this:</p>\n\n<pre><code>(&gt;&gt;=) :: Maybe a -&gt; (a -&gt; Maybe b) -&gt; Maybe b\nNothing  &gt;&gt;= _  =  Nothing    -- A failed computation returns Nothing\n(Just x) &gt;&gt;= f  =  f x        -- Applies function f to value x\n</code></pre>\n\n<p>Applying the value <code>(2 + undefined)</code> to the function <code>\\x -&gt; Nothing</code> will result in <code>Nothing</code>.\nThe expression <code>2 + undefined</code> is unevaluated, thanks to lazy evaluation strategy followed by Haskell.</p>\n\n<p>Now we have a reduced form:</p>\n\n<pre><code>Nothing &gt;&gt;= \\y -&gt; return (2 + undefined + y)\n</code></pre>\n\n<p>Looking at the <code>Monad</code> instance for it, you can see that this will produce <code>Nothing</code> because <code>Nothing &gt;&gt;= _ = Nothing</code>.\nWhat if the argument was strict instead:</p>\n\n<pre><code>test = do\n  !x &lt;- Just (2 + undefined)\n  y &lt;- Nothing\n  return (y + x)\n</code></pre>\n\n<p>Demo in <code>ghci</code>:</p>\n\n<pre><code>\u03bb&gt; test\n*** Exception: Prelude.undefined\n</code></pre>\n\n<p>If we follows strict evaluation procedure, then you can see that order actually matters. But in a lazy setting, the order of statements doesn't matter. And hence the wiki claims, \"the order of statements is not the criterion for the evaluation order\".</p>\n"}], "owner": {"reputation": 1867, "user_id": 1993391, "user_type": "registered", "accept_rate": 85, "profile_image": "https://www.gravatar.com/avatar/94b00ce75f65ed84787abf2fb6a98f26?s=128&d=identicon&r=PG", "display_name": "XrXr", "link": "https://stackoverflow.com/users/1993391/xrxr"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 779, "favorite_count": 1, "accepted_answer_id": 28910388, "answer_count": 1, "score": 1, "last_activity_date": 1425763073, "creation_date": 1425689081, "last_edit_date": 1425689397, "question_id": 28910076, "link": "https://stackoverflow.com/questions/28910076/is-it-true-that-order-of-execution-inside-a-do-block-doesnt-depend-on-the-state", "title": "Is it true that order of execution inside a do block doesn&#39;t depend on the statement order?", "body": "<p>I was reading <a href=\"https://wiki.haskell.org/Do_notation_considered_harmful\" rel=\"nofollow\">https://wiki.haskell.org/Do_notation_considered_harmful</a> and was surprised to read the following lines</p>\n\n<blockquote>\n  <p>Newcomers might think that the order of statements determines the order of execution. ... The order of statements is also not the criterion for the evaluation order.</p>\n</blockquote>\n\n<p>The wiki post gave some examples that demonstrate this property. While the examples make sense, I still don't fully believe that the statement is true, since if I write something like</p>\n\n<pre><code>main = do\n  putStrLn \"foo\"\n  putStrLn \"bar\"\n  putStrLn \"baz\"\n</code></pre>\n\n<p>The three lines come out in the order of the statements. So what exactly is going on here?</p>\n"}, {"tags": ["haskell"], "comments": [{"owner": {"reputation": 23444, "user_id": 414413, "user_type": "registered", "accept_rate": 79, "profile_image": "https://www.gravatar.com/avatar/6de2113f01432aa844dc85070ff33e89?s=128&d=identicon&r=PG", "display_name": "Cirdec", "link": "https://stackoverflow.com/users/414413/cirdec"}, "edited": false, "score": 0, "creation_date": 1425686719, "post_id": 28909308, "comment_id": 46078582, "body": "Do you also persist <code>Fridge</code>s, or only <code>SignedFridge</code>s?"}, {"owner": {"reputation": 11780, "user_id": 2827654, "user_type": "registered", "accept_rate": 57, "profile_image": "https://www.gravatar.com/avatar/a171742e9c31a541d4d2031af932e94a?s=128&d=identicon&r=PG&f=1", "display_name": "jamshidh", "link": "https://stackoverflow.com/users/2827654/jamshidh"}, "reply_to_user": {"reputation": 23444, "user_id": 414413, "user_type": "registered", "accept_rate": 79, "profile_image": "https://www.gravatar.com/avatar/6de2113f01432aa844dc85070ff33e89?s=128&d=identicon&r=PG", "display_name": "Cirdec", "link": "https://stackoverflow.com/users/414413/cirdec"}, "edited": false, "score": 0, "creation_date": 1425693504, "post_id": 28909308, "comment_id": 46080027, "body": "@Cirdec- Good question!  Let me say &quot;no&quot;....  We don&#39;t currently need to store a <code>Fridge</code> in the DB.  It may change later on, but if it does, I&#39;ll just post a new question (rather than add new and potentially unnecessary criteria to this question after the fact)."}], "owner": {"reputation": 11780, "user_id": 2827654, "user_type": "registered", "accept_rate": 57, "profile_image": "https://www.gravatar.com/avatar/a171742e9c31a541d4d2031af932e94a?s=128&d=identicon&r=PG&f=1", "display_name": "jamshidh", "link": "https://stackoverflow.com/users/2827654/jamshidh"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 43, "favorite_count": 0, "answer_count": 0, "score": 2, "last_activity_date": 1425684082, "creation_date": 1425684082, "question_id": 28909308, "link": "https://stackoverflow.com/questions/28909308/shoving-two-data-types-into-one-persistent-entity", "title": "Shoving two data types into one Persistent entity", "body": "<p>We cryptographically sign some data using a wrapped type....</p>\n\n<pre><code>--Here is the base data\ndata Fridge = Fridge {numOnions::Int, numPickles::Int} deriving (Show)\n\n--Here is the same data, signed\ndata SignedFridge = SignedFridge {fridge::Fridge, signature::Int}\n</code></pre>\n\n<p>This is done for type safety (ie- I made the mistake of submitting unsigned <code>Fridge</code>s in place of signed one too many times....  With this split, this mistake is weeded out at compile time).</p>\n\n<p>Now, we need to store this data (including signature) into a database....  I would love to use Persistent/Template Haskell, even handing over the data type generation....  But the split of fields across Fridge/SignedFridge seems to make this impossible.  Without the signature, it would be</p>\n\n<pre><code>[persistLowerCase|\n     Fridge\n         numOnions Int\n         numPickles Int\n         deriving Show\n|]\n</code></pre>\n\n<p>However, shoving in that extra <code>signature</code> item, and keeping the types split is difficult....</p>\n\n<p>The three (bad) options seem to be</p>\n\n<ol>\n<li>Create the PersistEntity instance by hand (ugh!)</li>\n<li>Use Persistent/TH to create a similar duplicate data type (like SignedFridge', with both the data and signature), then create function to convert back and forth to <code>SignedFridge</code>.  This works, but certainly isn't DRY.</li>\n<li>Lose type safety, store signature in the Fridge object as a <code>Maybe Int</code>.  Of course, I won't find out until runtime that I accidentally used an unsigned fridge where I need one signed.</li>\n</ol>\n\n<p>Does anyone have a fourth, better option for me?</p>\n"}, {"tags": ["string", "list", "haskell", "recursion"], "comments": [{"owner": {"reputation": 51584, "user_id": 839246, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/9b0573c2b936b12828dd1e4cc04206dc?s=128&d=identicon&r=PG&f=1", "display_name": "bheklilr", "link": "https://stackoverflow.com/users/839246/bheklilr"}, "edited": false, "score": 1, "creation_date": 1425676315, "post_id": 28907737, "comment_id": 46074787, "body": "If it performs IO then the type after the last <code>-&gt;</code> has to be <code>IO something</code>."}, {"owner": {"reputation": 51584, "user_id": 839246, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/9b0573c2b936b12828dd1e4cc04206dc?s=128&d=identicon&r=PG&f=1", "display_name": "bheklilr", "link": "https://stackoverflow.com/users/839246/bheklilr"}, "edited": false, "score": 2, "creation_date": 1425676363, "post_id": 28907737, "comment_id": 46074803, "body": "You can also delete the signature you&#39;re giving it and use GHCi to inspect what the compiler infers the signature to be: <code>:load myfile.hs</code>; <code>:type getList</code>."}, {"owner": {"reputation": 43759, "user_id": 1651941, "user_type": "registered", "accept_rate": 97, "profile_image": "https://www.gravatar.com/avatar/a513bc1fa519d2fcf5e4e0d9b5500101?s=128&d=identicon&r=PG", "display_name": "Sibi", "link": "https://stackoverflow.com/users/1651941/sibi"}, "edited": false, "score": 0, "creation_date": 1425677890, "post_id": 28907737, "comment_id": 46075502, "body": "What is <code>getCast</code> function in your code ?"}, {"owner": {"reputation": 47, "user_id": 4249860, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/af0d3b733d436d096a8077b56186c984?s=128&d=identicon&r=PG&f=1", "display_name": "Behtx3", "link": "https://stackoverflow.com/users/4249860/behtx3"}, "edited": false, "score": 0, "creation_date": 1425733954, "post_id": 28907737, "comment_id": 46088537, "body": "Sorry getCast was an error in my question. Should be getList."}], "answers": [{"comments": [{"owner": {"reputation": 47, "user_id": 4249860, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/af0d3b733d436d096a8077b56186c984?s=128&d=identicon&r=PG&f=1", "display_name": "Behtx3", "link": "https://stackoverflow.com/users/4249860/behtx3"}, "edited": false, "score": 0, "creation_date": 1425734177, "post_id": 28908714, "comment_id": 46088596, "body": "Thank you for explaining IO types."}], "tags": [], "owner": {"reputation": 8676, "user_id": 1113881, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/sBc0F.jpg?s=128&g=1", "display_name": "CR Drost", "link": "https://stackoverflow.com/users/1113881/cr-drost"}, "is_accepted": true, "score": 3, "last_activity_date": 1610913485, "last_edit_date": 1610913485, "creation_date": 1425680737, "answer_id": 28908714, "question_id": 28907737, "link": "https://stackoverflow.com/questions/28907737/haskell-input-to-create-a-string-list/28908714#28908714", "title": "Haskell Input to create a String List", "body": "<p>So there's a bunch of things that you need to understand. One of them is the <code>IO x</code> type. A value of this type is a <em>computer program</em> that, when later run, will do something and produce a value of type <code>x</code>. So <code>getLine</code> doesn't <em>do</em> anything by itself; it just <em>is</em> a certain sort of program. Same with <code>let p = putStrLn &quot;hello!&quot;</code>. I can sequence <code>p</code> into my program multiple times and it will print <code>hello!</code> multiple times, because the <code>IO ()</code> is a program, as a value which Haskell happens to be able to talk about and manipulate. If this were TypeScript I would say <code>type IO&lt;x&gt; = { run: () =&gt; Promise&lt;x&gt; }</code> and emphatically that type says that the side-effecting action <em>has not been run yet</em>.</p>\n<p>So how do we manipulate these values when the value is a program, for example one that fetches the current system time?</p>\n<p>The most fundamental way to chain such programs together is to take a program that produces an <code>x</code> (an <code>IO x</code>) and then a Haskell function which takes an <code>x</code> and constructs a program which produces a <code>y</code> (an <code>x -&gt; IO y</code> and combines them together into a resulting program producing a <code>y</code> (an <code>IO y</code>.)  This function is called <code>&gt;&gt;=</code> and pronounced &quot;bind&quot;. In fact this way is universal, if we add a program which takes any Haskell value of type <code>x</code> and produces a program which does nothing and produces that value (<code>return :: x -&gt; IO x</code>). This allows you to use, for example, the Prelude function <code>fmap f = (&gt;&gt;= return . f)</code> which takes an <code>a -&gt; b</code> and applies it to an <code>IO a</code> to produce an <code>IO b</code>.</p>\n<p>So  It is so common to say things like <code>getLine &gt;&gt;= \\line -&gt; putStrLn (upcase line ++ &quot;!&quot;)</code> that  we invented <code>do</code>-notation, writing this as</p>\n<pre><code>do \n    line &lt;- getLine\n    putStrLn (upcase line ++ &quot;!&quot;)\n</code></pre>\n<p>Notice that it's the same basic deal; the last line needs to be an <code>IO y</code> for some <code>y</code>.</p>\n<p>The last thing you need to know in Haskell is the convention which actually gets these things run. That is that, in your Haskell source code, you are supposed to create an <code>IO ()</code> (a program whose value doesn't matter) called <code>Main.main</code>, and the Haskell compiler is supposed to take this program which you described, and give it to you as an executable which you can run whenever you want. As a very special case, the GHCi interpreter will notice if you produce an <code>IO x</code> expression at the top level and will <em>immediately</em> run it for you, but that is very different from how the rest of the language works. For the most part, Haskell says, describe the program and I will give it to you.</p>\n<p>Now that you know that Haskell has no magic and the Haskell <code>IO x</code> type just is a static representation of a computer program as a value, rather than something which does side-effecting stuff when you &quot;reduce&quot; it (like it is in other languages), we can turn to your <code>getList</code>. Clearly <code>getList :: IO [String]</code> makes the most sense based on what you said: a program which allows a user to build a list from a series of inputs.</p>\n<p>Now to build the internals, you've got the right guess: we've got to start with a <code>getLine</code> and either finish off the list or continue accepting inputs, prepending the line to the list:</p>\n<pre><code>getList = do\n    line &lt;- getLine\n    if line == 'exit' then return []\n                      else fmap (line:) getList\n</code></pre>\n<p>You've also identified another way to do it, which depends on taking a list of strings and producing a new list:</p>\n<pre><code>getList :: IO [String]\ngetList = fmap reverse (go []) where \n    go xs = do \n        x &lt;- getLine\n        if x == &quot;exit&quot; then return xs\n                       else go (x : xs)\n</code></pre>\n<p>There are probably several other ways to do it.</p>\n"}], "owner": {"reputation": 47, "user_id": 4249860, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/af0d3b733d436d096a8077b56186c984?s=128&d=identicon&r=PG&f=1", "display_name": "Behtx3", "link": "https://stackoverflow.com/users/4249860/behtx3"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 2130, "favorite_count": 1, "accepted_answer_id": 28908714, "answer_count": 1, "score": 1, "last_activity_date": 1610913485, "creation_date": 1425676265, "last_edit_date": 1425733907, "question_id": 28907737, "link": "https://stackoverflow.com/questions/28907737/haskell-input-to-create-a-string-list", "title": "Haskell Input to create a String List", "body": "<p>I would like to allow a user to build a list from a series of inputs in Haskell. </p>\n\n<p>The getLine function would be called recursively until the stopping case (\"Y\") is input, at which point the list is returned.   </p>\n\n<p>I know the function needs to be in a similar format to below. I am having trouble assigning the correct type signatures - I think I need to include the IO type somewhere.</p>\n\n<pre><code>getList :: [String] -&gt; [String]\ngetList list =  do line &lt;- getLine\n                   if line ==  \"Y\"\n                      then return list\n                      else getList (line : list)\n</code></pre>\n"}, {"tags": ["haskell", "data-structures", "sequence"], "comments": [{"owner": {"reputation": 359, "user_id": 1924817, "user_type": "registered", "accept_rate": 86, "profile_image": "https://www.gravatar.com/avatar/33867bd74b16d7ca6bfb658964dfe878?s=128&d=identicon&r=PG", "display_name": "akegalj", "link": "https://stackoverflow.com/users/1924817/akegalj"}, "edited": false, "score": 2, "creation_date": 1425672927, "post_id": 28906742, "comment_id": 46073218, "body": "As I know they are implemented using finger trees. I am not expert but you can find more information in <a href=\"http://staff.city.ac.uk/~ross/papers/FingerTree.html\" rel=\"nofollow noreferrer\">staff.city.ac.uk/~ross/papers/FingerTree.html</a> and <a href=\"http://apfelmus.nfshost.com/articles/monoid-fingertree.html\" rel=\"nofollow noreferrer\">apfelmus.nfshost.com/articles/monoid-fingertree.html</a>"}, {"owner": {"reputation": 44013, "user_id": 1477667, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/trgKM.jpg?s=128&g=1", "display_name": "dfeuer", "link": "https://stackoverflow.com/users/1477667/dfeuer"}, "reply_to_user": {"reputation": 359, "user_id": 1924817, "user_type": "registered", "accept_rate": 86, "profile_image": "https://www.gravatar.com/avatar/33867bd74b16d7ca6bfb658964dfe878?s=128&d=identicon&r=PG", "display_name": "akegalj", "link": "https://stackoverflow.com/users/1924817/akegalj"}, "edited": false, "score": 0, "creation_date": 1425673747, "post_id": 28906742, "comment_id": 46073619, "body": "@akegalj, I am familiar with how the sequences are represented; Wasserman&#39;s code is just a bit ... magical."}, {"owner": {"reputation": 171740, "user_id": 869736, "user_type": "registered", "accept_rate": 82, "profile_image": "https://www.gravatar.com/avatar/671f732e3c68c387c702112a30e5ebd8?s=128&d=identicon&r=PG&f=1", "display_name": "Louis Wasserman", "link": "https://stackoverflow.com/users/869736/louis-wasserman"}, "edited": false, "score": 4, "creation_date": 1425873525, "post_id": 28906742, "comment_id": 46125644, "body": "Or, you could summon me here, and I&#39;ll answer when I have a minute to look over the code I wrote several years ago."}], "answers": [{"comments": [{"owner": {"reputation": 44013, "user_id": 1477667, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/trgKM.jpg?s=128&g=1", "display_name": "dfeuer", "link": "https://stackoverflow.com/users/1477667/dfeuer"}, "edited": false, "score": 0, "creation_date": 1425961796, "post_id": 28951472, "comment_id": 46165519, "body": "I must admit this still makes me more than a little dizzy, but I will continue to try to work through it. I appreciate you taking the time to explain."}, {"owner": {"reputation": 44013, "user_id": 1477667, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/trgKM.jpg?s=128&g=1", "display_name": "dfeuer", "link": "https://stackoverflow.com/users/1477667/dfeuer"}, "edited": false, "score": 0, "creation_date": 1426044315, "post_id": 28951472, "comment_id": 46206833, "body": "I think I get the general gist of it now. It seems to just barely work, almost by accident. Finger trees are weird. Have you had a chance to look at my re-implementations of <code>&lt;*&gt;</code>, <code>*&gt;</code>, and <code>zipWith</code> for <code>Data.Sequence</code>? I finally got <code>&lt;*&gt;</code> and <code>*&gt;</code> into decent shape <a href=\"https://github.com/haskell/containers/pull/141\" rel=\"nofollow noreferrer\">today</a> although earlier versions made it into <code>containers-0.5.6.3</code>."}, {"owner": {"reputation": 171740, "user_id": 869736, "user_type": "registered", "accept_rate": 82, "profile_image": "https://www.gravatar.com/avatar/671f732e3c68c387c702112a30e5ebd8?s=128&d=identicon&r=PG&f=1", "display_name": "Louis Wasserman", "link": "https://stackoverflow.com/users/869736/louis-wasserman"}, "reply_to_user": {"reputation": 44013, "user_id": 1477667, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/trgKM.jpg?s=128&g=1", "display_name": "dfeuer", "link": "https://stackoverflow.com/users/1477667/dfeuer"}, "edited": false, "score": 2, "creation_date": 1426044374, "post_id": 28951472, "comment_id": 46206846, "body": "I haven&#39;t been keeping an eye on this for several years, but I can take a look tomorrow."}], "tags": [], "owner": {"reputation": 171740, "user_id": 869736, "user_type": "registered", "accept_rate": 82, "profile_image": "https://www.gravatar.com/avatar/671f732e3c68c387c702112a30e5ebd8?s=128&d=identicon&r=PG&f=1", "display_name": "Louis Wasserman", "link": "https://stackoverflow.com/users/869736/louis-wasserman"}, "is_accepted": true, "score": 7, "last_activity_date": 1598649661, "last_edit_date": 1598649661, "creation_date": 1425934169, "answer_id": 28951472, "question_id": 28906742, "link": "https://stackoverflow.com/questions/28906742/how-do-inits-and-tails-work-in-data-sequence/28951472#28951472", "title": "How do inits and tails work in Data.Sequence?", "body": "<p>It's me!</p>\n<p>I think the best approach is probably to work through an example.  Let's have a go...</p>\n<pre><code>Deep (Two 1 2)                                                    (Two 7 8))\n                (Deep (One (Node2 3 4))        (One (Node2 5 6))\n                                         Empty\n</code></pre>\n<p>Here's a Sequence, somewhat simplified (e.g. omitting the Elem wrappers).</p>\n<p>Let's do inits on this; tails is essentially symmetric.  Our recursive algorithm is going to leave out the empty init and only include nonempty things.</p>\n<hr />\n<p><strong>Prefix</strong></p>\n<p>So the prefix digit of inits is going to be generated with, essentially, <code>fmap digitToTree (initsDigit (Two 1 2))</code>.</p>\n<pre><code>initsDigit (Two 1 2) = Two (One 1) (Two 1 2)\nfmap digitToTree (Two (One 1) (Two 1 2)) = \n    Two (Single 1) (Deep (One 1) Empty (One 2))\n</code></pre>\n<p>So those are the first two inits of the whole thing, and this digit is going to be the prefix digit of the result of <code>inits</code>.  (Except we're going to prepend the empty sequence after all we're done, but let's ignore that for now.)</p>\n<hr />\n<p><strong>Inner tree</strong></p>\n<p>Now let's take the inits of the inner tree, treated as a <code>FingerTree (Node a)</code> -- we're not going to pull apart the nodes yet, it's just a two-element <code>FingerTree</code> containing two nodes.   I'm not going to do the details of this, it's just recursing through the same algorithm, I'm just going to magically reach the result</p>\n<pre><code>Deep \n    (One (Single (Node2 3 4))) \n    Empty \n    (One (Deep (One (Node2 3 4)) Empty (One (Node2 5 6))))\n  :: FingerTree (FingerTree (Node a))\n</code></pre>\n<p>So these are the inits of the inner tree.  How do these correspond to inits of the outer tree?  Each init of the inner tree corresponds to a tree containing</p>\n<ul>\n<li>the prefix digit of the original tree, <code>Two 1 2</code></li>\n<li>all but the last <code>Node</code> of the init of the inner tree</li>\n<li>some prefix of the last <code>Node</code> of the init of the inner tree</li>\n</ul>\n<p>So each <code>FingerTree (Node a)</code> acquired by taking an init of the inner tree will map to a <code>Node (FingerTree a)</code>, containing a <code>FingerTree</code> for each init of the last node in the <code>FingerTree (Node a)</code>.</p>\n<p>So for example,  <code>Single (Node2 3 4)</code>, with its last node extracted,  will be decomposed to <code>Empty</code> and <code>Node2 3 4</code>, and the resulting <code>Node (FingerTree a)</code> is</p>\n<pre><code>Node2 \n   (Deep (Two 1 2 {- prefix of original tree -}) \n         Empty \n         (One 3 {- first prefix of Node2 3 4 -}))\n   (Deep (Two 1 2) \n         Empty \n         (Two 3 4 {- second prefix of Node2 3 4 -}))\n</code></pre>\n<p>And for the other prefix of the inner tree, <code>Deep (One (Node2 3 4)) Empty (One (Node2 5 6))</code>, extracting the last <code>Node</code> gives us the remainder <code>Single (Node2 3 4)</code> and the extracted node <code>Node2 5 6</code>, so the resulting <code>Node (FingerTree a)</code>:</p>\n<pre><code>Node2\n   (Deep (Two 1 2 {- prefix of original tree -})\n         (Single (Node2 3 4) {- init of the inner tree minus the last Node -})\n         (One 5 {- first prefix of Node2 5 6 -})\n   (Deep (Two 1 2 {- prefix of original tree -})\n         (Single (Node2 3 4) {- init of the inner tree minus the last Node -})\n         (Two 5 6 {- second prefix of Node2 5 6 -}))\n</code></pre>\n<p>So this is an operation that takes a <code>FingerTree (Node a)</code>, a single init of the inner tree, to a <code>Node (FingerTree a)</code>.  So, having recursively acquired the inits of the inner tree as a <code>FingerTree (FingerTree (Node a))</code>, we map this function over them to get a <code>FingerTree (Node (FingerTree a))</code>, which is exactly what we wanted; it's the inner tree of the inits of the entire thing.</p>\n<hr />\n<p><strong>Suffix</strong></p>\n<p>Finally, there are inits of the original tree composed of</p>\n<ul>\n<li>the original prefix</li>\n<li>the original inner tree</li>\n<li>each init of the suffix of the original tree</li>\n</ul>\n<p>and these become the suffix digit of the tree of inits.  <code>initsDigit (Two 7 8)</code> returns <code>Two (One 7) (Two 7 8)</code>, and we essentially just map <code>\\sf -&gt; Deep pr m sf</code> over this, to get</p>\n<pre><code>Two \n   (Deep (Two 1 2 {- original -})\n         (Deep (One (Node2 3 4)) Empty (One (Node2 5 6)) {- original -})\n         (One 7 {- first init of original suffix digit -}))\n   (Deep (Two 1 2 {- original -})\n         (Deep (One (Node2 3 4)) Empty (One (Node2 5 6)) {- original -})\n         (Two 7 8 {- second init of original suffix digit -})) \n</code></pre>\n<hr />\n<p>So, this isn't quite how the code is organized.  We've described a function from <code>FingerTree a</code> to <code>FingerTree (FingerTree a)</code>, but the actual implementation is essentially that plus an <code>fmap</code>, because we end up always needing to map the elements somehow -- even if it's just wrapping newtypes.  But this is basically what we're doing.</p>\n"}], "owner": {"reputation": 44013, "user_id": 1477667, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/trgKM.jpg?s=128&g=1", "display_name": "dfeuer", "link": "https://stackoverflow.com/users/1477667/dfeuer"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 407, "favorite_count": 4, "accepted_answer_id": 28951472, "answer_count": 1, "score": 7, "last_activity_date": 1598649661, "creation_date": 1425672324, "last_edit_date": 1425672678, "question_id": 28906742, "link": "https://stackoverflow.com/questions/28906742/how-do-inits-and-tails-work-in-data-sequence", "title": "How do inits and tails work in Data.Sequence?", "body": "<p>Louis Wasserman wrote the current implementations of <code>inits</code> and <code>tails</code> in <code>Data.Sequence</code>. He indicates that they are very efficient, and indeed just looking at the code I can see that whatever they are doing, they are doing it in the clean, top-down sort of fashion that tends to lead to good performance for lazy trees. Unfortunately, I can't actually make heads or tails of just what they are doing. Can anyone give me a hand? The code is a bit long, but can be found on <a href=\"http://hackage.haskell.org/package/containers-0.5.6.3/docs/src/Data-Sequence.html\">Hackage</a>.</p>\n"}, {"tags": ["haskell", "monads", "monad-transformers"], "comments": [{"owner": {"reputation": 100185, "user_id": 3234959, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/93bb12ca0f93dfddb33880316f7e66c2?s=128&d=identicon&r=PG&f=1", "display_name": "chi", "link": "https://stackoverflow.com/users/3234959/chi"}, "edited": false, "score": 2, "creation_date": 1425667817, "post_id": 28905315, "comment_id": 46070433, "body": "<code>p&#39; &lt;- return $ errorf p</code> looks weird. You may be looking for <code>p&#39; &lt;- EitherT $ return $ errorf p</code>. Also, <code>throwError</code> may be <code>left</code> ?"}, {"owner": {"reputation": 44013, "user_id": 1477667, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/trgKM.jpg?s=128&g=1", "display_name": "dfeuer", "link": "https://stackoverflow.com/users/1477667/dfeuer"}, "edited": false, "score": 0, "creation_date": 1425670221, "post_id": 28905315, "comment_id": 46071727, "body": "I don&#39;t understand why you are using <code>EitherT</code> and then throwing <code>undefined</code> about. That seems pretty weird. What are you actually trying to accomplish? The names <code>entryPoint</code> and <code>foo</code> are not so descriptive."}, {"owner": {"reputation": 1126, "user_id": 104103, "user_type": "registered", "accept_rate": 50, "profile_image": "https://www.gravatar.com/avatar/ccf1cf3aa6e5cacc9d60e5422cb0100f?s=128&d=identicon&r=PG", "display_name": "BruceBerry", "link": "https://stackoverflow.com/users/104103/bruceberry"}, "edited": false, "score": 0, "creation_date": 1425670991, "post_id": 28905315, "comment_id": 46072128, "body": "because the implementation doesn&#39;t matter, as long as you know that one method does IO and another one uses Either to report errors. I&#39;m pretty sure <code>EitherT String IO Int</code> is the correct type for the behavior I need so I just need the code to typecheck"}, {"owner": {"reputation": 1126, "user_id": 104103, "user_type": "registered", "accept_rate": 50, "profile_image": "https://www.gravatar.com/avatar/ccf1cf3aa6e5cacc9d60e5422cb0100f?s=128&d=identicon&r=PG", "display_name": "BruceBerry", "link": "https://stackoverflow.com/users/104103/bruceberry"}, "reply_to_user": {"reputation": 100185, "user_id": 3234959, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/93bb12ca0f93dfddb33880316f7e66c2?s=128&d=identicon&r=PG&f=1", "display_name": "chi", "link": "https://stackoverflow.com/users/3234959/chi"}, "edited": false, "score": 0, "creation_date": 1425671077, "post_id": 28905315, "comment_id": 46072179, "body": "@chi It compiles, thanks. So basically <code>return $ errorf p&#39;</code> already had the correct type in an abstract sense, but I had to pack it further into an <code>EitherT</code> to satisfy the typechecker?"}, {"owner": {"reputation": 100185, "user_id": 3234959, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/93bb12ca0f93dfddb33880316f7e66c2?s=128&d=identicon&r=PG&f=1", "display_name": "chi", "link": "https://stackoverflow.com/users/3234959/chi"}, "edited": false, "score": 2, "creation_date": 1425674415, "post_id": 28905315, "comment_id": 46073941, "body": "Almost. The original <code>return $ x</code> is in <code>EitherT s IO</code> and means success, modeled as <code>EitherT (return (Right x))</code> where the latter <code>return</code> produces <code>IO</code>. So, the original code builds <code>EtiherT (return (Right (Left ...)))</code> since <code>x=Left ..</code> which is wrong. Instead using <code>EitherT $ return $ errorf p</code> we use the <code>return</code> to produce <code>IO</code> (not <code>EitherT ...</code>), so we get <code>EitherT (return (Left ...))</code>. It&#39;s weird because it <i>appears</i> that we are packing it further, when we are not: adding <code>EitherT</code> makes Haskell to choose a different <code>return</code> (in <code>IO</code> instead of <code>EitherT</code>) !"}, {"owner": {"reputation": 23444, "user_id": 414413, "user_type": "registered", "accept_rate": 79, "profile_image": "https://www.gravatar.com/avatar/6de2113f01432aa844dc85070ff33e89?s=128&d=identicon&r=PG", "display_name": "Cirdec", "link": "https://stackoverflow.com/users/414413/cirdec"}, "reply_to_user": {"reputation": 100185, "user_id": 3234959, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/93bb12ca0f93dfddb33880316f7e66c2?s=128&d=identicon&r=PG&f=1", "display_name": "chi", "link": "https://stackoverflow.com/users/3234959/chi"}, "edited": false, "score": 0, "creation_date": 1425681338, "post_id": 28905315, "comment_id": 46077006, "body": "@chi For this question, your observation and explanations are good enough to be an answer."}], "answers": [{"comments": [{"owner": {"reputation": 1126, "user_id": 104103, "user_type": "registered", "accept_rate": 50, "profile_image": "https://www.gravatar.com/avatar/ccf1cf3aa6e5cacc9d60e5422cb0100f?s=128&d=identicon&r=PG", "display_name": "BruceBerry", "link": "https://stackoverflow.com/users/104103/bruceberry"}, "edited": false, "score": 0, "creation_date": 1425684354, "post_id": 28909290, "comment_id": 46077957, "body": "Why should throwError from Control.Monad.Error.Class be changed to left? It compiles with throwError, and i feel like the name captures the semantics better."}, {"owner": {"reputation": 100185, "user_id": 3234959, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/93bb12ca0f93dfddb33880316f7e66c2?s=128&d=identicon&r=PG&f=1", "display_name": "chi", "link": "https://stackoverflow.com/users/3234959/chi"}, "reply_to_user": {"reputation": 1126, "user_id": 104103, "user_type": "registered", "accept_rate": 50, "profile_image": "https://www.gravatar.com/avatar/ccf1cf3aa6e5cacc9d60e5422cb0100f?s=128&d=identicon&r=PG", "display_name": "BruceBerry", "link": "https://stackoverflow.com/users/104103/bruceberry"}, "edited": false, "score": 0, "creation_date": 1425685811, "post_id": 28909290, "comment_id": 46078336, "body": "@BruceBerry I was wrong about <code>throwError</code> -- I thought that one was raising an exception in <code>IO</code>, which is not the case."}], "tags": [], "owner": {"reputation": 100185, "user_id": 3234959, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/93bb12ca0f93dfddb33880316f7e66c2?s=128&d=identicon&r=PG&f=1", "display_name": "chi", "link": "https://stackoverflow.com/users/3234959/chi"}, "is_accepted": true, "score": 2, "last_activity_date": 1425685672, "last_edit_date": 1425685672, "creation_date": 1425683946, "answer_id": 28909290, "question_id": 28905315, "link": "https://stackoverflow.com/questions/28905315/how-to-combine-multiple-monad-effects-into-the-same-do-block/28909290#28909290", "title": "How to combine multiple monad effects into the same do block?", "body": "<p>The part</p>\n\n<pre><code>p' &lt;- return $ errorf p\n</code></pre>\n\n<p>looks wrong. Here, <code>return</code> builds a monadic value in <code>EitherT String IO</code>. Assuming that <code>errorf p = Left something</code> the value which is being built is</p>\n\n<pre><code>p' &lt;- EitherT (return (Right (Left something)))\n</code></pre>\n\n<p>where the above <code>return</code> builds an <code>IO</code> action. This is not what we want -- there is an extra <code>Right</code> there. We instead want</p>\n\n<pre><code>p' &lt;- EitherT (return (Left something))\n</code></pre>\n\n<p>which is</p>\n\n<pre><code>p' &lt;- EitherT $ return $ errorf p\n</code></pre>\n"}], "owner": {"reputation": 1126, "user_id": 104103, "user_type": "registered", "accept_rate": 50, "profile_image": "https://www.gravatar.com/avatar/ccf1cf3aa6e5cacc9d60e5422cb0100f?s=128&d=identicon&r=PG", "display_name": "BruceBerry", "link": "https://stackoverflow.com/users/104103/bruceberry"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 430, "favorite_count": 0, "accepted_answer_id": 28909290, "answer_count": 1, "score": 0, "last_activity_date": 1425685672, "creation_date": 1425666664, "question_id": 28905315, "link": "https://stackoverflow.com/questions/28905315/how-to-combine-multiple-monad-effects-into-the-same-do-block", "title": "How to combine multiple monad effects into the same do block?", "body": "<p>I have a function that calls functions of type <code>IO</code> and functions of type <code>Either String a</code>.</p>\n\n<p>I would like to combine the effects in the do notation, so that I can unpack <code>IO</code> when necessary and at the same time abort the computation at the first <code>Left</code> I encounter.</p>\n\n<p>Here is a very simple example, can you help me fix it? (use of runEitherT is optional. But I think if you use plain either you won't be able to use <code>MonadError</code> and <code>MonadIO</code> features).</p>\n\n<pre><code>entryPoint :: IO (Either String Int)\nentryPoint = runEitherT foo\n\n-- p and p' should have type Int,\n-- and errorf can force the computation to abort (as can throwError) \nfoo :: EitherT String IO Int\nfoo = do\n  p &lt;- liftIO $ iof 1\n  p' &lt;- return $ errorf p\n  if p' == 2\n    then throwError \"No!\"\n    else return 1\n\nerrorf :: b -&gt; Either String b\nerrorf = undefined\n\niof :: a -&gt; IO a\niof = undefined\n</code></pre>\n"}, {"tags": ["list", "haskell"], "comments": [{"owner": {"reputation": 359, "user_id": 1924817, "user_type": "registered", "accept_rate": 86, "profile_image": "https://www.gravatar.com/avatar/33867bd74b16d7ca6bfb658964dfe878?s=128&d=identicon&r=PG", "display_name": "akegalj", "link": "https://stackoverflow.com/users/1924817/akegalj"}, "edited": false, "score": 0, "creation_date": 1425663914, "post_id": 28904293, "comment_id": 46068489, "body": "i would guess it was design decision (they didn&#39;t want to introduce Maybe). You could ask why <code>head []</code> gives an error instead of Nothing. But you will quickly find there is safe version of head which does exactly this."}], "answers": [{"comments": [{"owner": {"reputation": 100185, "user_id": 3234959, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/93bb12ca0f93dfddb33880316f7e66c2?s=128&d=identicon&r=PG&f=1", "display_name": "chi", "link": "https://stackoverflow.com/users/3234959/chi"}, "edited": false, "score": 0, "creation_date": 1425668416, "post_id": 28904868, "comment_id": 46070732, "body": "While I am generally a big fan of starting induction from 0 when it&#39;s sensible to do so, I&#39;m not so sure about this case. Usually we have <code>concat . chunksOf n == id</code>, but not for 0. An exception might be preferrable here: an infinite list might lead a program to run forever or go out of memory, while an exception at least points to the bug. Using <code>Maybe</code> is an option, but it seems a bit overkill here."}, {"owner": {"reputation": 44013, "user_id": 1477667, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/trgKM.jpg?s=128&g=1", "display_name": "dfeuer", "link": "https://stackoverflow.com/users/1477667/dfeuer"}, "reply_to_user": {"reputation": 100185, "user_id": 3234959, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/93bb12ca0f93dfddb33880316f7e66c2?s=128&d=identicon&r=PG&f=1", "display_name": "chi", "link": "https://stackoverflow.com/users/3234959/chi"}, "edited": false, "score": 0, "creation_date": 1425670040, "post_id": 28904868, "comment_id": 46071637, "body": "@chi, you make good points, but the trend these days seems to be very much toward totality. I think 0-length chunks giving an infinite stream is more obvious than saturated subtraction for <code>Nat</code>!"}, {"owner": {"reputation": 37991, "user_id": 409976, "user_type": "registered", "accept_rate": 68, "profile_image": "https://www.gravatar.com/avatar/9ccda0b49cc974197399eae01ebd6850?s=128&d=identicon&r=PG", "display_name": "Kevin Meredith", "link": "https://stackoverflow.com/users/409976/kevin-meredith"}, "edited": false, "score": 0, "creation_date": 1425681565, "post_id": 28904868, "comment_id": 46077098, "body": "<code>here is precisely one sensible way to produce chunks of size 0 from a list</code> - could you please explain why it&#39;s sensible? I don&#39;t disagree - just want to understand."}, {"owner": {"reputation": 44013, "user_id": 1477667, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/trgKM.jpg?s=128&g=1", "display_name": "dfeuer", "link": "https://stackoverflow.com/users/1477667/dfeuer"}, "reply_to_user": {"reputation": 37991, "user_id": 409976, "user_type": "registered", "accept_rate": 68, "profile_image": "https://www.gravatar.com/avatar/9ccda0b49cc974197399eae01ebd6850?s=128&d=identicon&r=PG", "display_name": "Kevin Meredith", "link": "https://stackoverflow.com/users/409976/kevin-meredith"}, "edited": false, "score": 2, "creation_date": 1425681833, "post_id": 28904868, "comment_id": 46077186, "body": "@KevinMeredith, if you&#39;re asked to empty a bathtub with a bucket, you can probably do it in a few minutes. If you&#39;re asked to perform the same task with a coffee cup, it will take you longer. If you&#39;re asked to do it with a teaspoon, it will take much longer. If you&#39;re asked to do it with a 0-volume measure, it will take forever."}], "tags": [], "owner": {"reputation": 44013, "user_id": 1477667, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/trgKM.jpg?s=128&g=1", "display_name": "dfeuer", "link": "https://stackoverflow.com/users/1477667/dfeuer"}, "is_accepted": true, "score": 4, "last_activity_date": 1425665050, "creation_date": 1425665050, "answer_id": 28904868, "question_id": 28904293, "link": "https://stackoverflow.com/questions/28904293/data-list-splits-chunksof-with-0-value/28904868#28904868", "title": "Data.List.Split&#39;s `chunksOf` with 0 Value", "body": "<p>There is precisely one sensible way to produce chunks of size 0 from a list, so it does that. It's not that useful, but it's better to produce something reasonable and useless than to deal with <code>Maybe</code> or throw exceptions.</p>\n"}], "owner": {"reputation": 37991, "user_id": 409976, "user_type": "registered", "accept_rate": 68, "profile_image": "https://www.gravatar.com/avatar/9ccda0b49cc974197399eae01ebd6850?s=128&d=identicon&r=PG", "display_name": "Kevin Meredith", "link": "https://stackoverflow.com/users/409976/kevin-meredith"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 101, "favorite_count": 0, "accepted_answer_id": 28904868, "answer_count": 1, "score": 2, "last_activity_date": 1425692287, "creation_date": 1425662939, "last_edit_date": 1425692287, "question_id": 28904293, "link": "https://stackoverflow.com/questions/28904293/data-list-splits-chunksof-with-0-value", "title": "Data.List.Split&#39;s `chunksOf` with 0 Value", "body": "<p><code>Data.List.Split</code>'s <code>chunksOf</code> has the type:</p>\n\n<pre><code>Prelude Data.List.Split&gt; :t chunksOf\nchunksOf :: Int -&gt; [e] -&gt; [[e]]\n</code></pre>\n\n<p>Simple example:</p>\n\n<pre><code>Prelude Data.List.Split&gt; chunksOf 2 [1,2,3,4]\n[[1,2],[3,4]]\n</code></pre>\n\n<p>When I pass in a value of <code>0</code>, it returns an infinite list of empty list's: </p>\n\n<pre><code>Prelude Data.List.Split&gt; take 5 $ chunksOf 0 [1]\n[[],[],[],[],[]]\n</code></pre>\n\n<p>What's the reason for this behavior? What's the advantage/reason for not returning a <code>Maybe [[a]]</code>?</p>\n"}, {"tags": ["haskell"], "answers": [{"tags": [], "owner": {"reputation": 58792, "user_id": 1006010, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/f683d229f3673c9dcc3f3f2796d75c09?s=128&d=identicon&r=PG", "display_name": "MathematicalOrchid", "link": "https://stackoverflow.com/users/1006010/mathematicalorchid"}, "is_accepted": false, "score": 3, "last_activity_date": 1425660402, "creation_date": 1425660402, "answer_id": 28903537, "question_id": 28903285, "link": "https://stackoverflow.com/questions/28903285/understanding-sequence-with-a-monad/28903537#28903537", "title": "Understanding `sequence` with `[[a]]` Monad", "body": "<p>What <code>sequence</code> does is to turn something like</p>\n\n<pre><code>[foo, bar, baz]\n</code></pre>\n\n<p>into something like</p>\n\n<pre><code>do\n  x &lt;- foo\n  y &lt;- bar\n  z &lt;- baz\n  return [x, y, z]\n</code></pre>\n\n<p>In your case, we have</p>\n\n<pre><code>do\n  x &lt;- [Just 10, Just 5]\n  y &lt;- [Just 5]\n  return [x, y]\n</code></pre>\n\n<p>which is the same as</p>\n\n<pre><code>foreach x in [Just 10, Just 5]\n  foreach y in [Just 5]\n    return [x, y]\n</code></pre>\n\n<p>in psuedo-OO syntax.</p>\n\n<p>It should now be fairly obvious why you get the result you do.</p>\n"}, {"tags": [], "owner": {"reputation": 51584, "user_id": 839246, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/9b0573c2b936b12828dd1e4cc04206dc?s=128&d=identicon&r=PG&f=1", "display_name": "bheklilr", "link": "https://stackoverflow.com/users/839246/bheklilr"}, "is_accepted": true, "score": 3, "last_activity_date": 1425660492, "creation_date": 1425660492, "answer_id": 28903569, "question_id": 28903285, "link": "https://stackoverflow.com/questions/28903285/understanding-sequence-with-a-monad/28903569#28903569", "title": "Understanding `sequence` with `[[a]]` Monad", "body": "<p>It might be easier to do this with just <code>Int</code>s instead of <code>Maybe Int</code>s:</p>\n\n<pre><code>&gt; sequence [[10, 20], [5]]\n[[10,5],[20,5]]\nit :: [[Int]]\n</code></pre>\n\n<p>The type signature you deduced is correct, it does have type <code>[[a]] -&gt; [[a]]</code> in this situation, where <code>a ~ Int</code> in my example or <code>a ~ Maybe Int</code> in your example.  Whenever using <code>sequence</code> in the list monad, I like to think of it as an N-dimensional Cartesian product.  It desugars to something like</p>\n\n<pre><code>sequence [a, b, c] = do\n    x &lt;- a\n    y &lt;- b\n    z &lt;- c\n    return [x, y, z]\n</code></pre>\n\n<p>But with an arbitrary number of elements, not just 3.  Some other examples might help explain:</p>\n\n<pre><code>sequence [[\"a1\", \"a2\", \"a3\"], [\"b1\", \"b2\"], [\"c1\", \"c2\", \"c3\"]]\n[\n  [\"a1\",\"b1\",\"c1\"],[\"a1\",\"b1\",\"c2\"],[\"a1\",\"b1\",\"c3\"],[\"a1\",\"b2\",\"c1\"],[\"a1\",\"b2\",\"c2\"],[\"a1\",\"b2\",\"c3\"],\n  [\"a2\",\"b1\",\"c1\"],[\"a2\",\"b1\",\"c2\"],[\"a2\",\"b1\",\"c3\"],[\"a2\",\"b2\",\"c1\"],[\"a2\",\"b2\",\"c2\"],[\"a2\",\"b2\",\"c3\"],\n  [\"a3\",\"b1\",\"c1\"],[\"a3\",\"b1\",\"c2\"],[\"a3\",\"b1\",\"c3\"],[\"a3\",\"b2\",\"c1\"],[\"a3\",\"b2\",\"c2\"],[\"a3\",\"b2\",\"c3\"]\n]\n</code></pre>\n\n<p>If you study this output closely, you'll see that we have each element of the <code>a</code>s matched with each element of the <code>b</code>s and each element from the <code>c</code>s.  Since there are 3 <code>a</code>s, 2 <code>b</code>s, and 3 <code>c</code>s, there are <code>3*2*3 == 18</code> elements in the output.</p>\n"}], "owner": {"reputation": 37991, "user_id": 409976, "user_type": "registered", "accept_rate": 68, "profile_image": "https://www.gravatar.com/avatar/9ccda0b49cc974197399eae01ebd6850?s=128&d=identicon&r=PG", "display_name": "Kevin Meredith", "link": "https://stackoverflow.com/users/409976/kevin-meredith"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 63, "favorite_count": 0, "accepted_answer_id": 28903569, "answer_count": 2, "score": 0, "last_activity_date": 1425660492, "creation_date": 1425659627, "question_id": 28903285, "link": "https://stackoverflow.com/questions/28903285/understanding-sequence-with-a-monad", "title": "Understanding `sequence` with `[[a]]` Monad", "body": "<p>Given:</p>\n\n<pre><code>Prelude&gt;[ [Just 10, Just 20], [Just 5] ]\n[ [Just 10, Just 20], [Just 5] ]\n</code></pre>\n\n<p>it has type:</p>\n\n<pre><code>Prelude&gt; :t [ [Just 10, Just 20], [Just 5] ]\n[ [Just 10, Just 20], [Just 5] ] :: Num a =&gt; [[Maybe a]]\n</code></pre>\n\n<p>I'd like to apply this to <code>sequence</code>:</p>\n\n<pre><code>Prelude&gt; :t sequence\nsequence :: Monad m =&gt; [m a] -&gt; m [a]\n</code></pre>\n\n<p>The <code>Monad m</code> in the above List is: <code>[a]</code>, as I understand, so I'd expect the types to line up as:</p>\n\n<pre><code>sequence :: Monad m =&gt; [m a] -&gt; m [a]\n                       [[a]] -&gt; [[a]]\n</code></pre>\n\n<p>Assuming that's right, then please help me understand the output:</p>\n\n<pre><code>Prelude&gt; sequence [ [Just 10, Just 20], [Just 5] ]\n[[Just 10,Just 5],[Just 20,Just 5]]\n</code></pre>\n"}, {"tags": ["haskell", "cabal"], "comments": [{"owner": {"reputation": 58792, "user_id": 1006010, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/f683d229f3673c9dcc3f3f2796d75c09?s=128&d=identicon&r=PG", "display_name": "MathematicalOrchid", "link": "https://stackoverflow.com/users/1006010/mathematicalorchid"}, "edited": false, "score": 0, "creation_date": 1425660060, "post_id": 28902169, "comment_id": 46066177, "body": "If there isn&#39;t a way to do it with Cabal, you could always just write a shell script... (Although obviously that only works for your dev box.)"}, {"owner": {"reputation": 2501, "user_id": 2868481, "user_type": "registered", "accept_rate": 48, "profile_image": "https://www.gravatar.com/avatar/d32920192c6bebcffb83fffd557b9553?s=128&d=identicon&r=PG&f=1", "display_name": "d8d0d65b3f7cf42", "link": "https://stackoverflow.com/users/2868481/d8d0d65b3f7cf42"}, "reply_to_user": {"reputation": 58792, "user_id": 1006010, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/f683d229f3673c9dcc3f3f2796d75c09?s=128&d=identicon&r=PG", "display_name": "MathematicalOrchid", "link": "https://stackoverflow.com/users/1006010/mathematicalorchid"}, "edited": false, "score": 0, "creation_date": 1425661343, "post_id": 28902169, "comment_id": 46067007, "body": "Yes. -- I could understand if cabal designers refused to do this on the grounds that your tests should be (completely) specified in the (Haskell) source (for repeatability). But then why did they implement <code>--test-options</code>? So my question is, whether the design is inconsistent (<code>--test-options</code> allowed on command line, but forbidden in cabal file) or I am simply missing something."}], "answers": [{"tags": [], "owner": {"reputation": 37486, "user_id": 371753, "user_type": "registered", "accept_rate": 83, "profile_image": "https://i.stack.imgur.com/znFEK.jpg?s=128&g=1", "display_name": "sclv", "link": "https://stackoverflow.com/users/371753/sclv"}, "is_accepted": false, "score": 3, "last_activity_date": 1517908009, "creation_date": 1517908009, "answer_id": 48639163, "question_id": 28902169, "link": "https://stackoverflow.com/questions/28902169/put-command-line-arguments-for-tests-in-cabal-file/48639163#48639163", "title": "put command line arguments for tests in cabal file?", "body": "<p>There is no way to do this. As the comments suggest, if there are default options for the test-suite, they should just be baked into the executable. Command line options are intended only for <em>overriding or modifying</em> those default options. There is no way to add additional options in the cabal file</p>\n"}], "owner": {"reputation": 2501, "user_id": 2868481, "user_type": "registered", "accept_rate": 48, "profile_image": "https://www.gravatar.com/avatar/d32920192c6bebcffb83fffd557b9553?s=128&d=identicon&r=PG&f=1", "display_name": "d8d0d65b3f7cf42", "link": "https://stackoverflow.com/users/2868481/d8d0d65b3f7cf42"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 543, "favorite_count": 0, "answer_count": 1, "score": 9, "last_activity_date": 1517908009, "creation_date": 1425656126, "last_edit_date": 1425669494, "question_id": 28902169, "link": "https://stackoverflow.com/questions/28902169/put-command-line-arguments-for-tests-in-cabal-file", "title": "put command line arguments for tests in cabal file?", "body": "<p>Is there a way to write command line arguments for tests (exitcode-stdio-1.0) in the cabal file? </p>\n\n<p>I can run the tests manually with</p>\n\n<pre><code>cabal test --test-options=\"foo bar\"\n</code></pre>\n\n<p>but I don't want to (re-)type this. </p>\n"}, {"tags": ["algorithm", "haskell", "tree"], "comments": [{"owner": {"reputation": 44013, "user_id": 1477667, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/trgKM.jpg?s=128&g=1", "display_name": "dfeuer", "link": "https://stackoverflow.com/users/1477667/dfeuer"}, "edited": false, "score": 0, "creation_date": 1425654747, "post_id": 28901650, "comment_id": 46062684, "body": "Think about how to sum the elements of a list."}], "answers": [{"comments": [{"owner": {"reputation": 13807, "user_id": 2407038, "user_type": "registered", "accept_rate": 64, "profile_image": "https://www.gravatar.com/avatar/538f6f4a9aa43841841de7d8e8b169fc?s=128&d=identicon&r=PG&f=1", "display_name": "user2407038", "link": "https://stackoverflow.com/users/2407038/user2407038"}, "edited": false, "score": 0, "creation_date": 1425677060, "post_id": 28902610, "comment_id": 46075132, "body": "Tree is not a Foldable - it doesn&#39;t even have the correct kind."}, {"owner": {"reputation": 75362, "user_id": 625403, "user_type": "registered", "accept_rate": 82, "profile_image": "https://www.gravatar.com/avatar/786eed7da67079cb5d63a49d469af25b?s=128&d=identicon&r=PG", "display_name": "amalloy", "link": "https://stackoverflow.com/users/625403/amalloy"}, "edited": false, "score": 0, "creation_date": 1425678367, "post_id": 28902610, "comment_id": 46075726, "body": "And of course <code>foldr (+) 0 x</code> is just a worse way to write <code>sum x</code>."}, {"owner": {"reputation": 81, "user_id": 1074540, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/d3e84fe1963fc2c059181b8e435b435e?s=128&d=identicon&r=PG", "display_name": "Jared Simpson", "link": "https://stackoverflow.com/users/1074540/jared-simpson"}, "reply_to_user": {"reputation": 13807, "user_id": 2407038, "user_type": "registered", "accept_rate": 64, "profile_image": "https://www.gravatar.com/avatar/538f6f4a9aa43841841de7d8e8b169fc?s=128&d=identicon&r=PG&f=1", "display_name": "user2407038", "link": "https://stackoverflow.com/users/2407038/user2407038"}, "edited": false, "score": 0, "creation_date": 1425780836, "post_id": 28902610, "comment_id": 46101782, "body": "@user2407038, indeed. I didn&#39;t paste in my <code>data Tree a</code> that I was coding against."}], "tags": [], "owner": {"reputation": 81, "user_id": 1074540, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/d3e84fe1963fc2c059181b8e435b435e?s=128&d=identicon&r=PG", "display_name": "Jared Simpson", "link": "https://stackoverflow.com/users/1074540/jared-simpson"}, "is_accepted": false, "score": 3, "last_activity_date": 1425657506, "creation_date": 1425657506, "answer_id": 28902610, "question_id": 28901650, "link": "https://stackoverflow.com/questions/28901650/how-to-sum-the-elements-of-a-n-ary-haskell-tree/28902610#28902610", "title": "How to sum the elements of a n-ary Haskell Tree?", "body": "<pre><code>import qualified Data.Foldable as F\n\ninstance F.Foldable Tree where\n    foldMap f Empty = mempty\n    foldMap f (Node a ts) = mconcat $ f a : map (F.foldMap f) ts\n\nsumall = F.sum\n</code></pre>\n\n<p>without Foldable you would do something like</p>\n\n<pre><code>sumall Empty = 0\nsumall (Node a ts) = a + foldr (+) 0 (map sumall ts)\n</code></pre>\n"}], "owner": {"reputation": 3, "user_id": 4641365, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/183d5077b72457073a86a5dc2eb368b1?s=128&d=identicon&r=PG", "display_name": "mustafamuratcoskun", "link": "https://stackoverflow.com/users/4641365/mustafamuratcoskun"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 558, "favorite_count": 0, "answer_count": 1, "score": 0, "last_activity_date": 1425657506, "creation_date": 1425654520, "last_edit_date": 1425654712, "question_id": 28901650, "link": "https://stackoverflow.com/questions/28901650/how-to-sum-the-elements-of-a-n-ary-haskell-tree", "title": "How to sum the elements of a n-ary Haskell Tree?", "body": "<p>I am new in Haskell Programming and I have tried to code  and manipulate a Haskell n-ary tree defined as</p>\n\n<pre><code>data Tree = Empty | Node Integer [Tree] \n</code></pre>\n\n<p>I want to write a <code>sum</code> function for this tree structure, but I did not figure it out. The function I coded is here:</p>\n\n<pre><code>sumall Empty = 0\n\nsumall (Node a (x:xy) ) = a + (sumall x)\n</code></pre>\n\n<p>Input: <code>(Node 5 [Node 2 [Node 1 [Empty]],Node 8 [Node 7 [Node 6 [Empty]],Node 12 [Node 10 [Node 9 [Empty]],Node 13 [Node 15 [Empty]]]]] )</code></p>\n\n<p>The result = 8.</p>\n\n<p>How to develop this function to sum all the elements in this tree? Thanks in advance.</p>\n"}, {"tags": ["haskell", "ghci", "ffi"], "answers": [{"tags": [], "owner": {"reputation": 4530, "user_id": 94687, "user_type": "registered", "accept_rate": 45, "profile_image": "https://www.gravatar.com/avatar/ef249e4381c9d55297cddc4bd5b5c3c2?s=128&d=identicon&r=PG", "display_name": "imz -- Ivan Zakharyaschev", "link": "https://stackoverflow.com/users/94687/imz-ivan-zakharyaschev"}, "is_accepted": true, "score": 6, "last_activity_date": 1425659306, "last_edit_date": 1495542321, "creation_date": 1425647916, "answer_id": 28899621, "question_id": 28899620, "link": "https://stackoverflow.com/questions/28899620/make-ghci-load-and-interpret-a-module-with-a-foreign-export-declaration-for-f/28899621#28899621", "title": "Make GHCi load and interpret a module with a &quot;foreign export&quot; declaration (for FFI with C)?", "body": "<p>Actually, as <a href=\"https://groups.google.com/forum/#!topic/comp.lang.haskell/wloDdit9gO4\" rel=\"nofollow noreferrer\">told by Dirk Thierbach</a>, there are two helpful options in this case:</p>\n\n<blockquote>\n  <p>If you look up -fvia-C in the GHC manual, section flag reference,\n  you're redirected to section 4.10.6 (Options affecting code\n  generation). There you'll find, near -fvia-C:</p>\n  \n  <blockquote>\n    <p><code>-fobject-code</code></p>\n    \n    <p>Generate object code. This is the default outside of GHCi, and can\n    be used with GHCi to cause object code to be generated in preference\n    to bytecode.</p>\n    \n    <p><code>-fbyte-code</code></p>\n    \n    <p>Generate byte-code instead of object-code. This is the default in\n    GHCi. Byte-code can currently only be used in the interactive\n    interpreter, not saved to disk. This option is only useful for\n    reversing the effect of <code>-fobject-code</code>.</p>\n  </blockquote>\n  \n  <p>That explains why it works with GHC, but not with GHCI.</p>\n</blockquote>\n\n<p>So, I happily do <code>ghci -fobject-code src/valencies.lhs src/Safe.hs</code> now.</p>\n\n<h3>Related questions</h3>\n\n<ul>\n<li><a href=\"https://stackoverflow.com/q/10123040/94687\">GHCi doesn't work with FFI export declarations/shared libaries</a> first seemed a mess to me, because it didn't help me. It deals with <code>foreign export</code> from Haskell to C, too, but the problem solved there is some missing object files, which you must give to GHCi for it to link everything. In my case, I simply omit linking with the C part of the program, because I don't need it to test the Haskell module. After re-reading that Q&amp;A, I can suspect that giving an <code>.o</code> to GHCi can simply silently switch GHCi to the correct mode!</li>\n</ul>\n\n<p>If all you want is to test the Haskell module, and if its functions can work in isolation from C functions (i.e., they don't call C functions), I believe the option I have discovered is a simpler way than to add more <code>.o</code> files to the command line to make GHCi link everything (you see, there might be further requirements to link with some C functions from other packages, which is not important for you).</p>\n"}], "owner": {"reputation": 4530, "user_id": 94687, "user_type": "registered", "accept_rate": 45, "profile_image": "https://www.gravatar.com/avatar/ef249e4381c9d55297cddc4bd5b5c3c2?s=128&d=identicon&r=PG", "display_name": "imz -- Ivan Zakharyaschev", "link": "https://stackoverflow.com/users/94687/imz-ivan-zakharyaschev"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 380, "favorite_count": 0, "accepted_answer_id": 28899621, "answer_count": 1, "score": 3, "last_activity_date": 1425659306, "creation_date": 1425647916, "last_edit_date": 1495542728, "question_id": 28899620, "link": "https://stackoverflow.com/questions/28899620/make-ghci-load-and-interpret-a-module-with-a-foreign-export-declaration-for-f", "title": "Make GHCi load and interpret a module with a &quot;foreign export&quot; declaration (for FFI with C)?", "body": "<p>I have a module (<code>Safe.hs</code>) with</p>\n\n<pre><code>foreign export ccall respond_hs :: CWString -&gt; IO CWString\n</code></pre>\n\n<p>for FFI with C.</p>\n\n<p>I'd like to load <code>Safe.hs</code> in GHCi and evaluate some things with it.</p>\n\n<p>But <code>ghci</code> fails to load it (I'm specifying two source files because it depends on <code>valencies.lhs</code>):</p>\n\n<pre><code>$ ghci src/valencies.lhs src/Safe.hs \nGHCi, version 7.6.1: http://www.haskell.org/ghc/  :? for help\nLoading package ghc-prim ... linking ... done.\nLoading package integer-gmp ... linking ... done.\nLoading package base ... linking ... done.\n[1 of 2] Compiling Valencies        ( src/valencies.lhs, interpreted ) [flags changed]\n\n[2 of 2] Compiling Safe             ( src/Safe.hs, interpreted )\n\nsrc/Safe.hs:10:1:\n    Illegal foreign declaration: requires via-C, llvm (-fllvm) or native code generation (-fvia-C)\n    When checking declaration:\n      foreign export ccall \"respond_hs\" respond_hs\n        :: CWString -&gt; IO CWString\nFailed, modules loaded: Valencies.\n*Valencies&gt; :q\nLeaving GHCi.\n$ \n</code></pre>\n\n<p>Giving <code>-fvia-C</code> option doesn't help.</p>\n\n<h3>Related questions</h3>\n\n<ul>\n<li><p>This is a different question from <a href=\"https://stackoverflow.com/q/15677323/94687\">Testing FFI Code with GHCi</a>, where the point was in testing Haskell code with <code>foreign import</code> (not <code>export</code>) from C libraries.</p></li>\n<li><p><a href=\"https://stackoverflow.com/q/10123040/94687\">GHCi doesn't work with FFI export declarations/shared libaries</a> seems strange to me, because it doesn't help me. It deals with <code>foreign export</code> from Haskell to C, but the problem solved there is some missing object files.</p></li>\n</ul>\n"}, {"tags": ["haskell", "types"], "comments": [{"owner": {"reputation": 94713, "user_id": 1139697, "user_type": "registered", "accept_rate": 86, "profile_image": "https://www.gravatar.com/avatar/5f136ddb684f39aaee1c028ee1950f6f?s=128&d=identicon&r=PG", "display_name": "Zeta", "link": "https://stackoverflow.com/users/1139697/zeta"}, "edited": false, "score": 1, "creation_date": 1425643696, "post_id": 28898320, "comment_id": 46056173, "body": "Note: StackOverflow&#39;s markdown variant doesn&#39;t know fenced code blocks, you need to use indentation."}], "answers": [{"comments": [{"owner": {"reputation": 4455, "user_id": 1460448, "user_type": "registered", "accept_rate": 71, "profile_image": "https://www.gravatar.com/avatar/0dd5a0fbb2b5d5592a49d2e60ef98f0a?s=128&d=identicon&r=PG&f=1", "display_name": "xji", "link": "https://stackoverflow.com/users/1460448/xji"}, "edited": false, "score": 0, "creation_date": 1425645442, "post_id": 28898543, "comment_id": 46057077, "body": "That solved the problem. Thanks. So the <code>(Integral Float)</code> thing actually refers to <code>(Part1 &#47; Part2)</code>? Then isn&#39;t the error message actually a bit misleading though. It seems to be saying it was the arguments of <code>truncate</code> which caused the issue, while in fact it was the result of it."}], "tags": [], "owner": {"reputation": 94713, "user_id": 1139697, "user_type": "registered", "accept_rate": 86, "profile_image": "https://www.gravatar.com/avatar/5f136ddb684f39aaee1c028ee1950f6f?s=128&d=identicon&r=PG", "display_name": "Zeta", "link": "https://stackoverflow.com/users/1139697/zeta"}, "is_accepted": true, "score": 3, "last_activity_date": 1425646438, "last_edit_date": 1425646438, "creation_date": 1425643954, "answer_id": 28898543, "question_id": 28898320, "link": "https://stackoverflow.com/questions/28898320/haskell-cannot-understand-this-type-mismatch-error/28898543#28898543", "title": "Haskell - Cannot understand this type mismatch error", "body": "<p>Well, <code>truncate</code> has type <code>(RealFrac a, Integral b) =&gt; a -&gt; b</code>, which means that its polymorphic result needs to fulfil the <code>Integral</code> constraint. However, <code>dowNumber</code>'s type indicates that <code>(partOne + partTwo) / 7</code> is a <code>Float</code>. Therefore, <code>partOne</code> and <code>partTwo</code> <em>also</em> need to be <code>Float</code>s.</p>\n\n<p>That would be possible if a <code>Float</code> was some kind of integral type. But it isn't. But to get a float from an <code>Integral</code>, all that's missing is another <code>fromIntegral</code>, either at <code>partOne</code>:</p>\n\n<pre><code>partOne = fromIntegral $ truncate $ \u2026\n</code></pre>\n\n<p>or before you try to divide:</p>\n\n<pre><code>dowNumber \u2026 = fromIntegral (partOne + partTwo) / 7 where \n   \u2026\n</code></pre>\n\n<h2>How can I fix errors like this easier?</h2>\n\n<p>Annotate the types. In this specific case, GHC complained about <code>truncate</code>, and therefore about <code>partOne</code>. Lets simplify your example for a minute:</p>\n\n<pre><code>number :: Float\nnumber = (a + b) / 2 where\n  a = truncate $ fromIntegral 5 / 2 \n  b = fromIntegral $ 12\n</code></pre>\n\n<p>This creates the same error as your previous program:</p>\n\n<pre>\nSO.hs:3:7:\n    No instance for (Integral Float) arising from a use of \u2018truncate\u2019\n    In the expression: truncate\n    In the expression: truncate $ fromIntegral 5 / 2\n    In an equation for \u2018a\u2019: a = truncate $ fromIntegral 5 / 2\n</pre>\n\n<p>So, the equation for <code>a</code> isn't correct? Lets fix the types of both <code>a</code> and <code>b</code>:</p>\n\n<pre><code>number :: Float\nnumber = (a + b) / 2 where\n  a, b :: Int\n  a = truncate $ fromIntegral 5 / 2 \n  b = fromIntegral $ 12\n</code></pre>\n\n<p>And now it gets clear:</p>\n\n<pre>\nSO.hs:2:11:\n    Couldn't match expected type \u2018Float\u2019 with actual type \u2018Int\u2019\n    In the first argument of \u2018(+)\u2019, namely \u2018a\u2019\n    In the first argument of \u2018(/)\u2019, namely \u2018(a + b)\u2019\n\nSO.hs:2:15:\n    Couldn't match expected type \u2018Float\u2019 with actual type \u2018Int\u2019\n    In the second argument of \u2018(+)\u2019, namely \u2018b\u2019\n    In the first argument of \u2018(/)\u2019, namely \u2018(a + b)\u2019\nFailed, modules loaded: none.\n</pre>\n"}], "owner": {"reputation": 4455, "user_id": 1460448, "user_type": "registered", "accept_rate": 71, "profile_image": "https://www.gravatar.com/avatar/0dd5a0fbb2b5d5592a49d2e60ef98f0a?s=128&d=identicon&r=PG&f=1", "display_name": "xji", "link": "https://stackoverflow.com/users/1460448/xji"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 143, "favorite_count": 0, "accepted_answer_id": 28898543, "answer_count": 1, "score": 1, "last_activity_date": 1425646438, "creation_date": 1425643174, "last_edit_date": 1425643676, "question_id": 28898320, "link": "https://stackoverflow.com/questions/28898320/haskell-cannot-understand-this-type-mismatch-error", "title": "Haskell - Cannot understand this type mismatch error", "body": "<p>I have the following code (<code>yyyy</code> and <code>mm</code> defined to be type <code>Int</code>):</p>\n\n<pre><code>partOne = truncate  ((fromIntegral yyyy + fromIntegral mm/100) * 1.25 + 0.97)\n</code></pre>\n\n<p>which on being loaded into GHCi gives me an error:</p>\n\n<pre>\nNo instance for (Integral Float) arising from a use of \u2018truncate\u2019\n</pre>\n\n<p>However if I directly use the following line in GHCi, it works fine:</p>\n\n<pre><code>truncate  ((fromIntegral 2000 + fromIntegral 04/100) * 1.25 + 0.97)\n</code></pre>\n\n<p>There seems to be some problem related to the type <code>Int</code>, however I am not able to figure out how.</p>\n\n<p>Also, actually I don't exactly understand what <code>(Integral Float)</code> means here.</p>\n\n<hr>\n\n<p>For completeness's sake, the definition of the whole function is included here in case the error is caused by the whole thing instead of that single statement:</p>\n\n<pre><code>dowNumber :: Mnemonic -&gt; PhonePad -&gt; Date -&gt; Float\ndowNumber mn p (yyyy, mm, dd) = (partOne + partTwo) / 7 where\n  partOne = (truncate  ((fromIntegral yyyy + (fromIntegral mm)/100) * 1.25 + 0.97))\n  partTwo = fromIntegral ((monthToPhone mn p mm) + dd)\n</code></pre>\n\n<p><code>Mnemonic</code> is just <code>String</code> and <code>PhonePad</code> is <code>[(Char, Int)]</code>. <code>Date</code> is <code>(Int, Int, Int)</code>.</p>\n"}, {"tags": ["haskell", "monad-transformers", "state-monad", "free-monad"], "comments": [{"owner": {"reputation": 57219, "user_id": 33796, "user_type": "registered", "accept_rate": 70, "profile_image": "https://www.gravatar.com/avatar/08727b23ba62e634b32988cdff082663?s=128&d=identicon&r=PG", "display_name": "luqui", "link": "https://stackoverflow.com/users/33796/luqui"}, "edited": false, "score": 1, "creation_date": 1425638166, "post_id": 28896877, "comment_id": 46053515, "body": "Look at the type signature for <code>runTest</code>: it returns a value in a monad <code>m</code> as long as <code>m</code> is a <code>MonadState FakeDB</code>.  So when you call <code>runTest</code> you need to bind it into such a monad, which <code>IO</code> is not (that&#39;s what the error message is telling you).  Try <code>runStateT (runTest foo) Map.empty</code> (which creates such a monadic context in its first argument)."}, {"owner": {"reputation": 113, "user_id": 506816, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/ac665af6ba4f32d2a8ff720f1a2fbecb?s=128&d=identicon&r=PG", "display_name": "Tds", "link": "https://stackoverflow.com/users/506816/tds"}, "reply_to_user": {"reputation": 57219, "user_id": 33796, "user_type": "registered", "accept_rate": 70, "profile_image": "https://www.gravatar.com/avatar/08727b23ba62e634b32988cdff082663?s=128&d=identicon&r=PG", "display_name": "luqui", "link": "https://stackoverflow.com/users/33796/luqui"}, "edited": false, "score": 0, "creation_date": 1425656458, "post_id": 28896877, "comment_id": 46063837, "body": "Thanks for the explanation @luqui, your suggestion did indeed work."}, {"owner": {"reputation": 37486, "user_id": 371753, "user_type": "registered", "accept_rate": 83, "profile_image": "https://i.stack.imgur.com/znFEK.jpg?s=128&g=1", "display_name": "sclv", "link": "https://stackoverflow.com/users/371753/sclv"}, "reply_to_user": {"reputation": 57219, "user_id": 33796, "user_type": "registered", "accept_rate": 70, "profile_image": "https://www.gravatar.com/avatar/08727b23ba62e634b32988cdff082663?s=128&d=identicon&r=PG", "display_name": "luqui", "link": "https://stackoverflow.com/users/33796/luqui"}, "edited": false, "score": 0, "creation_date": 1428342266, "post_id": 28896877, "comment_id": 47113830, "body": "@luqui since your comment resolved the question, do you mind posting it as an answer?"}], "answers": [{"tags": [], "owner": {"reputation": 57219, "user_id": 33796, "user_type": "registered", "accept_rate": 70, "profile_image": "https://www.gravatar.com/avatar/08727b23ba62e634b32988cdff082663?s=128&d=identicon&r=PG", "display_name": "luqui", "link": "https://stackoverflow.com/users/33796/luqui"}, "is_accepted": true, "score": 1, "last_activity_date": 1428343813, "creation_date": 1428343813, "answer_id": 29476919, "question_id": 28896877, "link": "https://stackoverflow.com/questions/28896877/using-free-monads-to-test-redis-calls/29476919#29476919", "title": "Using free monads to test Redis calls", "body": "<p>Look at the type signature for <code>runTest</code>: it returns a value in a monad <code>m</code> as long as <code>m</code> is a <code>MonadState FakeDB</code>. So when you call runTest you need to bind it into such a monad, which <code>IO</code> is not (that's what the error message is telling you). Try <code>runStateT (runTest foo) Map.empty</code> (which creates such a monadic context in its first argument).</p>\n"}], "owner": {"reputation": 113, "user_id": 506816, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/ac665af6ba4f32d2a8ff720f1a2fbecb?s=128&d=identicon&r=PG", "display_name": "Tds", "link": "https://stackoverflow.com/users/506816/tds"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 140, "favorite_count": 0, "accepted_answer_id": 29476919, "answer_count": 1, "score": 2, "last_activity_date": 1428343813, "creation_date": 1425637762, "question_id": 28896877, "link": "https://stackoverflow.com/questions/28896877/using-free-monads-to-test-redis-calls", "title": "Using free monads to test Redis calls", "body": "<p>I am trying to follow <a href=\"http://michaelxavier.net/posts/2014-04-27-Cool-Idea-Free-Monads-for-Testing-Redis-Calls.html\" rel=\"nofollow\">this blog post</a> in order to separate the execution of  Redis requests from their usage by using free monads. I made some small changes to the code provided in order to use hedis as the Redis client and the changes seem to type check. Unfortunately I have not been able to find or write a type class instance that satisfies the type constraints for the runTest and runRedis functions and I get the following error when I call runTest with foo.</p>\n\n<pre><code>No instance for (Control.Monad.State.Class.MonadState FakeDB IO)\n</code></pre>\n\n<p>Storage/Types.hs</p>\n\n<pre><code>{-# LANGUAGE TemplateHaskell #-}\n{-# LANGUAGE DeriveFunctor #-}\n{-# LANGUAGE FlexibleContexts #-}\n\nmodule Storage.Types where\n\nimport Control.Monad.Free\nimport Control.Monad.Free.TH\n\ndata RedisCmd next = Get' String (Maybe String -&gt; next) |\n                     Set' String String next      |\n                     Multi' (RedisCmdM ()) next deriving (Functor)\n\ntype RedisCmdM = Free RedisCmd\n\nmakeFree ''RedisCmd\n</code></pre>\n\n<p>Storage/Implementations.hs</p>\n\n<pre><code>{-# LANGUAGE FlexibleContexts #-}\n{-# LANGUAGE TypeSynonymInstances #-}\n{-# LANGUAGE UndecidableInstances #-}\n\nmodule Storage.Implementations where\n\nimport Control.Monad.State\nimport Control.Monad.State.Class\nimport Control.Monad.Free\nimport Control.Monad.Free.TH\nimport Data.Functor\nimport Data.Map (Map)\nimport Data.ByteString (ByteString)\nimport qualified Data.ByteString.Char8 as C8\nimport qualified Data.Map as M\nimport qualified Database.Redis as R\nimport Storage.Types\n\nrunDebug :: RedisCmdM a -&gt; IO a\nrunDebug = iterM run\n  where\n    run :: RedisCmd (IO a) -&gt; IO a\n    run (Get' k f) = do\n      putStrLn $ unwords [\"GET\", k]\n      f . Just =&lt;&lt; getLine\n    run (Set' k v n) = do\n      putStrLn $ unwords [\"SET\", k, v]\n      n\n    run (Multi' txn n) = do\n      putStrLn \"MULTI\"\n      runDebug txn\n      putStrLn \"EXEC\"\n      n\n\n-- newtype FakeDB = FakeDB { insideFDB :: Map String String }\ntype FakeDB = Map String String\n\n-- instance (MonadIO m) =&gt; MonadState R.Connection m where\n--   get = lift get\n--   put = lift . put\n\nrunTest :: MonadState FakeDB m =&gt; RedisCmdM a -&gt; m a\nrunTest = iterM run\n  where\n    run (Get' k f) = f =&lt;&lt; gets (M.lookup k)\n    run (Set' k v n) = do\n      modify $ M.insert k v\n      n\n    run (Multi' txn n) = do\n      runTest txn\n      n\n\ngetC :: R.Connection -&gt; String -&gt; IO (Maybe String)\ngetC c k = R.runRedis c (getRedis k)\n\ngetRedis :: String -&gt; R.Redis (Maybe String)\ngetRedis k = convert &lt;$&gt; (R.get . C8.pack) k\n  where\n   convert (Left _)  = Nothing\n   convert (Right r) = C8.unpack &lt;$&gt; r\n\nsetC :: R.Connection -&gt; String -&gt; String -&gt; IO ()\nsetC c k v = do\n  _ &lt;- R.runRedis c $ R.set (C8.pack k) (C8.pack v)\n  return ()\n\nmulti :: R.Connection -&gt; (RedisCmdM ()) -&gt; IO ()\nmulti = undefined\n\ndb :: IO R.Connection\ndb = R.connect R.defaultConnectInfo\n\nrunRedis :: (MonadState R.Connection m, MonadIO m) =&gt; RedisCmdM a -&gt; m a\nrunRedis rcmd = withConn $ \\c -&gt; (iterM (run c) rcmd)\n  where\n    run :: R.Connection -&gt; RedisCmd (IO a) -&gt; IO a\n    run c (Get' k f) = f =&lt;&lt; getC c k\n    run c (Set' k v n) = setC c k v &gt;&gt; n\n    run c (Multi' txn n) = undefined --multi c txn &gt;&gt; n\n    withConn action = liftIO (join (action &lt;$&gt; db))\n</code></pre>\n\n<p>Main.hs</p>\n\n<pre><code>{-# LANGUAGE OverloadedStrings #-}\n\nimport Storage.Types\nimport Storage.Implementations (runDebug, runTest, runRedis)\n\nfoo :: RedisCmdM ()\nfoo = do\n  mv &lt;- get' \"foo\"\n  case mv of\n    Nothing -&gt; return ()\n    Just v -&gt; multi' $ do\n      set' \"foo1\" v\n      set' \"foo2\" v\n\nmain = do\n  runTest foo\n</code></pre>\n"}, {"tags": ["haskell", "recursion", "tail-recursion", "binomial-coefficients"], "answers": [{"tags": [], "owner": {"reputation": 60057, "user_id": 1333025, "user_type": "registered", "accept_rate": 65, "profile_image": "https://www.gravatar.com/avatar/79ab43010f900324ac5e2de19a2916cb?s=128&d=identicon&r=PG", "display_name": "Petr", "link": "https://stackoverflow.com/users/1333025/petr"}, "is_accepted": true, "score": 11, "last_activity_date": 1487529553, "last_edit_date": 1487529553, "creation_date": 1425637968, "answer_id": 28896925, "question_id": 28896626, "link": "https://stackoverflow.com/questions/28896626/tail-recursive-binomial-coefficient-function-in-haskell/28896925#28896925", "title": "Tail recursive binomial coefficient function in Haskell", "body": "<p>Yes. There is a standard trick of using <a href=\"https://wiki.haskell.org/Performance/Accumulating_parameter\" rel=\"nofollow noreferrer\">an accumulator to achieve tail recursion</a>. In your case, you'll need two of them (or accumulate one rational number):</p>\n\n<pre><code>binom :: Int -&gt; Int -&gt; Int\nbinom = loop 1 1\n  where\n    loop rn rd _ 0 = rn `div` rd\n    loop _  _  0 _ = 0\n    loop rn rd n k = loop (rn * n) (rd * k) (n-1) (k-1)\n</code></pre>\n\n<p><strong>Update:</strong> For large binomial coefficients, better use <code>Integer</code> as <code>Int</code> can easily overflow. Moreover in the above simple implementation both numerator and denominator can grow much larger than the final result. One simple solution is to accumulate <code>Rational</code>, another would be to divide both by their <a href=\"https://en.wikipedia.org/wiki/Greatest_common_divisor\" rel=\"nofollow noreferrer\">gcd</a> at every step (which AFAIK <code>Rational</code> does behind the scenes).</p>\n"}, {"tags": [], "owner": {"reputation": 3183, "user_id": 3025453, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/ecaade2979d70e6fa61d1f8bca6f27e1?s=128&d=identicon&r=PG&f=1", "display_name": "Michael Karcher", "link": "https://stackoverflow.com/users/3025453/michael-karcher"}, "is_accepted": false, "score": 3, "last_activity_date": 1425638888, "last_edit_date": 1425638888, "creation_date": 1425637979, "answer_id": 28896929, "question_id": 28896626, "link": "https://stackoverflow.com/questions/28896626/tail-recursive-binomial-coefficient-function-in-haskell/28896929#28896929", "title": "Tail recursive binomial coefficient function in Haskell", "body": "<p>Yes, it is possible, if you introduce a helper function that takes an extra parameter:</p>\n\n<pre><code>-- calculate factor*(n choose k)\nbinom_and_multiply factor n 0 = factor\nbinom_and_multiply factor 0 k = 0\nbinom_and_multiply factor n k = binom (n-1) (k-1) (factor * n `div` k)\n\nbinom n k = binom_and_multiply 1 n k\n</code></pre>\n\n<p>The last line could be rewritten in point-free style:</p>\n\n<pre><code>binom = binom_and_multiply 1\n</code></pre>\n\n<hr>\n\n<p>EDIT: The function above shows the idea, but is actually broken, because the <code>div</code> operand truncates and opposed to the original version, there is no mathematical proof that the value to divide always is a multiple of the denominator. So that function must be replaced by the suggestion by Petr Pudl\u00e1k:</p>\n\n<pre><code>-- calculate (n choose k) * num `div` denom\nbinom_and_multiply num denom _ 0 = num `div` denom\nbinom_and_multiply _   _     0 _ = 0\nbinom_and_multiply num denom n k = binom_and_multiply num denom (num * n) (denom * k) (n-1) (k-1)\n\nbinom = binom_and_multiply 1 1\n</code></pre>\n\n<hr>\n\n<p>In non-optimizing haskell implementations, you might be disappointed that the \"properly tail recursive\" variant still gobbles up lots of memory if you choose high values for <code>n</code> and <code>k</code>, because you are trading stack space in the non tail-recursive implementation by heap-space, as haskell is too lazy to calculate all the products just in time. It waits until you really need the value (maybe to print it), and just stores a representation of the two product expressions on the heap. To avoid that, you should make <code>binom_and_multiply</code> as they say <em>strict in the first and second parameter</em>, so the product will be eagerly evaluated while doing the tail recursion. For example, one could compare <code>num</code> and <code>denom</code> to zero, which will need to evaluate the expression for factor before going on:</p>\n\n<pre><code>-- calculate (n choose k) * num `div` denom\nbinom_and_multiply 0 0 _ _ = undefined  -- can't happen, div by zero\n-- remaining expressions go here.\n</code></pre>\n\n<p>The general way to make sure the product is not \"evalutated to large\" is using the <code>seq</code> function:</p>\n\n<pre><code>-- calculate (n choose k) * num `div` denom\nbinom_and_multiply num denom _ 0 = num `div` denom\nbinom_and_multiply _   _     0 _ = 0\nbinom_and_multiply num denom n k = \n      new_num = num*n\n      new_denom = denom*k\n    in new_num `seq` new_denom `seq` binom_and_multiply new_num new_denom (n-1) (k-1)\n</code></pre>\n\n<p>This tells the haskell implementation that the recursive call to <code>binom_and_multiply</code> may only occur after <code>new_num</code> and <code>new_denom</code> has been evaluted (to WHNF, but explaining WHNF is out-of-scope for this question).</p>\n\n<p>One last remark: What this answer was doing is called generally <em>transforming a right-fold into a left-fold</em> and then <em>making the left-fold strict</em>.</p>\n"}, {"tags": [], "owner": {"reputation": 5755, "user_id": 394253, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/985ef765f821b00d3b41ac5ca8aef6a0?s=128&d=identicon&r=PG", "display_name": "Ed&#39;ka", "link": "https://stackoverflow.com/users/394253/edka"}, "is_accepted": false, "score": 1, "last_activity_date": 1425981566, "creation_date": 1425981566, "answer_id": 28960691, "question_id": 28896626, "link": "https://stackoverflow.com/questions/28896626/tail-recursive-binomial-coefficient-function-in-haskell/28960691#28960691", "title": "Tail recursive binomial coefficient function in Haskell", "body": "<p>An \"automatic\" way to make a function tail recursive is to rewrite it using <a href=\"http://en.wikibooks.org/wiki/Haskell/Continuation_passing_style\" rel=\"nofollow\">continuation passing style</a> (which is by definition tail recursive).\nArguably a straightforward way to do it in Haskell is to convert the original function into monadic form and then use <a href=\"http://en.wikibooks.org/wiki/Haskell/Continuation_passing_style#The_Cont_monad\" rel=\"nofollow\">Cont monad</a> to execute the result:</p>\n\n<pre><code>import Control.Monad.Cont\n\n-- | Original function in monadic form\nbinomM n 0 = return 1\nbinomM 0 k = return 0\nbinomM n k = do\n  b1 &lt;- binomM (n-1) (k-1)\n  return $! b1 * n `div` k\n\n-- | Tail recursive mode of execution\nbinom :: Int -&gt; Int -&gt; Int\nbinom n k = binomM n k `runCont` id\n</code></pre>\n\n<p>Note: This way many monadic functions can be converted into tail recursive ones simply by adding <a href=\"https://hackage.haskell.org/package/transformers-0.4.3.0/docs/Control-Monad-Trans-Cont.html#g:3\" rel=\"nofollow\">ContT transformer</a> to their monadic stack.</p>\n"}], "owner": {"reputation": 577, "user_id": 2246018, "user_type": "registered", "accept_rate": 80, "profile_image": "https://www.gravatar.com/avatar/6a404014d03f162c3fd94e937f294917?s=128&d=identicon&r=PG&f=1", "display_name": "Green Fireman", "link": "https://stackoverflow.com/users/2246018/green-fireman"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 2899, "favorite_count": 2, "accepted_answer_id": 28896925, "answer_count": 3, "score": 3, "last_activity_date": 1487529553, "creation_date": 1425636931, "question_id": 28896626, "link": "https://stackoverflow.com/questions/28896626/tail-recursive-binomial-coefficient-function-in-haskell", "title": "Tail recursive binomial coefficient function in Haskell", "body": "<p>I have a function that calculates the binomial coefficient in Haskell, it looks like this:</p>\n\n<pre><code>binom :: Int -&gt; Int -&gt; Int\nbinom n 0 = 1\nbinom 0 k = 0\nbinom n k = binom (n-1) (k-1) * n `div` k\n</code></pre>\n\n<p>Is it possible to modify it and make it tail recursive?</p>\n"}, {"tags": ["haskell", "functional-programming"], "comments": [{"owner": {"reputation": 44013, "user_id": 1477667, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/trgKM.jpg?s=128&g=1", "display_name": "dfeuer", "link": "https://stackoverflow.com/users/1477667/dfeuer"}, "edited": false, "score": 0, "creation_date": 1425630039, "post_id": 28894252, "comment_id": 46049433, "body": "What&#39;s supposed to happen if some nodes are nothing? Clarify!"}, {"owner": {"reputation": 1387, "user_id": 4616611, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/90099c6ce97d206fcac50806bf8c74da?s=128&d=identicon&r=PG&f=1", "display_name": "Teodorico Levoff", "link": "https://stackoverflow.com/users/4616611/teodorico-levoff"}, "reply_to_user": {"reputation": 44013, "user_id": 1477667, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/trgKM.jpg?s=128&g=1", "display_name": "dfeuer", "link": "https://stackoverflow.com/users/1477667/dfeuer"}, "edited": false, "score": 0, "creation_date": 1425630369, "post_id": 28894252, "comment_id": 46049588, "body": "Ah forget to mention, I edited the question above. It just ignores the nothing values."}, {"owner": {"reputation": 44013, "user_id": 1477667, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/trgKM.jpg?s=128&g=1", "display_name": "dfeuer", "link": "https://stackoverflow.com/users/1477667/dfeuer"}, "edited": false, "score": 3, "creation_date": 1425631847, "post_id": 28894252, "comment_id": 46050308, "body": "The fact that a tree of nothings is treated one way and an empty tree another way feels rather awkward. I think those really should both be 0."}], "answers": [{"comments": [{"owner": {"reputation": 23444, "user_id": 414413, "user_type": "registered", "accept_rate": 79, "profile_image": "https://www.gravatar.com/avatar/6de2113f01432aa844dc85070ff33e89?s=128&d=identicon&r=PG", "display_name": "Cirdec", "link": "https://stackoverflow.com/users/414413/cirdec"}, "edited": false, "score": 5, "creation_date": 1425632595, "post_id": 28894675, "comment_id": 46050646, "body": "The <code>Foldable</code> instance can be derived automatically by GHC with <a href=\"https://downloads.haskell.org/~ghc/7.6.3/docs/html/users_guide/deriving.html\" rel=\"nofollow noreferrer\"><code>DeriveFoldable</code></a>(Section 7.5.3)."}], "tags": [], "owner": {"reputation": 23895, "user_id": 472416, "user_type": "registered", "accept_rate": 79, "profile_image": "https://www.gravatar.com/avatar/aa78d79fb4238d200e26fb87e3de947b?s=128&d=identicon&r=PG", "display_name": "utdemir", "link": "https://stackoverflow.com/users/472416/utdemir"}, "is_accepted": false, "score": 6, "last_activity_date": 1425629880, "last_edit_date": 1592644375, "creation_date": 1425629880, "answer_id": 28894675, "question_id": 28894252, "link": "https://stackoverflow.com/questions/28894252/haskell-sum-values-in-a-tree/28894675#28894675", "title": "Haskell - Sum values in a tree", "body": "<p>You can make your Tree a <a href=\"http://hackage.haskell.org/package/base-4.7.0.2/docs/Data-Foldable.html\" rel=\"noreferrer\"><code>Foldable</code></a> instance, and you get many functions for free, including <code>sum</code>:</p>\n<blockquote>\n<p>sum :: (Foldable t, Num a) =&gt; t a -&gt; a Source</p>\n<p>The sum function computes the sum of the numbers of a structure.</p>\n</blockquote>\n<p>But you need to make your <code>Tree</code> a parametric type:</p>\n<pre><code>data Tree a = Empty | Node (Maybe a) Tree Tree\n</code></pre>\n<p>Also, with GHC 7.10, almost all Prelude functions will use <code>Foldable</code> and <code>Traversable</code> typeclasses instead of lists, and then you can use them freely for your tree, if you implement those typeclasses.</p>\n"}, {"tags": [], "owner": {"reputation": 23444, "user_id": 414413, "user_type": "registered", "accept_rate": 79, "profile_image": "https://www.gravatar.com/avatar/6de2113f01432aa844dc85070ff33e89?s=128&d=identicon&r=PG", "display_name": "Cirdec", "link": "https://stackoverflow.com/users/414413/cirdec"}, "is_accepted": false, "score": 4, "last_activity_date": 1425629887, "creation_date": 1425629887, "answer_id": 28894678, "question_id": 28894252, "link": "https://stackoverflow.com/questions/28894252/haskell-sum-values-in-a-tree/28894678#28894678", "title": "Haskell - Sum values in a tree", "body": "<p>Here's a hint:</p>\n\n<pre><code>data Tree a = Empty | Node a (Tree a) (Tree a)\n\nreduce :: (a -&gt; r -&gt; r -&gt; r) -&gt; r -&gt; Tree a -&gt; r\nreduce f z = go\n    where\n        go Empty        = z\n        go (Node x l r) = f x (go l) (go r)\n</code></pre>\n"}, {"comments": [{"owner": {"reputation": 23444, "user_id": 414413, "user_type": "registered", "accept_rate": 79, "profile_image": "https://www.gravatar.com/avatar/6de2113f01432aa844dc85070ff33e89?s=128&d=identicon&r=PG", "display_name": "Cirdec", "link": "https://stackoverflow.com/users/414413/cirdec"}, "edited": false, "score": 0, "creation_date": 1425631566, "post_id": 28894876, "comment_id": 46050152, "body": "In terms of my <a href=\"http://stackoverflow.com/a/28894678/414413\">hint</a>, <code>toList = reduce (\\x l r -&gt; maybeToList x ++ l ++ r) []</code>."}, {"owner": {"reputation": 94713, "user_id": 1139697, "user_type": "registered", "accept_rate": 86, "profile_image": "https://www.gravatar.com/avatar/5f136ddb684f39aaee1c028ee1950f6f?s=128&d=identicon&r=PG", "display_name": "Zeta", "link": "https://stackoverflow.com/users/1139697/zeta"}, "reply_to_user": {"reputation": 23444, "user_id": 414413, "user_type": "registered", "accept_rate": 79, "profile_image": "https://www.gravatar.com/avatar/6de2113f01432aa844dc85070ff33e89?s=128&d=identicon&r=PG", "display_name": "Cirdec", "link": "https://stackoverflow.com/users/414413/cirdec"}, "edited": false, "score": 0, "creation_date": 1425631843, "post_id": 28894876, "comment_id": 46050305, "body": "@Cirdec: Yep. Didn&#39;t see your answer. Thanks for the comment, otherwise I would have written a completely fledged <code>instance Foldable =&gt; TreeF</code> tutorial \u2013 again."}, {"owner": {"reputation": 1387, "user_id": 4616611, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/90099c6ce97d206fcac50806bf8c74da?s=128&d=identicon&r=PG&f=1", "display_name": "Teodorico Levoff", "link": "https://stackoverflow.com/users/4616611/teodorico-levoff"}, "edited": false, "score": 0, "creation_date": 1425698013, "post_id": 28894876, "comment_id": 46080768, "body": "I want to simply make a call to toList, and then sumTree, in my main function. How do I nest the functions calls nicely, like                           treeValues :: Tree -&gt; Maybe Integer                                                                             treeValues = I want to call toList and sumTree together in a elegant way, first calling toList then sumTree?"}], "tags": [], "owner": {"reputation": 94713, "user_id": 1139697, "user_type": "registered", "accept_rate": 86, "profile_image": "https://www.gravatar.com/avatar/5f136ddb684f39aaee1c028ee1950f6f?s=128&d=identicon&r=PG", "display_name": "Zeta", "link": "https://stackoverflow.com/users/1139697/zeta"}, "is_accepted": true, "score": 5, "last_activity_date": 1425631610, "last_edit_date": 1425631610, "creation_date": 1425630652, "answer_id": 28894876, "question_id": 28894252, "link": "https://stackoverflow.com/questions/28894252/haskell-sum-values-in-a-tree/28894876#28894876", "title": "Haskell - Sum values in a tree", "body": "<p>You already know how to sum lists, so you could transform your tree into a list first:</p>\n\n<pre><code>&gt; toList :: Tree -&gt; [Integer]\n&gt; toList Empty        = []\n&gt; toList (Node a l r) = maybeToList a ++ toList l ++ toList r\n&gt;   where maybeToList (Just x) = [x]\n&gt;         maybeToList Nothing  = []\n</code></pre>\n\n<p>Now, you want to differ between an empty tree (<code>Empty</code>) and a tree that contains only <code>Nothing</code>. Since <code>toList</code> filters all <code>Nothing</code> values, this boils down to</p>\n\n<pre><code>&gt; sumTree :: Tree -&gt; Maybe Integer\n&gt; sumTree Empty = Just 0\n&gt; sumTree tree  = case toList tree of\n&gt;                  [] -&gt; Nothing      -- all values in the tree are Nothing\n&gt;                  xs -&gt; Just $ sum xs       -- some were Just x\n</code></pre>\n\n<h2>But wait, there's more!</h2>\n\n<p><code>sumTree</code> isn't that nice yet. What if we want to compute the product of a <code>Tree</code>? Hm. Well, we can take a tree, transform it to a list, and use\u2026 a folding function!</p>\n\n<pre><code>&gt; type I = Integer -- otherwise the lines get ridiculously long\n&gt;\n&gt; foldrTree' :: (I -&gt; I -&gt; I) -&gt; I -&gt; Tree -&gt; Maybe I\n&gt; foldrTree' _ init Empty = init\n&gt; foldrTree' f init tree  = case toList tree of\n&gt;                            [] -&gt; Nothing\n&gt;                            xs -&gt; Just $ foldr f init xs\n&gt; --                                      ^^^^^\n</code></pre>\n\n<p>Now we can take any <code>(Integer -&gt; Integer -&gt; Integer)</code> and produce a single value, as long as our operation is associative:</p>\n\n<pre><code>&gt; productTree :: Tree -&gt; Maybe Integer\n&gt; productTree = foldrTree' (*) 1\n&gt;\n&gt; sumTree' :: Tree -&gt; Maybe Integer\n&gt; sumTree' = foldrTree' (+) 0\n</code></pre>\n"}, {"tags": [], "owner": {"reputation": 309, "user_id": 3320256, "user_type": "registered", "accept_rate": 75, "profile_image": "https://i.stack.imgur.com/NZCl4.png?s=128&g=1", "display_name": "daniel.kahlenberg", "link": "https://stackoverflow.com/users/3320256/daniel-kahlenberg"}, "is_accepted": false, "score": 2, "last_activity_date": 1425635985, "creation_date": 1425635985, "answer_id": 28896340, "question_id": 28894252, "link": "https://stackoverflow.com/questions/28894252/haskell-sum-values-in-a-tree/28896340#28896340", "title": "Haskell - Sum values in a tree", "body": "<p>Regarding the above solutions and comments plus <a href=\"http://learnyouahaskell.com/zippers\" rel=\"nofollow\">lyah</a> and <a href=\"https://byorgey.wordpress.com/2010/03/03/deriving-pleasure-from-ghc-6-12-1/\" rel=\"nofollow\">Brent Yorgeys advice</a> I compiled the following proposal (try as you might like in <code>ghci</code>):</p>\n\n<pre><code>:set -XDeriveFoldable -XDeriveFunctor\n:m + Data.Foldable Data.Monoid\ndata Tree a = Empty | Node (Maybe a) (Tree a) (Tree a) deriving (Show, Functor, Foldable)\nlet tree :: Tree Integer ; tree = Node Nothing (Node (Just 42) Empty Empty) (Node Nothing Empty Empty)\nfoldMap Sum tree\n</code></pre>\n\n<p>It though returns only <code>0</code> in both cases only <code>Nothing</code> values given and tree is <code>Empty</code> but I hope it gives a hint later for learners like me.</p>\n"}], "owner": {"reputation": 1387, "user_id": 4616611, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/90099c6ce97d206fcac50806bf8c74da?s=128&d=identicon&r=PG&f=1", "display_name": "Teodorico Levoff", "link": "https://stackoverflow.com/users/4616611/teodorico-levoff"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 2757, "favorite_count": 2, "accepted_answer_id": 28894876, "answer_count": 4, "score": 1, "last_activity_date": 1425635985, "creation_date": 1425628065, "last_edit_date": 1425630324, "question_id": 28894252, "link": "https://stackoverflow.com/questions/28894252/haskell-sum-values-in-a-tree", "title": "Haskell - Sum values in a tree", "body": "<p>My tree looks like this, a tree which at each node can or cannot have an integer:</p>\n\n<pre><code>data Tree = Empty | Node (Maybe Integer) Tree Tree deriving Show\n</code></pre>\n\n<p>I want to sum all the values in the tree, not including Nothing values and if tree is not empty but has only Nothing values, just return Nothing, or empty tree is 0. These cases I understand how to.</p>\n\n<p>I want thinking depth first traversal would be best, or just some basic traversal in general, but struggling on how to implement it elegantly. </p>\n\n<p>treeValues :: Tree -> Maybe Integer</p>\n"}, {"tags": ["haskell", "instance", "gchi"], "answers": [{"tags": [], "owner": {"reputation": 13807, "user_id": 2407038, "user_type": "registered", "accept_rate": 64, "profile_image": "https://www.gravatar.com/avatar/538f6f4a9aa43841841de7d8e8b169fc?s=128&d=identicon&r=PG&f=1", "display_name": "user2407038", "link": "https://stackoverflow.com/users/2407038/user2407038"}, "is_accepted": false, "score": 3, "last_activity_date": 1425620759, "creation_date": 1425620759, "answer_id": 28893031, "question_id": 28892910, "link": "https://stackoverflow.com/questions/28892910/ghci-unexpected-behavior-instance-of-class/28893031#28893031", "title": "ghci unexpected behavior instance of class", "body": "<p>To see what is really happening:</p>\n\n<pre><code>[1 of 1] Compiling JSONModule       ( test.hs, interpreted )\nOk, modules loaded: JSONModule.\n&gt;:set -Wall\n&gt;:t fromJValue (toJValue False)\nfromJValue (toJValue False) :: JSON a =&gt; Either String a\n&gt; fromJValue (toJValue False)\n\n&lt;interactive&gt;:6:2: Warning:\n    Defaulting the following constraint(s) to type `Double'\n      (JSON a0) arising from a use of `it' at &lt;interactive&gt;:6:2-28\n      (Show a0) arising from a use of `print' at &lt;interactive&gt;:6:2-28\n    In the first argument of `print', namely `it'\n    In a stmt of an interactive GHCi command: print it\nLeft \"not a JSON number\"\n</code></pre>\n\n<p>As you can see, ghc defaults the ambiguous type variable to Double. The reason that it gives the ambiguous type error when there is no instance for Double is because the default behavior is to only default constraints to Integer or Double, because these are the cases that have been found to be most useful (or common). <a href=\"https://www.haskell.org/onlinereport/decls.html#sect4.3.4\" rel=\"nofollow\">More info on defaulting.</a></p>\n"}, {"tags": [], "owner": {"reputation": 17809, "user_id": 1088108, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/63781cd38e91aa346a3849bc3ef3e550?s=128&d=identicon&r=PG&f=1", "display_name": "&#216;rjan Johansen", "link": "https://stackoverflow.com/users/1088108/%c3%98rjan-johansen"}, "is_accepted": true, "score": 4, "last_activity_date": 1425621263, "creation_date": 1425621263, "answer_id": 28893094, "question_id": 28892910, "link": "https://stackoverflow.com/questions/28892910/ghci-unexpected-behavior-instance-of-class/28893094#28893094", "title": "ghci unexpected behavior instance of class", "body": "<p>This is not a bug, but a result of the <a href=\"https://downloads.haskell.org/~ghc/latest/docs/html/users_guide/interactive-evaluation.html#extended-default-rules\" rel=\"nofollow\"><code>ExtendedDefaultRules</code> extension</a>, which is enabled by default at the GHCi prompt, but not in files.</p>\n\n<p>Approximately, when a type is otherwise ambiguous and has class constraints of the right form, GHC with this extension will try defaulting it to the first type which fits from <code>(), Integer, Double</code>.</p>\n\n<p>Without the <code>ExtendedDefaultRules</code> extension, such as in module files by default, defaulting can still happen, but the requirements are stricter (at least one numeric class must be involved, and <code>()</code> isn't tried) and will only apply to a fixed set of classes, not any you define yourself.</p>\n"}], "owner": {"reputation": 165, "user_id": 4485049, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/626f8645e9e35a2ad579b6dcf716e77d?s=128&d=identicon&r=PG&f=1", "display_name": "peter a g", "link": "https://stackoverflow.com/users/4485049/peter-a-g"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 69, "favorite_count": 0, "accepted_answer_id": 28893094, "answer_count": 2, "score": 2, "last_activity_date": 1425621263, "creation_date": 1425619990, "question_id": 28892910, "link": "https://stackoverflow.com/questions/28892910/ghci-unexpected-behavior-instance-of-class", "title": "ghci unexpected behavior instance of class", "body": "<p>I've been going through Bryan O'Sullivan's and co's  \"Real World Haskell,\" and came across what I would call unexpected 'laxness' on the part of GHCi, version 7.8.3, under Windows. \nI \":loaded\" the following -</p>\n\n<pre><code>module JSONModule   where\n\ndata JValue = JNumber Double\n           | JBool Bool\n             deriving ( Show, Eq, Ord )\n\n\nclass JSON a where\n  toJValue :: a -&gt; JValue\n  fromJValue :: JValue -&gt; Either String  a\n\n\nfromJBool (JBool b) = Right b\nfromJBool _ = Left \"not a JSON boolean\"\n\ninstance JSON Double where\n  toJValue = JNumber\n  fromJValue = doubleToJValue id\n\ninstance JSON Bool where\n  toJValue = JBool\n  fromJValue = fromJBool\n\ndoubleToJValue :: (Double -&gt; a) -&gt; JValue -&gt; Either String a\ndoubleToJValue f (JNumber v) = Right (f v)\ndoubleToJValue _ _ = Left \"not a JSON number\"\n</code></pre>\n\n<p>Then, in ghci :</p>\n\n<pre><code>*JSONModule&gt; :r\n[1 of 1] Compiling JSONModule       ( JSONModule.hs, interpreted )\nOk, modules loaded: JSONModule.\n*JSONModule&gt; toJValue False\nJBool False\n*JSONModule&gt; fromJValue it\nLeft \"not a JSON number\"\n</code></pre>\n\n<p>While this is true, it is not what would have expected. I think ghci should have told me to fly a kite, as there were 2 instances for fromJValue.\nIndeed, if I specify </p>\n\n<pre><code>fromJValue it :: Either String Bool\n</code></pre>\n\n<p>I get Right False. The issue seems to be doubleToJValue. Eliminating the JSON Double instance, and adding a JChar Char constructor to JValue, and a  corresponding instance of JSON Char, I get the expected 'ambiguous' response from ghci.\nSo I think there is a bug.\nComments? Thanks...</p>\n"}, {"tags": ["haskell", "compilation", "cabal", "ghci"], "comments": [{"owner": {"reputation": 51584, "user_id": 839246, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/9b0573c2b936b12828dd1e4cc04206dc?s=128&d=identicon&r=PG&f=1", "display_name": "bheklilr", "link": "https://stackoverflow.com/users/839246/bheklilr"}, "edited": false, "score": 5, "creation_date": 1425616816, "post_id": 28892191, "comment_id": 46045463, "body": "Can you post the full code that is causing this error?"}, {"owner": {"reputation": 17809, "user_id": 1088108, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/63781cd38e91aa346a3849bc3ef3e550?s=128&d=identicon&r=PG&f=1", "display_name": "&#216;rjan Johansen", "link": "https://stackoverflow.com/users/1088108/%c3%98rjan-johansen"}, "edited": false, "score": 0, "creation_date": 1425656236, "post_id": 28892191, "comment_id": 46063707, "body": "My guess, which wouldn&#39;t be visible from just the code, is that you have two versions of <code>transformers</code> installed: A newer one that is loaded directly by GHCi and an older one that is used by some other package you have installed. Then <code>MonadTrans</code> from one gets mixed with <code>EitherT</code> from the other, which it knows nothing about. <code>cabal</code> makes sure to use one consistent version."}, {"owner": {"reputation": 89, "user_id": 2755310, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/cc44bffba313ed4e66549e858c81a613?s=128&d=identicon&r=PG", "display_name": "brettwines", "link": "https://stackoverflow.com/users/2755310/brettwines"}, "reply_to_user": {"reputation": 17809, "user_id": 1088108, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/63781cd38e91aa346a3849bc3ef3e550?s=128&d=identicon&r=PG&f=1", "display_name": "&#216;rjan Johansen", "link": "https://stackoverflow.com/users/1088108/%c3%98rjan-johansen"}, "edited": false, "score": 0, "creation_date": 1425684415, "post_id": 28892191, "comment_id": 46077976, "body": "@&#216;rjan-johansen, that sounds pretty likely -- it was working and then stopped and I feel like I ran a <code>cabal</code> install in the middle or something... I tried <code>ghc-pkg unregister</code> on <code>transformers</code> (and maybe <code>mtl</code>?) and re-installed it but it didn&#39;t fix it. Any idea how else to test if your hypothesis is correct?  Thanks so much! :)"}, {"owner": {"reputation": 17809, "user_id": 1088108, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/63781cd38e91aa346a3849bc3ef3e550?s=128&d=identicon&r=PG&f=1", "display_name": "&#216;rjan Johansen", "link": "https://stackoverflow.com/users/1088108/%c3%98rjan-johansen"}, "edited": false, "score": 0, "creation_date": 1425689349, "post_id": 28892191, "comment_id": 46079242, "body": "Eek, I&#39;m not sure unregistering <code>transformers</code>/<code>mtl</code> is wise, you may break other packages that come with GHC and that <i>need</i> a particular version. To check if there are two versions installed, use <code>ghc-pkg list ...</code>. And you can give GHCi a <code>-package</code> flag (or use <code>:set</code>) to force a version to be used, but I suspect that won&#39;t work if it&#39;s implicitly used by two other packages. Also, everyone seems to be recommending cabal sandboxes these days (I&#39;m a bit behind on that...)"}, {"owner": {"reputation": 89, "user_id": 2755310, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/cc44bffba313ed4e66549e858c81a613?s=128&d=identicon&r=PG", "display_name": "brettwines", "link": "https://stackoverflow.com/users/2755310/brettwines"}, "reply_to_user": {"reputation": 17809, "user_id": 1088108, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/63781cd38e91aa346a3849bc3ef3e550?s=128&d=identicon&r=PG&f=1", "display_name": "&#216;rjan Johansen", "link": "https://stackoverflow.com/users/1088108/%c3%98rjan-johansen"}, "edited": false, "score": 0, "creation_date": 1426059569, "post_id": 28892191, "comment_id": 46211635, "body": "@&#216;rjanJohansen - Aw, shoot; I was so hopeful about that one. Yeah; there&#39;s only one instance of <code>transformers</code> / <code>mtl</code> installed. Probably should&#39;ve done a cabal sandbox right from the start."}, {"owner": {"reputation": 89, "user_id": 2755310, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/cc44bffba313ed4e66549e858c81a613?s=128&d=identicon&r=PG", "display_name": "brettwines", "link": "https://stackoverflow.com/users/2755310/brettwines"}, "reply_to_user": {"reputation": 17809, "user_id": 1088108, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/63781cd38e91aa346a3849bc3ef3e550?s=128&d=identicon&r=PG&f=1", "display_name": "&#216;rjan Johansen", "link": "https://stackoverflow.com/users/1088108/%c3%98rjan-johansen"}, "edited": false, "score": 0, "creation_date": 1426062418, "post_id": 28892191, "comment_id": 46212779, "body": "Son of a gun. @&#216;rjanJohansen, you were right -- I did have two different versions installed, but I didn&#39;t see it in <code>ghc-pkg list</code> because I didn&#39;t scroll up enough; there are two sets of packages; one in <code>&#47;Library&#47;Frameworks&#47;GHC.framework&#47;Versions&#47;7.8.3-x86_64&#47;usr&#47;&zwnj;&#8203;lib&#47;ghc-7.8.3&#47;packag&zwnj;&#8203;e.conf.d</code> and one in <code>~&#47;.ghc&#47;x86_64-darwin-7.8.3&#47;package.conf.d</code>. Why, I have no idea :P  The fix was to initialize a sandbox and run <code>cabal install --only-dependencies</code>.  <i>phew</i>; this was quite a thing to track down..."}, {"owner": {"reputation": 89, "user_id": 2755310, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/cc44bffba313ed4e66549e858c81a613?s=128&d=identicon&r=PG", "display_name": "brettwines", "link": "https://stackoverflow.com/users/2755310/brettwines"}, "reply_to_user": {"reputation": 17809, "user_id": 1088108, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/63781cd38e91aa346a3849bc3ef3e550?s=128&d=identicon&r=PG&f=1", "display_name": "&#216;rjan Johansen", "link": "https://stackoverflow.com/users/1088108/%c3%98rjan-johansen"}, "edited": false, "score": 0, "creation_date": 1426062467, "post_id": 28892191, "comment_id": 46212800, "body": "@&#216;rjanJohansen, post what you said above about two different versions being installed if you&#39;d like and I&#39;ll mark it as the accepted answer ;)"}, {"owner": {"reputation": 17809, "user_id": 1088108, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/63781cd38e91aa346a3849bc3ef3e550?s=128&d=identicon&r=PG&f=1", "display_name": "&#216;rjan Johansen", "link": "https://stackoverflow.com/users/1088108/%c3%98rjan-johansen"}, "edited": false, "score": 0, "creation_date": 1426092805, "post_id": 28892191, "comment_id": 46233362, "body": "I just had a slightly embarassing realization: <code>EitherT</code> is defined in the <code>either</code> package, not <code>transformers</code>. (That makes like <i>3</i> differently named slight variations of that type I know about, although to be fair <code>ErrorT</code> is deprecated.) The rest seems to be correct so I&#39;ll clean it up a bit and make it an answer."}, {"owner": {"reputation": 44013, "user_id": 1477667, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/trgKM.jpg?s=128&g=1", "display_name": "dfeuer", "link": "https://stackoverflow.com/users/1477667/dfeuer"}, "reply_to_user": {"reputation": 17809, "user_id": 1088108, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/63781cd38e91aa346a3849bc3ef3e550?s=128&d=identicon&r=PG&f=1", "display_name": "&#216;rjan Johansen", "link": "https://stackoverflow.com/users/1088108/%c3%98rjan-johansen"}, "edited": false, "score": 0, "creation_date": 1426093927, "post_id": 28892191, "comment_id": 46234144, "body": "@&#216;rjanJohansen, indeed, it appears that the main difference between <code>EitherT</code> and <code>ExceptT</code> is that <code>EitherT</code> uses GHC extensions (notably <code>FlexibleContexts</code>, but maybe others) to produce instances with weaker constraints."}], "answers": [{"tags": [], "owner": {"reputation": 17809, "user_id": 1088108, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/63781cd38e91aa346a3849bc3ef3e550?s=128&d=identicon&r=PG&f=1", "display_name": "&#216;rjan Johansen", "link": "https://stackoverflow.com/users/1088108/%c3%98rjan-johansen"}, "is_accepted": true, "score": 1, "last_activity_date": 1426092978, "creation_date": 1426092978, "answer_id": 28992732, "question_id": 28892191, "link": "https://stackoverflow.com/questions/28892191/ghci-wont-interpret-file-but-cabal-build-succeeds/28992732#28992732", "title": "ghci won&#39;t interpret file but cabal build succeeds?", "body": "<p>My guess, which wouldn't be visible from just the code, is that you have two versions of <code>transformers</code> installed: A newer one that is loaded directly by GHCi and an older one that is used by the installed <code>either</code> package. Or possibly even more packages are involved through indirect dependencies.</p>\n\n<p>Then <code>MonadTrans</code> from one gets mixed with <code>EitherT</code> from the other, which knows nothing about it.</p>\n\n<p><code>cabal</code>, on the other hand, makes sure to use one consistent version.</p>\n\n<p>To check if there are two versions installed, use</p>\n\n<pre><code>ghc-pkg list transformers\n</code></pre>\n\n<p>You can give GHCi a <code>-package</code> flag (or use <code>:set</code>) to force a version to be used, although that will only affect loaded files, not installed packages.</p>\n\n<p>Also, everyone seems to be recommending <code>cabal</code> sandboxes these days to avoid such problems.</p>\n"}], "owner": {"reputation": 89, "user_id": 2755310, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/cc44bffba313ed4e66549e858c81a613?s=128&d=identicon&r=PG", "display_name": "brettwines", "link": "https://stackoverflow.com/users/2755310/brettwines"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 109, "favorite_count": 0, "accepted_answer_id": 28992732, "answer_count": 1, "score": 1, "last_activity_date": 1426185513, "creation_date": 1425614821, "last_edit_date": 1426185513, "question_id": 28892191, "link": "https://stackoverflow.com/questions/28892191/ghci-wont-interpret-file-but-cabal-build-succeeds", "title": "ghci won&#39;t interpret file but cabal build succeeds?", "body": "<p>When I load a certain file in <code>ghci</code> / <code>cabal repl</code>, I get the following error message:</p>\n\n<pre><code>No instance for (Control.Monad.Trans.Class.MonadTrans\n                   (EitherT Error))\n  arising from a use of \u2018lift\u2019\n</code></pre>\n\n<p>However, <code>EitherT a</code> is definitely an instance of <code>MonadTrans</code>; it's part of the package. <code>cabal build</code> succeeds; too. It seems <code>ghci</code> and <code>cabal repl</code> don't know about <code>EitherT</code> typeclass instances (<code>liftIO</code> produces a similar error) for some reason (but <code>cabal build</code> is happy with it)?</p>\n\n<p>Has anyone encountered anything like this before?</p>\n\n<p>Thanks in advance! :)</p>\n\n<p>EDIT:</p>\n\n<p>Yup; most of the instances are missing:</p>\n\n<pre><code>\u03bb :i EitherT\ntype role EitherT nominal representational nominal\nnewtype EitherT e (m :: * -&gt; *) a\n  = EitherT {runEitherT :: m (Either e a)}\n    -- Defined in \u2018Control.Monad.Trans.Either\u2019\ninstance Eq (m (Either e a)) =&gt; Eq (EitherT e m a)\n  -- Defined in \u2018Control.Monad.Trans.Either\u2019\ninstance Monad m =&gt; Monad (EitherT e m)\n  -- Defined in \u2018Control.Monad.Trans.Either\u2019\ninstance Monad m =&gt; Functor (EitherT e m)\n  -- Defined in \u2018Control.Monad.Trans.Either\u2019\ninstance Ord (m (Either e a)) =&gt; Ord (EitherT e m a)\n  -- Defined in \u2018Control.Monad.Trans.Either\u2019\ninstance Read (m (Either e a)) =&gt; Read (EitherT e m a)\n  -- Defined in \u2018Control.Monad.Trans.Either\u2019\ninstance Show (m (Either e a)) =&gt; Show (EitherT e m a)\n  -- Defined in \u2018Control.Monad.Trans.Either\u2019\n\u03bb\n</code></pre>\n\n<p><em>However</em>, if I run <code>cabal get either</code> to get the source code for the package, and open <em>that</em> in <code>cabal repl</code>, it <em>does</em> have all the instances. So... uh... why doesn't it know about those instances when I import the package instead of loading the source code?</p>\n\n<p>EDIT5:</p>\n\n<p>Ok, this is seriously weird. Running <code>ghci</code> (<em>not</em> <code>cabal repl</code> inside the <code>either-4.3.3.2</code> source directory and then running <code>:l src/Control/Monad/Trans/Either.hs</code> produces missing typeclass instance errors for <code>EitherT</code>, namely <code>MonadTrans</code></p>\n\n<pre><code>\u03bb :l src/Control/Monad/Trans/Either.hs\n[1 of 1] Compiling Control.Monad.Trans.Either ( src/Control/Monad/Trans/Either.hs, interpreted )\n\nsrc/Control/Monad/Trans/Either.hs:287:14:\n    Could not deduce (transformers-0.3.0.0:Control.Monad.Trans.Class.MonadTrans\n                        (EitherT e))\n</code></pre>\n"}, {"tags": ["haskell", "parsec"], "comments": [{"owner": {"reputation": 13807, "user_id": 2407038, "user_type": "registered", "accept_rate": 64, "profile_image": "https://www.gravatar.com/avatar/538f6f4a9aa43841841de7d8e8b169fc?s=128&d=identicon&r=PG&f=1", "display_name": "user2407038", "link": "https://stackoverflow.com/users/2407038/user2407038"}, "edited": false, "score": 2, "creation_date": 1425621141, "post_id": 28892104, "comment_id": 46046498, "body": "I&#39;m guessing trimParser is supposed to parse any string, including strings containing spaces, ignoring trailing and leading whitespace. If so, the simplest way is really just to &quot;parse&quot; the string unconditionally and then apply the trim function to the result; <code>trim &lt;$&gt; many anyChar</code>."}, {"owner": {"reputation": 44013, "user_id": 1477667, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/trgKM.jpg?s=128&g=1", "display_name": "dfeuer", "link": "https://stackoverflow.com/users/1477667/dfeuer"}, "edited": false, "score": 2, "creation_date": 1425621336, "post_id": 28892104, "comment_id": 46046550, "body": "It is indeed generally a very very good idea to say what it is that your code is supposed to do, instead of just dumping it on the table."}], "answers": [{"comments": [{"owner": {"reputation": 2875, "user_id": 2299477, "user_type": "registered", "accept_rate": 31, "profile_image": "https://i.stack.imgur.com/xppB7.jpg?s=128&g=1", "display_name": "Alaya", "link": "https://stackoverflow.com/users/2299477/alaya"}, "edited": false, "score": 0, "creation_date": 1425626968, "post_id": 28893174, "comment_id": 46048258, "body": "I know how to trim from both side, I just wonder how to implement trim using <code>Parsec</code>."}, {"owner": {"reputation": 2152, "user_id": 1103600, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/7830fb399137c319ff68dca3e3b6f7e2?s=128&d=identicon&r=PG", "display_name": "Arnon", "link": "https://stackoverflow.com/users/1103600/arnon"}, "edited": false, "score": 0, "creation_date": 1425632454, "post_id": 28893174, "comment_id": 46050578, "body": "That sounds like you&#39;re going to misuse Parsec. Is there a specific reason why would you want to trim using Parsec?"}, {"owner": {"reputation": 18999, "user_id": 825637, "user_type": "registered", "accept_rate": 85, "profile_image": "https://www.gravatar.com/avatar/825a58fde1ef99db42c5354dab6cd472?s=128&d=identicon&r=PG", "display_name": "MasterMastic", "link": "https://stackoverflow.com/users/825637/mastermastic"}, "reply_to_user": {"reputation": 2152, "user_id": 1103600, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/7830fb399137c319ff68dca3e3b6f7e2?s=128&d=identicon&r=PG", "display_name": "Arnon", "link": "https://stackoverflow.com/users/1103600/arnon"}, "edited": false, "score": 0, "creation_date": 1475330268, "post_id": 28893174, "comment_id": 66906226, "body": "@Arnon First line of his question: &quot;I am learning <code>Parsec</code> and want to practice it by implementing function <code>trim</code>.&quot;"}], "tags": [], "owner": {"reputation": 44013, "user_id": 1477667, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/trgKM.jpg?s=128&g=1", "display_name": "dfeuer", "link": "https://stackoverflow.com/users/1477667/dfeuer"}, "is_accepted": false, "score": 2, "last_activity_date": 1425621747, "creation_date": 1425621747, "answer_id": 28893174, "question_id": 28892104, "link": "https://stackoverflow.com/questions/28892104/how-to-implement-function-trim-using-parsec-in-haskell/28893174#28893174", "title": "How to implement function trim using Parsec in haskell?", "body": "<p>To trim the spaces from both sides of a string:</p>\n\n<pre><code>trim :: String -&gt; String\ntrim = dropWhileEnd isSpace . dropWhile isSpace\n</code></pre>\n\n<p>Note that you may be better off using the following implementation of <code>dropWhileEnd</code> instead of the one from <code>Data.List</code>, depending on the situation:</p>\n\n<pre><code>dropWhileEnd :: (a -&gt; Bool) -&gt; [a] -&gt; [a]\ndropWhileEnd p = foldr\n  (\\x xs -&gt; if null xs &amp;&amp; p x then [] else x : xs) []\n</code></pre>\n"}], "owner": {"reputation": 2875, "user_id": 2299477, "user_type": "registered", "accept_rate": 31, "profile_image": "https://i.stack.imgur.com/xppB7.jpg?s=128&g=1", "display_name": "Alaya", "link": "https://stackoverflow.com/users/2299477/alaya"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 387, "favorite_count": 1, "answer_count": 1, "score": 2, "last_activity_date": 1425621747, "creation_date": 1425614200, "question_id": 28892104, "link": "https://stackoverflow.com/questions/28892104/how-to-implement-function-trim-using-parsec-in-haskell", "title": "How to implement function trim using Parsec in haskell?", "body": "<p>I am learning <code>Parsec</code> and want to practice it by implementing function <code>trim</code>. Here is my code:</p>\n\n<pre><code>module Trim where\nimport Text.ParserCombinators.Parsec hiding(spaces)\ntrim = reverse.trimFront.reverse.trimFront\ntrimFront :: String-&gt;String\ntrimFront = readExpr trimParser\nreadExpr :: Parser String-&gt;String-&gt;String\nreadExpr parser input = case parse parser \"trim\" input of\n                             Left err -&gt; error $ show err\n                             Right val -&gt; val\nspaces = many space\ntrimParser :: Parser String\ntrimParser = spaces &gt;&gt; many anyChar\n</code></pre>\n\n<p>my question is, How could I implement <code>trim</code> in function <code>trimParser</code>  directly without having to implement <code>trimFront</code> first?</p>\n"}, {"tags": ["haskell"], "comments": [{"owner": {"reputation": 1089, "user_id": 3681109, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/d676ca6572e75e842ca0fa3e9e82d1bb?s=128&d=identicon&r=PG&f=1", "display_name": "genisage", "link": "https://stackoverflow.com/users/3681109/genisage"}, "edited": false, "score": 3, "creation_date": 1425603553, "post_id": 28890617, "comment_id": 46042297, "body": "You probably want something like <code>f p xs = let (as, (b:bs)) = span p xs in as ++ bs</code>, possibly with some logic to handle the cases where no element matches the predicate and where the last element is the first to match."}, {"owner": {"reputation": 13807, "user_id": 2407038, "user_type": "registered", "accept_rate": 64, "profile_image": "https://www.gravatar.com/avatar/538f6f4a9aa43841841de7d8e8b169fc?s=128&d=identicon&r=PG&f=1", "display_name": "user2407038", "link": "https://stackoverflow.com/users/2407038/user2407038"}, "edited": false, "score": 6, "creation_date": 1425604581, "post_id": 28890617, "comment_id": 46042622, "body": "<code>filterFirst p (x:xs) = if p x then x : filterFirst p xs else xs</code>"}, {"owner": {"reputation": 44013, "user_id": 1477667, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/trgKM.jpg?s=128&g=1", "display_name": "dfeuer", "link": "https://stackoverflow.com/users/1477667/dfeuer"}, "reply_to_user": {"reputation": 13807, "user_id": 2407038, "user_type": "registered", "accept_rate": 64, "profile_image": "https://www.gravatar.com/avatar/538f6f4a9aa43841841de7d8e8b169fc?s=128&d=identicon&r=PG&f=1", "display_name": "user2407038", "link": "https://stackoverflow.com/users/2407038/user2407038"}, "edited": false, "score": 0, "creation_date": 1425619061, "post_id": 28890617, "comment_id": 46045987, "body": "@user2407038, why don&#39;t you make that an answer?"}, {"owner": {"reputation": 7204, "user_id": 4333347, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/6b091d5e3973e6f65ec16442c3b1b16b?s=128&d=identicon&r=PG", "display_name": "buydadip", "link": "https://stackoverflow.com/users/4333347/buydadip"}, "reply_to_user": {"reputation": 13807, "user_id": 2407038, "user_type": "registered", "accept_rate": 64, "profile_image": "https://www.gravatar.com/avatar/538f6f4a9aa43841841de7d8e8b169fc?s=128&d=identicon&r=PG&f=1", "display_name": "user2407038", "link": "https://stackoverflow.com/users/2407038/user2407038"}, "edited": false, "score": 0, "creation_date": 1425660451, "post_id": 28890617, "comment_id": 46066436, "body": "@user2407038 I would pick that as best answer"}], "answers": [{"tags": [], "owner": {"reputation": 126897, "user_id": 791604, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/ce991df7a056248d5e4f6fc3659ba733?s=128&d=identicon&r=PG", "display_name": "Daniel Wagner", "link": "https://stackoverflow.com/users/791604/daniel-wagner"}, "is_accepted": false, "score": 4, "last_activity_date": 1425610372, "creation_date": 1425610372, "answer_id": 28891632, "question_id": 28890617, "link": "https://stackoverflow.com/questions/28890617/haskell-filter-first-element/28891632#28891632", "title": "Haskell-filter first element", "body": "<p>You can abuse <code>deleteBy</code> for this.</p>\n\n<pre><code>&gt; deleteBy (&gt;) 1 [5, -6, -7, 9, 10]\n[5,-7,9,10]\n</code></pre>\n\n<p>...and more generally:</p>\n\n<pre><code>filterFirst p = deleteBy (const p) undefined\n</code></pre>\n"}, {"comments": [{"owner": {"reputation": 44013, "user_id": 1477667, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/trgKM.jpg?s=128&g=1", "display_name": "dfeuer", "link": "https://stackoverflow.com/users/1477667/dfeuer"}, "edited": false, "score": 2, "creation_date": 1425670534, "post_id": 28904773, "comment_id": 46071913, "body": "Great answer, but I would write &quot;If <code>p x</code> holds&quot; rather than &quot;If <code>p x == True</code>&quot;. A lot of people get confused and write funny-looking code using <code>==</code> to test <code>Bool</code> values."}], "tags": [], "owner": {"reputation": 370, "user_id": 4557694, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/24e1eefea58ed065620e1b494503c0da?s=128&d=identicon&r=PG", "display_name": "Chad Groft", "link": "https://stackoverflow.com/users/4557694/chad-groft"}, "is_accepted": true, "score": 7, "last_activity_date": 1425680321, "last_edit_date": 1425680321, "creation_date": 1425664617, "answer_id": 28904773, "question_id": 28890617, "link": "https://stackoverflow.com/questions/28890617/haskell-filter-first-element/28904773#28904773", "title": "Haskell-filter first element", "body": "<p>Walk through what your attempt does: <code>[]</code> is sent to <code>[]</code> (this is correct). With a list with at least two elements (<code>x:y:xs</code>), your function tests <code>x</code>, <em>throws out <code>x</code> and <code>y</code></em> and keeps filtering if the test <em>passes</em> (definitely not what you want), and throws out <code>x</code> and stops if the test fails (this is correct). A list with a single element errors out, as will many other lists with an odd number of elements (this is both bad and a clue to the correct answer).</p>\n\n<p>Let's walk through a correct implementation a step at a time. As you wrote, we want <code>filterFirst</code> to take a predicate on <code>a</code> and a list of <code>a</code> and return another list of <code>a</code>:</p>\n\n<pre><code>filterFirst :: (a -&gt; Bool) -&gt; [a] -&gt; [a]\n</code></pre>\n\n<p>The predicate type <code>a -&gt; Bool</code> can't be broken down, but <code>[a]</code> can: there can be empty lists <code>[]</code> and nonempty lists <code>x:xs</code>, and there should be a case for each:</p>\n\n<pre><code>filterFirst p []     = ...\nfilterFirst p (x:xs) = ...\n</code></pre>\n\n<p>In the \"base case\" <code>[]</code>, there's nothing left to filter, so we want this to be <code>[]</code>, which is what you've written. Since <code>p</code> isn't used here, you could replace <code>p</code> in this case with <code>_</code>:</p>\n\n<pre><code>filterFirst _ [] = []\n</code></pre>\n\n<p>but you don't have to.</p>\n\n<p>What we want to do with <code>x:xs</code> depends on the value of <code>p x</code>.  If <code>p x</code> holds, we want a list that starts with <code>x</code>. The tail of this list should be <code>xs</code>, but with the first failing element removed.  If <code>p x</code> fails, we want to throw out <code>x</code> (the first failing element) and keep <code>xs</code> (the list after the first failing element).  So:</p>\n\n<pre><code>filterFirst p (x:xs)\n    | p x       = x:filterFirst p xs\n    | otherwise = xs\n</code></pre>\n\n<p>And that covers all the possibilities, so we're done!</p>\n\n<p><strong>EDIT</strong> per dfeuer's comment.</p>\n"}], "owner": {"reputation": 7204, "user_id": 4333347, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/6b091d5e3973e6f65ec16442c3b1b16b?s=128&d=identicon&r=PG", "display_name": "buydadip", "link": "https://stackoverflow.com/users/4333347/buydadip"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 2709, "favorite_count": 1, "accepted_answer_id": 28904773, "answer_count": 2, "score": 6, "last_activity_date": 1425680321, "creation_date": 1425603210, "question_id": 28890617, "link": "https://stackoverflow.com/questions/28890617/haskell-filter-first-element", "title": "Haskell-filter first element", "body": "<p>I want to remove the first element that does not have a certain property.\nFor example, if my property is defined as...</p>\n\n<pre><code>greaterOne :: Num a=&gt;Ord a=&gt;a-&gt;Bool\ngreaterOne x = x &gt; 1\n</code></pre>\n\n<p>Then the function <code>filterFirst</code> should give me this...</p>\n\n<pre><code>filterFirst greaterOne [5,-6,-7,9,10]\n&gt;&gt; [5,-7,9,10]  //removes first element that is not greater than one\n</code></pre>\n\n<p>This is my attempt...</p>\n\n<pre><code>filterFirst :: (a-&gt;Bool)-&gt;[a]-&gt;[a]\nfilterFirst p [] = []\nfilterFirst p (x:y:xs)\n    |p x = filterFirst p xs\n    |otherwise = y:xs\n</code></pre>\n\n<p>Can someone help me out?</p>\n"}, {"tags": ["haskell", "infix-operator"], "answers": [{"comments": [{"owner": {"reputation": 7193, "user_id": 363663, "user_type": "registered", "accept_rate": 71, "profile_image": "https://www.gravatar.com/avatar/c59cd40f0edcd3feea80c7ca09bc8e76?s=128&d=identicon&r=PG", "display_name": "sof", "link": "https://stackoverflow.com/users/363663/sof"}, "edited": false, "score": 0, "creation_date": 1425602451, "post_id": 28890355, "comment_id": 46041979, "body": "Oh, I was initially confused with <code>LiveScript</code>, where <code>(-1)</code> is number while <code>(- 1)</code> is partial function."}, {"owner": {"reputation": 46235, "user_id": 2541573, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/Z1qtP.png?s=128&g=1", "display_name": "jub0bs", "link": "https://stackoverflow.com/users/2541573/jub0bs"}, "reply_to_user": {"reputation": 7193, "user_id": 363663, "user_type": "registered", "accept_rate": 71, "profile_image": "https://www.gravatar.com/avatar/c59cd40f0edcd3feea80c7ca09bc8e76?s=128&d=identicon&r=PG", "display_name": "sof", "link": "https://stackoverflow.com/users/363663/sof"}, "edited": false, "score": 0, "creation_date": 1425602696, "post_id": 28890355, "comment_id": 46042045, "body": "@sof Whitespace doesn&#39;t matter, in this case."}, {"owner": {"reputation": 7193, "user_id": 363663, "user_type": "registered", "accept_rate": 71, "profile_image": "https://www.gravatar.com/avatar/c59cd40f0edcd3feea80c7ca09bc8e76?s=128&d=identicon&r=PG", "display_name": "sof", "link": "https://stackoverflow.com/users/363663/sof"}, "edited": false, "score": 0, "creation_date": 1425602907, "post_id": 28890355, "comment_id": 46042108, "body": "Yes, I see <code>Haskell</code> is usually whitespace insensitive except for indented code block."}, {"owner": {"reputation": 8313, "user_id": 1648987, "user_type": "registered", "accept_rate": 25, "profile_image": "https://www.gravatar.com/avatar/dcc829df7369ce51e760cbf9f7b7b29b?s=128&d=identicon&r=PG", "display_name": "Karol S", "link": "https://stackoverflow.com/users/1648987/karol-s"}, "edited": false, "score": 0, "creation_date": 1425605364, "post_id": 28890355, "comment_id": 46042811, "body": "Also you could add that <code>(&#47; 2)</code> is <code>\\x-&gt;x&#47;2</code> and <code>((&#47;) 2)</code> is <code>\\x-&gt;2&#47;x</code>"}, {"owner": {"reputation": 46235, "user_id": 2541573, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/Z1qtP.png?s=128&g=1", "display_name": "jub0bs", "link": "https://stackoverflow.com/users/2541573/jub0bs"}, "reply_to_user": {"reputation": 8313, "user_id": 1648987, "user_type": "registered", "accept_rate": 25, "profile_image": "https://www.gravatar.com/avatar/dcc829df7369ce51e760cbf9f7b7b29b?s=128&d=identicon&r=PG", "display_name": "Karol S", "link": "https://stackoverflow.com/users/1648987/karol-s"}, "edited": false, "score": 0, "creation_date": 1425605450, "post_id": 28890355, "comment_id": 46042845, "body": "@KarolS That should be understood based on the first sentence in my answer."}], "tags": [], "owner": {"reputation": 46235, "user_id": 2541573, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/Z1qtP.png?s=128&g=1", "display_name": "jub0bs", "link": "https://stackoverflow.com/users/2541573/jub0bs"}, "is_accepted": true, "score": 7, "last_activity_date": 1425604367, "last_edit_date": 1425604367, "creation_date": 1425601359, "answer_id": 28890355, "question_id": 28890335, "link": "https://stackoverflow.com/questions/28890335/why-is-the-unary-minus-operator-problematic-in-this-expression-2-1/28890355#28890355", "title": "Why is the unary minus operator problematic in this expression: (- 2) 1?", "body": "<p>Each of these parenthesized expressions but <code>(-2)</code> (edit: and <code>((-) 2)</code>) are <em>sections</em>, i.e. functions that take one argument and \"put it on the missing side of the infix operator\" (see this <a href=\"https://wiki.haskell.org/Section_of_an_infix_operator\" rel=\"nofollow\">haskell.org wiki</a>).</p>\n\n<p><code>(-2)</code> is not a <em>function</em>, but a <em>number</em> (negative 2):</p>\n\n<pre><code>\u03bb&gt; :t (-2)\n(-2) :: Num a =&gt; a\n</code></pre>\n\n<p>If you write</p>\n\n<pre><code>\u03bb&gt; (-2) 1\n</code></pre>\n\n<p>it looks like you're trying to apply <code>(-2)</code> (a number) to <code>1</code> (which is not possible), and GHCi rightfully complains:</p>\n\n<pre><code>Could not deduce (Num (a0 -&gt; t))\n  arising from the ambiguity check for \u2018it\u2019\nfrom the context (Num (a -&gt; t), Num a)\n  bound by the inferred type for \u2018it\u2019: (Num (a -&gt; t), Num a) =&gt; t\n  at &lt;interactive&gt;:3:1-6\nThe type variable \u2018a0\u2019 is ambiguous\nWhen checking that \u2018it\u2019\n  has the inferred type \u2018forall a t. (Num (a -&gt; t), Num a) =&gt; t\u2019\nProbable cause: the inferred type is ambiguous\n</code></pre>\n\n<p>If you want a function that subtracts <code>2</code> from another number, you can use</p>\n\n<pre><code>(subtract 2)\n</code></pre>\n\n<p>Compare its type,</p>\n\n<pre><code>\u03bb&gt; :t (subtract 2)\n(subtract 2) :: Num a =&gt; a -&gt; a\n</code></pre>\n\n<p>to that of <code>(-2)</code> (see above).</p>\n\n<hr>\n\n<h3>Terminology addendum (after OP's edit)</h3>\n\n<p>Parenthesizing the minus operator turns it into a normal (prefix) function that takes two arguments; therefore <code>((-) 2)</code> is not a section, but a partially applied function.</p>\n"}], "owner": {"reputation": 7193, "user_id": 363663, "user_type": "registered", "accept_rate": 71, "profile_image": "https://www.gravatar.com/avatar/c59cd40f0edcd3feea80c7ca09bc8e76?s=128&d=identicon&r=PG", "display_name": "sof", "link": "https://stackoverflow.com/users/363663/sof"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 677, "favorite_count": 0, "closed_date": 1425609629, "accepted_answer_id": 28890355, "answer_count": 1, "score": 5, "last_activity_date": 1425604865, "creation_date": 1425601225, "last_edit_date": 1425604865, "question_id": 28890335, "link": "https://stackoverflow.com/questions/28890335/why-is-the-unary-minus-operator-problematic-in-this-expression-2-1", "closed_reason": "Duplicate", "title": "Why is the unary minus operator problematic in this expression: (- 2) 1?", "body": "<p>All of the following expressions get evaluated without mishap:</p>\n\n<pre class=\"lang-hs prettyprint-override\"><code>(+2) 1 -- 3\n(*2) 1 -- 2\n((-)2) 1 -- 1\n(2-) 1 -- 1   \n(/2) 1 -- 0.5\n(2/) 1 -- 2.0\n</code></pre>\n\n<p>but not this one:</p>\n\n<pre class=\"lang-hs prettyprint-override\"><code>(-2) 1 -- the inferred type is ambiguous\n</code></pre>\n\n<p>GHC throws some error about the inferred type being ambiguous. Why?</p>\n"}, {"tags": ["haskell", "scotty"], "comments": [{"owner": {"reputation": 13807, "user_id": 2407038, "user_type": "registered", "accept_rate": 64, "profile_image": "https://www.gravatar.com/avatar/538f6f4a9aa43841841de7d8e8b169fc?s=128&d=identicon&r=PG&f=1", "display_name": "user2407038", "link": "https://stackoverflow.com/users/2407038/user2407038"}, "edited": false, "score": 2, "creation_date": 1425601402, "post_id": 28890002, "comment_id": 46041683, "body": "You can use cabal to generate the Controllers.Index module at configure time, probably."}, {"owner": {"reputation": 675, "user_id": 260401, "user_type": "registered", "accept_rate": 92, "profile_image": "https://www.gravatar.com/avatar/21fc27a2ac6cd9094a423997f0344a0b?s=128&d=identicon&r=PG", "display_name": "framp", "link": "https://stackoverflow.com/users/260401/framp"}, "reply_to_user": {"reputation": 13807, "user_id": 2407038, "user_type": "registered", "accept_rate": 64, "profile_image": "https://www.gravatar.com/avatar/538f6f4a9aa43841841de7d8e8b169fc?s=128&d=identicon&r=PG&f=1", "display_name": "user2407038", "link": "https://stackoverflow.com/users/2407038/user2407038"}, "edited": false, "score": 2, "creation_date": 1425619673, "post_id": 28890002, "comment_id": 46046130, "body": "You mean generating the <code>Index.hs</code> file from <code>Setup.hs</code>? That&#39;s pretty clever. I suppose I am right in assuming there is nothing in Haskell which will let me import modules dynamically, then? (this ticket actually seems to confirm this: <a href=\"https://ghc.haskell.org/trac/ghc/ticket/1475\" rel=\"nofollow noreferrer\">ghc.haskell.org/trac/ghc/ticket/1475</a>)"}, {"owner": {"reputation": 13807, "user_id": 2407038, "user_type": "registered", "accept_rate": 64, "profile_image": "https://www.gravatar.com/avatar/538f6f4a9aa43841841de7d8e8b169fc?s=128&d=identicon&r=PG&f=1", "display_name": "user2407038", "link": "https://stackoverflow.com/users/2407038/user2407038"}, "edited": false, "score": 1, "creation_date": 1425620371, "post_id": 28890002, "comment_id": 46046294, "body": "Yes, you cannot import modules dynamically. I think the priority on that ticket is quite low, so you shouldn&#39;t expect anything like that any time soon."}], "answers": [{"tags": [], "owner": {"reputation": 675, "user_id": 260401, "user_type": "registered", "accept_rate": 92, "profile_image": "https://www.gravatar.com/avatar/21fc27a2ac6cd9094a423997f0344a0b?s=128&d=identicon&r=PG", "display_name": "framp", "link": "https://stackoverflow.com/users/260401/framp"}, "is_accepted": true, "score": 0, "last_activity_date": 1506432371, "creation_date": 1506432371, "answer_id": 46427838, "question_id": 28890002, "link": "https://stackoverflow.com/questions/28890002/dynamically-importing-modules-in-haskell/46427838#46427838", "title": "Dynamically importing modules in Haskell", "body": "<p>A little bit late, but this package helps to generate the needed imports from the setup, as suggested in the comments:</p>\n\n<p><a href=\"https://hackage.haskell.org/package/imports\" rel=\"nofollow noreferrer\">https://hackage.haskell.org/package/imports</a></p>\n"}], "owner": {"reputation": 675, "user_id": 260401, "user_type": "registered", "accept_rate": 92, "profile_image": "https://www.gravatar.com/avatar/21fc27a2ac6cd9094a423997f0344a0b?s=128&d=identicon&r=PG", "display_name": "framp", "link": "https://stackoverflow.com/users/260401/framp"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 113, "favorite_count": 0, "accepted_answer_id": 46427838, "answer_count": 1, "score": 2, "last_activity_date": 1506432371, "creation_date": 1425599184, "question_id": 28890002, "link": "https://stackoverflow.com/questions/28890002/dynamically-importing-modules-in-haskell", "title": "Dynamically importing modules in Haskell", "body": "<p>I'm building a Scotty-based application and I'm trying to import and add a list of dynamic middlewares contained in a directory.</p>\n\n<p>I don't want to hard-code my list of middleware - but as of now I'm using a <code>Index.hs</code> which expose all the directory middlewares.</p>\n\n<p>Let's say I have a <code>Main.hs</code></p>\n\n<pre><code>import Controllers.Index (endpoints)\n...\n\nmain :: IO ()\nmain = do\n  port &lt;- read &lt;$&gt; getEnv \"PORT\"\n  scotty port $ do\n         middleware logStdoutDev\n         endpoints\n</code></pre>\n\n<p>Then in <code>Controllers/Index.hs</code>:</p>\n\n<pre><code>module Controllers.Index\n( endpoints ) where\n\nimport Controllers.Order (order)\nimport Controllers.User (user)\n...\nimport Web.Scotty (ScottyM)\n\nendpoints :: ScottyM ()\nendpoints = order &gt;&gt; user &gt;&gt; ...\n</code></pre>\n\n<p>Each <code>Controllers/*.hs</code> contains a middleware.</p>\n\n<p>What would be the best way to get rid of <code>Controllers/Index.hs</code>?\nIs there a way of importing all the modules from a directory and getting a list I can work with?</p>\n"}, {"tags": ["list", "function", "haskell"], "answers": [{"tags": [], "owner": {"reputation": 204954, "user_id": 1903116, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/w6Ffg.jpg?s=128&g=1", "display_name": "thefourtheye", "link": "https://stackoverflow.com/users/1903116/thefourtheye"}, "is_accepted": true, "score": 5, "last_activity_date": 1425619203, "last_edit_date": 1425619203, "creation_date": 1425598813, "answer_id": 28889940, "question_id": 28889899, "link": "https://stackoverflow.com/questions/28889899/haskell-check-if-all-items-in-list-are-greater-than-1/28889940#28889940", "title": "Haskell - Check if all items in list are greater than 1", "body": "<p>For a moment, just consider this expression,</p>\n\n<pre><code>x &gt; 1\n</code></pre>\n\n<p>we know for sure that, <code>1</code> is a number and we need to compare it with <code>x</code> and return the result. But we don't know the type of <code>x</code>. What if <code>x</code> is actually a String? Then the expression will fail. But Haskell's type system is strong and it senses the confusion here and asks you to fix it manually. It even offers you a hint,</p>\n\n<pre><code>Possible fix:\n  add (Num a) to the context of\n    the type signature for greaterOne :: Ord a =&gt; a -&gt; Bool\n</code></pre>\n\n<p>So, all you have to do is, explicitly specify that <code>a</code> is an instance of the class <code>Num</code>, as suggested by GHC, like this</p>\n\n<pre><code>checkLis :: Ord a =&gt; Num a =&gt; [a] -&gt; Bool\ncheckLis [] = True\n......\ngreaterOne :: Ord a =&gt; Num a =&gt; a -&gt; Bool\ngreaterOne x = x &gt; 1\n</code></pre>\n\n<p>Now, we are saying, <code>a</code> is not just an Ordered data-type, but it is actually of class <code>Num</code>.</p>\n\n<hr>\n\n<p>You can actually use the built-in function <a href=\"http://hackage.haskell.org/package/base-4.7.0.2/docs/Prelude.html#v:all\" rel=\"nofollow\"><code>all</code></a> to do this.</p>\n\n<pre><code>&gt; all greaterOne [2, 2, 3]\nTrue\n&gt; all greaterOne [1, 2, 3]\nFalse\n</code></pre>\n\n<p>The <code>all</code> function checks if the function passed as the first parameter, evaluates to <code>True</code> for every element in the list.</p>\n\n<hr>\n\n<p>We can actually do the same thing with just the partial expression, like this</p>\n\n<pre><code>Prelude&gt; all (&gt; 1) [2, 2, 3]\nTrue\nPrelude&gt; all (&gt; 1) [1, 2, 3]\nFalse\n</code></pre>\n"}], "owner": {"reputation": 7204, "user_id": 4333347, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/6b091d5e3973e6f65ec16442c3b1b16b?s=128&d=identicon&r=PG", "display_name": "buydadip", "link": "https://stackoverflow.com/users/4333347/buydadip"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 3101, "favorite_count": 1, "accepted_answer_id": 28889940, "answer_count": 1, "score": 2, "last_activity_date": 1425619203, "creation_date": 1425598569, "last_edit_date": 1425599150, "question_id": 28889899, "link": "https://stackoverflow.com/questions/28889899/haskell-check-if-all-items-in-list-are-greater-than-1", "title": "Haskell - Check if all items in list are greater than 1", "body": "<p>I need to return a Boolean True if all items are greater than 1, otherwise False. This is my attempt...</p>\n\n<pre><code>greaterOne :: Ord a=&gt;a-&gt;Bool\ngreaterOne x = x &gt; 1\n\ncheckLis :: Ord a=&gt;[a]-&gt;Bool\ncheckLis [] = True\ncheckLis (x:xs)\n    | greaterOne x = checkLis xs\n    | otherwise = False\n</code></pre>\n\n<p>This is the error I get, I keep trying to fix it but to no avail...</p>\n\n<pre><code>Could not deduce (Num a) arising from the literal \u20181\u2019\nfrom the context (Ord a)\n  bound by the type signature for greaterOne :: Ord a =&gt; a -&gt; Bool\n  at pract.hs:23:15-28\nPossible fix:\n  add (Num a) to the context of\n    the type signature for greaterOne :: Ord a =&gt; a -&gt; Bool\nIn the second argument of \u2018(&gt;)\u2019, namely \u20181\u2019\nIn the expression: x &gt; 1\nIn an equation for \u2018greaterOne\u2019: greaterOne x = x &gt; 1\n</code></pre>\n"}, {"tags": ["haskell"], "comments": [{"owner": {"reputation": 100892, "user_id": 745903, "user_type": "registered", "accept_rate": 74, "profile_image": "https://www.gravatar.com/avatar/50933f6638836741e620669b3940410e?s=128&d=identicon&r=PG", "display_name": "leftaroundabout", "link": "https://stackoverflow.com/users/745903/leftaroundabout"}, "edited": false, "score": 5, "creation_date": 1425596471, "post_id": 28889466, "comment_id": 46039927, "body": "What&#39;s wrong with just using <code>sum . map (^2)</code>?"}, {"owner": {"reputation": 46235, "user_id": 2541573, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/Z1qtP.png?s=128&g=1", "display_name": "jub0bs", "link": "https://stackoverflow.com/users/2541573/jub0bs"}, "edited": false, "score": 1, "creation_date": 1425596482, "post_id": 28889466, "comment_id": 46039939, "body": "Related: <a href=\"http://stackoverflow.com/questions/27407773/sum-of-squares-using-haskell\" title=\"sum of squares using haskell\">stackoverflow.com/questions/27407773/&hellip;</a>"}, {"owner": {"reputation": 44013, "user_id": 1477667, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/trgKM.jpg?s=128&g=1", "display_name": "dfeuer", "link": "https://stackoverflow.com/users/1477667/dfeuer"}, "edited": false, "score": 0, "creation_date": 1425596596, "post_id": 28889466, "comment_id": 46039982, "body": "Why do you want <code>sqSum</code> to take a function as an argument?"}], "answers": [{"tags": [], "owner": {"reputation": 100768, "user_id": 1899640, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/47374ccb28e4b0d2454b64f7b975bc66?s=128&d=identicon&r=PG", "display_name": "that other guy", "link": "https://stackoverflow.com/users/1899640/that-other-guy"}, "is_accepted": true, "score": 9, "last_activity_date": 1425597993, "last_edit_date": 1425597993, "creation_date": 1425596811, "answer_id": 28889579, "question_id": 28889466, "link": "https://stackoverflow.com/questions/28889466/haskell-square-everything-in-list/28889579#28889579", "title": "Haskell - Square everything in list", "body": "<p>The problem is that you're saying that the type of <code>sqSum</code> is <code>(a-&gt;a)-&gt;[a]-&gt;a</code>, in other words, that it can operate on any type of data.</p>\n\n<p>You then go on to say that the empty list gives a result of <code>0</code>. This is valid when the type is a number, but not when the type is a String, tuple or function. </p>\n\n<p>You can specify that your function is only supposed to work for numbers by adding a class constraint in the type signature:</p>\n\n<pre><code>sqSum :: Num a =&gt; (a-&gt;a)-&gt;[a]-&gt;a\nsqSum _ [] = 0\nsqSum f (x:xs) = f x + sqSum f xs\n\nsquare :: Int-&gt;Int\nsquare num = num*num\n</code></pre>\n\n<hr>\n\n<p>You can also take it a step further by decoupling the input type from the output type, and saying that you can accept a list of any type, as long as you have a function to convert it to a number to be summed:</p>\n\n<pre><code>sqSum :: Num b =&gt; (a -&gt; b) -&gt; [a] -&gt; b\n</code></pre>\n\n<p>Now you can do both <code>sqSum square [1,2,3]</code> and <code>sqSum length [\"a\", \"be\", \"sea\"]</code>.</p>\n\n<p>Oh, and instead of hard coding <code>+</code> and <code>0</code>, you can pass in a combiner function and a zero value:</p>\n\n<pre><code>sqSum :: (a -&gt; b -&gt; b) -&gt; b -&gt; [a] -&gt; b\nsqSum _ zero [] = zero\nsqSum f zero (a:rest) a `f` sqSum f zero rest\n</code></pre>\n\n<p>Now you can start from zero and add all the squares using</p>\n\n<pre><code>sqSum ((+) . square) 0 [1,2,3]\n</code></pre>\n\n<p>Or start from <code>1</code> and multiply all the squares using</p>\n\n<pre><code>sqSum ((*) . square) 1 [1,2,3]\n</code></pre>\n\n<p>Or start from empty string and concatenate all the numbers using</p>\n\n<pre><code>sqSum ((++) . show) \"\" [1,2,3]\n</code></pre>\n\n<p>This version of <code>sqSum</code> already exists in the standard libraries, and is called <code>foldr</code>.</p>\n"}], "owner": {"reputation": 7204, "user_id": 4333347, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/6b091d5e3973e6f65ec16442c3b1b16b?s=128&d=identicon&r=PG", "display_name": "buydadip", "link": "https://stackoverflow.com/users/4333347/buydadip"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 6043, "favorite_count": 1, "accepted_answer_id": 28889579, "answer_count": 1, "score": 1, "last_activity_date": 1425597993, "creation_date": 1425596330, "last_edit_date": 1425596864, "question_id": 28889466, "link": "https://stackoverflow.com/questions/28889466/haskell-square-everything-in-list", "title": "Haskell - Square everything in list", "body": "<p>I am trying to find the sum of squares of everything in a list, for example :</p>\n\n<pre><code>[1,2,3] --&gt; 1+4+9 --&gt; 14\n</code></pre>\n\n<p>Here is my attempt:</p>\n\n<pre><code>sqSum :: (a-&gt;a)-&gt;[a]-&gt;a\nsqSum _ [] = 0\nsqSum f (x:xs) = f x + sqSum f xs\n\nsquare :: Int-&gt;Int\nsquare num = num*num\n</code></pre>\n\n<p>I use it as so...</p>\n\n<pre><code>sqSum square [1,2,3]\n</code></pre>\n\n<p>But I get an error:</p>\n\n<pre class=\"lang-none prettyprint-override\"><code>square.hs:2:14:\n    No instance for (Num a) arising from the literal `0'\n    Possible fix:\n      add (Num a) to the context of\n        the type signature for sqSum :: (a -&gt; a) -&gt; [a] -&gt; a\n    In the expression: 0\n    In an equation for `sqSum': sqSum _ [] = 0\n</code></pre>\n\n<p>Can someone help me out?</p>\n"}, {"tags": ["haskell", "error-handling", "crash", "ghc", "compiler-warnings"], "comments": [{"owner": {"reputation": 44013, "user_id": 1477667, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/trgKM.jpg?s=128&g=1", "display_name": "dfeuer", "link": "https://stackoverflow.com/users/1477667/dfeuer"}, "edited": false, "score": 2, "creation_date": 1425593185, "post_id": 28888587, "comment_id": 46038436, "body": "Partiality inference is actually currently under discussion by the GHC devs. In the mean time, your best bet is probably to hide the imports of those functions, and (to make sure they&#39;re really hidden) redefine them yourself: <code>fromJust = ()</code> should do the trick."}, {"owner": {"reputation": 56659, "user_id": 450128, "user_type": "registered", "accept_rate": 62, "profile_image": "https://www.gravatar.com/avatar/2f72b3fdc99fe9fd1bbeb2f9da1d2c0a?s=128&d=identicon&r=PG", "display_name": "Ben", "link": "https://stackoverflow.com/users/450128/ben"}, "edited": false, "score": 3, "creation_date": 1425593700, "post_id": 28888587, "comment_id": 46038707, "body": "Even just redefine them in a module, which you import unqualified as a way of &quot;turning on the warning&quot;. You&#39;ll then get an ambiguity error pointing you at any places you actually use the Prelude&#39;s versions (unless you qualify then, as in <code>Prelude.fromJust</code>). It won&#39;t help for partial functions you use from qualified imports of other modules though."}], "answers": [{"comments": [{"owner": {"reputation": 4530, "user_id": 94687, "user_type": "registered", "accept_rate": 45, "profile_image": "https://www.gravatar.com/avatar/ef249e4381c9d55297cddc4bd5b5c3c2?s=128&d=identicon&r=PG", "display_name": "imz -- Ivan Zakharyaschev", "link": "https://stackoverflow.com/users/94687/imz-ivan-zakharyaschev"}, "edited": false, "score": 0, "creation_date": 1433439774, "post_id": 28891571, "comment_id": 49364622, "body": "Just a note for me. I came to the idea that whenever I want to use a non-total pattern match in a practically useful code (and I believe that semantically I exhaust all real cases), I shouldn&#39;t. In some cases it should be at least possible to make the assumption more explicit by wrapping the non-total function in a class and define it near the place where it is obvious that it is OK (as workaround for totally unsafe and uncontrollable code). Example: <a href=\"https://github.com/bos/aeson/issues/79#issuecomment-108959252\" rel=\"nofollow noreferrer\">a <code>ToJSONObject</code> constraint</a> for data encoded generically and deconstructed then."}], "tags": [], "owner": {"reputation": 126897, "user_id": 791604, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/ce991df7a056248d5e4f6fc3659ba733?s=128&d=identicon&r=PG", "display_name": "Daniel Wagner", "link": "https://stackoverflow.com/users/791604/daniel-wagner"}, "is_accepted": false, "score": 3, "last_activity_date": 1425609908, "creation_date": 1425609908, "answer_id": 28891571, "question_id": 28888587, "link": "https://stackoverflow.com/questions/28888587/can-ghc-warn-about-the-uses-of-dangerous-non-total-functions/28891571#28891571", "title": "Can GHC warn about the uses of dangerous non-total functions?", "body": "<p>GHC can warn about definitions with partial patterns with <code>-fwarn-incomplete-patterns</code> (though does not warn about uses of values that include incomplete patterns). Additionally, Neil Mitchell's <a href=\"http://community.haskell.org/~ndm/catch/\" rel=\"nofollow\">catch</a> attempts a slightly more detailed analysis to identify safe and unsafe invocations of partial functions. (Though of course that's an undecidable problem in general, so it won't always be right!)</p>\n"}], "owner": {"reputation": 4530, "user_id": 94687, "user_type": "registered", "accept_rate": 45, "profile_image": "https://www.gravatar.com/avatar/ef249e4381c9d55297cddc4bd5b5c3c2?s=128&d=identicon&r=PG", "display_name": "imz -- Ivan Zakharyaschev", "link": "https://stackoverflow.com/users/94687/imz-ivan-zakharyaschev"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 355, "favorite_count": 1, "answer_count": 1, "score": 11, "last_activity_date": 1425609908, "creation_date": 1425592773, "question_id": 28888587, "link": "https://stackoverflow.com/questions/28888587/can-ghc-warn-about-the-uses-of-dangerous-non-total-functions", "title": "Can GHC warn about the uses of dangerous non-total functions?", "body": "<p>I have been writing quickly some code in Haskell, and used a dangerous non-total function, namely <code>fromJust</code> (where I expect a value from input). I'm going to think later what kind of error-handling style I want to use.</p>\n\n<p>Can GHC help me make sure that I have got rid of all uses of dangerous non-total functions (like <code>fromJust</code> or <code>head</code>, which could crash) , give me warnings where they are.</p>\n"}, {"tags": ["haskell", "functional-programming", "monads", "purely-functional"], "comments": [{"owner": {"reputation": 126897, "user_id": 791604, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/ce991df7a056248d5e4f6fc3659ba733?s=128&d=identicon&r=PG", "display_name": "Daniel Wagner", "link": "https://stackoverflow.com/users/791604/daniel-wagner"}, "edited": false, "score": 3, "creation_date": 1425591444, "post_id": 28888114, "comment_id": 46037592, "body": "Since your first thought is to jump to a monad, you will like <a href=\"http://hackage.haskell.org/package/MonadRandom\" rel=\"nofollow noreferrer\">MonadRandom</a>."}, {"owner": {"reputation": 37219, "user_id": 1523776, "user_type": "moderator", "accept_rate": 87, "profile_image": "https://www.gravatar.com/avatar/b3e0b5c8e42a8c38009ef2d969f8dabb?s=128&d=identicon&r=PG", "display_name": "Benjamin Hodgson", "link": "https://stackoverflow.com/users/1523776/benjamin-hodgson"}, "edited": false, "score": 3, "creation_date": 1425592255, "post_id": 28888114, "comment_id": 46038017, "body": "&quot;that generator would have to be passed through the whole stack of invocations&quot; - that&#39;s a good thing. I want to <i>know</i> which functions are impure. A function that uses randomness is not pure; Haskell deals with this by explicitly passing a random number generator around."}], "answers": [{"comments": [{"owner": {"reputation": 44013, "user_id": 1477667, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/trgKM.jpg?s=128&g=1", "display_name": "dfeuer", "link": "https://stackoverflow.com/users/1477667/dfeuer"}, "edited": false, "score": 1, "creation_date": 1425593610, "post_id": 28888658, "comment_id": 46038652, "body": "The thing that annoys me about randomness in Haskell is that using the same code for both pseudo-random and truly random numbers seems to pretty much require lazy I/O, which is widely shunned. If you commit to pseudo-random numbers and then later decide to switch to truly random ones, things get pretty icky. Perhaps <code>pipes</code> or <code>conduit</code> or some arrowy library offers a good solution; I don&#39;t know."}, {"owner": {"reputation": 11971, "user_id": 1100135, "user_type": "registered", "accept_rate": 53, "profile_image": "https://www.gravatar.com/avatar/e7b273722f4261cd61c3256374da73cc?s=128&d=identicon&r=PG", "display_name": "piotrek", "link": "https://stackoverflow.com/users/1100135/piotrek"}, "edited": false, "score": 0, "creation_date": 1425594331, "post_id": 28888658, "comment_id": 46039001, "body": "thanks. but what about nesting? now you&#39;re calling this function directly from IO monad. if we want to call this function from another function then we would have to make that function have type X -&gt; Rand g Y, right?"}, {"owner": {"reputation": 64805, "user_id": 286871, "user_type": "registered", "accept_rate": 77, "profile_image": "https://i.stack.imgur.com/xNBpr.png?s=128&g=1", "display_name": "Tikhon Jelvis", "link": "https://stackoverflow.com/users/286871/tikhon-jelvis"}, "edited": false, "score": 1, "creation_date": 1425594481, "post_id": 28888658, "comment_id": 46039062, "body": "Yes, the return type would have to be in <code>Rand</code>. The advantage of being a monad is that we can combine functions of the type <code>a -&gt; Rand g b</code> easily without making the underlying plumbing explicit. This lets us use the types to mark which functions depend on randomness (we can&#39;t return a <code>b</code> directly because it would lose this information) without too much hassle in actually putting it together."}, {"owner": {"reputation": 56659, "user_id": 450128, "user_type": "registered", "accept_rate": 62, "profile_image": "https://www.gravatar.com/avatar/2f72b3fdc99fe9fd1bbeb2f9da1d2c0a?s=128&d=identicon&r=PG", "display_name": "Ben", "link": "https://stackoverflow.com/users/450128/ben"}, "reply_to_user": {"reputation": 11971, "user_id": 1100135, "user_type": "registered", "accept_rate": 53, "profile_image": "https://www.gravatar.com/avatar/e7b273722f4261cd61c3256374da73cc?s=128&d=identicon&r=PG", "display_name": "piotrek", "link": "https://stackoverflow.com/users/1100135/piotrek"}, "edited": false, "score": 1, "creation_date": 1425603670, "post_id": 28888658, "comment_id": 46042326, "body": "@piotrek The point is that all of the functions involved in the other layers of nested calls are <i>also</i> dependent on (and affecting) the random generator state; being explicit about this in the types is a good thing. The functional programming approach to this challenge is to come up with abstractions that make it easy to work these kinds of functions (like Monads). The imperative programming approach to this challenge is to make the information flow implicit."}], "tags": [], "owner": {"reputation": 64805, "user_id": 286871, "user_type": "registered", "accept_rate": 77, "profile_image": "https://i.stack.imgur.com/xNBpr.png?s=128&g=1", "display_name": "Tikhon Jelvis", "link": "https://stackoverflow.com/users/286871/tikhon-jelvis"}, "is_accepted": true, "score": 2, "last_activity_date": 1425593071, "creation_date": 1425593071, "answer_id": 28888658, "question_id": 28888114, "link": "https://stackoverflow.com/questions/28888114/randomness-in-a-nested-pure-function/28888658#28888658", "title": "Randomness in a nested pure function", "body": "<p>You would, in fact, use a variant of the state monad to pass the random generator around behind the scenes. The <code>Rand</code> type in <code>Control.Monad.Random</code> helps with this. The API is a bit confusing, but more because it's polymorphic over the type of random generator you use than because it has to be functional. This extra bit of scaffolding is useful, however, because you can easily reuse your existing code with different random generators which lets you test different algorithms as well as explicitly controlling whether the generator is deterministic (good for testing) or seeded with outside data (in <code>IO</code>).</p>\n\n<p>Here's a simple example of <code>Rand</code> in action. The <code>RandomGen g =&gt;</code> in the type signature tells us that we can use <em>any</em> type of random generator for it. We have to explicitly annotate <code>n</code> as an <code>Int</code> because otherwise GHC only knows that it has to be <em>some</em> numeric type that can be generated and turned into a string, which can be one of multiple possible options (like <code>Double</code>).</p>\n\n<pre><code>randomReplace :: RandomGen g =&gt; String -&gt; Rand g String\nrandomReplace = foldM go \"\"\n  where go str '#' = do\n          n :: Int &lt;- getRandomR (0, 10)\n          return (str ++ show n)\n        go str chr = return $ str ++ [chr]\n</code></pre>\n\n<p>To run this, we need to get a random generator from somewhere and pass it into <code>evalRand</code>. The easiest way to do this is to get the global system generator which we can do in <code>IO</code>:</p>\n\n<pre><code>main :: IO ()\nmain = do gen &lt;- getStdGen\n          print $ evalRand (randomReplace \"ab#c#\") gen\n</code></pre>\n\n<p>This is such a common pattern that the library provides an <code>evalRandIO</code> function which does it for you:</p>\n\n<pre><code>main :: IO ()\nmain = do res &lt;- evalRandIO $ randomReplace \"ab#c#\"\n          print res\n</code></pre>\n\n<p>In the end, the code is a bit more explicit about having a random generator and passing it around, but it's still reasonably easy to follow. For more involved code, you could also use <code>RandT</code>, which allows you to extend other monads (like <code>IO</code>) with the ability to generate random values, letting you relegate all the plumbing and setup to one part of your code.</p>\n"}, {"tags": [], "owner": {"reputation": 11986, "user_id": 3237465, "user_type": "registered", "accept_rate": 76, "profile_image": "https://i.stack.imgur.com/vOArX.png?s=128&g=1", "display_name": "user3237465", "link": "https://stackoverflow.com/users/3237465/user3237465"}, "is_accepted": false, "score": 0, "last_activity_date": 1425595469, "creation_date": 1425595469, "answer_id": 28889279, "question_id": 28888114, "link": "https://stackoverflow.com/questions/28888114/randomness-in-a-nested-pure-function/28889279#28889279", "title": "Randomness in a nested pure function", "body": "<p>It's just a monadic mapping</p>\n\n<pre><code>import Control.Applicative\nimport Control.Monad.Random\nimport Data.Char\n\nrandomReplace :: RandomGen g =&gt; String -&gt; Rand g String\nrandomReplace = mapM f where\n    f '#' = intToDigit &lt;$&gt; getRandomR (0, 10)\n    f  c  = return c\n\nmain = evalRandIO (randomReplace \"#abc#def#\") &gt;&gt;= print\n</code></pre>\n"}], "owner": {"reputation": 11971, "user_id": 1100135, "user_type": "registered", "accept_rate": 53, "profile_image": "https://www.gravatar.com/avatar/e7b273722f4261cd61c3256374da73cc?s=128&d=identicon&r=PG", "display_name": "piotrek", "link": "https://stackoverflow.com/users/1100135/piotrek"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 267, "favorite_count": 1, "accepted_answer_id": 28888658, "answer_count": 2, "score": 2, "last_activity_date": 1425607684, "creation_date": 1425591009, "last_edit_date": 1425607684, "question_id": 28888114, "link": "https://stackoverflow.com/questions/28888114/randomness-in-a-nested-pure-function", "title": "Randomness in a nested pure function", "body": "<p>I want to provide a function that replaces each occurrence of <code>#</code> in a string with a different random number. In a non-pure language, it's trivial. However, how should it be designed in a pure language? I don't want to use <code>unsafePerformIO</code>, as it rather looks like a hack and not a proper design.</p>\n\n<p>Should this function require a random generator as one of its parameters? And if so, would that generator have to be passed through the whole stack of invocations? Are there other possible approaches? Should I use the <code>State</code> monad, here? I would appreciate a toy example demonstrating a viable approach...</p>\n"}]